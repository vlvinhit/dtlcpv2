/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{r as t}from"./mathUtils.js";import{E as e,g as s,F as r}from"./unitUtils.js";import{j as i,s as o}from"./mat4.js";import{s as n,i as a,c as l,n as c,f as u}from"./vec3.js";import{j as m,k as p}from"./typedArrayUtil.js";import{projectPointToVector as f,projectVectorToVector as d,projectVectorToDehydratedPoint as h,projectVectorToPoint as v}from"../geometry/projection.js";import{A as y,b as S}from"./vector.js";import{c as A}from"./vec3f64.js";import g from"../geometry/SpatialReference.js";import{g as j}from"./spatialReferenceEllipsoidUtils.js";import{f as _,b as R}from"./boundedPlane.js";import{f as w,s as C}from"./sphere.js";import{h as P}from"./plane.js";import{s as M}from"./ray.js";import{i as b}from"./ElevationProvider.js";import{V as U}from"./ViewingMode.js";function x(t,e,s=function(t){return{operations:t,value:t.create()}}(t)){return s.operations=t,t.copy(e,s.value),s}const B=2**50;function E(t,e,s,r){return t.operations.setAltitudeAt(t.value,e,s,r)}function G(t,e,s){return t.operations.elevate(t.value,e,s.value)}const F=A();function I(t,e,s,r,i){return i[0]=a(t,e),i[1]=a(t,s),i[2]=a(t,r),i}function L(t,e,s,r,i){l(s,t),l(Y,e),c(Y,Y),u(r,Y,s),u(i,r,s)}function V(t,e){return t?j(e):e.isGeographic?g.PlateCarree:e}const Y=A();class Z{constructor(t,e,s,r){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=s,this._coordinateSystem=r,this._tmpCoordinateSystem=function(t){const{value:e,operations:s}=t;return{operations:s,value:s.create(e)}}(r)}set extent(t){t&&function(t,e,s){t.operations.setExtent(t.value,e,s.value)}(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return s=t,(e=this._coordinateSystem).operations.altitudeAt(e.value,s);var e,s}setAltitude(t,e,s=t){return E(this._coordinateSystem,s,e,t)}setAltitudeOfTransformation(t,e){!function(t,e,s,r){e!==r&&i(r,e),n(F,r[12],r[13],r[14]),E(t,F,s,F),r[12]=F[0],r[13]=F[1],r[14]=F[2]}(this._coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return r=t,i=e,(s=this._coordinateSystem).operations.axisAt(s.value,r,y.Z,i);var s,r,i}worldBasisAtPosition(t,e,s){return i=t,o=e,n=s,(r=this._coordinateSystem).operations.axisAt(r.value,i,o,n);var r,i,o,n}basisMatrixAtPosition(t,e){const s=this.worldBasisAtPosition(t,y.X,M.get()),r=this.worldBasisAtPosition(t,y.Y,M.get()),i=this.worldBasisAtPosition(t,y.Z,M.get());return o(e,s[0],s[1],s[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,0,0,0,1),e}headingAtPosition(e,s){const r=this.worldUpAtPosition(e,M.get()),i=this.worldBasisAtPosition(e,y.Y,M.get()),o=S(s,i,r);return t(o)}intersectManifoldClosestSilhouette(t,e,s){var r,i,o;return G(this._coordinateSystem,e,this._tmpCoordinateSystem),i=t,o=s,(r=this._tmpCoordinateSystem).operations.intersectRayClosestSilhouette(r.value,i,o),s}intersectManifold(t,e,s){G(this._coordinateSystem,e,this._tmpCoordinateSystem);const r=M.get();return o=t,n=r,(i=this._tmpCoordinateSystem).operations.intersectRay(i.value,o,n)?l(s,r):null;var i,o,n}intersectInfiniteManifold(t,e,s){if(this.viewingMode===U.Global)return this.intersectManifold(t,e,s);G(this._coordinateSystem,e,this._tmpCoordinateSystem);const r=this._tmpCoordinateSystem.value,i=M.get();return P(r.plane,t,i)?l(s,i):null}toRenderCoords(t,e,s){return b(t)?f(t,e,this.spatialReference):d(t,e,s,this.spatialReference)}fromRenderCoords(t,e,s=null){return b(e)?(null!=s&&(e.spatialReference=s),h(t,this.spatialReference,e)):function(t){return m(t)&&t.length>=3}(r=e)||function(t){return(p(t)||Array.isArray(t))&&t.length>=3}(r)?d(t,this.spatialReference,e,s)?e:null:v(t,this.spatialReference,e);var r}static create(t,r){switch(t){case U.Local:return new Z(U.Local,r,s(r),x(R,_([0,0,0],[B,0,0],[0,B,0])));case U.Global:return new Z(U.Global,r,1,function(t){return x(C,w(0,0,0,e(t).radius))}(r))}}static renderUnitScaleFactor(t,e){return r(t)/r(e)}}export{Z as R,L as c,V as r,I as v};
