/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{substitute as e}from"../intl.js";import{i as t}from"./typedArrayUtil.js";import{t as n,r}from"./string.js";import{d as a,b as i,a as s,f as o}from"./date.js";import{isDateField as l,D as p,NumericRangeValidationError as m,g as u,getFieldRange as d,TypeValidationError as c}from"../layers/support/fieldUtils.js";const f=e=>"field"===e?.type,y=e=>"group"===e?.type,T=e=>"relationship"===e?.type,E=e=>!y(e)&&null!=e.group,b=e=>"field"===e.type,O=e=>"group"===e.type,g=e=>"relationship"===e.type,v=e=>e.reduce(((e,t)=>y(t)?[...e,...t.inputs]:[...e,t]),[]),h=e=>v(e).filter(f),x=e=>v(e).filter(T),j=(e,t)=>null!=e&&e.input?.type===t,N=e=>null!=e&&(j(e,"text-box")||j(e,"text-area")),_=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),A=e=>"items"in e,L={typeFieldName:null,types:[]};function U(e,a,i){const s=Object.keys(a).filter((t=>n(e,t))),o=s.map((e=>a[e])),l=s.map((e=>i.get(e))).filter(t);return function(e,t){return r(r(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}(e,D(o,l))}function D(e,t){const n=t.map(((t,n)=>{let r=e[n];if(t.domain&&"coded-value"===t.domain.type){const e=t.domain.codedValues.find((e=>e.code===r));e?.name&&(r=e.name)}return l(t)&&(r=F(t,r)),[t.name,r]}));return Object.fromEntries(n)}function F(e,t){if(!e||null==t)return null;switch(e.type){case"date":return o(t);case"date-only":return s(t);case"time-only":return i(t);case"timestamp-offset":return a(t);default:return null}}const I=new Set(["date-only","time-only","timestamp-offset"]),w=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:L:L,R=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};var V;!function(e){e.TOO_SHORT="length-validation-error::too-short"}(V||(V={}));const S={type:"number"},C={type:"number",intlOptions:{notation:"scientific"}},k={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};function q(e){return e>=1e7||e<=-1e7}const G=(t,n)=>{const{dataType:r,domain:a,error:i,field:s,minLength:o,value:l,required:f}=t;if(!n||!i)return null;if(f&&null===l)return n.validationErrors.cannotBeNull;if(i===p.VALUE_OUT_OF_RANGE||i===m.OUT_OF_RANGE){const t=u(a)||d(s);return e(n.validationErrors.outsideRange,t,{format:{max:"date"===r?k:q(t.max)?C:S,min:"date"===r?k:q(t.min)?C:S}})}return i===p.INVALID_CODED_VALUE?n.validationErrors.invalidCodedValue:i===c.INVALID_TYPE?n.validationErrors.invalidType:i===V.TOO_SHORT?e(n.validationErrors.tooShort,{min:o}):null},H=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":r||n||"table"},P=e=>{const t=[];if(e.formTemplate){const{description:r,title:a}=e.formTemplate;e.fields?.forEach((e=>{const i=a&&n(a,e.name),s=r&&n(r,e.name);(i||s)&&t.push(e.name)}))}return t};function B(e){return!(!("formTemplate"in e)||!e.formTemplate)&&(e.formTemplate.elements?.filter(b)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}export{V as L,f as a,T as b,E as c,j as d,H as e,F as f,G as g,_ as h,y as i,A as j,B as k,h as l,x as m,O as n,b as o,U as p,g as q,w as r,N as s,R as t,I as u,D as v,P as w};
