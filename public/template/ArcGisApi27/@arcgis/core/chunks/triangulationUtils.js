/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{e as n}from"./earcut.js";import{i as t}from"../geometry/Polygon.js";import{d as e,a as o,n as s}from"./DoubleArray.js";import{c as r}from"./Indices.js";import{d as i}from"./deduplicate.js";function l(t){const l=c(t.rings,t.hasZ,f.CCW_IS_HOLE),a=new Array;let h=0,g=0;for(const t of l.polygons){const o=t.count,s=t.index,i=e(l.position,3*s,3*o),c=t.holeIndices.map((n=>n-s)),f=r(n(i,c,3));a.push({position:i,faces:f}),h+=i.length,g+=f.length}const p=function(n,t,e){if(1===n.length)return n[0];const o=s(t),i=new Array(e);let l=0,c=0,a=0;for(const t of n){for(let n=0;n<t.position.length;n++)o[l++]=t.position[n];for(const n of t.faces)i[c++]=n+a;a=l/3}return{position:o,faces:r(i)}}(a,h,g),u=Array.isArray(p.position)?i(p.position,3,{originalIndices:p.faces}):i(p.position.buffer,6,{originalIndices:p.faces});return p.position=o(new Float64Array(u.buffer)),p.faces=u.indices,p}function c(n,e,o){const r=n.length,i=new Array(r),l=new Array(r),c=new Array(r);let h=0,g=0,p=0,u=0;for(let t=0;t<r;++t)u+=n[t].length;const d=s(3*u);let y=0;for(let s=r-1;s>=0;s--){const u=n[s],m=o===f.CCW_IS_HOLE&&!t(u,!1,!1);if(m&&1!==r)i[h++]=u;else{let n=u.length;for(let t=0;t<h;++t)n+=i[t].length;const t={index:y,pathLengths:new Array(h+1),count:n,holeIndices:new Array(h)};t.pathLengths[0]=u.length,u.length>0&&(c[p++]={index:y,count:u.length}),y=m?a(u,u.length-1,-1,d,y,u.length,e):a(u,0,1,d,y,u.length,e);for(let n=0;n<h;++n){const o=i[n];t.holeIndices[n]=y,t.pathLengths[n+1]=o.length,o.length>0&&(c[p++]={index:y,count:o.length}),y=a(o,0,1,d,y,o.length,e)}h=0,t.count>0&&(l[g++]=t)}}for(let n=0;n<h;++n){const t=i[n];t.length>0&&(c[p++]={index:y,count:t.length}),y=a(t,0,1,d,y,t.length,e)}return l.length=g,c.length=p,{position:d,polygons:l,outlines:c}}function a(n,t,e,o,s,r,i){s*=3;for(let l=0;l<r;++l){const r=n[t];o[s++]=r[0],o[s++]=r[1],o[s++]=i?r[2]:0,t+=e}return s/3}var f;!function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(f||(f={}));export{f as C,c as p,l as t};
