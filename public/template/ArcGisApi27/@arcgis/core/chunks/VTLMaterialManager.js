/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{S as e}from"./enums2.js";import{r}from"./resolver.js";import{g as t}from"./programUtils.js";const a=e=>t({ID:e.id,PATTERN:e.pattern}),s={shaders:e=>({vertexShader:a(e)+r("background/background.vert"),fragmentShader:a(e)+r("background/background.frag")})},n=e=>t({ID:e.id}),i={shaders:e=>({vertexShader:n(e)+r("circle/circle.vert"),fragmentShader:n(e)+r("circle/circle.frag")})},d=e=>t({ID:e.id,PATTERN:e.pattern}),c={shaders:e=>({vertexShader:d(e)+r("fill/fill.vert"),fragmentShader:d(e)+r("fill/fill.frag")})},o=e=>t({ID:e.id}),g={shaders:e=>({vertexShader:o(e)+r("outline/outline.vert"),fragmentShader:o(e)+r("outline/outline.frag")})},h=e=>t({ID:e.id,SDF:e.sdf}),l={shaders:e=>({vertexShader:h(e)+r("icon/icon.vert"),fragmentShader:h(e)+r("icon/icon.frag")})},u=e=>t({ID:e.id,PATTERN:e.pattern,SDF:e.sdf}),m={shaders:e=>({vertexShader:u(e)+r("line/line.vert"),fragmentShader:u(e)+r("line/line.frag")})},p=e=>t({ID:e.id}),f={shaders:e=>({vertexShader:p(e)+r("text/text.vert"),fragmentShader:p(e)+r("text/text.frag")})};class S{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((e=>e.dispose())),this._programByKey.clear()}getMaterialProgram(e,r,t){const a=r.key<<3|this._getMaterialOptionsValue(r.type,t);if(this._programByKey.has(a))return this._programByKey.get(a);const s=this._getProgramTemplate(r.type),{shaders:n}=s,{vertexShader:i,fragmentShader:d}=n(t),c=r.getShaderHeader(),o=r.getShaderMain(),g=i.replace("#pragma header",c).replace("#pragma main",o),h=e.programCache.acquire(g,d,r.getAttributeLocations());return this._programByKey.set(a,h),h}_getMaterialOptionsValue(r,t){switch(r){case e.BACKGROUND:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case e.FILL:{const e=t;return(e.pattern?1:0)<<1|(e.id?1:0)}case e.OUTLINE:return t.id?1:0;case e.LINE:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1|(e.id?1:0)}case e.ICON:{const e=t;return(e.sdf?1:0)<<1|(e.id?1:0)}case e.CIRCLE:case e.TEXT:return t.id?1:0;default:return 0}}_getProgramTemplate(r){switch(r){case e.BACKGROUND:return s;case e.CIRCLE:return i;case e.FILL:return c;case e.ICON:return l;case e.LINE:return m;case e.OUTLINE:return g;case e.TEXT:return f;default:return null}}}export{S as V};
