/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{p as r,o as t,ak as o,w as e,q as i,al as s,am as a,F as n,V as m,an as p,ao as c,ap as d,aq as u,L as j,ar as l,as as y,at as f}from"./arcadeUtils.js";import{A as v,E as g}from"./executionError.js";import"../geometry.js";import"./ensureType.js";import"./typedArrayUtil.js";import"./Logger.js";import"../config.js";import"./object.js";import"../core/lang.js";import"./string.js";import"../geometry/Extent.js";import"./tslib.es6.js";import"../core/accessorSupport/decorators/property.js";import"./get.js";import"./utils.js";import"./maybe.js";import"./metadata.js";import"../core/Error.js";import"../core/accessorSupport/decorators/subclass.js";import"./tracking.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"./ObjectPool.js";import"./ObservableBase.js";import"./watch.js";import"./ArrayPool.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/promiseUtils.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./jsonMap.js";import"./writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./extentUtils.js";import"./aaBoundingRect.js";import"./mathUtils.js";import"./vec3.js";import"./vec3f64.js";import"./common.js";import"./vec4.js";import"../geometry/Polyline.js";import"./typeUtils.js";import"../geometry/support/jsonUtils.js";import"./ArcadeDate.js";import"./datetime.js";import"./ImmutableArray.js";import"./number3.js";import"./locale.js";import"../kernel.js";import"../core/urlUtils.js";import"../layers/support/Field.js";import"./enumeration.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"./featureConversionUtils.js";import"./aaBoundingBox.js";import"./OptimizedFeature.js";import"./OptimizedFeatureSet.js";import"./OptimizedGeometry.js";import"./arcadeTimeUtils.js";import"../layers/support/FieldsIndex.js";import"../layers/support/fieldUtils.js";import"./arcadeOnDemand.js";import"./TimeReference.js";import"../core/Clonable.js";import"./centroid2.js";import"./hash.js";import"../portal/Portal.js";import"../request.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";function b(r,t){return r&&r.domain?"coded-value"===r.domain.type||"codedValue"===r.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:r.domain.name,dataType:f[r.field.type],codedValues:r.domain.codedValues.map((r=>({name:r.name,code:r.code})))},m(t)):n.convertObjectToArcadeDictionary({type:"range",name:r.domain.name,dataType:f[r.field.type],min:r.domain.min,max:r.domain.max},m(t)):null}function w(f){"async"===f.mode&&(f.functions.domain=function(a,n){return f.standardFunctionAsync(a,n,(async(m,p,c)=>{if(r(c,2,3,a,n),t(c[0]))return b(o(c[0],e(c[1]),void 0===c[2]?void 0:c[2]),a);if(i(c[0]))return await c[0]._ensureLoaded(),b(s(e(c[1]),c[0],null,void 0===c[2]?void 0:c[2]),a);throw new v(a,g.InvalidParameter,n)}))},f.functions.subtypes=function(o,e){return f.standardFunctionAsync(o,e,(async(s,p,c)=>{if(r(c,1,1,o,e),t(c[0])){const r=a(c[0]);return r?n.convertObjectToArcadeDictionary(r,m(o)):null}if(i(c[0])){await c[0]._ensureLoaded();const r=c[0].subtypes();return r?n.convertObjectToArcadeDictionary(r,m(o)):null}throw new v(o,g.InvalidParameter,e)}))},f.functions.domainname=function(o,a){return f.standardFunctionAsync(o,a,(async(n,m,d)=>{if(r(d,2,4,o,a),t(d[0]))return p(d[0],e(d[1]),d[2],void 0===d[3]?void 0:d[3]);if(i(d[0])){await d[0]._ensureLoaded();const r=s(e(d[1]),d[0],null,void 0===d[3]?void 0:d[3]);return c(r,d[2])}throw new v(o,g.InvalidParameter,a)}))},f.signatures.push({name:"domainname",min:2,max:4}),f.functions.domaincode=function(o,a){return f.standardFunctionAsync(o,a,(async(n,m,p)=>{if(r(p,2,4,o,a),t(p[0]))return d(p[0],e(p[1]),p[2],void 0===p[3]?void 0:p[3]);if(i(p[0])){await p[0]._ensureLoaded();const r=s(e(p[1]),p[0],null,void 0===p[3]?void 0:p[3]);return u(r,p[2])}throw new v(o,g.InvalidParameter,a)}))},f.signatures.push({name:"domaincode",min:2,max:4})),f.functions.text=function(t,o){return f.standardFunctionAsync(t,o,((e,s,a)=>{if(r(a,1,2,t,o),!i(a[0]))return l(a[0],a[1]);{const r=j(a[1],"");if(""===r)return a[0].castToText();if("schema"===r.toLowerCase())return a[0].convertToText("schema",e.abortSignal);if("featureset"===r.toLowerCase())return a[0].convertToText("featureset",e.abortSignal)}}))},f.functions.gdbversion=function(o,e){return f.standardFunctionAsync(o,e,(async(s,a,n)=>{if(r(n,1,1,o,e),t(n[0]))return n[0].gdbVersion();if(i(n[0]))return(await n[0].load()).gdbVersion;throw new v(o,g.InvalidParameter,e)}))},f.functions.schema=function(o,e){return f.standardFunctionAsync(o,e,(async(s,a,p)=>{if(r(p,1,1,o,e),i(p[0]))return await p[0].load(),n.convertObjectToArcadeDictionary(p[0].schema(),m(o));if(t(p[0])){const r=y(p[0]);return r?n.convertObjectToArcadeDictionary(r,m(o)):null}throw new v(o,g.InvalidParameter,e)}))}}export{w as registerFunctions};
