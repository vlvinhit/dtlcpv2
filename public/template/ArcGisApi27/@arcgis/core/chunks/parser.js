/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{g as t,a as e,i as r,b as n,h as o}from"./colorUtils.js";import a from"../core/Error.js";import{p as u}from"./screenUtils.js";import{s,t as i}from"./mat4.js";import{c}from"./_commonjsHelpers.js";function l(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}l();class f{constructor(t,e,r){this.strength=t,this.radius=e,this.threshold=r,this.type="bloom"}interpolate(t,e,r){this.strength=y(t.strength,e.strength,r),this.radius=y(t.radius,e.radius,r),this.threshold=y(t.threshold,e.threshold,r)}clone(){return new f(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:v(this.radius),strength:this.strength,threshold:this.threshold}}}class h{constructor(t){this.radius=t,this.type="blur"}interpolate(t,e,r){this.radius=Math.round(y(t.radius,e.radius,r))}clone(){return new h(this.radius)}toJSON(){return{type:"blur",radius:v(this.radius)}}}class p{constructor(t,e){this.type=t,this.amount=e,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.amount=y(t.amount,e.amount,r),this._updateMatrix()}clone(){return new p(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||l();switch(this.type){case"brightness":this._colorMatrix=((t,e)=>{const r=s(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return i(r,r)})(t,this.amount);break;case"contrast":this._colorMatrix=((t,e)=>{const r=s(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return i(r,r)})(t,this.amount);break;case"grayscale":this._colorMatrix=((t,e)=>{const r=1-this.amount,n=s(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return i(n,n)})(t);break;case"invert":this._colorMatrix=((t,e)=>{const r=1-2*e,n=s(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return i(n,n)})(t,this.amount);break;case"saturate":this._colorMatrix=((t,e)=>{const r=s(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return i(r,r)})(t,this.amount);break;case"sepia":this._colorMatrix=((t,e)=>{const r=1-this.amount,n=s(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return i(n,n)})(t)}}}class m{constructor(t,e,r,n){this.offsetX=t,this.offsetY=e,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(t,e,r){this.offsetX=y(t.offsetX,e.offsetX,r),this.offsetY=y(t.offsetY,e.offsetY,r),this.blurRadius=y(t.blurRadius,e.blurRadius,r),this.color[0]=Math.round(y(t.color[0],e.color[0],r)),this.color[1]=Math.round(y(t.color[1],e.color[1],r)),this.color[2]=Math.round(y(t.color[2],e.color[2],r)),this.color[3]=y(t.color[3],e.color[3],r)}clone(){return new m(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:v(this.offsetX),yoffset:v(this.offsetY),blurRadius:v(this.blurRadius),color:t}}}class g{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.angle=y(t.angle,e.angle,r),this._updateMatrix()}clone(){return new g(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||l();this._colorMatrix=((t,e)=>{const r=Math.sin(e*Math.PI/180),n=Math.cos(e*Math.PI/180),o=s(t,.213+.787*n-.213*r,.715-.715*n-.715*r,.072-.072*n+.928*r,0,.213-.213*n+.143*r,.715+.285*n+.14*r,.072-.072*n-.283*r,0,.213-.213*n-.787*r,.715-.715*n+.715*r,.072+.928*n+.072*r,0,0,0,0,1);return i(o,o)})(t,this.angle)}}class d{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,e,r){this.amount=y(t.amount,e.amount,r)}clone(){return new d(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function y(t,e,r){return t+(e-t)*r}function v(t){return Math.round(1e3*u(t))/1e3}function w(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new p(e.type,0);case"saturate":case"brightness":case"contrast":return new p(e.type,1);case"opacity":return new d(1);case"hue-rotate":return new g(0);case"blur":return new h(0);case"drop-shadow":return new m(0,0,0,[...t("transparent")]);case"bloom":return new f(0,0,1)}}var x,b={exports:{}};(x=b).exports&&(x.exports=function(){function t(e,r,n,o){var a=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(a,t.prototype),a.expected=r,a.found=n,a.location=o,a.name="SyntaxError",a}function e(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var n,o=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){o=t[n].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,u=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(a):a,s=this.location.source+":"+u.line+":"+u.column;if(o){var i=this.location.end,c=e("",u.line.toString().length," "),l=o[a.line-1],f=(a.line===i.line?i.column:l.length+1)-a.column||1;r+="\n --\x3e "+s+"\n"+c+" |\n"+u.line+" | "+l+"\n"+c+" | "+e("",a.column-1," ")+e("",f,"^")}else r+="\n at "+s}return r},t.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function u(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(u);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."},{SyntaxError:t,parse:function(e,r){var n,o,a,u,s={},i=(r=void 0!==r?r:{}).grammarSource,c={start:Kt},l=Kt,f="none",h=")",p=",",m="(",g="%",d="px",y="cm",v="mm",w="in",x="pt",b="pc",A="deg",M="rad",_="grad",C="turn",F="#",E=".",j="e",O=/^[ \t\n\r]/,R=/^[a-z\-]/,S=/^[0-9a-fA-F]/,$=/^[+\-]/,k=/^[0-9]/,N=Ht("none"),J=Ut("none",!1),X=Ut(")",!1),Y=Ut(",",!1),q=Ht("whitespace"),I=Tt([" ","\t","\n","\r"],!1,!1),P=Ht("function"),z=Ut("(",!1),U=Ht("identifier"),T=Tt([["a","z"],"-"],!1,!1),H=Ht("percentage"),B=Ut("%",!1),D=Ht("length"),G=Ut("px",!1),K=Ut("cm",!1),L=Ut("mm",!1),Q=Ut("in",!1),V=Ut("pt",!1),W=Ut("pc",!1),Z=Ht("angle"),tt=Ut("deg",!1),et=Ut("rad",!1),rt=Ut("grad",!1),nt=Ut("turn",!1),ot=Ht("number"),at=Ht("color"),ut=Ut("#",!1),st=Tt([["0","9"],["a","f"],["A","F"]],!1,!1),it=Tt(["+","-"],!1,!1),ct=Tt([["0","9"]],!1,!1),lt=Ut(".",!1),ft=Ut("e",!1),ht=function(){return[]},pt=function(t,e){return{type:"function",name:t,parameters:e||[]}},mt=function(t,e){return e.length>0?function(t,e,r){return[t].concat(e.map((function(t){return t[3]})))}(t,e):[t]},gt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},dt=function(t){return{type:"color",colorType:t.type,value:t.value}},yt=function(t){return t},vt=function(){return zt()},wt=function(t){return{value:t,unit:"%"}},xt=function(t){return{value:t,unit:"px"}},bt=function(t){return{value:t,unit:"cm"}},At=function(t){return{value:t,unit:"mm"}},Mt=function(t){return{value:t,unit:"in"}},_t=function(t){return{value:t,unit:"pt"}},Ct=function(t){return{value:t,unit:"pc"}},Ft=function(t){return{value:t,unit:"deg"}},Et=function(t){return{value:t,unit:"rad"}},jt=function(t){return{value:t,unit:"grad"}},Ot=function(t){return{value:t,unit:"turn"}},Rt=function(t){return{value:t,unit:null}},St=function(){return{type:"hex",value:zt()}},$t=function(t){return{type:"function",value:t}},kt=function(){return{type:"named",value:zt()}},Nt=function(){return parseFloat(zt())},Jt=0,Xt=0,Yt=[{line:1,column:1}],qt=0,It=[],Pt=0;if("startRule"in r){if(!(r.startRule in c))throw new Error("Can't start parsing from rule \""+r.startRule+'".');l=c[r.startRule]}function zt(){return e.substring(Xt,Jt)}function Ut(t,e){return{type:"literal",text:t,ignoreCase:e}}function Tt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Ht(t){return{type:"other",description:t}}function Bt(t){var r,n=Yt[t];if(n)return n;for(r=t-1;!Yt[r];)r--;for(n={line:(n=Yt[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Yt[t]=n,n}function Dt(t,e,r){var n=Bt(t),o=Bt(e),a={source:i,start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:o.line,column:o.column}};return r&&i&&"function"==typeof i.offset&&(a.start=i.offset(a.start),a.end=i.offset(a.end)),a}function Gt(t){Jt<qt||(Jt>qt&&(qt=Jt,It=[]),It.push(t))}function Kt(){var t;return(t=function(){var t,r;return Pt++,t=Jt,Vt(),e.substr(Jt,4)===f?(r=f,Jt+=4):(r=s,0===Pt&&Gt(J)),r!==s?(Vt(),Xt=t,t=ht()):(Jt=t,t=s),Pt--,t===s&&0===Pt&&Gt(N),t}())===s&&(t=function(){var t,e;if(t=[],(e=Lt())!==s)for(;e!==s;)t.push(e),e=Lt();else t=s;return t}()),t}function Lt(){var t,r,n,o;return t=Jt,Vt(),(r=function(){var t,r,n;return Pt++,t=Jt,(r=Wt())!==s?(40===e.charCodeAt(Jt)?(n=m,Jt++):(n=s,0===Pt&&Gt(z)),n!==s?(Xt=t,t=yt(r)):(Jt=t,t=s)):(Jt=t,t=s),Pt--,t===s&&(r=s,0===Pt&&Gt(P)),t}())!==s?(Vt(),(n=function(){var t,r,n,o,a,u,i,c;if(t=Jt,(r=Qt())!==s){for(n=[],o=Jt,a=Vt(),44===e.charCodeAt(Jt)?(u=p,Jt++):(u=s,0===Pt&&Gt(Y)),u===s&&(u=null),i=Vt(),(c=Qt())!==s?o=a=[a,u,i,c]:(Jt=o,o=s);o!==s;)n.push(o),o=Jt,a=Vt(),44===e.charCodeAt(Jt)?(u=p,Jt++):(u=s,0===Pt&&Gt(Y)),u===s&&(u=null),i=Vt(),(c=Qt())!==s?o=a=[a,u,i,c]:(Jt=o,o=s);Xt=t,t=mt(r,n)}else Jt=t,t=s;return t}())===s&&(n=null),Vt(),41===e.charCodeAt(Jt)?(o=h,Jt++):(o=s,0===Pt&&Gt(X)),o!==s?(Vt(),Xt=t,t=pt(r,n)):(Jt=t,t=s)):(Jt=t,t=s),t}function Qt(){var t,r;return t=Jt,(r=function(){var t,r,n;return Pt++,t=Jt,Vt(),(r=Zt())!==s?(37===e.charCodeAt(Jt)?(n=g,Jt++):(n=s,0===Pt&&Gt(B)),n!==s?(Xt=t,t=wt(r)):(Jt=t,t=s)):(Jt=t,t=s),Pt--,t===s&&0===Pt&&Gt(H),t}())===s&&(r=function(){var t,r,n;return Pt++,t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===d?(n=d,Jt+=2):(n=s,0===Pt&&Gt(G)),n!==s?(Xt=t,t=xt(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===y?(n=y,Jt+=2):(n=s,0===Pt&&Gt(K)),n!==s?(Xt=t,t=bt(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===v?(n=v,Jt+=2):(n=s,0===Pt&&Gt(L)),n!==s?(Xt=t,t=At(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===w?(n=w,Jt+=2):(n=s,0===Pt&&Gt(Q)),n!==s?(Xt=t,t=Mt(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===x?(n=x,Jt+=2):(n=s,0===Pt&&Gt(V)),n!==s?(Xt=t,t=_t(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,Vt(),(r=Zt())!==s?(e.substr(Jt,2)===b?(n=b,Jt+=2):(n=s,0===Pt&&Gt(W)),n!==s?(Xt=t,t=Ct(r)):(Jt=t,t=s)):(Jt=t,t=s)))))),Pt--,t===s&&0===Pt&&Gt(D),t}())===s&&(r=function(){var t,r,n;return Pt++,t=Jt,(r=Zt())!==s?(e.substr(Jt,3)===A?(n=A,Jt+=3):(n=s,0===Pt&&Gt(tt)),n!==s?(Xt=t,t=Ft(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,(r=Zt())!==s?(e.substr(Jt,3)===M?(n=M,Jt+=3):(n=s,0===Pt&&Gt(et)),n!==s?(Xt=t,t=Et(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,(r=Zt())!==s?(e.substr(Jt,4)===_?(n=_,Jt+=4):(n=s,0===Pt&&Gt(rt)),n!==s?(Xt=t,t=jt(r)):(Jt=t,t=s)):(Jt=t,t=s),t===s&&(t=Jt,(r=Zt())!==s?(e.substr(Jt,4)===C?(n=C,Jt+=4):(n=s,0===Pt&&Gt(nt)),n!==s?(Xt=t,t=Ot(r)):(Jt=t,t=s)):(Jt=t,t=s)))),Pt--,t===s&&(r=s,0===Pt&&Gt(Z)),t}())===s&&(r=function(){var t,e;return Pt++,t=Jt,Vt(),(e=Zt())!==s?(Xt=t,t=Rt(e)):(Jt=t,t=s),Pt--,t===s&&0===Pt&&Gt(ot),t}()),r!==s&&(Xt=t,r=gt(r)),(t=r)===s&&(t=Jt,(r=function(){var t,r,n,o;if(Pt++,t=Jt,35===e.charCodeAt(Jt)?(r=F,Jt++):(r=s,0===Pt&&Gt(ut)),r!==s){if(n=[],S.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=s,0===Pt&&Gt(st)),o!==s)for(;o!==s;)n.push(o),S.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=s,0===Pt&&Gt(st));else n=s;n!==s?(Xt=t,t=St()):(Jt=t,t=s)}else Jt=t,t=s;return t===s&&(t=Jt,(r=Lt())!==s&&(Xt=t,r=$t(r)),(t=r)===s&&(t=Jt,(r=Wt())!==s&&(Xt=t,r=kt()),t=r)),Pt--,t===s&&(r=s,0===Pt&&Gt(at)),t}())!==s&&(Xt=t,r=dt(r)),t=r),t}function Vt(){var t,r;for(Pt++,t=[],O.test(e.charAt(Jt))?(r=e.charAt(Jt),Jt++):(r=s,0===Pt&&Gt(I));r!==s;)t.push(r),O.test(e.charAt(Jt))?(r=e.charAt(Jt),Jt++):(r=s,0===Pt&&Gt(I));return Pt--,r=s,0===Pt&&Gt(q),t}function Wt(){var t,r,n;if(Pt++,t=Jt,r=[],R.test(e.charAt(Jt))?(n=e.charAt(Jt),Jt++):(n=s,0===Pt&&Gt(T)),n!==s)for(;n!==s;)r.push(n),R.test(e.charAt(Jt))?(n=e.charAt(Jt),Jt++):(n=s,0===Pt&&Gt(T));else r=s;return r!==s&&(Xt=t,r=vt()),Pt--,(t=r)===s&&(r=s,0===Pt&&Gt(U)),t}function Zt(){var t,r,n,o,a,u,i;for(t=Jt,$.test(e.charAt(Jt))?(e.charAt(Jt),Jt++):0===Pt&&Gt(it),r=Jt,n=[],k.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=s,0===Pt&&Gt(ct));o!==s;)n.push(o),k.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=s,0===Pt&&Gt(ct));if(46===e.charCodeAt(Jt)?(o=E,Jt++):(o=s,0===Pt&&Gt(lt)),o!==s){if(a=[],k.test(e.charAt(Jt))?(u=e.charAt(Jt),Jt++):(u=s,0===Pt&&Gt(ct)),u!==s)for(;u!==s;)a.push(u),k.test(e.charAt(Jt))?(u=e.charAt(Jt),Jt++):(u=s,0===Pt&&Gt(ct));else a=s;a!==s?r=n=[n,o,a]:(Jt=r,r=s)}else Jt=r,r=s;if(r===s)if(r=[],k.test(e.charAt(Jt))?(n=e.charAt(Jt),Jt++):(n=s,0===Pt&&Gt(ct)),n!==s)for(;n!==s;)r.push(n),k.test(e.charAt(Jt))?(n=e.charAt(Jt),Jt++):(n=s,0===Pt&&Gt(ct));else r=s;if(r!==s){if(n=Jt,101===e.charCodeAt(Jt)?(o=j,Jt++):(o=s,0===Pt&&Gt(ft)),o!==s){if($.test(e.charAt(Jt))?(a=e.charAt(Jt),Jt++):(a=s,0===Pt&&Gt(it)),a===s&&(a=null),u=[],k.test(e.charAt(Jt))?(i=e.charAt(Jt),Jt++):(i=s,0===Pt&&Gt(ct)),i!==s)for(;i!==s;)u.push(i),k.test(e.charAt(Jt))?(i=e.charAt(Jt),Jt++):(i=s,0===Pt&&Gt(ct));else u=s;u!==s?n=o=[o,a,u]:(Jt=n,n=s)}else Jt=n,n=s;n===s&&(n=null),Xt=t,t=Nt()}else Jt=t,t=s;return t}if((n=l())!==s&&Jt===e.length)return n;throw n!==s&&Jt<e.length&&Gt({type:"end"}),o=It,a=qt<e.length?e.charAt(qt):null,u=qt<e.length?Dt(qt,qt+1):Dt(qt,qt),new t(t.buildMessage(o,a),o,a,u)}}}());var A=b.exports;function M(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every(((t,e)=>t.type===r[e].type))}function _(t,e){const r=t.length>e.length?t:e,n=t.length>e.length?e:t;for(let t=n.length;t<r.length;t++)n.push(w(r[t]))}function C(t){const e=t[0];return!!e&&"type"in e}function F(t){if(!t||0===t.length)return null;if("string"==typeof t){const e=E(t);return e&&0!==e.length?e:null}const e=t.map((t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new a("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:E(t.value)}}));e.sort(((t,e)=>e.effects.length-t.effects.length));for(let t=0;t<e.length-1;t++){if(!M(e[t].effects,e[t+1].effects))throw new a("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[t].effects,b:e[t+1].effects});_(e[t].effects,e[t+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}function E(t){let e;if(!t)return[];try{e=A.parse(t)}catch(e){throw new a("effect:invalid-syntax","Invalid effect syntax",{value:t,error:e})}return e.map((t=>function(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;return j(t.parameters,1),1===t.parameters.length&&(e=k(t.parameters[0])),new p(t.name,e)}(t);case"opacity":return function(t){let e=1;return j(t.parameters,1),1===t.parameters.length&&(e=k(t.parameters[0])),new d(e)}(t);case"hue-rotate":return function(t){let e=0;var r;return j(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=S[t.unit]))throw new a("effect:type-error",`Expected <angle>, Actual: ${O(t)}`,{term:t})}(r=t.parameters[0]),e=r.value*S[r.unit]||0),new g(e)}(t);case"blur":return function(t){let e=0;return j(t.parameters,1),1===t.parameters.length&&(e=N(t.parameters[0]),R(e,t.parameters[0])),new h(e)}(t);case"drop-shadow":return function(t){const e=[];let r=null;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),r)throw new a("effect:type-error","Accepts only one color",{});r=J(n)}else{const t=N(n);if(Object.isFrozen(e))throw new a("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&R(t,n)}if(e.length<2||e.length>3)throw new a("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new m(e[0],e[1],e[2]||0,r||X("black"))}(t);case"bloom":return function(t){let e=1,r=0,n=0;return j(t.parameters,3),t.parameters[0]&&(e=k(t.parameters[0])),t.parameters[1]&&(r=N(t.parameters[1]),R(r,t.parameters[1])),t.parameters[2]&&(n=k(t.parameters[2])),new f(e,r,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new a("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}(t)))}function j(t,e){if(t.length>e)throw new a("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function O(t){if("color"===t.type)return"<color>";if(t.unit){if(t.unit in $)return"<length>";if(t.unit in S)return"<angle>";if("%"===t.unit)return"<percentage>"}return"<double>"}function R(t,e){if(t<0)throw new a("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}const S={deg:1,grad:.9,rad:180/Math.PI,turn:360},$={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function k(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new a("effect:type-error",`Expected <double> or <percentage>, Actual: ${O(t)}`,{term:t})}(t);const e=t.value;return R(e,t),"%"===t.unit?.01*e:e}function N(t){return function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=$[t.unit]))throw new a("effect:type-error",`Expected <length>, Actual: ${O(t)}`,{term:t})}(t),t.value*$[t.unit]||0}function J(t){switch(t.colorType){case"hex":return e(t.value);case"named":return X(t.value);case"function":return function(t){if(j(t.parameters,4),Y.test(t.name))return[k(t.parameters[0]),k(t.parameters[1]),k(t.parameters[2]),t.parameters[3]?k(t.parameters[3]):1];if(q.test(t.name))return o(function(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new a("effect:type-error",`Expected <double>, Actual: ${O(t)}`,{term:t})}(t),R(t.value,t),t.value}(t.parameters[0]),k(t.parameters[1]),k(t.parameters[2]),t.parameters[3]?k(t.parameters[3]):1);throw new a("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(t.value)}}function X(t){if(!r(t))throw new a("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return n(t)}const Y=/^rgba?/i,q=/^hsla?/i;export{M as c,C as i,_ as n,F as p};
