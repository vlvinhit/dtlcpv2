/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import t from"../Graphic.js";import o from"../core/Evented.js";import{HandleOwnerMixin as i}from"../core/HandleOwner.js";import{b as r}from"./utils.js";import{d as n}from"./maybe.js";import{z as s,d as a,c as l,m as p}from"./quantityUtils.js";import{watch as c,syncAndInitial as u}from"../core/reactiveUtils.js";import{o as h,g as d,j as y}from"./unitUtils.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import{l as g,i as f}from"./typedArrayUtil.js";import{subclass as v}from"../core/accessorSupport/decorators/subclass.js";import w from"../layers/GraphicsLayer.js";import{c as x}from"./elevationInfoUtils.js";import"../geometry.js";import{clone as _}from"../core/lang.js";import{x as b,a as O,I as T,e as M,b as I,f as G,n as S,i as V,l as j,r as z}from"./vec3.js";import{c as R,f as C,Z as P}from"./vec3f64.js";import U from"../geometry/Circle.js";import{simplify as E,distance as A}from"../geometry/geometryEngine.js";import D,{q as L,i as k,s as N}from"../geometry/Polygon.js";import{m as Z,c as F}from"./surfaceCoordinateSystems.js";import Y from"../geometry/Multipoint.js";import q from"../geometry/Polyline.js";import H from"../geometry/Point.js";import{g as B}from"./helpMessageUtils.js";import{I as J}from"./dragEventPipeline.js";import K from"../views/interactive/sketch/SketchLabelOptions.js";import Q from"../views/interactive/sketch/SketchTooltipOptions.js";import{S as W,a as X,b as $,T as ee,c as te}from"./automaticLengthMeasurementUtils.js";import{a as oe}from"./automaticAreaMeasurementUtils.js";import{p as ie,s as re,g as ne,z as se,A as ae,c as le,j as pe,b as ce}from"./vec2.js";import{c as ue,u as he}from"./boundedPlane.js";import{j as de,s as ye}from"./ray.js";import{U as me,M as ge,R as fe,S as ve}from"./EditGeometryOperations.js";function we(e,t){const o=new H({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(o.z=e[2]),o}function xe(e,t,o){const i=new q({paths:e,spatialReference:t});return o&&L(i),i}function _e(e,t,o,i=!0){const r=_(e);r.forEach((e=>{const t=e[0],o=e[e.length-1];g(t,o)&&1!==e.length||e.push(e[0])}));let n=new D({rings:r,spatialReference:t});return n.rings.forEach((e=>{k(e,!1,!1)||e.reverse()})),o&&L(n),i&&n.isSelfIntersecting&&h(t)&&(n=E(n)),n}function be(e,t,o){const i=t.mapToLocalMultiple(e),r=[],n={x:i[0].x,y:i[0].y},s=i[1].x,a=i[1].y,l=Math.round(s-n.x),p=Math.round(a-n.y),c=Math.max(Math.abs(l),Math.abs(p));if(o){const e={x:n.x+c,y:n.y+c},t={x:n.x-c,y:n.y-c};r.push(Z(e.x,t.y),Z(t.x,t.y),Z(t.x,e.y),Z(e.x,e.y))}else{const e={x:l>0?n.x+c:n.x-c,y:p>0?n.y+c:n.y-c};r.push(Z(n.x,n.y),Z(e.x,n.y),Z(e.x,e.y),Z(n.x,e.y))}return Oe(_e([r.map((e=>t.localToMap(e))).filter(f)],t.spatialReference,t.doUnnormalization,!0),r,t)}function Oe(e,t,o){const i=Te(t[3],t[2],o),r=Te(t[1],t[2],o),n=Te(t[0],t[1],o),s=Te(t[0],t[3],o);return{geometry:e,midpoints:null!=i&&null!=r&&null!=n&&null!=s?{top:i,right:r,bottom:n,left:s}:null}}function Te(e,t,o){Ie[0]=e.x,Ie[1]=e.y,Ie[2]=0,Ge[0]=t.x,Ge[1]=t.y,Ge[2]=0,b(Ie,Ie,Ge,.5),Me.x=Ie[0],Me.y=Ge[1],Me.z=Ge[2];const i=o.localToMap(Me);return null!=i?we(i,o.spatialReference):null}const Me=Z(0,0,0),Ie=R(),Ge=R();function Se(e,t,o,i){const r=t.mapToLocalMultiple(e);let n=null,s=null;if(o)n=r[0],s=r[1];else{const e=r[0],t=r[1],o=Math.round(t.x-e.x),i=Math.round(t.y-e.y),a=Math.max(Math.abs(o),Math.abs(i));n=Z(o>0?e.x+a/2:e.x-a/2,i>0?e.y+a/2:e.y-a/2),s=Z(Math.abs(o)>Math.abs(i)?n.x-a/2:n.x,Math.abs(o)>Math.abs(i)?n.y:n.y-a/2)}const a=t.localToMap(n),l=t.localToMap(s);if(null==a||null==l)return null;t.doUnnormalization&&N([[a,l]],t.spatialReference);const p=we(a,t.spatialReference),c=we(l,t.spatialReference),u=d(t.spatialReference);let y=0;if(h(t.spatialReference))y=u*A(p,c,null);else{const e=n.x-s.x,t=n.y-s.y;y=u*Math.sqrt(e*e+t*t)*(i||1)}const m=new U({center:p,radius:y,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:_e(m.rings,m.spatialReference,!1),center:p,edge:c}}let Ve=class extends W{constructor(e){super(e),this.type="draw-point"}};e([m()],Ve.prototype,"type",void 0),e([m()],Ve.prototype,"elevation",void 0),e([m()],Ve.prototype,"viewType",void 0),e([m()],Ve.prototype,"helpMessage",void 0),Ve=e([v("esri.views.interactive.tooltip.DrawPointTooltipInfo")],Ve);let je=class extends W{constructor(e){super(e),this.type="draw-polyline",this.totalLength=s}};e([m()],je.prototype,"type",void 0),e([m()],je.prototype,"elevation",void 0),e([m()],je.prototype,"totalLength",void 0),e([m()],je.prototype,"viewType",void 0),e([m()],je.prototype,"helpMessage",void 0),je=e([v("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],je);let ze=class extends W{constructor(e){super(e),this.type="draw-polygon",this.area=a}};e([m()],ze.prototype,"type",void 0),e([m()],ze.prototype,"elevation",void 0),e([m()],ze.prototype,"area",void 0),e([m()],ze.prototype,"viewType",void 0),e([m()],ze.prototype,"helpMessage",void 0),ze=e([v("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],ze);let Re=class extends W{constructor(e){super(e),this.type="draw-mesh"}};e([m()],Re.prototype,"type",void 0),e([m()],Re.prototype,"elevation",void 0),e([m()],Re.prototype,"viewType",void 0),e([m()],Re.prototype,"helpMessage",void 0),Re=e([v("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],Re);let Ce=class extends W{constructor(e){super(e),this.type="draw-rectangle",this.xSize=s,this.ySize=s,this.area=a}};e([m()],Ce.prototype,"type",void 0),e([m()],Ce.prototype,"xSize",void 0),e([m()],Ce.prototype,"ySize",void 0),e([m()],Ce.prototype,"area",void 0),Ce=e([v("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],Ce);let Pe=class extends W{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=a}};e([m()],Pe.prototype,"type",void 0),e([m()],Pe.prototype,"radius",void 0),e([m()],Pe.prototype,"xSize",void 0),e([m()],Pe.prototype,"ySize",void 0),e([m()],Pe.prototype,"area",void 0),Pe=e([v("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],Pe);class Ue{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let Ee=class extends(i(o.EventedMixin(J))){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new K,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new Q}initialize(){this.internalGraphicsLayer=new w({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e))),c((()=>this.tooltipOptions.enabled),(e=>{this.tooltip=e?new ee({view:this.view,info:this._tooltipInfo}):n(this.tooltip)}),u),c((()=>this._tooltipInfo),(e=>{null!=this.tooltip&&(this.tooltip.info=e)}),u)]),this.finishToolCreation()}destroy(){this.drawOperation=n(this.drawOperation),this.tooltip=n(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=n(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return l(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.handles.remove(De.outline),this.handles.remove(De.regularVertices),this.handles.remove(De.activeVertex),this.handles.remove(Ae)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this._updateGraphicGeometry(this._graphic,e),this._graphic;const o=this._graphic=new t({...this.graphicProperties,symbol:this.graphicSymbol});return this._updateGraphicGeometry(o,e),this.internalGraphicsLayer.add(o),this.handles.add(this.initializeGraphic(o)),this.notifyChange("graphic"),this.handles.add(r((()=>{this.internalGraphicsLayer.remove(o),n(o),this._graphic===o&&(this._graphic=null)})),Ae),o}_updateGraphicGeometry(e,t){e.geometry=t}_getCreateOperationGeometry(e={operationComplete:!1}){const{drawOperation:t}=this;if(null==t||0===t.numVertices)return null;const{coordinateHelper:o,view:i}=t,r=t.stagedVertex,n=t.committedVertices,s=n.slice(),a=null!=r;a&&s.push(o.pointToArray(r));const l=a?o.pointToArray(r):n.splice(-1)[0],p=s.length,c=i.spatialReference,u="3d"===i.type&&"global"===i.viewingMode,h=new Ue;switch(this.geometryType){case"point":case"mesh":h.regularVertices=n,h.activeVertex=l,h.full=o.arrayToPoint(s[0]);break;case"multipoint":h.regularVertices=n,h.activeVertex=l,p>0&&(h.full=function(e,t){return new Y({points:e,spatialReference:t})}(s,c));break;case"polyline":h.regularVertices=n,h.activeVertex=l,p>0&&(h.full=xe([s],c,u));break;case"polygon":h.regularVertices=n,h.activeVertex=l,p>0&&(h.full=_e([s],c,u,!0));break;case"circle":if(p>0){const t=F(i,s[0]);if(1===p&&e.operationComplete){const e=s[0],o=t.makeMapPoint(e[0]+ke*i.resolution,e[1]);h.circle=Se([e,o],t,!0),h.full=null!=h.circle?h.circle.geometry:null}else 2===p&&(this.forceUniformSize?(h.circle=Se(s,t,this.centered),h.full=null!=h.circle?h.circle.geometry:null):(h.rectangle=function(e,t,o){const i=t.mapToLocalMultiple(e),r=i[0],n=i[1],s=Math.round(n.x-r.x),a=Math.round(n.y-r.y),l=Z(o?r.x:r.x+s/2,o?r.y:r.y+a/2),p=o?s:s/2,c=o?a:a/2,u=[],h=2*Math.PI/60;function d(e){const t=Math.cos(e),o=Math.sin(e);return Z(p*t+l.x,c*o+l.y)}for(let e=0;e<60;e++)u.push(d(e*h));u.push(u[0]);const{spatialReference:y,doUnnormalization:m}=t,g=_e([u.map((e=>t.localToMap(e))).filter(f)],y,m,!1),v=t.localToMap(d(Math.PI/2)),w=t.localToMap(d(0)),x=t.localToMap(d(-Math.PI/2)),_=t.localToMap(d(Math.PI));return{geometry:g,midpoints:null!=v&&null!=w&&null!=x&&null!=_?{top:we(v,y),right:we(w,y),bottom:we(x,y),left:we(_,y)}:null}}(s,t,this.centered),h.full=h.rectangle.geometry))}break;case"rectangle":if(p>0){const t=F(i,s[0]);if(1===p&&e.operationComplete){const e=s[0],o=t.makeMapPoint(e[0]+ke*i.resolution,e[1]);h.rectangle=be([e,o],t,!0),h.full=h.rectangle.geometry}else 2===p&&(h.rectangle=this.forceUniformSize?be(s,t,this.centered):function(e,t,o){let i=t.mapToLocalMultiple(e);if(1===i.length){const e=48,t=i[0];i=[Z(t.x-e,t.y+e),Z(t.x+e,t.y-e),Z(t.x+e,t.y-e),Z(t.x-e,t.y+e)]}const r=[],n={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(o){const e=Math.round(s.x-n.x),t=Math.round(s.y-n.y);r.push(Z(n.x-e,n.y-t),Z(s.x,n.y-t),Z(s.x,s.y),Z(n.x-e,s.y))}else r.push(Z(n.x,n.y),Z(s.x,n.y),Z(s.x,s.y),Z(n.x,s.y));return Oe(_e([r.map((e=>t.localToMap(e))).filter(f)],t.spatialReference,t.doUnnormalization,!0),r,t)}(s,t,this.centered),h.full=h.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":h.outline=p>1?xe([s],c,u):null;break;case"polygon":h.outline=p>1?_e([s],c,u):null;break;case"circle":case"rectangle":h.outline="polygon"===h.full?.type?_e(h.full.rings,c,u):null}return h}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});null!=e&&(t=this._createOrUpdateGraphic(e.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.outline?this.handles.add(this.onOutlineChanged(e.outline),De.outline):this.handles.remove(De.outline),null!=e.regularVertices?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),De.regularVertices):this.handles.remove(De.regularVertices),null!=e.activeVertex?this.handles.add(this.onActiveVertexChanged(e.activeVertex),De.activeVertex):this.handles.remove(De.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.handles.remove(Ae)):this._destroyAllVisualisations()}get _tooltipInfo(){const{drawOperation:e}=this;if(!e)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;case"mesh":return this._drawMeshTooltipInfo;default:return null}}get _drawPointTooltipInfo(){const{view:e,graphic:t}=this,o=t?.geometry;return"point"!==o?.type||"2d"===e.type&&0===this.defaultZ?null:new Ve({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:B("point",o,e)})}get _drawPolylineTooltipInfo(){const e=this._createOperationGeometry,t=null!=e?e.full:null;if("polyline"!==t?.type)return null;const o=X(t,this._elevationMode),{view:i}=this;return new je({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:o??s,viewType:i.type,helpMessage:B("polyline",t,i)})}get _drawPolygonTooltipInfo(){const e=this._createOperationGeometry,t=null!=e?e.full:null;if("polygon"!==t?.type)return null;const o=oe(t,this._elevationMode),{view:i}=this;return new ze({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:o??a,viewType:i.type,helpMessage:B("polygon",t,i)})}get _drawMeshTooltipInfo(){const{view:e,graphic:t}=this,o=t?.geometry;return"mesh"!==o?.type||"2d"===e.type&&0===this.defaultZ?null:new Re({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:e.type,helpMessage:B("mesh",o,e)})}get _drawRectangleTooltipInfo(){return null==this.drawOperation?null:new Ce({tooltipOptions:this.tooltipOptions,xSize:this._xSize??s,ySize:this._ySize??s,area:this._fullGeometryArea??a})}get _drawCircleTooltipInfo(){if(null==this.drawOperation)return null;const e=this.forceUniformSize;return new Pe({tooltipOptions:this.tooltipOptions,radius:e?this._circleRadius??s:null,xSize:e?null:this._xSize??s,ySize:e?null:this._ySize??s,area:this._fullGeometryArea??a})}get _circleRadius(){const e=this._createOperationGeometry;return null!=e&&null!=e.circle&&null!=e.circle.center&&null!=e.circle.edge?$(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){const e=this._createOperationGeometry;if(null==e?.rectangle)return null;const{midpoints:t}=e.rectangle;return null!=t?$(t.left,t.right,this._elevationMode):null}get _ySize(){const e=this._createOperationGeometry;if(null==e?.rectangle)return null;const{midpoints:t}=e.rectangle;return null!=t?$(t.top,t.bottom,this._elevationMode):null}get _fullGeometryArea(){const e=this._createOperationGeometry,t=null!=e?e.full:null;return"polygon"!==t?.type?null:oe(t,this._elevationMode)}get _elevationTooltipDetail(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}get _vertexTooltipElevation(){const{tooltipOptions:e,view:t,drawOperation:o}=this;if(null==o)return this._defaultElevation;const i=o.stagedVertex??o.lastVertex;if(null==i||"2d"===t.type)return this._defaultElevation;const r={mode:e.elevation.mode,offset:0},n=(x(t,i,o.elevationInfo,r)??0)*y(i.spatialReference);return l(n,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}};e([m()],Ee.prototype,"_createOperationGeometry",void 0),e([m()],Ee.prototype,"_defaultElevation",null),e([m({value:!0})],Ee.prototype,"centered",null),e([m({nonNullable:!0})],Ee.prototype,"defaultZ",void 0),e([m()],Ee.prototype,"drawOperation",void 0),e([m({value:!0})],Ee.prototype,"enabled",null),e([m({value:!0})],Ee.prototype,"forceUniformSize",null),e([m({constructOnly:!0})],Ee.prototype,"geometryType",void 0),e([m()],Ee.prototype,"graphic",null),e([m({constructOnly:!0})],Ee.prototype,"graphicProperties",void 0),e([m()],Ee.prototype,"graphicSymbol",null),e([m({constructOnly:!0})],Ee.prototype,"hasZ",void 0),e([m({constructOnly:!0,type:K})],Ee.prototype,"labelOptions",void 0),e([m({constructOnly:!0})],Ee.prototype,"geometryToPlace",void 0),e([m({constructOnly:!0})],Ee.prototype,"mode",void 0),e([m()],Ee.prototype,"snappingManager",void 0),e([m()],Ee.prototype,"snapToScene",void 0),e([m()],Ee.prototype,"tooltip",void 0),e([m({constructOnly:!0,type:Q})],Ee.prototype,"tooltipOptions",void 0),e([m({readOnly:!0})],Ee.prototype,"type",void 0),e([m({readOnly:!0})],Ee.prototype,"updating",null),e([m({constructOnly:!0,nonNullable:!0})],Ee.prototype,"view",void 0),e([m()],Ee.prototype,"_tooltipInfo",null),e([m()],Ee.prototype,"_drawPointTooltipInfo",null),e([m()],Ee.prototype,"_drawPolylineTooltipInfo",null),e([m()],Ee.prototype,"_drawPolygonTooltipInfo",null),e([m()],Ee.prototype,"_drawMeshTooltipInfo",null),e([m()],Ee.prototype,"_drawRectangleTooltipInfo",null),e([m()],Ee.prototype,"_drawCircleTooltipInfo",null),e([m()],Ee.prototype,"_circleRadius",null),e([m()],Ee.prototype,"_xSize",null),e([m()],Ee.prototype,"_ySize",null),e([m()],Ee.prototype,"_fullGeometryArea",null),e([m()],Ee.prototype,"_elevationTooltipDetail",null),e([m()],Ee.prototype,"_vertexTooltipElevation",null),e([m()],Ee.prototype,"_elevationMode",null),Ee=e([v("esri.views.draw.DrawGraphicTool")],Ee);const Ae="create-operation-graphic",De={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Le(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ke=48;function Ne(e,t){return Fe(e,t,!1)}function Ze(e,t){return Fe(e,t,!0)}function Fe(e,t,o){if(e instanceof me){if(e.operation instanceof ge)return function(e,t,o=!1){const i=o?-1:1,r=C(i*e.dx,i*e.dy,i*e.dz);O(t.origin,t.origin,r)}(e.operation,t,o),!0;if(e.operation instanceof fe)return function(e,t,o=!1){const i=o?-e.angle:e.angle;T(t.basis1,t.basis1,P,i),T(t.basis2,t.basis2,P,i)}(e.operation,t,o),!0;if(e.operation instanceof ve)return function(e,t,o=!1){const i=o?1/e.factor1:e.factor1,r=o?1/e.factor2:e.factor2;M(t.basis1,t.basis1,i),M(t.basis2,t.basis2,r),ie(t.origin,t.origin,e.origin,e.axis1,i),ie(t.origin,t.origin,e.origin,e.axis2,r)}(e.operation,t,o),!0}return!1}function Ye(e,t,o,i){i||(i=ue());const r=re(de.get(),e[1],-e[0]),n=re(de.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=re(de.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=de.get();t.components.forEach((t=>t.vertices.forEach((t=>{const o=t.pos;re(a,ne(e,o),ne(r,o)),se(n,n,a),ae(s,s,a)}))));const l=1e-6,p=re(de.get(),s[0]-n[0]<l?o/2:0,s[1]-n[1]<l?o/2:0);return le(n,n,p),pe(s,s,p),ce(i.basis1,e,(s[0]-n[0])/2),ce(i.basis2,r,(s[1]-n[1])/2),re(i.origin,n[0]*e[0]+n[1]*r[0],n[0]*e[1]+n[1]*r[1]),pe(i.origin,i.origin,i.basis1),pe(i.origin,i.origin,i.basis2),i}function qe(e,t,o,i=0,r){r||(r=ue()),t.toRenderCoords(e.origin,o,r.origin);const n=ye.get();O(n,e.origin,e.basis1),O(n,n,e.basis2),t.toRenderCoords(n,o,n);const s=ye.get();O(s,e.origin,e.basis1),I(s,s,e.basis2),t.toRenderCoords(s,o,s);const a=ye.get();I(a,e.origin,e.basis1),I(a,a,e.basis2),t.toRenderCoords(a,o,a);const l=ye.get();I(l,e.origin,e.basis1),O(l,l,e.basis2),t.toRenderCoords(l,o,l);const p=b(ye.get(),n,s,.5);I(p,p,r.origin);const c=b(ye.get(),a,l,.5);I(c,r.origin,c),b(r.basis1,p,c,.5);const u=b(ye.get(),l,n,.5);I(u,u,r.origin);const h=b(ye.get(),s,a,.5);I(h,r.origin,h),b(r.basis2,u,h,.5);const d=G(ye.get(),r.basis1,r.basis2),y=G(d,d,r.basis1);return S(y,y),M(r.basis2,y,V(r.basis2,y)),M(r.basis1,r.basis1,1+i/j(r.basis1)),M(r.basis2,r.basis2,1+i/j(r.basis2)),he(r),r}function He(e,t,o,i){const r=ye.get();I(r,I(r,e.origin,e.basis1),e.basis2);const n=ye.get();z(n,r,e.basis1,2);const s=ye.get();z(s,n,e.basis2,2);const a=ye.get();z(a,r,e.basis2,2),r[2]=n[2]=s[2]=a[2]=t;const l=i?"on-the-ground":"absolute-height",c=p(te(r,n,o,l),te(a,s,o,l)),u=p(te(n,s,o,l),te(r,a,o,l));return null==u||null==c?null:[c,u]}export{Ee as D,Ne as a,qe as b,Ye as c,Le as g,He as m,Ze as u};
