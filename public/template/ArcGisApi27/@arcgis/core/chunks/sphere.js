/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import"./typedArrayUtil.js";import{L as t}from"./Logger.js";import{b as n,g as r}from"./mathUtils.js";import{a as e}from"./mat4.js";import{f as s,e as o,l as i,d as a,b as c,c as u,a as f,z as l,D as g,n as m,s as p,C as h,x as d}from"./vec3.js";import{c as j}from"./vec3f64.js";import{c as y}from"./vec4.js";import{c as M,f as b}from"./vec4f64.js";import{a as S,A as v}from"./vector.js";import{s as A,d as R,e as x}from"./ray.js";const P=C();function C(){return M()}function _(t,n=C()){return y(n,t)}function w(t,n){return b(t[0],t[1],t[2],n)}function L(t){return t}function O(t,n){return t[0]=t[1]=t[2]=0,t[3]=n,t}function T(t){return t[3]}function q(t){return t}function z(t,n,r,e){return b(t,n,r,e)}function E(t,n,r){if(null==n)return!1;const{origin:e,direction:s}=n,o=N;o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2];const i=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(0===i)return!1;const a=2*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]),c=a*a-4*i*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-t[3]*t[3]);if(c<0)return!1;const u=Math.sqrt(c);let f=(-a-u)/(2*i);const l=(-a+u)/(2*i);return(f<0||l<f&&l>0)&&(f=l),!(f<0||(r&&(r[0]=e[0]+s[0]*f,r[1]=e[1]+s[1]*f,r[2]=e[2]+s[2]*f),0))}const N=j();function U(t,n){return E(t,n,null)}function Z(t,n,r){const c=A.get(),u=R.get();s(c,n.origin,n.direction);const f=T(t);s(r,c,n.origin),o(r,r,1/i(r)*f);const l=V(t,n.origin),g=S(n.origin,r);return e(u,g+l,c),a(r,r,u),r}function k(t,n,r){const e=c(A.get(),n,t),s=o(A.get(),e,t[3]/i(e));return f(r,s,t)}function D(t,n){const r=c(A.get(),n,t),e=g(r),s=t[3]*t[3];return Math.sqrt(Math.abs(e-s))}function V(t,r){const e=c(A.get(),r,t),s=i(e),o=T(t),a=o+Math.abs(o-s);return n(o/a)}const X=j();function Y(t,n,e,s){const o=c(X,n,t);switch(e){case v.X:{const t=r(o,X)[2];return p(s,-Math.sin(t),Math.cos(t),0)}case v.Y:{const t=r(o,X),n=t[1],e=t[2],i=Math.sin(n);return p(s,-i*Math.cos(e),-i*Math.sin(e),Math.cos(n))}case v.Z:return m(s,o);default:return}}function B(t,n){const r=c(H,n,t);return i(r)-t[3]}function F(t,n){const r=h(t,n),e=T(t);return r<=e*e}function G(t,n,r=C()){const e=l(t,n),s=t[3],o=n[3];return e+o<s?(y(r,t),r):e+s<o?(y(r,n),r):(d(r,t,n,(e+o-s)/(2*e)),r[3]=(e+s+o)/2,r)}const H=j(),I=C(),J=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:P,altitudeAt:B,angleToSilhouette:V,axisAt:Y,clear:function(t){t[0]=t[1]=t[2]=t[3]=0},closestPoint:function(t,n,r){return E(t,n,r)?r:(x(n,t,r),k(t,r,r))},closestPointOnSilhouette:Z,containsPoint:F,copy:_,create:C,distanceToSilhouette:D,elevate:function(t,n,r){return t!==r&&u(r,t),r[3]=t[3]+n,r},fromCenterAndRadius:w,fromRadius:O,fromValues:z,getCenter:q,getRadius:T,intersectRay:E,intersectRayClosestSilhouette:function(t,n,r){if(E(t,n,r))return r;const e=Z(t,n,A.get());return f(r,n.origin,o(A.get(),n.direction,l(n.origin,e)/i(n.direction))),r},intersectsRay:U,projectPoint:k,setAltitudeAt:function(t,n,r,e){const s=B(t,n),i=Y(t,n,v.Z,H),a=o(H,i,r-s);return f(e,n,a)},setExtent:function(n,r,e){return t.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),n===e?e:_(n,e)},tmpSphere:I,union:G,wrap:L},Symbol.toStringTag,{value:"Module"}));export{P as N,_ as a,q as b,C as c,E as d,w as e,z as f,T as g,Z as h,U as i,O as j,D as k,F as l,J as s,I as t,G as u,L as w};
