/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import t from"../core/Error.js";import"./Logger.js";import"./ensureType.js";import"./typedArrayUtil.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import{unpackFieldNames as r,populateMissingFields as a}from"../layers/support/fieldUtils.js";import{a as p,g as o}from"./popupUtils.js";const i=i=>{let l=class extends i{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:r}=s;if(!r)throw new t("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!p(s,e))throw new t("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,t){this._validateFetchPopupFeatures(t);const s=null!=t?t.clientGraphics:null;if(!s||0===s.length)return[];const i="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let l=[];"fieldsIndex"in this.layer&&(l=r(this.layer.fieldsIndex,await o(i,p(this.layer,t)))),await this.prepareFetchPopupFeatures(l);const c=new Set,n=[],u=[];for(const e of s)a(l,e,c)?u.push(e):n.push(e);return 0===u.length?n:this.whenGraphicAttributes(u,[...c]).catch((()=>u)).then((e=>n.concat(e)))}};return l=e([s("esri.views.3d.layers.support.PopupSceneLayerView")],l),l};export{i as P};
