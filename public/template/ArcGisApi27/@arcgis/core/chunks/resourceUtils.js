/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../request.js";import t from"../core/Error.js";import{join as r,getPathExtension as o}from"../core/urlUtils.js";import"../config.js";import"./typedArrayUtil.js";import"./object.js";import"../core/lang.js";import"../kernel.js";import"./Logger.js";import"./string.js";import"./maybe.js";import"../core/promiseUtils.js";async function s(e,t={},o){await e.load(o);const s=r(e.itemUrl,"resources"),{start:a=1,num:n=10,sortOrder:i="asc",sortField:l="created"}=t,c={query:{start:a,num:n,sortOrder:i,sortField:l,token:e.apiKey},signal:o?.signal},u=await e.portal.request(s,c);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:r,resource:o})=>({created:new Date(t),size:r,resource:e.resourceFromPath(o)})))}}async function a(e,o,s,a){if(!e.hasPath())throw new t(`portal-item-resource-${o}:invalid-path`,"Resource does not have a valid path");const n=e.portalItem;await n.load(a);const i=r(n.userItemUrl,"add"===o?"addResources":"updateResources"),[c,p]=l(e.path),m=await u(s),d=new FormData;return c&&"."!==c&&d.append("resourcesPrefix",c),null!=a&&a.compress&&d.append("compress","true"),d.append("fileName",p),d.append("file",m,p),d.append("f","json"),null!=a&&a.access&&d.append("access",a.access),await n.portal.request(i,{method:"post",body:d,signal:a?.signal}),e}async function n(e,o,s){if(!o.hasPath())throw new t("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const a=r(e.userItemUrl,"removeResources");await e.portal.request(a,{method:"post",query:{resource:o.path},signal:s?.signal}),o.portalItem=null}async function i(e,t){await e.load(t);const o=r(e.userItemUrl,"removeResources");return e.portal.request(o,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function l(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function c(e){const[t,r]=function(e){const t=o(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[s,a]=l(t);return[s,a,r]}async function u(t){return t instanceof Blob?t:(await e(t.url,{responseType:"blob"})).data}function p(e,t){if(!e.hasPath())return null;const[o,,s]=c(e.path);return e.portalItem.resourceFromPath(r(o,t+s))}function m(e,t){if(!e.hasPath())return null;const[o,,s]=c(e.path);return e.portalItem.resourceFromPath(r(o,t+s))}export{a as addOrUpdateResource,u as contentToBlob,s as fetchResources,p as getSiblingOfSameType,m as getSiblingOfSameTypeI,i as removeAllResources,n as removeResource,c as splitPrefixFileNameAndExtension};
