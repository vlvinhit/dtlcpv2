/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{o as t}from"./vec2.js";import{s as e}from"./vec3.js";import{c as r}from"./vec3f64.js";import{O as o}from"./vec4f64.js";import{E as n}from"./unitUtils.js";import{lonLatToWebMercatorComparable as a}from"../geometry/projection.js";import{n as s}from"./DoubleArray.js";import{a as i,n as u}from"./DefaultBufferWriter.js";import{g as l}from"./Indices.js";import{V as c}from"./ViewingMode.js";import{A as f}from"./Attribute.js";import{C as p}from"./Material.js";import{V as m}from"./VertexAttribute.js";function T(r,T,A=null){const I=[],R=[],D=T.mapPositions;!function(t,e,r){const{attributeData:{position:o},removeDuplicateStartEnd:n}=t,a=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(o)&&n,s=o.length/3-(a?1:0),i=new Array(2*(s-1)),u=a?o.slice(0,o.length-3):o;let l=0;for(let t=0;t<s-1;t++)i[l++]=t,i[l++]=t+1;e.push([m.POSITION,new f(u,3,a)]),r.push([m.POSITION,i])}(T,R,I);const O=R[0][1].data,b=I[0][1].length,g=l(b);return function(t,e,r,n){if(null!=t.attributeData.colorFeature)return;const a=t.attributeData.color;e.push([m.COLOR,new f(a??o,4)]),r.push([m.COLOR,n])}(T,R,I,g),function(t,e,r,o){null==t.attributeData.sizeFeature&&(e.push([m.SIZE,new f([t.attributeData.size??1],1,!0)]),r.push([m.SIZE,o]))}(T,R,I,g),function(t,e,r,o){if(null==t.attributeData.normal)return;const n=t.attributeData.normal;e.push([m.NORMAL,new f(n,3)]),r.push([m.NORMAL,o])}(T,R,I,g),function(t,e,r,o){null!=t.attributeData.colorFeature&&(e.push([m.COLORFEATUREATTRIBUTE,new f([t.attributeData.colorFeature],1,!0)]),r.push([m.COLOR,o]))}(T,R,I,g),function(t,e,r,o){null!=t.attributeData.sizeFeature&&(e.push([m.SIZEFEATUREATTRIBUTE,new f([t.attributeData.sizeFeature],1,!0)]),r.push([m.SIZEFEATUREATTRIBUTE,o]))}(T,R,I,g),function(t,e,r,o){const n=t.attributeData.opacityFeature;null!=n&&(e.push([m.OPACITYFEATUREATTRIBUTE,new f([n],1,!0)]),r.push([m.OPACITYFEATUREATTRIBUTE,o]))}(T,R,I,g),function(r,o,i,l){if(null==r.overlayInfo||r.overlayInfo.renderCoordsHelper.viewingMode!==c.Global||!r.overlayInfo.spatialReference.isGeographic)return;const p=s(l.length),T=n(r.overlayInfo.spatialReference);for(let t=0;t<p.length;t+=3)a(l,t,p,t,T);const A=l.length/3,I=u(A+1);let R=h,D=E,O=0,b=0;e(R,p[b++],p[b++],p[b++]),I[0]=0;for(let r=1;r<A+1;++r)r===A&&(b=0),e(D,p[b++],p[b++],p[b++]),O+=t(R,D),I[r]=O,[R,D]=[D,R];o.push([m.DISTANCETOSTART,new f(I,1,!0)]),i.push([m.DISTANCETOSTART,i[0][1]])}(T,R,I,O),new i(r,R,I,D,p.Line,A)}const h=r(),E=r();function A(t,e){if(null==t||0===t.length)return[];const r=[];return t.forEach((t=>{const o=t.length,n=s(3*o);t.forEach(((t,e)=>{n[3*e]=t[0],n[3*e+1]=t[1],n[3*e+2]=t[2]}));const a={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(a)})),r}export{T as c,A as l};
