/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as o}from"./tslib.es6.js";import r from"../core/Accessor.js";import{c as t}from"./asyncUtils.js";import e from"../core/Error.js";import{isAbortError as s,throwIfAborted as i,createAbortError as n,throwIfNotAbortError as a,createResolver as c,o as p}from"../core/promiseUtils.js";import{h as l,b as m}from"./utils.js";import{b as u}from"./maybe.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./typedArrayUtil.js";import{subclass as f}from"../core/accessorSupport/decorators/subclass.js";import j from"../geometry/Point.js";import{d as y,e as h}from"./infoFor3D.js";import"../core/Handles.js";import"./get.js";import"./metadata.js";import"../core/lang.js";import"./Logger.js";import"../config.js";import"./object.js";import"./string.js";import"./ObjectPool.js";import"./ObservableBase.js";import"./tracking.js";import"./watch.js";import"./ArrayPool.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/accessorSupport/decorators/cast.js";import"./reader.js";import"./writer.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./jsonMap.js";import"../geometry/support/webMercatorUtils.js";let g=class extends r{constructor(){super({}),this._uploadTask=null}destroy(){this.cancel()}get state(){const o=this._uploadTask;return o?o.finished?o.error?s(o.error)?"canceled":"error":"success":"pending":"default"}get result(){return this._uploadTask?.value??null}get error(){return this._uploadTask?.error??null}uploadTo(o){this.cancel(),this._uploadTask=t((async r=>{const t=await async function(o){return"showOpenFilePicker"in window&&!w?async function(o){try{const r=await window.showOpenFilePicker({multiple:!0,excludeAcceptAllOption:!0,types:y(o.infoFor3D)});return Promise.all(r.map((o=>o.getFile())))}catch(o){return a(o),[]}}(o):async function(o){const r=c();let t;const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=h(o.infoFor3D).join(",");const s=l([p(e,"change",(()=>n(i()))),m((()=>clearTimeout(t))),p(document,["focus","focusin"],a),p(window,["focus","focusin"],a)]);function i(){return e.files?Array.from(e.files):[]}function n(o){s.remove(),r.resolve(o)}function a(){clearTimeout(t),t=setTimeout((()=>{if(!document.hasFocus())return;const o=i();0===o.length&&n(o)}),b)}return w?w(e):e.click(),r.promise.finally((()=>s.remove()))}(o)}(o);if(i(r),0===t.length)throw n();const s=(await import("../geometry/Mesh.js")).default;i(r);const u=new j({x:0,y:0,z:0,spatialReference:o.spatialReference}),d=await s.createFromFiles(u,t,{layer:o,signal:r});if(i(r),!d)throw new e("editor:upload","could not upload or convert model");return d.load()}))}cancel(){this._uploadTask=u(this._uploadTask)}};o([d()],g.prototype,"state",null),o([d()],g.prototype,"result",null),o([d()],g.prototype,"error",null),o([d()],g.prototype,"_uploadTask",void 0),g=o([f("esri.widgets.Editor.Upload")],g);let w=null;function T(o){w=r=>{setTimeout((()=>{const t=new DataTransfer;o.forEach((o=>t.items.add(o))),r.files=t.files,r.dispatchEvent(new Event("change"))}))}}function k(){w=null}const b=5e3;export{g as Upload,k as clearPromptForFilesStub,T as simulateSelectingFiles};
