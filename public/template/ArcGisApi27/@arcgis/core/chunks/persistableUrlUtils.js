/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{makeAbsolute as e,makeRelative as r,isAbsolute as t,normalize as o,isDataProtocol as l,changeDomain as s,hasSameOrigin as n,splitPathExtension as a,getAppUrl as u}from"../core/urlUtils.js";function i(t,o){const l=o&&o.url&&o.url.path;if(t&&l&&(t=e(t,l,{preserveProtocolRelative:!0}),o.portalItem&&o.readResourcePaths)){const e=r(t,o.portalItem.itemUrl);null!=e&&h.test(e)&&o.readResourcePaths.push(o.portalItem.resourceFromPath(e).path)}return I(t,o&&o.portal)}function c(s,n,a=R.YES){if(null==s)return s;!t(s)&&n&&n.blockedRelativeUrls&&n.blockedRelativeUrls.push(s);let u=e(s);if(n){const e=n.verifyItemRelativeUrls&&n.verifyItemRelativeUrls.rootPath||n.url&&n.url.path;if(e){const t=I(e,n.portal),o=I(u,n.portal);u=r(o,t,t),null!=u&&u!==o&&u!==s&&n.verifyItemRelativeUrls&&n.verifyItemRelativeUrls.writtenUrls.push(u)}}return u=d(u,n?.portal),t(u)&&(u=o(u)),n?.resources&&n?.portalItem&&!t(u)&&!l(u)&&a===R.YES&&n.resources.toKeep.push({resource:n.portalItem.resourceFromPath(u),compress:!1}),u}function m(e,r,t){return i(e,t)}function p(e,r,t,o){const l=c(e,o);void 0!==l&&(r[t]=l)}const f=/\/items\/([^\/]+)\/resources\/(.*)/,h=/^\.\/resources\//;function v(e){const r=e?.match(f)??null;return r?.[1]??null}function U(e){const r=e?.match(f)??null;if(null==r)return null;const t=r[2],o=t.lastIndexOf("/");if(-1===o){const{path:e,extension:r}=a(t);return{prefix:null,filename:e,extension:r}}const{path:l,extension:s}=a(t.slice(o+1));return{prefix:t.slice(0,o),filename:l,extension:s}}function d(e,r){return r&&!r.isPortal&&r.urlKey&&r.customBaseUrl?s(e,`${r.urlKey}.${r.customBaseUrl}`,r.portalHostname):e}function I(e,r){if(!r||r.isPortal||!r.urlKey||!r.customBaseUrl)return e;const t=`${r.urlKey}.${r.customBaseUrl}`,o=u();return n(o,`${o.scheme}://${t}`)?s(e,r.portalHostname,t):s(e,t,r.portalHostname)}var R;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(R||(R={}));const y=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return R},ensureMainOnlineDomain:d,fromJSON:i,itemIdFromResourceUrl:v,prefixAndFilenameFromResourceUrl:U,read:m,toJSON:c,write:p},Symbol.toStringTag,{value:"Module"}));export{R as M,y as a,d as e,i as f,v as i,U as p,m as r,c as t,p as w};
