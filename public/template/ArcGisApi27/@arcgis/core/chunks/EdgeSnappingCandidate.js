/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{c as t,u as s,g as e,q as n,i as r,a as i,h as o}from"./vec2.js";import{a,d as c}from"./vec2f64.js";import{s as u,m as f,i as h,r as p,b as d,f as l,F as L,h as E}from"./vec3.js";import{c as m,e as A,f as y}from"./vec3f64.js";import{j as N,h as k,L as P}from"./snappingUtils.js";import{j as g}from"./mathUtils.js";import{L as q}from"./geometry2dUtils.js";import{a as x,L as I}from"./LineSnappingHint.js";function j({start:r,end:i,type:o},c,u){const f=[],h=t(G,i,r),p=t(O,r,c),d=s(h),l=2*e(h,p),L=l*l-4*d*(s(p)-u*u);if(0===L){const t=-l/(2*d);(o===_.PLANE||t>=0)&&f.push(n(a(),r,h,t))}else if(L>0){const t=Math.sqrt(L),s=(-l+t)/(2*d);(o===_.PLANE||s>=0)&&f.push(n(a(),r,h,s));const e=(-l-t)/(2*d);(o===_.PLANE||e>=0)&&f.push(n(a(),r,h,e))}return f}function T(s,n){const i=s.start,o=s.end,a=t(G,o,i),c=u(O,-a[1],a[0],0),d=n.start,l=n.end,L=f(S,l,d),E=h(L,c),m=u(C,i[0],i[1],0),y=f(V,m,d),N=h(y,c);if(Math.abs(E)<U)return Math.abs(N),[];const k=p(z,d,L,N/E);if(n.type===q.RAY){const t=f(B,k,d);if(h(t,L)<-U)return[]}if(s.type===_.HALF_PLANE){const t=r(B,k,i);if(e(t,a)<-U)return[]}return[A(k)]}function b(t,s){return Y(v(J,s[2],t),s)}function F(t,s){const e=H(v(J,0,t),v(K,0,s)),n=[];for(const t of e)n.push(c(t));return n}function R(t,s){return w(t,v(J,t[2],s))}function w(t,{start:s,end:e,type:n}){const r=f(G,t,s),i=f(O,e,s),o=h(r,i)/h(i,i);return p(m(),s,i,n===q.RAY?Math.max(o,0):o)}function M({start:n,end:r,type:i},o,a){const c=[],u=d(G,r,n),f=t(O,n,o),h=s(u),l=2*e(u,f),L=l*l-4*h*(s(f)-a*a);if(0===L){const t=-l/(2*h);(i===q.LINE||t>=0)&&c.push(p(m(),n,u,t))}else if(L>0){const t=Math.sqrt(L),s=(-l+t)/(2*h);(i===q.LINE||s>=0)&&c.push(p(m(),n,u,s));const e=(-l-t)/(2*h);(i===q.LINE||e>=0)&&c.push(p(m(),n,u,e))}return c}function H(t,s){const e=t.start,n=t.end,r=s.start,i=s.end,o=f(G,n,e),a=f(O,i,r),c=f(S,r,e),u=l(C,o,a),d=h(c,u);if(!g(d,0,U))return[];const E=L(u);if(g(E,0,U))return[];const m=l(V,c,a),y=h(m,u)/E,N=p(z,e,o,y);if(t.type===q.RAY){const t=f(B,N,e);if(h(o,t)<-U)return[]}if(s.type===q.RAY){const t=f(B,N,r);if(h(a,t)<-U)return[]}return[A(N)]}function Y({start:t,end:s,type:e},n){const r=f(G,n,t),i=f(O,s,t),o=l(S,i,r);if(L(o)/L(i)<U)switch(e){case q.LINE:return[A(n)];case q.RAY:return h(i,r)<-U?[]:[A(n)]}return[]}function Z(t,s,e){return g(i(e,t),s*s,U)?[A(e)]:[]}function v(t,s,{start:e,end:n,type:r}){return u(t.start,e[0],e[1],s),u(t.end,n[0],n[1],s),t.type=D[r],t}var _;!function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"}(_||(_={}));const D={[_.PLANE]:q.LINE,[_.HALF_PLANE]:q.RAY},U=1e-6,G=m(),O=m(),S=m(),C=m(),V=m(),z=m(),B=m(),J={start:m(),end:m(),type:q.LINE},K={start:m(),end:m(),type:q.LINE};class Q{intersect(t){return function(t,s){let e=[];if(ct(t)){const{point:n}=t;ut(s)?e=Y(s.lineLike,n):ft(s)?e=Z(s.center,s.radius,n):ht(s)?e=b(s.planeLike,n):pt(s)&&(e=at(s,t))}else if(ut(t)){const{lineLike:n}=t;ct(s)?e=Y(n,s.point):ut(s)?e=H(n,s.lineLike):ft(s)?e=M(n,s.center,s.radius):ht(s)?e=T(s.planeLike,n):pt(s)&&(e=at(s,t))}else if(ft(t)){const{center:n,radius:r}=t;if(ut(s))e=M(s.lineLike,n,r);else if(ct(s))e=Z(n,r,s.point);else{if(ht(s))return j(s.planeLike,n,r).map((e=>new st(e,t,s)));pt(s)&&(e=at(s,t))}}else if(ht(t)){const{planeLike:n}=t;if(ht(s))return F(n,s.planeLike).map((e=>new st(e,t,s)));if(ct(s))e=b(n,s.point);else if(ut(s))e=T(n,s.lineLike);else{if(ft(s))return j(n,s.center,s.radius).map((e=>new st(e,t,s)));pt(s)&&(e=at(s,t))}}else pt(t)&&(e=at(t,s));return function(t,s,e){return t.map((t=>new tt(k(t),s,e)))}(e,t,s)}(this,t)}}class W extends Q{constructor(t){super(),this.point=t}equals(t){return ct(t)&&E(this.point,t.point)}closestTo(){return N(this.point)}}class X extends Q{constructor(t,s,e){super(),this.start=t,this.end=s,this.type=e,this.lineLike={start:this.start,end:this.end,type:this.type}}equals(t){return ut(t)&&this.type===t.type&&E(this.start,t.start)&&E(this.end,t.end)}closestTo(t){const s=w(t,this.lineLike);return k(s)}}class $ extends X{constructor(t,s){super(t,s,q.LINE)}}class tt extends Q{constructor(t,s,e){super(),this.intersection=t,this.first=s,this.second=e}equals(t){return t instanceof tt&&this.first.equals(t.first)&&this.second.equals(t.second)}closestTo(){return N(this.intersection)}}class st extends Q{constructor(t,s,e){super(),this.basePoint=t,this.first=s,this.second=e}equals(t){return t instanceof st&&this.first.equals(t.first)&&this.second.equals(t.second)}closestTo(t){const s=this.basePoint;return k(y(s[0],s[1],t[2]))}}class et extends Q{constructor(t,s){super(),this.center=t,this.radius=s}equals(t){return ft(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(s){const e=function(s,e,r){const i=t(G,s,e),a=r/o(i),c=n(m(),e,i,a);return c[2]=s[2],c}(s,this.center,this.radius);return k(e)}}class nt extends Q{constructor(t,s,e){super(),this.start=t,this.end=s,this.type=e,this.planeLike={start:t,end:s,type:e}}equals(t){return ht(t)&&this.type===t.type&&E(this.start,t.start)&&E(this.end,t.end)}closestTo(t){return k(R(t,this.planeLike))}closestEndTo(s){const{start:n,end:r}=this;return Math.sign(e(t(dt,r,n),t(lt,s,n)))>0?r:n}}class rt extends nt{constructor(t,s){super(t,s,_.HALF_PLANE)}}class it extends nt{constructor(t,s){super(t,s,_.PLANE)}}class ot extends Q{constructor(t,s,e){super(),this.start=t,this.end=s,this.getZ=e,this.planeLike={start:t,end:s,type:_.PLANE}}equals(t){return pt(t)&&E(this.start,t.start)&&E(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return function(t,s){const e=R(s,t.planeLike);return e[2]=t.getZ(s[0],s[1],s[2])??Lt,k(e)}(this,t)}addIfOnTheGround(t,s){for(const e of s){const s=this.getZ(e[0],e[1],e[2])??0;Math.abs(e[2]-s)<U&&(e[2]=s,t.push(e))}}}function at(t,s){const{planeLike:e,getZ:n}=t,r=[];if(ct(s))t.addIfOnTheGround(r,b(e,s.point));else if(ut(s))t.addIfOnTheGround(r,T(e,s.lineLike));else if(ft(s))for(const[t,i]of j(e,s.center,s.radius)){const s=n(t,i,0);null!=s&&r.push(y(t,i,s))}else if(ht(s)||pt(s))for(const[t,i]of F(e,s.planeLike)){const s=n(t,i,0)??Lt;r.push(y(t,i,s))}return r}function ct(t){return t instanceof W}function ut(t){return t instanceof X}function ft(t){return t instanceof et}function ht(t){return t instanceof nt}function pt(t){return t instanceof ot}const dt=a(),lt=a(),Lt=0;class Et{constructor(t,s,e,n){this.targetPoint=t,this.constraint=s,this.isDraped=e,this.domain=n}}class mt extends Et{constructor({targetPoint:t,objectId:s,constraint:e,isDraped:n}){super(t,e,n,x.FEATURE),this.objectId=s}}class At extends mt{constructor(t){super({...t,constraint:new $(t.edgeStart,t.edgeEnd)})}get hints(){return[new I(P.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}export{ot as D,At as E,mt as F,tt as I,W as P,Et as S,rt as V,it as a,et as b,w as p};
