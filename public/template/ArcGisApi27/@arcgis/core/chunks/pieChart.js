/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{a as e}from"./tslib.es6.js";import{w as t,c as s,S as i,a as r,T as o}from"./Tick.js";import{j as a,k as l,L as n,g as p,n as m,s as u,l as c,o as h,P as d,G as y,b as j,T as g,p as b,d as f,q as x,a as v,t as _,v as D,u as R,w,x as S,y as P,m as k}from"../widgets/Feature.js";import{C as A}from"./ColorSet.js";import"../intl.js";import"./date.js";import"./jsonMap.js";import"./object.js";import"../core/lang.js";import"./typedArrayUtil.js";import"./locale.js";import"./datetime.js";import"./number.js";import"./maybe.js";import"./Logger.js";import"../config.js";import"./string.js";import"./messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./assets.js";import"../core/reactiveUtils.js";import"./utils.js";import"./watch.js";import"./ArrayPool.js";import"./ObjectPool.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"./get.js";import"./tracking.js";import"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./metadata.js";import"../core/accessorSupport/decorators/cast.js";import"../core/accessorSupport/decorators/subclass.js";import"../widgets/Widget.js";import"./domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Handles.js";import"./ObservableBase.js";import"../core/Promise.js";import"./uuid.js";import"./projector.js";import"./widgetUtils.js";import"./dom.js";import"./guid.js";import"./index.js";import"./jsxWidgetSupport.js";import"../widgets/Attachments.js";import"./unitFormatUtils.js";import"./ByteSizeUnit.js";import"./Cyclical.js";import"./mathUtils.js";import"./vec3.js";import"./vec3f64.js";import"./common.js";import"./vec4.js";import"./unitUtils.js";import"../widgets/Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./extentUtils.js";import"./aaBoundingRect.js";import"../geometry/Polyline.js";import"./typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"./shared.js";import"./SimpleObservable.js";import"../layers/support/fieldUtils.js";import"./arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"./enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"./chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"./colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils2.js";import"../symbols/edges/Edges3D.js";import"./screenUtils.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"./lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"./utils3.js";import"./colors.js";import"./symbolLayerUtils3D.js";import"./aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"./persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"./Thumbnail.js";import"./calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"./featureUtils.js";import"./layerUtils.js";import"./messageBundle.js";import"./jsxFactory.js";import"../widgets/Feature/FeatureViewModel.js";import"./throttle.js";import"../core/HandleOwner.js";import"./WatchUpdatingTracking.js";import"./DataLayerSource.js";import"../layers/support/Field.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"./executeQueryJSON.js";import"./utils4.js";import"./query.js";import"../geometry/support/normalizeUtils.js";import"./normalizeUtilsCommon.js";import"./simplify.js";import"./utils5.js";import"./urlUtils2.js";import"./pbfQueryUtils.js";import"./pbf.js";import"./OptimizedGeometry.js";import"./OptimizedFeature.js";import"./OptimizedFeatureSet.js";import"./queryZScale.js";import"./zscale.js";import"../rest/support/FeatureSet.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"./timeUtils.js";import"./FullTextSearch.js";import"./QuantizationParameters.js";import"../rest/support/StatisticDefinition.js";import"./featureConversionUtils.js";import"../rest/support/RelationshipQuery.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"./colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"./LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"./visualVariableUtils.js";import"./compilerUtils.js";import"./lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"./commonProperties.js";import"../symbols/support/jsonUtils.js";import"../renderers/DictionaryRenderer.js";import"./DictionaryLoader.js";import"./LRUCache.js";import"./MemCache.js";import"./Version.js";import"../layers/support/FieldsIndex.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"./deprecate.js";import"../renderers/support/HeatmapColorStop.js";import"./heatmapUtils.js";import"./vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"./diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"./styleUtils.js";import"./featureFlags.js";import"../renderers/support/jsonUtils.js";import"./MultiOriginJSONSupport.js";import"../core/sql.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/RelationshipElement.js";import"../layers/Layer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"./Queue.js";import"../core/workers/RemoteClient.js";import"./editsZScale.js";import"../layers/mixins/APIKeyMixin.js";import"./ArcGISService.js";import"./arcgisLayerUrl.js";import"../layers/mixins/BlendLayer.js";import"./jsonUtils.js";import"./parser.js";import"./mat4.js";import"./_commonjsHelpers.js";import"../layers/mixins/CustomParametersMixin.js";import"./EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"./commonProperties2.js";import"../support/timeUtils.js";import"./ElevationInfo.js";import"./unitConversionUtils.js";import"./TimeReference.js";import"./featureLayerUtils.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"./serviceCapabilitiesUtils.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"./FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"./labelUtils.js";import"./defaults.js";import"./defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"./clusterUtils.js";import"./MD5.js";import"./OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"./asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"./portalItemUtils.js";import"../geometry/projection.js";import"./pe.js";import"./geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"./fieldProperties.js";import"./labelingInfo.js";import"./versionUtils.js";import"./styleUtils2.js";import"../support/popupUtils.js";import"./FeatureRelationshipViewModel.js";import"./featureFormUtils.js";import"./Heading.js";import"../widgets/support/widget.js";import"./accessibleHandler.js";import"./vmEvent.js";import"./themeUtils.js";import"./uriUtils.js";import"./utils16.js";import"./numberUtils.js";import"./utils6.js";import"../symbols/support/cimSymbolUtils.js";import"./utils7.js";class T extends a{constructor(){super(...arguments),Object.defineProperty(this,"_display",{enumerable:!0,configurable:!0,writable:!0,value:this._root._renderer.makeRadialText("",this.textStyle)})}_afterNew(){super._afterNew()}_beforeChanged(){super._beforeChanged(),this._display.clear(),this.isDirty("textType")&&(this._display.textType=this.get("textType"),this.markDirtyBounds()),this.isDirty("radius")&&(this._display.radius=this.get("radius"),this.markDirtyBounds()),this.isDirty("startAngle")&&(this._display.startAngle=(this.get("startAngle",0)+90)*l,this.markDirtyBounds()),this.isDirty("inside")&&(this._display.inside=this.get("inside"),this.markDirtyBounds()),this.isDirty("orientation")&&(this._display.orientation=this.get("orientation"),this.markDirtyBounds()),this.isDirty("kerning")&&(this._display.kerning=this.get("kerning"),this.markDirtyBounds())}}Object.defineProperty(T,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialText"}),Object.defineProperty(T,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:a.classNames.concat([T.className])});class L extends n{constructor(){super(...arguments),Object.defineProperty(this,"_flipped",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._textKeys.push("textType","kerning"),super._afterNew()}_makeText(){this._text=this.children.push(T.new(this._root,{}))}baseRadius(){const e=this.getPrivate("radius",0),t=this.getPrivate("innerRadius",0),s=this.get("baseRadius",0);return t+p(s,e-t)}radius(){const e=this.get("inside",!1);return this.baseRadius()+this.get("radius",0)*(e?-1:1)}_updateChildren(){if(super._updateChildren(),this.isDirty("baseRadius")||this.isPrivateDirty("radius")||this.isPrivateDirty("innerRadius")||this.isDirty("labelAngle")||this.isDirty("radius")||this.isDirty("inside")||this.isDirty("orientation")||this.isDirty("textType")){const e=this.get("textType","adjusted"),t=this.get("inside",!1),s=this.get("orientation");let i=m(this.get("labelAngle",0));this._text.set("startAngle",this.get("labelAngle",0)),this._text.set("inside",t);const r=u(i),o=c(i);let a=this.baseRadius(),l=this.radius();if(this._display.angle=0,"circular"==e)this.setAll({paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}),this._text.set("orientation",s),this._text.set("radius",l);else{0==a&&(i=0,l=0);let t=l*o,n=l*r;"radial"==e?(this.setRaw("x",t),this.setRaw("y",n),i<90||i>270||"auto"!=s?(this._display.angle=i,this._flipped=!1):(this._display.angle=i+180,this._flipped=!0),this._dirty.rotation=!1):"adjusted"==e?(this.setRaw("centerX",h),this.setRaw("centerY",h),this.setRaw("x",t),this.setRaw("y",n)):"regular"==e&&(this.setRaw("x",t),this.setRaw("y",n))}this.markDirtyPosition(),this.markDirtyBounds()}}_updatePosition(){const e=this.get("textType","regular"),t=this.get("inside",!1);let s=0,i=0,r=this.get("labelAngle",0),o=this.localBounds(),a=o.right-o.left,l=o.bottom-o.top;if("radial"==e){if(this._flipped){let e=this.get("centerX");e instanceof d&&(a*=1-2*e.value),s=a*c(r),i=a*u(r)}}else t||"adjusted"!=e||(s=a/2*c(r),i=l/2*u(r));this.setRaw("dx",s),this.setRaw("dy",i),super._updatePosition()}get text(){return this._text}}Object.defineProperty(L,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialLabel"}),Object.defineProperty(L,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:n.classNames.concat([L.className])});const C=Math.abs,I=Math.atan2,U=Math.cos,O=Math.max,F=Math.min,M=Math.sin,N=Math.sqrt,V=1e-12,B=Math.PI,E=B/2,H=2*B;function z(e){return e>=1?E:e<=-1?-E:Math.asin(e)}function q(e){return e.innerRadius}function G(e){return e.outerRadius}function W(e){return e.startAngle}function X(e){return e.endAngle}function Y(e){return e&&e.padAngle}function Q(e,t,s,i,r,o,a){var l=e-s,n=t-i,p=(a?o:-o)/N(l*l+n*n),m=p*n,u=-p*l,c=e+m,h=t+u,d=s+m,y=i+u,j=(c+d)/2,g=(h+y)/2,b=d-c,f=y-h,x=b*b+f*f,v=r-o,_=c*y-d*h,D=(f<0?-1:1)*N(O(0,v*v*x-_*_)),R=(_*f-b*D)/x,w=(-_*b-f*D)/x,S=(_*f+b*D)/x,P=(-_*b+f*D)/x,k=R-j,A=w-g,T=S-j,L=P-g;return k*k+A*A>T*T+L*L&&(R=S,w=P),{cx:R,cy:w,x01:-m,y01:-u,x11:R*(r/v-1),y11:w*(r/v-1)}}function J(){var e=q,i=G,r=s(0),o=null,a=W,l=X,n=Y,p=null,m=t(u);function u(){var t,s,u,c=+e.apply(this,arguments),h=+i.apply(this,arguments),d=a.apply(this,arguments)-E,y=l.apply(this,arguments)-E,j=C(y-d),g=y>d;if(p||(p=t=m()),h<c&&(s=h,h=c,c=s),h>V)if(j>H-V)p.moveTo(h*U(d),h*M(d)),p.arc(0,0,h,d,y,!g),c>V&&(p.moveTo(c*U(y),c*M(y)),p.arc(0,0,c,y,d,g));else{var b,f,x=d,v=y,_=d,D=y,R=j,w=j,S=n.apply(this,arguments)/2,P=S>V&&(o?+o.apply(this,arguments):N(c*c+h*h)),k=F(C(h-c)/2,+r.apply(this,arguments)),A=k,T=k;if(P>V){var L=z(P/c*M(S)),O=z(P/h*M(S));(R-=2*L)>V?(_+=L*=g?1:-1,D-=L):(R=0,_=D=(d+y)/2),(w-=2*O)>V?(x+=O*=g?1:-1,v-=O):(w=0,x=v=(d+y)/2)}var q=h*U(x),G=h*M(x),W=c*U(D),X=c*M(D);if(k>V){var Y,J=h*U(v),K=h*M(v),Z=c*U(_),$=c*M(_);if(j<B)if(Y=function(e,t,s,i,r,o,a,l){var n=s-e,p=i-t,m=a-r,u=l-o,c=u*n-m*p;if(!(c*c<V))return[e+(c=(m*(t-o)-u*(e-r))/c)*n,t+c*p]}(q,G,Z,$,J,K,W,X)){var ee=q-Y[0],te=G-Y[1],se=J-Y[0],ie=K-Y[1],re=1/M(((u=(ee*se+te*ie)/(N(ee*ee+te*te)*N(se*se+ie*ie)))>1?0:u<-1?B:Math.acos(u))/2),oe=N(Y[0]*Y[0]+Y[1]*Y[1]);A=F(k,(c-oe)/(re-1)),T=F(k,(h-oe)/(re+1))}else A=T=0}w>V?T>V?(b=Q(Z,$,q,G,h,T,g),f=Q(J,K,W,X,h,T,g),p.moveTo(b.cx+b.x01,b.cy+b.y01),T<k?p.arc(b.cx,b.cy,T,I(b.y01,b.x01),I(f.y01,f.x01),!g):(p.arc(b.cx,b.cy,T,I(b.y01,b.x01),I(b.y11,b.x11),!g),p.arc(0,0,h,I(b.cy+b.y11,b.cx+b.x11),I(f.cy+f.y11,f.cx+f.x11),!g),p.arc(f.cx,f.cy,T,I(f.y11,f.x11),I(f.y01,f.x01),!g))):(p.moveTo(q,G),p.arc(0,0,h,x,v,!g)):p.moveTo(q,G),c>V&&R>V?A>V?(b=Q(W,X,J,K,c,-A,g),f=Q(q,G,Z,$,c,-A,g),p.lineTo(b.cx+b.x01,b.cy+b.y01),A<k?p.arc(b.cx,b.cy,A,I(b.y01,b.x01),I(f.y01,f.x01),!g):(p.arc(b.cx,b.cy,A,I(b.y01,b.x01),I(b.y11,b.x11),!g),p.arc(0,0,c,I(b.cy+b.y11,b.cx+b.x11),I(f.cy+f.y11,f.cx+f.x11),g),p.arc(f.cx,f.cy,A,I(f.y11,f.x11),I(f.y01,f.x01),!g))):p.arc(0,0,c,D,_,g):p.lineTo(W,X)}else p.moveTo(0,0);if(p.closePath(),t)return p=null,t+""||null}return u.centroid=function(){var t=(+e.apply(this,arguments)+ +i.apply(this,arguments))/2,s=(+a.apply(this,arguments)+ +l.apply(this,arguments))/2-B/2;return[U(s)*t,M(s)*t]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:s(+t),u):e},u.outerRadius=function(e){return arguments.length?(i="function"==typeof e?e:s(+e),u):i},u.cornerRadius=function(e){return arguments.length?(r="function"==typeof e?e:s(+e),u):r},u.padRadius=function(e){return arguments.length?(o=null==e?null:"function"==typeof e?e:s(+e),u):o},u.startAngle=function(e){return arguments.length?(a="function"==typeof e?e:s(+e),u):a},u.endAngle=function(e){return arguments.length?(l="function"==typeof e?e:s(+e),u):l},u.padAngle=function(e){return arguments.length?(n="function"==typeof e?e:s(+e),u):n},u.context=function(e){return arguments.length?(p=e??null,u):p},u}class K extends y{constructor(){super(...arguments),Object.defineProperty(this,"ix",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"iy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_generator",{enumerable:!0,configurable:!0,writable:!0,value:J()})}_getTooltipPoint(){let e=this.get("tooltipX"),t=this.get("tooltipY"),s=0,i=0;j(e)&&(s=e),j(t)&&(i=t);let r=this.get("radius",0),o=this.get("innerRadius",0);return r+=this.get("dRadius",0),o+=this.get("dInnerRadius",0),o<0&&(o=r+o),e instanceof d&&(s=this.ix*(o+(r-o)*e.value)),t instanceof d&&(i=this.iy*(o+(r-o)*t.value)),this.get("arc")>=360&&0==o&&(s=0,i=0),{x:s,y:i}}_beforeChanged(){super._beforeChanged(),(this.isDirty("radius")||this.isDirty("arc")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("dRadius")||this.isDirty("dInnerRadius")||this.isDirty("cornerRadius"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){let e=this.get("startAngle",0),t=this.get("arc",0);const s=this._generator;t<0&&(e+=t,t*=-1),t>.1&&s.cornerRadius(this.get("cornerRadius",0)),s.context(this._display);let i=this.get("radius",0),r=this.get("innerRadius",0);i+=this.get("dRadius",0),r+=this.get("dInnerRadius",0),r<0&&(r=i+r),s({innerRadius:r,outerRadius:i,startAngle:(e+90)*l,endAngle:(e+t+90)*l});let o=e+t/2;this.ix=c(o),this.iy=u(o)}if(this.isDirty("shiftRadius")){const e=this.get("shiftRadius",0);this.setRaw("dx",this.ix*e),this.setRaw("dy",this.iy*e),this.markDirtyPosition()}}}Object.defineProperty(K,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Slice"}),Object.defineProperty(K,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:y.classNames.concat([K.className])});class Z extends g{setupDefaultRules(){super.setupDefaultRules();const e=this._root.interfaceColors,t=this.rule.bind(this);t("PercentSeries").setAll({legendLabelText:"{category}",legendValueText:"{valuePercentTotal.formatNumber('0.00p')}",colors:A.new(this._root,{}),width:b,height:b}),t("PieChart").setAll({radius:f(80),startAngle:-90,endAngle:270}),t("PieSeries").setAll({alignLabels:!0,startAngle:-90,endAngle:270}),t("PieSeries").states.create("hidden",{endAngle:-90,opacity:0}),t("Slice",["pie"]).setAll({position:"absolute",isMeasured:!1,x:0,y:0,toggleKey:"active",tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}",strokeWidth:1,strokeOpacity:1,role:"figure",lineJoin:"round"}),t("Slice",["pie"]).states.create("active",{shiftRadius:20,scale:1}),t("Slice",["pie"]).states.create("hoverActive",{scale:1.04}),t("Slice",["pie"]).states.create("hover",{scale:1.04}),t("RadialLabel",["pie"]).setAll({textType:"aligned",radius:10,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",paddingTop:5,paddingBottom:5,populateText:!0}),t("Tick",["pie"]).setAll({location:1}),t("SlicedChart").setAll({paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10}),t("FunnelSeries").setAll({startLocation:0,endLocation:1,orientation:"vertical",alignLabels:!0,sequencedInterpolation:!0}),t("FunnelSlice").setAll({interactive:!0,expandDistance:0}),t("FunnelSlice").states.create("hover",{expandDistance:.15}),t("Label",["funnel"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:h}),t("Label",["funnel","horizontal"]).setAll({centerX:0,centerY:h,rotation:-90}),t("Label",["funnel","vertical"]).setAll({centerY:h,centerX:0}),t("Tick",["funnel"]).setAll({location:1}),t("FunnelSlice",["funnel","link"]).setAll({fillOpacity:.5,strokeOpacity:0,expandDistance:-.1}),t("FunnelSlice",["funnel","link","vertical"]).setAll({height:10}),t("FunnelSlice",["funnel","link","horizontal"]).setAll({width:10}),t("PyramidSeries").setAll({valueIs:"area"}),t("FunnelSlice",["pyramid","link"]).setAll({fillOpacity:.5}),t("FunnelSlice",["pyramid","link","vertical"]).setAll({height:0}),t("FunnelSlice",["pyramid","link","horizontal"]).setAll({width:0}),t("FunnelSlice",["pyramid"]).setAll({interactive:!0,expandDistance:0}),t("FunnelSlice",["pyramid"]).states.create("hover",{expandDistance:.15}),t("Label",["pyramid"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:h}),t("Label",["pyramid","horizontal"]).setAll({centerX:0,centerY:h,rotation:-90}),t("Label",["pyramid","vertical"]).setAll({centerY:h,centerX:0}),t("Tick",["pyramid"]).setAll({location:1}),t("FunnelSlice",["pictorial"]).setAll({interactive:!0,tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}"}),t("Label",["pictorial"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:h}),t("Label",["pictorial","horizontal"]).setAll({centerX:0,centerY:h,rotation:-90}),t("Label",["pictorial","vertical"]).setAll({centerY:h,centerX:0}),t("FunnelSlice",["pictorial","link"]).setAll({fillOpacity:.5,width:0,height:0}),t("Tick",["pictorial"]).setAll({location:.5});{const s=t("Graphics",["pictorial","background"]);s.setAll({fillOpacity:.2}),x(s,"fill",e,"alternativeBackground")}}}class $ extends i{_afterNew(){this._defaultThemes.push(Z.new(this._root)),super._afterNew(),this.chartContainer.children.push(this.seriesContainer),this.seriesContainer.children.push(this.bulletsContainer)}_processSeries(e){super._processSeries(e),this.seriesContainer.children.moveValue(this.bulletsContainer,this.seriesContainer.children.length-1)}}Object.defineProperty($,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentChart"}),Object.defineProperty($,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.classNames.concat([$.className])});class ee extends r{constructor(){super(...arguments),Object.defineProperty(this,"slicesContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(v.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"labelsContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(v.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"ticksContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(v.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"_lLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_rLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_hLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"slices",{enumerable:!0,configurable:!0,writable:!0,value:this._makeSlices()}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this._makeLabels()}),Object.defineProperty(this,"ticks",{enumerable:!0,configurable:!0,writable:!0,value:this._makeTicks()})}makeSlice(e){const t=this.slicesContainer.children.push(this.slices.make());return t.on("fill",(()=>{this.updateLegendMarker(e)})),t.on("stroke",(()=>{this.updateLegendMarker(e)})),t._setDataItem(e),e.set("slice",t),this.slices.push(t),t}makeLabel(e){const t=this.labelsContainer.children.push(this.labels.make());return t._setDataItem(e),e.set("label",t),this.labels.push(t),t}_shouldMakeBullet(e){return null!=e.get("value")}makeTick(e){const t=this.ticksContainer.children.push(this.ticks.make());return t._setDataItem(e),e.set("tick",t),this.ticks.push(t),t}_afterNew(){this.fields.push("category","fill"),super._afterNew()}_onDataClear(){const e=this.get("colors");e&&e.reset()}_prepareChildren(){if(super._prepareChildren(),this._lLabels=[],this._rLabels=[],this._hLabels=[],this._valuesDirty){let e=0,t=0,s=0,i=1/0,r=0;_(this._dataItems,(s=>{let i=s.get("valueWorking",0);e+=i,t+=Math.abs(i)})),_(this._dataItems,(e=>{let o=e.get("valueWorking",0);o>s&&(s=o),o<i&&(i=o),r++;let a=o/t;0==t&&(a=0),e.setRaw("valuePercentTotal",100*a)})),this.setPrivateRaw("valueLow",i),this.setPrivateRaw("valueHigh",s),this.setPrivateRaw("valueSum",e),this.setPrivateRaw("valueAverage",e/r),this.setPrivateRaw("valueAbsoluteSum",t)}}show(t){const s=Object.create(null,{show:{get:()=>super.show}});return e(this,void 0,void 0,(function*(){let e=[];e.push(s.show.call(this,t)),e.push(this._sequencedShowHide(!0,t)),yield Promise.all(e)}))}hide(t){const s=Object.create(null,{hide:{get:()=>super.hide}});return e(this,void 0,void 0,(function*(){let e=[];e.push(s.hide.call(this,t)),e.push(this._sequencedShowHide(!1,t)),yield Promise.all(e)}))}_updateChildren(){super._updateChildren(),this._valuesDirty&&_(this._dataItems,(e=>{e.get("label").text.markDirtyText()})),(this.isDirty("legendLabelText")||this.isDirty("legendValueText"))&&_(this._dataItems,(e=>{this.updateLegendValue(e)})),this._arrange()}_arrange(){this._arrangeDown(this._lLabels),this._arrangeUp(this._lLabels),this._arrangeDown(this._rLabels),this._arrangeUp(this._rLabels),this._arrangeLeft(this._hLabels),this._arrangeRight(this._hLabels),_(this.dataItems,(e=>{this._updateTick(e)}))}_afterChanged(){super._afterChanged(),this._arrange()}processDataItem(e){if(super.processDataItem(e),null==e.get("fill")){let t=this.get("colors");t&&e.setRaw("fill",t.next())}}showDataItem(t,s){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return e(this,void 0,void 0,(function*(){const e=[i.showDataItem.call(this,t,s)];j(s)||(s=this.get("stateAnimationDuration",0));const r=this.get("stateAnimationEasing");let o=t.get("value");const a=t.animate({key:"valueWorking",to:o,duration:s,easing:r});a&&e.push(a.waitForStop());const l=t.get("tick");l&&e.push(l.show(s));const n=t.get("label");n&&e.push(n.show(s));const p=t.get("slice");p&&e.push(p.show(s)),p.get("active")&&p.states.applyAnimate("active"),yield Promise.all(e)}))}hideDataItem(t,s){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return e(this,void 0,void 0,(function*(){const e=[i.hideDataItem.call(this,t,s)],r=this.states.create("hidden",{});j(s)||(s=r.get("stateAnimationDuration",this.get("stateAnimationDuration",0)));const o=r.get("stateAnimationEasing",this.get("stateAnimationEasing")),a=t.animate({key:"valueWorking",to:0,duration:s,easing:o});a&&e.push(a.waitForStop());const l=t.get("tick");l&&e.push(l.hide(s));const n=t.get("label");n&&e.push(n.hide(s));const p=t.get("slice");p.hideTooltip(),p&&e.push(p.hide(s)),yield Promise.all(e)}))}disposeDataItem(e){super.disposeDataItem(e);let t=e.get("label");t&&(this.labels.removeValue(t),t.dispose());let s=e.get("tick");s&&(this.ticks.removeValue(s),s.dispose());let i=e.get("slice");i&&(this.slices.removeValue(i),i.dispose())}hoverDataItem(e){const t=e.get("slice");t&&!t.isHidden()&&t.hover()}unhoverDataItem(e){const t=e.get("slice");t&&t.unhover()}updateLegendMarker(e){const t=e.get("slice");if(t){const s=e.get("legendDataItem");if(s){const e=s.get("markerRectangle");_(D,(s=>{null!=t.get(s)&&e.set(s,t.get(s))}))}}}_arrangeDown(e){if(e){let t=this._getNextDown();e.sort(((e,t)=>e.y>t.y?1:e.y<t.y?-1:0)),_(e,(e=>{const s=e.label.adjustedLocalBounds();let i=s.top;e.y+i<t&&(e.y=t-i),e.label.set("y",e.y),t=e.y+s.bottom}))}}_getNextUp(){return this.labelsContainer.maxHeight()}_getNextDown(){return 0}_arrangeUp(e){if(e){let t=this._getNextUp();e.sort(((e,t)=>e.y<t.y?1:e.y>t.y?-1:0)),_(e,(e=>{const s=e.label.adjustedLocalBounds();let i=s.bottom;e.y+i>t&&(e.y=t-i),e.label.set("y",e.y),t=e.y+s.top}))}}_arrangeRight(e){if(e){let t=0;e.sort(((e,t)=>e.y>t.y?1:e.y<t.y?-1:0)),_(e,(e=>{const s=e.label.adjustedLocalBounds();let i=s.left;e.y+i<t&&(e.y=t-i),e.label.set("x",e.y),t=e.y+s.right}))}}_arrangeLeft(e){if(e){let t=this.labelsContainer.maxWidth();e.sort(((e,t)=>e.y<t.y?1:e.y>t.y?-1:0)),_(e,(e=>{const s=e.label.adjustedLocalBounds();let i=s.right;e.y+i>t&&(e.y=t-i),e.label.set("x",e.y),t=e.y+s.left}))}}_updateSize(){super._updateSize(),this.markDirty()}_updateTick(e){}_dispose(){super._dispose();const e=this.chart;e&&e.series.removeValue(this)}}Object.defineProperty(ee,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentSeries"}),Object.defineProperty(ee,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:r.classNames.concat([ee.className])});class te extends ${constructor(){super(...arguments),Object.defineProperty(this,"_maxRadius",{enumerable:!0,configurable:!0,writable:!0,value:1})}_afterNew(){super._afterNew(),this.seriesContainer.setAll({x:h,y:h})}_prepareChildren(){super._prepareChildren();const e=this.chartContainer,t=e.innerWidth(),s=e.innerHeight(),i=this.get("startAngle",0),r=this.get("endAngle",0),o=this.get("innerRadius");let a=R(0,0,i,r,1);const l=t/(a.right-a.left),n=s/(a.bottom-a.top);let m={left:0,right:0,top:0,bottom:0};if(o instanceof d){let e=o.value,a=Math.min(l,n);e=Math.max(a*e,a-Math.min(s,t))/a,m=R(0,0,i,r,e),this.setPrivateRaw("irModifyer",e/o.value)}a=w([a,m]);const u=this._maxRadius;this._maxRadius=Math.min(l,n);const c=p(this.get("radius",0),this._maxRadius);this.seriesContainer.setAll({dy:-c*(a.bottom+a.top)/2,dx:-c*(a.right+a.left)/2}),(this.isDirty("startAngle")||this.isDirty("endAngle")||u!=this._maxRadius)&&this.series.each((e=>{e._markDirtyKey("startAngle")})),(this.isDirty("innerRadius")||this.isDirty("radius"))&&this.series.each((e=>{e._markDirtyKey("innerRadius")}))}radius(e){let t=p(this.get("radius",0),this._maxRadius),s=p(this.get("innerRadius",0),t);if(e){let i=this.series.indexOf(e),r=this.series.length,o=e.get("radius");return null!=o?s+p(o,t-s):s+(t-s)/r*(i+1)}return t}innerRadius(e){const t=this.radius();let s=p(this.get("innerRadius",0),t);if(s<0&&(s=t+s),e){let i=this.series.indexOf(e),r=this.series.length,o=e.get("innerRadius");return null!=o?s+p(o,t-s):s+(t-s)/r*i}return s}}Object.defineProperty(te,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieChart"}),Object.defineProperty(te,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:$.classNames.concat([te.className])});class se extends ee{_makeSlices(){return new S(P.new({}),(()=>K._new(this._root,{themeTags:k(this.slices.template.get("themeTags",[]),["pie","series"])},[this.slices.template])))}_makeLabels(){return new S(P.new({}),(()=>L._new(this._root,{themeTags:k(this.labels.template.get("themeTags",[]),["pie","series"])},[this.labels.template])))}_makeTicks(){return new S(P.new({}),(()=>o._new(this._root,{themeTags:k(this.ticks.template.get("themeTags",[]),["pie","series"])},[this.ticks.template])))}processDataItem(e){super.processDataItem(e);const t=this.makeSlice(e);t.on("scale",(()=>{this._updateTick(e)})),t.on("shiftRadius",(()=>{this._updateTick(e)})),t.events.on("positionchanged",(()=>{this._updateTick(e)}));const s=this.makeLabel(e);s.events.on("positionchanged",(()=>{this._updateTick(e)})),this.makeTick(e),t.events.on("positionchanged",(()=>{s.markDirty()}))}_getNextUp(){const e=this.chart;return e?e._maxRadius:this.labelsContainer.maxHeight()/2}_getNextDown(){const e=this.chart;return e?-e._maxRadius:-this.labelsContainer.maxHeight()/2}_prepareChildren(){super._prepareChildren();const e=this.chart;if(e){if(this.isDirty("alignLabels")){let e=this.labels.template;if(this.get("alignLabels"))e.set("textType","aligned");else{let t=e.get("textType");null!=t&&"aligned"!=t||e.set("textType","adjusted")}}if(this._valuesDirty||this.isDirty("radius")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("endAngle")||this.isDirty("alignLabels")){this.markDirtyBounds();const t=this.get("startAngle",e.get("startAngle",-90)),s=this.get("endAngle",e.get("endAngle",270))-t;let i=t;const r=e.radius(this);this.setPrivateRaw("radius",r);let o=e.innerRadius(this)*e.getPrivate("irModifyer",1);o<0&&(o=r+o),_(this._dataItems,(e=>{this.updateLegendValue(e);let t=s*e.get("valuePercentTotal")/100;const a=e.get("slice");if(a){a.set("radius",r),a.set("innerRadius",o),a.set("startAngle",i),a.set("arc",t);const s=e.get("fill");a._setDefault("fill",s),a._setDefault("stroke",s)}let l=m(i+t/2);const n=e.get("label");if(n&&(n.setPrivate("radius",r),n.setPrivate("innerRadius",o),n.set("labelAngle",l),"aligned"==n.get("textType"))){let e=r+n.get("radius",0),t=r*u(l);l>90&&l<=270?(n.isHidden()||n.isHiding()||this._lLabels.push({label:n,y:t}),e*=-1,e-=this.labelsContainer.get("paddingLeft",0),n.set("centerX",b),n.setPrivateRaw("left",!0)):(n.isHidden()||n.isHiding()||this._rLabels.push({label:n,y:t}),e+=this.labelsContainer.get("paddingRight",0),n.set("centerX",0),n.setPrivateRaw("left",!1)),n.set("x",e),n.set("y",r*u(l))}i+=t,this._updateTick(e)}))}}}_updateTick(e){const t=e.get("tick"),s=e.get("label"),i=e.get("slice"),r=t.get("location",1);if(t&&s&&i){const e=(i.get("shiftRadius",0)+i.get("radius",0))*i.get("scale",1)*r,o=s.get("labelAngle",0),a=c(o),l=u(o),n=this.labelsContainer,p=n.get("paddingLeft",0),m=n.get("paddingRight",0);let h=0,d=0;if(h=s.x(),d=s.y(),"circular"==s.get("textType")){const e=s.radius()-s.get("paddingBottom",0),t=s.get("labelAngle",0);h=e*c(t),d=e*u(t)}let y=-m;s.getPrivate("left")&&(y=p),t.set("points",[{x:i.x()+e*a,y:i.y()+e*l},{x:h+y,y:d},{x:h,y:d}])}}_positionBullet(e){const t=e.get("sprite");if(t){const s=t.dataItem.get("slice");if(s){const i=s.get("innerRadius",0),r=s.get("radius",0),o=s.get("startAngle",0)+s.get("arc",0)*e.get("locationX",.5),a=i+(r-i)*e.get("locationY",.5);t.setAll({x:c(o)*a,y:u(o)*a})}}}}Object.defineProperty(se,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieSeries"}),Object.defineProperty(se,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:ee.classNames.concat([se.className])});export{te as PieChartAm5,se as PieSeriesAm5};
