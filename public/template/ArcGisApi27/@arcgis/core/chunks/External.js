/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import t from"../request.js";import{l as s}from"./typedArrayUtil.js";import{throwIfAborted as r}from"../core/promiseUtils.js";import{g as e,a}from"./infoFor3D.js";class n{constructor(t,s,r){this.assetName=t,this.assetMimeType=s,this.parts=r}equals(t){return this===t||this.assetName===t.assetName&&this.assetMimeType===t.assetMimeType&&s(this.parts,t.parts,((t,s)=>t.equals(s)))}isOnService(t){return this.parts.every((s=>s.isOnService(t)))}makeHash(){let t="";for(const s of this.parts)t+=s.partHash;return t}async toBlob(t){const{parts:s}=this;if(1===s.length)return s[0].toBlob(t);const e=await Promise.all(s.map((s=>s.toBlob(t))));return r(t),new Blob(e)}}class i{constructor(t,s){this.partUrl=t,this.partHash=s}equals(t){return this===t||this.partUrl===t.partUrl&&this.partHash===t.partHash}isOnService(t){return this.partUrl.startsWith(`${t.path}/assets/`)}async toBlob(s){const{data:e}=await t(this.partUrl,{responseType:"blob"});return r(s),e}}function o(t){return s=t?.source,!!s&&(Array.isArray(s)?s.some(f):f(s));var s}function u(t){return!!Array.isArray(t)&&t.every((t=>t instanceof n))}const c=/^(model\/gltf\+json)|(model\/gltf-binary)$/,l=/\.(gltf|glb)/i;function f(t){if(t instanceof File){const{type:s,name:r}=t;return c.test(s)||l.test(r)}return c.test(t.assetMimeType)||l.test(t.assetName)}function p(t,s){if(!t)return!1;const{source:r}=t;return function(t,s){return Array.isArray(t)?t.every((t=>h(t,s))):h(t,s)}(r,s)}function m(t,s){if(t===s)return!0;const{source:r}=t,{source:e}=s;if(r===e)return!0;if(u(r)&&u(e)){if(r.length!==e.length)return!1;const t=(t,s)=>t.assetName<s.assetName?-1:t.assetName>s.assetName?1:0,s=[...r].sort(t),a=[...e].sort(t);for(let t=0;t<s.length;++t)if(!s[t].equals(a[t]))return!1;return!0}return!1}function h(t,s){return t instanceof n&&t.isOnService(s)}function y(t,s){return t instanceof File?e(t.name,s)??a(t.type,s):a(t.assetMimeType,s)??e(t.assetName,s)}function b(t){return Array.isArray(t)?t:[t]}function g(t){return!!t.original}export{i as S,p as a,g as b,n as c,y as d,m as e,b as f,o as i};
