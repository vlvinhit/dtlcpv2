/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import e from"../core/Accessor.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./typedArrayUtil.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{d as n}from"./maybe.js";import{watch as o,syncAndInitial as a}from"../core/reactiveUtils.js";import"./Logger.js";import"../core/Error.js";import"../intl.js";import{e as r,g as l,h as c,i as p,j as h,k as u,l as g}from"./quantityFormatUtils.js";import{g as m}from"./getDefaultUnitForView.js";import v from"../widgets/Widget.js";import{c as f,i as d}from"./widgetUtils.js";import{m as _}from"./messageBundle.js";import{f as y}from"./number.js";import{t as b}from"./jsxFactory.js";import{b as w,c as T,d as x,f as L,e as M}from"./euclideanLengthMeasurementUtils.js";import{c as $}from"./quantityUtils.js";import{c as z}from"./vec3f64.js";import{geodesicLength as C}from"../geometry/geometryEngine.js";import{projectVectorToWGS84ComparableLonLat as k,projectPolylineToWGS84ComparableLonLat as j}from"../geometry/projection.js";import{isSupported as E,InverseGeodeticSolverResult as O,inverseGeodeticSolver as H,geodesicLengths as N}from"../geometry/support/geodesicUtils.js";import{c as U,b as R,f as S}from"./unitUtils.js";let V=class extends e{constructor(t){super(t),this.helpMessage=void 0}};t([s()],V.prototype,"tooltipOptions",void 0),t([s()],V.prototype,"helpMessage",void 0),V=t([i("esri.views.interactive.tooltip.SketchTooltipInfo")],V);const P="esri-tooltip",W=`${P}-content`,A=`${P}-table`,D=`${P}-help-message`;let F=class extends v{get _units(){const t=m(this.tooltip.view);return{length:t,verticalLength:t,area:t}}_getHelpMessage(t){const{info:e}=this,{tooltipOptions:s,helpMessage:i,viewType:n}=e,o=s?.visibleElements?.helpMessage,a=t??i,r="3d"===n?"helpMessages3d":"helpMessages2d";return o&&a?this._messagesTooltip?.sketch?.[r]?.[a]:void 0}_formatScale(t){return y(t,{style:"percent",maximumFractionDigits:0})}_formatRelativeOrientation(t){return y(t,{maximumFractionDigits:2,minimumFractionDigits:2,signDisplay:"exceptZero"})}_formatLength(t,e,s){return r(this._messagesUnits,t,e??this._units.length,s)}_formatRelativeLength(t){return l(this._messagesUnits,t,this._units.length)}_formatVerticalLength(t){return c(this._messagesUnits,t,this._units.verticalLength)}_formatRelativeVerticalLength(t){return p(this._messagesUnits,t,this._units.verticalLength)}_formatTotalLength(t){return r(this._messagesUnits,t,this._units.length)}_formatArea(t){return h(this._messagesUnits,t,this._units.area)}_formatPercentage(t){return y(t.value,{style:"percent"})}};function Z({className:t,helpMessage:e},...s){const i=s.filter((t=>!!t));return b("div",{class:f(t,W)},i.length>0?b("div",{class:A},...i):null,e?b("div",{key:"help-message",class:D},e):null)}t([s()],F.prototype,"info",void 0),t([s()],F.prototype,"tooltip",void 0),t([s()],F.prototype,"_units",null),t([_("esri/core/t9n/Units"),s()],F.prototype,"_messagesUnits",void 0),t([_("esri/views/interactive/tooltip/t9n/Tooltip"),s()],F.prototype,"_messagesTooltip",void 0),F=t([i("esri.views.interactive.tooltip.content.TooltipContent")],F);const G=`${P}-field`,q={base:G,title:`${G}__title`,value:`${G}__value`};let B=class extends v{render(){return b("div",{class:q.base},b("div",{class:q.title},this.title),b("div",{class:q.value},this.value))}};t([s()],B.prototype,"title",void 0),t([s()],B.prototype,"value",void 0),B=t([i("esri.views.interactive.tooltip.support.TooltipField")],B);const X={base:`${P}-value-by-value`};let Y=class extends v{constructor(){super(...arguments),this.divider="Ã—"}render(){return b("div",{class:X.base},b("span",null,this.left),b("span",null,this.divider),b("span",null,this.right))}};t([s()],Y.prototype,"left",void 0),t([s()],Y.prototype,"divider",void 0),t([s()],Y.prototype,"right",void 0),Y=t([i("esri.views.interactive.tooltip.support.ValueByValue")],Y);const I={base:`${W} ${W}--draw-rectangle`};let J=class extends F{render(){const{area:t,radius:e,xSize:s,ySize:i,tooltipOptions:n}=this.info,{visibleElements:o}=n,a=this._messagesTooltip.sketch;return b(Z,{className:I.base,helpMessage:this._getHelpMessage()},o.radius&&null!=e&&b(B,{title:a.radius,value:this._formatLength(e)}),o.size&&null!=s&&null!=i&&b(B,{title:a.size,value:b(Y,{left:this._formatLength(s),right:this._formatLength(i)})}),o.area&&b(B,{title:a.area,value:this._formatArea(t)}))}};J=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],J);const K={base:`${W}--draw-mesh`};let Q=class extends F{render(){const{elevation:t,tooltipOptions:e}=this.info,{visibleElements:s}=e,i=this._messagesTooltip.sketch;return b(Z,{className:K.base,helpMessage:this._getHelpMessage()},s.elevation&&b(B,{title:i.elevation,value:this._formatVerticalLength(t)}))}};Q=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Q);const tt={base:`${W}--draw-point`};let et=class extends F{render(){const{elevation:t,tooltipOptions:e}=this.info,{visibleElements:s}=e,i=this._messagesTooltip.sketch;return b(Z,{className:tt.base,helpMessage:this._getHelpMessage()},s.elevation&&b(B,{title:i.elevation,value:this._formatVerticalLength(t)}))}};et=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],et);const st={base:`${W} ${W}--draw-polygon`};let it=class extends F{render(){const{area:t,elevation:e,tooltipOptions:s,viewType:i}=this.info,{visibleElements:n}=s,o=this._messagesTooltip.sketch;return b(Z,{className:st.base,helpMessage:this._getHelpMessage()},n.elevation&&"2d"!==i&&b(B,{title:o.elevation,value:this._formatVerticalLength(e)}),n.area&&b(B,{title:o.area,value:this._formatArea(t)}))}};it=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],it);const nt={base:`${W} ${W}--draw-polyline`};let ot=class extends F{render(){const{elevation:t,totalLength:e,tooltipOptions:s,viewType:i}=this.info,{visibleElements:n}=s,o=this._messagesTooltip.sketch;return b(Z,{className:nt.base,helpMessage:this._getHelpMessage()},n.elevation&&"2d"!==i&&b(B,{title:o.elevation,value:this._formatVerticalLength(t)}),n.totalLength&&b(B,{title:o.totalLength,value:this._formatLength(e)}))}};ot=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],ot);const at={base:`${W} ${W}--draw-rectangle`};let rt=class extends F{render(){const{area:t,xSize:e,ySize:s,tooltipOptions:i}=this.info,{visibleElements:n}=i,o=this._messagesTooltip.sketch;return b(Z,{className:at.base,helpMessage:this._getHelpMessage()},n.size&&null!=e&&null!=s&&b(B,{title:o.size,value:b(Y,{left:this._formatLength(e),right:this._formatLength(s)})}),n.area&&b(B,{title:o.area,value:this._formatArea(t)}))}};rt=t([i("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],rt);const lt={base:`${W} ${W}--extent-rotate`};let ct=class extends F{render(){const{angle:t,tooltipOptions:e}=this.info,{visibleElements:s}=e,i=this._messagesTooltip.sketch;return b(Z,{className:lt.base,helpMessage:this._getHelpMessage()},s.rotation&&b(B,{title:i.rotation,value:this._formatRelativeOrientation(t)}))}};ct=t([i("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],ct);const pt={base:`${W} ${W}--extent-scale`};let ht=class extends F{render(){const t=this.info,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:pt.base,helpMessage:this._getHelpMessage()},e.size&&b(B,{title:s.size,value:b(Y,{left:this._formatLength(t.xSize),right:this._formatLength(t.ySize)})}),e.scale&&b(B,{title:s.scale,value:b(Y,{left:this._formatScale(t.xScale),right:this._formatScale(t.yScale)})}))}};ht=t([i("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],ht);const ut={base:`${W} ${W}--reshape-edge-offset`};let gt=class extends F{render(){const{area:t,distance:e,totalLength:s,tooltipOptions:i}=this.info,{visibleElements:n}=i,o=this._messagesTooltip.sketch;return b(Z,{className:ut.base,helpMessage:this._getHelpMessage()},n.distance&&b(B,{title:o.distance,value:this._formatRelativeLength(e)}),n.area&&null!=t&&b(B,{title:o.area,value:this._formatArea(t)}),n.totalLength&&null!=s&&b(B,{title:o.totalLength,value:this._formatLength(s)}))}};gt=t([i("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],gt);const mt={base:`${W} ${W}--transform-absolute`};let vt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:mt.base,helpMessage:this._getHelpMessage()},e.orientation&&null!=t.orientation&&b(B,{key:"orientation",title:s.orientation,value:u(t.orientation,t.rotationType,t.orientationPrecision)}),e.size&&null!=t.size&&b(B,{key:"size",title:s.size,value:this._formatLength(t.size,t.sizeUnit,t.sizePrecision)}))}};vt=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformAbsolute")],vt);const ft={base:`${W} ${W}--transform-rotate`};let dt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:ft.base,helpMessage:this._getHelpMessage()},e.rotation&&null!=t.rotation&&b(B,{key:"rotation",title:s.rotation,value:g(t.rotation,t.rotationType,t.rotationPrecision)}),e.orientation&&null!=t.orientation&&b(B,{key:"orientation",title:s.orientation,value:u(t.orientation,t.rotationType,t.orientationPrecision)}))}};dt=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformRotate")],dt);const _t={base:`${W} ${W}--transform-scale`};let yt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:_t.base,helpMessage:this._getHelpMessage()},e.scale&&null!=t.scale&&b(B,{key:"scale",title:s.scale,value:this._formatPercentage(t.scale)}),e.size&&null!=t.size&&b(B,{key:"size",title:s.size,value:this._formatLength(t.size,t.sizeUnit,t.sizePrecision)}))}};yt=t([i("esri.views.interactive.tooltip.content.TooltipContentTransformScale")],yt);const bt={base:`${W} ${W}--translate-graphic`};let wt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:bt.base,helpMessage:this._getHelpMessage()},e.distance&&b(B,{title:s.distance,value:this._formatLength(t.distance)}))}};wt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphic")],wt);const Tt={base:`${W} ${W}--translate-graphic-xy`};let xt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:Tt.base,helpMessage:this._getHelpMessage()},e.distance&&b(B,{title:s.distance,value:this._formatRelativeLength(t.distance)}))}};xt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicXY")],xt);const Lt={base:`${W} ${W}--translate-graphic-z`};let Mt=class extends F{render(){const{info:t}=this,{visibleElements:e}=t.tooltipOptions,s=this._messagesTooltip.sketch;return b(Z,{className:Lt.base,helpMessage:this._getHelpMessage()},e.distance&&b(B,{title:s.distance,value:this._formatRelativeVerticalLength(t.distance)}))}};Mt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateGraphicZ")],Mt);const $t={base:`${W} ${W}--translate-vertex`};let zt=class extends F{render(){const{distance:t,elevation:e,area:s,totalLength:i,tooltipOptions:n}=this.info,{visibleElements:o}=n,a=this._messagesTooltip.sketch;return b(Z,{className:$t.base,helpMessage:this._getHelpMessage()},o.distance&&b(B,{title:a.distance,value:this._formatLength(t)}),o.elevation&&null!=e&&b(B,{title:a.elevation,value:this._formatVerticalLength(e)}),o.area&&null!=s&&b(B,{title:a.area,value:this._formatArea(s)}),o.totalLength&&null!=i&&b(B,{title:a.totalLength,value:this._formatLength(i)}))}};zt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],zt);const Ct={base:`${W} ${W}--translate-vertex`};let kt=class extends F{render(){const{area:t,distance:e,elevation:s,totalLength:i,tooltipOptions:n}=this.info,{visibleElements:o}=n,a=this._messagesTooltip.sketch;return b(Z,{className:Ct.base,helpMessage:this._getHelpMessage()},o.distance&&b(B,{title:a.distance,value:this._formatRelativeLength(e)}),o.elevation&&null!=s&&b(B,{title:a.elevation,value:this._formatVerticalLength(s)}),o.area&&null!=t&&b(B,{title:a.area,value:this._formatArea(t)}),o.totalLength&&null!=i&&b(B,{title:a.totalLength,value:this._formatLength(i)}))}};kt=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexXY")],kt);const jt={base:`${W} ${W}--translate-vertex`};let Et=class extends F{render(){const{distance:t,elevation:e,tooltipOptions:s}=this.info,{visibleElements:i}=s,n=this._messagesTooltip.sketch;return b(Z,{className:jt.base,helpMessage:this._getHelpMessage()},i.distance&&b(B,{title:n.distance,value:this._formatRelativeVerticalLength(t)}),i.elevation&&null!=e&&b(B,{title:n.elevation,value:this._formatVerticalLength(e)}))}};Et=t([i("esri.views.interactive.tooltip.content.TooltipContentTranslateVertexZ")],Et);const Ot={base:`${P}`};let Ht=class extends e{constructor(t){super(t),this.info=null,this._contentContainer=(()=>{const t=document.createElement("div");return t.classList.add(Ot.base),t})(),this._contentWidget=null}initialize(){const t=this._contentContainer;this.addHandles([o((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t)}),a),o((()=>this.info),((e,s)=>{if(null!=this._contentWidget&&null!=e&&null!=s&&e.type===s.type)this._contentWidget.info=e;else{this._contentWidget=n(this._contentWidget);const s=function(t,e){if(null==e)return null;const s=document.createElement("div");switch(e.type){case"draw-point":return new et({tooltip:t,info:e,container:s});case"draw-polygon":return new it({tooltip:t,info:e,container:s});case"draw-polyline":return new ot({tooltip:t,info:e,container:s});case"draw-mesh":return new Q({tooltip:t,info:e,container:s});case"draw-rectangle":return new rt({tooltip:t,info:e,container:s});case"draw-circle":return new J({tooltip:t,info:e,container:s});case"extent-rotate":return new ct({tooltip:t,info:e,container:s});case"extent-scale":return new ht({tooltip:t,info:e,container:s});case"transform-absolute":return new vt({tooltip:t,info:e,container:s});case"transform-rotate":return new dt({tooltip:t,info:e,container:s});case"transform-scale":return new yt({tooltip:t,info:e,container:s});case"translate-graphic":return new wt({tooltip:t,info:e,container:s});case"translate-graphic-z":return new Mt({tooltip:t,info:e,container:s});case"translate-graphic-xy":return new xt({tooltip:t,info:e,container:s});case"translate-vertex":return new zt({tooltip:t,info:e,container:s});case"translate-vertex-z":return new Et({tooltip:t,info:e,container:s});case"translate-vertex-xy":return new kt({tooltip:t,info:e,container:s});case"reshape-edge-offset":return new gt({tooltip:t,info:e,container:s})}}(this,e);s&&(this._contentWidget=s,s.container&&t.appendChild(s.container))}}),a),o((()=>({container:this._contentContainer,contentWidget:this._contentWidget,screenPoint:this._screenPoint})),Nt,a)])}destroy(){this._contentWidget=n(this._contentWidget),this._contentContainer.remove()}clear(){this.info=null}get _screenPoint(){const t=this.view.inputManager;return t?.multiTouchActive?null:t?.latestPointerLocation}get test(){return{contentContainer:this._contentContainer,visible:"none"!==this._contentContainer?.style.display}}};function Nt({container:t,contentWidget:e,screenPoint:s}){const{style:i}=t;if(null!=s&&null!=e){i.display="block";const e=d(t),n=`translate(${Math.round(s.x)+Ut[0]*(e?-1:1)}px, ${Math.round(s.y)+Ut[1]}px)`;i.transform=e?`translate(-100%, 0) ${n}`:n}else i.display="none"}t([s({nonNullable:!0})],Ht.prototype,"view",void 0),t([s()],Ht.prototype,"info",void 0),t([s()],Ht.prototype,"_contentContainer",void 0),t([s()],Ht.prototype,"_contentWidget",void 0),t([s()],Ht.prototype,"_screenPoint",null),Ht=t([i("esri.views.interactive.tooltip.Tooltip")],Ht);const Ut=[20,20];function Rt(t,e,s,i,...n){return U(t)&&E(t)?e.apply(void 0,n):R(t)?s.apply(void 0,n):i.apply(void 0,n)}function St(t){const{spatialReference:e}=t;return Rt(e,Ft,Zt,Gt,t)}function Vt(t,e){if(!S(t.spatialReference,e.spatialReference))return null;const{spatialReference:s}=t;return Bt[0]=t.x,Bt[1]=t.y,Bt[2]=t.hasZ?t.z:0,Xt[0]=e.x,Xt[1]=e.y,Xt[2]=e.hasZ?e.z:0,Pt(Bt,Xt,s)}function Pt(t,e,s){return Rt(s,Wt,At,Dt,t,e,s)}function Wt(t,e,s){return $(H(qt,t,e,s).distance,"meters")}function At(t,e,s){return $(C(function(t,e,s){return{type:"polyline",spatialReference:s,paths:[[[...t],[...e]]]}}(t,e,s),"meters"),"meters")}function Dt(t,e,s){return k(t,s,Yt)&&k(e,s,It)?$(H(qt,Yt,It).distance,"meters"):null}function Ft(t){return $(N([t],"meters")[0],"meters")}function Zt(t){return $(C(t,"meters"),"meters")}function Gt(t){const e=[];if(!j(t,e))return null;let s=0;for(const t of e){let e=0;for(let s=1;s<t.length;++s)e+=H(qt,t[s-1],t[s]).distance;s+=e}return $(s,"meters")}const qt=new O,Bt=z(),Xt=z(),Yt=z(),It=z();function Jt(t,e){return ie(T,St,w,e,t)}function Kt(t,e,s,i){return ie(M,Pt,L,i,t,e,s)}function Qt(t,e,s){return ie(x,Vt,x,s,t,e)}function te(t,e,s,i){return ie(L,Pt,L,i,t,e,s)}function ee(t){return ie(T,St,w,"on-the-ground",t)}function se(t,e){return ie(x,Vt,x,"on-the-ground",t,e)}function ie(t,e,s,i,...n){if("on-the-ground"===i){const t=e.apply(void 0,n);return null!=t?t:s.apply(void 0,n)}return t.apply(void 0,n)}export{V as S,Ht as T,Jt as a,Qt as b,te as c,Kt as d,Pt as e,se as f,Rt as g,ee as h};
