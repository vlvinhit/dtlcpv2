/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{l as t}from"./typedArrayUtil.js";import{n as e}from"./nextTick.js";import{c as i,b as s,f as r,n,i as a,a as o,e as f}from"./vec3.js";import{g as c,e as h,c as m}from"./vec3f64.js";import{B as _}from"./ByteSizeUnit.js";import{a as u}from"./mat3f64.js";import{a as g}from"./mat4f64.js";import{a as l}from"./quatf64.js";import{c as P}from"./vec2f64.js";import{b as p}from"./vec4f64.js";class B{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&e((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*w);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,w));t++)this._items.push(this._allocator())}}const w=1024;class d{constructor(t,e,i){this._itemByteSize=t,this._itemCreate=e,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){0===this._itemsPtr&&e((()=>this._reset()));const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const t=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let e=0;e<this._itemsPerBuffer;++e)this._items.push(this._itemCreate(t,e*this._itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=M){return new d(16,P,t)}static createVec3f64(t=M){return new d(24,c,t)}static createVec4f64(t=M){return new d(32,p,t)}static createMat3f64(t=M){return new d(72,u,t)}static createMat4f64(t=M){return new d(128,g,t)}static createQuatf64(t=M){return new d(32,l,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const M=4*_.KILOBYTES,j=d.createVec2f64(),y=d.createVec3f64(),b=d.createVec4f64();d.createMat3f64();const z=d.createMat4f64(),S=d.createQuatf64();function V(t){return t?v(h(t.origin),h(t.direction)):v(m(),m())}function v(t,e){return{origin:t,direction:e}}function x(e,i){return t(e.origin,i.origin)&&t(e.direction,i.direction)}function A(t,e){const i=U.get();return i.origin=t,i.direction=e,i}function k(t,e=V()){return O(t.origin,t.direction,e)}function C(t,e,r=V()){return i(r.origin,t),s(r.direction,e,t),r}function O(t,e,s=V()){return i(s.origin,t),i(s.direction,e),s}function Q(t,e){const i=r(y.get(),n(y.get(),t.direction),s(y.get(),e,t.origin));return a(i,i)}function T(t,e,i){const r=a(t.direction,s(i,e,t.origin));return o(i,t.origin,f(i,t.direction,r)),i}const U=new B((()=>V()));export{B as O,b as a,k as b,V as c,z as d,T as e,O as f,C as g,Q as h,x as i,j,S as k,y as s,A as w};
