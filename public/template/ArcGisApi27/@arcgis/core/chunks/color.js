/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{L as t}from"./Logger.js";import{C as n,J as r}from"./enums.js";import{a as s,b as a,V as i}from"./enums4.js";import{U as c,b as o,D as u}from"./enums3.js";import{V as l}from"./VertexElementDescriptor.js";import{a as f}from"./number2.js";const m=t.getLogger("esri.views.2d.engine.webgl.Utils"),d="geometry",p=[{name:d,strideInBytes:12}],y=[{name:d,strideInBytes:36}],I=[{name:d,strideInBytes:24}],g=[{name:d,strideInBytes:12}],S=[{name:d,strideInBytes:40}],T=[{name:d,strideInBytes:36}],E=[{name:d,strideInBytes:36}];function h(e){const t={};for(const n of e)t[n.name]=n.strideInBytes;return t}const w=h([{name:d,strideInBytes:36}]),L=h(p),D=h(y),N=h(I),A=h(g),U=h(S),M=h(T),v=h(E);function b(e,t){switch(e){case s.MARKER:return t===a.HEATMAP?L:w;case s.FILL:switch(t){case a.DOT_DENSITY:return A;case a.SIMPLE:case a.OUTLINE_FILL_SIMPLE:return N;default:return D}case s.LINE:return U;case s.TEXT:return M;case s.LABEL:return v}}const B=[d],C=[d],R=[d],_=[d],O=[d];function F(e){switch(e){case s.MARKER:return B;case s.FILL:return C;case s.LINE:return R;case s.TEXT:return _;case s.LABEL:return O}}function x(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function z(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function P(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function V(e){return null!=e}function j(e){return"number"==typeof e}function k(t){switch(t){case"butt":return n.BUTT;case"round":return n.ROUND;case"square":return n.SQUARE;default:return m.error(new e("mapview-invalid-type",`Cap type ${t} is not a valid option. Defaulting to round`)),n.ROUND}}function $(t){switch(t){case"miter":return r.MITER;case"bevel":return r.BEVEL;case"round":return r.ROUND;default:return m.error(new e("mapview-invalid-type",`Join type ${t} is not a valid option. Defaulting to round`)),r.ROUND}}function G(e){switch(e){case"opacity":return i.OPACITY;case"color":return i.COLOR;case"rotation":return i.ROTATION;case"size":return i.SIZE;default:return m.error(`Cannot interpret unknown vv: ${e}`),null}}function Y(e,t,n,r,s,a,i){for(const t in a){const r=a[t].stride,i=x(r),c=a[t].data,o=n[t].data;if(null==c||null==o)continue;const u=r*s.vertexCount/i,l=r*e/i,f=r*s.vertexFrom/i;for(let e=0;e<u;++e)o[e+l]=c[e+f]}if(null!=i&&null!=r){const n=s.indexCount;for(let a=0;a<n;++a)r[a+t]=i[a+s.indexFrom]-s.vertexFrom+e}}const H={[d]:c.STATIC_DRAW};function q(e,t){const n=[];for(let r=0;r<5;++r){const s=F(r),a={};for(const e of s)a[e]={data:t(r,e)};n.push({data:e(r),buffers:a})}return n}function K(e){switch(e){case u.BYTE:case u.UNSIGNED_BYTE:return 1;case u.SHORT:case u.UNSIGNED_SHORT:return 2;case u.FLOAT:case u.INT:case u.UNSIGNED_INT:return 4}}function W(t){switch(t){case o.UNSIGNED_BYTE:return 1;case o.UNSIGNED_SHORT_4_4_4_4:return 2;case o.FLOAT:return 4;default:return void m.error(new e("webgl-utils",`Unable to handle type ${t}`))}}function X(t){switch(t){case o.UNSIGNED_BYTE:return Uint8Array;case o.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case o.FLOAT:return Float32Array;default:return void m.error(new e("webgl-utils",`Unable to handle type ${t}`))}}const J=new Map,Q=(e,t)=>{if(!J.has(e)){const n=function(e){const t={};for(const n in e){const r=e[n];let s=0;t[n]=r.map((e=>{const t=new l(e.name,e.count,e.type,s,0,e.normalized||!1);return s+=e.count*K(e.type),t})),t[n]?.forEach((e=>e.stride=s))}return t}(t),r=(e=>{const t={};for(const n in e){const r=e[n];t[n]=r?.length?r[0].stride:0}return t})(n),s=(e=>{const t=new Map;for(const n in e)for(const r of e[n])t.set(r.name,r.location);return t})(t),a={strides:r,bufferLayouts:n,attributes:s};J.set(e,a)}return J.get(e)};function Z(e){e(s.FILL),e(s.LINE),e(s.MARKER),e(s.TEXT),e(s.LABEL)}const ee=e=>"path"in e&&de(e.path),te=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,ne=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,re=e=>null!=e&&e.startsWith("data:image/gif"),se=e=>"url"in e&&e.url&&(e.url.includes(".gif")||re(e.url))||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&re(e.imageData),ae=e=>null!=e&&e.startsWith("data:image/png"),ie=e=>"url"in e&&e.url&&(e.url.includes(".png")||ae(e.url))||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&ae(e.imageData),ce=e=>e.type&&e.type.toLowerCase().includes("3d");function oe(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const ue=e=>e.includes("data:image/svg+xml");function le(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return pe(e);default:return!0}}function fe(e){const t="maxVVSize"in e&&e.maxVVSize,n="width"in e&&e.width||"size"in e&&e.size||0;return t||n}function me(e){const t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}const de=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),pe=e=>"fill"===e.type&&"CIMMarkerPlacementInsidePolygon"===e?.cim?.markerPlacement?.type;function ye(e,t=0,n=!1){const r=e[t+3];return e[t]*=r,e[t+1]*=r,e[t+2]*=r,n||(e[t+3]*=255),e}function Ie(e){if(!e)return 0;const{r:t,g:n,b:r,a:s}=e;return f(t*s,n*s,r*s,255*s)}function ge(e){if(!e)return 0;const[t,n,r,s]=e;return f(t*(s/255),n*(s/255),r*(s/255),s)}function Se(e,t,n=0){if(null==t)return e[n]=0,e[n+1]=0,e[n+2]=0,void(e[n+3]=0);const{r,g:s,b:a,a:i}=t;e[n]=r*i/255,e[n+1]=s*i/255,e[n+2]=a*i/255,e[n+3]=i}export{k as A,$ as B,H as C,G as D,W as E,V as F,ce as a,me as b,Q as c,oe as d,ee as e,te as f,X as g,pe as h,j as i,ne as j,fe as k,se as l,ie as m,ue as n,z as o,ye as p,x as q,Y as r,le as s,q as t,P as u,b as v,Se as w,Z as x,ge as y,Ie as z};
