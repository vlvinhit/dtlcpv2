/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{L as r}from"./Logger.js";import{f as e,t,n as o,i as n}from"./mat3.js";import{c as a}from"./mat3f64.js";import{c as f}from"./mat4f64.js";import{t as s,n as m}from"./vec3.js";import{c as i}from"./vec3f64.js";import{projectBuffer as c,computeTranslationToOriginAndRotation as p}from"../geometry/projection.js";import{g as y}from"./spatialReferenceEllipsoidUtils.js";import{G as u,v as P,w as l}from"./unitUtils.js";import{y2lat as T}from"../geometry/support/webMercatorUtils.js";import{B as F,a as g}from"./BufferView.js";import{a as C,n as d}from"./vec32.js";const A=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function _(r,e,t,o,n){return L(o)?(V(U.TO_PCPF,F.fromTypedArray(r),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n)),n):(A.error("Cannot convert spatial reference to PCPF"),n)}function j(r,e,t,o,n){return L(o)?(V(U.FROM_PCPF,F.fromTypedArray(r),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n)),n):(A.error("Cannot convert to spatial reference from PCPF"),n)}function E(r,e,t){return c(r,e,0,t,y(e),0,r.length/3),t}function M(r,e,t){return c(r,y(t),0,e,t,0,r.length/3),e}function O(r,e,t){return o(G,t),C(e,r,G),n(G)||d(e,e),e}function v(r,e,t){if(o(G,t),C(e,r,G,4),n(G)||d(e,e,4),r!==e)for(let t=3;t<r.length;t+=4)e[t]=r[t];return e}function R(r,e,t,o,n){if(!L(o))return A.error("Cannot convert spatial reference to PCPF"),n;V(U.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let e=3;e<r.length;e+=4)n[e]=r[e];return n}function h(r,e,t,o,n){if(!L(o))return A.error("Cannot convert to spatial reference from PCPF"),n;V(U.FROM_PCPF,F.fromTypedArray(r,16),g.fromTypedArray(e),g.fromTypedArray(t),o,F.fromTypedArray(n,16));for(let e=3;e<r.length;e+=4)n[e]=r[e];return n}function V(r,o,n,a,f,i){if(!o)return;const c=n.count,u=y(f);if(B(f))for(let n=0;n<c;n++)a.getVec(n,b),o.getVec(n,w),p(u,b,S,u),e(G,S),r===U.FROM_PCPF&&t(G,G),s(w,w,G),i.setVec(n,w);else for(let f=0;f<c;f++){a.getVec(f,b),o.getVec(f,w),p(u,b,S,u),e(G,S);const c=T(n.get(f,1));let y=Math.cos(c);r===U.TO_PCPF&&(y=1/y),G[0]*=y,G[1]*=y,G[2]*=y,G[3]*=y,G[4]*=y,G[5]*=y,r===U.FROM_PCPF&&t(G,G),s(w,w,G),m(w,w),i.setVec(f,w)}return i}function L(r){return B(r)||function(r){return r.isWebMercator}(r)}function B(r){return r.isWGS84||u(r)||P(r)||l(r)}var U;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(U||(U={}));const b=i(),w=i(),S=f(),G=a();export{_ as a,R as b,M as c,j as d,h as e,v as f,E as p,O as t};
