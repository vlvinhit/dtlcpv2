/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{h as t}from"./typedArrayUtil.js";import{Z as e}from"./vec4f64.js";import{n as s}from"./InterleavedLayout.js";import{S as r}from"./ShaderOutput.js";import{C as a}from"./basicInterfaces.js";import{s as o,c as i,d as n,D as l,G as p}from"./DefaultBufferWriter.js";import{c,o as u,a as h,g as f,d}from"./OrderIndependentTransparency.js";import{R as m}from"./RenderSlot.js";import{V as g}from"./VertexAttribute.js";import{T as y}from"./TriangleMaterial.js";import{V as v}from"./FloatsPassUniform.js";import{S as O,P as T,R as A}from"./Program2.js";import{D as _}from"./Material.js";import{T as C}from"./TransparencyPassType.js";import{C as P}from"./ColorMaterial.glsl.js";import{m as j,c as S,d as D,a as E}from"./renderState.js";import{_ as I}from"./tslib.es6.js";import{p as b}from"./ShaderTechniqueConfiguration.js";import{D as R}from"./DefaultTechniqueConfiguration.js";class L extends O{initializeProgram(t){return new T(t.rctx,L.shader.get().build(this.configuration),_)}_createPipeline(t,e){const s=this.configuration,a=t===C.NONE,l=t===C.FrontFace;return j({blending:s.output!==r.Color&&s.output!==r.Alpha||!s.transparent?null:a?c:u(t),culling:S(s.cullFace),depthTest:{func:h(t)},depthWrite:(a||l)&&s.writeDepth?D:null,colorWrite:E,stencilWrite:s.hasOccludees?o:null,stencilTest:s.hasOccludees?e?i:n:null,polygonOffset:a||l?s.polygonOffset?w:null:f(s.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}L.shader=new A(P,(()=>import("./ColorMaterial.glsl.js").then((t=>t.C))));const w={factor:1,units:1};class N extends R{constructor(){super(...arguments),this.output=r.Color,this.cullFace=a.None,this.transparencyPassType=C.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}}I([b({count:r.COUNT})],N.prototype,"output",void 0),I([b({count:a.COUNT})],N.prototype,"cullFace",void 0),I([b({count:C.COUNT})],N.prototype,"transparencyPassType",void 0),I([b()],N.prototype,"hasSlicePlane",void 0),I([b()],N.prototype,"hasVertexColors",void 0),I([b()],N.prototype,"transparent",void 0),I([b()],N.prototype,"polygonOffset",void 0),I([b()],N.prototype,"enableOffset",void 0),I([b()],N.prototype,"writeDepth",void 0),I([b()],N.prototype,"hasOccludees",void 0),I([b()],N.prototype,"hasMultipassTerrain",void 0),I([b()],N.prototype,"cullAboveGround",void 0),I([b()],N.prototype,"objectAndLayerIdColorInstanced",void 0),I([b()],N.prototype,"vvColor",void 0),I([b({constValue:!0})],N.prototype,"hasVvInstancing",void 0),I([b({constValue:!1})],N.prototype,"vvSize",void 0),I([b({constValue:!1})],N.prototype,"vvOpacity",void 0);class x extends y{constructor(t){super(t,new V),this.supportsEdges=!0,this._configuration=new N}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<d,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(t,e){return!!(e===r.Color||e===r.Alpha||e===r.Highlight||e===r.Depth&&this.parameters.writeLinearDepth||e===r.ObjectAndLayerIdColor)&&(t===m.DRAPED_MATERIAL||(e===r.Highlight?t===m.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?m.TRANSPARENT_MATERIAL:m.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:m.OPAQUE_MATERIAL)))}createGLMaterial(t){return new M(t)}createBufferWriter(){const e=s().vec3f(g.POSITION);return t("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(g.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(g.COLORFEATUREATTRIBUTE):e.vec4u8(g.COLOR),new l(e)}}class M extends p{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==r.Color&&this._output!==r.Alpha||this._updateOccludeeState(t),this.ensureTechnique(L,t)}}class V extends v{constructor(){super(...arguments),this.color=e,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.None,this.hasOccludees=!1}}export{x as C};
