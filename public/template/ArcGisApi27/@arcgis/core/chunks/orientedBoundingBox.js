/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{a as t}from"./mat3.js";import{c as n}from"./mat3f64.js";import{a as e,c as r}from"./quat.js";import{a,b as i}from"./quatf32.js";import{c as s}from"./quatf64.js";import{o,c as f,b as c,j as h,p as u,q as l,m,l as b,a as j,s as z,e as S,r as P,u as q,v as x,w as M}from"./vec3.js";import{c as I,a as w}from"./vec3f32.js";import{e as y,c as V,g as A}from"./vec3f64.js";import{c as N}from"./aaBoundingBox.js";import{s as p,n as d}from"./plane.js";import{V as g}from"./ViewingMode.js";import{A as v}from"./Attribute.js";const F=1e-6,T=[0,0,0],E=[0,0,0],Y=[0,0,0],_=[0,0,0],B=[0,0,0],G=[0,0,0],O=[0,0,0],k=[0,0,0],C=[0,0,0],D=[0,0,0],H=[0,0,0],J=[0,0],K=[0,0,0],L=[0,0,0],Q=[0,0,0],R=[0,0,0],U=[0,0,0],W=[0,0,0];function X(t,n,e,r,a,i){if(It(n)<F)return;xt(K,e,n),xt(L,r,n),xt(Q,a,n),$(t,n,J),U[1]=J[0],R[1]=J[1],W[1]=R[1]-U[1];const s=[e,r,a],o=[K,L,Q];for(let e=0;e<3;++e){$(t,s[e],J),U[0]=J[0],R[0]=J[1],$(t,o[e],J),U[2]=J[0],R[2]=J[1],W[0]=R[0]-U[0],W[2]=R[2]-U[2];const r=jt(W);r<i.quality&&(qt(i.b0,s[e]),qt(i.b1,n),qt(i.b2,o[e]),i.quality=r)}}const Z=[0,0,0];function $(t,n,e){const{data:r,size:a}=t;e[0]=Number.POSITIVE_INFINITY,e[1]=Number.NEGATIVE_INFINITY;for(let t=0;t<r.length;t+=a){const a=r[t]*n[0]+r[t+1]*n[1]+r[t+2]*n[2];e[0]=Math.min(e[0],a),e[1]=Math.max(e[1],a)}}function tt(t,n,e){qt(e.center,t),Pt(e.halfSize,n,.5),e.quaternion[0]=0,e.quaternion[1]=0,e.quaternion[2]=0,e.quaternion[3]=1}const nt=[0,0,0],et=[0,0,0],rt=[0,0,0],at=[0,0,0],it=[0,0,0],st=[0,0,0];function ot(t,n,e){qt(nt,n),Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?nt[0]=0:Math.abs(n[1])>Math.abs(n[2])?nt[1]=0:nt[2]=0,It(nt)<F&&(nt[0]=nt[1]=nt[2]=1),xt(et,n,nt),Mt(et,et),xt(rt,n,et),Mt(rt,rt),ft(t,n,et,rt,at,it),St(st,it,at),lt(n,et,rt,at,it,st,e)}function ft(t,n,e,r,a,i){$(t,n,J),a[0]=J[0],i[0]=J[1],$(t,e,J),a[1]=J[0],i[1]=J[1],$(t,r,J),a[2]=J[0],i[2]=J[1]}const ct=[0,0,0],ht=[1,0,0,0,1,0,0,0,1],ut=[0,0,0];function lt(t,n,e,r,a,i,s){ht[0]=t[0],ht[1]=t[1],ht[2]=t[2],ht[3]=n[0],ht[4]=n[1],ht[5]=n[2],ht[6]=e[0],ht[7]=e[1],ht[8]=e[2],function(t,n){const e=n[0]+n[4]+n[8];if(e>0){let r=Math.sqrt(e+1);t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r}else{let e=0;n[4]>n[0]&&(e=1),n[8]>n[3*e+e]&&(e=2);const r=(e+1)%3,a=(e+2)%3;let i=Math.sqrt(n[3*e+e]-n[3*r+r]-n[3*a+a]+1);t[e]=.5*i,i=.5/i,t[3]=(n[3*r+a]-n[3*a+r])*i,t[r]=(n[3*r+e]+n[3*e+r])*i,t[a]=(n[3*a+e]+n[3*e+a])*i}}(s.quaternion,ht),zt(ut,r,a),Pt(ut,ut,.5),Pt(s.center,t,ut[0]),Pt(ct,n,ut[1]),zt(s.center,s.center,ct),Pt(ct,e,ut[2]),zt(s.center,s.center,ct),Pt(s.halfSize,i,.5)}class mt{constructor(t){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let n=0;this.minProj=new Float64Array(this.buffer,n,7),n+=56,this.maxProj=new Float64Array(this.buffer,n,7),n+=56;for(let t=0;t<7;++t)this.minVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.maxVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.minProj[t]=Number.POSITIVE_INFINITY,this.maxProj[t]=Number.NEGATIVE_INFINITY;const e=new Array(7),r=new Array(7),{data:a,size:i}=t;for(let t=0;t<a.length;t+=i){let n=a[t];n<this.minProj[0]&&(this.minProj[0]=n,e[0]=t),n>this.maxProj[0]&&(this.maxProj[0]=n,r[0]=t),n=a[t+1],n<this.minProj[1]&&(this.minProj[1]=n,e[1]=t),n>this.maxProj[1]&&(this.maxProj[1]=n,r[1]=t),n=a[t+2],n<this.minProj[2]&&(this.minProj[2]=n,e[2]=t),n>this.maxProj[2]&&(this.maxProj[2]=n,r[2]=t),n=a[t]+a[t+1]+a[t+2],n<this.minProj[3]&&(this.minProj[3]=n,e[3]=t),n>this.maxProj[3]&&(this.maxProj[3]=n,r[3]=t),n=a[t]+a[t+1]-a[t+2],n<this.minProj[4]&&(this.minProj[4]=n,e[4]=t),n>this.maxProj[4]&&(this.maxProj[4]=n,r[4]=t),n=a[t]-a[t+1]+a[t+2],n<this.minProj[5]&&(this.minProj[5]=n,e[5]=t),n>this.maxProj[5]&&(this.maxProj[5]=n,r[5]=t),n=a[t]-a[t+1]-a[t+2],n<this.minProj[6]&&(this.minProj[6]=n,e[6]=t),n>this.maxProj[6]&&(this.maxProj[6]=n,r[6]=t)}for(let t=0;t<7;++t){let n=e[t];qt(this.minVert[t],a,n),n=r[t],qt(this.maxVert[t],a,n)}}}class bt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function jt(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function zt(t,n,e){t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2]}function St(t,n,e){t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2]}function Pt(t,n,e){t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e}function qt(t,n,e=0){t[0]=n[e],t[1]=n[e+1],t[2]=n[e+2]}function xt(t,n,e){const r=n[0],a=n[1],i=n[2],s=e[0],o=e[1],f=e[2];t[0]=a*f-i*o,t[1]=i*s-r*f,t[2]=r*o-a*s}function Mt(t,n){const e=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(e>0){const r=1/Math.sqrt(e);t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r}}function It(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function wt(t,n){const e=n[0]-t[0],r=n[1]-t[1],a=n[2]-t[2];return e*e+r*r+a*a}function yt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}const Vt=s(),At=V(),Nt=V(),pt=n();class dt{constructor(t){const n=56*t;this.buffer=new ArrayBuffer(n),this.obbs=new Array(t);for(let n=0;n<t;n++)this.obbs[n]={center:A(this.buffer,56*n+0),halfSize:w(this.buffer,56*n+24),quaternion:i(this.buffer,56*n+36)}}}function gt(t=[0,0,0],n=[-1,-1,-1],e=s()){return{center:y(t),halfSize:I(n),quaternion:a(e)}}function vt(t){return gt(t.center,t.halfSize,t.quaternion)}function Ft(t,n){f(n.center,t.center),f(n.halfSize,t.halfSize),r(n.quaternion,t.quaternion)}function Tt(t,n){return function(t,n){const{data:e,size:r}=t,a=e.length/r;if(a<=0)return;const i=new mt(t);zt(T,i.minProj,i.maxProj),Pt(T,T,.5),St(E,i.maxProj,i.minProj);const s=jt(E),o=new bt;o.quality=s,a<14&&(t=new v(new Float64Array(i.buffer,112,42),3));const f=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],l=[0,0,0],m=[0,0,0],b=[0,0,0];switch(function(t,n,e,r,a,i,s,o,f,c){if(function(t,n,e){let r=wt(t.maxVert[0],t.minVert[0]),a=0;for(let n=1;n<7;++n){const e=wt(t.maxVert[n],t.minVert[n]);e>r&&(r=e,a=n)}qt(n,t.minVert[a]),qt(e,t.maxVert[a])}(t,r,a),wt(r,a)<F)return 1;St(s,r,a),Mt(s,s);const h=function(t,n,e,r){const{data:a,size:i}=t;let s=Number.NEGATIVE_INFINITY,o=0;for(let t=0;t<a.length;t+=i){H[0]=a[t]-n[0],H[1]=a[t+1]-n[1],H[2]=a[t+2]-n[2];const r=e[0]*H[0]+e[1]*H[1]+e[2]*H[2],i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],f=H[0]*H[0]+H[1]*H[1]+H[2]*H[2]-r*r/i;f>s&&(s=f,o=t)}return qt(r,a,o),s}(n,r,s,i);return h<F?2:(St(o,a,i),Mt(o,o),St(f,i,r),Mt(f,f),xt(e,o,s),Mt(e,e),X(n,e,s,o,f,c),0)}(i,t,b,f,c,h,u,l,m,o)){case 1:return void tt(T,E,n);case 2:return void ot(t,u,n)}!function(t,n,e,r,a,i,s,o,f){(function(t,n,e,r,a){!function(t,n,e,r,a){const{data:i,size:s}=t;qt(r,i),qt(a,r),e[0]=yt(Z,n),e[1]=e[0];for(let t=s;t<i.length;t+=s){const s=i[t]*n[0]+i[t+1]*n[1]+i[t+2]*n[2];s<e[0]&&(e[0]=s,qt(r,i,t)),s>e[1]&&(e[1]=s,qt(a,i,t))}}(t,n,J,a,r);const i=yt(e,n);J[1]-F<=i&&(r[0]=void 0),J[0]+F>=i&&(a[0]=void 0)})(t,n,e,Y,_),void 0!==Y[0]&&(St(B,Y,e),Mt(B,B),St(G,Y,r),Mt(G,G),St(O,Y,a),Mt(O,O),xt(k,G,i),Mt(k,k),xt(C,O,s),Mt(C,C),xt(D,B,o),Mt(D,D),X(t,k,i,G,B,f),X(t,C,s,O,G,f),X(t,D,o,B,O,f)),void 0!==_[0]&&(St(B,_,e),Mt(B,B),St(G,_,r),Mt(G,G),St(O,_,a),Mt(O,O),xt(k,G,i),Mt(k,k),xt(C,O,s),Mt(C,C),xt(D,B,o),Mt(D,D),X(t,k,i,G,B,f),X(t,C,s,O,G,f),X(t,D,o,B,O,f))}(t,b,f,c,h,u,l,m,o),ft(t,o.b0,o.b1,o.b2,at,it);const j=[0,0,0];St(j,it,at),o.quality=jt(j),o.quality<s?lt(o.b0,o.b1,o.b2,at,it,j,n):tt(T,E,n)}(t,n=n||gt()),n}function Et(t,n){const e=p(n,t.center),r=Ct(t,d(n));return e>r?1:e<-r?-1:0}function Yt(t,n){return At[0]=t.center[0]-n[0],At[1]=t.center[1]-n[1],At[2]=t.center[2]-n[2],e(Vt,t.quaternion),o(At,At,Vt),u(At,At),l(Nt,At,t.halfSize),M(Nt,At)<n[3]*n[3]}function _t(n,e){e||(e=N());const r=t(pt,n.quaternion),a=n.halfSize[0]*Math.abs(r[0])+n.halfSize[1]*Math.abs(r[3])+n.halfSize[2]*Math.abs(r[6]),i=n.halfSize[0]*Math.abs(r[1])+n.halfSize[1]*Math.abs(r[4])+n.halfSize[2]*Math.abs(r[7]),s=n.halfSize[0]*Math.abs(r[2])+n.halfSize[1]*Math.abs(r[5])+n.halfSize[2]*Math.abs(r[8]);return e[0]=n.center[0]-a,e[1]=n.center[1]-i,e[2]=n.center[2]-s,e[3]=n.center[0]+a,e[4]=n.center[1]+i,e[5]=n.center[2]+s,e}function Bt(t,n){return p(n,t.center)-Ct(t,d(n))}function Gt(t,n){return p(n,t.center)+Ct(t,d(n))}function Ot(t,n){return Et(t,n[0])<=0&&Et(t,n[1])<=0&&Et(t,n[2])<=0&&Et(t,n[3])<=0&&Et(t,n[4])<=0&&Et(t,n[5])<=0}function kt(t,n,r,a=0){e(Vt,t.quaternion),c(At,n,t.center);const i=o(At,At,Vt),s=o(Nt,r,Vt);let f=-1/0,h=1/0;for(let n=0;n<3;n++)if(Math.abs(s[n])>1e-6){const e=(a+t.halfSize[n]-i[n])/s[n],r=(-a-t.halfSize[n]-i[n])/s[n];f=Math.max(f,Math.min(e,r)),h=Math.min(h,Math.max(e,r))}else if(i[n]>t.halfSize[n]+a||i[n]<-t.halfSize[n]-a)return!1;return f<=h}function Ct(t,n){e(Vt,t.quaternion),o(At,n,Vt);const r=t.halfSize;return Math.abs(At[0]*r[0])+Math.abs(At[1]*r[1])+Math.abs(At[2]*r[2])}function Dt(t,n){for(let e=0;e<8;++e){const r=n[e];r[0]=1&e?-t.halfSize[0]:t.halfSize[0],r[1]=2&e?-t.halfSize[1]:t.halfSize[1],r[2]=4&e?-t.halfSize[2]:t.halfSize[2],o(r,r,t.quaternion),j(r,r,t.center)}}function Ht(t){return h(t.halfSize)}function Jt(t,n,a,i,s){if(r(s.quaternion,t.quaternion),i===g.Global){e(Rt,t.quaternion),o(Kt,t.center,Rt),u(Lt,Kt),l(Qt,Lt,t.halfSize),m(Qt,Lt,Qt);const r=b(Qt);j(Qt,Lt,t.halfSize);const i=b(Qt);if(r<a)f(s.center,t.center),z(Kt,a,a,a),j(s.halfSize,t.halfSize,Kt);else{const e=i>0?1+n/i:1,f=r>0?1+a/r:1,c=(f+e)/2,h=(f-e)/2;S(s.halfSize,Lt,h),P(s.halfSize,s.halfSize,t.halfSize,c),S(s.center,Lt,c),P(s.center,s.center,t.halfSize,h),q(Kt,Kt),x(s.center,s.center,Kt),o(s.center,s.center,s.quaternion)}}else{const r=z(Kt,0,0,1);P(s.center,t.center,r,(a+n)/2),e(Rt,t.quaternion),o(r,r,Rt),u(r,r),P(s.halfSize,t.halfSize,r,(a-n)/2)}return s}(()=>{const t=new Int8Array(162);let n=0;const e=e=>{for(let r=0;r<e.length;r++)t[n+r]=e[r];n+=6};e([6,2,3,1,5,4]),e([0,2,3,1,5,4]),e([0,2,3,7,5,4]),e([0,1,3,2,6,4]),e([0,1,3,2,0,0]),e([0,1,5,7,3,2]),e([0,1,3,7,6,4]),e([0,1,3,7,6,2]),e([0,1,5,7,6,2]),e([0,1,5,4,6,2]),e([0,1,5,4,0,0]),e([0,1,3,7,5,4]),e([0,2,6,4,0,0]),e([0,0,0,0,0,0]),e([1,3,7,5,0,0]),e([2,3,7,6,4,0]),e([2,3,7,6,0,0]),e([2,3,1,5,7,6]),e([0,1,5,7,6,2]),e([0,1,5,7,6,4]),e([0,1,3,7,6,4]),e([4,5,7,6,2,0]),e([4,5,7,6,0,0]),e([4,5,1,3,7,6]),e([0,2,3,7,5,4]),e([6,2,3,7,5,4]),e([6,2,3,1,5,4])})();const Kt=V(),Lt=V(),Qt=V(),Rt=s();export{dt as O,Tt as a,Dt as b,gt as c,vt as d,Jt as e,kt as f,Yt as g,Ot as h,Et as i,Gt as j,Bt as m,Ct as p,Ht as r,Ft as s,_t as t};
