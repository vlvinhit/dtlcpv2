/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{IdentifiableMixin as e}from"../../core/Identifiable.js";import{d as s}from"../../chunks/maybe.js";import{watch as r,initial as i}from"../../core/reactiveUtils.js";import{property as n}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/ensureType.js";import"../../chunks/typedArrayUtil.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import c from"../Widget.js";import{d as l}from"../../chunks/layerListUtils.js";import{isWidget as a}from"../support/widget.js";import{t as d}from"../../chunks/jsxFactory.js";import"../../chunks/metadata.js";import"../../core/lang.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../core/Error.js";import"../../core/promiseUtils.js";import"../../chunks/watch.js";import"../../chunks/ArrayPool.js";import"../../chunks/ObjectPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/get.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Evented.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/ObservableBase.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/widgetUtils.js";import"../../chunks/dom.js";import"../../chunks/guid.js";import"../../chunks/index.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/accessibleHandler.js";import"../../chunks/messageBundle.js";import"../../chunks/vmEvent.js";import"../../chunks/themeUtils.js";const p="esri-layer-list-panel",m=`${p}__content`,h={base:p,content:m,contentLegend:`${m}--legend`,contentString:`${m}--string`,contentElement:`${m}--html-element`,contentWidget:`${m}--widget`};let u=class extends(e(c)){constructor(t,e){super(t,e),this._legend=null,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles(r((()=>this.content),(t=>this._createLegend(t)),i))}destroy(){this._legend=s(this._legend)}get className(){const{image:t}=this,e=this._getFirstWidget();return this._get("className")||(!t&&e?e.iconClass??"":"")}set className(t){this._override("className",t)}get disabled(){const{listItem:t,_legend:e,content:s}=this;return!(t&&(Array.isArray(s)&&s.length>1||!e||e.activeLayerInfos?.length&&t.visibleAtCurrentScale&&t.visible))}set disabled(t){this._overrideIfSome("disabled",t)}get title(){const t=this._getFirstWidget();return this._get("title")||(t?.label??"")}set title(t){this._override("title",t)}render(){return d("div",{class:h.base},this._renderContents())}_renderContent(t){const{_legend:e,disabled:s}=this;return!t||s?null:"legend"===t&&e?d("div",{class:this.classes(h.content,h.contentLegend),key:e},e.render()):"string"==typeof t?d("div",{class:this.classes(h.content,h.contentString),key:t,innerHTML:t}):a(t)?d("div",{class:this.classes(h.content,h.contentWidget),key:t},t.render()):t instanceof HTMLElement?d("div",{class:this.classes(h.content,h.contentElement),key:t,bind:t,afterCreate:this._attachToNode}):null}_renderContents(){const{content:t}=this;return Array.isArray(t)?t.map((t=>this._renderContent(t))):this._renderContent(t)}_getLegendOptions(){const{listItem:t}=this;if(!t)return{};const{layer:e,view:s}=t;return e&&s?{view:s,layerInfos:[l(e)]}:{}}async _createLegend(t){if(!this._hasLegend(t)||this._legend)return;const{default:e}=await import("../Legend.js"),{listItem:s}=this,n=new e(this._getLegendOptions());this._legend=n,this.notifyChange("className"),this.notifyChange("title");const o=r((()=>[s?.view,s?.layer,s?.layer?.source,s?.layer?.parent]),(()=>this._updateLegend(n)),i);this.addHandles(o,"legends"),this.scheduleRender()}_hasLegend(t){const e="legend";return t===e||null!=t&&!!Array.isArray(t)&&t.includes(e)}_attachToNode(t){t.appendChild(this)}_updateLegend(t){t.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(t){return"legend"===t?this._legend:a(t)?t:null}_getFirstWidget(){const{content:t}=this;if(Array.isArray(t)){let e=null;return t.some((t=>{const s=this._getWidget(t);return s&&(e=s),!!s})),e}return this._getWidget(t)}};t([n()],u.prototype,"_legend",void 0),t([n()],u.prototype,"className",null),t([n()],u.prototype,"content",void 0),t([n()],u.prototype,"disabled",null),t([n()],u.prototype,"image",void 0),t([n()],u.prototype,"listItem",void 0),t([n()],u.prototype,"title",null),t([n()],u.prototype,"open",void 0),t([n()],u.prototype,"visible",void 0),u=t([o("esri.widgets.LayerList.ListItemPanel")],u);const g=u;export{g as default};
