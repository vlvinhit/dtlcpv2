/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{c as s}from"../chunks/domUtils.js";import{o as i,e as l}from"../core/promiseUtils.js";import{HandleOwnerMixin as n}from"../core/HandleOwner.js";import{d as a}from"../chunks/maybe.js";import{watch as c,when as r,initial as o}from"../core/reactiveUtils.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import{cast as d}from"../core/accessorSupport/decorators/cast.js";import"../chunks/typedArrayUtil.js";import{subclass as m}from"../core/accessorSupport/decorators/subclass.js";import{f as h,g as p}from"../chunks/number.js";import v from"./Slider.js";import S,{l as g}from"./Widget.js";import{g as M}from"../chunks/assets.js";import{g as _}from"../chunks/locale.js";import f from"./ScaleRangeSlider/ScaleRanges.js";import b from"./ScaleRangeSlider/ScaleRangeSliderViewModel.js";import{P as w}from"../chunks/Popover.js";import{a as k}from"../chunks/accessibleHandler.js";import{m as y}from"../chunks/messageBundle.js";import{t as x}from"../chunks/jsxFactory.js";import{i as j,s as I}from"../chunks/widgetUtils.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/datetime.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/ensureType.js";import"../chunks/WatchUpdatingTracking.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"./Slider/SliderViewModel.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";const T="esri-scale-range-slider",L=`${T}__scale-menu`,C={base:T,scaleIndicator:`${T}__scale-indicator`,scaleIndicatorIcon:`${T}__scale-indicator-icon`,scaleIndicatorContainer:`${T}__scale-indicator-container`,scaleMenuContainer:`${L}-container`,scaleMenuToggle:`${L}-toggle`,scaleMenuToggleText:`${L}-toggle-text`,scaleMenuToggleIcon:`${L}-toggle-icon`,scaleMenuToggleActive:`${L}-toggle--active`,scaleMenu:L,scaleMenuList:`${L}-list`,scaleMenuListItem:`${L}-item`,scaleMenuListItemContent:`${L}-item-content`,scaleMenuListItemIcon:`${L}-item-icon`,scaleMenuListItemActive:`${L}-item--active`,scaleMenuScroller:`${L}-scroller`,scaleItemLabel:`${T}__scale-item-label`,scaleItemValue:`${T}__scale-item-value`,scaleItemValueEditable:`${T}__scale-item-value--editable`,scalePreview:`${T}__scale-preview`,scalePreviewThumbnail:`${T}__scale-preview-thumbnail`,slider:"esri-slider",expandIcon:"esri-icon-down",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",button:"esri-button",disabled:"esri-disabled",widget:"esri-widget"},$=_().substr(0,2);var R;!function(e){e.ar="ar",e.bg="bg",e.cs="cs",e.da="da",e.de="de",e.el="el",e.en="en",e.es="es",e.et="et",e.fi="fi",e.fr="fr",e.is="is",e.it="it",e.ja="ja",e.ko="ko",e.lt="lt",e.lv="lv",e.nl="nl",e.nn="nn",e.pl="pl",e.pt="pt",e.ro="ro",e.ru="ru",e.sk="sk",e.sv="sv",e.th="th",e.zh="zh"}(R||(R={}));const P={ae:R.en,ar:R.es,at:R.de,au:R.en,be:R.nl,bg:R.bg,bo:R.es,br:R.pt,ca:R.en,ch:R.de,ci:R.fr,cl:R.es,cn:R.zh,co:R.es,cr:R.es,cz:R.cs,de:R.de,dk:R.da,ee:R.et,eg:R.en,es:R.es,fi:R.fi,fr:R.fr,gb:R.en,gl:R.da,gr:R.el,gt:R.es,hk:R.en,id:R.en,ie:R.en,il:R.en,in:R.en,iq:R.ar,is:R.is,it:R.it,jp:R.ja,ke:R.en,kr:R.ko,kw:R.ar,li:R.de,lt:R.lt,lu:R.en,lv:R.lv,ma:R.fr,mg:R.fr,ml:R.fr,mo:R.en,mx:R.es,my:R.en,ni:R.es,nl:R.nl,no:R.nn,nz:R.en,pe:R.es,pl:R.pl,pr:R.es,pt:R.pt,ro:R.ro,ru:R.ru,rw:R.en,se:R.sv,sg:R.en,sk:R.sk,sr:R.nl,sv:R.es,th:R.th,tn:R.fr,tw:R.zh,us:R.en,ve:R.es,vi:R.en,wo:R.en,za:R.en},A=["ar-iq","ar-kw","bg-bg","cs-cz","da-dk","da-gl","de-at","de-ch","de-de","de-li","el-gr","en-ae","en-au","en-ca","en-eg","en-gb","en-hk","en-id","en-ie","en-il","en-in","en-iq","en-ke","en-lu","en-mo","en-my","en-nz","en-rw","en-sg","en-us","en-vi","en-wo","en-za","es-ar","es-bo","es-cl","es-co","es-cr","es-es","es-gt","es-mx","es-ni","es-pe","es-pr","es-sv","es-ve","et-ee","fi-fi","fr-ci","fr-fr","fr-ma","fr-mg","fr-ml","fr-tn","is-is","it-it","ja-jp","ko-kr","lt-lt","lv-lv","nl-be","nl-nl","nl-sr","nn-no","pl-pl","pt-br","pt-pt","ro-ro","ru-ru","sk-sk","sv-se","th-th","zh-cn","zh-tw"];function E(e){e=function(e){return e.toLowerCase()}(e);const t=`${$}-${e}`,s=`${P[e]}-${e}`;return i=A.includes(t)?t:A.includes(s)?s:"en-wo",`url(${M(`esri/widgets/ScaleRangeSlider/images/scalePreview/${i}.jpg`)})`;var i}function N(e){if(!(e<0||e>=25))return`-${e%5*128}px -${128*Math.floor(e/5)}px`}const V={preview:!0,scaleMenus:{maxScaleMenu:!0,minScaleMenu:!0}},z={maximumFractionDigits:0};let D=class extends(n(S)){constructor(e,t){super(e,t),this._activeMenu=null,this._activeMenuNode=null,this._activeMenuToggleNode=null,this._activeThumb=null,this._customMaxScale=-1,this._customMinScale=-1,this._focusedMenuItemIndex=-1,this._maxScaleMenuPopover=new w({owner:this,placement:"bottom-end",anchorElement:()=>this._activeMenuToggleNode,renderContentFunction:()=>this._maxScaleMenuEnabled?this.renderMaxScaleMenu():null}),this._minScaleMenuPopover=new w({owner:this,placement:"bottom-start",anchorElement:()=>this._activeMenuToggleNode,renderContentFunction:()=>this._minScaleMenuEnabled?this.renderMinScaleMenu():null}),this._maxThumbNode=null,this._minThumbNode=null,this._previewAutoCloseTimeoutId=void 0,this._previewPopover=new w({owner:this,placement:"top",anchorElement:()=>0===this._activeThumb?this._minThumbNode:this._maxThumbNode,offset:[0,16],renderContentFunction:this.renderScalePreview}),this._scaleMenuNode=null,this._slider=new v({thumbCreatedFunction:(e,t,s)=>{0===e&&(this._minThumbNode=s),1===e&&(this._maxThumbNode=s),this.addHandles([i(s,"mouseenter",(()=>{const{visibleElements:{preview:t}}=this;this._activeThumb=e,this._previewPopover.open=t,this.scheduleRender()})),i(s,"mouseleave",(()=>{this._previewAutoCloseTimeoutId||(this._activeThumb=null,this._previewPopover.open=!1,this.scheduleRender())}))])}}),this.disabled=!1,this.messages=null,this.region="US",this.viewModel=new b,this.visibleElements=V,this._handleScaleMenuToggleClick=e=>{const t=e.currentTarget,l=t.getAttribute("data-type"),n="menu-closing-click-handle";if(this.handles.remove(n),l===this._activeMenu)return this._setActiveMenu(null),void(this._activeMenuToggleNode=null);this._setActiveMenu(l),this._activeMenuToggleNode=t,this.handles.add(i(document,"mousedown",(e=>{const t=e.target,i=s(t,`.${C.scaleMenuToggle}`),l=i&&i.getAttribute("data-type");i&&l===this._activeMenu||!l&&this._scaleMenuNode&&!this._scaleMenuNode.contains(t)&&(this._setActiveMenu(null),this.handles.remove(n),this.scheduleRender())})),n)},this._afterMenuListCreate=e=>{this._activeMenuNode=e,e.children[0].focus({preventScroll:!0})},this._handleCustomScaleEntry=e=>{this._setScaleFromMenuSelection(e),this._customMaxScale=-1,this._customMinScale=-1},this._handleCustomScaleInputBlur=()=>{"max"===this._activeMenu?this._customMaxScale=-1:this._customMinScale=-1},this._handleCustomScaleInputKeyDown=e=>{const t=e.currentTarget,{handleCustomScaleSelect:s}=t["data-render-props"],{key:i,ctrlKey:l,metaKey:n}=e,{viewModel:{scaleRanges:a}}=this;if("Enter"===i){const i=this.parseScale(t.value);return s?.(isNaN(i)?-1:a.clampScale(i)),e.preventDefault(),void e.stopPropagation()}i.length>1||l||n||/[:,.\d]/.test(i)||(e.preventDefault(),e.stopPropagation())},this._handleScaleMenuKeyDown=e=>{const t=l(e);if("Escape"===t||"Tab"===t)return this._setActiveMenu(null),void this._activeMenuToggleNode?.focus();if("ArrowUp"!==t&&"ArrowDown"!==t)return;const s=Array.from(this._activeMenuNode?.children??[]),i=this._focusedMenuItemIndex,n="ArrowUp"===t?(0===i?s.length:i)-1:(i+1)%s.length;e.preventDefault(),e.stopPropagation(),s[n].focus(),this._focusedMenuItemIndex=n}}loadDependencies(){return g({icon:()=>import("../chunks/calcite-icon.js")})}initialize(){this.addHandles([c((()=>this.viewModel),(e=>this._slider.viewModel=e?.sliderViewModel??null),o),c((()=>this._interactive),(e=>{this._slider.disabled=!e,e||this._setActiveMenu(null)}),o),this._slider.on("thumb-drag",(({index:e})=>{const{visibleElements:{preview:t}}=this;this._activeThumb=e,this._previewPopover.open=t,clearTimeout(this._previewAutoCloseTimeoutId),this._previewAutoCloseTimeoutId=setTimeout((()=>{this._previewAutoCloseTimeoutId=void 0,this._activeThumb=null,this._previewPopover.open=!1,this.scheduleRender()}),250)})),r((()=>!0===this.view?.stationary),(()=>this.scheduleRender()))])}destroy(){this._previewPopover=a(this._previewPopover),this._maxScaleMenuPopover=a(this._maxScaleMenuPopover),this._minScaleMenuPopover=a(this._minScaleMenuPopover),this._slider=a(this._slider)}get _maxScaleMenuEnabled(){const{scaleMenus:e}=this.visibleElements;return!0===e||"boolean"!=typeof e&&e.maxScaleMenu}get _minScaleMenuEnabled(){const{scaleMenus:e}=this.visibleElements;return!0===e||"boolean"!=typeof e&&e.minScaleMenu}get _interactive(){return"disabled"!==this.get("viewModel.state")&&!this.disabled}get effectiveMaxScale(){return this.viewModel.effectiveMaxScale}get effectiveMinScale(){return this.viewModel.effectiveMinScale}get effectiveMaxScaleLimit(){return this.viewModel.effectiveMaxScaleLimit}get effectiveMinScaleLimit(){return this.viewModel.effectiveMinScaleLimit}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxScale(){return this.viewModel.maxScale}set maxScale(e){this.viewModel.maxScale=e}get maxScaleLimit(){return this.viewModel.maxScaleLimit}set maxScaleLimit(e){this.viewModel.maxScaleLimit=e}get minScale(){return this.viewModel.minScale}set minScale(e){this.viewModel.minScale=e}get minScaleLimit(){return this.viewModel.minScaleLimit}set minScaleLimit(e){this.viewModel.minScaleLimit=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...V,...e,scaleMenus:"boolean"==typeof e?.scaleMenus?e.scaleMenus:{...V.scaleMenus,...e?.scaleMenus}}}formatScale(e){return`1:${h(e,z)}`}parseScale(e){const t=p().formatToParts(100000.1),s=t.find((e=>"decimal"===e.type))?.value??"",i=t.find((e=>"group"===e.type))?.value??"",l=e.replace(/.*\(/,"").replace(/\).*$/,"").replace(/.*:/,"").replaceAll(i,"").replaceAll(s,".").replaceAll(/[^\d.\s]/g,"");return parseFloat(l)}render(){const{_interactive:e,_slider:t,label:s,messages:i,view:l,viewModel:{scaleRanges:n,state:a}}=this,c=i.scaleRangeLabels,r=c[n.findScaleRangeByIndex(t.values[0]).id],o=c[n.findScaleRangeByIndex(t.values[1]).id];return t.layout=j(this.container)?"horizontal-reversed":"horizontal",x("div",{"aria-label":s,class:this.classes(C.base,C.widget,e?null:C.disabled)},"ready"===a&&l?this.renderCurrentScaleIndicator():null,t.render(),x("div",{class:C.scaleMenuContainer,key:"scale-menu-toggles"},this._minScaleMenuEnabled?this.renderScaleMenuToggle("min",r):null,this._maxScaleMenuEnabled?this.renderScaleMenuToggle("max",o):null))}renderMinScaleMenu(){const{effectiveMaxScale:e,effectiveMinScaleLimit:t,view:s,viewModel:{scaleRanges:i}}=this,l=s?s.scale:void 0;return this.renderScaleMenu({type:"min",min:t,max:i.findScaleRange(e).minScale,map:l})}renderMaxScaleMenu(){const{effectiveMinScale:e,effectiveMaxScaleLimit:t,view:s,viewModel:{scaleRanges:i}}=this,l=s?s.scale:void 0;return this.renderScaleMenu({type:"max",min:i.findScaleRange(e).maxScale,max:t,map:l})}renderScalePreview(){const{_activeThumb:e,_slider:t,region:s,viewModel:{scaleRanges:i}}=this,l=0===e?t.values[0]:t.values[1],n=Object.keys(f.RecommendedScales).indexOf(i.findScaleRangeByIndex(l).id),a={backgroundImage:E(s),backgroundPosition:N(n)};return x("div",{class:C.scalePreview},x("div",{class:C.scalePreviewThumbnail,styles:a}))}renderScaleMenu({map:e,min:t,max:s,type:i}){const l=f.fromScaleRange({minScale:t,maxScale:s}),n=this.messages.featuredScaleLabels,a=f.RecommendedScales,c=Object.keys(a).filter((e=>l.contains(a[e]))).map((e=>this.renderScaleMenuItem({scaleLabel:n[e],scaleValue:a[e],valueVisible:"world"!==e,handleNamedScaleSelect:this._handleRecommendedScaleClick}))),{_customMaxScale:r,_customMinScale:o,messages:u}=this,d="max"===i?r:o;return x("div",{bind:this,class:C.scaleMenu,"data-type":i,id:`${this.id}__scale-menu--${i}`,key:`${i}-scale-menu`,afterCreate:I,"data-node-ref":"_scaleMenuNode",onkeydown:this._handleScaleMenuKeyDown},x("div",{class:C.scaleMenuScroller},x("ul",{class:C.scaleMenuList,afterCreate:this._afterMenuListCreate},this.renderScaleMenuItem({scaleValue:d,scaleLabel:u.featuredScaleLabels.custom,valueVisible:!1,handleNamedScaleSelect:this._handleScaleSelection,handleCustomScaleSelect:this._handleCustomScaleEntry}),null!=e?this.renderScaleMenuItem({scaleValue:e,scaleLabel:u.featuredScaleLabels.current,valueVisible:!0,handleNamedScaleSelect:this._handleRecommendedScaleClick}):null,c)))}_handleScaleSelection(){"max"===this._activeMenu?this._customMaxScale=this.effectiveMaxScale:this._customMinScale=this.effectiveMinScale}renderScaleMenuToggle(e,t){const{_activeMenu:s,_interactive:i}=this,l=s===e;return x("button",{"aria-controls":l?`${this.id}__scale-menu--${e}`:"","aria-pressed":l?"true":"false",class:this.classes(C.scaleMenuToggle,l?C.scaleMenuToggleActive:null),"data-type":e,key:`${e}-scale-menu-toggle`,onclick:this._handleScaleMenuToggleClick,disabled:!i,type:"button"},x("div",{class:C.scaleMenuToggleText,"aria-label":t,title:t},t),x("span",{class:this.classes(C.scaleMenuToggleIcon,C.expandIcon),"aria-hidden":"true"}))}renderScaleMenuItem(e){const{scaleValue:t,scaleLabel:s,valueVisible:i,handleNamedScaleSelect:l,handleCustomScaleSelect:n=null}=e,{id:a}=this,c=`${a}__custom-scale-input`;return x("li",{bind:this,class:C.scaleMenuListItem,"data-scale":t,key:s,onclick:l,onkeydown:l,tabIndex:-1},x("calcite-icon",{icon:"bullet-point",key:"bullet-icon",scale:"m",class:C.scaleMenuListItemIcon}),x("div",{class:C.scaleMenuListItemContent},x("label",{class:C.scaleItemLabel,for:c},s),i?x("div",{class:C.scaleItemValue,key:"value"},this.formatScale(t)):null,t>-1&&n?x("input",{afterCreate:this._focusAndSelectInputOnCreate,class:this.classes(C.scaleItemValue,C.scaleItemValueEditable),"data-render-props":e,id:c,key:"value",value:this.formatScale(t),onkeydown:this._handleCustomScaleInputKeyDown,onblur:this._handleCustomScaleInputBlur}):null))}_focusAndSelectInputOnCreate(e){e.focus(),e.select()}renderCurrentScaleIndicator(){const{_slider:e,messages:s,view:i,viewModel:{scaleRanges:l}}=this,n=l.clampScale(i.scale),a=this.viewModel.mapScaleToSlider(n),c=a/e.max,r=s.scaleRangeLabels[l.findScaleRangeByIndex(a).id],o=t(s.currentScaleTooltip,{scaleLabel:r});return x("div",{class:C.scaleIndicatorContainer,key:"scale-indicator"},x("div",{"aria-label":o,class:C.scaleIndicator,styles:{left:(j(this.container)?-1:1)*c*100+"%"},title:o},this.renderCurrentScaleIndicatorIcon()))}renderCurrentScaleIndicatorIcon(){return x("svg",{class:C.scaleIndicatorIcon,height:"8",width:"8",viewBox:"0 0 8 8",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},x("polygon",{points:"4 0 8 8 0 8"}))}_handleRecommendedScaleClick(e){const t=Number(e.currentTarget["data-scale"]);this._setScaleFromMenuSelection(t)}_setScaleFromMenuSelection(e){"max"===this._activeMenu?this.maxScale=Math.min(e,this.effectiveMinScale-1):this.minScale=Math.max(e,this.effectiveMaxScale+1),this._setActiveMenu(null),this._activeMenuToggleNode?.focus()}_setActiveMenu(e){this._activeMenu=e,this._maxScaleMenuPopover.open="max"===e,this._minScaleMenuPopover.open="min"===e,this._focusedMenuItemIndex=e?0:-1}};e([u()],D.prototype,"_maxScaleMenuEnabled",null),e([u()],D.prototype,"_minScaleMenuEnabled",null),e([u()],D.prototype,"_slider",void 0),e([u({readOnly:!0})],D.prototype,"_interactive",null),e([u()],D.prototype,"disabled",void 0),e([u()],D.prototype,"effectiveMaxScale",null),e([u()],D.prototype,"effectiveMinScale",null),e([u()],D.prototype,"effectiveMaxScaleLimit",null),e([u()],D.prototype,"effectiveMinScaleLimit",null),e([u()],D.prototype,"label",null),e([u()],D.prototype,"layer",null),e([u()],D.prototype,"maxScale",null),e([u()],D.prototype,"maxScaleLimit",null),e([u(),y("esri/widgets/ScaleRangeSlider/t9n/ScaleRangeSlider")],D.prototype,"messages",void 0),e([u()],D.prototype,"minScale",null),e([u()],D.prototype,"minScaleLimit",null),e([u()],D.prototype,"region",void 0),e([u()],D.prototype,"view",null),e([u()],D.prototype,"viewModel",void 0),e([u()],D.prototype,"visibleElements",void 0),e([d("visibleElements")],D.prototype,"castVisibleElements",null),e([k()],D.prototype,"_handleScaleSelection",null),e([k()],D.prototype,"_handleRecommendedScaleClick",null),D=e([m("esri.widgets.ScaleRangeSlider")],D);const F=D;export{F as default};
