/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../TimeInterval.js";import{l as i}from"../chunks/typedArrayUtil.js";import s from"../core/Collection.js";import{n}from"../chunks/compilerUtils.js";import{c as o}from"../chunks/maybe.js";import{watch as r,initial as a}from"../core/reactiveUtils.js";import{t as l,o as m}from"../chunks/timeUtils.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{f as d,c as p}from"../chunks/date.js";import h from"./Slider.js";import v,{l as w}from"./Widget.js";import{a as f}from"../chunks/accessibleHandler.js";import{m as y}from"../chunks/messageBundle.js";import{v as k}from"../chunks/vmEvent.js";import{t as j}from"../chunks/jsxFactory.js";import{o as g}from"../chunks/widgetUtils.js";import{g as x}from"../chunks/themeUtils.js";import b from"./TimeSlider/TimeSliderViewModel.js";import"../core/Clonable.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../core/lang.js";import"../chunks/metadata.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../core/JSONSupport.js";import"../chunks/enumeration.js";import"../chunks/jsonMap.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../intl.js";import"../chunks/number.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/accessorSupport/decorators/cast.js";import"./Slider/SliderViewModel.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../TimeExtent.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../chunks/Widgets.js";const _="esri-time-slider",T={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${_}`,timeSliderOutOfBounds:`${_}--out-of-bounds`,timeSliderMode:`${_}__mode--`,timeSliderLayout:`${_}__layout--`,timeSliderRow:`${_}__row`,animation:`${_}__animation`,animationButton:`${_}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${_}__time-extent`,timeExtentGroup:`${_}__time-extent-group`,timeExtentDate:`${_}__time-extent-date`,timeExtentTime:`${_}__time-extent-time`,timeExtentSeparator:`${_}__time-extent-separator`,playbackControls:`${_}__playback-controls`,min:`${_}__min`,minDate:`${_}__min-date`,minTime:`${_}__min-time`,slider:`${_}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${_}__max`,maxDate:`${_}__max-date`,maxTime:`${_}__max-time`,previous:`${_}__previous`,previousButton:`${_}__previous-button`,previousIcon:"esri-icon-reverse",next:`${_}__next`,nextButton:`${_}__next-button`,nextIcon:"esri-icon-forward",warning:`${_}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${_}__warning-text`,hasActions:`${_}--has-actions`,actions:`${_}__actions`,actionsButton:`${_}__actions-button`},E=new s([{minor:new t({value:100,unit:"milliseconds"}),major:new t({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:500,unit:"milliseconds"}),major:new t({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:1,unit:"seconds"}),major:new t({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:2,unit:"seconds"}),major:new t({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:10,unit:"seconds"}),major:new t({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new t({value:15,unit:"seconds"}),major:new t({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"minutes"}),major:new t({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:5,unit:"minutes"}),major:new t({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:15,unit:"minutes"}),major:new t({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"hours"}),major:new t({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new t({value:6,unit:"hours"}),major:new t({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new t({value:1,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"long"}},{minor:new t({value:2,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:3,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:4,unit:"days"}),major:new t({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new t({value:1,unit:"weeks"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"months"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"months"}),major:new t({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"years"}),major:new t({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"years"}),major:new t({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:5,unit:"decades"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1,unit:"centuries"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:2,unit:"centuries"}),major:new t({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:5,unit:"centuries"}),major:new t({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:10,unit:"centuries"}),major:new t({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:20,unit:"centuries"}),major:new t({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:50,unit:"centuries"}),major:new t({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:100,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:200,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:500,unit:"centuries"}),major:new t({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1e3,unit:"centuries"}),major:new t({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let S=class extends v{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new h({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=T.widgetIcon,this.icon=null,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new b}initialize(){this.addHandles([r((()=>this._slider.values),(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);null!=this.timeExtent?null!=t?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:null!=t&&(this.timeExtent=t)})),r((()=>this.effectiveStops),(()=>this._updateSliderSteps()),a)])}loadDependencies(){return w({action:()=>import("../chunks/calcite-action.js"),"action-menu":()=>import("../chunks/calcite-action-menu.js")})}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){return!this.disabled&&"disabled"!==this.viewModel?.state}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,t){return b.getPropertiesFromWebMap(e,t)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:e,actions:t,domNode:s,effectiveStops:n,fullTimeExtent:r,interactive:a,messages:l,messagesCommon:m,mode:u,tickConfigs:c,timeExtent:p,timeVisible:h,viewModel:{state:v,timeExtentValues:w}}=this;if(null!=r){const{start:t,end:i}=r;if(null!=t&&null!=i){const s=t.getTime(),n=i.getTime(),o=e.min!==s||e.max!==n;if(o&&(e.min=s,e.max=n),null!=c)e.tickConfigs!==c&&(e.tickConfigs=c);else{const t=(n-s)/(e.trackElement?.offsetWidth||400),i=E.find((e=>e.minor.toMilliseconds()>3*t))??E.at(-1),r=this._tickFormat!==i&&null!=i;if(r&&(this._tickFormat=i),o||r){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t?.classList.add(T.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t?.classList.add(T.sliderMajorTick)},labelFormatFunction:e=>d(e,i.format)};e.tickConfigs=[t,s]}}}}const f=null==this.fullTimeExtent||null==this.fullTimeExtent.start||null==this.fullTimeExtent.end||null==this.timeExtent||this.timeExtent.isAllTime||this.timeExtent.isEmpty||null!=this.timeExtent.start&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||null!=this.timeExtent.end&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(f)switch(this._ignoreNextSliderUpdate=!0,u){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else null!=w?i(e.values,w)||(e.values=w):e.values=null;e.disabled=!a;const y="ready"===v,k="playing"===v,b=f||!a||null==n||0===n.length,_="auto"===this.layout?s.clientWidth<858?"compact":"wide":this.layout,S=j("div",{class:T.animation},j("button",{"aria-disabled":b?"true":"false","aria-label":k?m.control.stop:m.control.play,bind:this,class:this.classes(T.esriWidgetButton,T.animationButton,b&&T.esriButtonDisabled),disabled:b,title:k?m.control.stop:m.control.play,onclick:this._playOrStopClick,type:"button"},j("div",{class:this.classes((y||b)&&T.animationPlay,k&&T.animationPause)}))),M=null!=this.labelFormatFunction?j("div",{key:"extent",bind:this,class:T.timeExtentDate,"data-type":"extent","data-layout":_,"data-date":o(p,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):null==p||null!=p&&p.isAllTime?[j("div",{class:this.classes(T.warning,T.warningIcon)}),j("div",{key:"warning-text",class:T.warningText},l.noTimeExtent)]:p.isEmpty?[j("div",{class:this.classes(T.warning,T.warningIcon)}),j("div",{key:"warning-text",class:T.warningText},l.emptyTimeExtent)]:[null!=p.start&&j("div",{key:"start-date-group",class:T.timeExtentGroup},j("div",{key:"start-date",class:T.timeExtentDate},this._formatDate(p.start)),h&&j("div",{key:"start-time",class:T.timeExtentTime},this._formatTime(p.start))),null!=p.start&&null!=p.end&&p.start.getTime()!==p.end.getTime()&&j("div",{key:"separator",class:T.timeExtentSeparator},"â€“"),null!=p.end&&(null==p.start||p.start.getTime()!==p.end.getTime())&&j("div",{key:"end-date-group",class:T.timeExtentGroup},j("div",{key:"end-date",class:T.timeExtentDate},this._formatDate(p.end)),h&&j("div",{key:"end-time",class:T.timeExtentTime},this._formatTime(p.end)))],$=j("div",{class:this.classes(T.timeExtent,!a&&T.esriButtonDisabled)},[M]),C=null!=this.labelFormatFunction?j("div",{key:"min-date",bind:this,class:T.minDate,"data-date":o(r,(e=>e.start)),"data-type":"min","data-layout":_,afterCreate:this._createLabel,afterUpdate:this._createLabel}):null!=r&&null!=r.start&&[j("div",{key:"min-date",class:T.minDate},this._formatDate(r.start)),h&&j("div",{key:"min-time",class:T.minTime},this._formatTime(r.start))],D=j("div",{class:this.classes(T.min,!a&&T.esriButtonDisabled)},[C]),F=j("div",{class:T.slider},e.render()),B=null!=this.labelFormatFunction?j("div",{key:"max-date",bind:this,class:T.maxDate,"data-date":o(r,(e=>e.end)),"data-type":"max","data-layout":_,afterCreate:this._createLabel,afterUpdate:this._createLabel}):null!=r&&null!=r.end&&[j("div",{key:"max-date",class:T.maxDate},this._formatDate(r.end)),h&&j("div",{key:"max-time",class:T.maxTime},this._formatTime(r.end))],U=j("div",{class:this.classes(T.max,!a&&T.esriButtonDisabled)},[B]),L=j("div",{class:T.previous},j("button",{"aria-disabled":b?"true":"false","aria-label":m.pagination.previous,bind:this,class:this.classes(T.esriWidgetButton,T.previousButton,(k||b)&&T.esriButtonDisabled),disabled:b,title:m.pagination.previous,onclick:this._previousClick,type:"button"},j("div",{class:T.previousIcon}))),W=j("div",{class:T.next},j("button",{"aria-disabled":b?"true":"false","aria-label":m.pagination.next,bind:this,class:this.classes(T.esriWidgetButton,T.nextButton,(k||b)&&T.esriButtonDisabled),disabled:b,title:m.pagination.next,onclick:this._nextClick,type:"button"},j("div",{class:T.nextIcon}))),O=t?.length>0,P=O&&j("div",{class:T.actions,title:m.options},j("calcite-action-menu",{label:m.options,class:T.actionsButton},t.toArray().map((e=>j("calcite-action",{bind:this,icon:e.icon,id:e.id,onclick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return j("div",{class:this.classes(T.timeSlider,T.esriWidget,`${T.timeSliderMode}${u}`,`${T.timeSliderLayout}${_}`,!a&&T.esriDisabled,f&&T.timeSliderOutOfBounds,O&&T.hasActions,x()),afterCreate:e=>{this.addHandles(g(e,(()=>this.scheduleRender())))},"aria-label":l.widgetLabel},"wide"===_&&j("div",{class:T.timeSliderRow},j("div",{class:T.playbackControls},[S,$,D,F,U,L,W]),P),"compact"===_&&[j("div",{key:"time-slider-row-1",class:T.timeSliderRow},[$,P]),j("div",{key:"time-slider-row-2",class:T.timeSliderRow},[F]),j("div",{key:"time-slider-row-3",class:T.timeSliderRow},[D,L,S,W,U])])}updateWebDocument(e){this.viewModel?.updateWebDocument(e)}_createLabel(e){if(null==this.labelFormatFunction)return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(null==t||null==t.start||null==t.end)return[];const{start:i,end:s}=t,n=[],{value:o,unit:r}=e;let a=l(i,r);for(;a.getTime()<=s.getTime();)a.getTime()>=i.getTime()&&n.push(a.getTime()),a=m(a,o,r);return n}_formatDate(e){return e?d(e,p("short-date")):null}_formatTime(e){return e?d(e,p("long-time")):null}_updateSliderSteps(){this._slider.steps=null!=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:n(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([u()],S.prototype,"actions",null),e([u()],S.prototype,"disabled",void 0),e([u()],S.prototype,"effectiveStops",null),e([u()],S.prototype,"fullTimeExtent",null),e([u()],S.prototype,"iconClass",void 0),e([u()],S.prototype,"icon",void 0),e([u({readOnly:!0})],S.prototype,"interactive",null),e([u()],S.prototype,"label",null),e([u()],S.prototype,"labelFormatFunction",void 0),e([u({value:"auto"})],S.prototype,"layout",null),e([u()],S.prototype,"loop",null),e([u(),y("esri/widgets/TimeSlider/t9n/TimeSlider")],S.prototype,"messages",void 0),e([u(),y("esri/t9n/common")],S.prototype,"messagesCommon",void 0),e([u()],S.prototype,"mode",null),e([u()],S.prototype,"playRate",null),e([u()],S.prototype,"stops",null),e([u()],S.prototype,"tickConfigs",void 0),e([u()],S.prototype,"timeExtent",null),e([u({nonNullable:!0})],S.prototype,"timeVisible",void 0),e([u()],S.prototype,"view",null),e([u({type:b}),k("trigger-action")],S.prototype,"viewModel",void 0),e([f()],S.prototype,"_playOrStopClick",null),e([f()],S.prototype,"_previousClick",null),e([f()],S.prototype,"_nextClick",null),S=e([c("esri.widgets.TimeSlider")],S);const M=S;export{M as default};
