/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Collection.js";import{e as i}from"../core/promiseUtils.js";import{HandleOwnerMixin as s}from"../core/HandleOwner.js";import{h as n}from"../chunks/typedArrayUtil.js";import{watch as r,on as o,initial as a}from"../core/reactiveUtils.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import{cast as c}from"../core/accessorSupport/decorators/cast.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import h,{l as u}from"./Widget.js";import m from"./BasemapLayerList/BasemapLayerListViewModel.js";import g from"./LayerList/ListItem.js";import{f as p}from"../chunks/layerListUtils.js";import{H as b,i as _}from"../chunks/Heading.js";import{a as y}from"../chunks/accessibleHandler.js";import{m as f}from"../chunks/messageBundle.js";import{v as I}from"../chunks/vmEvent.js";import{t as v}from"../chunks/jsxFactory.js";import"../chunks/widgetUtils.js";import{S as k}from"../chunks/sortable.esm.js";import"../chunks/ArrayPool.js";import"../chunks/ObjectPool.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/get.js";import"../chunks/utils.js";import"../core/lang.js";import"../chunks/metadata.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../core/Error.js";import"../chunks/ensureType.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/WatchUpdatingTracking.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../core/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../chunks/ActionSlider.js";import"../support/actions/ActionToggle.js";import"./LayerList/ListItemPanel.js";import"./support/widget.js";import"../chunks/themeUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec4.js";const L=t.ofType(g);function T(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const C="root-layers",w="data-layer-uid",A="esri-basemap-layer-list",j=`${A}__item`,S=`${A}__list`,E={base:`${A} esri-widget esri-widget--panel`,newUI:`${A}--new-ui`,titleContainer:`${A}__title-container`,mainHeading:`${A}__main-heading`,editingCard:`${A}__editing-card`,editingInput:`${A}__editing-input`,editingActions:`${A}__editing-actions`,editButton:`${A}__edit-button`,editButtonIcon:`${A}__edit-button-icon`,submitButton:`${A}__submit-button`,cancelButton:`${A}__cancel-button`,noItems:`${A}__no-items`,horizontalRule:`${A}__hr`,list:S,listHeading:`${S}-heading`,listRoot:`${S}--root`,listExclusive:`${S}--exclusive`,listInherited:`${S}--inherited`,listIndependent:`${S}--independent`,item:j,itemOnlyChild:`${j}--only-child`,itemContent:`${j}-content`,itemMessage:`${j}--has-message`,itemInvisible:`${j}--invisible`,itemInvisibleAtScale:`${j}--invisible-at-scale`,itemChildren:`${j}--has-children`,itemSelectable:`${j}--selectable`,itemContainer:`${j}-container`,actionsMenu:`${j}-actions-menu`,actionsMenuItem:`${j}-actions-menu-item`,actionsMenuItemActive:`${j}-actions-menu-item--active`,actions:`${j}-actions`,actionsList:`${j}-actions-list`,action:`${j}-action`,actionIcon:`${j}-action-icon`,actionImage:`${j}-action-image`,actionTitle:`${j}-action-title`,actionToggle:`${A}__action-toggle`,actionToggleOn:`${A}__action-toggle--on`,label:`${j}-label`,message:`${j}-message`,title:`${j}-title`,statusIndicator:`${A}__status-indicator`,publishing:`${A}__publishing`,updating:`${A}__updating`,connectionStatus:`${A}__connection-status`,connectionStatusConnected:`${A}__connection-status--connected`,toggleVisible:`${j}-toggle`,toggleVisibleIcon:`${j}-toggle-icon`,toggleIcon:`${j}-toggle-icon`,radioIcon:`${j}-radio-icon`,childToggle:`${A}__child-toggle`,childToggleOpen:`${A}__child-toggle--open`,childOpened:`${A}__child-toggle-icon--opened`,childClosed:`${A}__child-toggle-icon--closed`,childClosed_RTL:`${A}__child-toggle-icon--closed-rtl`,sortableChosen:`${A}--chosen`,button:"esri-button",buttonTertiary:"esri-button--tertiary",input:"esri-input",disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",heading:"esri-widget__heading",iconEdit:"esri-icon-edit",iconCheckMark:"esri-icon-check-mark",iconClose:"esri-icon-close",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},$="base-items",M="reference-items",R={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function B(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>B(e)))}const O={baseLayers:!0,referenceLayers:!0,statusIndicators:!0,errors:!1};let x=class extends(s(h)){constructor(e,t){super(e,t),this._tooltipReferenceMap=new Map,this._editingTitle=!1,this._editTitleInput=null,this._editTitleButton=null,this._focusOnElement=null,this._sortableBaseLayers=null,this._sortableReferenceLayers=null,this._sortableBaseLayersNode=null,this._sortableReferenceLayersNode=null,this._focusSortUid=null,this._newUI=n("esri-basemaplayerlist-new-ui"),this.visibleItems=null,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=E.widgetIcon,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectedItems=new L,this.viewModel=new m,this.visibleElements={...O}}initialize(){const{baseItems:e,referenceItems:t}=this;this._setVisibleItems(),this.addHandles([r((()=>this.visibleElements),(()=>{this._itemsChanged(e,$),this._itemsChanged(t,M)})),o((()=>this.baseItems),"change",(()=>{this._itemsChanged(e,$)})),o((()=>this.referenceItems),"change",(()=>this._itemsChanged(t,M))),r((()=>this.editingEnabled),(()=>this._toggleSorting()),a)])}loadDependencies(){return u({icon:()=>import("../chunks/calcite-icon.js"),tooltip:()=>import("../chunks/calcite-tooltip.js")})}destroy(){this._destroyBaseSortable(),this._destroyReferenceSortable(),this._tooltipReferenceMap.clear()}get basemapTitle(){return this.viewModel.basemapTitle}set basemapTitle(e){this.viewModel.basemapTitle=e}get baseListItemCreatedFunction(){return this.viewModel.baseListItemCreatedFunction}set baseListItemCreatedFunction(e){this.viewModel.baseListItemCreatedFunction=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get referenceListItemCreatedFunction(){return this.viewModel.referenceListItemCreatedFunction}set referenceListItemCreatedFunction(e){this.viewModel.referenceListItemCreatedFunction=e}get baseItems(){return this.viewModel.baseItems}get referenceItems(){return this.viewModel.referenceItems}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...O,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){const{state:e}=this.viewModel,t={[E.newUI]:this._newUI,[E.hidden]:"loading"===e,[E.disabled]:"disabled"===e},i=this.renderItemTooltips(),s=this.renderReferenceSection(),n=this.renderBaseSection(),r=s&&n?v("hr",{class:E.horizontalRule}):null,o=[this.renderTitleContainer(),s,r,n];return v("div",{class:this.classes(E.base,t)},[i,o])}renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?v("calcite-tooltip",{label:i.layerIncompatible,referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this.renderItemTooltip(e):null,...!t&&i?i.toArray().map((e=>this.renderItemTooltipNodes(e))):[]]}renderItemTooltips(){return this.visibleItems?.toArray().map((e=>this.renderItemTooltipNodes(e)))??[]}renderEditingInput(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return v("label",{class:E.editingInput},e.basemapTitle,v("input",{bind:this,class:E.input,title:e.basemapTitle,"aria-label":e.basemapTitle,placeholder:e.basemapTitle,type:"text",role:"textbox",required:!0,pattern:".*\\S+.*",value:t??void 0,afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement}))}renderCancelButton(){const{messagesCommon:e}=this;return v("button",{title:e.cancel,"aria-label":e.cancel,type:"button",bind:this,class:this.classes(E.button,E.buttonTertiary),onclick:this._toggleEditingTitle},e.cancel)}renderSubmitButton(){const{messagesCommon:e}=this;return v("button",{title:e.form.submit,"aria-label":e.form.submit,type:"submit",bind:this,class:E.button},e.form.ok)}renderEditingForm(){return v("div",{class:E.editingCard},v("form",{bind:this,onsubmit:this._formSubmit},this.renderEditingInput(),v("div",{class:E.editingActions},this.renderCancelButton(),this.renderSubmitButton())))}renderBasemapTitle(){const{basemapTitle:e}=this.viewModel;return v(b,{level:this.headingLevel,class:this.classes(E.heading,E.mainHeading)},e)}renderEditTitleButton(){const{_editingTitle:e,editingEnabled:t,messagesCommon:i}=this;return t&&!e?v("button",{bind:this,class:E.editButton,title:i.edit,"aria-label":i.edit,onclick:this._toggleEditingTitle,afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"data-node-ref":"_editButtonNode",type:"button"},v("span",{"aria-hidden":"true",class:this.classes(E.iconEdit,E.editButtonIcon)})):null}renderTitleContainer(){return v("div",{class:E.titleContainer},this._editingTitle?this.renderEditingForm():this.renderBasemapTitle(),this.renderEditTitleButton())}renderNoLayersInfo(e,t){return v("div",{key:t,class:E.noItems},e)}renderList(e,t){const{messages:i}=this,s="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return v("ul",{key:t,"aria-label":i.widgetLabel,role:this.editingEnabled&&e.length?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:s,"data-node-ref":t,bind:this,class:this.classes(E.list,E.listRoot,E.listIndependent)},e.map((i=>this.renderItem({item:i,parent:null,itemType:t,isOnlyChild:1===e.length}))))}renderBaseHeader(){return v(b,{key:"base-heading",level:_(this.headingLevel),class:this.classes(E.heading,E.listHeading)},this.messages.baseHeading)}renderBaseSection(){const{baseItems:e,messages:t,visibleElements:i}=this;if(!i.baseLayers)return null;const s=this._getItems(e),n="base";return[this.renderBaseHeader(),[0===s.length?this.renderNoLayersInfo(t.noBaseLayers,n):null,this.renderList(s,n)]]}renderReferenceHeader(){return v(b,{key:"reference-heading",level:_(this.headingLevel),class:this.classes(E.heading,E.listHeading)},this.messages.referenceHeading)}renderReferenceSection(){const{referenceItems:e,messages:t,visibleElements:i}=this;if(!i.referenceLayers)return null;const s=this._getItems(e),n="reference";return[this.renderReferenceHeader(),[0===s.length?this.renderNoLayersInfo(t.noReferenceLayers,n):null,this.renderList(s,n)]]}renderChildrenToggle(e,t){const{messagesCommon:i}=this,{children:s}=e,n=!!e.error,r=!!s.length&&!n,o={[E.childToggleOpen]:e.open},a=e.open?i.collapse:i.expand;return r?v("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(E.childToggle,o),tabindex:"0",role:"button","aria-controls":t,"aria-label":a,title:a},v("span",{"aria-hidden":"true",class:this.classes(E.childClosed,E.iconRightArrow)}),v("span",{"aria-hidden":"true",class:this.classes(E.childOpened,E.iconDownArrow)}),v("span",{"aria-hidden":"true",class:this.classes(E.childClosed_RTL,E.iconLeftArrow)})):null}renderItemMessage(e){return e.error?v("div",{key:"esri-basemap-layer-list__error",class:E.message,role:"alert"},v("span",{"aria-hidden":"true",class:E.iconNoticeTriangle}),this.messages.layerError):e.incompatible?v("div",{key:"esri-basemap-layer-list__incompatible",class:E.message,role:"alert"},v("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:E.iconNoticeTriangle,afterCreate:t=>this._setTooltipReference(t,e)}),this.messages.layerIncompatible):null}renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[E.actionsMenuItemActive]:e.actionsOpen};return v("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(E.actionsMenuItem,s),tabindex:"0",role:"button","aria-controls":t,"aria-label":i.options,title:i.options},v("span",{"aria-hidden":"true",class:E.iconEllipses}))}renderActionsMenu(e,t,i,s){const{panel:n}=e,r=n&&n.visible?this.renderPanelButton(n):null,o=1===i&&this._getSingleActionButton(t),a=o?this.renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this.renderActionsMenuIcon(e,s):null;return l||r||o?v("div",{key:"actions-menu",class:E.actionsMenu},r,a,l):null}renderChildList(e,t){const{editingEnabled:i}=this,{visibilityMode:s,children:n}=e,r=this._hasChildren(e),o=!r&&i&&"group"===e.layer?.type,{exclusive:a,inherited:l}=R,c={[E.listExclusive]:s===a,[E.listInherited]:s===l,[E.listIndependent]:s!==l&&s!==a};return r||o?v("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,class:this.classes(E.list,c),"aria-expanded":e.open?"true":"false",role:i?"listbox":s===a?"radiogroup":"group",hidden:!e.open||null},n?.map((t=>this.renderItem({item:t,parent:e}))).toArray()):null}renderItemContent(e,t,i){const{id:s}=this,n=`${s}_${e.uid}`,r=`${n}_actions`,o=`${n}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[v("div",{key:"list-item-container",class:E.itemContainer},this.renderChildrenToggle(e,o),this.renderLabel(e,t,i),this.renderActionsMenu(e,l,c,r)),this.renderItemMessage(e),c?this.renderActionsSections(e,l,r):null,a&&a.open&&!a.disabled?a.render():null,this.renderChildList(e,o)]}renderItem({item:e,parent:t,itemType:i,isOnlyChild:s}){const{_newUI:n,id:r,editingEnabled:o,selectedItems:a}=this,l=`${r}_${e.uid}__title`,c=this._hasMessage(e),d=this._hasChildren(e),h={[E.itemChildren]:d,[E.itemMessage]:!!c,[E.itemInvisible]:n&&!e.visible,[E.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[E.itemSelectable]:o};if(o){const n={[w]:e.layer?.uid};return v("li",{key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(E.item,h,{[E.itemOnlyChild]:!!s}),"aria-labelledby":l,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item-type":i,"data-item":e,tabIndex:0,"aria-selected":p(e,a)?"true":"false",role:"option",...n},this.renderItemContent(e,t,l))}return v("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(E.item,h),"aria-labelledby":l},this.renderItemContent(e,t,l))}renderConnectionIcon(e){const{connectionStatus:t}=e;return null!=t?v("calcite-icon",{icon:"connected"===t?"check-circle":"offline",scale:"s"}):null}renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:s,publishing:n,updating:r}=e,o=r&&!t,a=!!s;return v("span",{class:this.classes({[E.statusIndicator]:!0,[E.publishing]:n,[E.updating]:o,[E.connectionStatus]:a,[E.connectionStatusConnected]:a&&"connected"===s}),key:"layer-item-status"},this.renderConnectionIcon(e))}renderItemTitle(e,t){const{messages:i}=this,s=e.title||i.untitledLayer,n=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return v("span",{key:"layer-title-container",id:t,title:n,"aria-label":n,class:E.title},s)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:s}=R,n=t&&t.visibilityMode,r={[E.toggleVisibleIcon]:i,[E.toggleIcon]:i&&n!==s,[E.radioIcon]:i&&n===s,[E.iconRadioSelected]:n===s&&e.visible,[E.iconRadioUnselected]:n===s&&!e.visible,[E.iconVisible]:n!==s&&e.visible,[E.iconInvisible]:n!==s&&!e.visible};return v("span",{key:"item-toggle-icon",class:this.classes(r),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{editingEnabled:s,messages:n}=this,{exclusive:r}=R,o=t&&t.visibilityMode,a=o===r?"radio":"switch";return v("span",s?{key:"item-toggle-selection-enabled",class:E.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,"aria-checked":e.visible?"true":"false",title:n.layerVisibility,role:a,"aria-labelledby":i}:{key:"item-toggle",class:E.toggleVisible},this.renderItemToggleIcon(e,t))}renderLabel(e,t,i){const{editingEnabled:s,_newUI:n,messages:r}=this,{inherited:o,exclusive:a}=R,l=t?.visibilityMode,c=l===a?"radio":"switch",d=n?[this.renderItemTitle(e,i),this.renderItemStatus(e,t),this.renderItemToggle(e,t,i)]:[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i),this.renderItemStatus(e,t)],h=v("div",s?{key:`item-label-no-selection-${e.uid}`,class:E.label}:{key:`item-label-with-selection-${e.uid}`,class:E.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,title:r.layerVisibility,"aria-checked":e.visible?"true":"false",role:c,"aria-labelledby":i},d);return l===o||e.error?v("div",{key:`item-label-container-${e.uid}`,class:E.label},this.renderItemTitle(e,i),this.renderItemStatus(e,t)):h}renderPanelButton(e){const{className:t,open:i,title:s,image:n,disabled:r}=e,o=n||t?t:E.iconDefaultAction,a=this._getIconImageStyles(e),l={[E.actionsMenuItemActive]:i&&!r},c={[E.actionImage]:!!a["background-image"],[E.disabledElement]:e.disabled};return o&&(c[o]=!!o),v("div",{"aria-disabled":e.disabled.toString(),key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(E.actionsMenuItem,l),role:"button",tabindex:e.disabled?null:0,title:s,"aria-label":s},v("span",{class:this.classes(c),styles:a}))}renderActionsSections(e,t,i){const s=t.toArray().map(((t,i)=>v("ul",{key:`${e}-action-section-${i}`,class:E.actionsList},this.renderActionSection(e,t))));return v("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:E.actions,hidden:!e.actionsOpen||null},s)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n="button"!==e.type||e.image||i?i:E.iconDefaultAction,r={[E.actionImage]:!t&&!!s["background-image"],[E.iconLoading]:t,[E.rotating]:t};return n&&!t&&(r[n]=!0),v("span",{key:"action-icon","aria-hidden":"true",class:this.classes(E.actionIcon,r),styles:s})}renderActionTitle(e,t){return t?null:v("span",{key:"action-title",class:E.actionTitle},e)}renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:r,title:o}=i,a={[E.actionsMenuItem]:s&&"button"===i.type,[E.action]:n||!s&&"toggle"!==i.type,[E.actionToggle]:!n&&"toggle"===i.type,[E.actionToggleOn]:!n&&"toggle"===i.type&&i.value,[E.disabledElement]:r},l=[this.renderActionIcon(i),this.renderActionTitle(o,s)];return s?v("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:o??void 0,"aria-label":o},l):v("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:o??void 0,"aria-label":o},l)}_setVisibleItems(){const{referenceItems:e,baseItems:t,visibleElements:i}=this,s=e.concat(t);this.visibleItems=s?.filter((e=>!e.hidden&&(i.errors||!e.error)))}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_destroyReferenceSortable(){const{_sortableReferenceLayers:e}=this;e?.el&&e.destroy(),this._sortableReferenceLayersNode=null}_destroyBaseSortable(){const{_sortableBaseLayers:e}=this;e?.el&&e.destroy(),this._sortableBaseLayersNode=null}_toggleEditingTitle(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()}_storeEditTitleInput(e){this._editTitleInput=e,this._focusEditElement()}_focusEditElement(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())}_storeEditTitleButton(e){this._editTitleButton=e,this._focusEditElement()}_formSubmit(e){e.preventDefault();const t=this._editTitleInput?.value;t?.trim()&&(this.basemapTitle=t),this._toggleEditingTitle()}_itemMovedList(e){const t=U(e.item);if(!t)return;const i=e.to.dataset.nodeRef,s=e.from.dataset.nodeRef,n=e.newIndex;this.viewModel.transferListItem({listItem:t,from:s,to:i,newIndex:n})}_toggleSortingBaseLayers(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=k.create(t,{dataIdAttr:w,group:C,filter:`.${E.itemOnlyChild}`,fallbackTolerance:4,disabled:s,onSort:()=>this._sortLayersToItems({type:"base",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:E.sortableChosen});this._sortableBaseLayers=e}}_toggleSortingReferenceLayers(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const e=k.create(t,{dataIdAttr:w,group:C,disabled:s,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:E.sortableChosen});this._sortableReferenceLayers=e}}_toggleSorting(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()}_sortNodeCreated(e){const t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()}_getItems(e){return e.toArray().filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error)))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).at(0)}_sortLayersToItems({type:e,itemIds:t}){const i="base"===e?this.get("view.map.basemap.baseLayers"):"reference"===e?this.get("view.map.basemap.referenceLayers"):null;i&&i.sort(((e,i)=>{const s=t.indexOf(e.uid),n=t.indexOf(i.uid);return s>n?-1:s<n?1:0}))}_focusListItem(e){const{_focusSortUid:t}=this;if(!e||!t)return;const i=U(e);i?.layer?.uid===t&&(e.focus(),this._focusSortUid=null)}_selectionKeydown(e){const t=i(e);if(!["ArrowDown","ArrowUp"].includes(t))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget,n=U(s),r=s.dataset.itemType,{_sortableBaseLayers:o,_sortableReferenceLayers:a,selectedItems:l}=this,c="base"===r?o:"reference"===r?a:null;if(!c||!n)return;const d=p(n,l),h=c.toArray(),u=e.target,m=h.indexOf(u.dataset.layerUid),{baseItems:g,referenceItems:b}=this.viewModel;if(-1!==m){if("ArrowDown"===t){const e=m+1,t=e>=h.length;if(t&&"reference"===r&&d){const e=g.length;return this.viewModel.transferListItem({listItem:n,from:"reference",to:"base",newIndex:e}),this._focusSortUid=n.layer?.uid,void this.scheduleRender()}if(t&&"reference"===r){const e=g.at(0);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;return d&&(T(h,m,e),c.sort(h),this._sortLayersToItems({type:r,itemIds:c.toArray()})),this._focusSortUid=n.layer?.uid,void this.scheduleRender()}if("ArrowUp"===t){const e=m-1,t=e<0;if(t&&"base"===r&&d){if(1===g.length)return;const e=0;return this.viewModel.transferListItem({listItem:n,from:"base",to:"reference",newIndex:e}),this._focusSortUid=n.layer?.uid,void this.scheduleRender()}if(t&&"base"===r){const e=b.at(-1);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;d&&(T(h,m,e),c.sort(h),this._sortLayersToItems({type:r,itemIds:c.toArray()})),this._focusSortUid=n.layer?.uid,this.scheduleRender()}}}_watchActionSectionChanges(e,t){this.handles.add(e.on("change",(()=>this.scheduleRender())),t),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){"toggle"!==e.type?"slider"!==e.type?this.handles.add([r((()=>[e.className,e.image,e.id,e.title,e.visible]),(()=>this.scheduleRender()),a)],t):this.handles.add([r((()=>[e.className,e.id,e.title,e.visible,e.value,e.displayValueEnabled,e.max,e.min,e.step]),(()=>this.scheduleRender()),a)],t):this.handles.add([r((()=>[e.className,e.image,e.id,e.title,e.visible,e.value]),(()=>this.scheduleRender()),a)],t)}_renderOnItemChanges(e,t){this.handles.add([r((()=>[e.actionsOpen,e.visible,e.open,e.updating,e.connectionStatus,e.publishing,e.title,e.visibleAtCurrentScale,e.error,e.visibilityMode,e.panel,e.panel?.title,e.panel?.content,e.panel?.className]),(()=>this.scheduleRender()),a),r((()=>[e.hidden,e.error]),(()=>this._setVisibleItems())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],t),e.children.forEach((e=>this._renderOnItemChanges(e,t))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e,t){this.handles.remove(t),this._tooltipReferenceMap.clear(),this._setVisibleItems(),e.forEach((e=>this._renderOnItemChanges(e,t))),this.scheduleRender()}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:""}}_toggleActionsOpen(e){e.stopPropagation();const t=U(e.currentTarget);if(!t)return;const{actionsOpen:i}=t,s=!i,{baseItems:n,referenceItems:r}=this;s&&(n.forEach((e=>B(e))),r.forEach((e=>B(e)))),t.actionsOpen=s}_triggerPanel(e){e.stopPropagation();const t=e.currentTarget["data-panel"];t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){e.stopPropagation();const t=e.currentTarget,i=t["data-action"],s=U(t);s&&i&&("toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,s))}_toggleVisibility(e){e.stopPropagation();const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=U(t);s&&(i===R.exclusive&&s.visible||(s.visible=!s.visible))}_toggleChildrenClick(e){e.stopPropagation();const t=U(e.currentTarget);t&&(t.open=!t.open)}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=t&&(e.metaKey||e.ctrlKey),n=U(e.currentTarget);if(!n)return;const r=p(n,i),{length:o}=i;if(!s)return!o||r&&1===o?void(r?i.remove(r):i.add(n)):(i.removeAll(),void i.add(n));r?i.remove(r):i.add(n)}get test(){return{visibleItems:this.visibleItems}}};function U(e){return e["data-item"]}e([l()],x.prototype,"visibleItems",void 0),e([l()],x.prototype,"basemapTitle",null),e([l()],x.prototype,"baseListItemCreatedFunction",null),e([l()],x.prototype,"editingEnabled",void 0),e([l()],x.prototype,"headingLevel",void 0),e([l()],x.prototype,"iconClass",void 0),e([l()],x.prototype,"label",null),e([l(),f("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],x.prototype,"messages",void 0),e([l(),f("esri/t9n/common")],x.prototype,"messagesCommon",void 0),e([l()],x.prototype,"multipleSelectionEnabled",void 0),e([l()],x.prototype,"referenceListItemCreatedFunction",null),e([l({readOnly:!0})],x.prototype,"baseItems",null),e([l({readOnly:!0})],x.prototype,"referenceItems",null),e([l()],x.prototype,"selectedItems",void 0),e([l()],x.prototype,"view",null),e([I("trigger-action"),l({type:m})],x.prototype,"viewModel",void 0),e([l()],x.prototype,"visibleElements",void 0),e([c("visibleElements")],x.prototype,"castVisibleElements",null),e([y()],x.prototype,"_toggleActionsOpen",null),e([y()],x.prototype,"_triggerPanel",null),e([y()],x.prototype,"_triggerAction",null),e([y()],x.prototype,"_toggleVisibility",null),e([y()],x.prototype,"_toggleChildrenClick",null),e([y()],x.prototype,"_toggleSelection",null),x=e([d("esri.widgets.BasemapLayerList")],x);const N=x;export{N as default};
