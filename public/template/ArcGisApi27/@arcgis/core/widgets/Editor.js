/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{i as s}from"../chunks/typedArrayUtil.js";import{HandleOwnerMixin as r}from"../core/HandleOwner.js";import{L as o}from"../chunks/Logger.js";import{createResolver as i}from"../core/promiseUtils.js";import{watch as n,on as a,when as l,initial as p}from"../core/reactiveUtils.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import{cast as c}from"../core/accessorSupport/decorators/cast.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";import{getDisplayFieldName as d}from"../layers/support/fieldUtils.js";import h from"./Attachments.js";import j from"./FeatureForm.js";import k,{r as y,I as g}from"./FeatureTemplates.js";import{S as f}from"../chunks/Spinner.js";import b,{l as w}from"./Widget.js";import v,{w as _}from"./Editor/EditorViewModel.js";import{i as C}from"./Editor/CreateFeaturesWorkflow.js";import{H as F,i as S}from"../chunks/Heading.js";import M from"./support/SnappingControls.js";import{a as I}from"../chunks/accessibleHandler.js";import{m as U}from"../chunks/messageBundle.js";import{v as A}from"../chunks/vmEvent.js";import{t as T}from"../chunks/jsxFactory.js";import"../chunks/widgetUtils.js";import"../chunks/ensureType.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/maybe.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/WatchUpdatingTracking.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/unitFormatUtils.js";import"../chunks/ByteSizeUnit.js";import"../chunks/Cyclical.js";import"./Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../chunks/featureUtils.js";import"../chunks/layerUtils.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/compilerUtils.js";import"../chunks/deprecate.js";import"../chunks/featureFormUtils.js";import"./FeatureForm/FeatureFormViewModel.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../form/elements/RelationshipElement.js";import"../chunks/editableLayers.js";import"../chunks/infoFor3D.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/Subtype.js";import"./FeatureForm/FieldInput.js";import"./FeatureForm/EditableInput.js";import"./FeatureForm/InputBase.js";import"../arcade.js";import"../chunks/ArcadeDate.js";import"../chunks/executionError.js";import"../chunks/ImmutableArray.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/featureFlags.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/sql.js";import"../layers/Layer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/CustomParametersMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../chunks/QuantizationParameters.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties2.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/TimeReference.js";import"../chunks/featureLayerUtils.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../chunks/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"../chunks/asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/portalItemUtils.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../support/popupUtils.js";import"./FeatureForm/GroupInput.js";import"./FeatureForm/RelationshipInput.js";import"../chunks/FeatureRelationshipViewModel.js";import"./FeatureTemplates/FeatureTemplatesViewModel.js";import"./FeatureTemplates/TemplateItem.js";import"../symbols/support/symbolUtils.js";import"../chunks/utils6.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/previewUtils.js";import"../chunks/renderUtils.js";import"../chunks/colorUtils2.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";import"../chunks/previewSymbol3D.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";import"./FeatureTemplates/TemplateItemGroup.js";import"./Spinner/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"./Editor/CreateWorkflow.js";import"../chunks/helpMessageUtils.js";import"../chunks/centroid2.js";import"./Editor/CreateWorkflowData.js";import"./Editor/Edits.js";import"./Editor/Workflow.js";import"../chunks/workflowUtils.js";import"../chunks/drapedUtils.js";import"../chunks/GraphicState.js";import"../chunks/hitTestSelectUtils.js";import"./Editor/UpdateWorkflow.js";import"../chunks/layerViewUtils.js";import"./Editor/UpdateWorkflowData.js";import"./Sketch/SketchViewModel.js";import"../chunks/isSupportedGraphic.js";import"../chunks/elevationInfoUtils.js";import"../geometry/Circle.js";import"../geometry/support/geodesicUtils.js";import"../chunks/layerUtils3.js";import"../chunks/InputManager.js";import"../chunks/PropertiesPool.js";import"../core/signal.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SnappingManager.js";import"../chunks/Settings2.js";import"../chunks/LineSnappingHint.js";import"../chunks/vec2.js";import"../chunks/EdgeSnappingCandidate.js";import"../chunks/vec2f64.js";import"../chunks/snappingUtils.js";import"../chunks/dehydratedFeatures.js";import"../chunks/byteSizeEstimations.js";import"../chunks/quantizationUtils.js";import"../chunks/geometry2dUtils.js";import"../chunks/DrapedEdgeSnappingCandidate.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/viewUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/screenUtils2.js";import"./Editor/CreateFeaturesWorkflowData.js";import"./support/SnappingControls/SnappingControlsViewModel.js";import"../chunks/layerListUtils.js";import"./LayerList/LayerListViewModel.js";import"./LayerList/ListItem.js";import"../chunks/ActionSlider.js";import"./LayerList/ListItemPanel.js";import"./support/widget.js";import"../chunks/themeUtils.js";let E=class extends b{constructor(e){super(e),this.viewModel=null,this.iconClass="esri-icon-gear",this.icon=null,this._onEnabledChange=e=>{const t=e.target;this.tooltipOptions.enabled=t.checked}}loadDependencies(){return w({block:()=>import("../chunks/calcite-block.js"),label:()=>import("../chunks/calcite-label.js"),switch:()=>import("../chunks/calcite-switch.js")})}render(){return T("div",{class:"esri-sketch-tooltip-controls"},T("calcite-block",{heading:"",open:!0},T("calcite-label",{layout:"inline-space-between"},this.messages?.enabledToggle,T("calcite-switch",{checked:this.tooltipOptions.enabled,onCalciteSwitchChange:this._onEnabledChange}))))}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}};e([m()],E.prototype,"viewModel",void 0),e([m()],E.prototype,"iconClass",void 0),e([m()],E.prototype,"icon",void 0),e([m()],E.prototype,"label",null),e([m(),U("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],E.prototype,"messages",void 0),e([m()],E.prototype,"tooltipOptions",void 0),E=e([u("esri.widgets.Editor.components.SketchTooltipControls")],E);const L="esri-editor",P=`${L}__panel`,W=`${L}__prompt`,D={base:`${L} esri-widget esri-widget--panel`,actions:`${L}__actions`,helpMessage:`${L}__help-message`,panelToolbar:`${P}-toolbar`,panelContent:`${P}-content`,panelContentMessage:`${P}-content__message`,panelContentSection:`${P}-content__section`,panelContentSectionGroup:`${P}-content__section__group`,panelContentScrimContainer:`${P}-content__scrim-container`,settingsContainer:`${L}__settings`,featureTemplatesContainer:`${L}__feature-templates-container`,notice:`${L}__notice`,templateItemContentEnd:`${L}__template-item-content-end`,templateItemContentEndSuccess:`${L}__template-item-content-end--success`,templateItemContentEndError:`${L}__template-item-content-end--error`,templateItemLoader:`${L}__template-item-loader`,promptContainer:W,promptHeader:`${W}__header`,promptHeading:`${W}__header__heading`,promptMessage:`${W}__message`,promptDivider:`${W}__divider`,promptActions:`${W}__actions`,widgetIcon:"esri-icon-edit"},x={undoRedoButtons:!1,snappingControls:!0,snappingControlsElements:{header:!1,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},sketchTooltipControls:!0};function O(e){requestAnimationFrame((()=>e.setFocus()))}const V="exclamation-mark-triangle",B="esri.widgets.Editor",R=o.getLogger(B);let $=class extends(r(b)){constructor(e,t){super(e,t),this._featureForm=new j,this._attachments=new h({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new k({enableListScroll:!1,renderItemContentEnd:e=>this._renderTemplateContentEnd(e),renderItemDescription:e=>this._renderTemplateDescription(e),renderItemLabel:e=>this._renderTemplateLabel(e),renderCustomGroupContent:e=>this._renderCustomTemplateGroupContent(e)}),this._filterText="",this._prompt=null,this._spinner=new f,this.headingLevel=4,this.iconClass=D.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new v,this.visibleElements={...x},this._renderSelectIcon=()=>T("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({handleBack:e,heading:t,headingLevel:s,key:r},...o)=>{const{messagesCommon:i,viewModel:n,visibleElements:a}=this,l=n.sketchViewModel,p=n.syncing||this._attachments.submitting;return T("calcite-flow-item",{closable:!1,heading:t,headingLevel:s,key:r,loading:p,onCalciteFlowItemBack:e??void 0},T("div",{key:"panel-toolbar",class:D.panelToolbar},this._renderSettings(),a.undoRedoButtons&&[T("calcite-button",{key:"undo-button",label:i.undo,appearance:"transparent",kind:"neutral",alignment:"center",iconStart:"undo",scale:"l",disabled:!l.canUndo(),onclick:l.undo.bind(l)},i.undo),T("calcite-button",{key:"redo-button",label:i.redo,appearance:"transparent",kind:"neutral",alignment:"center",iconStart:"redo",scale:"l",disabled:!l.canRedo(),onclick:l.redo.bind(l)},i.redo)]),...o)},this._showDiscardEditsPrompt=()=>{const{messages:e,activeWorkflow:t}=this;if("create-features"===t?.type&&C(t.data.creationInfo))return this._showPrompt({title:e.cancelUploadTitle,message:e.cancelUploadWarningMessage,yesLabel:e.discardUpload,noLabel:e.continueUpload});const s="create"===t?.type;return this._showPrompt({title:e[s?"cancelAddTitle":"cancelEditTitle"],message:e[s?"cancelAddWarningMessage":"cancelEditWarningMessage"],yesLabel:e[s?"discardFeature":"discardEdits"],noLabel:e[s?"continueAdding":"continueEditing"]})},this._showGenericCancelPrompt=()=>{const{messages:e,messagesCommon:t}=this;return this._showPrompt({title:e.cancelRequestTitle,message:e.cancelRequestWarningMessage,yesLabel:t.form.yes,noLabel:t.form.no})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onAttachmentDeleteConfirm=async()=>{const e=this._attachments,{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type?e.deleteFile():(await e.deleteAttachment(e.viewModel.activeAttachmentInfo),this._clearPrompt()),await t.back(),this._clearPrompt())},this._onAttachmentsError=e=>{this._prompt={title:this.messages.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}}},this._clearPrompt=()=>{this._prompt=null},this._onBack=this._onBack.bind(this),this._onSave=this._onSave.bind(this),this._onDelete=this._onDelete.bind(this),this._onToggleUpdateWorkflow=this._onToggleUpdateWorkflow.bind(this),this._onAttachmentAdd=this._onAttachmentAdd.bind(this),this._onAttachmentUpdate=this._onAttachmentUpdate.bind(this),this._onAttachmentDelete=this._onAttachmentDelete.bind(this)}initialize(){this.addHandles([n((()=>S(this.headingLevel)),(e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e}),p),n((()=>this.viewModel.selectedTemplateItem),(e=>this._featureTemplates.select(e,{emit:!1}))),a((()=>this.viewModel.activeWorkflow),"cancel-request",(({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then((t=>t?e.allow():e.deny()))})),n((()=>this.viewModel),(e=>{this._featureForm.viewModel=e?.featureFormViewModel??null,this._attachments.viewModel=e?.attachmentsViewModel??null,this._featureTemplates.viewModel=e?.featureTemplatesViewModel??null,this._spinner.viewModel=e?.spinnerViewModel??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt}),p),n((()=>this.view),((e,t)=>{const s=`editor-${this.id}-spinner`;t?.ui.remove(this._spinner,s),e?.ui.add(this._spinner,{key:s,position:"manual"})}),p),l((()=>this.supportingWidgetDefaults),(e=>{this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch)}),p),l((()=>this._attachments?.error),(e=>this._onAttachmentsError(e))),l((()=>this.viewModel?.failures),(e=>{const{messages:s}=this,[{error:r,retry:o,cancel:i}]=e;this._prompt={title:s.errorWarningTitle,message:t(s.errorWarningMessageTemplate,{errorMessage:r.message}),context:"warning",actions:{primary:{label:s.retry,action:()=>{o(),this._clearPrompt()}},secondary:{label:s.ignore,action:()=>{i(),this._clearPrompt()}}}}})),n((()=>this.viewModel?.state),(e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}})),n((()=>this.viewModel.featureFormDisabled),(e=>this._featureForm.disabled=e))])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return w({accordion:()=>import("../chunks/calcite-accordion.js"),"accordion-item":()=>import("../chunks/calcite-accordion-item.js"),button:()=>import("../chunks/calcite-button.js"),"flow-item":()=>import("../chunks/calcite-flow-item.js"),flow:()=>import("../chunks/calcite-flow.js"),icon:()=>import("../chunks/calcite-icon.js"),list:()=>import("../chunks/calcite-list.js"),loader:()=>import("../chunks/calcite-loader.js"),notice:()=>import("../chunks/calcite-notice.js"),scrim:()=>import("../chunks/calcite-scrim.js")})}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger",type:"primary"}}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){this.viewModel.allowedWorkflows=e}get useDeprecatedCreateWorkflow(){return this.viewModel.useDeprecatedCreateWorkflow}set useDeprecatedCreateWorkflow(e){this.viewModel.useDeprecatedCreateWorkflow=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...x,...e,snappingControlsElements:{...x.snappingControlsElements,...e?.snappingControlsElements}}}startCreateWorkflowAtFeatureTypeSelection(){return _(R,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),this.viewModel.startCreateWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateWorkflowAtFeatureCreation(e){return _(R,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),this.viewModel.startCreateWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateWorkflowAtFeatureEdit(e){return _(R,"startCreateWorkflowAtFeatureEdit"),this.viewModel.startCreateWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this;if(!e)return T("div",{key:"empty",class:D.base});const{state:t}=e;return T("div",{key:"base",class:D.base},T("calcite-flow",{key:"flow"},e.pageStack.map((e=>this._renderPage(e,t))),this._renderPage(e.page,t)),this._renderPrompt())}_renderPage(e,t){switch(e){case"disabled":break;case"ready":return this._renderLanding(t);case"awaiting-feature-creation-info":return this._renderTemplates(t);case"creating-features":case"editing-new-feature":case"editing-existing-feature":return this._renderAttributeEditing(t);case"awaiting-update-feature-candidate":return this._renderFeatureList(t);case"adding-attachment":return this._renderAttachmentAdding(t);case"editing-attachment":return this._renderAttachmentEditing(t)}return T("div",null)}_renderTemplates(e){const{EditorPanel:t,headingLevel:s,messages:r,_onBack:o}=this;return T(t,{active:this._isPanelActive(e),key:"templates-panel",handleBack:o,heading:r.selectTemplate,headingLevel:s},T("div",{key:"feature-templates",class:D.panelContent},this._featureTemplates.render()))}_renderAttributeEditing(e){const{activeWorkflow:s,EditorPanel:r,messages:o,messagesCommon:i,headingLevel:n,_onBack:a,viewModel:l}=this;if(!s)return null;const p=s.type,m="activeWorkflow"in s&&s.activeWorkflow,c=m?m.type:null,u=l.featureFormViewModel,d=m&&!m.hasPendingEdits||"update"===p&&!s.hasPendingEdits||l.syncing||u.updating,h="update"===p?o.editFeature:o.createFeatures,j="update"===p&&"create-features"!==c?i.update:i.create,k="create-features"===p&&"create-new"===s.createFeatureState,y="create-features"===p?s.numPendingFeatures:0,g=y>1?t(o.createFeaturesTemplate,{numFeatures:y}):j,f=s.shouldShowAttachments&&!l.featureFormViewModel.activeRelationshipInput,b=u.inputs.every((e=>!e.visible))&&!f?this._renderMessage(t(o.clickToFinishTemplate,{button:j})):T("div",{key:"panel-content-section",class:D.panelContentSection},this._renderNotices(s),T("div",{class:D.panelContentSectionGroup},this._featureForm.render(),f&&T("div",{key:"attachments"},T(F,{level:S(n)},o.attachments),this._attachments.render())));return T(r,{active:this._isPanelActive(e),key:"attribute-editing-panel",heading:h,headingLevel:n,handleBack:a},T("div",{key:"panel-content",class:this.classes(D.panelContent,{[D.panelContentScrimContainer]:k})},b,k&&T("calcite-scrim",null)),this._renderFooterActions([{clickHandler:this._onSave,disabled:d,label:g,type:"primary"},l.shouldShowDeleteButton?{...this._deleteButtonCommonInfo,clickHandler:this._onDelete,disabled:l.syncing,label:i.delete}:null]))}_renderNotices(e){return[this._renderOwnerAdminNotice(e),this._renderInvalidFormTemplateNotice(e),this._renderInvalidDateFieldNotice(e)]}_renderOwnerAdminNotice(e){return e?.reliesOnOwnerAdminPrivileges&&this._renderNotice(this.messages.ownerAdminNotice)}_renderInvalidFormTemplateNotice(e){return e?.hasInvalidFormTemplate&&this._renderNotice(this.messages.formFieldUpdateError,{icon:V})}_renderInvalidDateFieldNotice(e){return e?.hasUnsupportedFields&&this._renderNotice(this.messages.formFieldUnsupportedUpdateError,{icon:V})}_renderNotice(e,t){return T("calcite-notice",{open:!0,scale:"s",class:D.notice,...t},T("div",{slot:"message"},e))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:s}=this;let r=null;return e.group.items.some((e=>(s.itemHasUnsupportedFields(e)?r=t.formFieldUnsupportedCreateError:s.itemHasInvalidFormTemplate(e)&&(r=t.formFieldCreateError),r))),r?this._renderNotice(r,{icon:V}):null}_renderAttachmentAdding(e){const{_attachments:t,EditorPanel:s,_onBack:r,headingLevel:o,messages:i,messagesCommon:n}=this;return T(s,{active:this._isPanelActive(e),key:"attachment-adding-panel",heading:i.addAttachment,headingLevel:o,handleBack:r},T("div",{key:"attachments",class:D.panelContent},t.render()),this._renderFooterActions([{label:t.submitting?n.cancel:n.add,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._onAttachmentAdd}]))}_renderAttachmentEditing(e){const{_attachments:t,EditorPanel:s,_onBack:r,activeWorkflow:o,headingLevel:i,messages:n,messagesCommon:a}=this;return o?T(s,{active:this._isPanelActive(e),key:"attachment-editing-panel",heading:n.editAttachment,headingLevel:i,handleBack:r},T("div",{key:"attachments",class:D.panelContent},t.render()),o.shouldAllowAttachmentEditing?this._renderFooterActions([{label:a.update,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,clickHandler:this._onAttachmentDelete,disabled:t.submitting,label:a.delete}]):void 0):null}_renderMessage(e){return T("div",{key:"panel-content-message",class:D.panelContentMessage},e)}_renderFooterActions(e){return T("div",{key:"footer-actions",slot:"footer",class:D.actions},e.filter(s).map((({type:e,disabled:t,class:s,clickHandler:r,label:o,...i},n)=>T("calcite-button",{key:`action-${n}`,slot:"footer-actions",class:s,disabled:t??!1,onclick:r,width:"full",...i},o))))}_renderPrompt(){const e=this._prompt;if(!e)return null;const{title:t,message:s,context:r,actions:o}=e,i=o.secondary;let n;switch(r){case"danger":n="danger";break;case"info":n="brand";break;default:n="neutral"}const a=T("calcite-button",{afterCreate:O,appearance:"solid",key:"prompt-primary-button",kind:n,onclick:o.primary.action,scale:"m",width:i?"half":"full"},o.primary.label),l=i&&T("calcite-button",{appearance:"outline",key:"prompt-secondary-button",kind:n,onclick:i.action,scale:"m",width:"half"},i.label);return T("calcite-scrim",{key:"prompt"},T("div",{class:`${D.promptContainer}--${r}`},T("div",{class:D.promptHeader},T("calcite-icon",{icon:V}),T(F,{class:D.promptHeading,level:this.headingLevel},t)),T("div",{class:D.promptMessage},s),T("div",{class:D.promptDivider}),T("div",{class:D.promptActions},l,a)))}_renderLanding(e){const{EditorPanel:t,headingLevel:s,messages:r,viewModel:o}=this,{canUpdate:i}=o,n=this._featureTemplates.viewModel.numberOfFeatureTemplates,a=!i&&0===n;return T(t,{active:this._isPanelActive(e),key:"landing-panel",heading:r.widgetLabel,headingLevel:s},T("div",{key:"landing-content",class:D.panelContent},i&&T("div",{key:"edit-actions",class:D.panelContentSection},this._renderUpdateActions(e)),n>0&&T("div",{key:"create-actions",class:D.panelContentSection},this._renderCreateActions()),a&&T("div",{key:"no-content",class:D.panelContentMessage},r.noEditableLayers)),this._renderFooterHelpMessages())}_renderFooterHelpMessages(){const{activeWorkflow:e,messages:t,view:s}=this,r=e?.helpMessage,o=r?t["3d"===s?.type?"helpMessages3d":"helpMessages2d"]?.[r]:null;return o?T("div",{key:"footer-actions",slot:"footer",class:D.helpMessage},o):null}_renderUpdateActions(e){const{messages:t,messagesCommon:s}=this,r={id:"select",label:s.select};return T("div",{key:"update-actions"},T(F,{level:S(this.headingLevel)},t.editFeatures),T("calcite-list",{selectionMode:"single",selectionAppearance:"border"},y({grouped:!1,item:r,selectedItem:"awaiting-feature-to-update"===e?r:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){const{_featureTemplates:e,headingLevel:t,messages:s}=this;return T("div",{key:"create-actions"},T(F,{level:S(t)},s.createFeatures),T("div",{key:"templates",class:D.featureTemplatesContainer},e.render()))}_renderTemplateLabel(e){return e.label}_renderTemplateDescription(e){const t=this._getUploadForTemplateItem(e);if(!t)return null;const{messages:s}=this;switch(t.state){case"pending":return s?.uploadPending;case"error":return s?.uploadError;default:return null}}_renderTemplateContentEnd(e){const t=this._getUploadForTemplateItem(e),s=T("calcite-icon",{key:"upload-icon",class:D.templateItemContentEnd,icon:"upload-to"});if(!t)return e.supportsUpload?s:null;switch(t.state){case"success":return T("calcite-icon",{key:"success-icon",class:this.classes(D.templateItemContentEnd,D.templateItemContentEndSuccess),icon:"check"});case"error":return T("calcite-icon",{key:"error-icon",class:this.classes(D.templateItemContentEnd,D.templateItemContentEndError),icon:"exclamation-mark-circle-f"});case"pending":return T("calcite-loader",{class:D.templateItemLoader,inline:!0,key:"loader",label:"",scale:"s",type:"indeterminate"});case"canceled":case"default":return s}}_getUploadForTemplateItem(e){const t=this.activeWorkflow;if("create-features"!==t?.type)return null;const{data:s}=t,{creationInfo:r,upload:o}=s;return r?.template===e.template&&r?.layer===e.layer?o:null}_renderFeatureList(e){const{EditorPanel:r,_onBack:o,headingLevel:i,messages:n,messagesTemplates:a,viewModel:{activeWorkflow:l,editableItems:p}}=this;if("update"!==l?.type)return null;const m=l.data.candidates,c=t(n.multipleFeaturesTemplate,{total:m.length}),u=new Map;let d=0;m.map((e=>({label:this._getLabel(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{const{label:t,data:s}=e,r=this._filterText.toLowerCase(),{title:o}=s.layer,i=p.find((e=>e.layer===s.layer));if(!i)return null;const{attachmentsOnUpdateEnabled:n,supports:a}=i;return(a.includes("update")||a.includes("delete")||n)&&(!r||t?.toLowerCase().includes(r)||o?.toLowerCase().includes(r))})).filter(s).forEach((e=>{d++;const t=e.data.layer;u.has(t)?u.get(t)?.items.push(e):u.set(t,{id:`${t.id}`,label:t.title??"",items:[e]})}));const h=p.toArray().map((({layer:e})=>u.get(e))).filter(s),j=d>10||this._filterText.length>0;return T(r,{active:this._isPanelActive(e),key:"feature-list",heading:c,headingLevel:i,handleBack:o},T("div",{key:"feature-list",class:D.panelContent},T("div",{class:D.panelContentSection},g({enableListScroll:!1,filterEnabled:j,filterText:this._filterText,id:this.id,items:h,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},onFilterChange:e=>this._filterText=e,onItemMouseEnter:e=>this.viewModel.selectFeature(e.data),onItemMouseLeave:()=>this.viewModel.selectFeature(null),onItemSelect:e=>this.viewModel.selectFeature(e.data,!0)}))))}_isPanelActive(e){return this.viewModel.state===e}_renderSettings(){const e=this.visibleElements,t=e.snappingControls,s=e.sketchTooltipControls;return t||s?T("calcite-accordion",{key:"settings",class:D.settingsContainer,appearance:"transparent"},T("calcite-accordion-item",{heading:this.messagesCommon?.settings,iconStart:"gear"},s&&T(E,{tooltipOptions:this.tooltipOptions}),t&&T(M,{snappingOptions:this.snappingOptions,view:this.view,visibleElements:e.snappingControlsElements,afterCreate:e=>e.layerListOpen=!1}))):null}_getLabel(e){const t=e.layer;if(!t)return null;const s=t.fieldsIndex.get(t.objectIdField),r=s.alias||s.name,{attributes:o}=e,i=d(t);return i&&o[i]&&`${o[i]}`||`${r}: ${o[s.name]}`}_showPrompt({title:e,message:t,yesLabel:s,noLabel:r}){const o=i(),{view:n}=this,a=n?.focused;return this._prompt={title:e,message:t,context:"danger",actions:{primary:{label:s,action:()=>o.resolve(!0)},secondary:{label:r,action:()=>o.resolve(!1)}}},o.promise.finally((()=>{this._clearPrompt(),a&&n?.focus()}))}_onSave(){this.viewModel.saveWorkflow()}_onDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:e.keepFeature,action:this._clearPrompt}}}}async _onBack(e){return e?.stopPropagation(),this.viewModel.back()}_onAttachmentAdd(){const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.addFile(),e.back()):this._attachments.addAttachment().then((()=>e.back())))}_onAttachmentUpdate(){const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.updateFile(),e.back()):this._attachments.updateAttachment().then((()=>e.back())))}_onAttachmentDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:e.keepAttachment,action:this._clearPrompt}}}}};e([m()],$.prototype,"_featureForm",void 0),e([m()],$.prototype,"_attachments",void 0),e([m()],$.prototype,"_featureTemplates",void 0),e([m()],$.prototype,"_filterText",void 0),e([m()],$.prototype,"_prompt",void 0),e([m()],$.prototype,"_spinner",void 0),e([m()],$.prototype,"_deleteButtonCommonInfo",null),e([m({readOnly:!0})],$.prototype,"activeWorkflow",null),e([m()],$.prototype,"allowedWorkflows",null),e([m()],$.prototype,"useDeprecatedCreateWorkflow",null),e([m()],$.prototype,"headingLevel",void 0),e([m()],$.prototype,"iconClass",void 0),e([m()],$.prototype,"label",null),e([m()],$.prototype,"labelOptions",null),e([m()],$.prototype,"layerInfos",null),e([m(),U("esri/widgets/Editor/t9n/Editor")],$.prototype,"messages",void 0),e([m(),U("esri/t9n/common")],$.prototype,"messagesCommon",void 0),e([m(),U("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],$.prototype,"messagesTemplates",void 0),e([m()],$.prototype,"snappingOptions",null),e([m()],$.prototype,"tooltipOptions",null),e([m()],$.prototype,"supportingWidgetDefaults",void 0),e([m()],$.prototype,"view",null),e([m(),A(["workflow-cancel","workflow-commit"])],$.prototype,"viewModel",void 0),e([m()],$.prototype,"visibleElements",void 0),e([c("visibleElements")],$.prototype,"castVisibleElements",null),e([I()],$.prototype,"_onSave",null),e([I()],$.prototype,"_onDelete",null),e([I()],$.prototype,"_onBack",null),e([I()],$.prototype,"_onAttachmentAdd",null),e([I()],$.prototype,"_onAttachmentUpdate",null),e([I()],$.prototype,"_onAttachmentDelete",null),$=e([u(B)],$);const H=$;export{H as default};
