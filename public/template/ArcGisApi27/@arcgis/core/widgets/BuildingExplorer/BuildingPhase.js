/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as s}from"../../chunks/tslib.es6.js";import{property as e}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/ensureType.js";import"../../chunks/typedArrayUtil.js";import{subclass as t}from"../../core/accessorSupport/decorators/subclass.js";import o,{g as r}from"./BuildingNumericFilterViewModel.js";import{d as i,e as l}from"../../chunks/filterUtils.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../core/lang.js";import"../../chunks/string.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/maybe.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../chunks/tracking.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/collectionUtils.js";import"../../chunks/uuid.js";import"../../chunks/BuildingFilterBlock.js";import"../../core/JSONSupport.js";import"../../chunks/enumeration.js";import"../../chunks/jsonMap.js";import"../../chunks/utils2.js";import"../../symbols/edges/Edges3D.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../chunks/vec4.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";let c=class extends o{constructor(){super(...arguments),this._createdPhaseFieldName=null,this._demolishedPhaseFieldName=null,this._parseValueFromFilter=s=>{const e=this._createdPhaseFieldName,t=new RegExp(`${e}\\s*<=\\s*(\\d+)\\s*OR\\s*${e}\\s*IS\\s*NULL`,"gi"),o=this._demolishedPhaseFieldName,r=new RegExp(`${o}\\s*>\\s*(\\d+)\\s*OR\\s*${o}\\s*IS\\s*NULL`,"gi");for(const{filterExpression:e}of s.filterBlocks?.items??[]){const s=e?t.exec(e)??r.exec(e):null;if(s)return parseInt(s[1],10)}return null}}get filterExpressions(){if(!this.enabled)return{solid:null,xRay:null};const s=[],e=this._createdPhaseFieldName;e&&s.push(`(${e} <= ${this.value} OR ${e} IS NULL)`);const t=this._demolishedPhaseFieldName;t&&s.push(`(${t} > ${this.value} OR ${t} IS NULL)`);const o=s.join(" AND ");return{solid:o,xRay:o}}get _lastValue(){const s=this.allowedValues;return s.length>0?s[s.length-1]:0}_setup(){const s=[];this.layers.forEach((e=>{const t=i(e,"createdphase");null!=t&&(this._createdPhaseFieldName=t.fieldName,s.push(t));const o=i(e,"demolishedphase");null!=o&&(this._demolishedPhaseFieldName=o.fieldName,s.push(o))})),this._domainInfo=r(s);const e=this._valueBeforeReady;if(this._set("state","ready"),this._valueBeforeReady=null,this.allowedValues.length>0){const s=e??l(this.layers,this._parseValueFromFilter);this.select(s??this._lastValue)}else this.clear()}};s([e({readOnly:!0})],c.prototype,"filterExpressions",null),s([e()],c.prototype,"_createdPhaseFieldName",void 0),s([e()],c.prototype,"_demolishedPhaseFieldName",void 0),s([e({readOnly:!0})],c.prototype,"_lastValue",null),c=s([t("esri.widgets.BuildingExplorer.BuildingPhase")],c);const n=c;export{n as default};
