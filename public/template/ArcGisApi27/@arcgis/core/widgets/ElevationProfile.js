/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{c as e}from"../chunks/asyncUtils.js";import{c as i,d as s,r as o,b as n}from"../chunks/maybe.js";import{m as r}from"../chunks/memoize.js";import{o as a,throwIfAborted as l,createAbortError as c}from"../core/promiseUtils.js";import{watch as p,initial as h}from"../core/reactiveUtils.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{L as u}from"../chunks/typedArrayUtil.js";import{subclass as m}from"../core/accessorSupport/decorators/subclass.js";import g from"./Widget.js";import _ from"./ElevationProfile/ElevationProfileViewModel.js";import b from"../core/Accessor.js";import f from"../core/Collection.js";import{substitute as v}from"../intl.js";import{t as k}from"../chunks/throttle.js";import{f as y,e as j,u as C}from"../chunks/unitFormatUtils.js";import{N as x,g as S,E as w,a as P}from"./ElevationProfile/ElevationProfileLine.js";import{e as L,i as E,o as M}from"../chunks/widgetUtils.js";import{m as T}from"../chunks/messageBundle.js";import{t as U}from"../chunks/jsxFactory.js";import{X as B,z as I}from"../chunks/unitUtils.js";import{P as A}from"../chunks/Popover.js";import D from"../core/Error.js";import{h as z,b as F}from"../chunks/utils.js";import{g as O}from"../chunks/locale.js";import{i as V}from"../chunks/themeUtils.js";import{f as $}from"../chunks/number.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/string.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/get.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/messages.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/datetime.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/ByteSizeUnit.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/vec2.js";import"../geometry/projection.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/QueueProcessor.js";import"../chunks/Queue.js";import"../chunks/Scheduler.js";import"../core/signal.js";import"../chunks/debugFlags.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../Ground.js";import"../chunks/compilerUtils.js";import"../chunks/loadAll.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationSamplerData.js";import"../chunks/TileKey.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/vec4f64.js";import"../chunks/ray.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/Intersector2.js";import"../chunks/ViewingMode.js";import"../chunks/boundedPlane.js";import"../chunks/vector.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/mathUtils2.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/mat3.js";import"../chunks/quat.js";import"../chunks/vec3f32.js";import"../chunks/sphere.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/Intersector.js";import"../chunks/Intersector3.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"./Sketch/SketchViewModel.js";import"../chunks/isSupportedGraphic.js";import"../geometry/Circle.js";import"../chunks/layerUtils3.js";import"../chunks/InputManager.js";import"../chunks/PropertiesPool.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SnappingManager.js";import"../chunks/Settings2.js";import"../chunks/LineSnappingHint.js";import"../chunks/EdgeSnappingCandidate.js";import"../chunks/snappingUtils.js";import"../chunks/dehydratedFeatures.js";import"../chunks/byteSizeEstimations.js";import"../chunks/quantizationUtils.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/geometry2dUtils.js";import"../chunks/DrapedEdgeSnappingCandidate.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/viewUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/Cyclical.js";import"../chunks/Material.js";import"../chunks/interfaces2.js";import"../chunks/VertexAttribute.js";import"../chunks/Util2.js";const R="esri-elevation-profile",W={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-elevation-profile",base:`${R}`,portrait:`${R}--portrait`,refined:`${R}--refined`,mainContainer:`${R}__main-container`,promptContainer:`${R}__prompt-container`,header:`${R}__header`,zoomOutButton:`${R}__zoom-out-button esri-icon-zoom-out-magnifying-glass`,clearButton:`${R}__clear-button esri-icon-trash`,actionButton:`${R}__action-button esri-button`,sketchButton:`${R}__sketch-button esri-button--primary`,sketchCancelButton:`${R}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${R}__sketch-done-button esri-button--primary`,selectButton:`${R}__select-button esri-button--secondary`,selectCancelButton:`${R}__select-cancel-button esri-button--secondary`,chartContainer:`${R}__chart-container`,chartSpinner:`${R}__chart-spinner esri-icon-loading-indicator esri-rotating`,chartSpinnerVisible:`${R}__chart-spinner--visible`,chartSpinnerSmall:`${R}__chart-spinner--small`,footer:`${R}__footer`},H="esri-elevation-profile-legend-item",G={base:H,disabled:`${H}--disabled`,expanded:`${H}--expanded`,colorIndicator:`${H}__color-indicator`,header:`${H}__header`,content:`${H}__content`,collapseToggle:`${H}__collapse-toggle esri-button esri-button--tertiary`,collapseToggleIcon:`${H}__collapse-toggle__icon esri-icon-down`,label:`${H}__label`,labelDisabled:`${H}__label--disabled`,checkbox:`${H}__checkbox`},N="esri-elevation-profile-statistics",Y={base:N,statistic:`${N}__statistic`,statisticLabel:`${N}__statistic__label`,statisticValue:`${N}__statistic__value`,slopeValue:`${N}__slope-value`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down"},X="esri-elevation-profile-settings",q={base:`${X} esri-icon-handle-vertical`,popoverContent:`${X}__popover-content`,select:`${X}__select esri-select`,selectLabel:`${X}__select-label`,checkboxLabel:`${X}__checkbox-label`,checkbox:`${X}__checkbox`,uniformChartScalingCheckbox:`${X}__uniform-chart-scaling-checkbox`};let Z=class extends b{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([d()],Z.prototype,"legend",void 0),t([d()],Z.prototype,"chart",void 0),t([d()],Z.prototype,"clearButton",void 0),t([d()],Z.prototype,"settingsButton",void 0),t([d()],Z.prototype,"sketchButton",void 0),t([d()],Z.prototype,"selectButton",void 0),t([d()],Z.prototype,"unitSelector",void 0),t([d()],Z.prototype,"uniformChartScalingToggle",void 0),Z=t([m("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],Z);const Q=Z;let K=class extends g{constructor(t,e){super(t,e),this._updateLayout=t=>{const e=t.parentElement,i=t.style.display;e?.removeChild(t),document.body.appendChild(t),t.style.display="block";let s=80;for(const e of t.childNodes)e instanceof HTMLElement&&(s=Math.max(s,e.offsetWidth));document.body.removeChild(t),e?.appendChild(t),t.style.display=i,t.style.setProperty("--max-width",`${s}px`)},this._updateLayoutThrottled=k(this._updateLayout,100)}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return U("div",{bind:this,class:Y.base,afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const i=S().formatPrecision,s=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return y(this._messagesUnits,t,e,i)}));return this._renderStatistic(e,s)}_renderElevationStatistic(t,e){const i=S().formatPrecision,s=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return y(this._messagesUnits,t,e,i)}));return this._renderStatistic(e,s)}_renderSlopeStatistic(t,e,i){const s=S().formatPrecision,o=U("div",{key:"slope-up",class:Y.slopeValue},U("div",{class:Y.slopeUpIcon}),this._renderValue(t,(t=>j(t,"degrees","geographic","geographic",s))),U("div",{class:Y.slopeDownIcon}),this._renderValue(e,(t=>j(t,"degrees","geographic","geographic",s))));return this._renderStatistic(i,o)}_renderStatistic(t,e){return U("div",{class:Y.statistic},U("label",{class:Y.statisticLabel},t),U("div",{class:Y.statisticValue},e))}_renderValue(t,e){const s=this.line,o=1===s.progress?s.statistics:null,n=i(o,(e=>e[t]));return null!=n?e(n):x}};function J(t,{profiles:e}){const i=t.title;if(null!=i)return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([d()],K.prototype,"effectiveUnits",void 0),t([d()],K.prototype,"line",void 0),t([d(),T("esri/widgets/ElevationProfile/t9n/ElevationProfile")],K.prototype,"_messages",void 0),t([d(),T("esri/core/t9n/Units")],K.prototype,"_messagesUnits",void 0),K=t([m("esri.widgets.ElevationProfile.Statistics")],K);let tt=class extends g{constructor(t,e){super(t,e),this.expanded=!1,this.checkboxVisible=!0,this._messages=null}initialize(){this._statistics=new K(this._statisticsProps),this.addHandles(p((()=>this._statisticsProps),(t=>this._statistics.set(t))))}destroy(){this._statistics=s(this._statistics)}render(){const t=this.expanded;return U("div",{key:this,class:this.classes(G.base,{[G.disabled]:this.disabled,[G.expanded]:t})},this._renderColorIndicator(),U("div",{key:"header",class:G.header},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t&&U("div",{key:"content",class:G.content},this._statistics.render()))}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return U("div",{key:"color-indicator",class:G.colorIndicator,styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const t=this._messages,e=this.expanded?t.hideDetails:t.showDetails;return U("button",{key:"collapse-toggle",bind:this,class:G.collapseToggle,onclick:this._onCollapseToggleClick,title:e,"aria-label":e,type:"button"},U("span",{class:G.collapseToggleIcon}))}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:i}=this,s=`${G.base}__check-${t.id}`;return U("label",{key:"id",for:s,class:this.classes(G.label,{[G.labelDisabled]:i||!e})},e&&this._renderCheckbox(s),U("span",null,J(t,this._messages)))}_renderCheckbox(t){const e=this.line,i=e.visible,s=this.disabled,o=this._messages,n=i?o.hideProfile:o.showProfile,r=J(e,this._messages),a=v(n,{name:r});return U("input",{key:"checkbox",id:t,type:"checkbox",class:G.checkbox,title:a,checked:i,disabled:s,"aria-label":a,bind:this,onchange:t=>this._onCheckboxToggle(t,e)})}_onCheckboxToggle(t,e){t.stopPropagation(),e.toggleVisibility()}};t([d({nonNullable:!0})],tt.prototype,"effectiveUnits",void 0),t([d({nonNullable:!0})],tt.prototype,"line",void 0),t([d()],tt.prototype,"expanded",void 0),t([d()],tt.prototype,"disabled",null),t([d()],tt.prototype,"checkboxVisible",void 0),t([d()],tt.prototype,"onExpandedToggle",void 0),t([d()],tt.prototype,"_statistics",void 0),t([d(),T("esri/widgets/ElevationProfile/t9n/ElevationProfile")],tt.prototype,"_messages",void 0),tt=t([m("esri.widgets.ElevationProfile.LegendItem")],tt);let et=class extends g{constructor(t,e){super(t,e),this._items=new f,this._expandedLine=null}initialize(){this.addHandles([p((()=>this.profiles),(t=>{this._destroyItems(),this._items.addMany(t.map((t=>this._createItemForLine(t))))}),h),p((()=>this.effectiveUnits),(t=>{this._items.forEach((e=>{e.effectiveUnits=t}))}),h)])}destroy(){this._destroyItems()}render(){return U("div",{class:"esri-elevation-profile-legend"},this._items.toArray().map((t=>t.render())))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t,this._items.forEach((t=>t.expanded=t.line===this._expandedLine))}_createItemForLine(t){return new tt({line:t,effectiveUnits:this.effectiveUnits,expanded:t===this._expandedLine,checkboxVisible:this.profiles.length>1,onExpandedToggle:()=>this._onExpandedToggle(t)})}_destroyItems(){this._items.drain((t=>t.destroy()))}};t([d()],et.prototype,"profiles",void 0),t([d()],et.prototype,"effectiveUnits",void 0),t([d()],et.prototype,"_items",void 0),t([d()],et.prototype,"_expandedLine",void 0),et=t([m("esri.widgets.ElevationProfile.Legend")],et);let it=class extends g{constructor(t,e){super(t,e),this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;if(!t&&!e)return U("div",{key:`${this.id}-empty`});const i=null!=this._popover&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return U("button",{class:q.base,title:i,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":i,type:"button"})}_initializePopover(t){this._destroyPopover(),this._buttonElement=t,this._popover=new A({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=o(this._focusOutElement),this._popover=s(this._popover)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return U("div",{class:q.popoverContent,dir:L(this._buttonElement),bind:this,afterCreate:this._onPopoverContentAfterCreate},t&&this._renderUnitSelector(),e&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:t,unitOptions:e}=this.viewModel,i=this._messagesUnits;return U("label",{key:"unit-selector-label",class:q.selectLabel},this._messages.unitSelectLabel,U("select",{class:q.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},e.map((t=>U("option",{key:t,value:t},B(t)?i.systems[t]:i.units[t].pluralCapitalized)))))}_onUnitChange(t){this.viewModel.unit=t.target.value}_onUnitSelectAfterCreate(t){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,t.focus())}_renderUniformChartScalingToggle(){const t=this._messages,e=this.viewModel.uniformChartScaling,i=e?t.uniformChartScalingDisable:t.uniformChartScalingEnable;return U("label",{key:"uniform-chart-scaling-label",class:q.checkboxLabel,onmousedown:st},U("input",{class:this.classes(q.checkbox,q.uniformChartScalingCheckbox),type:"checkbox",checked:e,title:i,"aria-label":i,bind:this,onchange:this._onUniformChartScalingChange}),t.uniformChartScalingLabel)}_onUniformChartScalingChange(t){this.viewModel.uniformChartScaling=t.target.checked}_togglePopover(t){null!=this._popover&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){i(this._popover,(t=>t.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:t=!0}={}){i(this._popover,(t=>t.open=!1)),t&&i(this._buttonElement,(t=>t.focus()))}_onPopoverContentAfterCreate(t){o(this._focusOutElement),this._focusOutElement=a(t,"focusout",(({relatedTarget:e})=>{const i=t.contains(e),s=e===this._buttonElement;i||s||this._closePopover({focusOnButton:!1})}))}};function st(t){t.preventDefault()}function ot(t,e){const i=Math.floor(Math.log10(t)),s=t/10**i;let o;return o=e?s<1.5?1:s<3?2:s<5?2.5:s<7?5:10:s<=1?1:s<=2?2:s<=3?2.5:s<=5?5:10,o*10**i}t([d()],it.prototype,"viewModel",void 0),t([d()],it.prototype,"visibleElements",void 0),t([d(),T("esri/widgets/ElevationProfile/t9n/ElevationProfile")],it.prototype,"_messages",void 0),t([d(),T("esri/core/t9n/Units")],it.prototype,"_messagesUnits",void 0),it=t([m("esri.widgets.ElevationProfile.SettingsButton")],it);const nt="en-us",rt=new Map([["ar",()=>import("../chunks/ar.js").then((t=>t.a))],["bg-bg",()=>import("../chunks/bg_BG.js").then((t=>t.b))],["bs-ba",()=>import("../chunks/bs_BA.js").then((t=>t.b))],["ca-es",()=>import("../chunks/ca_ES.js").then((t=>t.c))],["cs-cz",()=>import("../chunks/cs_CZ.js").then((t=>t.c))],["da-dk",()=>import("../chunks/da_DK.js").then((t=>t.d))],["de-de",()=>import("../chunks/de_DE.js").then((t=>t.d))],["de-ch",()=>import("../chunks/de_CH.js").then((t=>t.d))],["el-gr",()=>import("../chunks/el_GR.js").then((t=>t.e))],["en-us",()=>import("../chunks/en_US.js").then((t=>t.e))],["en-ca",()=>import("../chunks/en_CA.js").then((t=>t.e))],["es-es",()=>import("../chunks/es_ES.js").then((t=>t.e))],["et-ee",()=>import("../chunks/et_EE.js").then((t=>t.e))],["fi-fi",()=>import("../chunks/fi_FI.js").then((t=>t.f))],["fr-fr",()=>import("../chunks/fr_FR.js").then((t=>t.f))],["he-il",()=>import("../chunks/he_IL.js").then((t=>t.h))],["hr-hr",()=>import("../chunks/hr_HR.js").then((t=>t.h))],["hu-hu",()=>import("../chunks/hu_HU.js").then((t=>t.h))],["id-id",()=>import("../chunks/id_ID.js").then((t=>t.i))],["it-it",()=>import("../chunks/it_IT.js").then((t=>t.i))],["ja-jp",()=>import("../chunks/ja_JP.js").then((t=>t.j))],["ko-kr",()=>import("../chunks/ko_KR.js").then((t=>t.k))],["lt-lt",()=>import("../chunks/lt_LT.js").then((t=>t.l))],["lv-lv",()=>import("../chunks/lv_LV.js").then((t=>t.l))],["nb-no",()=>import("../chunks/nb_NO.js").then((t=>t.n))],["nl-nl",()=>import("../chunks/nl_NL.js").then((t=>t.n))],["pl-pl",()=>import("../chunks/pl_PL.js").then((t=>t.p))],["pt-br",()=>import("../chunks/pt_BR.js").then((t=>t.p))],["pt-pt",()=>import("../chunks/pt_PT.js").then((t=>t.p))],["ro-ro",()=>import("../chunks/ro_RO.js").then((t=>t.r))],["ru-ru",()=>import("../chunks/ru_RU.js").then((t=>t.r))],["sk-sk",()=>import("../chunks/sk_SK.js").then((t=>t.s))],["sl-sl",()=>import("../chunks/sl_SL.js").then((t=>t.s))],["sr-rs",()=>import("../chunks/sr_RS.js").then((t=>t.s))],["sv-se",()=>import("../chunks/sv_SE.js").then((t=>t.s))],["th-th",()=>import("../chunks/th_TH.js").then((t=>t.t))],["tr-tr",()=>import("../chunks/tr_TR.js").then((t=>t.t))],["uk-ua",()=>import("../chunks/uk_UA.js").then((t=>t.u))],["vi-vn",()=>import("../chunks/vi_VN.js").then((t=>t.v))],["zh-cn",()=>import("../chunks/zh_Hans.js").then((t=>t.z))],["zh-hk",()=>import("../chunks/zh_Hant.js").then((t=>t.z))],["zh-tw",()=>import("../chunks/zh_Hant.js").then((t=>t.z))]]);let at=null,lt=null;const ct="#f8f8f8",pt="#a9a9a9",ht="#323232",dt="line",ut="fill",mt=30,gt=.5,_t={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:pt,axisTooltipFontSize:12,axisTooltipBackgroundColor:ht,axisTooltipLabelColor:ct,axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:ct,seriesTooltipLabelColor:ht,seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:Math.round(3.75),seriesTooltipPaddingHorizontal:Math.round(3.75),tooltipBorderRadius:0},bt={..._t,axisGridStroke:ht,axisLabelsColor:pt,axisTooltipBackgroundColor:ht,axisTooltipLabelColor:ct,seriesTooltipBackgroundColor:ht,seriesTooltipLabelColor:ct,seriesFillLighten:-.75},ft={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function vt({data:t,bounds:e,pixelWidth:i,pixelHeight:s,centered:o}){if(null==t)return e;let{minX:n,maxX:r,minY:a,maxY:l}=e;if(null==n||null==r||null==a||null==l)return ft;const c=r-n,p=l-a,h=t.effectiveUnits,d=I(p,h.elevation,h.distance)/s/(c/i);return d>=1?[n,r]=kt([n,r],d,o):[a,l]=kt([a,l],1/d,o),{minX:n,maxX:r,minY:a,maxY:l}}function kt([t,e],i,s){const o=(e-t)*i;if(s){const i=(t+e)/2-o/2;return[i,i+o]}return[t,t+o]}function yt(t,{line:e,fill:s},o){const{theme:n}=t,{am4core:r}=t.amCharts4Index,{r:a,g:l,b:c,a:p}=o.color,h=r.color({r:a,g:l,b:c,a:p}),d=o.samples??new Array,u=d.length>0;e.stroke=h,e.visible=u,i(s,(t=>{t.visible=u,t.fill=h.lighten(n.seriesFillLighten)}));const m=d.length,g=e.data;if(g.length===m){let t=!1;for(let e=0;e<m;++e){const i=g[e],s=d[e];t=t||null!=i.elevation!=(null!=s.elevation),b=s,(_=i).x=b.x,_.y=b.y,_.z=b.z,_.distance=b.distance,_.elevation=b.elevation}t?(e.invalidateData(),i(s,(t=>t.invalidateData()))):(e.invalidateRawData(),i(s,(t=>t.invalidateRawData())))}else e.data=d,i(s,(t=>t.data=d));var _,b}function jt(t,e){const{id:i}=e,s=Ct(t,`${dt}-${i}`);s.strokeWidth=e.chartStrokeWidth,s.dy=e.chartStrokeOffsetY;let o=null;return e.chartFillEnabled&&(o=Ct(t,`${ut}-${i}`),o.fillOpacity=1),{id:i,line:s,fill:o}}function Ct(t,e){const i=new t.amCharts4Index.am4charts.LineSeries;return i.id=e,i.showOnInit=!1,i.simplifiedProcessing=!0,i.minDistance=gt,i.excludeFromTotal=!0,i.clickable=!1,i.contextMenuDisabled=!0,i.cursorHoverEnabled=!1,i.cursorTooltipEnabled=!1,i.connect=!1,i.fill=null,i.stroke=null,i.dataFields.valueX="distance",i.dataFields.valueY="elevation",i}function xt(t,e){const{amChart:i,xAxis:s,yAxis:o}=t;let n=!1;const r=()=>{const{data:e}=t;if(!n||null==e||!e.uniformScaling)return;n=!1;const{minX:r,maxX:a,minY:l,maxY:c}=vt({data:t.data,bounds:{minX:s.minZoomed,maxX:s.maxZoomed,minY:o.minZoomed,maxY:o.maxZoomed},pixelWidth:s.pixelWidth,pixelHeight:o.pixelHeight,centered:!0});null!=r&&null!=a&&s.zoomToValues(r,a,!0),null!=l&&null!=c&&o.zoomToValues(l,c,!0),i.validate(),Lt(t)},a=()=>{e(t.xAxis.zoomFactor,t.yAxis.zoomFactor)},l=e=>{t.zooming=e,Lt(t)},c=[i.events.on("down",(()=>l(!0))),i.events.on("up",(()=>l(!1))),i.cursor.events.on("zoomended",(()=>{n=!0})),s.events.on("startendchanged",r),o.events.on("startendchanged",r),s.events.on("rangechangeended",a),o.events.on("rangechangeended",a)];return F((()=>{c.forEach((t=>t.dispose()))}))}function St({xAxis:t,yAxis:e}){const i=t=>()=>{t.renderer.grid.each((t=>{t.visible="none"!==t.dataItem.label.dom.getAttribute("display")}))},s=[t.events.on("rangechangeended",i(t)),t.events.on("validated",i(t)),e.events.on("rangechangeended",i(e)),e.events.on("validated",i(e))];return F((()=>{s.forEach((t=>t.dispose()))}))}function wt(t,e){const{amChart:i,xAxis:s,yAxis:o}=t,{cursor:n,events:r}=i,a=e=>{t.pointerIsOver=e,Lt(t)},l=()=>{a(!1),e(null,null)},c=[n.events.on("cursorpositionchanged",(()=>{if(!t.pointerIsOver)return;Lt(t);let i=s.toAxisPosition(n.xPosition),r=o.toAxisPosition(n.yPosition);const a=t.data;if(null!=a&&null!=a.statistics){const{maxDistance:t,minElevation:e,maxElevation:n}=a.statistics;null!=t&&(i=Pt(i,s.minZoomed,s.maxZoomed,0,t)),null!=e&&null!=n&&(r=Pt(r,o.minZoomed,o.maxZoomed,e,n))}e(i,r)})),r.on("over",(()=>a(!0))),r.on("out",l),r.on("blur",l)];return F((()=>{c.forEach((t=>t.dispose()))}))}function Pt(t,e,i,s,o){return(e+t*(i-e)-s)/(o-s)}function Lt(t){const{amChart:e,xAxis:s,data:o,theme:n,zooming:r,pointerIsOver:a}=t;if(t.amChart.tooltip.hide(),t.xAxis.hideTooltip(),!a)return;if(r)return;if(null==o||!o.refined)return;const l=function(t){const{amChart:e,yAxis:s,data:o}=t;if(null==o)return null;const n=o.lines.map((e=>({line:e,y:i(Tt(t,e),(t=>t.elevation))}))).sort(Et),r=n.length?n[0].y:null;if(null==r)return null;const a=e.cursor,l=s.measuredHeight,c=l+e.pixelPaddingTop;return{text:n.map((({y:e,line:i})=>function(t,e,i){const{data:s,messages:o}=t;if(null==s||null==o)return"";const n=S().formatPrecision,r=v(o.chartTooltip,{name:J(e,o),elevation:null!=i?y(o,i,s.effectiveUnits.elevation,n):x});return`[${e.color.toHex()}]‚óè[/] ${r}`}(t,i,e))).join("\n"),x:a.point.x+a.parent.pixelX+e.pixelPaddingLeft,y:c-s.valueToPosition(r)*l}}(t);if(null!=l){const{cursor:i}=e,o=e.tooltip;i.show(0),i.validate(),o.text=l.text,o.show(0),o.validate();const r=l.y-o.contentHeight-n.seriesTooltipSpacing;o.pointerOrientation=r<mt?"up":"down",o.pointTo(l,!0),o.validate();const a=s.tooltip;a.text=function(t){const{data:e,messages:i}=t;if(null==e||null==i)return"";const s=e.lines[0],o=s?Tt(t,s):null,n=S().formatPrecision;return null!=o?y(i,o.distance,e.effectiveUnits.distance,n):"-"}(t),a.show(0),a.validate()}}function Et({y:t},{y:e}){return null==t?1:null==e?-1:e-t}function Mt(t,e){const i=t.xAxis.numberFormatter.clone();return i.format=(i,s,o)=>{const{messages:n,data:r}=t;return null==n||null==r||"string"==typeof i?"":`${$(i,{maximumFractionDigits:o})} ${C(n,r.effectiveUnits[e],"abbr")}`},i}function Tt({amChart:t,xAxis:e},i){const s=i.samples??[];if(0===s.length)return null;const o=e.toAxisPosition(t.cursor.xPosition),n=e.positionToValue(o);return u(s,n,(t=>t.distance))}var Ut;!function(t){t.Sketch="sketch",t.SketchCancel="sketch-cancel",t.SketchDone="sketch-done",t.Select="select",t.SelectCancel="select-cancel"}(Ut||(Ut={}));const Bt=[{type:Ut.Select},{type:Ut.Sketch}],It={[w.None]:null,[w.NoValidInput]:"noProfile",[w.NoVisibleProfiles]:"noProfile",[w.RefinedButNoChartData]:"noProfile",[w.TooComplex]:"tooComplex",[w.UnknownError]:"unknown",[w.InvalidGeometry]:"invalidGeometry",[w.InvalidElevationInfo]:"invalidElevationInfo"},At=Symbol("resize-observer-handle");let Dt=class extends g{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new Q,this.iconClass=W.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._width=0,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=r(((t,e,i,s)=>({chart:t,data:e,stationary:i,messages:s}))),this._getDetailsPropsMemoized=r(((t,e)=>({effectiveUnits:t,profiles:e}))),t?.viewModel||(this._defaultViewModel=new _({view:t?.view}),this.viewModel=this._defaultViewModel)}initialize(){this._legend=new et(this._legendProps),this._settingsButton=new it(this._settingsButtonProps),this.addHandles([p((()=>this._legendProps),(t=>this._legend.set(t))),p((()=>this._settingsButtonProps),(t=>this._settingsButton.set(t)))])}postInitialize(){this.addHandles([p((()=>({container:this._chartContainer,width:this._width})),(({container:t,width:e})=>{this._destroyChart(),null!=t&&e>0&&this._initializeChart(t)}),h),p((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),h)])}destroy(){this._destroyChart(),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._legend=s(this._legend),this._settingsButton=s(this._settingsButton)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get geodesicDistanceThreshold(){return this.viewModel.geodesicDistanceThreshold}set geodesicDistanceThreshold(t){this.viewModel.geodesicDistanceThreshold=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get _portrait(){return this._width<S().portraitModePixelBreakpoint}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,null==t||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _legendProps(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}get _profilesArray(){return this.profiles.toArray()}get _settingsButtonProps(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}render(){const{viewModel:t,visible:e}=this;return U("div",{key:this,class:this.classes({[W.base]:e,[W.esriWidget]:e,[W.esriWidgetDisabled]:e&&"disabled"===t.state,[W.portrait]:this._portrait,[W.refined]:1===t.progress}),"aria-label":this.messages.widgetLabel},U("div",{key:"content-wrapper",bind:this,afterCreate:this._onContentWrapperAfterCreate,afterRemoved:this._onContentWrapperRemoved},e&&this._renderContentForState()))}_renderContentForState(){switch(this.viewModel.state){case P.Ready:return this._renderContentForReadyState();case P.Selecting:return this._renderContentForSelectingState();case P.Creating:return this._renderContentForCreatingState();case P.Selected:return this._renderContentForSelectedState();case P.Created:return this._renderContentForCreatedState();case P.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{sketchButton:t,selectButton:e}=this.visibleElements,i=this.messages;let s;return s=t&&e?i.readyPrompt:t?i.readyPromptCreateOnly:e?i.readyPromptSelectOnly:i.errors?.noProfile,this._renderContent({prompt:s,chart:!1,actions:Bt})}_renderContentForSelectingState(){const t=this.view;if(null==t)return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:Ut.SelectCancel}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(null==t)return null;const i=e.hasVertices?[{type:Ut.SketchCancel},{type:Ut.SketchDone,disabled:!e.tool.interaction.canStopCreating}]:[{type:Ut.Select},{type:Ut.Sketch,disabled:!0}];if(e.errorState===w.NoValidInput){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:i,prompt:e})}const s=this._getErrorMessage();return s?this._renderContent({chart:!1,actions:i,prompt:s}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Bt,prompt:t}):this._renderContent({chart:!0,actions:Bt})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Bt,prompt:t}):this._renderContent({chart:!0,actions:Bt})}_getErrorMessage(){const t=It[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=null!=t.prompt?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),i=null!=this.viewModel.input;return[U("header",{key:"header",class:W.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&i&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),U("div",{class:W.mainContainer},e),this.visibleElements.legend&&this._legend.render(),this._renderActions(t)]}_renderZoomOutButton(){return U("button",{key:"zoom-out",class:W.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})}_onZoomOutButtonClick(){i(this._chart,(t=>t.zoomOut()))}_renderClearButton(){return U("button",{key:"clear-profile",class:W.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})}_onClearButtonClick(){this.viewModel.clear()}_renderPrompt(t){return[U("div",{key:"prompt-container",bind:this,class:W.promptContainer},U("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return[U("div",{key:"empty-chart-container",class:W.chartContainer})];const t=this._chartIsRefined||this._canRenderChart();if(!t)return[this._renderSpinner({size:"large"}),U("div",{key:"chart-container-empty",class:W.chartContainer})];const{chartData:e,progress:i}=this.viewModel;return[null!=e&&i>0&&i<1&&this._renderSpinner({size:t?"small":"large"}),U("div",{key:"chart-container",bind:this,class:W.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]}_renderSpinner(t){return U("div",{key:"spinner",class:this.classes(W.chartSpinner,{[W.chartSpinnerSmall]:"small"===t.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})}_onSpinnerAfterCreate(t){requestAnimationFrame((()=>t.classList.add(W.chartSpinnerVisible)))}_onSpinnerExit(t,e){t.classList.remove(W.chartSpinnerVisible),setTimeout(e,200)}_canRenderChart(){const t=this.viewModel.chartData;if(null==t)return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:i}of t.lines)e+=null!=i?i.length:0;return t.refined||e<=S().largeChartSamples}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case Ut.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onSketchButtonClick,className:W.sketchButton,label:this.messages.sketchButtonLabel});case Ut.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:W.sketchCancelButton,label:this.messagesCommon.cancel});case Ut.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:W.sketchDoneButton,label:this.messagesCommon.done});case Ut.Select:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:W.selectButton,label:this.messages.selectButtonLabel});case Ut.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:W.selectCancelButton,label:this.messagesCommon.cancel})}})).filter(Boolean);return e.length?U("footer",{key:"footer",class:W.footer},e):null}_renderAction({action:t,onClick:e,className:i,label:s}){return U("button",{key:`action-${t.type}`,class:this.classes(W.actionButton,i,{[W.buttonDisabled]:!!t.disabled}),bind:this,disabled:t.disabled,onclick:e,type:"button"},s)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_onContentWrapperAfterCreate(t){const e=M(t,(t=>{this._width=t.contentRect.width}));this.addHandles(e,At)}_onContentWrapperRemoved(){this.removeHandles(At)}_updateChart(t){const{data:e,chart:i,messages:s,stationary:o}=t;null!=i&&null!=s&&o&&this._canRenderChart()&&(i.update(t),this._chartIsRefined=null!=e&&e.refined)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(t){n(this._chartInitTask),this._chartInitTask=e((async e=>{const o=await async function(t){const e=await async function(t=O()){if(t=function(t){return t?rt.has(t.toLowerCase())?t.toLowerCase():function(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const t of rt.keys())if(t.startsWith(e)){i=t;break}return i}(t)||nt:nt}(t),at&&t===lt)return at;at=import("../chunks/index2.js").then((t=>t.i)),lt=t;try{const[e,i]=await Promise.all([at,rt.get(lt)()]);lt===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return at=null,lt=null,null}return at}();if(!e)throw new D("elevation-profile:load-failed","Could not load amCharts");const{am4core:s,am4charts:o}=e;l(t.abortOptions);const{options:n}=s;n.minPolylineStep=.5,n.autoSetClassName=!0,n.animationsEnabled=!1;const r=V(),a=r?bt:_t;r&&s.useTheme(e.am4themes_dark);const c=s.create(t.container,o.XYChart);c.arrangeTooltips=!1,c.preloader.disabled=!0,c.zoomOutButton.disabled=!0;const p=E(t.container);c.rtl=p,c.padding(a.paddingTop,p?a.paddingLeft:a.paddingRight,a.paddingBottom,p?a.paddingRight:a.paddingLeft);const h=c.plotContainer.background;h.strokeWidth=0,h.strokeOpacity=0,h.stroke=null;const d=c.xAxes.push(new o.ValueAxis),u=c.yAxes.push(new o.ValueAxis),m={params:t,amCharts4Index:e,amChart:c,xAxis:d,yAxis:u,series:new Map,data:null,messages:null,theme:a,zooming:!1,pointerIsOver:!1};c.cursor=function(t){const e=new t.amCharts4Index.am4charts.XYCursor;return e.trackable=!0,e.lineY.disabled=!0,e.behavior="zoomXY",e}(m),function(t){const e=t.theme,i=t.amChart.tooltip,{am4core:s}=t.amCharts4Index;i.id="series-tooltip",i.fitPointerToBounds=!0,i.pointerOrientation="vertical",i.zIndex=-1,i.getFillFromObject=!1,i.label.fontSize=e.seriesTooltipFontSize,i.label.fill=s.color(e.seriesTooltipLabelColor),i.label.padding(e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal,e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal),i.background.cornerRadius=e.tooltipBorderRadius,i.background.stroke=null,i.background.fill=s.color(e.seriesTooltipBackgroundColor),i.background.padding(0,0,0,0),i.adapter.add("dy",(()=>e.seriesTooltipSpacing*(i.background.pointerY<=0?1:-1))),E(t.params.container)&&(i.label.textAlign="middle")}(m),function(t){const{xAxis:e,theme:i}=t,{am4core:s}=t.amCharts4Index;e.numberFormatter=Mt(t,"distance"),e.strictMinMax=!0,e.cursorTooltipEnabled=!1,e.title.visible=!1;const o=e.renderer;o.line.visible=!1,o.minGridDistance=i.xAxisMinGridDistance,o.minLabelPosition=i.xAxisMinLabelPosition,o.maxLabelPosition=i.xAxisMaxLabelPosition,o.fontWeight=i.axisFontWeight,o.fontSize=i.axisFontSize,o.baseGrid.disabled=!0;const n=o.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=s.color(i.axisLabelsColor),n.paddingTop=i.xAxisLabelsSpacing,n.horizontalCenter="left",n.paddingLeft=0;const r=e.tooltip;r.id="axis-tooltip",r.background.fill=s.color(i.axisTooltipBackgroundColor),r.background.stroke=null,r.background.padding(0,0,0,0),r.label.fontSize=i.axisTooltipFontSize,r.label.fill=s.color(i.axisTooltipLabelColor),r.label.padding(i.axisTooltipPaddingTop,i.axisTooltipPaddingHorizontal,i.axisTooltipPaddingBottom,i.axisTooltipPaddingHorizontal);const a=o.grid.template;a.strokeOpacity=1,a.stroke=s.color(i.axisGridStroke)}(m),function(t){const{yAxis:e,theme:i}=t,{am4core:s}=t.amCharts4Index;e.numberFormatter=Mt(t,"elevation"),e.title.visible=!1,e.cursorTooltipEnabled=!1,e.strictMinMax=!0,e.baseValue=S().noDataValue;const o=e.renderer;o.inside=!0,o.line.opacity=0,o.line.visible=!1,o.minGridDistance=i.yAxisMinGridDistance,o.minLabelPosition=i.yAxisMinLabelPosition,o.maxLabelPosition=i.yAxisMaxLabelPosition,o.fontWeight=i.axisFontWeight,o.fontSize=i.axisFontSize,o.baseGrid.disabled=!0;const n=o.labels.template;n.fontSize=i.axisLabelsFontSize,n.fontWeight=i.axisLabelsFontWeight,n.fill=s.color(i.axisLabelsColor),n.verticalCenter="bottom",n.paddingLeft=i.yAxisLabelSpacing,n.paddingBottom=0;const r=o.grid.template;r.strokeOpacity=1,r.stroke=s.color(i.axisGridStroke),E(t.params.container)&&(o.opposite=!0,n.textAlign="middle",n.paddingLeft=0,n.paddingRight=i.yAxisLabelSpacing)}(m);const g=[xt(m,t.onRangeChange),wt(m,t.onCursorPositionChange),St(m)];let _=null,b=!1;const f=()=>{null!=_&&("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(_):clearTimeout(_),_=null)};return{...m,destroy(){b=!0,f(),z(g).remove(),c.dispose()},update(t){if(t.data===m.data&&t.messages===m.messages)return;if(f(),b)return;const e=()=>{b||(_=null,function(t,{data:e,messages:s}){const{htmlContainer:o}=t.amChart;if(!o)return;const n=null!=e&&e.refined;t.amChart.cursor.disabled=!n,o.classList.toggle("amcharts-cursor--enabled",n);const r=t.data!==e,a=i(t.data,(t=>t.effectiveUnits))!==i(e,(t=>t.effectiveUnits));t.data=e,t.messages=s,r&&(function(t){const{xAxis:e,yAxis:s}=t,{minX:o,maxX:n,minY:r,maxY:a}=function({data:t,pixelWidth:e,pixelHeight:s}){if(null==t)return ft;const o=t.statistics,n=i(o,(t=>t.maxDistance));let r=i(o,(t=>t.minElevation)),a=i(o,(t=>t.maxElevation));if(null==n||null==r||null==a)return ft;const l=Math.max(n-0,.001);let c=Math.max(a-r,.001);const p=t.effectiveUnits;if(t.dynamicElevationRange){const t=I(l,p.distance,p.elevation);c=Math.max(c,t/S().maxChartRatio)}return r-=.02*c,a=r+c+.02*c,[r,a]=function(t,e,i=10){const s=ot(e-t,!1);if(0===s)return[t,e];const o=ot(s/(i-1),!0);return[Math.floor(t/o)*o,Math.ceil(e/o)*o]}(r,a,10),c=a-r,t.uniformScaling?vt({data:t,bounds:{minX:0,maxX:n,minY:r,maxY:a},pixelWidth:e,pixelHeight:s,centered:!0}):{minX:0,maxX:0+l,minY:r,maxY:r+c}}({data:t.data,pixelWidth:e.pixelWidth,pixelHeight:s.pixelHeight});e.min=o,e.max=n,s.min=r,s.max=a}(t),function(t){const{amChart:e,data:s}=t;if(null==s||0===s.lines.length)return void e.series.clear();const o=new Map,n=new Set(e.series.values),r=s.lines.length;for(let a=0;a<r;a++){const l=s.lines[a];let c=t.series.get(l.id);c?(i(c.fill,(t=>n.delete(t))),n.delete(c.line)):(c=jt(t,l),i(c.fill,(t=>e.series.push(t))),e.series.push(c.line)),o.set(c.id,c);const p=r-a-1;i(c.fill,(t=>t.zIndex=p)),c.line.zIndex=r+p,yt(t,c,l)}t.series=o;for(const t of n)e.series.removeValue(t)}(t)),a&&(t.yAxis.invalidateLabels(),t.xAxis.invalidateLabels()),Lt(t)}(m,t))};_="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(e,{timeout:30}):setTimeout(e,30)},zoomOut(){b||(m.yAxis.zoom({start:0,end:1},!1,!0),m.xAxis.zoom({start:0,end:1},!1,!0))}}}({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}});if(e.aborted)throw s(o),c();this._chart=o,this._updateChart(this._chartUpdateParams)}))}_destroyChart(){this._chartInitTask=n(this._chartInitTask),this._chart=s(this._chart),this._chartIsRefined=!1}get test(){return{chart:this._chart}}};t([d({type:_})],Dt.prototype,"viewModel",void 0),t([d()],Dt.prototype,"view",null),t([d()],Dt.prototype,"input",null),t([d()],Dt.prototype,"profiles",null),t([d()],Dt.prototype,"unitOptions",null),t([d()],Dt.prototype,"unit",null),t([d()],Dt.prototype,"geodesicDistanceThreshold",null),t([d({type:Q,nonNullable:!0})],Dt.prototype,"visibleElements",void 0),t([d()],Dt.prototype,"iconClass",void 0),t([d()],Dt.prototype,"icon",void 0),t([d()],Dt.prototype,"label",null),t([d()],Dt.prototype,"visible",null),t([d(),T("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Dt.prototype,"messages",void 0),t([d(),T("esri/t9n/common")],Dt.prototype,"messagesCommon",void 0),t([d(),T("esri/core/t9n/Units")],Dt.prototype,"messagesUnits",void 0),t([d()],Dt.prototype,"_chartContainer",void 0),t([d()],Dt.prototype,"_chart",void 0),t([d()],Dt.prototype,"_chartInitTask",void 0),t([d()],Dt.prototype,"_chartIsRefined",void 0),t([d()],Dt.prototype,"_settingsButton",void 0),t([d()],Dt.prototype,"_legend",void 0),t([d()],Dt.prototype,"_width",void 0),t([d()],Dt.prototype,"_portrait",null),t([d()],Dt.prototype,"_zoomOutButtonVisible",void 0),t([d()],Dt.prototype,"_chartUpdateParams",null),t([d()],Dt.prototype,"_chartMessages",null),t([d()],Dt.prototype,"_legendProps",null),t([d()],Dt.prototype,"_profilesArray",null),t([d()],Dt.prototype,"_settingsButtonProps",null),Dt=t([m("esri.widgets.ElevationProfile")],Dt);const zt=Dt;export{zt as default};
