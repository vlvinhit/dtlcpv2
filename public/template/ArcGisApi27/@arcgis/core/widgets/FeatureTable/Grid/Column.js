/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import e from"../../../core/Evented.js";import{HandleOwnerMixin as o}from"../../../core/HandleOwner.js";import{watch as s}from"../../../core/reactiveUtils.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import"../../../chunks/ensureType.js";import"../../../chunks/typedArrayUtil.js";import{subclass as r}from"../../../core/accessorSupport/decorators/subclass.js";import n from"./support/ButtonMenu.js";import{r as c}from"../../../chunks/widgetUtils.js";import"../../../core/Accessor.js";import"../../../core/Handles.js";import"../../../chunks/maybe.js";import"../../../chunks/get.js";import"../../../chunks/utils.js";import"../../../core/lang.js";import"../../../chunks/metadata.js";import"../../../chunks/Logger.js";import"../../../config.js";import"../../../chunks/object.js";import"../../../chunks/string.js";import"../../../chunks/ObjectPool.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../chunks/watch.js";import"../../../chunks/ArrayPool.js";import"../../../core/scheduling.js";import"../../../chunks/nextTick.js";import"../../../chunks/PooledArray.js";import"../../../core/promiseUtils.js";import"../../../core/Error.js";import"../../../chunks/WatchUpdatingTracking.js";import"../../Widget.js";import"../../../intl.js";import"../../../chunks/date.js";import"../../../chunks/jsonMap.js";import"../../../chunks/locale.js";import"../../../chunks/datetime.js";import"../../../chunks/number.js";import"../../../chunks/messages.js";import"../../../request.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../chunks/assets.js";import"../../../chunks/domUtils.js";import"../../../core/Promise.js";import"../../../chunks/uuid.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../chunks/projector.js";import"../../../chunks/dom.js";import"../../../chunks/guid.js";import"../../../chunks/index.js";import"../../../chunks/jsxWidgetSupport.js";import"./support/ButtonMenuViewModel.js";import"./support/ButtonMenuItem.js";import"../../../chunks/Popover.js";import"../../../chunks/jsxFactory.js";const l="esri-column",a={sortAscIcon:"esri-icon-arrow-up",sortDescIcon:"esri-icon-arrow-down",menuContainer:`${l}__menu-container`,menuIcon:"esri-icon-handle-horizontal",sorter:`${l}__sorter`,headerContent:`${l}__header-content`,headerLabel:`${l}__header-label`};let h=class extends(o(e.EventedAccessor)){constructor(t){super(t),this._menuContainer=document.createElement("div"),this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:t})=>c.sanitize(t),this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.grid=null,this.header=null,this.headerRenderFunction=t=>{const{root:e}=t;if(this.removeCellContent(e),e.classList.add(a.headerContent),this.sortable)this.headerSorterRenderFunction(t);else{const t=document.createElement("div");t.classList.add(a.headerLabel),t.textContent=this.label,e.appendChild(t)}this.headerMenuEnabled&&this.headerMenuRenderFunction(t)},this.headerMenuRenderFunction=({root:t})=>{this.menu?.items?.length&&t.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:t})=>{const{label:e,sortElement:o}=this;if(!o)return void(t.textContent=e);o.textContent!==e&&o.setAttribute("textContent",e),t.appendChild(o);const s=this.grid?.getSlotElementByName(t.slot),i=s?.parentElement;i&&!i.onkeydown&&(i.onkeydown=({key:t})=>{"Enter"!==t&&"Spacebar"!==t||o.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.initialSortPriority=null,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.path=null,this.renderFunction=({root:t,column:e,rowData:o})=>{const s=this.getCellValue(e,o),i=this.cellValueFormatFunction({column:e,rowData:o,value:s});t.innerHTML!==i&&(t.innerHTML=i)},this.resizable=!0,this.sortable=!0,this.textAlign="start",this.width=200}initialize(){const{messages:t,path:e}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",e??""),this._menuContainer.classList.add(a.menuContainer),this.menu=new n({label:t?.options,iconClass:a.menuIcon,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add(s((()=>this.hidden),(()=>this.menu?.set("open",!1))),s((()=>this.path),(t=>{this.sortElement&&this.sortElement.path!==t&&this.sortElement.setAttribute("path",t??"")})))}destroy(){this.menu?.destroy()}set direction(t){this.sortable&&(this.sortElement&&(t?this.sortElement.direction!==t&&this.sortElement.setAttribute("direction",t):this.sortElement.removeAttribute("direction")),this._set("direction",t))}get direction(){return this._get("direction")||null}get label(){return c.sanitize(this.header??this.path??"")}getMenuItems(){const{menuConfig:t,sortable:e}=this,o=t?.items,s=this.getSortMenuItems(),i=[];return e&&i.push(...s),o?.length&&i.push(...o),i.length?i:null}getSortMenuItems(){const{messages:t}=this;return[{selected:"asc"===this.direction,iconClass:a.sortAscIcon,label:t?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:a.sortDescIcon,label:t?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(t,e){return e?.item[t?.path]??""}createSortElement(){const{direction:t,label:e,path:o,initialSortPriority:s}=this,i=document.createElement("vaadin-grid-sorter");return i.classList.add(a.sorter),i.setAttribute("path",o??""),i.setAttribute("title",e),i.textContent=e,t&&i.setAttribute("direction",t),null!=s&&(i._initialOrder=s),i.addEventListener("direction-changed",(()=>{this.direction!==i.direction&&this._set("direction",i.direction)})),i}removeCellContent(t){if(t)for(;t.firstChild;)try{t.removeChild(t.firstChild)}catch(t){}}};t([i()],h.prototype,"activeRowIndex",void 0),t([i()],h.prototype,"autoWidth",void 0),t([i()],h.prototype,"cellValueFormatFunction",void 0),t([i()],h.prototype,"direction",null),t([i()],h.prototype,"flexGrow",void 0),t([i()],h.prototype,"footerRenderFunction",void 0),t([i()],h.prototype,"frozen",void 0),t([i()],h.prototype,"grid",void 0),t([i()],h.prototype,"header",void 0),t([i()],h.prototype,"headerRenderFunction",void 0),t([i()],h.prototype,"headerMenuRenderFunction",void 0),t([i()],h.prototype,"headerSorterRenderFunction",void 0),t([i()],h.prototype,"hidden",void 0),t([i()],h.prototype,"headerMenuEnabled",void 0),t([i({constructOnly:!0})],h.prototype,"initialSortPriority",void 0),t([i({readOnly:!0})],h.prototype,"label",null),t([i()],h.prototype,"menu",void 0),t([i()],h.prototype,"menuConfig",void 0),t([i()],h.prototype,"messages",void 0),t([i()],h.prototype,"messagesCommon",void 0),t([i()],h.prototype,"messagesURIUtils",void 0),t([i()],h.prototype,"path",void 0),t([i()],h.prototype,"renderFunction",void 0),t([i()],h.prototype,"resizable",void 0),t([i()],h.prototype,"sortable",void 0),t([i({readOnly:!0})],h.prototype,"sortElement",void 0),t([i()],h.prototype,"textAlign",void 0),t([i()],h.prototype,"width",void 0),h=t([r("esri.widgets.FeatureTable.Grid.Column")],h);const d=h;export{d as default};
