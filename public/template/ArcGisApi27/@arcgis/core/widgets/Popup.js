/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import o from"../core/Collection.js";import{d as i}from"../chunks/deprecate.js";import{e as s}from"../core/promiseUtils.js";import n from"../core/Handles.js";import{L as r}from"../chunks/Logger.js";import{watch as l,when as a,on as u,whenOnce as c,initial as p}from"../core/reactiveUtils.js";import{t as d}from"../chunks/throttle.js";import{property as h}from"../core/accessorSupport/decorators/property.js";import{cast as m}from"../core/accessorSupport/decorators/cast.js";import"../chunks/typedArrayUtil.js";import{subclass as g}from"../core/accessorSupport/decorators/subclass.js";import f,{F as b,C as _}from"./Feature.js";import{S as y}from"../chunks/Spinner.js";import j,{l as v}from"./Widget.js";import k,{g as w}from"./Popup/PopupViewModel.js";import{H as M}from"../chunks/Heading.js";import{a as C}from"../chunks/accessibleHandler.js";import{m as F}from"../chunks/messageBundle.js";import{v as A}from"../chunks/vmEvent.js";import{t as I}from"../chunks/jsxFactory.js";import{s as x,h as S,i as O}from"../chunks/widgetUtils.js";import{i as D}from"../chunks/themeUtils.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../core/lang.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/maybe.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/ArrayPool.js";import"../chunks/ObjectPool.js";import"../core/Evented.js";import"../core/Accessor.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/ensureType.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"./Attachments.js";import"../chunks/unitFormatUtils.js";import"../chunks/ByteSizeUnit.js";import"../chunks/Cyclical.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec4.js";import"../chunks/unitUtils.js";import"./Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../chunks/featureUtils.js";import"../chunks/layerUtils.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/guid.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"./Feature/FeatureViewModel.js";import"../core/HandleOwner.js";import"../chunks/WatchUpdatingTracking.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/executeQueryJSON.js";import"../chunks/utils4.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils5.js";import"../chunks/urlUtils2.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedGeometry.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/FullTextSearch.js";import"../chunks/QuantizationParameters.js";import"../rest/support/StatisticDefinition.js";import"../chunks/featureConversionUtils.js";import"../rest/support/RelationshipQuery.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/featureFlags.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/sql.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/RelationshipElement.js";import"../layers/Layer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/CustomParametersMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties2.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/TimeReference.js";import"../chunks/featureLayerUtils.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../chunks/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"../chunks/asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/portalItemUtils.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/FeatureRelationshipViewModel.js";import"../chunks/featureFormUtils.js";import"./support/widget.js";import"../chunks/uriUtils.js";import"../chunks/utils16.js";import"../chunks/numberUtils.js";import"../chunks/utils6.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"./Spinner/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"../chunks/LayerConstants.js";import"../symbols/support/symbolUtils.js";import"../chunks/previewUtils.js";import"../chunks/renderUtils.js";import"../chunks/colorUtils2.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";import"../chunks/previewSymbol3D.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/layerViewUtils.js";import"../chunks/actions.js";import"./support/GoTo.js";const E="esri-popup",T=`${E}__header`,U=`${E}--is-docked`,L={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:E,widget:"esri-widget",main:`${E}__main-container`,loadingContainer:`${E}__loading-container`,isCollapsible:`${E}--is-collapsible`,isCollapsed:`${E}--is-collapsed`,shadow:`${E}--shadow`,isDocked:U,isDockedTopLeft:`${U}-top-left`,isDockedTopCenter:`${U}-top-center`,isDockedTopRight:`${U}-top-right`,isDockedBottomLeft:`${U}-bottom-left`,isDockedBottomCenter:`${U}-bottom-center`,isDockedBottomRight:`${U}-bottom-right`,alignTopCenter:`${E}--aligned-top-center`,alignBottomCenter:`${E}--aligned-bottom-center`,alignTopLeft:`${E}--aligned-top-left`,alignBottomLeft:`${E}--aligned-bottom-left`,alignTopRight:`${E}--aligned-top-right`,alignBottomRight:`${E}--aligned-bottom-right`,isFeatureMenuOpen:`${E}--feature-menu-open`,isActionsMenuOpen:`${E}--actions-menu-open`,hasFeatureUpdated:`${E}--feature-updated`,header:T,headerButtons:`${T}-buttons`,headerContainer:`${T}-container`,headerContainerButton:`${T}-container--button`,headerTitle:`${T}-title`,content:`${E}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${E}__footer`,footerHasPagination:`${E}__footer--has-pagination`,footerHasActions:`${E}__footer--has-actions`,footerHasActionsMenu:`${E}__footer--has-actions-menu`,button:`${E}__button`,buttonDisabled:`${E}__button--disabled`,buttonDock:`${E}__button--dock`,icon:`${E}__icon`,iconDock:`${E}__icon--dock-icon`,inlineActionsContainer:`${E}__inline-actions-container`,actionsMenuButton:`${E}__actions-menu-button`,actions:`${E}__actions`,action:`${E}__action`,actionImage:`${E}__action-image`,actionText:`${E}__action-text`,actionToggle:`${E}__action-toggle`,actionToggleOn:`${E}__action-toggle--on`,actionExit:`${E}__action--exit`,actionSelectFeature:`${E}__action--select-feature`,pointer:`${E}__pointer`,pointerDirection:`${E}__pointer-direction`,navigation:`${E}__navigation`,paginationIcon:`${E}__pagination-icon`,paginationPrevious:`${E}__pagination-previous`,paginationNext:`${E}__pagination-next`,featureMenu:`${E}__feature-menu`,featureMenuList:`${E}__feature-menu-list`,featureMenuItem:`${E}__feature-menu-item`,featureMenuViewport:`${E}__feature-menu-viewport`,featureMenuHeader:`${E}__feature-menu-header`,featureMenuNote:`${E}__feature-menu-note`,featureMenuSelected:`${E}__feature-menu-item--selected`,featureMenuButton:`${E}__feature-menu-button`,featureMenuButtonIcon:`${E}__feature-menu-button-icon`,featureMenuTitle:`${E}__feature-menu-title`,featureMenuObserver:`${E}__feature-menu-observer`,featureMenuLoader:`${E}__feature-menu-loader`,collapseButton:`${E}__collapse-button`,collapseIcon:`${E}__collapse-icon`},P="selected-index",B="popup-spinner",R={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},N="esri-popup";function $(e,t){return void 0===t?`${N}__${e}`:`${N}__${e}-${t}`}const V={closeButton:!0,featureNavigation:!0};let W=class extends(b(j)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new n,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([e])=>{e?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=d((()=>this._displaySpinner()),0),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new o,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new k,this.visibleElements={...V},this._handleOpenRelatedFeature=e=>{this._openRelatedFeature(e)},this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,l((()=>this.viewModel?.screenLocation),(()=>this._positionContainer())),l((()=>[this.viewModel?.active,this.dockEnabled]),(()=>this._toggleScreenLocationEnabled())),l((()=>this.viewModel?.screenLocation),((e,t)=>{!!e!=!!t&&this.reposition()})),l((()=>[this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment]),(()=>this.reposition())),l((()=>this.spinnerEnabled),(e=>this._spinnerEnabledChange(e))),l((()=>this.viewModel?.view?.size),((e,t)=>this._updateDockEnabledForViewSize(e,t))),l((()=>this.viewModel?.view),((e,t)=>this._viewChange(e,t))),l((()=>this.viewModel?.view?.ready),((e,t)=>this._viewReadyChange(e??!1,t??!1))),l((()=>[this.viewModel?.waitingForResult,this.viewModel?.location]),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),l((()=>this.selectedFeatureWidget),(()=>this._destroyFlowItemWidgets())),l((()=>[this.selectedFeatureWidget?.viewModel?.title,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setTitleFromFeatureWidget())),l((()=>[this.selectedFeatureWidget?.viewModel?.content,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setContentFromFeatureWidget())),a((()=>!this.collapsed),(()=>{"xsmall"===this.viewModel?.view?.widthBreakpoint&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),u((()=>this.viewModel?.allActions),"change",(()=>this._watchActions())),l((()=>this.viewModel?.allActions),(()=>this._watchActions()),p),l((()=>this.viewModel?.featureViewModels),(()=>this._featureMenuViewportScrollTop())),u((()=>this._flowItems),"change",(()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()})),l((()=>[this._activeFlowItemWidget?.viewModel?.state,this._activeFlowItemWidget?.viewModel?.title]),(()=>this.scheduleRender()))])}loadDependencies(){return v({action:()=>import("../chunks/calcite-action.js"),flow:()=>import("../chunks/calcite-flow.js"),"flow-item":()=>import("../chunks/calcite-flow-item.js"),icon:()=>import("../chunks/calcite-icon.js"),tooltip:()=>import("../chunks/calcite-tooltip.js")})}initialize(){this.addHandles(this._displaySpinnerThrottled)}destroy(){this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles?.destroy(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:t}=this;if(!e)return!!t?.content;const o=e.viewModel;if(o?.waitingForContent||"error"===o?.state)return!0;const i=o?.content;return Array.isArray(i)?!!i.length:!!i}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&!!this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.at(-1)??null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return i(r.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){i(r.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||R}set dockOptions(e){const t={...R},o=this.viewModel?.view?.breakpoints,i={};o&&(i.width=o.xsmall,i.height=o.xsmall);const s={...t,...e},n={...t.breakpoint,...i},{breakpoint:r}=s;"object"==typeof r?s.breakpoint={...n,...r}:r&&(s.breakpoint=n),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:o,_flowItems:i}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...t,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=n):this._feature=new f({flowItems:i,headingLevel:o+1,viewModel:s,visibleElements:n}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...V,...e}}blur(){const{active:e}=this.viewModel;e||r.getLogger(this).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||r.getLogger(this).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){this._handles.remove(P);const t=!!e&&!!e.featureMenuOpen,o=!!e&&!!e.actionsMenuOpen,i={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:o,featureMenuOpen:t};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(i.collapsed=!0),this.set(i),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:o,dividedActions:i,currentAlignment:s,currentDockPosition:n}=this,{active:r}=this.viewModel,{menuActions:l}=i,a=r&&l.length>1&&e,u=r&&t,c=r&&!t,p=this.selectedFeature?.layer?.title,d=this.selectedFeature?.layer?.id,h={[L.alignTopCenter]:"top-center"===s,[L.alignBottomCenter]:"bottom-center"===s,[L.alignTopLeft]:"top-left"===s,[L.alignBottomLeft]:"bottom-left"===s,[L.alignTopRight]:"top-right"===s,[L.alignBottomRight]:"bottom-right"===s,[L.isDocked]:u,[L.shadow]:c,[L.isDockedTopLeft]:"top-left"===n,[L.isDockedTopCenter]:"top-center"===n,[L.isDockedTopRight]:"top-right"===n,[L.isDockedBottomLeft]:"bottom-left"===n,[L.isDockedBottomCenter]:"bottom-center"===n,[L.isDockedBottomRight]:"bottom-right"===n,[L.isFeatureMenuOpen]:o,[L.isActionsMenuOpen]:a};return I("div",{class:this.classes(L.base,h),role:"presentation","data-layer-title":p,"data-layer-id":d,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},r?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return I("span",{"aria-hidden":"true",class:this.classes(L.icon,L.iconLoading,L.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?I("div",{key:$("loading-container"),role:"presentation",class:L.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousButton(){const{messages:e}=this;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(L.button,L.paginationPrevious),"aria-label":e.previous,title:e.previous},I("calcite-icon",{icon:"chevron-left",scale:"s",class:L.paginationIcon}))}renderNextButton(){const{messages:e}=this;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(L.button,L.paginationNext),"aria-label":e.next,title:e.next},I("calcite-icon",{icon:"chevron-right",scale:"s",class:L.paginationIcon}))}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:o}=this,{featureCount:i,selectedFeatureIndex:s}=this.viewModel;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:L.featureMenuButton,"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":o.menu,title:o.menu},I("calcite-icon",{icon:"list-bullet",scale:"s",class:L.featureMenuButtonIcon}),this._getPageText(i,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNextButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),o={[L.iconUndock]:e,[L.iconDock]:!e,[L.iconDockToRight]:!e&&("top-right"===t||"bottom-right"===t),[L.iconDockToLeft]:!e&&("top-left"===t||"bottom-left"===t),[L.iconDockToTop]:!e&&"top-center"===t,[L.iconDockToBottom]:!e&&"bottom-center"===t};return I("span",{"aria-hidden":"true",class:this.classes(o,L.icon)})}renderDockButton(){const{dockEnabled:e,messages:t}=this,o=this.viewModel?.view?.widthBreakpoint,i=e?t.undock:t.dock;return"xsmall"!==o&&this.dockOptions?.buttonEnabled?I("div",{role:"button","aria-label":i,title:i,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(L.button,L.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:o,contentCollapsed:i,messagesCommon:s}=this,n={[L.headerContainerButton]:o},r=I(M,{level:this.headingLevel,class:L.headerTitle,innerHTML:e??""}),l=o?I("button",{key:`${e}--collapsible`,id:t,title:i?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(L.headerContainer,n),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},r,I("calcite-icon",{class:L.collapseIcon,key:"collapse-icon",icon:i?"chevron-down":"chevron-up",scale:"m"})):I("div",{key:e??"title",id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(L.headerContainer,n)},r);return e?l:null}renderCloseIcon(){return I("span",{"aria-hidden":"true",class:this.classes(L.icon,L.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?I("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:L.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return I("header",{class:L.header},this.renderTitle(),I("div",{class:L.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:o,_flowItems:i}=this,{content:s}=this.viewModel,n=i.toArray(),r={[L.contentHasFlows]:!!n.length};return t&&!o?I("div",{key:s??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(L.content,r)},I("calcite-flow",{bind:this},I("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:x,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),n.map((e=>this.renderFlowItem(e)))),n.map((e=>this.renderFlowItemTooltips(e)))):null}renderFlowItem(e){const{messages:t}=this,o=D(),i="graphic"in e&&!e.isTable;return I("calcite-flow-item",{bind:this,class:this.classes({[L.calciteThemeDark]:!o,[L.calciteThemeLight]:o}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},I("calcite-action",{class:L.actionExit,icon:"move-up",label:t?.exitRelatedRecords,text:t?.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:t=>this._storeExitRelatedRecordsAction(e,t),onclick:this._destroyFlowItemWidgets}),i?I("calcite-action",{class:L.actionSelectFeature,icon:"zoom-to-object",label:t?.selectFeature,text:t?.selectFeature,slot:"header-actions-end",bind:this,afterCreate:t=>this._storeFeatureSelectionAction(e,t),onclick:()=>this._handleOpenRelatedFeature(e)}):null,I("div",{class:this.classes(L.contentFlowItem,{[L.calciteThemeDark]:o,[L.calciteThemeLight]:!o})},e.render()))}renderFlowItemTooltips(e){const{messages:t,_exitRelatedRecordsActions:o,_featureSelectionActions:i}=this,s=D(),n=i.get(e);return[I("calcite-tooltip",{class:this.classes({[L.calciteThemeDark]:!s,[L.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:t?.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:o.get(e),placement:"top"},t?.exitRelatedRecords),n?I("calcite-tooltip",{class:this.classes({[L.calciteThemeDark]:!s,[L.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:t?.selectFeature,overlayPositioning:"fixed",referenceElement:n,placement:"top"},t?.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:o,dividedActions:i,messagesCommon:s}=this,n=o?s.close:s.open,{menuActions:r}=i;return r.length?I("div",{key:$("actions-menu-button"),class:this.classes(L.button,L.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":o?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},I("span",{"aria-hidden":"true",class:L.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:o,dividedActions:i}=this,{menuActions:s}=i;return s.length&&o?I("ul",{id:e,role:"menu","aria-labelledby":t,key:$("actions"),class:L.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map((e=>this.renderAction({action:e,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map((e=>this.renderAction({action:e,type:"inline"}))):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,o=!!e.length,i=!!t.length;return o||i?I("div",{key:"inline-actions-container","data-inline-actions":o.toString(),"data-menu-actions":i.toString(),class:L.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?I("section",{key:$("navigation"),class:this.classes(L.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:o,menuActions:i}=t,s=!!o.length,n=!!i.length,r={[L.footerHasPagination]:e,[L.footerHasActions]:s,[L.footerHasActionsMenu]:n};return e||s?I("div",{key:$("feature-buttons"),class:this.classes(L.footer,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:o,isLoadingFeature:i}=this.viewModel,s=t(e.selectedFeatures,{total:o.length});return I("section",{key:$("menu"),class:L.featureMenu},I("strong",{class:L.featureMenuHeader},s),I("nav",{bind:this,class:L.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:x},this.renderFeatureMenu(),I("div",{class:L.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?I("div",{class:L.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:I("div",{key:$("pointer"),class:L.pointer,role:"presentation"},I("div",{class:this.classes(L.pointerDirection,L.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:o,titleId:i,contentId:s,collapsible:n,hasContent:r,contentCollapsed:l,visibleElements:a}=this,{title:u}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===o||"top-center"===o||"top-right"===o,p="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===o||"bottom-center"===o||"bottom-right"===o,d={[L.shadow]:e,[L.isCollapsible]:n,[L.isCollapsed]:l};return I("div",{class:this.classes(L.main,L.widget,d),tabIndex:a.closeButton?void 0:-1,role:"dialog","aria-live":"polite","aria-labelledby":u?i:"","aria-describedby":r&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){const e=this.viewModel?.content;return e?"string"==typeof e?I("div",{class:_.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return I("span",{key:"text",class:L.actionText},e)}renderActionCalciteIcon(e,t){return I("calcite-icon",{scale:"s",key:`calcite-icon-${t}`,icon:e,class:L.icon})}renderActionIcon(e){const t=this._getActionClass(e),o=this._getActionImage(e),i={[L.iconLoading]:e.active,[L.rotating]:e.active,[L.icon]:!!t,[L.actionImage]:!e.active&&!!o};return t&&(i[t]=!e.active),I("span",{key:"icon","aria-hidden":"true",class:this.classes(L.icon,i),styles:this._getIconStyles(o)})}renderAction(e){const{action:t,type:o}=e,i=this._getActionTitle(t),s={[L.action]:"toggle"!==t.type,[L.actionToggle]:"toggle"===t.type,[L.actionToggleOn]:"toggle"===t.type&&t.value,[L.buttonDisabled]:t.disabled},n=[t.icon&&!t.active?this.renderActionCalciteIcon(t.icon,t.uid):this.renderActionIcon(t),this.renderActionText(i)],r="menu-item"===o?I("li",{key:t.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(L.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):I("div",{key:t.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(L.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?r:null}renderFeatureMenuItem(e,t){const{messages:o,messagesCommon:i}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,r=e===n,l={[L.featureMenuSelected]:r},a=r?I("span",{key:$(`feature-menu-selected-feature-${s}`),title:o.selectedFeature,"aria-label":o.selectedFeature,class:L.iconCheckMark}):null,u=I("span",{innerHTML:e.title||i.untitled});return I("li",{role:"menuitem",tabIndex:-1,key:$(`feature-menu-feature-${s}`),class:this.classes(l,L.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},I("span",{class:L.featureMenuTitle},u,a))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?I("ol",{class:L.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_storeFeatureSelectionAction(e,t){this._featureSelectionActions.set(e,t),this.scheduleRender()}_storeExitRelatedRecordsAction(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,o=t?.geometry;if(null==o||null==t)return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:o});const i=w(o);this.open({features:[t],location:null!=i?i:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach((e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:o,selectedFeature:i,messagesCommon:s}=this,{id:n}=e,r=i?.attributes,l=e.title??"",a="zoom-to-feature"===n?t(l,{messages:o}):"remove-selected-feature"===n?t(l,{messages:s}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?t(l,{messages:o}):e.title;return a&&r?t(a,r):a??""}_getActionClass(e){const{selectedFeature:o}=this,i=o?.attributes,{className:s,image:n}=e,r=n||s?s:L.iconDefaultAction;return r&&i?t(r,i):r??""}_getActionImage(e){if(e.active)return"";const{selectedFeature:o}=this,i=o?.attributes,{image:s}=e;return s&&i?t(s,i):s??""}_createFeatureUpdatedAnimation(){return S("enter",L.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const o=Math.round(e);return Math.max(t?o-1:o,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(l((()=>[e.uid,e.active,e.className,e.disabled,e.id,e.title,e.image,e.visible]),(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter((e=>e.visible)),i=this._getInlineActionCount(),s=null===i,n=0===i;return{inlineActions:s?t.slice(0):n?new o:t.slice(0,i),menuActions:s?new o:n?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title="error"===e.viewModel?.state?t.errorMessage:e.viewModel?.title||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===s(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===s(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,o=H(e.currentTarget);t.activeFeature=t.features[o]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=s(e),{_featureMenuNode:o}=this,i=H(e.currentTarget);if(!o)return;const n=o.querySelectorAll("li"),r=n.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(i+1+r)%r].focus()):(e.stopPropagation(),n[(i-1+r)%r].focus())}_handleActionMenuItemKeyup(e){const t=s(e),{_actionsMenuNode:o}=this,i=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,r=n.findIndex((e=>e.uid===i));if(!o)return;const l=o.querySelectorAll("li"),a=l.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),l[l.length-1].focus()):(e.stopPropagation(),l[0].focus()):(e.stopPropagation(),l[(r+1+a)%a].focus()):(e.stopPropagation(),l[(r-1+a)%a].focus())}_handleMainKeyup(e){const t=s(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:o}=this.viewModel;o&&t?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e?.shouldFocus&&(await c((()=>!0===this.viewModel?.active)),this.focus())}_addSelectedFeatureIndexHandle(){const e=l((()=>this.viewModel?.selectedFeatureIndex),((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,P)}_selectedFeatureIndexUpdated(e,t){const{featureCount:o}=this;o&&e!==t&&-1!==e&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:o,screenLocation:i,side:s,view:n}=e;if(isNaN(o)||isNaN(t)||!n||!i)return!1;const r=n.padding;return"right"===s&&i.x+o/2>n.width-r.right||"left"===s&&i.x-o/2<r.left||"top"===s&&i.y-t<r.top||"bottom"===s&&i.y+t>n.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:o,_mainContainerNode:i,viewModel:s}=this,{screenLocation:n,view:r}=s;if(null==n||!r||!o)return"top-center";if(!this._isScreenLocationWithinView(n,r))return this._get("currentAlignment")||"top-center";function l(e){return parseInt(e.replaceAll(/[^-\d\.]/g,""),10)}const a=i?window.getComputedStyle(i,null):null,u=a?l(a.getPropertyValue("max-height")):0,c=a?l(a.getPropertyValue("height")):0,{height:p,width:d}=o.getBoundingClientRect(),h=d+t,m=Math.max(p,u,c)+t,g=this._isOutsideView({popupHeight:m,popupWidth:h,screenLocation:n,side:"right",view:r}),f=this._isOutsideView({popupHeight:m,popupWidth:h,screenLocation:n,side:"left",view:r}),b=this._isOutsideView({popupHeight:m,popupWidth:h,screenLocation:n,side:"top",view:r}),_=this._isOutsideView({popupHeight:m,popupWidth:h,screenLocation:n,side:"bottom",view:r});return f?b?"bottom-right":"top-right":g?b?"bottom-left":"top-left":b?_?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return O(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){if("auto"!==e)return e;const t=this.viewModel?.view,o=O(this.container)?"top-left":"top-right";if(!t)return o;const i=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-i.left-i.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":o}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:o}=this._containerNode.getBoundingClientRect(),i=this._calculatePositionStyle(t,o);i&&Object.assign(this._containerNode.style,i)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:o}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+o:e}_calculateAlignmentPosition(e,t,o,i){const{currentAlignment:s,_pointerOffsetInPx:n}=this;if(!o)return;const{padding:r}=o,l=i/2,a=o.height-t,u=o.width-e;return"bottom-center"===s?{top:t+n-r.top,left:e-l-r.left}:"top-left"===s?{bottom:a+n-r.bottom,right:u+n-r.right}:"bottom-left"===s?{top:t+n-r.top,right:u+n-r.right}:"top-right"===s?{bottom:a+n-r.bottom,left:e+n-r.left}:"bottom-right"===s?{top:t+n-r.top,left:e+n-r.left}:"top-center"===s?{bottom:a+n-r.bottom,left:e-l-r.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:o,view:i}=this;if(!i)return;if(o)return{left:"",top:"",right:"",bottom:""};if(null==e||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,i,s);return n?{top:void 0!==n.top?`${n.top}px`:"auto",left:void 0!==n.left?`${n.left}px`:"auto",bottom:void 0!==n.bottom?`${n.bottom}px`:"auto",right:void 0!==n.right?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,o){const[i,s]=e,[n,r]=t,{width:l=0,height:a=0}=o??{};return i<=l&&n>l||i>l&&n<=l||s<=a&&r>a||s>a&&r<=a}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const o=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=o.left+o.right,s=o.top+o.bottom,n=[],r=[];n[0]=e[0]-i,n[1]=e[1]-s,r[0]=t[0]-i,r[1]=t[1]-s;const{dockOptions:l}=this,a=l.breakpoint;this._dockingThresholdCrossed(n,r,a)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const o=t.active&&!e;t.screenLocationEnabled=o}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,o=this.viewModel?.view?.ui;if(!o)return!1;const{width:i,height:s}=o;if(isNaN(i)||isNaN(s))return!1;if(!t)return!1;const n=t.hasOwnProperty("width")&&i<=(t.width??0),r=t.hasOwnProperty("height")&&s<=(t.height??0);return n||r}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,o){return this.featureNavigationVisible?t(this.messages.pageText,{index:o+1,total:e}):null}_destroySpinner(){this._spinner&&(this.view?.ui?.remove(this._spinner,B),this._spinner.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new y({view:e}),e.ui.add(this._spinner,{key:B,position:"manual",internal:!0}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:o}=this.viewModel,i=o.findIndex((e=>e.uid===t)),s=o.at(i);s&&"toggle"===s.type&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}_selectFeature(e){const t=H(e.currentTarget);null==t||isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};function H(e){return e?.["data-feature-index"]}e([h({readOnly:!0})],W.prototype,"actionsMenuId",null),e([h({readOnly:!0})],W.prototype,"actionsMenuButtonId",null),e([h({readOnly:!0})],W.prototype,"featureMenuId",null),e([h({readOnly:!0})],W.prototype,"titleId",null),e([h({readOnly:!0})],W.prototype,"contentId",null),e([h({readOnly:!0})],W.prototype,"hasContent",null),e([h({readOnly:!0})],W.prototype,"featureNavigationVisible",null),e([h({readOnly:!0})],W.prototype,"collapsible",null),e([h({readOnly:!0})],W.prototype,"featureMenuVisible",null),e([h({readOnly:!0})],W.prototype,"contentCollapsed",null),e([h({readOnly:!0})],W.prototype,"dividedActions",null),e([h({readOnly:!0,dependsOn:["_flowItems.length"]})],W.prototype,"_activeFlowItemWidget",null),e([h()],W.prototype,"actions",null),e([h()],W.prototype,"actionsMenuOpen",null),e([h()],W.prototype,"alignment",void 0),e([h()],W.prototype,"autoCloseEnabled",null),e([h()],W.prototype,"autoOpenEnabled",null),e([h()],W.prototype,"defaultPopupTemplateEnabled",null),e([h()],W.prototype,"content",null),e([h()],W.prototype,"collapsed",void 0),e([h()],W.prototype,"collapseEnabled",void 0),e([h({readOnly:!0})],W.prototype,"currentAlignment",null),e([h({readOnly:!0})],W.prototype,"currentDockPosition",null),e([h()],W.prototype,"dockOptions",null),e([h()],W.prototype,"dockEnabled",void 0),e([h({readOnly:!0})],W.prototype,"featureCount",null),e([h()],W.prototype,"featureMenuOpen",null),e([h()],W.prototype,"features",null),e([h()],W.prototype,"goToOverride",null),e([h()],W.prototype,"headingLevel",void 0),e([h()],W.prototype,"highlightEnabled",null),e([h()],W.prototype,"location",null),e([h()],W.prototype,"label",null),e([h()],W.prototype,"maxInlineActions",void 0),e([h(),F("esri/widgets/Popup/t9n/Popup")],W.prototype,"messages",void 0),e([h(),F("esri/t9n/common")],W.prototype,"messagesCommon",void 0),e([h()],W.prototype,"promises",null),e([h({readOnly:!0})],W.prototype,"selectedFeature",null),e([h()],W.prototype,"selectedFeatureIndex",null),e([h({readOnly:!0})],W.prototype,"selectedFeatureWidget",null),e([h()],W.prototype,"spinnerEnabled",void 0),e([h()],W.prototype,"title",null),e([h()],W.prototype,"updateLocationEnabled",null),e([h()],W.prototype,"view",null),e([h({type:k}),A(["triggerAction","trigger-action"])],W.prototype,"viewModel",void 0),e([h()],W.prototype,"visible",null),e([h()],W.prototype,"visibleElements",void 0),e([m("visibleElements")],W.prototype,"castVisibleElements",null),e([C()],W.prototype,"_close",null),e([C()],W.prototype,"_toggleDockEnabled",null),e([C()],W.prototype,"_toggleFeatureMenu",null),e([C()],W.prototype,"_toggleActionsMenu",null),e([C()],W.prototype,"_triggerAction",null),e([C()],W.prototype,"_selectFeature",null),e([C()],W.prototype,"_next",null),e([C()],W.prototype,"_previous",null),W=e([g("esri.widgets.Popup")],W);const z=W;export{z as default};
