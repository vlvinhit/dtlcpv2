/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{b as t}from"../chunks/domUtils.js";import r from"../core/Evented.js";import{debounce as s,throwIfNotAbortError as o,i as n,o as i,eachAlways as a}from"../core/promiseUtils.js";import c from"../core/Handles.js";import"../chunks/typedArrayUtil.js";import{clone as d}from"../core/lang.js";import{L as l}from"../chunks/Logger.js";import{d as p}from"../chunks/maybe.js";import{EsriPromiseMixin as h}from"../core/Promise.js";import{watch as u,when as m,initial as f}from"../core/reactiveUtils.js";import{g}from"../chunks/uuid.js";import{property as y}from"../core/accessorSupport/decorators/property.js";import{cast as v}from"../core/accessorSupport/decorators/cast.js";import{subclass as j}from"../core/accessorSupport/decorators/subclass.js";import{r as _}from"../chunks/tracking.js";import{S as k}from"../chunks/watch.js";import{d as w}from"../chunks/projector.js";import{d as b,a as R}from"../chunks/dom.js";import{g as E}from"../chunks/assets.js";import{makeAbsolute as P}from"../core/urlUtils.js";import{g as L,s as C}from"../chunks/index.js";import{W as N,i as S,p as I,a as F}from"../chunks/jsxWidgetSupport.js";import{g as T,a as A,d as H,c as O,b as U}from"../chunks/widgetUtils.js";import{o as $}from"../chunks/locale.js";import{f as M}from"../chunks/messages.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/string.js";import"../request.js";import"../config.js";import"../kernel.js";import"../core/Error.js";import"../core/Accessor.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/ensureType.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/guid.js";const x={handleInterceptedEvent:(e,t,r,s)=>(e.scheduleRender(),t.properties[`on${s.type}`].apply(t.properties.bind||r,[s]))},D={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},B=(e,t,r=!1)=>{let s=e;return t.forEach(((e,o)=>{const n=s?.children?(i=t=>t.domNode===e,s.children.find(i)):void 0;var i;r&&!n&&o!==t.length-1||(s=n)})),s};
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */
function z(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(b)||e.contains(R)&&t?"dark":"light",s=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),o=e=>{n!==e&&s(e),n=e};let n=r();s(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>o(e.matches?"dark":"light"))),new MutationObserver((()=>o(r()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}let W;function q(e){const t=[];for(const r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return Promise.all(t)}"undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document&&("interactive"===document.readyState?z():document.addEventListener("DOMContentLoaded",(()=>z()),{once:!0})),W="esri/widgets/support/components/assets";const G=new Set;var V;let J=0;function K(e,t){for(const r in t)null!=e[r]&&("object"==typeof e[r]&&"object"==typeof t[r]?K(e[r],t?.[r]):e[r]=t[r]);return e}const Q=(e=>{let t;const r={...x,...e},s=(e=>({...D,...e}))(r),o=s.performanceLogger;let n,i=!0,a=!1;const c=[],d=[],l=(e,n,i)=>{let a;s.eventHandlerInterceptor=(e,s,n,i)=>function(e){let s;o("domEvent",e);const n=((e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(e.currentTarget,a.domNode),i=n.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&i){const t=e.composedPath(),r=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).filter((e=>e.getRootNode()===e.ownerDocument)).reverse();s=B(a.getLastRender(),r,!0)}else n.reverse(),s=B(a.getLastRender(),n);let c;return s&&(c=r.handleInterceptedEvent(t,s,this,e)),o("domEventProcessed",e),c},r.postProcessProjectionOptions?.(s);const l=i();a=e(n,l,s),c.push(a),d.push(i),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(a,l)};let p=()=>{if(n=void 0,i){i=!1,o("renderStart",void 0);for(let e=0;e<c.length;e++){const t=d[e]();o("rendered",void 0),c[e].update(t),o("patched",void 0)}o("renderDone",void 0),i=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,c,d)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,i=!0,t.scheduleRender()},append:(e,t)=>{l(w.append,e,t)},insertBefore:(e,t)=>{l(w.insertBefore,e,t)},merge:(e,t)=>{l(w.merge,e,t)},replace:(e,t)=>{l(w.replace,e,t)},detach:e=>{for(let t=0;t<d.length;t++)if(d[t]===e)return d.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(e,s,o,n)=>{const i=t?.(e,s,o,n),a=r.test(e);if(!((e=e.replace(r,"")).toLowerCase()in o)||a){const t=e[2].toLowerCase()+e.slice(3),r=e=>i?.call(o,e);o.addEventListener(t,r,a);const s=()=>o.removeEventListener(t,r,a),c=n.afterRemoved;n.afterRemoved=e=>{c?.(e),s()}}return i}},handleInterceptedEvent(e,t,r,s){const{eventPhase:o,type:n}=s,i=o===Event.CAPTURING_PHASE;let a=`on${n}${i?"capture":""}`;const c=t.properties;(c&&a in c||(a=`on${n[0].toUpperCase()}${n.slice(1)}${i?"Capture":""}`,c&&a in c))&&(U(),e.scheduleRender(),c[a].call(c.bind||r,s))}});let X=!1,Y=class extends(h(r.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new c,this._projector=Q,this._readyForTrueRender=!1,this.iconClass="esri-icon-checkbox-unchecked",this.icon=null,this.key=this,this._loadLocale=s((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await a(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{if(this.destroyed)return;let r=await M(e);this.uiStrings&&Object.keys(this.uiStrings)&&(r=K(d(r),this.uiStrings)),this[t]=r})));if(this.destroyed)return;for(const t of e)t.error&&l.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()})),function(){try{L(".")}catch{C(P(E("esri/widgets/support/components/assets")))}}();const r="esri-widget-uid-"+g(),o=this.render.bind(this);this._trackingTarget=new k((()=>this.scheduleRender()));const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=o();let{properties:t}=e;t||(e.properties=t={});const{key:s}=t;s||(t.key=r),this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display||(t.styles.display="");let n=0;return e.children?.forEach((e=>{if(S(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${this.id}--${n++}`)})),I(this,e)};var i;this.render=()=>{if(X)return n();let e=T(this)??null;if(e)return e;this._trackingTarget.clear(),X=!0;try{e=_(this._trackingTarget,n)}catch(e){throw console.error(e),e}finally{X=!1}return e&&A(this,e),e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{this._readyForTrueRender=!0,this._postInitialize()}))),i=this._resourcesFetch,G.add(i),i.finally((()=>G.delete(i)))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then((()=>{})).catch(o)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(p(this._trackingTarget),p(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,H(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return t(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+J++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(V=F,N)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(H(this),this._projector.scheduleRender())}classes(...e){return O.apply(this,e)}renderNow(){H(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add(u((()=>this.viewModel),((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&n(e)&&this._internalHandles.add(this._delegatedEventNames.map((t=>i(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),f)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(o),this.scheduleRender()};this._internalHandles.add([$(e),u((()=>this.uiStrings),e),m((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Y[V]=!0,e([y()],Y.prototype,"_readyForTrueRender",void 0),e([y({value:null})],Y.prototype,"container",null),e([v("container")],Y.prototype,"castContainer",null),e([y()],Y.prototype,"iconClass",void 0),e([y()],Y.prototype,"icon",void 0),e([y()],Y.prototype,"id",null),e([y()],Y.prototype,"label",null),e([y()],Y.prototype,"renderable",null),e([y()],Y.prototype,"uiStrings",void 0),e([y()],Y.prototype,"viewModel",void 0),e([y({value:!0})],Y.prototype,"visible",null),e([y()],Y.prototype,"key",void 0),e([y()],Y.prototype,"children",void 0),e([y()],Y.prototype,"afterCreate",void 0),e([y()],Y.prototype,"afterUpdate",void 0),e([y()],Y.prototype,"afterRemoved",void 0),Y=e([j("esri.widgets.Widget")],Y);const Z=Y;export{Z as default,q as l};
