/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
import"../../chunks/typedArrayUtil.js";import{l as t}from"../../chunks/arcadeOnDemand.js";import{d as e,e as s,f as r,h as l,c as o,a as i,b as a,g as n,i as c}from"../../chunks/utils6.js";import{S as m}from"../../chunks/previewUtils.js";import{g as u,a as p,r as h,b,c as d,d as y,e as f,f as j,h as k}from"../../chunks/renderUtils.js";import{i as g,c as L}from"../../chunks/widgetUtils.js";import{t as S}from"../../chunks/jsxFactory.js";import{getSymbolLayerFill as w}from"../../chunks/previewSymbol3D.js";import"../../geometry.js";import"../../chunks/ensureType.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../core/lang.js";import"../../chunks/string.js";import"../../geometry/Extent.js";import"../../chunks/tslib.es6.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/maybe.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/tracking.js";import"../../geometry/Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../chunks/vec4.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../symbols.js";import"../CIMSymbol.js";import"../../chunks/enumeration.js";import"../../layers/support/fieldUtils.js";import"../Symbol.js";import"../ExtrudeSymbol3DLayer.js";import"../Symbol3DLayer.js";import"../../chunks/utils2.js";import"../edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../edges/SketchEdges3D.js";import"../edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../FillSymbol.js";import"../SimpleLineSymbol.js";import"../LineSymbol.js";import"../LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../FillSymbol3DLayer.js";import"../patterns/LineStylePattern3D.js";import"../patterns/StylePattern3D.js";import"../../chunks/utils3.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../Font.js";import"../IconSymbol3DLayer.js";import"../../core/urlUtils.js";import"../../chunks/persistableUrlUtils.js";import"../LabelSymbol3D.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../kernel.js";import"../../request.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../chunks/locale.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../LineSymbol3DLayer.js";import"../LineStyleMarker3D.js";import"../../core/Clonable.js";import"../ObjectSymbol3DLayer.js";import"../PathSymbol3DLayer.js";import"../TextSymbol3DLayer.js";import"../WaterSymbol3DLayer.js";import"./StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../callouts/Callout3D.js";import"../callouts/LineCallout3D.js";import"./Symbol3DVerticalOffset.js";import"../LineSymbol3D.js";import"../MarkerSymbol.js";import"../MeshSymbol3D.js";import"../PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../PictureMarkerSymbol.js";import"../PointSymbol3D.js";import"../PolygonSymbol3D.js";import"../SimpleFillSymbol.js";import"../SimpleMarkerSymbol.js";import"../TextSymbol.js";import"../WebStyleSymbol.js";import"../../chunks/asyncUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/mat4.js";import"../../chunks/_commonjsHelpers.js";import"./cimSymbolUtils.js";import"../../chunks/utils7.js";import"../../chunks/assets.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/colorUtils2.js";import"../../chunks/projector.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../core/reactiveUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/webStyleSymbolUtils.js";import"../../chunks/devEnvironmentUtils.js";import"./jsonUtils.js";import"../../chunks/layerUtils.js";import"../../chunks/styleUtils.js";import"../../chunks/featureFlags.js";const v="esri-relationship-ramp",C=`${v}--diamond`,M=`${v}--square`,U="http://www.w3.org/2000/svg",x={diamondContainer:`${C}__container`,diamondLeftCol:`${C}__left-column`,diamondRightCol:`${C}__right-column`,diamondMidCol:`${C}__middle-column`,diamondMidColLabel:`${C}__middle-column--label`,diamondMidColRamp:`${C}__middle-column--ramp`,squareTable:`${M}__table`,squareTableRow:`${M}__table-row`,squareTableCell:`${M}__table-cell`,squareTableLabel:`${M}__table-label`,squareTableLabelLeftBottom:`${M}__table-label--left-bottom`,squareTableLabelRightBottom:`${M}__table-label--right-bottom`,squareTableLabelLeftTop:`${M}__table-label--left-top`,squareTableLabelRightTop:`${M}__table-label--right-top`};function H(t,s,r={}){const{focus:l,labels:o}=t,i=!!l,a=function(t,s,r={}){const{focus:l,numClasses:o,colors:i,rotation:a}=t,{opacity:n,effectList:c,ariaLabel:m}=r,j=r.size??60,k=!!l,g=Math.sqrt(j**2+j**2)+(k?0:5),L=[],w=[],v=[],C=(j||75)/o;for(let t=0;t<o;t++){const e=t*C;for(let s=0;s<o;s++){const r=s*C,l=u(i[t][s]),o=p(null),a={type:"rect",x:r,y:e,width:C,height:C},n=h(l);n&&L.push(n);const c=b(a,l.fill,o,null);c&&w.push(c),v.push(d(a))}}let M=null;k||(M="margin: -15px -15px -18px -15px");const H=T("left",l,s),q=T("right",l,s),$=y(v),D=f($,g,g,0,!1,a,!1),_=f($,g,g,0,!1,k?-45:null,!1),R={filter:e(c)??void 0,opacity:null==n?"":`${n}`};return S("div",{styles:R,class:k?x.diamondMidColRamp:x.squareTableCell},S("svg",{xmlns:U,width:g,height:g,style:M,"aria-labelledBy":m,role:"image",focusable:!1},S("defs",null,S("marker",{id:`${s}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},S("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),S("marker",{id:`${s}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},S("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),L),S("g",{transform:D},w),S("g",{transform:_},S("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":H.markerStart,"marker-end":H.markerEnd,x1:-10,y1:j-15,x2:-10,y2:15}),S("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":q.markerStart,"marker-end":q.markerEnd,x1:15,y1:j+10,x2:j-15,y2:j+10}))))}(t,s,r),n=g();return i?S("div",{class:x.diamondContainer,styles:{justifyContent:"center"}},S("div",{class:x.diamondLeftCol},n?o.right:o.left),S("div",{class:x.diamondMidCol},S("div",{class:x.diamondMidColLabel},o.top),a,S("div",{class:x.diamondMidColLabel},o.bottom)),S("div",{class:x.diamondRightCol},n?o.left:o.right)):S("div",{class:x.squareTable},S("div",{class:x.squareTableRow},S("div",{class:L(x.squareTableCell,x.squareTableLabel,x.squareTableLabelRightBottom)},n?o.top:o.left),S("div",{class:x.squareTableCell}),S("div",{class:L(x.squareTableCell,x.squareTableLabel,x.squareTableLabelLeftBottom)},n?o.left:o.top)),S("div",{class:x.squareTableRow},S("div",{class:x.squareTableCell}),a,S("div",{class:x.squareTableCell})),S("div",{class:x.squareTableRow},S("div",{class:L(x.squareTableCell,x.squareTableLabel,x.squareTableLabelRightTop)},n?o.right:o.bottom),S("div",{class:x.squareTableCell}),S("div",{class:L(x.squareTableCell,x.squareTableLabel,x.squareTableLabelLeftTop)},n?o.bottom:o.right)))}function T(t,e,s){const r=`${s}_arrowStart`,l=`${s}_arrowEnd`,o="left"===t,i={markerStart:null,markerEnd:null};switch(e){case"HL":o?i.markerStart=`url(#${l})`:i.markerEnd=`url(#${r})`;break;case"LL":i.markerStart=`url(#${l})`;break;case"LH":o?i.markerEnd=`url(#${r})`:i.markerStart=`url(#${l})`;break;default:i.markerEnd=`url(#${r})`}return i}const q={HH:315,HL:45,LL:135,LH:225},$={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function D(t){if(!t)return;const{type:e}=t;if(e.includes("3d"))return w(t.symbolLayers.at(0));if("simple-line"===e){const e=s(t);return e&&e.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const e=s(t);return e&&e.color}return r(t)}function _(t){const{focus:e,infos:s,numClasses:r}=t,l=$[r],o={};s.forEach((t=>{o[t.value]={label:t.label,fill:D(t.symbol)}}));const i=[];for(let t=0;t<r;t++){const e=[];for(let s=0;s<r;s++){const r=o[l[t][s]];e.push(r.fill)}i.push(e)}const a=function(t,e){const s=e.HH.label,r=e.LL.label,l=e.HL.label,o=e.LH.label;switch(t){case"HH":default:return{top:s,bottom:r,left:l,right:o};case"HL":return{top:l,bottom:o,left:r,right:s};case"LL":return{top:r,bottom:s,left:o,right:l};case"LH":return{top:o,bottom:l,left:s,right:r}}}(e,o);return{type:"relationship-ramp",numClasses:r,focus:e,colors:i,labels:a,rotation:R(e)}}function R(t){let e=q[t];return t&&null==e&&(e=q.HH),e||0}let P=null;const E=[255,255,255];function V(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function F(t,e,s){const{backgroundColor:r,outline:l,dotSize:o}=t,i=s&&s.swatchSize||m.size,a=Math.round(i*i/o**2*.8),n=window.devicePixelRatio,c=document.createElement("canvas"),u=i*n;c.width=u,c.height=u,c.style.width=c.width/n+"px",c.style.height=c.height/n+"px";const p=c.getContext("2d");if(r&&(p.fillStyle=r.toCss(!0),p.fillRect(0,0,u,u),p.fill()),p.fillStyle=e?.toCss(!0)??"",P&&P.length/2===a)for(let t=0;t<2*a;t+=2){const e=P[t],s=P[t+1];p.fillRect(e,s,o*n,o*n),p.fill()}else{P=[];for(let t=0;t<2*a;t+=2){const t=V(0,u),e=V(0,u);P.push(t,e),p.fillRect(t,e,o*n,o*n),p.fill()}}l&&(l.color&&(p.strokeStyle=l.color.toCss(!0)),p.lineWidth=l.width,p.strokeRect(0,0,u,u));const h=new Image(i,i);return h.src=c.toDataURL(),h.ariaLabel=s?.ariaLabel??null,h.alt=s?.ariaLabel??"",h}function W(t,e={}){const r=e.radius||40,l=2*Math.PI*r,o=t.length,i=l/o,a=[],n=s(e.outline);null!=n?.width&&(n.width*=2),(n||e.backgroundColor)&&a.push({shape:{type:"circle",cx:r,cy:r,r},fill:e.backgroundColor,stroke:n,offset:[0,0]});const c=e.values,m=c&&c.length===o&&100===c.reduce(((t,e)=>t+e),0),u=[0];for(let e=0;e<o;e++){let s=null;m&&(s=c[e]*l/100,u.push(s+u[e])),a.push({shape:{type:"circle",cx:r,cy:r,r:r/2},fill:[0,0,0,0],stroke:{width:r,dashArray:`${(s??i)/2} ${l}`,dashoffset:"-"+(m?u[e]/2:e*(i/2)),color:t[e]},offset:[0,0]})}let p=null;const h=2*r+(n?.width||0),b=e.holePercentage;if(b){n&&a.push({shape:{type:"circle",cx:r,cy:r,r:r*b},fill:null,stroke:n,offset:[0,0]});const t=h/2;p=[[{shape:{type:"circle",cx:t,cy:t,r:t},fill:E,stroke:n?{...n,color:E}:null,offset:[0,0]},{shape:{type:"circle",cx:t,cy:t,r:r*b},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return j([a],[h,h],{effectView:e.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90,ariaLabel:e.ariaLabel})}function A(t,e={}){const s=t?.authoringInfo;if("relationship"!==s?.type||!s?.numClasses||!t.uniqueValueInfos)return null;const{focus:r,numClasses:l}=s,o=_({focus:r,numClasses:l,infos:t.uniqueValueInfos}),i=e&&e.node||document.createElement("div");return k(i,(()=>H(o,e.id||"relationship",{opacity:e.opacity||1,effectList:e.effectList,ariaLabel:e.ariaLabel}))),i}function O(t,s={}){const r="horizontal"===s.align,l=r?75:24,o=r?24:75,i=s.width??l,a=s.height??o,n=s.gradient??!0,c=window.devicePixelRatio,m=i*c,u=a*c,p=document.createElement("canvas");p.width=m,p.height=u,p.ariaLabel=s.ariaLabel??null,p.style.width=`${i}px`,p.style.height=`${a}px`;const h=p.getContext("2d"),b=r?m:0,d=r?0:u;if(n){const e=h.createLinearGradient(0,0,b,d),s=t.length,r=1===s?0:1/(s-1);t.forEach(((t,s)=>e.addColorStop(s*r,t.toString()))),h.fillStyle=e,h.fillRect(0,0,m,u)}else{const e=r?m/t.length:m,s=r?u:u/t.length;let l=0,o=0;for(const i of t)h.fillStyle=i.toString(),h.fillRect(l,o,e,s),l=r?l+e:0,o=r?0:o+s}const y=document.createElement("div");return y.style.width=`${i}px`,y.style.height=`${a}px`,function(t,s){if(!s)return;t.style.filter=e(s);const r=s.effects;if(r)for(const e of r)if("drop-shadow"===e?.type){e.offsetX<0?t.style.marginLeft=`${Math.abs(e.offsetX)}px`:t.style.marginRight=`${e.offsetX}px`;break}}(y,s?.effectList),y.appendChild(p),y}async function B(t,e){switch(t.type){case"web-style":{const{previewWebStyleSymbol:s}=await import("../../chunks/previewWebStyleSymbol.js");return s(t,B,e)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:s}=await import("../../chunks/previewSymbol3D.js");return s(t,e)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:s}=await import("../../chunks/previewSymbol2D.js");return s(t,e)}case"cim":{const{previewCIMSymbol:s}=await import("../../chunks/previewCIMSymbol.js");return s(t,e)}default:return}}function I(t){return t&&"opacity"in t?t.opacity*I(t.parent):1}async function z(e,s){if(!e)return;const r=e.sourceLayer,n=(null!=s&&s.useSourceLayer?r:e.layer)??r,c=I(n);if(null!=e.symbol&&(null==s||!0!==s.ignoreGraphicSymbol)){const t="web-style"===e.symbol.type?await l(e.symbol,{...s,cache:null!=s?s.webStyleCache:null}):e.symbol.clone();return o(t,null,c),t}const m=(null!=s?s.renderer:null)??(n&&"renderer"in n?n.renderer:null);let u=m&&"getSymbolAsync"in m?await m.getSymbolAsync(e,s):null;if(!u)return;if(u="web-style"===u.type?await u.fetchSymbol({...s,cache:null!=s?s.webStyleCache:null}):u.clone(),!(m&&"visualVariables"in m&&m.visualVariables&&m.visualVariables.length))return o(u,null,c),u;if("arcadeRequiredForVisualVariables"in m&&m.arcadeRequiredForVisualVariables&&(null==s||null==s.arcade)){const e={...s};e.arcade=await t(),s=e}const{getColor:p,getOpacity:h,getAllSizes:b,getRotationAngle:d}=await import("../../chunks/visualVariableUtils.js").then((t=>t.l)),y=[],f=[],j=[],k=[];for(const t of m.visualVariables)switch(t.type){case"color":y.push(t);break;case"opacity":f.push(t);break;case"rotation":k.push(t);break;case"size":t.target||j.push(t)}const g=!!y.length&&y[y.length-1],L=g?p(g,e,s):null,S=!!f.length&&f[f.length-1];let w=S?h(S,e,s):null;if(null!=c&&(w=null!=w?w*c:c),o(u,L,w),j.length){const t=b(j,e,s);await i(u,t)}for(const t of k)a(u,d(t,e,s),t.axis);return u}async function G(e,s){if(!e)return;const r=I(e.layer||e.sourceLayer);if(null!=e.symbol&&(null==s||!0!==s.ignoreGraphicSymbol)){const t="web-style"===e.symbol.type?await l(e.symbol,s):e.symbol.clone();return n(t,r)}const o=null!=s&&s.renderer||e.get("layer.renderer")||e.get("sourceLayer.renderer");let i=await o.getSymbolAsync(e,s);if(!i)return;i="web-style"===i.type?await l(i,s):i.clone();const a=n(i,r);if(!("visualVariables"in o)||"visualVariables"in o&&!o.visualVariables||"visualVariables"in o&&!o.visualVariables?.length)return a;if(o.arcadeRequiredForVisualVariables&&(null==s||null==s.arcade)){const e={...s};e.arcade=await t(),s=e}const{getColor:m,getOpacity:u}=await import("../../chunks/visualVariableUtils.js").then((t=>t.l)),p=[],h=[];for(const t of o.visualVariables)switch(t.type){case"color":p.push(t);break;case"opacity":h.push(t)}const b=p.length>0?p[p.length-1]:null,d=b?m(b,e,s):a,y=h.length>0?h[h.length-1]:null;let f=y?u(y,e,s):null;return null!=r&&(f=null!=f?f*r:r),d?c(d,f):null}export{R as a,_ as g,G as getDisplayedColor,z as getDisplayedSymbol,H as r,O as renderColorRampPreviewHTML,F as renderDotDensityPreviewHTML,W as renderPieChartPreviewHTML,B as renderPreviewHTML,A as renderRelationshipRampPreviewHTML};
