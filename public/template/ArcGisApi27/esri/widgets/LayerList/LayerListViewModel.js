// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ListItem ./support/layerListUtils".split(" "),function(t,k,f,x,g,l,z,A,B,y,u,q){const v=f.ofType(u);f=function(w){function p(a){a=w.call(this,a)||this;a.checkPublishStatusEnabled=!1;a.listItemCreatedFunction=
null;a.operationalItems=new v;a.view=null;return a}t._inherits(p,w);var e=p.prototype;e.initialize=function(){this.addHandles([g.watch(()=>[this.view,this.view?.ready],()=>this._viewHandles(),g.initial),g.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],"view")};e.destroy=function(){this.removeAllHandles();this.view=null;this.operationalItems.removeAll()};e.triggerAction=function(a,b){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:b})};
e.moveListItem=function(a,b,c,d){const m=a?.layer;if(m){var h=this.view?.map?.layers,r=b?q.getItemLayers(b):h;h=c?q.getItemLayers(c):h;if(r&&h){var {operationalItems:n}=this;b=b?.children||n;n=c?.children||n;d=h.length-d;a.parent=c||null;b.includes(a)&&b.remove(a);r.includes(m)&&r.remove(m);n.includes(a)||n.add(a,d);h.includes(m)||h.add(m,d)}}};e._createLayerViewHandles=function(a){this.removeHandles("layer-views");this._compileList();a&&this.addHandles(a.on("change",()=>this._compileList()),"layer-views")};
e._createMapLayerHandles=function(a){this.removeHandles("map-layers");this._compileList();a&&this.addHandles(a.on("change",()=>this._compileList()),"map-layers")};e._createListItem=function(a){const {view:b,listItemCreatedFunction:c,checkPublishStatusEnabled:d}=this;return new u({checkPublishStatusEnabled:d,layer:a,listItemCreatedFunction:c,view:b})};e._removeAllItems=function(){this.operationalItems.removeAll()};e._getViewableLayers=function(a){if(a)return a.filter(b=>"hide"!==q.findLayerListMode(b))};
e._watchLayersListMode=function(a){this.removeHandles("layer-list-mode");a&&a.forEach(b=>{"listMode"in b&&this.addHandles(g.watch(()=>b.listMode,()=>this._compileList()),"layer-list-mode")})};e._compileList=function(){var a=this.get("view.map.layers");this._watchLayersListMode(a);(a=this._getViewableLayers(a))&&a.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a)):this._removeAllItems()};e._createNewItems=function(a){const {operationalItems:b}=this;a.forEach(c=>{b.find(d=>d.layer===
c)||b.add(this._createListItem(c))})};e._removeItems=function(a){const {operationalItems:b}=this,c=[];b.forEach(d=>{d&&a&&a.includes(d.layer)||c.push(d)});b.removeMany(c)};e._sortItems=function(a){const {operationalItems:b}=this;b.sort((c,d)=>{c=a.indexOf(c.layer);d=a.indexOf(d.layer);return c>d?-1:c<d?1:0})};e._recompileList=function(){this._removeAllItems();this._compileList()};e._viewHandles=function(){const {view:a}=this;this.removeHandles(["map-layers","layer-views","view-layers"]);this._recompileList();
a&&a.ready&&this.addHandles([g.watch(()=>this.view?.map?.allLayers,b=>this._createMapLayerHandles(b),g.initial),g.watch(()=>this.view?.allLayerViews,b=>this._createLayerViewHandles(b),g.initial)],"view-layers")};t._createClass(p,[{key:"state",get:function(){const a=this.get("view");return this.get("view.ready")?"ready":a?"loading":"disabled"}}]);return p}(x.EventedAccessor);k.__decorate([l.property()],f.prototype,"checkPublishStatusEnabled",void 0);k.__decorate([l.property()],f.prototype,"listItemCreatedFunction",
void 0);k.__decorate([l.property({type:v})],f.prototype,"operationalItems",void 0);k.__decorate([l.property({readOnly:!0})],f.prototype,"state",null);k.__decorate([l.property()],f.prototype,"view",void 0);return f=k.__decorate([y.subclass("esri.widgets.LayerList.LayerListViewModel")],f)});