// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../intl ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../symbols/support/svgUtils ../../../symbols/support/utils ../../Widget ./CardCSS ./support/relationshipUtils ./support/univariateUtils ../support/styleUtils ../../support/Heading ../../support/decorators/accessibleHandler ../../support/decorators/messageBundle ../../support/jsxFactory ../../support/widgetUtils ../../../intl/substitute".split(" "),
function(F,v,u,G,H,w,S,T,U,M,N,I,O,e,P,t,q,B,Q,J,f,K,R){var A;(function(y){y.Auto="auto";y.Stack="stack";y.SideBySide="side-by-side"})(A||(A={}));const z=window.devicePixelRatio;u=function(y){function E(a,c){a=y.call(this,a,c)||this;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.headingLevel=3;a.layout=A.Stack;a.messages=null;a.messagesCommon=null;a.type="card";a.view=null;return a}F._inherits(E,y);var p=E.prototype;p.initialize=
function(){this.addHandles(G.watch(()=>this.activeLayerInfos,a=>{this.removeAllHandles();this._watchForSectionChanges(a)}))};p.render=function(){var {view:a}=this;this._hasIndicators=this.layout===A.Auto&&a&&768>=a.container.clientWidth||this.layout===A.Stack;a=(a=this.activeLayerInfos)&&a.toArray().map(b=>this._renderLegendForLayer(b)).filter(b=>!!b);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&
this._sectionNames[0]):this._selectedSectionName=null;const c=this._sectionNames.length;var d=this._sectionNames.map((b,h)=>{h=R.substitute(this.messagesCommon.pagination.pageText,{index:h+1,total:c});return f.tsx("div",{key:b,role:"tab",id:b,"aria-label":h,"aria-controls":`${b}-panel`,"aria-selected":(this._selectedSectionName===b).toString(),tabIndex:this._selectedSectionName===b?0:-1,title:h,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(e.CSS.indicator,{[e.CSS.activated]:this._selectedSectionName===
b}),"data-section-name":b})});d=this._hasIndicators&&1<c?f.tsx("div",{class:e.CSS.indicatorContainer,key:"carousel-navigation",role:"tablist"},d):null;a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):a&&a.length?a:null;return f.tsx("div",{class:this.classes(e.CSS.base,{[e.CSS.stacked]:this._hasIndicators})},a||f.tsx("div",{class:e.CSS.message},this.messages.noLegend),d)};p._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};
p._focusSection=function(a){switch(a.key){case "ArrowLeft":case "ArrowRight":this._switchSectionOnArrowPress(a);break;case "Enter":case " ":this._selectSection(a)}};p._switchSectionOnArrowPress=function(a){const c=a.key,d="ArrowLeft"===c?-1:1;a=a.target.getAttribute("data-section-name");a=this._sectionNames.indexOf(a);const b=this._sectionNames;let h=null;-1!==a&&(b[a+d]?h=document.getElementById(b[a+d]):"ArrowLeft"===c?h=document.getElementById(b[b.length-1]):"ArrowRight"===c&&(h=document.getElementById(b[0])),
h?.focus())};p._watchForSectionChanges=function(a){this._generateSectionNames();a&&(a.forEach(c=>{const d=`activeLayerInfo-${c.layer.uid}-version-change`;this.removeHandles(d);this._watchForSectionChanges(c.children);this.addHandles(G.watch(()=>c.version,()=>this._generateSectionNames()),d)}),this.removeHandles("activeLayerInfos-collection-change"),this.addHandles(a.on("change",()=>this._watchForSectionChanges(a)),"activeLayerInfos-collection-change"))};p._generateSectionNames=function(){this._sectionNames.length=
0;this._selectedSectionName=null;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)};p._getSectionName=function(a,c,d){return`${this.id}${a.uid}-type-${c.type}-${d}`};p._generateSectionNamesForActiveLayerInfo=function(a){a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach((c,d)=>{this._sectionNames.push(this._getSectionName(a.layer,c,d))})};p._renderLegendForLayer=function(a){if(!a.ready)return null;
if(a.children.length){var c=a.children.map(b=>this._renderLegendForLayer(b)).toArray();return f.tsx("div",{key:a.layer.uid,class:this.classes(e.CSS.service,e.CSS.groupLayer)},f.tsx("div",{class:e.CSS.serviceCaptionContainer},a.title),c)}if((c=a.legendElements)&&!c.length)return null;const d=c.some(b=>"relationship-ramp"===b.type);c=c.map((b,h)=>this._renderLegendForElement(b,a,h,d)).filter(b=>!!b);return c.length?f.tsx("div",{key:a.layer.uid,class:this.classes(e.CSS.service,{[e.CSS.groupLayerChild]:!!a.parent})},
f.tsx("div",{class:e.CSS.serviceCaptionContainer},f.tsx("div",{class:e.CSS.serviceCaptionText},a.title)),f.tsx("div",{class:e.CSS.serviceContent},c)):null};p._renderLegendForElement=function(a,c,d,b=!1,h=!1){var k="color-ramp"===a.type,g="opacity-ramp"===a.type,l="size-ramp"===a.type;const m=c.layer;var n=null;"string"===typeof a.title?n=a.title:a.title&&(n=a.title,k=q.getTitle(this.messages,n,k||g),n=n.title?`${n.title} (${k})`:k);d=this._getSectionName(m,a,d);k=this._hasIndicators&&!h?f.tsx("div",
null,f.tsx(B.Heading,{level:this.headingLevel,class:e.CSS.carouselTitle},c.title),f.tsx(B.Heading,{level:B.incrementHeadingLevel(this.headingLevel),class:e.CSS.layerCaption},n)):n?f.tsx(B.Heading,{level:this.headingLevel,class:e.CSS.layerCaption},n):null;n=c.effectList;g=null;"symbol-table"===a.type?(l=a.infos.map((r,x)=>this._renderLegendForElementInfo(r,c,a.legendType,x)).filter(r=>!!r),l.length&&(g=f.tsx("div",{class:this.classes({[e.CSS.labelContainer]:!(l[0].properties.classes&&l[0].properties.classes[e.CSS.symbolRow])&&
!b,[e.CSS.relationshipLabelContainer]:b})},l))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?g=this._renderLegendForRamp(a,m.opacity,n):l?g=this._renderSizeRamp(a,m.opacity):"pie-chart-ramp"===a.type?g=this._renderPieChartRamp(a):"relationship-ramp"===a.type?g=P.renderRelationshipRamp(a,this.id,{opacity:m.opacity,effectList:n,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"univariate-above-and-below-ramp"===a.type?g=this._renderUnivariateAboveAndBelowRamp(a,
m.opacity,n):"univariate-color-size-ramp"===a.type&&(g=this._renderUnivariateColorSizeRamp(a,m.opacity,n));if(!g)return null;b=f.tsx("div",{key:d,class:e.CSS.section,id:`${d}-panel`,role:"tabpanel","aria-labelledby":d,tabIndex:0},[k,g]);h||this._sectionMap.set(d,b);return b};p._renderPieChartRamp=function(a){return f.tsx("div",{class:e.CSS.pieChartRampPreview,bind:a.preview,afterCreate:q.attachToNode})};p._renderUnivariateAboveAndBelowRamp=function(a,c,d){const {sizeRampElement:b,colorRampElement:h}=
t.getUnivariateAboveAndBelowRampElements(a,c,"horizontal");if(!b)return null;a=t.getUnivariateSizeRampSize(b,"full",!0,"horizontal");var k=t.getUnivariateColorRampSize(b,"above",!0,"horizontal"),g=t.getUnivariateColorRampSize(b,"below",!0,"horizontal"),l=this.messages?.previewColorRampAriaLabel;k=t.getUnivariateColorRampPreview(h,{width:k,height:12,rampAlignment:"horizontal",opacity:c,type:"above",effectList:d,ariaLabel:l});c=t.getUnivariateColorRampPreview(h,{width:g,height:12,rampAlignment:"horizontal",
opacity:c,type:"below",effectList:d,ariaLabel:l});d=t.getUnivariateColorRampMargin(b,"card");g=b.infos.map(n=>n.label);const m=g.length-1;g=g.map((n,r)=>0===r||r===m?f.tsx("div",{key:r},n):null);l={marginTop:"3px",display:"flex"};K.isRTL(this.container)?l.marginRight=`${d}px`:l.marginLeft=`${d}px`;a={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return f.tsx("div",{class:e.CSS.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},f.tsx("div",
{class:this.classes(e.CSS.symbolContainer,e.CSS.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},b.infos.map((n,r)=>f.tsx("div",{key:r,class:e.CSS.symbol,bind:n.preview,afterCreate:q.attachToNode}))),k?f.tsx("div",{class:e.CSS.univariateAboveAndBelowColorRamp,styles:l,key:"color-ramp-preview"},f.tsx("div",{bind:k,afterCreate:q.attachToNode}),f.tsx("div",{bind:c,afterCreate:q.attachToNode})):null,f.tsx("div",{class:e.CSS.layerInfo},f.tsx("div",{class:e.CSS.rampLabelsContainer,styles:a},
g)))};p._renderUnivariateColorSizeRamp=function(a,c,d){const {sizeRampElement:b,colorRampElement:h}=t.getUnivariateColorSizeRampElements(a,"horizontal");if(!b)return null;a=t.getUnivariateSizeRampSize(b,"full",!1,"horizontal");var k=t.getUnivariateColorRampSize(b,"full",!1,"horizontal");c=t.getUnivariateColorRampPreview(h,{width:k,height:12,rampAlignment:"horizontal",opacity:c,type:"full",effectList:d,ariaLabel:this.messages?.previewColorRampAriaLabel});const g=t.getUnivariateColorRampMargin(b,"card"),
l=b.infos.length-1;d=b.infos.map((m,n)=>0===n||n===l?f.tsx("div",{key:n},m.label):null);k={marginTop:"3px",display:"flex"};K.isRTL(this.container)?k.marginRight=`${g}px`:k.marginLeft=`${g}px`;a={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return f.tsx("div",{class:e.CSS.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},f.tsx("div",{class:this.classes(e.CSS.symbolContainer,e.CSS.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},
b.infos.map((m,n)=>f.tsx("div",{key:n,class:e.CSS.symbol,bind:m.preview,afterCreate:q.attachToNode}))),f.tsx("div",{class:e.CSS.univariateAboveAndBelowColorRamp,styles:k,key:"color-ramp-preview"},f.tsx("div",{bind:c,afterCreate:q.attachToNode})),f.tsx("div",{class:e.CSS.layerInfo},f.tsx("div",{class:e.CSS.rampLabelsContainer,styles:a},d)))};p._renderLegendForElementInfo=function(a,c,d,b){var h=c.layer;if(a.type)return this._renderLegendForElement(a,c,b,!1,!0);d=q.isImageryStretchedLegend(h,d);if(a.preview){if(!a.symbol||
!a.symbol.type.includes("simple-fill")){if(!a.label)return f.tsx("div",{key:b,bind:a.preview,afterCreate:q.attachToNode});c={[e.CSS.symbolCell]:this._hasIndicators};return f.tsx("div",{key:b,class:this.classes(e.CSS.layerRow,{[e.CSS.symbolRow]:this._hasIndicators})},f.tsx("div",{class:this.classes(c),bind:a.preview,afterCreate:q.attachToNode}),f.tsx("div",{class:this.classes(e.CSS.imageLabel,{[e.CSS.labelCell]:this._hasIndicators})},q.getTitle(this.messages,a.label,!1)||""))}let k=d=255,g=255,l=0,
m=255,n=255,r=255,x=0;const C=a.symbol.color&&a.symbol.color.a,L=a.symbol.outline&&a.symbol.outline.color&&a.symbol.outline.color.a;C&&(d=a.symbol.color.r,k=a.symbol.color.g,g=a.symbol.color.b,l=a.symbol.color.a*h.opacity);L&&(m=a.symbol.outline.color.r,n=a.symbol.outline.color.g,r=a.symbol.outline.color.b,x=a.symbol.outline.color.a*h.opacity);const D=(h=a.symbol.color?.isBright??!0)?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";c={background:C?`rgba(${d}, ${k}, ${g}, ${l})`:"none",color:h?"black":
"white",textShadow:`-1px -1px 0 ${D},\n                                              1px -1px 0 ${D},\n                                              -1px 1px 0 ${D},\n                                              1px 1px 0 ${D}`,border:L?`1px solid rgba(${m}, ${n}, ${r}, ${x})`:"none",filter:I.getCSSFilterFromEffectList(c.effectList)??void 0};return f.tsx("div",{key:b,class:e.CSS.layerRow},f.tsx("div",{class:e.CSS.labelElement,styles:c}," ",a.label," "))}if(a.src)return c=this._renderImage(a,h,d),
f.tsx("div",{key:b,class:e.CSS.layerRow},c,f.tsx("div",{class:e.CSS.imageLabel},a.label||""))};p._renderImage=function(a,c,d){const {label:b,src:h,opacity:k}=a;d={[e.CSS.imageryLayerStretchedImage]:d,[e.CSS.symbol]:!d};c={opacity:`${null!=k?k:c.opacity}`};return f.tsx("img",{alt:q.getTitle(this.messages,b,!1),"aria-label":q.getTitle(this.messages,b,!1),src:h,border:0,width:a.width,height:a.height,class:this.classes(d),styles:c})};p._renderSizeRampLines=function(a){a=a.infos;var c=a[0],d=a[a.length-
1],b=c.symbol;a=this._hasIndicators;c=H.pt2px(c.size+c.outlineSize)*z;d=H.pt2px(d.size+d.outlineSize)*z;const h=a?c:c+50*z,k=a?c/2+50*z:c;var g;b?b.type.includes("3d")?(g=b.symbolLayers&&b.symbolLayers.length)?(g=b.symbolLayers.at(g-1).get("resource.primitive"),g="triangle"===g||"cone"===g||"tetrahedron"===g):g=void 0:g="triangle"===b.style:g=void 0;if(b)if(b.type.includes("3d")){var l=b.symbolLayers&&b.symbolLayers.length;l?(b=b.symbolLayers.at(l-1),b=b.resource&&b.resource.primitive,b="circle"===
b||"cross"===b||"kite"===b||"sphere"===b||"cube"===b||"diamond"===b):b=void 0}else b=b.style,b="circle"===b||"diamond"===b||"cross"===b;else b=void 0;l=document.createElement("canvas");l.width=h;l.height=k;l.style.width=`${l.width/z}px`;l.style.height=`${l.height/z}px`;const m=l.getContext("2d");if(a){m.beginPath();var n=h/2-d/2;m.moveTo(0,0);m.lineTo(n,k);n=h/2+d/2;m.moveTo(h,0);m.lineTo(n,k)}else m.beginPath(),m.moveTo(0,k/2-d/2),m.lineTo(h,0),m.moveTo(0,k/2+d/2),m.lineTo(h,k);m.strokeStyle="#ddd";
m.stroke();return f.tsx("div",{bind:l,afterCreate:q.attachToNode,styles:a?{display:"flex",marginTop:`-${g?0:b?c/2:0}px`,marginBottom:`-${g?d:b?d/2:0}px`}:{display:"flex",marginRight:`-${g?0:b?c/2:0}px`,marginLeft:`-${g?0:b?d/2:0}px`}})};p._renderSizeRamp=function(a,c){var d=a.infos;const b=d[0].label,h=d[d.length-1].label;let k=d[0].preview;d=d[d.length-1].preview;const g=this._hasIndicators,l={"flex-direction":g?"column":"row-reverse"};k&&(k=k.cloneNode(!0),k.style.display="flex");d&&(d=d.cloneNode(!0),
d.style.display="flex");c={opacity:null!=c?`${c}`:""};return f.tsx("div",{class:this.classes(e.CSS.layerRow,{[e.CSS.sizeRampRow]:g})},f.tsx("div",{class:e.CSS.rampLabel},g?b:h),f.tsx("div",{class:e.CSS.sizeRampContainer,styles:l},f.tsx("div",{bind:k,afterCreate:q.attachToNode,class:e.CSS.sizeRampPreview,styles:c}),this._renderSizeRampLines(a),f.tsx("div",{bind:d,afterCreate:q.attachToNode,class:e.CSS.sizeRampContainer,styles:c})),f.tsx("div",{class:e.CSS.rampLabel},g?h:b))};p._renderLegendForRamp=
function(a,c,d){var b=a.infos;const h="heatmap-ramp"===a.type,k=b.length-1;var g=2<k&&!h?25*k:100,l=g+20;const m=b.slice(0).reverse();m.forEach((x,C)=>{x.offset=h?x.ratio:C/k});const n=m.length-1;a=(a=0!==m.length%2&&m[m.length/2|0])&&f.tsx("div",{class:e.CSS.intervalSeparatorsContainer},f.tsx("div",{class:e.CSS.intervalSeparator},"|"),f.tsx("div",{class:e.CSS.rampLabel},a.label));const r=b[b.length-1].label;b=b[0].label;g=N.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:m[0].color,
stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:g,height:25},fill:{type:"linear",x1:10,y1:0,x2:g+10,y2:0,colors:m},stroke:{width:0}},{shape:{type:"path",path:`M${g+10} 0 L${l} ${12.5} L${g+10} ${25} Z`},fill:m[n].color,stroke:{width:0}}]],l,25);({messages:l}=this);c={filter:I.getCSSFilterFromEffectList(d)??void 0,opacity:null==c?void 0:`${c}`};return f.tsx("div",{class:e.CSS.layerRow,styles:{justifyContent:"center"}},f.tsx("div",{class:e.CSS.rampLabel},h?l[r]:r),f.tsx("div",{class:e.CSS.symbolContainer},
f.tsx("div",{styles:c},g),a),f.tsx("div",{class:e.CSS.rampLabel},h?l[b]:b))};return F._createClass(E)}(O);v.__decorate([w.property()],u.prototype,"activeLayerInfos",void 0);v.__decorate([w.property()],u.prototype,"headingLevel",void 0);v.__decorate([w.property()],u.prototype,"layout",void 0);v.__decorate([w.property(),J.messageBundle("esri/widgets/Legend/t9n/Legend")],u.prototype,"messages",void 0);v.__decorate([w.property(),J.messageBundle("esri/t9n/common")],u.prototype,"messagesCommon",void 0);
v.__decorate([w.property({readOnly:!0})],u.prototype,"type",void 0);v.__decorate([w.property()],u.prototype,"view",void 0);v.__decorate([Q.accessibleHandler()],u.prototype,"_selectSection",null);return u=v.__decorate([M.subclass("esri.widgets.Legend.styles.Card")],u)});