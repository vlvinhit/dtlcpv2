// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/HandleOwner ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(k,c,m,b,n,p,q,d,u,v,w,r){b=function(l){function h(a){a=l.call(this,a)||this;a._indexHistory=[];a._lastStepIndex=-1;a._stepIndex=-1;a._setupAbortController=
null;a._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"};a.data=void 0;a.started=!1;a.steps=[];a.type=null;return a}k._inherits(h,l);var f=h.prototype;f.back=async function(a=()=>Promise.resolve(!0)){if(!this.hasPendingEdits||await a())this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0})};f.cancel=async function(a={force:!0}){return!1!==a.force?this._cancel(a):new Promise((e,g)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...a,
force:!0}).then(e)},deny:()=>g(new m("workflow:cancel-denied","Request to cancel workflow was denied."))}})})};f.commit=async function(){this.handles.remove(this._handleKeys.beforeCommit);await this.onCommit?.(this.data);this.handles.remove(this._handleKeys.afterCommit);this.emit("commit")};f.go=async function(a){var {steps:e}=this;e=e.findIndex(g=>g.id===a);this._indexHistory.push(this._stepIndex);await this._go(e)};f.next=async function(){this._indexHistory.push(this._stepIndex);await this._go(this._stepIndex+
1)};f.previous=async function(a={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),a.cancelCurrentStep)};f.reset=async function(){await this._cancel({notify:!1});await this.start()};f.save=async function(){await this.commit();await this.reset()};f.start=async function(){this._set("started",!0);await this._go(-1===this._stepIndex?0:this._stepIndex)};f._cancel=async function({notify:a=!0,error:e}={}){this.started&&(this._set("started",!1),await this.steps[this._stepIndex].tearDown({canceled:!0}));
this.handles.remove([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]);this._resetIndexing(a);a&&this.emit("cancel",{error:e})};f._go=async function(a=-1,e=!1){const {steps:g}=this;if(!(-1>=a||a>=g.length))if(this.started){-1<this._lastStepIndex&&(this._setupAbortController=p.abortMaybe(this._setupAbortController),await g[this._lastStepIndex].tearDown({canceled:e}));this._setupAbortController=new AbortController;e=this._setupAbortController.signal;try{await g[a].setUp(e)}catch(t){q.throwIfNotAbortError(t)}this._setupAbortController.signal===
e&&(this._setupAbortController=null);e.aborted||(this._stepIndex=this._lastStepIndex=a,this._notifyStepProps())}else this._stepIndex=a,this._notifyStepProps()};f._resetIndexing=function(a=!0){this._lastStepIndex=this._stepIndex=-1;this._indexHistory.length=0;a&&this._notifyStepProps()};f._notifyStepProps=function(){this.notifyChange("stepId");this.notifyChange("hasPreviousStep");this.notifyChange("hasNextStep")};k._createClass(h,[{key:"hasNextStep",get:function(){const {steps:a}=this;return!!(a&&
this._stepIndex<a.filter(e=>!e.parent).length-1)}},{key:"hasPreviousStep",get:function(){return 0<this._stepIndex}},{key:"reliesOnOwnerAdminPrivileges",get:function(){return!1}},{key:"hasInvalidFormTemplate",get:function(){return!1}},{key:"hasUnsupportedFields",get:function(){return!1}},{key:"shouldShowAttachments",get:function(){return!1}},{key:"shouldAllowAttachmentEditing",get:function(){return!1}},{key:"stepId",get:function(){var {steps:a}=this;return(a=a&&a[this._stepIndex])&&a.id}},{key:"helpMessage",
get:function(){}},{key:"hasPendingEdits",get:function(){return!1}},{key:"keyboardCancellationEnabled",get:function(){return!0}}]);return h}(n.HandleOwnerMixin(b.EventedAccessor));c.__decorate([d.property()],b.prototype,"data",void 0);c.__decorate([d.property()],b.prototype,"hasNextStep",null);c.__decorate([d.property()],b.prototype,"hasPreviousStep",null);c.__decorate([d.property()],b.prototype,"onCommit",void 0);c.__decorate([d.property()],b.prototype,"reliesOnOwnerAdminPrivileges",null);c.__decorate([d.property()],
b.prototype,"hasInvalidFormTemplate",null);c.__decorate([d.property()],b.prototype,"hasUnsupportedFields",null);c.__decorate([d.property()],b.prototype,"shouldShowAttachments",null);c.__decorate([d.property()],b.prototype,"shouldAllowAttachmentEditing",null);c.__decorate([d.property()],b.prototype,"started",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"stepId",null);c.__decorate([d.property()],b.prototype,"steps",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"type",
void 0);c.__decorate([d.property()],b.prototype,"helpMessage",null);c.__decorate([d.property()],b.prototype,"hasPendingEdits",null);c.__decorate([d.property()],b.prototype,"keyboardCancellationEnabled",null);return b=c.__decorate([r.subclass("esri.widgets.Editor.Workflow")],b)});