// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Error ../../core/events ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/infoFor3D".split(" "),function(u,f,q,l,v,w,x,p,r,y,h,n,I,J,K,z,
A,t){async function B(e){return"showOpenFilePicker"in window&&!m?C(e):D(e)}async function C(e){try{const c=await window.showOpenFilePicker({multiple:!0,excludeAcceptAllOption:!0,types:t.getFilePickerAcceptTypes(e.infoFor3D)});return Promise.all(c.map(d=>d.getFile()))}catch(c){return h.throwIfNotAbortError(c),[]}}async function D(e){function c(){clearTimeout(a);a=setTimeout(()=>{if(document.hasFocus()){var k=b.files?Array.from(b.files):[];0===k.length&&(g.remove(),d.resolve(k))}},5E3)}const d=h.createResolver();
let a;const b=document.createElement("input");b.type="file";b.multiple=!0;b.accept=t.getSupportedExtensions(e.infoFor3D).join(",");const g=r.handlesGroup([p.on(b,"change",()=>{var k=b.files?Array.from(b.files):[];g.remove();d.resolve(k)}),r.makeHandle(()=>clearTimeout(a)),p.on(document,["focus","focusin"],c),p.on(window,["focus","focusin"],c)]);m?m(b):b.click();return d.promise.finally(()=>g.remove())}f.Upload=function(e){function c(){var a=e.call(this,{})||this;a._uploadTask=null;return a}q._inherits(c,
e);var d=c.prototype;d.destroy=function(){this.cancel()};d.uploadTo=function(a){this.cancel();this._uploadTask=w.createTask(async b=>{var g=await B(a);h.throwIfAborted(b);if(0===g.length)throw h.createAbortError();const k=(await new Promise((E,F)=>u(["../../geometry/Mesh"],G=>E(Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}))),F))).default;h.throwIfAborted(b);const H=new A({x:0,y:0,z:0,spatialReference:a.spatialReference});g=await k.createFromFiles(H,
g,{layer:a,signal:b});h.throwIfAborted(b);if(!g)throw new x("editor:upload","could not upload or convert model");return g.load()})};d.cancel=function(){this._uploadTask=y.abortMaybe(this._uploadTask)};q._createClass(c,[{key:"state",get:function(){const a=this._uploadTask;return a?a.finished?a.error?h.isAbortError(a.error)?"canceled":"error":"success":"pending":"default"}},{key:"result",get:function(){return this._uploadTask?.value??null}},{key:"error",get:function(){return this._uploadTask?.error??
null}}]);return c}(v);l.__decorate([n.property()],f.Upload.prototype,"state",null);l.__decorate([n.property()],f.Upload.prototype,"result",null);l.__decorate([n.property()],f.Upload.prototype,"error",null);l.__decorate([n.property()],f.Upload.prototype,"_uploadTask",void 0);f.Upload=l.__decorate([z.subclass("esri.widgets.Editor.Upload")],f.Upload);let m=null;f.clearPromptForFilesStub=function(){m=null};f.simulateSelectingFiles=function(e){m=c=>{setTimeout(()=>{const d=new DataTransfer;e.forEach(a=>
d.items.add(a));c.files=d.files;c.dispatchEvent(new Event("change"))})}};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});