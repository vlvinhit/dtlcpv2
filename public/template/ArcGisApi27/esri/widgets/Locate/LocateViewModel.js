// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../PopupTemplate ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Popup/actions ../support/GeolocationPositioning ../support/geolocationUtils ../../intl/locale ../../intl/messages".split(" "),function(l,e,d,n,m,p,f,y,z,A,q,r,t,u,v,w){async function x(){const b=
await w.fetchMessageBundle("esri/widgets/Locate/t9n/Locate");return new n({title:b.currentLocation,fieldInfos:[{fieldName:"timestamp",label:b.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:b.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:b.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:b.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:b.altitude,format:{places:0,digitSeparator:!0}},
{fieldName:"altitudeAccuracy",label:b.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:b.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:b.speed,format:{places:0,digitSeparator:!0}}],actions:[r.removeSelectedFeature.clone()],content:[{type:"fields"}]})}d=function(b){function h(a){a=b.call(this,a)||this;a._locateController=null;a.popupEnabled=!0;a.locate=a.locate.bind(l._assertThisInitialized(a));return a}l._inherits(h,b);var g=h.prototype;g.initialize=
function(){this.addHandles([v.onLocaleChange(()=>{const {graphic:a,view:c}=this;a&&c?.graphics?.includes(a)&&this._updatePopupTemplate(a)})])};g.destroy=function(){this.cancelLocate()};g.locate=async function(){this.cancelLocate();if("disabled"===this.state)throw new m("locate:disabled-state","Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new m("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const a=new AbortController;this._locateController=a;
try{const c=await u.getCurrentPosition(this.geolocationOptions);await this.updatePosition(c,a);if(this._locateController!==a)return null;const {graphic:k}=this;k&&await this._updatePopupTemplate(k);this._addGraphic();this.emit("locate",{position:c});this._locateController=null;return c}catch(c){if(p.isAbortError(c))return null;a===this._locateController&&(this._locateController=null);this.emit("locate-error",{error:c});throw c;}};g.cancelLocate=function(){this._clearGraphic();this._locateController&&
this._locateController.abort();this._locateController=null};g._updatePopupTemplate=async function(a){if(this.popupEnabled){var c=await x(),k=a!==this.graphic;this.destroyed||k||(a.popupTemplate=c)}};l._createClass(h,[{key:"state",get:function(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"}}]);return h}(t);e.__decorate([f.property()],d.prototype,"_locateController",void 0);e.__decorate([f.property()],d.prototype,"popupEnabled",
void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"state",null);e.__decorate([f.property()],d.prototype,"locate",null);e.__decorate([f.property()],d.prototype,"cancelLocate",null);return d=e.__decorate([q.subclass("esri.widgets.Locate.LocateViewModel")],d)});