// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/Accessor ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../layers/support/layerUtils ../../rest/networks/support/ValidateNetworkTopologyParameters ../../intl/locale ../../intl/messages".split(" "),
function(p,e,c,u,v,q,w,x,r,g,E,F,G,y,z,A,B,C,D){c=function(t){function l(a){a=t.call(this,a)||this;a._activeOperationDidSucceed=!1;a._initialValidationsFinished=!1;a._dirtyAreasLayer=null;a._noViewPropertyErrorMessage="Property 'view' is missing on UtilityNetworkValidateTopologyViewModel.";a._validView=!1;a.executionError="";a.extentToValidate="current";a.loadErrors=new v;return a}p._inherits(l,t);var m=l.prototype;m.initialize=function(){const a=async()=>{this.messages||(this.messages=await D.fetchMessageBundle("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};
a().then(()=>{this.view||(this.view=null);this.utilityNetwork||(this.utilityNetwork=null);this.addHandles([r.watch(()=>[this.view,this.utilityNetwork],async()=>{const {loadErrors:b,messages:f}=this,h=f.info;this._initialValidationsFinished=!1;b.removeAll();this._validView=!0;this._dirtyAreasLayer=null;this.view&&"2d"===this.view.type||(this._validView=!1,x.getLogger(this).error(new q("validateNetworkTopology:missing-property",this._noViewPropertyErrorMessage)));if(this.utilityNetwork&&"utility"===
this.utilityNetwork.type){this.utilityNetwork.loaded||await this.utilityNetwork.load();await this._checkUtilityNetworkExtension();const d=1===b.length&&this.loadErrors.find(k=>k===h.noUtilityNetworkServiceUserTypeExtension);b.length&&!d||this._setDirtyAreasLayer();this._validView&&(this._initialValidationsFinished=!0)}else this.loadErrors.push(h.noUtilityNetwork)},{initial:!0}),r.on(()=>this.view?.map?.layers,"change",()=>{const {loadErrors:b,messages:f}=this,h=f.info,d=b.find(n=>n===h.noUtilityNetwork),
k=b.find(n=>n===h.noUtilityNetworkServiceUserTypeExtension);this._initialValidationsFinished=!1;d||(b.removeAll(),k&&b.push(h.noUtilityNetworkServiceUserTypeExtension),this._setDirtyAreasLayer());this._validView&&(this._initialValidationsFinished=!0)}),C.onLocaleChange(a)])})};m.validateTopology=async function(){const {messages:a,utilityNetwork:b,view:f}=this;if(!this.loadErrors.length){this._activeOperationDidSucceed=!1;this._set("executionError","");let h;h="current"===this.extentToValidate?{xmin:f?.extent.xmin,
ymin:f?.extent.ymin,xmax:f?.extent.xmax,ymax:f?.extent.ymax,spatialReference:{wkid:f?.spatialReference.wkid,latestWkid:f?.spatialReference.latestWkid}}:{xmin:b?.fullExtent?.xmin,ymin:b?.fullExtent?.ymin,xmax:b?.fullExtent?.xmax,ymax:b?.fullExtent?.ymax,spatialReference:{wkid:b?.spatialReference.wkid,latestWkid:b?.spatialReference.latestWkid}};this.updatingHandles.addPromise(b?.validateTopology(new B({gdbVersion:this._dirtyAreasLayer.gdbVersion,validateArea:new z(h)})).then(()=>{this._activeOperationDidSucceed=
!0},d=>{let k="Error: "+d;if(d instanceof q&&d.details&&d.details.raw)if(-2147208940===d.details.raw.extendedCode)k=a.info.noDirtyAreasInExtent;else if(-2147217146===d.details.raw.extendedCode||-2147220947===d.details.raw.extendedCode)k=a.info.cannotAcquireVersionLock;this._set("executionError",k)}))}};m._setDirtyAreasLayer=function(){var a=this.view?.map.layers;a&&((a=a.items.filter(b=>A.isFeatureLayer(b)).find(b=>b.parsedUrl?.path===this.utilityNetwork?.networkSystemLayers.dirtyAreasLayerUrl))?
this._dirtyAreasLayer=a:this.loadErrors.push(this.messages.info.noDirtyAreasLayer))};m._checkUtilityNetworkExtension=async function(){await this.utilityNetwork?.queryNamedTraceConfigurations({globalIds:["{AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA}"]}).catch(a=>{-2147208474===a.details.raw.extendedCode?this.loadErrors.push(this.messages.info.noUtilityNetworkServiceUserTypeExtension):this.loadErrors.push(a.message)})};p._createClass(l,[{key:"state",get:function(){return this.loadErrors.length?"disabled":
this.executionError?"failed":this.updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}},{key:"utilityNetwork",set:function(a){this._get("utilityNetwork")!==a&&this._set("utilityNetwork",a)}},{key:"view",set:function(a){this._get("view")!==a&&this._set("view",a)}}]);return l}(w.HandleOwnerMixin(u));e.__decorate([g.property()],c.prototype,"_initialValidationsFinished",void 0);e.__decorate([g.property()],c.prototype,"_dirtyAreasLayer",
void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"executionError",void 0);e.__decorate([g.property()],c.prototype,"extentToValidate",void 0);e.__decorate([g.property()],c.prototype,"loadErrors",void 0);e.__decorate([g.property()],c.prototype,"messages",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([g.property()],c.prototype,"utilityNetwork",null);e.__decorate([g.property()],c.prototype,"view",null);return c=e.__decorate([y.subclass("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],
c)});