// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/arrayUtils ../core/compilerUtils ../core/deprecate ../core/Logger ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Widget ./FeatureForm/css ./FeatureForm/featureFormUtils ./FeatureForm/FeatureFormViewModel ./support/componentsUtils ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ../chunks/datetime ../intl/substitute ../intl/locale".split(" "),
function(w,x,r,p,N,O,J,P,K,t,X,Q,R,l,n,S,T,H,Y,E,U,g,F,V,W){const L=P.getLogger("esri.widgets.FeatureForm");p=function(M){function G(a,b){var c=M.call(this,a,b)||this;c._dateFieldInputMap=new Map;c._activeInputName="";c._activeNumberFieldEdit=null;c._fieldFocusNeeded=!1;c._fieldToInitialIncompatibleDomainValue=new Map;c._switchFieldsWithInitialIncompatibleValue=new Set;c._userUpdatedFieldInputNames=new Set;c._listObserverNode=null;c._listObserver=new IntersectionObserver(d=>{d.length&&d[0].isIntersecting&&
c._incrementRelatedRecordPage()},{root:window.document});c.groupDisplay="all";c.headingLevel=2;c.messages=null;c.messagesCommon=null;c.messagesFeature=null;c.messagesTemplates=null;c.viewModel=new S;c._onShowAllRelatedRecordsClick=d=>{const {feature:h,relatedRecordCallbacks:f}=x._assertThisInitialized(c);h&&f?.showAllRelatedRecords&&f.showAllRelatedRecords({parentFeature:h,relationshipId:d})};c._onAddRelatedRecordsClick=(d,h)=>{const {feature:f,relatedRecordCallbacks:k}=x._assertThisInitialized(c);
f&&k?.addRelatedRecord&&k.addRelatedRecord({parentFeature:f,relatedLayer:h,relationshipId:d})};c._handleInputInput=d=>{c._commitInputValue(d.currentTarget)};c._handleFormKeyDown=c._handleFormKeyDown.bind(x._assertThisInitialized(c));c._handleInputBlur=c._handleInputBlur.bind(x._assertThisInitialized(c));c._handleInputFocus=c._handleInputFocus.bind(x._assertThisInitialized(c));c._handleNumberInputMouseDown=c._handleNumberInputMouseDown.bind(x._assertThisInitialized(c));c._handleInputKeyDown=c._handleInputKeyDown.bind(x._assertThisInitialized(c));
c._handleOptionChange=c._handleOptionChange.bind(x._assertThisInitialized(c));c._handleGroupClick=c._handleGroupClick.bind(x._assertThisInitialized(c));c._handleSubmit=c._handleSubmit.bind(x._assertThisInitialized(c));c._afterInputCreateOrUpdate=c._afterInputCreateOrUpdate.bind(x._assertThisInitialized(c));c._afterDateInputCreateOrUpdate=c._afterDateInputCreateOrUpdate.bind(x._assertThisInitialized(c));return c}x._inherits(G,M);var e=G.prototype;e.initialize=function(){this.addHandles([K.watch(()=>
this.feature,()=>{this._activeInputName=this._getFocusableInput("forward")?.name||"";this._userUpdatedFieldInputNames.clear();this._fieldToInitialIncompatibleDomainValue.clear();this._switchFieldsWithInitialIncompatibleValue.clear();this._dateFieldInputMap.clear();this._fieldFocusNeeded=!0}),this.on("submit",a=>{if(0<a.invalid.length){const [b]=a.invalid;a.invalid.forEach(c=>this._userUpdatedFieldInputNames.add(c));this._activeInputName=b;this._fieldFocusNeeded=!0;this.scheduleRender()}}),K.watch(()=>
[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])};e.loadDependencies=function(){return T.loadCalciteComponents({button:()=>new Promise((a,b)=>w(["../chunks/calcite-button"],a,b)),combobox:()=>new Promise((a,b)=>w(["../chunks/calcite-combobox"],a,b)),"combobox-item":()=>new Promise((a,b)=>w(["../chunks/calcite-combobox-item"],a,b)),"combobox-item-group":()=>new Promise((a,b)=>w(["../chunks/calcite-combobox-item-group"],a,b)),icon:()=>new Promise((a,b)=>
w(["../chunks/calcite-icon"],a,b)),"input-date-picker":()=>new Promise((a,b)=>w(["../chunks/calcite-input-date-picker"],a,b)),"input-message":()=>new Promise((a,b)=>w(["../chunks/calcite-input-message"],a,b)),"input-time-picker":()=>new Promise((a,b)=>w(["../chunks/calcite-input-time-picker"],a,b)),list:()=>new Promise((a,b)=>w(["../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>w(["../chunks/calcite-list-item"],a,b)),loader:()=>new Promise((a,b)=>w(["../chunks/calcite-loader"],a,
b)),notice:()=>new Promise((a,b)=>w(["../chunks/calcite-notice"],a,b)),progress:()=>new Promise((a,b)=>w(["../chunks/calcite-progress"],a,b)),switch:()=>new Promise((a,b)=>w(["../chunks/calcite-switch"],a,b))})};e.destroy=function(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)};e.getValues=function(){return this.viewModel.getValues()};e.submit=function(){return this.viewModel.submit()};e.render=function(){const {state:a}=this.viewModel;return g.tsx("div",{class:this.classes(l.CSS.base,
l.CSS.widget,l.CSS.panel)},"ready"===a?this._renderForm():null)};e._renderForm=function(){return g.tsx("form",{class:l.CSS.form,novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},this._renderHeader(),this._renderInputs())};e._renderHeader=function(){var a=this.viewModel;if(a.formHeaderVisible){var b=null!=a.formTitle&&g.tsx(H.Heading,{key:"title",level:this.headingLevel},a.formTitle);a=null!=a.formDescription&&g.tsx("p",{class:l.CSS.description,key:"description"},a.formDescription);
return g.tsx("div",{class:l.CSS.formHeader},b,a)}};e._renderInputs=function(){const {viewModel:a}=this;return a.activeRelationshipInput?this._renderActiveRelationshipInput(a.activeRelationshipInput):a.inputs.filter(N.isSome).filter(b=>b.visible).map((b,c)=>{if(n.isGroupInput(b))return this._renderGroup(b,c);if(n.isFieldInput(b))return this._renderLabeledField(b);if(n.isRelationshipInput(b))return this._renderRelationshipInput(b)})};e._renderActiveRelationshipInput=function(a){return this._renderRelationshipInput(a)};
e._renderDescriptionOrEmpty=function(a,b){return null==a?null:g.tsx("div",{class:this.classes(l.CSS.description),id:b},a)};e._renderGroup=function(a,b){const {formTemplate:c,disabled:d}=this,{description:h,inputs:f,label:k,state:q}=a,m=f.filter(C=>C.visible);var v=this.viewModel.findField(this._activeInputName);v=!(!v||v.group!==a);const A=`${this.id}_group_${b}`,z=`${this.id}_group-label_${b}`,y=`${this.id}_group-description_${b}`,B=this._renderDescriptionOrEmpty(h,y),u="sequential"===this.groupDisplay,
D=u?v:"expanded"===q,I=D?l.CSS.collapseIcon:l.CSS.expandIcon;return g.tsx("fieldset",{"aria-expanded":D.toString(),"aria-labelledby":z,"aria-describedby":h?y:"",class:this.classes(l.CSS.group,u?l.CSS.groupSequential:null,D?null:l.CSS.groupCollapsed,v?l.CSS.groupActive:null,d?l.CSS.inputDisabled:null),disabled:d,"data-group":a,id:A,key:b,onclick:this._handleGroupClick},g.tsx("button",{role:u?"presentation":void 0,class:l.CSS.groupHeader,type:"button",tabIndex:u?-1:0},g.tsx("div",{class:l.CSS.groupTitle},
g.tsx(H.Heading,{class:l.CSS.groupLabel,id:z,level:null!=c&&c.title?H.incrementHeadingLevel(this.headingLevel):this.headingLevel},k),B),u?null:g.tsx("span",{class:this.classes(I,l.CSS.groupToggleIcon)})),m.map(C=>{if(n.isFieldInput(C))return this._renderLabeledField(C);if(n.isRelationshipInput(C))return this._renderRelationshipInput(C)}))};e._getFocusableInput=function(a,b){var c=this.viewModel.allFieldInputs;c="forward"===a?c:c.slice().reverse();!b||n.isRelationshipInput(b)?a=0:n.isGroupInput(b)?
a=(a=b.inputs.find(n.isFieldInput))?c.indexOf(a):0:(n.isInputInGroupInput(b)&&"collapsed"===b.group.state?(b=b.group.inputs.filter(n.isFieldInput),a="forward"===a?b[b.length-1]:b[0]):a=b,a=c.indexOf(a)+1);for(;a<c.length;a++)if(b=c[a],b.visible&&n.isFieldInput(b))return b;return null};e._renderLabeledField=function(a){const {dataType:b,feature:c,label:d,layer:h}=a;return g.tsx("label",{key:`${h.id}-${c.uid}-${a.name}`,class:l.CSS.label},[d,"unsupported"!==b?this._renderFieldInput(a):this._renderUnsupportedField(a),
this._renderAuxiliaryText(a)])};e._renderFieldInput=function(a){const {dataType:b,domain:c,name:d,updating:h,value:f}=a,k=this.getCommonInputProps(a);if("coded-value"===c?.type){if(n.isFieldElementWithInputType(a.element,"switch")){const {element:q}=a;if(this._switchFieldsWithInitialIncompatibleValue.has(d)||null==f||q.input.onValue!==f&&q.input.offValue!==f)this._switchFieldsWithInitialIncompatibleValue.add(d);else return this._renderSwitchFieldInput(a,k)}return"radio-buttons"===a.inputType?this._renderRadioButtonsFieldInput(a,
c.codedValues.map(({code:q,name:m})=>({value:q,name:m})),k):this._renderSelectFieldInput(a,this._getFieldValueOptions(d,c),k)}if("datetime-picker"===a.inputType||"date"===b)return this._renderDateFieldInput(a,k);a="number"===b?g.tsx("input",{type:"number",...k,value:null!=this._activeNumberFieldEdit&&this._activeNumberFieldEdit.fieldName===a.name?this._activeNumberFieldEdit.value:`${k.value}`}):"text-area"===a.inputType?g.tsx("textarea",{...k}):g.tsx("input",{type:"text",...k});return h?g.tsx("div",
{key:`${k.key}-input-updating-wrapper`,class:l.CSS.fieldInputWrapper},a,g.tsx("div",{class:l.CSS.fieldInputLoader},g.tsx("calcite-progress",{type:"indeterminate"}))):a};e._renderDateFieldInput=function(a,b){const {dateDataType:c,includeTime:d,label:h,name:f,valid:k,value:q}=a,{readOnly:m,required:v}=b;if("string"===c)return this._renderUnsupportedField(a,n.formatDateFieldValue(a.field,b.value));const {date:A,time:z}=this._formatValueForDateInputs(q);a=null!=b.max?this._formatValueForDateInputs(b.max):
void 0;var y=null!=b.min?this._formatValueForDateInputs(b.min):void 0;a=a?.date??void 0;y=y?.date??void 0;const B={afterCreate:this._afterDateInputCreate,afterUpdate:this._afterDateInputCreateOrUpdate,"aria-invalid":!k,label:h,numberingSystem:"latn",overlayPositioning:"fixed",readOnly:m,required:v,tabIndex:0,["data-field-name"]:f};return g.tsx("div",{key:`${b.key}-date-time-container`,class:l.CSS.dateInputContainer},g.tsx("calcite-input-date-picker",{bind:this,...B,class:this.classes(b.class,l.CSS.inputDate),
"data-date-part":"date",key:`${b.key}-date-input`,valueAsDate:A??void 0,maxAsDate:a,minAsDate:y,onCalciteInputDatePickerChange:u=>this._commitDateChanges(u.target),onblur:u=>this._commitDateChanges(u.target,!0)}),d?g.tsx("calcite-input-time-picker",{bind:this,...B,class:this.classes(b.class,l.CSS.inputTime),"data-date-part":"time",key:`${b.key}-time-input`,value:z??void 0,step:1,onCalciteInputTimePickerChange:u=>this._commitDateChanges(u.target),onfocus:u=>{u.target.calciteTimePickerEl&&(u.target.calciteTimePickerEl.showSecond=
!0)},onblur:u=>this._commitDateChanges(u.target,!0)}):null)};e._renderUnsupportedField=function(a,b){a=this.getCommonInputProps(a);return g.tsx("input",{afterCreate:a.afterCreate,afterUpdate:a.afterUpdate,class:this.classes(l.CSS.input,l.CSS.fieldInput,l.CSS.inputDisabled),onfocus:a.onfocus,readOnly:!0,tabIndex:a.tabIndex,type:"text",value:null!=b?`${b}`:a.value,["data-field-name"]:a["data-field-name"]})};e._renderSelectFieldInput=function(a,b,c){const {element:d,required:h,value:f}=a,{messages:k,
messagesTemplates:q}=this;var m=b.map(z=>z.map(y=>g.tsx("calcite-combobox-item",{value:`${y.value}`,textLabel:y.name,key:`#${y.value}`,selected:f===y.value})));const [v,A]=m;this._registerIncompatibleValue(f,b.flat(),a,z=>{A.unshift(g.tsx("calcite-combobox-item",{value:`${z}`,textLabel:`${z}`,key:"incompatible-option",readOnly:!0}))});a=0<A.length?[g.tsx("calcite-combobox-item-group",{key:"recommended",label:k.recommended},v),g.tsx("calcite-combobox-item-group",{key:"other",label:q.other},A)]:v;m=
null==d;b=n.isFieldElementWithInputType(d,"combo-box");m=m||b&&d.input?.showNoValueOption;!h&&m&&a.unshift(g.tsx("calcite-combobox-item",{value:"",textLabel:k.empty,key:"empty-option"},b&&d.input.noValueOptionLabel||k.empty));return g.tsx("calcite-combobox",{...c,selectionMode:"single",disabled:c.readOnly,allowCustomValues:!1,clearDisabled:!0,onCalciteComboboxChange:z=>this._handleOptionChange(z.target)},a)};e._registerIncompatibleValue=function(a,b,c,d){const h=this._fieldToInitialIncompatibleDomainValue,
f=h.has(c.name);if(f||null!=a&&""!==a&&!b.some(k=>k.value===a))f||h.set(c.name,a),d?.(a)};e._renderRadioButtonsFieldInput=function(a,b,c){const {element:d,name:h,required:f,value:k}=a,q=b.map(m=>this._renderRadioButton({key:m.name,label:m.name,name:h,value:m.value,selected:m.value===k,props:c}));this._registerIncompatibleValue(k,b,a);b=null==d;a=n.isFieldElementWithInputType(d,"radio-buttons");b=b||a&&d.input?.showNoValueOption;!f&&b&&q.unshift(this._renderRadioButton({key:"empty-option",label:a&&
d.input.noValueOptionLabel||this.messages.empty,name:h,value:"",selected:""===k||null===k,props:c}));return g.tsx("div",{key:`${c.key}-radio`,class:l.CSS.inputRadioGroup},q)};e._renderSwitchFieldInput=function(a,b){const {value:c}=a;a=n.isFieldElementWithInputType(a.element,"switch")?c===a.element.input.onValue:!1;return g.tsx("calcite-switch",{...b,class:l.CSS.inputSwitch,onCalciteSwitchChange:d=>this._commitInputValue(d.target),checked:a,disabled:b.readOnly})};e._renderRadioButton=function({key:a,
name:b,value:c,selected:d,label:h,props:f}){return g.tsx("label",{key:a,class:l.CSS.inputRadioLabel},g.tsx("input",{...f,class:l.CSS.inputRadio,name:b,type:"radio",value:c,checked:d,disabled:f.readOnly,onchange:k=>this._commitInputValue(k.target)}),h)};e._renderAuxiliaryText=function(a){const b=this._userUpdatedFieldInputNames.has(a.name)&&!a.valid?n.getErrorMessageForFieldInput(a,this.messages):null!=this.viewModel.contingencyConstraintViolations.get(a.name)?this.messages.validationErrors.valuesIncompatible:
null!=a.valueExpressionExecutor&&a.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=b?g.tsx("calcite-input-message",{status:"invalid",icon:!0},b):this._renderDescriptionOrEmpty(a.description)};e._renderShowAllRelatedRecordsListItem=function(a){const {featureCount:b,relationshipId:c,showAllActionVisible:d}=a;({relatedRecordCallbacks:a}=this);if(d&&a?.showAllRelatedRecords)return a=this.messages,g.tsx("calcite-list-item",{description:V.substitute(a.totalCount,{count:b}),
label:a.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(c)},g.tsx("calcite-icon",{slot:"content-end",scale:"s",icon:"list"}))};e._renderAddRelatedRecordButton=function(a){const {canAddRelatedFeature:b,relationshipId:c,relatedLayer:d}=a,{relatedRecordCallbacks:h}=this;if(b&&h?.addRelatedRecord&&d)return g.tsx("calcite-button",{alignment:"center",appearance:"outline-fill",class:l.CSS.centeredButton,disabled:a.updating,iconStart:"plus",key:`${c}-add-button`,round:!0,scale:"s",
width:"half",onclick:()=>this._onAddRelatedRecordsClick(c,d)},this.messages.addRecord)};e._renderRelatedRecordListItem=function(a,b){const {feature:c,description:d,title:h}=a,{feature:f,relatedRecordCallbacks:k}=this;return g.tsx("calcite-list-item",{bind:this,description:d,label:h,key:`${b}-${c.uid}`,value:h,onclick:()=>{k?.editRelatedRecord&&f&&k.editRelatedRecord({parentFeature:f,relationshipId:b,relatedFeature:c})}},g.tsx("calcite-icon",{slot:"content-start",scale:"m",icon:n.getIconForFeature(c)}),
g.tsx("calcite-icon",{slot:"content-end",scale:"s",icon:"chevron-right"}))};e._renderRelationshipInput=function(a){if(this._relatedRecordsEnabled&&a.editable){var {featureCount:b,relationshipId:c,showAllEnabled:d}=a,h=d?null:this._renderDescriptionOrEmpty(a.description),f=0<b?this._renderRelatedRecordsList(a):a.loaded?this._renderNoRelatedRecordsNotice():void 0;return g.tsx("label",{class:this.classes(l.CSS.label,l.CSS.relationshipLabel),key:`relationship-${c}-container`},g.tsx("div",null,this._renderRelatedRecordsHeaderContainer(a),
h,f),this._renderAddRelatedRecordButton(a))}};e._renderRelatedRecordsHeaderContainer=function(a){const b=a.updating||!a.loaded;return g.tsx("div",{class:l.CSS.relatedRecordsHeader,key:`relationship-${a.relationshipId}-header`},g.tsx("span",null,a.label),b?g.tsx("calcite-loader",{label:this.messagesCommon?.loading,inline:!0,key:"loader",scale:"s",type:"indeterminate"}):void 0)};e._renderRelatedRecordsList=function(a){const {relationshipId:b}=a;return g.tsx("calcite-list",{class:l.CSS.relatedRecordsList},
a.relatedFeatureInfos.map(c=>this._renderRelatedRecordListItem(c,b)),this._renderShowAllRelatedRecordsListItem(a),this._renderObserverNode())};e._renderNoRelatedRecordsNotice=function(){return g.tsx("calcite-notice",{open:!0,scale:"s",kind:"brand",icon:"information",width:"full"},g.tsx("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))};e._renderObserverNode=function(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return g.tsx("div",{key:"feature-observer",class:l.CSS.listObserver,
bind:this,afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved})};e.getCommonInputProps=function(a){const {disabled:b,groupDisplay:c}=this,{dataType:d,editable:h,group:f,hint:k,label:q,maxLength:m,minLength:v,name:A,required:z,valid:y,value:B}=a,u=this._userUpdatedFieldInputNames.has(A),D=!h||b,I="all"===c&&null!=f&&"collapsed"===f.state;return{afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":y?"false":"true",class:this.classes(l.CSS.input,
l.CSS.fieldInput,D?l.CSS.inputDisabled:null,u&&!y?l.CSS.inputInvalid:null),key:A,label:q,minlength:-1<v?`${v}`:"",maxlength:-1<m?`${m}`:"",...a.range,readOnly:D,value:null==B?"":`${B}`,["data-field-name"]:A,onfocus:this._handleInputFocus,oninput:this._handleInputInput,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:"number"===d?this._handleNumberInputMouseDown:void 0,placeholder:"number"===d||"text"===d?k??void 0:"",required:z,tabIndex:I?-1:0}};e._handleNumberInputMouseDown=
function({target:a}){a.focus();this.scheduleRender()};e._getFieldValueOptions=function(a,b){b=b.codedValues.map(({code:c,name:d})=>({value:c,name:d}));a=this.viewModel.fieldsWithContingentValues.has(a)?this._getContingentValueOptions(a):[];if(0<a.length){const c=new Set(a.map(d=>d.value));b=b.filter(d=>!c.has(d.value));return[a,b]}return[b,[]]};e._getContingentValueOptions=function(a){const b={};for(var c of this.viewModel.allFieldInputs){const {name:h,value:f}=c;null!=f&&h!==a&&this.viewModel.fieldsWithContingentValues.has(h)&&
(b[h]=f)}var d=this.viewModel.joinedContingentValues.slice();c=new Map;for(const h of d){d=h.values[a];if(null==d||"code"!==d.objectType&&"null"!==d.objectType)continue;const {code:f,name:k}=d.codedValue&&"null"!==d.objectType?d.codedValue:{code:"",name:this.messages.empty};c.has(f)||Object.entries(b).every(([q,m])=>!h.values.hasOwnProperty(q)||this._valueIsValidContingentValue(m,h.values[q]))&&c.set(f,{name:k,value:f})}return[...c.values()]};e._getFieldInputFromHTMLElement=function(a){return this.viewModel.findField(a.getAttribute("data-field-name"))};
e._afterDateInputCreate=async function(a){this._afterDateInputCreateOrUpdate(a)};e._afterDateInputCreateOrUpdate=function(a){const {name:b}=this._getFieldInputFromHTMLElement(a),c=this._dateFieldInputMap.get(b),d="valueAsDate"in a;null!=c?d?c.date=a:c.time=a:this._dateFieldInputMap.set(b,{[d?"date":"time"]:a});this._afterInputCreateOrUpdate(a)};e._afterInputCreateOrUpdate=function(a){var {viewModel:b}=this;const c=this._getFieldInputFromHTMLElement(a);b=b.findField(this._activeInputName);const d=
this._fieldToInitialIncompatibleDomainValue.get(c.name)===c.value;this._fieldFocusNeeded&&b===c&&("radio-buttons"!==c.inputType||d||a.checked)&&(this._fieldFocusNeeded=!1,n.isInputInGroupInput(c)&&(c.group.state="expanded"),a.focus())};e._handleInputFocus=function(a){a=a.target;const b=this._getFieldInputFromHTMLElement(a);this._activeInputName=b.name;n.isNumberFieldInput(b)&&(this._activeNumberFieldEdit={fieldName:b.name,input:a,value:a.value})};e._handleInputBlur=function(a){a=a.target;const b=
this._getFieldInputFromHTMLElement(a);"number"===b.dataType&&null!=this._activeNumberFieldEdit&&(this._activeNumberFieldEdit.input.value=`${b.value}`,this._activeNumberFieldEdit=null);this._commitInputValue(a);this.scheduleRender()};e._commitDateChanges=function(a,b=!1){const {name:c}=this._getFieldInputFromHTMLElement(a);if(this._dateFieldInputMap.has(c)){var d=this._dateFieldInputMap.get(c);d&&d.date&&(a=this._getFieldValueFromDateInput(a),d=this._getFieldValueFromDateInputs(d.date,d.time),this.viewModel.getValue(c)!==
d&&(null===a||null===d?b&&this._updateFieldValue(c,null):this._updateFieldValue(c,d)))}};e._commitInputValue=function(a){const b=this._getFieldInputFromHTMLElement(a);null!=this._activeNumberFieldEdit&&n.isNumberFieldInput(b)&&(this._activeNumberFieldEdit.value=a.value);this._updateFieldValue(b.name,this._parseValue(a))};e._handleInputKeyDown=function(a){const {key:b,altKey:c,ctrlKey:d,metaKey:h}=a;var f=this._getFieldInputFromHTMLElement(a.target);if("Enter"!==b){var {type:k}=f.field;f="single"===
k||"double"===k;if(!("integer"!==k&&"small-integer"!==k&&!f||c||d||h)&&1===b.length){k=Number(b);const q=["-","+"],m=["e","."];f=f?[...q,...m]:q;isNaN(k)&&!f.includes(b)&&a.preventDefault()}}else n.isInputInGroupInput(f)&&"collapsed"===f.group.state&&(f.group.state="expanded")};e._updateFieldValue=function(a,b){this.viewModel.setValue(a,b);this._userUpdatedFieldInputNames.add(a);this.viewModel.fieldsWithContingentValues.has(a)&&(a=Object.fromEntries(Object.entries(this.getValues()).filter(([,c])=>
null!=c)),this.viewModel.validateContingencyConstraints(a))};e._parseValue=function(a){const b=this._getFieldInputFromHTMLElement(a),c=a.value;if(n.isFieldElementWithInputType(b.element,"switch")&&"CALCITE-COMBOBOX"!==a.tagName)return a.checked?b.element.input.onValue:b.element.input.offValue;if("radio-buttons"===b.inputType&&"radio"===a.type&&!a.checked)return b.value;({dataType:a}=b);return"number"===a?c?parseFloat(c):null:c};e._handleOptionChange=function(a){this._commitInputValue(a);this.scheduleRender()};
e._handleGroupClick=function(a){const b=a.currentTarget["data-group"],c="expanded"===b.state,d="sequential"===this.groupDisplay,h=`.${l.CSS.groupHeader}`;if(!c||a.target.closest(h)){this._activeInputName=this._getFocusableInput("forward",b)?.name||"";if(d){a=a.target.closest(h);if(c&&!a)return;this.viewModel.inputs.forEach(f=>{n.isGroupInput(f)&&f!==b&&(f.state="collapsed")})}b.state=c?"collapsed":"expanded";this._fieldFocusNeeded=d;this.scheduleRender()}};e._handleSubmit=function(a){a.preventDefault()};
e._handleFormKeyDown=function(a){"Enter"===a.key&&this.viewModel.submit()};e._getDefaultLocaleOptions=function(){return{locale:W.getLocale(),numberingSystem:"latn"}};e._getFieldValueFromDateInputs=function(a,b){var c=this._getDateTimeFromInput(a);b=this._getDateTimeFromInput(b);if(!c&&!b)return null;a=this._getFieldInputFromHTMLElement(a).range;const d=Date.now();a=F.DateTime.fromMillis(null!=a.max&&a.max<d?a.max:d,this._getDefaultLocaleOptions());c=c||a;const {year:h,month:f,day:k}=c,{hour:q,minute:m,
second:v}=b||a;c=c.set({year:h,month:f,day:k,hour:q,minute:m,second:v});return c.isValid?c.toMillis():null};e._getDateTimeFromInput=function(a){if(!a)return null;let b=null;if("valueAsDate"in a){a=a.valueAsDate;if(!a||Array.isArray(a))return null;b=F.DateTime.fromJSDate(a)}else{if(!a.value)return null;b=F.DateTime.fromFormat(a.value,"TT",this._getDefaultLocaleOptions())}return b??null};e._getFieldValueFromDateInput=function(a){return this._dateTimeToFieldValue(this._getDateTimeFromInput(a))};e._dateTimeToFieldValue=
function(a){return a?.isValid?a.toMillis():null};e._dateTimeFromFieldValue=function(a){return null===a?null:F.DateTime.fromMillis(a,this._getDefaultLocaleOptions())};e._formatValueForDateInputs=function(a){return null==a||isNaN(a)?{date:null,time:null}:(a=this._dateTimeFromFieldValue(a))?{date:a.toJSDate(),time:a.toFormat("TT",this._getDefaultLocaleOptions())}:{date:null,time:null}};e._valueIsValidContingentValue=function(a,b){switch(b.objectType){case "any":return!0;case "null":return null==a;case "code":return a===
b.codedValue?.code;case "range":return null!=a&&null!=b.minValue&&null!=b.maxValue&&+a>=b.minValue&&+a<=b.maxValue;default:return O.neverReached(b.objectType),!1}};e._afterListObserverCreated=function(a){this.viewModel.activeRelationshipInput&&(this._listObserverNode=a)};e._afterListObserverRemoved=function(){this._listObserverNode=null};e._onObserverChange=async function(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const a=this.viewModel.activeRelationshipInput;
if(a){var {showAllEnabled:b,updating:c}=a;this._listObserverNode&&!c&&b&&this._listObserver.observe(this._listObserverNode)}};e._incrementRelatedRecordPage=function(){this.viewModel.activeRelationshipInput?.incrementPage()};x._createClass(G,[{key:"_relatedRecordsEnabled",get:function(){const a=this.relatedRecordCallbacks;return!(!a||!(a.addRelatedRecord||a.editRelatedRecord||a.showAllRelatedRecords))}},{key:"disabled",get:function(){return this.viewModel.disabled},set:function(a){this.viewModel.disabled=
a}},{key:"feature",get:function(){return this.viewModel.feature},set:function(a){this.viewModel.feature=a}},{key:"formTemplate",get:function(){return this.viewModel.formTemplate},set:function(a){this.viewModel.formTemplate=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=a}},{key:"map",get:function(){return this.viewModel.map},set:function(a){this.viewModel.map=
a}},{key:"relatedRecordCallbacks",get:function(){return this.viewModel.relatedRecordCallbacks},set:function(a){this.viewModel.relatedRecordCallbacks=a}},{key:"relationshipId",get:function(){return this.viewModel.relationshipId},set:function(a){this.viewModel.relationshipId=a}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(a){this.viewModel.spatialReference=a}},{key:"strict",get:function(){return this.viewModel.strict},set:function(a){this.viewModel.strict=
a}},{key:"view",get:function(){J.deprecatedProperty(L,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"});return this.viewModel.view},set:function(a){J.deprecatedProperty(L,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"});this.viewModel.view=a}}]);return G}(R);r.__decorate([t.property()],p.prototype,"_listObserverNode",void 0);r.__decorate([t.property()],p.prototype,"_relatedRecordsEnabled",null);r.__decorate([t.property()],p.prototype,"disabled",null);r.__decorate([t.property()],
p.prototype,"feature",null);r.__decorate([t.property()],p.prototype,"formTemplate",null);r.__decorate([t.property()],p.prototype,"groupDisplay",void 0);r.__decorate([t.property()],p.prototype,"headingLevel",void 0);r.__decorate([t.property()],p.prototype,"label",null);r.__decorate([t.property()],p.prototype,"layer",null);r.__decorate([t.property()],p.prototype,"map",null);r.__decorate([t.property(),E.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],p.prototype,"messages",void 0);r.__decorate([t.property(),
E.messageBundle("esri/t9n/common")],p.prototype,"messagesCommon",void 0);r.__decorate([t.property(),E.messageBundle("esri/widgets/Feature/t9n/Feature")],p.prototype,"messagesFeature",void 0);r.__decorate([t.property(),E.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],p.prototype,"messagesTemplates",void 0);r.__decorate([t.property()],p.prototype,"relatedRecordCallbacks",null);r.__decorate([t.property()],p.prototype,"relationshipId",null);r.__decorate([t.property()],p.prototype,
"spatialReference",null);r.__decorate([t.property()],p.prototype,"strict",null);r.__decorate([t.property()],p.prototype,"view",null);r.__decorate([t.property(),U.vmEvent(["value-change","submit"])],p.prototype,"viewModel",void 0);return p=r.__decorate([Q.subclass("esri.widgets.FeatureForm")],p)});