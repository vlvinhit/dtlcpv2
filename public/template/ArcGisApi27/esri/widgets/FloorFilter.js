// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/events ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./FloorFilter/css ./FloorFilter/FloorFilterViewModel ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),function(w,m,l,B,C,n,G,H,I,D,E,c,x,r,p,y,f,z){const F=
["ArrowUp","ArrowDown","End","Home"];l=function(A){function t(a,b){var d=A.call(this,a,b)||this;d._activeMenu=null;d._activeMenuIndex={levels:-1,menuItems:-1};d._baseNode=null;d._facilitiesListNode=null;d._levelsListNode=null;d._sitesListNode=null;d._searchInput=null;d.viewModel=new x;d.messages=null;d.messagesCommon=null;d.headingLevel=2;d._resizeObserver=new ResizeObserver(()=>d.scheduleRender());d.addHandles(C.watch(()=>d._searchInput,()=>d._focusSearch()));return d}w._inherits(t,A);var h=t.prototype;
h.destroy=function(){this._resizeObserver?.disconnect()};h.updateWebDocument=function(a){return this.viewModel.updateWebDocument(a)};h.render=function(){var {longNames:a}=this;a=a&&this.viewModel.isNormalMode?"expanded":"collapsed";var b=this.renderButtons();const d=this.renderFilterMenu(),g=f.tsx("div",{class:this.classes(c.CSS.separator)});var e=this._getComponentPosition();const k=this._getPosition(e),q="top-right"===e||"bottom-right"===e,u="top-left"===e||"bottom-left"===e,v=p.isRTL(this.container);
e=v&&u||!v&&q?d:b;b=v&&u||!v&&q?b:d;return f.tsx("div",{afterCreate:this._afterBaseNodeCreate,key:"floor-filter-menu",class:this.classes(c.CSS.floorFilter,c.CSS.esriWidget,`${c.CSS.floorFilterLayout}${a}`,`${c.CSS.floorFilterPosition}${k}`)},e,this.viewModel?.filterMenuOpen&&g,b)};h.renderButtons=function(){const a=this._getComponentPosition(),b=[];"top"===this._getPosition(a)?(b.push(this.renderBrowseButton()),b.push(this.renderLevelButtons()),b.push(this.renderCloseLevelsButton()),b.push(this.renderZoomButton()),
b.push(this.renderCollapseToggleButton())):(b.push(this.renderCollapseToggleButton()),b.push(this.renderZoomButton()),b.push(this.renderCloseLevelsButton()),b.push(this.renderLevelButtons()),b.push(this.renderBrowseButton()));return f.tsx("div",{key:"button-container",class:this.classes(c.CSS.esriWidget,c.CSS.buttonContainer)},b)};h.renderBrowseButton=function(){const {longNames:a,messages:b}=this;return f.tsx("button",{key:"browse-button",title:b.buttons.browse,bind:this,class:this.classes(c.CSS.esriWidget,
c.CSS.esriWidgetButton,c.CSS.esriInteractive,("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&c.CSS.esriButtonDisabled,c.CSS.browseButton,this.viewModel?.filterMenuOpen&&c.CSS.esriWidgetButtonActive),"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":b.buttons.browse,onclick:this._toggleFilterMenu,type:"button"},f.tsx("div",{class:this.classes(c.CSS.buttonInfo)},f.tsx("span",{class:this.classes(c.CSS.esriIcon,c.CSS.urbanIcon)}),f.tsx("span",{class:this.classes(c.CSS.buttonLabel)},
a&&this.viewModel.isNormalMode&&b.buttons.browse)))};h.renderLevelButtons=function(){if(!this.viewModel?.filterFeatures?.levels?.levelsInfo||!this.facility)return null;const {facility:a,messagesCommon:b,messages:d}=this;var g=this.viewModel?.getFacility(a);const e=(this.viewModel?.getFacilityLevels(a)).map(k=>this.renderLevelButton(k));if(!e.length)return null;g=g&&z.substitute(d.selector.levelsLabel,{name:`"${g.name}"`});if(this._isWebScene(this.view?.map)&&1<e?.length){const k=this.renderLevelButton({id:`all--${a}`,
facilityId:a,shortName:b.all,longName:b.all,levelNumber:null,verticalOrder:null});e.push(k)}return f.tsx("ul",{key:"levels-button-container",class:this.classes(c.CSS.levelsContainer),bind:this,"data-id":"levels",afterCreate:p.storeNode,"data-node-ref":"_levelsListNode","aria-label":g,onkeydown:this._handleListKeydown},e)};h.renderLevelButton=function(a){var {longNames:b}=this;const {shortName:d,longName:g,id:e}=a;a=this.level===e;b=b&&this.viewModel.isNormalMode?g:d;return this.viewModel.isNormalMode||
a||this.viewModel.levelsExpanded?f.tsx("li",{key:`levels--${e}`},f.tsx("button",{"data-id":e,"data-list-id":"levels",bind:this,class:this.classes(c.CSS.esriWidgetButton,a?c.CSS.esriWidgetButtonActive:null,c.CSS.esriInteractive,c.CSS.levelButton),onclick:this._levelSelected,onfocus:this._onItemFocus,type:"button"},b)):null};h.renderCloseLevelsButton=function(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const {messagesCommon:a}=this;return f.tsx("button",
{key:"close-levels-button",title:a.close,bind:this,class:this.classes(c.CSS.esriWidget,c.CSS.esriWidgetButton,c.CSS.esriInteractive,c.CSS.closeLevelsButton),"aria-label":a.close,onclick:this._closeLevels,type:"button"},f.tsx("div",{class:this.classes(c.CSS.buttonInfo)},f.tsx("span",{class:this.classes(c.CSS.esriIcon,c.CSS.closeIcon)})))};h.renderZoomButton=function(){const {longNames:a,messages:b,facility:d,site:g}=this,e=this.viewModel?.filterMenuType,k=this.viewModel?.filterMenuOpen,q=this.viewModel?.getSite(g),
u=this.viewModel?.getFacility(d);return f.tsx("button",{key:"zoom-button",title:b.buttons.zoomTo,bind:this,class:this.classes(c.CSS.esriWidget,c.CSS.esriWidgetButton,("site"===e&&k?!q:!u)&&c.CSS.esriButtonDisabled,c.CSS.esriInteractive,0<this.viewModel?.getFacilityLevels(d).length?c.CSS.zoomButtonLevels:c.CSS.zoomButton),"aria-label":b.buttons.zoomTo,onclick:this._zoomToClicked,type:"button"},f.tsx("div",{class:this.classes(c.CSS.buttonInfo)},f.tsx("span",{class:this.classes(c.CSS.esriIcon,c.CSS.zoomToIcon)}),
f.tsx("span",{class:this.classes(c.CSS.buttonLabel)},a&&this.viewModel.isNormalMode&&b.buttons.zoomTo)))};h.renderCollapseToggleButton=function(){const {longNames:a,messagesCommon:b}=this,d=this.classes(c.CSS.esriIcon,a?c.CSS.collapseIconRight:c.CSS.expandIconRight),g=a?b.collapse:b.expand;return f.tsx("button",{key:"minimize-toggle-button",title:g,bind:this,class:this.classes(c.CSS.esriWidget,c.CSS.esriWidgetButton,c.CSS.esriInteractive,c.CSS.minimizeToggleButton),"aria-label":g,onclick:this._toggleCollapsed,
type:"button"},f.tsx("div",{class:this.classes(c.CSS.buttonInfo)},f.tsx("span",{class:d}),f.tsx("span",{class:this.classes(c.CSS.buttonLabel)},a&&this.viewModel.isNormalMode&&b.collapse)))};h.renderFilterMenu=function(){return this.viewModel?.filterMenuOpen?"site"===this.viewModel?.filterMenuType?this.renderSiteFilterMenu():"facility"===this.viewModel?.filterMenuType?this.renderFacilityFilterMenu():null:null};h.renderSiteFilterMenu=function(){const {messages:a,messagesCommon:b}=this;var d=this.site?
this.viewModel?.getSite(this.site)?.name:a.selector.selectSite;d=f.tsx("div",{key:"filter-menu-site-header",class:this.classes(`${c.CSS.filterMenuHeader}`)},f.tsx("div",{class:this.classes(c.CSS.filterMenuHeaderTextGroup)},f.tsx(r.Heading,{level:this.headingLevel,class:this.classes(c.CSS.filterMenuHeaderText)},d)),f.tsx("button",{bind:this,title:b.close,class:this.classes(c.CSS.esriIcon,c.CSS.closeIcon),onclick:this._closeClicked,type:"button"}));const g=this.renderSearchInput(),e=this.renderSiteItems();
return f.tsx("div",{key:"filter-menu-site",class:this.classes(c.CSS.filterMenu)},d,g,e)};h.renderFacilityFilterMenu=function(){const {messages:a,messagesCommon:b,site:d}=this;var g=this.viewModel?.getSite(d)?.name,e=this.facility&&this.viewModel?.getFacility(this.facility)?.name||a.selector.selectFacility,k=this.viewModel.hasMultipleSites?f.tsx("button",{bind:this,title:b.back,class:this.classes(c.CSS.filterMenuHeaderBack),onclick:this._backClicked,type:"button"},f.tsx("span",{class:this.classes(p.isRTL(this.container)?
c.CSS.rightIcon:c.CSS.leftIcon)})):null;g=this.viewModel.hasMultipleSites?f.tsx(r.Heading,{level:r.incrementHeadingLevel(this.headingLevel),class:this.classes(c.CSS.filterMenuHeaderSubtext)},g):null;e=f.tsx("div",{key:"filter-menu-site-header",class:this.classes(c.CSS.filterMenuHeader)},k,f.tsx("div",{class:this.classes(c.CSS.filterMenuHeaderTextGroup)},f.tsx(r.Heading,{level:this.headingLevel,class:this.classes(c.CSS.filterMenuHeaderText)},e),g),f.tsx("button",{bind:this,title:b.close,class:this.classes(c.CSS.esriIcon,
c.CSS.closeIcon),onclick:this._closeClicked,type:"button"}));k=this.renderSearchInput();g=this.renderFacilityItems();return f.tsx("div",{key:"filter-menu-facility",class:this.classes(c.CSS.filterMenu)},e,k,g)};h.renderSearchInput=function(){const {messagesCommon:a}=this;return f.tsx("div",{key:"filter-menu-search",class:this.classes(c.CSS.filterMenuSearch)},f.tsx("span",{class:this.classes(c.CSS.esriIcon,c.CSS.searchIcon)}),f.tsx("input",{bind:this,key:"filter-menu-search__input",afterCreate:p.storeNode,
"data-node-ref":"_searchInput",class:this.classes(c.CSS.filterMenuSearchInput),placeholder:a.search,oninput:this._onSearchChange,onpaste:this._onSearchChange,value:this.viewModel.searchTerm??void 0}))};h.renderBlueCircle=function(){return f.tsx("span",{key:"floor-filter__selected-item-circle",class:this.classes(c.CSS.selectedItemCircle)})};h.renderSiteItems=function(){if(!this.viewModel?.filterFeatures?.sites?.sitesInfo)return null;const {messages:a}=this,b=this.viewModel.filterSites(this.viewModel.filterFeatures.sites.sitesInfo).map(g=>
this.renderSiteItem(g)),d=0===b.length&&this.viewModel?.searchTerm&&f.tsx("div",{class:this.classes(c.CSS.esriWidgetContentEmpty)},a.noResults);return f.tsx("ul",{key:"filter-menu-items--sites",class:this.classes(c.CSS.filterMenuItems),bind:this,afterCreate:p.storeNode,"data-node-ref":"_sitesListNode","data-id":"sites",onkeydown:this._handleListKeydown,tabIndex:-1,"aria-label":a.selector.sitesLabel},b,d)};h.renderSiteItem=function(a){const {name:b,id:d}=a;a=this.site===d;return f.tsx("li",{key:`filter-menu-site--${d}`},
f.tsx("button",{"data-id":d,"data-list-id":"sites",bind:this,class:this.classes(c.CSS.filterMenuSite),onclick:this._siteSelected,onfocus:this._onItemFocus,type:"button"},a&&this.renderBlueCircle(),f.tsx("span",{class:this.classes(a?c.CSS.filterMenuSelectedItem:c.CSS.filterMenuItemName)},b),f.tsx("span",{class:this.classes(p.isRTL(this.container)?c.CSS.leftIcon:c.CSS.rightIcon)})))};h.renderFacilityItems=function(){if(!this.viewModel?.filterFeatures?.facilities?.facilitiesInfo)return null;const {messages:a,
site:b}=this;var d=this.viewModel.getSite(b);const g=this.viewModel.filterFacilities(this.viewModel.filterFeatures.facilities.facilitiesInfo).map(k=>this.renderFacilityItem(k)),e=0===g.length&&this.viewModel?.searchTerm&&f.tsx("div",{class:this.classes(c.CSS.esriWidgetContentEmpty)},a.noResults);d=d?z.substitute(a.selector.siteFacilitiesLabel,{name:`"${d.name}"`}):a.selector.facilitiesLabel;return f.tsx("ul",{key:"filter-menu-items--facilities",class:this.classes(c.CSS.filterMenuItems),bind:this,
afterCreate:p.storeNode,"data-node-ref":"_facilitiesListNode","data-id":"facilities",onkeydown:this._handleListKeydown,tabIndex:-1,"aria-label":d},g,e)};h.renderFacilityItem=function(a){const {name:b,id:d}=a;a=this.facility===d;return f.tsx("li",{key:`filter-menu-facility--${d}`},f.tsx("button",{"data-id":d,"data-list-id":"facilities",bind:this,class:this.classes(c.CSS.filterMenuFacility),onclick:this._facilitySelected,onfocus:this._onItemFocus,type:"button"},a&&this.renderBlueCircle(),f.tsx("span",
{class:this.classes(a?c.CSS.filterMenuSelectedItem:c.CSS.filterMenuItemName)},b)))};h._afterBaseNodeCreate=function(a){this._baseNode&&this._resizeObserver?.unobserve(this._baseNode);this._baseNode=a;this._resizeObserver?.observe(this._baseNode)};h._toggleCollapsed=function(){this.longNames=!this.longNames};h._toggleFilterMenu=function(){this.viewModel.filterMenuOpen=!(this.viewModel?.filterMenuOpen??!1)};h._setFilterMenuType=function(a){this.viewModel.filterMenuType=a};h._zoomToClicked=function(){if(this.site&&
"site"===this.viewModel?.filterMenuType&&this.viewModel?.filterMenuOpen){var a=this.viewModel?.getSite(this.site);this.viewModel.goTo(a)}else this.facility?(a=this.viewModel?.getFacility(this.facility),this.viewModel.goTo(a)):this.site&&(a=this.viewModel?.getSite(this.site),this.viewModel.goTo(a))};h._onSearchChange=function(a){a=a.target;""===a.value?this.viewModel.searchTerm=null:a.value&&this.viewModel?.searchTerm!==a.value&&(this.viewModel.searchTerm=a.value.toLowerCase().trim())};h._closeClicked=
function(){this.viewModel.searchTerm=null;this.viewModel.filterMenuOpen=!1};h._backClicked=function(){this._setFilterMenuType("site");this.viewModel.searchTerm=null};h._siteSelected=function(a){a=a.currentTarget.getAttribute("data-id");const b=this.viewModel.getSite(a);let d=!1;this.site!==a&&(this.level=this.facility=null,d=!0,this.viewModel.levelsExpanded=!1);this.site=a;this.viewModel.searchTerm=null;this._setFilterMenuType("facility");this.viewModel.goTo(b);d&&this.viewModel.setFloors(null)};
h._facilitySelected=function(a){a=a.currentTarget.getAttribute("data-id");var b=this.viewModel.getFacility(a),d=!1;this.facility!==a&&(this.level="base-floors"===this.viewModel.filterMode?(d=this.viewModel?.getBaseLevel(b))?d.id:null:null,d=!0,this.viewModel.levelsExpanded=!1);this.facility=a;this.viewModel.goTo(b);d&&(b=this.viewModel.getLevel(this.level),this.viewModel.setFloors(b));!this.viewModel.isNormalMode&&1<this.viewModel.getFacilityLevels(a)?.length&&(this.viewModel.levelsExpanded=!0);setTimeout(()=>
this._focusActiveLevel(),50)};h._levelSelected=function(a){this.level=a.currentTarget.getAttribute("data-id")};h._closeLevels=function(){this.viewModel.levelsExpanded=!1};h._isWebScene=function(a){return"esri.WebScene"===a?.declaredClass};h._getComponentPosition=function(){return null!=this.container?this.view?.ui?.getPosition(this.container):null};h._getPosition=function(a){switch(a){case "bottom-right":case "bottom-left":return"bottom";default:return"top"}};h._handleListKeydown=function(a){var b=
a.currentTarget.getAttribute("data-id");let d=null;"sites"===b||"facilities"===b?(this._activeMenu!==b&&(this._activeMenuIndex.menuItems=-1),this._activeMenu=b,d="menuItems"):"levels"===b&&(d="levels");var g="sites"===b?this._sitesListNode:"facilities"===b?this._facilitiesListNode:"levels"===b?this._levelsListNode:null;b=B.eventKey(a);const e="Tab"===b,k=F.includes(b);k&&a.preventDefault();(g=g?.getElementsByTagName("li"))&&0!==g.length&&(k||e)&&this._handleItemNavigation(b,a.shiftKey,g,e,d)};h._handleItemNavigation=
function(a,b,d,g,e){if(e){this._activeMenuIndex[e]===d.length&&this._activeMenuIndex[e]--;-1===this._activeMenuIndex[e]&&this._activeMenuIndex[e]++;var k=this._activeMenuIndex[e];switch(a){case "Home":this._activeMenuIndex[e]=0;break;case "End":this._activeMenuIndex[e]=d.length-1;break;case "ArrowUp":this._activeMenuIndex[e]=0>=this._activeMenuIndex[e]?d.length-1:this._activeMenuIndex[e]-1;break;case "ArrowDown":this._activeMenuIndex[e]=this._activeMenuIndex[e]===d.length-1?0:this._activeMenuIndex[e]+
1}"Tab"===a&&b&&0<=this._activeMenuIndex[e]&&this._activeMenuIndex[e]--;"Tab"===a&&!b&&this._activeMenuIndex[e]<d.length&&this._activeMenuIndex[e]++;k!==this._activeMenuIndex[e]&&-1<this._activeMenuIndex[e]&&this._activeMenuIndex[e]<d.length&&!g&&(a=d[this._activeMenuIndex[e]].getElementsByTagName("button"),(1===a?.length?a[0]:null)?.focus())}};h._focusSearch=function(){this._searchInput?.focus()};h._focusActiveLevel=function(){const {level:a}=this;var b=this._levelsListNode;const d=b?.getElementsByTagName("li");
if(a&&b&&d){b=this._facilitiesListNode?.getElementsByTagName("li");this._activeMenuIndex.menuItems=b?b.length-1:-1;b=[];for(let g=0;g<d.length;g++){const e=d[g].getElementsByTagName("button");1===e?.length&&b.push(e[0])}b.forEach((g,e)=>{g.getAttribute("data-id")===a&&(g.focus(),this._activeMenuIndex.levels=e)})}};h._onItemFocus=function(a){var b=a.currentTarget;a=b.getAttribute("data-list-id");const d=b.getAttribute("data-id");if(b="sites"===a?this._sitesListNode:"facilities"===a?this._facilitiesListNode:
"levels"===a?this._levelsListNode:null)if(b=b?.getElementsByTagName("li")){var g=[];Array.from(b).forEach(k=>{k=k.getElementsByTagName("button");1===k?.length&&g.push(k[0])});b=null;switch(a){case "sites":case "facilities":b="menuItems";break;case "levels":b="levels"}if(b){var e=b;g.forEach((k,q)=>{k.getAttribute("data-id")===d&&this._activeMenuIndex[e]!==q&&(this._activeMenuIndex[e]=q)})}}};w._createClass(t,[{key:"enabled",get:function(){return this.viewModel.enabled},set:function(a){this.viewModel.enabled=
a}},{key:"longNames",get:function(){return this.viewModel.longNames},set:function(a){this.viewModel.longNames=a}},{key:"minimized",get:function(){return this.viewModel.minimized},set:function(a){this.viewModel.minimized=a}},{key:"pinnedLevels",get:function(){return this.viewModel.pinnedLevels},set:function(a){this.viewModel.pinnedLevels=a}},{key:"site",get:function(){return this.viewModel.site},set:function(a){this.viewModel.site=a}},{key:"facility",get:function(){return this.viewModel.facility},
set:function(a){this.viewModel.facility=a}},{key:"level",get:function(){return this.viewModel.level},set:function(a){this.viewModel.level=a}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(a){this.viewModel.goToOverride=a}}]);return t}(E);m.__decorate([n.property()],l.prototype,"_searchInput",void 0);m.__decorate([n.property()],l.prototype,"enabled",null);m.__decorate([n.property()],
l.prototype,"longNames",null);m.__decorate([n.property()],l.prototype,"minimized",null);m.__decorate([n.property()],l.prototype,"pinnedLevels",null);m.__decorate([n.property()],l.prototype,"site",null);m.__decorate([n.property()],l.prototype,"facility",null);m.__decorate([n.property()],l.prototype,"level",null);m.__decorate([n.property()],l.prototype,"view",null);m.__decorate([n.property({type:x})],l.prototype,"viewModel",void 0);m.__decorate([n.property(),y.messageBundle("esri/widgets/FloorFilter/t9n/FloorFilter")],
l.prototype,"messages",void 0);m.__decorate([n.property(),y.messageBundle("esri/t9n/common")],l.prototype,"messagesCommon",void 0);m.__decorate([n.property()],l.prototype,"goToOverride",null);m.__decorate([n.property()],l.prototype,"headingLevel",void 0);return l=m.__decorate([D.subclass("esri.widgets.FloorFilter")],l)});