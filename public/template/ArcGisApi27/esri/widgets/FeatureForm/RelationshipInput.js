// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/layerUtils ../Feature/FeatureRelationship/FeatureRelationshipViewModel ../Feature/support/featureUtils ./EditableInput".split(" "),function(n,c,p,d,b,A,B,r,l,t,u,v){b=function(q){function h(a){var e=q.call(this,a)||this;
e._relationshipVM=null;e.group=null;e.type="relationship";e.handles.add([p.watch(()=>({feature:e.feature,element:e.element,layer:e.layer}),f=>e._createRelationshipVM(f),p.initial)]);return e}n._inherits(h,q);var k=h.prototype;k.destroy=function(){this._relationshipVM?.destroy()};k.incrementPage=function(){this._relationshipVM&&this._relationshipVM.featurePage++};k.getRelatedFeatureByObjectId=function(a){return this._relationshipVM?.getRelatedFeatureByObjectId(a)};k._createRelationshipVM=function(a){const {feature:e,
element:f,layer:g}=a;this._relationshipVM?.destroy();if(e&&f&&g){var {displayCount:m,map:w,orderByFields:x,relationshipId:y,showAllEnabled:z}=this;u.isRelatableFeatureSupportedLayer(g)&&(this._relationshipVM=new t({graphic:e,displayCount:m,layer:g,map:w,orderByFields:x,relationshipId:y,showAllEnabled:z}))}};n._createClass(h,[{key:"canAddRelatedFeature",get:function(){const {editable:a,featureCount:e,_relationshipVM:f}=this;if(!f?.relationship||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const {cardinality:g,
role:m}=f.relationship;return"one-to-one"===g&&0<e||"many-to-many"===g||"one-to-many"===g&&"destination"===m&&0<e?!1:a}},{key:"displayCount",get:function(){return this.element.displayCount??3}},{key:"displayType",get:function(){return this.element.displayType}},{key:"editable",get:function(){return this.relatedLayerAllowsEdits?this.evaluatedEditableExpression??!1:!1}},{key:"featureCount",get:function(){return this._relationshipVM?.featureCount??0}},{key:"map",get:function(){return this._get("map")},
set:function(a){a&&this._relationshipVM?.set("map",a);this._set("map",a)}},{key:"orderByFields",get:function(){return this.element.orderByFields}},{key:"relationshipId",get:function(){return this.element.relationshipId}},{key:"relatedFeatureInfos",get:function(){return this._relationshipVM?.relatedFeatureInfos??[]}},{key:"relatedLayer",get:function(){return this._relationshipVM?.relatedLayer}},{key:"relatedLayerAllowsAdds",get:function(){const {relatedLayer:a}=this;return a&&this.relatedLayerAllowsEdits?
!!l.getEffectiveLayerCapabilities(a)?.operations?.supportsAdd:!1}},{key:"relatedLayerAllowsEdits",get:function(){const {relatedLayer:a}=this;return a?!!l.getEffectiveLayerCapabilities(a)?.operations?.supportsEditing:!1}},{key:"showAllEnabled",get:function(){return this._get("showAllEnabled")},set:function(a){this._relationshipVM?.set("showAllEnabled",a);this._set("showAllEnabled",a)}},{key:"showAllActionVisible",get:function(){return!this.showAllEnabled&&0<this.featureCount&&this.featureCount>this.displayCount}},
{key:"visible",get:function(){const {_relationshipVM:a,relatedLayer:e}=this;if(!a?.relationship)return!1;const {cardinality:f}=a.relationship;return"many-to-many"===f||e&&!l.isTable(e)?!1:null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element}},{key:"updating",get:function(){return"loading"===this._relationshipVM?.state||"querying"===this._relationshipVM?.state}},{key:"loaded",get:function(){return"ready"===this._relationshipVM?.state}}]);return h}(v);c.__decorate([d.property()],
b.prototype,"canAddRelatedFeature",null);c.__decorate([d.property()],b.prototype,"displayCount",null);c.__decorate([d.property()],b.prototype,"displayType",null);c.__decorate([d.property()],b.prototype,"editable",null);c.__decorate([d.property()],b.prototype,"group",void 0);c.__decorate([d.property()],b.prototype,"map",null);c.__decorate([d.property()],b.prototype,"orderByFields",null);c.__decorate([d.property()],b.prototype,"relationshipId",null);c.__decorate([d.property()],b.prototype,"relatedFeatureInfos",
null);c.__decorate([d.property()],b.prototype,"relatedLayer",null);c.__decorate([d.property()],b.prototype,"relatedLayerAllowsAdds",null);c.__decorate([d.property()],b.prototype,"relatedLayerAllowsEdits",null);c.__decorate([d.property()],b.prototype,"showAllEnabled",null);c.__decorate([d.property()],b.prototype,"showAllActionVisible",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"visible",null);c.__decorate([d.property()],b.prototype,
"updating",null);c.__decorate([d.property()],b.prototype,"incrementPage",null);c.__decorate([d.property()],b.prototype,"getRelatedFeatureByObjectId",null);return b=c.__decorate([r.subclass("esri.widgets.FeatureForm.RelationshipInput")],b)});