// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../arcade ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../layers/support/fieldUtils".split(" "),function(a,l,c,m,q,r,d,n,y,z,t,u,v){n=Symbol("FormExpressionArcadeExecutor");a.FormExpressionArcadeExecutor=function(e){function f(h){var b=
e.call(this,h)||this;b[w]=!0;b._lastEvaluatedValue=null;b._abortController=new AbortController;b._stale=!1;b._updatingTracking=new u.WatchUpdatingTracking;b._executeAsyncDebounced=r.debounce(async(k,x,p)=>{k=await b.executor.executeAsync(k,{...x,abortSignal:p});if(p.aborted)return b._lastEvaluatedValue;b._lastEvaluatedValue=k;b._stale=!1;return k});return b}l._inherits(f,e);var g=f.prototype;g.abort=function(){this._abortController.abort()};g.execute=function(h,b){this._abortController=new AbortController;
return this._lastEvaluatedValue=h=this.executor.execute(h,{...b,abortSignal:this._abortController.signal})};g.executeAsync=async function(h,b){this._abortController=new AbortController;return this._updatingTracking.addPromise(this._executeAsyncDebounced(h,b??{},this._abortController.signal))};g.markStale=function(){this._stale=!0};g.reset=function(){this.abort();this._lastEvaluatedValue=null;this._stale=!1};l._createClass(f,[{key:"isAsync",get:function(){return this.executor.isAsync}},{key:"fieldsUsed",
get:function(){return this.executor.fieldsUsed}},{key:"syntaxTree",get:function(){return this.executor.syntaxTree}},{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"stale",get:function(){return this._stale}},{key:"geometryUsed",get:function(){return this.executor.geometryUsed}},{key:"variablesUsed",get:function(){return this.executor.variablesUsed}},{key:"lastEvaluatedValue",get:function(){return this._lastEvaluatedValue}}]);return f}(q);var w=n;c.__decorate([d.property()],
a.FormExpressionArcadeExecutor.prototype,"_lastEvaluatedValue",void 0);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"_stale",void 0);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"_updatingTracking",void 0);c.__decorate([d.property({constructOnly:!0})],a.FormExpressionArcadeExecutor.prototype,"executor",void 0);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"isAsync",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,
"fieldsUsed",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"syntaxTree",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"updating",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"stale",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"geometryUsed",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,"variablesUsed",null);c.__decorate([d.property()],a.FormExpressionArcadeExecutor.prototype,
"lastEvaluatedValue",null);a.FormExpressionArcadeExecutor=c.__decorate([t.subclass("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],a.FormExpressionArcadeExecutor);a.createFormExpressionArcadeExecutor=async(e,f)=>{const g=m.createArcadeProfile("form-calculation");e=await m.createArcadeExecutor(e,g,{});f?.fieldsIndex&&(e.fieldsUsed=v.fixFields(f.fieldsIndex,e.fieldsUsed));return new a.FormExpressionArcadeExecutor({executor:e})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});