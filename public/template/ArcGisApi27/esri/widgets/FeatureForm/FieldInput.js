// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/CodedValue ../../layers/support/CodedValueDomain ../../layers/support/Domain ../../layers/support/InheritedDomain ../../layers/support/RangeDomain ../../layers/support/domainUtils ../../layers/support/fieldUtils ../Feature/support/featureUtils ./EditableInput ./featureFormUtils".split(" "),
function(v,d,e,c,E,F,y,z,A,G,H,I,w,k,B,C,t){var l;(function(p){p.Text="text";p.Number="number";p.Date="date";p.Unsupported="unsupported"})(l||(l={}));c=function(p){function u(a){a=p.call(this,a)||this;a._storedValue=null;a.error=null;a.field=null;a.group=null;a.requiredExpressionExecutor=null;a.type="field";a.valueExpressionExecutor=null;return a}v._inherits(u,p);var x=u.prototype;x._isDomainCompatible=function(a){const {field:b}=this;if("coded-value"===a?.type){const g=typeof a.codedValues[0].code;
if("string"===g&&k.isStringField(b)||"number"===g&&k.isNumericField(b))return!0}return"range"===a?.type&&k.isNumericField(b)||k.isDateField(b)?!0:!1};x._validate=function(){const {dataType:a,domain:b,field:g,initialFeature:f,minLength:m,required:n,valid:r,value:h}=this,q=n&&null==h,D=void 0!==r;return!q&&f.getAttribute(g.name)===h&&D?null:q?k.TypeValidationError.INVALID_TYPE:"text"===a&&-1<m&&"string"===typeof h&&h.length<m?t.LengthValidationError.TOO_SHORT:b?null!==h||n?w.validateDomainValue(b,h):
null:k.validateFieldValue(g,h)};v._createClass(u,[{key:"_dateRange",get:function(){const {element:a}=this;if("datetime-picker"===a?.input?.type){const {max:b,min:g}=a.input;return{max:b,min:g}}return{min:null,max:null}}},{key:"_configAllowsEdits",get:function(){const {element:a,layer:b,name:g}=this;return null!=a?a.editableExpression?!!this.evaluatedEditableExpression:!1!==a.editable:b?.userHasUpdateItemPrivileges?!0:(b&&"popupTemplate"in b?b?.popupTemplate?.fieldInfos?.find(({fieldName:f})=>f===
g):null)?.isEditable??!0}},{key:"_layerAndFieldAllowEdits",get:function(){return this.layerAllowsEdits&&this.field?.editable}},{key:"_isVisibleByDefault",get:function(){const {field:a,layer:b}=this;return!!a?.visible&&k.isFieldVisibleByDefault(a,b)}},{key:"_isEditTrackingField",get:function(){return k.getLowerCaseEditTrackingFields(this.layer).includes(this.name?.toLowerCase())}},{key:"_shouldUseValueExpression",get:function(){return this._layerAndFieldAllowEdits&&!this._configAllowsEdits&&null!=
this.valueExpressionExecutor}},{key:"dataType",get:function(){const {field:a}=this;return k.isNumericField(a)?l.Number:k.isStringField(a)?l.Text:k.isDateField(a)?l.Date:l.Unsupported}},{key:"dateDataType",get:function(){if(this.dataType===l.Date)return"date"!==this.field.type?"string":"number"}},{key:"domain",get:function(){var {layer:a}=this;const {typeFieldName:b,types:g}=t.getNormalizedFeatureTypeInfo(a);if(b===this.name&&null==this.field.domain)return new A({name:"__internal-type-based-coded-value-domain__",
codedValues:g.map(({code:m,name:n})=>new z.CodedValue({code:m,name:n}))});var {feature:f}=this;a=a?.getFieldDomain(this.name,{feature:f});f=this.element?.domain;return null!=f&&this._isDomainCompatible(f)?f:a}},{key:"editable",get:function(){return this._layerAndFieldAllowEdits?this.evaluatedEditableExpression??this._configAllowsEdits:!1}},{key:"evaluatedRequiredExpression",get:function(){const {requiredExpressionExecutor:a}=this;return null!=a?!!a.lastEvaluatedValue:null}},{key:"evaluatedValueExpression",
get:function(){const {valueExpressionExecutor:a}=this;return null!=a?a.lastEvaluatedValue:null}},{key:"hint",get:function(){return this.element?.hint}},{key:"includeDate",get:function(){return!(this.dataType!==l.Date||"time-only"===this.field.type)}},{key:"includeTime",get:function(){const {element:a,field:b}=this;if(this.dataType!==l.Date)return!1;if("time-only"===b.type)return!0;if("date-only"===b.type)return!1;const g="datetime-picker"===a?.input?.type?a.input.includeTime:void 0;return void 0===
g||g}},{key:"includeTimestamp",get:function(){return"timestamp-offset"===this.field.type}},{key:"initialFeature",set:function(a){this._set("initialFeature",a);this.notifyChange("valid")}},{key:"inputType",get:function(){return this.element?.input?.type}},{key:"isRelationshipKeyField",get:function(){const {field:a,layer:b}=this;return B.isRelatableFeatureSupportedLayer(b)&&!!b.relationships?.some(g=>g.keyField===a.name)}},{key:"label",get:function(){return this.element?.label||this.field.alias||this.field.name}},
{key:"maxLength",get:function(){if(this.dataType===l.Date)return-1;const {field:a,element:b}=this,g=a?.length,f=t.isFieldElementWithTextInput(b)?b.input.maxLength:NaN;return null!=f&&!isNaN(f)&&-1<=f&&(-1===g||f<=g)?f:g}},{key:"minLength",get:function(){if(this.dataType===l.Date)return-1;const {field:a,element:b}=this,g=a?.length,f=t.isFieldElementWithTextInput(b)?b.input.minLength:NaN;return null!=f&&!isNaN(f)&&-1<=f&&(-1===g||f<=g)?f:-1}},{key:"name",get:function(){return this.field?.name}},{key:"range",
get:function(){const {_dateRange:a,domain:b,field:g}=this,{max:f,min:m}=a,n=null!=f&&f&&!Number.isNaN(f.valueOf())?f.getTime():null,r=null!=m&&m&&!Number.isNaN(m.valueOf())?m.getTime():null;var h=w.getDomainRange(b)||k.getFieldRange(g);if(!h)return{max:n,min:r};const q=h.max===Number.MAX_VALUE?null:h.max;h=h.min===Number.MIN_VALUE?null:h.min;return{max:null!=n&&(null===q||null!=q&&n<q)?n:q,min:null!=r&&(null===h||null!=h&&r>h)?r:h}}},{key:"required",get:function(){const {editable:a,evaluatedRequiredExpression:b,
field:g,visible:f}=this;return a?!1===g?.nullable?!0:f&&null!=b?b:!1:!1},set:function(a){this._overrideIfSome("required",a)}},{key:"submittable",get:function(){const {field:a,required:b,valid:g,value:f}=this;return b&&null==f?!1:g?!0:this.initialFeature.getAttribute(a.name)===f}},{key:"updating",get:function(){const {editableExpressionExecutor:a,valueExpressionExecutor:b}=this;return null!=b&&b.updating||null!=a&&a.updating}},{key:"valid",get:function(){const a=this.editable?this._validate():null;
this._set("error",a);return null===a}},{key:"value",get:function(){if(this._shouldUseValueExpression){const a=this.evaluatedValueExpression;if(this.dataType===l.Date){if(a instanceof Date)return a.getTime();if("number"!==typeof a)return parseInt(a,10)}return null!=a&&"object"===typeof a?a.toString():a}return this.get("_storedValue")},set:function(a){this.notifyChange("evaluatedVisibilityExpression");this.set("_storedValue",a)}},{key:"visible",get:function(){return this._isEditTrackingField?!1:null!=
this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element?!0:this._isVisibleByDefault}}]);return u}(C);d.__decorate([e.property()],c.prototype,"_storedValue",void 0);d.__decorate([e.property()],c.prototype,"_configAllowsEdits",null);d.__decorate([e.property()],c.prototype,"_layerAndFieldAllowEdits",null);d.__decorate([e.property()],c.prototype,"_isVisibleByDefault",null);d.__decorate([e.property()],c.prototype,"_isEditTrackingField",null);d.__decorate([e.property()],
c.prototype,"_shouldUseValueExpression",null);d.__decorate([e.property()],c.prototype,"dataType",null);d.__decorate([e.property()],c.prototype,"dateDataType",null);d.__decorate([e.property()],c.prototype,"domain",null);d.__decorate([e.property()],c.prototype,"editable",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"error",void 0);d.__decorate([e.property()],c.prototype,"evaluatedRequiredExpression",null);d.__decorate([e.property()],c.prototype,"evaluatedValueExpression",null);d.__decorate([e.property()],
c.prototype,"field",void 0);d.__decorate([e.property()],c.prototype,"group",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"hint",null);d.__decorate([e.property()],c.prototype,"includeDate",null);d.__decorate([e.property()],c.prototype,"includeTime",null);d.__decorate([e.property()],c.prototype,"includeTimestamp",null);d.__decorate([e.property()],c.prototype,"initialFeature",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"inputType",null);d.__decorate([e.property()],c.prototype,
"label",null);d.__decorate([e.property()],c.prototype,"maxLength",null);d.__decorate([e.property()],c.prototype,"minLength",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"name",null);d.__decorate([e.property()],c.prototype,"range",null);d.__decorate([e.property()],c.prototype,"required",null);d.__decorate([e.property()],c.prototype,"requiredExpressionExecutor",void 0);d.__decorate([e.property()],c.prototype,"submittable",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"type",
void 0);d.__decorate([e.property()],c.prototype,"updating",null);d.__decorate([e.property()],c.prototype,"valid",null);d.__decorate([e.property({value:null})],c.prototype,"value",null);d.__decorate([e.property()],c.prototype,"valueExpressionExecutor",void 0);d.__decorate([e.property()],c.prototype,"visible",null);return c=d.__decorate([y.subclass("esri.widgets.FeatureForm.FieldInput")],c)});