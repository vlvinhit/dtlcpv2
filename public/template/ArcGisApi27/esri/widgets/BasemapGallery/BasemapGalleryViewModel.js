// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Basemap ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(q,f,z,r,d,t,n,g,A,E,F,B,p,u,C,v,w,D,l){const x=r.ofType(w);d=function(y){function m(a){a=y.call(this,a)||this;a._loadingProjectionEngine=!1;a.items=new x;a.source=new l;a.view=null;return a}q._inherits(m,y);var h=m.prototype;h.initialize=function(){const a=()=>this._recreateItems();this.handles.add([n.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),n.on(()=>this.source?.basemaps,"change",a,{onListenerAdd:a}),n.when(()=>this.view,()=>{this.source instanceof
l&&(this.source.viewType=this.view?.type)},{once:!0})])};h.castSource=function(a){return Array.isArray(a)||r.isCollection(a)?new D({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new l({portal:a}):!a||a instanceof l||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new l(a)};h.basemapEquals=function(a,b){return C.contentEquals(a,b)};h.refresh=function(){this._recreateItems()};h.load=function(a){this.addResolvingPromise(t.isLoadable(this.source)?this.source.load(a):
null);return Promise.resolve(this)};h._recreateItems=function(){const a=this.source?.basemaps,{view:b,compatibilityFunction:e}=this;this.items.removeAll().forEach(c=>c.destroy());a&&this.items.addMany(a.map(c=>new w({basemap:c,compatibilityFunction:e,view:b})))};h._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};q._createClass(m,[{key:"activeBasemap",get:function(){return this.view?.map?.basemap??null},set:function(a){const b=this.view;
if(b?.map){var e="string"===typeof a?z.fromId(a):a;if(e&&b.ready){var c=e.spatialReference||this.items?.find(k=>this.basemapEquals(e,k.basemap))?.spatialReference;if(c&&"spatialReferenceLocked"in b&&!b.spatialReferenceLocked){const k=b.spatialReference;null==c||u.equals(k,c)||p.canProjectWithoutEngine(b.spatialReference,c)||p.isLoaded()?(b.map.basemap=e,this._clearOverride("activeBasemap"),null==c||u.equals(b.spatialReference,c)||(b.spatialReference=c)):(this._override("activeBasemap",e),this._loadingProjectionEngine=
!0,p.load().then(()=>{this._get("activeBasemap")===a&&(b.map.basemap=a,b.spatialReference=c,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1}))}else b.map.basemap=e,this._clearOverride("activeBasemap")}else b.map.basemap=e,this._clearOverride("activeBasemap")}}},{key:"activeBasemapIndex",get:function(){const {state:a,items:b,activeBasemap:e}=this;if("ready"!==a)return-1;const c=b.findIndex(k=>k.basemap===e);return-1===c?b.findIndex(k=>this.basemapEquals(k.basemap,
e)):c}},{key:"compatibilityFunction",get:function(){return"3d"===this.view?.type?v.default3DCompatibility:v.default2DCompatibility},set:function(a){this._overrideIfSome("compatibilityFunction",a)}},{key:"state",get:function(){return this.view?.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return m}(d.HandleOwnerMixin(t));f.__decorate([g.property()],d.prototype,"_loadingProjectionEngine",void 0);f.__decorate([g.property()],d.prototype,"activeBasemap",null);f.__decorate([g.property({readOnly:!0})],
d.prototype,"activeBasemapIndex",null);f.__decorate([g.property()],d.prototype,"compatibilityFunction",null);f.__decorate([g.property({readOnly:!0,type:x})],d.prototype,"items",void 0);f.__decorate([g.property()],d.prototype,"source",void 0);f.__decorate([A.cast("source")],d.prototype,"castSource",null);f.__decorate([g.property({readOnly:!0})],d.prototype,"state",null);f.__decorate([g.property()],d.prototype,"view",void 0);return d=f.__decorate([B.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],
d)});