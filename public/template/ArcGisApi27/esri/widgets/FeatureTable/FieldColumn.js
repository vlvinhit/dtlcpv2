// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../intl/date ../../intl/number ../../layers/support/CodedValueDomain ../../layers/support/editableLayers ../../layers/support/fieldUtils ../../layers/support/layerUtils ../FeatureForm/featureFormUtils ../FeatureForm/FieldInput ./Grid/EditorColumn ../support/DatePicker ../support/TimePicker ../support/widgetUtils".split(" "),
function(t,k,G,l,h,U,V,H,v,D,I,J,u,K,z,L,M,N,O,A){const P=v.convertDateFormatToIntlOptions("short-date-short-time"),Q=v.convertDateFormatToIntlOptions("short-date"),R={useGrouping:!0,maximumFractionDigits:20};h=function(E){function w(c){var a=E.call(this,c)||this;a._inputField=null;a.cellValueFormatFunction=({rowData:b,value:d})=>{if(a.formatFunction){const {config:e,field:m}=t._assertThisInitialized(a);return a.formatFunction({config:e,field:m,value:A.renderingSanitizer.sanitize(d)})}if(null===d)return"\x26nbsp;";
const {config:f,field:g}=t._assertThisInitialized(a);if(b=a._getDomainForFeature(b?.item?.feature))return a._getComputedDomain(d,b);if("date"===g.type){b=a._getDateFormatOptions();const e="feature"===a.layer?.type&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null;return d?v.formatDate(d,{...b,...e}):null}return z.unsupportedDateFieldTypes.has(g.type)&&d?(d=z.formatDateFieldValue(g,d),A.renderingSanitizer.sanitize(d)):u.isNumericField(g)?(b=f?.format?D.convertNumberFormatToIntlOptions(f.format):
R,D.formatNumber(parseFloat(d),b)):A.renderingSanitizer.sanitize(d)};a.cellValueValidatorFunction=({oldValue:b,value:d})=>a._inputField&&!a._inputField.valid||a.required&&(null==d||""===d)?!1:b!==d;a.config=null;a.editingEnabled=!1;a.expressionInfos=null;a.field=null;a.formatFunction=null;a.headerRenderFunction=b=>{const {root:d}=b,{editable:f,editingEnabled:g,headerMenuEnabled:e,sortable:m}=t._assertThisInitialized(a);a.removeCellContent(d);d.classList.add("esri-field-column__header-content");g&&
!f&&d.appendChild(a.createLockedElement());if(m)a.headerSorterRenderFunction(b);else{const n=document.createElement("div");n.classList.add("esri-field-column__header-label");n.textContent=a.label;d.appendChild(n)}e&&a.headerMenuRenderFunction(b)};a.inputRenderFunction=({root:b,column:d,rowData:f})=>{if(!a.activeEditInfo?.updating&&a.editable){var g=a.getCellValue(d,f),e=a.createInputElement({root:b,column:d,rowData:f,value:g});a._set("activeEditInfo",{column:d,input:e,root:b,rowData:f,updating:!0,
oldValue:g});"date"===a.field.type?a._renderDateEditors(g,b,e):(d=a.createInputContainer(),d.appendChild(e),a.removeCellContent(b),b.appendChild(d),e.focus(),e instanceof HTMLInputElement&&e.select(),a.grid?.notifyResize())}};a.layer=null;a.parseInputValueFunction=({input:b})=>{const d=a._inputField;if(!d)return null;b=b.value;const {dataType:f,required:g}=d;return g||""!==b?"number"===f||"date"===f?parseFloat(b):"text"===f?b.trim():b:null};a.store=null;a.template=null;a.updateRowItemFunction=({rowData:b,
column:d,value:f})=>{b&&(b.item.feature.attributes[d.path]=f)};a.updateStoreItemFunction=async({rowData:b,column:d,value:f})=>{b&&a.store&&(b=a.store.getObjectIdIndex(b.item.objectId)??b.index,await a.store.updateItem({index:b,name:d.path,value:f}))};return a}t._inherits(w,E);var p=w.prototype;p.createInputElement=function({rowData:c,value:a}){c=c?.item;if(!c||!c.feature)return null;this._inputField=this._setUpInputField(c.feature,a);const {field:b,maxLength:d,minLength:f,required:g}=this;({domain:c}=
this._inputField);let e;"coded-value"===c?.type?(e=this._createSelectElement(a,c.codedValues.map(({code:r,name:B})=>({value:r,name:B})),this._inputField),e.onchange=()=>{e.onblur=null;n()}):(e=document.createElement("input"),e.type=u.isNumericField(b)?"number":"text",-1<d&&(e.maxLength=d),0<f&&(e.minLength=f));e.classList.add("esri-field-column__cell-input");e.value=a;e.required=g;let m=!1;e.onkeydown=r=>{m="Escape"===r.key};e.onblur=()=>{e.onblur=null;n()};const n=()=>{m?this.cancel():this.submit();
this._inputField=null};return e};p.createInputContainer=function(){const c=document.createElement("div");c.classList.add("esri-field-column__cell__input-container");return c};p.createLockedElement=function(){const c=document.createElement("div");c.classList.add("esri-icon-locked");return c};p.getCellValue=function({path:c},a){return a?.item?.feature?.attributes?.[c]??null};p._renderDateEditors=function(c,a,b){const {config:d,messagesCommon:f,template:g}=this;var e=c?new Date(c):new Date(Date.now());
const m=new N({dateInputEnabled:!0,value:e}),n=new O({value:e});b.value=e.getTime().toString();let r=!c;const B=()=>{r=!0;const x=this._getCombinedDateTime(m.value,n.value);b.value=x.getTime().toString()},S=()=>{r?this.submit():this.cancel()},T=()=>{b.value=null;this.submit()};G.watch(()=>[m.value,n.value],()=>B());var q=document.createElement("div");const F=document.createElement("div");m.container=q;n.container=F;c=document.createElement("button");c.classList.add("esri-field-column__button","esri-icon-save");
c.onclick=()=>S();c.title=f?.save;e=document.createElement("button");e.classList.add("esri-field-column__button","esri-icon-trash");e.onclick=()=>T();e.title=f?.clear;const y=document.createElement("div");y.classList.add("esri-field-column__cell__date-input-wrapper");y.appendChild(q);(g&&g.input&&"datetime-picker"===g.input.type&&!1!==g.input.includeTime||d&&!1!==d.includeTime)&&y.appendChild(F);q=document.createElement("div");q.classList.add("esri-field-column__cell__date-input-container");q.appendChild(y);
q.appendChild(c);q.appendChild(e);m.when(()=>{const x=m._inputOrButtonNode;x&&(x.onblur=C=>{(C=C.relatedTarget)&&C.className.includes("esri-date-picker")||m.close(!1)});this.grid?.notifyResize()});n.when(()=>this.grid?.notifyResize());this.removeCellContent(a);a.appendChild(q);this.grid?.notifyResize()};p._createSelectElement=function(c,a,b){let d=!1;a=a.map(g=>{g.value===c&&(d=!0);const e=document.createElement("option");e.text=g.name;e.value=g.value;return e});if(null!=c&&""!==c&&!d){const g=document.createElement("option");
g.text=c;g.value=c;a.unshift(g)}b.required||null!=b.value||(b=document.createElement("option"),b.value="",a.unshift(b));const f=document.createElement("select");a.forEach(g=>f.add(g));f.value=c;return f};p._setUpInputField=function(c,a){const {field:b,layer:d}=this;c=new L({feature:c,initialFeature:c.clone(),field:b,layer:d});c.set("value",a);return c};p._isDomainCompatible=function(c){const {field:a}=this;if(c&&"coded-value"===c.type){const b=typeof c.codedValues[0].code;if("string"===b&&u.isStringField(a)||
"number"===b&&u.isNumericField(a))return!0}return c&&"range"===c.type&&u.isNumericField(a)?!0:!1};p._getDomainForFeature=function(c){const {config:a,layer:b,name:d,template:f}=this;if(!b||"wfs"===b.type||"geojson"===b.type||"csv"===b.type)return null;if(f?.domain&&this._isDomainCompatible(f.domain))return f.domain;var {typeIdField:g}=b;const e=this.field.domain;if(g===d&&!e)return new I({name:"__internal-type-based-coded-value-domain__",codedValues:b.types?.map(({id:m,name:n})=>({code:m,name:n}))});
c=g&&null!=d&&b.getFieldDomain(d,{feature:c})||e;g=a?.domain;return this._isDomainCompatible(g)?g:c};p._getComputedDomain=function(c,a){return a?"range"===a.type?c:"coded-value"===a.type?(a=a.codedValues.filter(b=>b.hasOwnProperty("code")&&b.code===c))&&a.length?a[0].name:c:null:null};p._getCombinedDateTime=function(c,a){return new Date(c.getFullYear(),c.getMonth(),c.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())};p._getDateFormatOptions=function(){const {config:c,template:a}=this,b=a?.format?.dateFormat||
c?.format?.dateFormat;return b?v.convertDateFormatToIntlOptions(b):a&&a.input&&!1==="includeTime"in a.input||!1===c?.includeTime?Q:P};t._createClass(w,[{key:"alias",get:function(){return this.field?.alias}},{key:"defaultValue",get:function(){return this.field?.defaultValue}},{key:"description",get:function(){return this.template?.description??this.config?.description??this.field?.description??null}},{key:"editable",get:function(){const {config:c,editingEnabled:a,field:b,layer:d,template:f}=this;if(null==
b||null==d)return!1;const g=J.isEditableLayer(d),e=K.getEffectiveLayerCapabilities(d);return b.editable&&g&&e?.operations.supportsUpdate&&!z.unsupportedDateFieldTypes.has(b.type)?a?!(!1===f?.editable||!1===c?.editable):!(!f?.editable&&!c?.editable):!1}},{key:"header",get:function(){return this.template?.label||this.config?.label||this.alias||this.path||null}},{key:"hidden",get:function(){const {config:c}=this;return!1===c?.visible||this._get("hidden")||!1},set:function(c){this._set("hidden",c)}},
{key:"loadingMessage",get:function(){return this.messages?.loading||"..."}},{key:"maxLength",get:function(){const {field:c,config:a,template:b}=this,d=c?.length,f=b?.input&&"maxLength"in b.input?b.input.maxLength:a?.maxLength;return null!=f&&!isNaN(f)&&-1<=f&&(-1===d||f<=d)?f:d}},{key:"minLength",get:function(){const {config:c,template:a,maxLength:b}=this,d=a?.input&&"minLength"in a.input?a.input.minLength:c?.minLength||null;return b&&d<=b?d:null}},{key:"name",get:function(){return this.field?.name}},
{key:"nullable",get:function(){return this.field?.nullable??!1}},{key:"path",get:function(){return this.field?.name}},{key:"required",get:function(){const {config:c,field:a,template:b}=this;return this.editable&&(!a?.nullable||!0===c?.required||!0===b?.required)}},{key:"sortable",get:function(){return this.template?!1!==this.template?.sortable:!1!==this.config?.sortable}}]);return w}(M);k.__decorate([l.property({readOnly:!0})],h.prototype,"alias",null);k.__decorate([l.property()],h.prototype,"cellValueFormatFunction",
void 0);k.__decorate([l.property()],h.prototype,"cellValueValidatorFunction",void 0);k.__decorate([l.property()],h.prototype,"config",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"defaultValue",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"description",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"editable",null);k.__decorate([l.property()],h.prototype,"editingEnabled",void 0);k.__decorate([l.property()],h.prototype,"expressionInfos",void 0);k.__decorate([l.property()],
h.prototype,"field",void 0);k.__decorate([l.property()],h.prototype,"formatFunction",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"header",null);k.__decorate([l.property()],h.prototype,"hidden",null);k.__decorate([l.property()],h.prototype,"headerRenderFunction",void 0);k.__decorate([l.property()],h.prototype,"inputRenderFunction",void 0);k.__decorate([l.property()],h.prototype,"layer",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"loadingMessage",null);k.__decorate([l.property()],
h.prototype,"maxLength",null);k.__decorate([l.property()],h.prototype,"minLength",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"name",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"nullable",null);k.__decorate([l.property()],h.prototype,"parseInputValueFunction",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"path",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"required",null);k.__decorate([l.property()],h.prototype,"sortable",null);k.__decorate([l.property()],
h.prototype,"store",void 0);k.__decorate([l.property()],h.prototype,"template",void 0);k.__decorate([l.property()],h.prototype,"updateRowItemFunction",void 0);k.__decorate([l.property()],h.prototype,"updateStoreItemFunction",void 0);return h=k.__decorate([H.subclass("esri.widgets.FeatureTable.FieldColumn")],h)});