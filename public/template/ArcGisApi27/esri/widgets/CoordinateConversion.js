// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/events ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./CoordinateConversion/CoordinateConversionViewModel ./CoordinateConversion/support/Conversion ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(x,k,F,y,p,G,h,L,H,I,z,A,B,r,C,c,D){function t(u){return u["data-format"]}const E={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0};h=function(u){function v(a,b){a=u.call(this,a,b)||this;a._popupMessage=null;a._popupTimeoutId=void 0;a._clipboardPopupTimeoutId=void 0;a._coordinateInput=null;a._badInput=!1;a._goToEnabled=!1;a._conversionFormat=null;a._settingsFormat=null;a._previewConversion=null;a._expanded=!1;a._clipboardPopupVisible=!1;a._popupVisible=!1;a._settingsVisible=
!1;a._inputVisible=!1;a.headingLevel=4;a.messages=null;a.messagesCommon=null;a.orientation="auto";a.viewModel=new z;a.visibleElements={...E};return a}x._inherits(v,u);var e=v.prototype;e.castVisibleElements=function(a){return{...E,...a}};e.reverseConvert=function(a,b){return this.viewModel.reverseConvert(a,b)};e.render=function(){const a=this.get("viewModel.state"),b="disabled"===a?c.tsx("div",{key:"esri-coordinate__no-basemap"},this.messages?.noBasemap):null,d=!b&&this._inputVisible?this._renderInputForm():
null,g=!b&&this._settingsVisible?this._renderSettings():null,l=b||d||g?null:this._renderConversionsView(),f=this._popupVisible?this._renderPopup():null;return c.tsx("div",{class:this.classes("esri-coordinate-conversion esri-widget",{["esri-coordinate-conversion--capture-mode"]:"capture"===this.mode,["esri-disabled"]:"loading"===a,["esri-coordinate-conversion--no-basemap"]:"disabled"===a})},f,b,l,g,d)};e._addConversion=function(a){a=a.target;var b=t(a.options[a.options.selectedIndex]);const d=a["data-index"];
null!=b&&null!=d&&(b=new A({format:b}),a.options.selectedIndex=0,0<=d?(this.conversions.removeAt(d),this.conversions.add(b,d)):this.conversions.add(b))};e._findSettingsFormat=function(){return this._settingsFormat||this.conversions.reduceRight((a,b)=>{b=b.format;return b?.hasDisplayProperties?b:a},null)||this.formats.find(a=>a.hasDisplayProperties)};e._hidePopup=function(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0);this._popupVisible=!1;this._popupMessage=
null;this.scheduleRender()};e._hideClipboardPopup=function(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0);this._clipboardPopupVisible=!1;this.scheduleRender()};e._onConvertComplete=function(){this._inputVisible=!1;this._coordinateInput.value=""};e._onCopy=function(a){const b=a.currentTarget["data-conversion"]?.displayCoordinate;null!=b&&(a.clipboardData?.setData("text/plain",b),this._showClipboardPopup(),a.preventDefault())};e._processUserInput=
function(a){a=F.eventKey(a);const b=this.viewModel;"Enter"!==a&&a?this._badInput&&(this._badInput=!1):(a=t(this._coordinateInput))&&this._reverseConvert(this._coordinateInput.value,a).then(d=>{"capture"===this.mode?b.resume():this.mode="capture";this.currentLocation=d;b.setLocation(d);this._onConvertComplete()}).catch(d=>{y.getLogger(this).error(d);this._showPopup(this.messages?.invalidCoordinate);this._badInput=!0})};e._reverseConvert=async function(a,b){const d=this.viewModel;a=await b.reverseConvert(a);
this._goToEnabled&&a&&d.goToLocation(a).catch(g=>{y.getLogger(this).warn(g);this._showPopup(this.messages?.locationOffBasemap)});return a};e._setInputFormat=function(a){a=a.target;a=t(a[a.options.selectedIndex]);null!=a&&(this._conversionFormat=a)};e._setPreviewConversion=function(){const a=this._findSettingsFormat(),b=this.viewModel;if(a){const d=this.conversions.find(g=>g.format===a);this._previewConversion=new A({format:a,position:{location:this.currentLocation,coordinate:d?.position?.coordinate}});
this._previewConversion.position?.coordinate||b.previewConversion(this._previewConversion)}};e._setSettingsFormat=function(a){a=a.target;a=t(a[a.options.selectedIndex]);null!=a&&(this._settingsFormat=a,this._setPreviewConversion())};e._showClipboardPopup=function(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hideClipboardPopup()},750)};e._showPopup=
function(a,b=2500){this._popupMessage=a;this._popupVisible?clearTimeout(this._popupTimeoutId):this._popupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hidePopup()},b)};e._toggleGoTo=function(){this._goToEnabled=!this._goToEnabled};e._updateCurrentPattern=function(a){a.stopPropagation();a=a.target;const b=this._findSettingsFormat();b&&(b.currentPattern=a.value)};e._renderConversion=function(a,b){const {messages:d}=this;if(!d)return c.tsx("li",
null);const {format:g}=a,l=g?.label??"",f=`${this.id}__list-item-${b}`,n=`${l} ${d.conversionOutputSuffix}`;var m=0===b;const q=m||this._expanded,w=m?this._renderFirstConversion(a):this._renderTools(b,a,f);m=m&&!a.displayCoordinate?d.noLocation:a.displayCoordinate;m=c.tsx("div",{"aria-label":m,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabindex:"0",title:m??""},m);const K=this._renderOptions(this.formats.filter(J=>J!==g));return q?c.tsx("li",{"aria-label":n,class:"esri-coordinate-conversion__row",
id:f,key:a,role:"group",title:n,tabindex:"0"},c.tsx("select",{"aria-controls":f,"aria-label":d.selectFormat,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),bind:this,"data-index":b,onchange:this._addConversion,title:d.selectFormat},c.tsx("option",{"aria-label":l,selected:!0,title:l},l.toUpperCase()),K),m,w):null};e._renderCopyButton=function(a){const b=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:d}=this;return d?c.tsx("li",{"aria-label":d.copy,
bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-conversion":a,onclick:this._copyCoordinateOutput,onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:d.copy},b,c.tsx("span",{"aria-hidden":"true",class:"esri-icon-duplicate"})):c.tsx("li",null)};e._renderFirstConversion=function(a){var b=this.id;const d={["esri-icon-down"]:!this._expanded,["esri-icon-up"]:this._expanded},{messages:g,messagesCommon:l,multipleConversions:f,
visibleElements:n}=this;if(!l||!g)return c.tsx("ul",null);var m="live"===this.mode?g.captureMode:g.liveMode;const q=this._expanded?l.collapse:l.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):null;b=f&&n.expandButton&&c.tsx("li",{"aria-controls":`${b}__${"esri-coordinate-conversion__conversion-list"}`,"aria-label":q,bind:this,class:"esri-widget--button",key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",
tabindex:"0",title:q},c.tsx("span",{"aria-hidden":"true",class:this.classes(d)}));m=!f&&n.captureButton&&c.tsx("li",{"aria-label":m,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),key:"esri-coordinate-conversion__mode-toggle",onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:m},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"}));return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},a,b,m)};e._renderInputForm=
function(){const a=this._conversionFormat||this.conversions.at(0).format;var b=this.formats.findIndex(q=>q.name===a?.name),d=this.id;const g=`${d}__${"esri-coordinate-conversion__input-coordinate"}`;d=`${d}__${"esri-coordinate-conversion__input-coordinate"}__header`;b=this._renderOptions(this.formats,!0,b);const l={["esri-coordinate-conversion__input-coordinate--rejected"]:this._badInput},{messages:f,messagesCommon:n,headingLevel:m}=this;return n&&f?c.tsx("div",{"aria-labelledby":d,class:"esri-coordinate-conversion__input-form",
key:"esri-coordinate-conversion__input-form",role:"search"},c.tsx("div",{class:"esri-coordinate-conversion__heading"},c.tsx("div",{"aria-label":n.back,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:n.back},this._renderBackIcon()),c.tsx(B.Heading,{level:m,class:"esri-widget__heading",id:d},f.inputCoordTitle)),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},
c.tsx("select",{"aria-controls":g,"aria-label":f.selectFormat,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),onchange:this._setInputFormat,title:f.selectFormat},b),c.tsx("input",{afterCreate:D.storeNode,"aria-labelledby":d,"aria-required":"true",bind:this,class:this.classes("esri-coordinate-conversion__input-coordinate","esri-input",l),"data-format":a,"data-node-ref":"_coordinateInput",id:g,onkeydown:this._processUserInput,placeholder:f.inputCoordTitle,role:"textbox",
spellcheck:!1,title:f.inputCoordTitle,type:"text"})),c.tsx("div",{class:"esri-coordinate-conversion__input-group"},c.tsx("label",{"aria-label":f.goTo},c.tsx("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:f.goTo,type:"checkbox"}),f.goTo),c.tsx("button",{"aria-label":f.convert,bind:this,class:this.classes("esri-coordinate-conversion__button","esri-button"),onclick:this._processUserInput,title:f.convert,type:"button"},c.tsx("span",{class:"esri-coordinate-conversion__convert-button-span"},
f.convert)))):c.tsx("div",null)};e._renderConversionsView=function(){var {messages:a}=this;if(!a)return c.tsx("div",null);const b=`${this.id}__${"esri-coordinate-conversion__conversion-list"}`,d=this._renderPrimaryTools(),g=this._renderOptions(this.formats),l=this.conversions.map((f,n)=>this._renderConversion(f,n)).toArray();a=this._expanded?c.tsx("div",{class:"esri-coordinate-conversion__row"},c.tsx("select",{"aria-controls":b,"aria-label":a.addConversion,bind:this,class:this.classes("esri-select",
"esri-coordinate-conversion__select-primary"),"data-index":-1,onchange:this._addConversion,title:a.addConversion},c.tsx("option",{disabled:!0,selected:!0,value:""},a.addConversion),g),d):null;return c.tsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",{["esri-coordinate-conversion__conversions-view--expanded"]:this._expanded,["esri-coordinate-conversion__conversions-view--expand-up"]:"expand-up"===this.orientation,["esri-coordinate-conversion__conversions-view--expand-down"]:"expand-down"===
this.orientation}),key:"esri-coordinate-conversion__main-view"},c.tsx("ul",{"aria-expanded":this._expanded?"true":"false",class:"esri-coordinate-conversion__conversion-list",id:b},l),a)};e._renderOptions=function(a,b,d){const g=this.conversions.at(0),l=g.format?.name;return a.map((f,n)=>{const m=b||!g?!1:l===f.name||this.conversions.map(q=>q.format?.name).includes(f.name);return c.tsx("option",{"aria-label":f.label,"data-format":f,disabled:m,key:f.name??"unnamed-format",selected:n===d,value:f.label},
f.label.toUpperCase())}).toArray()};e._renderPopup=function(){return c.tsx("div",{class:"esri-coordinate-conversion__popup",role:"alert"},this._popupMessage)};e._renderClipboardPopup=function(){const {messages:a}=this;return a?c.tsx("div",{class:this.classes("esri-coordinate-conversion__popup","esri-coordinate-conversion__clipboard-popup"),role:"alert"},a.copySuccessMessage):c.tsx("div",null)};e._renderPrimaryTools=function(){const {messages:a,visibleElements:b}=this;if(!a)return c.tsx("ul",null);
var d="live"===this.mode?a.captureMode:a.liveMode;const g=b.inputButton&&c.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:a.inputCoordTitle},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-edit"}));d=b.captureButton&&c.tsx("li",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",
tabindex:"0",title:d},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"}));const l=b.settingsButton&&c.tsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:a.settingsTitle},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-settings2"}));return c.tsx("ul",{class:"esri-coordinate-conversion__tools"},g,d,l)};e._renderSettings=function(){var a=this.id;const b=`${a}__${"esri-coordinate-conversion__pattern-input"}`,
d=`${a}__${"esri-coordinate-conversion__pattern-input"}__header`;a=`${a}__${"esri-coordinate-conversion__preview-coordinate"}`;var g=this.formats.filter(w=>w.hasDisplayProperties),l=this._findSettingsFormat();const f=l?g.indexOf(l):-1;g=this._renderOptions(g,!0,f);l=l?.get("currentPattern");const {messages:n,messagesCommon:m,headingLevel:q}=this;return m&&n?c.tsx("div",{"aria-labelledby":d,class:"esri-coordinate__settings",key:"esri-coordinate-conversion__settings"},c.tsx("div",{class:"esri-coordinate-conversion__heading"},
c.tsx("div",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:m.back},this._renderBackIcon()),c.tsx(B.Heading,{level:q,class:"esri-widget__heading",id:d},n.settingsTitle)),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},c.tsx("label",{for:b},n.changeCoordinateDisplay),c.tsx("select",{"aria-label":n.selectFormat,class:"esri-select",
bind:this,onchange:this._setSettingsFormat,title:n.selectFormat},g),c.tsx("div",{class:"esri-coordinate-conversion__settings-group-horizontal"},c.tsx("input",{"aria-controls":a,bind:this,class:this.classes("esri-coordinate-conversion__pattern-input","esri-input"),id:b,oninput:this._updateCurrentPattern,spellcheck:!1,title:n.changeCoordinateDisplay,type:"text",value:l}),c.tsx("div",{"aria-controls":b,bind:this,class:"esri-widget--button",onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,
role:"button",tabindex:"0",title:n.defaultPattern},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-refresh"})))),c.tsx("div",{class:"esri-coordinate-conversion__settings-group"},c.tsx("label",null,m.preview,c.tsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabindex:"0"},this._previewConversion?.displayCoordinate)))):c.tsx("div",null)};e._renderBackIcon=function(){return c.tsx("span",{"aria-hidden":"true",class:D.isRTL(this.container)?"esri-icon-right-arrow":"esri-icon-left-arrow"})};
e._renderTools=function(a,b,d){b=b.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(b):null;const {messages:g}=this;return g?c.tsx("ul",{class:"esri-coordinate-conversion__tools",role:"listitem"},b,c.tsx("li",{"aria-controls":d,"aria-label":g.removeConversion,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-index":a,key:`${d}__${"esri-widget--button"}`,onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",
title:g.removeConversion},c.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"}))):c.tsx("ul",null)};e._copyCoordinateOutput=function(a){a=a.target;if(!("createTextRange"in document.body)){const b=window.getSelection(),d=document.createRange();d.selectNodeContents(a);b?.removeAllRanges();b?.addRange(d)}document.execCommand("copy")};e._removeConversion=function(a){a=a.currentTarget["data-index"];null!=a&&this.conversions.removeAt(a)};e._setDefaultPattern=function(a){a.stopPropagation();if(a=
this._findSettingsFormat())a.currentPattern=a.get("defaultPattern")};e._toggleExpand=function(){this._expanded=!this._expanded};e._toggleInputVisibility=function(){this._inputVisible=!this._inputVisible;this._popupVisible&&this._hidePopup();this._inputVisible?this.viewModel.pause():this.viewModel.resume()};e._toggleMode=function(){this.mode="live"===this.mode?"capture":"live"};e._toggleSettingsVisibility=function(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();
this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()};x._createClass(v,[{key:"conversions",get:function(){return this.viewModel.conversions},set:function(a){this.viewModel.conversions=a}},{key:"currentLocation",get:function(){return this.viewModel.currentLocation},set:function(a){this.viewModel.currentLocation=a}},{key:"formats",get:function(){return this.viewModel.formats},set:function(a){this.viewModel.formats=a}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},
set:function(a){this.viewModel.goToOverride=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"mode",get:function(){return this.viewModel.mode},set:function(a){this.viewModel.mode=a}},{key:"multipleConversions",get:function(){const a=this._get("multipleConversions");return"boolean"===typeof a?a:!0},set:function(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",
a)}},{key:"locationSymbol",get:function(){return this.viewModel.locationSymbol},set:function(a){this.viewModel.locationSymbol=a}},{key:"storageEnabled",get:function(){return this.viewModel.storageEnabled},set:function(a){this.viewModel.storageEnabled=a}},{key:"storageType",get:function(){return this.viewModel.storageType},set:function(a){this.viewModel.storageType=a}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}}]);return v}(I);k.__decorate([p.property()],
h.prototype,"conversions",null);k.__decorate([p.property()],h.prototype,"currentLocation",null);k.__decorate([p.property()],h.prototype,"formats",null);k.__decorate([p.property()],h.prototype,"goToOverride",null);k.__decorate([p.property()],h.prototype,"headingLevel",void 0);k.__decorate([p.property()],h.prototype,"label",null);k.__decorate([p.property(),C.messageBundle("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],h.prototype,"messages",void 0);k.__decorate([p.property(),C.messageBundle("esri/t9n/common")],
h.prototype,"messagesCommon",void 0);k.__decorate([p.property()],h.prototype,"mode",null);k.__decorate([p.property()],h.prototype,"orientation",void 0);k.__decorate([p.property()],h.prototype,"multipleConversions",null);k.__decorate([p.property()],h.prototype,"locationSymbol",null);k.__decorate([p.property()],h.prototype,"storageEnabled",null);k.__decorate([p.property()],h.prototype,"storageType",null);k.__decorate([p.property()],h.prototype,"view",null);k.__decorate([p.property({type:z})],h.prototype,
"viewModel",void 0);k.__decorate([p.property()],h.prototype,"visibleElements",void 0);k.__decorate([G.cast("visibleElements")],h.prototype,"castVisibleElements",null);k.__decorate([r.accessibleHandler()],h.prototype,"_copyCoordinateOutput",null);k.__decorate([r.accessibleHandler()],h.prototype,"_removeConversion",null);k.__decorate([r.accessibleHandler()],h.prototype,"_setDefaultPattern",null);k.__decorate([r.accessibleHandler()],h.prototype,"_toggleExpand",null);k.__decorate([r.accessibleHandler()],
h.prototype,"_toggleInputVisibility",null);k.__decorate([r.accessibleHandler()],h.prototype,"_toggleMode",null);k.__decorate([r.accessibleHandler()],h.prototype,"_toggleSettingsVisibility",null);return h=k.__decorate([H.subclass("esri.widgets.CoordinateConversion")],h)});