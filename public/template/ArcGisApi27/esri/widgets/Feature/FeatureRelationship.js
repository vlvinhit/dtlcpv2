// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../support/componentsUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(m,p,g,e,v,w,l,h,x,I,J,y,z,q,A,B,C,r,f,D){const t={title:!0,description:!0};e=function(u){function n(a,b){var d=u.call(this,a,b)||this;d._featureElementInfo=null;d._relatedFeatureIntersectionObserverNode=null;d._relatedFeatureIntersectionObserver=new IntersectionObserver(([k])=>{k?.isIntersecting&&d._increaseFeaturePage()},{root:window.document});d.headingLevel=2;d.viewModel=new q;d.messages=null;d.messagesCommon=null;d.visibleElements={...t};d._increaseFeaturePage=()=>{const {state:k,showAllEnabled:E,
relatedFeatures:F,featuresPerPage:G,featurePage:H}=d.viewModel;"ready"===k&&E&&F.length>=G*H&&d.viewModel.featurePage++};return d}p._inherits(n,u);var c=n.prototype;c.initialize=function(){this._featureElementInfo=new A;this.addHandles([l.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),l.initial),l.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),
l.on(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])};c.loadDependencies=function(){return B.loadCalciteComponents({icon:()=>new Promise((a,b)=>m(["../../chunks/calcite-icon"],a,b)),list:()=>new Promise((a,b)=>m(["../../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>m(["../../chunks/calcite-list-item"],a,b)),notice:()=>new Promise((a,b)=>m(["../../chunks/calcite-notice"],a,b))})};c.destroy=function(){this._unobserveRelatedFeatureObserver();
this._featureElementInfo=v.destroyMaybe(this._featureElementInfo)};c.castVisibleElements=function(a){return{...t,...a}};c.renderStickyLoading=function(){return"querying"===this.viewModel.state?f.tsx("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null};c.renderLoadingIcon=function(){return f.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})};c.renderLoading=function(){return f.tsx("div",
{key:"loading-container",class:"esri-feature__loading-container"},this.renderLoadingIcon())};c.renderShowAllIconNode=function(){return f.tsx("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})};c.renderChevronIconNode=function(){const a=C.isRTL(this.container)?"chevron-left":"chevron-right";return f.tsx("calcite-icon",{scale:"s",icon:a,slot:"content-end"})};c.renderRelatedFeature=function(a){const {itemDescriptionFieldName:b}=this.viewModel,d=a.title;a.description=b&&a.formattedAttributes?.global[b];
return f.tsx("calcite-list-item",{class:this.classes("esri-feature-relationship__list-item",{["esri-feature-relationship__list-item--hidden"]:"loading"===a.state}),key:a.uid,label:d,description:a.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:a})},this.renderChevronIconNode())};c.renderShowAllListItem=function(){return this.displayShowAllButton?f.tsx("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,
onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null};c.renderNoRelatedFeaturesMessage=function(){return f.tsx("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},f.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))};c.renderFeatureObserver=function(){return f.tsx("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})};
c.renderList=function(){const {relatedFeatureViewModels:a}=this.viewModel;return f.tsx("calcite-list",null,a.toArray().map(b=>this.renderRelatedFeature(b)),this.renderShowAllListItem())};c.renderRelatedFeatures=function(){const {displayListItems:a}=this,{state:b}=this.viewModel;return f.tsx("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===b})},a?this.renderList():"ready"===b?this.renderNoRelatedFeaturesMessage():
null,this.renderStickyLoading(),this.renderFeatureObserver())};c.renderRelationshipNotFound=function(){return f.tsx("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},f.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))};c.render=function(){const {state:a}=this.viewModel;return f.tsx("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===a?this.renderLoading():
"disabled"===a?this.renderRelationshipNotFound():this.renderRelatedFeatures())};c._setupRelatedFeatureViewModels=function(){const {relatedFeatureViewModels:a}=this.viewModel;this.removeHandles("related-feature-viewmodels");a?.forEach(b=>{this.addHandles(l.watch(()=>[b.title,b.state],()=>this.scheduleRender(),l.initial),"related-feature-viewmodels")});this.scheduleRender()};c._setupFeatureElementInfo=function(){const {headingLevel:a,visibleElements:b}=this,d=b.description&&this.description,k=b.title&&
this.title;this._featureElementInfo?.set({description:d,title:k,headingLevel:a})};c._handleRelatedFeatureObserverChange=async function(){this._unobserveRelatedFeatureObserver();const {state:a,showAllEnabled:b}=this.viewModel;await w.after(0);this._relatedFeatureIntersectionObserverNode&&"ready"===a&&b&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)};c._relatedFeatureIntersectionObserverCreated=function(a){this._relatedFeatureIntersectionObserverNode=
a};c._unobserveRelatedFeatureObserver=function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)};p._createClass(n,[{key:"displayShowAllButton",get:function(){const {showAllEnabled:a,featureCount:b,displayCount:d,state:k}=this.viewModel;return!a&&!!b&&"ready"===k&&(b>d||0===d)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}},{key:"description",
get:function(){return this.viewModel.description},set:function(a){this.viewModel.description=a}},{key:"featureCountDescription",get:function(){const {messages:a}=this,{featureCount:b}=this.viewModel;return D.substitute(a?.numberRecords,{number:b})}},{key:"title",get:function(){return this.viewModel.title},set:function(a){this.viewModel.title=a}}]);return n}(z);g.__decorate([h.property()],e.prototype,"_relatedFeatureIntersectionObserverNode",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,
"displayShowAllButton",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"displayListItems",null);g.__decorate([h.property()],e.prototype,"description",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"featureCountDescription",null);g.__decorate([h.property()],e.prototype,"headingLevel",void 0);g.__decorate([h.property()],e.prototype,"title",null);g.__decorate([h.property({type:q})],e.prototype,"viewModel",void 0);g.__decorate([h.property(),r.messageBundle("esri/widgets/Feature/t9n/Feature")],
e.prototype,"messages",void 0);g.__decorate([h.property(),r.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);g.__decorate([h.property()],e.prototype,"visibleElements",void 0);g.__decorate([x.cast("visibleElements")],e.prototype,"castVisibleElements",null);return e=g.__decorate([y.subclass("esri.widgets.Feature.FeatureRelationship")],e)});