// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/arrayUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),function(A,h,f,D,l,E,I,F,G,H,k,z){const B={chartAnimation:!0};f=
function(C){function y(a){a=C.call(this,a)||this;a.abilities={...B};a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.expressionAttributes=null;a.isAggregate=!1;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}A._inherits(y,C);var r=y.prototype;r.castAbilities=function(a){return{...B,...a}};r.setActiveMedia=function(a){this._setContentElementMedia(a)};r.next=function(){this._pageContentElementMedia(1)};
r.previous=function(){this._pageContentElementMedia(-1)};r._setContentElementMedia=function(a){const {formattedMediaInfoCount:c}=this;this.activeMediaInfoIndex=(a+c)%c};r._pageContentElementMedia=function(a){const {activeMediaInfoIndex:c}=this;this._setContentElementMedia(c+a)};r._formatMediaInfos=function(){const {mediaInfos:a,layer:c}=this,d=this.attributes??{},g=this.formattedAttributes??{},m=this.expressionAttributes??{},e=this.fieldInfoMap??new Map;return a?.map(b=>{b=b?.clone();if(!b)return null;
b.title=k.substituteFieldsInLinksAndAttributes({attributes:d,fieldInfoMap:e,globalAttributes:g,expressionAttributes:m,layer:c,text:b.title});b.caption=k.substituteFieldsInLinksAndAttributes({attributes:d,fieldInfoMap:e,globalAttributes:g,expressionAttributes:m,layer:c,text:b.caption});b.altText=k.substituteFieldsInLinksAndAttributes({attributes:d,fieldInfoMap:e,globalAttributes:g,expressionAttributes:m,layer:c,text:b.altText});if("image"===b.type){var {value:t}=b;this._setImageValue({value:t,formattedAttributes:g,
layer:c});return b.value.sourceURL?b:void 0}return"pie-chart"===b.type||"line-chart"===b.type||"column-chart"===b.type||"bar-chart"===b.type?({value:t}=b,this._setChartValue({value:t,chartType:b.type,attributes:d,formattedAttributes:g,layer:c,expressionAttributes:m}),b):null}).filter(D.isSome)??[]};r._setImageValue=function(a){const c=this.fieldInfoMap??new Map,{value:d,formattedAttributes:g,layer:m}=a,{linkURL:e,sourceURL:b}=d;b&&(a=k.fixTokens(b,m),d.sourceURL=k.substituteAttributes({formattedAttributes:g,
template:a,fieldInfoMap:c}));e&&(a=k.fixTokens(e,m),d.linkURL=k.substituteAttributes({formattedAttributes:g,template:a,fieldInfoMap:c}))};r._setChartValue=function(a){const {value:c,attributes:d,formattedAttributes:g,chartType:m,layer:e,expressionAttributes:b}=a,{popupTemplate:t,relatedInfos:w}=this,{fields:u,normalizeField:q}=c;c.fields=k.getFixedFieldNames(u,e);q&&(c.normalizeField=k.getFixedFieldName(q,e));if(u.some(n=>!!(null!=g[n]||k.isRelatedField(n)&&w?.size))){var p=t?.fieldInfos??[];u.forEach(n=>
{k.isRelatedField(n)?c.series=[...c.series,...this._getRelatedChartInfos({fieldInfos:p,fieldName:n,formattedAttributes:g,chartType:m,value:c})]:(n=this._getChartOption({value:c,attributes:d,chartType:m,formattedAttributes:g,expressionAttributes:b,fieldName:n,fieldInfos:p}),c.series.push(n))})}};r._getRelatedChartInfos=function(a){const {fieldInfos:c,fieldName:d,formattedAttributes:g,chartType:m,value:e}=a,b=[],t=z.getRelatedFieldInfo(d);a=t&&this.relatedInfos?.get(t.layerId.toString());if(!a)return b;
const {relatedFeatures:w,relation:u}=a;if(!u||!w)return b;({cardinality:a}=u);w.forEach(q=>{const {attributes:p}=q;p&&Object.keys(p).forEach(n=>{n===t.fieldName&&b.push(this._getChartOption({value:e,attributes:p,formattedAttributes:g,fieldName:d,chartType:m,relatedFieldName:n,hasMultipleRelatedFeatures:1<w?.length,fieldInfos:c}))})});return"one-to-many"===a||"many-to-many"===a?b:[b[0]]};r._getTooltip=function({label:a,value:c,chartType:d}){return"pie-chart"===d?`${a}`:`${a}: ${c}`};r._getChartOption=
function(a){const {value:c,attributes:d,formattedAttributes:g,expressionAttributes:m,fieldName:e,relatedFieldName:b,fieldInfos:t,chartType:w,hasMultipleRelatedFeatures:u}=a;var q=this.layer,p=this.fieldInfoMap??new Map;const {normalizeField:n,tooltipField:x}=c;a=n?k.isRelatedField(n)?d[z.getRelatedFieldInfo(n).fieldName]:d[n]:null;var v=k.isExpressionField(e)&&m&&void 0!==m[e]?m[e]:b&&void 0!==d[b]?d[b]:void 0!==d[e]?d[e]:g[e];a=new H({fieldName:e,value:void 0===v?null:v&&a?v/a:v});if(k.isRelatedField(e))return q=
p.get(e.toLowerCase()),v=x&&p.get(x.toLowerCase()),p=q?.fieldName??e,v=u&&x?z.getRelatedFieldInfo(x).fieldName:v?.fieldName??x,a.tooltip=this._getTooltip({label:u&&v?d[v]:g[v]??q?.label??q?.fieldName??b,value:u&&b?d[b]:g[p],chartType:w}),a;p=k.getFieldInfo(t,e);q=k.getFixedFieldName(e,q);p=x&&void 0!==g[x]?g[x]:k.getFieldInfoLabel(p||new G({fieldName:q}),this.popupTemplate?.expressionInfos);a.tooltip=this._getTooltip({label:p,value:g[q],chartType:w});return a};A._createClass(y,[{key:"activeMediaInfo",
get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return y}(f);h.__decorate([l.property()],f.prototype,"abilities",void 0);h.__decorate([E.cast("abilities")],f.prototype,"castAbilities",null);h.__decorate([l.property()],f.prototype,"activeMediaInfoIndex",void 0);h.__decorate([l.property({readOnly:!0})],
f.prototype,"activeMediaInfo",null);h.__decorate([l.property()],f.prototype,"attributes",void 0);h.__decorate([l.property()],f.prototype,"description",void 0);h.__decorate([l.property()],f.prototype,"fieldInfoMap",void 0);h.__decorate([l.property()],f.prototype,"formattedAttributes",void 0);h.__decorate([l.property()],f.prototype,"expressionAttributes",void 0);h.__decorate([l.property({readOnly:!0})],f.prototype,"formattedMediaInfos",null);h.__decorate([l.property()],f.prototype,"isAggregate",void 0);
h.__decorate([l.property()],f.prototype,"layer",void 0);h.__decorate([l.property({readOnly:!0})],f.prototype,"formattedMediaInfoCount",null);h.__decorate([l.property()],f.prototype,"mediaInfos",void 0);h.__decorate([l.property()],f.prototype,"popupTemplate",void 0);h.__decorate([l.property()],f.prototype,"relatedInfos",void 0);h.__decorate([l.property()],f.prototype,"title",void 0);return f=h.__decorate([F.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],f)});