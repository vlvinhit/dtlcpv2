// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/a11yUtils ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtilsAm5 ../support/componentsUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils ../../intl/substitute".split(" "),
function(u,E,w,q,I,J,C,x,U,V,W,K,L,M,F,N,O,P,Q,G,R,r,S,T){q=function(H){function D(a,b){var c=H.call(this,a,b)||this;c._refreshTimer=null;c._refreshIntervalInfo=null;c._featureElementInfo=null;c._chartRootMap=new WeakMap;c.viewModel=new F;c.messages=null;c._disposeChart=f=>{c._chartRootMap.get(f)?.dispose();c._chartRootMap.delete(f)};c._createChart=async f=>{const {destroyed:e,viewModel:k}=E._assertThisInitialized(c);if(!e&&k&&f){var {createRoot:m}=await new Promise((g,p)=>u(["../support/chartUtilsAm5"],
g,p));m=await m(f);c._chartRootMap.set(f,m);c._renderChart({mediaInfo:k.activeMediaInfo,root:m})}};return c}E._inherits(D,H);var d=D.prototype;d.initialize=function(){this._featureElementInfo=new N;this.addHandles([C.watch(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),C.initial),C.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),C.initial)])};d.loadDependencies=function(){return Q.loadCalciteComponents({icon:()=>
new Promise((a,b)=>u(["../../chunks/calcite-icon"],a,b))})};d.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo?.destroy()};d.render=function(){return r.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())};d.renderMedia=function(){const {formattedMediaInfoCount:a,activeMediaInfoIndex:b}=this.viewModel,c=this.renderMediaText();return a?r.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},
this.renderMediaInfo(),r.tsx("div",{class:"esri-feature-media__item-navigation"},c,r.tsx("div",{class:"esri-feature-media__pagination"},this.renderMediaPageButton("previous"),r.tsx("span",{class:"esri-feature-media__pagination-text"},T.substitute(this.messages.pageText,{index:b+1,total:a})),this.renderMediaPageButton("next")))):null};d.renderMediaText=function(){var {activeMediaInfo:a}=this.viewModel;if(!a)return null;const b=a&&a.title?r.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",
innerHTML:a.title}):null;a=a&&a.caption?r.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:a.caption}):null;return b||a?r.tsx("div",{key:"media-text",class:"esri-feature-media__item-text"},b,a):null};d.renderImageMediaInfo=function(a){var {_refreshIntervalInfo:b}=this;const {activeMediaInfoIndex:c,formattedMediaInfoCount:f}=this.viewModel,{value:e,refreshInterval:k,altText:m,title:g,type:p}=a,{sourceURL:t,linkURL:l}=e;a=O.shouldOpenInNewTab(l??void 0)?"_blank":"_self";
const n="_blank"===a?"noreferrer":"";b=k?b:null;b=r.tsx("img",{alt:m||g,key:`media-${p}-${c}-${f}-${b?b.timestamp:0}`,src:(b?b.sourceURL:t)??void 0});return(l?r.tsx("a",{title:g,href:l,rel:n,target:a},b):null)??b};d.renderChartMediaInfo=function(a){const {activeMediaInfoIndex:b,formattedMediaInfoCount:c}=this.viewModel;return r.tsx("div",{key:`media-${a.type}-${b}-${c}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._createChart,afterRemoved:this._disposeChart})};d.renderMediaInfoType=
function(){const {activeMediaInfo:a}=this.viewModel;return a?"image"===a.type?this.renderImageMediaInfo(a):a.type.includes("chart")?this.renderChartMediaInfo(a):null:null};d.renderMediaInfo=function(){const {activeMediaInfo:a}=this.viewModel;return a?r.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},r.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType())):null};d.renderMediaPageButton=function(a){if(2>this.viewModel.formattedMediaInfoCount)return null;
const b=(a="previous"===a)?this.messages.previous:this.messages.next;return r.tsx("button",{type:"button",key:a?"media-previous":"media-next",title:b,"aria-label":b,tabIndex:0,class:"esri-feature-media__pagination-button",bind:this,onclick:a?this._previous:this._next},r.tsx("calcite-icon",{class:"esri-feature-media__pagination-icon",scale:"s",icon:a?"chevron-left":"chevron-right"}))};d._setupFeatureElementInfo=function(){const {description:a,title:b}=this;this._featureElementInfo?.set({description:a,
title:b})};d._next=function(){this.viewModel.next()};d._previous=function(){this.viewModel.previous()};d._getRenderer=function(){if(this.viewModel){var {isAggregate:a,layer:b}=this.viewModel;return a&&b?.featureReduction&&"renderer"in b.featureReduction?b.featureReduction.renderer:b?.renderer}};d._getRendererColors=async function(){const {colorAm5:a}=await new Promise((e,k)=>u(["./FeatureMedia/chartCommon"],e,k)),b=new Map,c=this._getRenderer();if(!c)return b;const f=await L.getColorsFromRenderer(c);
f.delete("default");if(!Array.from(f.values()).every(e=>1===e?.length))return b;Array.from(f.keys()).forEach(e=>{const k=f.get(e)?.[0]?.toCss(!0);k&&b.set(e,a(k))});return b};d._handleMediaKeyup=function(a){const b=J.eventKey(a);"ArrowLeft"===b&&(a.stopPropagation(),this.viewModel.previous());"ArrowRight"===b&&(a.stopPropagation(),this.viewModel.next())};d._canAnimateChart=function(){return this.viewModel?!!this.viewModel.abilities.chartAnimation&&!I.prefersReducedMotion():!1};d._getChartAnimationMS=
function(){return this._canAnimateChart()?250:0};d._getChartSeriesAnimationMS=function(){return this._canAnimateChart()?500:0};d._renderChart=async function(a){const {root:b,mediaInfo:c}=a,{value:f,type:e}=c,{ResponsiveThemeAm5:k,DarkThemeAm5:m,AnimatedThemeAm5:g,ColorSetAm5:p,ThemeAm5:t}=await new Promise((v,h)=>u(["./FeatureMedia/chartCommon"],v,h));var l=t.new(b);l.rule("ColorSet").set("colors",P.esriChartColorSet);l=[k.new(b),l];S.isDarkTheme()&&l.push(m.new(b));this._canAnimateChart()&&l.push(g.new(b));
b.setThemes(l);const n=await this._getRendererColors(),A=p.new(b,{});l=f.series.map((v,h)=>{h=n.get(v.fieldName)||A.getIndex(h);return{category:v.tooltip,value:v.value,columnSettings:{fill:h,stroke:h}}}).filter(v=>"pie-chart"===e?null!=v.value&&0<v.value:!0);"pie-chart"===e?this._createPieChart(a,l):this._createXYChart(a,l)};d._getDirection=function(){return G.isRTL(this.container)?"rtl":"ltr"};d._isInversed=function(){return!!G.isRTL(this.container)};d._customizeChartTooltip=async function(a,b="horizontal"){const {colorAm5:c}=
await new Promise((f,e)=>u(["./FeatureMedia/chartCommon"],f,e));a.setAll({pointerOrientation:b});a.get("background")?.setAll({stroke:c("rgba(50, 50, 50, 1)")});a.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})};d._createPieChart=async function(a,b){var {TooltipAm5:c}=await new Promise((p,t)=>u(["./FeatureMedia/chartCommon"],p,t));const {PieChartAm5:f,PieSeriesAm5:e}=await new Promise((p,t)=>u(["./FeatureMedia/pieChart"],p,t)),{mediaInfo:k,root:m}=a;var {title:g}=
k;a=m.container.children.push(f.new(m,{ariaLabel:k?.altText||k?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5}));c=c.new(m,{labelText:"{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})"});g=a.series.push(e.new(m,{name:g,valueField:"value",categoryField:"category",tooltip:c}));g.ticks.template.set("forceHidden",!0);g.labels.template.set("forceHidden",!0);g.slices.template.states.create("active",{shiftRadius:5});this._customizeChartTooltip(c);g.slices.template.setAll({ariaLabel:"{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",
focusable:!0,templateField:"columnSettings"});g.data.setAll(b);g.appear(this._getChartSeriesAnimationMS());a.appear(this._getChartAnimationMS());a.root.dom.classList.toggle("esri-feature-media__chart--rendered",!0)};d._getMinSeriesValue=function(a){let b=0;a.forEach(c=>b=Math.min(c.value,b));return b};d._createColumnChart=async function(a,b,c){const {TooltipAm5:f,ScrollbarAm5:e}=await new Promise((y,z)=>u(["./FeatureMedia/chartCommon"],y,z)),{CategoryAxisAm5:k,AxisRendererXAm5:m,ValueAxisAm5:g,AxisRendererYAm5:p,
ColumnSeriesAm5:t}=await new Promise((y,z)=>u(["./FeatureMedia/xyChart"],y,z)),{mediaInfo:l,root:n}=b,{value:A,title:v}=l;a.setAll({wheelX:"panX",wheelY:"zoomX"});b=a.xAxes.push(k.new(n,{renderer:m.new(n,{inversed:this._isInversed()}),categoryField:"category"}));b.get("renderer").labels.template.setAll({forceHidden:!0});var h=a.yAxes.push(g.new(n,{renderer:p.new(n,{inside:!1}),min:this._getMinSeriesValue(A.series)}));h.get("renderer").labels.template.setAll({direction:this._getDirection()});const B=
f.new(n,{labelText:"{categoryX}"});h=a.series.push(t.new(n,{name:v,xAxis:b,yAxis:h,valueYField:"value",categoryXField:"category",tooltip:B}));this._customizeChartTooltip(B);h.columns.template.setAll({ariaLabel:"{categoryX}",focusable:!0,templateField:"columnSettings"});15<A.series.length&&a.set("scrollbarX",e.new(n,{orientation:"horizontal"}));b.data.setAll(c);h.data.setAll(c);h.appear(this._getChartSeriesAnimationMS());a.appear(this._getChartAnimationMS())};d._createBarChart=async function(a,b,c){const {TooltipAm5:f,
ScrollbarAm5:e}=await new Promise((y,z)=>u(["./FeatureMedia/chartCommon"],y,z)),{CategoryAxisAm5:k,AxisRendererXAm5:m,ValueAxisAm5:g,AxisRendererYAm5:p,ColumnSeriesAm5:t}=await new Promise((y,z)=>u(["./FeatureMedia/xyChart"],y,z)),{mediaInfo:l,root:n}=b,{value:A,title:v}=l;a.setAll({wheelX:"panY",wheelY:"zoomY"});b=a.yAxes.push(k.new(n,{renderer:p.new(n,{inversed:!0}),categoryField:"category"}));b.get("renderer").labels.template.setAll({forceHidden:!0});var h=a.xAxes.push(g.new(n,{renderer:m.new(n,
{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(A.series)}));h.get("renderer").labels.template.setAll({direction:this._getDirection()});const B=f.new(n,{labelText:"{categoryY}"});h=a.series.push(t.new(n,{name:v,xAxis:h,yAxis:b,valueXField:"value",categoryYField:"category",tooltip:B}));this._customizeChartTooltip(B,"vertical");h.columns.template.setAll({ariaLabel:"{categoryY}",focusable:!0,templateField:"columnSettings"});15<A.series.length&&a.set("scrollbarY",e.new(n,{orientation:"vertical"}));
b.data.setAll(c);h.data.setAll(c);h.appear(this._getChartSeriesAnimationMS());a.appear(this._getChartAnimationMS())};d._createLineChart=async function(a,b,c){const {TooltipAm5:f,ScrollbarAm5:e}=await new Promise((y,z)=>u(["./FeatureMedia/chartCommon"],y,z)),{CategoryAxisAm5:k,AxisRendererXAm5:m,ValueAxisAm5:g,AxisRendererYAm5:p,LineSeriesAm5:t}=await new Promise((y,z)=>u(["./FeatureMedia/xyChart"],y,z)),{root:l,mediaInfo:n}=b,{value:A,title:v}=n;a.setAll({wheelX:"panX",wheelY:"zoomX"});b=a.xAxes.push(k.new(l,
{renderer:m.new(l,{inversed:this._isInversed()}),categoryField:"category"}));b.get("renderer").labels.template.setAll({forceHidden:!0});var h=a.yAxes.push(g.new(l,{renderer:p.new(l,{inside:!1}),min:this._getMinSeriesValue(A.series)}));h.get("renderer").labels.template.setAll({direction:this._getDirection()});const B=f.new(l,{labelText:"{categoryX}"});h=a.series.push(t.new(l,{name:v,xAxis:b,yAxis:h,valueYField:"value",categoryXField:"category",tooltip:B}));this._customizeChartTooltip(B,"vertical");
15<A.series.length&&a.set("scrollbarX",e.new(l,{orientation:"horizontal"}));b.data.setAll(c);h.data.setAll(c);h.appear(this._getChartSeriesAnimationMS());a.appear(this._getChartAnimationMS())};d._createXYChart=async function(a,b){const {XYChartAm5:c,XYCursorAm5:f}=await new Promise((p,t)=>u(["./FeatureMedia/xyChart"],p,t)),{root:e,mediaInfo:k}=a,{type:m}=k,g=e.container.children.push(c.new(e,{ariaLabel:k?.altText||k?.title||"",focusable:!0,panX:!0,panY:!0}));g.set("cursor",f.new(e,{}));"column-chart"===
m&&await this._createColumnChart(g,a,b);"bar-chart"===m&&await this._createBarChart(g,a,b);"line-chart"===m&&await this._createLineChart(g,a,b);g.root.dom.classList.toggle("esri-feature-media__chart--rendered",!0)};d._clearMediaRefreshTimer=function(){const {_refreshTimer:a}=this;a&&(clearTimeout(a),this._refreshTimer=null)};d._updateMediaInfoTimestamp=function(a){const b=Date.now();this._refreshIntervalInfo={timestamp:b,sourceURL:a&&this._getImageSource(a,b)}};d._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();
const {activeMediaInfo:a}=this.viewModel;a&&"image"===a.type&&a.refreshInterval&&this._setRefreshTimeout(a)};d._setRefreshTimeout=function(a){const {refreshInterval:b,value:c}=a;b&&(a=6E4*b,this._updateMediaInfoTimestamp(c.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(c.sourceURL)},a))};d._getImageSource=function(a,b){const c=a.includes("?")?"\x26":"?",[f,e=""]=a.split("#");return`${f}${c}timestamp=${b}${e?"#":""}${e}`};E._createClass(D,[{key:"attributes",get:function(){return this.viewModel.attributes},
set:function(a){this.viewModel.attributes=a}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(a){this.viewModel.activeMediaInfoIndex=a}},{key:"description",get:function(){return this.viewModel.description},set:function(a){this.viewModel.description=a}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(a){this.viewModel.fieldInfoMap=a}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=
a}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(a){this.viewModel.mediaInfos=a}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},set:function(a){this.viewModel.popupTemplate=a}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},set:function(a){this.viewModel.relatedInfos=a}},{key:"title",get:function(){return this.viewModel.title},set:function(a){this.viewModel.title=a}}]);return D}(M);w.__decorate([x.property()],q.prototype,
"_refreshIntervalInfo",void 0);w.__decorate([x.property()],q.prototype,"attributes",null);w.__decorate([x.property()],q.prototype,"activeMediaInfoIndex",null);w.__decorate([x.property()],q.prototype,"description",null);w.__decorate([x.property()],q.prototype,"fieldInfoMap",null);w.__decorate([x.property()],q.prototype,"layer",null);w.__decorate([x.property()],q.prototype,"mediaInfos",null);w.__decorate([x.property()],q.prototype,"popupTemplate",null);w.__decorate([x.property()],q.prototype,"relatedInfos",
null);w.__decorate([x.property()],q.prototype,"title",null);w.__decorate([x.property({type:F})],q.prototype,"viewModel",void 0);w.__decorate([x.property(),R.messageBundle("esri/widgets/Feature/t9n/Feature")],q.prototype,"messages",void 0);return q=w.__decorate([K.subclass("esri.widgets.Feature.FeatureMedia")],q)});