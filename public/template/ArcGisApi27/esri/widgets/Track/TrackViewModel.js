// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../support/GeolocationPositioning".split(" "),function(m,d,h,e,b,v,w,p,q){b=function(n){function g(a){a=n.call(this,a)||this;a._watchId=void 0;a._trackStartingTimeoutId=void 0;a._settingPosition=null;a._trackController=null;a.positionFilterFunction=
null;return a}m._inherits(g,n);var c=g.prototype;c.destroy=function(){this._stopTracking()};c.start=function(){"disabled"!==this.state&&"feature-unsupported"!==this.state&&this._startTracking()};c.stop=function(){"disabled"!==this.state&&"feature-unsupported"!==this.state&&this._stopTracking()};c._stopWatchingPosition=function(){void 0!==this._watchId&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)};c._stopTracking=function(){this._abortTrack();this._clearWaitingTimer();this._stopWatchingPosition();
this._clearGraphic()};c._startTracking=function(){this._stopTracking();const a=h.debounce(async f=>{this._abortTrack();const k=new AbortController;this._trackController=k;const {timestamp:r,coords:t}=f,u={timestamp:r,coords:{...t}};try{if("function"!==typeof this.positionFilterFunction||this.positionFilterFunction.call(null,{position:u}))await this.updatePosition(f,k),this._trackController===k&&(this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:f}),this._trackController=null)}catch(l){if(!h.isAbortError(l))throw this._trackController=
null,this._emitError(l),this._clearWaitingTimer(),l;}},0);this._watchId=navigator.geolocation.watchPosition(f=>{this._settingPosition=a(f).catch(h.ignoreAbortErrors)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0);this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},15E3)};c._handleWatchPositionError=function(a){a.code===a.PERMISSION_DENIED&&this._stopTracking();this._emitError(a)};c._abortTrack=function(){this._trackController?.abort();this._trackController=
null};c._clearWaitingTimer=function(){clearTimeout(this._trackStartingTimeoutId);this._trackStartingTimeoutId=void 0;this._settingPosition=null};c._emitError=function(a){this.emit("track-error",{error:a})};m._createClass(g,[{key:"state",get:function(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||void 0!==this._trackStartingTimeoutId?"waiting":this.tracking?"tracking":"ready":"feature-unsupported"}},{key:"tracking",get:function(){return void 0!==this._watchId}}]);
return g}(q);d.__decorate([e.property()],b.prototype,"_watchId",void 0);d.__decorate([e.property()],b.prototype,"_trackStartingTimeoutId",void 0);d.__decorate([e.property()],b.prototype,"_settingPosition",void 0);d.__decorate([e.property()],b.prototype,"positionFilterFunction",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"state",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"tracking",null);d.__decorate([e.property()],b.prototype,"start",null);d.__decorate([e.property()],
b.prototype,"stop",null);return b=d.__decorate([p.subclass("esri.widgets.Track.TrackViewModel")],b)});