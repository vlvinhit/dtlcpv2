// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/events ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../properties/defaultUnit ../rest/support/Stop ../symbols/SimpleMarkerSymbol ./Search ./Widget ./Directions/DirectionsViewModel ./Directions/components/SaveLayer ./Directions/support/directionsUtils ./Directions/support/resources ./Search/support/locatorUtils ./support/componentsUtils ./support/DatePicker ./support/Heading ./support/TimePicker ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../chunks/sortable.esm ../intl/number ../intl/date".split(" "),
function(G,L,m,l,A,M,t,p,T,ha,ia,U,V,W,X,Y,Z,N,aa,E,d,O,ba,ca,y,da,z,H,e,ja,ea,I,P){function Q(B){return!!B.composedPath?.().find(C=>C.classList?.contains("esri-search__suggestions-list"))}function J(B){return B?.["data-stop-index"]}const R={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};l=function(B){function C(a,c){var b=B.call(this,a,c)||this;b._activeStop=null;b._activeManeuver=null;b._autoStopRemovalDelay=100;b._autoStopRemovalTimeoutId=void 0;
b._departureTimeOption=d.DepartureTimeOption.NOW;b._datePicker=new ca;b._focusedManeuver=null;b._newPlaceholderStop=null;b._pointerDownUpHandle=null;b._pointerPressedSearchSuggestionStop=null;b._renderSavePopoverFunction=null;b._saveAsButtonNode=null;b._saveLayer=new aa.SaveLayer;b._sections=null;b._sortable=null;b._stopsToSearches=new Map;b._timePicker=new da;b._viewClickHandle=null;b.headingLevel=2;b.iconClass=d.CSS.widgetIcon;b.icon=null;b.messages=null;b.messagesCommon=null;b.messagesUnits=null;
b.searchProperties=null;b.viewModel=new N;b.visibleElements={...R};b._setUpDragAndDropStops=g=>{b._sortable=ea.Sortable.create(g,{draggable:`.${d.CSS.validStopRow}`,ghostClass:d.CSS.stopRowGhost,handle:`.${d.CSS.stopHandle}`,onEnd:b._handleStopInputDragEnd})};b._handleDragHandlePointerDown=()=>b.viewModel.layer?.stops.forEach(g=>b._acquireSearch(g).activeMenu="none");b._handleStopInputDragEnd=({oldIndex:g,newIndex:h,target:k})=>{if(g!==h&&null!=h&&null!=g){var {children:n}=k,r=n[g];k.insertBefore(n[h],
0>h-g?r.nextElementSibling:r);({stops:k}=b.viewModel.layer);k.reorder(k.at(g),h);for(const q of k)q.sequence=null;b._getDirections()}};return b}L._inherits(C,B);var f=C.prototype;f.initialize=function(){this.addHandles([t.watch(()=>this.viewModel.layer?.routeInfo,()=>{this._focusedManeuver=this._activeManeuver=null;this._sections=this._getSections();this.scheduleRender()},t.initial),t.when(()=>this.view,(a,c)=>{c&&(this._viewClickHandle=null,null!=c&&this.removeHandles(c));if(a){c=this._prepPointerDownUpClick();
const b=this._prepViewClick();c.pause();b.pause();const g=a.surface;this.addHandles([A.on(g,"mousedown",()=>this._autoStopRemovalDelay=500),A.on(g,"mouseup",()=>this._autoStopRemovalDelay=100),c,b],a);this._pointerDownUpHandle=c;this._viewClickHandle=b}},t.initial),t.when(()=>null==this.viewModel.serviceDescription,()=>{try{this.viewModel.load()}catch{}},t.initial),t.watch(()=>this._saveLayer.state,()=>{this.scheduleRender()})]);this.when(()=>{!this.destroyed&&this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=
this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))})};f.loadDependencies=function(){return ba.loadCalciteComponents({button:()=>new Promise((a,c)=>G(["../chunks/calcite-button"],a,c)),link:()=>new Promise((a,c)=>G(["../chunks/calcite-link"],a,c)),popover:()=>new Promise((a,c)=>G(["../chunks/calcite-popover"],a,c))})};f.destroy=function(){this._datePicker.destroy();this._timePicker.destroy();for(const a of this._stopsToSearches.values())a.destroy();
this._sortable?.destroy();null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)};f.castVisibleElements=function(a){return{...R,...a}};f.getDirections=function(){return this.viewModel.getDirections()};f.render=function(){return e.tsx("div",{class:this.classes(d.CSS.base,d.CSS.scroller)},this._renderPanelContent())};f.save=function(){return this.viewModel.save()};f.saveAs=function(a,c={}){return this.viewModel.saveAs(a,c)};f.zoomToRoute=function(){return this.viewModel.zoomToRoute()};
f._renderPanelContent=function(){const {layer:a,serviceDescription:c,state:b}=this.viewModel;var g="initializing"===b;const h="error"===b&&!c,k="unauthenticated"===b,n={[d.CSS.panelContentLoading]:g,[d.CSS.panelContentError]:h||!a,[d.CSS.panelContentSignIn]:k},r=g?"presentation":"group";g=a?k?this._renderSignIn():h?this._renderMessage(this._getErrorMessage()):g?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return e.tsx("div",{class:this.classes(d.CSS.panelContent,
n),role:r},g)};f._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]};f._renderSignIn=function(){return e.tsx("div",{key:"sign-in",class:d.CSS.signInContent},e.tsx(y.Heading,{class:d.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),e.tsx(y.Heading,{level:y.incrementHeadingLevel(this.headingLevel)},
this.messages.signInRequired),e.tsx("button",{class:this.classes(d.CSS.button,d.CSS.buttonSecondary,d.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))};f._handleSignInClick=function(){this.viewModel.load().catch(()=>{})};f._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const {selectedTravelMode:a,travelModes:c}=this.viewModel;if(0===c.length)return null;const b=null!=a?a.name:this.messages.travelMode;
return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.CSS.travelMode,this._saveLayer.opened&&d.CSS.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},e.tsx("select",{"aria-label":b,bind:this,class:this.classes(d.CSS.travelModeSelect,d.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:b},c.map((g,h)=>e.tsx("option",{key:`esri-directions__travel-mode-${h}`,"data-mode":g,selected:a===g,value:`${h}`},
g.name))))};f._handleTravelModeChange=function(a){var c=a.currentTarget;a=this.viewModel;c=c.item(c.selectedIndex)?.["data-mode"];a.selectedTravelMode=c;this._getDirections()};f._renderStopsContainer=function(){return this.visibleElements.stops?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.CSS.section,this._saveLayer.opened&&d.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null};f._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;
const {messages:{departAt:a,departureTime:c,leaveNow:b,timeUnspecified:g}}=this;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.CSS.departureTime,this._saveLayer.opened&&d.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},e.tsx("select",{"aria-label":c,bind:this,class:this.classes(d.CSS.departureTimeSelect,d.CSS.select),onchange:this._handleDepartureOptionChange,title:c},e.tsx("option",{value:d.DepartureTimeOption.NOW,selected:this._departureTimeOption===
d.DepartureTimeOption.NOW},b),e.tsx("option",{value:d.DepartureTimeOption.DEPART_AT,selected:this._departureTimeOption===d.DepartureTimeOption.DEPART_AT},a),e.tsx("option",{value:d.DepartureTimeOption.UNSPECIFIED,selected:this._departureTimeOption===d.DepartureTimeOption.UNSPECIFIED},g)),this._departureTimeOption===d.DepartureTimeOption.DEPART_AT?this._renderTimeControls():null)};f._renderStops=function(){const {stops:a}=this.viewModel.layer;let c=0;for(var b of this._stopsToSearches.keys())a.includes(b)||
this._disposeSearch(b);for(var g of a)b=this._acquireSearch(g),"none"!==b.activeMenu&&(c+=1),null!=g.name&&(b.searchTerm=g.name);g=a.toArray().map((h,k)=>{var n=a.length;const r={[d.CSS.stopsIcon]:0<=k&&k<n-1,[d.CSS.lastStopIcon]:k===n-1},q={[d.CSS.lastStopIconContainer]:k===n-1},u={[d.CSS.validStopRow]:!(1<k&&null==h.geometry)};var w=a.at(k+1);w=w&&null!=w.geometry;var v=k===n-1,x=k===n-2;w=2===n&&0===k||2<n&&!v&&!x||2<n&&x&&w||2<n&&v&&null==h.geometry;n=3>n;v=this._acquireSearch(h);({messages:x}=
this);const {removeStop:D,reverseStops:S,unlocated:fa}=x;var F=null!=h.geometry&&null!=h.name?h.name:fa,K=I.formatNumber(k+1);x=`${x.stopLabel} ${K} (${F})`;F=`${this.id}__stop--${k}`;h=!!v.searchTerm&&!!v.selectedResult&&null!=h.geometry&&v.selectedResult.name===h.name;K={zIndex:"none"!==v.activeMenu?`${c--}`:""};return e.tsx("li",{"aria-label":x,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(d.CSS.stopRow,u),id:F,key:k,"data-stop-index":k,styles:K},e.tsx("div",{class:d.CSS.stopHandle},
e.tsx("span",{"aria-hidden":"true",class:this.classes(d.CSS.stopIcon,d.CSS.handleIcon,d.CSS.stopHandleIcon,d.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),e.tsx("div",{bind:this,"aria-labelledby":F,class:this.classes(d.CSS.stopIconContainer,q),"data-stop-index":k,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},e.tsx("span",{class:this.classes(d.CSS.stopIcon,r),tabindex:h?"0":null}))),e.tsx("div",{class:d.CSS.stopInput},v.render()),
e.tsx("div",{class:d.CSS.stopOptions,role:"group"},e.tsx("div",{"aria-label":D,class:d.CSS.removeStopButton,bind:this,"data-stop-index":k,hidden:n,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:D},e.tsx("span",{"aria-hidden":"true",class:this.classes(d.CSS.stopIcon,d.CSS.removeStop,d.CSS.removeStopIcon,d.CSS.interactiveStopIcon)}),e.tsx("span",{class:d.CSS.screenReaderText},"removeStopTitle")),e.tsx("div",{"aria-label":S,class:d.CSS.reverseStops,bind:this,
hidden:w,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:S},e.tsx("span",{"aria-hidden":"true",class:this.classes(d.CSS.stopIcon,d.CSS.reverseStopIcon,d.CSS.interactiveStopIcon)}),e.tsx("span",{class:d.CSS.screenReaderText},"removeStopTitle"))))});b=this._renderAddStop();return e.tsx("div",null,e.tsx("ol",{class:d.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},g),b)};f._renderAddStop=function(){var a=this.viewModel.layer?.stops;if(!a)return null;
const c=a.filter(({geometry:b})=>null!=b);a=a.at(-1);return 1<c.length&&c.length<this.maxStops&&null!=a&&null!=a.geometry?e.tsx("div",{class:d.CSS.toolbarSection},e.tsx("div",{class:d.CSS.toolbarButtons},e.tsx("calcite-button",{appearance:"outline",class:d.CSS.addStopButton,kind:"neutral",scale:"s",round:!0,iconStart:"plus",key:d.CSS.addStopButton,onclick:()=>{this._addNewPlaceholder()},label:this.messages.addStop,width:"full"},this.messages.addStop))):null};f._handleStopIconClick=function(a){a=J(a.currentTarget);
a=null!=a?this.viewModel.layer?.stops.at(a):void 0;a?.geometry&&this._centerAtStop(a)};f._handleClearRouteClick=function(){this.viewModel.reset()};f._centerAtStop=function(a){this.viewModel.centerAt(a)};f._handleStopFieldCreation=function(a){const c=this._newPlaceholderStop;if(c){a=J(a);a=null!=a?this.viewModel.layer?.stops.at(a):void 0;if(c===a){const b=this._acquireSearch(a);b.when(()=>{this.renderNow();b.focus()})}this._newPlaceholderStop=null}};f._handleStopInputBlur=function(a,c){if(!this._saveLayer.opened)if(this.removeHandles("search-term"),
a.selectedResult&&null!=c.geometry&&null!=a.selectedResult?.feature.geometry&&c.geometry===a.selectedResult?.feature.geometry)this._pointerDownUpHandle?.pause();else{var b=null!=c.geometry&&null!=a.selectedResult?.feature.geometry&&c.geometry!==a.selectedResult?.feature.geometry;(null==c.geometry&&null==a.selectedResult?.feature.geometry||b)&&"none"===a.activeMenu&&a.searchTerm?(a.search(),this._pointerDownUpHandle?.pause()):a.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),
this._autoStopRemovalTimeoutId=setTimeout(()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"===a.viewModel.state?this._pointerDownUpHandle?.pause():this._pointerPressedSearchSuggestionStop||(null!=c.geometry&&(c.geometry=null,this._getDirections()),this.scheduleRender()))},this._autoStopRemovalDelay))}};f._handleStopInputFocus=function(a,c){this._pointerDownUpHandle?.resume();const {view:b}=this;if(!this.hasHandles("search-term")&&b){var g=b.cursor;this.addHandles([{remove(){b.cursor=
g}},t.watch(()=>a.searchTerm,h=>{a.destroyed||(b.cursor=h.length?g:"copy")},t.initial)],"search-term");this._activeStop=c}};f._prepViewClick=function(){const {view:a}=this.viewModel;M.assertIsSome(a);M.assertIsSome(a.surface);const c=A.pausable(a,"click",this._handleViewClick.bind(this)),b=A.pausable(a.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId);b.pause()});return{remove(){b.remove();c.remove()},pause(){b.pause();c.pause()},resume(){b.resume();c.resume()}}};f._prepPointerDownUpClick=
function(){const a=A.pausable(document,"pointerdown",b=>{this._pointerPressedSearchSuggestionStop=Q(b)?this._activeStop:null}),c=A.pausable(document,"pointerup",b=>{this._pointerDownUpHandle?.pause();b=Q(b);const g=this._activeStop;b||g!==this._pointerPressedSearchSuggestionStop||this._removeStop(g);this.scheduleRender();this._pointerPressedSearchSuggestionStop=b?g:null});return{remove(){c.remove();a.remove()},pause(){c.pause();a.pause()},resume(){a.resume()}}};f._handleViewClick=function(a){a.stopPropagation();
const c=this._activeStop,b=c?this._stopsToSearches.get(c):null;c&&b&&!b.searchTerm&&(b.search(a.mapPoint).then(g=>{if(g=g?.results[0].results){var {feature:h,name:k}=g[0];c.geometry=h.geometry;c.name=k;b.searchTerm=k}}),this.scheduleRender());this._viewClickHandle?.pause();clearTimeout(this._autoStopRemovalTimeoutId)};f._addNewPlaceholder=function(){this._pointerDownUpHandle?.pause();if(!this._newPlaceholderStop){var a=new W({symbol:new X});this.viewModel.layer?.stops.add(a);this._newPlaceholderStop=
a}};f._handleReverseStops=function(){this._reverseStops()};f._reverseStops=function(){const a=this.viewModel.layer?.stops??[];a.reverse();for(const c of a)c.sequence=null;this._getDirections()};f._handleRemoveStop=function(a){var {layer:c}=this.viewModel;if(c&&(a=J(a.currentTarget),null!=a)){var {stops:b,routeInfo:g}=c;c=b.at(a);this._removeStop(c);null==c.geometry&&null!=g||this._getDirections()}};f._removeStop=function(a){const {stops:c}=this.viewModel.layer;!a||2>=c.length||(this._disposeSearch(a),
c.remove(a))};f._handleDepartureOptionChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);a.value===d.DepartureTimeOption.NOW?(this._departureTimeOption=d.DepartureTimeOption.NOW,this.viewModel.departureTime=d.DepartureTimeOption.NOW,this.removeHandles("date-time-picker"),this._getDirections()):a.value===d.DepartureTimeOption.DEPART_AT?(this._departureTimeOption=d.DepartureTimeOption.DEPART_AT,this.addHandles(t.watch(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime();
this._getDirections()},t.initial),"date-time-picker")):(this._departureTimeOption=d.DepartureTimeOption.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())};f._updateDepartureTime=function(){const a=this._datePicker.value,c=this._timePicker.value;a&&c&&(this.viewModel.departureTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),c.getHours(),c.getMinutes()))};f._renderTimeControls=function(){return e.tsx("div",{class:d.CSS.departureTimeControls,key:"esri-directions__time-controls",
role:"group"},this._datePicker.render(),this._timePicker.render())};f._renderSectionSplitter=function(){return e.tsx("div",{class:d.CSS.sectionSplitter})};f._renderSaveContainer=function(){const {saveButton:a,saveAsButton:c,printButton:b,layerDetails:g}=this.visibleElements;return a||c||b||g?e.tsx("div",{class:d.CSS.saveSection,key:d.CSS.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null};f._renderSaveButtons=function(){const {saveButton:a,saveAsButton:c,printButton:b}=
this.visibleElements;return a||c||b?e.tsx("div",{class:d.CSS.saveButtons,key:d.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null};f._renderSaveButton=function(){if(!this.visibleElements.saveButton)return null;const {portalItem:a,routeInfo:c}=this.viewModel.layer,b=a?.itemControl;return e.tsx("calcite-button",{appearance:"outline",class:d.CSS.saveButton,disabled:!(null!=c&&("admin"===b||"update"===b)),iconStart:"save",key:d.CSS.saveButton,onclick:()=>
{this._handleSaveButtonClick()},label:this.messagesCommon.save,width:"full"},this.messagesCommon.save)};f._renderSaveAsButton=function(){return this.visibleElements.saveAsButton?e.tsx("div",{class:d.CSS.saveAsButtonPopover,key:d.CSS.saveAsButtonPopover},e.tsx("calcite-button",{afterCreate:a=>{this._saveAsButtonNode=a},appearance:"outline",class:d.CSS.saveAsButton,disabled:null==this.viewModel.layer.routeInfo,iconStart:"duplicate",key:d.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),
label:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs)):null};f._renderSavePopover=function(){return e.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode},this._saveLayer.render())};f._handleSaveAsButtonClick=function(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)};f._renderPrintButton=function(){return this.visibleElements.printButton?e.tsx("calcite-button",
{appearance:"outline",class:d.CSS.printButton,iconStart:"print",key:d.CSS.printButton,label:this.messagesCommon.print}):null};f._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const {portalItem:a}=this.viewModel.layer;if(!a)return null;const {id:c,portal:{url:b}}=a;return e.tsx("calcite-link",{class:d.CSS.layerDetailsLink,href:`${b}/home/item.html?id=${c}`,key:d.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)};f._handleSaveButtonClick=
function(){this.viewModel.layer.save()};f._renderDirectionsContainer=function(){return e.tsx("div",{class:this.classes(d.CSS.directionsSection,d.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())};f._renderLoader=function(){return e.tsx("div",{class:d.CSS.loader,key:"loader"})};f._renderWarningCard=function(){return e.tsx("div",{class:d.CSS.warningCard,role:"alert"},e.tsx("div",{class:d.CSS.warningHeader},e.tsx("span",{class:d.CSS.warningIcon,"aria-hidden":"true"}),
e.tsx(y.Heading,{class:d.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),e.tsx("div",{class:d.CSS.warningMessage},this._getErrorMessage()))};f._renderDirectionsContainerContent=function(){const {layer:a,state:c}=this.viewModel,b="routing"===c;return"error"===c?this._renderWarningCard():b?this._renderLoader():null!=a.directionLines?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(d.CSS.summary,this._saveLayer.opened&&d.CSS.buttonDisabled),
key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):e.tsx("div",{key:"esri-directions__placeholder",class:d.CSS.emptyContent},this._renderPlaceholder(),e.tsx(y.Heading,{class:d.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))};f._renderPlaceholder=function(){return e.tsx("svg",{class:d.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},e.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))};
f._renderMessage=function(a){return e.tsx(y.Heading,{class:d.CSS.messageHeading,level:this.headingLevel},a)};f._renderRouteActions=function(){return e.tsx("div",{class:d.CSS.routeActions},e.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(d.CSS.clearRouteButton,d.CSS.button,d.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))};f._getSections=function(){var {layer:a}=this.viewModel;if(!a)return null;const {directionPoints:c,
directionLines:b,stops:g}=a;if(null==c||null==b)return null;a=[];let h=null;for(const n of c){const {objectId:r,stopId:q}=n;if(null!=q){var k=g.find(({objectId:w})=>w===q);const u=0===a.length;if(null==h||h.stop!==k)h={stop:k,directions:[],open:u},a.push(h)}else null!=h&&(k=b.find(({directionPointId:u})=>u===r),null!=k&&h.directions.push({directionPoint:n,directionLine:k}))}return a};f._renderManeuverSections=function(){return null==this._sections?null:e.tsx("div",{class:d.CSS.maneuvers,role:"group"},
this._sections.map((a,c)=>{const {open:b}=a;let g;0<a.directions.length&&b&&(g=e.tsx("ol",{class:d.CSS.maneuverList},a.directions.map(q=>this._renderManeuver(q))));var h=2<this._sections.length;const k=c===this._sections.length-1,n={[d.CSS.collapsibleSection]:h},r={[d.CSS.openIcon]:!b,[d.CSS.closeIcon]:b};h&&!k?(h=b?this.messagesCommon.close:this.messagesCommon.open,a=e.tsx("header",{class:this.classes(d.CSS.maneuverSectionHeader,d.CSS.maneuverSectionToggle),key:d.CSS.maneuverSectionHeader},e.tsx("div",
{"aria-expanded":b.toString(),"aria-label":h,bind:this,class:d.CSS.maneuverSectionHeaderButton,"data-maneuver-section":a,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:h},e.tsx(y.Heading,{class:d.CSS.maneuverSectionTitle,level:this.headingLevel},a.stop.name),e.tsx("span",{"aria-hidden":"true",class:this.classes(r)})))):a=e.tsx("header",{class:d.CSS.maneuverSectionHeader,key:d.CSS.maneuverSectionHeader},e.tsx(y.Heading,{class:d.CSS.maneuverSectionTitle,
level:this.headingLevel},a.stop.name));return e.tsx("section",{class:this.classes(d.CSS.maneuverSection,n),key:c},a,g)}))};f._handleSectionToggle=function(a){if(a=a.currentTarget?.["data-maneuver-section"])a.open=!a.open};f._renderCosts=function(){var a=this._getCostSummary(),{directionPoints:c}=this.viewModel.layer;if(null==c||null==a)return null;c=c.at(-1).arrivalTime;const {distance:b,duration:g}=a,{eta:h,primaryCosts:k,secondaryCosts:n,zoomToRoute:r}=this.messages;a=P.convertDateFormatToIntlOptions("short-time");
if(null!=c){a=P.formatDate(c,a);c=c.getTimezoneOffset();const q=Math.abs(Math.floor(c)%60),u={minimumIntegerDigits:2};c=`GMT${0<c?"-":"+"}${I.formatNumber(Math.abs(Math.floor(c/60)),u)}${I.formatNumber(q,u)}`;a=`<strong>${a}</strong> ${c}`}else a="";return e.tsx("div",{"aria-label":r,bind:this,class:d.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:r},e.tsx("div",{class:d.CSS.costsDetails,role:"group"},e.tsx("div",{class:d.CSS.primaryCosts,
title:k},g),e.tsx("div",{class:d.CSS.verticalSplitter}),e.tsx("div",{class:d.CSS.secondaryCosts,title:n},b)),e.tsx("div",{innerHTML:a,title:h}))};f._handleSummaryInteraction=function(){this._focusedManeuver=this._activeManeuver=null;this.viewModel.clearHighlights();this.zoomToRoute()};f._getErrorMessage=function(){switch(this.viewModel.lastError?.name){case "directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case "directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;
default:return this.messages.errors.unknownError}};f._normalizeSearchSources=function(a){this._overrideDefaultSources(a);this._applyLocatorSourceOverrides(a)};f._overrideDefaultSources=function(a){a.viewModel.defaultSources.forEach(c=>{c.autoNavigate=!1})};f._applyLocatorSourceOverrides=function({allSources:a}){for(const c of a)"url"in c&&c.url&&(c.locationType??(c.locationType="street"),O.isArcGISWorldGeocoder(c.url)&&this.apiKey&&null==c.apiKey&&(c.apiKey=this.apiKey,c.url=O.meteredArcGISLocatorUrl))};
f._acquireSearch=function(a){const {view:c}=this.viewModel;if(this._stopsToSearches.has(a)){const g=this._stopsToSearches.get(a);g.view=c;this._overrideDefaultSources(g);return g}const b=new Y({view:c,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});this._normalizeSearchSources(b);this.addHandles([t.on(()=>b.allSources,"change",()=>this._normalizeSearchSources(b)),b.on("select-result",()=>{a.geometry=b.selectedResult?.feature.geometry;a.name=b.selectedResult?.name;this._getDirections()}),
b.on("search-focus",()=>this._handleStopInputFocus(b,a)),b.on("search-blur",()=>this._handleStopInputBlur(b,a)),b.on("search-clear",()=>{a.geometry=null;a.name=null;this._activeStop=a;this.viewModel.layer?.removeResult()}),t.watch(()=>b.searchTerm,g=>{a.name=g})],b);this._stopsToSearches.set(a,b);return b};f._disposeSearch=function(a){if(a&&this._stopsToSearches.has(a)){var c=this._stopsToSearches.get(a);this.removeHandles(c);c.destroy();this._stopsToSearches.delete(a)}};f._renderManeuver=function(a){const {directionPoint:c,
directionLine:b}=a,{distance:g,duration:h}=b,{messages:k,messagesUnits:n,unit:r}=this;a=E.formatDistance(n,g??0,r);var q=E.formatDuration(h??0);a=a&&q?`${a}&nbsp;&middot;&nbsp;${q}`:`${a}${q}`;q=this._getFormattedManeuverText(c);const {objectId:u,directionPointType:w}=c,v=d.getIconPath(w),x=`esri-directions__maneuver-${u}`,D=`esri-directions__intermediate-costs-${u}`;return e.tsx("li",{"aria-labelledby":`${x} ${D}`,bind:this,class:this.classes(d.CSS.maneuver,{[d.CSS.maneuverActive]:this._activeManeuver===
b}),"data-maneuver":b,key:b,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},null!=v&&e.tsx("img",{alt:"",class:d.CSS.maneuverIcon,src:v}),e.tsx("div",{class:d.CSS.maneuverCostsContainer},e.tsx("span",{id:x,innerHTML:q??""}),e.tsx("div",{class:d.CSS.maneuverCosts},e.tsx("div",{class:d.CSS.horizontalSplitter}),e.tsx("div",
{"aria-hidden":"true",id:D,class:d.CSS.intermediateCost,innerHTML:a,title:k.intermediateCosts}))))};f._handleManeuverClick=function(a){if(a=a.currentTarget?.["data-maneuver"])if(this._activeManeuver===a)this._activeManeuver=null,this.zoomToRoute();else{this._activeManeuver=a;var {geometry:c}=a;this.viewModel.centerAt(c);this.viewModel.highlight(a)}};f._handleManeuverMouseOver=function(a){this._activeManeuver||this._focusedManeuver||(a=a.currentTarget?.["data-maneuver"])&&this.viewModel.highlight(a)};
f._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()};f._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())};f._handleManeuverFocus=function(a){!this._activeManeuver&&(a=a.currentTarget?.["data-maneuver"])&&(this._focusedManeuver=a,this.viewModel.highlight(a))};f._getFormattedManeuverText=function(a){const {displayText:c,name:b,intersectingName:g}=a;if(null==c)return"";a=c;
null!=b&&a.includes(b)&&(a=a.replace(b,`<strong>${b}</strong>`));null!=g&&a.includes(g)&&(a=a.replace(g,`<strong>${g}</strong>`));return a};f._getCostSummary=function(){const {messagesUnits:a,unit:c,viewModel:b}=this;var {routeInfo:g}=b.layer;if(null==g)return null;var h=g.totalDuration??0;g=E.formatDistance(a,g.totalDistance??0,c);h=E.formatDuration(h);return{distance:g,duration:h}};f._getDirections=async function(){const a=this.viewModel.layer?.stops.filter(({geometry:c})=>null!=c);if(a&&!(2>a.length))try{await this.viewModel.getDirections()}catch{}};
L._createClass(C,[{key:"apiKey",get:function(){return this.viewModel.apiKey},set:function(a){this.viewModel.apiKey=a}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(a){this.viewModel.goToOverride=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"lastRoute",get:function(){return this.viewModel.lastRoute}},{key:"layer",get:function(){return this.viewModel.layer},set:function(a){this.viewModel.layer=
a}},{key:"maxStops",get:function(){return this.viewModel.maxStops},set:function(a){this.viewModel.maxStops=a}},{key:"unit",get:function(){return this.defaultUnit},set:function(a){this._overrideIfSome("unit",a)}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}},{key:"test",get:function(){return{acquireSearch:a=>this._acquireSearch(a)}}}]);return C}(Z);m.__decorate([p.property()],l.prototype,"apiKey",null);m.__decorate([p.property(V.defaultUnitPropertyMetadata)],
l.prototype,"defaultUnit",void 0);m.__decorate([p.property()],l.prototype,"goToOverride",null);m.__decorate([p.property()],l.prototype,"headingLevel",void 0);m.__decorate([p.property()],l.prototype,"iconClass",void 0);m.__decorate([p.property()],l.prototype,"icon",void 0);m.__decorate([p.property()],l.prototype,"label",null);m.__decorate([p.property({readOnly:!0})],l.prototype,"lastRoute",null);m.__decorate([p.property()],l.prototype,"layer",null);m.__decorate([p.property()],l.prototype,"maxStops",
null);m.__decorate([p.property(),H.messageBundle("esri/widgets/Directions/t9n/Directions")],l.prototype,"messages",void 0);m.__decorate([p.property(),H.messageBundle("esri/t9n/common")],l.prototype,"messagesCommon",void 0);m.__decorate([p.property(),H.messageBundle("esri/core/t9n/Units")],l.prototype,"messagesUnits",void 0);m.__decorate([p.property()],l.prototype,"searchProperties",void 0);m.__decorate([p.property()],l.prototype,"unit",null);m.__decorate([p.property()],l.prototype,"view",null);m.__decorate([p.property({type:N})],
l.prototype,"viewModel",void 0);m.__decorate([p.property()],l.prototype,"visibleElements",void 0);m.__decorate([T.cast("visibleElements")],l.prototype,"castVisibleElements",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleStopIconClick",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleClearRouteClick",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleReverseStops",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleRemoveStop",null);m.__decorate([z.accessibleHandler()],
l.prototype,"_handleSectionToggle",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleSummaryInteraction",null);m.__decorate([z.accessibleHandler()],l.prototype,"_handleManeuverClick",null);return l=m.__decorate([U.subclass("esri.widgets.Directions")],l)});