// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/HandleOwner ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./support/componentsUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./UtilityNetworkTrace/UtilityNetworkTraceViewModel ./UtilityNetworkTrace/support/GraphicHandler".split(" "),
function(n,v,k,h,r,m,I,J,K,D,E,F,G,w,H,d,x,y){function z(){return{textAlign:"center",padding:"1rem"}}h=function(A){function t(a,b){a=A.call(this,a,b)||this;a._tracesExists=!0;a._graphicHandler=null;a._selectToolActive=!1;a._activeTrace=null;a._activeSwatch="";a._traceHeaderForFlow="";a._assetGroupHeader="";a._assetTypeHeader="";a._traceResultsFunctions=[];a._traceResultsAssetGroup=[];a._traceResultsAssetType=[];a._traceResultsIndividual=[];a._showTraceResultFunctions=!1;a._showTraceResultAssetGroup=
!1;a._showTraceResultAssetType=!1;a._showIndividualRecords=!1;a._activeTab="input";a._flagViewType="starting-point";a._alertRemoveModal=!1;a._warningNoFlag=!1;a._warningNoTraceSelected=!1;a._warningNoStartAssetFound=!1;a._warningNoBarrierAssetFound=!1;a._warningNoTerminal=!1;a._confirmReset=!1;a._showResultOptions=!1;a._resultObjectIdField="objectid";a._resultDisplayField="objectid";a._resultSortField="objectid";a._resultSortOrder="desc";a._swatchNode=null;a._individualResultNode=null;a._symbolStartFlag=
null;a._symbolBarrier=null;a._watchHandler=null;a._loadUNError=!0;a._errorMessage="";a.disabled=!0;a.iconClass="esri-icon-UtilityNetworkTrace";a.inputSettings=[];a.messages=null;a.messagesUnits=null;a.viewModel=new x;return a}v._inherits(t,A);var g=t.prototype;g.initialize=function(){this._utilityNetworkTraceInitialized();this._graphicHandler=new y.GraphicHandler};g.checkCanTrace=async function(){this._confirmReset=!1;const a=this.viewModel.checkCanTrace();a.status?(this._showIndividualRecords=this._showTraceResultAssetType=
this._showTraceResultAssetGroup=this._showTraceResultFunctions=this._warningNoTerminal=this._warningNoTraceSelected=this._warningNoTraceSelected=this._warningNoFlag=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,this.viewModel.removeResultAreaGrahicsLayer(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):a.issues.forEach(b=>{switch(b){case "noStart":this._warningNoFlag=!0;break;case "noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=
!0}})};g.confirmReset=function(){this._confirmReset=!0};g.render=function(){var {state:a}=this.viewModel;this._mixCustomStrings();this._overrideFlagSymbol();a="loading"===a?this.renderLoading():this.renderUtilityNetworkTrace();return d.tsx("div",{class:this.classes("esri-utility-trace-network","esri-widget","esri-widget--panel",{["esri-widget--disabled"]:this.disabled}),styles:{height:"100%"}},a)};g.loadDependencies=function(){return F.loadCalciteComponents({action:()=>new Promise((a,b)=>n(["../chunks/calcite-action"],
a,b)),"action-group":()=>new Promise((a,b)=>n(["../chunks/calcite-action-group"],a,b)),"action-pad":()=>new Promise((a,b)=>n(["../chunks/calcite-action-pad"],a,b)),block:()=>new Promise((a,b)=>n(["../chunks/calcite-block"],a,b)),"block-section":()=>new Promise((a,b)=>n(["../chunks/calcite-block-section"],a,b)),button:()=>new Promise((a,b)=>n(["../chunks/calcite-button"],a,b)),checkbox:()=>new Promise((a,b)=>n(["../chunks/calcite-checkbox"],a,b)),"color-picker-swatch":()=>new Promise((a,b)=>n(["../chunks/calcite-color-picker-swatch"],
a,b)),combobox:()=>new Promise((a,b)=>n(["../chunks/calcite-combobox"],a,b)),"combobox-item":()=>new Promise((a,b)=>n(["../chunks/calcite-combobox-item"],a,b)),flow:()=>new Promise((a,b)=>n(["../chunks/calcite-flow"],a,b)),"flow-item":()=>new Promise((a,b)=>n(["../chunks/calcite-flow-item"],a,b)),icon:()=>new Promise((a,b)=>n(["../chunks/calcite-icon"],a,b)),"input-number":()=>new Promise((a,b)=>n(["../chunks/calcite-input-number"],a,b)),label:()=>new Promise((a,b)=>n(["../chunks/calcite-label"],
a,b)),list:()=>new Promise((a,b)=>n(["../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>n(["../chunks/calcite-list-item"],a,b)),loader:()=>new Promise((a,b)=>n(["../chunks/calcite-loader"],a,b)),modal:()=>new Promise((a,b)=>n(["../chunks/calcite-modal"],a,b)),notice:()=>new Promise((a,b)=>n(["../chunks/calcite-notice"],a,b)),option:()=>new Promise((a,b)=>n(["../chunks/calcite-option"],a,b)),panel:()=>new Promise((a,b)=>n(["../chunks/calcite-panel"],a,b)),popover:()=>new Promise((a,
b)=>n(["../chunks/calcite-popover"],a,b)),select:()=>new Promise((a,b)=>n(["../chunks/calcite-select"],a,b)),tab:()=>new Promise((a,b)=>n(["../chunks/calcite-tab"],a,b)),"tab-nav":()=>new Promise((a,b)=>n(["../chunks/calcite-tab-nav"],a,b)),"tab-title":()=>new Promise((a,b)=>n(["../chunks/calcite-tab-title"],a,b)),tabs:()=>new Promise((a,b)=>n(["../chunks/calcite-tabs"],a,b))})};g.switchTab=function(a){this._activeTab=a};g.switchToFunctions=function(a,b){this._traceResultsFunctions=a;this._showTraceResultFunctions=
b};g.switchToAssetGroup=function(a,b,c){this._traceHeaderForFlow=b;this._traceResultsAssetGroup=a;this._showTraceResultAssetGroup=c};g.switchToAssetType=function(a,b,c){this._assetGroupHeader=b;this._traceResultsAssetType=a;this._showTraceResultAssetType=c};g.switchToIndividualRecords=function(a,b,c){this._assetTypeHeader=b;this._traceResultsIndividual=a;this._showIndividualRecords=c};g.renderLoading=function(){return d.tsx("div",{class:"esri-utility-trace-network__loader-container",key:"loader"},
d.tsx("div",{class:"esri-utility-trace-network__loader"}))};g.renderUtilityNetworkTrace=function(){var {messages:a}=this;a=d.tsx("calcite-tabs",{position:"top",layout:"center",styles:{width:"100%"}},d.tsx("calcite-tab-nav",{slot:"title-group"},d.tsx("calcite-tab-title",{selected:"input"===this._activeTab,onclick:()=>{this.switchTab("input")}},a.inputsStrings.headerTabInputs),d.tsx("calcite-tab-title",{selected:"result"===this._activeTab,onclick:()=>{this.switchTab("result")}},a.resultsStrings.headerTabResults)),
d.tsx("calcite-tab",{selected:"input"===this._activeTab},this.renderInputPanel()),d.tsx("calcite-tab",{selected:"result"===this._activeTab},this.viewModel._activeProgress?d.tsx("calcite-loader",{label:a.alertsStrings.traceExecuting,text:a.alertsStrings.traceExecuting,type:"indeterminate"}):0<this.viewModel.traceResults.length?this.renderResultPanel():this.renderWarningMessage("noTraceExecuted",!1),d.tsx("calcite-modal",{open:this._confirmReset,kind:"brand",scale:"m",width:"s",onCalciteModalClose:()=>
{this._confirmReset=!1}},d.tsx("h3",{slot:"header"},a.resultsStrings.startOverButton),d.tsx("div",{slot:"content"},a.resultsStrings.startOverValidation),d.tsx("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onclick:()=>{this._confirmReset=!1}},a.globalStrings.cancel),d.tsx("calcite-button",{slot:"primary",width:"full",onclick:()=>{this._confirmReset=!1;this.viewModel.reset();this.switchTab("input")}},a.globalStrings.ok))));this._tracesExists||(a=d.tsx("calcite-panel",null,this.renderWarningMessage("noTraceConfig",
!1)));this._loadUNError||(a=d.tsx("calcite-panel",null,this.renderWarningMessage("loadUNError",!1,this._errorMessage)));return a};g.renderInputPanel=function(){const {messages:a}=this;return d.tsx("calcite-flow",{class:"esri-utility-trace-network__flow"},d.tsx("calcite-flow-item",null,this._warningNoFlag?this.renderWarningMessage("flag",!0):null,this._warningNoTerminal?this.renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this.renderWarningMessage("trace",!0):null,this.renderTraceSelectorContainer(),
this.renderStartFlagsContainer(),this.renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?d.tsx("div",{styles:{height:"10px"}}):null,d.tsx("calcite-button",{slot:"footer",scale:"m",kind:"brand",width:"full",onclick:()=>{this.checkCanTrace()}},a.tracingStrings.runTrace)),this._selectToolActive?this.renderActiveTool():null)};g.renderResultPanel=function(){return d.tsx("calcite-flow",{styles:{height:"100%"}},this.renderTraceResults(),this._showTraceResultFunctions?this.renderTraceResultFunctions():
null,this._showTraceResultAssetGroup?this.renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this.renderTraceResultByAssetType():null,this._showIndividualRecords?this.renderTraceResultIndividual():null,this._showIndividualRecords?this.renderTraceResultIndividualPopover():null)};g.renderStartFlagsContainer=function(){const {messages:a}=this,b=[];let c=[];c=this.viewModel._flags.filter(f=>"starting-point"===f.type);c.forEach(f=>{f.displayValue&&b.push(this.renderFlagRow(f,"start"))});
let e=null;this._symbolStartFlag&&(e=this._getSymbolIcon(this._symbolStartFlag));return d.tsx("calcite-block",{heading:a.inputsStrings.headerStartingPoint+" ("+c.length+")",open:!0,collapsible:!0},d.tsx("div",{slot:"icon"},e||d.tsx("calcite-icon",{icon:"pin",scale:"s"})),d.tsx("div",null,a.inputsStrings.startingPointHint),d.tsx("div",{class:"esri-utility-trace-network__list-container"},b),this._warningNoStartAssetFound?this.renderWarningMessage("noStartAsset",!0):null,d.tsx("div",{class:"esri-utility-trace-network__add-button-container"},
d.tsx("calcite-button",{alignment:"center",appearance:"outline",iconStart:"plus",scale:"m",href:"",label:a.inputsStrings.addPointOption,onclick:()=>{this._flagViewType="starting-point";this._selectToolActive=!0;this._warningNoStartAssetFound=!1;this.viewModel.addFlagByHit("starting-point",this._symbolStartFlag).then(f=>{f?this._warningNoFlag=!1:this._warningNoStartAssetFound=!0;this._selectToolActive=!1})},round:!0})))};g.renderBarriersFlagsContainer=function(){const {messages:a}=this,b=[];let c=
[];c=this.viewModel._flags.filter(f=>"barrier"===f.type);c.forEach(f=>{f.displayValue&&b.push(this.renderFlagRow(f,"barrier"))});let e=null;this._symbolBarrier&&(e=this._getSymbolIcon(this._symbolBarrier));return d.tsx("calcite-block",{heading:a.inputsStrings.headerBarrier+" ("+c.length+")",open:!1,collapsible:!0},d.tsx("div",{slot:"icon"},e||d.tsx("calcite-icon",{icon:"x-circle-f",scale:"s"})),d.tsx("div",null,a.inputsStrings.barrierPointHint),d.tsx("div",{class:"esri-utility-trace-network__list-container"},
b),this._warningNoBarrierAssetFound?this.renderWarningMessage("noBarrierAsset",!0):null,d.tsx("div",{class:"esri-utility-trace-network__add-button-container"},d.tsx("calcite-button",{alignment:"center",appearance:"outline",kind:"brand",iconStart:"plus",scale:"m",href:"",round:!0,label:a.inputsStrings.addPointOption,onclick:()=>{this._flagViewType="barrier";this._selectToolActive=!0;this._warningNoBarrierAssetFound=!1;this.viewModel.addFlagByHit("barrier",this._symbolBarrier).then(f=>{f||(this._warningNoBarrierAssetFound=
!0);this._selectToolActive=!1})}})))};g.renderFlagRow=function(a,b){const {messages:c}=this,e=[];let f=!1;null!=a.allTerminals&&0<a.allTerminals.terminals.length&&(f=!0,a.allTerminals.terminals.forEach(l=>{let q=!1;a?.selectedTerminals?.includes(l.id)&&(q=!0);e.push(d.tsx("calcite-combobox-item",{key:l.name,selected:q,value:l.id,textLabel:l.name}))}));return d.tsx("calcite-block",{key:"pop"+a.globalId+a.type+a.id+b,heading:a.displayValue?.value??"",collapsible:null!==a.allTerminals||"barrier"===a.type},
d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:c.globalStrings.remove,label:c.globalStrings.remove,onclick:()=>{this.viewModel.removeFlag(a)},scale:"s",icon:"trash"}),d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:c.globalStrings.zoomToFeature,label:c.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(a.details.geometry)},scale:"s",icon:"zoom-to-object"}),"barrier"===a.type?d.tsx("calcite-label",{scale:"s",layout:"inline"},d.tsx("calcite-checkbox",
{checked:a.isFilterBarrier,scale:"s",onclick:()=>{this.viewModel.manageFilterBarrier(!a.isFilterBarrier,a)}}),c.inputsStrings.barrierFilter):null,f?d.tsx("calcite-combobox",{label:c.globalStrings.selectTerminalPlaceholder,placeholder:c.globalStrings.selectTerminalPlaceholder,selectionMode:"multiple",scale:"s",maxItems:0,onCalciteComboboxChange:l=>{0<l.target.selectedItems.length?(a.selectedTerminals=[],l.target.selectedItems.forEach(q=>{this.viewModel.addTerminal(q.value,a)})):a.selectedTerminals=
[]},onCalciteComboboxChipClose:l=>{l.preventDefault();this.viewModel.removeTerminal(l.target.value,a)}},e):null)};g.renderActiveTool=function(){const {messages:a}=this;let b=null;"starting-point"===this._flagViewType?this._symbolStartFlag&&(b=this._getSymbolIcon(this._symbolStartFlag)):this._symbolBarrier&&(b=this._getSymbolIcon(this._symbolBarrier));return d.tsx("calcite-flow-item",{onCalciteFlowItemBack:()=>{this.viewModel._clickHandler&&(this.viewModel._clickHandler.remove(),this.view?.popup&&
(this.view.popupEnabled=!0));this._selectToolActive=!1},heading:a.inputsStrings.addPointOption},d.tsx("calcite-block",{open:!0,collapsible:!1,heading:""},d.tsx("div",{styles:z()},b||d.tsx("calcite-icon",{icon:"starting-point"===this._flagViewType?"pin-plus":"x-circle-f",scale:"m"})),d.tsx("div",{styles:z()},a.inputsStrings.addPointHint)))};g.renderTraceSelectorContainer=function(){const {messages:a}=this,b=[];let c=a.tracingStrings.traceOperation,e=0;0<this.viewModel._traces.length&&this.viewModel._traces.forEach(f=>
{b.push(d.tsx("calcite-combobox-item",{key:f.globalId,selected:f.selected,value:f.globalId,textLabel:f.title,onCalciteComboboxItemChange:l=>{l=l.target;this.viewModel.selectTraces(l.selected,l.value);0<this.viewModel._traces.length&&(this._warningNoTraceSelected=!1)}}));f.selected&&e++});return d.tsx("calcite-block",{heading:c+` (${e})`,open:!0,collapsible:!0},d.tsx("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),d.tsx("calcite-combobox",{label:a.inputsStrings.selectTraces,placeholder:a.inputsStrings.selectTraces,
selectionMode:"multiple",overlayPositioning:"fixed",scale:"s",maxItems:0},b))};g.renderStartOverContainer=function(){const {messages:a}=this;return d.tsx("calcite-button",{slot:"footer",scale:"m",kind:"brand",width:"full",onclick:()=>{this.confirmReset()}},a.resultsStrings.startOverButton)};g.renderWarningMessage=function(a,b,c){const {messages:e}=this;let f=e.alertsStrings.NoRunAlertHeader,l=e.alertsStrings.noResultsInfo;switch(a){case "flag":f=e.alertsStrings.startingPointAlertHeader;l=e.alertsStrings.startingPointAlert;
break;case "noTerminal":f=e.alertsStrings.noTerminalDefinedHeader;l=e.alertsStrings.noTerminalDefined;break;case "trace":f=e.alertsStrings.selectTraceAlertHeader;l=e.alertsStrings.selectTraceAlert;break;case "noTraceExecuted":f=e.alertsStrings.NoRunAlertHeader;l=e.alertsStrings.noResultsInfo;break;case "noBarrierAsset":case "noStartAsset":f=e.alertsStrings.noAssetsFoundHeader;l=e.alertsStrings.noAssetFound;break;case "noTraceConfig":f="";l=e.alertsStrings.noTraceSupported;break;default:f=e.alertsStrings.genericErrorHeader,
l=c||""}return d.tsx("div",{class:"esri-utility-trace-network__notice-container",key:a},d.tsx("calcite-notice",{key:a,open:!0,closable:b,icon:!0,scale:"s",width:"auto",kind:"danger",onCalciteNoticeClose:()=>{switch(a){case "flag":this._warningNoFlag=!1;break;case "noTerminal":this._warningNoTerminal=!1;break;case "trace":this._warningNoTraceSelected=!1;break;case "noStartAsset":this._warningNoStartAssetFound=!1;break;case "noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},d.tsx("div",{slot:"title"},
f),d.tsx("div",{slot:"message"},l)))};g.renderRemoveTraceContainer=function(a){const {messages:b}=this;return d.tsx("calcite-action",{textEnabled:!0,slot:"header-menu-actions",text:b.globalStrings.clearResults,label:b.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0;this._activeTrace=a.trace},scale:"s",icon:"trash"})};g.renderHighlightColorPicker=function(a,b,c){const {messages:e}=this,f=[];a=new RegExp(`^${a.hex}$`,"i");for(let l=0;l<y.HIGHLIGHT_COLOR.length;l++)f.push(d.tsx("calcite-action",
{key:l,active:a.test(this._graphicHandler?.getHighlightColor(l).hex),text:e.resultsStrings.graphicColor,label:e.resultsStrings.graphicColor,scale:"s",onclick:()=>{"aggregate"===c?this.viewModel.changeResultGraphicColor(this._graphicHandler?.getHighlightColor(l),b):this.viewModel.changeResultAreaColor(b,this._graphicHandler?.getHighlightColor(l))}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:this._graphicHandler?.getHighlightColor(l).hex,active:a.test(this._graphicHandler?.getHighlightColor(l).hex)})));
return d.tsx("calcite-action-pad",{position:"start",layout:"grid",expandDisabled:!0},d.tsx("calcite-action-group",{layout:"grid",columns:4},f))};g.renderTraceResults=function(){const {messages:a}=this,b=[];this.viewModel.traceResults.forEach((c,e)=>{let f=[],l=[],q=!1,u=!1,B=!1,C="";if(null!==c.results)if(c.results.hasOwnProperty("elements")){null!==c.results.aggregatedGeometry&&(u=!0);null!==c.results.globalFunctionResults&&0<c.results.globalFunctionResults.length&&(l=c.results.globalFunctionResults,
0<l.length&&(B=!0));c.results.elements&&0<c.results.elements.length&&(f=c.results.elements,0<f.length&&(q=!0));if(u||q)C=this.messagesUnits.units[c.resultArea?.unit]?.abbr;b.push(d.tsx("calcite-block",{key:c.trace.title,heading:c.trace.title,description:c.trace.description??"",collapsible:!0,open:!0},this.renderRemoveTraceContainer(c),d.tsx("calcite-list",null,B?d.tsx("calcite-list-item",{label:a.resultsStrings.functionHeader+" ("+l.length+")",onCalciteListItemSelect:()=>{this.switchToFunctions(l,
!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,q&&this.viewModel.showSelectionAttributes?d.tsx("calcite-list-item",{key:this.id,label:a.resultsStrings.viewFeatures+" ("+f.length+")",onCalciteListItemSelect:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(c),c.trace.title+" ("+f.length+")",!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?d.tsx("calcite-label",{layout:"inline",scale:"s"},
a.resultsStrings.noSelectionResults):null),q?d.tsx("calcite-label",{layout:"inline",scale:"s",onclick:p=>{p.preventDefault();p.stopPropagation();this.viewModel.mergeSelection(!c.selectionEnabled,c.trace)}},d.tsx("calcite-checkbox",{checked:c.selectionEnabled,scale:"m",onclick:p=>{p.preventDefault();p.stopPropagation();this.viewModel.mergeSelection(!c.selectionEnabled,c.trace)}}),this.viewModel.showSelectionAttributes?a.resultsStrings.selectFeatures:a.resultsStrings.selectFeatures+" ("+f.length+")"):
null,u?d.tsx("calcite-block-section",{toggleDisplay:"switch",text:a.resultsStrings.highlightTrace,open:c.graphicEnabled,onCalciteBlockSectionToggle:p=>{p.target.open?this.viewModel.changeResultGraphicColor(c.graphicColor,c):this.viewModel.removeResultGraphicFromView(c)}},d.tsx("calcite-list",{selectionMode:"none"},d.tsx("calcite-list-item",{label:a.resultsStrings.graphicColor,onclick:p=>{this._swatchNode=p.target;this._activeSwatch="aggGeom_"+e}},d.tsx("calcite-color-picker-swatch",{scale:"s",color:c.graphicColor.hex,
slot:"actions-end"})))):null,this.enableResultArea&&(u||q)?d.tsx("calcite-block-section",{toggleDisplay:"switch",text:a.resultsStrings.resultAreaHeader,open:c.resultArea?.show,onCalciteBlockSectionToggle:p=>{p.target.open?this.viewModel.addResultAreaToMap(c):this.viewModel.removeResultAreaFromMap(c)}},d.tsx("calcite-list",{selectionMode:"none"},d.tsx("calcite-list-item",{label:a.resultsStrings.graphicColor,onclick:p=>{this._swatchNode=p.target;this._activeSwatch="resultArea_"+e}},d.tsx("calcite-color-picker-swatch",
{scale:"s",color:c.resultArea?.color.hex,slot:"actions-end"}))),d.tsx("calcite-list",{selectionMode:"none"},d.tsx("calcite-list-item",{label:a.resultsStrings.resultAreaBuffer},d.tsx("calcite-input-number",{scale:"s",slot:"actions-end",max:999999,maxLength:999999,min:0,suffixText:C,value:c.resultArea?.distance.toString(),class:"esri-utility-trace-network__number-input",onCalciteInputNumberChange:p=>{this.view&&this.view.popup&&(this.view.popup.visible&&this.view.closePopup(),p=p.target,c.resultArea.distance=
0<=c.resultArea.distance?parseInt(p.value,10):0,this.viewModel.removeResultAreaFromMap(c),this.viewModel.addResultAreaToMap(c))}})))):null,d.tsx("calcite-popover",{autoClose:!0,closable:!0,label:a.resultsStrings.graphicColor,referenceElement:this._swatchNode,placement:"auto-start",offsetDistance:0,offsetSkidding:0,scale:"s",open:this._activeSwatch==="aggGeom_"+e||this._activeSwatch==="resultArea_"+e,onCalcitePopoverClose:()=>{this._activeSwatch=this._swatchNode=null}},this.renderHighlightColorPicker(this._activeSwatch===
"resultArea_"+e?c.resultArea?.color:c.graphicColor,c,this._activeSwatch==="resultArea_"+e?"resultArea":"aggregate"))))}else b.push(d.tsx("calcite-block",{key:"error-"+e,heading:c.trace.title,collapsible:!1,open:!0},this.renderRemoveTraceContainer(c),this.renderWarningMessage("noController",!1,c.status)));else b.push(d.tsx("calcite-block",{key:"error-"+e,heading:c.trace.title,collapsible:!1,open:!0},this.renderRemoveTraceContainer(c),this.renderWarningMessage("noController",!1,c.status)))});return d.tsx("calcite-flow-item",
{key:"traceResults",styles:{height:"100%"}},b,this.renderStartOverContainer(),d.tsx("calcite-modal",{open:this._alertRemoveModal,kind:"brand",scale:"m",width:"s",onCalciteModalClose:()=>{this._alertRemoveModal=!1}},d.tsx("h3",{slot:"header"},a.globalStrings.clearResults),d.tsx("div",{slot:"content"},a.alertsStrings.clearResultsAlert),d.tsx("calcite-button",{slot:"secondary",width:"full",appearance:"outline",onclick:()=>{this._alertRemoveModal=!1}},a.globalStrings.cancel),d.tsx("calcite-button",{slot:"primary",
width:"full",onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace);this._alertRemoveModal=!1;0===this.viewModel.traceResults.length?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._showIndividualRecords=this._showTraceResultAssetType=this._showTraceResultAssetGroup=this._showTraceResultFunctions=!1)}},a.globalStrings.ok)))};g.renderTraceResultFunctions=function(){const {messages:a}=this,b=[];this._traceResultsFunctions.forEach(c=>{b.push(this.renderResultRowFunctions(c))});
return d.tsx("calcite-flow-item",{key:"functionResultMultiple",onCalciteFlowItemBack:()=>{this.switchToFunctions([],!1)},heading:a.resultsStrings.functionHeader},b,this.renderStartOverContainer())};g.renderTraceResultByAssetGroup=function(){const a=this._traceResultsAssetGroup,b=[];for(const c in a){const e=a[c];for(const f in e)b.push(this.renderResultRowAssetGroup(e[f]))}return d.tsx("calcite-flow-item",{key:"assetGroupResultMultiple",onCalciteFlowItemBack:()=>{this.switchToAssetGroup([],"",!1)},
heading:this._traceHeaderForFlow},d.tsx("calcite-list",null,b),this.renderStartOverContainer())};g.renderTraceResultByAssetType=function(){const a=this._traceResultsAssetType,b=[];for(const c in a)0<a[c].length&&b.push(this.renderResultRowAssetType(a[c]));return d.tsx("calcite-flow-item",{key:"assetTypeResult",onCalciteFlowItemBack:()=>{this.switchToAssetType([],"",!1)},heading:this._assetGroupHeader},d.tsx("calcite-list",{selectionMode:"none"},b),this.renderStartOverContainer())};g.renderTraceResultIndividual=
function(){const {messages:a}=this,b=this._traceResultsIndividual;b.sort(this._compare(this._resultSortField,this._resultSortOrder));const c=[];0<b.length&&(b[0].details.fields.some(e=>e.name.toLowerCase()===this._resultDisplayField.toLocaleLowerCase())||(this._resultSortField=this._resultDisplayField=this._resultObjectIdField),b.forEach(e=>{c.push(this.renderResultRowIndividual(e))}));return d.tsx("calcite-flow-item",{key:"individualResult",onCalciteFlowItemBack:()=>{this._showResultOptions=!1;this.switchToIndividualRecords([],
"",!1)},heading:this._assetTypeHeader},d.tsx("calcite-action",{slot:"header-actions-end",text:a.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},scale:"m",icon:"gear",label:a.resultsStrings.displayAttribute,id:"field_options"+this.id,afterCreate:G.storeNode,bind:this,"data-node-ref":"_individualResultNode"}),d.tsx("calcite-list",{selectionMode:"none"},c),this.renderStartOverContainer())};g.renderTraceResultIndividualPopover=function(){const {messages:a}=this,b=this._traceResultsIndividual,
c=[],e=[];0<b.length&&b[0].details.fields.forEach(f=>{c.push(d.tsx("calcite-option",{key:"display"+f.name,label:f.alias,value:f.name,selected:f.name===this._resultDisplayField}));e.push(d.tsx("calcite-option",{key:"sort"+f.name,label:f.alias,value:f.name,selected:f.name===this._resultSortField}))});return d.tsx("calcite-popover",{autoClose:!0,label:a.resultsStrings.displayAttribute,referenceElement:this._individualResultNode,placement:"left-start",overlayPositioning:"fixed",offsetDistance:0,offsetSkidding:0,
open:this._showResultOptions,styles:null!==this.domNode?{width:.75*this.domNode.clientWidth+"px"}:{width:"75%"}},d.tsx("calcite-block",{heading:"",open:!0},d.tsx("calcite-label",{scale:"s"},a.resultsStrings.displayAttribute,d.tsx("calcite-select",{scale:"s",label:a.resultsStrings.displayAttribute,onCalciteSelectChange:f=>{this._resultDisplayField=f.target.selectedOption.value;this._showResultOptions=!1}},c)),d.tsx("calcite-label",{scale:"s"},a.resultsStrings.sortBy,d.tsx("calcite-select",{scale:"s",
label:a.resultsStrings.sortBy,onCalciteSelectChange:f=>{this._resultSortField=f.target.selectedOption.value;b.sort(this._compare(this._resultSortField,this._resultSortOrder));this._traceResultsIndividual=b;this._showResultOptions=!1}},e))))};g.renderResultRow=function(a){let b=a[0].assetGroupCode;var c=this.viewModel.getValidSources().filter(e=>e.sourceId===a[0].networkSourceId);0<c.length&&(c=c[0].assetGroups.filter(e=>e.assetGroupCode===a[0].assetGroupCode),0<c.length&&(b=c[0].assetGroupName));
return d.tsx("calcite-list-item",{label:b+" ("+a.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(a),b+" ("+a.length+")",!0)}},d.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))};g.renderResultRowFunctions=function(a){return d.tsx("calcite-block",{heading:a.networkAttributeName+" "+a.functionType+" \x3d "+a.result,collapsible:!1})};g.renderResultRowAssetGroup=function(a){const b=this._getAssetGroupName(a[0]);return d.tsx("calcite-list-item",
{label:b+" ("+a.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(a),b+" ("+a.length+")",!0)}},d.tsx("calcite-icon",{slot:"content-end",icon:"chevron-right",scale:"s"}))};g.renderResultRowAssetType=function(a){const b=this._getAssetTypeName(a[0]);return d.tsx("calcite-list-item",{label:b+" ("+a.length+")",onCalciteListItemSelect:()=>{this.viewModel.queryFeaturesById(a).then(c=>{c?.length?(this._resultObjectIdField=c[0].layer.objectIdField,"objectid"===this._resultDisplayField&&
(this._resultDisplayField=c[0].layer.objectIdField),"objectid"===this._resultSortField&&(this._resultSortField=c[0].layer.objectIdField),c=this._appendAttributes(a,c,"objectId"),this.switchToIndividualRecords(c,b+" ("+a.length+")",!0)):this.switchToIndividualRecords(a,b+" ("+a.length+")",!0)})}},d.tsx("calcite-icon",{slot:"content-end",icon:"chevron-right",scale:"s"}))};g.renderResultRowIndividual=function(a){const {messages:b}=this;var c="";c=null;for(var e=0;e<a.details.fields.length;e++)a.details.fields[e].name===
this._resultDisplayField&&(c=a.details.fields[e]);if("date"===c.type)c=(new Date(a.details.attributes[this._resultDisplayField])).toDateString();else if(null!==c.domain){c=c.domain.codedValues;e="";for(let f=0;f<c.length;f++)c[f].code===a.details.attributes[this._resultDisplayField]&&(e=c[f].name);c=e}else c="assetgroup"===this._resultDisplayField.toLocaleLowerCase()?this._getAssetGroupName(a):"assettype"===this._resultDisplayField.toLocaleLowerCase()?this._getAssetTypeName(a):a.details.attributes[this._resultDisplayField];
c&&""!==c&&null!==c?"string"!==typeof c||c.trim()||(c=b.resultsStrings.noValue):c=b.resultsStrings.noValue;return d.tsx("calcite-list-item",{label:c,onCalciteListItemSelect:()=>{this.viewModel.zoomToAsset(a.details.geometry)}},d.tsx("calcite-icon",{icon:"zoom-to-object",textLabel:b.globalStrings.zoomToFeature,scale:"s",slot:"content-end"}))};g._mixCustomStrings=function(){const {messages:a}=this;0<this.inputSettings.length&&this.inputSettings.forEach(b=>{"starting-point"===b.type&&(a.inputsStrings.headerStartingPoint=
b.label,a.inputsStrings.startingPointHint=b.description);"barrier"===b.type&&(a.inputsStrings.headerBarrier=b.label,a.inputsStrings.barrierPointHint=b.description)})};g._overrideFlagSymbol=function(){0<this.inputSettings.length&&this.inputSettings.forEach(a=>{"starting-point"===a.type?this._symbolStartFlag=a.symbol:this._symbolBarrier=a.symbol;this.viewModel.changeFlagSymbol(a.type,a.symbol)})};g._utilityNetworkTraceInitialized=function(){return this.viewModel.loadUtilityNetwork().then(a=>{if(a)return this.viewModel.selectTracesOnLoad(),
this._registerWatchers(),0>=this.viewModel._traces.length&&(this._tracesExists=!1),0<this.viewModel.flags.length&&this._processFlagOnLoad(),this.view?.when().then(()=>{this._watchViewState()});this.disabled=this._tracesExists=!1}).catch(a=>{const {messages:b}=this;this._loadUNError=!1;this._errorMessage=-2147208474===a.details.raw.extendedCode?b?.alertsStrings?.noUserExtension||a.message:a.message;this.disabled=!1})};g._processFlagOnLoad=function(){return this.view?.when().then(()=>{this._watchHandler=
r.when(()=>!this.view?.updating,async()=>{this._warningNoStartAssetFound=this._warningNoBarrierAssetFound=this._warningNoFlag=!1;const a=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher();a.includes("barrier")&&(this._warningNoBarrierAssetFound=!0);a.includes("starting-point")&&(this._warningNoStartAssetFound=!0);this.disabled=!1;null!==this._watchHandler&&this._watchHandler.remove()})})};g._registerWatchers=function(){this.addHandles([r.watch(()=>this.selectedTraces,
()=>{this.viewModel.selectTracesOnLoad();this.scheduleRender()}),r.watch(()=>this.defaultGraphicColor,()=>{0<this.viewModel.traceResults.length&&this.viewModel.traceResults.forEach(a=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,a)});this.scheduleRender()})])};g._groupResultsByAssetGroup=function(a){const b=[];a=this._groupBy(a.results?.elements??[],"networkSourceId");for(const c in a)b.push(this._groupBy(a[c],"assetGroupCode"));return b};g._groupResultsByAssetType=
function(a){return this._groupBy(a,"assetTypeCode")};g._appendAttributes=function(a,b,c){const e=[];a.forEach(f=>{b.forEach(l=>{l.featureSet.features.forEach(q=>{f[c]===q.attributes[this._resultObjectIdField]&&(f.details=q,f.details.fields=l.featureSet.fields,e.push(f))})})});return e};g._getAssetGroupName=function(a){let b=a.assetGroupCode.toString();const c=a.assetGroupCode;var e=this.viewModel.getValidSources().find(f=>f.sourceId===a.networkSourceId);e&&(e=e.assetGroups.find(f=>f.assetGroupCode===
c))&&(b=e.assetGroupName);return b};g._getAssetTypeName=function(a){let b=a.assetTypeCode.toString();const c=a.assetGroupCode;var e=this.viewModel.getValidSources().find(f=>f.sourceId===a.networkSourceId);e&&(e=e.assetGroups.find(f=>f.assetGroupCode===c))&&(e=e.assetTypes.find(f=>f.assetTypeCode===a.assetTypeCode))&&(b=e.assetTypeName);return b};g._compare=function(a,b){return(c,e)=>{let f=0;c=c.details.attributes[a];e=e.details.attributes[a];isNaN(c)&&(c=c.toLowerCase());isNaN(e)&&(e=e.toLowerCase());
"desc"===b?c>e?f=1:c<e&&(f=-1):c<e?f=1:c>e&&(f=-1);return f}};g._groupBy=function(a,b){return a.reduce((c,e)=>{(c[e[b]]=c[e[b]]||[]).push(e);return c},{})};g._getSymbolIcon=function(a){return"picture-marker"===a.type?d.tsx("img",{src:a.url??void 0,width:a.width,height:a.height}):null};g._watchViewState=function(){this._watchHandler=r.when(()=>!this.view?.updating,()=>{this.disabled=!1;null!==this._watchHandler&&this._watchHandler.remove()},{initial:!0})};v._createClass(t,[{key:"defaultGraphicColor",
get:function(){return this.viewModel.defaultGraphicColor},set:function(a){this.viewModel.defaultGraphicColor=a}},{key:"flags",get:function(){return this.viewModel.flags},set:function(a){this.viewModel.flags=a}},{key:"gdbVersion",get:function(){return this.viewModel.gdbVersion},set:function(a){this.viewModel.gdbVersion=a}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(a){this._overrideIfSome("label",a)}},{key:"resultAreaProperties",get:function(){return this.viewModel.resultAreaProperties},
set:function(a){this.viewModel.resultAreaProperties=a}},{key:"selectedTraces",get:function(){return this.viewModel.selectedTraces},set:function(a){this.viewModel.selectedTraces=a}},{key:"selectOnComplete",get:function(){return this.viewModel.selectOnComplete},set:function(a){this.viewModel.selectOnComplete=a}},{key:"showGraphicsOnComplete",get:function(){return this.viewModel.showGraphicsOnComplete},set:function(a){this.viewModel.showGraphicsOnComplete=a}},{key:"enableResultArea",get:function(){return this.viewModel.enableResultArea},
set:function(a){this.viewModel.enableResultArea=a}},{key:"showSelectionAttributes",get:function(){return this.viewModel.showSelectionAttributes},set:function(a){this.viewModel.showSelectionAttributes=a}},{key:"utilityNetwork",get:function(){return this.viewModel.utilityNetwork},set:function(a){this.viewModel.utilityNetwork=a}},{key:"view",get:function(){return this.viewModel.view},set:function(a){this.viewModel.view=a}}]);return t}(h.HandleOwnerMixin(E));k.__decorate([m.property()],h.prototype,"_tracesExists",
void 0);k.__decorate([m.property()],h.prototype,"_selectToolActive",void 0);k.__decorate([m.property()],h.prototype,"_activeTrace",void 0);k.__decorate([m.property()],h.prototype,"_activeSwatch",void 0);k.__decorate([m.property()],h.prototype,"_traceHeaderForFlow",void 0);k.__decorate([m.property()],h.prototype,"_assetGroupHeader",void 0);k.__decorate([m.property()],h.prototype,"_assetTypeHeader",void 0);k.__decorate([m.property()],h.prototype,"_traceResultsFunctions",void 0);k.__decorate([m.property()],
h.prototype,"_traceResultsAssetGroup",void 0);k.__decorate([m.property()],h.prototype,"_traceResultsAssetType",void 0);k.__decorate([m.property()],h.prototype,"_traceResultsIndividual",void 0);k.__decorate([m.property()],h.prototype,"_showTraceResultFunctions",void 0);k.__decorate([m.property()],h.prototype,"_showTraceResultAssetGroup",void 0);k.__decorate([m.property()],h.prototype,"_showTraceResultAssetType",void 0);k.__decorate([m.property()],h.prototype,"_showIndividualRecords",void 0);k.__decorate([m.property()],
h.prototype,"_activeTab",void 0);k.__decorate([m.property()],h.prototype,"_alertRemoveModal",void 0);k.__decorate([m.property()],h.prototype,"_warningNoFlag",void 0);k.__decorate([m.property()],h.prototype,"_warningNoTraceSelected",void 0);k.__decorate([m.property()],h.prototype,"_confirmReset",void 0);k.__decorate([m.property()],h.prototype,"_swatchNode",void 0);k.__decorate([m.property()],h.prototype,"_errorMessage",void 0);k.__decorate([m.property()],h.prototype,"defaultGraphicColor",null);k.__decorate([m.property()],
h.prototype,"disabled",void 0);k.__decorate([m.property()],h.prototype,"flags",null);k.__decorate([m.property()],h.prototype,"gdbVersion",null);k.__decorate([m.property()],h.prototype,"iconClass",void 0);k.__decorate([m.property()],h.prototype,"inputSettings",void 0);k.__decorate([m.property()],h.prototype,"label",null);k.__decorate([m.property(),w.messageBundle("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],h.prototype,"messages",void 0);k.__decorate([m.property(),w.messageBundle("esri/core/t9n/Units")],
h.prototype,"messagesUnits",void 0);k.__decorate([m.property()],h.prototype,"resultAreaProperties",null);k.__decorate([m.property()],h.prototype,"selectedTraces",null);k.__decorate([m.property()],h.prototype,"selectOnComplete",null);k.__decorate([m.property()],h.prototype,"showGraphicsOnComplete",null);k.__decorate([m.property()],h.prototype,"enableResultArea",null);k.__decorate([m.property()],h.prototype,"showSelectionAttributes",null);k.__decorate([m.property()],h.prototype,"utilityNetwork",null);
k.__decorate([m.property()],h.prototype,"view",null);k.__decorate([H.vmEvent(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection"]),m.property({type:x})],h.prototype,"viewModel",void 0);return h=k.__decorate([D.subclass("esri.widgets.UtilityNetworkTrace")],h)});