// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../intl ../../core/Accessor ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/Point ../../geometry/Polyline ../../geometry/projection ../../layers/GraphicsLayer ../../rest/networks/synthesizeAssociationGeometries ../../rest/networks/support/SynthesizeAssociationGeometriesParameters ../../symbols/CIMSymbol ../../symbols/SimpleLineSymbol ../../views/draw/support/layerUtils ../../intl/messages ../../intl/locale".split(" "),
function(u,d,m,c,z,A,B,e,K,L,M,C,D,v,n,p,E,F,G,H,w,q,x,I){c=function(y){function r(a){a=y.call(this,a)||this;a._handles=new A;a._internalArrowsLayerConnectivity=a._createInternalGraphicsLayer("Connectivity Associations - Arrows (Internal)");a._internalArrowsLayerStructuralAttachment=a._createInternalGraphicsLayer("Structural Attachment Associations - Arrows (Internal)");a._internalGraphicsLayerConnectivity=a._createInternalGraphicsLayer("Connectivity Associations (Internal)");a._internalGraphicsLayerStructuralAttachment=
a._createInternalGraphicsLayer("Structural Attachment Associations (Internal)");a.connectivityAssociationsLineSymbol=new w({style:"short-dash",width:2,color:[190,159,159,1]});a.errorMessage="";a.maxAllowableAssociations=250;a.showArrowsConnectivity=!1;a.showArrowsStructuralAttachment=!1;a.structuralAttachmentAssociationsLineSymbol=new w({style:"short-dash",width:2,color:[159,190,159,1]});a.utilityNetwork=null;return a}u._inherits(r,y);var f=r.prototype;f.initialize=function(){x.fetchMessageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations").then(a=>
{this.messages=a});this._handles.add([I.onLocaleChange(async()=>{this.messages=await x.fetchMessageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations")}),B.watch(()=>this.view,a=>{a&&(q.addUniqueLayer(a,this._internalGraphicsLayerConnectivity),q.addUniqueLayer(a,this._internalArrowsLayerConnectivity),q.addUniqueLayer(a,this._internalGraphicsLayerStructuralAttachment),q.addUniqueLayer(a,this._internalArrowsLayerStructuralAttachment));this._internalGraphicsLayerConnectivity.visible=
this.includeConnectivityAssociations;this._internalGraphicsLayerStructuralAttachment.visible=this.includeStructuralAttachmentAssociations})])};f.destroy=function(){this.view=null;this._removeInternalGraphicsLayers()};f.removeAssociations=function(){this._internalGraphicsLayerConnectivity.removeAll();this._internalGraphicsLayerStructuralAttachment.removeAll();this._internalArrowsLayerConnectivity.removeAll();this._internalArrowsLayerStructuralAttachment.removeAll()};f.showAssociations=async function(){const {messages:a}=
this;try{if(this._set("state","executing"),this.includeConnectivityAssociations||this.includeStructuralAttachmentAssociations){this._internalGraphicsLayerConnectivity.visible=this.includeConnectivityAssociations;this._internalGraphicsLayerStructuralAttachment.visible=this.includeStructuralAttachmentAssociations;this._internalArrowsLayerConnectivity.visible=this.showArrowsConnectivity&&this.includeConnectivityAssociations;this._internalArrowsLayerStructuralAttachment.visible=this.showArrowsStructuralAttachment&&
this.includeStructuralAttachmentAssociations;this.removeAssociations();p.isLoaded()||await p.load();this.utilityNetwork.loaded||await this.utilityNetwork.load();var g=this.utilityNetwork.spatialReference,l=p.project(new v({x:this.view?.extent.xmin,y:this.view?.extent.ymin,spatialReference:this.view?.spatialReference}),g),k=p.project(new v({x:this.view?.extent.xmax,y:this.view?.extent.ymax,spatialReference:this.view?.spatialReference}),g),t=new D({xmin:l.x,ymin:l.y,xmax:k.x,ymax:k.y,spatialReference:g}),
J=new G({returnConnectivityAssociations:this.includeConnectivityAssociations,returnAttachmentAssociations:this.includeStructuralAttachmentAssociations,extent:t,outSpatialReference:this.utilityNetwork.spatialReference,maxGeometryCount:this.maxAllowableAssociations,gdbVersion:(this.view?.map.allLayers?.items.find(b=>"feature"===b.type)).gdbVersion,moment:this.moment}),h=await F.synthesizeAssociationGeometries(null!==this.utilityNetwork.networkServiceUrl?this.utilityNetwork.networkServiceUrl:"",J);g=
[];l=[];k=[];t=[];if(h){if(!0===h.maxGeometryCountExceeded){this._set("state","warning");this._set("errorMessage",a.infoStrings.maxAllowableAssociationsExceeded);return}if(0===h.associations.length){this._set("state","warning");this._set("errorMessage",a.infoStrings.noAssociationsFound);return}g=h.associations.filter(b=>"connectivity"===b.associationType).map(b=>{b=new n({paths:b.geometry.paths,spatialReference:b.geometry.spatialReference});return new m({geometry:b,symbol:this.connectivityAssociationsLineSymbol})});
l=h.associations.filter(b=>"connectivity"===b.associationType).map(b=>{b=new n({paths:b.geometry.paths,spatialReference:b.geometry.spatialReference});return new m({geometry:b,symbol:this._getCIMSymbolArrows(this.connectivityAssociationsLineSymbol.color)})});k=h.associations.filter(b=>"attachment"===b.associationType).map(b=>{b=new n({paths:b.geometry.paths,spatialReference:b.geometry.spatialReference});return new m({geometry:b,symbol:this.structuralAttachmentAssociationsLineSymbol})});t=h.associations.filter(b=>
"attachment"===b.associationType).map(b=>{b=new n({paths:b.geometry.paths,spatialReference:b.geometry.spatialReference});return new m({geometry:b,symbol:this._getCIMSymbolArrows(this.structuralAttachmentAssociationsLineSymbol.color)})})}0<g.length&&(this._internalGraphicsLayerConnectivity.addMany(g),this._internalArrowsLayerConnectivity.addMany(l));0<k.length&&(this._internalGraphicsLayerStructuralAttachment.addMany(k),this._internalArrowsLayerStructuralAttachment.addMany(t));this._set("state","ready")}else this.removeAssociations()}catch(b){this._set("state",
"failed"),this._set("errorMessage",b.message)}};f._createInternalGraphicsLayer=function(a){return new E({listMode:"hide",internal:!0,title:a})};f._getCIMSymbolArrows=function(a){return new H({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementAtExtremities",extremityPlacement:"JustEnd",angleToLine:!0},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-18,
-5.47],[-18,5.6],[1.96,-.03],[-18,-5.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[a.r,a.g,a.b,255*a.a]}]}}]}]}}})};f._removeInternalGraphicsLayers=function(){this._internalGraphicsLayerConnectivity&&this._internalGraphicsLayerStructuralAttachment&&this.view&&this.view.map&&(this.view.map.remove(this._internalGraphicsLayerConnectivity),this.view.map.remove(this._internalGraphicsLayerStructuralAttachment),this.view.map.remove(this._internalArrowsLayerConnectivity),
this.view.map.remove(this._internalArrowsLayerStructuralAttachment))};f._utilityNetworkExists=function(){const {messages:a}=this;return this.utilityNetwork?!0:(this._set("errorMessage",a.infoStrings.noUtilityNetwork),!1)};u._createClass(r,[{key:"includeConnectivityAssociations",set:function(a){this._set("includeConnectivityAssociations",a);this._internalGraphicsLayerConnectivity.visible=a;this._internalArrowsLayerConnectivity.visible=a&&this.showArrowsConnectivity}},{key:"includeStructuralAttachmentAssociations",
set:function(a){this._set("includeStructuralAttachmentAssociations",a);this._internalGraphicsLayerStructuralAttachment.visible=a;this._internalArrowsLayerStructuralAttachment.visible=a&&this.showArrowsStructuralAttachment}},{key:"state",get:function(){const {view:a}=this;return a?.ready&&this._utilityNetworkExists()?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},set:function(a){this._set("view",a)}}]);return r}(z);d.__decorate([e.property()],c.prototype,"connectivityAssociationsLineSymbol",
void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"errorMessage",void 0);d.__decorate([e.property({type:Boolean,value:!0})],c.prototype,"includeConnectivityAssociations",null);d.__decorate([e.property({type:Boolean,value:!0})],c.prototype,"includeStructuralAttachmentAssociations",null);d.__decorate([e.property()],c.prototype,"maxAllowableAssociations",void 0);d.__decorate([e.property()],c.prototype,"messages",void 0);d.__decorate([e.property()],c.prototype,"moment",void 0);d.__decorate([e.property()],
c.prototype,"showArrowsConnectivity",void 0);d.__decorate([e.property()],c.prototype,"showArrowsStructuralAttachment",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);d.__decorate([e.property()],c.prototype,"structuralAttachmentAssociationsLineSymbol",void 0);d.__decorate([e.property()],c.prototype,"utilityNetwork",void 0);d.__decorate([e.property({value:null})],c.prototype,"view",null);return c=d.__decorate([C.subclass("esri.widgets.UtilityNetworkAssociations.UtilityNetworkAssociationsViewModel")],
c)});