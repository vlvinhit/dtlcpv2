// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Viewpoint ../../core/Collection ../../core/deprecate ../../core/Error ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../webdoc/support/SlideThumbnail ../../webmap/Bookmark ../support/GoTo".split(" "),function(w,e,D,c,x,l,E,F,g,y,L,M,G,H,z,I){const A=c.ofType(z),
J={width:128,height:128,format:"png"},m={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},q={time:!0},B=F.getLogger("esri.widgets.Bookmarks.BookmarksViewModel");c=function(C){function n(a){a=C.call(this,a)||this;a.capabilities={...q};a.activeBookmark=null;a.view=null;return a}w._inherits(n,C);var h=n.prototype;h.destroy=function(){this.view=null;this._set("activeBookmark",null)};h.castAbilities=function(a){return{...q,...a}};h.castCapabilities=function(a){return{...q,
...a}};h.createBookmark=async function(a){const {view:b,defaultCreateOptions:f,capabilities:d}=this;if(!b)throw new l("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const {takeScreenshot:k,screenshotSettings:r,captureViewpoint:t,captureRotation:u,captureScale:v,captureTimeExtent:p}={...f,...a};a=k?await this._createThumbnail(r):void 0;const K=d.time&&p&&null!=b.timeExtent?b.timeExtent.clone():void 0;return new z({...(a&&{thumbnail:a}),...(p&&{timeExtent:K}),...(t&&{viewpoint:this._createViewpoint({view:b,
captureScale:v,captureRotation:u})})})};h.editBookmark=async function(a,b){if(!a)return a;const {view:f,defaultEditOptions:d}=this;if(!f)throw new l("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const {takeScreenshot:k,screenshotSettings:r,captureViewpoint:t,captureRotation:u,captureScale:v,captureTimeExtent:p}={...d,...b};if(b=k?await this._createThumbnail(r):void 0)a.thumbnail=b;t&&(a.viewpoint=this._createViewpoint({view:f,captureScale:v,captureRotation:u}));p&&null!=f.timeExtent&&
(a.timeExtent=f.timeExtent.clone());this.emit("bookmark-edit",{bookmark:a});return a};h.goTo=function(a){const {capabilities:b,view:f}=this;if(!f)throw new l("go-to:invalid-view","Cannot go to a bookmark without a view");var d=a?.viewpoint;if(!d)throw new l("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:a});this._set("activeBookmark",a);d=this.callGoTo({target:d});const k=a?.timeExtent;b.time&&k&&(f.timeExtent=k);this.emit("bookmark-select",{bookmark:a});
d.catch(()=>{}).then(()=>this._set("activeBookmark",null));return d};h._createThumbnail=async function(a){const {view:b}=this;if(!b)throw new l("bookmark:invalid-view","Cannot create slide thumbnail without a view");a=await b.takeScreenshot({...J,...a});return new H.SlideThumbnail({url:a.dataUrl})};h._createViewpoint=function({view:a,captureRotation:b,captureScale:f}){const d=a.viewpoint?.clone();return new D({targetGeometry:a.extent?.clone(),rotation:(b?d?.rotation:null)??0,scale:(f?d?.scale:null)??
0})};w._createClass(n,[{key:"abilities",get:function(){x.deprecatedProperty(B,"abilities",{replacement:"capabilities",version:"4.27"});return this.capabilities},set:function(a){x.deprecatedProperty(B,"abilities",{replacement:"capabilities",version:"4.27"});this.capabilities=a}},{key:"bookmarks",get:function(){return this.view?.map?.bookmarks??new A},set:function(a){this._overrideIfSome("bookmarks",a)}},{key:"defaultCreateOptions",get:function(){return m},set:function(a){this._set("defaultCreateOptions",
{...m,...a})}},{key:"defaultEditOptions",get:function(){return m},set:function(a){this._set("defaultEditOptions",{...m,...a})}},{key:"state",get:function(){const a=this.get("view");return a&&!a.ready?"loading":"ready"}}]);return n}(I.GoToMixin(E.EventedAccessor));e.__decorate([g.property()],c.prototype,"abilities",null);e.__decorate([y.cast("abilities")],c.prototype,"castAbilities",null);e.__decorate([g.property()],c.prototype,"capabilities",void 0);e.__decorate([y.cast("capabilities")],c.prototype,
"castCapabilities",null);e.__decorate([g.property({readOnly:!0})],c.prototype,"activeBookmark",void 0);e.__decorate([g.property({type:A})],c.prototype,"bookmarks",null);e.__decorate([g.property()],c.prototype,"defaultCreateOptions",null);e.__decorate([g.property()],c.prototype,"defaultEditOptions",null);e.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([g.property()],c.prototype,"view",void 0);return c=e.__decorate([G.subclass("esri.widgets.Bookmarks.BookmarksViewModel")],
c)});