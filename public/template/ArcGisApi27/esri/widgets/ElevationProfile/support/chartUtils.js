// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../intl ../../../core/arrayUtils ../../../core/Error ../../../core/handleUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/unitFormatUtils ../../../core/unitUtils ../css ./constants ./intlUtils ./niceScale ../../support/chartUtils ../../support/widgetUtils ../../../support/themeUtils ../../../intl/substitute ../../../intl/number".split(" "),function(x,la,K,L,w,r,M,y,B,N,v,O,P,Q,z,R,S,T){function U(a){a=new a.amCharts4Index.am4charts.XYCursor;a.trackable=!0;a.lineY.disabled=
!0;a.behavior="zoomXY";return a}function V(a){const c=a.theme,b=a.amChart.tooltip,{am4core:e}=a.amCharts4Index;b.id="series-tooltip";b.fitPointerToBounds=!0;b.pointerOrientation="vertical";b.zIndex=-1;b.getFillFromObject=!1;b.label.fontSize=c.seriesTooltipFontSize;b.label.fill=e.color(c.seriesTooltipLabelColor);b.label.padding(c.seriesTooltipPaddingVertical,c.seriesTooltipPaddingHorizontal,c.seriesTooltipPaddingVertical,c.seriesTooltipPaddingHorizontal);b.background.cornerRadius=c.tooltipBorderRadius;
b.background.stroke=null;b.background.fill=e.color(c.seriesTooltipBackgroundColor);b.background.padding(0,0,0,0);b.adapter.add("dy",()=>c.seriesTooltipSpacing*(0>=b.background.pointerY?1:-1));z.isRTL(a.params.container)&&(b.label.textAlign="middle")}function W(a){const {xAxis:c,theme:b}=a,{am4core:e}=a.amCharts4Index;c.numberFormatter=C(a,"distance");c.strictMinMax=!0;c.cursorTooltipEnabled=!1;c.title.visible=!1;a=c.renderer;a.line.visible=!1;a.minGridDistance=b.xAxisMinGridDistance;a.minLabelPosition=
b.xAxisMinLabelPosition;a.maxLabelPosition=b.xAxisMaxLabelPosition;a.fontWeight=b.axisFontWeight;a.fontSize=b.axisFontSize;a.baseGrid.disabled=!0;var d=a.labels.template;d.fontSize=b.axisLabelsFontSize;d.fontWeight=b.axisLabelsFontWeight;d.fill=e.color(b.axisLabelsColor);d.paddingTop=b.xAxisLabelsSpacing;d.horizontalCenter="left";d.paddingLeft=0;d=c.tooltip;d.id="axis-tooltip";d.background.fill=e.color(b.axisTooltipBackgroundColor);d.background.stroke=null;d.background.padding(0,0,0,0);d.label.fontSize=
b.axisTooltipFontSize;d.label.fill=e.color(b.axisTooltipLabelColor);d.label.padding(b.axisTooltipPaddingTop,b.axisTooltipPaddingHorizontal,b.axisTooltipPaddingBottom,b.axisTooltipPaddingHorizontal);a=a.grid.template;a.strokeOpacity=1;a.stroke=e.color(b.axisGridStroke)}function X(a){const {yAxis:c,theme:b}=a,{am4core:e}=a.amCharts4Index;c.numberFormatter=C(a,"elevation");c.title.visible=!1;c.cursorTooltipEnabled=!1;c.strictMinMax=!0;c.baseValue=v.getConfig().noDataValue;const d=c.renderer;d.inside=
!0;d.line.opacity=0;d.line.visible=!1;d.minGridDistance=b.yAxisMinGridDistance;d.minLabelPosition=b.yAxisMinLabelPosition;d.maxLabelPosition=b.yAxisMaxLabelPosition;d.fontWeight=b.axisFontWeight;d.fontSize=b.axisFontSize;d.baseGrid.disabled=!0;const f=d.labels.template;f.fontSize=b.axisLabelsFontSize;f.fontWeight=b.axisLabelsFontWeight;f.fill=e.color(b.axisLabelsColor);f.verticalCenter="bottom";f.paddingLeft=b.yAxisLabelSpacing;f.paddingBottom=0;const g=d.grid.template;g.strokeOpacity=1;g.stroke=
e.color(b.axisGridStroke);z.isRTL(a.params.container)&&(d.opposite=!0,f.textAlign="middle",f.paddingLeft=0,f.paddingRight=b.yAxisLabelSpacing)}function Y(a,{data:c,messages:b}){var {htmlContainer:e}=a.amChart;if(e){var d=null!=c&&c.refined;a.amChart.cursor.disabled=!d;e.classList.toggle(N.CHART_CSS.cursorEnabled,d);e=a.data!==c;d=r.applySome(a.data,f=>f.effectiveUnits)!==r.applySome(c,f=>f.effectiveUnits);a.data=c;a.messages=b;e&&(Z(a),aa(a));d&&(a.yAxis.invalidateLabels(),a.xAxis.invalidateLabels());
u(a)}}function Z(a){const {xAxis:c,yAxis:b}=a,{minX:e,maxX:d,minY:f,maxY:g}=D({data:a.data,pixelWidth:c.pixelWidth,pixelHeight:b.pixelHeight});c.min=e;c.max=d;b.min=f;b.max=g}function D({data:a,pixelWidth:c,pixelHeight:b}){if(null==a)return A;var e=a.statistics;const d=r.applySome(e,h=>h.maxDistance);let f=r.applySome(e,h=>h.minElevation);var g=r.applySome(e,h=>h.maxElevation);if(null==d||null==f||null==g)return A;e=Math.max(d-0,.001);let k=Math.max(g-f,.001);g=a.effectiveUnits;a.dynamicElevationRange&&
(g=B.convertUnit(e,g.distance,g.elevation),k=Math.max(k,g/v.getConfig().maxChartRatio));f-=.02*k;g=f+k+.02*k;[f,g]=P.niceScale(f,g,10);k=g-f;return a.uniformScaling?E({data:a,bounds:{minX:0,maxX:d,minY:f,maxY:g},pixelWidth:c,pixelHeight:b,centered:!0}):{minX:0,maxX:0+e,minY:f,maxY:f+k}}function E({data:a,bounds:c,pixelWidth:b,pixelHeight:e,centered:d}){if(null==a)return c;let {minX:f,maxX:g,minY:k,maxY:h}=c;if(null==f||null==g||null==k||null==h)return A;c=g-f;a=a.effectiveUnits;b=B.convertUnit(h-
k,a.elevation,a.distance)/e/(c/b);1<=b?[f,g]=F([f,g],b,d):[k,h]=F([k,h],1/b,d);return{minX:f,maxX:g,minY:k,maxY:h}}function F([a,c],b,e){b*=c-a;return e?(a=(a+c)/2-b/2,[a,a+b]):[a,a+b]}function aa(a){const {amChart:c,data:b}=a;if(null==b||0===b.lines.length)c.series.clear();else{var e=new Map,d=new Set(c.series.values),f=b.lines.length;for(let g=0;g<f;g++){const k=b.lines[g];let h=a.series.get(k.id);h?(r.applySome(h.fill,l=>d.delete(l)),d.delete(h.line)):(h=ba(a,k),r.applySome(h.fill,l=>c.series.push(l)),
c.series.push(h.line));e.set(h.id,h);const m=f-g-1;r.applySome(h.fill,l=>l.zIndex=m);h.line.zIndex=f+m;ca(a,h,k)}a.series=e;for(const g of d)c.series.removeValue(g)}}function ca(a,{line:c,fill:b},e){const {theme:d}=a;({am4core:a}=a.amCharts4Index);const {r:f,g,b:k,a:h}=e.color,m=a.color({r:f,g,b:k,a:h}),l=e.samples??[],n=0<l.length;c.stroke=m;c.visible=n;r.applySome(b,q=>{q.visible=n;q.fill=m.lighten(d.seriesFillLighten)});e=l.length;a=c.data;if(a.length===e){let q=!1;for(let p=0;p<e;++p){const t=
a[p],G=l[p];q=q||null!=t.elevation!==(null!=G.elevation);da(t,G)}q?(c.invalidateData(),r.applySome(b,p=>p.invalidateData())):(c.invalidateRawData(),r.applySome(b,p=>p.invalidateRawData()))}else c.data=l,r.applySome(b,q=>q.data=l)}function da(a,c){a.x=c.x;a.y=c.y;a.z=c.z;a.distance=c.distance;a.elevation=c.elevation}function ba(a,c){const {id:b}=c,e=H(a,`${"line"}-${b}`);e.strokeWidth=c.chartStrokeWidth;e.dy=c.chartStrokeOffsetY;let d=null;c.chartFillEnabled&&(d=H(a,`${"fill"}-${b}`),d.fillOpacity=
1);return{id:b,line:e,fill:d}}function H(a,c){a=new a.amCharts4Index.am4charts.LineSeries;a.id=c;a.showOnInit=!1;a.simplifiedProcessing=!0;a.minDistance=.5;a.excludeFromTotal=!0;a.clickable=!1;a.contextMenuDisabled=!0;a.cursorHoverEnabled=!1;a.cursorTooltipEnabled=!1;a.connect=!1;a.fill=null;a.stroke=null;a.dataFields.valueX="distance";a.dataFields.valueY="elevation";return a}function ea(a,c){const {amChart:b,xAxis:e,yAxis:d}=a;let f=!1;const g=()=>{const {data:m}=a;if(f&&null!=m&&m.uniformScaling){f=
!1;var {minX:l,maxX:n,minY:q,maxY:p}=E({data:a.data,bounds:{minX:e.minZoomed,maxX:e.maxZoomed,minY:d.minZoomed,maxY:d.maxZoomed},pixelWidth:e.pixelWidth,pixelHeight:d.pixelHeight,centered:!0});null!=l&&null!=n&&e.zoomToValues(l,n,!0);null!=q&&null!=p&&d.zoomToValues(q,p,!0);b.validate();u(a)}},k=()=>{c(a.xAxis.zoomFactor,a.yAxis.zoomFactor)},h=[b.events.on("down",()=>{a.zooming=!0;u(a)}),b.events.on("up",()=>{a.zooming=!1;u(a)}),b.cursor.events.on("zoomended",()=>{f=!0}),e.events.on("startendchanged",
g),d.events.on("startendchanged",g),e.events.on("rangechangeended",k),d.events.on("rangechangeended",k)];return w.makeHandle(()=>{h.forEach(m=>m.dispose())})}function fa({xAxis:a,yAxis:c}){const b=d=>()=>{d.renderer.grid.each(f=>{f.visible="none"!==f.dataItem.label.dom.getAttribute("display")})},e=[a.events.on("rangechangeended",b(a)),a.events.on("validated",b(a)),c.events.on("rangechangeended",b(c)),c.events.on("validated",b(c))];return w.makeHandle(()=>{e.forEach(d=>d.dispose())})}function ha(a,
c){const {amChart:b,xAxis:e,yAxis:d}=a,{cursor:f,events:g}=b,k=()=>{a.pointerIsOver=!1;u(a);c(null,null)},h=[f.events.on("cursorpositionchanged",()=>{if(a.pointerIsOver){u(a);var m=e.toAxisPosition(f.xPosition),l=d.toAxisPosition(f.yPosition),n=a.data;if(null!=n&&null!=n.statistics){const {maxDistance:q,minElevation:p,maxElevation:t}=n.statistics;null!=q&&(n=e.minZoomed,m=(n+m*(e.maxZoomed-n)-0)/(q-0));null!=p&&null!=t&&(n=d.minZoomed,l=(n+l*(d.maxZoomed-n)-p)/(t-p))}c(m,l)}}),g.on("over",()=>{a.pointerIsOver=
!0;u(a)}),g.on("out",k),g.on("blur",k)];return w.makeHandle(()=>{h.forEach(m=>m.dispose())})}function u(a){const {amChart:c,xAxis:b,data:e,theme:d,zooming:f,pointerIsOver:g}=a;a.amChart.tooltip.hide();a.xAxis.hideTooltip();if(g&&!f&&null!=e&&e.refined){var k=ia(a);if(null!=k){var {cursor:h}=c;const m=c.tooltip;h.show(0);h.validate();m.text=k.text;m.show(0);m.validate();m.pointerOrientation=30>k.y-m.contentHeight-d.seriesTooltipSpacing?"up":"down";m.pointTo(k,!0);m.validate();k=b.tooltip;{const {data:l,
messages:n}=a;null==l||null==n?a="":(a=(h=l.lines[0])?I(a,h):null,h=v.getConfig().formatPrecision,a=null!=a?y.formatDecimal(n,a.distance,l.effectiveUnits.distance,h):"-")}k.text=a;k.show(0);k.validate()}}}function ia(a){const {amChart:c,yAxis:b,data:e}=a;if(null==e)return null;const d=e.lines.map(m=>({line:m,y:r.applySome(I(a,m),l=>l.elevation)})).sort(ja),f=d.length?d[0].y:null;if(null==f)return null;const g=c.cursor,k=b.measuredHeight,h=k+c.pixelPaddingTop;return{text:d.map(({y:m,line:l})=>{{const {data:q,
messages:p}=a;if(null==q||null==p)l="";else{var n=v.getConfig().formatPrecision;m=S.substitute(p.chartTooltip,{name:O.getTranslatedLineTitle(l,p),elevation:null!=m?y.formatDecimal(p,m,q.effectiveUnits.elevation,n):v.NOT_AVAILABLE});l=`[${l.color.toHex()}]\u25cf[/] ${m}`}}return l}).join("\n"),x:g.point.x+g.parent.pixelX+c.pixelPaddingLeft,y:h-b.valueToPosition(f)*k}}function ja({y:a},{y:c}){return null==a?1:null==c?-1:c-a}function C(a,c){const b=a.xAxis.numberFormatter.clone();b.format=(e,d,f)=>{const {messages:g,
data:k}=a;return null==g||null==k||"string"===typeof e?"":`${T.formatNumber(e,{maximumFractionDigits:f})} ${y.unitName(g,k.effectiveUnits[c],"abbr")}`};return b}function I({amChart:a,xAxis:c},b){b=b.samples??[];if(0===b.length)return null;a=c.toAxisPosition(a.cursor.xPosition);c=c.positionToValue(a);return K.binaryFindClosest(b,c,e=>e.distance)}const J={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,
axisLabelsFontWeight:"400",axisLabelsColor:"#a9a9a9",axisTooltipFontSize:12,axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",axisTooltipPaddingTop:3,axisTooltipPaddingBottom:3,axisTooltipPaddingHorizontal:4,xAxisMinGridDistance:50,xAxisLabelsSpacing:6,xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:4,yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:"#f8f8f8",seriesTooltipLabelColor:"#323232",
seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:4,seriesTooltipPaddingHorizontal:4,tooltipBorderRadius:0},ka={...J,axisGridStroke:"#323232",axisLabelsColor:"#a9a9a9",axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",seriesTooltipBackgroundColor:"#323232",seriesTooltipLabelColor:"#f8f8f8",seriesFillLighten:-.75},A={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};x.createChart=async function(a){const c=await Q.loadChartsModule();if(!c)throw new L("elevation-profile:load-failed",
"Could not load amCharts");const {am4core:b,am4charts:e}=c;M.throwIfAborted(a.abortOptions);var {options:d}=b;d.minPolylineStep=.5;d.autoSetClassName=!0;d.animationsEnabled=!1;var f=R.isDarkTheme();d=f?ka:J;f&&b.useTheme(c.am4themes_dark);const g=b.create(a.container,e.XYChart);g.arrangeTooltips=!1;g.preloader.disabled=!0;g.zoomOutButton.disabled=!0;f=z.isRTL(a.container);g.rtl=f;g.padding(d.paddingTop,f?d.paddingLeft:d.paddingRight,d.paddingBottom,f?d.paddingRight:d.paddingLeft);f=g.plotContainer.background;
f.strokeWidth=0;f.strokeOpacity=0;f.stroke=null;f=g.xAxes.push(new e.ValueAxis);const k=g.yAxes.push(new e.ValueAxis),h={params:a,amCharts4Index:c,amChart:g,xAxis:f,yAxis:k,series:new Map,data:null,messages:null,theme:d,zooming:!1,pointerIsOver:!1};g.cursor=U(h);V(h);W(h);X(h);const m=[ea(h,a.onRangeChange),ha(h,a.onCursorPositionChange),fa(h)];let l=null,n=!1;const q=()=>{null!=l&&("undefined"!==typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(l):clearTimeout(l),l=null)};return{...h,
destroy(){n=!0;q();w.handlesGroup(m).remove();g.dispose()},update(p){if(p.data!==h.data||p.messages!==h.messages)if(q(),!n){var t=()=>{n||(l=null,Y(h,p))};l="undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(t,{timeout:30}):setTimeout(t,30)}},zoomOut(){n||(h.yAxis.zoom({start:0,end:1},!1,!0),h.xAxis.zoom({start:0,end:1},!1,!0))}}};x.getAdjustedBounds=D;Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});