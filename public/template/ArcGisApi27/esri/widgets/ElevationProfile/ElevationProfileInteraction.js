// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/asyncUtils ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/GraphicsLayer ../../symbols/CIMSymbol ../../symbols/SimpleLineSymbol ./support/geometryUtils ../Sketch/SketchViewModel".split(" "),
function(b,x,k,z,A,B,C,r,l,u,n,m,M,N,O,D,E,F,G,y,H){function I(f){return y.isPolyline(f)?(f=f.clone(),f.paths=[f.paths[0].slice(0,-1)],f):f}b.State=void 0;(function(f){f.Ready="ready";f.Creating="creating";f.Reshaping="reshaping";f.ReshapingDisabled="rehsaping-disabled";f.Selecting="selecting";f.Selected="selected"})(b.State||(b.State={}));var h;(function(f){f.View="view";f.Main="main";f.Interaction="interaction"})(h||(h={}));b.ElevationProfileInteraction=function(f){function t(a){a=f.call(this,a)||
this;a.state=b.State.Ready;a._handles=new C;a._pendingStartOptions=null;a._previousInputInfo=null;a._shouldRemoveLastPoint=!1;a._sketchedGraphics=new WeakSet;a._creationToolPromise=null;a._updateToolPromise=null;a._updateDisabled=!1;return a}x._inherits(t,f);var d=t.prototype;d.initialize=function(){this._handles.add(n.watch(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:a,visible:c})=>{null!=a&&c?this._attach(a):this._detach()},n.syncAndInitial),h.View)};d.destroy=function(){this._detach();
this._handles=l.destroyMaybe(this._handles)};d.start=function(a={mode:"sketch"}){if(this.tool.editable){var c=this._view;if(null!=c&&c.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),null==this._previousInputInfo&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),a.mode){case "sketch":this._set("state",b.State.Creating);this._startCreationInteraction();break;case "select":this._set("state",b.State.Selecting),this._startSelectionInteraction()}else this._pendingStartOptions=
a}};d.stop=function(){this._pendingStartOptions=null;this._stopInteractionAndUpdate();this._clearPreviousInput()};d.cancel=function(){this._pendingStartOptions=null;this._stopInteractionAndUpdate();this._restorePreviousInput()};d.clear=function(){this._stopInteractionAndUpdate();this._set("state",b.State.Ready);this._clearPreviousInput();this._pendingStartOptions=this._input=null};d.isSketchedGraphic=function(a){return null!=a&&this._sketchedGraphics.has(a)};d._attach=function(a){this._detach();this._graphicsLayer=
new E({listMode:"hide",internal:!0,elevationInfo:{mode:"3d"===a.type?"relative-to-ground":"on-the-ground",offset:null}});var c="2d"===a.type?new F({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",
width:1.5,color:[255,255,255,255]}]}}}):new G({color:[0,0,0,0]});this._sketchVM=new H({layer:this._graphicsLayer,view:a,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:c,activeLineSymbol:c});this._handles.add([n.when(()=>a.ready,()=>l.applySome(this._pendingStartOptions,
e=>this.start(e)),n.syncAndInitial),n.watch(()=>[this._input,this._visibleAndEditable],()=>this._update(),n.syncAndInitial),n.watch(()=>({map:a.map,graphicsLayer:this._graphicsLayer}),({map:e,graphicsLayer:g})=>{null!=e&&null!=g&&e.add(g);this._update()},n.syncAndInitial)],h.Main)};d._detach=function(){this._handles.remove(h.Main);this._sketchVM=l.destroyMaybe(this._sketchVM);this._updateToolPromise=this._creationToolPromise=null;const a=l.applySome(this._view,e=>e.map),c=this._graphicsLayer;null!=
a&&null!=c&&a.remove(c);this._graphicsLayer=l.destroyMaybe(this._graphicsLayer);this._shouldRemoveLastPoint=!1;this._set("state",b.State.Ready)};d._startCreationInteraction=function(){this._stopInteractionAndUpdate();const a=this._sketchVM;if(null!=this._view&&null!=a){this._shouldRemoveLastPoint=!1;var c=a.on("create",e=>{const g=e.graphic;switch(e.state){case "complete":this._shouldRemoveLastPoint=!1;this._setSketchedGraphic(g);this._stopInteractionAndUpdate();this._clearPreviousInput();break;case "cancel":this.cancel();
break;case "active":this._setSketchedGraphic(g);"cursor-update"===e.toolEventInfo?.type&&(this._shouldRemoveLastPoint=!0);break;case "start":this._setSketchedGraphic(g)}});this._handles.remove(h.Interaction);this._handles.add(r.makeHandle(()=>{c.remove();const e=this.canStopCreating,g=l.applySome(this._geometry,v=>v.clone());a.cancel();this._creationToolPromise=null;null!=g&&e?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new z({geometry:I(g)})):this._input=null}),h.Interaction);this._creationToolPromise=
u.ignoreAbortErrors(a.create("polyline"))}};d._startReshapeInteraction=function(){this._stopInteraction();const a=this._sketchVM;if(null!=this._view&&null!=a){var c=a.on("update",e=>{const g=e.graphics[0];switch(e.state){case "complete":this._setSketchedGraphic(g);this._stopInteractionAndUpdate();this._clearPreviousInput();break;case "active":this._setSketchedGraphic(g);break;case "start":this._setSketchedGraphic(g)}});this._handles.remove(h.Interaction);this._handles.add(r.makeHandle(()=>{c.remove();
a.cancel();this._updateToolPromise=null}),h.Interaction);l.applySome(this._input,e=>{e.visible=!0;this._updateToolPromise=u.ignoreAbortErrors(a.update(e,{tool:"reshape"}))})}};d._startSelectionInteraction=function(){this._stopInteraction();const a=this._view;if(null!=a){var c=a.cursor,e=r.makeHandle(()=>a.cursor=c);a.cursor="crosshair";a.closePopup();var g=null,v=r.makeHandle(()=>l.abortMaybe(g)),K=a.on("immediate-click",q=>{q.preventDefault();q.stopPropagation();l.abortMaybe(g);g=B.createTask(async w=>
{const {results:J}=await a.hitTest(q);u.throwIfAborted(w);if(w=J.filter(p=>"graphic"===p.type&&null!=p.graphic).map(p=>p.graphic).find(p=>null!=p.geometry&&"polyline"===p.geometry.type))this._input=w,this._clearPreviousInput(),this._stopInteractionAndUpdate()})}),L=a.on("key-down",q=>{"Escape"===q.key&&this.cancel()});this._handles.remove(h.Interaction);this._handles.add([K,L,v,e],h.Interaction);a.ready&&a.focus()}};d._stopInteraction=function(){this._handles.remove(h.Interaction)};d._stopInteractionAndUpdate=
function(){this._handles.has(h.Interaction)&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())};d._triggerUpdate=function(){this._set("state",b.State.Ready);this._update()};d._update=function(){if(!this._updateDisabled){var a=this.state;if(a===b.State.Selecting)this.stop();else{if(this._visibleAndEditable){if(a===b.State.Creating||a===b.State.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState());
this._updateVisuals()}}};d._getNextState=function(){return null==this._input?b.State.Ready:this.isSketchedGraphic(this._input)?this.state===b.State.Creating?b.State.Creating:this._visibleAndEditable?b.State.Reshaping:b.State.ReshapingDisabled:b.State.Selected};d._updateVisuals=function(){switch(this.state){case b.State.Reshaping:this._startReshapeInteraction();break;case b.State.ReshapingDisabled:this._stopInteractionAndUpdate();const a=this._input;null!=a&&this.isSketchedGraphic(a)&&(a.visible=!1);
break;case b.State.Ready:case b.State.Selected:this._stopInteractionAndUpdate()}this._updateSketchedGraphic()};d._storePreviousInput=function(a){this._previousInputInfo={graphic:a}};d._restorePreviousInput=function(){const a=this._previousInputInfo;null!=a&&(this._clearPreviousInput(),this._input=a.graphic,this._triggerUpdate())};d._clearPreviousInput=function(){this._previousInputInfo=null};d._updateSketchedGraphic=function(){var a=this._graphicsLayer;if(null!=a){a=a.graphics;var c=this._input;if(null!=
c&&this.isSketchedGraphic(c))if(-1!==a.indexOf(c)){if(1!==a.length){const e=a.filter(g=>g!==c);a.removeMany(e)}}else a.removeAll(),a.add(c);else a.removeAll()}};d._setSketchedGraphic=function(a){null!=a&&this._sketchedGraphics.add(a);this._input=a;this._updateSketchedGraphic()};x._createClass(t,[{key:"canStopCreating",get:function(){const a=this._geometry,c=this._shouldRemoveLastPoint?3:2;return y.isPolyline(a)&&0<a.paths.length&&a.paths[0].length>=c}},{key:"_input",get:function(){return this.tool.viewModel.input},
set:function(a){this.tool.viewModel.input=a}},{key:"_geometry",get:function(){return l.applySome(this._input,a=>a.geometry)}},{key:"_visibleAndEditable",get:function(){return this.tool.visible&&this.tool.editable}},{key:"_view",get:function(){return this.tool.viewModel.view}},{key:"test",get:function(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([this._creationToolPromise??Promise.resolve(),this._updateToolPromise??Promise.resolve()])}}}]);return t}(A);k.__decorate([m.property({nonNullable:!0})],
b.ElevationProfileInteraction.prototype,"state",void 0);k.__decorate([m.property({nonNullable:!0})],b.ElevationProfileInteraction.prototype,"tool",void 0);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"canStopCreating",null);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_graphicsLayer",void 0);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_sketchVM",void 0);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_input",
null);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_geometry",null);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_visibleAndEditable",null);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_view",null);k.__decorate([m.property()],b.ElevationProfileInteraction.prototype,"_shouldRemoveLastPoint",void 0);b.ElevationProfileInteraction=k.__decorate([D.subclass("esri.widgets.ElevationProfile.ElevationProfileInteraction")],b.ElevationProfileInteraction);
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});