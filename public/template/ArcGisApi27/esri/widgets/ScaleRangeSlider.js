// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/domUtils ../core/events ../core/HandleOwner ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../intl/number ./Slider ./Widget ./ScaleRangeSlider/css ./ScaleRangeSlider/scalePreviewUtils ./ScaleRangeSlider/ScaleRanges ./ScaleRangeSlider/ScaleRangeSliderViewModel ./support/componentsUtils ./support/Popover ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(I,r,k,g,J,w,K,x,t,m,L,U,V,M,E,N,O,h,F,A,P,Q,B,G,R,n,C,S){const D={preview:!0,scaleMenus:{maxScaleMenu:!0,minScaleMenu:!0}},T={maximumFractionDigits:0};g=function(H){function y(b,e){var a=H.call(this,b,e)||this;a._activeMenu=null;a._activeMenuNode=null;a._activeMenuToggleNode=null;a._activeThumb=null;a._customMaxScale=-1;a._customMinScale=-1;a._focusedMenuItemIndex=-1;a._maxScaleMenuPopover=new B({owner:r._assertThisInitialized(a),placement:"bottom-end",anchorElement:()=>a._activeMenuToggleNode,
renderContentFunction:()=>a._maxScaleMenuEnabled?a.renderMaxScaleMenu():null});a._minScaleMenuPopover=new B({owner:r._assertThisInitialized(a),placement:"bottom-start",anchorElement:()=>a._activeMenuToggleNode,renderContentFunction:()=>a._minScaleMenuEnabled?a.renderMinScaleMenu():null});a._maxThumbNode=null;a._minThumbNode=null;a._previewAutoCloseTimeoutId=void 0;a._previewPopover=new B({owner:r._assertThisInitialized(a),placement:"top",anchorElement:()=>0===a._activeThumb?a._minThumbNode:a._maxThumbNode,
offset:[0,16],renderContentFunction:a.renderScalePreview});a._scaleMenuNode=null;a._slider=new N({thumbCreatedFunction:(c,d,f)=>{0===c&&(a._minThumbNode=f);1===c&&(a._maxThumbNode=f);a.addHandles([w.on(f,"mouseenter",()=>{const {visibleElements:{preview:l}}=r._assertThisInitialized(a);a._activeThumb=c;a._previewPopover.open=l;a.scheduleRender()}),w.on(f,"mouseleave",()=>{a._previewAutoCloseTimeoutId||(a._activeThumb=null,a._previewPopover.open=!1,a.scheduleRender())})])}});a.disabled=!1;a.messages=
null;a.region="US";a.viewModel=new P;a.visibleElements=D;a._handleScaleMenuToggleClick=c=>{c=c.currentTarget;const d=c.getAttribute("data-type");a.handles.remove("menu-closing-click-handle");d===a._activeMenu?(a._setActiveMenu(null),a._activeMenuToggleNode=null):(a._setActiveMenu(d),a._activeMenuToggleNode=c,a.handles.add(w.on(document,"mousedown",f=>{f=f.target;const l=J.closest(f,`.${h.CSS.scaleMenuToggle}`),q=l&&l.getAttribute("data-type");l&&q===a._activeMenu||q||!a._scaleMenuNode||a._scaleMenuNode.contains(f)||
(a._setActiveMenu(null),a.handles.remove("menu-closing-click-handle"),a.scheduleRender())}),"menu-closing-click-handle"))};a._afterMenuListCreate=c=>{a._activeMenuNode=c;c.children[0].focus({preventScroll:!0})};a._handleCustomScaleEntry=c=>{a._setScaleFromMenuSelection(c);a._customMaxScale=-1;a._customMinScale=-1};a._handleCustomScaleInputBlur=()=>{"max"===a._activeMenu?a._customMaxScale=-1:a._customMinScale=-1};a._handleCustomScaleInputKeyDown=c=>{var d=c.currentTarget;const {handleCustomScaleSelect:f}=
d["data-render-props"],{key:l,ctrlKey:q,metaKey:u}=c,{viewModel:{scaleRanges:z}}=r._assertThisInitialized(a);"Enter"===l?(d=a.parseScale(d.value),f?.(isNaN(d)?-1:z.clampScale(d)),c.preventDefault(),c.stopPropagation()):1<l.length||q||u||/[:,.\d]/.test(l)||(c.preventDefault(),c.stopPropagation())};a._handleScaleMenuKeyDown=c=>{var d=w.eventKey(c);if("Escape"===d||"Tab"===d)a._setActiveMenu(null),a._activeMenuToggleNode?.focus();else if("ArrowUp"===d||"ArrowDown"===d){var f=Array.from(a._activeMenuNode?.children??
[]),l=a._focusedMenuItemIndex;d="ArrowUp"===d?(0===l?f.length:l)-1:(l+1)%f.length;c.preventDefault();c.stopPropagation();f[d].focus();a._focusedMenuItemIndex=d}};return a}r._inherits(y,H);var p=y.prototype;p.loadDependencies=function(){return Q.loadCalciteComponents({icon:()=>new Promise((b,e)=>I(["../chunks/calcite-icon"],b,e))})};p.initialize=function(){this.addHandles([t.watch(()=>this.viewModel,b=>this._slider.viewModel=b?.sliderViewModel??null,t.initial),t.watch(()=>this._interactive,b=>{this._slider.disabled=
!b;b||this._setActiveMenu(null)},t.initial),this._slider.on("thumb-drag",({index:b})=>{const {visibleElements:{preview:e}}=this;this._activeThumb=b;this._previewPopover.open=e;clearTimeout(this._previewAutoCloseTimeoutId);this._previewAutoCloseTimeoutId=setTimeout(()=>{this._previewAutoCloseTimeoutId=void 0;this._activeThumb=null;this._previewPopover.open=!1;this.scheduleRender()},250)}),t.when(()=>!0===this.view?.stationary,()=>this.scheduleRender())])};p.destroy=function(){this._previewPopover=
x.destroyMaybe(this._previewPopover);this._maxScaleMenuPopover=x.destroyMaybe(this._maxScaleMenuPopover);this._minScaleMenuPopover=x.destroyMaybe(this._minScaleMenuPopover);this._slider=x.destroyMaybe(this._slider)};p.castVisibleElements=function(b){return{...D,...b,scaleMenus:"boolean"===typeof b?.scaleMenus?b.scaleMenus:{...D.scaleMenus,...b?.scaleMenus}}};p.formatScale=function(b){return`1:${E.formatNumber(b,T)}`};p.parseScale=function(b){var e=E.getFormatter().formatToParts(100000.1);const a=
e.find(c=>"decimal"===c.type)?.value??"";e=e.find(c=>"group"===c.type)?.value??"";b=b.replace(/.*\(/,"").replace(/\).*$/,"").replace(/.*:/,"").replaceAll(e,"").replaceAll(a,".").replaceAll(/[^\d.\s]/g,"");return parseFloat(b)};p.render=function(){const {_interactive:b,_slider:e,label:a,messages:c,view:d,viewModel:{scaleRanges:f,state:l}}=this;var q=c.scaleRangeLabels;const u=q[f.findScaleRangeByIndex(e.values[0]).id];q=q[f.findScaleRangeByIndex(e.values[1]).id];e.layout=C.isRTL(this.container)?"horizontal-reversed":
"horizontal";return n.tsx("div",{"aria-label":a,class:this.classes(h.CSS.base,h.CSS.widget,b?null:h.CSS.disabled)},"ready"===l&&d?this.renderCurrentScaleIndicator():null,e.render(),n.tsx("div",{class:h.CSS.scaleMenuContainer,key:"scale-menu-toggles"},this._minScaleMenuEnabled?this.renderScaleMenuToggle("min",u):null,this._maxScaleMenuEnabled?this.renderScaleMenuToggle("max",q):null))};p.renderMinScaleMenu=function(){const {effectiveMaxScale:b,effectiveMinScaleLimit:e,view:a,viewModel:{scaleRanges:c}}=
this,d=a?a.scale:void 0;return this.renderScaleMenu({type:"min",min:e,max:c.findScaleRange(b).minScale,map:d})};p.renderMaxScaleMenu=function(){const {effectiveMinScale:b,effectiveMaxScaleLimit:e,view:a,viewModel:{scaleRanges:c}}=this,d=a?a.scale:void 0;return this.renderScaleMenu({type:"max",min:c.findScaleRange(b).maxScale,max:e,map:d})};p.renderScalePreview=function(){const {_activeThumb:b,_slider:e,region:a,viewModel:{scaleRanges:c}}=this;var d=0===b?e.values[0]:e.values[1];d=Object.keys(A.RecommendedScales).indexOf(c.findScaleRangeByIndex(d).id);
d={backgroundImage:F.getScalePreviewSource(a),backgroundPosition:F.getScalePreviewSpriteBackgroundPosition(d)};return n.tsx("div",{class:h.CSS.scalePreview},n.tsx("div",{class:h.CSS.scalePreviewThumbnail,styles:d}))};p.renderScaleMenu=function({map:b,min:e,max:a,type:c}){const d=A.fromScaleRange({minScale:e,maxScale:a}),f=this.messages.featuredScaleLabels,l=A.RecommendedScales;e=Object.keys(l).filter(v=>d.contains(l[v])).map(v=>this.renderScaleMenuItem({scaleLabel:f[v],scaleValue:l[v],valueVisible:"world"!==
v,handleNamedScaleSelect:this._handleRecommendedScaleClick}));const {_customMaxScale:q,_customMinScale:u,messages:z}=this;return n.tsx("div",{bind:this,class:h.CSS.scaleMenu,"data-type":c,id:`${this.id}__scale-menu--${c}`,key:`${c}-scale-menu`,afterCreate:C.storeNode,"data-node-ref":"_scaleMenuNode",onkeydown:this._handleScaleMenuKeyDown},n.tsx("div",{class:h.CSS.scaleMenuScroller},n.tsx("ul",{class:h.CSS.scaleMenuList,afterCreate:this._afterMenuListCreate},this.renderScaleMenuItem({scaleValue:"max"===
c?q:u,scaleLabel:z.featuredScaleLabels.custom,valueVisible:!1,handleNamedScaleSelect:this._handleScaleSelection,handleCustomScaleSelect:this._handleCustomScaleEntry}),null!=b?this.renderScaleMenuItem({scaleValue:b,scaleLabel:z.featuredScaleLabels.current,valueVisible:!0,handleNamedScaleSelect:this._handleRecommendedScaleClick}):null,e)))};p._handleScaleSelection=function(){"max"===this._activeMenu?this._customMaxScale=this.effectiveMaxScale:this._customMinScale=this.effectiveMinScale};p.renderScaleMenuToggle=
function(b,e){const {_activeMenu:a,_interactive:c}=this,d=a===b;return n.tsx("button",{"aria-controls":d?`${this.id}__scale-menu--${b}`:"","aria-pressed":d?"true":"false",class:this.classes(h.CSS.scaleMenuToggle,d?h.CSS.scaleMenuToggleActive:null),"data-type":b,key:`${b}-scale-menu-toggle`,onclick:this._handleScaleMenuToggleClick,disabled:!c,type:"button"},n.tsx("div",{class:h.CSS.scaleMenuToggleText,"aria-label":e,title:e},e),n.tsx("span",{class:this.classes(h.CSS.scaleMenuToggleIcon,h.CSS.expandIcon),
"aria-hidden":"true"}))};p.renderScaleMenuItem=function(b){const {scaleValue:e,scaleLabel:a,valueVisible:c,handleNamedScaleSelect:d,handleCustomScaleSelect:f=null}=b;var {id:l}=this;l=`${l}__custom-scale-input`;return n.tsx("li",{bind:this,class:h.CSS.scaleMenuListItem,"data-scale":e,key:a,onclick:d,onkeydown:d,tabIndex:-1},n.tsx("calcite-icon",{icon:"bullet-point",key:"bullet-icon",scale:"m",class:h.CSS.scaleMenuListItemIcon}),n.tsx("div",{class:h.CSS.scaleMenuListItemContent},n.tsx("label",{class:h.CSS.scaleItemLabel,
for:l},a),c?n.tsx("div",{class:h.CSS.scaleItemValue,key:"value"},this.formatScale(e)):null,-1<e&&f?n.tsx("input",{afterCreate:this._focusAndSelectInputOnCreate,class:this.classes(h.CSS.scaleItemValue,h.CSS.scaleItemValueEditable),"data-render-props":b,id:l,key:"value",value:this.formatScale(e),onkeydown:this._handleCustomScaleInputKeyDown,onblur:this._handleCustomScaleInputBlur}):null))};p._focusAndSelectInputOnCreate=function(b){b.focus();b.select()};p.renderCurrentScaleIndicator=function(){const {_slider:b,
messages:e,view:a,viewModel:{scaleRanges:c}}=this;var d=c.clampScale(a.scale),f=this.viewModel.mapScaleToSlider(d);d=f/b.max;f=e.scaleRangeLabels[c.findScaleRangeByIndex(f).id];f=S.substitute(e.currentScaleTooltip,{scaleLabel:f});return n.tsx("div",{class:h.CSS.scaleIndicatorContainer,key:"scale-indicator"},n.tsx("div",{"aria-label":f,class:h.CSS.scaleIndicator,styles:{left:`${(C.isRTL(this.container)?-1:1)*d*100}%`},title:f},this.renderCurrentScaleIndicatorIcon()))};p.renderCurrentScaleIndicatorIcon=
function(){return n.tsx("svg",{class:h.CSS.scaleIndicatorIcon,height:"8",width:"8",viewBox:"0 0 8 8",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},n.tsx("polygon",{points:"4 0 8 8 0 8"}))};p._handleRecommendedScaleClick=function(b){this._setScaleFromMenuSelection(Number(b.currentTarget["data-scale"]))};p._setScaleFromMenuSelection=function(b){"max"===this._activeMenu?this.maxScale=Math.min(b,this.effectiveMinScale-1):this.minScale=Math.max(b,this.effectiveMaxScale+1);this._setActiveMenu(null);
this._activeMenuToggleNode?.focus()};p._setActiveMenu=function(b){this._activeMenu=b;this._maxScaleMenuPopover.open="max"===b;this._minScaleMenuPopover.open="min"===b;this._focusedMenuItemIndex=b?0:-1};r._createClass(y,[{key:"_maxScaleMenuEnabled",get:function(){const {scaleMenus:b}=this.visibleElements;return!0===b||"boolean"!==typeof b&&b.maxScaleMenu}},{key:"_minScaleMenuEnabled",get:function(){const {scaleMenus:b}=this.visibleElements;return!0===b||"boolean"!==typeof b&&b.minScaleMenu}},{key:"_interactive",
get:function(){return"disabled"!==this.get("viewModel.state")&&!this.disabled}},{key:"effectiveMaxScale",get:function(){return this.viewModel.effectiveMaxScale}},{key:"effectiveMinScale",get:function(){return this.viewModel.effectiveMinScale}},{key:"effectiveMaxScaleLimit",get:function(){return this.viewModel.effectiveMaxScaleLimit}},{key:"effectiveMinScaleLimit",get:function(){return this.viewModel.effectiveMinScaleLimit}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(b){this._overrideIfSome("label",
b)}},{key:"layer",get:function(){return this.viewModel.layer},set:function(b){this.viewModel.layer=b}},{key:"maxScale",get:function(){return this.viewModel.maxScale},set:function(b){this.viewModel.maxScale=b}},{key:"maxScaleLimit",get:function(){return this.viewModel.maxScaleLimit},set:function(b){this.viewModel.maxScaleLimit=b}},{key:"minScale",get:function(){return this.viewModel.minScale},set:function(b){this.viewModel.minScale=b}},{key:"minScaleLimit",get:function(){return this.viewModel.minScaleLimit},
set:function(b){this.viewModel.minScaleLimit=b}},{key:"view",get:function(){return this.viewModel.view},set:function(b){this.viewModel.view=b}}]);return y}(K.HandleOwnerMixin(O));k.__decorate([m.property()],g.prototype,"_maxScaleMenuEnabled",null);k.__decorate([m.property()],g.prototype,"_minScaleMenuEnabled",null);k.__decorate([m.property()],g.prototype,"_slider",void 0);k.__decorate([m.property({readOnly:!0})],g.prototype,"_interactive",null);k.__decorate([m.property()],g.prototype,"disabled",void 0);
k.__decorate([m.property()],g.prototype,"effectiveMaxScale",null);k.__decorate([m.property()],g.prototype,"effectiveMinScale",null);k.__decorate([m.property()],g.prototype,"effectiveMaxScaleLimit",null);k.__decorate([m.property()],g.prototype,"effectiveMinScaleLimit",null);k.__decorate([m.property()],g.prototype,"label",null);k.__decorate([m.property()],g.prototype,"layer",null);k.__decorate([m.property()],g.prototype,"maxScale",null);k.__decorate([m.property()],g.prototype,"maxScaleLimit",null);
k.__decorate([m.property(),R.messageBundle("esri/widgets/ScaleRangeSlider/t9n/ScaleRangeSlider")],g.prototype,"messages",void 0);k.__decorate([m.property()],g.prototype,"minScale",null);k.__decorate([m.property()],g.prototype,"minScaleLimit",null);k.__decorate([m.property()],g.prototype,"region",void 0);k.__decorate([m.property()],g.prototype,"view",null);k.__decorate([m.property()],g.prototype,"viewModel",void 0);k.__decorate([m.property()],g.prototype,"visibleElements",void 0);k.__decorate([L.cast("visibleElements")],
g.prototype,"castVisibleElements",null);k.__decorate([G.accessibleHandler()],g.prototype,"_handleScaleSelection",null);k.__decorate([G.accessibleHandler()],g.prototype,"_handleRecommendedScaleClick",null);return g=k.__decorate([M.subclass("esri.widgets.ScaleRangeSlider")],g)});