// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(q,v){q.GeometryType=void 0;(function(g){g[g.Unknown=0]="Unknown";g[g.Point=1]="Point";g[g.LineString=2]="LineString";g[g.Polygon=3]="Polygon"})(q.GeometryType||(q.GeometryType={}));let t=function(){function g(a,b){this.x=a;this.y=b}var c=g.prototype;c.clone=function(){return new g(this.x,this.y)};c.equals=function(a,b){return a===this.x&&b===this.y};c.isEqual=function(a){return a.x===this.x&&a.y===this.y};c.setCoords=function(a,
b){this.x=a;this.y=b};c.normalize=function(){var a=this.x;const b=this.y;a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a};c.rightPerpendicular=function(){const a=this.x;this.x=this.y;this.y=-a};c.move=function(a,b){this.x+=a;this.y+=b};c.assign=function(a){this.x=a.x;this.y=a.y};c.assignAdd=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y};c.assignSub=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y};c.rotate=function(a,b){const d=this.x,f=this.y;this.x=d*a-f*b;this.y=d*b+f*a};c.scale=function(a){this.x*=a;this.y*=
a};c.length=function(){const a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};g.distance=function(a,b){const d=b.x-a.x;a=b.y-a.y;return Math.sqrt(d*d+a*a)};g.add=function(a,b){return new g(a.x+b.x,a.y+b.y)};g.sub=function(a,b){return new g(a.x-b.x,a.y-b.y)};return v._createClass(g)}(),x=v._createClass(function(g,c,a){this.ratio=g;this.x=c;this.y=a}),B=function(){function g(a,b,d,f=8,e=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=f;this._pixelMargin=e;this._tileSize=
512*f;this._dz=a;this._yPos=b;this._xPos=d}var c=g.prototype;c.setPixelMargin=function(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))};c.setExtent=function(a){this._extent=a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-b;this._ymin=a*this._yPos-b;this._xmax=this._xmin+a+2*b;this._ymax=this._ymin+a+2*b};c.reset=function(a){this._type=a;this._lines=
[];this._starts=[];this._line=null;this._start=0};c.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new t(a,b);this._firstPt=new t(a,b);this._dist=0};c.lineTo=function(a,b){const d=this._isIn(a,b),f=new t(a,b),e=t.distance(this._prevPt,f);if(d)if(this._prevIsIn)this._lineTo(a,b,!0);else{var h=this._prevPt;var k=f;a=this._intersect(k,h);this._start=this._dist+e*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(k.x,k.y,!0)}else if(this._prevIsIn)k=
this._prevPt,h=f,a=this._intersect(k,h),this._lineTo(a.x,a.y,!0),this._lineTo(h.x,h.y,!1);else{const l=this._prevPt;if(!(l.x<=this._xmin&&f.x<=this._xmin||l.x>=this._xmax&&f.x>=this._xmax||l.y<=this._ymin&&f.y<=this._ymin||l.y>=this._ymax&&f.y>=this._ymax)){a=[];if(l.x<this._xmin&&f.x>this._xmin||l.x>this._xmin&&f.x<this._xmin){b=(this._xmin-l.x)/(f.x-l.x);var m=l.y+b*(f.y-l.y);m<=this._ymin?k=!1:m>=this._ymax?k=!0:a.push(new x(b,this._xmin,m))}if(l.x<this._xmax&&f.x>this._xmax||l.x>this._xmax&&f.x<
this._xmax)b=(this._xmax-l.x)/(f.x-l.x),m=l.y+b*(f.y-l.y),m<=this._ymin?k=!1:m>=this._ymax?k=!0:a.push(new x(b,this._xmax,m));if(l.y<this._ymin&&f.y>this._ymin||l.y>this._ymin&&f.y<this._ymin)b=(this._ymin-l.y)/(f.y-l.y),m=l.x+b*(f.x-l.x),m<=this._xmin?h=!1:m>=this._xmax?h=!0:a.push(new x(b,m,this._ymin));if(l.y<this._ymax&&f.y>this._ymax||l.y>this._ymax&&f.y<this._ymax)b=(this._ymax-l.y)/(f.y-l.y),m=l.x+b*(f.x-l.x),m<=this._xmin?h=!1:m>=this._xmax?h=!0:a.push(new x(b,m,this._ymax));if(0===a.length)h?
k?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):k?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+e*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+e*a[0].ratio,h=0;h<a.length;h++)this._lineTo(a[h].x,a[h].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=e;this._prevIsIn=d;this._prevPt=f};c.close=function(){if(2<this._line.length){var a=
this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};c.result=function(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===q.GeometryType.Polygon&&a&&A.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines};c.resultWithStarts=function(){if(this._type!==q.GeometryType.LineString)throw Error("Only valid for lines");
this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const d=[];for(let f=0;f<b;f++)d.push({line:a[f],start:this._starts[f]||0});return d};c._isIn=function(a,b){return a>=this._xmin&&a<=this._xmax&&b>=this._ymin&&b<=this._ymax};c._intersect=function(a,b){let d,f,e;if(b.x>=this._xmin&&b.x<=this._xmax)f=b.y<=this._ymin?this._ymin:this._ymax,e=(f-a.y)/(b.y-a.y),d=a.x+e*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)d=b.x<=this._xmin?this._xmin:this._xmax,e=(d-a.x)/(b.x-a.x),f=a.y+
e*(b.y-a.y);else{f=b.y<=this._ymin?this._ymin:this._ymax;d=b.x<=this._xmin?this._xmin:this._xmax;const h=(d-a.x)/(b.x-a.x),k=(f-a.y)/(b.y-a.y);h<k?(e=h,f=a.y+h*(b.y-a.y)):(e=k,d=a.x+k*(b.x-a.x))}this._r=e;return new t(d,f)};c._pushLine=function(){this._line&&(this._type===q.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===q.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===
q.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0};c._moveTo=function(a,b,d){this._type!==q.GeometryType.Polygon?d&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(a,b))):(d||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+
this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(a,b)),this._isV=this._isH=!1)};c._lineTo=function(a,b,d){if(this._type!==q.GeometryType.Polygon)if(d){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(d=this._line[this._line.length-1],d.equals(a,b)))return;this._line.push(new t(a,b))}else this._line&&0<this._line.length&&this._pushLine();
else if(d||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){d=this._line[this._line.length-1];const f=d.x===a,e=d.y===b;f&&e||(this._isH&&f?(d.x=a,d.y=b,d=this._line[this._line.length-2],d.x===a&&d.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(d=this._line[this._line.length-
2],this._isH=d.x===a,this._isV=d.y===b)):(this._isH=d.x===a,this._isV=d.y===b)):this._isV&&e?(d.x=a,d.y=b,d=this._line[this._line.length-2],d.x===a&&d.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(d=this._line[this._line.length-2],this._isH=d.x===a,this._isV=d.y===b)):(this._isH=d.x===a,this._isV=d.y===b)):(this._line.push(new t(a,b)),this._isH=f,this._isV=e))}else this._line.push(new t(a,b))};return v._createClass(g)}(),C=function(){function g(){}var c=g.prototype;c.setExtent=
function(a){this._ratio=4096===a?1:4096/a};c.reset=function(a){this._lines=[];this._line=null};c.moveTo=function(a,b){this._line&&this._lines.push(this._line);this._line=[];const d=this._ratio;this._line.push(new t(a*d,b*d))};c.lineTo=function(a,b){const d=this._ratio;this._line.push(new t(a*d,b*d))};c.close=function(){const a=this._line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};c.result=function(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines};v._createClass(g,
[{key:"validateTessellation",get:function(){return 1>this._ratio}}]);return g}();var p;(function(g){g[g.sideLeft=0]="sideLeft";g[g.sideRight=1]="sideRight";g[g.sideTop=2]="sideTop";g[g.sideBottom=3]="sideBottom"})(p||(p={}));let A=function(){function g(){}g.simplify=function(c,a,b){if(b){var d=-a,f=c+a,e=-a,h=c+a;c=[];a=[];var k=b.length;for(let m=0;m<k;++m){const l=b[m];if(!l||2>l.length)continue;let r=l[0],u;const w=l.length;for(let n=1;n<w;++n)u=l[n],r.x===u.x&&(r.x<=d&&(r.y>u.y?(c.push(m),c.push(n),
c.push(p.sideLeft),c.push(-1)):(a.push(m),a.push(n),a.push(p.sideLeft),a.push(-1))),r.x>=f&&(r.y<u.y?(c.push(m),c.push(n),c.push(p.sideRight),c.push(-1)):(a.push(m),a.push(n),a.push(p.sideRight),a.push(-1)))),r.y===u.y&&(r.y<=e&&(r.x<u.x?(c.push(m),c.push(n),c.push(p.sideTop),c.push(-1)):(a.push(m),a.push(n),a.push(p.sideTop),a.push(-1))),r.y>=h&&(r.x>u.x?(c.push(m),c.push(n),c.push(p.sideBottom),c.push(-1)):(a.push(m),a.push(n),a.push(p.sideBottom),a.push(-1)))),r=u}0!==c.length&&0!==a.length&&(g.fillParent(b,
a,c),g.fillParent(b,c,a),d=[],g.calcDeltas(d,a,c),g.calcDeltas(d,c,a),g.addDeltas(d,b))}};g.fillParent=function(c,a,b){const d=b.length,f=a.length;for(let l=0;l<f;l+=4){var e=a[l],h=a[l+1];const r=a[l+2],u=c[e][h-1];e=c[e][h];h=8092;let w=-1;for(let n=0;n<d;n+=4){if(b[n+2]!==r)continue;var k=b[n];const z=b[n+1];var m=c[k][z-1];k=c[k][z];switch(r){case p.sideLeft:case p.sideRight:y(u.y,m.y,k.y)&&y(e.y,m.y,k.y)&&(m=Math.abs(k.y-m.y),m<h&&(h=m,w=n));break;case p.sideTop:case p.sideBottom:y(u.x,m.x,k.x)&&
y(e.x,m.x,k.x)&&(m=Math.abs(k.x-m.x),m<h&&(h=m,w=n))}}a[l+3]=w}};g.calcDeltas=function(c,a,b){const d=a.length;for(let f=0;f<d;f+=4){const e=g.calcDelta(f,a,b,[]);c.push(a[f]);c.push(a[f+1]);c.push(a[f+2]);c.push(e)}};g.calcDelta=function(c,a,b,d){c=a[c+3];if(-1===c)return 0;const f=d.length;if(1<f&&d[f-2]===c)return 0;d.push(c);return g.calcDelta(c,b,a,d)+1};g.addDeltas=function(c,a){const b=c.length;let d=0;for(var f=0;f<b;f+=4){var e=c[f+3];e>d&&(d=e)}for(f=0;f<b;f+=4){e=a[c[f]];const h=c[f+1],
k=d-c[f+3];switch(c[f+2]){case p.sideLeft:e[h-1].x-=k;e[h].x-=k;1===h&&(e[e.length-1].x-=k);h===e.length-1&&(e[0].x-=k);break;case p.sideRight:e[h-1].x+=k;e[h].x+=k;1===h&&(e[e.length-1].x+=k);h===e.length-1&&(e[0].x+=k);break;case p.sideTop:e[h-1].y-=k;e[h].y-=k;1===h&&(e[e.length-1].y-=k);h===e.length-1&&(e[0].y-=k);break;case p.sideBottom:e[h-1].y+=k,e[h].y+=k,1===h&&(e[e.length-1].y+=k),h===e.length-1&&(e[0].y+=k)}}};return v._createClass(g)}();const y=(g,c,a)=>g>=c&&g<=a||g>=a&&g<=c;q.Point=
t;q.SimpleBuilder=C;q.TileClipper=B;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});