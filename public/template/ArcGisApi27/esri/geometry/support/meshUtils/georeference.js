// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../DoubleArray ../MeshGeoreferencedRelativeVertexSpace ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),function(m,A,I,u,p,J,v,B,r,C,w,K,L,M,N,k,D,l){function x(a,b,c){if(D.isGeographicMesh(b.spatialReference,
c)){var e=b.spatialReference,f=E(b,c,n),d=new Float64Array(a.position.length);b=a.position;var g=e;var h=d;k.transformMat4(h,b,f);b=new Float64Array(b.length);g=l.projectFromPCPF(h,b,g);f=B.normalFromMat4(F,f);h=d;b=a.normal;c=f;var t=e;if(null==b)h=null;else{var q=new Float32Array(b.length);k.transformMat3(q,b,c);l.projectNormalFromPCPF(q,g,h,t,q);h=q}a=a.tangent;if(null==a)a=null;else{b=new Float32Array(a.length);k.transformMat3(b,a,f,4);for(f=3;f<b.length;f+=4)b[f]=a[f];l.projectTangentFromPCPF(b,
g,d,e,b);a=b}a={position:g,normal:h,tangent:a}}else{e=new Float64Array(a.position.length);g=a.position;d=b.x;f=b.y;h=b.z??0;b=y(c?c.unit:null,b.spatialReference);for(c=0;c<g.length;c+=3)e[c]=g[c]*b+d,e[c+1]=g[c+1]*b+f,e[c+2]=g[c+2]*b+h;a={position:e,normal:a.normal,tangent:a.tangent}}return a}function G(a,b,c,e){const {position:f,normal:d,tangent:g}=a;if(!b.isRelative)return{position:f,normal:d,tangent:g};var h=c?.localMatrix??p.IDENTITY;a=k.transformMat4(new Float64Array(f.length),f,h);c=null!=d?
l.transformNormal(d,new Float32Array(d.length),h):null;h=null!=g?l.transformTangent(g,new Float32Array(g.length),h):null;return x({position:a,normal:c,tangent:h},b.getOriginPoint(e),{geographic:!b.isGeoreferenced})}function z(a,b,c){if(D.isGeographicMesh(b.spatialReference,c)){const g=b.spatialReference;E(b,c,n);var e=u.invert(O,n);b=new Float64Array(a.position.length);c=e;var f=l.projectToPCPF(a.position,g,b),d=new Float64Array(f.length);k.transformMat4(d,f,c);c=d;e=B.normalFromMat4(F,e);d=a.normal;
f=e;null==d?f=null:(d=l.projectNormalToPCPF(d,a.position,b,g,new Float32Array(d.length)),k.transformMat3(d,d,f),f=d);d=a.tangent;null==d?a=null:(a=l.projectTangentToPCPF(d,a.position,b,g,new Float32Array(d.length)),k.transformMat3(a,a,e,4));a={position:c,normal:f,tangent:a}}else a=H(a,b,c);return a}function H(a,b,c){const e=new Float64Array(a.position.length),f=a.position,d=b.x,g=b.y,h=b.z??0;b=y(c?c.unit:null,b.spatialReference);for(c=0;c<f.length;c+=3)e[c]=(f[c]-d)/b,e[c+1]=(f[c+1]-g)/b,e[c+2]=
(f[c+2]-h)/b;return{position:e,normal:a.normal,tangent:a.tangent}}function E(a,b,c){r.computeTranslationToOriginAndRotation(a.spatialReference,[a.x,a.y,a.z??0],c,C.getSphericalPCPF(a.spatialReference));a=y(b?b.unit:null,a.spatialReference);u.scale(c,c,[a,a,a]);return c}function y(a,b){if(null==a)return 1;b=A.getMetersPerCartesianUnitForSR(b);return 1/A.convertUnit(b,"meters",a)}const n=p.create(),O=p.create(),F=I.create();m.georeference=x;m.georeferenceApplyTransform=G;m.georeferenceByTransform=function(a,
b,c){if(c?.useTransform){const {position:e,normal:f,tangent:d}=a,{x:g,y:h,z:t}=b;a=v.fromValues(g,h,t??0);return{vertexAttributes:{position:e,normal:f,tangent:d},vertexSpace:c.geographic??!0?new M({origin:a}):new K({origin:a}),transform:new N}}return{vertexAttributes:x(a,b,c),vertexSpace:new L,transform:null}};m.project=function({positions:a,transform:b,vertexSpace:c,inSpatialReference:e,outSpatialReference:f,outPositions:d,local:g}){const h=c.isRelative?c.origin:v.ZEROS;b=c.isRelative?b?.localMatrix??
p.IDENTITY:p.IDENTITY;if(c.isGeoreferenced){d=d??w.newDoubleArray(a.length);u.equals(b,p.IDENTITY)?w.copyInto(d,a):k.transformMat4(d,a,b);if(!J.exactEquals(h,v.ZEROS)){const [t,q,P]=h;for(a=0;a<d.length;a+=3)d[a]+=t,d[a+1]+=q,d[a+2]+=P}r.projectBuffer(d,e,0,d,f,0,d.length/3);return d}c=C.getSphericalPCPF(e);g=!g&&r.canProjectWithoutEngine(e,c)?c:e;r.computeTranslationToOriginAndRotation(e,h,n,g);u.multiply(n,n,b);e=d??w.newDoubleArray(a.length);k.transformMat4(e,a,n);r.projectBuffer(e,g,0,e,f,0,e.length/
3);return e};m.ungeoreference=z;m.ungeoreferenceByTransform=function(a,b,c,e,f){if(!b.isRelative)return z(a,e,f);const {spatialReference:d}=e;a=G(a,b,c,d);return e.equals(b.getOriginPoint(d))?H(a,e,f):z(a,e,f)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});