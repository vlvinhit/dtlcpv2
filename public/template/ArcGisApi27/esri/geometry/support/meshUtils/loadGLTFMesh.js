// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../Color ../../../request ../../../core/MapUtils ../../../core/mathUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../MeshComponent ../MeshMaterialMetallicRoughness ../MeshTexture ../MeshTextureTransform ../MeshVertexAttributes ../buffer/BufferView ../../../chunks/vec32 ../../../chunks/vec42 ../buffer/utils ./georeference ../../../views/3d/glTF/DefaultLoadingContext ../../../views/3d/glTF/loader ../../../views/3d/glTF/internal/indexUtils ../../../views/3d/glTF/internal/resourceUtils ../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../views/webgl/enums ../../../chunks/vec33 ../../../chunks/vec43 ../../../chunks/vec22".split(" "),
function(F,G,N,H,C,I,J,O,P,Q,R,S,T,U,m,x,A,y,V,W,X,Y,Z,aa,D,K,B,L){function ba(a){const b=a?.resolveFile;return b?{busy:!1,request:async(f,c,e)=>{f=b(f);return(await N(f,{responseType:"image"===c?"image":"binary"===c?"array-buffer":"json",signal:null!=e?e.signal:null})).data}}:null}function z(a,b){if(null==a)return"-";a=a.typedBuffer;return`${H.getOrCreateMapValue(b,a.buffer,()=>b.size)}/${a.byteOffset}/${a.byteLength}`}function ca(a){return null!=a?a.toString():"-"}function da(a){let b=0;var f=!1,
c=!1,e=!1,d=!1;const g=new Map,u=new Map,q=[];for(const l of a.parts){const {attributes:{position:k,normal:v,color:h,tangent:p,texCoord0:t}}=l;a=`\n      ${z(k,g)}/\n      ${z(v,g)}/\n      ${z(h,g)}/\n      ${z(p,g)}/\n      ${z(t,g)}/\n      ${ca(l.transform)}\n    `;let n=!1;a=H.getOrCreateMapValue(u,a,()=>{n=!0;return{start:b,length:k.count}});n&&(b+=k.count);v&&(e=!0);h&&(f=!0);p&&(c=!0);t&&(d=!0);q.push({gltf:l,writeVertices:n,region:a})}return{vertexAttributes:{position:y.createBuffer(m.BufferViewVec3f64,
b),normal:e?y.createBuffer(m.BufferViewVec3f,b):null,tangent:c?y.createBuffer(m.BufferViewVec4f,b):null,color:f?y.createBuffer(m.BufferViewVec4u8,b):null,texCoord0:d?y.createBuffer(m.BufferViewVec2f,b):null},parts:q,components:[]}}function ea(a,b){const f=new G(fa(a.color,a.opacity)),c=a.emissiveFactor?new G(ha(a.emissiveFactor)):null,e=k=>k?new T({scale:k.scale?[k.scale[0],k.scale[1]]:[1,1],rotation:C.rad2deg(k.rotation??0),offset:k.offset?[k.offset[0],k.offset[1]]:[0,0]}):null;var d=b.get(a.textureColor),
g=b.get(a.textureNormal),u=b.get(a.textureEmissive),q=b.get(a.textureOcclusion);a:{switch(a.alphaMode){case "OPAQUE":var l="opaque";break a;case "MASK":l="mask";break a;case "BLEND":l="blend";break a}l=void 0}return new R({color:f,colorTexture:d,normalTexture:g,emissiveColor:c,emissiveTexture:u,occlusionTexture:q,alphaMode:l,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,metallic:a.metallicFactor,roughness:a.roughnessFactor,metallicRoughnessTexture:b.get(a.textureMetallicRoughness),colorTextureTransform:e(a.colorTextureTransform),
normalTextureTransform:e(a.normalTextureTransform),occlusionTextureTransform:e(a.occlusionTextureTransform),emissiveTextureTransform:e(a.emissiveTextureTransform),metallicRoughnessTextureTransform:e(a.metallicRoughnessTextureTransform)})}function ia(a,b,f){if(b.writeVertices){const {position:v,normal:h,tangent:p,color:t,texCoord0:n}=a.vertexAttributes;var c=b.region.start;const {attributes:r,transform:E}=b.gltf;var e=r.position.count;x.transformMat4View(v.slice(c,e),r.position,E);if(null!=r.normal&&
null!=h){var d=I.normalFromMat4(J.create(),E),g=h.slice(c,e);x.transformMat3View(g,r.normal,d);C.hasScaling(d)&&x.normalizeView(g,g)}else null!=h&&K.fill(h,0,0,1,{dstIndex:c,count:e});null!=r.tangent&&null!=p?(d=I.normalFromMat4(J.create(),E),g=p.slice(c,e),A.transformMat3View(g,r.tangent,d),C.hasScaling(d)&&A.normalize(g,g)):null!=p&&B.fill(p,0,0,1,1,{dstIndex:c,count:e});null!=r.texCoord0&&null!=n?L.normalizeIntegerBufferView(n.slice(c,e),r.texCoord0):null!=n&&L.fill(n,0,0,{dstIndex:c,count:e});
null!=r.color&&null!=t?(d=r.color,c=t.slice(c,e),4===d.elementCount?d instanceof m.BufferViewVec4f?A.scaleView(c,d,255):d instanceof m.BufferViewVec4u8?B.copyView(c,d):d instanceof m.BufferViewVec4u16&&A.scaleView(c,d,1/256):(B.fill(c,255,255,255,255),c=m.BufferViewVec3u8.fromTypedArray(c.typedBuffer,c.typedBufferStride),d instanceof m.BufferViewVec3f?x.scaleView(c,d,255):d instanceof m.BufferViewVec3u8?K.copyView(c,d):d instanceof m.BufferViewVec3u16&&x.scaleView(c,d,1/256))):null!=t&&B.fill(t.slice(c,
e),255,255,255,255)}const {indices:u,attributes:q,primitiveType:l,material:k}=b.gltf;c=Y.convertPrimitiveToTriangles(u||q.position.count,l);if(b=b.region.start){e=new Uint32Array(c);for(d=0;d<c.length;d++)e[d]+=b;c=e}a.components.push(new Q({faces:c,material:f.get(k),shading:q.normal?"source":"flat",trustSourceNormals:!0}))}function M(a){switch(a){case D.TextureWrapMode.CLAMP_TO_EDGE:return"clamp";case D.TextureWrapMode.MIRRORED_REPEAT:return"mirror";case D.TextureWrapMode.REPEAT:return"repeat"}}
function w(a){return 255*a**(1/aa.COLOR_GAMMA)}function fa(a,b){return P.fromValues(w(a[0]),w(a[1]),w(a[2]),b)}function ha(a){return O.fromValues(w(a[0]),w(a[1]),w(a[2]))}F.loadGLTFMesh=async function(a,b,f){f={...f,useTransform:f?.useTransform??!0};var c=new W.DefaultLoadingContext(ba(f));b=(await X.loadGLTF(c,b,f,!0)).model;c=b.lods.shift();const e=new Map,d=new Map;b.textures.forEach((h,p)=>{var t=e.set;var n=(Z.isEncodedMeshTexture(h.data),h.data);h=h.parameters.wrap;h={horizontal:M(h.s),vertical:M(h.t)};
n=new S({data:n,wrap:h});return t.call(e,p,n)});b.materials.forEach((h,p)=>d.set(p,ea(h,e)));b=da(c);for(var g of b.parts)ia(b,g,d);const {position:u,normal:q,tangent:l,color:k,texCoord0:v}=b.vertexAttributes;g={position:u.typedBuffer,normal:null!=q?q.typedBuffer:null,tangent:null!=l?l.typedBuffer:null,uv:null!=v?v.typedBuffer:null,color:null!=k?k.typedBuffer:null};f=V.georeferenceByTransform(g,a,f);return{transform:f.transform,vertexSpace:f.vertexSpace,components:b.components,spatialReference:a.spatialReference,
vertexAttributes:new U.MeshVertexAttributes({position:f.vertexAttributes.position,normal:f.vertexAttributes.normal,tangent:f.vertexAttributes.tangent,color:g.color,uv:g.uv})}};Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});