// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(r,m,t,n,e,p,u){function v(a){const c=p.removeFile(a.url);return b=>{var d=p.makeRelative(b,c,c);return((d=d?d.replace(/^ *\.\//,""):null)?a.files.get(d):null)??b}}async function w(a,c){if(Array.isArray(a)){if(!a.length)throw new n("mesh-load-external:missing-assets","There must be at least one file to load");return a[0]instanceof File?
x(a):y(a,c)}return g.fromBlob(a)}async function z(a,c){const {parts:b}=a;if(1===b.length)return new g(b[0].partUrl);a=await a.toBlob(c);e.throwIfAborted(c);return g.fromBlob(a)}function x(a){a=a.map(c=>({name:c.name,mimeType:c.type,source:g.fromBlob(c)}));return q(a)}async function y(a,c){a=await e.eachAlwaysValues(a.map(async b=>{const d=await z(b);e.throwIfAborted(c);return{name:b.assetName,mimeType:b.assetMimeType,source:d}}));if(e.isAborted(c))throw a.forEach(b=>b.source.dispose()),e.createAbortError();
return q(a)}function q(a){const c=new Map;let b=null;for(const {name:d,mimeType:f,source:h}of a){if(null==b||A.test(f)||B.test(d))b=h.url;c.set(d,h.url);h.files.forEach((k,l)=>c.set(l,k))}if(null==b)throw new n("mesh-load-external:missing-files","Missing files to load external mesh source");return new g(b,()=>a.forEach(({source:d})=>d.dispose()),c)}const A=/^(model\/gltf\+json)|(model\/gltf-binary)$/,B=/\.(gltf|glb)/i;let g=function(){function a(c,b=()=>{},d=new Map){this.url=c;this.dispose=b;this.files=
d}a.fromBlob=function(c){const b=URL.createObjectURL(c);return new a(b,()=>URL.revokeObjectURL(b))};return t._createClass(a)}();m.loadExternal=async function(a,c,b){({source:c}=c);const {loadGLTFMesh:d}=await e.whenOrAbort(new Promise((l,C)=>r(["./loadGLTFMesh"],l,C)),b),f=await w(c,b);e.throwIfAborted(b);b=d(new u({x:0,y:0,z:0,spatialReference:a.spatialReference}),f.url,{resolveFile:v(f),useTransform:!0,signal:b?.signal});b.then(()=>f.dispose(),()=>f.dispose());const {vertexAttributes:h,components:k}=
await b;a.vertexAttributes=h;a.components=k};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});