// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/HandleOwner ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/MeshGeoreferencedRelativeVertexSpace ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/georeference ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(C,D,h,t,e,J,k,K,L,M,l,E,ba,ca,N,O,P,Q,r,R,F,w,S,x,y,z,A,T,u,U,V,W,G,X,p,Y,Z){var m;E={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:x,"georeferenced-relative":S,local:y}};e=m=function(H){function n(a){a=H.call(this,a)||this;a.components=null;a.vertexSpace=new x;a.transform=null;a.metadata=new G.Metadata;a.hasZ=!0;a.hasM=!1;a.vertexAttributes=new A.MeshVertexAttributes;a.type="mesh";return a}D._inherits(n,H);var f=n.prototype;f.initialize=function(){if(0===this.metadata.externalSources.length||
this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.handles.add(M.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(a=>a.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})};f.addComponent=function(a){this.loaded?(this.components||(this.components=[]),this.components.push(w.from(a)),this.notifyChange("components")):k.getLogger(this).error("addComponent()","Mesh must be loaded before applying operations")};f.removeComponent=function(a){if(this.loaded){if(this.components&&
(a=this.components.indexOf(a),-1!==a)){this.components.splice(a,1);this.notifyChange("components");return}k.getLogger(this).error("removeComponent()","Provided component is not part of the list of components")}else k.getLogger(this).error("removeComponent()","Mesh must be loaded before applying operations")};f.rotate=function(a,b,c,d){F.composeAxes(a,b,c,I);Y.rotate(this,I,d);return this};f.offset=function(a,b,c,d){if(!this.loaded)return k.getLogger(this).error("offset()","Mesh must be loaded before applying operations"),
this;v[0]=a;v[1]=b;v[2]=c;X.offset(this,v,d);return this};f.scale=function(a,b){if(!this.loaded)return k.getLogger(this).error("scale()","Mesh must be loaded before applying operations"),this;Z.scale(this,a,b);return this};f.centerAt=function(a,b){if(!this.loaded)return k.getLogger(this).error("centerAt()","Mesh must be loaded before applying operations"),this;U.centerAt(this,a,b);return this};f.load=function(a){const {metadata:{displaySource:b}}=this;b&&this.addResolvingPromise(W.loadExternal(this,
b,a));return Promise.resolve(this)};f.addExternalSources=function(a){this.metadata.externalSources.addMany(a)};f.updateDisplaySource=function(a){this.metadata.displaySource=a};f.clone=function(){return this.cloneWithVertexSpace(this.vertexSpace.clone())};f.cloneWithVertexSpace=function(a){let b=null;if(this.components){const c=new Map,d=new Map;b=this.components.map(g=>g.cloneWithDeduplication(c,d))}a={components:b,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),
vertexSpace:a,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new m(a)};f.cloneShallow=function(){return new m({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})};f.vertexAttributesChanged=function(){this.notifyChange("vertexAttributes")};f.toBinaryGLTF=async function(a){var b=new Promise((d,g)=>C(["./support/meshUtils/exporters/gltf/gltfexport"],
d,g));const c=this.load();b=await Promise.all([b,c]);({toBinaryGLTF:b}=b[0]);return b(this,a)};f._clearSources=function(){this.metadata.clearSources()};n.createBox=function(a,b){if(!(a instanceof r))return k.getLogger("esri.geometry.Mesh").error(".createBox()","expected location to be a Point instance"),null;a=new m(p.convertUnitGeometry(p.createUnitSizeBox(),a,b));return b&&b.imageFace&&"all"!==b.imageFace?p.extractSingleFaceOfBox(a,b.imageFace):a};n.createSphere=function(a,b){return a instanceof
r?new m(p.convertUnitGeometry(p.createUnitSizeSphere(b&&b.densificationFactor||0),a,b)):(k.getLogger("esri.geometry.Mesh").error(".createSphere()","expected location to be a Point instance"),null)};n.createCylinder=function(a,b){return a instanceof r?new m(p.convertUnitGeometry(p.createUnitSizeCylinder(b&&b.densificationFactor||0),a,b)):(k.getLogger("esri.geometry.Mesh").error(".createCylinder()","expected location to be a Point instance"),null)};n.createPlane=function(a,b){if(!(a instanceof r))return k.getLogger("esri.geometry.Mesh").error(".createPlane()",
"expected location to be a Point instance"),null;const c=b?.facing??"up",d=p.convertPlaneSizeParameter(c,b?.size);return new m(p.convertUnitGeometry(p.createUnitSizePlane(c),a,{...b,size:d}))};n.createFromPolygon=function(a,b){if(!(a instanceof R))return k.getLogger("esri.geometry.Mesh").error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const c=T.triangulate(a);return new m({vertexAttributes:new A.MeshVertexAttributes({position:c.position}),components:[new w({faces:c.faces,
shading:"flat",material:b?.material??null})],spatialReference:a.spatialReference,vertexSpace:new x})};n.createFromGLTF=async function(a,b,c){if(!(a instanceof r))throw k.getLogger("esri.geometry.Mesh").error(".createfromGLTF()","expected location to be a Point instance"),new t("invalid-input","Expected location to be a Point instance");const {loadGLTFMesh:d}=await L.whenOrAbort(new Promise((g,q)=>C(["./support/meshUtils/loadGLTFMesh"],g,q)),c);return new m(await d(a,b,c))};n.createFromFiles=async function(a,
b,c){if(!(a instanceof r))throw k.getLogger("esri.geometry.Mesh").error(".createFromFiles()","Expected location to be a Point instance"),new t("invalid-input","Expected location to be a Point instance");a=m.createWithExternalSource(a,b);b=c?.layer;if(!b)throw k.getLogger("esri.geometry.Mesh").error(".createFromFiles()","A layer is needed to convert the files"),new t("invalid-input","A layer is needed to convert the files");[c]=await b.uploadAssets([a],c);return c};n.createWithExternalSource=function(a,
b,c){var d=c?.extent??null;const {x:g,y:q,z:B,spatialReference:aa}=a;a=c?.transform?.clone()??new z;c=c?.vertexSpace??new y({origin:[g,q,B??0]});b={source:b,extent:d};d=new G.Metadata;d.externalSources.push(b);return new m({metadata:d,transform:a,vertexSpace:c,spatialReference:aa})};n.createIncomplete=function(a,b){const {x:c,y:d,z:g,spatialReference:q}=a;a=b?.transform?.clone()??new z;b=b?.vertexSpace??new y({origin:[c,d,g??0]});b=new m({transform:a,vertexSpace:b,spatialReference:q});b.addResolvingPromise(Promise.reject(new t("mesh-incomplete",
"Mesh resources are not complete")));return b};D._createClass(n,[{key:"hasExtent",get:function(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}},{key:"_transformedExtent",get:function(){const {components:a,spatialReference:b,vertexAttributes:c,vertexSpace:d}=this;var g=c.position;if(0===g.length||a&&0===a.length)return new P({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b});if("local"===
d.type){const {_untransformedExtent:q,transform:B}=this;return u.getProjectedExtent(q,B,d,b)}if("georeferenced-relative"===d.type){const {transform:q}=this;g=V.project({positions:g,transform:q,vertexSpace:d,inSpatialReference:b,outSpatialReference:b,local:!1});return u.getExtentFromPositions(g,b)}return u.getExtentFromPositions(g,b)}},{key:"_untransformedExtent",get:function(){return u.getExtentFromPositions(this.vertexAttributes.position,this.spatialReference)}},{key:"anchor",get:function(){const {vertexSpace:a}=
this;if(a.isRelative)return a.getOriginPoint(this.spatialReference);const {center:b,zmin:c}=this._transformedExtent;return new r({x:b.x,y:b.y,z:c,spatialReference:this.spatialReference})}},{key:"origin",get:function(){const {vertexSpace:a}=this;return a.isRelative?a.getOriginPoint(this.spatialReference):this._transformedExtent.center}},{key:"extent",get:function(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}},{key:"memoryUsage",
get:function(){let a;a=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const b of this.components)a+=b.memoryUsage;return a}}]);return n}(e.HandleOwnerMixin(J.LoadableMixin(K.EsriPromiseMixin(Q))));h.__decorate([l.property({type:[w],json:{write:!0}})],e.prototype,"components",void 0);h.__decorate([l.property({nonNullable:!0,types:E,constructOnly:!0,json:{write:!0}})],e.prototype,"vertexSpace",void 0);h.__decorate([l.property({type:z,json:{write:!0}})],e.prototype,"transform",void 0);
h.__decorate([l.property({constructOnly:!0})],e.prototype,"metadata",void 0);h.__decorate([l.property()],e.prototype,"hasExtent",null);h.__decorate([l.property()],e.prototype,"_transformedExtent",null);h.__decorate([l.property()],e.prototype,"_untransformedExtent",null);h.__decorate([l.property()],e.prototype,"anchor",null);h.__decorate([l.property()],e.prototype,"origin",null);h.__decorate([l.property({readOnly:!0,json:{read:!1}})],e.prototype,"extent",null);h.__decorate([l.property({readOnly:!0,
json:{read:!1,write:!0,default:!0}})],e.prototype,"hasZ",void 0);h.__decorate([l.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],e.prototype,"hasM",void 0);h.__decorate([l.property({type:A.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],e.prototype,"vertexAttributes",void 0);e=m=h.__decorate([N.subclass("esri.geometry.Mesh")],e);const v=O.create(),I=F.create();return e});