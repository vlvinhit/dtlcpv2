// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(l,H,I){function r(a){return null==a||"string"===typeof a&&!a?"\x3cNull\x3e":a}function x(a){const b=null!=a.minValue||null!=a.maxValue,c=!!a.sqlExpression&&a.supportsSQLExpression;return!(null!=a.normalizationField||null!=a.normalizationType)&&!b&&!c}function y(a){const {values:b,useSampleStdDev:c,supportsNullCount:e}=a;var g=Number.POSITIVE_INFINITY;let f=Number.NEGATIVE_INFINITY,d=null,k=
null;var h=null;let p=null,m=0;const q=null==a.minValue?-Infinity:a.minValue,t=null==a.maxValue?Infinity:a.maxValue;for(const n of b)Number.isFinite(n)?n>=q&&n<=t&&(d=null===d?n:d+n,g=Math.min(g,n),f=Math.max(f,n),m++):"string"===typeof n&&m++;if(m&&null!=d){k=d/m;h=0;for(const n of b)Number.isFinite(n)&&n>=q&&n<=t&&(h+=(n-k)**2);p=c?1<m?h/(m-1):0:0<m?h/m:0;h=Math.sqrt(p)}else f=g=null;g={avg:k,count:m,max:f,min:g,stddev:h,sum:d,variance:p};e&&(g.nullcount=b.length-m);a.percentileParams&&(g.median=
v(b,a.percentileParams));return g}function v(a,b){const {fieldType:c,value:e,orderBy:g,isDiscrete:f}=b,d=z(c,"desc"===g);a=[...a].filter(m=>null!=m).sort((m,q)=>d(m,q));if(0===a.length)return null;if(0>=e)return a[0];if(1<=e)return a[a.length-1];var k=(a.length-1)*e,h=Math.floor(k);b=h+1;k%=1;h=a[h];const p=a[b];return b>=a.length||f||"string"===typeof h||"string"===typeof p?h:h*(1-k)+p*k}function z(a,b){const c=b?1:-1,e=J(b),g=A(b);if(!a||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID",
"esriFieldTypeGlobalID",...B].includes(a))return(f,d)=>"number"===typeof f&&"number"===typeof d?e(f,d):"string"===typeof f&&"string"===typeof d?g(f,d):c;if("esriFieldTypeDate"===a)return(f,d)=>{f=(new Date(f)).getTime();d=(new Date(d)).getTime();return isNaN(f)||isNaN(d)?c:e(f,d)};if(B.has(a))return(f,d)=>e(f,d);if("esriFieldTypeString"===a)return(f,d)=>g(f,d);if("esriFieldTypeGUID"===a||"esriFieldTypeGlobalID"===a){const f=A(b);return(d,k)=>f(C(d),C(k))}return b?(f,d)=>1:(f,d)=>-1}function u(a,b,
c){if(c){if(null==a)return null==b?0:1;if(null==b)return-1}else{if(null==a)return null==b?0:-1;if(null==b)return 1}return null}function A(a){return a?(b,c)=>{const e=u(b,c,!0);if(null!=e)return e;b=b.toUpperCase();c=c.toUpperCase();return b>c?-1:b<c?1:0}:(b,c)=>{const e=u(b,c,!1);if(null!=e)return e;b=b.toUpperCase();c=c.toUpperCase();return b<c?-1:b>c?1:0}}function J(a){return a?(b,c)=>{const e=u(b,c,!0);return null!=e?e:c-b}:(b,c)=>{const e=u(b,c,!1);return null!=e?e:b-c}}function C(a){return a.substr(24,
12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function w(a){return"coded-value"!==a?.type?[]:a.codedValues.map(b=>b.code)}function D(a,b){const c=E({field:b.field,normalizationType:b.normalizationType,normalizationField:b.normalizationField,classificationMethod:b.classificationMethod,standardDeviationInterval:b.standardDeviationInterval,breakCount:b.numClasses||5});a=K(a,b.minValue,b.maxValue);return I.createGenerateRendererClassBreaks({definition:c,
values:a,normalizationTotal:b.normalizationTotal})}function K(a,b,c){const e=null==b?-Infinity:b,g=null==c?Infinity:c;return a.filter(f=>Number.isFinite(f)&&f>=e&&f<=g)}function E(a){const {breakCount:b,field:c,normalizationField:e,normalizationType:g}=a,f=a.classificationMethod||"equal-interval";return new H({breakCount:b,classificationField:c,classificationMethod:f,normalizationField:"field"===g?e:void 0,normalizationType:g,standardDeviationInterval:"standard-deviation"===f?a.standardDeviationInterval||
1:void 0})}function L(a,b){const {field:c,classificationMethod:e,standardDeviationInterval:g,normalizationType:f,normalizationField:d,normalizationTotal:k,minValue:h,maxValue:p}=b,m=b.numBins||10;let q=b=null,t=null;e&&"equal-interval"!==e||f?({classBreaks:a}=D(a,{field:c,normalizationType:f,normalizationField:d,normalizationTotal:k,classificationMethod:e,standardDeviationInterval:g,minValue:h,maxValue:p,numClasses:m}),b=a[0].minValue,q=a[a.length-1].maxValue,t=a.map(n=>[n.minValue,n.maxValue])):
(null!=h&&null!=p?(b=h,q=p):(a=y({values:a,minValue:h,maxValue:p,useSampleStdDev:!f,supportsNullCount:x({normalizationType:f,normalizationField:d,minValue:h,maxValue:p})}),b=a.min??null,q=a.max??null),t=F(b??0,q??0,m));return{min:b,max:q,intervals:t}}function M(a,b){let c=-1;for(let e=a.length-1;0<=e;e--)if(b>=a[e][0]){c=e;break}return c}function F(a,b,c){const e=(b-a)/c,g=[];let f;for(let d=1;d<=c;d++)f=a+e,f=Number(f.toFixed(16)),g.push([a,d===c?b:f]),a=f;return g}const N=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,
B=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),G="min max avg stddev count sum variance nullcount median".split(" ");l.calculateClassBreaks=D;l.calculateHistogram=function(a,b){var c=L(a,b);if(null==c.min&&null==c.max)return{bins:[],minValue:c.min,maxValue:c.max,normalizationTotal:b.normalizationTotal};const e=c.intervals,g=c.min??0;c=c.max??0;const f=e.map((d,k)=>({minValue:e[k][0],maxValue:e[k][1],count:0}));for(const d of a)null!=d&&
d>=g&&d<=c&&(a=M(e,d),-1<a&&f[a].count++);return{bins:f,minValue:g,maxValue:c,normalizationTotal:b.normalizationTotal}};l.calculatePercentile=v;l.calculateStatistics=y;l.calculateStringStatistics=function(a){const b=a.returnDistinct?[...(new Set(a.values))]:a.values;var c=b.filter(g=>null!=g).sort();const e=c.length;c={count:e,min:c[0],max:c[e-1]};a.supportsNullCount&&(c.nullcount=b.length-e);a.percentileParams&&(c.median=v(b,a.percentileParams));return c};l.calculateUniqueValuesCount=function(a){const b=
{};for(let c of a){if(null==c||"string"===typeof c&&""===c.trim())c=null;null==b[c]?b[c]={count:1,data:c}:b[c].count++}return{count:b}};l.createClassBreaksDefinition=E;l.createUVResult=function(a,b,c,e){a=a.count;const g=[];if(c&&b){c=[];var f=w(b[0]);for(const d of f)if(b[1]){f=w(b[1]);for(const k of f)if(b[2]){f=w(b[2]);for(const h of f)c.push(`${r(d)}${e}${r(k)}${e}${r(h)}`)}else c.push(`${r(d)}${e}${r(k)}`)}else c.push(d);for(const d of c)a.hasOwnProperty(d)||(a[d]={data:d,count:0})}for(const d in a)b=
a[d],g.push({value:b.data,count:b.count,label:b.label});return{uniqueValueInfos:g}};l.getAttributeComparator=z;l.getEqualIntervalBins=F;l.getNormalizedValue=function(a,b,c,e){let g=null;switch(b){case "log":0!==a&&(g=Math.log(a)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(e)&&0!==e&&(g=a/e*100);break;case "field":Number.isFinite(c)&&0!==c&&(g=a/c);break;case "natural-log":0<a&&(g=Math.log(a));break;case "square-root":0<a&&(g=a**.5)}return g};l.isNullCountSupported=x;l.processNullValue=
r;l.processSummaryStatisticsResult=function(a,b){let c;for(c in a)G.includes(c)&&(Number.isFinite(a[c])||(a[c]=null));if(!b)return a;["avg","stddev","variance"].forEach(e=>{null!=a[e]&&(a[e]=Math.ceil(a[e]??0))});return a};l.resolveCBResult=function(a,b){let c=a.classBreaks;const e=c[0]?.minValue,g=c[c.length-1]?.maxValue,f="standard-deviation"===b;c=c.map(d=>{const k=d.label;d={minValue:d.minValue,maxValue:d.maxValue,label:k};if(f&&k){const h=k.match(N)?.map(p=>+p.trim())??[];2===h.length?(d.minStdDev=
h[0],d.maxStdDev=h[1],0>h[0]&&0<h[1]&&(d.hasAvg=!0)):1===h.length&&(k.includes("\x3c")?(d.minStdDev=null,d.maxStdDev=h[0]):k.includes("\x3e")&&(d.minStdDev=h[0],d.maxStdDev=null))}return d});return{minValue:e,maxValue:g,classBreakInfos:c,normalizationTotal:a.normalizationTotal}};l.statisticTypes=G;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});