// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../renderers/support/AuthoringInfo ../../renderers/support/HeatmapColorStop ../../renderers/support/heatmapUtils ./support/utils ../statistics/heatmapStatistics ../support/utils ../support/adapters/support/layerUtils ../symbology/heatmap".split(" "),
function(k,l,S,T,U,E,V,W,X,Y,Z,u,v,g,F,m,G,H,e,n){async function I(a){if(!(a&&a.layer&&a.view))throw new u("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");a={...a,layer:a.layer,view:a.view};a.radius??(a.radius=null==a.blurRadius?18:F.gaussianBlurRadiusPxToKernelDensityRadiusPt(a.blurRadius));a.minRatio??(a.minRatio=.01);a.maxRatio??(a.maxRatio=1);a.fadeRatio??(a.fadeRatio=.2);a.fadeToTransparent??(a.fadeToTransparent=!0);var b=[e.LayerType.CSVLayer,e.LayerType.FeatureLayer,
e.LayerType.OGCFeatureLayer,e.LayerType.GeoJSONLayer,e.LayerType.StreamLayer,e.LayerType.WFSLayer],c=e.createLayerAdapter(a.layer,b);if(!c)throw new u("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+e.getLayerTypeLabels(b).join(", "));a.layer=c;await c.load(null!=a.signal?{signal:a.signal}:null);b=await H.getFieldsList({field:a.field});if(c=m.verifyBasicFieldValidity(c,b,"heatmap-renderer:invalid-parameters"))throw c;return a}async function J(a){let b=a.scheme,c=null;
var d=null;d=await m.getBasemapInfo(a.basemap,a.view);c=null!=d.basemapId?d.basemapId:null;d=null!=d.basemapTheme?d.basemapTheme:null;if(b)return{scheme:n.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=n.getSchemes({basemap:c,basemapTheme:d}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}async function K(a,b){const {fieldOffset:c}=a,{field:d,basemap:p,radius:q,fadeToTransparent:h,heatmapScheme:L,view:M}=b,{scheme:w,basemapId:N,basemapTheme:O}=await J({basemap:p,
scheme:L,view:M});var f=w.colors;const x=f.length,y=!a.count,z=y?[0,.04]:[a.min,a.max];let A;const B=b.fadeRatio??0,r=b.minRatio??0,P=((b.maxRatio??0)-r)/(x-1);b=f[0];const C=h?r:.01,t=[new g({ratio:0,color:new l([b.r,b.g,b.b,0])}),new g({ratio:.01,color:new l([b.r,b.g,b.b,0])}),new g({ratio:C,color:new l([b.r,b.g,b.b,C])})];m.createColors(f,x).forEach((Q,R)=>{t.push(new g({ratio:r+P*R,color:Q}))});h&&(D(t,B),A=new v({fadeRatio:B}));f=new E({authoringInfo:A,radius:q,colorStops:t,field:d,minDensity:z[0],
maxDensity:z[1]});null!=c&&(f.fieldOffset=c);return{renderer:f,statistics:a,defaultValuesUsed:y,scheme:n.cloneScheme(w),basemapId:N,basemapTheme:O}}function D(a,b){const c=10*(1-b)+1;a.forEach((d,p)=>{if(!(2>=p)){var {ratio:q,color:h}=d;h.a=0===b?1:Math.min(Math.max(q*c,0),1)}})}k.createRenderer=async function(a){a=await I(a);const b=a.statistics??await G({layer:a.layer,field:a.field,fieldOffset:a.fieldOffset,radius:a.radius,view:a.view,signal:a.signal});return K(b,a)};k.updateRenderer=function(a){const {fadeRatio:b,
renderer:c}=a;a=c.clone();const d=null==b?a?.authoringInfo?.fadeRatio||0:b;D(a.colorStops,d);a.authoringInfo?a.authoringInfo.fadeRatio=d:a.authoringInfo=new v({fadeRatio:d});return a};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});