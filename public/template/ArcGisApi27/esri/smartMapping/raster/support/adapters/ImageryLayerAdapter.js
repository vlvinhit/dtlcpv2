// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/stretchUtils ../../../../rest/support/ImageHistogramParameters ./RasterLayerAdapter ../../../../geometry/Point".split(" "),function(h,k,d,q,z,A,B,r,t,u,v,w){d=
function(l){function g(){var a=l.apply(this,arguments)||this;a._cacheSize=20;a._statsCache=new Map;return a}h._inherits(g,l);var e=g.prototype;e.generateRasterInfo=function(a){try{return this.layer.generateRasterInfo(a?.rasterFunction,{signal:a?.signal})}catch{return Promise.resolve(this.layer.serviceRasterInfo)}};e.estimateStatisticsHistograms=async function(a){var b=a?.rasterFunction?.functionName??"default";if(this._statsCache.has(b))return this._statsCache.get(b);let {width:m,height:n,pixelSize:f}=
this.layer.rasterInfo;for(var c=1;2E3<m||2E3<n;)m/=2,n/=2,c*=2;const x=a?.rasterFunction??this.layer.rasterFunction,{fullExtent:p,mosaicRule:y}=this.layer;f=new w(f.x*c,f.y*c,p.spatialReference);c=new u({geometry:p,pixelSize:f,renderingRule:x,mosaicRule:y});this.layer.capabilities.operations.supportsComputeStatisticsHistograms?a=await this.layer.computeStatisticsHistograms(c,a):({histograms:a}=await this.layer.computeHistograms(c,a),a={statistics:t.estimateStatisticsFromHistograms(a),histograms:a});
this._statsCache.set(b,a);this._statsCache.size>this._cacheSize&&(b=this._statsCache.keys().next().value,this._statsCache.delete(b));return a};e.supportsMultidirectionalHillshade=function(){return 10.81<=this.layer.version};e.load=function(a){this.addResolvingPromise(this.layer.load(a).then(()=>{this.generateRasterInfo({rasterFunction:this.rasterFunction,signal:a?.signal}).then(b=>this.rasterInfo=b)}));return Promise.resolve(this)};return h._createClass(g)}(v);k.__decorate([q.property()],d.prototype,
"layer",void 0);return d=k.__decorate([r.subclass("esri.smartMapping.support.adapters.ImageryLayerAdapter")],d)});