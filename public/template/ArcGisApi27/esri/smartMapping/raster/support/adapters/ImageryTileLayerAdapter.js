// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/stretchUtils ./RasterLayerAdapter".split(" "),function(q,r,u,v,h,A,B,w,x,y,z){h=function(t){function m(){return t.apply(this,arguments)||
this}q._inherits(m,t);var g=m.prototype;g.generateRasterInfo=async function(a){const {layer:b}=this,d=a?.rasterFunction;if("imagery-tile"===b.type&&d)try{return b.generateRasterInfo(d,{signal:a?.signal})}catch{return b.rasterInfo}return this.rasterInfo};g.estimateStatisticsHistograms=async function(a){if(null!==this._statsCache)return this._statsCache;const {raster:b}=this.layer,{extent:d,width:n,height:c}=this._getSamplePixelBlockDescriptor(b.rasterInfo);({pixelBlock:a}=await b.fetchPixels(d,n,c,
a));if(null==a)throw new u("raster-layer-adapter","Unable to estimate histograms");return this._statsCache=y.estimateStatisticsHistograms(a)};g.supportsMultidirectionalHillshade=function(){return!0};g.load=function(a){this.addResolvingPromise(this.layer.load(a).then(()=>this.rasterInfo=this.layer.raster.rasterInfo));return Promise.resolve(this)};g._getSamplePixelBlockDescriptor=function(a,b=1E3){const {pyramidScalingFactor:d,maximumPyramidLevel:n}=a.storageInfo;let {extent:c,width:e,height:f,pixelSize:k}=
a,p=Math.ceil(Math.log(Math.max(e,f)/b)/Math.log(d))-1,l=a=0;p<=n?(b=d**p,e=Math.floor(e/b),f=Math.floor(f/b)):(p=0,e=Math.min(e,b),f=Math.min(f,b),a=Math.max(Math.floor(e/2-500),0),l=Math.max(Math.floor(f/2-500),0),c=new x({xmin:c.xmin+a*k.x,xmax:Math.min(c.xmax,c.xmin+a*k.x*b),ymin:c.ymin+l*k.y,ymax:Math.min(c.ymax,c.ymin+l*k.y*b)}));return{extent:c,width:e,height:f,origin:{x:a,y:l}}};return q._createClass(m)}(z);r.__decorate([v.property()],h.prototype,"layer",void 0);return h=r.__decorate([w.subclass("esri.smartMapping.support.adapters.ImageryTileLayerAdapter")],
h)});