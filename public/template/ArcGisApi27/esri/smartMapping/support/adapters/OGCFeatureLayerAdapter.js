// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/fieldUtils ../../statistics/support/predominanceUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ../utils ./FeatureLayerAdapter ./support/utils ../../../statistics/utils".split(" "),
function(r,w,x,h,n,p,G,H,y,z,A,B,C,t,D,l,u){p=function(v){function q(a){return v.call(this,a)||this}r._inherits(q,v);var f=q.prototype;f._waitForLayerViewUpdate=async function(a){if(!a)throw new h("ogc-feature-layer-adapter:insufficient-data","layerView is required to fetch the features");await n.whenOnce(()=>!a.updating)};f._summaryStatsFromClientQuery=async function(a,c){const {signal:b,view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");
a=l.getSummaryStatsQuery(this,a,c);const e=await d.whenLayerView(this.layer);await n.whenOnce(()=>!e.updating,b);a=await e.queryFeatures(a,{signal:b});c=l.getSummaryStatisticsFromFeatureSet(a,c);return u.processSummaryStatisticsResult(c)};f._uvFromClientQuery=async function(a,c){const {signal:b,view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");var e=l.getUVQuery(this,a);const g=await d.whenLayerView(this.layer);await n.whenOnce(()=>
!g.updating,b);e=await g.queryFeatures(e,{signal:b});e=await l.getUniqueValuesFromFeatureSet(e,{layer:this,field:a.field,field2:a.field2,field3:a.field3,fieldDelimiter:t.FIELD_DELIMITER,view:a.view,signal:a.signal});return u.createUVResult(e,c,a.returnAllCodedValues,t.FIELD_DELIMITER)};f.summaryStatistics=function(a){const {field:c,valueExpression:b,sqlExpression:d,features:e,view:g}=a,m=c?this.getField(c):null,k=z.isDateField(m),E=!!b,F="3d"===g?.type;if(!b&&d&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported",
"Layer does not support standardized SQL expression for queries");return E||e||F?this._summaryStatsFromMemory(a,m):this._summaryStatsFromClientQuery(a,k)};f.uniqueValues=async function(a){const {valueExpression:c,sqlExpression:b,features:d,view:e}=a,g=await l.getDomainsForFields(a,this),m=!!c,k="3d"===e?.type;if(!c&&b&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return m||d||k?this._uvFromMemory(a,
g):this._uvFromClientQuery(a,g)};f.histogram=function(a){const {features:c,valueExpression:b,normalizationType:d,sqlExpression:e}=a,g=c||!!b;if(!b&&e&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return g||d?this._histogramFromMemory(a):this._histogramForField(a)};f.classBreaks=function(a){return!1!==a.analyzeData?this._classBreaksFromMemory(a):this._classBreaksFromInterpolation(a)};f.queryFeatureCount=
async function(a){const {whereClause:c,view:b,signal:d}=a;if(!b)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");a=this.layer.createQuery();a.where=B.mergeWhereClauses(a.where,c);const e=await b.whenLayerView(this.layer);await n.whenOnce(()=>!e.updating,d);return e.queryFeatureCount(a,{signal:d})};f.generateRenderer=function(a,c){throw new h("ogc-feature-layer-adapter:not-supported","OGCFeatureLayer does not support generateRenderer operation");
};f.predominantCategories=async function(a){const {fields:c,view:b,signal:d}=a;a=A.getArcadeForPredominantCategory(c);a=await this._uvFromMemory({valueExpression:a,view:b,signal:d});return l.getPredominantCategoriesFromUVInfos(a.uniqueValueInfos,c)};f.getSampleFeatures=async function(a,c){const {view:b,sampleSize:d,requiredFields:e,returnGeometry:g,signal:m}=a,k=this.layer.createQuery();k.outSpatialReference=a.spatialReference||b&&b.spatialReference;k.returnGeometry=!!g;k.outFields=e;if(!b)throw new h("ogc-feature-layer-adapter:not-supported",
"view is required to get sample features for OGCFeatureLayer");a=await b.whenLayerView(this.layer);if(l.getMissingFields(this,e,a).length)throw new h("ogc-feature-layer-adapter:not-supported","Required fields need to be passed in the outFields for OGCFeatureLayer");c=await this._fetchFeaturesFromMemory(a,k,m,c);return x.pickRandom(c,null!=d&&0<d&&d<=c.length?d:c.length,1)};f.load=function(a){const c=this.layer.load(a).then(async b=>{this.geometryType=b.geometryType;this.objectIdField=b.objectIdField;
this.supportsSQLExpression=b.get("capabilities.query.supportsSqlExpression");this.minScale=b.minScale;this.maxScale=b.maxScale;this.fullExtent=b.fullExtent;this.workerClient=C.WorkerClient.getInstance();await this.workerClient.open(a.signal)});this.addResolvingPromise(c);return Promise.resolve(this)};return r._createClass(q)}(D);return p=w.__decorate([y.subclass("esri.smartMapping.support.adapters.OGCFeatureLayerAdapter")],p)});