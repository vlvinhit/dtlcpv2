// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../rest/support/generateRendererUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ../utils ./FeatureLayerAdapter ./support/utils".split(" "),function(p,u,q,k,C,D,E,v,r,l,w,x,y,z){k=function(t){function m(){var a=t.apply(this,
arguments)||this;a.adapterName="csv-layer-adapter";return a}p._inherits(m,t);var n=m.prototype;n._createGenerateRendererResult=async function(a,c,b,f,d){a=a?.features;if(!a?.length)throw new q("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const g=z.ensureFeaturesJSON(a);a=null;if("percent-of-total"===f&&(a=(await this.workerClient.summaryStatistics({field:c},g)).sum,null==a))throw new q("csv-layer-adapter:invalid","invalid normalizationTotal");if("class-breaks-definition"===
d?.type)return c=(await l.getDataValues({field:c,normalizationType:f,normalizationField:b,normalizationTotal:a},g)).filter(e=>Number.isFinite(e)),r.createGenerateRendererClassBreaks({definition:d,values:c,normalizationTotal:a});d=(await l.getDataValues({field:c},g)).filter(e=>null!=e&&"string"===typeof e&&""!==e.trim());return r.createGenerateRendererUniqueValues(d)};n.generateRenderer=function(a,c){const b=a.classificationDefinition;let f=null,d=null,g=null;"class-breaks-definition"===b?.type?(f=
b.classificationField,d=b.normalizationField,g=b.normalizationType):f=b?.attributeField;const e=this.layer;return x.getFieldsList({field:f,normalizationField:d}).then(A=>{const h=e.createQuery();h.returnGeometry=!1;h.outFields=A;h.where=l.mergeWhereClauses(h.where,a.where);return e.queryFeatures(h,{signal:c}).then(B=>this._createGenerateRendererResult(B,f,d,g,b))})};n.load=function(a){const c=this.layer.load(a).then(async b=>{this.geometryType=b.geometryType;this.objectIdField=b.objectIdField;this.supportsSQLExpression=
!0;this._hasLocalSource=!1;this.hasQueryEngine=!0;this.workerClient=w.WorkerClient.getInstance();await this.workerClient.open(a.signal)});this.addResolvingPromise(c);return Promise.resolve(this)};return p._createClass(m)}(y);return k=u.__decorate([v.subclass("esri.smartMapping.support.adapters.CSVLayerAdapter")],k)});