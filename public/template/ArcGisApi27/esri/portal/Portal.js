// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/JSONSupport ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ../intl/locale ./portalDefault ./PortalQueryParams ./PortalQueryResult ./PortalUser ../support/apiKeyUtils".split(" "),
function(w,F,c,z,x,I,D,b,J,A,u,d,K,T,U,v,L,M,E,N,B,O,P,Q){function R(m){const l=x.id;return()=>{const g=m.deref();g&&l.findCredential(g.restUrl)&&g.signIn().catch(()=>{})}}const y=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));var q;let C;const G={PortalGroup:()=>new Promise((m,l)=>w(["./PortalGroup"],g=>m(y(g)),l)),PortalItem:()=>new Promise((m,l)=>w(["./PortalItem"],g=>m(y(g)),l)),PortalUser:()=>new Promise((m,l)=>w(["./PortalUser"],g=>m(y(g)),
l))};b=q=function(m){function l(a){a=m.call(this,a)||this;a._esriIdCredentialCreateHandle=null;a.access=null;a.allSSL=!1;a.authMode="auto";a.authorizedCrossOriginDomains=null;a.basemapGalleryGroupQuery=null;a.basemapGalleryGroupQuery3D=null;a.bingKey=null;a.canListApps=!1;a.canListData=!1;a.canListPreProvisionedItems=!1;a.canProvisionDirectPurchase=!1;a.canSearchPublic=!0;a.canShareBingPublic=!1;a.canSharePublic=!1;a.canSignInArcGIS=!1;a.canSignInIDP=!1;a.colorSetsGroupQuery=null;a.commentsEnabled=
!1;a.created=null;a.culture=null;a.customBaseUrl=null;a.defaultBasemap=null;a.defaultDevBasemap=null;a.defaultExtent=null;a.defaultVectorBasemap=null;a.description=null;a.devBasemapGalleryGroupQuery=null;a.eueiEnabled=null;a.featuredGroups=null;a.featuredItemsGroupQuery=null;a.galleryTemplatesGroupQuery=null;a.livingAtlasGroupQuery=null;a.hasCategorySchema=!1;a.helperServices=null;a.homePageFeaturedContent=null;a.homePageFeaturedContentCount=null;a.httpPort=null;a.httpsPort=null;a.id=null;a.ipCntryCode=
null;a.isPortal=!1;a.isReadOnly=!1;a.layerTemplatesGroupQuery=null;a.maxTokenExpirationMinutes=null;a.modified=null;a.name=null;a.portalHostname=null;a.portalMode=null;a.portalProperties=null;a.region=null;a.rotatorPanels=null;a.showHomePageDescription=!1;a.sourceJSON=null;a.supportsHostedServices=!1;a.symbolSetsGroupQuery=null;a.templatesGroupQuery=null;a.units=null;a.url=z.portalUrl;a.urlKey=null;a.user=null;a.use3dBasemaps=!0;a.useStandardizedQuery=!1;a.useVectorBasemaps=!1;a.vectorBasemapGalleryGroupQuery=
null;return a}F._inherits(l,m);var g=l.prototype;g.normalizeCtorArgs=function(a){return"string"===typeof a?{url:a}:a};g.destroy=function(){H.unregister(this);this.defaultBasemap=A.destroyMaybe(this.defaultBasemap);this.defaultDevBasemap=A.destroyMaybe(this.defaultDevBasemap);this.defaultVectorBasemap=A.destroyMaybe(this.defaultVectorBasemap);this._esriIdCredentialCreateHandle=A.removeMaybe(this._esriIdCredentialCreateHandle)};g.readAuthorizedCrossOriginDomains=function(a){if(a)for(const e of a)z.request.trustedServers.includes(e)||
z.request.trustedServers.push(e);return a};g.readDefaultBasemap=function(a){return this._readBasemap(a)};g.readDefaultDevBasemap=function(a){return this._readBasemap(a)};g.readDefaultVectorBasemap=function(a){return this._readBasemap(a)};g.readUrlKey=function(a){return a?a.toLowerCase():a};g.readUser=function(a){let e=null;a&&(e=P.fromJSON(a),e.portal=this);return e};g.load=function(a){const e=(new Promise((f,h)=>w(["../Basemap"],k=>f(y(k)),h))).then(({default:f})=>{u.throwIfAborted(a);C=f}).then(()=>
this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,a)).then(f=>{if(x.id){const h=x.id;this.credential=h.findCredential(this.restUrl);this.credential||this.authMode!==q.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=h.on("credential-create",R(new WeakRef(this))),H.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=f;this.read(f)});this.addResolvingPromise(e);return Promise.resolve(this)};g.createElevationLayers=async function(){await this.load();
const a=this._getHelperService("defaultElevationLayers"),e=(await new Promise((f,h)=>w(["../layers/ElevationLayer"],k=>f(y(k)),h))).default;return a?a.map(f=>new e({id:f.id,url:f.url})):[]};g.fetchBasemaps=async function(a,e){const f=await this._fetchBasemaps(a,e);!0===e?.include3d&&!1!==this.use3dBasemaps&&(a=await this._fetchBasemaps3D(a,e),f.unshift(...a));return f};g.fetchCategorySchema=function(a){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",a).then(e=>
e.categorySchema):u.isAborted(a)?Promise.reject(u.createAbortError()):Promise.resolve([])};g.fetchFeaturedGroups=function(a){const e=this.featuredGroups,f=new B;f.num=100;f.sortField="title";if(e&&e.length){const h=[];for(const k of e)h.push(`(title:"${k.title}" AND owner:${k.owner})`);f.query=h.join(" OR ");return this.queryGroups(f,a).then(k=>k.results)}return u.isAborted(a)?Promise.reject(u.createAbortError()):Promise.resolve([])};g.fetchRegions=function(a){const e=this.user?.culture||this.culture||
E.getLocale();return this.request(this.restUrl+"/portals/regions",{...a,query:{culture:e}})};g.fetchSettings=function(a){const e=this.user?.culture||this.culture||E.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...a,query:{culture:e}})};l.getDefault=function(){return N.ensureDefaultPortalInstance(()=>new q)};g.queryGroups=function(a,e){return this.queryPortal("/community/groups",a,"PortalGroup",e)};g.queryItems=function(a,e){return this.queryPortal("/search",a,"PortalItem",
e)};g.queryUsers=function(a,e){a.sortField||(a.sortField="username");return this.queryPortal("/community/users",a,"PortalUser",e)};g.fetchSelf=function(a=this.authMode,e=!1,f){const h=this.restUrl+"/portals/self";a={authMode:a,query:{culture:E.getLocale().toLowerCase()},...f};"auto"===a.authMode&&(a.authMode="no-prompt");e&&(a.query.default=!0);return this.request(h,a)};g.queryPortal=function(a,e,f,h){const k=K.ensureType(B,e),t=n=>this.request(this.restUrl+a,{...k.toRequestOptions(this),...h}).then(p=>
{const r=k.clone();r.start=p.nextStart;return new O({nextQueryParams:r,queryParams:k,total:p.total,results:q._resultsToTypedArray(n,{portal:this},p,h)})}).then(p=>Promise.all(p.results.map(r=>"function"===typeof r.when?r.when():p)).then(()=>p,r=>{u.throwIfAbortError(r);return p}));return f&&G[f]?G[f]().then(({default:n})=>{u.throwIfAborted(h);return t(n)}):t()};g.signIn=function(){if(this.authMode===q.AUTH_MODE_ANONYMOUS)return Promise.reject(new D("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));
if("failed"===this.loadStatus)return Promise.reject(this.loadError);const a=e=>Promise.resolve().then(()=>{if("not-loaded"===this.loadStatus)return e||(this.authMode="immediate"),this.load().then(()=>null);if("loading"===this.loadStatus)return this.load().then(()=>{if(this.credential)return null;this.credential=e;return this.fetchSelf("immediate")});if(this.user&&this.credential===e)return null;this.credential=e;return this.fetchSelf("immediate")}).then(f=>{f&&(this.sourceJSON=f,this.read(f))});return x.id?
x.id.getCredential(this.restUrl).then(e=>a(e)):a(this.credential)};g.normalizeUrl=function(a){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?a+(a.includes("?")?"\x26":"?")+"token\x3d"+e:a)};g.requestToTypedArray=function(a,e,f){return this.request(a,e).then(h=>{const k=q._resultsToTypedArray(f,{portal:this},h);return Promise.all(k.map(t=>"function"===typeof t.when?t.when():h)).then(()=>k,()=>k)})};g.request=function(a,e={}){const f={f:"json",...e.query},{authMode:h=this.authMode===
q.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:k=null,cacheBust:t=!1,method:n="auto",responseType:p="json",signal:r}=e;e={authMode:h,body:k,cacheBust:t,method:n,query:f,responseType:p,timeout:0,signal:r};return I(this._normalizeSSL(a),e).then(S=>S.data)};g.toJSON=function(){throw new D("internal:not-yet-implemented","Portal.toJSON is not yet implemented");};l.fromJSON=function(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");return new q({sourceJSON:a})};g._getHelperService=
function(a){const e=this.helperServices&&this.helperServices[a];if(!e)throw new D("portal:service-not-found",`The \`helperServices\` do not include an entry named "${a}"`);return e};g._fetchBasemaps=async function(a,e){const f=new B;f.query=a||(z.apiKey&&Q.supportsApiKey(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);f.disableExtraQuery=!0;a=await this.queryGroups(f,e);if(!a.total)return[];a=a.results[0];f.num=100;
f.query='type:"Web Map" -type:"Web Application"';f.sortField=a.sortField||"name";f.sortOrder=a.sortOrder||"desc";e=await a.queryItems(f,e);return e.total?e.results.filter(h=>"Web Map"===h.type).map(h=>new C({portalItem:h})):[]};g._fetchBasemaps3D=async function(a,e){a=a||this.basemapGalleryGroupQuery3D;if(!a)return[];a=new B({query:a,disableExtraQuery:!0});var f=await this.queryGroups(a,e);if(!f.total)return[];f=f.results[0];a.num=100;a.query='type:"Web Scene"';a.sortField=f.sortField||"name";a.sortOrder=
f.sortOrder||"desc";e=await f.queryItems(a,e);return e.total?e.results.filter(h=>"Web Scene"===h.type).map(h=>new C({portalItem:h})):[]};g._normalizeSSL=function(a){return a.replace(/^http:/i,"https:").replace(":7080",":7443")};g._readBasemap=function(a){return a?(a=C.fromJSON(a),a.portalItem={portal:this},a):null};l._resultsToTypedArray=function(a,e,f,h){let k=[];if(f){const t=null!=h?h.signal:null;k=f.listings||f.notifications||f.userInvitations||f.tags||f.items||f.groups||f.comments||f.provisions||
f.results||f.relatedItems||f;if(a||e)k=k.map(n=>{n=Object.assign(a?a.fromJSON(n):n,e);"function"===typeof n.load&&n.load(t);return n})}else k=[];return k};F._createClass(l,[{key:"extraQuery",get:function(){const a=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!a?` AND orgid:${this.id}`:null}},{key:"isOrganization",get:function(){return!!this.access}},{key:"itemPageUrl",get:function(){return this.url?`${this.url}/home/item.html`:null}},{key:"restUrl",get:function(){let a=this.url;
if(a){const e=a.indexOf("/sharing");a=0<e?a.substring(0,e):this.url.replace(/\/+$/,"");a+="/sharing/rest"}return a}},{key:"thumbnailUrl",get:function(){const a=this.restUrl,e=this.thumbnail;return a&&e?this._normalizeSSL(a+"/portals/self/resources/"+e):null}}]);return l}(b.JSONSupportMixin(J));b.AUTH_MODE_ANONYMOUS="anonymous";b.AUTH_MODE_AUTO="auto";b.AUTH_MODE_IMMEDIATE="immediate";c.__decorate([d.property()],b.prototype,"access",void 0);c.__decorate([d.property()],b.prototype,"allSSL",void 0);
c.__decorate([d.property()],b.prototype,"authMode",void 0);c.__decorate([d.property()],b.prototype,"authorizedCrossOriginDomains",void 0);c.__decorate([v.reader("authorizedCrossOriginDomains")],b.prototype,"readAuthorizedCrossOriginDomains",null);c.__decorate([d.property()],b.prototype,"basemapGalleryGroupQuery",void 0);c.__decorate([d.property({json:{name:"3DBasemapGalleryGroupQuery"}})],b.prototype,"basemapGalleryGroupQuery3D",void 0);c.__decorate([d.property()],b.prototype,"bingKey",void 0);c.__decorate([d.property()],
b.prototype,"canListApps",void 0);c.__decorate([d.property()],b.prototype,"canListData",void 0);c.__decorate([d.property()],b.prototype,"canListPreProvisionedItems",void 0);c.__decorate([d.property()],b.prototype,"canProvisionDirectPurchase",void 0);c.__decorate([d.property()],b.prototype,"canSearchPublic",void 0);c.__decorate([d.property()],b.prototype,"canShareBingPublic",void 0);c.__decorate([d.property()],b.prototype,"canSharePublic",void 0);c.__decorate([d.property()],b.prototype,"canSignInArcGIS",
void 0);c.__decorate([d.property()],b.prototype,"canSignInIDP",void 0);c.__decorate([d.property()],b.prototype,"colorSetsGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"commentsEnabled",void 0);c.__decorate([d.property({type:Date})],b.prototype,"created",void 0);c.__decorate([d.property()],b.prototype,"credential",void 0);c.__decorate([d.property()],b.prototype,"culture",void 0);c.__decorate([d.property()],b.prototype,"currentVersion",void 0);c.__decorate([d.property()],b.prototype,"customBaseUrl",
void 0);c.__decorate([d.property()],b.prototype,"defaultBasemap",void 0);c.__decorate([v.reader("defaultBasemap")],b.prototype,"readDefaultBasemap",null);c.__decorate([d.property()],b.prototype,"defaultDevBasemap",void 0);c.__decorate([v.reader("defaultDevBasemap")],b.prototype,"readDefaultDevBasemap",null);c.__decorate([d.property({type:M})],b.prototype,"defaultExtent",void 0);c.__decorate([d.property()],b.prototype,"defaultVectorBasemap",void 0);c.__decorate([v.reader("defaultVectorBasemap")],b.prototype,
"readDefaultVectorBasemap",null);c.__decorate([d.property()],b.prototype,"description",void 0);c.__decorate([d.property()],b.prototype,"devBasemapGalleryGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"eueiEnabled",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"extraQuery",null);c.__decorate([d.property()],b.prototype,"featuredGroups",void 0);c.__decorate([d.property()],b.prototype,"featuredItemsGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"galleryTemplatesGroupQuery",
void 0);c.__decorate([d.property()],b.prototype,"livingAtlasGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"hasCategorySchema",void 0);c.__decorate([d.property()],b.prototype,"helpBase",void 0);c.__decorate([d.property()],b.prototype,"helperServices",void 0);c.__decorate([d.property()],b.prototype,"helpMap",void 0);c.__decorate([d.property()],b.prototype,"homePageFeaturedContent",void 0);c.__decorate([d.property()],b.prototype,"homePageFeaturedContentCount",void 0);c.__decorate([d.property()],
b.prototype,"httpPort",void 0);c.__decorate([d.property()],b.prototype,"httpsPort",void 0);c.__decorate([d.property()],b.prototype,"id",void 0);c.__decorate([d.property()],b.prototype,"ipCntryCode",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"isOrganization",null);c.__decorate([d.property()],b.prototype,"isPortal",void 0);c.__decorate([d.property()],b.prototype,"isReadOnly",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"itemPageUrl",null);c.__decorate([d.property()],
b.prototype,"layerTemplatesGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"maxTokenExpirationMinutes",void 0);c.__decorate([d.property({type:Date})],b.prototype,"modified",void 0);c.__decorate([d.property()],b.prototype,"name",void 0);c.__decorate([d.property()],b.prototype,"portalHostname",void 0);c.__decorate([d.property()],b.prototype,"portalMode",void 0);c.__decorate([d.property()],b.prototype,"portalProperties",void 0);c.__decorate([d.property()],b.prototype,"region",void 0);c.__decorate([d.property({readOnly:!0})],
b.prototype,"restUrl",null);c.__decorate([d.property()],b.prototype,"rotatorPanels",void 0);c.__decorate([d.property()],b.prototype,"showHomePageDescription",void 0);c.__decorate([d.property()],b.prototype,"sourceJSON",void 0);c.__decorate([d.property()],b.prototype,"staticImagesUrl",void 0);c.__decorate([d.property({json:{name:"2DStylesGroupQuery"}})],b.prototype,"stylesGroupQuery2d",void 0);c.__decorate([d.property({json:{name:"stylesGroupQuery"}})],b.prototype,"stylesGroupQuery3d",void 0);c.__decorate([d.property()],
b.prototype,"supportsHostedServices",void 0);c.__decorate([d.property()],b.prototype,"symbolSetsGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"templatesGroupQuery",void 0);c.__decorate([d.property()],b.prototype,"thumbnail",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"thumbnailUrl",null);c.__decorate([d.property()],b.prototype,"units",void 0);c.__decorate([d.property()],b.prototype,"url",void 0);c.__decorate([d.property()],b.prototype,"urlKey",void 0);c.__decorate([v.reader("urlKey")],
b.prototype,"readUrlKey",null);c.__decorate([d.property()],b.prototype,"user",void 0);c.__decorate([v.reader("user")],b.prototype,"readUser",null);c.__decorate([d.property()],b.prototype,"use3dBasemaps",void 0);c.__decorate([d.property()],b.prototype,"useStandardizedQuery",void 0);c.__decorate([d.property()],b.prototype,"useVectorBasemaps",void 0);c.__decorate([d.property()],b.prototype,"vectorBasemapGalleryGroupQuery",void 0);c=b=q=c.__decorate([L.subclass("esri.portal.Portal")],b);const H=new FinalizationRegistry(m=>
{m.remove()});return c});