// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/RandomLCG","../CIMPlacements","../enums"],function(z,A,D,E,y){let B=function(){function m(){}m.local=function(){null===m.instance&&(m.instance=new m);return m.instance};m.prototype.execute=function(v,d,a,c,e){return new F(v,d,a,c,e)};return A._createClass(m)}();B.instance=null;let F=function(){function m(d,a,c,e,b){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=
!1;this._verticalSubdivision=!0;this._stepX=Math.abs(a.stepX??16)*c;this._stepY=Math.abs(a.stepY??16)*c;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=a.gridType??y.PlacementGridType.Fixed;if(this._gridType===y.PlacementGridType.Random)this._randomLCG=new D(1*(a.seed??13)),this._randomness=(a.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=
0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=a.gridAngle??0;this._shiftOddRows=a.shiftOddRows??!1;this._offsetX=(a.offsetX??0)*c;this._offsetY=(a.offsetY??0)*c;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<
-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=e){const [k,g,f,q]=e.split("/");a=parseFloat(k);c=parseFloat(g);e=parseFloat(f);this._graphicOriginX=512*-(parseFloat(q)*2**a+e);this._graphicOriginY=512*c;this._testInsidePolygon=!0}this._internalPlacement=new E.Placement;this._calculateMinMax(d);this._geometryCursor=d}}var v=m.prototype;v.next=function(){return this._geometryCursor?
this._nextInside():null};v._buildRandomValues=function(){if(!m._randValues){m._randValues=[];for(let d=0;24>d;d++)for(let a=0;24>a;a++)m._randValues.push(this._randomLCG.getFloat()),m._randValues.push(this._randomLCG.getFloat())}};v._calculateMinMax=function(d){this._yMax=this._yMin=this._xMax=this._xMin=0;let a,c,e,b,k,g,f,q;a=c=f=k=Number.MAX_VALUE;e=b=q=g=-Number.MAX_VALUE;var r=1!==this._cosAngle;for(d.reset();d.nextPath();)for(;d.nextPoint();){var p=d.x;var l=d.y;var h=p-this._graphicOriginX-
this._offsetX;var t=l-this._graphicOriginY-this._offsetY;if(r){var n=this._cosAngle*h-this._sinAngle*t;h=this._sinAngle*h+this._cosAngle*t}else n=h,h=t;a=Math.min(a,n);e=Math.max(e,n);c=Math.min(c,h);b=Math.max(b,h);k=Math.min(k,l);g=Math.max(g,l);f=Math.min(f,p);q=Math.max(q,p)}k=k!==Number.MAX_VALUE?k:-512-this._stepY;g=g!==-Number.MAX_VALUE?g:this._stepY;f=f!==Number.MAX_VALUE?f:-this._stepX;q=q!==-Number.MAX_VALUE?q:512+this._stepX;this._polygonMin=(this._verticalSubdivision=g-k>=q-f)?k:f;if(this._testInsidePolygon){n=
0-this._graphicOriginX-this._offsetX-this._stepX;l=512-this._graphicOriginX-this._offsetX+this._stepX;p=-512-this._graphicOriginY-this._offsetY-this._stepY;h=0-this._graphicOriginY-this._offsetY+this._stepY;if(r){r=[[n,p],[n,h],[l,p],[l,h]];n=p=Number.MAX_VALUE;l=h=-Number.MAX_VALUE;for(const u of r)r=this._cosAngle*u[0]-this._sinAngle*u[1],t=this._sinAngle*u[0]+this._cosAngle*u[1],n=Math.min(n,r),l=Math.max(l,r),p=Math.min(p,t),h=Math.max(h,t)}a=a!==Number.MAX_VALUE?Math.max(a,n):n;c=c!==Number.MAX_VALUE?
Math.max(c,p):p;e=e!==-Number.MAX_VALUE?Math.min(e,l):l;b=b!==-Number.MAX_VALUE?Math.min(b,h):h}this._xMin=Math.round(a/this._stepX);this._xMax=Math.round(e/this._stepX);this._yMin=Math.round(c/this._stepY);this._yMax=Math.round(b/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(d,f,q,k,g)};v._buildAccelerationMap=function(d,a,c,e,b){d.reset();const k=new Map,g=this._verticalSubdivision;c=g?b-e:c-a;b=Math.ceil(c/10);if(!(1>=b)){c=Math.floor(c/b);b++;
this._delta=c;var f,q;if(g){b=-512-this._stepY;var r=this._stepY;var p=e}else b=-this._stepX,r=512+this._stepX,p=a;for(;d.nextPath();)if(!(2>d.numPoints)&&d.nextPoint()){var l=d.x;for(f=d.y;d.nextPoint();l=a,f=e){a=d.x;e=d.y;if(g){if(f===e||f<b&&e<b||f>r&&e>r)continue;var h=Math.min(f,e);var t=Math.max(f,e)}else{if(l===a||l<b&&a<b||l>r&&a>r)continue;h=Math.min(l,a);t=Math.max(l,a)}for(;h<t;){var n=q=Math.floor((h-p)/c),u=l,w=f,G=a,H=e,C=k;let x=C.get(n);x||(x=[],C.set(n,x));x.push([[u,w],[G,H]]);
h+=c}h=Math.floor((t-p)/c);h>q&&(t=a,n=e,u=k,w=u.get(h),w||(w=[],u.set(h,w)),w.push([[l,f],[t,n]]))}}this._accelerationMap=k}};v._nextInside=function(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var d=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(d+=.5*this._stepX);const a=this._currentY*this._stepY+this._offsetY;this._currentX++;let c;
if(this._gridType===y.PlacementGridType.Random){const e=(this._currentX%24+24)%24,b=(this._currentY%24+24)%24;c=this._graphicOriginX+d+this._stepX*this._randomness*(.5-m._randValues[24*b+e])*2/3;d=this._graphicOriginY+a+this._stepY*this._randomness*(.5-m._randValues[24*b+e+1])*2/3}else c=this._graphicOriginX+this._cosAngle*d+this._sinAngle*a,d=this._graphicOriginY-this._sinAngle*d+this._cosAngle*a;if(!this._testInsidePolygon||this._isInsidePolygon(c,d,this._geometryCursor))return this._internalPlacement.setTranslate(c,
d),this._internalPlacement}};v._isInsidePolygon=function(d,a,c){if(null==this._accelerationMap){var e=0,b;let f;d+=1E-6;a+=1E-6;for(c.reset();c.nextPath();)if(c.nextPoint()){var k=c.x;for(b=c.y;c.nextPoint();k=g,b=f){var g=c.x;f=c.y;b>a!==f>a&&(0<(g-k)*(a-b)-(f-b)*(d-k)?e++:e--)}}return 0!==e}d+=1E-6;a+=1E-6;c=this._verticalSubdivision;b=this._accelerationMap.get(Math.floor(((c?a:d)-this._polygonMin)/this._delta));if(!b)return!1;k=0;for(e of b){b=e[0];g=e[1];if(c){if(b[1]>a===g[1]>a)continue;b=(g[0]-
b[0])*(a-b[1])-(g[1]-b[1])*(d-b[0])}else{if(b[0]>d===g[0]>d)continue;b=(g[1]-b[1])*(d-b[0])-(g[0]-b[0])*(a-b[1])}0<b?k++:k--}return 0!==k};return A._createClass(m)}();z.PlacementInsidePolygon=B;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});