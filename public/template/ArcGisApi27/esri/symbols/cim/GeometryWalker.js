// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../geometry/GeometryCursor","./CurveHelper"],function(h,l,p,n){let q=function(){function f(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}var e=f.prototype;e.isEmpty=function(){return 0===this._values.length};e.size=function(){return this._values.length};e.init=function(c,b,a=!0){this._setEmpty();if(!c||0===c.length)return!1;for(let d=0;d<c.length;d++){let k=Math.abs(c[d]);a&&1E-7>k&&(k=1E-7);this._values.push(k);
this._length+=k}b&&c.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0};e.scale=function(c){const b=this._values?this._values.length:0;for(let a=0;a<b;++a)this._values[a]*=c;this._length*=c;this.extPtGap*=c;this.ctrlPtGap*=c};e.addValue=function(c){this._length+=c;this._values.push(c)};e.firstValue=function(){return this._values[0]};e.lastValue=function(){return this._values[this._values.length-1]};e.nextValue=function(){this._currentValue++;
this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]};e.reset=function(){this._currentValue=-1};e.length=function(){return this._length};e._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0};return l._createClass(f)}(),r=l._createClass(function(){this.pt=null;this.sa=this.ca=0});h.EndType=void 0;(function(f){f[f.FAIL=0]="FAIL";f[f.END=1]="END";f[f.CONTINUE=2]="CONTINUE"})(h.EndType||(h.EndType=
{}));let m=function(){function f(){this.reset()}var e=f.prototype;e.reset=function(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1};e.isValid=function(){return null!==this.segment};e.copyTo=function(c){c.segment=this.segment;c.segmentLength=this.segmentLength;c.abscissa=this.abscissa;c.isPathEnd=this.isPathEnd;c.isPartEnd=this.isPartEnd};return l._createClass(f)}(),u=function(f){function e(b=0,a=!1){b=f.call(this,b,a)||this;b._tolerance=n.PIXEL_TOLERANCE;b._currentPosition=
new m;return b}l._inherits(e,f);var c=e.prototype;c.updateTolerance=function(b){this._tolerance=n.PIXEL_TOLERANCE*b};c.init=function(b,a,d=!0){d?(this._patternLength=a.length(),this._partExtPtGap=a.extPtGap,this._partCtrlPtGap=a.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=b;this._seg=-1;return this._setPosAtNextPart()};c.curPositionIsValid=function(){return this._currentPosition.isValid()};c.nextPosition=
function(b,a=h.EndType.FAIL){const d=new m;if(!this._nextPosition(b,d,null,a))return!1;d.copyTo(this._currentPosition);return!0};c.curPointAndAngle=function(b){b.pt=this._getPoint(this._currentPosition);const [a,d]=this._getAngleCS(this._currentPosition);b.ca=a;b.sa=d};c.nextPointAndAngle=function(b,a,d=h.EndType.FAIL){const k=new m;if(!this._nextPosition(b,k,null,d))return!1;k.copyTo(this._currentPosition);a.pt=this._getPoint(k);const [g,t]=this._getAngleCS(k);a.ca=g;a.sa=t;return!0};c.nextCurve=
function(b){if(0===b)return null;const a=p.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");a.startPath();a.nextPath();const d=new m;if(!this._nextPosition(b,d,a,h.EndType.END))return null;d.copyTo(this._currentPosition);return a};c.isPathEnd=function(){return this._currentPosition.isPathEnd};c.getPathEnd=function(){return this._currentPosition.segment[1]};c.getPt=function(b){this._pathCursor.seekInPath(b);return[this._pathCursor.x,this._pathCursor.y]};c.getSeg=function(b){const a=this.getPt(b);
b=this.getPt(b+1);return[a,b]};c._nextPosition=function(b,a,d,k){if(this._currentPosition.isPathEnd)return!1;var g=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(g/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(a);a.abscissa+b*this._partLengthRatio>a.segmentLength+this._tolerance;)if(d&&(0===d.numPoints&&(0===g?(g=a.segment[0],d.pushXY(g[0],g[1])):d.pushPoint(this.getSegCoord2D(a.segment,g))),g=a.segment[1],d.pushXY(g[0],g[1])),g=0,b-=(a.segmentLength-
a.abscissa)/this._partLengthRatio,this._partSegCount)a.segment=this._nextSegment(),a.segmentLength=this.getSegLength(a.segment),a.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(k===h.EndType.FAIL)return!1;a.segmentLength=this.getSegLength(a.segment);a.isPartEnd=!0;k===h.EndType.END?(a.abscissa=a.segmentLength,a.isPathEnd=!0):a.abscissa=a.segmentLength+b;return!0}this._currentPosition.copyTo(a)}a.abscissa+=b*this._partLengthRatio;d&&(0===d.numPoints&&(0===g?d.pushPoint(a.segment[0]):
d.pushPoint(this.getSegCoord2D(a.segment,g))),b=a.abscissa/a.segmentLength,1===b?d.pushPoint(a.segment[1]):d.pushPoint(this.getSegCoord2D(a.segment,b)));!this._partSegCount&&Math.abs(a.abscissa-a.segmentLength)<this._tolerance&&(a.isPathEnd=this._partIsLast,a.isPartEnd=!0);return!0};c._getPoint=function(b){return this.getSegCoord2D(this._currentPosition.segment,0>=b.segmentLength?0:b.abscissa/b.segmentLength)};c._getAngleCS=function(b){return this.getSegAngleCS(this._currentPosition.segment,0>=b.segmentLength?
0:b.abscissa/b.segmentLength)};c._setPosAtNextPart=function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var b=this._partSegCount;b;)this._previousSegment(),
--b;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;b=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(b);b=b+this._partSegCount+1;b>=this._pathCursor.numPoints&&(b=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(b);if(0<this._patternLength){b=this._ctrlPtBegin?
this._partCtrlPtGap:this._partExtPtGap;const a=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let d=Math.round((this._partLength-(b+a))/this._patternLength);0>=d&&(d=0<b+a?0:1);this._partLengthRatio=this._partLength/(b+a+d*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0};c._hasNextSegment=function(){return this._seg<this._pathCursor.numPoints-2};c._previousSegment=function(){return this.getSeg(--this._seg)};c._nextSegment=function(){return this.getSeg(++this._seg)};
c._getStartPointIndex=function(){return this._seg};c._getEndPointIndex=function(){return this._seg+1};return l._createClass(e)}(n.CurveHelper);h.DashPattern=q;h.GeometryWalker=u;h.Pos=r;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});