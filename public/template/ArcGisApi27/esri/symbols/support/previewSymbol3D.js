// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),function(z,M,N,ha,O,U,V,W,w,A,X,Y,n,B,P,Z){function y(a){const b=a.outline;var d=null!=a.material?a.material.color:null;d=null!=d?d.toHex():null;if(null==b||"pattern"in b&&null!=b.pattern&&"style"===
b.pattern.type&&"none"===b.pattern.style)return"fill"===a.type&&"#ffffff"===d?{color:"#bdc3c7",width:.75}:null;a=w.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,I),style:"pattern"in b&&null!=b.pattern&&"style"===b.pattern.type?A.dekebabifyLineStyle(b.pattern.style):null,join:"butt",cap:"patternCap"in b?b.patternCap:"butt"}}async function aa(a,b){if(a.thumbnail?.url)return a.thumbnail.url;if("icon"===b.type&&b?.resource?.href)return P.getIconHref(b);
b=M.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)&&(a=await Z.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(()=>null))&&"thumbnail"in a&&a.thumbnail?.url?a.thumbnail.url:b}function J(a,b=1){const d=a.a;a=N.toHSV(a);const {r:e,g:u,b:v}=N.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,u,v,d]}function C(a){return"water"===a.type?null==a.color?null:a.color:null==a.material||null==
a.material.color?null:a.material.color}function g(a,b=0){var d=C(a);if(!d){if("fill"===a.type)return null;b=n.adjustColorComponentBrightness(A.defaultThematicColor.r,b);return[b,b,b,100]}a=d.toRgba();for(d=0;3>d;d++)a[d]=n.adjustColorComponentBrightness(a[d],b);return a}async function Q(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:await A.getPatternUrlWithColor(M.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,height:5}}function R(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",
width:1.5}}function S(a,b){a=C(a);if(!a)return null;let d;d="rgba("+(n.adjustColorComponentBrightness(a.r,b)+",");d+=n.adjustColorComponentBrightness(a.g,b)+",";d+=n.adjustColorComponentBrightness(a.b,b)+",";return d+a.a+");"}function K(a,b){b=S(a,b);if(!b)return{};if("pattern"in a&&null!=a.pattern&&"style"===a.pattern.type&&"none"===a.pattern.style)return null;const d=Math.min(a.size?w.pt2px(a.size):.75,I);return{color:b,width:d,style:"pattern"in a&&null!=a.pattern&&"style"===a.pattern.type?A.dekebabifyLineStyle(a.pattern.style):
null,cap:"cap"in a?a.cap:null,join:"join"in a?"miter"===a.join?w.pt2px(2):a.join:null}}function D(a,b,d){d=null!=d?.75*d:0;return{type:"linear",x1:d?.25*d:0,y1:d?.5*d:0,x2:d||4,y2:d?.5*d:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function ba(a){const b=a.depth,d=a.height;a=a.width;return 0!==a&&0!==b&&0!==d&&a===b&&null!=a&&null!=d&&a<d}function ca(a,b,d){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||X.defaultPrimitive){case "circle":e.push({shape:{type:"circle",
cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:y(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:y(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",
values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:R(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:R(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,
0),stroke:y(a)})}break;case "object":switch(a.resource&&a.resource.primitive||Y.defaultPrimitive){case "cone":var u=g(a,0);a=g(a,-.6);a=D(u,a,d?L:b);b=n.getConeShapes(b,d);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":d=g(a,0);a=g(a,-.6);a=D(d,a,b);b=n.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:d});break;case "cube":b=n.getCubeShapes(b,d);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,
-.5)});break;case "cylinder":u=g(a,0);const v=g(a,-.6);u=D(u,v,d?L:b);b=n.getCylinderShapes(b,d);e.push({shape:b[0],fill:u});e.push({shape:b[1],fill:u});e.push({shape:b[2],fill:g(a,0)});break;case "diamond":b=n.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":d=g(a,0);a=g(a,-.6);a=D(d,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},
fill:a});break;case "tetrahedron":b=n.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function E(a){return(a="number"===typeof a?.size?a?.size:null)?w.pt2px(a):null}function da(a,b){const d=E(b),e=b?.maxSize?w.pt2px(b.maxSize):null,u=b?.disableUpsampling??!1,v=a.symbolLayers,q=[];let m=0,r=0;const c=v.at(-1);let l;c&&"icon"===c.type&&(l=c.size&&w.pt2px(c.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var h=
"icon"===f.type?f.size&&w.pt2px(f.size):0,k=d||h?Math.ceil(Math.min(d||h,e||F)):x;if(f&&f.resource&&f.resource.href){var p=aa(a,f).then(t=>{const G=f.get("material.color");var H="icon"===f.type?"multiply":"tint";return B.tintImageWithColor(t,k,G,H,u)}).then(t=>{const G=t.width,H=t.height;m=Math.max(m,G);r=Math.max(r,H);return[{shape:{type:"image",x:0,y:0,width:G,height:H,src:t.url},fill:null,stroke:null}]});q.push(p)}else p=k,"icon"===f.type&&l&&d&&(p=h/l*k),h="tall"===b?.symbolConfig||b?.symbolConfig?.isTall||
("object"===f.type?ba(f):!1),m=Math.max(m,h?L:p),r=Math.max(r,p),q.push(Promise.resolve(ca(f,p,h)))}});return W.eachAlways(q).then(f=>{const h=[];f.forEach(k=>{k.value?h.push(k.value):k.error&&U.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",k.error)});return B.renderSymbol(h,[m,r],{node:b&&b.node,scale:!1,opacity:b&&b.opacity,ariaLabel:b?.ariaLabel})})}function ea(a,b){const d=a.symbolLayers,e=[];a=P.isVolumetricSymbol(a);const u=E(b),v=(b&&b.maxSize?w.pt2px(b.maxSize):
null)||I;let q=0,m=0,r;d.forEach((c,l)=>{if(c&&("line"===c.type||"path"===c.type)){var f=[];switch(c.type){case "line":var h=K(c,0);if(null==h)break;var k=h&&h.width||0;0===l&&(r=k);c=Math.min(u||k,v);l=0===l?c:u?k/r*c:c;k=l>T/2?2*l:T;m=Math.max(m,l);q=Math.max(q,k);h.width=l;f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[q,.5*m]}]},stroke:h});break;case "path":h=Math.min(u||x,v);l=g(c,0);k=g(c,-.2);var p=S(c,-.4);p=p?{color:p,width:1}:{};if("quad"===c.profile){const t=
c.width;c=c.height;c=n.getPathSymbolShapes(t&&c?t/c:1,0===c,0===t);p={...p,join:"bevel"};f.push({shape:c[0],fill:k,stroke:p});f.push({shape:c[1],fill:k,stroke:p});f.push({shape:c[2],fill:l,stroke:p})}else f.push({shape:n.shapes.pathSymbol3DLayer[0],fill:k,stroke:p}),f.push({shape:n.shapes.pathSymbol3DLayer[1],fill:l,stroke:p});q=m=Math.max(m,h)}e.push(f)}});return Promise.resolve(B.renderSymbol(e,[q,m],{node:b&&b.node,scale:a,opacity:b&&b.opacity,ariaLabel:b?.ariaLabel}))}async function fa(a,b){const d=
"mesh-3d"===a.type;a=a.symbolLayers;var e=E(b);const u=b&&b.maxSize?w.pt2px(b.maxSize):null;e=e||x;const v=[];let q=0,m=0;var r=!1;for(let p=0;p<a.length;p++){var c=a.at(p);const t=[];if(!d||"fill"===c.type){var l=n.shapes.fill[0];switch(c.type){case "fill":var f=y(c);r=Math.min(e,u||F);q=Math.max(q,r);m=Math.max(m,r);r=!0;var h=g(c,0),k="pattern"in c?c.pattern:null;c=C(c);!d&&null!=k&&"style"===k.type&&"solid"!==k.style&&c&&(h=await Q(k,c));t.push({shape:l,fill:h,stroke:f});break;case "line":c=K(c,
0);if(null==c)break;c={stroke:c,shape:l};q=Math.max(q,x);m=Math.max(m,x);t.push(c);break;case "extrude":l={join:"round",width:1,...K(c,-.4)};f=g(c,0);c=g(c,-.2);h=Math.min(e,u||F);k=n.getExtrudeSymbolShapes(h);l.width=1;t.push({shape:k[0],fill:c,stroke:l});t.push({shape:k[1],fill:c,stroke:l});t.push({shape:k[2],fill:f,stroke:l});c=.7*x+.5*h;q=Math.max(q,x);m=Math.max(m,c);break;case "water":r=V.unwrapOrThrow(C(c)),c=J(r),l=J(r,2),f=J(r,3),h=n.getWaterSymbolShapes(),r=!0,t.push({shape:h[0],fill:c}),
t.push({shape:h[1],fill:l}),t.push({shape:h[2],fill:f}),c=Math.min(e,u||F),q=Math.max(q,c),m=Math.max(m,c)}v.push(t)}}return B.renderSymbol(v,[q,m],{node:b&&b.node,scale:r,opacity:b&&b.opacity,ariaLabel:b?.ariaLabel})}const x=n.SymbolSizeDefaults.size,F=n.SymbolSizeDefaults.maxSize,I=n.SymbolSizeDefaults.maxOutlineSize,T=n.SymbolSizeDefaults.lineWidth,L=n.SymbolSizeDefaults.tallSymbolWidth;z.getPatternDescriptor=Q;z.getSizeFromOptions=E;z.getSymbolLayerFill=g;z.previewSymbol3D=function(a,b){if(0===
a.symbolLayers.length)return Promise.reject(new O("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(a.type){case "point-3d":return da(a,b);case "line-3d":return ea(a,b);case "polygon-3d":case "mesh-3d":return fa(a,b)}return Promise.reject(new O("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});