// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../core/screenUtils ../cim/CIMSymbolHelper ../cim/CIMSymbolRasterizer ../cim/utils ./previewUtils ./renderUtils".split(" "),function(r,h,k,p,y,q,z){const l=new p.CIMSymbolRasterizer(null,!0),m=h.px2pt(q.SymbolSizeDefaults.size),t=h.px2pt(q.SymbolSizeDefaults.maxSize),A=h.px2pt(q.SymbolSizeDefaults.lineWidth);r.previewCIMSymbol=async function(b,f={}){const {node:u,opacity:v,symbolConfig:n}=f;var g=null!=n&&"object"===typeof n&&"isSquareFill"in n?n.isSquareFill:!1,d=f.cimOptions||
f,c=d.geometryType||y.mapCIMSymbolToGeometryType(b?.data?.symbol);var a=f?.size;a="number"===typeof a?{width:a,height:a}:{width:null!=a&&"object"===typeof a&&"width"in a?a.width:null,height:null!=a&&"object"===typeof a&&"height"in a?a.height:null};const {feature:w,fieldMap:x}=d;if(null==a.width||null==a.height){d=await k.OverrideHelper.resolveSymbolOverrides(b.data,w,null,x,c);if(!d)return null;b=b.clone();b.data={type:"CIMSymbolReference",symbol:d};b.data.primitiveOverrides=void 0;var e=[];k.CIMSymbolHelper.fetchResources(d,
l.resourceManager,e);k.CIMSymbolHelper.fetchFonts(d,l.resourceManager,e);0<e.length&&await Promise.all(e);e=k.CIMSymbolHelper.getEnvelope(d,null,l.resourceManager);d=e?.width;e=e?.height;a.width="esriGeometryPolygon"===c?m:"esriGeometryPolyline"===c?A:null!=d&&isFinite(d)?Math.min(d,t):m;a.height="esriGeometryPolygon"===c?m:null!=e&&isFinite(e)?Math.max(Math.min(e,t),1):m}g=await l.rasterizeCIMSymbolAsync(b,w,a,g||"esriGeometryPolygon"!==c?p.GeometryStyle.Preview:p.GeometryStyle.Legend,x,c);if(!g)return null;
const {width:B,height:C}=g;b=document.createElement("canvas");b.width=B;b.height=C;b.getContext("2d").putImageData(g,0,0);g=h.pt2px(a.width);a=h.pt2px(a.height);c=new Image(g,a);c.src=b.toDataURL();c.ariaLabel=f.ariaLabel??null;c.alt=f.ariaLabel??"";null!=v&&(c.style.opacity=`${v}`);b=c;null!=f.effectView&&(b=z.renderSymbol([[{shape:{type:"image",x:0,y:0,width:g,height:a,src:c.src},fill:null,stroke:null,offset:[0,0]}]],[g,a],{effectView:f.effectView,ariaLabel:f.ariaLabel}));u&&b&&u.appendChild(b);
return b};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});