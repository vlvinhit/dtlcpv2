// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../core/has ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils ../../widgets/Legend/styles/support/relationshipUtils ../../widgets/Legend/support/relationshipRampUtils".split(" "),function(u,t,I,z,D,E,A,q,F,G){function H(a,b){if(b&&(a.style.filter=q.getCSSFilterFromEffectList(b),b=b.effects))for(const c of b)if("drop-shadow"===c?.type){0>c.offsetX?a.style.marginLeft=`${Math.abs(c.offsetX)}px`:a.style.marginRight=`${c.offsetX}px`;break}}async function B(a,
b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=await new Promise((e,d)=>u(["./previewWebStyleSymbol"],e,d));return c(a,B,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=await new Promise((e,d)=>u(["./previewSymbol3D"],e,d)),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=await new Promise((e,d)=>u(["./previewSymbol2D"],e,d)),
c(a,b);case "cim":return{previewCIMSymbol:c}=await new Promise((e,d)=>u(["./previewCIMSymbol"],e,d)),c(a,b)}}function x(a){return a&&"opacity"in a?a.opacity*x(a.parent):1}let v=null;const C=[255,255,255];t.getDisplayedColor=async function(a,b){if(a){var c=x(a.layer||a.sourceLayer);if(null!=a.symbol&&(null==b||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await q.fetchWebStyleSymbol(a.symbol,b):a.symbol.clone(),q.getColorFromSymbol(a,c);var e=null!=b&&b.renderer||a.get("layer.renderer")||
a.get("sourceLayer.renderer"),d=await e.getSymbolAsync(a,b);if(d){d="web-style"===d.type?await q.fetchWebStyleSymbol(d,b):d.clone();d=q.getColorFromSymbol(d,c);if(!("visualVariables"in e)||"visualVariables"in e&&!e.visualVariables||"visualVariables"in e&&!e.visualVariables?.length)return d;!e.arcadeRequiredForVisualVariables||null!=b&&null!=b.arcade||(b={...b},b.arcade=await z.loadArcade());var {getColor:m,getOpacity:g}=await new Promise((k,f)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],
k,f)),h=[],l=[];for(const k of e.visualVariables)switch(k.type){case "color":h.push(k);break;case "opacity":l.push(k)}e=(e=0<h.length?h[h.length-1]:null)?m(e,a,b):d;a=(d=0<l.length?l[l.length-1]:null)?g(d,a,b):null;null!=c&&(a=null!=a?a*c:c);return e?q.applyOpacityToColor(e,a):null}}};t.getDisplayedSymbol=async function(a,b){if(a){var c=a.sourceLayer,e=(null!=b&&(b.useSourceLayer??!1)?c:a.layer)??c;c=x(e);if(null!=a.symbol&&(null==b||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?
await q.fetchWebStyleSymbol(a.symbol,{...b,cache:null!=b?b.webStyleCache:null}):a.symbol.clone(),q.applyColorToSymbol(a,null,c),a;var d=(null!=b?b.renderer:null)??(e&&"renderer"in e?e.renderer:null);if(e=d&&"getSymbolAsync"in d?await d.getSymbolAsync(a,b):null){e="web-style"===e.type?await e.fetchSymbol({...b,cache:null!=b?b.webStyleCache:null}):e.clone();if(!(d&&"visualVariables"in d&&d.visualVariables&&d.visualVariables.length))return q.applyColorToSymbol(e,null,c),e;"arcadeRequiredForVisualVariables"in
d&&d.arcadeRequiredForVisualVariables&&(null==b||null==b.arcade)&&(b={...b},b.arcade=await z.loadArcade());var {getColor:m,getOpacity:g,getAllSizes:h,getRotationAngle:l}=await new Promise((w,y)=>u(["../../renderers/visualVariables/support/visualVariableUtils"],w,y)),k=[],f=[],n=[],p=[];for(var r of d.visualVariables)switch(r.type){case "color":k.push(r);break;case "opacity":f.push(r);break;case "rotation":p.push(r);break;case "size":r.target||n.push(r)}r=(r=!!k.length&&k[k.length-1])?m(r,a,b):null;
f=(f=!!f.length&&f[f.length-1])?g(f,a,b):null;null!=c&&(f=null!=f?f*c:c);q.applyColorToSymbol(e,r,f);n.length&&(c=h(n,a,b),await q.applySizesToSymbol(e,c));for(const w of p)q.applyRotationToSymbol(e,l(w,a,b),w.axis);return e}}};t.renderColorRampPreviewHTML=function(a,b={}){var c="horizontal"===b.align;const e=b.width??(c?75:24),d=b.height??(c?24:75);var m=b.gradient??!0,g=window.devicePixelRatio,h=e*g,l=d*g;g=document.createElement("canvas");g.width=h;g.height=l;g.ariaLabel=b.ariaLabel??null;g.style.width=
`${e}px`;g.style.height=`${d}px`;const k=g.getContext("2d");var f=c?h:0;const n=c?0:l;if(m){const p=k.createLinearGradient(0,0,f,n);c=a.length;const r=1===c?0:1/(c-1);a.forEach((w,y)=>p.addColorStop(y*r,w.toString()));k.fillStyle=p;k.fillRect(0,0,h,l)}else{h=c?h/a.length:h;l=c?l:l/a.length;f=m=0;for(const p of a)k.fillStyle=p.toString(),k.fillRect(m,f,h,l),m=c?m+h:0,f=c?0:f+l}a=document.createElement("div");a.style.width=`${e}px`;a.style.height=`${d}px`;H(a,b?.effectList);a.appendChild(g);return a};
t.renderDotDensityPreviewHTML=function(a,b,c){const {backgroundColor:e,outline:d,dotSize:m}=a;var g=c&&c.swatchSize||E.SymbolSizeDefaults.size;const h=Math.round(g*g/m**2*.8),l=window.devicePixelRatio;a=document.createElement("canvas");const k=g*l;a.width=k;a.height=k;a.style.width=`${a.width/l}px`;a.style.height=`${a.height/l}px`;const f=a.getContext("2d");e&&(f.fillStyle=e.toCss(!0),f.fillRect(0,0,k,k),f.fill());f.fillStyle=b?.toCss(!0)??"";if(v&&v.length/2===h)for(b=0;b<2*h;b+=2)f.fillRect(v[b],
v[b+1],m*l,m*l),f.fill();else for(v=[],b=0;b<2*h;b+=2){const n=Math.floor(Math.random()*(k-0+1)),p=Math.floor(Math.random()*(k-0+1));v.push(n,p);f.fillRect(n,p,m*l,m*l);f.fill()}d&&(d.color&&(f.strokeStyle=d.color.toCss(!0)),f.lineWidth=d.width,f.strokeRect(0,0,k,k));g=new Image(g,g);g.src=a.toDataURL();g.ariaLabel=c?.ariaLabel??null;g.alt=c?.ariaLabel??"";return g};t.renderPieChartPreviewHTML=function(a,b={}){const c=b.radius||40;var e=2*Math.PI*c,d=a.length;const m=e/d,g=[],h=D.getStroke(b.outline);
null!=h?.width&&(h.width*=2);(h||b.backgroundColor)&&g.push({shape:{type:"circle",cx:c,cy:c,r:c},fill:b.backgroundColor,stroke:h,offset:[0,0]});const l=b.values,k=l&&l.length===d&&100===l.reduce((n,p)=>n+p,0),f=[0];for(let n=0;n<d;n++){let p=null;k&&(p=l[n]*e/100,f.push(p+f[n]));g.push({shape:{type:"circle",cx:c,cy:c,r:c/2},fill:[0,0,0,0],stroke:{width:c,dashArray:`${(p??m)/2} ${e}`,dashoffset:`-${k?f[n]/2:m/2*n}`,color:a[n]},offset:[0,0]})}d=null;a=2*c+(h?.width||0);if(e=b.holePercentage)h&&g.push({shape:{type:"circle",
cx:c,cy:c,r:c*e},fill:null,stroke:h,offset:[0,0]}),d=a/2,d=[[{shape:{type:"circle",cx:d,cy:d,r:d},fill:C,stroke:h?{...h,color:C}:null,offset:[0,0]},{shape:{type:"circle",cx:d,cy:d,r:c*e},fill:[0,0,0],stroke:null,offset:[0,0]}]];return A.renderSymbol([g],[a,a],{effectView:b.effectList,ignoreStrokeWidth:!0,masking:d,rotation:-90,ariaLabel:b.ariaLabel})};t.renderPreviewHTML=B;t.renderRelationshipRampPreviewHTML=function(a,b={}){const c=a?.authoringInfo;if("relationship"!==c?.type||!c?.numClasses||!a.uniqueValueInfos)return null;
const {focus:e,numClasses:d}=c,m=G.getRelationshipRampElement({focus:e,numClasses:d,infos:a.uniqueValueInfos});a=b&&b.node||document.createElement("div");A.renderOnce(a,()=>F.renderRelationshipRamp(m,b.id||"relationship",{opacity:b.opacity||1,effectList:b.effectList,ariaLabel:b.ariaLabel}));return a};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});