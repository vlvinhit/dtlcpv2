// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../chunks/_rollupPluginBabelHelpers ../geometry ../core/Error ../core/Logger ../geometry/SpatialReference".split(" "),function(A,k,B,r,C,D,E){function x(){t||(t=(async()=>{const b=await new Promise((e,a)=>A(["./arcadeUtils"],e,a));return{arcade:b.arcade,arcadeUtils:b,Dictionary:b.Dictionary,Feature:b.arcadeFeature}})());return t}const F=D.getLogger("esri.support.arcadeOnDemand");let t;r=(b,e,a)=>n.create(b,e,a,null,["$feature","$view"],[]);let n=function(){function b(a,g,u,
m,h,f,c){this.services=null;this.script=a;this.evaluate=m;this.fields=Array.isArray(f)?f:f.fields;this._syntaxTree=u;this._arcade=g;this._arcadeFeature=h;this._spatialReference=c;this._referencesGeometry=g.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}b.create=async function(a,g,u,m,h,f){const {arcade:c,Feature:G,Dictionary:y}=await x(),v=E.fromJSON(g);let l;try{l=c.parseScript(a,f)}catch(d){return F.error(new C("arcade-bad-expression",
"Failed to parse arcade script",{script:a,error:d})),null}h=h.reduce((d,w)=>({...d,[w]:null}),{});let p=null;null!=m&&(p=new y(m),p.immutable=!0,h.$config=null);f=(m=c.scriptUsesGeometryEngine(l))&&c.enableGeometrySupport();const H=c.scriptUsesFeatureSet(l)&&c.enableFeatureSetSupport(),z=(g=c.scriptIsAsync(l))&&c.enableAsyncSupport();h={vars:h,spatialReference:v,useAsync:!!z};await Promise.all([f,H,z]);f=new Set;await c.loadDependentModules(f,l,null,g,m);const q=new y;q.immutable=!1;q.setField("scale",
0);const I=c.compileScript(l,h);return new b(a,c,l,(d,w)=>{"$view"in d&&d.$view&&(q.setField("scale","object"===typeof d.$view&&"scale"in d.$view?d.$view.scale:void 0),d.$view=q);p&&(d.$config=p);return I({vars:d,spatialReference:v,services:w})},new G,u,v)};var e=b.prototype;e.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,a.attributes,{fields:this.fields});return this._arcadeFeature};
e.referencesGeometry=function(){return this._referencesGeometry};e.referencesScale=function(){return this._referencesScale};return B._createClass(b)}();k.ArcadeExpression=n;k.createDictionaryExpression=(b,e,a,g)=>n.create(b,e,a,g,["$feature","$view"],[]);k.createLabelExpression=(b,e,a)=>n.create(b,e,a,null,["$feature"],[]);k.createRendererExpression=r;k.createVVExpression=r;k.loadArcade=x;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});