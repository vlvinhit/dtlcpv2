// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../executionError","../../chunks/languageUtils","./fieldStats","../../core/sql/WhereClause"],function(l,m,g,k,n){async function h(b,c,d,a,f,e){if(1===a.length){if(g.isArray(a[0]))return k.calculateStat(b,a[0],g.defaultUndefined(a[1],-1));if(g.isImmutableArray(a[0]))return k.calculateStat(b,a[0].toArray(),g.defaultUndefined(a[1],-1))}else if(2===a.length){if(g.isArray(a[0]))return k.calculateStat(b,a[0],g.defaultUndefined(a[1],-1));if(g.isImmutableArray(a[0]))return k.calculateStat(b,
a[0].toArray(),g.defaultUndefined(a[1],-1));if(g.isFeatureSet(a[0]))return d=await a[0].load(),f=await p(n.WhereClause.create(a[1],d.getFieldsIndex()),e,f),a[0].calculateStatistic(b,f,g.defaultUndefined(a[2],1E3),c.abortSignal)}else if(3===a.length&&g.isFeatureSet(a[0]))return d=await a[0].load(),f=await p(n.WhereClause.create(a[1],d.getFieldsIndex()),e,f),a[0].calculateStatistic(b,f,g.defaultUndefined(a[2],1E3),c.abortSignal);return k.calculateStat(b,a,-1)}async function p(b,c,d){const a=b.getVariables();
if(0<a.length){const f=[];for(let e=0;e<a.length;e++)f.push(await c.evaluateIdentifier(d,{name:a[e]}));c={};for(d=0;d<a.length;d++)c[a[d]]=f[d];b.parameters=c}return b}l.registerFunctions=function(b){"async"===b.mode&&(b.functions.stdev=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("stdev",a,f,e,c,b))},b.functions.variance=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("variance",a,f,e,c,b))},b.functions.average=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>
h("mean",a,f,e,c,b))},b.functions.mean=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("mean",a,f,e,c,b))},b.functions.sum=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("sum",a,f,e,c,b))},b.functions.min=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("min",a,f,e,c,b))},b.functions.max=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>h("max",a,f,e,c,b))},b.functions.count=function(c,d){return b.standardFunctionAsync(c,d,(a,f,e)=>{g.pcCheck(e,1,1,c,d);
if(g.isFeatureSet(e[0]))return e[0].count(a.abortSignal);if(g.isArray(e[0])||g.isString(e[0]))return e[0].length;if(g.isImmutableArray(e[0]))return e[0].length();throw new m.ArcadeExecutionError(c,m.ExecutionErrorCodes.InvalidParameter,d);})})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});