// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../sources/Empty ../support/errorsupport ../support/FeatureSet ../support/IdSet ../support/shared ../../../geometry/geometryEngineAsync".split(" "),function(r,k,t,h,p,m,l){return function(u){function f(a){var b=u.call(this,a)||this;b._relation="";b._relationGeom=null;b._relationString="";b.declaredClass="esri.arcade.featureset.actions.SpatialFilter";b._relationString=a.relationString;b._parent=a.parentfeatureset;b._maxProcessing=40;b._relation=a.relation;
b._relationGeom=a.relationGeom;return b}r._inherits(f,u);var g=f.prototype;g._getSet=async function(a){if(null===this._wset){await this._ensureLoaded();const b=await this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,null,null,a);this._checkCancelled(a);this._wset=new p(b._candidates.slice(0),b._known.slice(0),b._ordered,this._clonePageDefinition(b.pagesDefinition))}return this._wset};g._isInFeatureSet=function(a){let b=
this._parent._isInFeatureSet(a);if(b===m.IdState.NotInFeatureSet)return b;b=this._idstates[a];return void 0===b?m.IdState.Unknown:b};g._getFeature=function(a,b,c){return this._parent._getFeature(a,b,c)};g._getFeatures=function(a,b,c,e){return this._parent._getFeatures(a,b,c,e)};g._featureFromCache=function(a){return this._parent._featureFromCache(a)};g.executeSpatialRelationTest=async function(a){if(null===a.geometry)return!1;switch(this._relation){case "esriSpatialRelEnvelopeIntersects":return l.intersects(m.shapeExtent(this._relationGeom),
m.shapeExtent(a.geometry));case "esriSpatialRelIntersects":return l.intersects(this._relationGeom,a.geometry);case "esriSpatialRelContains":return l.contains(this._relationGeom,a.geometry);case "esriSpatialRelOverlaps":return l.overlaps(this._relationGeom,a.geometry);case "esriSpatialRelWithin":return l.within(this._relationGeom,a.geometry);case "esriSpatialRelTouches":return l.touches(this._relationGeom,a.geometry);case "esriSpatialRelCrosses":return l.crosses(this._relationGeom,a.geometry);case "esriSpatialRelRelation":return l.relate(this._relationGeom,
a.geometry,this._relationString??"")}};g._fetchAndRefineFeatures=async function(a,b,c){var e=new p([],a,!1,null),d=Math.min(b,a.length);await this._parent?._getFeatures(e,-1,d,c);this._checkCancelled(c);c=[];for(e=0;e<d;e++){const n=this._parent._featureFromCache(a[e]);c.push(await this.executeSpatialRelationTest(n))}for(d=0;d<b;d++)this._idstates[a[d]]=!0===c[d]?m.IdState.InFeatureSet:m.IdState.NotInFeatureSet;return"success"};g._getFilteredSet=async function(a,b,c,e,d){await this._ensureLoaded();
a=await this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,c,e,d);this._checkCancelled(d);return null!==b?new p(a._candidates.slice(0).concat(a._known.slice(0)),[],a._ordered,this._clonePageDefinition(a.pagesDefinition)):new p(a._candidates.slice(0),a._known.slice(0),a._ordered,this._clonePageDefinition(a.pagesDefinition))};g._stat=async function(a,b,c,e,d,n,q){if(""!==c)return{calculated:!1};const v=await this._parent._stat(a,
b,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,d,n,q);return!1===v.calculated?null===d&&""===c&&null===e?this._manualStat(a,b,n,q):{calculated:!1}:v};g._canDoAggregates=async function(a,b,c,e,d){return""!==c||null!==e||null===this._parent?!1:this._parent._canDoAggregates(a,b,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,d)};g._getAggregatePagesDataSourceDefinition=
async function(a,b,c,e,d,n,q){if(null===this._parent)throw new t.FeatureSetError(t.FeatureSetErrorCodes.NeverReach);return this._parent._getAggregatePagesDataSourceDefinition(a,b,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,d,n,q)};f.registerAction=function(){h._featuresetFunctions.intersects=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelIntersects",
relationGeom:a})};h._featuresetFunctions.envelopeIntersects=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:a})};h._featuresetFunctions.contains=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:a})};h._featuresetFunctions.overlaps=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):
new f({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:a})};h._featuresetFunctions.within=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:a})};h._featuresetFunctions.touches=function(a){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:a})};h._featuresetFunctions.crosses=function(a){return null===a||
void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:a})};h._featuresetFunctions.relate=function(a,b){return null===a||void 0===a?new k({parentfeatureset:this}):new f({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:a,relationString:b})}};return r._createClass(f)}(h)});