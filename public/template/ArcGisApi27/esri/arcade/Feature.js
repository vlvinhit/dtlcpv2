// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ./Dictionary ./ImmutableArray ../chunks/languageUtils ../geometry/Geometry ../geometry/Point ../geometry/support/jsonUtils ../layers/graphics/featureConversionUtils ./ArcadeDate ./executionError ./arcadeTimeUtils ./deepClone".split(" "),function(w,q,n,h,r,t,p,x,l,m,u,y){let v=function(){function g(){this.arcadeDeclaredClass="esri.arcade.Feature";this._layer=this.attributes=this._geometry=this._optimizedGeomDefinition=null;this._datesfixed=!0;this.contextTimeReference=
this.dateTimeReferenceFieldIndex=null;this.immutable=!0;this._datefields=null;this.immutable=!0}g.createFromGraphic=function(a,b){const c=new g;c.contextTimeReference=b??null;c._geometry=null!=a.geometry?a.geometry:null;c.attributes=void 0===a.attributes?{}:null===a.attributes?{}:a.attributes;a._sourceLayer?(c._layer=a._sourceLayer,c._datesfixed=!1):a._layer?(c._layer=a._layer,c._datesfixed=!1):a.layer&&"fields"in a.layer?(c._layer=a.layer,c._datesfixed=!1):a.sourceLayer&&"fields"in a.sourceLayer&&
(c._layer=a.sourceLayer,c._datesfixed=!1);c._layer&&!1===c._datesfixed&&(c.dateTimeReferenceFieldIndex=void 0!==c._layer.dateTimeReferenceFieldIndex?c._layer.dateTimeReferenceFieldIndex:u.DateTimeReferenceFieldIndex.createFromLayer(c._layer));return c};g.createFromArcadeFeature=function(a){if(a instanceof g){var b=new g;b._datesfixed=a._datesfixed;b.attributes=a.attributes;b._geometry=a._geometry;b._optimizedGeomDefinition=a._optimizedGeomDefinition;a._layer&&(b._layer=a._layer);b.dateTimeReferenceFieldIndex=
a.dateTimeReferenceFieldIndex;b.contextTimeReference=a.contextTimeReference;return b}b={};for(const c of a.keys())b[c]=a.field(c);return g.createFromGraphicLikeObject(a.geometry(),b,a.fullSchema(),a.contextTimeReference)};g.createFromOptimisedFeature=function(a,b,c){const d=new g;d._geometry=a.geometry?{geometry:a.geometry}:null;d._optimizedGeomDefinition=c;d.attributes=a.attributes||{};d._layer=b;d._datesfixed=!1;return d};g.createFromArcadeDictionary=function(a){const b=new g;b.attributes=a.field("attributes");
null!==b.attributes?b.attributes instanceof q?(b.attributes=b.attributes.attributes,null===b.attributes&&(b.attributes={})):b.attributes={}:b.attributes={};b._geometry=a.field("geometry");null!==b._geometry&&(b._geometry instanceof q?b._geometry=g.parseGeometryFromDictionary(b._geometry):b._geometry instanceof r||(b._geometry=null));return b};g.createFromGraphicLikeObject=function(a,b,c=null,d){const e=new g;e.contextTimeReference=d??null;null===b&&(b={});e.attributes=b;e._geometry=null!=a?a:null;
e._layer=c;e._layer&&(e._datesfixed=!1,e.dateTimeReferenceFieldIndex=void 0!==e._layer.dateTimeReferenceFieldIndex?e._layer.dateTimeReferenceFieldIndex:u.DateTimeReferenceFieldIndex.createFromLayer(e._layer));return e};var k=g.prototype;k.repurposeFromGraphicLikeObject=function(a,b,c=null){null===b&&(b={});this.attributes=b;this._geometry=a??null;this._datesfixed=(this._layer=c)?!1:!0};k.fieldSourceTimeZone=function(a){return this.dateTimeReferenceFieldIndex?.fieldTimeZone(a)??""};k.castToText=function(a=
!1){let b="";!1===this._datesfixed&&this._fixDates();for(const c in this.attributes){""!==b&&(b+=",");const d=this.attributes[c];null==d?b+=JSON.stringify(c)+":null":h.isBoolean(d)||h.isNumber(d)||h.isString(d)?b+=JSON.stringify(c)+":"+JSON.stringify(d):d instanceof r?b+=JSON.stringify(c)+":"+h.toStringExplicit(d):d instanceof n?b+=JSON.stringify(c)+":"+h.toStringExplicit(d,null,a):d instanceof Array?b+=JSON.stringify(c)+":"+h.toStringExplicit(d,null,a):d instanceof l.ArcadeDate?b=a?b+(JSON.stringify(c)+
":"+JSON.stringify(d.getTime())):b+(JSON.stringify(c)+":"+d.stringify()):null!==d&&"object"===typeof d&&void 0!==d.castToText&&(b+=JSON.stringify(c)+":"+d.castToText(a))}return'{"geometry":'+(null===this.geometry()?"null":h.toStringExplicit(this.geometry()))+',"attributes":{'+b+"}}"};k._fixDates=function(){if(null!==this._datefields)0<this._datefields.length&&this._fixDateFields(this._datefields);else{var a=[],b=this._layer.fields;for(let c=0;c<b.length;c++){const d=b[c],e=d.type;"date"!==e&&"esriFieldTypeDate"!==
e||a.push(d.name)}this._datefields=a;0<a.length&&this._fixDateFields(a)}this._datesfixed=!0};k.isUnknownDateTimeField=function(a){return"unknown"===this.dateTimeReferenceFieldIndex?.fieldTimeZone(a)};k._fixDateFields=function(a){this.attributes={...this.attributes};const b=this.contextTimeReference?.timeZone??"system";for(let d=0;d<a.length;d++){let e=this.attributes[a[d]];if(null!==e)if(void 0===e)for(const f in this.attributes){if(f.toLowerCase()===a[d].toLowerCase()){e=this.attributes[f];if(null!==
e){var c=this.isUnknownDateTimeField(f);h.isDate(e)?this.attributes[f]=e:this.attributes[f]=e instanceof Date?c?l.ArcadeDate.unknownDateJSToArcadeDate(e):l.ArcadeDate.dateJSAndZoneToArcadeDate(e,b):c?l.ArcadeDate.unknownEpochToArcadeDate(e):l.ArcadeDate.epochToArcadeDate(e,b)}break}}else c=this.isUnknownDateTimeField(a[d]),h.isDate(e)?this.attributes[a[d]]=e:this.attributes[a[d]]=e instanceof Date?c?l.ArcadeDate.unknownDateJSToArcadeDate(e):l.ArcadeDate.dateJSAndZoneToArcadeDate(e,b):c?l.ArcadeDate.unknownEpochToArcadeDate(e):
l.ArcadeDate.epochToArcadeDate(e,b)}};k.geometry=function(){if(null===this._geometry||this._geometry instanceof r)return this._geometry;this._optimizedGeomDefinition?(this._geometry=p.fromJSON(x.convertToGeometry(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=p.fromJSON(this._geometry);return this._geometry};k.field=function(a){!1===
this._datesfixed&&this._fixDates();var b=this.attributes[a];if(void 0!==b)return b;b=a.toLowerCase();for(const c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];if(this._hasFieldDefinition(b))return null;throw new m.ArcadeExecutionError(null,m.ExecutionErrorCodes.FieldNotFound,null,{key:a});};k._hasFieldDefinition=function(a){if(null===this._layer)return!1;for(let b=0;b<this._layer.fields.length;b++)if(this._layer.fields[b].name.toLowerCase()===a)return!0;return!1};k.setField=
function(a,b){if(this.immutable)throw new m.ArcadeExecutionError(null,m.ExecutionErrorCodes.Immutable,null);b instanceof Date&&(b=this.isUnknownDateTimeField(a)?l.ArcadeDate.unknownDateJSToArcadeDate(b):l.ArcadeDate.dateJSToArcadeDate(b));if(!1===h.isSimpleType(b))throw new m.ArcadeExecutionError(null,m.ExecutionErrorCodes.TypeNotAllowedInFeature,null);const c=a.toLowerCase();if(void 0===this.attributes[a])for(const d in this.attributes)if(d.toLowerCase()===c){this.attributes[d]=b;return}this.attributes[a]=
b};k.hasField=function(a){const b=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(const c in this.attributes)if(c.toLowerCase()===b)return!0;return this._hasFieldDefinition(b)?!0:!1};k.keys=function(){let a=[];const b={};for(var c in this.attributes)a.push(c),b[c.toLowerCase()]=1;if(null!==this._layer)for(c=0;c<this._layer.fields.length;c++){const d=this._layer.fields[c];1!==b[d.name.toLowerCase()]&&a.push(d.name)}return a=a.sort()};g.parseGeometryFromDictionary=function(a){a=g._convertDictionaryToJson(a,
!0);void 0!==a.hasm&&(a.hasM=a.hasm,delete a.hasm);void 0!==a.hasz&&(a.hasZ=a.hasz,delete a.hasz);void 0!==a.spatialreference&&(a.spatialReference=a.spatialreference,delete a.spatialreference);void 0!==a.rings&&(a.rings=this._fixPathArrays(a.rings,!0===a.hasZ,!0===a.hasZ));void 0!==a.paths&&(a.paths=this._fixPathArrays(a.paths,!0===a.hasZ,!0===a.hasM));void 0!==a.points&&(a.points=this._fixPointArrays(a.points,!0===a.hasZ,!0===a.hasM));return p.fromJSON(a)};g._fixPathArrays=function(a,b,c){const d=
[];if(a instanceof Array)for(var e=0;e<a.length;e++)d.push(this._fixPointArrays(a[e],b,c));else if(a instanceof n)for(e=0;e<a.length();e++)d.push(this._fixPointArrays(a.get(e),b,c));return d};g._fixPointArrays=function(a,b,c){const d=[];if(a instanceof Array)for(var e=0;e<a.length;e++){var f=a[e];f instanceof t?b&&c?d.push([f.x,f.y,f.z,f.m]):b?d.push([f.x,f.y,f.z]):c?d.push([f.x,f.y,f.m]):d.push([f.x,f.y]):f instanceof n?d.push(f.toArray()):d.push(f)}else if(a instanceof n)for(e=0;e<a.length();e++)f=
a.get(e),f instanceof t?b&&c?d.push([f.x,f.y,f.z,f.m]):b?d.push([f.x,f.y,f.z]):c?d.push([f.x,f.y,f.m]):d.push([f.x,f.y]):f instanceof n?d.push(f.toArray()):d.push(f);return d};g._convertDictionaryToJson=function(a,b=!1){const c={};for(const d in a.attributes){let e=a.attributes[d];e instanceof q&&(e=g._convertDictionaryToJson(e));b?c[d.toLowerCase()]=e:c[d]=e}return c};g.parseAttributesFromDictionary=function(a){const b={};for(const c in a.attributes){const d=a.attributes[c];if(h.isSimpleType(d))b[c]=
d;else throw new m.ArcadeExecutionError(null,m.ExecutionErrorCodes.InvalidParameter,null);}return b};g.fromJson=function(a,b){let c=null;null!==a.geometry&&void 0!==a.geometry&&(c=p.fromJSON(a.geometry));const d={};if(null!==a.attributes&&void 0!==a.attributes)for(const e in a.attributes){const f=a.attributes[e];if(null===f)d[e]=f;else if(h.isString(f)||h.isNumber(f)||h.isBoolean(f)||h.isDate(f))d[e]=f;else throw new m.ArcadeExecutionError(null,m.ExecutionErrorCodes.InvalidParameter,null);}return g.createFromGraphicLikeObject(c,
d,null,b??null)};k.fullSchema=function(){return this._layer};k.gdbVersion=function(){if(null===this._layer)return"";const a=this._layer.gdbVersion;return void 0===a?"":""===a&&this._layer.capabilities&&this._layer.capabilities.isVersioned?"SDE.DEFAULT":a};k.castAsJson=function(a){const b={attributes:{},geometry:!0===a?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null};for(const c in this.attributes){const d=this.attributes[c];void 0!==d&&(b.attributes[c]=h.castAsJson(d,a))}return b};
k.castAsJsonAsync=async function(a,b){return this.castAsJson(b)};w._createClass(g,[{key:"layerPreferredTimeZone",get:function(){return this.dateTimeReferenceFieldIndex?.layerPreferredTimeZone??""}}]);return g}();y.configureDeepClone(v);return v});