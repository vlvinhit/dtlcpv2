// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ./ArcadeModule ./ArcadeModuleLoader ./Dictionary ./executionError ./Feature ./FunctionWrapper ../chunks/languageUtils ./treeAnalysis ../chunks/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ../geometry/Geometry ../geometry/SpatialReference".split(" "),function(A,B,D,N,w,g,O,t,e,Y,Z,aa,ba,E,ca,da,ea,P,Q){async function F(b,a){const c=[];for(let d=0;d<a.arguments.length;d++)c.push(await k(b,
a.arguments[d]));return c}async function u(b,a,c){if(!0===a.preparsed)return c(b,null,a.arguments);const d=await F(b,a);return c(b,a,d)}async function y(b,a,c){if(!0===a.preparsed)return c(b,null,a.arguments);const d=await F(b,a);return c(b,a,d)}async function k(b,a,c){if(a.breakpoint&&!0!==c)return await a.breakpoint(),k(b,a,!0);try{switch(a?.type){case "VariableDeclarator":return await fa(b,a);case "ImportDeclaration":return await ha(b,a);case "ExportNamedDeclaration":return await ia(b,a);case "VariableDeclaration":return await R(b,
a,0);case "BlockStatement":case "Program":return await ja(b,a);case "FunctionDeclaration":return await ka(b,a);case "ReturnStatement":return await la(b,a);case "IfStatement":return await ma(b,a);case "ExpressionStatement":return await na(b,a);case "UpdateExpression":return await oa(b,a);case "AssignmentExpression":return await pa(b,a);case "ForStatement":return await qa(b,a);case "WhileStatement":return await ra(b,a);case "ForInStatement":return await sa(b,a);case "BreakStatement":return e.breakResult;
case "EmptyStatement":return e.voidOperation;case "ContinueStatement":return e.continueResult;case "TemplateElement":return await ta(b,a);case "TemplateLiteral":return await ua(b,a);case "Identifier":return await G(b,a);case "MemberExpression":return await va(b,a);case "Literal":return a.value;case "CallExpression":return await wa(b,a);case "UnaryExpression":return await xa(b,a);case "BinaryExpression":return await ya(b,a);case "LogicalExpression":return await za(b,a);case "ArrayExpression":return await Aa(b,
a);case "ObjectExpression":return await Ba(b,a);case "Property":return await Ca(b,a);default:throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.Unrecognised,a);}}catch(d){throw g.ensureArcadeExecutionError(b,a,d);}}async function Ba(b,a){const c=[];for(var d=0;d<a.properties.length;d++)c[d]=await k(b,a.properties[d]);d={};const f=new Map;for(let h=0;h<c.length;h++){const l=c[h];if(e.isFunctionParameter(l.value))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.NoFunctionInDictionary,
a);if(!1===e.isString(l.key))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.KeyMustBeString,a);let m=l.key.toString();const n=m.toLowerCase();f.has(n)?m=f.get(n):f.set(n,m);d[m]=l.value===e.voidOperation?null:l.value}b=new w(d);b.immutable=!1;return b}async function Ca(b,a){const c=await k(b,a.value);return"Identifier"===a.key.type?{key:a.key.name,value:c}:{key:await k(b,a.key),value:c}}async function ra(b,a){var c=!0,d=e.voidOperation;c=await k(b,a.test);if(!1===c)return e.voidOperation;
if(!0!==c)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a);for(;!0===c;){d=await k(b,a.body);if(d===e.breakResult)break;if(d instanceof e.ReturnResult)break;c=await k(b,a.test);if(!0!==c&&!1!==c)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a);}return d instanceof e.ReturnResult?d:e.voidOperation}async function Da(b,a,c){const d=await k(b,a.body);c.lastAction=d;if(c.lastAction===e.breakResult||c.lastAction instanceof e.ReturnResult)return c.testResult=
!1,c;null!==a.update&&await k(b,a.update);return c}async function Ea(b,a,c){if(null!==a.test){const d=await k(b,a.test);if(!0===b.abortSignal?.aborted)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.Cancelled,a);c.testResult=d;if(!1===c.testResult)return c;if(!0!==c.testResult)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a);}return Da(b,a,c)}function C(b,a,c,d,f,h){try{Ea(b,a,c).then(()=>{try{!0===c.testResult?(h++,100<h?(h=0,setTimeout(()=>{C(b,a,c,d,
f,h)},0)):C(b,a,c,d,f,h)):c.lastAction instanceof e.ReturnResult?d(c.lastAction):d(e.voidOperation)}catch(l){f(l)}},l=>{f(l)})}catch(l){f(l)}}function qa(b,a){try{return null!==a.init?k(b,a.init).then(()=>new Promise((c,d)=>{C(b,a,{testResult:!0,lastAction:e.voidOperation},f=>{c(f)},f=>{d(f)},0)})):new Promise((c,d)=>{C(b,a,{testResult:!0,lastAction:e.voidOperation},f=>{c(f)},f=>{d(f)},0)})}catch(c){return Promise.reject(c)}}function H(b,a,c,d,f,h,l,m,n,p){try{d<=h?m(e.voidOperation):(f.value="k"===
l?c[h]:h,k(b,a.body).then(q=>{try{q instanceof e.ReturnResult?m(q):q===e.breakResult?m(e.voidOperation):(p++,100<p?(p=0,setTimeout(()=>{H(b,a,c,d,f,h+1,l,m,n,p)},0)):H(b,a,c,d,f,h+1,l,m,n,p))}catch(I){n(I)}},q=>{n(q)}))}catch(q){n(q)}}function J(b,a,c,d,f,h,l,m,n){try{c.length()<=f?l(e.voidOperation):(d.value="k"===h?c.get(f):f,k(b,a.body).then(p=>{p instanceof e.ReturnResult?l(p):p===e.breakResult?l(e.voidOperation):(n++,100<n?(n=0,setTimeout(()=>{J(b,a,c,d,f+1,h,l,m,n)},0)):J(b,a,c,d,f+1,h,l,m,
n))},p=>{m(p)}))}catch(p){m(p)}}function K(b,a,c,d,f,h){try{void 0===h&&(h="i"),0===c.length?d.resolve(e.voidOperation):H(b,a,c,c.length,f,0,h,l=>{d.resolve(l)},l=>{d.reject(l)},0)}catch(l){d.reject(l)}}function Fa(b,a,c,d,f,h){try{void 0===h&&(h="i"),0===c.length?d.resolve(e.voidOperation):J(b,a,c,f,0,h,l=>{d.resolve(l)},l=>{d.reject(l)},0)}catch(l){d.reject(l)}}function Ga(b,a,c,d,f){try{const h=c.keys();K(b,a,h,d,f,"k")}catch(h){d.reject(h)}}function L(b,a,c,d,f,h,l,m){try{b.next().then(n=>{try{if(null===
n)h(e.voidOperation);else{const p=O.createFromGraphicLikeObject(n.geometry,n.attributes,d,a.timeReference);p._underlyingGraphic=n;f.value=p;k(a,c.body).then(q=>{try{q===e.breakResult?h(e.voidOperation):q instanceof e.ReturnResult?h(q):(m++,100<m?(m=0,setTimeout(()=>{L(b,a,c,d,f,h,l,m)},0)):L(b,a,c,d,f,h,l,m))}catch(I){l(I)}},q=>{l(q)})}}catch(p){l(p)}},n=>{l(n)})}catch(n){l(n)}}async function sa(b,a){return new Promise((c,d)=>{k(b,a.right).then(f=>{try{let h=null;h="VariableDeclaration"===a.left.type?
k(b,a.left):Promise.resolve();h.then(()=>{try{let m="";if("VariableDeclaration"===a.left.type){var l=a.left.declarations[0].id;"Identifier"===l.type&&(m=l.name)}else"Identifier"===a.left.type&&(m=a.left.name);if(!m)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);m=m.toLowerCase();l=null;null!=b.localScope&&void 0!==b.localScope[m]&&(l=b.localScope[m]);null===l&&void 0!==b.globalScope[m]&&(l=b.globalScope[m]);null===l?d(new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,
a)):e.isArray(f)||e.isString(f)?K(b,a,f,{reject:d,resolve:c},l):e.isImmutableArray(f)?Fa(b,a,f,{reject:d,resolve:c},l):f instanceof w||e.isFeature(f)?Ga(b,a,f,{reject:d,resolve:c},l):e.isFeatureSet(f)?L(f.iterator(b.abortSignal),b,a,f,l,n=>{c(n)},n=>{d(n)},0):K(b,a,[],{reject:d,resolve:c},l)}catch(m){d(m)}},d)}catch(h){d(h)}},d)})}async function oa(b,a){var c=a.argument;if("MemberExpression"===c.type){var d=null,f=null;d=await k(b,c.object);!0===c.computed?f=await k(b,c.property):"Identifier"===c.property.type&&
(f=c.property.name);c=d;if(e.isArray(c))if(e.isNumber(f)){0>f&&(f=c.length+f);if(0>f||f>=c.length)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.OutOfBounds,a);b=e.toNumber(c[f]);c[f]="++"===a.operator?b+1:b-1}else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ArrayAccessorMustBeNumber,a);else if(c instanceof w){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.KeyAccessorMustBeString,a);if(!0===c.hasField(f))b=e.toNumber(c.field(f)),c.setField(f,
"++"===a.operator?b+1:b-1);else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FieldNotFound,a,{key:f});}else if(c instanceof x){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ModuleAccessorMustBeString,a);if(!0===c.hasGlobal(f))b=e.toNumber(await c.global(f)),c.setGlobal(f,"++"===a.operator?b+1:b-1);else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ModuleExportNotFound,a);}else if(e.isFeature(c)){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.KeyAccessorMustBeString,a);if(!0===c.hasField(f))b=e.toNumber(c.field(f)),c.setField(f,"++"===a.operator?b+1:b-1);else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FieldNotFound,a,{key:f});}else{if(e.isImmutableArray(c))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.Immutable,a);throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidParameter,a);}return!1===a.prefix?b:"++"===a.operator?b+1:b-1}f="Identifier"===a.argument.type?a.argument.name.toLowerCase():
"";if(!f)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);if(null!=b.localScope&&void 0!==b.localScope[f])return c=e.toNumber(b.localScope[f].value),b.localScope[f]={value:"++"===a.operator?c+1:c-1,valueset:!0,node:a},!1===a.prefix?c:"++"===a.operator?c+1:c-1;if(void 0!==b.globalScope[f])return c=e.toNumber(b.globalScope[f].value),b.globalScope[f]={value:"++"===a.operator?c+1:c-1,valueset:!0,node:a},!1===a.prefix?c:"++"===a.operator?c+1:c-1;throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.InvalidIdentifier,a);}function v(b,a,c,d,f){switch(a){case "\x3d":return b===e.voidOperation?null:b;case "/\x3d":return e.toNumber(c)/e.toNumber(b);case "*\x3d":return e.toNumber(c)*e.toNumber(b);case "-\x3d":return e.toNumber(c)-e.toNumber(b);case "+\x3d":return e.isString(c)||e.isString(b)?e.toString(c)+e.toString(b):e.toNumber(c)+e.toNumber(b);case "%\x3d":return e.toNumber(c)%e.toNumber(b);default:throw new g.ArcadeExecutionError(f,g.ExecutionErrorCodes.UnsupportedOperator,
d);}}async function pa(b,a){var c=a.left;if("MemberExpression"===c.type){var d=await k(b,c.object),f=null;if(!0===c.computed)f=await k(b,c.property);else if("Identifier"===c.property.type)f=c.property.name;else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);c=await k(b,a.right);if(e.isArray(d))if(e.isNumber(f)){0>f&&(f=d.length+f);if(0>f||f>d.length)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.OutOfBounds,a);if(f===d.length&&"\x3d"!==a.operator)throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.OutOfBounds,a);d[f]=v(c,a.operator,d[f],a,b)}else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ArrayAccessorMustBeNumber,a);else if(d instanceof w){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.KeyAccessorMustBeString,a);if(!0===d.hasField(f))d.setField(f,v(c,a.operator,d.field(f),a,b));else{if("\x3d"!==a.operator)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FieldNotFound,a,{key:f});d.setField(f,v(c,a.operator,null,a,b))}}else if(d instanceof
x){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.KeyAccessorMustBeString,a);if(!0===d.hasGlobal(f))d.setGlobal(f,v(c,a.operator,await d.global(f),a,b));else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ModuleExportNotFound,a);}else if(e.isFeature(d)){if(!1===e.isString(f))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.KeyAccessorMustBeString,a);if(!0===d.hasField(f))d.setField(f,v(c,a.operator,d.field(f),a,b));else{if("\x3d"!==a.operator)throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.FieldNotFound,a,{key:f});d.setField(f,v(c,a.operator,null,a,b))}}else{if(e.isImmutableArray(d))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.Immutable,a);throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidParameter,a);}return e.voidOperation}d=c.name.toLowerCase();if(null!=b.localScope&&void 0!==b.localScope[d])return f=await k(b,a.right),b.localScope[d]={value:v(f,a.operator,b.localScope[d].value,a,b),valueset:!0,node:a.right},e.voidOperation;if(void 0!==
b.globalScope[d])return f=await k(b,a.right),b.globalScope[d]={value:v(f,a.operator,b.globalScope[d].value,a,b),valueset:!0,node:a.right},e.voidOperation;throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);}async function na(b,a){if("AssignmentExpression"===a.expression.type)return k(b,a.expression);if("CallExpression"===a.expression.type)return b=await k(b,a.expression),b===e.voidOperation?e.voidOperation:new e.ImplicitResult(b);b=await k(b,a.expression);return b===e.voidOperation?
e.voidOperation:new e.ImplicitResult(b)}async function ma(b,a){const c=await k(b,a.test);if(!0===c)return k(b,a.consequent);if(!1===c)return null!==a.alternate?k(b,a.alternate):e.voidOperation;throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a);}async function ja(b,a){return S(b,a,0)}async function S(b,a,c){if(c>=a.body.length)return e.voidOperation;const d=await k(b,a.body[c]);return d instanceof e.ReturnResult||d===e.breakResult||d===e.continueResult||c===a.body.length-
1?d:S(b,a,c+1)}async function la(b,a){if(null===a.argument)return new e.ReturnResult(e.voidOperation);b=await k(b,a.argument);return new e.ReturnResult(b)}async function ka(b,a){const c=a.id.name.toLowerCase();b.globalScope[c]={valueset:!0,node:null,value:new Ha(a,b)};return e.voidOperation}async function ha(b,a){const c=a.specifiers[0].local.name.toLowerCase(),d=b.libraryResolver.loadLibrary(c);let f=null;b.libraryResolver._moduleSingletons?.has(d.uri)?f=b.libraryResolver._moduleSingletons.get(d.uri):
(f=new x(d),await f.loadModule(b),b.libraryResolver._moduleSingletons?.set(d.uri,f));b.globalScope[c]={value:f,valueset:!0,node:a};return e.voidOperation}async function ia(b,a){await k(b,a.declaration);if("FunctionDeclaration"===a.declaration.type)b.exports[a.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===a.declaration.type)for(const c of a.declaration.declarations)b.exports[c.id.name.toLowerCase()]="variable";return e.voidOperation}async function R(b,a,c){if(c>=a.declarations.length)return e.voidOperation;
await k(b,a.declarations[c]);if(c===a.declarations.length-1)return e.voidOperation;await R(b,a,c+1);return e.voidOperation}async function fa(b,a){let c=null;c=null===a.init?null:await k(b,a.init);if(null!==b.localScope){c===e.voidOperation&&(c=null);if("Identifier"!==a.id.type)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);var d=a.id.name.toLowerCase();null!=b.localScope&&(b.localScope[d]={value:c,valueset:!0,node:a.init});return e.voidOperation}if("Identifier"!==a.id.type)throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.InvalidIdentifier,a);d=a.id.name.toLowerCase();c===e.voidOperation&&(c=null);b.globalScope[d]={value:c,valueset:!0,node:a.init};return e.voidOperation}async function va(b,a){const c=await k(b,a.object);if(null===c)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.MemberOfNull,a);if(!1===a.computed){if("Identifier"===a.property.type){if(c instanceof w||e.isFeature(c))return c.field(a.property.name);if(c instanceof P)return E.geometryMember(c,a.property.name,b,a);if(c instanceof
x){if(!c.hasGlobal(a.property.name))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);return c.global(a.property.name)}}throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidMemberAccessKey,a);}let d=await k(b,a.property);if(c instanceof w||e.isFeature(c)){if(e.isString(d))return c.field(d)}else if(c instanceof x){if(e.isString(d))return c.global(d)}else if(c instanceof P){if(e.isString(d))return E.geometryMember(c,d,b,a)}else if(e.isArray(c)){if(e.isNumber(d)&&
isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.OutOfBounds,a);return c[d]}}else if(e.isImmutableArray(c)){if(e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.OutOfBounds,a);return c.get(d)}}else if(e.isString(c)&&e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.OutOfBounds,a);return c[d]}throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidMemberAccessKey,a);}async function xa(b,a){const c=await k(b,a.argument);if(e.isBoolean(c)&&"!"===a.operator)return!c;if("-"===a.operator)return-1*e.toNumber(c);if("+"===a.operator)return 1*e.toNumber(c);if("~"===a.operator)return~e.toNumber(c);throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.UnsupportedUnaryOperator,a);}async function Aa(b,a){const c=[];for(var d=0;d<a.elements.length;d++)c.push(await k(b,
a.elements[d]));for(d=0;d<c.length;d++){if(e.isFunctionParameter(c[d]))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.NoFunctionInArray,a);c[d]===e.voidOperation&&(c[d]=null)}return c}async function ya(b,a){var c=[];c[0]=await k(b,a.left);c[1]=await k(b,a.right);const d=c[0];c=c[1];switch(a.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":return e.binaryOperator(e.toNumber(d),e.toNumber(c),a.operator);case "\x3d\x3d":return e.equalityTest(d,c);
case "!\x3d":return!e.equalityTest(d,c);case "\x3c":return e.greaterThanLessThan(d,c,a.operator);case "\x3e":return e.greaterThanLessThan(d,c,a.operator);case "\x3c\x3d":return e.greaterThanLessThan(d,c,a.operator);case "\x3e\x3d":return e.greaterThanLessThan(d,c,a.operator);case "+":return e.isString(d)||e.isString(c)?e.toString(d)+e.toString(c):e.toNumber(d)+e.toNumber(c);case "-":return e.toNumber(d)-e.toNumber(c);case "*":return e.toNumber(d)*e.toNumber(c);case "/":return e.toNumber(d)/e.toNumber(c);
case "%":return e.toNumber(d)%e.toNumber(c);default:throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.UnsupportedOperator,a);}}async function za(b,a){const c=await k(b,a.left);let d=null;if(e.isBoolean(c))switch(a.operator){case "||":if(!0===c)return c;d=await k(b,a.right);if(e.isBoolean(d))return d;throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.LogicExpressionOrAnd,a);case "\x26\x26":if(!1===c)return c;d=await k(b,a.right);if(e.isBoolean(d))return d;throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.LogicExpressionOrAnd,a);default:throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.LogicExpressionOrAnd,a);}else throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,a);}async function G(b,a){const c=a.name.toLowerCase();if(null!=b.localScope&&void 0!==b.localScope[c]){a=b.localScope[c];if(!0===a.valueset)return a.value;if(null!==a.d)return a.d;a.d=k(b,a.node);b=await a.d;a.value=b;a.valueset=!0;return b}if(void 0!==b.globalScope[c]){a=
b.globalScope[c];if(!0===a.valueset)return a.value;if(null!==a.d)return a.d;a.d=k(b,a.node);b=await a.d;a.value=b;a.valueset=!0;return b}throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.InvalidIdentifier,a);}async function wa(b,a){if("MemberExpression"===a.callee.type){var c=await k(b,a.callee.object);if(!(c instanceof x))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FunctionNotFound,a);const d=!1===a.callee.computed?a.callee.property.name:await k(b,a.callee.property);if(!c.hasGlobal(d))throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.FunctionNotFound,a);c=await c.global(d);if(!e.isFunctionParameter(c))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.CallNonFunction,a);return c.call(b,a)}if("Identifier"!==a.callee.type)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FunctionNotFound,a);if(null!=b.localScope&&void 0!==b.localScope[a.callee.name.toLowerCase()]){c=b.localScope[a.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(b,a);throw new g.ArcadeExecutionError(b,
g.ExecutionErrorCodes.CallNonFunction,a);}if(void 0!==b.globalScope[a.callee.name.toLowerCase()]){c=b.globalScope[a.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(b,a);throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.CallNonFunction,a);}throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.FunctionNotFound,a);}async function ta(b,a){return a.value?a.value.cooked:""}async function ua(b,a){const c=[];for(var d=0;d<a.expressions.length;d++){var f=await k(b,
a.expressions[d]);c[d]=e.toString(f)}d="";f=0;for(const n of a.quasis)if(d+=n.value?n.value.cooked:"",!1===n.tail){if(c[f]){var h=c[f];var l=b,m=a;if(e.isFunctionParameter(h))throw new g.ArcadeExecutionError(l,g.ExecutionErrorCodes.NoFunctionInTemplateLiteral,m);}else h="";d+=h;f++}return d}async function T(b,a,c,d){var f=await k(b,a.arguments[c]);if(e.equalityTest(f,d))return k(b,a.arguments[c+1]);f=a.arguments.length-c;return 1===f?k(b,a.arguments[c]):2===f?null:3===f?k(b,a.arguments[c+2]):T(b,
a,c+2,d)}async function U(b,a,c,d){if(!0===d)return k(b,a.arguments[c+1]);if(3===a.arguments.length-c)return k(b,a.arguments[c+2]);d=await k(b,a.arguments[c+2]);if(!1===e.isBoolean(d))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.ModuleExportNotFound,a.arguments[c+2]);return U(b,a,c+2,d)}async function M(b,a,c,d){const f=b.body;if(c.length!==b.params.length)throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let h=0;h<c.length;h++){const l=b.params[h];
"Identifier"===l.type&&null!=a.localScope&&(a.localScope[l.name.toLowerCase()]={d:null,value:c[h],valueset:!0,node:null})}b=await k(a,f);if(b instanceof e.ReturnResult)return b.value;if(b===e.breakResult)throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.UnexpectedToken,d);if(b===e.continueResult)throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.UnexpectedToken,d);return b instanceof e.ImplicitResult?b.value:b}function V(b,a,c){const d=new z;if(void 0===b||null===b)b={};if(void 0===a||
null===a)a={};const f=new w({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});f.immutable=!1;d.textformatting={value:f,valueset:!0,node:null};for(const h in a)d[h]={value:new t.NativeFunction(a[h]),native:!0,valueset:!0,node:null};for(const h in b)d[h]=b[h]&&"esri.Graphic"===b[h].declaredClass?{value:O.createFromGraphic(b[h],c),valueset:!0,node:null}:{value:b[h],valueset:!0,node:null};return d}function W(b){console.log(b)}function X(b){const a={mode:"async",
compiled:!1,functions:{},signatures:[],standardFunction:u,standardFunctionAsync:y,evaluateIdentifier:G};for(let c=0;c<b.length;c++)b[c].registerFunctions(a);for(const c in a.functions)r[c]={value:new t.NativeFunction(a.functions[c]),valueset:!0,node:null},z.prototype[c]=r[c];for(b=0;b<a.signatures.length;b++)Y.addFunctionDeclaration(a.signatures[b],"async")}let Ha=function(b){function a(d,f){var h=b.call(this)||this;h.definition=null;h.context=null;h.definition=d;h.context=f;return h}B._inherits(a,
b);var c=a.prototype;c.createFunction=function(d){return(...f)=>{const h={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeReference:this.context.timeReference??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:d.depthCounter+1},globalScope:this.context.globalScope};if(64<h.depthCounter.depth)throw new g.ArcadeExecutionError(d,g.ExecutionErrorCodes.MaximumCallDepth,
null);return M(this.definition,h,f,null)}};c.call=function(d,f){return y(d,f,(h,l,m)=>{h={spatialReference:d.spatialReference,services:d.services,console:d.console,libraryResolver:d.libraryResolver,exports:d.exports,lrucache:d.lrucache,timeReference:d.timeReference??null,interceptor:d.interceptor,localScope:{},abortSignal:d.abortSignal,globalScope:d.globalScope,depthCounter:{depth:d.depthCounter.depth+1}};if(64<h.depthCounter.depth)throw new g.ArcadeExecutionError(d,g.ExecutionErrorCodes.MaximumCallDepth,
f);return M(this.definition,h,m,f)})};c.marshalledCall=function(d,f,h,l){return l(d,f,async(m,n,p)=>{m={spatialReference:d.spatialReference,globalScope:h.globalScope,depthCounter:{depth:d.depthCounter.depth+1},libraryResolver:d.libraryResolver,exports:d.exports,console:d.console,abortSignal:d.abortSignal,lrucache:d.lrucache,timeReference:d.timeReference??null,interceptor:d.interceptor,localScope:{}};p=p.map(q=>!e.isFunctionParameter(q)||q instanceof t.ScopeMarshalledFunction?q:t.wrapModuleScopedResponse(q,
d,l));return t.wrapModuleScopedResponse(await M(this.definition,m,p,f),h,l)})};return B._createClass(a)}(t.ArcadeFunction),x=function(b){function a(d){return b.call(this,d)||this}B._inherits(a,b);var c=a.prototype;c.global=async function(d){d=this.executingContext.globalScope[d.toLowerCase()];d.valueset||(d.value=await k(this.executingContext,d.node),d.valueset=!0);if(e.isFunctionParameter(d.value)&&!(d.value instanceof t.ScopeMarshalledFunction)){const f=new t.ScopeMarshalledFunction;f.fn=d.value;
f.parameterEvaluator=y;f.context=this.executingContext;d.value=f}return d.value};c.setGlobal=function(d,f){if(e.isFunctionParameter(f))throw new g.ArcadeExecutionError(null,g.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[d.toLowerCase()]={value:f,valueset:!0,node:null}};c.hasGlobal=function(d){void 0===this.executingContext.exports[d]&&(d=d.toLowerCase());return void 0!==this.executingContext.exports[d]?!0:!1};c.loadModule=async function(d){let f=d.spatialReference;
if(null===f||void 0===f)f=new Q({wkid:102100});this.moduleScope=V({},d.customfunctions,d.timeReference);this.executingContext={spatialReference:f,services:d.services,libraryResolver:new N.ArcadeModuleLoader(d.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===d.abortSignal||null===d.abortSignal?{aborted:!1}:d.abortSignal,globalScope:this.moduleScope,console:d.console??W,lrucache:d.lrucache,timeReference:d.timeReference??null,interceptor:d.interceptor,
localScope:null,depthCounter:{depth:1}};await k(this.executingContext,this.source.syntax)};return B._createClass(a)}(D.ArcadeModule);const r={};aa.registerFunctions(r,u);ea.registerFunctions(r,u);ca.registerFunctions(r,u);E.registerFunctions(r,u);da.registerFunctions(r,u);ba.registerFunctions({functions:r,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:u,standardFunctionAsync:y});r.iif=async function(b,a){e.pcCheck(null===a.arguments?[]:a.arguments,3,3,b,a);const c=
await k(b,a.arguments[0]);if(!1===e.isBoolean(c))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a);return c?k(b,a.arguments[1]):k(b,a.arguments[2])};r.decode=async function(b,a){if(2>a.arguments.length)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.WrongNumberOfParameters,a);if(2===a.arguments.length)return k(b,a.arguments[1]);if(0===(a.arguments.length-1)%2)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.WrongNumberOfParameters,a);const c=await k(b,
a.arguments[0]);return T(b,a,1,c)};r.when=async function(b,a){if(3>a.arguments.length)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.WrongNumberOfParameters,a);if(0===a.arguments.length%2)throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.WrongNumberOfParameters,a);const c=await k(b,a.arguments[0]);if(!1===e.isBoolean(c))throw new g.ArcadeExecutionError(b,g.ExecutionErrorCodes.BooleanConditionRequired,a.arguments[0]);return U(b,a,0,c)};D={fixSpatialReference:e.fixSpatialReference,
parseArguments:F,standardFunction:u,standardFunctionAsync:y,evaluateIdentifier:G};for(const b in r)r[b]={value:new t.NativeFunction(r[b]),valueset:!0,node:null};const z=function(){};z.prototype=r;z.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};z.prototype.pi={value:Math.PI,valueset:!0,node:null};X([Z.ArrayFunctions]);A.executeScript=async function(b,a){let c=a.spatialReference;if(null===c||void 0===c)c=new Q({wkid:102100});let d=null;b.usesModules&&(d=new N.ArcadeModuleLoader(new Map,
b.loadedModules));const f=V(a.vars,a.customfunctions,a.timeReference);a={spatialReference:c,services:a.services,exports:{},libraryResolver:d,abortSignal:void 0===a.abortSignal||null===a.abortSignal?{aborted:!1}:a.abortSignal,globalScope:f,console:a.console??W,timeReference:a.timeReference??null,lrucache:a.lrucache,interceptor:a.interceptor,localScope:null,depthCounter:{depth:1}};b=await k(a,b);b instanceof e.ReturnResult&&(b=b.value);b instanceof e.ImplicitResult&&(b=b.value);b===e.voidOperation&&
(b=null);if(b===e.breakResult)throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.IllegalResult,null);if(b===e.continueResult)throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.IllegalResult,null);if(e.isFunctionParameter(b))throw new g.ArcadeExecutionError(a,g.ExecutionErrorCodes.IllegalResult,null);return b};A.extend=X;A.functionHelper=D;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});