// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../request ../portal/Portal ./parser ./featureset/support/RecentlyUsedCache ./executionError".split(" "),function(p,u,v,q,r,w,g){let k=function(){function b(a){this.portalUri=a}var m=b.prototype;m.normalizeModuleUri=function(a){const d=/^[a-z0-9A-Z]+(@[0-9]+\.[0-9]+\.[0-9]+)?([\?|\/].*)?$/gi;var e=/(?<portalurl>.+)\/home\/item\.html\?id=(?<itemid>.+)$/gi;const n=/(?<portalurl>.+)\/sharing\/rest\/content\/users\/[a-zA-Z0-9]+\/items\/(?<itemid>.+)$/gi,
x=/(?<portalurl>.+)\/sharing\/rest\/content\/items\/(?<itemid>.+)$/gi;var l=/(?<itemid>.*)@(?<versionstring>[0-9]+\.[0-9]+\.[0-9]+)([\?|\/].*)?$/gi;if(a.startsWith("portal+")){let f=a.substring(7);var h="",c=f;let t=!1;for(const y of[e,x,n])if(e=y.exec(f),null!==e){h=e.groups;c=h.itemid;h=h.portalurl;t=!0;break}if(!1===t)if(d.test(f))c=f,h=this.portalUri;else throw new g.ModuleError(g.ModuleErrorCodes.UnsupportedUriProtocol,{uri:a});c.includes("/")&&(c=c.split("/")[0]);c.includes("?")&&(c=c.split("?")[0]);
a="current";l=l.exec(c);null!==l&&(a=l.groups,c=a.itemid,a=a.versionstring);f=(new q({url:h})).restUrl+"/content/items/"+c+"/resources/"+a+".arc";return{url:f,scheme:"portal",uri:"PO:"+f}}if(a.startsWith("mock")){if("mock"===a)return{url:"",scheme:"mock",data:'\n      export var hello \x3d 1;\n      export function helloWorld() {\n          return "Hello World " + hello;\n      }\n  ',uri:"mock"};c=a.replace("mock:","");if(void 0!==b.mocks[c])return{url:"",scheme:"mock",data:b.mocks[c],uri:a}}throw new g.ModuleError(g.ModuleErrorCodes.UnrecognisedUri,
{uri:a});};m.fetchModule=async function(a){var d=b.cachedModules.getFromCache(a.uri);if(d)return d;d=this.fetchSource(a);b.cachedModules.addToCache(a.uri,d);let e=null;try{e=await d}catch(n){throw b.cachedModules.removeFromCache(a.uri),n;}return e};m.fetchSource=async function(a){if("portal"===a.scheme){const d=await v(a.url,{responseType:"text",query:{}});if(d.data)return r.parseScript(d.data,[])}if("mock"===a.scheme)return r.parseScript(a.data??"",[]);throw new g.ModuleError(g.ModuleErrorCodes.UnsupportedUriProtocol);
};b.create=function(a){return new b(a)};b.getDefault=function(){return this._default??(b._default=b._moduleResolverFactory())};u._createClass(b,null,[{key:"moduleResolverClass",set:function(a){this._moduleResolverFactory=a;this._default=null}}]);return b}();k.mocks={};k.cachedModules=new w(30);k._default=null;k._moduleResolverFactory=()=>{const b=q.getDefault();return new k(b.url)};p.ArcadeModuleResolver=k;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});