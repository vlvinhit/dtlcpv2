// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/typedArrayUtil ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(r,q,t,A,x,B,n,p,u){let w=function(){function m(g,c){this.layerUIDs=[];this.isDestroyed=!1;this._data=g;let a=1;g=new Uint32Array(g);this.layerUIDs=[];const b=g[a++];for(let d=0;d<b;d++)this.layerUIDs[d]=g[a++];this.bufferDataOffset=a;c&&(this.layer=c.getStyleLayerByUID(this.layerUIDs[0]))}
var k=m.prototype;k.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};k.prepareForRendering=function(g){null!=this._data&&(this.doPrepareForRendering(g,this._data,this.bufferDataOffset),this._data=null)};q._createClass(m,[{key:"isPreparedForRendering",get:function(){return null==this._data}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"data",get:function(){return this._data}}]);return m}(),C=function(m){function k(c,a){a=m.call(this,c,a)||this;a.type=
x.BucketType.LINE;a.lineIndexStart=0;a.lineIndexCount=0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.lineIndexStart=c[b++];a.lineIndexCount=c[b++];const d=c[b++];if(0<d){a.patternMap=new Map;for(let f=0;f<d;f++){const h=c[b++],e=c[b++],l=c[b++];a.patternMap.set(h,[e,l])}}a.bufferDataOffset=b;return a}q._inherits(k,m);var g=k.prototype;g.hasData=function(){return 0<this.lineIndexCount};g.triangleCount=function(){return this.lineIndexCount/3};g.doDestroy=function(){this.vao=t.disposeMaybe(this.vao)};
g.doPrepareForRendering=function(c,a,b){var d=new Uint32Array(a);a=new Int32Array(d.buffer);var f=d[b++];a=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(a.buffer,4*b,f));b+=f;f=d[b++];d=n.BufferObject.createIndex(c,p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,f));b+=f;b=this.layer.lineMaterial;this.vao=new u.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a},d)};q._createClass(k,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??
0)}}]);return k}(w),D=function(m){function k(c,a){a=m.call(this,c,a)||this;a.type=x.BucketType.FILL;a.fillIndexStart=0;a.fillIndexCount=0;a.outlineIndexStart=0;a.outlineIndexCount=0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.fillIndexStart=c[b++];a.fillIndexCount=c[b++];a.outlineIndexStart=c[b++];a.outlineIndexCount=c[b++];const d=c[b++];if(0<d){a.patternMap=new Map;for(let f=0;f<d;f++){const h=c[b++],e=c[b++],l=c[b++];a.patternMap.set(h,[e,l])}}a.bufferDataOffset=b;return a}q._inherits(k,m);
var g=k.prototype;g.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};g.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};g.doDestroy=function(){this.fillVAO=t.disposeMaybe(this.fillVAO);this.outlineVAO=t.disposeMaybe(this.outlineVAO)};g.doPrepareForRendering=function(c,a,b){var d=new Uint32Array(a),f=new Int32Array(d.buffer),h=d[b++];a=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(f.buffer,4*b,h));b+=h;var e=d[b++];h=n.BufferObject.createIndex(c,
p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,e));b+=e;e=d[b++];f=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(f.buffer,4*b,e));b+=e;e=d[b++];d=n.BufferObject.createIndex(c,p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,e));b+=e;e=this.layer;b=e.fillMaterial;e=e.outlineMaterial;this.fillVAO=new u.VertexArrayObject(c,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a},h);this.outlineVAO=new u.VertexArrayObject(c,e.getAttributeLocations(),e.getLayoutInfo(),{geometry:f},
d)};q._createClass(k,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}}]);return k}(w),E=function(m){function k(c,a,b){a=m.call(this,c,a)||this;a.type=x.BucketType.SYMBOL;a.iconPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.symbolInstances=[];a.isIconSDF=!1;a.opacityChanged=!1;a.lastOpacityUpdate=0;a.symbols=[];const d=new Uint32Array(c),f=new Int32Array(c);c=new Float32Array(c);let h=a.bufferDataOffset;
a.isIconSDF=!!d[h++];var e=d[h++];for(var l=0;l<e;l++){var v=d[h++],y=d[h++],z=d[h++];a.iconPerPageElementsMap.set(v,[y,z])}e=d[h++];for(l=0;l<e;l++)v=d[h++],y=d[h++],z=d[h++],a.glyphPerPageElementsMap.set(v,[y,z]);e=d[h++];l=d[h++];a.iconOpacity=new Int32Array(e);a.textOpacity=new Int32Array(l);h=B.deserializeSymbols(d,f,c,h,a.symbols,b);a.bufferDataOffset=h;return a}q._inherits(k,m);var g=k.prototype;g.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};
g.triangleCount=function(){let c=0;for(const [,a]of this.iconPerPageElementsMap)c+=a[1];for(const [,a]of this.glyphPerPageElementsMap)c+=a[1];return c/3};g.doDestroy=function(){this.iconVAO=t.disposeMaybe(this.iconVAO);this.textVAO=t.disposeMaybe(this.textVAO)};g.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var c=this.iconOpacity,a=this.iconVAO.vertexBuffers.opacity;0<c.length&&c.byteLength===a.byteLength&&a.setSubData(c,0,0,c.length);c=this.textOpacity;a=this.textVAO.vertexBuffers.opacity;
0<c.length&&c.byteLength===a.byteLength&&a.setSubData(c,0,0,c.length)}};g.doPrepareForRendering=function(c,a,b){var d=new Uint32Array(a),f=new Int32Array(d.buffer),h=d[b++];a=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(f.buffer,4*b,h));b+=h;var e=d[b++];h=n.BufferObject.createIndex(c,p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,e));b+=e;e=d[b++];f=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(f.buffer,4*b,e));b+=e;e=d[b++];d=n.BufferObject.createIndex(c,
p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,e));b+=e;b=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,this.iconOpacity.buffer);e=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,this.textOpacity.buffer);var l=this.layer;const v=l.iconMaterial;l=l.textMaterial;this.iconVAO=new u.VertexArrayObject(c,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:a,opacity:b},h);this.textVAO=new u.VertexArrayObject(c,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:f,opacity:e},d)};q._createClass(k,
[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+A.estimateSize(this.iconOpacity)+A.estimateSize(this.textOpacity)}}]);return k}(w),F=function(m){function k(c,a){a=m.call(this,c,a)||this;a.type=x.BucketType.CIRCLE;a.circleIndexStart=0;a.circleIndexCount=0;c=new Uint32Array(c);let b=a.bufferDataOffset;a.circleIndexStart=c[b++];a.circleIndexCount=c[b++];a.bufferDataOffset=b;return a}q._inherits(k,m);var g=k.prototype;
g.hasData=function(){return 0<this.circleIndexCount};g.triangleCount=function(){return this.circleIndexCount/3};g.doDestroy=function(){this.vao=t.disposeMaybe(this.vao)};g.doPrepareForRendering=function(c,a,b){var d=new Uint32Array(a);a=new Int32Array(d.buffer);var f=d[b++];a=n.BufferObject.createVertex(c,p.Usage.STATIC_DRAW,new Int32Array(a.buffer,4*b,f));b+=f;f=d[b++];d=n.BufferObject.createIndex(c,p.Usage.STATIC_DRAW,new Uint32Array(d.buffer,4*b,f));b+=f;b=this.layer.circleMaterial;this.vao=new u.VertexArrayObject(c,
b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a},d)};q._createClass(k,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}}]);return k}(w);r.CircleRenderBucket=F;r.FillRenderBucket=D;r.LineRenderBucket=C;r.RenderBucketBase=w;r.SymbolRenderBucket=E;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});