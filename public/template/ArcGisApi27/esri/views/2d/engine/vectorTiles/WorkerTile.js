// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","./Placement","./TileParser","../../tiling/enums"],function(m,n,p,q,e){return function(){function l(b,a,c,f){this.status=e.TileStatus.INITIALIZED;this.placementEngine=new p.PlacementEngine;this.tileKey=b;this.refKeys=a;this._workerTileHandler=c;this._styleRepository=f}var g=l.prototype;g.release=function(){this.tileKey="";this.refKeys=null;this.status=e.TileStatus.INITIALIZED;this._workerTileHandler=null};g.parse=
async function(b,a){const c=a&&a.signal;if(null!=c){const k=()=>{c.removeEventListener("abort",k);this.status=e.TileStatus.INVALID};c.addEventListener("abort",k)}const f={bucketsWithData:[],emptyBuckets:null};try{var d=await this._parse(b,a)}catch(k){if(n.isAbortError(k))throw k;return{result:f,transferList:[]}}this.status=e.TileStatus.READY;a=f.bucketsWithData;b=[];for(var h of d)h.hasFeatures()?(d=h.serialize(),a.push(d)):b.push(h.layer.uid);h=[...a];d=null;0<b.length&&(d=Uint32Array.from(b),h.push(d.buffer));
f.emptyBuckets=d;return{result:f,transferList:h}};g.setObsolete=function(){this.status=e.TileStatus.INVALID};g.getLayers=function(){return this._workerTileHandler.getLayers()};g.getWorkerTileHandler=function(){return this._workerTileHandler};g._parse=async function(b,a){const c=b.sourceName2DataAndRefKey;if(0===Object.keys(c).length)return[];this.status=e.TileStatus.MODIFIED;return(new q(c,this,a.client,this._styleRepository,b.styleLayerUIDs)).parse(a)};return m._createClass(l)}()});