// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../vtlBrushes ./shaders/VTLMaterialManager ./style/StyleDefinition ../../../webgl/enums".split(" "),function(q,r,t,u,g,h){return function(){function p(a,d){this.spriteMosaic=a;this.glyphMosaic=d;this._brushCache=new Map;this._vtlMaterialManager=new u}var l=p.prototype;l.dispose=function(){this._brushCache&&(this._brushCache.forEach(a=>a.dispose()),this._brushCache=null);this._vtlMaterialManager=r.disposeMaybe(this._vtlMaterialManager);
this.spriteMosaic.dispose();this.glyphMosaic.dispose()};l.drawTile=function(a,d,e,b){const {context:c}=a,m=e.layers;0<e.backgroundBucketIds.length&&(a.renderPass="background",e.backgroundBucketIds.forEach(n=>{n=e.getLayerById(n);null!=b&&b!==n.type||this._renderStyleLayer(n,a,d,!0)}));c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);c.setDepthWriteEnabled(!0);c.setDepthFunction(h.CompareFunction.LEQUAL);a.renderPass="opaque";for(var f=m.length-1;0<=f;f--){var k=m[f];null!=b&&b!==k.type||this._renderStyleLayer(k,
a,d,!1)}c.setDepthWriteEnabled(!1);c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);a.renderPass="translucent";for(f=0;f<m.length;f++)k=m[f],null!=b&&b!==k.type||this._renderStyleLayer(k,a,d,!1);c.setDepthTestEnabled(!1);c.bindVAO()};l._renderStyleLayer=function(a,d,e,b){if(b||a&&e.layerData.has(a.uid))if(b=a.getLayoutProperty("visibility"),!b||b.getValue()!==g.Visibility.NONE){({renderPass:b}=
d);switch(a.type){case g.StyleLayerType.BACKGROUND:if("background"!==b)return;var c="vtlBackground";break;case g.StyleLayerType.FILL:if("opaque"!==b&&"translucent"!==d.renderPass)return;c="vtlFill";break;case g.StyleLayerType.LINE:if("translucent"!==b)return;c="vtlLine";break;case g.StyleLayerType.CIRCLE:if("translucent"!==b)return;c="vtlCircle";break;case g.StyleLayerType.SYMBOL:if("translucent"!==b)return;c="vtlSymbol"}b=d.displayLevel;void 0!==a.minzoom&&a.minzoom>b+1E-6||void 0!==a.maxzoom&&a.maxzoom<=
b-1E-6||(d.styleLayerUID=a.uid,d.styleLayer=a,this._drawWithBrush(d,e,c))}};l._drawWithBrush=function(a,d,e){this._brushCache.has(e)||this._brushCache.set(e,new t.vtlBrushes[e]);this._brushCache.get(e).drawMany(a,[d])};q._createClass(p,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}}]);return p}()});