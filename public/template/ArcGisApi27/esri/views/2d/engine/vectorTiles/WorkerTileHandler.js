// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","./enums","./WorkerTile","./style/StyleRepository"],function(p,q,l,r,t){return function(){function n(){this._spriteInfo={};this._glyphInfo={}}var f=n.prototype;f.reset=function(){this._spriteInfo={};this._glyphInfo={};return Promise.resolve()};f.getLayers=function(){return this._styleRepository?.layers??[]};f.createTileAndParse=async function(a,c){var {key:b}=a;const g={};for(const d of Object.keys(a.sourceName2DataAndRefKey))g[d]=
a.sourceName2DataAndRefKey[d].refKey;b=new r(b,g,this,this._styleRepository);try{return await b.parse(a,c)}catch(d){b.setObsolete();b.release();if(!q.isAbortError(d))throw d;return null}};f.updateStyle=function(a){if(a&&0!==a.length&&this._styleRepository){var c=this._styleRepository;for(const b of a)switch(a=b.data,b.type){case l.StyleUpdateType.PAINTER_CHANGED:c.setPaintProperties(a.layer,a.paint);break;case l.StyleUpdateType.LAYOUT_CHANGED:c.setLayoutProperties(a.layer,a.layout);break;case l.StyleUpdateType.LAYER_REMOVED:c.deleteStyleLayer(a.layer);
break;case l.StyleUpdateType.LAYER_CHANGED:c.setStyleLayer(a.layer,a.index);break;case l.StyleUpdateType.SPRITES_CHANGED:this._spriteInfo={}}}};f.setStyle=function(a){this._styleRepository=new t(a);this._spriteInfo={};this._glyphInfo={}};f.fetchSprites=function(a,c,b){const g=[],d=this._spriteInfo;for(const e of a)void 0===d[e.name]&&g.push(e);return 0===g.length?Promise.resolve():c.invoke("getSprites",g,{signal:b&&b.signal}).then(e=>{for(const k in e)d[k]=e[k]})};f.getSpriteItems=function(){return this._spriteInfo};
f.fetchGlyphs=function(a,c,b,g,d){const e=[];let k=this._glyphInfo[c];k?b.forEach(h=>{k[h]||e.push(h)}):(k=this._glyphInfo[c]=[],b.forEach(h=>e.push(h)));return 0===e.length?Promise.resolve():g.invoke("getGlyphs",{tileID:a,font:c,codePoints:e},d).then(h=>{for(let m=0;m<h.length;m++)h[m]&&(k[m]=h[m])})};f.getGlyphItems=function(a){return this._glyphInfo[a]};return p._createClass(n)}()});