// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(A,C,D,g,E,F,G,h,w,n,x,H,I,J,K,L){const M=
F.create(),N=E.create();return function(B){function t(a,c,p){var b=B.call(this,a)||this;b._cimMarkerLayer=a;b._minMaxZoom=x.i1616to32(Math.round(c*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(p*n.MIN_MAX_ZOOM_PRECISION_FACTOR));const k=a.color;h.isFeatureValueFn(k)?b._dynamicPropertyMap.set("_fillColor",(e,f,d)=>w.premultiplyAlphaRGBA(k(e,f,d))):b._fillColor=w.premultiplyAlphaRGBA(k);const q=a.outlineColor;h.isFeatureValueFn(q)?b._dynamicPropertyMap.set("_outlineColor",(e,f,d)=>w.premultiplyAlphaRGBA(q(e,
f,d))):b._outlineColor=w.premultiplyAlphaRGBA(q);const l=a.size;h.isFeatureValueFn(l)?b._dynamicPropertyMap.set("_size",(e,f,d)=>g.pt2px(l(e,f,d))):b._size=g.pt2px(l)||0;c=a.scaleX;h.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_scaleX",c):b._scaleX=c;const u=a.offsetX;h.isFeatureValueFn(u)?b._dynamicPropertyMap.set("xOffset",(e,f,d)=>g.pt2px(u(e,f,d))):b.xOffset=g.pt2px(u)||0;const m=a.offsetY;h.isFeatureValueFn(m)?b._dynamicPropertyMap.set("yOffset",(e,f,d)=>g.pt2px(m(e,f,d))):b.yOffset=g.pt2px(m)||
0;const r=a.outlineWidth;h.isFeatureValueFn(r)?b._dynamicPropertyMap.set("_outlineWidth",(e,f,d)=>g.pt2px(r(e,f,d))):b._outlineWidth=g.pt2px(r)||0;c=a.rotation;h.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_angle",c):b._angle=c||0;null!=a.effects&&(c=a.effects,h.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);null!=a.markerPlacement&&(c=a.markerPlacement,h.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_markerPlacement",c):b._markerPlacement=c);b._scaleFactor=a.scaleFactor??
1;b._bitSet=(a.alignment===G.Alignment.MAP?n.BITSET_MARKER_ALIGNMENT_MAP:n.BITSET_MARKER_ALIGNMENT_SCREEN)|(a.colorLocked?n.BITSET_GENERIC_LOCK_COLOR:0)|(a.scaleSymbolsProportionally?n.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0);b._materialKey=a.materialKey;return b}A._inherits(t,B);t.fromCIMMarker=function(a,c){const [p,b]=I.getMinMaxZoom(a.scaleInfo,c);return new t(a,p,b)};t.prototype.bindFeature=function(a,c,p){const b=a.readLegacyFeature();a=a.getObjectId();this._dynamicPropertyMap.forEach((O,
P)=>{this[P]=O(b,c,p)});var k=this._cimMarkerLayer.materialHash;a="function"===typeof k?k(b,c,p,a):k;if((a=this._materialCache.get(a))&&L.ok(a.spriteMosaicItem)&&a.spriteMosaicItem){a=a.spriteMosaicItem;k=this._cimMarkerLayer.sizeRatio;var q=a.width/a.height*this._scaleX,l=H.MarkerMaterialKey.load(this._materialKey);l.sdf=a.sdf;l.pattern=!0;l.textureBinding=a.textureBinding;this._materialKey=l.data;var u=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,m=this._size,r=m*q,e=this.xOffset,
f=this.yOffset;this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var d=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/g.pt2px(this._cimMarkerLayer.frameHeight):1;d*=this._outlineWidth;var Q=g.pt2px(this._cimMarkerLayer.referenceSize),y=0,z=0,v=this._cimMarkerLayer.anchorPoint;v&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(y=g.pt2px(v.x)/(this._size*q),z=g.pt2px(v.y)/this._size):(y=v.x,z=v.y));this._anchorX=y;this._anchorY=z;
this._sizeOutlineWidth=x.i8888to32(Math.round(Math.min(Math.sqrt(128*r),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*Q),255)));this.angle=u;this._bitestAndDistRatio=x.i1616to32(this._bitSet,Math.round(64*k));this._computeSize(r,m,k,d,this._scaleFactor,a,l.hasSizeVV(),!0);this._applyTransformation(N,M);this.xOffset=e;this.yOffset=f}else D.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new C("mapview-cim",
"Encountered an error when binding feature"))};return A._createClass(t)}(J(K))});