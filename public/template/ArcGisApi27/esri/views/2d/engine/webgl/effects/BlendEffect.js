// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ../shaders/BlendPrograms ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(q,y,r,n,t,z,A,u,g,B,C){const v=n.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");n=function(){function w(){this._size=[0,0]}var k=w.prototype;k.dispose=function(a){this._backBufferTexture=
t.disposeMaybe(this._backBufferTexture);this._quad=t.disposeMaybe(this._quad)};k.draw=function(a,c,f,e,l){const {context:b,drawPhase:p}=a;this._setupShader(b);e&&"normal"!==e&&p!==z.WGLDrawPhase.LABEL?this._drawBlended(a,c,f,e,l):(a=u.createProgramTemplate("normal"),(a=b.programCache.acquire(a.shaders.vertexShader,a.shaders.fragmentShader,a.attributes))?(b.useProgram(a),c.setSamplingMode(f),b.bindTexture(c,0),a.setUniform1i("u_layerTexture",0),a.setUniform1f("u_opacity",l),b.setBlendingEnabled(!0),
b.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA),c=this._quad,c.draw(),c.unbind(),a.dispose()):v.error(new r("mapview-BlendEffect",'Error creating shader program for blend mode "normal"')))};k._drawBlended=function(a,c,f,e,l){const {context:b,state:p,pixelRatio:x,inFadeTransition:D}=a;var {size:h}=p,d=b.getBoundFramebufferObject();let m;null!=d?(m=d.width,h=d.height):(m=Math.round(x*h[0]),h=Math.round(x*h[1]));this._createOrResizeTexture(a,m,h);a=this._backBufferTexture;d.copyToTexture(0,
0,m,h,0,0,a);b.setStencilTestEnabled(!1);b.setStencilWriteMask(0);b.setBlendingEnabled(!0);b.setDepthTestEnabled(!1);b.setDepthWriteEnabled(!1);d=u.createProgramTemplate(e);(d=b.programCache.acquire(d.shaders.vertexShader,d.shaders.fragmentShader,d.attributes))?(b.useProgram(d),a.setSamplingMode(f),b.bindTexture(a,0),d.setUniform1i("u_backbufferTexture",0),c.setSamplingMode(f),b.bindTexture(c,1),d.setUniform1i("u_layerTexture",1),d.setUniform1f("u_opacity",l),d.setUniform1f("u_inFadeOpacity",D?1:
0),b.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ZERO),c=this._quad,c.draw(),c.unbind(),d.dispose(),b.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA)):v.error(new r("mapview-BlendEffect",`Error creating shader program for blend mode ${e}`))};k._setupShader=function(a){this._quad||(this._quad=new A(a,[-1,-1,1,-1,-1,1,1,1]))};k._createOrResizeTexture=function(a,c,f){({context:a}=a);if(null===this._backBufferTexture||c!==this._size[0]||f!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(c,
f);else{const e=new C.TextureDescriptor;e.internalFormat=g.PixelFormat.RGBA;e.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;e.width=c;e.height=f;this._backBufferTexture=new B.Texture(a,e)}this._size[0]=c;this._size[1]=f}};return y._createClass(w)}();q.BlendEffect=n;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});