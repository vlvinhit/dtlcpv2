// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(H,I,J,A,E,P,F,p){const K=1/65536;F=function(L){function G(){var d=L.apply(this,arguments)||this;d._fillProgramOptions={id:!1,pattern:!1};d._outlineProgramOptions={id:!1};return d}I._inherits(G,L);var B=G.prototype;B.dispose=function(){};B.drawMany=function(d,u){const {displayLevel:k,drawPhase:c,renderPass:h,
spriteMosaic:f,styleLayerUID:m}=d;var a=!1;for(var l of u)if(l.layerData.has(m)){var q=l.layerData.get(m);if(0<q.fillIndexCount||0<q.outlineIndexCount){a=!0;break}}if(a){a=d.styleLayer;var g=a.getPaintProperty("fill-pattern");q=(l=void 0!==g)&&g.isDataDriven;if(l&&!q){var r=g.getValue(k);r=f.getMosaicItemPosition(r,!0)}g=!l&&a.getPaintValue("fill-antialias",k);var x=!0,v=1;if(!l){var w=a.getPaintProperty("fill-color"),y=a.getPaintProperty("fill-opacity");w?.isDataDriven||y?.isDataDriven||(v=a.getPaintValue("fill-color",
k),v=a.getPaintValue("fill-opacity",k)*v[3],1<=v&&(x=!1))}if(!x||"opaque"!==h){var b;c===E.WGLDrawPhase.HITTEST&&(b=P.u32to4Xu8(m+1));w=a.getPaintValue("fill-translate",k);y=a.getPaintValue("fill-translate-anchor",k);(x||"translucent"!==h)&&this._drawFill(d,m,a,u,w,y,l,r,q,b);r=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&1>v;g&&"opaque"!==h&&!r&&this._drawOutline(d,m,a,u,w,y,b)}}};B._drawFill=function(d,u,k,c,h,f,m,a,l,q){if(!m||l||null!=a){var {context:g,displayLevel:r,state:x,drawPhase:v,
painter:w,pixelRatio:y,spriteMosaic:b,requestRender:C,allowDelayedRender:D}=d;d=k.fillMaterial;var e=w.vectorTilesMaterialManager,t=y>A.VTL_HIGH_RES_CUTOFF?2:1,M=v===E.WGLDrawPhase.HITTEST,z=this._fillProgramOptions;z.id=M;z.pattern=m;e=e.getMaterialProgram(g,d,z);if(D&&null!=C&&!e.compiled)C();else{g.useProgram(e);null!=a&&({page:a}=a,z=b.getPageSize(a),null!=z&&(b.bind(g,p.TextureSamplingMode.LINEAR,a,A.VTL_TEXTURE_BINDING_UNIT_SPRITES),e.setUniform2fv("u_mosaicSize",z),e.setUniform1i("u_texture",
A.VTL_TEXTURE_BINDING_UNIT_SPRITES)));e.setUniformMatrix3fv("u_displayMat3",f===J.TranslateAnchor.VIEWPORT?x.displayMat3:x.displayViewMat3);e.setUniform2fv("u_fillTranslation",h);e.setUniform1f("u_depth",k.z+K);M&&e.setUniform4fv("u_id",q);h=-1;for(const n of c)if(n.layerData.has(u)&&(n.key.level!==h&&(h=n.key.level,d.setDataUniforms(e,r,k,h,b)),c=n.layerData.get(u),c.fillIndexCount&&(c.prepareForRendering(g),f=c.fillVAO,null!=f))){g.bindVAO(f);e.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs);
g.setStencilFunction(p.CompareFunction.EQUAL,n.stencilRef,255);m&&e.setUniform1f("u_patternFactor",n.rangeX/(t*n.width*Math.max(2**(Math.round(r)-n.key.level),1)));if(l){f=c.patternMap;if(!f)continue;for(const [N,O]of f)f=b.getPageSize(N),null!=f&&(b.bind(g,p.TextureSamplingMode.LINEAR,N,A.VTL_TEXTURE_BINDING_UNIT_SPRITES),e.setUniform2fv("u_mosaicSize",f),e.setUniform1i("u_texture",A.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.drawElements(p.PrimitiveType.TRIANGLES,O[1],p.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*
O[0]))}else g.drawElements(p.PrimitiveType.TRIANGLES,c.fillIndexCount,p.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*c.fillIndexStart);n.triangleCount+=c.fillIndexCount/3}}}};B._drawOutline=function(d,u,k,c,h,f,m){const {context:a,displayLevel:l,state:q,drawPhase:g,painter:r,pixelRatio:x,spriteMosaic:v,requestRender:w,allowDelayedRender:y}=d;d=k.outlineMaterial;var b=r.vectorTilesMaterialManager;const C=.75/x,D=g===E.WGLDrawPhase.HITTEST,e=this._outlineProgramOptions;e.id=D;b=b.getMaterialProgram(a,
d,e);if(y&&null!=w&&!b.compiled)w();else{a.useProgram(b);b.setUniformMatrix3fv("u_displayMat3",f===J.TranslateAnchor.VIEWPORT?q.displayMat3:q.displayViewMat3);b.setUniform2fv("u_fillTranslation",h);b.setUniform1f("u_depth",k.z+K);b.setUniform1f("u_outline_width",C);D&&b.setUniform4fv("u_id",m);h=-1;for(const t of c)t.layerData.has(u)&&(t.key.level!==h&&(h=t.key.level,d.setDataUniforms(b,l,k,h,v)),c=t.layerData.get(u),c.prepareForRendering(a),c.outlineIndexCount&&(f=c.outlineVAO,null!=f&&(a.bindVAO(f),
b.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),a.setStencilFunction(p.CompareFunction.EQUAL,t.stencilRef,255),a.drawElements(p.PrimitiveType.TRIANGLES,c.outlineIndexCount,p.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*c.outlineIndexStart),t.triangleCount+=c.outlineIndexCount/3)))}};return I._createClass(G)}(F);H.WGLBrushVTLFill=F;Object.defineProperty(H,Symbol.toStringTag,{value:"Module"})});