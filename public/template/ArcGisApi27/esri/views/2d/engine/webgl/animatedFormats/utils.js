// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ../../../../../symbols/cim/enums ../grouping".split(" "),function(h,A,g,B,k,t){function p(b){return g.Milliseconds(b.frameDurations.reduce((a,c)=>a+c,0))}function u(b){const {width:a,height:c}=b;return{frameDurations:b.frameDurations.reverse(),getFrame:f=>b.getFrame(b.frameDurations.length-1-f),width:a,height:c}}function v(b,a){const {width:c,
height:f,getFrame:d}=b,e=p(b),l=a/e;return{frameDurations:b.frameDurations.map(m=>g.Milliseconds(m*l)),getFrame:d,width:c,height:f}}function w(b,a){const {width:c,height:f,getFrame:d}=b;b=b.frameDurations.slice();const e=b.shift();b.unshift(g.Milliseconds(e+a));return{frameDurations:b,getFrame:d,width:c,height:f}}function q(b,a){const {width:c,height:f,getFrame:d}=b;b=b.frameDurations.slice();const e=b.pop();b.push(g.Milliseconds(e+a));return{frameDurations:b,getFrame:d,width:c,height:f}}function x(b,
a,c,f){let {repeatType:d}=a;null==d&&(d=k.AnimatedSymbolRepeatType.Loop);!0===a.reverseAnimation&&(b=u(b));null!=a.duration&&(b=v(b,g.Milliseconds(1E3*a.duration)));if(null!=a.repeatDelay){const e=1E3*a.repeatDelay;d===k.AnimatedSymbolRepeatType.Loop?b=q(b,g.Milliseconds(e)):d===k.AnimatedSymbolRepeatType.Oscillate&&(b=w(q(b,g.Milliseconds(e/2)),g.Milliseconds(e/2)))}null!=a.startTimeOffset?a=g.Milliseconds(1E3*a.startTimeOffset):null!=a.randomizeStartTime?(c=t.getMaterialGroup(c),a=t.getRandomValue(c,
null!=a.randomizeStartSeed?a.randomizeStartSeed:82749913),a=g.Milliseconds(a*p(b))):a=g.Milliseconds(0);return new y(b,a,d,f)}let y=function(){function b(a,c,f,d){this._animation=a;this._repeatType=f;this._onFrameData=d;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(a=0;c>a;)a+=this.timeToFrame,this.nextFrame();c=this._animation.getFrame(this._currentFrame);this._onFrameData(c)}b.prototype.nextFrame=function(){this._currentFrame+=this._direction;
if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case k.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case k.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case k.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case k.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case k.AnimatedSymbolRepeatType.Loop:this._currentFrame=
this._animation.frameDurations.length-1;break;case k.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const a=this._animation.getFrame(this._currentFrame);this._onFrameData(a)};return A._createClass(b)}();const r=document.createElement("canvas"),n=r.getContext("2d");h.Player=y;h.adjustDuration=v;h.appendDelay=q;h.createPlayer=x;h.getDuration=p;h.play=function(b,a,c,f){function d(){z=e?setTimeout(()=>
{l.nextFrame();m=l.timeToFrame;d()},m):void 0}const e=null!=a.playAnimation?a.playAnimation:!0,l=x(b,a,c,f);let m=l.timeToFrame,z;d();return{remove:()=>{e&&clearTimeout(z)}}};h.prependDelay=w;h.resize=function(b,a,c){r.width=a;r.height=c;const f=[],d=b.frameDurations.length;for(let e=0;e<d;e++){const l=b.getFrame(e);n.clearRect(0,0,a,c);l instanceof ImageData?n.drawImage(B.imageTypeToCanvas(l),0,0,a,c):n.drawImage(l,0,0,a,c);f.push(n.getImageData(0,0,a,c))}return{width:a,height:c,frameDurations:b.frameDurations,
getFrame:e=>f[e]}};h.reverse=u;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});