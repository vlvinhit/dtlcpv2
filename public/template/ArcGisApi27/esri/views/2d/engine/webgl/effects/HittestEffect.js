// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./Effect","../../../../webgl/enums"],function(n,p,h,k,q){k=function(r){function l(){var a=r.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["hittest"];return a}p._inherits(l,r);var g=l.prototype;g.dispose=function(){null!=this._fbo&&this._fbo.dispose()};g.createOptions=function({pixelRatio:a},b,e=h.HITTEST_RADIUS){if(!b.length)return null;b=b.shift();const m=b.x,d=b.y;this._outstanding=b;return{type:"hittest",
distance:e*a,position:[m,d]}};g.bind=function(a){const {context:b,attributeView:e}=a;e.size&&(a=e.getBlock(h.ATTRIBUTE_DATA_GPGPU),null!=a&&(a=a.getFBO(b),b.setViewport(0,0,e.size,e.size),b.bindFramebuffer(a),b.setColorMask(!0,!0,!0,!0),b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT)))};g.unbind=function(a){};g.draw=function(a){if(null!=this._outstanding){var b=this._outstanding;this._outstanding=null;this._resolve(a,b.resolvers)}};g._resolve=async function(a,b){const {context:e,
attributeView:m}=a;a=m.getBlock(h.ATTRIBUTE_DATA_GPGPU);if(null==a)b.forEach(c=>c.resolve([]));else{var d=a.getFBO(e);a=new Uint8Array(d.width*d.height*4);try{await d.readPixelsAsync(0,0,d.width,d.height,q.PixelFormat.RGBA,q.PixelType.UNSIGNED_BYTE,a)}catch(c){b.forEach(f=>f.resolve([]));return}d=[];for(let c=0;c<a.length;c+=4){const f=a[c+3];a[c]&&d.push({id:c/4,directHits:f})}d.sort((c,f)=>f.directHits===c.directHits?f.id-c.id:f.directHits-c.directHits);var t=d.map(c=>c.id);b.forEach(c=>c.resolve(t))}};
return p._createClass(l)}(k.Effect);n.HittestEffect=k;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});