// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(y,z,J,q,K,L,v,l){v=function(A){function w(){var b=A.apply(this,arguments)||this;b._programOptions={id:!1,pattern:!1,sdf:!1};return b}z._inherits(w,A);var B=w.prototype;B.dispose=function(){};B.drawMany=function(b,e){const {context:g,displayLevel:m,state:x,drawPhase:M,painter:N,pixelRatio:C,spriteMosaic:n,styleLayerUID:r,
requestRender:D,allowDelayedRender:O}=b;if(e.some(f=>f.layerData.get(r)?.lineIndexCount??!1)){b=b.styleLayer;var E=b.lineMaterial,P=N.vectorTilesMaterialManager,d=b.getPaintValue("line-translate",m),c=b.getPaintValue("line-translate-anchor",m),h=b.getPaintProperty("line-pattern"),t=void 0!==h,F=t&&h.isDataDriven;if(t&&!F){h=h.getValue(m);var k=n.getMosaicItemPosition(h)}var a;h=!1;if(!t){var p=b.getPaintProperty("line-dasharray");h=(a=void 0!==p)&&p.isDataDriven;a&&!h&&(k=p.getValue(m),k=b.getDashKey(k,
b.getLayoutValue("line-cap",m)),k=n.getMosaicItemPosition(k))}p=1/C;var G=M===K.WGLDrawPhase.HITTEST,u=this._programOptions;u.id=G;u.pattern=t;u.sdf=a;a=P.getMaterialProgram(g,E,u);if(O&&null!=D&&!a.compiled)D();else{g.useProgram(a);a.setUniformMatrix3fv("u_displayViewMat3",x.displayViewMat3);a.setUniformMatrix3fv("u_displayMat3",c===J.TranslateAnchor.VIEWPORT?x.displayMat3:x.displayViewMat3);a.setUniform2fv("u_lineTranslation",d);a.setUniform1f("u_depth",b.z);a.setUniform1f("u_antialiasing",p);G&&
(d=L.u32to4Xu8(r+1),a.setUniform4fv("u_id",d));k&&null!=k&&({page:d}=k,c=n.getPageSize(d),null!=c&&(n.bind(g,l.TextureSamplingMode.LINEAR,d,q.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_SPRITES)));d=-1;for(const f of e)if(f.layerData.has(r)&&(f.key.level!==d&&(d=f.key.level,E.setDataUniforms(a,m,b,d,n)),a.setUniform1f("u_zoomFactor",2**(m-d)/C),e=f.layerData.get(r),e.lineIndexCount&&(e.prepareForRendering(g),c=e.vao,null!=
c))){g.bindVAO(c);a.setUniformMatrix3fv("u_dvsMat3",f.transforms.dvs);g.setStencilFunction(l.CompareFunction.EQUAL,f.stencilRef,255);if(F||h){c=e.patternMap;if(!c)continue;for(const [H,I]of c)c=n.getPageSize(H),null!=c&&(n.bind(g,l.TextureSamplingMode.LINEAR,H,q.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.drawElements(l.PrimitiveType.TRIANGLES,I[1],l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*I[0]))}else g.drawElements(l.PrimitiveType.TRIANGLES,
e.lineIndexCount,l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart);f.triangleCount+=e.lineIndexCount/3}}}};return z._createClass(w)}(v);y.WGLBrushVTLLine=v;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});