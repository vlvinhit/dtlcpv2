// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(x,r,n,y,d,z,t,B,C,D,E,F){return function(A){function w(a,c,u){var b=A.call(this,a)||this;b._minMaxZoom=t.i1616to32(Math.round(c*d.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(u*d.MIN_MAX_ZOOM_PRECISION_FACTOR));
n.isFeatureValueFn(a.color)?b._dynamicPropertyMap.set("fillColor",(e,g,h)=>(e=a.color(e,g,h))&&y.premultiplyAlphaRGBA(e)||0):(c=a.color,b.fillColor=c&&y.premultiplyAlphaRGBA(c)||0);const k="CIMMarkerPlacementInsidePolygon"===a.cim.placement?.type&&a.cim.placement.shiftOddRows?2:1,f=a.height;n.isFeatureValueFn(f)?b._dynamicPropertyMap.set("_height",(e,g,h)=>f(e,g,h)*k):b._height=(f||0)*k;const l=a.offsetX;n.isFeatureValueFn(l)?b._dynamicPropertyMap.set("_offsetX",(e,g,h)=>r.pt2px(l(e,g,h))):b._offsetX=
r.pt2px(l||0);const m=a.offsetY;n.isFeatureValueFn(m)?b._dynamicPropertyMap.set("_offsetY",(e,g,h)=>r.pt2px(-m(e,g,h))):b._offsetY=r.pt2px(-m||0);c=a.scaleX;n.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_scaleX",c):b._scaleX=c||1;const v=a.angle;n.isFeatureValueFn(v)?b._dynamicPropertyMap.set("_angle",(e,g,h)=>z.degToByte(v(e,g,h))):b._angle=z.degToByte(v)||0;null!=a.effects&&(c=a.effects,n.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);b._cimFillLayer=a;b._bitset=(a.colorLocked?
d.BITSET_GENERIC_LOCK_COLOR:0)|(a.applyRandomOffset?d.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(a.sampleAlphaOnly?d.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(a.hasUnresolvedReplacementColor?d.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);b._fillMaterialKey=a.materialKey;return b}x._inherits(w,A);w.fromCIMFill=function(a,c){const [u,b]=C.getMinMaxZoom(a.scaleInfo,c);return new w(a,u,b)};w.prototype.bindFeature=function(a,c,u){const b=a.readLegacyFeature();this._dynamicPropertyMap.forEach((l,m)=>{this[m]=
l(b,c,u)});a=B.FillMaterialKey.load(this._fillMaterialKey);var k=this._materialCache,f=this._cimFillLayer.materialHash;f=f(b,c,u);f=k.get(f);k=null;f&&F.ok(f.spriteMosaicItem)&&(k=f.spriteMosaicItem);if(k){const {rect:l,width:m,height:v}=k;f=l.x+d.SPRITE_PADDING;const e=l.y+d.SPRITE_PADDING,g=f+m,h=e+v;let p=r.pt2px(this._height);0>=p&&(p=h-e);p<d.MAX_SIZE_FOR_U16_COMPRESSION&&(p*=d.COMPRESSION_FACTOR_FOR_U16,this._bitset|=d.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR);p=Math.round(p);let q=r.pt2px(this._height/
v*m);0>=q&&(q=g-f);q<d.MAX_SIZE_FOR_U16_COMPRESSION&&(q*=d.COMPRESSION_FACTOR_FOR_U16,this._bitset|=d.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR);q=Math.round(q);const G=this._scaleX;this.tl=t.i1616to32(f,e);this.br=t.i1616to32(g,h);this.aux21=t.i1616to32(q,p);this.aux22=t.i1616to32(this._offsetX,this._offsetY);this.aux3=t.i8888to32(G*d.COMPRESSION_FACTOR_FOR_U16,1*d.COMPRESSION_FACTOR_FOR_U16,this._angle,0);a.sdf=k.sdf;a.pattern=!0;a.textureBinding=k.textureBinding}else this.aux3=this.aux22=
this.aux21=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return x._createClass(w)}(D(E))});