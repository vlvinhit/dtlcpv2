// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/contextUtils ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexArrayObject".split(" "),
function(q,x,y,z,r,A,B,l,C,D,E,F,u,v,t,G,H,I){const n=C.create();return function(w){function p(c){var b=w.call(this)||this;b.elementView=c;b.isWrapAround=!1;b.perspectiveTransform=E.create();b._vertices=new Float32Array(20);b._handles=[];b._handles.push(l.watch(()=>b.elementView.element.opacity,a=>b.opacity=a,l.initial),l.watch(()=>[b.elementView.coords],()=>{b.requestRender()},l.initial),l.when(()=>b.elementView.element.loaded,()=>{const a=b.elementView.element;b.ready();"video"===a.type&&null!=
a.content&&b._handles.push(y.on(a.content,"play",()=>b.requestRender()))},l.initial));c.element.load().catch(a=>{z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new x("element-load-error","Element cannot be displayed",{element:c,error:a}))});return b}q._inherits(p,w);var m=p.prototype;m.destroy=function(){this._handles.forEach(c=>c.remove());this.texture=A.disposeMaybe(this.texture)};m.beforeRender=function(c){const {context:b}=c,a=this.elementView.element.content;if(null!=a){var d=a instanceof
HTMLImageElement;const h=a instanceof HTMLVideoElement,k=d?a.naturalWidth:h?a.videoWidth:a.width;d=d?a.naturalHeight:h?a.videoHeight:a.height;this._updatePerspectiveTransform(k,d);if(this.texture)h&&!a.paused&&(this.texture.setData(a),this.requestRender(),(b.type===v.ContextType.WEBGL2||r.isPowerOfTwo(k)&&r.isPowerOfTwo(d))&&this.texture.generateMipmap());else{const e=new H.TextureDescriptor;e.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;e.preMultiplyAlpha=!0;e.width=k;e.height=d;this.texture=new G.Texture(b,
e,a);(b.type===v.ContextType.WEBGL2||r.isPowerOfTwo(k)&&r.isPowerOfTwo(d))&&this.texture.generateMipmap();h&&!a.paused&&this.requestRender()}}q._get(q._getPrototypeOf(p.prototype),"beforeRender",this).call(this,c)};m._createTransforms=function(){return null};m.updateDrawCoords=function(c,b){var a=this.elementView.coords;if(null!=a){var [d,h,k,e]=a.rings[0];a=this._vertices;var {x:f,y:g}=c;(c=0!==b)?a.set([h[0]-f,h[1]-g,d[0]-f,d[1]-g,k[0]-f,k[1]-g,e[0]-f,e[1]-g,e[0]-f,e[1]-g,h[0]+b-f,h[1]-g,h[0]+b-
f,h[1]-g,d[0]+b-f,d[1]-g,k[0]+b-f,k[1]-g,e[0]+b-f,e[1]-g]):a.set([h[0]-f,h[1]-g,d[0]-f,d[1]-g,k[0]-f,k[1]-g,e[0]-f,e[1]-g]);this.isWrapAround=c}};m.getVAO=function(c,b,a){if(null==this.elementView.coords)return null;var d=this._vertices;this._vao?this._geometryVbo.setData(d):(this._geometryVbo=u.BufferObject.createVertex(c,t.Usage.DYNAMIC_DRAW,d),d=u.BufferObject.createVertex(c,t.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new I.VertexArrayObject(c,a,b,
{geometry:this._geometryVbo,tex:d}));return this._vao};m._updatePerspectiveTransform=function(c,b){const a=this._vertices;B.getProjectiveTransform(n,[0,0,c,0,0,b,c,b],[a[0],a[1],a[4],a[5],a[2],a[3],a[6],a[7]]);D.set(this.perspectiveTransform,n[6]/n[8]*c,n[7]/n[8]*b)};q._createClass(p,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return p}(F.DisplayObject)});