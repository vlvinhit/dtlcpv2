// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/capabilities/isWebGL2Context".split(" "),function(l,v,m,w,n,p,q,e,r,x,y,t,z){return function(u){function k(){var a=
u.apply(this,arguments)||this;a._color=v.fromValues(1,0,0,1);return a}l._inherits(k,u);var h=k.prototype;h.dispose=function(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._canvas=this._tileInfoVertexArrayObject=null};h.prepareState=function({context:a}){a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(e.BlendFactor.ONE,
e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!1)};h.draw=function(a,b){const {context:c,requestRender:d,allowDelayedRender:g}=a;if(b.isReady)if(this._loadWGLResources(c),!g||null==d||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){c.bindVAO(this._outlineVertexArrayObject);c.useProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);
this._outlineProgram.setUniform2f("u_coord_range",b.rangeX,b.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);c.drawArrays(e.PrimitiveType.LINE_STRIP,0,4);if(a=this._getTexture(c,b))c.bindVAO(this._tileInfoVertexArrayObject),c.useProgram(this._tileInfoProgram),c.bindTexture(a,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",
b.rangeX/b.width,b.rangeY/b.height),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",a.descriptor.width,a.descriptor.height),c.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,4);c.bindVAO()}else d()};h._loadWGLResources=function(a){if(!this._outlineProgram||!this._tileInfoProgram){var b=r.createProgram(a,n.background),c=r.createProgram(a,p.tileInfo),d=new Int8Array([0,0,1,0,1,1,0,1]);d=q.BufferObject.createVertex(a,e.Usage.STATIC_DRAW,d);d=new t.VertexArrayObject(a,
n.background.attributes,m.Pos2b,{geometry:d});var g=new Int8Array([0,0,1,0,0,1,1,1]);g=q.BufferObject.createVertex(a,e.Usage.STATIC_DRAW,g);a=new t.VertexArrayObject(a,p.tileInfo.attributes,m.Pos2b,{geometry:g});this._outlineProgram=b;this._tileInfoProgram=c;this._outlineVertexArrayObject=d;this._tileInfoVertexArrayObject=a}};h._getTexture=function(a,b){if(b.texture&&b.triangleCountReportedInDebug===b.triangleCount)return b.texture;b.triangleCountReportedInDebug=b.triangleCount;this._canvas||(this._canvas=
document.createElement("canvas"),this._canvas.setAttribute("id","tileCanvas2d"),this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var c=b.triangleCount;let d=b.key.id;0<b.triangleCount&&(d+=`, ${c}`);const g=this._canvas,f=g.getContext("2d");f.font="24px sans-serif";f.textAlign="left";f.textBaseline="top";f.clearRect(0,0,300,32);1E5<c?(f.fillStyle="red",f.fillRect(0,0,300,32),f.fillStyle="black"):(f.clearRect(0,0,300,
32),f.fillStyle="blue");f.fillText(d,0,0);c=new y.TextureDescriptor;c.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;c.samplingMode=e.TextureSamplingMode.NEAREST;c.isImmutable=z(a.gl);b.texture=new x.Texture(a,c,g);return b.texture};return l._createClass(k)}(w)});