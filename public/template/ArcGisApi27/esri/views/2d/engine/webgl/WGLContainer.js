// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3f32 ../brushes ../Container ./ClippingInfo ./enums".split(" "),function(d,t,n,p,q,r,e){return function(h){function f(){var a=h.apply(this,arguments)||this;a.name=a.constructor.name;return a}d._inherits(f,h);var c=f.prototype;c.beforeRender=function(a){d._get(d._getPrototypeOf(f.prototype),"beforeRender",this).call(this,a);this.updateTransforms(a.state)};c._createTransforms=function(){return{dvs:n.create()}};
c.doRender=function(a){a=this.createRenderParams(a);const {painter:b,globalOpacity:g,profiler:k,drawPhase:l}=a,m=l===e.WGLDrawPhase.LABEL||l===e.WGLDrawPhase.HIGHLIGHT?1:g*this.computedOpacity;k.recordContainerStart(this.name);b.beforeRenderLayer(a,this._clippingInfos?255:0,m);this.renderChildren(a);b.compositeLayer(a,m);k.recordContainerEnd()};c.renderChildren=function(a){null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(a.painter));for(const b of this._renderPasses)try{b.render(a)}catch(g){}};
c.createRenderParams=function(a){a.requireFBO=this.requiresDedicatedFBO;return a};c.prepareRenderPasses=function(a){return[a.registerRenderPass({name:"clip",brushes:[p.brushes.clip],target:()=>this._clippingInfos,drawPhase:e.WGLDrawPhase.MAP|e.WGLDrawPhase.LABEL|e.WGLDrawPhase.LABEL_ALPHA|e.WGLDrawPhase.DEBUG|e.WGLDrawPhase.HIGHLIGHT})]};c.updateTransforms=function(a){for(const b of this.children)b.setTransform(a)};c.onAttach=function(){d._get(d._getPrototypeOf(f.prototype),"onAttach",this).call(this);
this._updateClippingInfo()};c.onDetach=function(){d._get(d._getPrototypeOf(f.prototype),"onDetach",this).call(this);this._updateClippingInfo()};c._updateClippingInfo=function(){null!=this._clippingInfos&&(this._clippingInfos.forEach(g=>g.destroy()),this._clippingInfos=null);const a=this.stage;if(a){var b=this._clips;null!=b&&b.length&&(this._clippingInfos=b.items.map(g=>r.fromClipArea(a,g)));this.requestRender()}};d._createClass(f,[{key:"clips",set:function(a){this._clips=a;this.children.forEach(b=>
b.clips=a);this._updateClippingInfo()}}]);return f}(q.Container)});