// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./Effect","../../../../webgl/enums"],function(r,t,y,n,u){n=function(v){function p(){var a=v.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._lastSize=0;a._boundFBO=null;return a}t._inherits(p,v);var g=p.prototype;g.dispose=function(){null!=this._fbo&&this._fbo.dispose()};g.bind=function({context:a,painter:e}){const {width:d,height:k}=a.getViewport();this._boundFBO=a.getBoundFramebufferObject();
e=e.getFbos(d,k).effect0;a.bindFramebuffer(e);a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};g.unbind=function({context:a}){a.bindFramebuffer(this._boundFBO);this._boundFBO=null};g.draw=function(a,e,d=2*y.HITTEST_RADIUS){this._resolve(a,e,d)};g._resolve=async function({context:a,state:e,pixelRatio:d},k,z){const A=a.getBoundFramebufferObject(),B=e.size[1]*d,b=Math.round(z*d),w=b/2,x=b/2;this._ensureBuffer(b);k.forEach(async(C,q)=>{var h=new Map;await A.readPixelsAsync(Math.floor(q.x*
d-b/2),Math.floor(B-q.y*d-b/2),b,b,u.PixelFormat.RGBA,u.PixelType.UNSIGNED_BYTE,this._buf);for(let c=0;c<this._buf32.length;c++){const f=this._buf32[c];if(4294967295!==f&&0!==f){var l=c%b,m=b-Math.floor(c/b);l=(w-l)*(w-l)+(x-m)*(x-m);m=h.has(f)?h.get(f):4294967295;h.set(f,Math.min(l,m))}}h=Array.from(h).sort((c,f)=>c[1]-f[1]).map(c=>c[0]);C.resolve(h);k.delete(q)})};g._ensureBuffer=function(a){this._lastSize!==a&&(this._lastSize=a,this._buf=new Uint8Array(4*a*a),this._buf32=new Uint32Array(this._buf.buffer))};
return t._createClass(p)}(n.Effect);r.HittestEffectVTL=n;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});