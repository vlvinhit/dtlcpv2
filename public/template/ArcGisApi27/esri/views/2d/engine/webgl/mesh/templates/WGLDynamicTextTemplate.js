// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(q,m,z,d,t,n,r,A,B,C,D,E,F){return function(u){function p(a,e,c){var b=u.call(this,a)||this;b._horizontalAlignment="center";b._verticalAlignment=
"middle";b._textToGlyphs=new Map;b._minMaxZoom=A.i1616to32(Math.round(e*r.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(c*r.MIN_MAX_ZOOM_PRECISION_FACTOR));e=a.scaleFactor||1;b._cimTextLayer=a;const k=a.color;d.isFeatureValueFn(k)?b._dynamicPropertyMap.set("_color",(f,g,h)=>n.premultiplyAlphaRGBA(k(f,g,h))):b._color=n.premultiplyAlphaRGBA(k);const l=a.outlineColor;d.isFeatureValueFn(l)?b._dynamicPropertyMap.set("_haloColor",(f,g,h)=>n.premultiplyAlphaRGBA(l(f,g,h))):b._haloColor=n.premultiplyAlphaRGBA(l);
let v;d.isFeatureValueFn(a.size)||(v=Math.min(Math.round(m.pt2px(a.size*a.sizeRatio)),127));b._dynamicPropertyMap.set("_size",(f,g,h)=>d.isFeatureValueFn(a.size)?Math.min(Math.round(m.pt2px(a.size(f,g,h)*a.sizeRatio)),127):v);d.isFeatureValueFn(a.outlineSize)?b._dynamicPropertyMap.set("_haloSize",(f,g,h)=>Math.min(Math.floor(5*m.pt2px(a.outlineSize(f,g,h)*a.sizeRatio)),127)):b._haloSize=Math.min(Math.floor(5*m.pt2px(a.outlineSize*a.sizeRatio)),127);let w;d.isFeatureValueFn(a.offsetX)||(w=Math.round(m.pt2px(a.offsetX*
a.sizeRatio)));b._dynamicPropertyMap.set("_xOffset",(f,g,h)=>d.isFeatureValueFn(a.offsetX)?Math.round(m.pt2px(a.offsetX(f,g,h)*a.sizeRatio)):w);let x;d.isFeatureValueFn(a.offsetY)||(x=Math.round(m.pt2px(a.offsetY*a.sizeRatio)));b._dynamicPropertyMap.set("_yOffset",(f,g,h)=>d.isFeatureValueFn(a.offsetY)?Math.round(m.pt2px(a.offsetY(f,g,h)*a.sizeRatio)):x);d.isFeatureValueFn(a.angle)?b._dynamicPropertyMap.set("_angle",a.angle):b._angle=a.angle;d.isFeatureValueFn(a.horizontalAlignment)?b._dynamicPropertyMap.set("_horizontalAlignment",
a.horizontalAlignment):b._horizontalAlignment=a.horizontalAlignment;d.isFeatureValueFn(a.verticalAlignment)?b._dynamicPropertyMap.set("_verticalAlignment",a.verticalAlignment):b._verticalAlignment=a.verticalAlignment;null!=a.effects&&(c=a.effects,d.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);null!=a.markerPlacement&&(c=a.markerPlacement,d.isFeatureValueFn(c)?b._dynamicPropertyMap.set("_markerPlacement",c):b._textPlacement=c);d.isFeatureValueFn(a.text)?b._dynamicPropertyMap.set("_text",
a.text):b._text=a.text;b._backgroundColor=a.backgroundColor&&n.premultiplyAlphaRGBA(a.backgroundColor);b._borderLineColor=a.borderLineColor&&n.premultiplyAlphaRGBA(a.borderLineColor);b._borderLineSize=a.borderLineWidth;b._scaleFactor=e;e=Math.min(Math.round(m.pt2px(a.referenceSize*a.sizeRatio)),127);b._referenceSize=Math.round(Math.sqrt(256*e));b._materialKey=a.materialKey;e=B.TextMaterialKey.load(b._materialKey);e.sdf=!0;b._bitset=(a.alignment===z.Alignment.MAP?1:0)|(a.colorLocked?1:0)<<1;b._materialKey=
e.data;b._decoration="none";b._lineHeight=1;b._lineWidth=512;b._isCIM=!0;return b}q._inherits(p,u);p.fromCIMText=function(a,e){const [c,b]=C.getMinMaxZoom(a.scaleInfo,e);return new p(a,c,b)};var y=p.prototype;y.analyze=async function(a,e,c,b){var k=e.readLegacyFeature();var l=this._cimTextLayer;k="string"===typeof l.text?l.text:"function"===typeof l.text?l.text(k,c,b)??"":"";(a=await q._get(q._getPrototypeOf(p.prototype),"analyze",this).call(this,a,e,c,b,F.codepoints(k)))&&a.glyphMosaicItems&&this._textToGlyphs.set(k,
a.glyphMosaicItems);return a};y.bindFeature=function(a,e,c){const b=a.readLegacyFeature();this._dynamicPropertyMap.forEach((k,l)=>{this[l]=k(b,e,c)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/r.GLYPH_SIZE,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=t.getXAnchorDirection(this._horizontalAlignment??"center"),this._yAlignD=t.getYAnchorDirection(this._verticalAlignment??"baseline"),a=this._textToGlyphs.get(this._text)??
[],this.bindTextInfo(a,!1)):this._shapingInfo=null};return q._createClass(p)}(D(E))});