// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Handles ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/boundedPlane ../../../../../geometry/support/spatialReferenceUtils ./Manipulation ./utils ../../../../interactive/dragEventPipeline ../../../../interactive/GraphicManipulator ../../../../interactive/editGeometry/interfaces ../../../../interactive/editGeometry/operations/UpdateVertices ../../../../interactive/editGeometry/support/editPlaneUtils".split(" "),
function(A,I,O,J,P,d,v,t,Q,K,R,L,S,M,T,U){function B(k){const u=d.length(k.basis1);k=d.length(k.basis2);return.3*Math.min(u,k)}let X=function(k){function u(f){var a=k.call(this)||this;a._handles=new O;a._planeStart=t.create();a._displayPlaneStart=t.create();a._originCache=v.create();a._axisCache=P.create();a._renderStartCache=v.create();a._renderEndCache=v.create();a._resizeOriginCache=v.create();a._view=f.view;a._tool=f.tool;a._graphic=f.graphic;a._direction=f.direction;a._preserveAspectRatio=f.preserveAspectRatio;
a._manipulator=a._createManipulator();a._handles.add([a._manipulator.events.on("grab-changed",h=>R.onGrabChangedHandle(h,a._manipulator))]);a.forEachManipulator(h=>a._tool.manipulators.add(h));return a}I._inherits(u,k);var w=u.prototype;w.destroy=function(){this._handles.destroy();this.forEachManipulator(f=>{this._tool.manipulators.remove(f);f.destroy()});this._preserveAspectRatio=this._resizeOriginCache=this._renderEndCache=this._renderStartCache=this._axisCache=this._originCache=this._displayPlaneStart=
this._planeStart=this._handles=this._direction=this._manipulator=this._graphic=this._view=this._tool=null};w.forEachManipulator=function(f){f(this._manipulator,K.ManipulatorType.SCALE)};w.createDragPipeline=function(f,a){let h=null,C=null,r=null,D=0,E=null,F=null;const l=this._planeStart,m=this._displayPlaneStart,g=this._direction;return L.createManipulatorDragEventPipeline(this._manipulator,(N,V)=>{V.next(c=>{if("start"===c.action){N.cursor="grabbing";var b=f();h=b.plane;C=b.displayPlane;r=b.editGeometryOperations;
D=10*this._view.resolution;t.copy(h,l);t.copy(C,m);E=(b=Q.getInfo(r.data.spatialReference))?b.valid[1]-b.valid[0]-30*this._view.resolution:null}return c}).next(L.screenToMap(this._view)).next(c=>{const b=d.copy(this._renderStartCache,[c.mapStart.x,c.mapStart.y,0]),n=d.copy(this._renderEndCache,[c.mapEnd.x,c.mapEnd.y,0]);var e=d.copy(this._resizeOriginCache,m.origin);d.scaleAndAdd(e,e,m.basis1,-g[0]);d.scaleAndAdd(e,e,m.basis2,-g[1]);d.subtract(n,n,e);d.subtract(b,b,e);const G=0!==g[0]&&0!==g[1];e=
B(m);const W=B(C)/e;var z=(p,H)=>{if(0===p)return 1;let q=d.length(H),x=.5*p*d.dot(H,n)/q;const y=0>x?-1:1;G&&(p=q-.5*p*d.dot(H,b)/q,x+=p*y*W);p=q<1.5*D?1:1E-6;q=Math.max(q-D,1E-6);0<y&&(x-=10*this._view.resolution);return y*Math.max(x/q*y,p)};e=z(g[0],m.basis1);z=z(g[1],m.basis2);return{...c,direction:g,factor1:e,factor2:z}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(c=>{var b=d.copy(this._originCache,l.origin);d.scaleAndAdd(b,b,l.basis1,-g[0]);
d.scaleAndAdd(b,b,l.basis2,-g[1]);const n=J.set(this._axisCache,l.basis1[0],l.basis1[1]);J.normalize(n,n);const e=[];for(const G of r.data.components)e.push(...G.vertices);b=r.scaleVertices(e,b,n,c.factor1,c.factor2,"start"===c.action?M.AccumulationBehaviour.NEW_STEP:M.AccumulationBehaviour.ACCUMULATE_STEPS,T.AccumulationType.REPLACE);E&&E<r.data.geometry.extent.width&&F?r.updateVertices(e,F):(t.copy(l,h),U.apply(b,h),F=b.operation,a(c,b));return c}).next(c=>{"end"===c.action&&(N.cursor="grab");return c})})};
w._createManipulator=function(){return new S.GraphicManipulator({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})};return I._createClass(u)}(K.Manipulation);A.ScaleManipulation=X;A.calculateDiagonalResizeHandleScale=B;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});