// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ControlPointsTransformTool ./TransformTool".split(" "),function(c,p,f,u,l,g,B,C,D,v,q,w){const k={redo:"r",undo:"z"};c.MediaTransformToolsWrapper=function(r){function m(a){a=
r.call(this,a)||this;a._transformTool=null;a._controlPointsTransformTool=null;a._advancedModeTransformTool=null;a._activeTool=null;a._sharedUndoStack=[];a._sharedRedoStack=[];a._originalOpacity=null;a.activeHandle=0;return a}p._inherits(m,r);var d=m.prototype;d.initialize=function(){const {view:a,mediaElement:e,preserveAspectRatio:x,snapRotation:y,advancedMode:h}=this;this._originalOpacity=e.opacity;this._transformTool=new w.TransformTool({target:e,view:a,preserveAspectRatio:x,snapRotation:y});this._controlPointsTransformTool=
new q.ControlPointsTransformTool({mediaElement:e,view:a});this._advancedModeTransformTool=new q.ControlPointsTransformTool({mediaElement:h.mediaElement,view:h.view});this._transformTool.setSharedUndoStack(this._sharedUndoStack);this._transformTool.setSharedRedoStack(this._sharedRedoStack);this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack);this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack);this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack);
this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const n=e.georeference,t=h.mediaElement.georeference;h.view.tools.addMany([this._advancedModeTransformTool]);"controlPoints"in t&&"controlPoints"in n&&this.addHandles([h.view.on("key-down",b=>{b.key===k.undo&&this.canUndo()&&(this.undo(),b.stopPropagation());b.key===k.redo&&this.canRedo()&&(this.redo(),b.stopPropagation())}),h.view.on("focus",async b=>{this._controlPointsTransformTool.removeHighlightActiveHandle();this._advancedModeTransformTool.highlightActiveHandle()}),
l.watch(()=>t.controlPoints,b=>{n.controlPoints=b.map(({sourcePoint:z},A)=>({sourcePoint:z,mapPoint:n.controlPoints[A].mapPoint}));this._activeTool?.refresh()}),l.watch(()=>this._controlPointsTransformTool.activeHandle,b=>{this._advancedModeTransformTool.updateActiveHandle(b);this.activeHandle=b}),l.watch(()=>this._advancedModeTransformTool.activeHandle,b=>{this._controlPointsTransformTool.updateActiveHandle(b);this.activeHandle=b})]);this.addHandles([a.on("key-down",b=>{b.key===k.undo&&this.canUndo()&&
(this.undo(),b.stopPropagation());b.key===k.redo&&this.canRedo()&&(this.redo(),b.stopPropagation())}),a.on("focus",async b=>{this._advancedModeTransformTool.removeHighlightActiveHandle();this._controlPointsTransformTool.highlightActiveHandle()})]);a.tools.addMany([this._transformTool,this._controlPointsTransformTool]);this._activeTool=a.activeTool=this._transformTool;a.focus()};d.destroy=function(){this._transformTool?.destroy();this._controlPointsTransformTool?.destroy();this._sharedRedoStack=this._sharedUndoStack=
this._activeTool=this._advancedModeTransformTool=this._controlPointsTransformTool=this._transformTool=null};d.canUndo=function(){return 0<this._sharedUndoStack.length};d.canRedo=function(){return 0<this._sharedRedoStack.length};d.undo=function(){if(0<this._sharedUndoStack.length){const {tool:a,operation:e}=this._sharedUndoStack.pop();a!==this._activeTool&&a.refresh();e.undo();a.updateGraphics();this._sharedRedoStack.push({tool:a,operation:e});this._activeTool!==a&&this._activeTool?.refresh()}};d.redo=
function(){if(0<this._sharedRedoStack.length){const {tool:a,operation:e}=this._sharedRedoStack.pop();a!==this._activeTool&&a.refresh();e.apply();a.updateGraphics();this._sharedUndoStack.push({tool:a,operation:e});this._activeTool!==a&&this._activeTool?.refresh()}};d.refresh=function(){this._activeTool.refresh()};d.reset=function(){this._activeTool.reset();this._advancedModeTransformTool.reset()};d.enableAdvancedMode=async function(){this._activeTool=this.view.activeTool=this._controlPointsTransformTool;
this._activeTool.refresh();await this.advancedMode.view.when();this.advancedMode.view.activeTool=this._advancedModeTransformTool;this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity;this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity};d.disableAdvancedMode=function(){this._activeTool=this.view.activeTool=this._transformTool;this._activeTool.refresh();this.advancedMode.view.activeTool=null;this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity};
return p._createClass(m)}(u);f.__decorate([g.property()],c.MediaTransformToolsWrapper.prototype,"activeHandle",void 0);f.__decorate([g.property({constructOnly:!0})],c.MediaTransformToolsWrapper.prototype,"advancedMode",void 0);f.__decorate([g.property()],c.MediaTransformToolsWrapper.prototype,"preserveAspectRatio",void 0);f.__decorate([g.property()],c.MediaTransformToolsWrapper.prototype,"snapRotation",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],c.MediaTransformToolsWrapper.prototype,
"mediaElement",void 0);f.__decorate([g.property({constructOnly:!0})],c.MediaTransformToolsWrapper.prototype,"view",void 0);c.MediaTransformToolsWrapper=f.__decorate([v.subclass("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],c.MediaTransformToolsWrapper);c.KEYS=k;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});