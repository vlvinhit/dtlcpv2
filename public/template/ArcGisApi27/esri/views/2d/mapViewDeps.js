// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/events ../../../core/has ../../../core/maybe ../../../core/scheduling ../../../chunks/mat3f32 ../../../symbols/cim/CIMResourceManager ./Container ./webgl/BufferPool ./webgl/enums ./webgl/Painter ./webgl/Profiler ../support/Timeline ../../support/screenshotUtils ../../webgl/contextUtils ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/RenderbufferDescriptor ../../webgl/RenderingContext ../../webgl/TextureDescriptor ../../webgl/capabilities/isWebGL2Context ../../../core/imageUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w,z,r){let C=function(x){function E(G,H){var I=x.call(this)||this;I._trash=new Set;I._renderRemainingTime=0;I._lastFrameRenderTime=0;I.renderRequested=!1;I.stage=l._assertThisInitialized(I);I._stationary=!0;const {canvas:J=document.createElement("canvas"),alpha:L=!0,stencil:K=!0,contextOptions:S={}}=H;I._canvas=J;const W=p.createContextForView("2d",J,{alpha:L,antialias:!1,depth:!0,stencil:K});I.context=new y.RenderingContext(W??null,S);I.resourceManager=
new f;I.painter=new b(I.context,l._assertThisInitialized(I),I.resourceManager);A("esri-2d-profiler")&&(I._debugOutput=document.createElement("div"),I._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),G.appendChild(I._debugOutput));I._renderParameters={drawPhase:0,state:I.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:I.context,painter:I.painter,timeline:H.timeline||
new e.Timeline,renderingOptions:H.renderingOptions,requestRender:()=>I.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new g.Profiler(I.context,I._debugOutput),dataUploadCounter:0,get highlightGradient(){return I._highlightGradient}};I._taskHandle=m.addFrameTask({render:X=>I.renderFrame(X)});I._taskHandle.pause();I._lostWebGLContextHandle=D.on(J,"webglcontextlost",X=>{I.emit("webgl-error",{error:new F("webgl-context-lost",X.statusMessage)})});I._bufferPool=new c.BufferPool;J.setAttribute("style",
"width: 100%; height:100%; display:block;");G.appendChild(J);return I}l._inherits(E,x);var B=E.prototype;B.destroy=function(){this.removeAllChildren();this._emptyTrash();this._taskHandle=u.removeMaybe(this._taskHandle);this._lostWebGLContextHandle=u.removeMaybe(this._lostWebGLContextHandle);this._canvas.parentNode?.removeChild(this._canvas);this._debugOutput?.parentNode?.removeChild(this._debugOutput);this._bufferPool.destroy();this.resourceManager.destroy();this.painter.dispose();this.context.dispose();
this._canvas=null};B.trashDisplayObject=function(G){this._trash.add(G);this.requestRender()};B.untrashDisplayObject=function(G){return this._trash.delete(G)};B.requestRender=function(){this._renderRemainingTime=2E3;this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())};B.renderFrame=function(G){this._renderRemainingTime-=this._lastFrameRenderTime?G.time-this._lastFrameRenderTime:0;0>=this._renderRemainingTime&&this._taskHandle.pause();this._lastFrameRenderTime=
G.time;this.renderRequested=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this._renderParameters.time=G.time;this._renderParameters.deltaTime=G.deltaTime;this._renderParameters.effects=null;this.processRender(this._renderParameters);this._emptyTrash();this.emit("post-render")};B._createTransforms=function(){return{dvs:h.create()}};B.renderChildren=function(G){for(const H of this.children)H.beforeRender(G);
this._renderChildren(this.children,G);for(const H of this.children)H.afterRender(G)};B._renderChildren=function(G,H){const I=this.context;this.painter.textureUploadManager.upload();I.resetInfo();H.profiler.recordStart("drawLayers");H.dataUploadCounter=0;H.drawPhase=a.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(I,this.backgroundColor);for(const J of G)J.processRender(H);this.painter.prepareDisplay(H,this.backgroundColor,this.state.padding);this.painter.renderLayers(I);H.drawPhase=a.WGLDrawPhase.HIGHLIGHT;
this.painter.beforeRenderLayers(I);for(const J of G)J.processRender(H);this.painter.renderLayers(I);if(this._isLabelDrawPhaseRequired(G)){H.drawPhase=a.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(I);for(const J of G)J.processRender(H);this.painter.renderLayers(I)}if(A("esri-tiles-debug")){H.drawPhase=a.WGLDrawPhase.DEBUG;this.painter.beforeRenderLayers(I);for(const J of G)J.processRender(H);this.painter.renderLayers(I)}H.profiler.recordEnd("drawLayers");I.logInfo()};B.doRender=function(G){const H=
this.context,{state:I,pixelRatio:J}=G;this._resizeCanvas(G);H.setViewport(0,0,J*I.size[0],J*I.size[1]);H.setDepthWriteEnabled(!0);H.setStencilWriteMask(255);l._get(l._getPrototypeOf(E.prototype),"doRender",this).call(this,G)};B.takeScreenshot=async function(G){var H=Math.round(this.state.size[0]*G.resolutionScale);const I=Math.round(this.state.size[1]*G.resolutionScale);var J=G.resolutionScale,L=this.context,K=this._state.clone();if(null!=G.rotation){var S=K.viewpoint;K.viewpoint.rotation=G.rotation;
K.viewpoint=S}K={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:K,pixelRatio:J,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1};J=z(L.gl);S=new w.TextureDescriptor(H,I);S.wrapMode=q.TextureWrapMode.CLAMP_TO_EDGE;S.internalFormat=J?q.SizedPixelFormat.RGBA8:q.PixelFormat.RGBA;S.isImmutable=J;J=new t.FramebufferObject(L,S,new v.RenderbufferDescriptor(q.RenderbufferFormat.DEPTH_STENCIL,H,I));S=L.getBoundFramebufferObject();const W=L.getViewport();
L.bindFramebuffer(J);L.setViewport(0,0,H,I);this._renderChildren(G.children,K);H=this._readbackScreenshot(J,{...G.cropArea,y:I-(G.cropArea.y+G.cropArea.height)});L.bindFramebuffer(S);L.setViewport(W.x,W.y,W.width,W.height);this.requestRender();L=await H;1===G.outputScale?G=L:(G=new ImageData(Math.round(L.width*G.outputScale),Math.round(L.height*G.outputScale)),k.resampleHermite(L,G,!0));J.dispose();return G};B._readbackScreenshot=async function(G,H){const I=r.createEmptyImageData(H.width,H.height,
document.createElement("canvas"));await G.readPixelsAsync(H.x,H.y,H.width,H.height,q.PixelFormat.RGBA,q.PixelType.UNSIGNED_BYTE,new Uint8Array(I.data.buffer));return I};B._resizeCanvas=function(G){const H=this._canvas,I=H.style,{state:{size:J},pixelRatio:L}=G;G=J[0];const K=J[1],S=Math.round(G*L),W=Math.round(K*L);if(H.width!==S||H.height!==W)H.width=S,H.height=W;I.width=G+"px";I.height=K+"px"};B._emptyTrash=function(){for(;0<this._trash.size;){const G=Array.from(this._trash);this._trash.clear();
for(const H of G)H.processDetach()}};B._isLabelDrawPhaseRequired=function(G){let H=!1;for(const I of G){if(!(I instanceof d.Container)){H=H||!1;break}if("hasLabels"in I&&I.hasLabels)return!0;H=H||this._isLabelDrawPhaseRequired(I.children)}return H};l._createClass(E,[{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(G){this._backgroundColor=G;this.requestRender()}},{key:"bufferPool",get:function(){return this._bufferPool}},{key:"renderingOptions",get:function(){return this._renderingOptions},
set:function(G){this._renderingOptions=G;this.requestRender()}},{key:"state",get:function(){return this._state},set:function(G){this._state=G;this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(G){this._stationary!==G&&(this._stationary=G,this.requestRender())}}]);return E}(d.Container);n.EXTRA_RENDER_TIME=2E3;n.Stage=C;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMResourceManager":function(){define("../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/fontUtils ../../core/promiseUtils ../../support/base64Utils ../../views/2d/engine/webgl/animatedFormats/apng ../../views/2d/engine/webgl/animatedFormats/gif".split(" "),
function(n,l,F,D,A,u,m,h){async function f(a,b){a=window.URL.createObjectURL(a);try{const {data:g}=await l(a,{...b,responseType:"image"});return g}catch(g){if(!A.isAbortError(g))throw new F("mapview-invalid-resource",`Could not fetch requested resource at ${a}`);throw g;}finally{window.URL.revokeObjectURL(a)}}async function d(a,b){const {arrayBuffer:g,mediaType:e}=await c(a,b);a="image/png"===e;if("image/gif"===e&&h.isAnimatedGIF(g))return h.parseGif(g);if(a&&m.isAnimatedPNG(g))return m.parseApng(g,
b);a=new Blob([g],{type:e});return f(a,b)}async function c(a,b){if(a.includes(";base64,")){b=a.indexOf(";base64,");var g=a.indexOf(";base64,")+8;g=a.substring(g);g=u.base64ToArrayBuffer(g);a=a.substring(0,b).replace("data:","");g={arrayBuffer:g,mediaType:a}}else try{const e=await l(a,{responseType:"array-buffer",...b}),k=e.data,p=e.getHeader("Content-Type");g={arrayBuffer:k,mediaType:p}}catch(e){if(!A.isAbortError(e))throw new F("mapview-invalid-resource",`Could not fetch requested resource at ${a}`);
}return g}return function(){function a(){this._resourceMap=new Map;this._inFlightResourceMap=new Map;this.geometryEnginePromise=this.geometryEngine=null}var b=a.prototype;b.destroy=function(){this._inFlightResourceMap.clear();this._resourceMap.clear()};b.getResource=function(g){return this._resourceMap.get(g)??null};b.fetchResource=async function(g,e){var k=this._resourceMap.get(g);if(k)return{width:k.width,height:k.height};if(k=this._inFlightResourceMap.get(g))return k.then(p=>({width:p.width,height:p.height}));
k=d(g,e);this._inFlightResourceMap.set(g,k);return k.then(p=>{this._inFlightResourceMap.delete(g);this._resourceMap.set(g,p);return{width:p.width,height:p.height}},()=>({width:0,height:0}))};b.deleteResource=function(g){this._inFlightResourceMap.delete(g);this._resourceMap.delete(g)};b.loadFont=function(g){return D.loadFont(g)};return n._createClass(a)}()})},"esri/core/fontUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../config"],function(n,l,F){function D(f){if(!f)return"arial-unicode-ms";
f=f.toLowerCase().split(" ").join("-");switch(f){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return f}}function A(f){a:{if(f.weight)switch(f.weight.toLowerCase()){case "bold":case "bolder":var d="-bold";break a}d=""}a:{if(f.style)switch(f.style.toLowerCase()){case "italic":case "oblique":var c="-italic";break a}c=""}d+=c;return D(f.family)+(0<d.length?d:
"-regular")}const u=new Map,m=new Set;let h=l._createClass(function(f,d){this.fontFace=f;this.promise=d});n.DEFAULT_FONT_FAMILY="arial-unicode-ms";n.clearFonts=function(){const f=document.fonts;u.forEach(d=>{f.delete(d.fontFace)});u.clear();m.clear()};n.getFontFamily=D;n.getFullyQualifiedFontName=A;n.isCachedFontFace=function(f){return m.has(f)};n.loadFont=async function(f){const d=A(f),c=u.get(d);if(c)return c.promise;const a=new FontFace(f.family,`url('${F.fontsUrl}/woff2/${d}.${"woff2"}') format('${"woff2"}')`,
{style:f.style,weight:f.weight}),b=document.fonts;if(b.has(a)&&"loading"===a.status)return a.loaded;f=a.load().then(()=>{b.add(a);return a});u.set(d,new h(a,f));m.add(a);return f};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/apng":function(){define(["exports","../../../../../chunks/index3","../../../../../core/promiseUtils","../../../../../core/time"],function(n,l,F,D){function A(m){const h=new Uint8Array(m);return!u.some((f,d)=>f!==h[d])}
const u=[137,80,78,71,13,10,26,10];n.isAnimatedPNG=function(m){if(!A(m))return!1;const h=new DataView(m);m=new Uint8Array(m);let f=8,d;do{const c=h.getUint32(f);d=String.fromCharCode.apply(String,Array.prototype.slice.call(m.subarray(f+4,f+8)));if("acTL"===d)return!0;f+=12+c}while("IEND"!==d&&f<m.length);return!1};n.isPNG=A;n.parseApng=async function(m,h){m=l.parseApng3rdParty(m);if(m instanceof Error)throw m;await m.createImages();F.throwIfAborted(h);const {frames:f,width:d,height:c}=m;h=document.createElement("canvas");
h.width=d;h.height=c;h=h.getContext("2d",{willReadFrequently:!0});const a=[];m=[];for(const g of f){m.push(D.Milliseconds(g.delay||100));var b=g.imageElement;h.globalCompositeOperation=0===g.blendOp?"copy":"source-over";const e=2===g.disposeOp?h.getImageData(g.left,g.top,g.width,g.height):void 0;h.drawImage(b,g.left,g.top);b=h.getImageData(0,0,d,c);a.push(b);0!==g.disposeOp&&(1===g.disposeOp?h.clearRect(g.left,g.top,g.width,g.height):2===g.disposeOp&&h.putImageData(e,g.left,g.top))}return{frameDurations:m,
getFrame:g=>a[g],width:d,height:c}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/index3":function(){define(["exports","./_commonjsHelpers"],function(n,l){var F={exports:{}};F.exports;(function(D,A){(function(u,m){D.exports=m()})(l.commonjsGlobal,function(){return function(u){function m(f){if(h[f])return h[f].exports;var d=h[f]={exports:{},id:f,loaded:!1};u[f].call(d.exports,d,d.exports,m);d.loaded=!0;return d.exports}var h={};m.m=u;m.c=h;m.p="";return m(0)}([function(u,
m,h){function f(q,t){var v=new DataView(q.buffer),y=8,w=void 0,z=void 0,r=void 0;do z=v.getUint32(y),w=y+4,w=Array.prototype.slice.call(q.subarray(w,w+4)),w=String.fromCharCode.apply(String,w),r=t(w,q,y,z),y+=12+z;while(!1!==r&&"IEND"!=w&&y<q.length)}function d(q,t,v){var y=new Uint8Array(v);y.set(q.subarray(t,t+v));return y}Object.defineProperty(m,"__esModule",{value:!0});m.isNotPNG=function(q){return q===b};m.isNotAPNG=function(q){return q===g};m.default=function(q){var t=new Uint8Array(q);if(Array.prototype.some.call(e,
function(G,H){return G!==t[H]}))return b;var v=!1;f(t,function(G){return!(v="acTL"===G)});if(!v)return g;var y=[],w=[],z=null,r=null,C=0,x=new a.APNG;f(t,function(G,H,I,J){var L=new DataView(H.buffer);switch(G){case "IHDR":z=H.subarray(I+8,I+8+J);x.width=L.getUint32(I+8);x.height=L.getUint32(I+12);break;case "acTL":x.numPlays=L.getUint32(I+8+4);break;case "fcTL":r&&(x.frames.push(r),C++);r=new a.Frame;r.width=L.getUint32(I+8+4);r.height=L.getUint32(I+8+8);r.left=L.getUint32(I+8+12);r.top=L.getUint32(I+
8+16);G=L.getUint16(I+8+20);H=L.getUint16(I+8+22);0===H&&(H=100);r.delay=1E3*G/H;10>=r.delay&&(r.delay=100);x.playTime+=r.delay;r.disposeOp=L.getUint8(I+8+24);r.blendOp=L.getUint8(I+8+25);r.dataParts=[];0===C&&2===r.disposeOp&&(r.disposeOp=1);break;case "fdAT":r&&r.dataParts.push(H.subarray(I+8+4,I+8+J));break;case "IDAT":r&&r.dataParts.push(H.subarray(I+8,I+8+J));break;case "IEND":w.push(d(H,I,12+J));break;default:y.push(d(H,I,12+J))}});r&&x.frames.push(r);if(0==x.frames.length)return g;var E=new Blob(y),
B=new Blob(w);x.frames.forEach(function(G){var H=[];H.push(e);z.set(p(G.width),0);z.set(p(G.height),4);H.push(k("IHDR",z));H.push(E);G.dataParts.forEach(function(I){return H.push(k("IDAT",I))});H.push(B);G.imageData=new Blob(H,{type:"image/png"});delete G.dataParts;H=null});return x};var c=(u=h(1))&&u.__esModule?u:{default:u},a=h(2),b=Error("Not a PNG"),g=Error("Not an animated PNG"),e=new Uint8Array([137,80,78,71,13,10,26,10]),k=function(q,t){var v=q.length+t.length,y=new Uint8Array(v+8),w=new DataView(y.buffer);
w.setUint32(0,t.length);for(var z=y.set,r=new Uint8Array(q.length),C=0;C<q.length;C++)r[C]=q.charCodeAt(C);z.call(y,r,4);y.set(t,8);q=(0,c.default)(y,4,v);w.setUint32(v+4,q);return y},p=function(q){return new Uint8Array([q>>>24&255,q>>>16&255,q>>>8&255,q&255])}},function(u,m){Object.defineProperty(m,"__esModule",{value:!0});m.default=function(d){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=-1,b=c;for(c+=2<arguments.length&&void 0!==arguments[2]?arguments[2]:d.length-c;b<c;b++)a=
a>>>8^h[(a^d[b])&255];return a^-1};var h=new Uint32Array(256);for(u=0;256>u;u++){m=u;for(var f=0;8>f;f++)m=0!==(m&1)?3988292384^m>>>1:m>>>1;h[u]=m}},function(u,m,h){function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(m,"__esModule",{value:!0});m.Frame=m.APNG=void 0;var d=function(){function a(b,g){for(var e=0;e<g.length;e++){var k=g[e];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(b,
k.key,k)}}return function(b,g,e){g&&a(b.prototype,g);e&&a(b,e);return b}}(),c=(u=h(3))&&u.__esModule?u:{default:u};m.APNG=function(){function a(){f(this,a);this.playTime=this.numPlays=this.height=this.width=0;this.frames=[]}d(a,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(b){return b.createImage()}))}},{key:"getPlayer",value:function(b){var g=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;return this.createImages().then(function(){return new c.default(g,
b,e)})}}]);return a}();m.Frame=function(){function a(){f(this,a);this.blendOp=this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageElement=this.imageData=null}d(a,[{key:"createImage",value:function(){var b=this;return this.imageElement?Promise.resolve():new Promise(function(g,e){var k=URL.createObjectURL(b.imageData);b.imageElement=document.createElement("img");b.imageElement.onload=function(){URL.revokeObjectURL(k);g()};b.imageElement.onerror=function(){URL.revokeObjectURL(k);
b.imageElement=null;e(Error("Image creation error"))};b.imageElement.src=k})}}]);return a}()},function(u,m,h){function f(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}Object.defineProperty(m,"__esModule",{value:!0});var d=function(){function c(a,
b){for(var g=0;g<b.length;g++){var e=b[g];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,g){b&&c(a.prototype,b);g&&c(a,g);return a}}();u=h(4);u=function(c){function a(b,g,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var k=(a.__proto__||Object.getPrototypeOf(a)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");k=!k||"object"!==
typeof k&&"function"!==typeof k?this:k;k.playbackRate=1;k._currentFrameNumber=0;k._ended=!1;k._paused=!0;k._numPlays=0;k._apng=b;k.context=g;k.stop();e&&k.play();return k}f(a,c);d(a,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length;this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._paused=this._ended=!0));this._prevFrame&&1==this._prevFrame.disposeOp?
this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var b=this.currentFrame;this._prevFrame=b;this._prevFrameData=null;2==b.disposeOp&&(this._prevFrameData=this.context.getImageData(b.left,b.top,b.width,b.height));0==b.blendOp&&this.context.clearRect(b.left,b.top,b.width,b.height);this.context.drawImage(b.imageElement,
b.left,b.top);this.emit("frame",this._currentFrameNumber);this._ended&&this.emit("end")}},{key:"play",value:function(){var b=this;this.emit("play");this._ended&&this.stop();this._paused=!1;var g=performance.now()+this.currentFrame.delay/this.playbackRate;requestAnimationFrame(function p(k){if(!b._ended&&!b._paused){if(k>=g){for(;k-g>=b._apng.playTime/b.playbackRate;)g+=b._apng.playTime/b.playbackRate,b._numPlays++;do b.renderNextFrame(),g+=b.currentFrame.delay/b.playbackRate;while(!b._ended&&k>g)}requestAnimationFrame(p)}})}},
{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop");this._numPlays=0;this._ended=!1;this._paused=!0;this._currentFrameNumber=-1;this.context.clearRect(0,0,this._apng.width,this._apng.height);this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},
{key:"ended",get:function(){return this._ended}}]);return a}((u&&u.__esModule?u:{default:u}).default);m.default=u},function(u,m){function h(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function f(c){return"function"===typeof c}function d(c){return"object"===typeof c&&null!==c}u.exports=h;h.EventEmitter=h;h.prototype._events=void 0;h.prototype._maxListeners=void 0;h.defaultMaxListeners=10;h.prototype.setMaxListeners=function(c){if("number"!==typeof c||0>c||isNaN(c))throw TypeError("n must be a positive number");
this._maxListeners=c;return this};h.prototype.emit=function(c){var a;this._events||(this._events={});if("error"===c&&(!this._events.error||d(this._events.error)&&!this._events.error.length)){var b=arguments[1];if(b instanceof Error)throw b;var g=Error('Uncaught, unspecified "error" event. ('+b+")");g.context=b;throw g;}g=this._events[c];if(void 0===g)return!1;if(f(g))switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);
break;default:b=Array.prototype.slice.call(arguments,1),g.apply(this,b)}else if(d(g)){b=Array.prototype.slice.call(arguments,1);var e=g.slice();g=e.length;for(a=0;a<g;a++)e[a].apply(this,b)}return!0};h.prototype.addListener=function(c,a){if(!f(a))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",c,f(a.listener)?a.listener:a);this._events[c]?d(this._events[c])?this._events[c].push(a):this._events[c]=[this._events[c],a]:
this._events[c]=a;d(this._events[c])&&!this._events[c].warned&&(a=void 0!==this._maxListeners?this._maxListeners:h.defaultMaxListeners)&&0<a&&this._events[c].length>a&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),"function"===typeof console.trace&&console.trace());return this};h.prototype.on=h.prototype.addListener;h.prototype.once=function(c,a){function b(){this.removeListener(c,
b);g||(g=!0,a.apply(this,arguments))}if(!f(a))throw TypeError("listener must be a function");var g=!1;b.listener=a;this.on(c,b);return this};h.prototype.removeListener=function(c,a){if(!f(a))throw TypeError("listener must be a function");if(!this._events||!this._events[c])return this;var b=this._events[c];var g=b.length;var e=-1;if(b===a||f(b.listener)&&b.listener===a)delete this._events[c],this._events.removeListener&&this.emit("removeListener",c,a);else if(d(b)){for(;0<g--;)if(b[g]===a||b[g].listener&&
b[g].listener===a){e=g;break}if(0>e)return this;1===b.length?(b.length=0,delete this._events[c]):b.splice(e,1);this._events.removeListener&&this.emit("removeListener",c,a)}return this};h.prototype.removeAllListeners=function(c){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[c]&&delete this._events[c],this;if(0===arguments.length){for(a in this._events)"removeListener"!==a&&this.removeAllListeners(a);this.removeAllListeners("removeListener");
this._events={};return this}var a=this._events[c];if(f(a))this.removeListener(c,a);else if(a)for(;a.length;)this.removeListener(c,a[a.length-1]);delete this._events[c];return this};h.prototype.listeners=function(c){return this._events&&this._events[c]?f(this._events[c])?[this._events[c]]:this._events[c].slice():[]};h.prototype.listenerCount=function(c){if(this._events){c=this._events[c];if(f(c))return 1;if(c)return c.length}return 0};h.listenerCount=function(c,a){return c.listenerCount(a)}}])})})(F,
F.exports);F=l.getDefaultExportFromCjs(F.exports);n.parseApng3rdParty=F})},"esri/views/2d/engine/webgl/animatedFormats/gif":function(){define(["exports","../../../../../core/time","../../../../../geometry/support/meshUtils/exporters/gltf/imageutils","../../../../../chunks/index4"],function(n,l,F,D){function A(m){const h=new Uint8Array(m);return!u.some((f,d)=>f!==h[d])}const u=[71,73,70];n.isAnimatedGIF=function(m){function h(){a++;c+=8;const g=d.getUint8(c++);c+=g&128?3*2**((g&7)+1):0;c++;f()}function f(){let g;
for(;g=d.getUint8(c++);)c+=g}if(!A(m))return!1;const d=new DataView(m);m=d.getUint8(10);let c=13+(m&128?3*2**((m&7)+1):0),a=0;for(m=!1;!m;){switch(d.getUint8(c++)){case 33:a:{switch(d.getUint8(c++)){case 249:c++;c+=4;f();break;case 1:a++;c++;c+=12;f();break;case 254:f();break;case 255:c++;c+=8;c+=3;f();break;default:var b=!1;break a}b=!0}if(!b)return!1;break;case 44:h();break;case 59:m=!0;break;default:return!1}if(1<a)return!0}return!1};n.isGIF=A;n.parseGif=async function(m,h){m=D.parseGIF_1(m);var f=
D.decompressFrames_1(m,!0);const {width:d,height:c}=m.lsd;m=document.createElement("canvas");m.width=d;m.height=c;m=m.getContext("2d",{willReadFrequently:!0});const a=[];h=[];for(const g of f){h.push(l.Milliseconds(g.delay||100));f=new ImageData(g.patch,g.dims.width,g.dims.height);var b=F.imageTypeToCanvas(f);f=3===g.disposalType?m.getImageData(g.dims.left,g.dims.top,g.dims.width,g.dims.height):void 0;m.drawImage(b,g.dims.left,g.dims.top);b=m.getImageData(0,0,d,c);a.push(b);1!==g.disposalType&&(2===
g.disposalType?m.clearRect(g.dims.left,g.dims.top,g.dims.width,g.dims.height):3===g.disposalType&&m.putImageData(f,g.dims.left,g.dims.top))}return{frameDurations:h,getFrame:g=>a[g],width:d,height:c}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/exporters/gltf/imageutils":function(){define(["exports","../../../../../core/has","../../../../../core/Error","../../../../../core/urlUtils"],function(n,l,F,D){async function A(m){if(!(m instanceof HTMLImageElement))return"image/png";
m=m.src;return D.isDataProtocol(m)?(m=D.dataComponents(m),"image/jpeg"===m?.mediaType?m.mediaType:"image/png"):/\.png$/i.test(m)?"image/png":/\.(jpg|jpeg)$/i.test(m)?"image/jpeg":"image/png"}function u(m){if(m instanceof HTMLCanvasElement)return m;if(m instanceof HTMLVideoElement)return null;const h=document.createElement("canvas");h.width=m.width;h.height=m.height;const f=h.getContext("2d");m instanceof HTMLImageElement?f.drawImage(m,0,0,m.width,m.height):m instanceof ImageData&&f.putImageData(m,
0,0);return h}n.encodeBase64DataUri=function(m){const h=[];m=new Uint8Array(m);for(let f=0;f<m.length;f++)h.push(String.fromCharCode(m[f]));return"data:application/octet-stream;base64,"+btoa(h.join(""))};n.imageToArrayBuffer=async function(m){const h=u(m);if(null==h)throw new F("imageToArrayBuffer","Unsupported image type");const f=await A(m);m=await new Promise(d=>h.toBlob(d,f));if(!m)throw new F("imageToArrayBuffer","Failed to encode image");return{data:await m.arrayBuffer(),type:f}};n.imageToDataURI=
function(m){m=u(m);return null!=m?m.toDataURL():""};n.imageTypeToCanvas=u;n.isArrayBufferPNG=function(m){if(8>m.byteLength)return!1;m=new Uint8Array(m);return 137===m[0]&&80===m[1]&&78===m[2]&&71===m[3]&&13===m[4]&&10===m[5]&&26===m[6]&&10===m[7]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/index4":function(){define(["exports"],function(n){var l={},F={},D={};Object.defineProperty(D,"__esModule",{value:!0});D.loop=D.conditional=D.parse=void 0;D.parse=function e(b,g){var k=
2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},p=3<arguments.length&&void 0!==arguments[3]?arguments[3]:k;if(Array.isArray(g))g.forEach(function(t){return e(b,t,k,p)});else if("function"===typeof g)g(b,k,p,e);else{var q=Object.keys(g)[0];Array.isArray(g[q])?(p[q]={},e(b,g[q],k,p[q])):p[q]=g[q](b,k,p,e)}return k};D.conditional=function(b,g){return function(e,k,p,q){g(e,k,p)&&q(e,b,k,p)}};D.loop=function(b,g){return function(e,k,p,q){for(var t=[],v=e.pos;g(e,k,p);){var y={};q(e,b,k,y);if(e.pos===
v)break;v=e.pos;t.push(y)}return t}};var A={};Object.defineProperty(A,"__esModule",{value:!0});A.readBits=A.readArray=A.readUnsigned=A.readString=A.peekBytes=A.readBytes=A.peekByte=A.readByte=A.buildStream=void 0;A.buildStream=function(b){return{data:b,pos:0}};var u=function(){return function(b){return b.data[b.pos++]}};A.readByte=u;A.peekByte=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return function(g){return g.data[g.pos+b]}};var m=function(b){return function(g){return g.data.subarray(g.pos,
g.pos+=b)}};A.readBytes=m;A.peekBytes=function(b){return function(g){return g.data.subarray(g.pos,g.pos+b)}};A.readString=function(b){return function(g){return Array.from(m(b)(g)).map(function(e){return String.fromCharCode(e)}).join("")}};A.readUnsigned=function(b){return function(g){g=m(2)(g);return b?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]}};A.readArray=function(b,g){return function(e,k,p){k="function"===typeof g?g(e,k,p):g;p=m(b);for(var q=Array(k),t=0;t<k;t++)q[t]=p(e);return q}};A.readBits=function(b){return function(g){g=
u()(g);for(var e=Array(8),k=0;8>k;k++)e[7-k]=!!(g&1<<k);return Object.keys(b).reduce(function(p,q){var t=b[q];if(t.length){for(var v=t.length,y=0,w=0;w<v;w++)y+=e[t.index+w]&&Math.pow(2,v-w-1);p[q]=y}else p[q]=e[t.index];return p},{})}};(function(b){Object.defineProperty(b,"__esModule",{value:!0});b["default"]=void 0;var g={blocks:function(t){for(var v=[],y=t.data.length,w=0,z=(0,A.readByte)()(t);0!==z&&z;z=(0,A.readByte)()(t)){if(t.pos+z>=y){y-=t.pos;v.push((0,A.readBytes)(y)(t));w+=y;break}v.push((0,A.readBytes)(z)(t));
w+=z}t=new Uint8Array(w);for(y=w=0;y<v.length;y++)t.set(v[y],w),w+=v[y].length;return t}},e=(0,D.conditional)({gce:[{codes:(0,A.readBytes)(2)},{byteSize:(0,A.readByte)()},{extras:(0,A.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,A.readUnsigned)(!0)},{transparentColorIndex:(0,A.readByte)()},{terminator:(0,A.readByte)()}]},function(t){t=(0,A.peekBytes)(2)(t);return 33===t[0]&&249===t[1]}),k=(0,D.conditional)({image:[{code:(0,A.readByte)()},
{descriptor:[{left:(0,A.readUnsigned)(!0)},{top:(0,A.readUnsigned)(!0)},{width:(0,A.readUnsigned)(!0)},{height:(0,A.readUnsigned)(!0)},{lct:(0,A.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,D.conditional)({lct:(0,A.readArray)(3,function(t,v,y){return Math.pow(2,y.descriptor.lct.size+1)})},function(t,v,y){return y.descriptor.lct.exists}),{data:[{minCodeSize:(0,A.readByte)()},g]}]},function(t){return 44===(0,A.peekByte)()(t)}),
p=(0,D.conditional)({text:[{codes:(0,A.readBytes)(2)},{blockSize:(0,A.readByte)()},{preData:function(t,v,y){return(0,A.readBytes)(y.text.blockSize)(t)}},g]},function(t){t=(0,A.peekBytes)(2)(t);return 33===t[0]&&1===t[1]}),q=(0,D.conditional)({application:[{codes:(0,A.readBytes)(2)},{blockSize:(0,A.readByte)()},{id:function(t,v,y){return(0,A.readString)(y.blockSize)(t)}},g]},function(t){t=(0,A.peekBytes)(2)(t);return 33===t[0]&&255===t[1]});g=(0,D.conditional)({comment:[{codes:(0,A.readBytes)(2)},
g]},function(t){t=(0,A.peekBytes)(2)(t);return 33===t[0]&&254===t[1]});e=[{header:[{signature:(0,A.readString)(3)},{version:(0,A.readString)(3)}]},{lsd:[{width:(0,A.readUnsigned)(!0)},{height:(0,A.readUnsigned)(!0)},{gct:(0,A.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,A.readByte)()},{pixelAspectRatio:(0,A.readByte)()}]},(0,D.conditional)({gct:(0,A.readArray)(3,function(t,v){return Math.pow(2,v.lsd.gct.size+1)})},function(t,
v){return v.lsd.gct.exists}),{frames:(0,D.loop)([e,q,g,k,p],function(t){t=(0,A.peekByte)()(t);return 33===t||44===t})}];b["default"]=e})(F);var h={};Object.defineProperty(h,"__esModule",{value:!0});h.deinterlace=void 0;h.deinterlace=function(b,g){for(var e=Array(b.length),k=b.length/g,p=[0,4,2,1],q=[8,8,4,2],t=0,v=0;4>v;v++)for(var y=p[v];y<k;y+=q[v]){var w=y,z=b.slice(t*g,(t+1)*g);e.splice.apply(e,[w*g,g].concat(z));t++}return e};var f={};Object.defineProperty(f,"__esModule",{value:!0});f.lzw=void 0;
f.lzw=function(b,g,e){var k,p,q,t,v,y,w,z,r=Array(e),C=Array(4096),x=Array(4096),E=Array(4097);var B=1<<b;var G=B+1;var H=B+2;var I=-1;var J=b+1;var L=(1<<J)-1;for(p=0;p<B;p++)C[p]=0,x[p]=p;for(q=t=k=v=y=z=w=0;q<e;){if(0===y){if(k<J){t+=g[w]<<k;k+=8;w++;continue}p=t&L;t>>=J;k-=J;if(p>H||p==G)break;if(p==B){J=b+1;L=(1<<J)-1;H=B+2;I=-1;continue}if(-1==I){E[y++]=x[p];v=I=p;continue}var K=p;p==H&&(E[y++]=v,p=I);for(;p>B;)E[y++]=x[p],p=C[p];v=x[p]&255;E[y++]=v;4096>H&&(C[H]=I,x[H]=v,H++,0===(H&L)&&4096>
H&&(J++,L+=H));I=K}y--;r[z++]=E[y];q++}for(q=z;q<e;q++)r[q]=0;return r};Object.defineProperty(l,"__esModule",{value:!0});n.decompressFrames_1=l.decompressFrames=l.decompressFrame=n.parseGIF_1=l.parseGIF=void 0;var d=F&&F.__esModule?F:{default:F};n.parseGIF_1=l.parseGIF=function(b){b=new Uint8Array(b);return(0,D.parse)((0,A.buildStream)(b),d["default"])};var c=function(b,g,e){if(b.image){var k=b.image,p=(0,f.lzw)(k.data.minCodeSize,k.data.blocks,k.descriptor.width*k.descriptor.height);k.descriptor.lct.interlaced&&
(p=(0,h.deinterlace)(p,k.descriptor.width));p={pixels:p,dims:{top:b.image.descriptor.top,left:b.image.descriptor.left,width:b.image.descriptor.width,height:b.image.descriptor.height}};p.colorTable=k.descriptor.lct&&k.descriptor.lct.exists?k.lct:g;b.gce&&(p.delay=10*(b.gce.delay||10),p.disposalType=b.gce.extras.disposal,b.gce.extras.transparentColorGiven&&(p.transparentIndex=b.gce.transparentColorIndex));if(e){b=p.pixels.length;g=new Uint8ClampedArray(4*b);for(e=0;e<b;e++){k=4*e;var q=p.pixels[e],
t=p.colorTable[q]||[0,0,0];g[k]=t[0];g[k+1]=t[1];g[k+2]=t[2];g[k+3]=q!==p.transparentIndex?255:0}p.patch=g}return p}console.warn("gif frame does not have associated image.")};l.decompressFrame=c;n.decompressFrames_1=l.decompressFrames=function(b,g){return b.frames.filter(function(e){return e.image}).map(function(e){return c(e,b.gct,g)})}})},"esri/views/2d/engine/Container":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat3f32 ../../../layers/effects/EffectView ./DisplayObject ./webgl/effects/highlight/HighlightGradient".split(" "),
function(n,l,F,D,A,u){A=function(m){function h(){var d=m.apply(this,arguments)||this;d._childrenSet=new Set;d._needsSort=!1;d.children=[];d._effectView=null;d._highlightOptions=null;d._highlightGradient=null;return d}l._inherits(h,m);var f=h.prototype;f.updateTransitionProperties=function(d,c){l._get(l._getPrototypeOf(h.prototype),"updateTransitionProperties",this).call(this,d,c);this._effectView&&(this._effectView.transitionStep(d,c),this._effectView.transitioning&&this.requestRender())};f.doRender=
function(d){d=this.createRenderParams(d);this.renderChildren(d)};f.addChild=function(d){return this.addChildAt(d,this.children.length)};f.addChildAt=function(d,c=this.children.length){if(!d||this.contains(d))return d;this._needsSort=!0;const a=d.parent;a&&a!==this&&a.removeChild(d);c>=this.children.length?this.children.push(d):this.children.splice(c,0,d);this._childrenSet.add(d);d.parent=this;d.stage=this.stage;this!==this.stage&&(d.clips=this.clips);this.requestRender();return d};f.contains=function(d){return this._childrenSet.has(d)};
f.endTransitions=function(){l._get(l._getPrototypeOf(h.prototype),"endTransitions",this).call(this);this._effectView&&(this._effectView.endTransitions(),this.requestRender())};f.removeAllChildren=function(){this._childrenSet.clear();this._needsSort=!0;for(const d of this.children)this!==this.stage&&(d.clips=null),d.stage=null,d.parent=null;this.children.length=0};f.removeChild=function(d){return this.contains(d)?this.removeChildAt(this.children.indexOf(d)):d};f.removeChildAt=function(d){if(0>d||d>=
this.children.length)return null;this._needsSort=!0;d=this.children.splice(d,1)[0];this._childrenSet.delete(d);this!==this.stage&&(d.clips=null);d.stage=null;d.parent=null;return d};f.sortChildren=function(d){this._needsSort&&(this.children.sort(d),this._needsSort=!1)};f.beforeRender=function(d){l._get(l._getPrototypeOf(h.prototype),"beforeRender",this).call(this,d);for(const c of this.children)c.beforeRender(d)};f.afterRender=function(d){l._get(l._getPrototypeOf(h.prototype),"afterRender",this).call(this,
d);for(const c of this.children)c.afterRender(d)};f._createTransforms=function(){return{dvs:F.create()}};f.onAttach=function(){l._get(l._getPrototypeOf(h.prototype),"onAttach",this).call(this);const d=this.stage;for(const c of this.children)c.stage=d};f.onDetach=function(){l._get(l._getPrototypeOf(h.prototype),"onDetach",this).call(this);for(const d of this.children)d.stage=null};f.renderChildren=function(d){for(const c of this.children)c.processRender(d)};f.createRenderParams=function(d){return{...d,
blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:d.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||d.highlightGradient}};l._createClass(h,[{key:"blendMode",get:function(){return this._blendMode},set:function(d){this._blendMode=d;this.requestRender()}},{key:"clips",get:function(){return this._clips},set:function(d){this._clips=d;this.children.forEach(c=>c.clips=d)}},{key:"computedEffects",get:function(){return this._effectView?.effects??
null}},{key:"effect",get:function(){return this._effectView?.effect??""},set:function(d){if(this._effectView||d)this._effectView||(this._effectView=new D.EffectView),this._effectView.effect=d,this.requestRender()}},{key:"highlightOptions",get:function(){return this._highlightOptions},set:function(d){d?this._highlightOptions&&this._highlightOptions.equals(d)||(this._highlightOptions=d,this._highlightGradient||(this._highlightGradient=new u),this._highlightGradient.setHighlightOptions(d),this.requestRender()):
(this._highlightOptions=null,this._highlightGradient&&(this._highlightGradient.destroy(),this._highlightGradient=null,this.requestRender()))}}]);return h}(A.DisplayObject);n.Container=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./parser ./utils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){function b(k){k=c.parse(k)||[];var p=(p=k[0])?"type"in p:!1;return p?[{scale:-1,effects:k}]:k}function g(k,p,q){return k[0]?.effects&&p[0]?.effects?(-1===k[0]?.scale||-1===p[0]?.scale)&&(1<k.length||1<p.length)&&0>=q?!1:a.canInterpolateEffects(k[0].effects,p[0].effects):!0}function e(k,p,q){const t=k.length>p.length?k:p;k=k.length>p.length?p:k;var v=k[k.length-1];p=v?.scale??q;v=v?.effects??[];for(let y=k.length;y<t.length;y++)k.push({scale:p,effects:[...v]});for(p=
0;p<t.length;p++)k[p].scale=-1===k[p].scale?q:k[p].scale,t[p].scale=-1===t[p].scale?q:t[p].scale,a.normalizeEffects(k[p].effects,t[p].effects)}n.EffectView=function(k){function p(t){t=k.call(this,t)||this;t._from=null;t._to=null;t._final=null;t._current=[];t._time=0;t.duration=A("mapview-transitions-duration");t.effects=[];return t}l._inherits(p,k);var q=p.prototype;q.canTransitionTo=function(t){try{return 0<this.scale&&g(this._current,b(t),this.scale)}catch{return!1}};q.transitionStep=function(t,
v){this._applyTimeTransition(t);this._updateForScale(v)};q.endTransitions=function(){this._applyTimeTransition(this.duration)};q._transitionTo=function(t){0<this.scale&&g(this._current,t,this.scale)?(this._final=t,this._to=u.clone(t),e(this._current,this._to,this.scale),this._from=u.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t);this._set("effects",this._current[0]?u.clone(this._current[0].effects):[])};q._applyTimeTransition=function(t){if(this._to&&this._from&&
this._current&&this._final){this._time+=t;t=Math.min(1,this._time/this.duration);for(let y=0;y<this._current.length;y++){const w=this._current[y],z=this._from[y],r=this._to[y];var v=z.scale;w.scale=v+(r.scale-v)*t;for(v=0;v<w.effects.length;v++)w.effects[v].interpolate(z.effects[v],r.effects[v],t)}1===t&&(this._current=this._final,this._set("effects",this._current[0]?u.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}};q._updateForScale=function(t){this._set("scale",t);if(0!==
this._current.length){var v=this._current,y=this._current.length-1,w,z=1;if(1===v.length||t>=v[0].scale)var r=w=v[0].effects;else if(t<=v[y].scale)r=w=v[y].effects;else for(let C=0;C<y;C++){const x=v[C],E=v[C+1];if(x.scale>=t&&E.scale<=t){z=(t-x.scale)/(E.scale-x.scale);w=x.effects;r=E.effects;break}}for(t=0;t<this.effects.length;t++)this.effects[t].interpolate(w[t],r[t],z)}};l._createClass(p,[{key:"effect",set:function(t){const v=this._get("effect");t=t||"";if(v!==t){this._set("effect",t);try{this._transitionTo(b(t))}catch(y){this._transitionTo([]),
m.getLogger(this).warn("Invalid Effect",{effect:t,error:y})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(t){this._updateForScale(t)}},{key:"transitioning",get:function(){return null!==this._to}}]);return p}(D);F.__decorate([h.property()],n.EffectView.prototype,"_to",void 0);F.__decorate([h.property()],n.EffectView.prototype,"duration",void 0);F.__decorate([h.property({value:""})],n.EffectView.prototype,"effect",null);F.__decorate([h.property({readOnly:!0})],
n.EffectView.prototype,"effects",void 0);F.__decorate([h.property({readOnly:!0})],n.EffectView.prototype,"hasEffects",null);F.__decorate([h.property({value:0})],n.EffectView.prototype,"scale",null);F.__decorate([h.property({readOnly:!0})],n.EffectView.prototype,"transitioning",null);n.EffectView=F.__decorate([d.subclass("esri.layers.effects.EffectView")],n.EffectView);n.canInterpolateEffectStops=g;n.convertEffectToStops=b;n.normalizeEffectStops=e;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(n,l,F,D,A){const u=1/D("mapview-transitions-duration");F=function(m){function h(){var d=m.apply(this,arguments)||this;d._fadeOutResolver=null;d._fadeInResolver=null;d._clips=null;d.computedVisible=!0;d.computedOpacity=1;d.fadeTransitionEnabled=!1;d.inFadeTransition=!1;d._isReady=!1;d._opacity=1;d.parent=null;
d._stage=null;d._visible=!0;return d}l._inherits(h,m);var f=h.prototype;f._getTransforms=function(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms};f.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=A.createResolver();this.requestRender();return this._fadeInResolver.promise};
f.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=A.createResolver();this.requestRender();return this._fadeOutResolver.promise};f.endTransitions=function(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()};
f.beforeRender=function(d){this.updateTransitionProperties(d.deltaTime,d.state.scale)};f.afterRender=function(d){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};f.remove=function(){this.parent?.removeChild(this)};f.setTransform=function(d){};f.processRender=function(d){this.stage&&this.computedVisible&&this.doRender(d)};f.requestRender=
function(){this.stage&&this.stage.requestRender()};f.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};f.updateTransitionProperties=function(d,c){if(this.fadeTransitionEnabled){c=this._fadeOutResolver||!this.visible?0:this.opacity;const a=this.computedOpacity;a===c?this.computedVisible=this.visible:(d*=u,this.computedOpacity=a>c?Math.max(c,
a-d):Math.min(c,a+d),this.computedVisible=0<this.computedOpacity,d=c===this.computedOpacity,this.inFadeTransition=!d,d||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};f.onAttach=function(){};f.onDetach=function(){};f.doRender=function(d){};f.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};l._createClass(h,[{key:"clips",get:function(){return this._clips},set:function(d){this._clips=d;this.requestRender()}},
{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(d){this._opacity!==d&&(this._opacity=Math.min(1,Math.max(d,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(d){if(this._stage!==d){var c=this._stage;(this._stage=d)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):c?.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",
get:function(){return this._visible},set:function(d){this._visible!==d&&(this._visible=d,this.requestRender())}}]);return h}(F);n.DisplayObject=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Logger ../../definitions ./parameters ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m){function h(c,a){a.fillColor[0]=c.color.r/255;a.fillColor[1]=c.color.g/255;a.fillColor[2]=c.color.b/255;a.fillColor[3]=c.color.a;c.haloColor?(a.outlineColor[0]=c.haloColor.r/255,a.outlineColor[1]=c.haloColor.g/255,a.outlineColor[2]=c.haloColor.b/255,a.outlineColor[3]=c.haloColor.a):(a.outlineColor[0]=a.fillColor[0],a.outlineColor[1]=a.fillColor[1],a.outlineColor[2]=a.fillColor[2],a.outlineColor[3]=a.fillColor[3]);a.fillColor[3]*=c.fillOpacity;a.outlineColor[3]*=c.haloOpacity;
a.fillColor[0]*=a.fillColor[3];a.fillColor[1]*=a.fillColor[3];a.fillColor[2]*=a.fillColor[3];a.outlineColor[0]*=a.outlineColor[3];a.outlineColor[1]*=a.outlineColor[3];a.outlineColor[2]*=a.outlineColor[3];a.outlineWidth=D.HIGHLIGHT_SIZING.outlineWidth;a.outerHaloWidth=D.HIGHLIGHT_SIZING.outerHaloWidth;a.innerHaloWidth=D.HIGHLIGHT_SIZING.innerHaloWidth;a.outlinePosition=D.HIGHLIGHT_SIZING.outlinePosition}const f=l.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),d=[0,0,0,
0];return function(){function c(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:D.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:D.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:D.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:D.HIGHLIGHT_SIZING.outerHaloWidth};this._shadeTexChanged=!0;this._texelData=new Uint8Array(4*D.SHADE_TEXTURE_SIZE);this._minMaxDistance=[0,0]}var a=c.prototype;a.setHighlightOptions=function(b){function g(w,
z,r){y[0]=(1-r)*w[0]+r*z[0];y[1]=(1-r)*w[1]+r*z[1];y[2]=(1-r)*w[2]+r*z[2];y[3]=(1-r)*w[3]+r*z[3]}const e=this._convertedHighlightOptions;h(b,e);b=e.outlinePosition-e.outlineWidth/2-e.outerHaloWidth;const k=e.outlinePosition-e.outlineWidth/2,p=e.outlinePosition+e.outlineWidth/2,q=e.outlinePosition+e.outlineWidth/2+e.innerHaloWidth;var t=Math.sqrt(Math.PI/2)*D.SIGMA,v=Math.abs(b)>t?Math.round(10*(Math.abs(b)-t))/10:0;t=Math.abs(q)>t?Math.round(10*(Math.abs(q)-t))/10:0;v&&!t?f.error("The outer rim of the highlight is "+
v+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!v&&t?f.error("The inner rim of the highlight is "+t+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):v&&t&&f.error("The highlight is "+Math.max(v,t)+"px away from the edge of the feature; consider reducing some width values.");const y=[void 0,void 0,void 0,
void 0];({_texelData:t}=this);for(let w=0;w<D.SHADE_TEXTURE_SIZE;++w)v=b+w/(D.SHADE_TEXTURE_SIZE-1)*(q-b),v<b?(y[4*w]=0,y[4*w+1]=0,y[4*w+2]=0,y[4*w+3]=0):v<k?g(d,e.outlineColor,(v-b)/(k-b)):v<p?[y[0],y[1],y[2],y[3]]=e.outlineColor:v<q?g(e.outlineColor,e.fillColor,(v-p)/(q-p)):[y[4*w],y[4*w+1],y[4*w+2],y[4*w+3]]=e.fillColor,t[4*w]=255*y[0],t[4*w+1]=255*y[1],t[4*w+2]=255*y[2],t[4*w+3]=255*y[3];this._minMaxDistance[0]=b;this._minMaxDistance[1]=q;this._shadeTexChanged=!0};a.applyHighlightOptions=function(b,
g){if(!this._shadeTex){const e=new m.TextureDescriptor;e.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;e.width=D.SHADE_TEXTURE_SIZE;e.height=1;this._shadeTex=new u.Texture(b,e)}this._shadeTexChanged&&(this._shadeTex.updateData(0,0,0,D.SHADE_TEXTURE_SIZE,1,this._texelData),this._shadeTexChanged=!1);b.bindTexture(this._shadeTex,F.TEXTURE_BINDING_HIGHLIGHT_1);g.setUniform2fv("u_minMaxDistance",this._minMaxDistance)};a.destroy=function(){this._shadeTex?.dispose();this._shadeTex=null};return n._createClass(c)}()})},
"esri/views/2d/engine/webgl/definitions":function(){define(["exports","../../../../core/has"],function(n,l){const F=256/360;l=l("featurelayer-force-marker-text-draw-order")?.5:3;n.ANGLE_FACTOR_256=F;n.ATTRIBUTE_DATA_ANIMATION=1;n.ATTRIBUTE_DATA_DD0=3;n.ATTRIBUTE_DATA_DD1=4;n.ATTRIBUTE_DATA_FILTER_FLAGS=0;n.ATTRIBUTE_DATA_GPGPU=2;n.ATTRIBUTE_DATA_VV=3;n.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;n.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};n.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR=
32;n.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR=64;n.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR=8;n.BITSET_FILL_RANDOM_PATTERN_OFFSET=4;n.BITSET_GENERIC_CONSIDER_ALPHA_ONLY=16;n.BITSET_GENERIC_LOCK_COLOR=2;n.BITSET_LINE_SCALE_DASH=4;n.BITSET_MARKER_ALIGNMENT_MAP=1;n.BITSET_MARKER_ALIGNMENT_SCREEN=0;n.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE=4;n.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY=8;n.BITSET_TYPE_FILL_OUTLINE=1;n.BUFFER_DATA_MINIMUM_SIZE=128;n.BUFFER_DATA_POOL_SIZE=4;n.CHART_MAX_FIELDS=
10;n.COLLISION_BOX_PADDING=16;n.COLLISION_BUCKET_SIZE=128;n.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;n.COLLISION_MAX_ZOOM_DELTA=1;n.COLLISION_PLACEMENT_PADDING=8;n.COLLISION_TILE_BOX_SIZE=4;n.COMPRESSION_FACTOR_FOR_U16=128;n.DEBUG_LABELS=!1;n.DISPLAY_RECORD_INT_PER_ELEMENT=8;n.DOT_DENSITY_MAX_FIELDS=8;n.EFFECT_FLAG_0=4;n.ENABLE_EARLY_LABEL_DISCARD=!1;n.EXTRUDE_SCALE=64;n.FILTER_FLAG_0=2;n.GLYPH_SIZE=24;n.HEURISTIC_GLYPHS_PER_FEATURE=10;n.HEURISTIC_GLYPHS_PER_LINE=50;n.HIGHLIGHT_FLAG=1;n.HITTEST_RADIUS=
l;n.MAGIC_LABEL_LINE_HEIGHT=29;n.MAX_FILTERS=2;n.MAX_GPU_UPLOADS_PER_FRAME=2;n.MAX_REPRESENTABLE_INT=16777216;n.MAX_SIZE_FOR_U16_COMPRESSION=511;n.MIN_MAX_ZOOM_PRECISION_FACTOR=10;n.NAN_MAGIC_NUMBER=1E-30;n.PATCH_PIXEL_BUFFER_ALLOC_SIZE=500;n.PATTERN_FILL_RASTERIZATION_SCALE=2;n.PICTURE_FILL_COLOR=4294967295;n.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE=1024;n.RASTER_TILE_SIZE=256;n.SDF_TEXTURE_SIZE=124;n.SPRITE_PADDING=2;n.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;n.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;n.TEXTURE_BINDING_ATTRIBUTE_DATA_2=
3;n.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;n.TEXTURE_BINDING_ATTRIBUTE_DATA_4=5;n.TEXTURE_BINDING_ATTRIBUTE_DATA_5=6;n.TEXTURE_BINDING_BITMAP=0;n.TEXTURE_BINDING_GLYPH_ATLAS=0;n.TEXTURE_BINDING_GPGPU=12;n.TEXTURE_BINDING_HIGHLIGHT_0=5;n.TEXTURE_BINDING_HIGHLIGHT_1=6;n.TEXTURE_BINDING_RENDERER_0=5;n.TEXTURE_BINDING_RENDERER_1=6;n.TEXTURE_BINDING_SPRITE_ATLAS=0;n.TEXTURE_UPLOAD_MANAGER_BUDGET=4;n.TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE=128;n.TEXT_PLACEMENT_PADDING=8;n.THIN_LINE_HALF_WIDTH_THRESHOLD=1.05;n.TILE_SIZE=
512;n.VTL_HIGH_RES_CUTOFF=1.15;n.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;n.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;n.WEBGL_MAX_INNER_STOPS=6;n.WEBGL_MAX_STOPS=8;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["exports"],function(n){n.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];n.HIGHLIGHT_SIZING={outlineWidth:1.3,outerHaloWidth:.4,innerHaloWidth:.4,outlinePosition:0};n.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];n.SHADE_TEXTURE_SIZE=256;n.SIGMA=1;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/BufferPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(n,l,F,D,A){const u=F("esri-2d-log-allocations");F=function(){function f(c,a){this._array=c;this._pool=a}f.create=function(c,a){c=a.acquire(c);return new f(c,a)};var d=f.prototype;
d.expand=function(c){c=this._pool.acquire(c);c.set(this._array);this._pool.release(this._array);this._array=c};d.destroy=function(){this._pool.release(this._array)};d.set=function(c,a){this._array.set(c._array,a)};d.slice=function(){const c=this._pool.acquire(this._array.byteLength);c.set(this._array);return new f(c,this._pool)};l._createClass(f,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}}]);return f}();let m=function(){function f(){this._data=
new ArrayBuffer(f.BYTE_LENGTH);this._freeList=new A.FreeList({start:0,end:this._data.byteLength})}var d=f.prototype;d.allocate=function(c){const a=this._freeList.firstFit(c);return null==a?null:new Uint32Array(this._data,a,c/Uint32Array.BYTES_PER_ELEMENT)};d.free=function(c){this._freeList.free(c.byteOffset,c.byteLength)};l._createClass(f,[{key:"buffer",get:function(){return this._data}}],[{key:"BYTE_LENGTH",get:function(){return 64E6}}]);return f}(),h=function(){function f(){this._bytesAllocated=
0;this._pages=[];this._pagesByBuffer=new Map;this._addPage()}var d=f.prototype;d.destroy=function(){this._pages=[];this._pagesByBuffer=null};d.acquire=function(c){this._bytesAllocated+=c;u&&console.log(`Allocating ${c}, (${this._bytesAllocated} / ${this._bytesTotal})`);if(c>m.BYTE_LENGTH)return new Uint32Array(c/Uint32Array.BYTES_PER_ELEMENT);for(const a of this._pages){const b=a.allocate(c);if(null!=b)return b}return D.unwrapOrThrow(this._addPage().allocate(c),"Expected to allocate page")};d.release=
function(c){this._bytesAllocated-=c.byteLength;u&&console.log(`Freeing ${c.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const a=this._pagesByBuffer.get(c.buffer);a&&a.free(c)};d._addPage=function(){const c=new m;this._pages.push(c);this._pagesByBuffer.set(c.buffer,c);return c};l._createClass(f,[{key:"_bytesTotal",get:function(){return this._pages.length*m.BYTE_LENGTH}}]);return f}();n.BufferPool=h;n.TypedBuffer=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function A(m){this.next=null;if(Array.isArray(m)){this.data=m[0];var h=this;for(let f=1;f<m.length;f++)h.next=new A([m[f]]),h=h.next}else this.data=m}var u=A.prototype;u.values=function*(){let m=this;for(;m;)yield m.data,m=m.next};u.forEach=function(m){let h=this;for(;h;)m(h.data),h=h.next};u.find=function(m){return m(this.data)?this:this.next?.find(m)};u.max=function(m,h=this){h=m(this.data)>m(h.data)?this:h;return this.next?
this.next.max(m,h):h};u.remove=function(m,h=null){return this===m?h?(h.next=this.next,h):this.next:this.next?.remove(m,this)??null};l._createClass(A,[{key:"last",get:function(){return this.next?this.next.last:this}}]);return A}(),D=function(){function A(m){this._head=null;null!=m&&(this._head=new F(m))}var u=A.prototype;u.maxAvailableSpace=function(){if(null==this._head)return 0;const m=this._head.max(h=>h.end-h.start);return m.data.end-m.data.start};u.firstFit=function(m){if(null==this._head)return null;
var h=null;let f=this._head;for(;f;){const d=f.data.end-f.data.start;if(d===m)return h?h.next=f.next:this._head=f.next,f.data.start;if(d>m)return h=f.data.start,f.data.start+=m,h;h=f;f=f.next}return null};u.free=function(m,h){const f=m+h;if(null==this._head)this._head=new F({start:m,end:f});else if(f<=this._head.data.start)if(f===this._head.data.start)this._head.data.start-=h;else{var d=new F({start:m,end:f});d.next=this._head;this._head=d}else{d=this._head;for(var c=d.next;c;){if(c.data.start>=f){if(d.data.end===
m){d.data.end+=h;d.data.end===c.data.start&&(d.data.end+=c.data.end-c.data.start,d.next=c.next);return}if(c.data.start===f){c.data.start-=h;return}m=new F({start:m,end:f});m.next=d.next;d.next=m;return}d=c;c=c.next}m===d.data.end?d.data.end+=h:(m=new F({start:m,end:f}),d.next=m)}};l._createClass(A,[{key:"head",get:function(){return this._head}}]);return A}();n.FreeList=D;n.List=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(["exports"],
function(n){n.WGLGeometryType=void 0;(function(l){l[l.FILL=0]="FILL";l[l.LINE=1]="LINE";l[l.MARKER=2]="MARKER";l[l.TEXT=3]="TEXT";l[l.LABEL=4]="LABEL"})(n.WGLGeometryType||(n.WGLGeometryType={}));n.WGLDrawPhase=void 0;(function(l){l[l.NONE=0]="NONE";l[l.MAP=1]="MAP";l[l.LABEL=2]="LABEL";l[l.LABEL_ALPHA=4]="LABEL_ALPHA";l[l.HITTEST=8]="HITTEST";l[l.HIGHLIGHT=16]="HIGHLIGHT";l[l.CLIP=32]="CLIP";l[l.DEBUG=64]="DEBUG";l[l.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(n.WGLDrawPhase||(n.WGLDrawPhase={}));n.VVType=
void 0;(function(l){l[l.SIZE=0]="SIZE";l[l.COLOR=1]="COLOR";l[l.OPACITY=2]="OPACITY";l[l.ROTATION=3]="ROTATION"})(n.VVType||(n.VVType={}));n.WGLVVFlag=void 0;(function(l){l[l.NONE=0]="NONE";l[l.OPACITY=1]="OPACITY";l[l.COLOR=2]="COLOR";l[l.ROTATION=4]="ROTATION";l[l.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";l[l.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";l[l.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";l[l.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(n.WGLVVFlag||(n.WGLVVFlag={}));n.WGLVVTarget=void 0;(function(l){l[l.MINMAX_TARGETS_OUTLINE=
128]="MINMAX_TARGETS_OUTLINE";l[l.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";l[l.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";l[l.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(n.WGLVVTarget||(n.WGLVVTarget={}));n.MosaicType=void 0;(function(l){l[l.SPRITE=0]="SPRITE";l[l.GLYPH=1]="GLYPH"})(n.MosaicType||(n.MosaicType={}));n.WGLSymbologyType=void 0;(function(l){l[l.DEFAULT=0]="DEFAULT";l[l.SIMPLE=1]="SIMPLE";l[l.DOT_DENSITY=2]="DOT_DENSITY";l[l.OUTLINE_FILL=3]="OUTLINE_FILL";l[l.OUTLINE_FILL_SIMPLE=
4]="OUTLINE_FILL_SIMPLE";l[l.HEATMAP=5]="HEATMAP";l[l.PIE_CHART=6]="PIE_CHART"})(n.WGLSymbologyType||(n.WGLSymbologyType={}));Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../brushes ../vectorTiles/shaders/VTLMaterialManager ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./TextureUploadManager ./WorldExtentClipRenderer ./effects/AnimationEffect ./effects/BlendEffect ./effects/FeatureEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/HittestEffectVTL ./effects/post-processing/EffectManager ./painter/RenderPass ../../../webgl/contextUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w,z,r){function C(x,E){switch(x){case u.WGLGeometryType.LINE:return F.brushes.line;case u.WGLGeometryType.TEXT:return F.brushes.text;case u.WGLGeometryType.LABEL:return F.brushes.label;case u.WGLGeometryType.FILL:switch(E){case u.WGLSymbologyType.DOT_DENSITY:return F.brushes.dotDensity;default:return F.brushes.fill}case u.WGLGeometryType.MARKER:switch(E){case u.WGLSymbologyType.HEATMAP:return F.brushes.heatmap;case u.WGLSymbologyType.PIE_CHART:return F.brushes.pieChart;
default:return F.brushes.marker}}}return function(){function x(B,G,H){this.context=B;this._blitRenderer=new A.BitBlitRenderer;this._worldExtentClipRenderer=new d.WorldExtentClipRenderer;this._isClippedToWorldExtent=!1;this._brushCache=new Map;this._prevFBO=this._lastHeight=this._lastWidth=null;this._vtlMaterialManager=new D;this._blendEffect=new a.BlendEffect;this._fbos=this._stencilBuf=null;this._fboPool=[];this._renderTarget=null;this.effects={highlight:new g,hittest:new e.HittestEffect,hittestVTL:new k.HittestEffectVTL,
integrate:new c.AnimationEffect,insideEffect:new b.FeatureEffect("inside"),outsideEffect:new b.FeatureEffect("outside")};this.materialManager=new m(B);this.textureManager=new h(G,H,B.type===t.ContextType.WEBGL2);this.textureUploadManager=new f.TextureUploadManager(B,G);this._effectsManager=new p.EffectManager}var E=x.prototype;E.getRenderTarget=function(){return this._renderTarget};E.setRenderTarget=function(B){this._renderTarget=B};E.getFbos=function(B,G){if(B!==this._lastWidth||G!==this._lastHeight){this._lastWidth=
B;this._lastHeight=G;if(this._fbos){for(var H in this._fbos)this._fbos[H].resize(B,G);return this._fbos}H=new r.TextureDescriptor(B,G);H.samplingMode=v.TextureSamplingMode.NEAREST;H.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;B=new z.RenderbufferDescriptor(v.RenderbufferFormat.DEPTH_STENCIL,B,G);this._stencilBuf=new w.Renderbuffer(this.context,B);this._fbos={output:new y.FramebufferObject(this.context,H,this._stencilBuf),blend:new y.FramebufferObject(this.context,H,this._stencilBuf),effect0:new y.FramebufferObject(this.context,
H,this._stencilBuf)}}return this._fbos};E.acquireFbo=function(B,G){if(0<this._fboPool.length)var H=this._fboPool.pop();else H=new r.TextureDescriptor(B,G),H.samplingMode=v.TextureSamplingMode.NEAREST,H.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE,H=new y.FramebufferObject(this.context,H,this._stencilBuf);H.width===B&&H.height===G||H.resize(B,G);return H};E.releaseFbo=function(B){this._fboPool.push(B)};E.getSharedStencilBuffer=function(){return this._stencilBuf};E.beforeRenderLayers=function(B,G=null){const {width:H,
height:I}=B.getViewport();this._prevFBO=B.getBoundFramebufferObject();const J=this.getFbos(H,I);B.bindFramebuffer(J?.output);B.setColorMask(!0,!0,!0,!0);if(null!=G){const {r:L,g:K,b:S,a:W}=G;B.setClearColor(W*L/255,W*K/255,W*S/255,W)}else B.setClearColor(0,0,0,0);B.setDepthWriteEnabled(!0);B.setClearDepth(1);B.clear(B.gl.COLOR_BUFFER_BIT|B.gl.DEPTH_BUFFER_BIT);B.setDepthWriteEnabled(!1)};E.beforeRenderLayer=function(B,G,H){const {context:I,blendMode:J,effects:L,requireFBO:K,drawPhase:S}=B;K||S!==
u.WGLDrawPhase.HIGHLIGHT&&(1!==H||null!=J&&"normal"!==J||null!=L&&0<L.length)?(I.bindFramebuffer(this._fbos?.blend),I.setColorMask(!0,!0,!0,!0),I.setClearColor(0,0,0,0),I.setDepthWriteEnabled(!0),I.setClearDepth(1),I.clear(I.gl.COLOR_BUFFER_BIT|I.gl.DEPTH_BUFFER_BIT),I.setDepthWriteEnabled(!1)):(B=this._getOutputFBO(),I.bindFramebuffer(B));I.setDepthWriteEnabled(!1);I.setDepthTestEnabled(!1);I.setStencilTestEnabled(!0);I.setClearStencil(G);I.setStencilWriteMask(255);I.clear(I.gl.STENCIL_BUFFER_BIT)};
E.compositeLayer=function(B,G){const {context:H,blendMode:I,effects:J,requireFBO:L,drawPhase:K}=B;if(L||K!==u.WGLDrawPhase.HIGHLIGHT&&(1!==G||null!=I&&"normal"!==I||null!=J&&0<J.length)){null!=J&&0<J.length&&K===u.WGLDrawPhase.MAP&&this._applyEffects(B,J);var S=this._getOutputFBO();H.bindFramebuffer(S);H.setStencilTestEnabled(!1);H.setStencilWriteMask(0);H.setBlendingEnabled(!0);H.setBlendFunctionSeparate(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA,v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);
H.setColorMask(!0,!0,!0,!0);S=null==I||K===u.WGLDrawPhase.HIGHLIGHT?"normal":I;const W=this._fbos;W?.blend.colorTexture&&this._blendEffect.draw(B,W.blend.colorTexture,v.TextureSamplingMode.NEAREST,S,G)}};E.renderLayers=function(B){B.bindFramebuffer(this._prevFBO);const G=this._getOutputFBO();G&&(B.setDepthTestEnabled(!1),B.setStencilWriteMask(0),this._isClippedToWorldExtent?(B.setStencilTestEnabled(!0),B.setStencilFunction(v.CompareFunction.EQUAL,1,255)):B.setStencilTestEnabled(!1),this.blitTexture(B,
G.colorTexture,v.TextureSamplingMode.NEAREST))};E.prepareDisplay=function(B,G,H){const {context:I}=B;I.bindFramebuffer(this._prevFBO);I.setColorMask(!0,!0,!0,!0);if(null!=G){const {r:J,g:L,b:K,a:S}=G;I.setClearColor(S*J/255,S*L/255,S*K/255,S)}else I.setClearColor(0,0,0,0);I.setStencilWriteMask(255);I.setClearStencil(0);I.clear(I.gl.COLOR_BUFFER_BIT|I.gl.STENCIL_BUFFER_BIT);this._isClippedToWorldExtent=this._worldExtentClipRenderer.render(B,H)};E.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();
this.textureUploadManager.destroy();this._blitRenderer=l.disposeMaybe(this._blitRenderer);this._worldExtentClipRenderer=l.disposeMaybe(this._worldExtentClipRenderer);this._brushCache&&(this._brushCache.forEach(B=>B.dispose()),this._brushCache.clear(),this._brushCache=null);if(this._fbos){let B;for(B in this._fbos)this._fbos[B]&&this._fbos[B].dispose()}for(const B of this._fboPool)B.dispose();this._fboPool.length=0;if(this.effects){let B;for(B in this.effects)this.effects[B]&&this.effects[B].dispose()}this._effectsManager.dispose();
this._vtlMaterialManager=l.disposeMaybe(this._vtlMaterialManager);this._prevFBO=null};E.getBrush=function(B,G){B=C(B,G);G=this._brushCache.get(B);void 0===G&&(G=new B,this._brushCache.set(B,G));return G};E.renderObject=function(B,G,H,I){if(H=F.brushes[H]){var J=this._brushCache.get(H);void 0===J&&(J=new H,this._brushCache.set(H,J));J.prepareState(B,I);J.draw(B,G,I)}};E.renderObjects=function(B,G,H,I){if(H=F.brushes[H]){var J=this._brushCache.get(H);void 0===J&&(J=new H,this._brushCache.set(H,J));
J.drawMany(B,G,I)}};E.registerRenderPass=function(B){const G=B.brushes.map(H=>{this._brushCache.has(H)||this._brushCache.set(H,new H);return this._brushCache.get(H)});return new q(G,B)};E.blitTexture=function(B,G,H,I=1){B.setBlendingEnabled(!0);B.setBlendFunctionSeparate(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA,v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);B.setColorMask(!0,!0,!0,!0);this._blitRenderer.render(B,G,H,I)};E.getPostProcessingEffects=function(B){return this._effectsManager.getPostProcessingEffects(B)};
E._getOutputFBO=function(){return null!=this._renderTarget?this._renderTarget:this._fbos?.output??null};E._applyEffects=function(B,G){const H=this._fbos?.blend;if(H){var {context:I}=B;G=this._effectsManager.getPostProcessingEffects(G);for(const {postProcessingEffect:J,effect:L}of G)I.bindFramebuffer(H),J.draw(B,H,L)}};n._createClass(x,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}}]);return x}()})},"esri/views/2d/engine/brushes":function(){define("exports ./webgl/brushes/BrushBitmap ./webgl/brushes/BrushClip ./webgl/brushes/BrushOverlay ./webgl/brushes/WGLBrushDotDensity ./webgl/brushes/WGLBrushHeatmap ./webgl/brushes/WGLBrushInfo ./webgl/brushes/WGLBrushPieChart ./webgl/brushes/WGLBrushStencil ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol ./webgl/brushes/WGLGeometryBrushFill ./webgl/brushes/WGLGeometryBrushLabel ./webgl/brushes/WGLGeometryBrushLine ./webgl/brushes/WGLGeometryBrushMarker ./webgl/brushes/WGLGeometryBrushText".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t){n.brushes={marker:q,line:p,fill:e,text:t,label:k,clip:F,stencil:f,bitmap:l,overlay:D,tileInfo:m,vtlBackground:d.WGLBrushVTLBackground,vtlFill:a.WGLBrushVTLFill,vtlLine:b.WGLBrushVTLLine,vtlCircle:c.WGLBrushVTLCircle,vtlSymbol:g.WGLBrushVTLSymbol,dotDensity:A,heatmap:u,pieChart:h};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],function(n,l,F,D,A){const u={nearest:{defines:[],samplingMode:A.TextureSamplingMode.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:A.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:A.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:A.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};return function(m){function h(){var d=m.apply(this,arguments)||this;d._desc={vsPath:"raster/bitmap",
fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])};return d}n._inherits(h,m);var f=h.prototype;f.dispose=function(){this._quad&&this._quad.dispose()};f.prepareState=function({context:d}){d.setBlendingEnabled(!0);d.setColorMask(!0,!0,!0,!0);d.setStencilWriteMask(0);d.setStencilTestEnabled(!0)};f.draw=function(d,c){const {context:a,renderingOptions:b,painter:g,requestRender:e,allowDelayedRender:k}=d;if(c.source&&c.isReady){if("dynamic"===b.samplingMode){({state:q}=d);var p=c.resolution/c.pixelRatio/
q.resolution;const w=Math.round(d.pixelRatio)!==d.pixelRatio;var q=q.rotation||1.05<p||.95>p||w||c.isSourceScaled||c.rotation?u.bilinear:u.nearest}else q=u[b.samplingMode];p=g.materialManager.getProgram(this._desc,q.defines);if(k&&null!=e&&!p.compiled)e();else{d.timeline.begin(this.name);"additive"===c.blendFunction?a.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE,A.BlendFactor.ONE,A.BlendFactor.ONE):a.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA,A.BlendFactor.ONE,
A.BlendFactor.ONE_MINUS_SRC_ALPHA);a.setStencilFunction(A.CompareFunction.EQUAL,c.stencilRef,255);this._quad||(this._quad=new F(a,[0,0,1,0,0,1,1,1]));var {coordScale:t,computedOpacity:v,transforms:y}=c;c.setSamplingProfile(q);c.bind(d.context,l.TEXTURE_BINDING_BITMAP);a.useProgram(p);p.setUniformMatrix3fv("u_dvsMat3",y.dvs);p.setUniform1i("u_texture",l.TEXTURE_BINDING_BITMAP);p.setUniform2fv("u_coordScale",t);p.setUniform1f("u_opacity",v);this._quad.draw();d.timeline.end(this.name)}}};return n._createClass(h)}(D)})},
"esri/views/2d/engine/webgl/VertexStream":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],function(n,l,F,D,A){return function(){function u(h,f){this._rctx=h;this._vertexBuffer=l.BufferObject.createVertex(h,F.Usage.STATIC_DRAW,new Uint16Array(f));this._vao=new D.VertexArrayObject(h,new Map([["a_position",0]]),{geometry:[new A.VertexElementDescriptor("a_position",
2,F.DataType.SHORT,0,4)]},{geometry:this._vertexBuffer});this._count=f.length/2}var m=u.prototype;m.bind=function(){this._rctx.bindVAO(this._vao)};m.unbind=function(){this._rctx.bindVAO(null)};m.dispose=function(){this._vao.dispose()};m.draw=function(){this._rctx.bindVAO(this._vao);this._rctx.drawArrays(F.PrimitiveType.TRIANGLE_STRIP,0,this._count)};return n._createClass(u)}()})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(n,
l){l=l._createClass(function(F,D,A,u,m,h=!1,f=0){this.name=F;this.count=D;this.type=A;this.offset=u;this.stride=m;this.normalized=h;this.divisor=f});n.VertexElementDescriptor=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}var F=l.prototype;F.prepareState=
function(D,A){};F.draw=function(D,A,u){};F.drawMany=function(D,A,u){for(const m of A)m.visible&&this.draw(D,m,u)};return n._createClass(l)}()})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/enums ../../../../webgl/ProgramTemplate".split(" "),function(n,l,F,D,A,u,m){return function(h){function f(){var c=h.apply(this,arguments)||this;
c._color=l.fromValues(0,1,0,1);return c}n._inherits(f,h);var d=f.prototype;d.dispose=function(){this._program&&this._program.dispose()};d.prepareState=function({context:c}){c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setFaceCullingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(u.StencilOperation.KEEP,u.StencilOperation.KEEP,u.StencilOperation.REPLACE);c.setStencilWriteMask(255);c.setStencilFunction(u.CompareFunction.ALWAYS,0,255)};d.draw=function(c,a){const {context:b,state:g,requestRender:e,
allowDelayedRender:k}=c;c=F.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.SHORT}]});a=a.getVAO(b,g,c.attributes,c.bufferLayouts);null!=a.indexBuffer&&(this._program||(this._program=m.createProgram(b,A.background)),k&&null!=e&&!this._program.compiled?e():(b.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",g.displayMat3),b.bindVAO(a),
b.drawElements(u.PrimitiveType.TRIANGLES,a.indexBuffer.size,u.DataType.UNSIGNED_INT,0),b.bindVAO()))};return n._createClass(f)}(D)})},"esri/chunks/vec4f32":function(){define(["exports"],function(n){function l(){return new Float32Array(4)}function F(t){const v=new Float32Array(4);v[0]=t[0];v[1]=t[1];v[2]=t[2];v[3]=t[3];return v}function D(t,v,y,w){const z=new Float32Array(4);z[0]=t;z[1]=v;z[2]=y;z[3]=w;return z}function A(t,v){return new Float32Array(t,v,4)}function u(){return l()}function m(){return D(1,
1,1,1)}function h(){return D(1,0,0,0)}function f(){return D(0,1,0,0)}function d(){return D(0,0,1,0)}function c(){return D(0,0,0,1)}const a=l(),b=m(),g=h(),e=f(),k=d(),p=c(),q=Object.freeze(Object.defineProperty({__proto__:null,ONES:b,UNIT_W:p,UNIT_X:g,UNIT_Y:e,UNIT_Z:k,ZEROS:a,clone:F,create:l,createView:A,fromValues:D,ones:m,unitW:c,unitX:h,unitY:f,unitZ:d,zeros:u},Symbol.toStringTag,{value:"Module"}));n.ONES=b;n.UNIT_W=p;n.UNIT_X=g;n.UNIT_Y=e;n.UNIT_Z=k;n.ZEROS=a;n.clone=F;n.create=l;n.createView=
A;n.fromValues=D;n.ones=m;n.unitW=c;n.unitX=h;n.unitY=f;n.unitZ=d;n.vec4f32=q;n.zeros=u})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ./enums ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),function(n,l,F,D,A,u,m){function h(J){const L={};for(const K of J)L[K.name]=K.strideInBytes;return L}function f(J){switch(J){case A.WGLGeometryType.MARKER:return w;case A.WGLGeometryType.FILL:return z;
case A.WGLGeometryType.LINE:return r;case A.WGLGeometryType.TEXT:return C;case A.WGLGeometryType.LABEL:return x}}function d(J){switch(J%4){case 0:case 2:return 4;case 1:case 3:return 1}}function c(J){switch(J){case u.DataType.BYTE:case u.DataType.UNSIGNED_BYTE:return 1;case u.DataType.SHORT:case u.DataType.UNSIGNED_SHORT:return 2;case u.DataType.FLOAT:case u.DataType.INT:case u.DataType.UNSIGNED_INT:return 4}}function a(J){const L={};for(const K in J){let S=0;L[K]=J[K].map(W=>{const X=new m.VertexElementDescriptor(W.name,
W.count,W.type,S,0,W.normalized||!1);S+=W.count*c(W.type);return X});L[K]?.forEach(W=>W.stride=S)}return L}const b=F.getLogger("esri.views.2d.engine.webgl.Utils"),g=h([{name:"geometry",strideInBytes:36}]),e=h([{name:"geometry",strideInBytes:12}]),k=h([{name:"geometry",strideInBytes:36}]),p=h([{name:"geometry",strideInBytes:24}]),q=h([{name:"geometry",strideInBytes:12}]),t=h([{name:"geometry",strideInBytes:40}]),v=h([{name:"geometry",strideInBytes:36}]),y=h([{name:"geometry",strideInBytes:36}]),w=
["geometry"],z=["geometry"],r=["geometry"],C=["geometry"],x=["geometry"];F={geometry:u.Usage.STATIC_DRAW};const E=new Map,B=J=>null!=J&&J.startsWith("data:image/gif"),G=J=>null!=J&&J.startsWith("data:image/png"),H=J=>{if(!J)return!1;J=J.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(J)&&/[\dz]$/i.test(J)&&4<J.length?!0:!1},I=J=>"fill"===J.type&&"CIMMarkerPlacementInsidePolygon"===J?.cim?.markerPlacement?.type;n.C_VBO_INFO=F;n.allocateTypedArrayBuffer=function(J,L){switch(L%4){case 0:case 2:return new Uint32Array(Math.floor(J*
L/4));case 1:case 3:return new Uint8Array(J*L)}};n.allocateTypedArrayBufferwithData=function(J,L){switch(L%4){case 0:case 2:return new Uint32Array(J);case 1:case 3:return new Uint8Array(J)}};n.charCodes=function(J){const L=[];for(let K=0;K<J.length;K++)L.push(J.charCodeAt(K));return L};n.copyMeshData=function(J,L,K,S,W,X,Z){for(const P in X){var V=X[P].stride,O=d(V);const M=X[P].data,Q=K[P].data;if(null==M||null==Q)continue;const R=V*W.vertexCount/O,aa=V*J/O;V=V*W.vertexFrom/O;for(O=0;O<R;++O)Q[O+
aa]=M[O+V]}if(null!=Z&&null!=S)for(K=W.indexCount,X=0;X<K;++X)S[X+L]=Z[X+W.indexFrom]-W.vertexFrom+J};n.createGeometryData=function(J,L){const K=[];for(let S=0;5>S;++S){const W=f(S),X={};for(const Z of W)X[Z]={data:L(S,Z)};K.push({data:J(S),buffers:X})}return K};n.createProgramDescriptor=(J,L)=>{if(!E.has(J)){const W=a(L);var K=W;var S={};for(const X in K){const Z=K[X];S[X]=Z?.length?Z[0].stride:0}K=S;S=new Map;for(const X in L)for(const Z of L[X])S.set(Z.name,Z.location);E.set(J,{strides:K,bufferLayouts:W,
attributes:S})}return E.get(J)};n.forEachGeometryType=function(J){J(A.WGLGeometryType.FILL);J(A.WGLGeometryType.LINE);J(A.WGLGeometryType.MARKER);J(A.WGLGeometryType.TEXT);J(A.WGLGeometryType.LABEL)};n.getBytes=c;n.getCapType=function(J){switch(J){case "butt":return D.CapType.BUTT;case "round":return D.CapType.ROUND;case "square":return D.CapType.SQUARE;default:return b.error(new l("mapview-invalid-type",`Cap type ${J} is not a valid option. Defaulting to round`)),D.CapType.ROUND}};n.getJoinType=
function(J){switch(J){case "miter":return D.JoinType.MITER;case "bevel":return D.JoinType.BEVEL;case "round":return D.JoinType.ROUND;default:return b.error(new l("mapview-invalid-type",`Join type ${J} is not a valid option. Defaulting to round`)),D.JoinType.ROUND}};n.getNamedBuffers=f;n.getPMSResourceSize=function(J){const L="width"in J&&J.width||"size"in J&&J.size||0;return"maxVVSize"in J&&J.maxVVSize||L};n.getPixelArrayCtor=function(J){switch(J){case u.PixelType.UNSIGNED_BYTE:return Uint8Array;
case u.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case u.PixelType.FLOAT:return Float32Array;default:b.error(new l("webgl-utils",`Unable to handle type ${J}`))}};n.getPixelBytes=function(J){switch(J){case u.PixelType.UNSIGNED_BYTE:return 1;case u.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case u.PixelType.FLOAT:return 4;default:b.error(new l("webgl-utils",`Unable to handle type ${J}`))}};n.getStrides=function(J,L){switch(J){case A.WGLGeometryType.MARKER:switch(L){case A.WGLSymbologyType.HEATMAP:return e;
default:return g}case A.WGLGeometryType.FILL:switch(L){case A.WGLSymbologyType.DOT_DENSITY:return q;case A.WGLSymbologyType.SIMPLE:case A.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return p;default:return k}case A.WGLGeometryType.LINE:return t;case A.WGLGeometryType.TEXT:return v;case A.WGLGeometryType.LABEL:return y}};n.getUrl=J=>"imageData"in J&&J.imageData&&"contentType"in J&&J.contentType?`data:${J.contentType};base64,${J.imageData}`:"url"in J?J.url:null;n.getVVType=function(J){switch(J){case "opacity":return A.VVType.OPACITY;
case "color":return A.VVType.COLOR;case "rotation":return A.VVType.ROTATION;case "size":return A.VVType.SIZE;default:return b.error(`Cannot interpret unknown vv: ${J}`),null}};n.is3D=J=>J.type&&J.type.toLowerCase().includes("3d");n.isDefined=function(J){return null!=J};n.isGIF=J=>"url"in J&&J.url&&(J.url.includes(".gif")||B(J.url))||"contentType"in J&&"image/gif"===J.contentType||"imageData"in J&&B(J.imageData);n.isGIFDataUri=B;n.isImageResource=J=>"url"in J&&J.url||"imageData"in J&&J.imageData;n.isMarkerPlacementInsidePolygon=
I;n.isNumber=function(J){return"number"===typeof J};n.isPNG=J=>"url"in J&&J.url&&(J.url.includes(".png")||G(J.url))||"contentType"in J&&"image/png"===J.contentType||"imageData"in J&&G(J.imageData);n.isPNGDataUri=G;n.isSVGImage=J=>J.includes("data:image/svg+xml");n.isSVGResource=J=>"path"in J&&H(J.path);n.isSimple=function(J){switch(J.type){case "line":return"CIMSolidStroke"===J.cim.type&&!J.dashTemplate;case "fill":return"CIMSolidFill"===J.cim.type;case "esriSFS":return"esriSFSSolid"===J.style||"esriSFSNull"===
J.style;case "esriSLS":return"esriSLSSolid"===J.style||"esriSLSNull"===J.style;default:return!1}};n.isValidSVG=H;n.shouldRepeat=function(J){switch("cim"in J?J.cim.type:J.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":return!1;case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":return I(J);default:return!0}};n.strideToPackingFactor=d;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(n){n.CapType=
void 0;(function(l){l[l.BUTT=0]="BUTT";l[l.ROUND=1]="ROUND";l[l.SQUARE=2]="SQUARE";l[l.UNKNOWN=4]="UNKNOWN"})(n.CapType||(n.CapType={}));n.JoinType=void 0;(function(l){l[l.BEVEL=0]="BEVEL";l[l.ROUND=1]="ROUND";l[l.MITER=2]="MITER";l[l.UNKNOWN=4]="UNKNOWN"})(n.JoinType||(n.JoinType={}));n.Alignment=void 0;(function(l){l[l.SCREEN=0]="SCREEN";l[l.MAP=1]="MAP"})(n.Alignment||(n.Alignment={}));n.ExternalColorMixMode=void 0;(function(l){l[l.Tint=0]="Tint";l[l.Ignore=1]="Ignore";l[l.Multiply=99]="Multiply"})(n.ExternalColorMixMode||
(n.ExternalColorMixMode={}));n.ExtremityPlacement=void 0;(function(l){l.Both="Both";l.JustBegin="JustBegin";l.JustEnd="JustEnd";l.None="None"})(n.ExtremityPlacement||(n.ExtremityPlacement={}));n.FillMode=void 0;(function(l){l[l.Mosaic=0]="Mosaic";l[l.Centered=1]="Centered"})(n.FillMode||(n.FillMode={}));n.FontEffects=void 0;(function(l){l[l.Normal=0]="Normal";l[l.Superscript=1]="Superscript";l[l.Subscript=2]="Subscript"})(n.FontEffects||(n.FontEffects={}));n.FontEncoding=void 0;(function(l){l[l.MSSymbol=
0]="MSSymbol";l[l.Unicode=1]="Unicode"})(n.FontEncoding||(n.FontEncoding={}));n.FontType=void 0;(function(l){l[l.Unspecified=0]="Unspecified";l[l.TrueType=1]="TrueType";l[l.PSOpenType=2]="PSOpenType";l[l.TTOpenType=3]="TTOpenType";l[l.Type1=4]="Type1"})(n.FontType||(n.FontType={}));n.AngleAlignment=void 0;(function(l){l[l.Display=0]="Display";l[l.Map=1]="Map"})(n.AngleAlignment||(n.AngleAlignment={}));n.AnimatedSymbolRepeatType=void 0;(function(l){l.None="None";l.Loop="Loop";l.Oscillate="Oscillate"})(n.AnimatedSymbolRepeatType||
(n.AnimatedSymbolRepeatType={}));n.DominantSizeAxis=void 0;(function(l){l[l.Z=0]="Z";l[l.X=1]="X";l[l.Y=2]="Y"})(n.DominantSizeAxis||(n.DominantSizeAxis={}));n.RotationOrder=void 0;(function(l){l[l.XYZ=0]="XYZ";l[l.ZXY=1]="ZXY";l[l.YXZ=2]="YXZ"})(n.RotationOrder||(n.RotationOrder={}));n.BalloonCalloutStyle=void 0;(function(l){l[l.Rectangle=0]="Rectangle";l[l.RoundedRectangle=1]="RoundedRectangle";l[l.Oval=2]="Oval"})(n.BalloonCalloutStyle||(n.BalloonCalloutStyle={}));n.BlendingMode=void 0;(function(l){l[l.None=
0]="None";l[l.Alpha=1]="Alpha";l[l.Screen=2]="Screen";l[l.Multiply=3]="Multiply";l[l.Add=4]="Add"})(n.BlendingMode||(n.BlendingMode={}));n.BlockProgression=void 0;(function(l){l[l.TTB=0]="TTB";l[l.RTL=1]="RTL";l[l.BTT=2]="BTT"})(n.BlockProgression||(n.BlockProgression={}));n.BillBoardMode=void 0;(function(l){l[l.None=0]="None";l[l.SignPost=1]="SignPost";l[l.FaceNearPlane=2]="FaceNearPlane"})(n.BillBoardMode||(n.BillBoardMode={}));n.CGAAttributeType=void 0;(function(l){l[l.Float=0]="Float";l[l.String=
1]="String";l[l.Boolean=2]="Boolean"})(n.CGAAttributeType||(n.CGAAttributeType={}));n.ClippingType=void 0;(function(l){l[l.Intersect=0]="Intersect";l[l.Subtract=1]="Subtract"})(n.ClippingType||(n.ClippingType={}));n.GeometricEffectArrowType=void 0;(function(l){l.OpenEnded="OpenEnded";l.Block="Block";l.Crossed="Crossed"})(n.GeometricEffectArrowType||(n.GeometricEffectArrowType={}));n.GeometricEffectControlMeasureLineRule=void 0;(function(l){l.FullGeometry="FullGeometry";l.PerpendicularFromFirstSegment=
"PerpendicularFromFirstSegment";l.ReversedFirstSegment="ReversedFirstSegment";l.PerpendicularToSecondSegment="PerpendicularToSecondSegment";l.SecondSegmentWithTicks="SecondSegmentWithTicks";l.DoublePerpendicular="DoublePerpendicular";l.OppositeToFirstSegment="OppositeToFirstSegment";l.TriplePerpendicular="TriplePerpendicular";l.HalfCircleFirstSegment="HalfCircleFirstSegment";l.HalfCircleSecondSegment="HalfCircleSecondSegment";l.HalfCircleExtended="HalfCircleExtended";l.OpenCircle="OpenCircle";l.CoverageEdgesWithTicks=
"CoverageEdgesWithTicks";l.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";l.GapExtentMidline="GapExtentMidline";l.Chevron="Chevron";l.PerpendicularWithArc="PerpendicularWithArc";l.ClosedHalfCircle="ClosedHalfCircle";l.TripleParallelExtended="TripleParallelExtended";l.ParallelWithTicks="ParallelWithTicks";l.Parallel="Parallel";l.PerpendicularToFirstSegment="PerpendicularToFirstSegment";l.ParallelOffset="ParallelOffset";l.OffsetOpposite="OffsetOpposite";l.OffsetSame="OffsetSame";l.CircleWithArc=
"CircleWithArc";l.DoubleJog="DoubleJog";l.PerpendicularOffset="PerpendicularOffset";l.LineExcludingLastSegment="LineExcludingLastSegment";l.MultivertexArrow="MultivertexArrow";l.CrossedArrow="CrossedArrow";l.ChevronArrow="ChevronArrow";l.ChevronArrowOffset="ChevronArrowOffset";l.PartialFirstSegment="PartialFirstSegment";l.Arch="Arch";l.CurvedParallelTicks="CurvedParallelTicks";l.Arc90Degrees="Arc90Degrees"})(n.GeometricEffectControlMeasureLineRule||(n.GeometricEffectControlMeasureLineRule={}));n.GeometricEffectDonutMethod=
void 0;(function(l){l.Mitered="Mitered";l.Bevelled="Bevelled";l.Rounded="Rounded";l.Square="Square";l.TrueBuffer="TrueBuffer"})(n.GeometricEffectDonutMethod||(n.GeometricEffectDonutMethod={}));n.GeometricEffectEnclosingPolygonMethod=void 0;(function(l){l.ClosePath="ClosePath";l.ConvexHull="ConvexHull";l.RectangularBox="RectangularBox"})(n.GeometricEffectEnclosingPolygonMethod||(n.GeometricEffectEnclosingPolygonMethod={}));n.GeometricEffectExtensionOrigin=void 0;(function(l){l.BeginningOfLine="BeginningOfLine";
l.EndOfLine="EndOfLine"})(n.GeometricEffectExtensionOrigin||(n.GeometricEffectExtensionOrigin={}));n.GeometricEffectOffsetMethod=void 0;(function(l){l.Mitered="Mitered";l.Bevelled="Bevelled";l.Rounded="Rounded";l.Square="Square"})(n.GeometricEffectOffsetMethod||(n.GeometricEffectOffsetMethod={}));n.GeometricEffectOffsetOption=void 0;(function(l){l.Fast="Fast";l.Accurate="Accurate"})(n.GeometricEffectOffsetOption||(n.GeometricEffectOffsetOption={}));n.GeometricEffectOffsetTangentMethod=void 0;(function(l){l.BeginningOfLine=
"BeginningOfLine";l.EndOfLine="EndOfLine"})(n.GeometricEffectOffsetTangentMethod||(n.GeometricEffectOffsetTangentMethod={}));n.GeometricEffectWaveform=void 0;(function(l){l.Sinus="Sinus";l.Square="Square";l.Triangle="Triangle";l.Random="Random"})(n.GeometricEffectWaveform||(n.GeometricEffectWaveform={}));n.GlyphHinting=void 0;(function(l){l[l.None=0]="None";l[l.Default=1]="Default";l[l.Force=2]="Force"})(n.GlyphHinting||(n.GlyphHinting={}));n.GradientAlignment=void 0;(function(l){l[l.Buffered=0]=
"Buffered";l[l.Left=1]="Left";l[l.Right=2]="Right";l[l.AlongLine=3]="AlongLine"})(n.GradientAlignment||(n.GradientAlignment={}));n.GradientFillMethod=void 0;(function(l){l[l.Linear=0]="Linear";l[l.Rectangular=1]="Rectangular";l[l.Circular=2]="Circular";l[l.Buffered=3]="Buffered"})(n.GradientFillMethod||(n.GradientFillMethod={}));n.GradientStrokeType=void 0;(function(l){l[l.Discrete=0]="Discrete";l[l.Continuous=1]="Continuous"})(n.GradientStrokeType||(n.GradientStrokeType={}));n.GradientStrokeMethod=
void 0;(function(l){l[l.AcrossLine=0]="AcrossLine";l[l.AloneLine=1]="AloneLine"})(n.GradientStrokeMethod||(n.GradientStrokeMethod={}));n.HorizontalAlignment=void 0;(function(l){l[l.Left=0]="Left";l[l.Right=1]="Right";l[l.Center=2]="Center";l[l.Justify=3]="Justify"})(n.HorizontalAlignment||(n.HorizontalAlignment={}));n.LeaderLineStyle=void 0;(function(l){l[l.Base=0]="Base";l[l.MidPoint=1]="MidPoint";l[l.ThreePoint=2]="ThreePoint";l[l.FourPoint=3]="FourPoint";l[l.Underline=4]="Underline";l[l.CircularCW=
5]="CircularCW";l[l.CircularCCW=6]="CircularCCW"})(n.LeaderLineStyle||(n.LeaderLineStyle={}));n.LineCapStyle=void 0;(function(l){l.Butt="Butt";l.Round="Round";l.Square="Square"})(n.LineCapStyle||(n.LineCapStyle={}));n.LineDashEnding=void 0;(function(l){l.NoConstraint="NoConstraint";l.HalfPattern="HalfPattern";l.HalfGap="HalfGap";l.FullPattern="FullPattern";l.FullGap="FullGap";l.Custom="Custom"})(n.LineDashEnding||(n.LineDashEnding={}));n.LineDecorationStyle=void 0;(function(l){l[l.None=-1]="None";
l[l.Custom=0]="Custom";l[l.Circle=1]="Circle";l[l.OpenArrow=2]="OpenArrow";l[l.ClosedArrow=3]="ClosedArrow";l[l.Diamond=4]="Diamond"})(n.LineDecorationStyle||(n.LineDecorationStyle={}));n.LineGapType=void 0;(function(l){l[l.ExtraLeading=0]="ExtraLeading";l[l.Multiple=1]="Multiple";l[l.Exact=2]="Exact"})(n.LineGapType||(n.LineGapType={}));n.LineJoinStyle=void 0;(function(l){l.Bevel="Bevel";l.Round="Round";l.Miter="Miter"})(n.LineJoinStyle||(n.LineJoinStyle={}));n.ExpressionReturnType=void 0;(function(l){l[l.Default=
0]="Default";l[l.String=1]="String";l[l.Numeric=2]="Numeric"})(n.ExpressionReturnType||(n.ExpressionReturnType={}));n.MarkerPlacementType=void 0;(function(l){l[l.InsidePolygon=0]="InsidePolygon";l[l.PolygonCenter=1]="PolygonCenter";l[l.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(n.MarkerPlacementType||(n.MarkerPlacementType={}));n.MaterialMode=void 0;(function(l){l[l.Tint=0]="Tint";l[l.Replace=1]="Replace";l[l.Multiply=2]="Multiply"})(n.MaterialMode||(n.MaterialMode={}));n.PlacementClip=void 0;
(function(l){l[l.ClipAtBoundary=0]="ClipAtBoundary";l[l.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";l[l.DoNotTouchBoundary=2]="DoNotTouchBoundary";l[l.DoNotClip=3]="DoNotClip"})(n.PlacementClip||(n.PlacementClip={}));n.PlacementEndings=void 0;(function(l){l.NoConstraint="NoConstraint";l.WithMarkers="WithMarkers";l.WithFullGap="WithFullGap";l.WithHalfGap="WithHalfGap";l.Custom="Custom"})(n.PlacementEndings||(n.PlacementEndings={}));n.PlacementGridType=void 0;(function(l){l.Fixed=
"Fixed";l.Random="Random";l.RandomFixedQuantity="RandomFixedQuantity"})(n.PlacementGridType||(n.PlacementGridType={}));n.PlacementOnLineRelativeTo=void 0;(function(l){l.LineMiddle="LineMiddle";l.LineBeginning="LineBeginning";l.LineEnd="LineEnd";l.SegmentMidpoint="SegmentMidpoint"})(n.PlacementOnLineRelativeTo||(n.PlacementOnLineRelativeTo={}));n.PlacementPolygonCenterMethod=void 0;(function(l){l.OnPolygon="OnPolygon";l.CenterOfMass="CenterOfMass";l.BoundingBoxCenter="BoundingBoxCenter"})(n.PlacementPolygonCenterMethod||
(n.PlacementPolygonCenterMethod={}));n.PlacementRandomlyAlongLineRandomization=void 0;(function(l){l[l.Low=0]="Low";l[l.Medium=1]="Medium";l[l.High=2]="High"})(n.PlacementRandomlyAlongLineRandomization||(n.PlacementRandomlyAlongLineRandomization={}));n.PlacementStepPosition=void 0;(function(l){l[l.MarkerCenter=0]="MarkerCenter";l[l.MarkerBounds=1]="MarkerBounds"})(n.PlacementStepPosition||(n.PlacementStepPosition={}));n.PointSymbolCalloutScale=void 0;(function(l){l[l.None=0]="None";l[l.PropUniform=
1]="PropUniform";l[l.PropNonuniform=2]="PropNonuniform";l[l.DifUniform=3]="DifUniform";l[l.DifNonuniform=4]="DifNonuniform"})(n.PointSymbolCalloutScale||(n.PointSymbolCalloutScale={}));n.Simple3DLineStyle=void 0;(function(l){l.Tube="Tube";l.Strip="Strip";l.Wall="Wall"})(n.Simple3DLineStyle||(n.Simple3DLineStyle={}));n.SizeVariationMethod=void 0;(function(l){l[l.Random=0]="Random";l[l.Increasing=1]="Increasing";l[l.Decreasing=2]="Decreasing";l[l.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(n.SizeVariationMethod||
(n.SizeVariationMethod={}));n.SymbolUnits=void 0;(function(l){l[l.Relative=0]="Relative";l[l.Absolute=1]="Absolute"})(n.SymbolUnits||(n.SymbolUnits={}));n.TextCase=void 0;(function(l){l[l.Normal=0]="Normal";l[l.LowerCase=1]="LowerCase";l[l.Allcaps=2]="Allcaps"})(n.TextCase||(n.TextCase={}));n.TextReadingDirection=void 0;(function(l){l[l.LTR=0]="LTR";l[l.RTL=1]="RTL"})(n.TextReadingDirection||(n.TextReadingDirection={}));n.TextureFilter=void 0;(function(l){l.Draft="Draft";l.Picture="Picture";l.Text=
"Text"})(n.TextureFilter||(n.TextureFilter={}));n.VerticalAlignment=void 0;(function(l){l[l.Top=0]="Top";l[l.Center=1]="Center";l[l.Baseline=2]="Baseline";l[l.Bottom=3]="Bottom"})(n.VerticalAlignment||(n.VerticalAlignment={}));n.VerticalGlyphOrientation=void 0;(function(l){l[l.Right=0]="Right";l[l.Upright=1]="Upright"})(n.VerticalGlyphOrientation||(n.VerticalGlyphOrientation={}));n.WaterbodySize=void 0;(function(l){l[l.Small=0]="Small";l[l.Medium=1]="Medium";l[l.Large=2]="Large"})(n.WaterbodySize||
(n.WaterbodySize={}));n.WaveStrength=void 0;(function(l){l[l.Calm=0]="Calm";l[l.Rippled=1]="Rippled";l[l.Slight=2]="Slight";l[l.Moderate=3]="Moderate"})(n.WaveStrength||(n.WaveStrength={}));Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(n,l){l={shaders:{vertexShader:l.resolveIncludes("background/background.vert"),fragmentShader:l.resolveIncludes("background/background.frag")},
attributes:new Map([["a_pos",0]])};n.background=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(n,l,F){const D=new F.ShaderCompiler(function(A){let u=l;A.split("/").forEach(m=>{u&&(u=u[m])});return u});n.resolveIncludes=function(A){return D.resolveIncludes(A)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",
"background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color \x3d texture2D(u_tex, v_uv);\ngl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_pos, 0.0, 1.0);\nv_uv \x3d a_tex;\n}"},
blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\nuniform lowp float u_inFadeOpacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\nfloat vIn \x3d rgb2v(Cb);\nvec3 hsvTint \x3d rgb2hsv(Cs);\nvec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\nreturn hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 0.0) ? 0.0 : (Cs \x3d\x3d 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 1.0) ? 1.0 : (Cs \x3d\x3d 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\nreturn (Cs \x3d\x3d 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\nif (Cs \x3c\x3d 0.5) {\nreturn Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n}\nif (Cb \x3c\x3d 0.25) {\nreturn Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n}\nreturn Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\nreturn min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\nreturn max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\nreturn dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\nreturn maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\nfloat lum \x3d lumv3(color);\nfloat mincol \x3d minv3(color);\nfloat maxcol \x3d maxv3(color);\nif (mincol \x3c 0.0) {\ncolor \x3d lum + ((color - lum) * lum) / (lum - mincol);\n}\nif (maxcol \x3e 1.0) {\ncolor \x3d lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n}\nreturn color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\nfloat lbase \x3d lumv3(cbase);\nfloat llum \x3d lumv3(clum);\nfloat ldiff \x3d llum - lbase;\nvec3 color \x3d cbase + vec3(ldiff);\nreturn clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\nfloat minbase \x3d minv3(cbase);\nfloat sbase \x3d satv3(cbase);\nfloat ssat \x3d satv3(csat);\nvec3 color;\nif (sbase \x3e 0.0) {\ncolor \x3d (cbase - minbase) * ssat / sbase;\n} else {\ncolor \x3d vec3(0.0);\n}\nreturn setLum(color, clum);\n}\nvoid main() {\nvec4 src \x3d texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\ngl_FragColor \x3d src *  u_opacity;\n#else\nvec4 dst \x3d texture2D(u_backbufferTexture, v_uv);\nvec3 Cs \x3d src.a \x3d\x3d 0.0 ? src.rgb : vec3(src.rgb / src.a);\nvec3 Cb \x3d dst.a \x3d\x3d 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\nfloat as \x3d u_opacity * src.a;\nfloat ab \x3d dst.a;\n#ifdef DESTINATION_OVER\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n#endif\n#ifdef SOURCE_IN\nvec4 color \x3d vec4(as * Cs * ab, as * ab);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef DESTINATION_IN\nvec4 color \x3d vec4(ab * Cb * as, ab * as);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef SOURCE_OUT\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n#endif\n#ifdef DESTINATION_OUT\ngl_FragColor \x3d vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n#endif\n#ifdef SOURCE_ATOP\ngl_FragColor \x3d vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n#endif\n#ifdef DESTINATION_ATOP\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n#endif\n#ifdef XOR\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\nas * (1.0 - ab) + ab * (1.0 - as));\n#endif\n#ifdef MULTIPLY\ngl_FragColor \x3d vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\nas + ab * (1.0 - as));\n#endif\n#ifdef SCREEN\ngl_FragColor \x3d vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef OVERLAY\nvec3 f \x3d vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DARKEN\ngl_FragColor \x3d vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LIGHTER\ngl_FragColor \x3d vec4(as * Cs + ab * Cb, as + ab);\n#endif\n#ifdef LIGHTEN\ngl_FragColor \x3d vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_DODGE\nvec3 f \x3d clamp(vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_BURN\nvec3 f \x3d vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HARD_LIGHT\nvec3 f \x3d vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SOFT_LIGHT\nvec3 f \x3d vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DIFFERENCE\ngl_FragColor \x3d vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef EXCLUSION\nvec3 f \x3d Cs + Cb - 2.0 * Cs * Cb;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef INVERT\ngl_FragColor \x3d vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n#endif\n#ifdef VIVID_LIGHT\nvec3 f \x3d vec3(clamp(vividLight(Cb.r, Cs.r), 0.0, 1.0),\nclamp(vividLight(Cb.g, Cs.g), 0.0, 1.0),\nclamp(vividLight(Cb.b, Cs.b), 0.0, 1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HUE\nvec3 f \x3d setLumSat(Cs,Cb,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SATURATION\nvec3 f \x3d setLumSat(Cb,Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR\nvec3 f \x3d setLum(Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LUMINOSITY\nvec3 f \x3d setLum(Cb,Cs);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef PLUS\ngl_FragColor \x3d clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n#endif\n#ifdef MINUS\ngl_FragColor \x3d vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n#endif\n#ifdef AVERAGE\nvec3 f \x3d (Cb + Cs) / 2.0;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef REFLECT\nvec3 f \x3d clamp(vec3(reflectBlend(Cb.r, Cs.r),\nreflectBlend(Cb.g, Cs.g),\nreflectBlend(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#endif\n}",
"blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_position , 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor \x3d v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position \x3d a_PositionAndFlags.xy;\nfloat flags \x3d a_PositionAndFlags.z;\nint colorIndex \x3d int(mod(flags, 4.0));\nvec4 color;\nfor (int i \x3d 0; i \x3c 4; i++) {\ncolor \x3d u_colors[i];\nif (i \x3d\x3d colorIndex) {\nbreak;\n}\n}\nint opacityIndex \x3d int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i \x3d 0; i \x3c 4; i++) {\nopacity \x3d u_opacities[i];\nif (i \x3d\x3d opacityIndex) {\nbreak;\n}\n}\nv_color \x3d color * opacity;\ngl_Position \x3d vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},
dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist \x3d length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha \x3d smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor \x3d v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON \x3d 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture \x3d mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords \x3d tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color \x3d texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth \x3d max(u_dotSize / 2., 1.) ;\nfloat z \x3d 0.;\nz +\x3d 2.0 * step(v_color.a, EPSILON);\ngl_PointSize \x3d (smoothEdgeWidth + u_dotSize);\ngl_Position \x3d vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio \x3d u_dotSize / gl_PointSize;\nv_invEdgeRatio \x3d -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *\x3d (u_pixelRatio * u_tileZoomFactor);\n}"}},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b \x3d 1.0 / 6.0;\nfloat v2 \x3d v * v;\nfloat v3 \x3d v2 * v;\nfloat w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 \x3d b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w \x3d computeWeights(v);\nfloat g0 \x3d w.x + w.y;\nfloat g1 \x3d w.z + w.w;\nfloat h0 \x3d 1.0 - (w.y / g0) + v;\nfloat h1 \x3d 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\nvec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\nvec2 texel \x3d coords * texSize - 0.5;\nvec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 \x3d coords + hgX.x * eX;\nvec2 coords00 \x3d coords - hgX.y * eX;\nvec2 coords11 \x3d coords10 + hgY.x * eY;\nvec2 coords01 \x3d coords00 + hgY.x * eY;\ncoords10 \x3d coords10 - hgY.y * eY;\ncoords00 \x3d coords00 - hgY.y * eY;\nvec4 color00 \x3d texture2D(sampler, coords00);\nvec4 color10 \x3d texture2D(sampler, coords10);\nvec4 color01 \x3d texture2D(sampler, coords01);\nvec4 color11 \x3d texture2D(sampler, coords11);\ncolor00 \x3d mix(color00, color01, hgY.z);\ncolor10 \x3d mix(color10, color11, hgY.z);\ncolor00 \x3d mix(color00, color10, hgX.z);\nreturn color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart \x3d floor(coords * texSize);\nvec2 coord0 \x3d texelStart / texSize;\nvec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 \x3d texture2D(sampler, coord0);\nvec4 color1 \x3d texture2D(sampler, coord1);\nvec4 color2 \x3d texture2D(sampler, coord2);\nvec4 color3 \x3d texture2D(sampler, coord3);\nvec2 blend \x3d fract(coords * texSize);\nvec4 color01 \x3d mix(color0, color1, blend.x);\nvec4 color23 \x3d mix(color2, color3, blend.x);\nvec4 color \x3d mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha \x3d floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor \x3d color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize \x3d 1.0 / texSize;\nvec2 texel \x3d coords * texSize;\nvec2 texel_i \x3d floor(texel);\nvec2 texel_frac \x3d fract(texel);\nvec4 colorP \x3d texture2D(sampler, texel_i * invSize);\nvec4 colorP1 \x3d vec4(colorP);\nvec4 colorP2 \x3d vec4(colorP);\nvec4 colorP3 \x3d vec4(colorP);\nvec4 colorP4 \x3d vec4(colorP);\nvec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\ncolorP1 \x3d colorA;\n}\nif (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\ncolorP2 \x3d colorB;\n}\nif (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\ncolorP3 \x3d colorC;\n}\nif (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\ncolorP4 \x3d colorD;\n}\nvec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\nvec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\nfloat flags \x3d data0.r * 255.0;\nfloat groupMinZoom \x3d data0.g * 255.0;\nfloat isVisible \x3d getFilterBit(flags, 0);\nfloat wouldClip \x3d step(groupMinZoom, u_zoomLevel);\nfloat direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\nfloat dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\nvec4 nextState \x3d vec4(texel + direction * dt);\ngl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\ngl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data \x3d texture2D(u_texture, v_uv);\nfloat density \x3d data.r * COMPRESSION_FACTOR;\ndensity *\x3d u_densityNormalization;\ndensity \x3d (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color \x3d texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}",
"heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w \x3d gauss1(i * u_direction.xy);\ntot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight +\x3d w;\n}\nvoid main(void) {\nmediump float tot \x3d 0.0;\nmediump float weight \x3d 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y \x3d texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 \x3d 0.5;\nmediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d \x3d (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d \x3d estimateDistance();\ngl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlayTexture;\nuniform bool u_maskEnabled;\nuniform bool u_overlayEnabled;\nvarying mediump vec2 v_texCoord;\nconst lowp float barrelFactor \x3d 1.1;\nlowp vec2 barrel(lowp vec2 uv) {\nlowp vec2 uvn \x3d uv * 2.0 - 1.0;\nif (uvn.x \x3d\x3d 0.0 \x26\x26 uvn.y \x3d\x3d 0.0) {\nreturn vec2(0.5, 0.5);\n}\nlowp float theta \x3d atan(uvn.y, uvn.x);\nlowp float r \x3d pow(length(uvn), barrelFactor);\nreturn r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;\n}\nvoid main(void)\n{\nlowp vec4 color \x3d texture2D(u_readbackTexture, barrel(v_texCoord));\ncolor \x3d (color + (1.0 - color.a) * u_background);\nlowp float mask \x3d u_maskEnabled ? texture2D(u_maskTexture, v_texCoord).a : 1.0;\ncolor *\x3d mask;\nlowp vec4 overlayColor \x3d u_overlayEnabled ? texture2D(u_overlayTexture, v_texCoord) : vec4(0);\ngl_FragColor \x3d overlayColor + (1.0 - overlayColor.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec4 u_drawPos;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\nv_texCoord \x3d a_pos;\ngl_Position \x3d vec4(u_drawPos.xy + vec2(a_pos - 0.5) * u_drawPos.zw, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp sampler2D u_attributeData4;\nuniform highp sampler2D u_attributeData5;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel \x3d unpackDisplayIdTexel(id);\nhighp float size \x3d float(u_attributeTextureSize);\nhighp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col \x3d mod(u32, size);\nhighp float row \x3d (u32 - col) / size;\nhighp float u \x3d col / size;\nhighp float v \x3d row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(u_attributeTextureSize));\n}\nhighp vec4 getAttributeData0(in highp vec3 id) {\nvec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData3, coords);\n}\nhighp vec4 getAttributeData4(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData4, coords);\n}\nhighp vec4 getAttributeData5(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(u_attributeData5, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}",
"barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary \x3d abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 \x3d mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 \x3d v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG \x3d 180.0 / 3.141592654;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION \x3d 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.00001;\nconst float EPSILON_HITTEST \x3d 0.05;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR \x3d 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY \x3d 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP \x3d 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE \x3d 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY \x3d 3;\nconst int BITSET_TYPE_FILL_OUTLINE \x3d 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET \x3d 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR \x3d 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR \x3d 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR \x3d 6;\nconst int BITSET_LINE_SCALE_DASH \x3d 2;",
fill:{"common.glsl":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\nlowp vec4 drawLine() {\nfloat v_lineWidth \x3d v_aux1.x;\nvec2  v_normal    \x3d v_aux1.yz;\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color \x3d vec4(0.);\n#ifdef HITTEST\nout_color \x3d v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr \x3d v_aux1;\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\nout_color \x3d v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY \x26\x26 !defined(HIGHLIGHT)\nvec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 \x3d step(0.0, difference0);\nvec4 isPositive1 \x3d step(0.0, difference1);\nfloat weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero \x3d step(weightSum, 0.0);\nfloat greaterThanZero \x3d 1.0 - lessThanEqZero ;\nfloat divisor \x3d (weightSum + lessThanEqZero);\nvec4 weights0 \x3d difference0 * isPositive0 / divisor;\nvec4 weights1 \x3d difference1 * isPositive1 / divisor;\nvec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax \x3d max(max4(difference0), max4(difference1));\nfloat lessThanZero \x3d step(diffMax, 0.0);\nfloat greaterOrEqZero \x3d 1.0 - lessThanZero;\nvec4 isMax0 \x3d step(diffMax, difference0);\nvec4 isMax1 \x3d step(diffMax, difference1);\nvec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color \x3d preEffectColor;\n#else\nout_color \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a \x3d 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline \x3e 0.5) {\ngl_FragColor \x3d drawLine();\n} else {\ngl_FragColor \x3d drawFill();\n}\n#else\ngl_FragColor \x3d drawFill();\n#endif\n}",
"fill.vert":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#include \x3cmaterials/fill/hittest.glsl\x3e\nconst float INV_SCALE_COMPRESSION_FACTOR \x3d 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT \x3d 16777216.0;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs \x3d buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      \x3d outputs.id;\nv_opacity \x3d outputs.opacity;\nv_aux1    \x3d vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color \x3d outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet \x3d a_bitset;\nout_color \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized \x3d mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   \x3d tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   \x3d u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   \x3d a_aux1;\nfloat a_width  \x3d a_aux2.x;\nfloat a_height \x3d a_aux2.y;\nvec2  a_offset \x3d a_aux2.zw;\nvec2  a_scale  \x3d a_aux3.xy;\nfloat a_angle  \x3d a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) \x3e 0.5) {\na_width *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) \x3e 0.5) {\na_height *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale \x3d INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width \x3d u_zoomFactor * a_width * scale.x;\nfloat height \x3d u_zoomFactor * a_height * scale.y;\nfloat angle \x3d C_256_TO_RAD * a_angle;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nfloat dx \x3d 0.0;\nfloat dy \x3d 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) \x3e 0.5) {\nfloat id \x3d rgba2float(vec4(a_id, 0.0));\ndx \x3d rand(vec2(id, 0.0));\ndy \x3d rand(vec2(0.0, id));\n}\nmat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize \x3d vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt \x3d vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection \x3d patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset \x3d u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset \x3d vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset \x3d mod(tileOffset, patternSize);\nvec2 symbolOffset \x3d u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 \x3d a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly \x3d getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) \x3e 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *\x3d (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly \x3d 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords \x3d (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) \x3e 0.5) {\nout_pos \x3d vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize \x3d 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline \x3d getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline \x3e 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  \x3d vec3(0.);\nhighp vec4 color  \x3d vec4(0.);\ndraw(color, pos);\nv_color \x3d color;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}",
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist \x3d u_hittestDist;\nfloat dist \x3d distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3c 0. || dist \x3e\x3d hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3d\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif"},
hittest:{"common.glsl":"#ifdef HITTEST\nuniform float u_hittestDist;\nuniform highp vec2 u_hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L \x3d p2 - p1;\nvec2 A \x3d p0 - p1;\nfloat projAL \x3d projectScalar(A, L);\nfloat t \x3d clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist \x3d distance(pos, vec3(u_hittestPos, 1.));\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) \x3e u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, (dist - size) \x3c 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba \x3d b - a;\nvec2 ca \x3d c - a;\nfloat crossProduct \x3d ba.x * ca.y - ca.x * ba.y;\nbool isParallel \x3d crossProduct \x3c EPSILON_HITTEST \x26\x26 crossProduct \x3e -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) \x3d\x3d 1.) {\nreturn 0.;\n}\nfloat distAB \x3d distPointSegment(p, a, b);\nfloat distBC \x3d distPointSegment(p, b, c);\nfloat distCA \x3d distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},
icon:{"common.glsl":"#include \x3cutil/encoding.glsl\x3e\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth \x3d v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize \x3d min(outlineWidth, size);\noutlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",
heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor \x3d v_hittestResult;\n#else\nfloat radius \x3d length(v_offsetFromCenter);\nfloat shapeWeight \x3d step(radius, 1.0);\nfloat oneMinusRadiusSquared \x3d 1.0 - radius * radius;\nfloat kernelWeight \x3d oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor \x3d vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}",
"heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color \x3d vec4(0.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\nvoid main() {\nfloat filterFlags \x3d getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult \x3d vec4(0.);\nhighp vec3 out_pos \x3d vec3(0.);\nvec3 pos \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult \x3d out_hittestResult;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter \x3d sign(a_vertexOffset);\nv_fieldValue \x3d getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos \x3d centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position \x3d vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase \x3d u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 \x3d scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 \x3d scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 \x3d xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 \x3d xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 \x3d xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 \x3d a_texCoords  / u_mosaicSize;\nvec2 tex1 \x3d a_texCoords1 / u_mosaicSize;\nvec2 tex2 \x3d a_texCoords2 / u_mosaicSize;\nfloat alphaSum \x3d 0.;\nalphaSum +\x3d inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z +\x3d step(alphaSum, .05) * 2.0;\nout_color \x3d vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif",
"icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvoid main()\n{\n#ifdef HITTEST\nvec4 color \x3d v_color;\n#else\nvec4 color \x3d getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/icon/hittest.glsl\x3e\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f \x3d getSize(size.y) / size.y;\nfloat sizeFactor \x3d size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec3  pos           \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        \x3d vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize \x3d a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally \x3d getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               \x3d getMarkerScaleFactor(size, referenceSize);\nsize.xy     *\x3d scaleFactor;\noffset.xy   *\x3d scaleFactor;\noutlineSize *\x3d scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   \x3d a_texCoords / u_mosaicSize;\nfloat filterFlags \x3d getFilterFlags();\nv_color    \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  \x3d getOpacity();\nv_id       \x3d norm(a_id);\nv_pos      \x3d u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  \x3d vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   \x3d getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor \x3d v_isThin;\n#else\nv_overridingOutlineColor \x3d 0.0;\n#endif\nv_outlineWidth \x3d min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor \x3d a_outlineColor;\nv_distRatio \x3d a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color \x3d vec4(0.);\nhighp vec3 out_pos   \x3d vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color \x3d out_color;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle \x3d angle * 360.0 / 254.0;\nfloat mapAngle \x3d u_mapRotation * 360.0 / 254.0;\nfloat diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z \x3d 0.0;\nz +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\nz +\x3d 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    \x3d getMinZoom();\nfloat glyphMinZoom    \x3d a_glyphData.x;\nfloat glyphMaxZoom    \x3d a_glyphData.y;\nfloat glyphAngle      \x3d a_glyphData.z;\nfloat a_isBackground  \x3d a_glyphData.w;\nfloat a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\nfloat fontSize           \x3d a_texAndSize.z;\nfloat haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    \x3d fontSize / SDF_FONT_SIZE;\nfloat halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\nfloat animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor \x3d (isBackground + isText) * a_color;\nv_color     \x3d animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   \x3d 1.0;\nv_tex       \x3d a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset \x3d u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\ngl_Position \x3d vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist \x3d min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3e\x3d u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3c\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif",
"line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\n#ifdef HITTEST\nvoid main() {\ngl_FragColor \x3d v_color;\n}\n#else\nvoid main() {\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor \x3d shadeLine(inputs);\n}\n#endif",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/line/hittest.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\n#ifdef HITTEST\nvoid draw() {\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat a_halfWidth \x3d a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth \x3d a_aux.x / 16. ;\nvec2  a_offset \x3d a_offsetAndNormal.xy / 16.;\nfloat baseWidth \x3d getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos \x3d vec3(0.);\nLineData outputs \x3d buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              \x3d outputs.id;\nv_color           \x3d outputs.color;\nv_normal          \x3d outputs.normal;\nv_lineHalfWidth   \x3d outputs.lineHalfWidth;\nv_opacity         \x3d outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          \x3d outputs.tlbr;\nv_patternSize   \x3d outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio \x3d outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position \x3d vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},
pie:{"pie.frag":"precision mediump float;\n#include \x3cutil/atan2.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvarying float v_size;\nvarying vec2 v_offset;\nvarying vec2 v_filteredSectorToColorId[NUMBER_OF_FIELDS];\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nuniform lowp vec4 u_colors[NUMBER_OF_FIELDS];\nuniform lowp vec4 u_defaultColor;\nuniform lowp vec4 u_othersColor;\nuniform lowp vec4 u_outlineColor;\nuniform float u_donutRatio;\nuniform float u_sectorThreshold;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[NUMBER_OF_FIELDS]) {\n#if __VERSION__ \x3d\x3d 300\nmediump int colorIndex \x3d int(filteredSectorToColorId[index].y);\nreturn u_colors[colorIndex];\n#else\nmediump int colorIndex;\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d index) {\ncolorIndex \x3d int(filteredSectorToColorId[i].y);\n}\n}\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d colorIndex) {\nreturn u_colors[i];\n}\n}\nreturn u_colors[NUMBER_OF_FIELDS - 1];\n#endif\n}\nconst int OTHER_SECTOR_ID \x3d 255;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle \x3d 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle \x3c 0.0) {\nangle +\x3d 360.0;\n} else if (angle \x3e 360.0) {\nangle \x3d mod(angle, 360.0);\n}\nint numOfEntries \x3d int(v_numOfEntries);\nfloat maxSectorAngle \x3d v_maxSectorAngle;\nlowp vec4 fillColor \x3d (maxSectorAngle \x3e 0.0 || u_sectorThreshold \x3e 0.0) ? u_othersColor : u_defaultColor;\nlowp vec4 prevColor \x3d vec4(0.0);\nlowp vec4 nextColor \x3d vec4(0.0);\nfloat startSectorAngle \x3d 0.0;\nfloat endSectorAngle \x3d 0.0;\nif (angle \x3c maxSectorAngle) {\nfor (int index \x3d 0; index \x3c NUMBER_OF_FIELDS; ++index) {\nstartSectorAngle \x3d endSectorAngle;\nendSectorAngle \x3d v_filteredSectorToColorId[index].x;\nif (endSectorAngle \x3e angle) {\nfillColor \x3d getSectorColor(index, v_filteredSectorToColorId);\nprevColor \x3d u_sectorThreshold !\x3d 0.0 \x26\x26 index \x3d\x3d 0 \x26\x26 abs(360.0 - maxSectorAngle) \x3c EPSILON ? u_othersColor :\ngetSectorColor(index \x3e 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d u_sectorThreshold !\x3d 0.0 \x26\x26 abs(endSectorAngle - maxSectorAngle) \x3c EPSILON ? u_othersColor :\ngetSectorColor(index \x3c numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index \x3d\x3d numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor \x3d getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle \x3d maxSectorAngle;\nendSectorAngle \x3d 360.0;\n}\nlowp vec4 outlineColor \x3d u_outlineColor;\nfloat offset \x3d length(v_offset);\nfloat distanceSize \x3d offset * v_size;\nif (startSectorAngle !\x3d 0.0 || endSectorAngle !\x3d 360.0) {\nfloat distanceToStartSector \x3d (angle - startSectorAngle);\nfloat distanceToEndSector \x3d (endSectorAngle - angle);\nfloat sectorThreshold \x3d 0.6;\nfloat beginSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize \x3d u_donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut \x3d donutSize - v_outlineWidth;\nfloat aaThreshold \x3d 0.75;\nfloat innerCircleAlpha \x3d endOfDonut - aaThreshold \x3e 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha \x3d 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha \x3d innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline \x3d v_size - v_outlineWidth;\nif (startOfOutline \x3e 0.0 \x26\x26 v_outlineWidth \x3e 0.25) {\nfloat outlineFactor \x3d smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor \x3d donutSize - aaThreshold \x3e 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor \x3d mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d getColor();\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}",
"pie.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\nuniform float u_outlineWidth;\nuniform mediump float u_sectorThreshold;\nvarying float v_size;\nvarying vec2 v_offset;\nvarying vec2 v_filteredSectorToColorId[NUMBER_OF_FIELDS];\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};\nint filter(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[NUMBER_OF_FIELDS]) {\nif (sectorAngle \x3e u_sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle +\x3d sectorAngle;\n#if __VERSION__ \x3d\x3d 300\nfilteredSectorToColorId[filteredInfo.colorId] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n#else\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; i++) {\nif (i \x3d\x3d filteredInfo.colorId) {\nfilteredSectorToColorId[i] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n}\n}\n#endif\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[NUMBER_OF_FIELDS],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[NUMBER_OF_FIELDS]) {\nfor (int index \x3d 0; index \x3c NUMBER_OF_FIELDS; ++index) {\nfloat sectorValue \x3d sectorAngles[index];\nfilter(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\nvec2 outSize \x3d baseSize;\n#ifdef VV_SIZE\nfloat r \x3d 0.5 * getSize(referenceSize) / referenceSize;\noutSize.xy *\x3d r;\noffset.xy *\x3d r;\nfloat scaleSymbolProportionally \x3d getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       \x3d vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value !\x3d NAN_MAGIC_NUMBER \x26\x26 value \x3e 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec2  a_offset \x3d a_vertexOffset / 16.0;\nfloat outlineSize \x3d u_outlineWidth;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec2 size \x3d getMarkerSize(a_offset, a_size, outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0, a_bitSet);\nfloat filterFlags \x3d getFilterFlags();\nvec3  pos         \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nv_opacity      \x3d getOpacity();\nv_id           \x3d norm(a_id);\nv_pos          \x3d u_dvsMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       \x3d sign(a_texCoords - 0.5);\nv_size         \x3d max(size.x, size.y);\nv_outlineWidth \x3d outlineSize;\nfloat attributeData[10];\nvec4 attributeData0 \x3d getAttributeData3(a_id);\nattributeData[0] \x3d filterNaNValues(attributeData0.x);\nattributeData[1] \x3d filterNaNValues(attributeData0.y);\nattributeData[2] \x3d filterNaNValues(attributeData0.z);\nattributeData[3] \x3d filterNaNValues(attributeData0.w);\n#if (NUMBER_OF_FIELDS \x3e 4)\nvec4 attributeData1 \x3d getAttributeData4(a_id);\nattributeData[4] \x3d filterNaNValues(attributeData1.x);\nattributeData[5] \x3d filterNaNValues(attributeData1.y);\nattributeData[6] \x3d filterNaNValues(attributeData1.z);\nattributeData[7] \x3d filterNaNValues(attributeData1.w);\n#endif\n#if (NUMBER_OF_FIELDS \x3e 8)\nvec4 attributeData2 \x3d getAttributeData5(a_id);\nattributeData[8] \x3d filterNaNValues(attributeData2.x);\nattributeData[9] \x3d filterNaNValues(attributeData2.y);\n#endif\nfloat sum \x3d 0.0;\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nsum +\x3d attributeData[i];\n}\nfloat sectorAngles[NUMBER_OF_FIELDS];\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nsectorAngles[i] \x3d 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[NUMBER_OF_FIELDS];\nFilteredChartInfo filteredInfo \x3d FilteredChartInfo(0.0, 0);\nint numOfEntries \x3d filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries \x3d float(numOfEntries);\nv_maxSectorAngle \x3d filteredInfo.endSectorAngle;\n#if __VERSION__ \x3d\x3d 300\nv_filteredSectorToColorId \x3d filteredSectorToColorId;\n#else\nfor (int i \x3d 0; i \x3c NUMBER_OF_FIELDS; ++i) {\nif (i \x3d\x3d numOfEntries) {\nbreak;\n}\nv_filteredSectorToColorId[i] \x3d filteredSectorToColorId[i];\n}\n#endif\n#ifdef HITTEST\nhighp vec3 out_pos \x3d vec3(0.0);\nv_color            \x3d vec4(0.0);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  pos, v_size);\ngl_PointSize \x3d 1.0;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};",
"line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth \x3d line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX \x3d fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY \x3d 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth \x3d line.lineHalfWidth;\nmediump float adjustedPatternHeight \x3d line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY \x3d fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX \x3d 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist \x3d length(line.normal) * line.lineHalfWidth;\nlowp float alpha \x3d clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color \x3d getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a \x3d step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a \x3c 1.0 / 255.0) {\ndiscard;\n}\nout_color \x3d vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}",
"line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth \x3d 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth \x3d max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat baseWidth \x3d getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nfloat z         \x3d 2.0 * step(baseWidth, 0.0);\nvec2  dist      \x3d getDist(in_offset, halfWidth);\nvec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       \x3d u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     \x3d in_color;\nfloat opacity   \x3d 1.0;\n#else\nvec4  color     \x3d getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   \x3d getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH \x3d 15.5;\nfloat scaleDash \x3d getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio \x3d (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nv_sampleAlphaOnly \x3d getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos \x3d vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},
"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;",
"hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF \x3d (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /\x3d 2.0;\n#endif\nlowp float aa \x3d v_antialiasingWidth;\nlowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\n#include \x3cmaterials/text/hittest.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r \x3d getSize(referenceSize) / referenceSize;\nbaseSize *\x3d r;\noffset.xy *\x3d r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  \x3d a_aux.y;\nfloat a_referenceSize \x3d a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        \x3d a_aux.w;\nfloat a_fontSize      \x3d a_texFontSize.z;\nvec2  a_offset        \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      \x3d getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     \x3d fontSize / SDF_FONT_SIZE;\nvec3  offset        \x3d getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  \x3d (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   \x3d u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\nv_tex     \x3d a_texCoords / u_mosaicSize;\nv_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\nv_edgeDistanceOffset \x3d u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position \x3d  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset \x3d pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\nreturn getBit(bitset, 0);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate \x3d getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r \x3d mod(rshift(u32, 0), 255.0);\nfloat g \x3d mod(rshift(u32, 8), 255.0);\nfloat b \x3d mod(rshift(u32, 16), 255.0);\nfloat a \x3d mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /\x3d 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a \x3d 12.9898;\nhighp float b \x3d 78.233;\nhighp float c \x3d 43758.5453;\nhighp float dt \x3d dot(co, vec2(a,b));\nhighp float sn \x3d mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp mat3 u_tileMat3;\nuniform highp mat3 u_viewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nuniform mediump float u_currentZoom;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef SUPPORTS_TEXTURE_FLOAT\ntarget.rgba \x3d getAttributeData2(a_id);\n#else\nvec4 data0 \x3d getAttributeData2(a_id);\nvec4 data1 \x3d getAttributeData3(a_id);\ntarget.r \x3d u88VVToFloat(data0.rg * 255.0);\ntarget.g \x3d u88VVToFloat(data0.ba * 255.0);\ntarget.b \x3d u88VVToFloat(data1.rg * 255.0);\ntarget.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   \x3d getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getAttributeData0(a_id).x * 255.0);\n#else\nreturn getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAttributeData1(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 \x3d getAttributeData0(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * u_viewMat3 * u_tileMat3 + (1.0 - isMapAligned) * u_tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef INSIDE\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(OUTSIDE)\npos.z +\x3d 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(HIGHLIGHT)\n#if !defined(HIGHLIGHT_ALL)\npos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n#endif\npos.z +\x3d 2.0 * (step(minMaxZoom.y, u_currentZoom) + (1.0 - step(minMaxZoom.x, u_currentZoom)));\nreturn pos;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\nreturn (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\ninterpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\nreturn u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\nreturn u_vvSizeFieldStopsSizes[0];\n}\nfor (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\nif (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\nfloat f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\nreturn mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n}\n}\nreturn u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\nreturn u_vvOpacities[0];\n}\nfor (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\nif (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\nfloat f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\nreturn mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n}\n}\nreturn u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (u_vvRotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (u_vvRotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * -rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\nreturn fallback;\n}\nif (colorValue \x3c\x3d u_vvColorValues[0]) {\nreturn u_vvColors[0];\n}\nfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\nif (u_vvColorValues[i] \x3e\x3d colorValue) {\nfloat f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\nreturn mix(u_vvColors[i-1], u_vvColors[i], f);\n}\n}\nreturn u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nreturn u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize \x3d getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},
overlay:{overlay:{"overlay.frag":"precision lowp float;\nuniform lowp sampler2D u_texture;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_texture, v_uv);\ngl_FragColor \x3d color *  u_opacity;\n}","overlay.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_perspective;\nvarying mediump vec2 v_uv;\nvoid main(void) {\nv_uv \x3d a_uv;\nfloat w \x3d 1.0 + dot(a_uv, u_perspective);\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0);\ngl_Position \x3d vec4(w * pos.xy, 0.0, w);\n}"}},
"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor \x3d texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor \x3d 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color \x3d u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor \x3d clamp(color, 0.0, 1.0);\n}"},
gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d float(SIGMA);\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel \x3d texture2D(u_texture, v_uv);\nvec3 luma \x3d vec3(0.299, 0.587, 0.114);\nfloat v \x3d dot(texel.xyz, luma);\nvec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor \x3d mix(outputColor, texel, alpha);\n}"}},
blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d u_sigma;\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist \x3d 1.0;\nconst float sampleStrength \x3d 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] \x3d -0.08;\nsamples[1] \x3d -0.05;\nsamples[2] \x3d -0.03;\nsamples[3] \x3d -0.02;\nsamples[4] \x3d -0.01;\nsamples[5] \x3d  0.01;\nsamples[6] \x3d  0.02;\nsamples[7] \x3d  0.03;\nsamples[8] \x3d  0.05;\nsamples[9] \x3d  0.08;\nvec2 dir \x3d 0.5 - v_uv;\nfloat dist \x3d sqrt(dir.x * dir.x + dir.y * dir.y);\ndir \x3d dir / dist;\nvec4 color \x3d texture2D(u_colorTexture,v_uv);\nvec4 sum \x3d color;\nfor (int i \x3d 0; i \x3c 10; i++) {\nsum +\x3d texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *\x3d 1.0 / 11.0;\nfloat t \x3d dist * sampleStrength;\nt \x3d clamp(t, 0.0, 1.0);\ngl_FragColor \x3d mix(color, sum, t);\n}"}},
dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor \x3d texture2D(u_minColor, vec2(0.5));\nvec4 maxColor \x3d texture2D(u_maxColor, vec2(0.5));\nvec4 color \x3d texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply \x3d minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply \x3d maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply \x3d color.rgb / color.a;\nvec3 range \x3d maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor \x3d vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}",
"min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel \x3d floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel \x3d vec2(1.0) / u_srcResolution;\nvec2 uv \x3d (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor \x3d vec4(1.0);\nvec4 maxColor \x3d vec4(0.0);\nfor (int y \x3d 0; y \x3c CELL_SIZE; ++y) {\nfor (int x \x3d 0; x \x3c CELL_SIZE; ++x) {\nvec2 offset \x3d uv + vec2(x, y) * onePixel;\nminColor \x3d min(minColor, texture2D(u_minTexture, offset));\nmaxColor \x3d max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] \x3d minColor;\ngl_FragData[1] \x3d maxColor;\n}"}},
"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset \x3d u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor \x3d texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor \x3d texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor \x3d ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},
"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 \x3d mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 \x3d mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 \x3d mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 \x3d mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 \x3d mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 \x3d mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 \x3d mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 \x3d mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 \x3d mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] \x3d g0,\nG[1] \x3d g1,\nG[2] \x3d g2,\nG[3] \x3d g3,\nG[4] \x3d g4,\nG[5] \x3d g5,\nG[6] \x3d g6,\nG[7] \x3d g7,\nG[8] \x3d g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 9; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nfloat M \x3d (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S \x3d (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor \x3d vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},
sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\ngl_FragColor \x3d vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},
"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\ngl_FragColor \x3d vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},
filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\nvec4 rgbw \x3d u_coefficients * vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a \x3d color.a;\ngl_FragColor \x3d vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"}},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor \x3d vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\n#ifdef BILINEAR\n#include \x3cfiltering/bilinear.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation \x3d projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color \x3d sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}",
"common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos * u_scale + u_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0;\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a);\n}\nreturn vec4(v.r / 255.0, v.g / 255.0, v.b / 255.0, currentPixel.a);\n}",
"getSurfaceValues.glsl":"#include \x3craster/common/mirror.glsl\x3e\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel \x3d 1.0 / srcImageSize;\nvec4 va \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve \x3d texture2D(imageTexture, mirror(texCoord));\nvec4 vf \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha \x3d va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] \x3d va.r;\nvalues[1] \x3d vb.r;\nvalues[2] \x3d vc.r;\nvalues[3] \x3d vd.r;\nvalues[4] \x3d ve.r;\nvalues[5] \x3d vf.r;\nvalues[6] \x3d vg.r;\nvalues[7] \x3d vh.r;\nvalues[8] \x3d vi.r;\nvalues[9] \x3d alpha;\n}",
"inverse.glsl":"float invertValue(float value) {\nfloat s \x3d sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 \x3d abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv \x3d texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},
flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff \x3d mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart \x3d clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist \x3e featheringStart) {\ncolor *\x3d 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",
imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled \x3d texture2D(u_texture, v_texcoord);\nfloat intensity \x3d getIntensity(sampled.r);\ngl_FragColor \x3d getColor(intensity);\ngl_FragColor.a *\x3d getOpacity(sampled.r);\ngl_FragColor.a *\x3d sampled.a;\ngl_FragColor.rgb *\x3d gl_FragColor.a;\n}",
"imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy \x3d (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\nvoid main(void) {\ngl_FragColor \x3d getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}",
"particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/vv.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nvec2 position0 \x3d a_xyts0.xy;\nfloat t0 \x3d a_xyts0.z;\nfloat speed0 \x3d a_xyts0.w;\nvec2 position1 \x3d a_xyts1.xy;\nfloat t1 \x3d a_xyts1.z;\nfloat speed1 \x3d a_xyts1.w;\nfloat type \x3d a_typeIdDurationSeed.x;\nfloat id \x3d a_typeIdDurationSeed.y;\nfloat duration \x3d a_typeIdDurationSeed.z;\nfloat seed \x3d a_typeIdDurationSeed.w;\nvec2 e0 \x3d a_extrudeInfo.xy;\nvec2 e1 \x3d a_extrudeInfo.zw;\nfloat animationPeriod \x3d duration + u_trailLength;\nfloat scaledTime \x3d u_time * u_flowSpeed;\nfloat randomizedTime \x3d scaledTime + seed * animationPeriod;\nfloat t \x3d mod(randomizedTime, animationPeriod);\nfloat fUnclamped \x3d (t - t0) / (t1 - t0);\nfloat f \x3d clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime \x3d mix(t0, t1, f);\nfloat speed \x3d mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type \x3d\x3d 2.0) {\nif (fUnclamped \x3c 0.0 || (fUnclamped \x3e 1.0 \x26\x26 t1 !\x3d duration)) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho \x3d mix(e0, e1, f);\nvec2 parallel;\nparallel \x3d normalize(position1 - position0) * 0.5;\nif (id \x3d\x3d 1.0) {\nextrude \x3d ortho;\nv_texcoord \x3d vec2(0.5, 0.0);\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -ortho;\nv_texcoord \x3d vec2(0.5, 1.0);\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d ortho + parallel;\nv_texcoord \x3d vec2(1.0, 0.0);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -ortho + parallel;\nv_texcoord \x3d vec2(1.0, 1.0);\n}\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else {\nif (fUnclamped \x3c 0.0) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id \x3d\x3d 1.0) {\nextrude \x3d e0;\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -e0;\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n}\n}\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_color.a *\x3d fadeOpacity;\nv_color.a *\x3d mix(1.0, introOpacity, u_introFade);\nv_color.rgb *\x3d v_color.a;\n}"},
streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nfloat t \x3d mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color \x3d v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *\x3d mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor \x3d getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}",
"streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nvoid main(void) {\nvec4 lineColor \x3d getColor(a_speed);\nfloat lineOpacity \x3d getOpacity(a_speed);\nfloat lineSize \x3d getSize(a_speed);\nvec2 position \x3d a_positionAndSide.xy;\nv_side \x3d a_positionAndSide.z;\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_time \x3d a_timeInfo.x;\nv_totalTime \x3d a_timeInfo.y;\nv_timeSeed \x3d a_timeInfo.z;\nv_color \x3d lineColor;\nv_color.a *\x3d lineOpacity;\nv_color.rgb *\x3d v_color.a;\nv_size \x3d lineSize;\n}"},
"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color \x3d u_color_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_color_count) {\nbreak;\n}\nfloat x1 \x3d u_color_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_color_stops[i];\nvec4 y2 \x3d u_color_values[i];\nif (x \x3c x2) {\nvec4 y1 \x3d u_color_values[i - 1];\ncolor \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor \x3d y2;\n}\n}\n}\n#else\nvec4 color \x3d u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity \x3d u_opacity_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_opacity_count) {\nbreak;\n}\nfloat x1 \x3d u_opacity_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_opacity_stops[i];\nfloat y2 \x3d u_opacity_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_opacity_values[i - 1];\nopacity \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity \x3d y2;\n}\n}\n}\n#else\nfloat opacity \x3d u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size \x3d u_size_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_size_count) {\nbreak;\n}\nfloat x1 \x3d u_size_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_size_stops[i];\nfloat y2 \x3d u_size_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_size_values[i - 1];\nsize \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize \x3d y2;\n}\n}\n}\n#else\nfloat size \x3d u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include \x3craster/lut/colorize.glsl\x3e\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv), 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy \x3d (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z \x3d (u_cosZs[0] + cosDelta) / dzd;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n} else {\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / dzd;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\ngl_FragColor \x3d overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex \x3d clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color \x3d texture2D(u_colormap, clrPosition);\nvec4 result \x3d vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nvec4 result \x3d colorize(currentPixel, 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},
magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor \x3d v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle \x3d a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle \x3d 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset \x3d vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos \x3d a_pos + offset * sizePercentage * u_symbolSize;\nv_color \x3d u_colors[int(a_vv.x)];\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_position;\ngl_Position \x3d vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},
rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nconst float pi \x3d 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *\x3d sign(abs(dzx) + abs(dzy));\nfloat aspect_rad \x3d (dzx \x3d\x3d 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},
bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index;\n#ifdef NDXI\nindex \x3d (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex \x3d nir * invertValue(red);\n#elif defined(CI)\nindex \x3d nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex \x3d (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s \x3d u_adjustments[0];\nfloat a \x3d u_adjustments[1];\nfloat x \x3d u_adjustments[2];\nfloat y \x3d -a * s + x * (1.0 + s * s);\nindex \x3d (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MAVI)\nindex \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex \x3d eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a \x3d u_adjustments[0];\nfloat b \x3d u_adjustments[1];\nfloat y \x3d sqrt(1.0 + a * a);\nindex \x3d (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex \x3d (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI2)\nfloat green \x3d pv2.b;\nfloat v \x3d pow(sqrt((2.0 * nir + 1.0), 2.0) - 6.0 * nir - 5.0 * sqrt(red) - 0.5);\nindex \x3d 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * v;\n#elif defined(RTVICORE)\nfloat green \x3d pv2.b;\nindex \x3d 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue \x3d pv2.b;\nfloat denom \x3d nir + 6.0 * red - 7.5 * blue + 1.0;\nindex \x3d  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g \x3d pv2.r;\nfloat n \x3d pv2.g;\nfloat s \x3d pv2.s;\nfloat a \x3d u_adjustments[0];\nfloat denom \x3d g + a * n + (1.0 - a) * s;\nindex \x3d (g - a * n - (1 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex \x3d invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor \x3d pv;\nreturn;\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 p0 \x3d texture2D(u_image, v_texcoord);\nvec4 p1 \x3d texture2D(u_image1, v_texcoord);\nvec4 p2 \x3d texture2D(u_image2, v_texcoord);\ngl_FragColor \x3d vec4(p0.r, p1.r, p2.r, p0.a * p1.a * p2.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include \x3craster/common/mirror.glsl\x3e\nvoid main() {\nvec3 rgb \x3d vec3(0.0, 0.0, 0.0);\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha \x3d 1.0;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\nrgb +\x3d pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *\x3d pv.a;\n}\n}\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat d \x3d ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e \x3d ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature \x3d 0.0;\n#ifdef STANDARD\ncurvature \x3d -u_zlFactor * (d + e);\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f \x3d (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g \x3d (-pv[3] + pv[5]) / 2.0;\nfloat h \x3d (pv[1] - pv[7]) / 2.0;\nfloat g2 \x3d g * g;\nfloat h2 \x3d h * h;\n#ifdef PROFILE\ncurvature \x3d (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature \x3d (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n}"},
extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\ngl_FragColor \x3d vec4(pv2, pv.a);\n}"},local:{"local.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\n#endif\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef PLUS\nresult \x3d a + b;\n#elif defined(MINUS)\nresult \x3d a - b;\n#elif defined(TIMES)\nresult \x3d a * b;\n#elif defined(DIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult \x3d floor(a * invertValue(b));\nalpha *\x3d float(abs(sign(b)));\n#elif defined(SQUARE)\nresult \x3d a * a;\n#elif defined(SQRT)\nresult \x3d sqrt(a);\n#elif defined(POWER)\nresult \x3d pow(a, b);\n#elif defined(LN)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_1_0)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_2)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(EXP)\nresult \x3d exp(a);\n#elif defined(EXP_1_0)\nresult \x3d pow(10.0, a);\n#elif defined(EXP_2)\nresult \x3d pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult \x3d floor(a);\n#elif defined(ROUNDUP)\nresult \x3d ceil(a);\n#elif defined(INT)\nresult \x3d float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult \x3d mod(a, b);\n#elif defined(NEGATE)\nresult \x3d -a;\n#elif defined(ABS)\nresult \x3d abs(a);\n#elif defined(ACOS)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: acos(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult \x3d acosh(a);\n#elif defined(POLYFILLACOSH)\nresult \x3d log(a + sqrt(a * a - 1.0));\n#elif defined(ASIN)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: asin(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult \x3d asinh(a);\n#elif defined(POLYFILLASINH)\nresult \x3d log(a + sqrt(a * a + 1.0));\n#elif defined(ATAN)\nresult \x3d atan(a);\n#elif defined(ATANH)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: atanh(a);\nalpha *\x3d step(abs(a), 1.0);\n#elif defined(POLYFILLATANH)\nresult \x3d a \x3d\x3d 1.0 ? 0.0 : 0.5 * log((1.0 + a)/(1.0 -a));\n#elif defined(ATAN_2)\nresult \x3d atan(a, b);\n#elif defined(COS)\nresult \x3d cos(a);\n#elif defined(COSH)\nresult \x3d cosh(a);\n#elif defined(POLYFILLCOSH)\nfloat halfexp \x3d exp(a) / 2.0;\nresult \x3d halfexp + 1.0 / halfexp;\n#elif defined(SIN)\nresult \x3d sin(a);\n#elif defined(SINH)\nresult \x3d sinh(a);\n#elif defined(POLYFILLSINH)\nfloat halfexp \x3d exp(a) / 2.0;\nresult \x3d halfexp - 1.0 / halfexp;\n#elif defined(TAN)\nresult \x3d tan(a);\n#elif defined(TANH)\nresult \x3d tanh(a);\n#elif defined(POLYFILLTANH)\nfloat expx \x3d exp(a);\nresult \x3d (expx - 1.0 / expx) / (expx + 1.0 / expx);\n#elif defined(BITWISEAND)\nresult \x3d a \x26 b;\n#elif defined(BITWISEOR)\nresult \x3d a | b;\n#elif defined(BITWISELEFTSHIFT)\nresult \x3d a \x3c\x3c b;\n#elif defined(BITWISERIGHTSHIFT)\nresult \x3d a \x3e\x3e b;\n#elif defined(BITWISENOT)\nresult \x3d ~a;\n#elif defined(BITWISEXOR)\nresult \x3d a ^ b;\n#elif defined(BOOLEANAND)\nresult \x3d float((a !\x3d 0.0) \x26\x26 (b !\x3d 0.0));\n#elif defined(BOOLEANNOT)\nresult \x3d float(a \x3d\x3d 0.0);\n#elif defined(BOOLEANOR)\nresult \x3d float((a !\x3d 0.0) || (b !\x3d 0.0));\n#elif defined(BOOLEANXOR)\nresult \x3d float((a !\x3d 0.0) ^^ (b !\x3d 0.0));\n#elif defined(GREATERTHAN)\nresult \x3d float(a \x3e b);\n#elif defined(GREATERTHANEQUAL)\nresult \x3d float(a \x3e\x3d b);\n#elif defined(LESSTHAN)\nresult \x3d float(a \x3c b);\n#elif defined(LESSTHANEQUAL)\nresult \x3d float(a \x3c\x3d b);\n#elif defined(EQUALTO)\nresult \x3d float(a \x3d\x3d b);\n#elif defined(NOTEQUAL)\nresult \x3d float(a !\x3d b);\n#elif defined(ISNULL)\nresult \x3d float(alpha \x3d\x3d 0.0);\nalpha \x3d 1.0;\n#elif defined(SETNULL)\nfloat maskValue \x3d float(a \x3d\x3d 0.0);\nresult \x3d maskValue * b;\nalpha *\x3d maskValue;\n#elif defined(CONDITIONAL)\nfloat weight \x3d float(abs(sign(a)));\nresult \x3d weight * b + (1.0 - weight) * c;\n#endif\nbool isInvalid \x3d result \x3c u_domainRange.s || result \x3e u_domainRange.t;\nresult \x3d isInvalid ? 0.0 : result;\nalpha *\x3d float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor \x3d 1.0;\nfor (int i \x3d 0; i \x3c LEN_NODATA_VALUES; i++) {\nfactor *\x3d float(u_noDataValues[i] !\x3d bandValue);\n}\nfactor *\x3d step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat redFactor \x3d maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor \x3d maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor \x3d maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor \x3d redFactor * greenFactor * blueFactor;\ngl_FragColor \x3d pv * maskFactor;\n#else\ngl_FragColor \x3d pv * redFactor;\n#endif\n}"},
ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index \x3d (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex \x3d floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat factor \x3d 1.0;\nfloat bandValue \x3d pv.r;\nfor (int i \x3d 0; i \x3c LEN_NODATA_RANGES; i+\x3d2) {\nfloat inside \x3d 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *\x3d inside;\n}\nfloat mapValue \x3d 0.0;\nfloat includeMask \x3d 0.0;\nfor (int i \x3d 0; i \x3c LEN_REMAP_RANGES; i+\x3d3) {\nfloat stepMask \x3d step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask \x3d (1.0 - stepMask) * includeMask + stepMask;\nmapValue \x3d (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue \x3d factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask \x3d factor * max(u_unmatchMask, includeMask);\nbandValue \x3d clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},
slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat xf \x3d (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf \x3d (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run \x3d sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat percentRise \x3d rise2run * 100.0;\ngl_FragColor \x3d vec4(percentRise, percentRise, percentRise, alpha);\n#else\nfloat degree \x3d atan(rise2run) * 57.2957795;\ngl_FragColor \x3d vec4(degree, degree, degree, alpha);\n#endif\n}"},
stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval \x3d clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -\x3d step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal \x3d tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal \x3d clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor \x3d vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},
vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor \x3d vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize \x3d 0.02;\nconst float innerRadius \x3d 0.25;\nconst float outerRadius \x3d 0.42;\nconst float innerSquareLength \x3d 0.15;\nvoid main() {\nmediump float dist \x3d length(v_pos);\nmediump float fillalpha1 \x3d smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *\x3d (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 \x3d smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *\x3d (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 \x3d (abs(v_pos.x) \x3c innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) \x3c innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor \x3d (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}",
"scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size \x3d u_symbolSize * sizePercentage;\nvec2 pos \x3d a_pos + a_offset * size;\nv_pos \x3d a_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val \x3e\x3d maxCutOff) {\nreturn maxOutput;\n} else if (val \x3c\x3d minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n}\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount \x3d\x3d 1) {\nfloat grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result \x3d colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},
stencil:{"stencil.frag":"void main() {\ngl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position \x3d vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\nv_tex \x3d a_pos;\n}"},
util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 \x3d abs(x);\nt1 \x3d abs(y);\nt0 \x3d max(t3, t1);\nt1 \x3d min(t3, t1);\nt3 \x3d 1.0 / t0;\nt3 \x3d t1 * t3;\nt4 \x3d t3 * t3;\nt0 \x3d         - 0.013480470;\nt0 \x3d t0 * t4 + 0.057477314;\nt0 \x3d t0 * t4 - 0.121239071;\nt0 \x3d t0 * t4 + 0.195635925;\nt0 \x3d t0 * t4 - 0.332994597;\nt0 \x3d t0 * t4 + 0.999995630;\nt3 \x3d t0 * t3;\nt3 \x3d (abs(y) \x3e abs(x)) ? 1.570796327 - t3 : t3;\nt3 \x3d x \x3c 0.0 ?  3.141592654 - t3 : t3;\nt3 \x3d y \x3c 0.0 ? -t3 : t3;\nreturn t3;\n}",
"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/BrushOverlay":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../definitions","../Utils","./WGLBrush","../../../../webgl/enums"],function(n,l,F,D,A){return function(u){function m(){var f=
u.apply(this,arguments)||this;f._desc={vsPath:"overlay/overlay",fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])};return f}n._inherits(m,u);var h=m.prototype;h.dispose=function(){};h.prepareState=function({context:f}){f.setBlendingEnabled(!0);f.setColorMask(!0,!0,!0,!0);f.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA,A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setStencilWriteMask(0);f.setStencilTestEnabled(!0);f.setStencilFunction(A.CompareFunction.GREATER,
255,255)};h.draw=function(f,d){const {context:c,painter:a,requestRender:b,allowDelayedRender:g}=f;if(d.isReady){var {computedOpacity:e,dvsMat3:k,isWrapAround:p,perspectiveTransform:q,texture:t}=d;f.timeline.begin(this.name);var v=a.materialManager.getProgram(this._desc);if(g&&null!=b&&!v.compiled)b();else{var y=F.createProgramDescriptor("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:A.DataType.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:A.DataType.UNSIGNED_SHORT}]});if(d=d.getVAO(c,
y.bufferLayouts,y.attributes))c.bindVAO(d),c.useProgram(v),c.bindTexture(t,l.TEXTURE_BINDING_BITMAP),v.setUniformMatrix3fv("u_dvsMat3",k),v.setUniform1i("u_texture",l.TEXTURE_BINDING_BITMAP),v.setUniform1f("u_opacity",e),v.setUniform2fv("u_perspective",q),c.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,p?10:4),c.bindVAO(),f.timeline.end(this.name)}}};return n._createClass(m)}(D)})},"esri/views/2d/engine/webgl/brushes/WGLBrushDotDensity":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/RandomLCG ../definitions ../enums ./WGLGeometryBrushFill ../techniques/utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/FramebufferObject ../../../../webgl/Renderbuffer ../../../../webgl/RenderbufferDescriptor ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e){return function(k){function p(){var t=k.apply(this,arguments)||this;t._dotTextureSize=0;t._dotTextures=null;t._dotSamplers=new Int32Array([D.TEXTURE_BINDING_RENDERER_0,D.TEXTURE_BINDING_RENDERER_1]);t._dotVAO=null;t._dotDesc={vsPath:"dot/dot",fsPath:"dot/dot",attributes:new Map([["a_pos",0]])};return t}n._inherits(p,k);var q=p.prototype;q.dispose=function(){n._get(n._getPrototypeOf(p.prototype),"dispose",this).call(this);this._disposeTextures();this._dotFBO=
l.disposeMaybe(this._dotFBO);this._dotVAO=l.disposeMaybe(this._dotVAO)};q.getGeometryType=function(){return A.WGLGeometryType.FILL};q.supportsSymbology=function(t){return t===A.WGLSymbologyType.DOT_DENSITY};q._drawFills=function(t,v,y,w,z,r){const {passOptions:C}=t;null!=C&&"hittest"===C.type?n._get(n._getPrototypeOf(p.prototype),"_drawFills",this).call(this,t,v,y,w,z,r):(y=this._drawDotLocations(t,v,y,z,r),this._drawDotDensity(t,v,y))};q._drawDotDensity=function(t,v,y){const {context:w,painter:z,
rendererInfo:r,requestRender:C,allowDelayedRender:x}=t,E=z.materialManager.getProgram(this._dotDesc);if(x&&null!=C&&!E.compiled)C();else{var {rendererSchema:B}=r;m.assertRendererSchema(B,"dot-density");var G=this._createDotDensityMesh(w,this._dotDesc.attributes,{geometry:[{name:"a_pos",count:2,type:f.DataType.SHORT,divisor:0,normalized:!1,offset:0,stride:4}]});w.setStencilTestEnabled(!0);w.useProgram(E);E.setUniform1f("u_tileZoomFactor",1);E.setUniform1i("u_texture",this._dotSamplers[0]);E.setUniform1f("u_dotSize",
Math.max(B.dotSize,1));E.setUniform1f("u_pixelRatio",window.devicePixelRatio);this._setSharedUniforms(E,t,v);w.bindTexture(y,this._dotSamplers[0]);w.bindVAO(G);w.drawArrays(f.PrimitiveType.POINTS,0,262144)}};q._drawDotLocations=function(t,v,y,w,z){const {context:r,rendererInfo:C,requiredLevel:x}=t,E=r.getViewport();var {rendererSchema:B}=C;m.assertRendererSchema(B,"dot-density");const {dotScale:G,colors:H,activeDots:I,backgroundColor:J,dotValue:L}=B;r.setViewport(0,0,512,512);B=r.getBoundFramebufferObject();
const K=this._createFBO(r);r.bindFramebuffer(K);r.setClearColor(0,0,0,0);r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.STENCIL_BUFFER_BIT);r.setStencilTestEnabled(!1);v=1/2**(x-v.key.level);const S=D.TILE_SIZE,W=S*window.devicePixelRatio*S*window.devicePixelRatio,X=1/v*(1/v);t=G?t.state.scale/G:1;y.setUniform1f("u_tileZoomFactor",v);y.setUniform1f("u_tileDotsOverArea",W/(D.TILE_SIZE*window.devicePixelRatio*D.TILE_SIZE*window.devicePixelRatio));y.setUniformMatrix4fv("u_dotColors",H);y.setUniform4fv("u_isActive",
I);y.setUniform4fv("u_dotBackgroundColor",J);y.setUniform1f("u_dotValue",Math.max(1,L*t*X));this._bindDotDensityTextures(r,y,C,S);r.drawElements(f.PrimitiveType.TRIANGLES,w,f.DataType.UNSIGNED_INT,z);r.setViewport(E.x,E.y,E.width,E.height);r.bindFramebuffer(B);return K.colorTexture};q._createFBO=function(t){if(null==this._dotFBO){const v=new g.TextureDescriptor(512,512);v.samplingMode=f.TextureSamplingMode.NEAREST;v.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;const y=new c.Renderbuffer(t,new a.RenderbufferDescriptor(f.RenderbufferFormat.DEPTH_STENCIL,
512,512));this._dotFBO=new d.FramebufferObject(t,v,y)}return this._dotFBO};q._disposeTextures=function(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}};q._bindDotDensityTextures=function(t,v,y,w){({rendererSchema:y}=y);m.assertRendererSchema(y,"dot-density");w=this._createDotDensityTextures(t,w,y.seed);v.setUniform1iv("u_dotTextures",this._dotSamplers);for(v=0;v<w.length;v++)t.bindTexture(w[v],this._dotSamplers[v])};q._createDotDensityMesh=
function(t,v,y){if(null==this._dotVAO){var w=new Int16Array(524288);for(let z=0;512>z;z++)for(let r=0;512>r;r++)w[2*(r+512*z)]=r,w[2*(r+512*z)+1]=z;w=h.BufferObject.createVertex(t,f.Usage.STATIC_DRAW,w);this._dotVAO=new e.VertexArrayObject(t,v,y,{geometry:w},null)}return this._dotVAO};q._createDotDensityTextures=function(t,v,y){if(this._dotTextureSize!==v||this._seed!==y)this._disposeTextures(),this._dotTextureSize=v,this._seed=y;null===this._dotTextures&&(y=new F(y),this._dotTextures=[this._allocDotDensityTexture(t,
v,y),this._allocDotDensityTexture(t,v,y)]);return this._dotTextures};q._allocDotDensityTexture=function(t,v,y){const w=new Float32Array(v*v*4);for(let z=0;z<w.length;z++)w[z]=y.getFloat();y=new g.TextureDescriptor;y.dataType=f.PixelType.FLOAT;y.samplingMode=f.TextureSamplingMode.NEAREST;y.width=v;y.height=v;return new b.Texture(t,y,w)};return n._createClass(p)}(u)})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../techniques/utils ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h){return function(f){function d(){return f.apply(this,arguments)||this}n._inherits(d,f);var c=d.prototype;c.dispose=function(){};c.getGeometryType=function(){return F.WGLGeometryType.FILL};c.supportsSymbology=function(a){return a!==F.WGLSymbologyType.DOT_DENSITY};c.drawGeometry=function(a,b,g,e){const {context:k,painter:p,rendererInfo:q,requiredLevel:t,passOptions:v,requestRender:y,allowDelayedRender:w}=a;var z=u.FillMaterialKey.load(g.materialKey),r=m.getTechniqueFromMaterialKey(z.data);
const C=null!=v&&"hittest"===v.type;var x=p.materialManager;if(null==(r=r.programSpec)){r={geometry:[{location:0,name:"a_pos",count:2,type:h.DataType.SHORT},{location:1,name:"a_id",count:3,type:h.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:h.DataType.UNSIGNED_BYTE},{location:3,name:"a_color",count:4,type:h.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_aux1",count:4,type:h.DataType.UNSIGNED_SHORT},{location:5,name:"a_aux2",count:4,type:h.DataType.SHORT},{location:6,
name:"a_aux3",count:4,type:h.DataType.UNSIGNED_BYTE},{location:7,name:"a_zoomRange",count:2,type:h.DataType.UNSIGNED_SHORT}]};switch(z.symbologyType){case F.WGLSymbologyType.SIMPLE:case F.WGLSymbologyType.OUTLINE_FILL_SIMPLE:r.geometry.splice(7,1),r.geometry.splice(4,1)}r={shader:"materials/fill",vertexLayout:r}}const {shader:E,vertexLayout:B,hittestAttributes:G}=r;r=h.PrimitiveType.TRIANGLES;var H=D.createProgramDescriptor(z.data,B);C&&(H=this._getTriangleDesc(g.materialKey,H,G),r=h.PrimitiveType.POINTS);
const {attributes:I,bufferLayouts:J}=H;e=x.getMaterialProgram(a,z,E,I,e);if(w&&null!=y&&!e.compiled)y();else{k.useProgram(e);this._setSharedUniforms(e,a,b);var {row:L,col:K}=b.key;x=K*l.TILE_SIZE;H=L*l.TILE_SIZE;e.setUniform2f("u_tileOffset",x%l.MAX_REPRESENTABLE_INT,H%l.MAX_REPRESENTABLE_INT);e.setUniform2f("u_maxIntNumOfCrossing",Math.floor(x/l.MAX_REPRESENTABLE_INT),Math.floor(H/l.MAX_REPRESENTABLE_INT));z.textureBinding&&(p.textureManager.bindTextures(k,e,z),e.setUniform1f("u_zoomFactor",1/2**
(t-b.key.level)));x=1/a.pixelRatio;e.setUniform1f("u_blur",x);e.setUniform1f("u_antialiasing",x);this._setSizeVVUniforms(z,e,q,b);this._setColorAndOpacityVVUniforms(z,e,q);z=g.target.getVAO(k,J,I,C);x=g.indexCount;g=g.indexFrom*Uint32Array.BYTES_PER_ELEMENT;C&&(x/=3,g/=3);k.bindVAO(z);this._drawFills(a,b,e,r,x,g)}};c._drawFills=function(a,b,g,e,k,p){a.context.drawElements(e,k,h.DataType.UNSIGNED_INT,p)};return n._createClass(d)}(A)})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../definitions","./WGLBrush","../materialKey/MaterialKey","../../../../webgl/enums"],function(n,l,F,D,A){return function(u){function m(){var f=u.apply(this,arguments)||this;f._computeDesc=new Map;return f}n._inherits(m,u);var h=m.prototype;h.prepareState=function({context:f},d){d&&d.includes("hittest")?f.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE,A.BlendFactor.ONE,A.BlendFactor.ONE):f.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA,A.BlendFactor.ONE,
A.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setBlendingEnabled(!0);f.setColorMask(!0,!0,!0,!0);f.setStencilWriteMask(0);f.setStencilTestEnabled(!0)};h.draw=function(f,d,c){var a=this.getGeometryType();d.commit(f);a=d.getGeometry(a);null!=a&&(f.timeline.begin(this.name),f.attributeView.bindTextures(f.context),f.context.setStencilFunction(A.CompareFunction.EQUAL,d.stencilRef,255),a.forEachCommand(b=>{const g=D.MaterialKeyBase.load(b.materialKey).symbologyType;this.supportsSymbology(g)&&this.drawGeometry(f,
d,b,c)}))};h._setSharedUniforms=function(f,d,c){const {displayLevel:a,pixelRatio:b,state:g,passOptions:e}=d;null!=e&&"hittest"===e.type&&(f.setUniform2fv("u_hittestPos",e.position),f.setUniform1f("u_hittestDist",e.distance));f.setUniform1f("u_pixelRatio",b);f.setUniformMatrix3fv("u_tileMat3",c.transforms.tileMat3);f.setUniformMatrix3fv("u_viewMat3",g.viewMat3);f.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);f.setUniformMatrix3fv("u_displayViewMat3",g.displayViewMat3);f.setUniform1f("u_currentZoom",
Math.round(a*l.MIN_MAX_ZOOM_PRECISION_FACTOR));f.setUniform1i("u_attributeTextureSize",d.attributeView.size);f.setUniform1i("u_attributeData0",l.TEXTURE_BINDING_ATTRIBUTE_DATA_0);f.setUniform1i("u_attributeData1",l.TEXTURE_BINDING_ATTRIBUTE_DATA_1);f.setUniform1i("u_attributeData2",l.TEXTURE_BINDING_ATTRIBUTE_DATA_2);f.setUniform1i("u_attributeData3",l.TEXTURE_BINDING_ATTRIBUTE_DATA_3);f.setUniform1i("u_attributeData4",l.TEXTURE_BINDING_ATTRIBUTE_DATA_4);f.setUniform1i("u_attributeData5",l.TEXTURE_BINDING_ATTRIBUTE_DATA_5)};
h._setSizeVVUniforms=function(f,d,c,a){f.vvSizeMinMaxValue&&d.setUniform4fv("u_vvSizeMinMaxValue",c.vvSizeMinMaxValue);f.vvSizeScaleStops&&d.setUniform1f("u_vvSizeScaleStopsValue",c.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(a=c.getSizeVVFieldStops(a.key.level),null!=a&&(d.setUniform1fv("u_vvSizeFieldStopsValues",a.values),d.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes)));f.vvSizeUnitValue&&d.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",c.vvSizeUnitValueToPixelsRatio)};h._setColorAndOpacityVVUniforms=
function(f,d,c){f.vvColor&&(d.setUniform1fv("u_vvColorValues",c.vvColorValues),d.setUniform4fv("u_vvColors",c.vvColors));f.vvOpacity&&(d.setUniform1fv("u_vvOpacityValues",c.vvOpacityValues),d.setUniform1fv("u_vvOpacities",c.vvOpacities))};h._setRotationVVUniforms=function(f,d,c){f.vvRotation&&d.setUniform1f("u_vvRotationType","geographic"===c.vvMaterialParameters.vvRotationType?0:1)};h._getTriangleDesc=function(f,d,c=["a_pos"]){const a=d.bufferLayouts.geometry;c=c.map(e=>a.findIndex(k=>k.name===e));
f=`${f}-${c.join("-")}`;var b=this._computeDesc.get(f);if(!b){b=d.strides;const e=d.strides.geometry,k=new Map(d.attributes);var g=a.map(q=>({...q}));d=Math.max(...d.attributes.values());g={geometry:g};let p=0;for(const q of c)c=a[q],g.geometry.push({count:c.count,name:c.name+"1",divisor:c.divisor,normalized:c.normalized,offset:e+c.offset,stride:e,type:c.type}),g.geometry.push({count:c.count,name:c.name+"2",divisor:c.divisor,normalized:c.normalized,offset:2*e+c.offset,stride:e,type:c.type}),k.set(c.name+
"1",d+ ++p),k.set(c.name+"2",d+ ++p);b={bufferLayouts:g,attributes:k,strides:b};this._computeDesc.set(f,b)}return b};return n._createClass(m)}(F)})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../alignmentUtils","../enums"],function(n,l,F,D,A){function u(t){return t===A.WGLSymbologyType.SIMPLE||t===A.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function m(t){return t===A.WGLSymbologyType.OUTLINE_FILL||
t===A.WGLSymbologyType.OUTLINE_FILL_SIMPLE}const h=Object.keys(A.WGLSymbologyType).filter(t=>"number"===typeof A.WGLSymbologyType[t]).reduce((t,v)=>({...t,[v]:A.WGLSymbologyType[v]}),{});let f=function(){function t(y){this._data=0;this._data=y}t.load=function(y){const w=this.shared;w.data=y;return w};var v=t.prototype;v.setBit=function(y,w){y=1<<y;this._data=w?this._data|y:this._data&~y};v.bit=function(y){return(this._data&1<<y)>>y};v.setBits=function(y,w,z){for(let r=w,C=0;r<z;r++,C++)this.setBit(r,
0!==(y&1<<C))};v.bits=function(y,w){let z=0;for(let r=y,C=0;r<w;r++,C++)z|=this.bit(r)<<C;return z};v.hasVV=function(){return!1};v.setVV=function(y,w){};v.getVariation=function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:A.WGLSymbologyType[this.symbologyType],options:h,namespace:"SYMBOLOGY_TYPE"}}};v.getVariationHash=function(){return this._data&~(7&this.textureBinding)};l._createClass(t,[{key:"data",get:function(){return this._data},set:function(y){this._data=
y??0}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(y){this.setBits(y,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(y){this.setBit(20,y)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(y){this.setBit(11,y??!1)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(y){this.setBit(12,y)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(y){this.setBits(y,0,8)}},{key:"symbologyType",get:function(){return this.bits(21,
26)},set:function(y){this.setBits(y,21,26)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case A.WGLGeometryType.FILL:return"fill";case A.WGLGeometryType.MARKER:return"marker";case A.WGLGeometryType.LINE:return"line";case A.WGLGeometryType.TEXT:return"text";case A.WGLGeometryType.LABEL:return"label";default:throw new F(`Unable to handle unknown geometryType: ${this.geometryType}`);}}}]);return t}();f.shared=new f(0);const d=t=>function(v){function y(){return v.apply(this,arguments)||
this}l._inherits(y,v);var w=y.prototype;w.hasSizeVV=function(){return this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};w.hasVV=function(){return l._get(l._getPrototypeOf(y.prototype),"hasVV",this).call(this)||this.hasSizeVV()};w.setVV=function(z,r){l._get(l._getPrototypeOf(y.prototype),"setVV",this).call(this,z,r);{var C=this.geometryType;const x=A.WGLVVFlag.SIZE_FIELD_STOPS|A.WGLVVFlag.SIZE_MINMAX_VALUE|A.WGLVVFlag.SIZE_SCALE_STOPS|A.WGLVVFlag.SIZE_UNIT_VALUE,
E=(z&(A.WGLVVTarget.FIELD_TARGETS_OUTLINE|A.WGLVVTarget.MINMAX_TARGETS_OUTLINE|A.WGLVVTarget.SCALE_TARGETS_OUTLINE|A.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;r=C===A.WGLGeometryType.LINE&&r.isOutline||C===A.WGLGeometryType.FILL&&m(r.symbologyType)?x&E:x&~E}z&=r;this.vvSizeMinMaxValue=!!(z&A.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(z&A.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(z&A.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(z&A.WGLVVFlag.SIZE_SCALE_STOPS)};l._createClass(y,
[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(z){this.setBit(16,z)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(z){this.setBit(17,z)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(z){this.setBit(18,z)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(z){this.setBit(19,z)}}]);return y}(t),c=t=>function(v){function y(){return v.apply(this,arguments)||this}l._inherits(y,v);var w=
y.prototype;w.hasVV=function(){return l._get(l._getPrototypeOf(y.prototype),"hasVV",this).call(this)||this.vvRotation};w.setVV=function(z,r){l._get(l._getPrototypeOf(y.prototype),"setVV",this).call(this,z,r);this.vvRotation=!r.isOutline&&!!(z&A.WGLVVFlag.ROTATION)};l._createClass(y,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(z){this.setBit(15,z)}}]);return y}(t),a=t=>function(v){function y(){return v.apply(this,arguments)||this}l._inherits(y,v);var w=y.prototype;w.hasVV=
function(){return l._get(l._getPrototypeOf(y.prototype),"hasVV",this).call(this)||this.vvColor};w.setVV=function(z,r){l._get(l._getPrototypeOf(y.prototype),"setVV",this).call(this,z,r);this.vvColor=!r.isOutline&&!!(z&A.WGLVVFlag.COLOR)};l._createClass(y,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(z){this.setBit(13,z)}}]);return y}(t),b=t=>function(v){function y(){return v.apply(this,arguments)||this}l._inherits(y,v);var w=y.prototype;w.hasVV=function(){return l._get(l._getPrototypeOf(y.prototype),
"hasVV",this).call(this)||this.vvOpacity};w.setVV=function(z,r){l._get(l._getPrototypeOf(y.prototype),"setVV",this).call(this,z,r);this.vvOpacity=!r.isOutline&&!!(z&A.WGLVVFlag.OPACITY)};l._createClass(y,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(z){this.setBit(14,z)}}]);return y}(t);let g=function(t){function v(){return t.apply(this,arguments)||this}l._inherits(v,t);v.load=function(y){const w=this.shared;w.data=y;return w};v.from=function(y){const {symbologyType:w,vvFlags:z}=
y,r=this.load(0);r.geometryType=A.WGLGeometryType.FILL;r.symbologyType=w;w!==A.WGLSymbologyType.DOT_DENSITY&&r.setVV(z,y);return r.data};v.prototype.getVariation=function(){return{...l._get(l._getPrototypeOf(v.prototype),"getVariation",this).call(this),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}};return l._createClass(v)}(a(b(d(f))));g.shared=
new g(0);let e=function(t){function v(){return t.apply(this,arguments)||this}l._inherits(v,t);v.load=function(y){const w=this.shared;w.data=y;return w};v.from=function(y){const {symbologyType:w,vvFlags:z}=y,r=this.load(0);r.geometryType=A.WGLGeometryType.MARKER;r.symbologyType=w;w!==A.WGLSymbologyType.HEATMAP&&r.setVV(z,y);return r.data};v.prototype.getVariation=function(){return{...l._get(l._getPrototypeOf(v.prototype),"getVariation",this).call(this),vvColor:this.vvColor,vvRotation:this.vvRotation,
vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}};return l._createClass(v)}(a(b(c(d(f)))));e.shared=new e(0);let k=function(t){function v(){return t.apply(this,arguments)||this}l._inherits(v,t);v.load=function(y){const w=this.shared;w.data=y;return w};v.from=function(y){const w=this.load(0);w.geometryType=A.WGLGeometryType.LINE;w.symbologyType=y.symbologyType;w.setVV(y.vvFlags,
y);return w.data};v.prototype.getVariation=function(){return{...l._get(l._getPrototypeOf(v.prototype),"getVariation",this).call(this),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}};return l._createClass(v)}(a(b(d(f))));k.shared=new k(0);let p=function(t){function v(){return t.apply(this,arguments)||this}l._inherits(v,t);v.load=function(y){const w=
this.shared;w.data=y;return w};v.from=function(y){const w=this.load(0);w.geometryType=A.WGLGeometryType.TEXT;w.symbologyType=y.symbologyType;w.setVV(y.vvFlags,y);return w.data};v.prototype.getVariation=function(){return{...l._get(l._getPrototypeOf(v.prototype),"getVariation",this).call(this),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}};
return l._createClass(v)}(a(b(c(d(f)))));p.shared=new p(0);let q=function(t){function v(){return t.apply(this,arguments)||this}l._inherits(v,t);v.load=function(y){const w=this.shared;w.data=y;return w};v.from=function(y){const w=this.load(0);w.geometryType=A.WGLGeometryType.LABEL;w.symbologyType=y.symbologyType;w.setVV(y.vvFlags,y);w.mapAligned=D.isMapAligned(y.placement);return w.data};v.prototype.getVariation=function(){return{...l._get(l._getPrototypeOf(v.prototype),"getVariation",this).call(this),
vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}};return l._createClass(v)}(d(f));q.shared=new q(0);n.FillMaterialKey=g;n.LabelMaterialKey=q;n.LineMaterialKey=k;n.MarkerMaterialKey=e;n.MaterialKeyBase=f;n.TextMaterialKey=p;n.createMaterialKey=function(t,v){switch(t){case A.WGLGeometryType.FILL:return g.from(v);case A.WGLGeometryType.LINE:return k.from(v);case A.WGLGeometryType.MARKER:return e.from(v);
case A.WGLGeometryType.TEXT:return p.from(v);case A.WGLGeometryType.LABEL:return q.from(v);default:throw Error(`Unable to createMaterialKey for unknown geometryType ${t}`);}};n.hasOutlineFillSymbology=function(t){return m(t.symbologyType)};n.hasSimpleSymbology=function(t){return u(t.symbologyType)};n.hydrateMaterialKey=function(t){switch(f.load(t).geometryType){case A.WGLGeometryType.MARKER:return new e(t);case A.WGLGeometryType.FILL:return new g(t);case A.WGLGeometryType.LINE:return new k(t);case A.WGLGeometryType.TEXT:return new p(t);
case A.WGLGeometryType.LABEL:return new q(t)}};n.isOutlineFillSymbology=m;n.isSimpleSymbology=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports"],function(n){n.HAlign=void 0;(function(l){l[l.Left=-1]="Left";l[l.Center=0]="Center";l[l.Right=1]="Right"})(n.HAlign||(n.HAlign={}));n.VAlign=void 0;(function(l){l[l.Top=1]="Top";l[l.Center=0]="Center";l[l.Bottom=-1]="Bottom";l[l.Baseline=2]="Baseline"})(n.VAlign||(n.VAlign=
{}));n.getAlignmentFromPlacement=function(l){switch(l){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return[n.HAlign.Right,n.VAlign.Bottom];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return[n.HAlign.Center,n.VAlign.Bottom];case "above-right":case "esriServerPointLabelPlacementAboveRight":return[n.HAlign.Left,n.VAlign.Bottom];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return[n.HAlign.Right,
n.VAlign.Center];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return[n.HAlign.Center,n.VAlign.Center];case "center-right":case "esriServerPointLabelPlacementCenterRight":return[n.HAlign.Left,n.VAlign.Center];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return[n.HAlign.Right,n.VAlign.Top];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return[n.HAlign.Center,
n.VAlign.Top];case "below-right":case "esriServerPointLabelPlacementBelowRight":return[n.HAlign.Left,n.VAlign.Top];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return[n.HAlign.Center,n.VAlign.Center];default:return console.debug(`Found invalid placement type ${l}`),[n.HAlign.Center,n.VAlign.Center]}};n.getJustification=function(l){switch(l){case "left":return n.HAlign.Left;case "right":return n.HAlign.Right;case "center":return n.HAlign.Center}};n.getXAnchorDirection=
function(l){switch(l){case "left":return n.HAlign.Left;case "right":return n.HAlign.Right;case "center":return n.HAlign.Center}};n.getXDirection=function(l){switch(l){case n.HAlign.Right:return-1;case n.HAlign.Center:return 0;case n.HAlign.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${l}`),0}};n.getYAnchorDirection=function(l){switch(l){case "top":return n.VAlign.Top;case "middle":return n.VAlign.Center;case "baseline":return n.VAlign.Baseline;case "bottom":return n.VAlign.Bottom}};
n.getYDirection=function(l){switch(l){case n.VAlign.Top:return 1;case n.VAlign.Center:return 0;case n.VAlign.Bottom:case n.VAlign.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${l}`),0}};n.isMapAligned=function(l){switch(l){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;default:return!1}};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/utils":function(){define("exports ../../../../../core/Error ../enums ../materialKey/MaterialKey ./Technique ./dotDensity/TechniqueDotDensity ./heatmap/TechniqueHeatmap ./pieChart/TechniquePieChart".split(" "),function(n,l,F,D,A,u,m,h){n.assertRendererSchema=function(f,d){if(f.type!==d)throw new l("material-view-model:unexpected-renderer-schema",`expected to find renderer schema of type "${d}" but found type "${f.type}"`);};n.getTechniqueFromMaterialKey=
function(f){const {geometryType:d,symbologyType:c}=D.MaterialKeyBase.load(f);switch(d){case F.WGLGeometryType.FILL:switch(c){case F.WGLSymbologyType.DOT_DENSITY:return u.DotDensityTechnique}break;case F.WGLGeometryType.MARKER:switch(c){case F.WGLSymbologyType.HEATMAP:return m.HeatmapTechnique;case F.WGLSymbologyType.PIE_CHART:return h.PieChartTechnique}}return A.Technique};n.getTechniqueFromRenderer=function(f){switch(f?.type){case "dot-density":return u.DotDensityTechnique;case "heatmap":return m.HeatmapTechnique;
case "pie-chart":return h.PieChartTechnique;default:return A.Technique}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/Technique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(){}D.getStorageSpec=function(A){return null};D.createOrUpdateRendererSchema=function(A,u){return null!=A&&"default"===A.type?A:{type:"default"}};D.getVariation=function(A){return{}};D.getVariationHash=
function(A){return 0};return l._createClass(D)}();F.type="default";F.programSpec=null;n.Technique=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/dotDensity/TechniqueDotDensity":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../color ../../definitions ../Technique ../../../../../webgl/enums".split(" "),function(n,l,F,D,A,u){A=function(m){function h(){return m.apply(this,arguments)||this}l._inherits(h,m);h.getStorageSpec=
function({attributes:f}){return{visualVariables:!1,attributes:f??null}};h._createRendererSchema=function(){return{type:"dot-density",colors:new Float32Array(32),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),activeDots:new Float32Array(8),seed:-1}};h.createOrUpdateRendererSchema=function(f,d){const {attributes:c,dotValue:a,referenceScale:b,dotSize:g,dotBlendingEnabled:e,seed:k,backgroundColor:p}=d;f=null!=f&&"dot-density"===f.type?f:this._createRendererSchema();
f.dotValue=a;f.dotSize=g;f.dotScale=b;f.dotBlending=e;f.seed=k;const {colors:q,activeDots:t,backgroundColor:v}=f;for(var y=0;y<D.DOT_DENSITY_MAX_FIELDS;y++)F.writeColor(q,y>=c.length?null:c[y].color,4*y);for(y=0;8>y;y++)t[y]=y<d.attributes.length?1:0;F.writeColor(v,p);return f};h.getVariation=function(f){return{ddDotBlending:f.dotBlending}};h.getVariationHash=function(f){return f.dotBlending?1:0};return l._createClass(h)}(A.Technique);A.type="dot-density";A.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,
name:"a_pos",count:2,type:u.DataType.SHORT},{location:1,name:"a_id",count:3,type:u.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:u.DataType.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:u.DataType.FLOAT}]}};n.DotDensityTechnique=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(n,l){n.premultiplyAlpha=function(F,D=0,A=!1){const u=F[D+3];F[D]*=u;F[D+1]*=u;F[D+2]*=u;
A||(F[D+3]*=255);return F};n.premultiplyAlphaRGBA=function(F){if(!F)return 0;const {r:D,g:A,b:u,a:m}=F;return l.i8888to32(D*m,A*m,u*m,255*m)};n.premultiplyAlphaRGBAArray=function(F){if(!F)return 0;const [D,A,u,m]=F;return l.i8888to32(m/255*D,m/255*A,m/255*u,m)};n.writeColor=function(F,D,A=0){if(null==D)F[A]=0,F[A+1]=0,F[A+2]=0,F[A+3]=0;else{var {r:u,g:m,b:h,a:f}=D;F[A]=u*f/255;F[A+1]=m*f/255;F[A+2]=h*f/255;F[A+3]=f}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],
function(n){function l(A,u,m){return Math.round(Math.max(Math.min(A,m),u))}const F=new Float32Array(1),D=new Uint32Array(F.buffer);n.i16=function(A){return l(A,-32768,32767)};n.i1616to32=function(A,u){return 65535&A|u<<16};n.i32=function(A){return l(A,-2147483648,2147483647)};n.i8=function(A){return l(A,-128,127)};n.i8816to32=function(A,u,m){return A&255|(u&255)<<8|m<<16};n.i8888to32=function(A,u,m,h){return A&255|(u&255)<<8|(m&255)<<16|h<<24};n.numTo32=function(A){return A|0};n.toFloat32=function(A){D[0]=
A;return F[0]};n.toUint32=function(A){F[0]=A;return D[0]};n.u16=function(A){return l(A,0,65535)};n.u32=function(A){return l(A,0,4294967295)};n.u32to4Xu8=function(A){return[A&255,(A&65280)>>>8,(A&16711680)>>>16,(A&4278190080)>>>24]};n.u4u4to8=function(A,u){return 15&A|(15&u)<<4};n.u8=function(A){return l(A,0,255)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/heatmap/TechniqueHeatmap":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../renderers/support/heatmapUtils ../Technique ../../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u){A=function(m){function h(){return m.apply(this,arguments)||this}l._inherits(h,m);h.getStorageSpec=function({field:f,valueExpression:d}){return{visualVariables:!1,attributes:f||d?[{field:f,valueExpression:d}]:null}};h._createRendererSchema=function(){return{type:"heatmap",radius:-1,referenceScale:-1,isFieldActive:0,minDensity:-1,densityRange:-1,kernel:null,gradient:null,gradientHash:"invalid"}};h.createOrUpdateRendererSchema=function(f,d){const {radius:c,minDensity:a,maxDensity:b,
referenceScale:g,field:e,valueExpression:k,colorStops:p}=d;d=b-a;const q=e||k?1:0,t=p.map(({color:w,ratio:z})=>`${z}:${w.toString()}`).join();let v=!0,y;null!=f&&"heatmap"===f.type?(y=f,v=t!==f.gradientHash):y=this._createRendererSchema();y.radius=F.pt2px(c);y.minDensity=a;y.densityRange=d;y.referenceScale=g;y.isFieldActive=q;v&&(y.gradient=D.generateGradient(p),y.gradientHash=t);return y};return l._createClass(h)}(A.Technique);A.type="heatmap";A.programSpec={shader:"materials/icon/heatmapAccumulate",
vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:u.DataType.SHORT},{location:4,name:"a_id",count:4,type:u.DataType.UNSIGNED_BYTE}]}};n.HeatmapTechnique=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/techniques/pieChart/TechniquePieChart":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../Color ../../../../../../core/screenUtils ../../color ../../definitions ../Technique ../../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h){m=function(f){function d(){return f.apply(this,arguments)||this}l._inherits(d,f);d.getStorageSpec=function({attributes:c}){return{visualVariables:!0,attributes:c??null}};d._createRendererSchema=function(){return{type:"pie-chart",colors:new Float32Array(4*u.CHART_MAX_FIELDS),defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}};d.createOrUpdateRendererSchema=function(c,
a){const {attributes:b,defaultColor:g,holePercentage:e,othersCategory:k,outline:p}=a;c=null!=c&&"pie-chart"===c.type?c:this._createRendererSchema();for(a=0;a<u.CHART_MAX_FIELDS;a++){const q=a>=b.length?new F([0,0,0,0]):b[a].color;A.writeColor(c.colors,q,4*a)}A.writeColor(c.defaultColor,g);A.writeColor(c.othersColor,k?.color);A.writeColor(c.outlineColor,p?.color);c.outlineWidth=D.pt2px(p?.width||0);c.holePercentage=e;c.sectorThreshold=k?.threshold||0;c.numberOfFields=b.length;return c};d.getVariation=
function(c){return{numberOfFields:c.numberOfFields}};d.getVariationHash=function(c){return c.numberOfFields};return l._createClass(d)}(m.Technique);m.type="pie-chart";m.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:h.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:h.DataType.SHORT},{location:2,name:"a_texCoords",count:2,type:h.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:h.DataType.UNSIGNED_SHORT},
{location:4,name:"a_id",count:4,type:h.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:h.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:h.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:h.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:h.DataType.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};n.PieChartTechnique=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/brushes/WGLBrushHeatmap":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ./WGLGeometryBrushMarker ../effects/Effect ../techniques/utils ../../../../webgl/contextUtils ../../../../webgl/enums ../../../../webgl/FramebufferObject ../../../../webgl/heatmapTextureUtils ../../../../webgl/Renderbuffer ../../../../webgl/RenderbufferDescriptor ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k){function p(y,w){const {referenceScale:z,radius:r}=y;return r*(0!==z?z/w.scale:1)}const q=l.getLogger("esri.views.2d.engine.webgl.brushes.WGLBrushHeatmap");l=function(y){function w(){var r=y.apply(this,arguments)||this;r.brushEffect=new v;return r}n._inherits(w,y);var z=w.prototype;z.supportsSymbology=function(r){return r===D.WGLSymbologyType.HEATMAP};z.dispose=function(){n._get(n._getPrototypeOf(w.prototype),"dispose",this).call(this);this.brushEffect.dispose();
this.brushEffect=null};z.prepareState=function(){};z.drawGeometry=function(r,C,x,E){const {defines:B}=this.brushEffect.loadQualityProfile(r.context);n._get(n._getPrototypeOf(w.prototype),"drawGeometry",this).call(this,r,C,x,E?[...E,...B]:B)};z._drawMarkers=function(r,C,x,E,B,G,H){const {context:I,rendererInfo:J,state:L}=r;({rendererSchema:r}=J);h.assertRendererSchema(r,"heatmap");const {isFieldActive:K}=r;x.setUniform1f("u_radius",p(r,L));H||(x.setUniform1f("u_isFieldActive",K),I.setStencilFunction(d.CompareFunction.GEQUAL,
C.stencilRef,255));I.drawElements(E,B,d.DataType.UNSIGNED_INT,G)};return n._createClass(w)}(u);const t={vsPath:"heatmap/heatmapResolve",fsPath:"heatmap/heatmapResolve",attributes:new Map([["a_position",0]])};let v=function(y){function w(){var r=y.apply(this,arguments)||this;r.name=r.constructor.name;return r}n._inherits(w,y);var z=w.prototype;z.createOptions=function({passOptions:r}){return r};z.dispose=function(){this._prevFBO=null;null!=this._accumulateFramebuffer&&this._accumulateFramebuffer.detachDepthStencilBuffer();
this._accumulateOutputStencilBuffer=F.disposeMaybe(this._accumulateOutputStencilBuffer);this._accumulateFramebuffer=F.disposeMaybe(this._accumulateFramebuffer);this._resolveGradientTexture=F.disposeMaybe(this._resolveGradientTexture);this._tileQuad=F.disposeMaybe(this._tileQuad)};z.bind=function(r){const {context:C,rendererInfo:x,passOptions:E,state:B}=r,{rendererSchema:G}=x;null!=E&&"hittest"===E.type||"heatmap"!==G.type||(this._prevFBO=C.getBoundFramebufferObject(),this._prevViewport=C.getViewport(),
h.assertRendererSchema(G,"heatmap"),this._loadResources(r),this._updateResources(C,G,B),C.bindFramebuffer(this._accumulateFramebuffer),C.setViewport(0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height),C.setStencilTestEnabled(!0),C.setBlendingEnabled(!0),C.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE),C.setClearColor(0,0,0,0),C.clear(d.ClearBufferBit.COLOR_BUFFER_BIT))};z.unbind=function(){this._prevViewport=this._prevFBO=null};z.draw=function(r){const {context:C,painter:x,
rendererInfo:E,passOptions:B}=r;({rendererSchema:r}=E);if((null==B||"hittest"!==B.type)&&"heatmap"===r.type){var {defines:G}=this.loadQualityProfile(C);G=x.materialManager.getProgram(t,G);C.useProgram(G);C.bindFramebuffer(this._prevFBO);C.setViewport(0,0,this._prevViewport.width,this._prevViewport.height);C.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);C.setStencilTestEnabled(!1);var {radius:H,minDensity:I,densityRange:J}=r;C.bindTexture(this._accumulateFramebuffer.colorTexture,
8);C.bindTexture(this._resolveGradientTexture,9);G.setUniform1i("u_texture",8);G.setUniform1i("u_gradient",9);G.setUniform2f("u_densityMinAndInvRange",I,1/J);G.setUniform1f("u_densityNormalization",3/(H*H*Math.PI));this._tileQuad.draw()}};z._loadResources=function({context:r,painter:C}){const {dataType:x,samplingMode:E,pixelFormat:B,internalFormat:G,requiresSharedStencilBuffer:H}=this.loadQualityProfile(r),{width:I,height:J}=this._prevViewport,L=.25*I,K=.25*J;let S=new k.TextureDescriptor(L,K);S.pixelFormat=
B;S.internalFormat=G;S.dataType=x;S.samplingMode=E;S.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;H||(this._accumulateOutputStencilBuffer??(this._accumulateOutputStencilBuffer=new b.Renderbuffer(r,new g.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_STENCIL,L,K))));this._accumulateFramebuffer??(this._accumulateFramebuffer=new c.FramebufferObject(r,S,H?C.getSharedStencilBuffer():this._accumulateOutputStencilBuffer));S=new k.TextureDescriptor;S.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;this._resolveGradientTexture??
(this._resolveGradientTexture=new e.Texture(r,S));this._tileQuad??(this._tileQuad=new A(r,[0,0,1,0,0,1,1,1]))};z._updateResources=function(r,C,x){const {gradientHash:E,gradient:B}=C;this._prevGradientHash!==E&&(this._resolveGradientTexture.resize(B.length/4,1),this._resolveGradientTexture.setData(B),this._prevGradientHash=E);const {requiresSharedStencilBuffer:G}=this.loadQualityProfile(r);x=G?1:2>p(C,x)?1:.25;const {width:H,height:I}=this._prevViewport;C=H*x;x*=I;const {width:J,height:L}=this._accumulateFramebuffer;
if(J!==C||L!==x){const K=this._accumulateFramebuffer.depthStencilAttachment;if(G&&null!=K){const {width:S,height:W}=K.descriptor;if(S!==C||W!==x)q.errorOnce("Attempted to resize shared stencil buffer! Detaching instead."),this._accumulateFramebuffer.detachDepthStencilBuffer()}this._accumulateFramebuffer.resize(C,x)}G||r.blitFramebuffer(this._prevFBO,this._accumulateFramebuffer,0,0,this._prevFBO.width,this._prevFBO.height,0,0,this._accumulateFramebuffer.width,this._accumulateFramebuffer.height,d.ClearBufferBit.STENCIL_BUFFER_BIT,
d.TextureSamplingMode.NEAREST)};z.loadQualityProfile=function(r){if(null==this._qualityProfile){const C=a.loadHeatmapTextureConfiguration(r,q);this._qualityProfile={...C,requiresSharedStencilBuffer:r.type===f.ContextType.WEBGL1,defines:C.dataType!==d.PixelType.FLOAT?["heatmapPrecisionHalfFloat"]:[]}}return this._qualityProfile};return n._createClass(w)}(m.Effect);return l})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../techniques/utils ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m){const h={shader:"materials/icon",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:m.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:m.DataType.SHORT},{location:2,name:"a_texCoords",count:2,type:m.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:m.DataType.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:m.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:m.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,
name:"a_outlineColor",count:4,type:m.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:m.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:m.DataType.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};return function(f){function d(){return f.apply(this,arguments)||this}n._inherits(d,f);var c=d.prototype;c.dispose=function(){};c.getGeometryType=function(){return l.WGLGeometryType.MARKER};c.supportsSymbology=function(a){return a!==
l.WGLSymbologyType.HEATMAP&&a!==l.WGLSymbologyType.PIE_CHART};c.drawGeometry=function(a,b,g,e){const {context:k,painter:p,rendererInfo:q,state:t,passOptions:v,requestRender:y,allowDelayedRender:w}=a;var z=A.MarkerMaterialKey.load(g.materialKey),r=u.getTechniqueFromMaterialKey(z.data);const C=null!=v&&"hittest"===v.type,{shader:x,vertexLayout:E,hittestAttributes:B}=r.programSpec??h;r=m.PrimitiveType.TRIANGLES;var G=F.createProgramDescriptor(z.data,E);C&&(G=this._getTriangleDesc(g.materialKey,G,B),
r=m.PrimitiveType.POINTS);const {attributes:H,bufferLayouts:I}=G;e=p.materialManager.getMaterialProgram(a,z,x,H,e);w&&null!=y&&!e.compiled?y():(k.useProgram(e),z.textureBinding&&p.textureManager.bindTextures(k,e,z,!0),this._setSharedUniforms(e,a,b),e.setUniformMatrix3fv("u_displayMat3",z.vvRotation?t.displayViewMat3:t.displayMat3),this._setSizeVVUniforms(z,e,q,b),this._setColorAndOpacityVVUniforms(z,e,q),this._setRotationVVUniforms(z,e,q),z=g.target.getVAO(k,I,H,C),G=g.indexCount,g=g.indexFrom*Uint32Array.BYTES_PER_ELEMENT,
C&&(G/=3,g/=3),k.bindVAO(z),this._drawMarkers(a,b,e,r,G,g,C),k.bindVAO(null))};c._drawMarkers=function(a,b,g,e,k,p,q){a.context.drawElements(e,k,m.DataType.UNSIGNED_INT,p)};return n._createClass(d)}(D)})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(){this.name=this.constructor.name}D.prototype.createOptions=function(A,u){return null};return l._createClass(D)}();n.Effect=F;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","../../core/maybe","./enums"],function(n,l,F,D){n.loadHeatmapTextureConfiguration=function(A,u){const {textureFloat:m,colorBufferFloat:h}=A.capabilities,f=m?.textureFloat,d=m?.textureFloatLinear;var c=m?.textureHalfFloat;const a=m?.textureHalfFloatLinear,b=m?.HALF_FLOAT,g=h?.textureFloat;var e=h?.textureHalfFloat;const k=h?.floatBlend;A=F.unwrapOrThrow(A.driverTest).floatBufferBlend.result;
if(!f&&!c)throw new l("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!g&&!e)throw new l("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(k&&A||e))throw new l("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${A?
"":" This device claims support for EXT_float_blend, but does not actually support it."}`);c=c&&e;e=!!h?.R32F;const p=!!h?.R16F;if(f&&g&&k&&A&&(d||!a))return d||u.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:D.PixelType.FLOAT,samplingMode:d?D.TextureSamplingMode.LINEAR:D.TextureSamplingMode.NEAREST,pixelFormat:e?D.PixelFormat.RED:D.PixelFormat.RGBA,internalFormat:e?D.SizedPixelFormat.R32F:D.PixelFormat.RGBA};if(c)return a||u.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),
{dataType:b,samplingMode:a?D.TextureSamplingMode.LINEAR:D.TextureSamplingMode.NEAREST,pixelFormat:p?D.PixelFormat.RED:D.PixelFormat.RGBA,internalFormat:p?D.SizedPixelFormat.R16F:D.PixelFormat.RGBA};throw new l("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){return function(g){function e(){var p=g.apply(this,arguments)||this;p._color=l.fromValues(1,0,0,1);return p}n._inherits(e,g);var k=e.prototype;k.dispose=function(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._canvas=this._tileInfoVertexArrayObject=null};k.prepareState=
function({context:p}){p.setBlendingEnabled(!0);p.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);p.setColorMask(!0,!0,!0,!0);p.setStencilWriteMask(0);p.setStencilTestEnabled(!1)};k.draw=function(p,q){const {context:t,requestRender:v,allowDelayedRender:y}=p;if(q.isReady)if(this._loadWGLResources(t),!y||null==v||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){t.bindVAO(this._outlineVertexArrayObject);t.useProgram(this._outlineProgram);
this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",q.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",q.rangeX,q.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);t.drawArrays(h.PrimitiveType.LINE_STRIP,0,4);if(p=this._getTexture(t,q))t.bindVAO(this._tileInfoVertexArrayObject),t.useProgram(this._tileInfoProgram),t.bindTexture(p,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",q.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",
0),this._tileInfoProgram.setUniform2f("u_coord_ratio",q.rangeX/q.width,q.rangeY/q.height),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",p.descriptor.width,p.descriptor.height),t.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);t.bindVAO()}else v()};k._loadWGLResources=function(p){if(!this._outlineProgram||!this._tileInfoProgram){var q=f.createProgram(p,A.background),t=f.createProgram(p,u.tileInfo),v=new Int8Array([0,0,1,0,1,1,0,1]);v=m.BufferObject.createVertex(p,
h.Usage.STATIC_DRAW,v);v=new a.VertexArrayObject(p,A.background.attributes,F.Pos2b,{geometry:v});var y=new Int8Array([0,0,1,0,0,1,1,1]);y=m.BufferObject.createVertex(p,h.Usage.STATIC_DRAW,y);p=new a.VertexArrayObject(p,u.tileInfo.attributes,F.Pos2b,{geometry:y});this._outlineProgram=q;this._tileInfoProgram=t;this._outlineVertexArrayObject=v;this._tileInfoVertexArrayObject=p}};k._getTexture=function(p,q){if(q.texture&&q.triangleCountReportedInDebug===q.triangleCount)return q.texture;q.triangleCountReportedInDebug=
q.triangleCount;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","tileCanvas2d"),this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var t=q.triangleCount;let v=q.key.id;0<q.triangleCount&&(v+=`, ${t}`);const y=this._canvas,w=y.getContext("2d");w.font="24px sans-serif";w.textAlign="left";w.textBaseline="top";w.clearRect(0,0,300,32);1E5<t?(w.fillStyle="red",w.fillRect(0,0,300,
32),w.fillStyle="black"):(w.clearRect(0,0,300,32),w.fillStyle="blue");w.fillText(v,0,0);t=new c.TextureDescriptor;t.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;t.samplingMode=h.TextureSamplingMode.NEAREST;t.isImmutable=b(p.gl);q.texture=new d.Texture(p,t,y);return q.texture};return n._createClass(e)}(D)})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(n,l,F){const D={geometry:[new F.VertexElementDescriptor("a_pos",
2,l.DataType.BYTE,0,2)]},A={geometry:[new F.VertexElementDescriptor("a_pos",2,l.DataType.BYTE,0,4),new F.VertexElementDescriptor("a_tex",2,l.DataType.BYTE,2,4)]};l={geometry:[new F.VertexElementDescriptor("a_pos",2,l.DataType.UNSIGNED_SHORT,0,4)]};n.Pos2b=D;n.Pos2us=l;n.PosTex2b=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports","./sources/resolver"],function(n,l){l={shaders:{vertexShader:l.resolveIncludes("tileInfo/tileInfo.vert"),
fragmentShader:l.resolveIncludes("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])};n.tileInfo=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(n){return window.WebGL2RenderingContext&&n instanceof window.WebGL2RenderingContext}})},"esri/views/2d/engine/webgl/brushes/WGLBrushPieChart":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../enums","./WGLGeometryBrushMarker",
"../techniques/utils","../../../../webgl/enums"],function(n,l,F,D,A){return function(u){function m(){return u.apply(this,arguments)||this}n._inherits(m,u);var h=m.prototype;h.supportsSymbology=function(f){return f===l.WGLSymbologyType.PIE_CHART};h._drawMarkers=function(f,d,c,a,b,g,e){({context:d}=f);({rendererInfo:f}=f);({rendererSchema:f}=f);D.assertRendererSchema(f,"pie-chart");c.setUniform4fv("u_colors",f.colors);c.setUniform4fv("u_defaultColor",f.defaultColor);c.setUniform4fv("u_othersColor",
f.othersColor);c.setUniform4fv("u_outlineColor",f.outlineColor);c.setUniform1f("u_donutRatio",f.holePercentage);c.setUniform1f("u_sectorThreshold",f.sectorThreshold);c.setUniform1f("u_outlineWidth",f.outlineWidth);d.drawElements(a,b,A.DataType.UNSIGNED_INT,g)};return n._createClass(m)}(F)})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f){return function(d){function c(){var b=d.apply(this,arguments)||this;b._color=l.fromValues(1,0,0,1);b._initialized=!1;return b}n._inherits(c,d);var a=c.prototype;a.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};a.prepareState=function({context:b}){b.setDepthWriteEnabled(!1);b.setDepthTestEnabled(!1);b.setStencilTestEnabled(!0);
b.setBlendingEnabled(!1);b.setColorMask(!1,!1,!1,!1);b.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE);b.setStencilWriteMask(255)};a.draw=function(b,g){const {context:e,requestRender:k,allowDelayedRender:p}=b;this._initialized||this._initialize(e);p&&null!=k&&!this._solidProgram.compiled?k():(e.setStencilFunctionSeparate(m.Face.FRONT_AND_BACK,m.CompareFunction.GREATER,g.stencilRef,255),e.bindVAO(this._solidVertexArrayObject),e.useProgram(this._solidProgram),
this._solidProgram.setUniformMatrix3fv("u_dvsMat3",g.transforms.dvs),this._solidProgram.setUniform2fv("u_coord_range",[g.rangeX,g.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),e.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4),e.bindVAO())};a._initialize=function(b){if(this._initialized)return!0;const g=h.createProgram(b,A.background);if(!g)return!1;var e=new Int8Array([0,0,1,0,0,1,1,1]);e=u.BufferObject.createVertex(b,m.Usage.STATIC_DRAW,
e);b=new f.VertexArrayObject(b,A.background.attributes,F.Pos2b,{geometry:e});this._solidProgram=g;this._solidVertexArrayObject=b;return this._initialized=!0};return n._createClass(c)}(D)})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){f=function(b){function g(){var k=b.apply(this,arguments)||this;k._color=A.fromValues(1,0,0,1);k._patternMatrix=D.create();k._programOptions={id:!1,pattern:!1};return k}l._inherits(g,b);var e=g.prototype;e.dispose=function(){this._vao&&(this._vao.dispose(),this._vao=null)};e.drawMany=function(k,p){const {context:q,painter:t,styleLayerUID:v,requestRender:y,allowDelayedRender:w}=k;this._loadWGLResources(k);const z=k.displayLevel;var r=k.styleLayer,C=r.backgroundMaterial;
const x=t.vectorTilesMaterialManager;var E=r.getPaintValue("background-color",z);const B=r.getPaintValue("background-opacity",z),G=r.getPaintValue("background-pattern",z),H=void 0!==G,I=E[3]*B,J=k.spriteMosaic;let L,K;const S=(window.devicePixelRatio|1)>u.VTL_HIGH_RES_CUTOFF?2:1;k=k.drawPhase===m.WGLDrawPhase.HITTEST;const W=this._programOptions;W.id=k;W.pattern=H;C=x.getMaterialProgram(q,C,W);if(w&&null!=y&&!C.compiled)y();else{q.bindVAO(this._vao);q.useProgram(C);if(H){E=J.getMosaicItemPosition(G,
!0);if(null!=E){const {tl:X,br:Z,page:V}=E;L=Z[0]-X[0];K=Z[1]-X[1];E=J.getPageSize(V);null!=E&&(J.bind(q,c.TextureSamplingMode.LINEAR,V,u.VTL_TEXTURE_BINDING_UNIT_SPRITES),C.setUniform4f("u_tlbr",X[0],X[1],Z[0],Z[1]),C.setUniform2fv("u_mosaicSize",E),C.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_SPRITES))}C.setUniform1f("u_opacity",B)}else this._color[0]=I*E[0],this._color[1]=I*E[1],this._color[2]=I*E[2],this._color[3]=I,C.setUniform4fv("u_color",this._color);C.setUniform1f("u_depth",r.z||
0);k&&(r=h.u32to4Xu8(v+1),C.setUniform4fv("u_id",r));for(const X of p)C.setUniform1f("u_coord_range",X.rangeX),C.setUniformMatrix3fv("u_dvsMat3",X.transforms.dvs),H&&(r=S*X.width*Math.max(2**(Math.round(z)-X.key.level),1),p=r/F.nextPowerOfTwo(L),r/=F.nextPowerOfTwo(K),this._patternMatrix[0]=p,this._patternMatrix[4]=r,C.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),q.setStencilFunction(c.CompareFunction.EQUAL,0,255),q.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4)}};e._loadWGLResources=
function(k){if(!this._vao){var {context:p,styleLayer:q}=k;k=q.backgroundMaterial;var t=new Int8Array([0,0,1,0,0,1,1,1]);t=d.BufferObject.createVertex(p,c.Usage.STATIC_DRAW,t);this._vao=new a.VertexArrayObject(p,k.getAttributeLocations(),k.getLayoutInfo(),{geometry:t})}};return l._createClass(g)}(f);n.WGLBrushVTLBackground=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../vectorTiles/style/StyleDefinition ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m){u=function(h){function f(){var c=h.apply(this,arguments)||this;c._programOptions={id:!1};return c}l._inherits(f,h);var d=f.prototype;d.dispose=function(){};d.drawMany=function(c,a){const {context:b,displayLevel:g,requiredLevel:e,state:k,drawPhase:p,painter:q,spriteMosaic:t,styleLayerUID:v,requestRender:y,allowDelayedRender:w}=c;if(a.some(G=>G.layerData.get(v)?.circleIndexCount??!1)){c=c.styleLayer;var z=c.circleMaterial,r=q.vectorTilesMaterialManager,C=c.getPaintValue("circle-translate",
g),x=c.getPaintValue("circle-translate-anchor",g),E=p===D.WGLDrawPhase.HITTEST,B=this._programOptions;B.id=E;r=r.getMaterialProgram(b,z,B);if(w&&null!=y&&!r.compiled)y();else{b.useProgram(r);r.setUniformMatrix3fv("u_displayMat3",x===F.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);r.setUniform2fv("u_circleTranslation",C);r.setUniform1f("u_depth",c.z);r.setUniform1f("u_antialiasingWidth",1.2);C=-1;E&&(E=A.u32to4Xu8(v+1),r.setUniform4fv("u_id",E));for(const G of a)G.layerData.has(v)&&(G.key.level!==
C&&(C=G.key.level,z.setDataUniforms(r,g,c,C,t)),a=G.layerData.get(v),a.circleIndexCount&&(a.prepareForRendering(b),E=a.vao,null!=E&&(b.bindVAO(E),r.setUniformMatrix3fv("u_dvsMat3",G.transforms.dvs),e!==G.key.level?b.setStencilFunction(m.CompareFunction.EQUAL,G.stencilRef,255):b.setStencilFunction(m.CompareFunction.GREATER,255,255),b.drawElements(m.PrimitiveType.TRIANGLES,a.circleIndexCount,m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a.circleIndexStart),G.triangleCount+=a.circleIndexCount/
3)))}}};return l._createClass(f)}(u);n.WGLBrushVTLCircle=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../symbols/cim/enums"],function(n,l,F){n.StyleLayerType=void 0;(function(D){D[D.BACKGROUND=0]="BACKGROUND";D[D.FILL=1]="FILL";D[D.LINE=2]="LINE";D[D.SYMBOL=3]="SYMBOL";D[D.CIRCLE=4]="CIRCLE"})(n.StyleLayerType||(n.StyleLayerType=
{}));n.Visibility=void 0;(function(D){D[D.VISIBLE=0]="VISIBLE";D[D.NONE=1]="NONE"})(n.Visibility||(n.Visibility={}));n.SymbolPlacement=void 0;(function(D){D[D.POINT=0]="POINT";D[D.LINE=1]="LINE";D[D.LINE_CENTER=2]="LINE_CENTER"})(n.SymbolPlacement||(n.SymbolPlacement={}));n.RotationAlignment=void 0;(function(D){D[D.MAP=0]="MAP";D[D.VIEWPORT=1]="VIEWPORT";D[D.AUTO=2]="AUTO"})(n.RotationAlignment||(n.RotationAlignment={}));n.TextJustification=void 0;(function(D){D[D.AUTO=0]="AUTO";D[D.LEFT=1]="LEFT";
D[D.CENTER=2]="CENTER";D[D.RIGHT=3]="RIGHT"})(n.TextJustification||(n.TextJustification={}));n.SymbolAnchor=void 0;(function(D){D[D.CENTER=0]="CENTER";D[D.LEFT=1]="LEFT";D[D.RIGHT=2]="RIGHT";D[D.TOP=3]="TOP";D[D.BOTTOM=4]="BOTTOM";D[D.TOP_LEFT=5]="TOP_LEFT";D[D.TOP_RIGHT=6]="TOP_RIGHT";D[D.BOTTOM_LEFT=7]="BOTTOM_LEFT";D[D.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(n.SymbolAnchor||(n.SymbolAnchor={}));n.TextTransform=void 0;(function(D){D[D.NONE=0]="NONE";D[D.UPPERCASE=1]="UPPERCASE";D[D.LOWERCASE=2]="LOWERCASE"})(n.TextTransform||
(n.TextTransform={}));n.TranslateAnchor=void 0;(function(D){D[D.MAP=0]="MAP";D[D.VIEWPORT=1]="VIEWPORT"})(n.TranslateAnchor||(n.TranslateAnchor={}));n.TextWritingMode=void 0;(function(D){D[D.HORIZONTAL=0]="HORIZONTAL";D[D.VERTICAL=1]="VERTICAL"})(n.TextWritingMode||(n.TextWritingMode={}));l=l._createClass(function(){});l.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.Visibility.VISIBLE}};l.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],
default:n.Visibility.VISIBLE}};l.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:F.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:F.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};l.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",
default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:n.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:n.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",
default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:n.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),
default:n.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:n.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},
"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:n.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:n.TextTransform.NONE},
"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[n.TextWritingMode.HORIZONTAL]}};l.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:n.Visibility.VISIBLE}};l.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};l.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",
default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:n.TranslateAnchor.MAP}};l.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},
"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:n.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};l.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",
minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:n.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},
"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:n.TranslateAnchor.MAP}};l.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",
minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};l.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,
0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:n.TranslateAnchor.MAP}};n.StyleDefinition=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h){const f=1/65536;m=function(d){function c(){var b=d.apply(this,arguments)||this;b._fillProgramOptions={id:!1,pattern:!1};b._outlineProgramOptions={id:!1};return b}l._inherits(c,d);var a=c.prototype;a.dispose=function(){};a.drawMany=function(b,g){const {displayLevel:e,drawPhase:k,renderPass:p,spriteMosaic:q,styleLayerUID:t}=b;var v=!1;for(var y of g)if(y.layerData.has(t)){var w=y.layerData.get(t);if(0<w.fillIndexCount||0<w.outlineIndexCount){v=!0;break}}if(v){v=b.styleLayer;
var z=v.getPaintProperty("fill-pattern");w=(y=void 0!==z)&&z.isDataDriven;if(y&&!w){var r=z.getValue(e);r=q.getMosaicItemPosition(r,!0)}z=!y&&v.getPaintValue("fill-antialias",e);var C=!0,x=1;if(!y){var E=v.getPaintProperty("fill-color"),B=v.getPaintProperty("fill-opacity");E?.isDataDriven||B?.isDataDriven||(x=v.getPaintValue("fill-color",e),x=v.getPaintValue("fill-opacity",e)*x[3],1<=x&&(C=!1))}if(!C||"opaque"!==p){var G;k===A.WGLDrawPhase.HITTEST&&(G=u.u32to4Xu8(t+1));E=v.getPaintValue("fill-translate",
e);B=v.getPaintValue("fill-translate-anchor",e);(C||"translucent"!==p)&&this._drawFill(b,t,v,g,E,B,y,r,w,G);r=!v.hasDataDrivenOutlineColor&&v.outlineUsesFillColor&&1>x;z&&"opaque"!==p&&!r&&this._drawOutline(b,t,v,g,E,B,G)}}};a._drawFill=function(b,g,e,k,p,q,t,v,y,w){if(!t||y||null!=v){var {context:z,displayLevel:r,state:C,drawPhase:x,painter:E,pixelRatio:B,spriteMosaic:G,requestRender:H,allowDelayedRender:I}=b;b=e.fillMaterial;var J=E.vectorTilesMaterialManager,L=B>D.VTL_HIGH_RES_CUTOFF?2:1,K=x===
A.WGLDrawPhase.HITTEST,S=this._fillProgramOptions;S.id=K;S.pattern=t;J=J.getMaterialProgram(z,b,S);if(I&&null!=H&&!J.compiled)H();else{z.useProgram(J);null!=v&&({page:v}=v,S=G.getPageSize(v),null!=S&&(G.bind(z,h.TextureSamplingMode.LINEAR,v,D.VTL_TEXTURE_BINDING_UNIT_SPRITES),J.setUniform2fv("u_mosaicSize",S),J.setUniform1i("u_texture",D.VTL_TEXTURE_BINDING_UNIT_SPRITES)));J.setUniformMatrix3fv("u_displayMat3",q===F.TranslateAnchor.VIEWPORT?C.displayMat3:C.displayViewMat3);J.setUniform2fv("u_fillTranslation",
p);J.setUniform1f("u_depth",e.z+f);K&&J.setUniform4fv("u_id",w);p=-1;for(const W of k)if(W.layerData.has(g)&&(W.key.level!==p&&(p=W.key.level,b.setDataUniforms(J,r,e,p,G)),k=W.layerData.get(g),k.fillIndexCount&&(k.prepareForRendering(z),q=k.fillVAO,null!=q))){z.bindVAO(q);J.setUniformMatrix3fv("u_dvsMat3",W.transforms.dvs);z.setStencilFunction(h.CompareFunction.EQUAL,W.stencilRef,255);t&&J.setUniform1f("u_patternFactor",W.rangeX/(L*W.width*Math.max(2**(Math.round(r)-W.key.level),1)));if(y){q=k.patternMap;
if(!q)continue;for(const [X,Z]of q)q=G.getPageSize(X),null!=q&&(G.bind(z,h.TextureSamplingMode.LINEAR,X,D.VTL_TEXTURE_BINDING_UNIT_SPRITES),J.setUniform2fv("u_mosaicSize",q),J.setUniform1i("u_texture",D.VTL_TEXTURE_BINDING_UNIT_SPRITES),z.drawElements(h.PrimitiveType.TRIANGLES,Z[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*Z[0]))}else z.drawElements(h.PrimitiveType.TRIANGLES,k.fillIndexCount,h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.fillIndexStart);W.triangleCount+=k.fillIndexCount/
3}}}};a._drawOutline=function(b,g,e,k,p,q,t){const {context:v,displayLevel:y,state:w,drawPhase:z,painter:r,pixelRatio:C,spriteMosaic:x,requestRender:E,allowDelayedRender:B}=b;b=e.outlineMaterial;var G=r.vectorTilesMaterialManager;const H=.75/C,I=z===A.WGLDrawPhase.HITTEST,J=this._outlineProgramOptions;J.id=I;G=G.getMaterialProgram(v,b,J);if(B&&null!=E&&!G.compiled)E();else{v.useProgram(G);G.setUniformMatrix3fv("u_displayMat3",q===F.TranslateAnchor.VIEWPORT?w.displayMat3:w.displayViewMat3);G.setUniform2fv("u_fillTranslation",
p);G.setUniform1f("u_depth",e.z+f);G.setUniform1f("u_outline_width",H);I&&G.setUniform4fv("u_id",t);p=-1;for(const L of k)L.layerData.has(g)&&(L.key.level!==p&&(p=L.key.level,b.setDataUniforms(G,y,e,p,x)),k=L.layerData.get(g),k.prepareForRendering(v),k.outlineIndexCount&&(q=k.outlineVAO,null!=q&&(v.bindVAO(q),G.setUniformMatrix3fv("u_dvsMat3",L.transforms.dvs),v.setStencilFunction(h.CompareFunction.EQUAL,L.stencilRef,255),v.drawElements(h.PrimitiveType.TRIANGLES,k.outlineIndexCount,h.DataType.UNSIGNED_INT,
Uint32Array.BYTES_PER_ELEMENT*k.outlineIndexStart),L.triangleCount+=k.outlineIndexCount/3)))}};return l._createClass(c)}(m);n.WGLBrushVTLFill=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(n,l,F,D,A,u,m,h){m=function(f){function d(){var a=
f.apply(this,arguments)||this;a._programOptions={id:!1,pattern:!1,sdf:!1};return a}l._inherits(d,f);var c=d.prototype;c.dispose=function(){};c.drawMany=function(a,b){const {context:g,displayLevel:e,state:k,drawPhase:p,painter:q,pixelRatio:t,spriteMosaic:v,styleLayerUID:y,requestRender:w,allowDelayedRender:z}=a;if(b.some(W=>W.layerData.get(y)?.lineIndexCount??!1)){a=a.styleLayer;var r=a.lineMaterial,C=q.vectorTilesMaterialManager,x=a.getPaintValue("line-translate",e),E=a.getPaintValue("line-translate-anchor",
e),B=a.getPaintProperty("line-pattern"),G=void 0!==B,H=G&&B.isDataDriven;if(G&&!H){B=B.getValue(e);var I=v.getMosaicItemPosition(B)}var J;B=!1;if(!G){var L=a.getPaintProperty("line-dasharray");B=(J=void 0!==L)&&L.isDataDriven;J&&!B&&(I=L.getValue(e),I=a.getDashKey(I,a.getLayoutValue("line-cap",e)),I=v.getMosaicItemPosition(I))}L=1/t;var K=p===A.WGLDrawPhase.HITTEST,S=this._programOptions;S.id=K;S.pattern=G;S.sdf=J;J=C.getMaterialProgram(g,r,S);if(z&&null!=w&&!J.compiled)w();else{g.useProgram(J);J.setUniformMatrix3fv("u_displayViewMat3",
k.displayViewMat3);J.setUniformMatrix3fv("u_displayMat3",E===F.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);J.setUniform2fv("u_lineTranslation",x);J.setUniform1f("u_depth",a.z);J.setUniform1f("u_antialiasing",L);K&&(x=u.u32to4Xu8(y+1),J.setUniform4fv("u_id",x));I&&null!=I&&({page:x}=I,E=v.getPageSize(x),null!=E&&(v.bind(g,h.TextureSamplingMode.LINEAR,x,D.VTL_TEXTURE_BINDING_UNIT_SPRITES),J.setUniform2fv("u_mosaicSize",E),J.setUniform1i("u_texture",D.VTL_TEXTURE_BINDING_UNIT_SPRITES)));
x=-1;for(const W of b)if(W.layerData.has(y)&&(W.key.level!==x&&(x=W.key.level,r.setDataUniforms(J,e,a,x,v)),J.setUniform1f("u_zoomFactor",2**(e-x)/t),b=W.layerData.get(y),b.lineIndexCount&&(b.prepareForRendering(g),E=b.vao,null!=E))){g.bindVAO(E);J.setUniformMatrix3fv("u_dvsMat3",W.transforms.dvs);g.setStencilFunction(h.CompareFunction.EQUAL,W.stencilRef,255);if(H||B){E=b.patternMap;if(!E)continue;for(const [X,Z]of E)E=v.getPageSize(X),null!=E&&(v.bind(g,h.TextureSamplingMode.LINEAR,X,D.VTL_TEXTURE_BINDING_UNIT_SPRITES),
J.setUniform2fv("u_mosaicSize",E),J.setUniform1i("u_texture",D.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.drawElements(h.PrimitiveType.TRIANGLES,Z[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*Z[0]))}else g.drawElements(h.PrimitiveType.TRIANGLES,b.lineIndexCount,h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*b.lineIndexStart);W.triangleCount+=b.lineIndexCount/3}}}};return l._createClass(d)}(m);n.WGLBrushVTLLine=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../GeometryUtils ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){const a=1/65536;d=function(b){function g(){var k=b.apply(this,arguments)||this;k._iconProgramOptions={id:!1,sdf:!1};k._sdfProgramOptions={id:!1};k._spritesTextureSize=F.create();return k}l._inherits(g,b);var e=g.prototype;e.dispose=function(){};e.drawMany=function(k,p){const {drawPhase:q,styleLayerUID:t}=k,v=k.styleLayer;let y;q===m.WGLDrawPhase.HITTEST&&(y=f.u32to4Xu8(t+1));this._drawIcons(k,v,p,y);this._drawText(k,v,p,y)};e._drawIcons=function(k,p,q,t){const {context:v,
displayLevel:y,drawPhase:w,painter:z,spriteMosaic:r,state:C,styleLayerUID:x,requestRender:E,allowDelayedRender:B}=k,G=p.iconMaterial;var H=z.vectorTilesMaterialManager,I=!1;for(var J of q)if(J.layerData.has(x)){var L=J.layerData.get(x);if(0<L.iconPerPageElementsMap.size){I=!0;break}}if(I){I=p.getPaintValue("icon-translate",y);J=p.getPaintValue("icon-translate-anchor",y);var K=p.getLayoutValue("icon-rotation-alignment",y);K===A.RotationAlignment.AUTO&&(K=p.getLayoutValue("symbol-placement",y)===A.SymbolPlacement.POINT?
A.RotationAlignment.VIEWPORT:A.RotationAlignment.MAP);var S=K===A.RotationAlignment.MAP;S=p.getLayoutValue("icon-keep-upright",y)&&S;var W=L.isIconSDF;L=w===m.WGLDrawPhase.HITTEST;var X=this._iconProgramOptions;X.id=L;X.sdf=W;H=H.getMaterialProgram(v,G,X);if(B&&null!=E&&!H.compiled)E();else{v.useProgram(H);H.setUniformMatrix3fv("u_displayViewMat3",K===A.RotationAlignment.MAP?C.displayViewMat3:C.displayMat3);H.setUniformMatrix3fv("u_displayMat3",J===A.TranslateAnchor.VIEWPORT?C.displayMat3:C.displayViewMat3);
H.setUniform2fv("u_iconTranslation",I);H.setUniform1f("u_depth",p.z);H.setUniform1f("u_mapRotation",h.degToByte(C.rotation));H.setUniform1f("u_keepUpright",S?1:0);H.setUniform1f("u_level",10*y);H.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_SPRITES);H.setUniform1f("u_fadeDuration",D.FADE_DURATION/1E3);L&&H.setUniform4fv("u_id",t);t=-1;for(const Z of q)if(Z.layerData.has(x)&&(Z.key.level!==t&&(t=Z.key.level,G.setDataUniforms(H,y,p,t,r)),L=Z.layerData.get(x),0!==L.iconPerPageElementsMap.size&&
(L.prepareForRendering(v),L.updateOpacityInfo(),q=L.iconVAO,null!=q))){v.bindVAO(q);H.setUniformMatrix3fv("u_dvsMat3",Z.transforms.dvs);H.setUniform1f("u_time",(performance.now()-L.lastOpacityUpdate)/1E3);for(const [V,O]of L.iconPerPageElementsMap)this._renderIconRange(k,H,O,V,Z)}}}};e._renderIconRange=function(k,p,q,t,v){const {context:y,spriteMosaic:w}=k;this._spritesTextureSize[0]=w.getWidth(t)/4;this._spritesTextureSize[1]=w.getHeight(t)/4;p.setUniform2fv("u_mosaicSize",this._spritesTextureSize);
w.bind(y,c.TextureSamplingMode.LINEAR,t,u.VTL_TEXTURE_BINDING_UNIT_SPRITES);y.setStencilTestEnabled(!0);y.setStencilFunction(c.CompareFunction.GREATER,255,255);y.setStencilWriteMask(0);y.drawElements(c.PrimitiveType.TRIANGLES,q[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q[0]);v.triangleCount+=q[1]/3};e._drawText=function(k,p,q,t){const {context:v,displayLevel:y,drawPhase:w,glyphMosaic:z,painter:r,pixelRatio:C,spriteMosaic:x,state:E,styleLayerUID:B,requestRender:G,allowDelayedRender:H}=
k;k=p.textMaterial;const I=r.vectorTilesMaterialManager;var J=!1;for(var L of q)if(L.layerData.has(B)){var K=L.layerData.get(B);if(0<K.glyphPerPageElementsMap.size){J=!0;break}}if(J&&(K=p.getPaintProperty("text-opacity"),!K||K.isDataDriven||0!==K.getValue(y))){K=p.getPaintProperty("text-color");var S=!K||K.isDataDriven||0<K.getValue(y)[3];K=p.getPaintProperty("text-halo-width");L=p.getPaintProperty("text-halo-color");var W=(!K||K.isDataDriven||0<K.getValue(y))&&(!L||L.isDataDriven||0<L.getValue(y)[3]);
if(S||W){K=p.getLayoutValue("text-rotation-alignment",y);K===A.RotationAlignment.AUTO&&(K=p.getLayoutValue("symbol-placement",y)===A.SymbolPlacement.POINT?A.RotationAlignment.VIEWPORT:A.RotationAlignment.MAP);L=K===A.RotationAlignment.MAP;L=p.getLayoutValue("text-keep-upright",y)&&L;J=w===m.WGLDrawPhase.HITTEST;var X=.8*3/C;this._glyphTextureSize||(this._glyphTextureSize=F.fromValues(z.width/4,z.height/4));var Z=p.getPaintValue("text-translate",y),V=p.getPaintValue("text-translate-anchor",y),O=this._sdfProgramOptions;
O.id=J;var P=I.getMaterialProgram(v,k,O);if(H&&null!=G&&!P.compiled)G();else{v.useProgram(P);P.setUniformMatrix3fv("u_displayViewMat3",K===A.RotationAlignment.MAP?E.displayViewMat3:E.displayMat3);P.setUniformMatrix3fv("u_displayMat3",V===A.TranslateAnchor.VIEWPORT?E.displayMat3:E.displayViewMat3);P.setUniform2fv("u_textTranslation",Z);P.setUniform1f("u_depth",p.z+a);P.setUniform2fv("u_mosaicSize",this._glyphTextureSize);P.setUniform1f("u_mapRotation",h.degToByte(E.rotation));P.setUniform1f("u_keepUpright",
L?1:0);P.setUniform1f("u_level",10*y);P.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_GLYPHS);P.setUniform1f("u_antialiasingWidth",X);P.setUniform1f("u_fadeDuration",D.FADE_DURATION/1E3);J&&P.setUniform4fv("u_id",t);t=-1;for(const M of q)M.layerData.has(B)&&(M.key.level!==t&&(t=M.key.level,k.setDataUniforms(P,y,p,t,x)),K=M.layerData.get(B),0!==K.glyphPerPageElementsMap.size&&(K.prepareForRendering(v),K.updateOpacityInfo(),q=K.textVAO,null!=q&&(v.bindVAO(q),P.setUniformMatrix3fv("u_dvsMat3",
M.transforms.dvs),v.setStencilTestEnabled(!0),v.setStencilFunction(c.CompareFunction.GREATER,255,255),v.setStencilWriteMask(0),q=(performance.now()-K.lastOpacityUpdate)/1E3,P.setUniform1f("u_time",q),K.glyphPerPageElementsMap.forEach((Q,R)=>{this._renderGlyphRange(v,Q,R,z,P,W,S,M)}))))}}}};e._renderGlyphRange=function(k,p,q,t,v,y,w,z){t.bind(k,c.TextureSamplingMode.LINEAR,q,u.VTL_TEXTURE_BINDING_UNIT_GLYPHS);y&&(v.setUniform1f("u_halo",1),k.drawElements(c.PrimitiveType.TRIANGLES,p[1],c.DataType.UNSIGNED_INT,
Uint32Array.BYTES_PER_ELEMENT*p[0]),z.triangleCount+=p[1]/3);w&&(v.setUniform1f("u_halo",0),k.drawElements(c.PrimitiveType.TRIANGLES,p[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*p[0]),z.triangleCount+=p[1]/3)};return l._createClass(g)}(d);n.WGLBrushVTLSymbol=d;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(n){n.COLLISION_GRID_CELL_SIZE=32;n.DECLUTTER_BUDGET=1.5;n.DECLUTTER_TILES=
!0;n.FADE_DURATION=200;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(n){function l(u,m){u%=m;return 0<=u?u:u+m}const F=128/Math.PI,D=256/360,A=1/Math.LN2;n.between=function(u,m,h){return u>=m&&u<=h||u>=h&&u<=m};n.degToByte=function(u){return l(u*D,256)};n.interpolate=function(u,m,h){return u*(1-h)+m*h};n.log2=function(u){return Math.log(u)*A};n.positiveMod=l;n.radToByte=function(u){return l(u*F,256)};
Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../../../../webgl/enums".split(" "),function(n,l,F,D,A,u){return function(m){function h(){return m.apply(this,arguments)||this}n._inherits(h,m);var f=h.prototype;f.dispose=function(){};f.getGeometryType=function(){return l.WGLGeometryType.LABEL};f.supportsSymbology=
function(d){return!0};f.drawGeometry=function(d,c,a,b){const {context:g,painter:e,state:k,rendererInfo:p,requestRender:q,allowDelayedRender:t}=d,v=A.LabelMaterialKey.load(a.materialKey),y=v.mapAligned?1:0;if(y||!(1<=Math.abs(c.key.level-Math.round(100*d.displayLevel)/100))){var {bufferLayouts:w,attributes:z}=F.createProgramDescriptor(v.data,{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.SHORT},{location:1,name:"a_id",count:4,type:u.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,
type:u.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:u.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texAndSize",count:4,type:u.DataType.UNSIGNED_BYTE},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:u.DataType.UNSIGNED_BYTE},{location:6,name:"a_glyphData",count:4,type:u.DataType.UNSIGNED_BYTE},{location:7,name:"a_vertexOffset",count:2,type:u.DataType.SHORT},{location:8,name:"a_texCoords",count:2,type:u.DataType.UNSIGNED_SHORT}]});b=e.materialManager.getMaterialProgram(d,
v,"materials/label",z,b);if(t&&null!=q&&!b.compiled)q();else{d.context.setStencilFunction(u.CompareFunction.EQUAL,0,255);g.useProgram(b);this._setSharedUniforms(b,d,c);e.textureManager.bindTextures(g,b,v);var r=1===y?k.displayViewMat3:k.displayMat3;this._setSizeVVUniforms(v,b,p,c);b.setUniform1f("u_mapRotation",Math.floor(k.rotation/360*254));b.setUniform1f("u_mapAligned",y);b.setUniformMatrix3fv("u_displayMat3",r);b.setUniform1f("u_opacity",1);b.setUniform2fv("u_screenSize",d.state.size);d=a.target.getVAO(g,
w,z);c=a.indexFrom*Uint32Array.BYTES_PER_ELEMENT;g.bindVAO(d);b.setUniform1f("u_isHaloPass",0);b.setUniform1f("u_isBackgroundPass",1);g.drawElements(u.PrimitiveType.TRIANGLES,a.indexCount,u.DataType.UNSIGNED_INT,c);b.setUniform1f("u_isHaloPass",1);b.setUniform1f("u_isBackgroundPass",0);g.drawElements(u.PrimitiveType.TRIANGLES,a.indexCount,u.DataType.UNSIGNED_INT,c);b.setUniform1f("u_isHaloPass",0);b.setUniform1f("u_isBackgroundPass",0);g.drawElements(u.PrimitiveType.TRIANGLES,a.indexCount,u.DataType.UNSIGNED_INT,
c);g.setStencilTestEnabled(!0);g.setBlendingEnabled(!0)}}};return n._createClass(h)}(D)})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../../../../webgl/enums".split(" "),function(n,l,F,D,A,u){return function(m){function h(){return m.apply(this,arguments)||this}n._inherits(h,m);var f=h.prototype;f.dispose=function(){};f.getGeometryType=function(){return l.WGLGeometryType.LINE};
f.supportsSymbology=function(d){return!0};f.drawGeometry=function(d,c,a,b){const {context:g,painter:e,rendererInfo:k,displayLevel:p,passOptions:q,requestRender:t,allowDelayedRender:v}=d,y=A.LineMaterialKey.load(a.materialKey),w=null!=q&&"hittest"===q.type;var z=F.createProgramDescriptor(y.data,{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.SHORT},{location:1,name:"a_id",count:4,type:u.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:u.DataType.UNSIGNED_BYTE,normalized:!0},
{location:3,name:"a_offsetAndNormal",count:4,type:u.DataType.BYTE},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:u.DataType.UNSIGNED_SHORT},{location:5,name:"a_tlbr",count:4,type:u.DataType.UNSIGNED_SHORT},{location:6,name:"a_segmentDirection",count:4,type:u.DataType.BYTE},{location:7,name:"a_aux",count:2,type:u.DataType.UNSIGNED_SHORT},{location:8,name:"a_zoomRange",count:2,type:u.DataType.UNSIGNED_SHORT}]});let r=u.PrimitiveType.TRIANGLES;w&&(z=this._getTriangleDesc(a.materialKey,
z),r=u.PrimitiveType.POINTS);const {attributes:C,bufferLayouts:x}=z;b=e.materialManager.getMaterialProgram(d,y,"materials/line",C,b);v&&null!=t&&!b.compiled?t():(z=1/d.pixelRatio,g.useProgram(b),this._setSharedUniforms(b,d,c),y.textureBinding&&e.textureManager.bindTextures(g,b,y),b.setUniform1f("u_zoomFactor",2**(p-c.key.level)),b.setUniform1f("u_blur",0+z),b.setUniform1f("u_antialiasing",z),this._setSizeVVUniforms(y,b,k,c),this._setColorAndOpacityVVUniforms(y,b,k),g.setFaceCullingEnabled(!1),d=a.target.getVAO(g,
x,C,w),c=a.indexCount,a=a.indexFrom*Uint32Array.BYTES_PER_ELEMENT,w&&(c/=3,a/=3),g.bindVAO(d),g.drawElements(r,c,u.DataType.UNSIGNED_INT,a))};return n._createClass(h)}(D)})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey ../../../../webgl/enums".split(" "),function(n,l,F,D,A,u){return function(m){function h(){return m.apply(this,arguments)||this}n._inherits(h,
m);var f=h.prototype;f.dispose=function(){};f.getGeometryType=function(){return l.WGLGeometryType.TEXT};f.supportsSymbology=function(d){return!0};f.drawGeometry=function(d,c,a,b){const {context:g,painter:e,rendererInfo:k,state:p,passOptions:q,requestRender:t,allowDelayedRender:v}=d,y=A.TextMaterialKey.load(a.materialKey),w=null!=q&&"hittest"===q.type,{bufferLayouts:z,attributes:r}=F.createProgramDescriptor(y.data,{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.SHORT},{location:1,name:"a_id",
count:4,type:u.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:u.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:u.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:u.DataType.UNSIGNED_BYTE},{location:5,name:"a_aux",count:4,type:u.DataType.BYTE},{location:6,name:"a_zoomRange",count:2,type:u.DataType.UNSIGNED_SHORT},{location:7,name:"a_vertexOffset",count:2,type:u.DataType.SHORT},{location:8,name:"a_texCoords",count:2,
type:u.DataType.UNSIGNED_SHORT}]});b=e.materialManager.getMaterialProgram(d,y,"materials/text",r,b);if(v&&null!=t&&!b.compiled)t();else{g.useProgram(b);var C=u.PrimitiveType.TRIANGLES;w&&(C=u.PrimitiveType.POINTS);this._setSharedUniforms(b,d,c);e.textureManager.bindTextures(g,b,y);b.setUniformMatrix3fv("u_displayMat3",p.displayMat3);b.setUniformMatrix3fv("u_displayViewMat3",p.displayViewMat3);this._setSizeVVUniforms(y,b,k,c);this._setColorAndOpacityVVUniforms(y,b,k);this._setRotationVVUniforms(y,
b,k);d=a.target.getVAO(g,z,r);c=a.indexFrom*Uint32Array.BYTES_PER_ELEMENT;g.bindVAO(d);b.setUniform1f("u_isHaloPass",0);b.setUniform1f("u_isBackgroundPass",1);g.drawElements(C,a.indexCount,u.DataType.UNSIGNED_INT,c);b.setUniform1f("u_isHaloPass",1);b.setUniform1f("u_isBackgroundPass",0);g.drawElements(u.PrimitiveType.TRIANGLES,a.indexCount,u.DataType.UNSIGNED_INT,c);b.setUniform1f("u_isHaloPass",0);b.setUniform1f("u_isBackgroundPass",0);g.drawElements(C,a.indexCount,u.DataType.UNSIGNED_INT,c)}};return n._createClass(h)}(D)})},
"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../enums","./Programs"],function(n,l,F){return function(){function D(){this._programByKey=new Map}var A=D.prototype;A.dispose=function(){this._programByKey.forEach(u=>u.dispose());this._programByKey.clear()};A.getMaterialProgram=function(u,m,h){const f=m.key<<3|this._getMaterialOptionsValue(m.type,h);if(this._programByKey.has(f))return this._programByKey.get(f);var d=
this._getProgramTemplate(m.type);({shaders:d}=d);const {vertexShader:c,fragmentShader:a}=d(h);h=m.getShaderHeader();d=m.getShaderMain();h=c.replace("#pragma header",h).replace("#pragma main",d);u=u.programCache.acquire(h,a,m.getAttributeLocations());this._programByKey.set(f,u);return u};A._getMaterialOptionsValue=function(u,m){switch(u){case l.ShaderProgramType.BACKGROUND:return(m.pattern?1:0)<<1|(m.id?1:0);case l.ShaderProgramType.FILL:return(m.pattern?1:0)<<1|(m.id?1:0);case l.ShaderProgramType.OUTLINE:return m.id?
1:0;case l.ShaderProgramType.LINE:return(m.sdf?1:0)<<2|(m.pattern?1:0)<<1|(m.id?1:0);case l.ShaderProgramType.ICON:return(m.sdf?1:0)<<1|(m.id?1:0);case l.ShaderProgramType.CIRCLE:return m.id?1:0;case l.ShaderProgramType.TEXT:return m.id?1:0;default:return 0}};A._getProgramTemplate=function(u){switch(u){case l.ShaderProgramType.BACKGROUND:return F.background;case l.ShaderProgramType.CIRCLE:return F.circle;case l.ShaderProgramType.FILL:return F.fill;case l.ShaderProgramType.ICON:return F.icon;case l.ShaderProgramType.LINE:return F.line;
case l.ShaderProgramType.OUTLINE:return F.outline;case l.ShaderProgramType.TEXT:return F.text;default:return null}};return n._createClass(D)}()})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(n){n.BucketType=void 0;(function(l){l[l.FILL=1]="FILL";l[l.LINE=2]="LINE";l[l.SYMBOL=3]="SYMBOL";l[l.CIRCLE=4]="CIRCLE"})(n.BucketType||(n.BucketType={}));n.ShaderProgramType=void 0;(function(l){l[l.BACKGROUND=0]="BACKGROUND";l[l.FILL=1]="FILL";l[l.OUTLINE=2]="OUTLINE";l[l.LINE=
3]="LINE";l[l.ICON=4]="ICON";l[l.CIRCLE=5]="CIRCLE";l[l.TEXT=6]="TEXT";l[l.TILEINFO=7]="TILEINFO"})(n.ShaderProgramType||(n.ShaderProgramType={}));n.StyleUpdateType=void 0;(function(l){l[l.PAINTER_CHANGED=0]="PAINTER_CHANGED";l[l.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";l[l.LAYER_CHANGED=2]="LAYER_CHANGED";l[l.LAYER_REMOVED=3]="LAYER_REMOVED";l[l.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(n.StyleUpdateType||(n.StyleUpdateType={}));Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports",
"./sources/resolver","../../../../webgl/programUtils"],function(n,l,F){n.background={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern})+l.resolveIncludes("background/background.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern})+l.resolveIncludes("background/background.frag")})};n.circle={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id})+l.resolveIncludes("circle/circle.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id})+l.resolveIncludes("circle/circle.frag")})};
n.fill={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern})+l.resolveIncludes("fill/fill.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern})+l.resolveIncludes("fill/fill.frag")})};n.icon={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id,SDF:D.sdf})+l.resolveIncludes("icon/icon.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id,SDF:D.sdf})+l.resolveIncludes("icon/icon.frag")})};n.line={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern,
SDF:D.sdf})+l.resolveIncludes("line/line.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id,PATTERN:D.pattern,SDF:D.sdf})+l.resolveIncludes("line/line.frag")})};n.outline={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id})+l.resolveIncludes("outline/outline.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id})+l.resolveIncludes("outline/outline.frag")})};n.text={shaders:D=>({vertexShader:F.glslifyDefineMap({ID:D.id})+l.resolveIncludes("text/text.vert"),fragmentShader:F.glslifyDefineMap({ID:D.id})+
l.resolveIncludes("text/text.frag")})};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(n,l,F){const D=new F.ShaderCompiler(function(A){let u=l;A.split("/").forEach(m=>{u&&(u=u[m])});return u});n.resolveIncludes=function(A){return D.resolveIncludes(A)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./DefaultVertexAttributeLayouts ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/ProgramTemplate ../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f){let d=function(){function c(){this._initialized=!1}var a=c.prototype;a.dispose=function(){this._program=F.disposeMaybe(this._program);this._vertexArrayObject=F.disposeMaybe(this._vertexArrayObject)};a.render=function(b,g,e,k){b&&(this._initialized||this._initialize(b),b.setBlendFunctionSeparate(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA),b.bindVAO(this._vertexArrayObject),b.useProgram(this._program),g.setSamplingMode(e),
b.bindTexture(g,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",k),b.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4),b.bindTexture(null,0),b.bindVAO())};a._initialize=function(b){if(this._initialized)return!0;const g=h.createProgram(b,A.bitBlit);if(!g)return!1;const e=new Int8Array(16);e[0]=-1;e[1]=-1;e[2]=0;e[3]=0;e[4]=1;e[5]=-1;e[6]=1;e[7]=0;e[8]=-1;e[9]=1;e[10]=0;e[11]=1;e[12]=1;e[13]=1;e[14]=1;e[15]=1;b=new f.VertexArrayObject(b,A.bitBlit.attributes,D.PosTex2b,{geometry:u.BufferObject.createVertex(b,
m.Usage.STATIC_DRAW,e)});this._program=g;this._vertexArrayObject=b;return this._initialized=!0};return l._createClass(c)}();n.BitBlitRenderer=d;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(n,l){l={shaders:{vertexShader:l.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:l.resolveIncludes("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};n.bitBlit=
l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/MaterialManager":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./enums","./shaders/MaterialPrograms"],function(n,l,F){const D=({rendererInfo:u,drawPhase:m},h,f)=>`${h.getVariationHash()}-${(m===l.WGLDrawPhase.HITTEST||m===l.WGLDrawPhase.LABEL_ALPHA?1:0)|(m===l.WGLDrawPhase.HIGHLIGHT?2:0)}-${u.getVariationHash()}-${null!=f&&f.join(".")}`,A=(u,m,h,f={})=>{f={...f};m={...m.getVariation()};
var d={...u.rendererInfo.getVariation()},c=u.drawPhase;f={...f,...m,...d,highlight:u.drawPhase===l.WGLDrawPhase.HIGHLIGHT,id:c===l.WGLDrawPhase.HITTEST||c===l.WGLDrawPhase.LABEL_ALPHA};if(null!=h)for(const a of h)f[a]=!0;return f};return function(){function u(h){this._rctx=h;this._programByKey=new Map}var m=u.prototype;m.dispose=function(){this._programByKey.forEach(h=>h.dispose());this._programByKey.clear()};m.getProgram=function(h,f=[]){const d=h.vsPath+"."+h.fsPath+JSON.stringify(f);if(this._programByKey.has(d))return this._programByKey.get(d);
f={...f.map(g=>"string"===typeof g?{name:g,value:!0}:g).reduce((g,e)=>({...g,[e.name]:e.value}),{})};const {vsPath:c,fsPath:a,attributes:b}=h;h=F.createProgramTemplate(c,a,b,f);h=this._rctx.programCache.acquire(h.shaders.vertexShader,h.shaders.fragmentShader,h.attributes);if(!h)throw Error("Unable to get program for key: ${key}");this._programByKey.set(d,h);return h};m.getMaterialProgram=function(h,f,d,c,a){const b=D(h,f,a);if(this._programByKey.has(b))return this._programByKey.get(b);h=A(h,f,a,{ignoresSamplerPrecision:h.context.driverTest.ignoresSamplerPrecision.result});
d=F.createProgramTemplate(d,d,c,h);d=this._rctx.programCache.acquire(d.shaders.vertexShader,d.shaders.fragmentShader,d.attributes);if(!d)throw Error("Unable to get program for key: ${key}");this._programByKey.set(b,d);return d};return n._createClass(u)}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(n,l,F){n.createProgramTemplate=(D,A,u,m)=>{D+=D.substring(D.lastIndexOf("/"));A+=A.substring(A.lastIndexOf("/"));
const h={};for(const d in m){let c=void 0;var f=d;c=""+f[0].toUpperCase();for(let a=1;a<f.length;a++){const b=f[a];b===b.toUpperCase()?(c+="_",c+=b):c+=b.toUpperCase()}h[c]=m[d]}m=F.glslifyDefineMap(h);return{attributes:u,shaders:{vertexShader:m+l.resolveIncludes(`${D}.vert`),fragmentShader:m+l.resolveIncludes(`${A}.frag`)}}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../config ../../../../request ../../../../core/BidiText ../../../../core/Error ../../../../core/fontUtils ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./Utils ./animatedFormats/AnimatableTextureResource ./animatedFormats/utils ./util/Result ./util/symbolUtils ../../../support/QueueProcessor ../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w,z,r,C,x,E){function B(J,L){L=Math.round(c.pt2px(L)*window.devicePixelRatio);return Math.min(J,L*(128<=L?2:4))}const G=b.create(),H=h.getLogger("esri.views.2d.engine.webgl.TextureManager");let I=function(){function J(L,K,S){this.mosaicType=L;this.page=K;this.sdf=S}J.fromMosaic=function(L,K){return new J(L,K.page,K.sdf)};return n._createClass(J)}();return function(){function J(K,S,W){this._requestRender=K;this.resourceManager=S;this._allowNonPowerOfTwo=
W;this._invalidFontsMap=new Map;this._sdfConverter=new t(e.SDF_TEXTURE_SIZE);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._ongoingRasterizations=new Map;this._imageRequestQueue=new x.QueueProcessor({concurrency:10,process:async(X,Z)=>{d.throwIfAborted(Z);try{return await F(X,{responseType:"image",signal:Z})}catch(V){if(!d.isAbortError(V))throw new A("mapview-invalid-resource",`Could not fetch requested resource at ${X}`,V);throw V;}}});this._spriteMosaic=new v(2048,2048,500);this._glyphSource=
new q(`${l.fontsUrl}/{fontstack}/{range}.pbf`);this._glyphMosaic=new p(1024,1024,this._glyphSource);this._rasterizer=new g(S)}var L=J.prototype;L.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._sdfConverter.dispose();this._sdfConverter=this._glyphMosaic=this._spriteMosaic=null;this._hashToBindingIndex.clear();this._bindingInfos=this._hashToBindingIndex=null;this._ongoingRasterizations.clear();this._ongoingRasterizations=null;this._imageRequestQueue.clear();
this._imageRequestQueue=null};L.rasterizeItem=async function(K,S,W,X){if(null==K)return H.error(new A("mapview-null-resource","Unable to rasterize null resource",void 0)),null;switch(K.type){case "text":case "esriTS":return K=await this._rasterizeText(K,W,X),K.forEach(Z=>this._setTextureBinding(k.MosaicType.GLYPH,Z)),{glyphMosaicItems:K};default:if(y.is3D(K))return H.error(new A("mapview-invalid-type",`MapView does not support symbol type: ${K.type}`,K)),null;K=await this._rasterizeSpriteSymbol(K,
S,X);r.ok(K)&&K&&this._setTextureBinding(k.MosaicType.SPRITE,K);return{spriteMosaicItem:K}}};L.bindTextures=function(K,S,W,X=!1){if(0!==W.textureBinding){var Z=this._bindingInfos[W.textureBinding-1];W=Z.page;X=X?E.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:E.TextureSamplingMode.LINEAR;switch(Z.mosaicType){case k.MosaicType.SPRITE:Z=this.sprites.getWidth(W);const V=this.sprites.getHeight(W);Z=a.set(G,Z,V);this._spriteMosaic.bind(K,X,W,e.TEXTURE_BINDING_SPRITE_ATLAS);S.setUniform1i("u_texture",e.TEXTURE_BINDING_SPRITE_ATLAS);
S.setUniform2fv("u_mosaicSize",Z);break;case k.MosaicType.GLYPH:Z=a.set(G,this.glyphs.width,this.glyphs.height);this._glyphMosaic.bind(K,X,W,e.TEXTURE_BINDING_GLYPH_ATLAS);S.setUniform1i("u_texture",e.TEXTURE_BINDING_GLYPH_ATLAS);S.setUniform2fv("u_mosaicSize",Z);break;default:H.error("mapview-texture-manager",`Cannot handle unknown type ${Z.mosaicType}`)}}};L._hashMosaic=function(K,S){return 1|K<<1|(S.sdf?1:0)<<2|S.page<<3};L._setTextureBinding=function(K,S){const W=this._hashMosaic(K,S);this._hashToBindingIndex.has(W)||
(K=I.fromMosaic(K,S),this._hashToBindingIndex.set(W,this._bindingInfos.length+1),this._bindingInfos.push(K));S.textureBinding=this._hashToBindingIndex.get(W)};L._rasterizeText=async function(K,S,W){let X,Z;X="cim"in K?K.fontName:u.getFullyQualifiedFontName(K.font);Z=K.text;K=this._invalidFontsMap.has(X);S=S||y.charCodes(D.bidiText(Z)[0]);try{return K=K?"arial-unicode-ms-regular":X,m("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(K),await this._glyphMosaic.getGlyphItems(K,
S,W)}catch(V){return H.error(new A("mapview-invalid-resource",`Couldn't find font ${X}. Falling back to Arial Unicode MS Regular`,void 0)),this._invalidFontsMap.set(X,!0),this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",S,W)}};L._rasterizeSpriteSymbol=async function(K,S,W){if(!y.isSimple(K)){S=C.keyFromSymbol(K);if(this._spriteMosaic.has(S))return this._spriteMosaic.getSpriteItem(S);if(y.isSVGResource(K)||y.isImageResource(K)&&!y.isMarkerPlacementInsidePolygon(K))return this._handleAsyncResource(S,
K,W);if(W=this._rasterizer.rasterizeJSONResource(K,e.PATTERN_FILL_RASTERIZATION_SCALE)){const {size:X,image:Z,sdf:V,simplePattern:O,rasterizationScale:P}=W;return this._addItemToMosaic(S,X,{type:"static",data:Z},y.shouldRepeat(K),V,O,P)}return new A("TextureManager","unrecognized or null rasterized image")}};L._handleAsyncResource=async function(K,S,W){if(this._ongoingRasterizations.has(K))return this._ongoingRasterizations.get(K);S=y.isSVGResource(S)?this._handleSVG(S,K,W):this._handleImage(S,K,
W);this._ongoingRasterizations.set(K,S);try{await S,this._ongoingRasterizations.delete(K)}catch{this._ongoingRasterizations.delete(K)}return S};L._handleSVG=async function(K,S,W){const X=[e.SDF_TEXTURE_SIZE,e.SDF_TEXTURE_SIZE];K=await this._sdfConverter.draw(K.path,W);return this._addItemToMosaic(S,X,{type:"static",data:new Uint32Array(K.buffer)},!1,!0,!0)};L._handleGIFOrPNG=async function(K,S,W){var X=y.getUrl(K);await this.resourceManager.fetchResource(X,W);W=this.resourceManager.getResource(X);
if(null==W)return new A("mapview-invalid-resource",`Could not fetch requested resource at ${X}.`);X=W.width;let Z=W.height;if(W instanceof HTMLImageElement){"esriPMS"===K.type&&(X=Math.round(B(W.width,y.getPMSResourceSize(K))),Z=Math.round(X/W.width*W.height));const {size:V,sdf:O,image:P}=this._rasterizer.rasterizeImageResource(X,Z,W,"cim"in K?K.cim.colorSubstitutions:void 0);return this._addItemToMosaic(S,V,{type:"static",data:P},y.shouldRepeat(K),O,!1)}this._allowNonPowerOfTwo||(X=f.nextPowerOfTwo(W.width+
2*e.SPRITE_PADDING)-2*e.SPRITE_PADDING,Z=f.nextPowerOfTwo(W.height+2*e.SPRITE_PADDING)-2*e.SPRITE_PADDING);if(X!==W.width||Z!==W.height)W=z.resize(W,X,Z);W=new w.AnimatableTextureResource(W,this._requestRender,K.animatedSymbolProperties||{},K.objectId);return this._addItemToMosaic(S,[W.width,W.height],{type:"animated",data:W},y.shouldRepeat(K),!1,!1)};L._handleImage=async function(K,S,W){if(y.isGIF(K)||y.isPNG(K))return this._handleGIFOrPNG(K,S,W);const X=y.getUrl(K);try{let Z;const V=this.resourceManager.getResource(X);
if(null!=V&&V instanceof HTMLImageElement)Z=V;else{const {data:aa}=await this._imageRequestQueue.push(X,{...W});Z=aa}if(y.isSVGImage(X))if("width"in K&&"height"in K)Z.width=c.pt2px(K.width),Z.height=c.pt2px(K.height);else if("cim"in K){const aa=K.cim;Z.width=c.pt2px(aa.width??aa.scaleX*aa.size);Z.height=c.pt2px(aa.size)}if(!Z.width||!Z.height)return null;let O=Z.width,P=Z.height;"esriPMS"===K.type&&(O=Math.round(B(Z.width,y.getPMSResourceSize(K))),P=Math.round(O/Z.width*Z.height));const {size:M,sdf:Q,
image:R}=this._rasterizer.rasterizeImageResource(O,P,Z,"cim"in K?K.cim.colorSubstitutions:void 0);return this._addItemToMosaic(S,M,{type:"static",data:R},y.shouldRepeat(K),Q,!1)}catch(Z){if(!d.isAbortError(Z))return new A("mapview-invalid-resource",`Could not fetch requested resource at ${X}. ${Z.message}`)}};L._addItemToMosaic=function(K,S,W,X,Z,V,O){return this._spriteMosaic.addSpriteItem(K,S,W,X,Z,V,O)};n._createClass(J,[{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}}]);
return J}()})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(n,l){const F=new l;n.bidiText=function(D){if(null==D)return["",!1];if(!F.hasBidiChar(D))return[D,!1];let A;A="rtl"===F.checkContextual(D)?"IDNNN":"ICNNN";return[F.bidiTransform(D,A,"VLYSN"),!0]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["../chunks/_rollupPluginBabelHelpers","./bidiEngineTables"],function(n,l){function F(z,r,C,x,E){var B=z;void 0===
r&&(r=E.defInFormat);void 0===C&&(C=E.defOutFormat);void 0===x&&(x=E.defSwap);if(r!==C){var G=r.substring(0,1),H=C.substring(0,1);var I=r.substring(1,4);var J=C.substring(1,4);"C"===I.charAt(0)&&(I=D(B),I="ltr"===I||"rtl"===I?I.toUpperCase():"L"===r.charAt(2)?"LTR":"RTL",r=G+I);"C"===J.charAt(0)&&(I=D(B),"rtl"===I?J="RTL":"ltr"===I?(B=B.split(""),B.reverse(),I=D(B.join("")),J=I.toUpperCase()):J="L"===C.charAt(2)?"LTR":"RTL",C=H+J)}if(r===C)return z;H=r.substring(0,1);B=r.substring(1,4);G=C.substring(0,
1);J=C.substring(1,4);E.inFormat=r;E.outFormat=C;E.swap=x;if("L"===H&&"VLTR"===C){if("LTR"===B)return E.dir=0,A(z,E);if("RTL"===B)return E.dir=1,A(z,E)}if("V"===H&&"V"===G)return E.dir="RTL"===B?1:0,m(z,E);if("L"===H&&"VRTL"===C)return E.dir="LTR"===B?0:1,z=A(z,E),m(z);if("VLTR"===r&&"LLTR"===C)return E.dir=0,A(z,E);if("V"===H&&"L"===G&&B!==J)return z=m(z),"RTL"===B?F(z,"LLTR","VLTR",x,E):F(z,"LRTL","VRTL",x,E);if("VRTL"===r&&"LRTL"===C)return F(z,"LRTL","VRTL",x,E);"L"===H&&"L"===G&&(r=E.swap,E.swap=
r.substr(0,1)+"N","RTL"===B?(E.dir=1,z=A(z,E),E.swap="N"+r.substr(1,2),E.dir=0,z=A(z,E)):(E.dir=0,z=A(z,E),E.swap="N"+r.substr(1,2),z=F(z,"VLTR","LRTL",E.swap,E)));return z}function D(z){return(z=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(z))?"z">=z[0]?"ltr":"rtl":""}function A(z,r){z=z.split("");const C=[];u(z,C,r);if(0!==r.hiLevel&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let B=0;B<z.length;B++)if(1===C[B]){var x=B;b:{let G=void 0;var E=z[B];let H=0,I=l.SwapTable.length-
1;for(;H<=I;)if(G=Math.floor((H+I)/2),E<l.SwapTable[G][0])I=G-1;else if(E>l.SwapTable[G][0])H=G+1;else{E=l.SwapTable[G][1];break b}}z[x]=E}d(2,z,C,r);d(1,z,C,r);t=C;return z.join("")}function u(z,r,C){const x=z.length;var E=C.dir?l.impTabRtl:l.impTabLtr,B=0,G=-1;const H=[],I=[];C.hiLevel=C.dir;C.lastArabic=!1;C.hasUbatAl=!1;C.hasUbatB=!1;C.hasUbatS=!1;for(var J=0;J<x;J++){var L=J,K=z[J].charCodeAt(0);const S=l.PrimaryTable[K>>8];H[L]=S<l.TBBASE?S:l.UnicodeTable[S-l.TBBASE][K&255]}for(L=0;L<x;L++){J=
c(z,H,I,L,C);I[L]=J;B=E[B][J];K=B&240;B&=15;J=E[B][5];r[L]=J;if(0<K){if(16===K)for(;G<L;G++)r[G]=1;G=-1}if(E[B][6])-1===G&&(G=L);else if(-1<G){for(;G<L;G++)r[G]=J;G=-1}H[L]===l.UBAT_B&&(r[L]=0);C.hiLevel|=J}if(C.hasUbatS)for(z=0;z<x;z++)if(H[z]===l.UBAT_S)for(r[z]=C.dir,E=z-1;0<=E;E--)if(H[E]===l.UBAT_WS)r[E]=C.dir;else break}function m(z,r){z=z.split("");if(r){const C=[];u(z,C,r);t=C}z.reverse();p.reverse();return z.join("")}function h(z){for(let r=0;r<l.ArabicAlefBetIntervalsBegine.length;r++)if(z>=
l.ArabicAlefBetIntervalsBegine[r]&&z<=l.ArabicAlefBetIntervalsEnd[r])return!0;return!1}function f(z,r,C,x){for(;r*C<x&&b(z[r]);)r+=C;return r*C<x&&h(z[r])?!0:!1}function d(z,r,C,x){if(!(x.hiLevel<z))if(1!==z||1!==x.dir||x.hasUbatB){x=r.length;for(var E=0,B,G,H;E<x;){if(C[E]>=z){for(B=E+1;B<x&&C[B]>=z;)B++;for(G=B-1;E<G;E++,G--)H=r[E],r[E]=r[G],r[G]=H,H=p[E],p[E]=p[G],p[G]=H;E=B}E++}}else r.reverse(),p.reverse()}function c(z,r,C,x,E){return{UBAT_L:()=>{E.lastArabic=!1;return l.UBAT_L},UBAT_R:()=>{E.lastArabic=
!1;return l.UBAT_R},UBAT_ON:()=>l.UBAT_ON,UBAT_AN:()=>l.UBAT_AN,UBAT_EN:()=>E.lastArabic?l.UBAT_AN:l.UBAT_EN,UBAT_AL:()=>{E.lastArabic=!0;E.hasUbatAl=!0;return l.UBAT_R},UBAT_WS:()=>l.UBAT_ON,UBAT_CS:()=>{let B,G;if(1>x||x+1>=r.length||(B=C[x-1])!==l.UBAT_EN&&B!==l.UBAT_AN||(G=r[x+1])!==l.UBAT_EN&&G!==l.UBAT_AN)return l.UBAT_ON;E.lastArabic&&(G=l.UBAT_AN);return G===B?G:l.UBAT_ON},UBAT_ES:()=>(0<x?C[x-1]:l.UBAT_B)===l.UBAT_EN&&x+1<r.length&&r[x+1]===l.UBAT_EN?l.UBAT_EN:l.UBAT_ON,UBAT_ET:()=>{if(0<
x&&C[x-1]===l.UBAT_EN)return l.UBAT_EN;if(E.lastArabic)return l.UBAT_ON;let B=x+1;const G=r.length;for(;B<G&&r[B]===l.UBAT_ET;)B++;return B<G&&r[B]===l.UBAT_EN?l.UBAT_EN:l.UBAT_ON},UBAT_NSM:()=>{if("VLTR"===E.inFormat){for(var B=r.length,G=x+1;G<B&&r[G]===l.UBAT_NSM;)G++;if(G<B&&(B=z[x].charCodeAt(0),G=r[G],(1425<=B&&2303>=B||64286===B)&&(G===l.UBAT_R||G===l.UBAT_AL)))return l.UBAT_R}return 1>x||r[x-1]===l.UBAT_B?l.UBAT_ON:C[x-1]},UBAT_B:()=>{E.lastArabic=!0;E.hasUbatB=!0;return E.dir},UBAT_S:()=>
{E.hasUbatS=!0;return l.UBAT_ON},UBAT_LRE:()=>{E.lastArabic=!1;return l.UBAT_ON},UBAT_RLE:()=>{E.lastArabic=!1;return l.UBAT_ON},UBAT_LRO:()=>{E.lastArabic=!1;return l.UBAT_ON},UBAT_RLO:()=>{E.lastArabic=!1;return l.UBAT_ON},UBAT_PDF:()=>{E.lastArabic=!1;return l.UBAT_ON},UBAT_BN:()=>l.UBAT_ON}[l.TYPES_NAMES[r[x]]]()}function a(z,r){for(let C=0;C<l.BaseForm.length;C++)if(z===l.BaseForm[C])return r[C];return z}function b(z){return"\u064b"<=z&&"\u0655">=z}function g(z){return"L"===z?"LTR":"R"===z?"RTL":
"C"===z?"CLR":"D"===z?"CRL":""}function e(z,r){for(let C=0;C<l.AlefTable.length;C++)if(z===l.AlefTable[C])return r[C];return z}function k(z,r,C,x){for(let E=0;E<z.length;E++)if(z[E]>r||!C&&z[E]===r)z[E]+=x}let p=[],q=[],t=[];const v={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},y=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,w=/[\u0591-\u06ff\ufb1d-\ufefc]/;return function(){function z(){this.inputFormat=
"ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}var r=z.prototype;r.bidiTransform=function(C,x,E){this.sourceToTarget=[];this.targetToSource=[];if(!C)return"";var B=this.sourceToTarget,G=this.targetToSource,H=C.length;p=[];t=[];for(var I=0;I<H;I++)B[I]=I,G[I]=I,p[I]=I;if(!this.checkParameters(x,E))return C;x=this.inputFormat;E=this.outputFormat;B=C;H=g(x.charAt(1));B=g(E.charAt(1));I="I"===x.charAt(0)?"L":x.charAt(0);G="I"===E.charAt(0)?"L":E.charAt(0);
H=I+H;B=G+B;G=x.charAt(2)+E.charAt(2);v.defInFormat=H;v.defOutFormat=B;v.defSwap=G;C=F(C,H,B,G,v);B=!1;if("R"===E.charAt(1))B=!0;else if("C"===E.charAt(1)||"D"===E.charAt(1))B="rtl"===this.checkContextual(C);G=this.sourceToTarget=p;H=Array(G.length);for(I=0;I<G.length;I++)H[G[I]]=I;q=this.targetToSource=H;if(x.charAt(3)===E.charAt(3))B=C;else if("S"===E.charAt(3))if(x=B,E=!0,0===C.length)B="";else{void 0===x&&(x=!0);void 0===E&&(E=!0);C=String(C);C=C.split("");H=0;B=1;G=C.length;x||(H=C.length-1,
B=-1,G=1);var J=H;H=E;var L=0;I=[];for(var K=0;J*B<G;J+=B)if(h(C[J])||b(C[J])){var S;if(S="\u0644"===C[J])b:{for(var W=C,X=J+B,Z=B,V=G;X*Z<V&&b(W[X]);)X+=Z;S=" ";if(X*Z<V)for(S=W[X],W=0;W<l.AlefTable.length;W++)if(l.AlefTable[W]===S){S=!0;break b}S=!1}if(S){C[J]=0===L?e(C[J+B],l.LamAlefInialTableFE):e(C[J+B],l.LamAlefMedialTableFE);J+=B;L=C;S=J;W=B;for(X=G;S*W<X&&b(L[S]);)S+=W;S*W<X&&(L[S]=" ");H&&(I[K]=J,K++);L=0}else{S=C[J];if(1===L){W=J;if(f(C,J+B,B,G))b:for(X=C[J],Z=0;Z<l.BaseForm.length;Z++){if(X===
l.BaseForm[Z]){X=l.MedialForm[Z];break b}}else X=a(C[J],l.FinalForm);C[W]=X}else!0===f(C,J+B,B,G)?C[J]=a(C[J],l.InitialForm):C[J]=a(C[J],l.IsolatedForm);b(S)||(L=1);b:{for(W=0;W<l.StandAlonForm.length;W++)if(l.StandAlonForm[W]===S){S=!0;break b}S=!1}!0===S&&(L=0)}}else L=0;B=I;G="";for(H=0;H<C.length;H++){if(I=E){b:{for(I=0;I<B.length;I++)if(B[I]===H)break b;I=-1}I=-1<I}I?(k(q,H,!x,-1),p.splice(H,1)):G+=C[H]}B=G}else if(x=C,E=B,C=!0,0===x.length)B="";else for(void 0===C&&(C=!0),void 0===E&&(E=!0),
x=String(x),B="",G=x.split(""),H=0;H<x.length;H++)I=!1,"\ufe70"<=G[H]&&"\ufeff">G[H]?(K=x.charCodeAt(H),"\ufef5"<=G[H]&&"\ufefc">=G[H]?(E?(0<H&&C&&" "===G[H-1]?B=B.substring(0,B.length-1)+"\u0644":(B+="\u0644",I=!0),B+=l.AlefTable[(K-65269)/2]):(B+=l.AlefTable[(K-65269)/2],B+="\u0644",H+1<x.length&&C&&" "===G[H+1]?H++:I=!0),I&&(k(q,H,!0,1),p.splice(H,0,p[H]))):B+=l.FETo06Table[K-65136]):B+=G[H];this.sourceToTarget=p;this.targetToSource=q;this.levels=t;return B};r._inputFormatSetter=function(C){if(!y.test(C))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=C};r._outputFormatSetter=function(C){if(!y.test(C))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=C};r.checkParameters=function(C,x){C?this._inputFormatSetter(C):C=this.inputFormat;x?this._outputFormatSetter(x):x=this.outputFormat;return C===x?!1:!0};r.checkContextual=function(C){C=D(C);if("ltr"!==C&&"rtl"!==C){try{C=document.dir.toLowerCase()}catch(x){}"ltr"!==C&&"rtl"!==C&&(C="ltr")}return C};r.hasBidiChar=function(C){return w.test(C)};
return n._createClass(z)}()})},"esri/core/bidiEngineTables":function(){define(["exports"],function(n){n.AlefTable=["\u0622","\u0623","\u0625","\u0627"];n.ArabicAlefBetIntervalsBegine=["\u0621","\u0641"];n.ArabicAlefBetIntervalsEnd=["\u063a","\u064a"];n.BaseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");
n.FETo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
n.FinalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");n.InitialForm="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");
n.IsolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");n.LamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];n.LamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];n.MedialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");
n.PrimaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,
4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];n.StandAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");n.SwapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59",
"\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];n.TBBASE=100;n.TYPES_NAMES="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");n.UBAT_AL=7;n.UBAT_AN=3;n.UBAT_B=5;n.UBAT_BN=18;n.UBAT_CS=9;n.UBAT_EN=2;n.UBAT_ES=10;n.UBAT_ET=11;n.UBAT_L=0;n.UBAT_LRE=13;n.UBAT_LRO=16;n.UBAT_NSM=12;n.UBAT_ON=
4;n.UBAT_PDF=15;n.UBAT_R=1;n.UBAT_RLE=14;n.UBAT_RLO=17;n.UBAT_S=6;n.UBAT_WS=8;n.UnicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,
4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,
12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,
4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,
4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,
12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,
4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];n.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];n.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rasterizer":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/mathUtils ./CIMSymbolHelper ./rasterizingUtils ./Rect ./SDFHelper ./utils".split(" "),function(n,l,F,D,A,
u,m){return function(){function h(d){this._resourceManager=d;this._rasterizationCanvas=null}var f=h.prototype;f.dispose=function(){this._rasterizationCanvas=null};f.rasterizeJSONResource=function(d,c,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===d.type||"esriSFS"===d.type){const [w,z,r]=D.rasterizeSimpleFill(this._rasterizationCanvas,d.style,c);return{size:[z,r],image:new Uint32Array(w.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,
rasterizationScale:l.nextPowerOfTwo(Math.ceil(c))}}if("simple-line"===d.type||"esriSLS"===d.type||"line"===d.type&&d.dashTemplate){if("simple-line"===d.type||"esriSLS"===d.type)switch(c=F.slsDashToTemplateArray(d.style,d.cap),d.cap){case "butt":d="Butt";break;case "square":d="Square";break;default:d="Round"}else c=d.dashTemplate,d=d.cim.capStyle;const [w,z,r]=D.rasterizeDash(c,d);return{size:[z,r],image:new Uint32Array(w.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let b,g=null,e=null,k=1;
"simple-marker"===d.type||"esriSMS"===d.type||"line-marker"===d.type?(b=F.CIMSymbolHelper.fromSimpleMarker(d),e=u.getSDFInfo(b)):d.cim&&"CIMHatchFill"===d.cim.type?(b=F.CIMSymbolHelper.fromCIMHatchFill(d.cim,c),g=new A(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-b.frame.ymin),k=c):d.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===d.cim.markerPlacement.type?(b=F.CIMSymbolHelper.fromCIMInsidePolygon(d.cim),g=new A(b.frame.xmin,-b.frame.ymax,b.frame.xmax-b.frame.xmin,b.frame.ymax-
b.frame.ymin)):(b=d.cim,d.avoidSDFRasterization||(e=u.getSDFInfo(b)));if(e&&!a){const [w,z,r]=u.buildSDF(e);return w?{size:[z,r],image:new Uint32Array(w.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:k}:null}const [p,q,t,v,y]=F.CIMSymbolHelper.rasterize(this._rasterizationCanvas,b,g,this._resourceManager,!a);return p?{size:[q,t],image:new Uint32Array(p.buffer),sdf:!1,simplePattern:!1,anchorX:v,anchorY:y}:null};f.rasterizeImageResource=function(d,c,a,b){this._rasterizationCanvas||
(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=d;this._rasterizationCanvas.height=c;var g=this._rasterizationCanvas.getContext("2d");a instanceof ImageData?g.putImageData(a,0,0):(a.setAttribute("width",`${d}px`),a.setAttribute("height",`${c}px`),g.drawImage(a,0,0,d,c));a=g.getImageData(0,0,d,c);a=new Uint8Array(a.data);if(b)for(var e of b)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const [k,p,q,t]=e.oldColor,[v,y,w,z]=e.newColor;
if(k!==v||p!==y||q!==w||t!==z)for(b=0;b<a.length;b+=4)k===a[b]&&p===a[b+1]&&q===a[b+2]&&t===a[b+3]&&(a[b]=v,a[b+1]=y,a[b+2]=w,a[b+3]=z)}for(b=0;b<a.length;b+=4)e=a[b+3]/255,a[b]*=e,a[b+1]*=e,a[b+2]*=e;g=a;e=d;b=c;if(512<=e||512<=b){g=e/b;1<g?(e=512,b=Math.round(512/g)):(b=512,e=Math.round(512*g));g=new Uint8Array(4*e*b);const k=new Uint8ClampedArray(g.buffer);m.resampleHermite(a,d,c,k,e,b,!1)}return{size:[e,b],image:new Uint32Array(g.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return n._createClass(h)}()})},
"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/BidiText ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../support/arcadeOnDemand ./CIMPlacements ./CIMSymbolDrawHelper ./enums ./utils ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../Font".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y){function w(P,M,Q){switch(M.type){case "CIMSymbolReference":return w(P,M.symbol,Q);case "CIMPointSymbol":null==Q&&(Q={x:0,y:0});P.drawSymbol(M,Q);break;case "CIMLineSymbol":null==Q&&(Q={paths:[[[0,0],[10,0]]]});P.drawSymbol(M,Q);break;case "CIMPolygonSymbol":null==Q&&(Q={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});P.drawSymbol(M,Q);break;case "CIMTextSymbol":P.drawSymbol(M,{x:0,y:0});break;case "CIMVectorMarker":Q=new b.Placement,P.drawMarker(M,
Q)}return P.envelope()}function z(P){if(!P)return 0;switch(P.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(P.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(P.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(P.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(P.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(P.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(P.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(P.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function r(P){if(!P)return 0;switch(P.type){case "CIMGeometricEffectArrow":return Math.abs(.5*P.width);case "CIMGeometricEffectBuffer":return Math.abs(P.size);case "CIMGeometricEffectExtension":return Math.abs(P.length);case "CIMGeometricEffectJog":return Math.abs(.5*P.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(k.getValue(P.offsetX)),Math.abs(k.getValue(P.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(P.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(P.offset);case "CIMGeometricEffectRadial":return Math.abs(P.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(P.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(P.fromWidth),Math.abs(P.toWidth));case "CIMGeometricEffectWave":return Math.abs(P.amplitude);case "CIMGeometricEffectDonut":return Math.abs(P.width);
default:return 0}}function C(P){if(!P)return 0;let M=0;for(const Q of P)M+=r(Q);return M}function x(P,M,Q){P.effects&&null==M.geometryEngine&&(M.geometryEnginePromise?Q.push(M.geometryEnginePromise):k.isGeometryEngineRequired(P.effects)&&(M.geometryEnginePromise=k.importGeometryEngine(),Q.push(M.geometryEnginePromise),M.geometryEnginePromise.then(R=>M.geometryEngine=R)))}function E(P){if(!P)return null;let M=null;const {cap:Q,color:R,join:aa,miterLimit:ba,style:N,width:T}=P;"solid"!==N&&"none"!==
N&&"esriSLSSolid"!==N&&"esriSLSNull"!==N&&(M=[{type:"CIMGeometricEffectDashes",dashTemplate:V(N,Q),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==N&&"none"!==N?Z(R):[0,0,0,0],capStyle:K(Q),joinStyle:S(aa),miterLimit:ba,width:T,effects:M}}const B=Math.PI,G=B/2,H=Math.PI/180,I=96/72,J=m.getLogger("esri.symbols.cim.CIMSymbolHelper");D=function(){function P(){}var M=P.prototype;M.getSymbolInflateSize=function(Q,R,aa,ba,N){Q||(Q=[0,
0,0,0]);return R?this._getInflateSize(Q,R,aa,ba,N):Q};P.safeSize=function(Q){const R=Math.max(Math.abs(Q[0]),Math.abs(Q[2]));Q=Math.max(Math.abs(Q[1]),Math.abs(Q[3]));return Math.sqrt(R*R+Q*Q)};M._vectorMarkerBounds=function(Q,R,aa,ba){let N=!0;const T=d.create();if(R&&R.markerGraphics)for(const U of R.markerGraphics)R=[0,0,0,0],U.geometry&&(c.getBoundsXY(T,U.geometry),R[0]=0,R[1]=0,R[2]=0,R[3]=0,this.getSymbolInflateSize(R,U.symbol,aa,0,ba),T[0]+=R[0],T[1]+=R[1],T[2]+=R[2],T[3]+=R[3],N?(Q[0]=T[0],
Q[1]=T[1],Q[2]=T[2],Q[3]=T[3],N=!1):(Q[0]=Math.min(Q[0],T[0]),Q[1]=Math.min(Q[1],T[1]),Q[2]=Math.max(Q[2],T[2]),Q[3]=Math.max(Q[3],T[3])));return Q};M._getInflateSize=function(Q,R,aa,ba,N){return void 0!==R.symbolLayers?(Q=this._getLayersInflateSize(Q,R.symbolLayers,aa,ba,N),R=C(R.effects),0<R&&(Q[0]-=R,Q[1]-=R,Q[2]+=R,Q[3]+=R),Q):this._getTextInflatedSize(Q,R,N)};M._getLayersInflateSize=function(Q,R,aa,ba,N){let T=!0;if(!R)return Q;for(const fa of R)if(fa){R=[0,0,0,0];switch(fa.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var U=
fa,Y=U.width;null!=Y&&(Y=U.capStyle===e.LineCapStyle.Square||U.joinStyle===e.LineJoinStyle.Miter?Y/1.4142135623730951:Y/2,R[0]=-Y,R[1]=-Y,R[2]=Y,R[3]=Y);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":U=fa;if("CIMVectorMarker"===fa.type){if(Y=fa,R=this._vectorMarkerBounds(R,Y,aa,N),Y.frame){var ca=(Y.frame.xmin+Y.frame.xmax)/2,da=(Y.frame.ymin+Y.frame.ymax)/2;R[0]-=ca;R[1]-=da;R[2]-=ca;R[3]-=da;null!=Y.size&&(Y=Y.size/(Y.frame.ymax-Y.frame.ymin),R[0]*=Y,R[1]*=Y,R[2]*=
Y,R[3]*=Y)}}else"CIMPictureMarker"===fa.type?(Y=fa,da=aa.getResource(Y.url),ca=1,null!=da&&da.height&&(ca=da.width/da.height),null!=U.size&&(R=U.size/2,Y=U.size*ca*Y.scaleX/2,R=[-Y,-R,Y,R])):null!=U.size&&(R=U.size/2,R=[-R,-R,R,R]);U.anchorPoint&&("Absolute"===U.anchorPointUnits?(Y=U.anchorPoint.x,ca=U.anchorPoint.y):(Y=U.anchorPoint.x*(R[2]-R[0]),ca=U.anchorPoint.y*(R[3]-R[1])),R[0]-=Y,R[1]-=ca,R[2]-=Y,R[3]-=ca);Y=k.getValue(U.rotation);U.rotateClockwise&&(Y=-Y);ba&&(Y-=ba);Y&&(ca=H*Y,Y=Math.cos(ca),
ca=Math.sin(ca),da=d.create([q.C_INFINITY,q.C_INFINITY,-q.C_INFINITY,-q.C_INFINITY]),d.expandPointInPlace(da,[R[0]*Y-R[1]*ca,R[0]*ca+R[1]*Y]),d.expandPointInPlace(da,[R[0]*Y-R[3]*ca,R[0]*ca+R[3]*Y]),d.expandPointInPlace(da,[R[2]*Y-R[1]*ca,R[2]*ca+R[1]*Y]),d.expandPointInPlace(da,[R[2]*Y-R[3]*ca,R[2]*ca+R[3]*Y]),R=da);Y=k.getValue(U.offsetX);ca=k.getValue(U.offsetY);if(ba){var ea=H*ba;da=Math.cos(ea);ea=Math.sin(ea);const ja=Y*ea+ca*da;Y=Y*da-ca*ea;ca=ja}R[0]+=Y;R[1]+=ca;R[2]+=Y;R[3]+=ca;U=z(U.markerPlacement);
0<U&&(R[0]-=U,R[1]-=U,R[2]+=U,R[3]+=U)}U=C(fa.effects);0<U&&(R[0]-=U,R[1]-=U,R[2]+=U,R[3]+=U);T?(Q[0]=R[0],Q[1]=R[1],Q[2]=R[2],Q[3]=R[3],T=!1):(Q[0]=Math.min(Q[0],R[0]),Q[1]=Math.min(Q[1],R[1]),Q[2]=Math.max(Q[2],R[2]),Q[3]=Math.max(Q[3],R[3]))}return Q};M._getTextInflatedSize=function(Q,R,aa){const ba=R.height??g.DEFAULT_TEXT_HEIGHT;Q[0]=-ba/2;Q[1]=-ba/2;Q[2]=ba/2;Q[3]=ba/2;if(!aa)return Q;aa=aa.get(R);if(!aa)return Q;const {text:N,mosaicItem:T}=aa;if(!T?.glyphMosaicItems?.length)return Q;const {lineGapType:U,
lineGap:Y}=R;aa=U?g.lineGapType2LineHeight(U,Y??0,ba):0;const ca=A.bidiText(N)[1],da="CIMBackgroundCallout"===R.callout?.type;R=v.shapeGlyphs(T.glyphMosaicItems,ca,{scale:ba/t.GLYPH_SIZE,angle:k.getValue(R.angle),xOffset:k.getValue(R.offsetX),yOffset:k.getValue(R.offsetY),hAlign:g.horizontalAlignment2HAlign(R.horizontalAlignment),vAlign:g.verticalAlignment2VAlign(R.verticalAlignment),maxLineWidth:512,lineHeight:t.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(aa||1,4)),decoration:R.font.decoration||
"none",isCIM:!0,hasBackground:da}).boundsT;Q[0]=R.x-R.halfWidth;Q[1]=-R.y-R.halfHeight;Q[2]=R.x+R.halfWidth;Q[3]=-R.y+R.halfHeight;return Q};return l._createClass(P)}();let L=function(){function P(){}P.getEnvelope=function(M,Q,R){if(!M)return null;R=new g.EnvDrawHelper(R);if(Array.isArray(M)){let aa;for(const ba of M)aa?aa.union(w(R,ba,Q)):aa=w(R,ba,Q);return aa}return w(R,M,Q)};P.getTextureAnchor=function(M,Q){M=this.getEnvelope(M,null,Q);if(!M)return[0,0,0];Q=M.height*I+2;return[-((M.x+.5*M.width)*
I)/(M.width*I+2),-((M.y+.5*M.height)*I)/Q,Q]};P.rasterize=function(M,Q,R,aa,ba=!0){var N=R||this.getEnvelope(Q,null,aa);if(!N)return[null,0,0,0,0];const T=(N.x+.5*N.width)*I,U=(N.y+.5*N.height)*I;M.width=N.width*I;M.height=N.height*I;R||(M.width+=2,M.height+=2);R=M.getContext("2d");N=g.Transformation.createScale(I,-I);N.translate(.5*M.width-T,.5*M.height+U);aa=new g.CanvasDrawHelper(R,aa,N);switch(Q.type){case "CIMPointSymbol":aa.drawSymbol(Q,{type:"point",x:0,y:0});break;case "CIMVectorMarker":N=
new b.Placement,aa.drawMarker(Q,N)}Q=R.getImageData(0,0,M.width,M.height);Q=new Uint8Array(Q.data);if(ba)for(aa=0;aa<Q.length;aa+=4)ba=Q[aa+3]/255,Q[aa]*=ba,Q[aa+1]*=ba,Q[aa+2]*=ba;return[Q,M.width,M.height,-T/M.width,-U/M.height]};P.fromTextSymbol=function(M){const {angle:Q,color:R,font:aa,haloColor:ba,haloSize:N,horizontalAlignment:T,kerning:U,text:Y,verticalAlignment:ca,xoffset:da,yoffset:ea,backgroundColor:fa,borderLineColor:ja,borderLineSize:ia}=M;let ha,ka,ma;if(aa){var na=aa.family;var oa=
aa.style;var pa=aa.weight;ha=aa.size;ka=aa.decoration}M=!1;Y&&(M=A.bidiText(Y)[1]);if(fa||ia)ma={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Z(fa)},{type:"CIMSolidStroke",color:Z(ja),width:ia}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var Ea=e.BlockProgression.BTT,ta=e.FontEffects.Normal,ua=e.FontEncoding.Unicode;na=na||"Arial";b:{if(pa)switch(pa.toLowerCase()){case "bold":case "bolder":pa="bold";
break b}pa=""}b:{if(oa)switch(oa.toLowerCase()){case "italic":case "oblique":oa="italic";break b}oa=""}pa=pa&&oa?`${pa}-${oa}`:`${pa}${oa}`;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:Q,blockProgression:Ea,depth3D:1,extrapolateBaselines:!0,fontEffects:ta,
fontEncoding:ua,fontFamilyName:na,fontStyleName:pa,fontType:e.FontType.Unspecified,haloSize:N,height:ha,hinting:e.GlyphHinting.Default,horizontalAlignment:W(T??"center"),kerning:U,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:k.getValue(da),offsetY:k.getValue(ea),strikethrough:"line-through"===ka,underline:"underline"===ka,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Z(R)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",
enable:!0,color:Z(ba)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?e.TextReadingDirection.RTL:e.TextReadingDirection.LTR,verticalAlignment:X(ca??"baseline"),verticalGlyphOrientation:e.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:e.BillBoardMode.FaceNearPlane,callout:ma},textString:Y}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}};P.fromPictureFillSymbol=function(M){const {height:Q,outline:R,width:aa,
xoffset:ba,xscale:N,yoffset:T,yscale:U}=M,Y=[],ca={type:"CIMPolygonSymbol",symbolLayers:Y};if(R){var da=E(R);da&&Y.push(da)}da=M.url;"esriPFS"===M.type&&M.imageData&&(da=M.imageData);M="angle"in M?M.angle??0:0;Y.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:e.TextureFilter.Picture,tintColor:null,url:da,height:(Q??0)*(U||1),width:(aa??0)*(N||1),offsetX:k.getValue(ba),offsetY:k.getValue(T),rotation:k.getValue(-M),colorSubstitutions:null});return ca};P.fromSimpleFillSymbol=
function(M){const {color:Q,style:R,outline:aa}=M;M=[];const ba={type:"CIMPolygonSymbol",symbolLayers:M};if(aa){var N=E(aa);N&&M.push(N)}if(R&&"solid"!==R&&"none"!==R&&"esriSFSSolid"!==R&&"esriSFSNull"!==R){N={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Z(Q),capStyle:e.LineCapStyle.Butt,joinStyle:e.LineJoinStyle.Miter,width:.75}]};let T=0;const U=f.px2pt("vertical"===R||"horizontal"===R||"cross"===R||"esriSFSCross"===R||"esriSFSVertical"===R||"esriSFSHorizontal"===R?8:10);switch(R){case "vertical":case "esriSFSVertical":T=
90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":T=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":T=45;break;case "cross":case "esriSFSCross":T=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":T=-45}M.push({type:"CIMHatchFill",lineSymbol:N,offsetX:0,offsetY:0,rotation:T,separation:U});"cross"===R||"esriSFSCross"===R?M.push({type:"CIMHatchFill",lineSymbol:u.clone(N),offsetX:0,offsetY:0,rotation:90,separation:U}):("diagonal-cross"===R||"esriSFSDiagonalCross"===
R)&&M.push({type:"CIMHatchFill",lineSymbol:u.clone(N),offsetX:0,offsetY:0,rotation:45,separation:U})}else!R||"solid"!==R&&"esriSFSSolid"!==R||M.push({type:"CIMSolidFill",enable:!0,color:Z(Q)});return ba};P.fromSimpleLineSymbol=function(M){const {cap:Q,color:R,join:aa,marker:ba,miterLimit:N,style:T,width:U}=M;M=null;"solid"!==T&&"none"!==T&&"esriSLSSolid"!==T&&"esriSLSNull"!==T&&(M=[{type:"CIMGeometricEffectDashes",dashTemplate:V(T,Q),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);
const Y=[];if(ba){let ca;switch(ba.placement){case "begin-end":ca=e.ExtremityPlacement.Both;break;case "begin":ca=e.ExtremityPlacement.JustBegin;break;case "end":ca=e.ExtremityPlacement.JustEnd;break;default:ca=e.ExtremityPlacement.None}const da=P.fromSimpleMarker(ba,U,R).symbolLayers[0];da.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:ca,offsetAlongLine:0};Y.push(da)}Y.push({type:"CIMSolidStroke",color:"none"!==T&&"esriSLSNull"!==T?Z(R):[0,0,0,
0],capStyle:K(Q),joinStyle:S(aa),miterLimit:N,width:U,effects:M});return{type:"CIMLineSymbol",symbolLayers:Y}};P.fromPictureMarker=function(M){const {angle:Q,height:R,width:aa,xoffset:ba,yoffset:N}=M;let T=M.url;"esriPMS"===M.type&&M.imageData&&(T=M.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:e.TextureFilter.Picture,tintColor:null,url:T,size:R,width:aa,offsetX:k.getValue(ba),offsetY:k.getValue(N),rotation:k.getValue(-Q)}]}};
P.fromSimpleMarker=function(M,Q,R){var {style:aa}=M;R=M.color??R;if("path"===aa){Q=[];"outline"in M&&M.outline&&(aa=M.outline,Q.push({type:"CIMSolidStroke",enable:!0,width:f.pt2px(Math.round(f.px2pt(aa.width))),color:Z(aa.color)}));Q.push({type:"CIMSolidFill",enable:!0,color:Z(R),path:M.path});const [U,Y]=O("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:k.getValue(-M.angle),size:k.getValue(M.size||6),offsetX:k.getValue(M.xoffset),offsetY:k.getValue(M.yoffset),
frame:U,markerGraphics:[{type:"CIMMarkerGraphic",geometry:Y,symbol:{type:"CIMPolygonSymbol",symbolLayers:Q}}]}]}}const [ba,N]=O(aa);if(N&&ba){aa=[];if("outline"in M&&M.outline){var T=M.outline;aa.push({type:"CIMSolidStroke",enable:!0,width:null!=T.width&&.667<T.width?f.pt2px(Math.round(f.px2pt(T.width))):T.width,color:Z(T.color)})}else!Q||"line-marker"!==M.type||"cross"!==M.style&&"x"!==M.style||aa.push({type:"CIMSolidStroke",enable:!0,width:Q,color:Z(R)});aa.push({type:"CIMSolidFill",enable:!0,color:Z(R)});
R={type:"CIMPolygonSymbol",symbolLayers:aa};T={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:k.getValue(-M.angle),size:k.getValue(M.size||6*Q),offsetX:k.getValue(M.xoffset),offsetY:k.getValue(M.yoffset),frame:ba,markerGraphics:[{type:"CIMMarkerGraphic",geometry:N,symbol:R}]}]}}return T};P.fromCIMHatchFill=function(M,Q){const R=Q*(M.separation??g.DEFAULT_HATCH_FILL_SEPARATION),aa=R/2;M=u.clone(M.lineSymbol);M.symbolLayers?.forEach(N=>{switch(N.type){case "CIMSolidStroke":null!=
N.width&&(N.width*=Q);N.effects?.forEach(T=>{"CIMGeometricEffectDashes"===T.type&&(T.dashTemplate=T.dashTemplate.map(U=>U*Q))});break;case "CIMVectorMarker":null!=N.size&&(N.size*=Q),N=N.markerPlacement,null!=N&&"placementTemplate"in N&&(N.placementTemplate=N.placementTemplate.map(T=>T*Q))}});for(var ba=this._getLineSymbolPeriod(M)||4;4>ba;)ba*=2;ba/=2;return{type:"CIMVectorMarker",frame:{xmin:-ba,xmax:ba,ymin:-aa,ymax:aa},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-ba,0],[ba,0]]]},
symbol:M}],size:R}};P.fetchResources=function(M,Q,R){if(M&&Q)switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(M=M.symbolLayers)for(const aa of M)switch(x(aa,Q,R),aa.type){case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMCharacterMarker":case "CIMPictureMarker":"url"in aa&&aa.url&&R.push(Q.fetchResource(aa.url,null));break;case "CIMVectorMarker":if(M=aa.markerGraphics)for(const ba of M)ba&&
(M=ba.symbol)&&P.fetchResources(M,Q,R)}}};P.fetchFonts=function(M,Q,R){if(M&&Q)if("symbolLayers"in M&&M.symbolLayers)for(const N of M.symbolLayers){if("CIMVectorMarker"===N.type&&N.markerGraphics)for(const T of N.markerGraphics)T?.symbol&&P.fetchFonts(T.symbol,Q,R)}else if("CIMTextSymbol"===M.type){const {fontFamilyName:N,fontStyleName:T}=M;if(N&&"calcitewebcoreicons"!==N.toLowerCase()){var {style:aa,weight:ba}=k.fromCIMFontStyle(T);M=k.fromCIMFontDecoration(M);M=new y({family:N,style:aa,weight:ba,
decoration:M});R.push(Q.loadFont(M).catch(()=>{J.error(`Unsupported font ${N} in CIM symbol`)}))}}};P._getLineSymbolPeriod=function(M){if(M){const Q=this._getEffectsRepeat(M.effects);if(Q)return Q;if(M.symbolLayers)for(const R of M.symbolLayers)if(R){if(M=this._getEffectsRepeat(R.effects))return M;switch(R.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(M=this._getPlacementRepeat(R.markerPlacement))return M}}}return 0};
P._getEffectsRepeat=function(M){if(M)for(var Q of M)if(Q)switch(Q.type){case "CIMGeometricEffectDashes":if((M=Q.dashTemplate)&&M.length){Q=0;for(const R of M)Q+=R;M.length&1&&(Q*=2);return Q}break;case "CIMGeometricEffectWave":return Q.period;default:J.error(`unsupported geometric effect type ${Q.type}`)}return 0};P._getPlacementRepeat=function(M){if(M)switch(M.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((M=
M.placementTemplate)&&M.length){let Q=0;for(const R of M)Q+=+R;M.length&1&&(Q*=2);return Q}}return 0};P.fromCIMInsidePolygon=function(M){var Q=M.markerPlacement;const R={...M,markerPlacement:null,anchorPoint:null};M=Math.abs(Q.stepX);const aa=Math.abs(Q.stepY);var ba=(Q.randomness??100)/100;let N,T;if("Random"===Q.gridType){var U=f.px2pt(t.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE);const Y=Math.max(Math.floor(U/M),1),ca=Math.max(Math.floor(U/aa),1);U=Y*M/2;N=ca*aa/2;T=2*N;Q=new h(Q.seed);const da=ba*M/1.5,
ea=ba*aa/1.5;ba=[];for(let fa=0;fa<Y;fa++)for(let ja=0;ja<ca;ja++){const ia=fa*M-U+da*(.5-Q.getFloat()),ha=ja*aa-N+ea*(.5-Q.getFloat());ba.push({x:ia,y:ha});0===fa&&ba.push({x:ia+2*U,y:ha});0===ja&&ba.push({x:ia,y:ha+2*N})}}else!0===Q.shiftOddRows?(U=M/2,N=aa,T=2*aa,ba=[{x:-U,y:0},{x:U,y:0},{x:0,y:N},{x:0,y:-N}]):(U=M/2,N=aa/2,T=aa,ba=[{x:-M,y:0},{x:0,y:-aa},{x:-M,y:-aa},{x:0,y:0},{x:M,y:0},{x:0,y:aa},{x:M,y:aa},{x:-M,y:aa},{x:M,y:-aa}]);M=ba.map(Y=>({type:"CIMMarkerGraphic",geometry:Y,symbol:{type:"CIMPointSymbol",
symbolLayers:[R]}}));return{type:"CIMVectorMarker",frame:{xmin:-U,xmax:U,ymin:-N,ymax:N},markerGraphics:M,size:T}};P.getSize=function(M){if(M)switch(M.type){case "CIMTextSymbol":return M.height;case "CIMPointSymbol":var Q=0;if(M.symbolLayers)for(var R of M.symbolLayers)if(R)switch(R.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":M=R.size,null!=M&&M>Q&&(Q=M)}return Q;case "CIMLineSymbol":case "CIMPolygonSymbol":R=0;if(M.symbolLayers)for(Q of M.symbolLayers)if(Q)switch(Q.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":M=
Q.width;null!=M&&M>R&&(R=M);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":Q.markerPlacement&&k.isCIMMarkerStrokePlacement(Q.markerPlacement)&&(M=Q.size,null!=M&&M>R&&(R=M))}return R}};P.getMarkerScaleRatio=function(M){if(M)switch(M.type){case "CIMVectorMarker":if(!1!==M.scaleSymbolsProportionally&&M.frame&&null!=M.size)return M.size/(M.frame.ymax-M.frame.ymin)}return 1};return l._createClass(P)}();m=function(){function P(){}
P.findApplicableOverrides=function(M,Q,R){if(M&&Q){if(M.primitiveName){let aa=!1;for(const ba of R)if(ba.primitiveName===M.primitiveName){aa=!0;break}if(!aa)for(const ba of Q)ba.primitiveName===M.primitiveName&&R.push(ba)}switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(M.effects)for(const aa of M.effects)P.findApplicableOverrides(aa,Q,R);if(M.symbolLayers)for(const aa of M.symbolLayers)P.findApplicableOverrides(aa,Q,R);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(M.effects)for(const aa of M.effects)P.findApplicableOverrides(aa,
Q,R);M.markerPlacement&&P.findApplicableOverrides(M.markerPlacement,Q,R);if("CIMVectorMarker"===M.type){if(M.markerGraphics)for(const aa of M.markerGraphics)P.findApplicableOverrides(aa,Q,R),P.findApplicableOverrides(aa.symbol,Q,R)}else"CIMCharacterMarker"===M.type?P.findApplicableOverrides(M.symbol,Q,R):"CIMHatchFill"===M.type?P.findApplicableOverrides(M.lineSymbol,Q,R):"CIMPictureMarker"===M.type&&P.findApplicableOverrides(M.animatedSymbolProperties,Q,R)}}};P.findEffectOverrides=function(M,Q,R){if(Q&&
M){var aa=M.length;for(let ba=0;ba<aa;ba++){const N=M[ba]?.primitiveName;if(N){let T=!1;for(const U of R)if(U.primitiveName===N){T=!0;break}if(!T)for(const U of Q)U.primitiveName===N&&R.push(U)}}}};P.resolveSymbolOverrides=async function(M,Q,R,aa,ba,N,T){if(!M||!M.symbol)return null;let {symbol:U,primitiveOverrides:Y}=M;M=!!Y;if(!M&&!aa)return U;U=u.clone(U);let ca=!0;Q||(Q={attributes:{}},ca=!1);M&&(ca||(Y=Y.filter(da=>!da.valueExpressionInfo?.expression.includes("$feature"))),T||(Y=Y.filter(da=>
!da.valueExpressionInfo?.expression.includes("$view"))),0<Y.length&&(M=k.attributesToFields(Q.attributes),await P.evaluateOverrides(Y,Q,{spatialReference:R,fields:M,geometryType:ba},N,T)),P.applyOverrides(U,Y));aa&&P.applyDictionaryTextOverrides(U,Q,aa);return U};P.evaluateOverrides=async function(M,Q,R,aa,ba){if(Q){var N;for(const T of M)(M=T.valueExpressionInfo)&&R&&R.geometryType&&(N||(N=[]),T.value=void 0,M=a.createRendererExpression(M.expression,R.spatialReference,R.fields).then(U=>{T.value=
p(U,Q,{$view:ba},R.geometryType,aa)}),N.push(M));void 0!==N&&0<N.length&&await Promise.all(N)}};P.applyDictionaryTextOverrides=function(M,Q,R,aa="Normal"){if(M&&M.type)switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":case "CIMTextSymbol":var ba=M.symbolLayers;if(!ba)break;for(var N of ba)N&&"CIMVectorMarker"===N.type&&P.applyDictionaryTextOverrides(N,Q,R,"CIMTextSymbol"===M.type?M.textCase:aa);break;case "CIMVectorMarker":M=M.markerGraphics;if(!M)break;for(ba of M)ba&&
P.applyDictionaryTextOverrides(ba,Q,R);break;case "CIMMarkerGraphic":(N=M.textString)&&N.includes("[")&&(R=k.analyzeTextParts(N,R),M.textString=k.assignTextValuesFromFeature(Q,R,aa))}};P.applyOverrides=function(M,Q,R,aa){if(M.primitiveName)for(const N of Q)if(N.primitiveName===M.primitiveName){var ba=(ba=N.propertyName)?ba.charAt(0).toLowerCase()+ba.substr(1):ba;aa&&aa.push({cim:M,nocapPropertyName:ba,value:M[ba]});N.expression&&(N.value=P.toValue(N.propertyName,N.expression));if(R){let T=!1;for(const U of R)U.primitiveName===
M.primitiveName&&(T=!0);T||R.push(N)}null!=N.value&&(M[ba]=N.value)}switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(M.effects)for(const N of M.effects)P.applyOverrides(N,Q,R,aa);if(M.symbolLayers)for(const N of M.symbolLayers)P.applyOverrides(N,Q,R,aa);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(M.effects)for(const N of M.effects)P.applyOverrides(N,Q,R,aa);if("CIMVectorMarker"===M.type&&M.markerGraphics)for(const N of M.markerGraphics)P.applyOverrides(N,
Q,R,aa),P.applyOverrides(N.symbol,Q,R,aa)}};P.restoreOverrides=function(M){for(const Q of M)Q.cim[Q.nocapPropertyName]=Q.value};P.buildOverrideKey=function(M){let Q="";for(const R of M)void 0!==R.value&&(Q+=`${R.primitiveName}${R.propertyName}${JSON.stringify(R.value)}`);return Q};P.toValue=function(M,Q){return"DashTemplate"===M?Q.split(" ").map(R=>Number(R)):"Color"===M?(M=(new F(Q)).toRgba(),M[3]*=255,M):Q};return l._createClass(P)}();const K=P=>{if(!P)return e.LineCapStyle.Butt;switch(P){case "butt":return e.LineCapStyle.Butt;
case "square":return e.LineCapStyle.Square;case "round":return e.LineCapStyle.Round}},S=P=>{if(!P)return e.LineJoinStyle.Miter;switch(P){case "miter":return e.LineJoinStyle.Miter;case "round":return e.LineJoinStyle.Round;case "bevel":return e.LineJoinStyle.Bevel}},W=P=>{if(null==P)return"Center";switch(P){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},X=P=>{if(null==P)return"Center";switch(P){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";
case "bottom":return"Bottom"}},Z=P=>{if(!P)return[0,0,0,0];const {r:M,g:Q,b:R,a:aa}=P;return[M,Q,R,255*aa]},V=(P,M)=>{M="butt"===M;switch(P){case "dash":case "esriSLSDash":return M?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return M?[4,3,1,3]:[3,4,0,4];case "dot":case "esriSLSDot":return M?[1,3]:[0,4];case "long-dash":case "esriSLSLongDash":return M?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return M?[8,3,1,3]:[7,4,0,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return M?
[8,3,1,3,1,3]:[7,4,0,4,0,4];case "short-dash":case "esriSLSShortDash":return M?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return M?[4,1,1,1]:[3,2,0,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return M?[4,1,1,1,1,1]:[3,2,0,2,0,2];case "short-dot":case "esriSLSShortDot":return M?[1,1]:[0,2];case "solid":case "esriSLSSolid":case "none":return J.error("Unexpected: style does not require rasterization"),[0,0];default:return J.error(`Tried to rasterize SLS, but found an unexpected style: ${P}!`),
[0,0]}},O=P=>{if("circle"===P||"esriSMSCircle"===P){var M=Math.acos(.995);P=Math.ceil(B/M/4);0===P&&(P=1);M=G/P;P*=4;var Q=[];Q.push([50,0]);for(let R=1;R<P;R++)Q.push([50*Math.cos(R*M),-50*Math.sin(R*M)]);Q.push([50,0]);M={rings:[Q]};Q={xmin:-50,ymin:-50,xmax:50,ymax:50}}else"cross"===P||"esriSMSCross"===P?(M={rings:[[[0,50],[0,0],[50,0],[50,-0],[0,-0],[0,-50],[-0,-50],[-0,-0],[-50,-0],[-50,0],[-0,0],[-0,50],[0,50]]]},Q={xmin:-50,ymin:-50,xmax:50,ymax:50}):"diamond"===P||"esriSMSDiamond"===P?(M=
{rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},Q={xmin:-50,ymin:-50,xmax:50,ymax:50}):"square"===P||"esriSMSSquare"===P?(M={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},Q={xmin:-50,ymin:-50,xmax:50,ymax:50}):"x"===P||"esriSMSX"===P?(M={rings:[[[0,0],[50,50],[50,50],[0,0],[50,-50],[50,-50],[0,-0],[-50,-50],[-50,-50],[-0,0],[-50,50],[-50,50],[0,0]]]},Q={xmin:-50,ymin:-50,xmax:50,ymax:50}):"triangle"===P||"esriSMSTriangle"===P?(P=2/3*100,Q=P-100,M={rings:[[[-57.735026918962575,Q],[0,P],
[57.735026918962575,Q],[-57.735026918962575,Q]]]},Q={xmin:-57.735026918962575,ymin:Q,xmax:57.735026918962575,ymax:P}):"arrow"===P&&(M={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},Q={xmin:-50,ymin:-50,xmax:50,ymax:50});return[Q,M]};n.CIMSymbolHelper=L;n.CIMSymbolInflatedSizeHelper=D;n.OverrideHelper=m;n.getEffectsInflateSize=C;n.slsDashToTemplateArray=V;n.symbolToCIM=function(P){if(!P||!P.type)return null;let M;switch(P.type){case "cim":return P.data;case "web-style":return P;
case "simple-marker":P=L.fromSimpleMarker(P);if(!P)return null;M=P;break;case "picture-marker":M=L.fromPictureMarker(P);break;case "simple-line":M=L.fromSimpleLineSymbol(P);break;case "simple-fill":M=L.fromSimpleFillSymbol(P);break;case "picture-fill":M=L.fromPictureFillSymbol(P);break;case "text":M=L.fromTextSymbol(P)}return{type:"CIMSymbolReference",symbol:M}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(n,l){let F=function(){function A(){this.setIdentity()}var u=A.prototype;u.getAngle=function(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz};u.setIdentity=function(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0};u.setTranslate=function(m,h){this.tx=m;this.ty=h};u.setTranslateZ=function(m){this.tz=m};u.setRotateCS=function(m,h){this.rz=void 0;this.rzCos=m;this.rzSin=h};u.setRotate=
function(m){this.rz=m;this.rzSin=this.rzCos=void 0};u.setRotateY=function(m){this.ry=m};u.setScale=function(m){this.s=m};u.setMeasure=function(m){this.m=m};return l._createClass(A)}(),D=function(){function A(){}A.prototype.next=function(){return null};return l._createClass(A)}();n.EmptyPlacementCursor=D;n.Placement=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/BidiText ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/alignmentUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w,z,r,C){function x(X,Z=1){const V=w.fromCIMFontDecoration(X);var O=w.fromCIMFontStyle(X.fontStyleName);const P=X.fontFamilyName??D.DEFAULT_FONT_FAMILY,{weight:M,style:Q}=O;O=Z*(X.height||5);const R=w.fromCIMHorizontalAlignment(X.horizontalAlignment),aa=w.fromCIMVerticalAlignment(X.verticalAlignment),ba=w.getFillColor(X),N=w.getFillColor(X.haloSymbol);Z=N?Z*(X.haloSize|0):0;var T="CIMBackgroundCallout"===X.callout?.type?X.callout.backgroundSymbol:
null;X=w.getFillColor(T);const U=w.getStrokeWidth(T);T=w.getStrokeColor(T);return{color:ba,size:O,horizontalAlignment:R,verticalAlignment:aa,font:{family:P,style:w.getFontStyle(Q),weight:w.getFontWeight(M),decoration:V},halo:{size:Z||0,color:N,style:Q},backgroundColor:X,borderLine:null!=U&&null!=T?{size:U,color:T}:null,pixelRatio:1,premultiplyColors:!0}}const E=Math.PI/180,B=u.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let G=function(){function X(V){this._t=V}X.createIdentity=function(){return new X([1,
0,0,0,1,0])};var Z=X.prototype;Z.clone=function(){return new X(this._t.slice())};Z.transform=function(V){const O=this._t;return[O[0]*V[0]+O[1]*V[1]+O[2],O[3]*V[0]+O[4]*V[1]+O[5]]};X.createScale=function(V,O){return new X([V,0,0,0,O,0])};Z.scale=function(V,O){const P=this._t;P[0]*=V;P[1]*=V;P[2]*=V;P[3]*=O;P[4]*=O;P[5]*=O;return this};Z.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};X.createTranslate=function(V,O){return new X([0,0,V,0,0,O])};Z.translate=function(V,
O){const P=this._t;P[2]+=V;P[5]+=O;return this};X.createRotate=function(V){const O=Math.cos(V);V=Math.sin(V);return new X([O,-V,0,V,O,0])};Z.rotate=function(V){return X.multiply(this,X.createRotate(V),this)};Z.angle=function(){const V=this._t[0],O=this._t[3],P=Math.sqrt(V*V+O*O);return[V/P,O/P]};X.multiply=function(V,O,P){V=V._t;O=O._t;const M=V[1]*O[0]+V[4]*O[1],Q=V[2]*O[0]+V[5]*O[1]+O[2],R=V[0]*O[3]+V[3]*O[4],aa=V[1]*O[3]+V[4]*O[4],ba=V[2]*O[3]+V[5]*O[4]+O[5],N=P._t;N[0]=V[0]*O[0]+V[3]*O[1];N[1]=
M;N[2]=Q;N[3]=R;N[4]=aa;N[5]=ba;return P};Z.invert=function(){const V=this._t;let O=V[0]*V[4]-V[1]*V[3];if(0===O)return new X([0,0,0,0,0,0]);O=1/O;return new X([V[4]*O,-V[1]*O,(V[1]*V[5]-V[2]*V[4])*O,-V[3]*O,V[0]*O,(V[2]*V[3]-V[0]*V[5])*O])};return l._createClass(X)}();u=function(){function X(V,O){this._resourceManager=V;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new m(p.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(O||
G.createIdentity());this._sizeTransfos.push(O?O.scaleRatio():1)}var Z=X.prototype;Z.setTransform=function(V,O){this._transfos=[V||G.createIdentity()];this._sizeTransfos=[O||(V?V.scaleRatio():1)]};Z.setGeomUnitsPerPoint=function(V){this._geomUnitsPerPoint=V};Z.transformPt=function(V){return this._transfos[this._transfos.length-1].transform(V)};Z.transformSize=function(V){return V*this._sizeTransfos[this._sizeTransfos.length-1]};Z.reverseTransformPt=function(V){return this._transfos[this._transfos.length-
1].invert().transform(V)};Z.reverseTransformSize=function(V){return V/this._sizeTransfos[this._sizeTransfos.length-1]};Z.getTransformAngle=function(){return this._transfos[this._transfos.length-1].angle()};Z.geomUnitsPerPoint=function(){return this.isEmbedded()?1:this._geomUnitsPerPoint};Z.isEmbedded=function(){return 1<this._transfos.length};Z.back=function(){return this._transfos[this._transfos.length-1]};Z.push=function(V,O){O=O?V.scaleRatio():1;G.multiply(V,this.back(),V);this._transfos.push(V);
this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*O)};Z.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};Z.drawSymbol=function(V,O,P){if(V)switch(V.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(V,O);break;case "CIMTextSymbol":this.drawTextSymbol(V,O,P)}};Z.drawMultiLayerSymbol=function(V,O){if(V&&O){var P=V.symbolLayers;if(P)if((V=V.effects)&&0<V.length){if(O=this.executeEffects(V,O))for(V=O.next();V;)this.drawSymbolLayers(P,
V.asJSON()),V=O.next()}else this.drawSymbolLayers(P,O)}};Z.executeEffects=function(V,O){const P=this._resourceManager.geometryEngine;O=new g.SimpleEffectCursor(f.GeometryCursor.fromJSONCIM(O));for(const M of V)(V=k.getEffectOperator(M))&&(O=V.execute(O,M,this.geomUnitsPerPoint(),null,P));return O};Z.drawSymbolLayers=function(V,O){let P=V.length;for(;P--;){const Q=V[P];if(Q&&!1!==Q.enable){var M=Q.effects;if(M&&0<M.length){if(M=this.executeEffects(M,O)){let R=null;for(;(R=M.next())&&(this.drawSymbolLayer(Q,
R.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(Q,O);if(this._earlyReturn)break}}};Z.drawSymbolLayer=function(V,O){switch(V.type){case "CIMSolidFill":this.drawSolidFill(O,V.color);break;case "CIMHatchFill":this.drawHatchFill(O,V);break;case "CIMPictureFill":this.drawPictureFill(O,V);break;case "CIMGradientFill":this.drawGradientFill(O,V);break;case "CIMSolidStroke":this.drawSolidStroke(O,V.color,V.width,V.capStyle,V.joinStyle,V.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(O,
V);break;case "CIMGradientStroke":this.drawGradientStroke(O,V);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(V,O)}};Z.drawHatchFill=function(V,O){const P=this._buildHatchPolyline(O,V,this.geomUnitsPerPoint());P&&(this.pushClipPath(V),this.drawMultiLayerSymbol(O.lineSymbol,P),this.popClipPath())};Z.drawPictureFill=function(V,O){};Z.drawGradientFill=function(V,O){};Z.drawPictureStroke=function(V,O){};Z.drawGradientStroke=function(V,O){};Z.drawMarkerLayer=
function(V,O){var P=V.markerPlacement;if(P){var M=k.getPlacementOperator(P);if(M){var Q="CIMMarkerPlacementInsidePolygon"===P.type||"CIMMarkerPlacementPolygonCenter"===P.type&&P.clipAtBoundary;Q&&this.pushClipPath(O);if(O=M.execute(f.GeometryCursor.fromJSONCIM(O),P,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(P=null;(P=O.next())&&(this.drawMarker(V,P),!this._earlyReturn););Q&&this.popClipPath()}}else{Q=this._placementPool.acquire();if(b.isPoint(O))Q.tx=O.x,Q.ty=O.y,this.drawMarker(V,
Q);else if(b.isPolygon(O)){if(O=a.polygonCentroid(O))[Q.tx,Q.ty]=O,this.drawMarker(V,Q)}else for(M of O.points)if(Q.tx=M[0],Q.ty=M[1],this.drawMarker(V,Q),this._earlyReturn)break;this._placementPool.release(Q)}};Z.drawMarker=function(V,O){switch(V.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(V,O);break;case "CIMVectorMarker":this.drawVectorMarker(V,O)}};Z.drawPictureMarker=function(V,O){if(V){var P=this._resourceManager.getResource(V.url),M=w.getValue(V.size,10);
if(!(null==P||0>=M)){var Q=P.width;P=P.height;if(Q&&P){P=Q/P;var R=w.getValue(V.scaleX,1);Q=G.createIdentity();var aa=V.anchorPoint;if(aa){var ba=aa.x;aa=aa.y;"Absolute"!==V.anchorPointUnits&&(ba*=M*P*R,aa*=M);Q.translate(-ba,-aa)}P=w.getValue(V.rotation);V.rotateClockwise&&(P=-P);this._mapRotation&&(P+=this._mapRotation);P&&Q.rotate(P*E);P=w.getValue(V.offsetX);R=w.getValue(V.offsetY);if(P||R){if(this._mapRotation){aa=E*this._mapRotation;ba=Math.cos(aa);aa=Math.sin(aa);const N=P*aa+R*ba;P=P*ba-R*
aa;R=N}Q.translate(P,R)}P=this.geomUnitsPerPoint();1!==P&&Q.scale(P,P);(P=O.getAngle())&&Q.rotate(P);Q.translate(O.tx,O.ty);this.push(Q,!1);this.drawImage(V,M);this.pop()}}}};Z.drawVectorMarker=function(V,O){if(V){var P=V.markerGraphics;if(P){var M=w.getValue(V.size,10),Q=V.frame,R=Q?Q.ymax-Q.ymin:0;R=M&&R?M/R:1;M=G.createIdentity();Q&&M.translate(.5*-(Q.xmax+Q.xmin),.5*-(Q.ymax+Q.ymin));var aa=V.anchorPoint;if(aa){var ba=aa.x;aa=aa.y;"Absolute"!==V.anchorPointUnits?Q&&(ba*=Q.xmax-Q.xmin,aa*=Q.ymax-
Q.ymin):(ba/=R,aa/=R);M.translate(-ba,-aa)}1!==R&&M.scale(R,R);Q=w.getValue(V.rotation);V.rotateClockwise&&(Q=-Q);this._mapRotation&&(Q+=this._mapRotation);Q&&M.rotate(Q*E);Q=w.getValue(V.offsetX);R=w.getValue(V.offsetY);if(Q||R){if(this._mapRotation){aa=E*this._mapRotation;ba=Math.cos(aa);aa=Math.sin(aa);const N=Q*aa+R*ba;Q=Q*ba-R*aa;R=N}M.translate(Q,R)}Q=this.geomUnitsPerPoint();1!==Q&&M.scale(Q,Q);(Q=O.getAngle())&&M.rotate(Q);M.translate(O.tx,O.ty);this.push(M,V.scaleSymbolsProportionally);for(const N of P)if(N&&
N.symbol&&N.geometry||B.error("Invalid marker graphic",N),this.drawSymbol(N.symbol,N.geometry,N.textString),this._earlyReturn)break;this.pop()}}};Z.drawTextSymbol=function(V,O,P){if(V&&b.isPoint(O)&&!(0>=w.getValue(V.height,10))){var M=G.createIdentity(),Q=w.getValue(V.angle);(Q=-Q)&&M.rotate(Q*E);Q=w.getValue(V.offsetX);var R=w.getValue(V.offsetY);(Q||R)&&M.translate(Q,R);Q=this.geomUnitsPerPoint();1!==Q&&M.scale(Q,Q);M.translate(O.x,O.y);this.push(M,!1);this.drawText(V,P);this.pop()}};Z._buildHatchPolyline=
function(V,O,P){var M=w.getValue(V.separation,4)*P,Q=w.getValue(V.rotation);if(0===M)return null;0>M&&(M=-M);for(var R=0,aa=.5*M;R>aa;)R-=M;for(;R<-aa;)R+=M;R=d.create();c.getBoundsXY(R,O);R[0]-=aa;R[1]-=aa;R[2]+=aa;R[3]+=aa;for(var ba=[[R[0],R[1]],[R[0],R[3]],[R[2],R[3]],[R[2],R[1]]];180<Q;)Q-=180;for(;0>Q;)Q+=180;aa=Math.cos(Q*E);var N=Math.sin(Q*E);Q=-M*N;O=M*aa;R=w.getValue(V.offsetX)*P;V=w.getValue(V.offsetY)*P;R=R*N-V*aa;let T;var U=V=Number.MAX_VALUE;T=P=-Number.MAX_VALUE;for(var Y of ba){var ca=
Y[0];const da=Y[1];ba=aa*ca+N*da;ca=-N*ca+aa*da;U=Math.min(U,ba);V=Math.min(V,ca);T=Math.max(T,ba);P=Math.max(P,ca)}V=Math.floor(V/M)*M;Y=aa*U-N*V-Q*R/M;ba=N*U+aa*V-O*R/M;U=aa*T-N*V-Q*R/M;R=N*T+aa*V-O*R/M;M=1+Math.round((P-V)/M);aa=[];for(N=0;N<M;N++)Y+=Q,ba+=O,U+=Q,R+=O,aa.push([[Y,ba],[U,R]]);return{paths:aa}};return l._createClass(X)}();let H=function(X){function Z(O,P){O=X.call(this,O,P)||this;O.reset();return O}l._inherits(Z,X);var V=Z.prototype;V.reset=function(){this._xmin=this._ymin=Infinity;
this._xmax=this._ymax=-Infinity;this._clipCount=0};V.envelope=function(){return new v(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};V.bounds=function(){return d.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)};V.drawSolidFill=function(O){!O||0<this._clipCount||(b.isPolygon(O)?this._processPath(O.rings,0):b.isPolyline(O)?this._processPath(O.paths,0):b.isExtent(O)?(O=L(O))&&this._processPath(O.rings,0):console.error("drawSolidFill Unexpected geometry type!"))};V.drawSolidStroke=
function(O,P,M){!O||0<this._clipCount||(P=.5*this.transformSize(w.getValue(M,4)),b.isPolygon(O)?this._processPath(O.rings,P):b.isPolyline(O)?this._processPath(O.paths,P):b.isExtent(O)?(O=L(O))&&this._processPath(O.rings,P):console.error("drawSolidStroke unexpected geometry type!"))};V.drawMarkerLayer=function(O,P){b.isPolygon(P)&&O.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===O.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===O.markerPlacement.type&&O.markerPlacement.clipAtBoundary)?
this._processPath(P.rings,0):l._get(l._getPrototypeOf(Z.prototype),"drawMarkerLayer",this).call(this,O,P)};V.drawHatchFill=function(O,P){this.drawSolidFill(O)};V.drawPictureFill=function(O,P){this.drawSolidFill(O)};V.drawGradientFill=function(O,P){this.drawSolidFill(O)};V.drawPictureStroke=function(O,P){this.drawSolidStroke(O,null,P.width)};V.drawGradientStroke=function(O,P){this.drawSolidStroke(O,null,P.width)};V.pushClipPath=function(O){this.drawSolidFill(O);this._clipCount++};V.popClipPath=function(){this._clipCount--};
V.drawImage=function(O,P){var {url:M}=O;O=w.getValue(O.scaleX,1);let Q=O*P,R=P;M=this._resourceManager.getResource(M);P||null==M||(Q=O*M.width,R=M.height);this._merge(this.transformPt([-Q/2,-R/2]),0);this._merge(this.transformPt([-Q/2,R/2]),0);this._merge(this.transformPt([Q/2,-R/2]),0);this._merge(this.transformPt([Q/2,R/2]),0)};V.drawText=function(O,P){if(P&&0!==P.length){this._textRasterizer||(this._textRasterizer=new y);var M=x(O),[Q,R]=this._textRasterizer.computeTextSize(P,M);P=0;switch(O.horizontalAlignment){case "Left":P=
Q/2;break;case "Right":P=-Q/2}M=0;switch(O.verticalAlignment){case "Bottom":M=R/2;break;case "Top":M=-R/2;break;case "Baseline":M=R/6}this._merge(this.transformPt([-Q/2+P,-R/2+M]),0);this._merge(this.transformPt([-Q/2+P,R/2+M]),0);this._merge(this.transformPt([Q/2+P,-R/2+M]),0);this._merge(this.transformPt([Q/2+P,R/2+M]),0)}};V._processPath=function(O,P){if(O)for(const M of O)if(O=M?M.length:0,1<O){this._merge(this.transformPt(M[0]),P);for(let Q=1;Q<O;Q++)this._merge(this.transformPt(M[Q]),P)}};V._merge=
function(O,P){O[0]-P<this._xmin&&(this._xmin=O[0]-P);O[0]+P>this._xmax&&(this._xmax=O[0]+P);O[1]-P<this._ymin&&(this._ymin=O[1]-P);O[1]+P>this._ymax&&(this._ymax=O[1]+P)};return l._createClass(Z)}(u),I=function(X){function Z(){var O=X.apply(this,arguments)||this;O._searchPoint=[0,0];O._searchDistPoint=0;O._textInfo=null;return O}l._inherits(Z,X);var V=Z.prototype;V.hitTest=function(O,P,M,Q,R,aa){aa*=h.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(aa);this._searchPoint=[(O[0]+O[2])/2,(O[1]+
O[3])/2];this._searchDistPoint=(O[2]-O[0])/2/aa;this._textInfo=Q;this._mapRotation=P&&("CIMPointSymbol"===P.type&&"Map"!==P.angleAlignment||"CIMTextSymbol"===P.type)?R:0;this._earlyReturn=!1;this.drawSymbol(P,M);return this._earlyReturn};V.drawSolidFill=function(O,P){this._hitTestFill(O)};V.drawHatchFill=function(O,P){this._hitTestFill(O)};V.drawPictureFill=function(O,P){this._hitTestFill(O)};V.drawGradientFill=function(O,P){this._hitTestFill(O)};V.drawSolidStroke=function(O,P,M,Q,R,aa){this._hitTestStroke(O,
M)};V.drawPictureStroke=function(O,P){this._hitTestStroke(O,P.width)};V.drawGradientStroke=function(O,P){this._hitTestStroke(O,P.width)};V.drawMarkerLayer=function(O,P){O.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===O.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===O.markerPlacement.type&&O.markerPlacement.clipAtBoundary)?this._hitTestFill(P):l._get(l._getPrototypeOf(Z.prototype),"drawMarkerLayer",this).call(this,O,P)};V.pushClipPath=function(O){};V.popClipPath=function(){};V.drawImage=
function(O,P){var {url:M}=O;O=w.getValue(O.scaleX,1);M=this._resourceManager.getResource(M);if(null!=M&&0!==M.height&&0!==P){P*=this.geomUnitsPerPoint();O=M.width/M.height*O*P;M=this.reverseTransformPt(this._searchPoint);var Q=this._searchDistPoint;Math.abs(M[0])<O/2+Q&&Math.abs(M[1])<P/2+Q&&(this._earlyReturn=!0)}};V.drawText=function(O,P){if(P=this._textInfo)if(P=P.get(O)){var {text:M,mosaicItem:Q}=P;if(Q?.glyphMosaicItems?.length){P=w.getValue(O.height,10);var {lineGapType:R,lineGap:aa}=O,ba=R?
W(R,w.getValue(aa),P):0,N=F.bidiText(M)[1],T="CIMBackgroundCallout"===O.callout?.type;O=C.shapeGlyphs(Q.glyphMosaicItems,N,{scale:P/r.GLYPH_SIZE,angle:0,xOffset:0,yOffset:0,hAlign:K(O.horizontalAlignment),vAlign:S(O.verticalAlignment),maxLineWidth:512,lineHeight:r.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(ba||1,4)),decoration:O.font.decoration||"none",isCIM:!0,hasBackground:T});ba=this.reverseTransformPt(this._searchPoint);P=ba[0];ba=ba[1];for(const U of O.glyphs)if(P>U.xTopLeft&&P<U.xBottomRight&&
ba>-U.yBottomRight&&ba<-U.yTopLeft){this._earlyReturn=!0;break}}}};V._hitTestFill=function(O){let P=null;if(b.isExtent(O))P=[[[O.xmin,O.ymin],[O.xmin,O.ymax],[O.xmax,O.ymax],[O.xmax,O.ymin],[O.xmin,O.ymin]]];else if(b.isPolygon(O))P=O.rings;else if(b.isPolyline(O))P=O.paths;else return;O=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(O,P)&&(this._earlyReturn=!0);if(!this._earlyReturn){const M=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(O,
P,M)&&(this._earlyReturn=!0)}};V._hitTestStroke=function(O,P){let M=null;if(b.isExtent(O))M=[[[O.xmin,O.ymin],[O.xmin,O.ymax],[O.xmax,O.ymax],[O.xmax,O.ymin],[O.xmin,O.ymin]]];else if(b.isPolygon(O))M=O.rings;else if(b.isPolyline(O))M=O.paths;else return;O=this.reverseTransformPt(this._searchPoint);P=w.getValue(P,4)*this.geomUnitsPerPoint();const Q=this.reverseTransformSize(this._searchDistPoint)*this.geomUnitsPerPoint();this._nearLine(O,M,P/2+Q)&&(this._earlyReturn=!0)};V._pointInPolygon=function(O,
P){let M=0;for(const Q of P){P=Q.length;for(let R=1;R<P;R++){const aa=Q[R-1],ba=Q[R];aa[1]>O[1]!==ba[1]>O[1]&&(0<(ba[0]-aa[0])*(O[1]-aa[1])-(ba[1]-aa[1])*(O[0]-aa[0])?M++:M--)}}return 0!==M};V._nearLine=function(O,P,M){for(const R of P){P=R.length;for(let aa=1;aa<P;aa++){var Q=R[aa-1];const ba=R[aa];let N=(ba[0]-Q[0])*(ba[0]-Q[0])+(ba[1]-Q[1])*(ba[1]-Q[1]);if(0!==N&&(N=Math.sqrt(N),Math.abs(((ba[0]-Q[0])*(O[1]-Q[1])-(ba[1]-Q[1])*(O[0]-Q[0]))/N)<M&&(Q=((ba[0]-Q[0])*(O[0]-Q[0])+(ba[1]-Q[1])*(O[1]-Q[1]))/
N,Q>-M&&Q<N+M)))return!0}}return!1};return l._createClass(Z)}(u),J=function(X){function Z(O,P,M,Q){P=X.call(this,P,M)||this;P._applyAdditionalRenderProps=Q;P._colorSubstitutionHelper=new e;P._ctx=O;return P}l._inherits(Z,X);var V=Z.prototype;V.drawSolidFill=function(O,P){if(O){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(L(O).rings,!0);else if(b.isMultipoint(O))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");
else return;O=this._ctx;O.fillStyle="string"===typeof P?P:"rgba("+Math.round(P[0])+","+Math.round(P[1])+","+Math.round(P[2])+","+(P[3]??255)/255+")";O.fill("evenodd")}};V.drawSolidStroke=function(O,P,M,Q,R,aa){if(O&&P&&0!==M){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!1);else if(b.isExtent(O))this._buildPath(L(O).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}O=this._ctx;O.strokeStyle="string"===typeof P?
P:"rgba("+Math.round(P[0])+","+Math.round(P[1])+","+Math.round(P[2])+","+(P[3]??255)/255+")";O.lineWidth=Math.max(this.transformSize(M),.5);this._setCapStyle(Q);this._setJoinStyle(R);O.miterLimit=aa;O.stroke()}};V.pushClipPath=function(O){this._ctx.save();if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(L(O).rings,!0);else return;this._ctx.clip("evenodd")};V.popClipPath=function(){this._ctx.restore()};V.drawImage=
function(O,P){const {colorSubstitutions:M,url:Q,tintColor:R}=O;O=w.getValue(O.scaleX,1);var aa=this._resourceManager.getResource(Q);if(null!=aa){var ba=aa.width/aa.height*P,N=P;P||(ba=aa.width,N=aa.height);var T=w.isSVGImage(Q)||"src"in aa&&w.isSVGImage(aa.src);P="getFrame"in aa?t.getFirstFrame(aa):aa;M&&(P=this._colorSubstitutionHelper.applyColorSubstituition(P,M));this._applyAdditionalRenderProps&&!T&&R&&(P=this._colorSubstitutionHelper.tintImageData(P,R));aa=this.transformPt([0,0]);var [U,Y]=this.getTransformAngle();
T=this.transformSize(1);var ca=this._ctx;ca.save();ca.setTransform({m11:O*T*U,m12:O*T*Y,m21:-T*Y,m22:T*U,m41:aa[0],m42:aa[1]});ca.drawImage(P,-ba/2,-N/2,ba,N);ca.restore()}};V.drawText=function(O,P){if(P&&0!==P.length&&(this._textRasterizer||(this._textRasterizer=new y),O=x(O),O.size*=this.transformSize(h.px2pt(1)),P=this._textRasterizer.rasterizeText(P,O))){var {size:M,anchorX:Q,anchorY:R,canvas:aa}=P;P=M[0]*(Q+.5);O=M[1]*(R-.5);var ba=this._ctx,N=this.transformPt([0,0]),[T,U]=this.getTransformAngle();
ba.save();ba.setTransform({m11:1*T,m12:1*U,m21:-1*U,m22:1*T,m41:N[0]-1*P,m42:N[1]+1*O});ba.drawImage(aa,0,0);ba.restore()}};V.drawPictureFill=function(O,P){if(O){var {colorSubstitutions:M,height:Q,offsetX:R,offsetY:aa,rotation:ba,scaleX:N,tintColor:T,url:U}=P;P=this._resourceManager.getResource(U);if(null!=P){if(b.isPolygon(O))this._buildPath(O.rings,!0);else if(b.isPolyline(O))this._buildPath(O.paths,!0);else if(b.isExtent(O))this._buildPath(L(O).rings,!0);else if(b.isMultipoint(O))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");
else return;O=this._ctx;var Y=w.isSVGImage(U)||"src"in P&&w.isSVGImage(P.src),ca="getFrame"in P?t.getFirstFrame(P):P;M&&(ca=this._colorSubstitutionHelper.applyColorSubstituition(ca,M));if(this._applyAdditionalRenderProps){if(Y||T&&(ca=this._colorSubstitutionHelper.tintImageData(ca,T)),Y=O.createPattern(ca,"repeat"),ca=this.transformSize(1),ba||(ba=0),R=R?ca*R:0,aa=aa?ca*aa:0,Q&&(Q*=ca),ca=Q?Q/P.height:1,P=N&&Q?N*Q/P.width:1,0!==ba||1!==ca||1!==P||0!==R||0!==aa){const da=new DOMMatrix;da.rotateSelf(0,
0,-ba).translateSelf(R,aa).scaleSelf(P,ca,1);Y.setTransform(da)}}else Y=O.createPattern(ca,"repeat");O.save();O.fillStyle=Y;O.fill("evenodd");O.restore()}}};V.drawPictureStroke=function(O,P){if(O){var {colorSubstitutions:M,capStyle:Q,joinStyle:R,miterLimit:aa,tintColor:ba,url:N,width:T}=P;P=this._resourceManager.getResource(N);if(null!=P){if(b.isPolygon(O))var U=O.rings;else if(b.isPolyline(O))U=O.paths;else if(b.isExtent(O))U=L(O).rings;else{b.isMultipoint(O)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");
return}T||(T=P.width);O=w.isSVGImage(N)||"src"in P&&w.isSVGImage(P.src);var Y="getFrame"in P?t.getFirstFrame(P):P;M&&(Y=this._colorSubstitutionHelper.applyColorSubstituition(Y,M));this._applyAdditionalRenderProps&&(O||ba&&(Y=this._colorSubstitutionHelper.tintImageData(Y,ba)));P=Math.max(this.transformSize(h.pt2px(T)),.5);O=P/Y.width;var ca=this._ctx;Y=ca.createPattern(Y,"repeat-y");ca.save();this._setCapStyle(Q);this._setJoinStyle(R);void 0!==aa&&(ca.miterLimit=aa);ca.lineWidth=P;var da;for(let ha of U){ha=
A.clone(ha);var ea=da=void 0,fa=void 0;let ka=ea=void 0;U=ha;for(var ja=U[0],ia=1;ia<U.length;)ka=U[ia][0]-ja[0],ea=U[ia][1]-ja[1],ea=0!==ka?ea/ka:Math.PI/2,void 0!==fa&&1E-4>=ea-fa?(U.splice(ia-1,1),ja=da):(da=ja,ja=U[ia],ia++),fa=ea;if(ha&&!(1>=ha.length))for(U=this.transformPt(ha[0]),fa=1;fa<ha.length;fa++)da=this.transformPt(ha[fa]),ja=180/Math.PI*Math.atan2(da[1]-U[1],da[0]-U[0]),ia=new DOMMatrix,ia.translateSelf(0,U[1]-P/2).scaleSelf(O,O,1).rotateSelf(0,0,90-ja),Y.setTransform(ia),ca.strokeStyle=
Y,ca.beginPath(),ca.moveTo(U[0],U[1]),ca.lineTo(da[0],da[1]),ca.stroke(),U=da}ca.restore()}}};V._buildPath=function(O,P){const M=this._ctx;M.beginPath();if(O)for(const Q of O)if(O=Q?Q.length:0,1<O){let R=this.transformPt(Q[0]);M.moveTo(R[0],R[1]);for(let aa=1;aa<O;aa++)R=this.transformPt(Q[aa]),M.lineTo(R[0],R[1]);P&&M.closePath()}};V._setCapStyle=function(O){switch(O){case q.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case q.LineCapStyle.Round:this._ctx.lineCap="round";break;case q.LineCapStyle.Square:this._ctx.lineCap=
"square"}};V._setJoinStyle=function(O){switch(O){case q.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case q.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case q.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}};return l._createClass(Z)}(u);const L=X=>X?{spatialReference:X.spatialReference,rings:[[[X.xmin,X.ymin],[X.xmin,X.ymax],[X.xmax,X.ymax],[X.xmax,X.ymin],[X.xmin,X.ymin]]]}:null,K=X=>{switch(X){case "Left":return z.HAlign.Left;case "Right":return z.HAlign.Right;case "Center":return z.HAlign.Center;
case "Justify":return B.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),z.HAlign.Center}},S=X=>{switch(X){case "Top":return z.VAlign.Top;case "Center":return z.VAlign.Center;case "Bottom":return z.VAlign.Bottom;case "Baseline":return z.VAlign.Baseline}},W=(X,Z,V)=>{switch(X){case "ExtraLeading":return 1+Z/V;case "Multiple":return Z;case "Exact":return Z/V}};n.CIMSymbolDrawHelper=u;n.C_DEG_TO_RAD=E;n.CanvasDrawHelper=J;n.DEFAULT_HATCH_FILL_SEPARATION=4;n.DEFAULT_MARKER_SIZE=
10;n.DEFAULT_PICTURE_FILL_HEIGHT=10;n.DEFAULT_STROKE_WIDTH=4;n.DEFAULT_TEXT_HALO_SIZE=1;n.DEFAULT_TEXT_HEIGHT=10;n.EnvDrawHelper=H;n.HittestDrawHelper=I;n.Transformation=G;n.horizontalAlignment2HAlign=K;n.lineGapType2LineHeight=W;n.verticalAlignment2VAlign=S;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../core/lang ./geometryCursorCollectUtils ./support/jsonUtils ../layers/graphics/OptimizedGeometry".split(" "),
function(n,l,F,D,A,u){function m(b){if(A.isPolygon(b))b=[b.rings,"esriGeometryPolygon"];else if(A.isPolyline(b))b=[b.paths,"esriGeometryPolyline"];else if(A.isMultipoint(b))b=[[b.points],"esriGeometryMultipoint"];else if(A.isExtent(b))b=[[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]],"esriGeometryEnvelope"];else if(A.isPoint(b)){const g=[b.x,b.y];b.z&&g.push(b.z);b.m&&g.push(b.m);b=[[[g]],"esriGeometryPoint"]}else b=[[],"esriGeometryPolyline"];return b}let h=function(){function b(){}
b.fromOptimized=function(e,k,p=!1,q=!1){return(new f).initialize(e,k,p,q,1)};b.fromJSON=function(e,k=!1,p=!1){const [q,t]=m(e);return(new d).initialize(q,t,k,p,1)};b.fromOptimizedCIM=function(e,k,p=!1,q=!1){return(new c).initialize(e,k,p,q,1)};b.fromJSONCIM=function(e,k=!1,p=!1){const [q,t]=m(e);return(new a).initialize(q,t,k,p,1)};b.fromFeatureSetReader=function(e){const k=e.readGeometryForDisplay();e=e.geometryType;return k&&e?this.fromOptimized(k,e):null};b.fromFeatureSetReaderCIM=function(e){const k=
e.readGeometryForDisplay();e=e.geometryType;return k&&e?this.fromOptimizedCIM(k,e):null};b.createEmptyOptimized=function(e,k=!1,p=!1){return(new f).initialize(new u,e,k,p,1)};b.createEmptyJSON=function(e,k=!1,p=!1){return(new d).initialize([],e,k,p,1)};b.createEmptyOptimizedCIM=function(e,k=!1,p=!1){return(new c).initialize(new u,e,k,p,1)};b.createEmptyJSONCIM=function(e,k=!1,p=!1){return(new a).initialize([],e,k,p,1)};var g=b.prototype;g.asJSON=function(){const e=D.collectMultipath(this);return"esriGeometryEnvelope"===
this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}};g.invertY=function(){this.yFactor*=-1};return l._createClass(b)}(),f=function(b){function g(){var k=b.apply(this,arguments)||this;k._end=-1;return k}l._inherits(g,b);var e=g.prototype;e.initialize=function(k,p,q,t,v){this.hasZ=
q;this.hasM=t;this.geometryType=p;this._stride=2+Number(q)+Number(t);this._geometry=k;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=v;return this};e.reset=function(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)};e.seekPathStart=function(){this._pointOffset=this._pathOffset-this._stride};e.seekPathEnd=function(){this._pointOffset=this._end};e.seekInPath=function(k){k=this._pathOffset+k*this._stride;return 0<=k&&
k<this._end?(this._pointOffset=k,!0):!1};e.nextPoint=function(){return(this._pointOffset+=this._stride)<this._end};e.prevPoint=function(){return(this._pointOffset-=this._stride)>=this._pathOffset};e.nextPath=function(){0<=this._pathIndex&&(this._pathOffset+=this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex]));this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*(this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex+
1]);return++this._pathIndex<this.numPaths};e.pathLength=function(){const k=this._end,p=this._stride,q=this._geometry.coords;let t=0;for(let v=this._pathOffset+p;v<k;v+=p){const y=q[v]-q[v-p],w=q[v+1]-q[v-p+1];t+=Math.sqrt(y*y+w*w)}return t};e.startPath=function(){this._geometry.lengths.push(0)};e.pushPath=function(k){this.startPath();this.pushPoints(k)};e.pushPoint=function(k){for(let p=0;p<this._stride;++p)this._geometry.coords.push(k[p]);this._geometry.lengths[this.numPaths-1]++};e.pushXY=function(k,
p){this._geometry.coords.push(k,p);this._geometry.lengths[this.numPaths-1]++};e.pushPoints=function(k){for(const p of k)for(let q=0;q<this._stride;++q)this._geometry.coords.push(p[q]);this._geometry.lengths[this.numPaths-1]+=k.length};e.asOptimized=function(){const k=this._geometry.clone();if(1!==this.yFactor)for(let p=1;p<k.coords.length;p+=this._stride)k.coords[p]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(k.lengths.length=0);return k};e.isClosed=function(){const k=this._geometry.coords,
p=this._pathOffset,q=this._end-this._stride;for(let t=0;t<this._stride;t++)if(k[p+t]!==k[q+t])return!1;return!0};e.clone=function(){return(new g).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)};l._createClass(g,[{key:"numPoints",get:function(){const {lengths:k}=this._geometry;return 0>this._pathIndex||this._pathIndex>k.length-1?0:k[this._pathIndex]}},{key:"numPaths",get:function(){return this._geometry.lengths.length}},{key:"x",get:function(){return this._geometry.coords[this._pointOffset]},
set:function(k){this._geometry.coords[this._pointOffset]=k}},{key:"y",get:function(){return this.yFactor*this._geometry.coords[this._pointOffset+1]},set:function(k){this._geometry.coords[this._pointOffset+1]=this.yFactor*k}},{key:"z",get:function(){return this._geometry.coords[this._pointOffset+2]},set:function(k){this._geometry.coords[this._pointOffset+2]=k}},{key:"m",get:function(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]},set:function(k){this._geometry.coords[this._pointOffset+
3]=k}},{key:"pathIndex",get:function(){return this._pathIndex}},{key:"pointIndex",get:function(){return this._pointOffset/this._stride}}]);return g}(h),d=function(b){function g(){return b.apply(this,arguments)||this}l._inherits(g,b);var e=g.prototype;e.initialize=function(k,p,q,t,v){this._paths=k;this.geometryType=p;this.hasZ=q;this.hasM=t;this._pathIndex=this._pointIndex=-1;this.yFactor=v;this._mIdx=this.hasZ?3:2;return this};e.reset=function(){this._pathIndex=this._pointIndex=-1};e.seekPathStart=
function(){this._pointIndex=-1};e.seekPathEnd=function(){this._pointIndex=this._currentPath.length};e.seekInPath=function(k){return 0<=k&&k<this._currentPath.length?(this._pointIndex=k,this._currentPoint=this._currentPath[this._pointIndex],!0):!1};e.nextPoint=function(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length};e.prevPoint=function(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex};e.nextPath=function(){this._pointIndex=
-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.numPaths};e.pathLength=function(){const k=this._currentPath.length,p=this._currentPath;let q=0;for(let v=1;v<k;v++){var t=p[v-1];const y=p[v],w=y[0]-t[0];t=y[1]-t[1];q+=Math.sqrt(w*w+t*t)}return q};e.startPath=function(){this._paths.push([])};e.pushPath=function(k){this._paths.push(k)};e.pushPoint=function(k){this._paths[this.pathIndex].push(k)};e.pushXY=function(k,p){this._paths[this.pathIndex].push([k,p])};e.pushPoints=
function(k){this._paths[this.pathIndex].push(...k)};e.asOptimized=function(){const k=new u;if("esriGeometryPoint"===this.geometryType)k.coords.push(...this._paths[0][0]),k.lengths.length=0;else for(const p of this._paths){for(const q of p)k.coords.push(q[0]),k.coords.push(q[1]*this.yFactor),this.hasZ&&k.coords.push(q[2]),this.hasM&&k.coords.push(q[this._mIdx]);k.lengths.push(p.length)}return k};e.isClosed=function(){const k=this._currentPath[0],p=this._currentPath[this._currentPath.length-1];for(let q=
0;q<k.length;q++)if(k[q]!==p[q])return!1;return!0};e.clone=function(){return(new g).initialize(F.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)};l._createClass(g,[{key:"numPoints",get:function(){return 0>this._pathIndex||this._pathIndex>this.numPaths-1?-1:this._paths[this._pathIndex].length}},{key:"numPaths",get:function(){return this._paths.length}},{key:"x",get:function(){return this._currentPoint[0]},set:function(k){this._currentPoint[0]=k}},{key:"y",get:function(){return this.yFactor*
this._currentPoint[1]},set:function(k){this._currentPoint[1]=this.yFactor*k}},{key:"z",get:function(){return this._currentPoint[2]},set:function(k){this._currentPoint[2]=k}},{key:"m",get:function(){return this._currentPoint[this._mIdx]},set:function(k){this._currentPoint[this._mIdx]=k}},{key:"pathIndex",get:function(){return this._pathIndex}},{key:"pointIndex",get:function(){return this._pointIndex}}]);return g}(h),c=function(b){function g(){return b.apply(this,arguments)||this}l._inherits(g,b);var e=
g.prototype;e.initialize=function(k,p,q,t,v){l._get(l._getPrototypeOf(g.prototype),"initialize",this).call(this,k,p,q,t,v);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.numPaths).fill(void 0).map(y=>new Set));return this};e.startPath=function(){l._get(l._getPrototypeOf(g.prototype),"startPath",this).call(this);this._controlPoints.push(new Set)};e.clone=function(){const k=(new g).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);k._controlPoints=
this._controlPoints;return k};e.setControlPoint=function(){this._controlPoints[this.pathIndex].add(this.pointIndex)};e.getControlPoint=function(){return this._controlPoints[this.pathIndex].has(this.pointIndex)};e.setControlPointAt=function(k){this._controlPoints[this.pathIndex].add(k)};e.getControlPointAt=function(k){return this._controlPoints[this.pathIndex].has(k)};return l._createClass(g)}(f),a=function(b){function g(){return b.apply(this,arguments)||this}l._inherits(g,b);var e=g.prototype;e.initialize=
function(k,p,q,t,v){return l._get(l._getPrototypeOf(g.prototype),"initialize",this).call(this,k,p,q,t,v)};e.clone=function(){return(new g).initialize(F.clone(this._paths),this.geometryType,this.hasZ,this.hasM,1)};e.setControlPoint=function(){this._paths[this.pathIndex][this.pointIndex][4]=1};e.getControlPoint=function(){return 1===this._paths[this.pathIndex][this.pointIndex][4]};e.setControlPointAt=function(k){this._paths[this.pathIndex][k][4]=1};e.getControlPointAt=function(k){return 1===this._paths[this.pathIndex][k][4]};
return l._createClass(g)}(d);n.GeometryCursor=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(n,l,F,D){let A,u=function(){function m(h){this._geometry=h}m.prototype.next=function(){const h=this._geometry;this._geometry=null;return h};return l._createClass(m)}();n.SimpleEffectCursor=u;n.clipCursorToTileExtent=
function(m,h){A||(A=new D.TileClipper(0,0,0,1));var f="esriGeometryPolygon"===m.geometryType;const d=f?3:2;A.reset(f?D.GeometryType.Polygon:D.GeometryType.LineString);A.setPixelMargin(h+1);A.setExtent(512);let c;for(;m.nextPath();)if(!(m.numPoints<d)){m.nextPoint();h=m.x;c=-m.y;for(A.moveTo(h,c);m.nextPoint();)h=m.x,c=-m.y,A.lineTo(h,c);f&&A.close()}if(f=A.result(!1)){m=F.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(const a of f){m.startPath();for(const b of a)m.pushXY(b.x,-b.y)}m.reset();
return m}return null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(n,l){n.GeometryType=void 0;(function(d){d[d.Unknown=0]="Unknown";d[d.Point=1]="Point";d[d.LineString=2]="LineString";d[d.Polygon=3]="Polygon"})(n.GeometryType||(n.GeometryType={}));let F=function(){function d(a,b){this.x=a;this.y=b}var c=d.prototype;c.clone=function(){return new d(this.x,this.y)};c.equals=
function(a,b){return a===this.x&&b===this.y};c.isEqual=function(a){return a.x===this.x&&a.y===this.y};c.setCoords=function(a,b){this.x=a;this.y=b};c.normalize=function(){var a=this.x;const b=this.y;a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a};c.rightPerpendicular=function(){const a=this.x;this.x=this.y;this.y=-a};c.move=function(a,b){this.x+=a;this.y+=b};c.assign=function(a){this.x=a.x;this.y=a.y};c.assignAdd=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y};c.assignSub=function(a,b){this.x=a.x-b.x;this.y=
a.y-b.y};c.rotate=function(a,b){const g=this.x,e=this.y;this.x=g*a-e*b;this.y=g*b+e*a};c.scale=function(a){this.x*=a;this.y*=a};c.length=function(){const a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};d.distance=function(a,b){const g=b.x-a.x;a=b.y-a.y;return Math.sqrt(g*g+a*a)};d.add=function(a,b){return new d(a.x+b.x,a.y+b.y)};d.sub=function(a,b){return new d(a.x-b.x,a.y-b.y)};return l._createClass(d)}(),D=l._createClass(function(d,c,a){this.ratio=d;this.x=c;this.y=a}),A=function(){function d(a,b,
g,e=8,k=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=e;this._pixelMargin=k;this._tileSize=512*e;this._dz=a;this._yPos=b;this._xPos=g}var c=d.prototype;c.setPixelMargin=function(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))};c.setExtent=function(a){this._extent=a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-
b;this._ymin=a*this._yPos-b;this._xmax=this._xmin+a+2*b;this._ymax=this._ymin+a+2*b};c.reset=function(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0};c.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new F(a,b);this._firstPt=new F(a,b);this._dist=0};c.lineTo=function(a,b){const g=this._isIn(a,b),e=new F(a,b),k=F.distance(this._prevPt,e);if(g)if(this._prevIsIn)this._lineTo(a,b,!0);else{var p=this._prevPt;
var q=e;a=this._intersect(q,p);this._start=this._dist+k*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(q.x,q.y,!0)}else if(this._prevIsIn)q=this._prevPt,p=e,a=this._intersect(q,p),this._lineTo(a.x,a.y,!0),this._lineTo(p.x,p.y,!1);else{const v=this._prevPt;if(!(v.x<=this._xmin&&e.x<=this._xmin||v.x>=this._xmax&&e.x>=this._xmax||v.y<=this._ymin&&e.y<=this._ymin||v.y>=this._ymax&&e.y>=this._ymax)){a=[];if(v.x<this._xmin&&e.x>this._xmin||v.x>this._xmin&&e.x<this._xmin){b=(this._xmin-v.x)/(e.x-v.x);
var t=v.y+b*(e.y-v.y);t<=this._ymin?q=!1:t>=this._ymax?q=!0:a.push(new D(b,this._xmin,t))}if(v.x<this._xmax&&e.x>this._xmax||v.x>this._xmax&&e.x<this._xmax)b=(this._xmax-v.x)/(e.x-v.x),t=v.y+b*(e.y-v.y),t<=this._ymin?q=!1:t>=this._ymax?q=!0:a.push(new D(b,this._xmax,t));if(v.y<this._ymin&&e.y>this._ymin||v.y>this._ymin&&e.y<this._ymin)b=(this._ymin-v.y)/(e.y-v.y),t=v.x+b*(e.x-v.x),t<=this._xmin?p=!1:t>=this._xmax?p=!0:a.push(new D(b,t,this._ymin));if(v.y<this._ymax&&e.y>this._ymax||v.y>this._ymax&&
e.y<this._ymax)b=(this._ymax-v.y)/(e.y-v.y),t=v.x+b*(e.x-v.x),t<=this._xmin?p=!1:t>=this._xmax?p=!0:a.push(new D(b,t,this._ymax));if(0===a.length)p?q?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):q?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+k*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+k*a[0].ratio,p=0;p<a.length;p++)this._lineTo(a[p].x,
a[p].y,!0)}this._lineTo(e.x,e.y,!1)}this._dist+=k;this._prevIsIn=g;this._prevPt=e};c.close=function(){if(2<this._line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};c.result=function(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===n.GeometryType.Polygon&&a&&h.simplify(this._tileSize,
this._margin*this._finalRatio,this._lines);return this._lines};c.resultWithStarts=function(){if(this._type!==n.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const g=[];for(let e=0;e<b;e++)g.push({line:a[e],start:this._starts[e]||0});return g};c._isIn=function(a,b){return a>=this._xmin&&a<=this._xmax&&b>=this._ymin&&b<=this._ymax};c._intersect=function(a,b){let g,e,k;if(b.x>=this._xmin&&b.x<=this._xmax)e=b.y<=this._ymin?
this._ymin:this._ymax,k=(e-a.y)/(b.y-a.y),g=a.x+k*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)g=b.x<=this._xmin?this._xmin:this._xmax,k=(g-a.x)/(b.x-a.x),e=a.y+k*(b.y-a.y);else{e=b.y<=this._ymin?this._ymin:this._ymax;g=b.x<=this._xmin?this._xmin:this._xmax;const p=(g-a.x)/(b.x-a.x),q=(e-a.y)/(b.y-a.y);p<q?(k=p,e=a.y+p*(b.y-a.y)):(k=q,g=a.x+q*(b.x-a.x))}this._r=k;return new F(g,e)};c._pushLine=function(){this._line&&(this._type===n.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),
this._starts.push(this._start)):this._type===n.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0};c._moveTo=function(a,b,g){this._type!==n.GeometryType.Polygon?g&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new F(a,
b))):(g||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new F(a,b)),this._isV=this._isH=!1)};c._lineTo=function(a,b,g){if(this._type!==n.GeometryType.Polygon)if(g){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&
(g=this._line[this._line.length-1],g.equals(a,b)))return;this._line.push(new F(a,b))}else this._line&&0<this._line.length&&this._pushLine();else if(g||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){g=this._line[this._line.length-1];const e=g.x===a,k=g.y===b;e&&k||(this._isH&&
e?(g.x=a,g.y=b,g=this._line[this._line.length-2],g.x===a&&g.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(g=this._line[this._line.length-2],this._isH=g.x===a,this._isV=g.y===b)):(this._isH=g.x===a,this._isV=g.y===b)):this._isV&&k?(g.x=a,g.y=b,g=this._line[this._line.length-2],g.x===a&&g.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(g=this._line[this._line.length-2],this._isH=g.x===a,this._isV=g.y===b)):(this._isH=g.x===a,this._isV=g.y===b)):(this._line.push(new F(a,
b)),this._isH=e,this._isV=k))}else this._line.push(new F(a,b))};return l._createClass(d)}(),u=function(){function d(){}var c=d.prototype;c.setExtent=function(a){this._ratio=4096===a?1:4096/a};c.reset=function(a){this._lines=[];this._line=null};c.moveTo=function(a,b){this._line&&this._lines.push(this._line);this._line=[];const g=this._ratio;this._line.push(new F(a*g,b*g))};c.lineTo=function(a,b){const g=this._ratio;this._line.push(new F(a*g,b*g))};c.close=function(){const a=this._line;a&&!a[0].isEqual(a[a.length-
1])&&a.push(a[0])};c.result=function(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines};l._createClass(d,[{key:"validateTessellation",get:function(){return 1>this._ratio}}]);return d}();var m;(function(d){d[d.sideLeft=0]="sideLeft";d[d.sideRight=1]="sideRight";d[d.sideTop=2]="sideTop";d[d.sideBottom=3]="sideBottom"})(m||(m={}));let h=function(){function d(){}d.simplify=function(c,a,b){if(b){var g=-a,e=c+a,k=-a,p=c+a;c=[];a=[];var q=b.length;for(let t=0;t<q;++t){const v=
b[t];if(!v||2>v.length)continue;let y=v[0],w;const z=v.length;for(let r=1;r<z;++r)w=v[r],y.x===w.x&&(y.x<=g&&(y.y>w.y?(c.push(t),c.push(r),c.push(m.sideLeft),c.push(-1)):(a.push(t),a.push(r),a.push(m.sideLeft),a.push(-1))),y.x>=e&&(y.y<w.y?(c.push(t),c.push(r),c.push(m.sideRight),c.push(-1)):(a.push(t),a.push(r),a.push(m.sideRight),a.push(-1)))),y.y===w.y&&(y.y<=k&&(y.x<w.x?(c.push(t),c.push(r),c.push(m.sideTop),c.push(-1)):(a.push(t),a.push(r),a.push(m.sideTop),a.push(-1))),y.y>=p&&(y.x>w.x?(c.push(t),
c.push(r),c.push(m.sideBottom),c.push(-1)):(a.push(t),a.push(r),a.push(m.sideBottom),a.push(-1)))),y=w}0!==c.length&&0!==a.length&&(d.fillParent(b,a,c),d.fillParent(b,c,a),g=[],d.calcDeltas(g,a,c),d.calcDeltas(g,c,a),d.addDeltas(g,b))}};d.fillParent=function(c,a,b){const g=b.length,e=a.length;for(let v=0;v<e;v+=4){var k=a[v],p=a[v+1];const y=a[v+2],w=c[k][p-1];k=c[k][p];p=8092;let z=-1;for(let r=0;r<g;r+=4){if(b[r+2]!==y)continue;var q=b[r];const C=b[r+1];var t=c[q][C-1];q=c[q][C];switch(y){case m.sideLeft:case m.sideRight:f(w.y,
t.y,q.y)&&f(k.y,t.y,q.y)&&(t=Math.abs(q.y-t.y),t<p&&(p=t,z=r));break;case m.sideTop:case m.sideBottom:f(w.x,t.x,q.x)&&f(k.x,t.x,q.x)&&(t=Math.abs(q.x-t.x),t<p&&(p=t,z=r))}}a[v+3]=z}};d.calcDeltas=function(c,a,b){const g=a.length;for(let e=0;e<g;e+=4){const k=d.calcDelta(e,a,b,[]);c.push(a[e]);c.push(a[e+1]);c.push(a[e+2]);c.push(k)}};d.calcDelta=function(c,a,b,g){c=a[c+3];if(-1===c)return 0;const e=g.length;if(1<e&&g[e-2]===c)return 0;g.push(c);return d.calcDelta(c,b,a,g)+1};d.addDeltas=function(c,
a){const b=c.length;let g=0;for(var e=0;e<b;e+=4){var k=c[e+3];k>g&&(g=k)}for(e=0;e<b;e+=4){k=a[c[e]];const p=c[e+1],q=g-c[e+3];switch(c[e+2]){case m.sideLeft:k[p-1].x-=q;k[p].x-=q;1===p&&(k[k.length-1].x-=q);p===k.length-1&&(k[0].x-=q);break;case m.sideRight:k[p-1].x+=q;k[p].x+=q;1===p&&(k[k.length-1].x+=q);p===k.length-1&&(k[0].x+=q);break;case m.sideTop:k[p-1].y-=q;k[p].y-=q;1===p&&(k[k.length-1].y-=q);p===k.length-1&&(k[0].y-=q);break;case m.sideBottom:k[p-1].y+=q,k[p].y+=q,1===p&&(k[k.length-
1].y+=q),p===k.length-1&&(k[0].y+=q)}}};return l._createClass(d)}();const f=(d,c,a)=>d>=c&&d<=a||d>=a&&d<=c;n.Point=F;n.SimpleBuilder=u;n.TileClipper=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(){}var F=l.prototype;F.applyColorSubstituition=function(D,A){if(!A)return D;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));
const {width:u,height:m}=D,h=this._rasterizationCanvas,f=h.getContext("2d");D!==h&&(h.width=u,h.height=m,f.drawImage(D,0,0,u,m));D=f.getImageData(0,0,u,m).data;if(A)for(var d of A)if(d&&d.oldColor&&4===d.oldColor.length&&d.newColor&&4===d.newColor.length){const [c,a,b,g]=d.oldColor,[e,k,p,q]=d.newColor;if(c!==e||a!==k||b!==p||g!==q)for(A=0;A<D.length;A+=4)c===D[A]&&a===D[A+1]&&b===D[A+2]&&g===D[A+3]&&(D[A]=e,D[A+1]=k,D[A+2]=p,D[A+3]=q)}d=new ImageData(D,u,m);f.putImageData(d,0,0);return h};F.tintImageData=
function(D,A){if(!A||4>A.length)return D;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:u,height:m}=D,h=this._rasterizationCanvas,f=h.getContext("2d");D!==h&&(h.width=u,h.height=m,f.drawImage(D,0,0,u,m));D=f.getImageData(0,0,u,m);D=new Uint8Array(D.data);A=[A[0]/255,A[1]/255,A[2]/255,A[3]/255];for(let d=0;d<D.length;d+=4)D[d]*=A[0],D[d+1]*=A[1],D[d+2]*=A[2],D[d+3]*=A[3];A=new ImageData(new Uint8ClampedArray(D.buffer),u,m);f.putImageData(A,0,0);
return h};return n._createClass(l)}()})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w){n.getEffectOperator=function(z){if(!z)return null;switch(z.type){case "CIMGeometricEffectAddControlPoints":return l.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return F.EffectArrow.local();case "CIMGeometricEffectBuffer":return D.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return A.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return u.EffectCut.local();case "CIMGeometricEffectDashes":return m.EffectDashes.local();
case "CIMGeometricEffectDonut":return h.EffectDonut.local();case "CIMGeometricEffectJog":return f.EffectJog.local();case "CIMGeometricEffectMove":return d.EffectMove.local();case "CIMGeometricEffectOffset":return c.EffectOffset.local();case "CIMGeometricEffectReverse":return a.EffectReverse.local();case "CIMGeometricEffectRotate":return b.EffectRotate.local();case "CIMGeometricEffectScale":return g.EffectScale.local();case "CIMGeometricEffectWave":return e.EffectWave.local()}return null};n.getPlacementOperator=
function(z){if(!z)return null;switch(z.type){case "CIMMarkerPlacementAlongLineSameSize":return k.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return p.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return q.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return t.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return v.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return y.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return w.PlacementPolygonCenter.local()}return null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function A(){}A.local=function(){null===A.instance&&(A.instance=new A);return A.instance};A.prototype.execute=function(u,m,h,f,d){return new D(u,m,h)};return l._createClass(A)}();F.instance=
null;let D=function(){function A(m,h,f){this._inputGeometries=m;this._angleTolerance=void 0!==h.angleTolerance?h.angleTolerance:120;this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}var u=A.prototype;u.next=function(){let m=this._inputGeometries.next();for(;m;){if("esriGeometryPolygon"===m.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===m.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===m.geometryType){if(this._maxCosAngle)return m;this._isClosed=
!0}else{m=this._inputGeometries.next();continue}for(;m.nextPath();)this._processPath(m);m.reset();return m}return null};u._processPath=function(m){if(m.nextPoint()){const h=m.x,f=m.y;let d=h,c=f,a=m.numPoints,b=0,g=0,e=0,k=0,p=0,q=0;this._isClosed&&++a;for(let t=1;m.nextPoint()||t<a;++t){let v,y;this._isClosed&&t===a-1?(v=h,y=f):(v=m.x,y=m.y);const w=v-d,z=y-c,r=Math.sqrt(w*w+z*z);1<t&&0<r&&0<e&&(b*w+g*z)/r/e<=this._maxCosAngle&&m.setControlPointAt(t-1);1===t&&(k=w,p=z,q=r);0<r&&(d=v,c=y,b=w,g=z,
e=r)}this._isClosed&&0<e&&0<q&&(b*k+g*p)/q/e<=this._maxCosAngle&&m.setControlPointAt(0)}};return l._createClass(A)}();n.EffectAddControlPoints=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(n,l,F,D,A,u,m){const h=m.GeometricEffectArrowType.OpenEnded;
let f=function(){function c(){}c.local=function(){null===c.instance&&(c.instance=new c);return c.instance};c.prototype.execute=function(a,b,g,e,k){return new d(a,b,g)};return l._createClass(c)}();f.instance=null;let d=function(c){function a(g,e,k){g=c.call(this,g,!1,!0)||this;g._curveHelper=new u.CurveHelper;g._width=(void 0!==e.width?e.width:5)*k;g._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:h;g._offsetFlattenError=u.PIXEL_TOLERANCE*
k;return g}l._inherits(a,c);var b=a.prototype;b.processPath=function(g){const e=F.GeometryCursor.createEmptyOptimizedCIM(g.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(e,g,!0);break;case m.GeometricEffectArrowType.Block:this._constructSimpleArrow(e,g,!1);break;case m.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(e,g)}return e};b._constructSimpleArrow=function(g,e,k){var p=e.pathLength(),q=this._width;p<2*q&&(q=p/2);var t=this._curveHelper.getSubCurve(e,0,
p-q);if(t&&t.nextPath()&&(t.seekPathStart(),p=q/2,!this._curveHelper.isEmpty(t)&&(t=D.collectPath(t),q=this._constructOffset(t,-p)))&&(t=this._constructOffset(t,p))){var v=this._constructArrowBasePoint(q,-p/2);v&&(p=this._constructArrowBasePoint(t,p/2))&&(e.seekInPath(e.numPoints-1),e=[e.x,e.y],g.pushPath(t),g.nextPath(),g.nextPoint(),g.setControlPoint(),g.pushPoint(p),g.nextPoint(),g.setControlPoint(),g.pushPoint(e),g.nextPoint(),g.setControlPoint(),g.pushPoint(v),g.nextPoint(),g.setControlPoint(),
g.pushPoints(q.reverse()),g.setControlPoint(),k||(g.setControlPointAt(0),g.setControlPointAt(g.numPoints-1),g.pushPoint(t[0])),g.reset())}};b._constructCrossedArrow=function(g,e){var k=e.pathLength(),p=this._width;k<3.732050807568877*p&&(p=k/3.732050807568877);e.seekPathStart();var q=this._curveHelper.getSubCurve(e,0,k-2.732050807568877*p);if(q){q.nextPath();var t=p/2;if(!this._curveHelper.isEmpty(q)){var v=D.collectPath(q);if(q=this._constructOffset(v,t))if(v=this._constructOffset(v,-t))if(k=this._curveHelper.getSubCurve(e,
0,k-p))if(k.nextPath(),!this._curveHelper.isEmpty(k)&&(k=D.collectPath(k),p=this._constructOffset(k,t))){var y=this._constructOffset(k,-t);if(y&&(k=p[p.length-1],p=this._constructArrowBasePoint(p,t/2))){var w=y[y.length-1];if(t=this._constructArrowBasePoint(y,-t/2))e.seekInPath(e.numPoints-1),e=[e.x,e.y],g.pushPath(q),g.nextPath(),g.nextPoint(),g.setControlPoint(),g.pushPoint(w),g.nextPoint(),g.setControlPoint(),g.pushPoint(t),g.nextPoint(),g.setControlPoint(),g.pushPoint(e),g.nextPoint(),g.setControlPoint(),
g.pushPoint(p),g.nextPoint(),g.setControlPoint(),g.pushPoint(k),g.nextPoint(),g.setControlPoint(),g.pushPoints(v.reverse()),g.nextPoint(),g.setControlPoint(),g.reset()}}}}};b._constructOffset=function(g,e){return this._curveHelper.offset(g,e,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)};b._constructArrowBasePoint=function(g,e){if(!g||2>g.length)return null;var k=g[g.length-2];g=g[g.length-1];k=[g[0]-k[0],g[1]-k[1]];this._curveHelper.normalize(k);return[g[0]+k[1]*e,g[1]-k[0]*e]};
return l._createClass(a)}(A.PathEffectCursor);n.EffectArrow=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./CIMPlacements"],function(n,l,F){let D=function(){function u(m,h=!0,f=!0,d=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!h&&"esriGeometryPolygon"===m.geometryType||!f&&"esriGeometryPolyline"===m.geometryType?null:m;this.geomUnitsPerPoint=d;this.iteratePath=
!1;this.internalPlacement=new F.Placement}u.prototype.next=function(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.nextPath();){this.geometryCursor.seekPathStart();const m=this.processPath(this.geometryCursor);if(m)return m}return this.geometryCursor=null};return l._createClass(u)}(),A=function(){function u(m,h,f,d=0){this.isClosed=!1;this.inputGeometries=m;this.acceptPolygon=h;this.acceptPolyline=f;this.geomUnitsPerPoint=d;this.iteratePath=!1;this.multiPathCursor=
null}u.prototype.next=function(){for(;;){if(!this.multiPathCursor){for(var m=this.inputGeometries.next();m&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===m.geometryType||"esriGeometryEnvelope"===m.geometryType,this.multiPathCursor=m);)m=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),m=this.processPath(this.multiPathCursor))return m;this.multiPathCursor=null}};return l._createClass(u)}();
n.PathEffectCursor=A;n.PathTransformationCursor=D;n.getId=function(u){return u[4]};n.setId=function(u,m){u[4]=m};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../geometry/GeometryCursor","./enums"],function(n,l,F,D){let A=function(){function u(h,f){}var m=u.prototype;m.isEmpty=function(h){if(!h.nextPoint())return!0;let f,d,c,a;f=h.x;for(d=h.y;h.nextPoint();f=d,d=a)if(c=h.x,a=
h.y,c!==f||a!==d)return h.seekPathStart(),!1;h.seekPathStart();return!0};m.normalize=function(h){const f=Math.sqrt(h[0]*h[0]+h[1]*h[1]);0!==f&&(h[0]/=f,h[1]/=f)};m.getLength=function(h,f,d,c){h=d-h;f=c-f;return Math.sqrt(h*h+f*f)};m.getSegLength=function(h){const [[f,d],[c,a]]=h;return this.getLength(f,d,c,a)};m.getCoord2D=function(h,f,d,c,a){return[h+(d-h)*a,f+(c-f)*a]};m.getSegCoord2D=function(h,f){const [[d,c],[a,b]]=h;return this.getCoord2D(d,c,a,b,f)};m.getAngle=function(h,f,d,c,a){return Math.atan2(c-
f,d-h)};m.getAngleCS=function(h,f,d,c,a){h=d-h;f=c-f;c=Math.sqrt(h*h+f*f);return 0<c?[h/c,f/c]:[1,0]};m.getSegAngleCS=function(h,f){const [[d,c],[a,b]]=h;return this.getAngleCS(d,c,a,b,f)};m.cut=function(h,f,d,c,a,b){a=0>=a?[h,f]:this.getCoord2D(h,f,d,c,a);h=1<=b?[d,c]:this.getCoord2D(h,f,d,c,b);return[a,h]};m.getSubCurve=function(h,f,d){const c=F.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(c,h,f,d)?c:null};m.appendSubCurve=function(h,f,d,c){h.startPath();
f.seekPathStart();let a=0;var b=!0;if(!f.nextPoint())return!1;var g=f.x;let e=f.y;for(;f.nextPoint();){const k=this.getLength(g,e,f.x,f.y);if(0!==k){if(b){if(a+k>d){const p=(d-a)/k;let q=1;b=!1;a+k>=c&&(q=(c-a)/k,b=!0);(g=this.cut(g,e,f.x,f.y,p,q))&&h.pushPoints(g);if(b)break;b=!1}}else{if(a+k>c){(f=this.cut(g,e,f.x,f.y,0,(c-a)/k))&&h.pushPoint(f[1]);break}h.pushXY(f.x,f.y)}a+=k}g=f.x;e=f.y}return!0};m.getCIMPointAlong=function(h,f){if(!h.nextPoint())return null;let d=0,c,a,b,g;c=h.x;for(a=h.y;h.nextPoint();c=
b,a=g){b=h.x;g=h.y;const e=this.getLength(c,a,b,g);if(0!==e){if(d+e>f)return this.getCoord2D(c,a,b,g,(f-d)/e);d+=e}}return null};m.offset=function(h,f,d,c,a){if(!h||2>h.length)return null;var b=0,g=h[b++];for(a=b;b<h.length;){var e=h[b];if(e[0]!==g[0]||e[1]!==g[1])b!==a&&(h[a]=h[b]),g=h[a++];b++}(b=h[0][0]===h[a-1][0]&&h[0][1]===h[a-1][1])&&--a;if(a<(b?3:2))return null;e=[];g=b?h[a-1]:null;let k=h[0];for(let y=0;y<a;y++){const w=y===a-1?b?h[0]:null:h[y+1];if(g)if(w){var p=[w[0]-k[0],w[1]-k[1]];this.normalize(p);
var q=[k[0]-g[0],k[1]-g[1]];this.normalize(q);var t=q[0]*p[1]-q[1]*p[0],v=q[0]*p[0]+q[1]*p[1];if(0===t&&1===v){k=w;continue}if(0<=t===0>=f)1>v&&(p=[p[0]-q[0],p[1]-q[1]],this.normalize(p),q=Math.sqrt((1+v)/2),q>1/c&&(q=-Math.abs(f)/q,e.push([k[0]-p[0]*q,k[1]-p[1]*q])));else switch(d){case D.GeometricEffectOffsetMethod.Mitered:if(g=Math.sqrt((1+v)/2),0<g&&1/g<c){p=[p[0]-q[0],p[1]-q[1]];this.normalize(p);q=Math.abs(f)/g;e.push([k[0]-p[0]*q,k[1]-p[1]*q]);break}case D.GeometricEffectOffsetMethod.Bevelled:e.push([k[0]+
q[1]*f,k[1]-q[0]*f]);e.push([k[0]+p[1]*f,k[1]-p[0]*f]);break;case D.GeometricEffectOffsetMethod.Rounded:if(1>v){e.push([k[0]+q[1]*f,k[1]-q[0]*f]);g=Math.floor(2.5*(1-v));if(0<g){t=v=1/g;for(let z=1;z<g;z++,t+=v){const r=[q[1]*(1-t)+p[1]*t,-q[0]*(1-t)-p[0]*t];this.normalize(r);e.push([k[0]+r[0]*f,k[1]+r[1]*f])}}e.push([k[0]+p[1]*f,k[1]-p[0]*f])}break;default:0>t?(e.push([k[0]+(q[1]+q[0])*f,k[1]+(q[1]-q[0])*f]),e.push([k[0]+(p[1]-p[0])*f,k[1]-(p[0]+p[1])*f])):(g=Math.sqrt((1+Math.abs(v))/2),p=[p[0]-
q[0],p[1]-q[1]],this.normalize(p),q=f/g,e.push([k[0]-p[0]*q,k[1]-p[1]*q]))}}else p=[k[0]-g[0],k[1]-g[1]],this.normalize(p),e.push([k[0]+p[1]*f,k[1]-p[0]*f]);else p=[w[0]-k[0],w[1]-k[1]],this.normalize(p),e.push([k[0]+p[1]*f,k[1]-p[0]*f]);g=k;k=w}if(e.length<(b?3:2))return null;b&&e.push([e[0][0],e[0][1]]);return e};return l._createClass(u)}();n.CurveHelper=A;n.PIXEL_TOLERANCE=.03;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(n,l,F,D,A,u,m,h,f){F=function(){function c(){}c.local=function(){null===c.instance&&(c.instance=new c);return c.instance};c.prototype.execute=function(a,b,g,e,k,p){return new d(a,b,g,e,k,p)};return l._createClass(c)}();F.instance=null;let d=function(){function c(a,b,g,e,k,p){this._inputGeometries=a;this._tileKey=e;this._geometryEngine=k;this._curveHelper=new m.CurveHelper;this._size=(void 0!==b.size?b.size:1)*g;this._maxInflateSize=p*g;this._offsetFlattenError=m.PIXEL_TOLERANCE*g}c.prototype.next=
function(){for(var a;a=this._inputGeometries.next();){if(0===this._size)return a;if("esriGeometryEnvelope"===a.geometryType)if(0<this._size){var b=D.GeometryCursor.createEmptyOptimizedCIM(a.geometryType),g=A.collectMultipath(a)[0];if(g=this._curveHelper.offset(g,this._size,h.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return b.pushPath(g),b}else if(0>this._size&&(b=a.asJSON(),0<Math.min(b.xmax-b.xmin,b.ymax-b.ymin)+2*this._size))return D.GeometryCursor.fromJSONCIM({xmin:b.xmin-
this._size,xmax:b.xmax+this._size,ymin:b.ymin-this._size,ymax:b.ymax+this._size});b=this._geometryEngine;if(null==b)break;if(a=this._tileKey?u.clipCursorToTileExtent(a,this._maxInflateSize):a)return(a=b.buffer(f.WebMercator,a.asJSON(),this._size,1))?D.GeometryCursor.fromJSONCIM(a):null}return null};return l._createClass(c)}();n.EffectBuffer=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums".split(" "),
function(n,l,F,D,A,u){let m=function(){function f(){}f.local=function(){null===f.instance&&(f.instance=new f);return f.instance};f.prototype.execute=function(d,c,a,b,g){return new h(d,c,a)};return l._createClass(f)}();m.instance=null;let h=function(){function f(c,a,b){this._defaultPointSize=20;this._inputGeometries=c;this._geomUnitsPerPoint=b;this._rule=a.rule??u.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*b}var d=f.prototype;d.next=function(){for(var c;c=
this._inputGeometries.next();)if((c=this._processGeom(D.collectMultipath(c)))&&c.length)return F.GeometryCursor.fromJSONCIM({paths:c});return null};d._clone=function(c){return[c[0],c[1]]};d._mid=function(c,a){return[(c[0]+a[0])/2,(c[1]+a[1])/2]};d._mix=function(c,a,b,g){return[c[0]*a+b[0]*g,c[1]*a+b[1]*g]};d._add=function(c,a){return[c[0]+a[0],c[1]+a[1]]};d._add2=function(c,a,b){return[c[0]+a,c[1]+b]};d._sub=function(c,a){return[c[0]-a[0],c[1]-a[1]]};d._dist=function(c,a){return Math.sqrt((c[0]-a[0])*
(c[0]-a[0])+(c[1]-a[1])*(c[1]-a[1]))};d._norm=function(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])};d._normalize=function(c,a=1){a/=this._norm(c);c[0]*=a;c[1]*=a};d._leftPerpendicular=function(c){const a=c[0];c[0]=-c[1];c[1]=a};d._leftPerp=function(c){return[-c[1],c[0]]};d._rightPerpendicular=function(c){const a=-c[0];c[0]=c[1];c[1]=a};d._rightPerp=function(c){return[c[1],-c[0]]};d._dotProduct=function(c,a){return c[0]*a[0]+c[1]*a[1]};d._crossProduct=function(c,a){return c[0]*a[1]-c[1]*a[0]};d._rotateDirect=
function(c,a,b){const g=c[0]*b+c[1]*a;c[0]=c[0]*a-c[1]*b;c[1]=g};d._makeCtrlPt=function(c){c=[c[0],c[1]];A.setId(c,1);return c};d._addAngledTicks=function(c,a,b,g){const e=this._sub(b,a);this._normalize(e);var k=this._crossProduct(e,this._sub(g,a));g=0<k?this._rightPerp(e):this._leftPerp(e);k=Math.abs(k)/2;const p=[];p.push([a[0]+(g[0]-e[0])*k,a[1]+(g[1]-e[1])*k]);p.push(a);p.push(b);p.push([b[0]+(g[0]+e[0])*k,b[1]+(g[1]+e[1])*k]);c.push(p)};d._addBezier2=function(c,a,b,g,e){if(0===e--)c.push(g);
else{var k=this._mid(a,b);b=this._mid(b,g);var p=this._mid(k,b);this._addBezier2(c,a,k,p,e);this._addBezier2(c,p,b,g,e)}};d._addBezier3=function(c,a,b,g,e,k){if(0===k--)c.push(e);else{var p=this._mid(a,b),q=this._mid(b,g);g=this._mid(g,e);b=this._mid(p,q);q=this._mid(q,g);var t=this._mid(b,q);this._addBezier3(c,a,p,b,t,k);this._addBezier3(c,t,q,g,e,k)}};d._add90DegArc=function(c,a,b,g,e){g=e??0<this._crossProduct(this._sub(b,a),this._sub(g,a));e=this._mid(a,b);const k=this._sub(e,a);g?this._leftPerpendicular(k):
this._rightPerpendicular(k);e[0]+=k[0];e[1]+=k[1];this._addBezier3(c,a,this._mix(a,.33333,e,.66667),this._mix(b,.33333,e,.66667),b,4)};d._addArrow=function(c,a,b){var g=a[0],e=a[1],k=a[a.length-1],p=this._sub(g,e);this._normalize(p);const q=this._crossProduct(p,this._sub(k,e));e=.5*q;var t=this._leftPerp(p);const v=[k[0]-t[0]*q,k[1]-t[1]*q];var y=a.length-1;k=[];k.push(b?[-t[0],-t[1]]:t);var w=[-p[0],-p[1]];for(b=1;b<y-1;b++){p=this._sub(a[b+1],a[b]);this._normalize(p);var z=this._dotProduct(p,w);
t=this._crossProduct(p,w);z=Math.sqrt((1+z)/2);w=this._sub(p,w);this._normalize(w);w[0]/=z;w[1]/=z;k.push(0>t?[-w[0],-w[1]]:w);w=p}k.push(this._rightPerp(w));for(y=k.length-1;0<y;y--)c.push([a[y][0]+k[y][0]*e,a[y][1]+k[y][1]*e]);c.push([v[0]+k[0][0]*e,v[1]+k[0][1]*e]);c.push([v[0]+k[0][0]*q,v[1]+k[0][1]*q]);c.push(g);c.push([v[0]-k[0][0]*q,v[1]-k[0][1]*q]);c.push([v[0]-k[0][0]*e,v[1]-k[0][1]*e]);for(g=1;g<k.length;g++)c.push([a[g][0]-k[g][0]*e,a[g][1]-k[g][1]*e])};d._cp2=function(c,a,b){return 2<=
c.length?c[1]:this._add2(c[0],a*this._defaultSize,b*this._defaultSize)};d._cp3=function(c,a,b,g){if(3<=c.length)return c[2];b=this._mix(c[0],1-b,a,b);c=this._sub(a,c[0]);this._normalize(c);this._rightPerpendicular(c);return[b[0]+c[0]*g*this._defaultSize,b[1]+c[1]*g*this._defaultSize]};d._arrowPath=function(c){if(2<c.length)return c;const a=c[0];c=this._cp2(c,-4,0);const b=this._sub(a,c);this._normalize(b);const g=this._rightPerp(b);return[a,c,[a[0]+(g[0]-b[0])*this._defaultSize,a[1]+(g[1]-b[1])*this._defaultSize]]};
d._arrowLastSeg=function(c){var a=c[0];const b=this._cp2(c,-4,0);if(3<=c.length)a=c[c.length-1];else{c=this._sub(a,b);this._normalize(c);const g=this._rightPerp(c);a=[a[0]+(g[0]-c[0])*this._defaultSize,a[1]+(g[1]-c[1])*this._defaultSize]}return[b,a]};d._processGeom=function(c){if(!c)return null;const a=[];for(const b of c){if(!b||0===b.length)continue;const g=b.length;let e=b[0];switch(this._rule){case u.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const k=this._cp2(b,0,-1),
p=this._cp3(b,k,.5,4),q=[];q.push(p);q.push(this._mid(e,k));a.push(q);break;case u.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const t=this._cp2(b,0,-1);a.push([t,e]);break;case u.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const v=this._cp2(b,-4,1),y=this._cp3(b,v,.882353,-1.94),w=[];w.push(this._mid(v,y));w.push(e);a.push(w);break;case u.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const z=this._cp2(b,-4,1),r=this._cp3(b,z,.882353,-1.94),C=this._sub(r,
z);let x;x=0<this._crossProduct(C,this._sub(e,z))?this._rightPerp(x):this._leftPerp(C);const E=[];E.push([z[0]+(x[0]-C[0])/3,z[1]+(x[1]-C[1])/3]);E.push(z);E.push(r);E.push([r[0]+(x[0]+C[0])/3,r[1]+(x[1]+C[1])/3]);a.push(E);break;case u.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const B=this._cp2(b,0,-1),G=this._cp3(b,B,.5,3),H=this._mid(e,B),I=this._sub(H,G);this._normalize(I);const J=this._crossProduct(I,this._sub(e,G));this._leftPerpendicular(I);const L=[];L.push(e);L.push([G[0]+
I[0]*J,G[1]+I[1]*J]);a.push(L);const K=[];K.push([G[0]-I[0]*J,G[1]-I[1]*J]);K.push(B);a.push(K);break;case u.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const S=this._cp2(b,0,-1),W=this._cp3(b,S,.5,3),X=this._mid(e,S),Z=this._sub(X,W);this._normalize(Z);const V=this._crossProduct(Z,this._sub(e,W));this._leftPerpendicular(Z);const O=[];O.push([W[0]+Z[0]*V,W[1]+Z[1]*V]);O.push([W[0]-Z[0]*V,W[1]-Z[1]*V]);a.push(O);break;case u.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const P=
this._cp2(b,0,-1),M=this._cp3(b,P,.5,4),Q=this._mid(e,P),R=this._sub(Q,M);this._normalize(R);const aa=this._crossProduct(R,this._sub(e,M));this._leftPerpendicular(R);const ba=[];ba.push([M[0]+R[0]*aa*.8,M[1]+R[1]*aa*.8]);ba.push([Q[0]+.8*(e[0]-Q[0]),Q[1]+.8*(e[1]-Q[1])]);a.push(ba);a.push([M,Q]);const N=[];N.push([M[0]-R[0]*aa*.8,M[1]-R[1]*aa*.8]);N.push([Q[0]+.8*(P[0]-Q[0]),Q[1]+.8*(P[1]-Q[1])]);a.push(N);break;case u.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const T=this._cp2(b,
0,-1),U=this._cp3(b,T,.5,4),Y=this._mid(e,T);let ca=this._sub(T,e);const da=Math.cos(Math.PI/18),ea=Math.sin(Math.PI/18),fa=Math.sqrt((1+da)/2),ja=Math.sqrt((1-da)/2),ia=[];let ha;0<this._crossProduct(ca,this._sub(U,e))?(ia.push(e),ca=this._sub(e,Y),ha=T):(ia.push(T),ca=this._sub(T,Y),ha=e);this._rotateDirect(ca,fa,ja);ca[0]/=fa;ca[1]/=fa;for(let la=1;18>=la;la++)ia.push(this._add(Y,ca)),this._rotateDirect(ca,da,ea);ia.push(ha);a.push(ia);break;case u.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const ka=
this._cp2(b,0,-1),ma=this._cp3(b,ka,1,-1);let na=this._sub(e,ka);this._normalize(na);const oa=this._crossProduct(na,this._sub(ma,ka))/2;this._leftPerpendicular(na);const pa=[ka[0]+na[0]*oa,ka[1]+na[1]*oa];na=this._sub(ka,pa);const Ea=Math.cos(Math.PI/18);let ta=Math.sin(Math.PI/18);0<oa&&(ta=-ta);const ua=[ka];for(let la=1;18>=la;la++)this._rotateDirect(na,Ea,ta),ua.push(this._add(pa,na));a.push(ua);break;case u.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const wa=this._cp2(b,0,-2),Na=
this._cp3(b,wa,1,-1);let qb;if(4<=g)qb=b[3];else{const la=this._sub(e,wa);qb=this._add(Na,la)}const jc=this._dist(wa,Na)/2/.75,kc=this._sub(wa,e);this._normalize(kc,jc);const lc=this._sub(Na,qb);this._normalize(lc,jc);a.push([qb,Na]);const Lb=[this._clone(Na)];this._addBezier3(Lb,Na,this._add(Na,lc),this._add(wa,kc),wa,4);Lb.push(e);a.push(Lb);break;case u.GeometricEffectControlMeasureLineRule.OpenCircle:const mc=this._cp2(b,-2,0),nc=this._sub(mc,e),Rc=Math.cos(Math.PI/18),Sc=-Math.sin(Math.PI/18),
oc=[mc];for(let la=1;33>=la;la++)this._rotateDirect(nc,Rc,Sc),oc.push(this._add(e,nc));a.push(oc);break;case u.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Fa=this._cp2(b,0,-1);let Oa;if(3<=g)Oa=b[2];else{const la=this._sub(Fa,e),qa=this._leftPerp(la);Oa=[e[0]+qa[0]-.25*la[0],e[1]+qa[1]-.25*la[1]]}let rb;if(4<=g)rb=b[3];else{const la=this._mid(e,Fa),qa=this._sub(e,Fa);this._normalize(qa);this._leftPerpendicular(qa);const sa=this._crossProduct(qa,this._sub(Oa,la));this._rightPerpendicular(qa);
rb=[Oa[0]+qa[0]*sa*2,Oa[1]+qa[1]*sa*2]}const Ba=this._sub(Fa,e);let Pa,za;Pa=0<this._crossProduct(Ba,this._sub(Oa,e))?this._rightPerp(Ba):this._leftPerp(Ba);za=[];za.push(Oa);za.push(e);za.push([e[0]+(Pa[0]-Ba[0])/3,e[1]+(Pa[1]-Ba[1])/3]);a.push(za);Pa=0<this._crossProduct(Ba,this._sub(rb,Fa))?this._rightPerp(Pa):this._leftPerp(Ba);za=[];za.push([Fa[0]+(Pa[0]+Ba[0])/3,Fa[1]+(Pa[1]+Ba[1])/3]);za.push(Fa);za.push(rb);a.push(za);break;case u.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const sb=
this._cp2(b,0,2),Mb=this._cp3(b,sb,0,1);let tb;if(4<=g)tb=b[3];else{const la=this._sub(sb,e);tb=this._add(Mb,la)}this._addAngledTicks(a,e,sb,this._mid(Mb,tb));this._addAngledTicks(a,Mb,tb,this._mid(e,sb));break;case u.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Nb=this._cp2(b,2,0),pc=this._cp3(b,Nb,0,1);let Ob;if(4<=g)Ob=b[3];else{const la=this._sub(Nb,e);Ob=this._add(pc,la)}const Pb=[];Pb.push(this._mid(e,pc));Pb.push(this._mid(Nb,Ob));a.push(Pb);break;case u.GeometricEffectControlMeasureLineRule.Chevron:const qc=
this._cp2(b,-1,-1);let Qb;if(3<=g)Qb=b[2];else{const la=this._sub(qc,e);this._leftPerpendicular(la);Qb=this._add(e,la)}a.push([qc,this._makeCtrlPt(e),Qb]);break;case u.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Ya=this._cp2(b,0,-2),rc=this._cp3(b,Ya,.5,-1);let ra=this._sub(Ya,e);const Za=this._norm(ra);ra[0]/=Za;ra[1]/=Za;const Qa=this._crossProduct(ra,this._sub(rc,e));let $a=this._dotProduct(ra,this._sub(rc,e));$a<.05*Za?$a=.05*Za:$a>.95*Za&&($a=.95*Za);const ub=[e[0]+ra[0]*
$a,e[1]+ra[1]*$a];this._leftPerpendicular(ra);let ab=[];ab.push([ub[0]-ra[0]*Qa,ub[1]-ra[1]*Qa]);ab.push([ub[0]+ra[0]*Qa,ub[1]+ra[1]*Qa]);a.push(ab);const sc=[Ya[0]+ra[0]*Qa,Ya[1]+ra[1]*Qa];ra=this._sub(Ya,sc);const Tc=Math.cos(Math.PI/18);let Rb=Math.sin(Math.PI/18);0>Qa&&(Rb=-Rb);ab=[e,Ya];for(let la=1;9>=la;la++)this._rotateDirect(ra,Tc,Rb),ab.push(this._add(sc,ra));a.push(ab);break;case u.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Sb=this._cp2(b,2,0),tc=this._mid(e,Sb),uc=this._sub(Sb,
tc),Uc=Math.cos(Math.PI/18),Vc=Math.sin(Math.PI/18),vc=[e,Sb];for(let la=1;18>=la;la++)this._rotateDirect(uc,Uc,Vc),vc.push(this._add(tc,uc));a.push(vc);break;case u.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Ra=this._cp2(b,0,-2),Tb=this._cp3(b,Ra,1,-2),Sa=this._mid(e,Ra),Aa=this._sub(Tb,Ra);this._normalize(Aa);const wc=Math.abs(this._crossProduct(Aa,this._sub(Sa,Ra)))/2,bb=this._dist(Ra,Tb),xc=[Ra,e];xc.push([e[0]+Aa[0]*bb*.5,e[1]+Aa[1]*bb*.5]);a.push(xc);const cb=[];cb.push([Sa[0]-
Aa[0]*wc,Sa[1]-Aa[1]*wc]);cb.push([Sa[0]+Aa[0]*bb*.375,Sa[1]+Aa[1]*bb*.375]);A.setId(cb[cb.length-1],1);cb.push([Sa[0]+Aa[0]*bb*.75,Sa[1]+Aa[1]*bb*.75]);a.push(cb);a.push([Ra,Tb]);break;case u.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const gb=this._cp2(b,3,0),Ub=this._cp3(b,gb,.5,-1),hb=this._sub(Ub,gb);this._normalize(hb);const yc=this._crossProduct(hb,this._sub(Ub,e));this._leftPerpendicular(hb);this._addAngledTicks(a,e,gb,Ub);this._addAngledTicks(a,this._mix(e,1,hb,yc),this._mix(gb,
1,hb,yc),this._mid(e,gb));break;case u.GeometricEffectControlMeasureLineRule.Parallel:const ib=this._cp2(b,3,0),Wc=this._cp3(b,ib,.5,-1),Vb=this._sub(ib,e);this._normalize(Vb);const vb=this._leftPerp(Vb),wb=this._crossProduct(Vb,this._sub(Wc,e));let jb=[e,ib];a.push(jb);jb=[];jb.push([e[0]+vb[0]*wb,e[1]+vb[1]*wb]);jb.push([ib[0]+vb[0]*wb,ib[1]+vb[1]*wb]);a.push(jb);break;case u.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const Wb=this._cp2(b,3,0),Xc=this._cp3(b,Wb,.5,-1),xb=
this._mid(e,Wb),Ta=this._sub(Wb,e);this._normalize(Ta);const yb=this._crossProduct(Ta,this._sub(Xc,e));this._leftPerpendicular(Ta);const Xb=[];Xb.push([xb[0]-Ta[0]*yb*.25,xb[1]-Ta[1]*yb*.25]);Xb.push([xb[0]+Ta[0]*yb*1.25,xb[1]+Ta[1]*yb*1.25]);a.push(Xb);break;case u.GeometricEffectControlMeasureLineRule.ParallelOffset:const db=this._cp2(b,3,0),Yc=this._cp3(b,db,.5,-1),xa=this._sub(db,e);this._normalize(xa);const Ga=this._crossProduct(xa,this._sub(Yc,e));this._leftPerpendicular(xa);const Yb=[];Yb.push([e[0]-
xa[0]*Ga,e[1]-xa[1]*Ga]);Yb.push([db[0]-xa[0]*Ga,db[1]-xa[1]*Ga]);a.push(Yb);const Zb=[];Zb.push([e[0]+xa[0]*Ga,e[1]+xa[1]*Ga]);Zb.push([db[0]+xa[0]*Ga,db[1]+xa[1]*Ga]);a.push(Zb);break;case u.GeometricEffectControlMeasureLineRule.OffsetOpposite:const zb=this._cp2(b,3,0),Zc=this._cp3(b,zb,.5,-1),Ua=this._sub(zb,e);this._normalize(Ua);const Ab=this._crossProduct(Ua,this._sub(Zc,e));this._leftPerpendicular(Ua);const $b=[];$b.push([e[0]-Ua[0]*Ab,e[1]-Ua[1]*Ab]);$b.push([zb[0]-Ua[0]*Ab,zb[1]-Ua[1]*Ab]);
a.push($b);break;case u.GeometricEffectControlMeasureLineRule.OffsetSame:const Bb=this._cp2(b,3,0),$c=this._cp3(b,Bb,.5,-1),Va=this._sub(Bb,e);this._normalize(Va);const Cb=this._crossProduct(Va,this._sub($c,e));this._leftPerpendicular(Va);const ac=[];ac.push([e[0]+Va[0]*Cb,e[1]+Va[1]*Cb]);ac.push([Bb[0]+Va[0]*Cb,Bb[1]+Va[1]*Cb]);a.push(ac);break;case u.GeometricEffectControlMeasureLineRule.CircleWithArc:let Ha=this._cp2(b,3,0);const bc=this._cp3(b,Ha,.5,-1);let eb,Db;if(4<=g)eb=b[3],Db=0<this._crossProduct(this._sub(eb,
Ha),this._sub(bc,Ha));else{eb=Ha;Db=0<this._crossProduct(this._sub(eb,e),this._sub(bc,e));const la=24*this._geomUnitsPerPoint,qa=this._sub(eb,e);this._normalize(qa,la);const sa=Math.sqrt(2)/2;this._rotateDirect(qa,sa,Db?sa:-sa);Ha=this._add(e,qa)}const zc=this._sub(Ha,e),ad=Math.cos(Math.PI/18),bd=Math.sin(Math.PI/18),kb=[Ha];for(let la=1;36>=la;la++)this._rotateDirect(zc,ad,bd),kb.push(this._add(e,zc));this._add90DegArc(kb,Ha,eb,bc,Db);A.setId(kb[kb.length-8],1);a.push(kb);break;case u.GeometricEffectControlMeasureLineRule.DoubleJog:let Ia=
this._cp2(b,-3,1),Ja;Ja=3<=g?b[2]:this._add(e,this._sub(e,Ia));let Ca;if(4<=g)Ca=b[3];else{const la=e;e=Ia;Ca=Ja;const qa=this._dist(e,la),sa=this._dist(Ca,la);let Ka=30*this._geomUnitsPerPoint;.5*qa<Ka&&(Ka=.5*qa);.5*sa<Ka&&(Ka=.5*sa);Ia=this._mix(e,Ka/qa,la,(qa-Ka)/qa);Ja=this._mix(Ca,Ka/sa,la,(sa-Ka)/sa)}const Ac=this._mid(e,Ia),Bc=this._mid(Ca,Ja),cd=this._dist(e,Ia),dd=this._dist(Ja,Ca);let Eb=Math.min(cd,dd)/8;Eb=Math.min(Eb,24*this._geomUnitsPerPoint);const La=Math.cos(Math.PI/4);let va=this._sub(e,
Ia);this._normalize(va,Eb);0<this._crossProduct(va,this._sub(Ca,Ia))?this._rotateDirect(va,La,-La):this._rotateDirect(va,La,La);let ya=[];ya.push(Ia);ya.push(this._add(Ac,va));ya.push(this._sub(Ac,va));ya.push(e);a.push(ya);va=this._sub(Ca,Ja);this._normalize(va,Eb);0>this._crossProduct(va,this._sub(e,Ja))?this._rotateDirect(va,La,La):this._rotateDirect(va,La,-La);ya=[];ya.push(Ja);ya.push(this._add(Bc,va));ya.push(this._sub(Bc,va));ya.push(Ca);a.push(ya);break;case u.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Fb=
this._cp2(b,-4,1),Cc=this._cp3(b,Fb,.882353,-1.94),lb=this._sub(Cc,Fb);0<this._crossProduct(lb,this._sub(e,Fb))?this._rightPerpendicular(lb):this._leftPerpendicular(lb);const ed=[lb[0]/8,lb[1]/8],fd=this._sub(this._mid(Fb,Cc),ed);a.push([fd,e]);break;case u.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Dc=this._arrowPath(b),Ec=[];let Fc=Dc.length-2;for(;Fc--;)Ec.push(Dc[Fc]);a.push(Ec);break;case u.GeometricEffectControlMeasureLineRule.MultivertexArrow:const gd=this._arrowPath(b),
Gc=[];this._addArrow(Gc,gd,!1);a.push(Gc);break;case u.GeometricEffectControlMeasureLineRule.CrossedArrow:const hd=this._arrowPath(b),Hc=[];this._addArrow(Hc,hd,!0);a.push(Hc);break;case u.GeometricEffectControlMeasureLineRule.ChevronArrow:const [Ic,mb]=this._arrowLastSeg(b),Gb=10*this._geomUnitsPerPoint,Wa=this._sub(e,Ic);this._normalize(Wa);const Jc=this._crossProduct(Wa,this._sub(mb,Ic)),Kc=this._leftPerp(Wa),Lc=[mb[0]-Kc[0]*Jc*2,mb[1]-Kc[1]*Jc*2],Hb=[];Hb.push([mb[0]+Wa[0]*Gb,mb[1]+Wa[1]*Gb]);
Hb.push(e);Hb.push([Lc[0]+Wa[0]*Gb,Lc[1]+Wa[1]*Gb]);a.push(Hb);break;case u.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [Mc,cc]=this._arrowLastSeg(b),Da=this._sub(e,Mc);this._normalize(Da);const fb=this._crossProduct(Da,this._sub(cc,Mc));this._leftPerpendicular(Da);const nb=[cc[0]-Da[0]*fb,cc[1]-Da[1]*fb],Ib=[];Ib.push([nb[0]+Da[0]*fb*.5,nb[1]+Da[1]*fb*.5]);Ib.push(this._mid(nb,e));Ib.push([nb[0]-Da[0]*fb*.5,nb[1]-Da[1]*fb*.5]);a.push(Ib);break;case u.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [dc,
ec]=this._arrowLastSeg(b),ob=this._sub(e,dc);this._normalize(ob);const Nc=this._crossProduct(ob,this._sub(ec,dc));this._leftPerpendicular(ob);a.push([dc,[ec[0]-ob[0]*Nc,ec[1]-ob[1]*Nc]]);break;case u.GeometricEffectControlMeasureLineRule.Arch:const fc=this._cp2(b,0,-1),Jb=this._cp3(b,fc,.5,1),Oc=this._sub(e,fc),id=this._mix(Jb,1,Oc,.55),jd=this._mix(Jb,1,Oc,-.55),gc=[e];this._addBezier2(gc,e,id,Jb,4);this._addBezier2(gc,Jb,jd,fc,4);a.push(gc);break;case u.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Ma=
this._cp2(b,-4,1),pb=this._cp3(b,Ma,.882353,-1.94),Xa=this._sub(pb,Ma);0<this._crossProduct(Xa,this._sub(e,Ma))?this._rightPerpendicular(Xa):this._leftPerpendicular(Xa);const hc=[Xa[0]/8,Xa[1]/8],Pc=this._sub(this._mid(Ma,pb),hc),kd=this._sub(this._mix(Ma,.75,pb,.25),hc),ld=this._sub(this._mix(Ma,.25,pb,.75),hc),Kb=[Ma];this._addBezier2(Kb,Ma,kd,Pc,3);this._addBezier2(Kb,Pc,ld,pb,3);a.push(Kb);for(let la=0;8>la;la++){const qa=Kb[2*la+1],sa=[this._clone(qa)];sa.push(this._add(qa,[Xa[0]/4,Xa[1]/4]));
a.push(sa)}break;case u.GeometricEffectControlMeasureLineRule.Arc90Degrees:const ic=this._cp2(b,0,-1),md=this._cp3(b,ic,.5,1),Qc=[ic];this._add90DegArc(Qc,ic,e,md);a.push(Qc);break;default:a.push(b)}}return a};return l._createClass(f)}();n.EffectControlMeasureLine=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],
function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(d,c,a){d=h.call(this,d,!0,!0)||this;d._curveHelper=new A.CurveHelper;d._beginCut=(void 0!==c.beginCut?c.beginCut:1)*a;d._endCut=(void 0!==c.endCut?c.endCut:1)*a;d._middleCut=(void 0!==c.middleCut?c.middleCut:0)*a;d._invert=void 0!==c.invert?
c.invert:!1;0>d._beginCut&&(d._beginCut=0);0>d._endCut&&(d._endCut=0);0>d._middleCut&&(d._middleCut=0);return d}l._inherits(f,h);f.prototype.processPath=function(d){const {_beginCut:c,_endCut:a,_middleCut:b}=this,g=d.pathLength(),e=F.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===c&&0===a&&0===b)for(e.startPath();d.nextPoint();)e.pushXY(d.x,d.y);else c+a+b<g&&(0===b?this._curveHelper.appendSubCurve(e,d,c,g-a):(this._curveHelper.appendSubCurve(e,d,c,.5*(g-b)),
this._curveHelper.appendSubCurve(e,d,.5*(g+b),g-a)));else if(0!==c||0!==a||0!==b)if(c+a+b>=g)for(e.startPath();d.nextPoint();)e.pushXY(d.x,d.y);else this._curveHelper.appendSubCurve(e,d,0,c),this._curveHelper.appendSubCurve(e,d,.5*(g-b),.5*(g+b)),this._curveHelper.appendSubCurve(e,d,g-a,a);return 0===e.numPaths?null:e};return l._createClass(f)}(D.PathEffectCursor);n.EffectCut=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker".split(" "),
function(n,l,F,D,A,u,m){let h=function(){function d(){}d.local=function(){null===d.instance&&(d.instance=new d);return d.instance};d.prototype.execute=function(c,a,b,g,e){return new f(c,a,b)};return l._createClass(d)}();h.instance=null;let f=function(d){function c(a,b,g){a=d.call(this,a,!0,!0)||this;a._firstCurve=null;a._walker=new m.GeometryWalker;a._walker.updateTolerance(g);a._endings=b.lineDashEnding;a._customDashPos=-(b.offsetAlongLine??0)*g;a._offsetAtEnd=(b.customEndingOffset??0)*g;a._pattern=
new m.DashPattern;a._pattern.init(b.dashTemplate,!0);a._pattern.scale(g);return a}l._inherits(c,d);c.prototype.processPath=function(a){if(0===this._pattern.length())return this.iteratePath=!1,a=D.collectPath(a),F.GeometryCursor.fromJSONCIM({paths:[a]});if(!this.iteratePath){var b=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case u.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case u.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=
.5*this._pattern.lastValue());break;case u.LineDashEnding.NoConstraint:this.isClosed||(b=!1);break;case u.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var g=a.pathLength();if(this._pattern.isEmpty()||g<.1*this._pattern.length()||!this._walker.init(a,this._pattern,b))return a=D.collectPath(a),F.GeometryCursor.fromJSONCIM({paths:[a]})}if(this.iteratePath)a=this._pattern.nextValue();else{switch(this._endings){default:b=.5*this._pattern.firstValue();break;case u.LineDashEnding.HalfGap:b=
.5*-this._pattern.lastValue();break;case u.LineDashEnding.FullGap:b=-this._pattern.lastValue();break;case u.LineDashEnding.FullPattern:b=0;break;case u.LineDashEnding.NoConstraint:case u.LineDashEnding.Custom:b=-this._customDashPos}a=b/this._pattern.length();a-=Math.floor(a);b=a*this._pattern.length();this._pattern.reset();a=this._pattern.nextValue();for(g=!1;b>=a;)b-=a,a=this._pattern.nextValue(),g=!g;a-=b;g?(this._walker.nextPosition(a),a=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=
this._walker.nextCurve(a),a=this._pattern.nextValue(),this._walker.nextPosition(a),a=this._pattern.nextValue())}if(b=this._walker.nextCurve(a))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)b.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else a=this._pattern.nextValue(),!this._walker.nextPosition(a)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(b=this._firstCurve,this._firstCurve=
null)):this.iteratePath=!0;else this.iteratePath=!1,b=this._firstCurve,this._firstCurve=null;b?.reset();return b};return l._createClass(c)}(A.PathEffectCursor);n.EffectDashes=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../geometry/GeometryCursor","./CurveHelper"],function(n,l,F,D){let A=function(){function f(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=
this.extPtGap=0}var d=f.prototype;d.isEmpty=function(){return 0===this._values.length};d.size=function(){return this._values.length};d.init=function(c,a,b=!0){this._setEmpty();if(!c||0===c.length)return!1;for(let g=0;g<c.length;g++){let e=Math.abs(c[g]);b&&1E-7>e&&(e=1E-7);this._values.push(e);this._length+=e}a&&c.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0};d.scale=function(c){const a=this._values?this._values.length:0;for(let b=
0;b<a;++b)this._values[b]*=c;this._length*=c;this.extPtGap*=c;this.ctrlPtGap*=c};d.addValue=function(c){this._length+=c;this._values.push(c)};d.firstValue=function(){return this._values[0]};d.lastValue=function(){return this._values[this._values.length-1]};d.nextValue=function(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]};d.reset=function(){this._currentValue=-1};d.length=function(){return this._length};d._setEmpty=
function(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0};return l._createClass(f)}(),u=l._createClass(function(){this.pt=null;this.sa=this.ca=0});n.EndType=void 0;(function(f){f[f.FAIL=0]="FAIL";f[f.END=1]="END";f[f.CONTINUE=2]="CONTINUE"})(n.EndType||(n.EndType={}));let m=function(){function f(){this.reset()}var d=f.prototype;d.reset=function(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1};d.isValid=function(){return null!==
this.segment};d.copyTo=function(c){c.segment=this.segment;c.segmentLength=this.segmentLength;c.abscissa=this.abscissa;c.isPathEnd=this.isPathEnd;c.isPartEnd=this.isPartEnd};return l._createClass(f)}(),h=function(f){function d(a=0,b=!1){a=f.call(this,a,b)||this;a._tolerance=D.PIXEL_TOLERANCE;a._currentPosition=new m;return a}l._inherits(d,f);var c=d.prototype;c.updateTolerance=function(a){this._tolerance=D.PIXEL_TOLERANCE*a};c.init=function(a,b,g=!0){g?(this._patternLength=b.length(),this._partExtPtGap=
b.extPtGap,this._partCtrlPtGap=b.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=a;this._seg=-1;return this._setPosAtNextPart()};c.curPositionIsValid=function(){return this._currentPosition.isValid()};c.nextPosition=function(a,b=n.EndType.FAIL){const g=new m;if(!this._nextPosition(a,g,null,b))return!1;g.copyTo(this._currentPosition);return!0};c.curPointAndAngle=function(a){a.pt=this._getPoint(this._currentPosition);
const [b,g]=this._getAngleCS(this._currentPosition);a.ca=b;a.sa=g};c.nextPointAndAngle=function(a,b,g=n.EndType.FAIL){const e=new m;if(!this._nextPosition(a,e,null,g))return!1;e.copyTo(this._currentPosition);b.pt=this._getPoint(e);const [k,p]=this._getAngleCS(e);b.ca=k;b.sa=p;return!0};c.nextCurve=function(a){if(0===a)return null;const b=F.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");b.startPath();b.nextPath();const g=new m;if(!this._nextPosition(a,g,b,n.EndType.END))return null;
g.copyTo(this._currentPosition);return b};c.isPathEnd=function(){return this._currentPosition.isPathEnd};c.getPathEnd=function(){return this._currentPosition.segment[1]};c.getPt=function(a){this._pathCursor.seekInPath(a);return[this._pathCursor.x,this._pathCursor.y]};c.getSeg=function(a){const b=this.getPt(a);a=this.getPt(a+1);return[b,a]};c._nextPosition=function(a,b,g,e){if(this._currentPosition.isPathEnd)return!1;var k=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(k/=this._currentPosition.segmentLength);
for(this._currentPosition.copyTo(b);b.abscissa+a*this._partLengthRatio>b.segmentLength+this._tolerance;)if(g&&(0===g.numPoints&&(0===k?(k=b.segment[0],g.pushXY(k[0],k[1])):g.pushPoint(this.getSegCoord2D(b.segment,k))),k=b.segment[1],g.pushXY(k[0],k[1])),k=0,a-=(b.segmentLength-b.abscissa)/this._partLengthRatio,this._partSegCount)b.segment=this._nextSegment(),b.segmentLength=this.getSegLength(b.segment),b.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(e===n.EndType.FAIL)return!1;
b.segmentLength=this.getSegLength(b.segment);b.isPartEnd=!0;e===n.EndType.END?(b.abscissa=b.segmentLength,b.isPathEnd=!0):b.abscissa=b.segmentLength+a;return!0}this._currentPosition.copyTo(b)}b.abscissa+=a*this._partLengthRatio;g&&(0===g.numPoints&&(0===k?g.pushPoint(b.segment[0]):g.pushPoint(this.getSegCoord2D(b.segment,k))),a=b.abscissa/b.segmentLength,1===a?g.pushPoint(b.segment[1]):g.pushPoint(this.getSegCoord2D(b.segment,a)));!this._partSegCount&&Math.abs(b.abscissa-b.segmentLength)<this._tolerance&&
(b.isPathEnd=this._partIsLast,b.isPartEnd=!0);return!0};c._getPoint=function(a){return this.getSegCoord2D(this._currentPosition.segment,0>=a.segmentLength?0:a.abscissa/a.segmentLength)};c._getAngleCS=function(a){return this.getSegAngleCS(this._currentPosition.segment,0>=a.segmentLength?0:a.abscissa/a.segmentLength)};c._setPosAtNextPart=function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=
!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var a=this._partSegCount;a;)this._previousSegment(),--a;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=
this._currentPosition.isPartEnd=!1;--this._partSegCount;a=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(a);a=a+this._partSegCount+1;a>=this._pathCursor.numPoints&&(a=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(a);if(0<this._patternLength){a=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const b=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let g=Math.round((this._partLength-(a+b))/this._patternLength);0>=g&&(g=0<a+b?0:1);this._partLengthRatio=
this._partLength/(a+b+g*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0};c._hasNextSegment=function(){return this._seg<this._pathCursor.numPoints-2};c._previousSegment=function(){return this.getSeg(--this._seg)};c._nextSegment=function(){return this.getSeg(++this._seg)};c._getStartPointIndex=function(){return this._seg};c._getEndPointIndex=function(){return this._seg+1};return l._createClass(d)}(D.CurveHelper);n.DashPattern=A;n.GeometryWalker=
h;n.Pos=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),function(n,l,F,D,A,u,m){F=function(){function f(){}f.local=function(){null===f.instance&&(f.instance=new f);return f.instance};f.prototype.execute=function(d,c,a,b,g,e){return new h(d,c,a,b,g,e)};return l._createClass(f)}();
F.instance=null;let h=function(){function f(d,c,a,b,g,e){this._inputGeometries=d;this._tileKey=b;this._geometryEngine=g;this._maxInflateSize=e*a;this._width=(void 0!==c.width?c.width:2)*a;this._option=c.option}f.prototype.next=function(){for(var d;d=this._inputGeometries.next();){if("esriGeometryEnvelope"===d.geometryType&&0<this._width){var c=d.asJSON();return 0>Math.min(c.xmax-c.xmin,c.ymax-c.ymin)-2*this._width?d:D.GeometryCursor.fromJSONCIM({paths:[[[c.xmin+this._width,c.ymin+this._width],[c.xmax-
this._width,c.ymin+this._width],[c.xmax-this._width,c.ymax-this._width],[c.xmin+this._width,c.ymax-this._width],[c.xmin+this._width,c.ymin+this._width]],[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]})}if("esriGeometryPolygon"===d.geometryType){if(0===this._width)return d.clone();var a=this._geometryEngine;if(null==a)break;if(d=this._tileKey?A.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()){if(a=a.buffer(m.WebMercator,d.asJSON(),-this._width,1))for(c of a.rings)c&&
d.pushPath(c.reverse());return d}}}return null};return l._createClass(f)}();n.EffectDonut=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,
d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(d,c,a){d=h.call(this,d,!1,!0)||this;d._curveHelper=new A.CurveHelper;d._length=(void 0!==c.length?c.length:20)*a;d._angle=void 0!==c.angle?c.angle:225;d._position=void 0!==c.position?c.position:50;0>d._length&&(d._length=-d._length);20>d._position&&(d._position=20);80<d._position&&(d._position=80);d._mirror=!1;return d}l._inherits(f,h);f.prototype.processPath=function(d){const c=F.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(d))return null;d.seekInPath(0);const a=d.x,b=d.y;d.seekInPath(d.numPoints-1);const g=d.x;d=d.y;this._curveHelper.normalize([g-a,d-b]);const e=a+(g-a)*this._position/100,k=b+(d-b)*this._position/100,p=Math.cos((90-this._angle)/180*Math.PI);let q=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(q=-q);this._mirror=!this._mirror;c.pushPath([[a,b],[e-this._length/2*p,k-this._length/2*q],[e+this._length/2*p,k+this._length/2*q],[g,d]]);return c};return l._createClass(f)}(D.PathEffectCursor);
n.EffectJog=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function A(){}A.local=function(){null===A.instance&&(A.instance=new A);return A.instance};A.prototype.execute=function(u,m,h,f,d){return new D(u,m,h)};return l._createClass(A)}();F.instance=null;let D=function(){function A(m,h,f){this._inputGeometries=m;this._offsetX=void 0!==h.offsetX?
h.offsetX*f:0;this._offsetY=void 0!==h.offsetY?h.offsetY*f:0}var u=A.prototype;u.next=function(){let m=this._inputGeometries.next();for(;m;){if(0<m.numPaths)return this._move(m.clone(),this._offsetX,this._offsetY);m=this._inputGeometries.next()}return null};u._move=function(m,h,f){for(;m.nextPath();)for(;m.nextPoint();)m.x+=h,m.y+=f;m.reset();return m};return l._createClass(A)}();n.EffectMove=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(n,l,F,D,A,u,m,h,f,d){F=function(){function a(){}a.local=function(){null===a.instance&&(a.instance=new a);return a.instance};a.prototype.execute=function(b,g,e,k,p,q){return new c(b,g,e,k,p,q)};return l._createClass(a)}();F.instance=null;let c=function(){function a(b,g,e,k,p,q){this._inputGeometries=b;this._tileKey=k;this._geometryEngine=p;this._curveHelper=new h.CurveHelper;this._offset=(g.offset??1)*e;this._method=g.method;this._maxInflateSize=q*e;this._option=g.option;this._offsetFlattenError=
h.PIXEL_TOLERANCE*e}a.prototype.next=function(){for(var b;b=this._inputGeometries.next();){if(0===this._offset)return b.clone();if("esriGeometryEnvelope"===b.geometryType){if(this._method===f.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var g=A.collectPath(b);if(g=this._curveHelper.offset(g,-this._offset,this._method,4,this._offsetFlattenError))return b=D.GeometryCursor.createEmptyOptimizedCIM(b.geometryType),b.pushPath(g),b;break}g=b.asJSON();if(u.isExtent(g)&&0<Math.min(g.xmax-g.xmin,g.ymax-
g.ymin)+2*this._offset)return D.GeometryCursor.fromJSONCIM({xmin:g.xmin-this._offset,xmax:g.xmax+this._offset,ymin:g.ymin-this._offset,ymax:g.ymax+this._offset})}g=this._geometryEngine;if(null!=g&&(b=this._tileKey?m.clipCursorToTileExtent(b,this._maxInflateSize):b.clone()))return(b=g.offset(d.WebMercator,b.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?D.GeometryCursor.fromJSONCIM(b):null}return null};return l._createClass(a)}();n.EffectOffset=F;Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function A(){}A.local=function(){null===A.instance&&(A.instance=new A);return A.instance};A.prototype.execute=function(u,m,h,f,d){return new D(u,m,h)};return l._createClass(A)}();F.instance=null;let D=function(){function A(u,m,h){this._inputGeometries=u;this._reverse=void 0!==m.reverse?m.reverse:!0}A.prototype.next=function(){for(var u=
this._inputGeometries.next();u;){if(!this._reverse)return u;if("esriGeometryPolyline"===u.geometryType){for(u=u.clone();u.nextPath();)for(let m=0;m<u.numPoints/2;m++){u.seekInPath(m);const h=u.x,f=u.y;u.seekInPath(u.numPoints-m-1);const d=u.x,c=u.y;u.x=h;u.y=f;u.seekInPath(m);u.x=d;u.y=c}u.reset();return u}u=this._inputGeometries.next()}return null};return l._createClass(A)}();n.EffectReverse=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../geometry/support/boundsUtils"],function(n,l,F){let D=function(){function u(){}u.local=function(){null===u.instance&&(u.instance=new u);return u.instance};u.prototype.execute=function(m,h,f,d,c){return new A(m,h,f)};return l._createClass(u)}();D.instance=null;let A=function(){function u(h,f,d){this._inputGeometries=h;this._rotateAngle=void 0!==f.angle?f.angle*Math.PI/180:0}var m=u.prototype;m.next=function(){let h=this._inputGeometries.next();for(;h;){if(0===
this._rotateAngle||"esriGeometryPoint"===h.geometryType)return h;if(0<h.numPaths){var f=F.getCursorBoundsXY(h);const d=(f[2]+f[0])/2;f=(f[3]+f[1])/2;h.reset();return this._rotate(h.clone(),d,f)}h=this._inputGeometries.next()}return null};m._rotate=function(h,f,d){const c=Math.cos(this._rotateAngle),a=Math.sin(this._rotateAngle);for(;h.nextPath();)for(;h.nextPoint();){const b=h.x-f,g=h.y-d;h.x=f+b*c-g*a;h.y=d+b*a+g*c}h.reset();return h};return l._createClass(u)}();n.EffectRotate=D;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/support/boundsUtils"],function(n,l,F){let D=function(){function u(){}u.local=function(){null===u.instance&&(u.instance=new u);return u.instance};u.prototype.execute=function(m,h,f,d,c){return new A(m,h,f)};return l._createClass(u)}();D.instance=null;let A=function(){function u(h,f,d){this._inputGeometries=h;this._xFactor=void 0!==
f.XScaleFactor?f.XScaleFactor:1.15;this._yFactor=void 0!==f.YScaleFactor?f.YScaleFactor:1.15}var m=u.prototype;m.next=function(){const h=this._inputGeometries.next();if(h){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===h.geometryType)return h;if(0<h.numPaths){var f=F.getCursorBoundsXY(h);const d=(f[2]+f[0])/2;f=(f[3]+f[1])/2;h.reset();return this._scaleCursor(h.clone(),d,f)}}return null};m._scaleCursor=function(h,f,d){for(;h.nextPath();)for(;h.nextPoint();)h.x=f+(h.x-f)*this._xFactor,
h.y=d+(h.y-d)*this._yFactor;h.reset();return h};return l._createClass(u)}();n.EffectScale=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,
d,c)};return l._createClass(h)}();u.instance=null;let m=function(){function h(d,c,a){this._inputGeometries=d;this._height=(void 0!==c.amplitude?c.amplitude:2)*a;this._period=(void 0!==c.period?c.period:3)*a;this._style=c.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));this._pattern=new A.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new A.GeometryWalker;this._walker.updateTolerance(a)}
var f=h.prototype;f.next=function(){for(var d=this._inputGeometries.next();d;){if(0===this._height||0===this._period||(d=this._processGeom(d)))return d;d=this._inputGeometries.next()}return null};f._processGeom=function(d){const c=F.GeometryCursor.createEmptyOptimizedCIM(d.geometryType);for(;d.nextPath();){c.startPath();const a=d.pathLength();if(this._walker.init(d,this._pattern))switch(this._style){default:this._constructCurve(c,a,!1);break;case D.GeometricEffectWaveform.Square:this._constructSquare(c,
a);break;case D.GeometricEffectWaveform.Triangle:this._constructTriangle(c,a);break;case D.GeometricEffectWaveform.Random:this._constructCurve(c,a,!0)}else for(;d.nextPoint();)c.pushXY(d.x,d.y)}return c};f._constructCurve=function(d,c,a){var b=Math.round(c/this._period);0===b&&(b=1);const g=this._period/16,e=1/(16*b+1);c=2*Math.PI*c/(c/b);b=2*Math.PI*Math.random();const k=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),q=.75-Math.random()/2,t=.75-Math.random()/2,v=new A.Pos;this._walker.curPointAndAngle(v);
d.pushPoint(v.pt);let y=0;for(;;)if(this._walker.nextPointAndAngle(g,v)){const w=y;y+=e;let z;if(a){const r=this._height/2*(1+.3*Math.sin(q*c*w+b));z=r*Math.sin(c*w+k);z+=r*Math.sin(t*c*w+p);z/=2}else z=.5*this._height*Math.sin(.5*c*w);d.pushXY(v.pt[0]-z*v.sa,v.pt[1]+z*v.ca)}else{d.pushPoint(this._walker.getPathEnd());break}};f._constructSquare=function(d,c){Math.round(c/this._period);for(c=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=new A.Pos;this._walker.curPointAndAngle(b);const g=
new A.Pos;if(this._walker.nextPointAndAngle(this._period,g)){const e=new A.Pos;this._walker.nextPointAndAngle(this._period,e)&&(c?(d.pushPoint(b.pt),c=!1):d.pushPoint(b.pt),d.pushXY(b.pt[0]-this._height/2*b.sa,b.pt[1]+this._height/2*b.ca),d.pushXY(g.pt[0]-this._height/2*g.sa,g.pt[1]+this._height/2*g.ca),d.pushXY(g.pt[0]+this._height/2*g.sa,g.pt[1]-this._height/2*g.ca),d.pushXY(e.pt[0]+this._height/2*e.sa,e.pt[1]-this._height/2*e.ca),a=!0)}}if(!a){d.pushPoint(this._walker.getPathEnd());break}}};f._constructTriangle=
function(d,c){Math.round(c/this._period);for(c=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=new A.Pos;this._walker.curPointAndAngle(b);const g=new A.Pos;if(this._walker.nextPointAndAngle(this._period/2,g)){const e=new A.Pos;this._walker.nextPointAndAngle(this._period,e)&&(this._walker.nextPosition(this._period/2)&&(c?(d.pushPoint(b.pt),c=!1):d.pushPoint(b.pt),d.pushXY(g.pt[0]-this._height/2*g.sa,g.pt[1]+this._height/2*g.ca),d.pushXY(e.pt[0]+this._height/2*e.sa,e.pt[1]-this._height/
2*e.ca)),a=!0)}}if(!a){d.pushPoint(this._walker.getPathEnd());break}}};return l._createClass(h)}();n.EffectWave=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../CIMCursor","../enums","../GeometryWalker"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=
function(f,d,c,a,b){return new m(f,d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(c,a,b){c=h.call(this,c)||this;c._geometryWalker=new A.GeometryWalker;c._geometryWalker.updateTolerance(b);c._angleToLine=a.angleToLine??!0;c._offset=(a.offset?a.offset:0)*b;c._originalEndings=a.endings;c._offsetAtEnd=(a.customEndingOffset?a.customEndingOffset:0)*b;c._position=-(a.offsetAlongLine?a.offsetAlongLine:0)*b;c._pattern=new A.DashPattern;c._pattern.init(a.placementTemplate,!1);
c._pattern.scale(b);c._endings=c._originalEndings;return c}l._inherits(f,h);var d=f.prototype;d.processPath=function(c){if(this._pattern.isEmpty())return null;if(this.iteratePath)var a=this._pattern.nextValue();else{this._endings=this._originalEndings===D.PlacementEndings.WithFullGap&&this.isClosed?D.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let b=!0;switch(this._endings){case D.PlacementEndings.NoConstraint:a=-this._position;a=this._adjustPosition(a);b=!1;break;
default:a=-this._pattern.lastValue()/2;break;case D.PlacementEndings.WithFullGap:a=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();break;case D.PlacementEndings.WithMarkers:a=0;break;case D.PlacementEndings.Custom:a=-this._position,a=this._adjustPosition(a),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(c,this._pattern,b))return null;this._pattern.reset();for(c=0;a>c;)a-=c,c=this._pattern.nextValue();a=c-a;this.iteratePath=!0}c=new A.Pos;if(!this._geometryWalker.nextPointAndAngle(a,
c)||this._endings===D.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===D.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(c.pt[0]-this._offset*c.sa,c.pt[1]+this._offset*c.ca);this._angleToLine&&this.internalPlacement.setRotateCS(c.ca,c.sa);return this.internalPlacement};d._adjustPosition=function(c){c/=this._pattern.length();c-=Math.floor(c);
return c*this._pattern.length()};return l._createClass(f)}(F.PathTransformationCursor);n.PlacementAlongLineSameSize=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../CIMCursor","../CurveHelper","../enums"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,
d,c,a,b){return new m(f,d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(c,a,b){c=h.call(this,c,!1,!0)||this;c._curveHelper=new D.CurveHelper;c._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;c._offset=void 0!==a.offset?a.offset*b:0;c._type=a.extremityPlacement;c._position=void 0!==a.offsetAlongLine?a.offsetAlongLine*b:0;c._beginProcessed=!1;return c}l._inherits(f,h);var d=f.prototype;d.processPath=function(c){let a;switch(this._type){default:this._beginProcessed?
(a=this._atExtremities(c,this._position,!1),this.iteratePath=this._beginProcessed=!1):(a=this._atExtremities(c,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case A.ExtremityPlacement.JustBegin:a=this._atExtremities(c,this._position,!0);break;case A.ExtremityPlacement.JustEnd:a=this._atExtremities(c,this._position,!1);case A.ExtremityPlacement.None:}return a};d._atExtremities=function(c,a,b){b||c.seekPathEnd();if(b?c.nextPoint():c.prevPoint()){let g=0,[e,k]=[0,0],[p,q]=[c.x,c.y];
for(;b?c.nextPoint():c.prevPoint();){e=p;k=q;p=c.x;q=c.y;const t=this._curveHelper.getLength(e,k,p,q);if(g+t>a){c=(a-g)/t;const [v,y]=this._curveHelper.getAngleCS(e,k,p,q,c);c=this._curveHelper.getCoord2D(e,k,p,q,c);this.internalPlacement.setTranslate(c[0]-this._offset*y,c[1]+this._offset*v);this._angleToLine&&this.internalPlacement.setRotateCS(-v,-y);return this.internalPlacement}g+=t}}return null};return l._createClass(f)}(F.PathTransformationCursor);n.PlacementAtExtremities=u;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../CIMCursor","../GeometryWalker"],function(n,l,F,D){let A=function(){function m(){}m.local=function(){null===m.instance&&(m.instance=new m);return m.instance};m.prototype.execute=function(h,f,d,c,a){return new u(h,f,d)};return l._createClass(m)}();A.instance=null;let u=function(m){function h(f,d,c){f=m.call(this,f)||this;f._walker=
new D.GeometryWalker;f._walker.updateTolerance(c);f._angleToLine=void 0!==d.angleToLine?d.angleToLine:!0;f._offset=void 0!==d.offset?d.offset*c:0;f._beginGap=void 0!==d.beginPosition?d.beginPosition*c:0;f._endGap=void 0!==d.endPosition?d.endPosition*c:0;f._flipFirst=void 0!==d.flipFirst?d.flipFirst:!0;f._pattern=new D.DashPattern;f._pattern.init(d.positionArray,!1,!1);f._subPathLen=0;f._posCount=f._pattern.size();f._isFirst=!0;f._prevPos=0;return f}l._inherits(h,m);h.prototype.processPath=function(f){if(this._pattern.isEmpty())return null;
if(this.iteratePath){f=this._pattern.nextValue()*this._subPathLen;var d=this._beginGap+f;f=d-this._prevPos;this._prevPos=d}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=f.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(f,this._pattern,!1))return null;this._pattern.reset();f=this._pattern.nextValue()*this._subPathLen;d=this._beginGap+f;f=d-this._prevPos;this._prevPos=d;this.iteratePath=
!0}d=new D.Pos;if(!this._walker.nextPointAndAngle(f,d,D.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(d.pt[0]-this._offset*d.sa,d.pt[1]+this._offset*d.ca);f=this._isFirst&&this._flipFirst;let c;this._angleToLine?(c=d.ca,d=d.sa):(c=1,d=0);f&&(c=-c,d=-d);this.internalPlacement.setRotateCS(c,d);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement};return l._createClass(h)}(F.PathTransformationCursor);n.PlacementAtRatioPositions=
A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/RandomLCG","../CIMPlacements","../enums"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,d,c,a,b)};return l._createClass(h)}();u.instance=null;let m=function(){function h(d,
c,a,b,g){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(c.stepX??16)*a;this._stepY=Math.abs(c.stepY??16)*a;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=c.gridType??A.PlacementGridType.Fixed;if(this._gridType===A.PlacementGridType.Random)this._randomLCG=new F(1*(c.seed??13)),
this._randomness=(c.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=c.gridAngle??0;this._shiftOddRows=c.shiftOddRows??!1;this._offsetX=(c.offsetX??0)*a;this._offsetY=(c.offsetY??0)*a;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=
this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=b){const [e,k,p,q]=b.split("/");c=parseFloat(e);a=parseFloat(k);b=parseFloat(p);this._graphicOriginX=512*-(parseFloat(q)*2**c+b);this._graphicOriginY=512*a;this._testInsidePolygon=!0}this._internalPlacement=
new D.Placement;this._calculateMinMax(d);this._geometryCursor=d}}var f=h.prototype;f.next=function(){return this._geometryCursor?this._nextInside():null};f._buildRandomValues=function(){if(!h._randValues){h._randValues=[];for(let d=0;24>d;d++)for(let c=0;24>c;c++)h._randValues.push(this._randomLCG.getFloat()),h._randValues.push(this._randomLCG.getFloat())}};f._calculateMinMax=function(d){this._yMax=this._yMin=this._xMax=this._xMin=0;let c,a,b,g,e,k,p,q;c=a=p=e=Number.MAX_VALUE;b=g=q=k=-Number.MAX_VALUE;
var t=1!==this._cosAngle;for(d.reset();d.nextPath();)for(;d.nextPoint();){var v=d.x;var y=d.y;var w=v-this._graphicOriginX-this._offsetX;var z=y-this._graphicOriginY-this._offsetY;if(t){var r=this._cosAngle*w-this._sinAngle*z;w=this._sinAngle*w+this._cosAngle*z}else r=w,w=z;c=Math.min(c,r);b=Math.max(b,r);a=Math.min(a,w);g=Math.max(g,w);e=Math.min(e,y);k=Math.max(k,y);p=Math.min(p,v);q=Math.max(q,v)}e=e!==Number.MAX_VALUE?e:-512-this._stepY;k=k!==-Number.MAX_VALUE?k:this._stepY;p=p!==Number.MAX_VALUE?
p:-this._stepX;q=q!==-Number.MAX_VALUE?q:512+this._stepX;this._polygonMin=(this._verticalSubdivision=k-e>=q-p)?e:p;if(this._testInsidePolygon){r=0-this._graphicOriginX-this._offsetX-this._stepX;y=512-this._graphicOriginX-this._offsetX+this._stepX;v=-512-this._graphicOriginY-this._offsetY-this._stepY;w=0-this._graphicOriginY-this._offsetY+this._stepY;if(t){t=[[r,v],[r,w],[y,v],[y,w]];r=v=Number.MAX_VALUE;y=w=-Number.MAX_VALUE;for(const C of t)t=this._cosAngle*C[0]-this._sinAngle*C[1],z=this._sinAngle*
C[0]+this._cosAngle*C[1],r=Math.min(r,t),y=Math.max(y,t),v=Math.min(v,z),w=Math.max(w,z)}c=c!==Number.MAX_VALUE?Math.max(c,r):r;a=a!==Number.MAX_VALUE?Math.max(a,v):v;b=b!==-Number.MAX_VALUE?Math.min(b,y):y;g=g!==-Number.MAX_VALUE?Math.min(g,w):w}this._xMin=Math.round(c/this._stepX);this._xMax=Math.round(b/this._stepX);this._yMin=Math.round(a/this._stepY);this._yMax=Math.round(g/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(d,p,q,e,k)};f._buildAccelerationMap=
function(d,c,a,b,g){d.reset();const e=new Map,k=this._verticalSubdivision;a=k?g-b:a-c;g=Math.ceil(a/10);if(!(1>=g)){a=Math.floor(a/g);g++;this._delta=a;var p,q;if(k){g=-512-this._stepY;var t=this._stepY;var v=b}else g=-this._stepX,t=512+this._stepX,v=c;for(;d.nextPath();)if(!(2>d.numPoints)&&d.nextPoint()){var y=d.x;for(p=d.y;d.nextPoint();y=c,p=b){c=d.x;b=d.y;if(k){if(p===b||p<g&&b<g||p>t&&b>t)continue;var w=Math.min(p,b);var z=Math.max(p,b)}else{if(y===c||y<g&&c<g||y>t&&c>t)continue;w=Math.min(y,
c);z=Math.max(y,c)}for(;w<z;){var r=q=Math.floor((w-v)/a),C=y,x=p,E=c,B=b,G=e;let H=G.get(r);H||(H=[],G.set(r,H));H.push([[C,x],[E,B]]);w+=a}w=Math.floor((z-v)/a);w>q&&(z=c,r=b,C=e,x=C.get(w),x||(x=[],C.set(w,x)),x.push([[y,p],[z,r]]))}}this._accelerationMap=e}};f._nextInside=function(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var d=this._currentX*this._stepX+this._offsetX;
this._shiftOddRows&&this._currentY%2&&(d+=.5*this._stepX);const c=this._currentY*this._stepY+this._offsetY;this._currentX++;let a;if(this._gridType===A.PlacementGridType.Random){const b=(this._currentX%24+24)%24,g=(this._currentY%24+24)%24;a=this._graphicOriginX+d+this._stepX*this._randomness*(.5-h._randValues[24*g+b])*2/3;d=this._graphicOriginY+c+this._stepY*this._randomness*(.5-h._randValues[24*g+b+1])*2/3}else a=this._graphicOriginX+this._cosAngle*d+this._sinAngle*c,d=this._graphicOriginY-this._sinAngle*
d+this._cosAngle*c;if(!this._testInsidePolygon||this._isInsidePolygon(a,d,this._geometryCursor))return this._internalPlacement.setTranslate(a,d),this._internalPlacement}};f._isInsidePolygon=function(d,c,a){if(null==this._accelerationMap){var b=0,g;let p;d+=1E-6;c+=1E-6;for(a.reset();a.nextPath();)if(a.nextPoint()){var e=a.x;for(g=a.y;a.nextPoint();e=k,g=p){var k=a.x;p=a.y;g>c!==p>c&&(0<(k-e)*(c-g)-(p-g)*(d-e)?b++:b--)}}return 0!==b}d+=1E-6;c+=1E-6;a=this._verticalSubdivision;g=this._accelerationMap.get(Math.floor(((a?
c:d)-this._polygonMin)/this._delta));if(!g)return!1;e=0;for(b of g){g=b[0];k=b[1];if(a){if(g[1]>c===k[1]>c)continue;g=(k[0]-g[0])*(c-g[1])-(k[1]-g[1])*(d-g[0])}else{if(g[0]>d===k[0]>d)continue;g=(k[1]-g[1])*(d-g[0])-(k[0]-g[0])*(c-g[1])}0<g?e++:e--}return 0!==e};return l._createClass(h)}();n.PlacementInsidePolygon=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../CIMCursor","../CurveHelper","../enums"],function(n,l,F,D,A){let u=function(){function h(){}h.local=function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(c,a,b){c=h.call(this,c)||this;c._curveHelper=new D.CurveHelper;c._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;c._offset=void 0!==a.offset?a.offset*b:0;c._relativeTo=a.relativeTo;c._position=
void 0!==a.startPointOffset?a.startPointOffset*b:0;c._epsilon=.001*b;return c}l._inherits(f,h);var d=f.prototype;d.processPath=function(c){var a=this._position;if(this._relativeTo===A.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(c.nextPoint()){let [b,g]=[c.x,c.y],[e,k]=[0,0];for(;c.nextPoint();){e=c.x;k=c.y;a=this._curveHelper.getLength(b,g,e,k);if(a<this._epsilon){b=e;g=k;continue}c=.5+this._position/a;const [p,q]=this._curveHelper.getAngleCS(b,g,e,k,c);c=
this._curveHelper.getCoord2D(b,g,e,k,c);this.internalPlacement.setTranslate(c[0]-this._offset*q,c[1]+this._offset*p);this._angleToLine&&this.internalPlacement.setRotateCS(p,q);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(c,a,this._relativeTo===A.PlacementOnLineRelativeTo.LineEnd)};d.onLine=function(c,a,b){let g=!1;switch(this._relativeTo){default:c.seekPathStart();a=c.pathLength()/2+a;break;case A.PlacementOnLineRelativeTo.LineBeginning:break;case A.PlacementOnLineRelativeTo.LineEnd:g=
!0}b?c.seekPathEnd():c.seekPathStart();let e=0;if(b?c.prevPoint():c.nextPoint()){let [k,p]=[c.x,c.y],[q,t]=[0,0];for(;b?c.prevPoint():c.nextPoint();){q=c.x;t=c.y;const v=this._curveHelper.getLength(k,p,q,t);if(e+v>a){c=(a-e)/v;const [y,w]=this._curveHelper.getAngleCS(k,p,q,t,c);c=this._curveHelper.getCoord2D(k,p,q,t,c);b=g?-this._offset:this._offset;this.internalPlacement.setTranslate(c[0]-b*w,c[1]+b*y);this._angleToLine&&(g?this.internalPlacement.setRotateCS(-y,-w):this.internalPlacement.setRotateCS(y,
w));return this.internalPlacement}k=q;p=t;e+=v}}return null};return l._createClass(f)}(F.PathTransformationCursor);n.PlacementOnLine=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../CIMCursor","../CurveHelper"],function(n,l,F,D){function A(h,f){const d=Math.PI;for(;Math.abs(f-h)>d+2E-15;)f=f-h>d?f-2*d:f+2*d;return(h+f)/2}let u=function(){function h(){}h.local=
function(){null===h.instance&&(h.instance=new h);return h.instance};h.prototype.execute=function(f,d,c,a,b){return new m(f,d,c)};return l._createClass(h)}();u.instance=null;let m=function(h){function f(c,a,b){c=h.call(this,c)||this;c._curveHelper=new D.CurveHelper;c._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;c._offset=void 0!==a.offset?a.offset*b:0;c._endPoints=void 0!==a.placeOnEndPoints?a.placeOnEndPoints:!0;c._controlPoints=void 0!==a.placeOnControlPoints?a.placeOnControlPoints:!0;c._regularVertices=
void 0!==a.placeOnRegularVertices?a.placeOnRegularVertices:!0;c._tags=[];c._tagIterator=0;return c}l._inherits(f,h);var d=f.prototype;d.processPath=function(c){this.iteratePath||(this._preparePath(c),this.iteratePath=!0);if(this._tagIterator>=this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;c=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(c[2]);let a=c[0],b=c[1];if(0!==this._offset){const g=Math.cos(c[2]);a-=this._offset*Math.sin(c[2]);
b+=this._offset*g}this.internalPlacement.setTranslate(a,b);this._tagIterator++;return this.internalPlacement};d._preparePath=function(c){this._tagIterator=this._tags.length=0;c.seekPathStart();const a=c.isClosed();let b=0,g=!1,e=0,k=0;c.seekPathStart();if(c.nextPoint()){let p=c.x,q=c.y,t=c.getControlPoint(),v=!0,y=c.nextPoint();for(;y;){const w=c.x,z=c.y,r=c.getControlPoint();if(this._angleToLine||0!==this._offset)e=this._curveHelper.getAngle(p,q,w,z,0);v?(v=!1,a?(b=e,g=t):(this._endPoints||this._controlPoints&&
t)&&this._tags.push([p,q,e])):t?this._controlPoints&&this._tags.push([p,q,A(k,e)]):this._regularVertices&&this._tags.push([p,q,A(k,e)]);if(this._angleToLine||0!==this._offset)k=this._curveHelper.getAngle(p,q,w,z,1);(y=c.nextPoint())||(a?r||g?this._controlPoints&&this._tags.push([w,z,A(k,b)]):this._regularVertices&&this._tags.push([w,z,A(k,b)]):(this._endPoints||this._controlPoints&&r)&&this._tags.push([w,z,k]));p=w;q=z;t=r}}this._tagIterator=0};return l._createClass(f)}(F.PathTransformationCursor);
n.PlacementOnVertices=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),function(n,l,F,D,A,u,m,h){let f=function(){function c(){}c.local=function(){null===c.instance&&(c.instance=new c);return c.instance};
c.prototype.execute=function(a,b,g,e,k){return new d(a,b,g)};return l._createClass(c)}();f.instance=null;let d=function(){function c(b,g,e){this._geometryCursor=b;this._offsetX=void 0!==g.offsetX?g.offsetX*e:0;this._offsetY=void 0!==g.offsetY?g.offsetY*e:0;this._method=void 0!==g.method?g.method:h.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new m.Placement}var a=c.prototype;a.next=function(){const b=this._geometryCursor;this._geometryCursor=null;return b?this._polygonCenter(b):
null};a._polygonCenter=function(b){let g=!1;switch(this._method){case h.PlacementPolygonCenterMethod.CenterOfMass:if(b=A.weightedAreaCentroid(b))this._internalPlacement.setTranslate(b[0]+this._offsetX,b[1]+this._offsetY),g=!0;break;case h.PlacementPolygonCenterMethod.BoundingBoxCenter:if(b=D.getCursorBoundsXY(b))this._internalPlacement.setTranslate((b[2]+b[0])/2+this._offsetX,(b[3]+b[1])/2+this._offsetY),g=!0;break;default:b=F("polylabel-placement-enabled")?u.getPolylabelPoint(b):u.labelPointAdapter(b),
null!==b&&(this._internalPlacement.setTranslate(b[0]+this._offsetX,b[1]+this._offsetY),g=!0)}return g?this._internalPlacement:null};return l._createClass(c)}();n.PlacementPolygonCenter=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/PriorityQueue ../geometryCursorCollectUtils ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(n,
l,F,D,A,u,m,h,f){function d(q){var {rings:t}=q;if(!t||0===t.length)return null;var v=u.getBoundsXY(A.create(),q);if(!v)return null;var y=8.8818E-14*(Math.abs(v[0])+Math.abs(v[2])+Math.abs(v[1])+Math.abs(v[3])+1),w=0,z=0;for(var r=0;r<t.length;r++){var C=h.getRingArea(t[r]);C>z&&(z=C,w=r)}if(Math.abs(z)<=2*y*y)return z=u.getPointsBounds(A.create(),t[w]),[(z[0]+z[2])/2,(z[1]+z[3])/2];var x=m.ringCentroid(t[w],!1,A.create());if(null===x)return null;if(1===t.length&&4>t[0].length)return x;z=[[NaN,NaN],
[NaN,NaN],[NaN,NaN],[NaN,NaN]];r=[NaN,NaN,NaN,NaN];C=[NaN,NaN,NaN,NaN];var E=!1,B=a(x,q,!0);0===B.distance&&(E=!0,z[0][0]=x[0],z[0][1]=x[1],B=a(x,q,!1));r[0]=B.distance;C[0]=0;var G=[NaN,NaN],H=!1;let I=.25,J=-1;t=u.getPointsBounds(A.create(),t[w]);w=NaN;do if(w=NaN,B=t[0],z[1]=b(q,B+(t[2]-B)*I,y,v),isNaN(z[1][0])||isNaN(z[1][1])||(B=a(z[1],q,!1),w=B.distance),!isNaN(w)&&w>y&&c(z[1],q))H=!0,r[1]=w,C[1]=e(z[1],x);else if(!isNaN(w)&&w>J&&(J=w,G[0]=z[1][0],G[1]=z[1][1]),I-=.01,.1>I)if(0<=J)H=!0,r[1]=
J,z[1][0]=G[0],z[1][1]=G[1],C[1]=e(z[1],x);else break;while(!H);H=!1;I=.5;J=-1;let L=.01,K=1;do if(w=NaN,B=t[0],z[2]=b(q,B+(t[2]-B)*I,y,v),isNaN(z[2][0])||isNaN(z[2][1])||(B=a(z[2],q,!1),w=B.distance),!isNaN(w)&&w>y&&c(z[2],q))H=!0,r[2]=w,C[2]=e(z[2],x);else if(!isNaN(w)&&w>J)J=w,G[0]=z[2][0],G[1]=z[2][1];else if(w>J&&(J=w,G[0]=z[2][0],G[1]=z[2][1]),I=.5+L*K,L+=.01,K*=-1,.3>I||.7<I)if(0<=J)H=!0,r[2]=J,z[2][0]=G[0],z[2][1]=G[1],C[2]=e(z[2],x);else break;while(!H);H=!1;I=.75;J=-1;do if(w=NaN,B=t[0],
z[3]=b(q,B+(t[2]-B)*I,y,v),isNaN(z[3][0])||isNaN(z[3][1])||(B=a(z[3],q,!1),w=B.distance),!isNaN(w)&&w>y&&c(z[3],q))H=!0,r[3]=w,C[3]=e(z[3],x);else if(w>J&&(J=w,G[0]=z[3][0],G[1]=z[3][1]),I+=.01,.9<I)if(0<=J)H=!0,r[3]=J,z[3][0]=G[0],z[3][1]=G[1],C[3]=e(z[3],x);else break;while(!H);q=[0,1,2,3];v=E?0:1;for(E=v;4>E;E++)for(x=v;3>x;x++)G=C[x],H=C[x+1],0<k(G,H)&&(y=q[x],q[x]=q[x+1],q[x+1]=y,C[x]=H,C[x+1]=G);C=v;for(E=y=0;4>v;v++){switch(v){case 0:E=2*r[q[v]];break;case 1:E=1.66666666*r[q[v]];break;case 2:E=
1.33333333*r[q[v]];break;case 3:E=r[q[v]]}E>y&&(y=E,C=q[v])}return z[C]}function c(q,t){var {rings:v}=t;t=0;for(const y of v){v=y.length;for(let w=1;w<v;++w){const z=y[w-1],r=y[w];z[1]>q[1]!==r[1]>q[1]&&(0<(r[0]-z[0])*(q[1]-z[1])-(r[1]-z[1])*(q[0]-z[0])?t++:t--)}}return 0!==t}function a(q,t,v){if(v&&c(q,t))return{coord:q,distance:0};v=Infinity;let y=0,w=0;const z=[0,0];({rings:t}=t);for(const r of t)if(!(2>r.length))for(t=0;t<r.length-1;t++){h.projectPointOnLine(z,q,r,t);const C=e(q,z);C<v&&(v=C,
y=z[0],w=z[1])}return{coord:[y,w],distance:Math.sqrt(v)}}function b(q,t,v,y){v=[t,0];let w=Infinity,z=Infinity,r=!1,C=!1;t=[[t,y[1]-1],[t,y[3]+1]];y=[0,0];const x=[0,0],E=[0,0],B=[[0,0],[0,0]],G=A.create();({rings:q}=q);for(const L of q)if(!(2>L.length))for(q=1;q<L.length;q++){B[0][0]=L[q-1][0];B[0][1]=L[q-1][1];B[1][0]=L[q][0];B[1][1]=L[q][1];a:{var H=G;var I=B;if(2>I.length){H=null;break a}H||(H=A.create());const [K,S]=I[0],[W,X]=I[1];H[0]=Math.min(K,W);H[1]=Math.min(S,X);H[2]=Math.max(K,W);H[3]=
Math.max(S,X)}if(null!==H){x[0]=t[0][0];x[1]=t[0][1];E[0]=t[1][0];E[1]=t[1][1];a:{H=G;I=x;var J=E;let K=g(I,H),S=g(J,H);const W=H[0],X=H[1],Z=H[2],V=H[3];if(K&S){H=0;break a}if(!(K|S)){H=4;break a}const O=(K?1:0)|(S?2:0);do{const P=J[0]-I[0],M=J[1]-I[1];if(P>M)K&3?(K&1?(I[1]+=M*(W-I[0])/P,I[0]=W):(I[1]+=M*(Z-I[0])/P,I[0]=Z),K=g(I,H)):S&3?(S&1?(J[1]+=M*(W-J[0])/P,J[0]=W):(J[1]+=M*(Z-J[0])/P,J[0]=Z),S=g(J,H)):K?(K&4?(I[0]+=P*(X-I[1])/M,I[1]=X):(I[0]+=P*(V-I[1])/M,I[1]=V),K=g(I,H)):(S&4?(J[0]+=P*(X-
J[1])/M,J[1]=X):(J[0]+=P*(V-J[1])/M,J[1]=V),S=g(J,H));else if(K&12?(K&4?(I[0]+=P*(X-I[1])/M,I[1]=X):(I[0]+=P*(V-I[1])/M,I[1]=V),K=g(I,H)):S&12?(S&4?(J[0]+=P*(X-J[1])/M,J[1]=X):(J[0]+=P*(V-J[1])/M,J[1]=V),S=g(J,H)):K?(K&1?(I[1]+=M*(W-I[0])/P,I[0]=W):(I[1]+=M*(Z-I[0])/P,I[0]=Z),K=g(I,H)):(S&1?(J[1]+=M*(W-J[0])/P,J[0]=W):(J[1]+=M*(Z-J[0])/P,J[0]=Z),S=g(J,H)),K&S){H=0;break a}}while(K|S);H=O}0!==H&&f.segmentIntersects(t[0],t[1],B[0],B[1],y)&&(H=y[1],w>z?H<w&&(w=H,r=!0):H<z&&(z=H,C=!0))}}r&&C?v[1]=(w+
z)/2:v[0]=v[1]=NaN;return v}function g(q,t){return(q[0]<t[0]?1:0)|(q[0]>t[2]?1:0)<<1|(q[1]<t[1]?1:0)<<2|(q[1]>t[3]?1:0)<<3}function e(q,t){return(q[0]-t[0])*(q[0]-t[0])+(q[1]-t[1])*(q[1]-t[1])}function k(q,t){if(q<t)return-1;if(q>t)return 1;if(q===t)return 0;q=isNaN(q);t=isNaN(t);return q<t?-1:q>t?1:0}let p=l._createClass(function(q,t,v,y){this.x=q;this.y=t;this.cellSize=v;this.distancefromCellCenter=h.distanceFromPointToPolygon(q,t,y);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*
Math.SQRT2});n.getLabelPoint=d;n.getPolylabelPoint=function(q){if(!q.nextPath()||!q.numPoints)return null;var t=u.currPathBounds(q),v=t[2]-t[0],y=t[3]-t[1];if(0===v||0===y)return[t[0]+v/2,t[1]+y/2];const w=Math.max(Math.min(v,y)/100,1),z=new F((x,E)=>E.maxDistanceToPolygon-x.maxDistanceToPolygon);y=Math.min(v,y);v=y/2;let r=0,C=0;for(r=t[0];r<t[2];r+=y)for(C=t[1];C<t[3];C+=y)z.enqueue(new p(r+v,C+v,v,q));t=m.ringsCentroidCursor(q);if(null===t)return null;for(t=new p(t[0],t[1],0,q);0<z.size;)y=z.dequeue(),
y.distancefromCellCenter>t.distancefromCellCenter&&(t=y),y.maxDistanceToPolygon-t.distancefromCellCenter<=w||(v=y.cellSize/2,z.enqueue(new p(y.x-v,y.y-v,v,q)),z.enqueue(new p(y.x+v,y.y-v,v,q)),z.enqueue(new p(y.x-v,y.y+v,v,q)),z.enqueue(new p(y.x+v,y.y+v,v,q)));return[t.x,t.y]};n.labelPointAdapter=function(q){q={rings:D.collectMultipath(q)};return d(q)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(["../chunks/_rollupPluginBabelHelpers"],
function(n){const l=(F,D)=>F<D?-1:F>D?1:0;return function(){function F(A=l){this._data=[];this._compare=A}var D=F.prototype;D.enqueue=function(A){if(null!=A){var {_data:u,_compare:m}=this;u.push(A);A=u.length-1>>>0;for(var h=u[A];0<A;){const f=A-1>>1,d=u[f];if(0>=m(d,h))u[f]=h,u[A]=d,A=f;else break}}};D.dequeue=function(){const {_data:A,_compare:u}=this,m=A[0];var h=A.pop();if(0===A.length)return m;A[0]=h;h=0;const f=A.length,d=A[0];let c;let a=null;for(;;){var b=2*h+1;const g=2*h+2;a=null;b<f&&(c=
A[b],0<u(c,d)&&(a=b));g<f&&(b=A[g],null===a&&0>=u(b,d)||null!==a&&0>=u(b,c))&&(a=g);if(null===a)break;A[h]=A[a];A[a]=d;h=a}return m};n._createClass(F,[{key:"size",get:function(){return this._data.length}}]);return F}()})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(n){n.getFirstFrame=function(l){const F=l.getFrame(0);if(F instanceof HTMLImageElement||F instanceof HTMLCanvasElement)return F;const D=document.createElement("canvas");D.width=l.width;D.height=l.height;l=D.getContext("2d");
F instanceof ImageData?l.putImageData(F,0,0):l.drawImage(F,0,0);return D};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(F=0,D=0,A=0,u=0){this.x=F;this.y=D;this.width=A;this.height=u}l.prototype.union=function(F){this.x=Math.min(this.x,F.x);this.y=Math.min(this.y,F.y);this.width=Math.max(this.width,F.width);this.height=Math.max(this.height,F.height)};n._createClass(l,
[{key:"isEmpty",get:function(){return 0>=this.width||0>=this.height}}]);return l}()})},"esri/symbols/cim/TextRasterizer":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/screenUtils","../support/textUtils"],function(n,l,F){function D(A){return`rgba(${A.slice(0,3).toString()},${A[3]})`}return function(){function A(m){m&&(this._textRasterizationCanvas=m)}var u=A.prototype;u.rasterizeText=function(m,h){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));
const f=this._textRasterizationCanvas;var d=f.getContext("2d");this._setFontProperties(d,h);this._parameters=h;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:c,weight:a}=h.font;this._lineThroughWidthOffset=c&&"line-through"===c?.1*this._lineHeight:0;var b=(m=null!=h.backgroundColor||null!=h.borderLine)?F.BACKGROUND_PADDING:0,g=this._computeTextWidth(d,h)+2*b,e=this._lineHeight*this._textLines.length+2*b;f.width=g+2*this._lineThroughWidthOffset;f.height=
e;if(0===f.width||0===f.height)return f.width=f.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:f};this._renderedLineHeight=Math.round(this._lineHeight*h.pixelRatio);this._renderedHaloSize=l.pt2px(h.halo.size)*h.pixelRatio;this._renderedWidth=g*h.pixelRatio;this._renderedHeight=e*h.pixelRatio;this._lineThroughWidthOffset*=h.pixelRatio;g=h.halo&&h.halo.color?h.halo.color:[0,0,0,0];this._fillStyle=D(h.color??[0,0,0,0]);this._haloStyle=`rgb(${g.slice(0,
3).toString()})`;g=this._renderedLineHeight;var k=this._renderedHaloSize;d.save();d.clearRect(0,0,f.width,f.height);this._setFontProperties(d,h);e=b*h.pixelRatio;b=d.textAlign;var p=this._renderedWidth-2*e;b=("center"===b?.5*p:"right"===b?p:0)+k+e;e=k+e;k=0<k;p=this._lineThroughWidthOffset;let q=0;if(m){d.save();m=h.backgroundColor??[0,0,0,0];const v=h.borderLine?.color??[0,0,0,0],y=2*l.pt2px(h.borderLine?.size??0);d.fillStyle=D(m);d.strokeStyle=D(v);d.lineWidth=y;d.fillRect(0,0,f.width,f.height);
d.strokeRect(0,0,f.width,f.height);d.restore()}k&&this._renderHalo(d,b,e,p,q,h);q+=e;p+=b;for(var t of this._textLines)k&&(d.globalCompositeOperation="destination-out",d.fillStyle="rgb(0, 0, 0)",d.fillText(t,p,q),d.globalCompositeOperation="source-over"),d.fillStyle=this._fillStyle,d.fillText(t,p,q),c&&"none"!==c&&this._renderDecoration(d,p,q,c,a),q+=g;d.restore();t=this._renderedWidth+2*this._lineThroughWidthOffset;m=this._renderedHeight;d=d.getImageData(0,0,t,m);d=new Uint8Array(d.data);if(h.premultiplyColors)for(b=
0;b<d.length;b+=4)g=d[b+3]/255,d[b]*=g,d[b+1]*=g,d[b+2]*=g;switch(h.horizontalAlignment){case "left":g=-.5;break;case "right":g=.5;break;default:g=0}switch(h.verticalAlignment){case "bottom":h=-.5;break;case "top":h=.5;break;default:h=0}return{size:[t,m],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:g,anchorY:h,canvas:f}};u._renderHalo=function(m,h,f,d,c,a){const b=this._renderedWidth,g=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));
this._haloRasterizationCanvas.width=b;this._haloRasterizationCanvas.height=g;const e=this._haloRasterizationCanvas,k=e.getContext("2d");k.clearRect(0,0,b,g);this._setFontProperties(k,a);const {decoration:p,weight:q}=a.font;k.fillStyle=this._haloStyle;k.strokeStyle=this._haloStyle;k.lineJoin="round";this._renderHaloNative(k,h,f,p,q);m.globalAlpha=this._parameters.halo.color[3];m.drawImage(e,0,0,b,g,d,c,b,g);m.globalAlpha=1};u._renderHaloNative=function(m,h,f,d,c){const a=this._renderedLineHeight,b=
this._renderedHaloSize;for(const g of this._textLines){const e=2*b;for(let k=0;5>k;k++){const p=(.6+.1*k)*e;m.lineWidth=p;m.strokeText(g,h,f);d&&"none"!==d&&this._renderDecoration(m,h,f,d,c,p)}f+=a}};u._setFontProperties=function(m,h){var f=h.font;f=`${f.style} ${f.weight} ${l.pt2px(Math.max(h.size,.5)*h.pixelRatio).toFixed(1)}px ${f.family}, sans-serif`;m.font=f;m.textBaseline="top";switch(h.horizontalAlignment){case "left":h="left";break;case "right":h="right";break;case "center":h="center";break;
default:h="left"}m.textAlign=h};u.computeTextSize=function(m,h){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const f=this._textRasterizationCanvas;var d=f.getContext("2d");this._setFontProperties(d,h);this._parameters=h;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();m=this._computeTextWidth(d,h);d=this._lineHeight*this._textLines.length;f.width=m;f.height=d;return[m*h.pixelRatio,d*h.pixelRatio]};u._computeTextWidth=function(m,
h){let f=0;for(const d of this._textLines)f=Math.max(f,m.measureText(d).width);h=h.font;if("italic"===h.style||"oblique"===h.style||"string"===typeof h.weight&&("bold"===h.weight||"bolder"===h.weight)||"number"===typeof h.weight&&600<h.weight)f+=.3*m.measureText("w").width;f+=2*l.pt2px(this._parameters.halo.size);return Math.round(f)};u._computeLineHeight=function(){let m=1.275*this._parameters.size;const h=this._parameters.font.decoration;h&&"underline"===h&&(m*=1.3);return Math.round(m+2*l.pt2px(this._parameters.halo.size))};
u._renderDecoration=function(m,h,f,d,c,a){const b=.9*this._lineHeight;switch(m.textAlign){case "center":h-=this._renderedWidth/2;break;case "right":h-=this._renderedWidth}const g=m.textBaseline;if("underline"===d)switch(g){case "top":f+=b;break;case "middle":f+=b/2}else if("line-through"===d)switch(g){case "top":f+=b/1.5;break;case "middle":f+=b/3}d=a?1.5*a:Math.ceil(b*("bold"===c?.06:"bolder"===c?.09:.04));m.save();m.beginPath();m.strokeStyle=m.fillStyle;m.lineWidth=d;m.moveTo(h-this._lineThroughWidthOffset,
f);m.lineTo(h+this._renderedWidth+2*this._lineThroughWidthOffset,f);m.stroke();m.restore()};return n._createClass(A)}()})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(n,l){function F(a){return"function"===typeof a}function D(a){let b=a.length;for(;b--;)if(!" /-,\n".includes(a.charAt(b)))return!1;return!0}function A(a,b){const g=[];var e=0;let k=-1;do k=a.indexOf("[",e),k>=e&&(k>e&&(e=a.substr(e,k-e),g.push([e,null,D(e)])),e=k+1,k=a.indexOf("]",e),k>=e&&(k>e&&(e=a.substr(e,
k-e),(e=b[e])&&g.push([null,e,!1])),e=k+1));while(-1!==k);e<a.length-1&&(a=a.substr(e),g.push([a,null,D(a)]));return g}function u(a,b,g){let e="",k=null;for(const p of b){const [q,t,v]=p;if(q)v?k=q:(k&&(e+=k,k=null),e+=q);else if(b=a.attributes[t])k&&(e+=k,k=null),e+=b}return m(e,g)}function m(a,b){"string"!==typeof a&&(a=String(a));switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function h(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,
g:0,b:0,a:0}}function f(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=f(b),null!=a)return a;break;case "CIMTextSymbol":return f(a.symbol);case "CIMSolidFill":return a.color}}function d(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a=a.symbolLayers)for(const b of a)if(a=d(b),null!=a)return a;break;case "CIMTextSymbol":return d(a.symbol);case "CIMSolidStroke":return a.color}}function c(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=
c(b),void 0!==a)return a;break;case "CIMTextSymbol":return c(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}}l.adjustTextCase=m;l.analyzeTextParts=A;l.assignTextValuesFromFeature=u;l.attributesToFields=function(a){return(a?Object.keys(a):[]).map(b=>({name:b,alias:b,type:"string"===typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}))};l.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};l.createLabelOverrideFunction=function(a,b,g){const e=A(b,
a);return k=>u(k,e,g)};l.evaluateValueOrFunction=function(a,b,g,e){return F(a)?a(b,g,e):a};l.fromCIMColor=h;l.fromCIMFontDecoration=function(a){return a.underline?"underline":a.strikethrough?"line-through":"none"};l.fromCIMFontStyle=function(a){let b="normal",g="normal";a&&(a=a.toLowerCase(),a.includes("italic")?b="italic":a.includes("oblique")&&(b="oblique"),a.includes("bold")?g="bold":a.includes("light")&&(g="lighter"));return{style:b,weight:g}};l.fromCIMHorizontalAlignment=function(a){switch(a){default:return"left";
case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};l.fromCIMVerticalAlignment=function(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};l.getFillColor=f;l.getFontStyle=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};l.getFontWeight=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "bold":return"bold";
case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};l.getStrokeColor=d;l.getStrokeWidth=c;l.getTintColor=a=>a.tintColor?h(a.tintColor):{r:255,g:255,b:255,a:1};l.getValue=(a,b=0)=>null==a||isNaN(a)?b:a;l.importGeometryEngine=function(){return new Promise((a,b)=>n(["../../geometry/geometryEngineJSON"],a,b))};l.isCIMFill=function(a){return null!=a&&("CIMGradientFill"===a.type||"CIMHatchFill"===a.type||"CIMPictureFill"===a.type||"CIMSolidFill"===a.type||"CIMWaterFill"===
a.type)};l.isCIMMarker=function(a){return"CIMVectorMarker"===a.type||"CIMPictureMarker"===a.type||"CIMBarChartMarker"===a.type||"CIMCharacterMarker"===a.type||"CIMPieChartMarker"===a.type||"CIMStackedBarChartMarker"===a.type};l.isCIMMarkerStrokePlacement=function(a){return null!=a&&("CIMMarkerPlacementAlongLineRandomSize"===a.type||"CIMMarkerPlacementAlongLineSameSize"===a.type||"CIMMarkerPlacementAlongLineVariableSize"===a.type||"CIMMarkerPlacementAtExtremities"===a.type||"CIMMarkerPlacementAtMeasuredUnits"===
a.type||"CIMMarkerPlacementAtRatioPositions"===a.type||"CIMMarkerPlacementOnLine"===a.type||"CIMMarkerPlacementOnVertices"===a.type)};l.isCIMStroke=function(a){return"CIMGradientStroke"===a.type||"CIMPictureStroke"===a.type||"CIMSolidStroke"===a.type};l.isFeatureValueFn=F;l.isGeometryEngineRequired=a=>{if(!a)return!1;for(const b of a)switch(b.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};l.isSVGImage=a=>a.includes("data:image/svg+xml");
l.mapCIMSymbolToGeometryType=function(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};l.resampleHermite=function(a,b,g,e,k,p,q=!0){const t=b/k;g/=p;const v=Math.ceil(t/2),y=Math.ceil(g/2);for(let r=0;r<p;r++)for(let C=0;C<k;C++){const x=4*(C+(q?p-r-1:r)*k);var w=0;let E=0,B=0,G=0,H=0,I=0,J=0;const L=(r+.5)*g;for(let K=
Math.floor(r*g);K<(r+1)*g;K++){var z=Math.abs(L-(K+.5))/y;const S=(C+.5)*t;z*=z;for(let W=Math.floor(C*t);W<(C+1)*t;W++){let X=Math.abs(S-(W+.5))/v;w=Math.sqrt(z+X*X);-1<=w&&1>=w&&(w=2*w*w*w-3*w*w+1,0<w&&(X=4*(W+K*b),J+=w*a[X+3],B+=w,255>a[X+3]&&(w=w*a[X+3]/250),G+=w*a[X],H+=w*a[X+1],I+=w*a[X+2],E+=w))}}e[x]=G/E;e[x+1]=H/E;e[x+2]=I/E;e[x+3]=J/B}};l.toCIMSymbolJSON=function(a){return a.data?.symbol??null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){function a(p,q){p.forEach(t=>u.transformMat2d(t,t,q));return{upperLeft:f.i1616to32(8*p[0][0],8*p[0][1]),upperRight:f.i1616to32(8*p[1][0],8*p[1][1]),lowerLeft:f.i1616to32(8*p[2][0],8*p[2][1]),lowerRight:f.i1616to32(8*p[3][0],8*p[3][1])}}const b=Math.PI/180;let g=function(){function p(t,v,y,w){this._rotationT=A.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const z=y.rect,r=new Float32Array(8);t*=w;v*=w;const C=y.code?z.width*w:
y.metrics.width,x=y.code?z.height*w:y.metrics.height;this.width=C;this.height=x;r[0]=t;r[1]=v;r[2]=t+C;r[3]=v;r[4]=t;r[5]=v+x;r[6]=t+C;r[7]=v+x;this._data=r;this._setTextureCoords(z);this._scale=w;this._mosaic=y;this.x=t;this.y=v;this.maxOffset=Math.max(t+C,v+x)}var q=p.prototype;q.setTransform=function(t){this._transform=t;this._offsets=null};q._setOffsets=function(t){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const v=this._offsets,y=new Float32Array(8),w=
D.multiply(A.create(),this._rotationT,this._transform);A.transformMany(y,t,w);v.upperLeft=f.i1616to32(8*y[0],8*y[1]);v.upperRight=f.i1616to32(8*y[2],8*y[3]);v.lowerLeft=f.i1616to32(8*y[4],8*y[5]);v.lowerRight=f.i1616to32(8*y[6],8*y[7])};q._setTextureCoords=function({x:t,y:v,width:y,height:w}){this._texcoords={upperLeft:f.i1616to32(t,v),upperRight:f.i1616to32(t+y,v),lowerLeft:f.i1616to32(t,v+w),lowerRight:f.i1616to32(t+y,v+w)}};l._createClass(p,[{key:"mosaic",get:function(){return this._mosaic}},{key:"angle",
get:function(){return this._angle},set:function(t){this._angle=t;D.fromRotation(this._rotationT,-t);this._setOffsets(this._data)}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},{key:"offsets",
get:function(){this._offsets||this._setOffsets(this._data);return this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){if(!this._bounds){const {height:z,width:r}=this._mosaic.metrics;var t=r*this._scale,v=Math.abs(z)*this._scale,y=new Float32Array(8);y[0]=this.x;y[1]=this.y;y[2]=this.x+t;y[3]=this.y;y[4]=this.x;y[5]=this.y+v;y[6]=this.x+t;y[7]=this.y+v;t=D.multiply(A.create(),this._rotationT,
this._transform);A.transformMany(y,y,t);v=t=Infinity;let C=0;var w=0;for(let x=0;4>x;x++){const E=y[2*x],B=y[2*x+1];t=Math.min(t,E);v=Math.min(v,B);C=Math.max(C,E);w=Math.max(w,B)}y=C-t;w-=v;this._bounds=new c(t+y/2,v+w/2,y,w)}return this._bounds}}]);return p}(),e=function(){function p(t,v,y){this._rotation=0;this._decorate(t,v,y);this.glyphs=t;this.bounds=this._createBounds(t);this.isMultiline=1<v.length;this._hasRotation=0!==y.angle;this._transform=this._createGlyphTransform(this.bounds,y);if((this._borderLineSize=
y.borderLineSize)||y.hasBackground)[this.bounds,this.background]=this.shapeBackground(this._transform);for(const w of t)w.setTransform(this._transform)}var q=p.prototype;q.setRotation=function(t){if(0!==t||0!==this._rotation){this._rotation=t;var v=this._transform;t=D.fromRotation(A.create(),t);D.multiply(v,t,v);for(const y of this.glyphs)y.setTransform(this._transform)}};q._decorate=function(t,v,y){if(y.decoration&&"none"!==y.decoration&&t.length){var w=y.scale;y="underline"===y.decoration?30:20;
var z=t[0].textureBinding;for(const E of v){const B=E.startX*w,G=E.startY*w;v=t;var r=v.push;var C=(E.width+E.glyphWidthEnd)*w;var x=z;C={code:0,page:0,sdf:!0,rect:new d(0,0,11,8),textureBinding:x,metrics:{advance:0,height:4,width:C,left:0,top:0}};r.call(v,new g(B,G+y*w,C,1))}}};q.shapeBackground=function(t){const v=(1.5+F.pt2px(this._borderLineSize||0))/2;var y=this._borderLineSize?v:0;const {xmin:w,ymin:z,xmax:r,ymax:C,x,y:E,width:B,height:G}=this.bounds,H=[w-8,z-8],I=[r+8,z-8],J=[w-8,C+8],L=[r+
8,C+8],K=a([[H[0]-v,H[1]-v],[I[0]+v,I[1]-v],[H[0]+y,H[1]+y],[I[0]-y,I[1]+y]],t),S=a([[J[0]+y,J[1]-y],[L[0]-y,L[1]-y],[J[0]-v,J[1]+v],[L[0]+v,L[1]+v]],t),W=a([[H[0]-v,H[1]-v],[H[0]+y,H[1]+y],[J[0]-v,J[1]+v],[J[0]+y,J[1]-y]],t);y=a([[I[0]-y,I[1]+y],[I[0]+v,I[1]-v],[L[0]-y,L[1]-y],[L[0]+v,L[1]+v]],t);t={main:a([H,I,J,L],t),top:K,bot:S,left:W,right:y};return[new c(x,E,B+2*v,G+2*v),t]};q._createBounds=function(t){let v=Infinity,y=Infinity,w=0;var z=0;for(const r of t)v=Math.min(v,r.xTopLeft),y=Math.min(y,
r.yTopLeft),w=Math.max(w,r.xBottomRight),z=Math.max(z,r.yBottomRight);t=w-v;z-=y;return new c(v+t/2,y+z/2,t,z)};q._createGlyphTransform=function(t,v){const y=b*v.angle,w=A.create(),z=m.create();D.translate(w,w,u.set(z,v.xOffset,-v.yOffset));v.isCIM?D.rotate(w,w,y):(D.translate(w,w,u.set(z,t.x,t.y)),D.rotate(w,w,y),D.translate(w,w,u.set(z,-t.x,-t.y)));return w};l._createClass(p,[{key:"boundsT",get:function(){var t=this.bounds;const v=u.set(m.create(),t.x,t.y);u.transformMat2d(v,v,this._transform);
return this._hasRotation?(t=Math.max(t.width,t.height),new c(v[0],v[1],t,t)):new c(v[0],v[1],t.width,t.height)}}]);return p}(),k=l._createClass(function(p,q,t,v,y,w){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(q,t));this.end=Math.max(0,Math.max(q,t));this.end<p.length&&(this.glyphWidthEnd=p[this.end].metrics.width);this.width=v;this.yMin=y;this.yMax=w});n.ShapedGlyph=g;n.ShapingInfo=e;n.shapeGlyphs=function(p,q,t){const v=t.scale,y=[],w=[];var z=1/t.scale*t.maxLineWidth;
var r=q?p.length-1:0,C=q?-1:p.length;q=q?-1:1;var x=r,E=0,B=0;let G=x,H=G,I=0,J=Infinity,L=0;for(;x!==C;){const {code:X,metrics:Z}=p[x];var K=Math.abs(Z.top);10!==X&&32!==X&&(J=Math.min(J,K),L=Math.max(L,K+Z.height));10===X?(x!==r&&(w.push(new k(p,G,x-q,E,J,L)),J=Infinity,L=0),E=0,G=x+q,H=x+q,B=0):32===X?(H=x+q,B=0,I=Z.advance,E+=Z.advance):(E>z&&(H!==G?(K=H-2*q,E-=I,w.push(new k(p,G,K,E-B,J,L)),J=Infinity,L=0,G=H,E=B):(w.push(new k(p,G,x-q,E,J,L)),J=Infinity,L=0,H=G=x,E=0)),E+=Z.advance,B+=Z.advance);
x+=q}z=new k(p,G,x-q,E,J,L);0<=z.start&&z.end<p.length&&w.push(z);for(z=0;z<w.length;z++);r=w[0].yMin;z=w[w.length-1].yMax+t.lineHeight*(w.length-1)+("underline"===t.decoration?4:0)-r;const {vAlign:S,hAlign:W}=t;C=S===h.VAlign.Baseline?1:0;z=(1-C)*-r+z/2*(C?0:S-1)+-26*(C?1:0);for(r=0;r<w.length;r++){const {start:X,end:Z,width:V}=w[r];C=V/2*(W+1)*-1-3;q=r*t.lineHeight+z-3;w[r].startX=C;w[r].startY=q;for(x=X;x<=Z;x++)E=p[x],10!==E.code&&(B=new g(C+E.metrics.left,q-E.metrics.top,E,v),C+=E.metrics.advance,
y.push(B))}return new e(y,w,t)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(F=0,D=0,A=0,u=0){this.x=F;this.y=D;this.width=A;this.height=u}l.prototype.union=function(F){this.x=Math.min(this.x,F.x);this.y=Math.min(this.y,F.y);this.width=Math.max(this.width,F.width);this.height=Math.max(this.height,F.height)};n._createClass(l,[{key:"isEmpty",
get:function(){return 0>=this.width||0>=this.height}}]);return l}()})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec2f32"],function(n,l){return function(){function F(A,u,m,h){this.center=l.fromValues(A,u);this.centerT=l.create();this.halfWidth=m/2;this.halfHeight=h/2;this.width=m;this.height=h}var D=F.prototype;D.clone=function(){return new F(this.x,this.y,this.width,this.height)};D.serialize=function(A){A.writeF32(this.center[0]);
A.writeF32(this.center[1]);A.push(this.width);A.push(this.height);return A};D.findCollisionDelta=function(A,u=4){return Math.log2(Math.min((A.halfWidth+this.halfWidth+u)/Math.abs(A.centerT[0]-this.centerT[0]),(A.halfHeight+this.halfHeight+u)/Math.abs(A.centerT[1]-this.centerT[1])))};D.extend=function(A){const u=Math.min(this.xmin,A.xmin),m=Math.min(this.ymin,A.ymin),h=Math.max(this.xmax,A.xmax)-u;A=Math.max(this.ymax,A.ymax)-m;this.width=h;this.height=A;this.halfWidth=h/2;this.halfHeight=A/2;this.x=
u+h/2;this.y=m+A/2};F.deserialize=function(A){const u=A.readF32(),m=A.readF32(),h=A.readInt32();A=A.readInt32();return new F(u,m,h,A)};n._createClass(F,[{key:"x",get:function(){return this.center[0]},set:function(A){this.center[0]=A}},{key:"y",get:function(){return this.center[1]},set:function(A){this.center[1]=A}},{key:"blX",get:function(){return this.center[0]+this.halfWidth}},{key:"blY",get:function(){return this.center[1]+this.halfHeight}},{key:"trX",get:function(){return this.center[0]-this.halfWidth}},
{key:"trY",get:function(){return this.center[1]-this.halfHeight}},{key:"xmin",get:function(){return this.x-this.halfWidth}},{key:"xmax",get:function(){return this.x+this.halfWidth}},{key:"ymin",get:function(){return this.y-this.halfHeight}},{key:"ymax",get:function(){return this.y+this.halfHeight}}]);return F}()})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(n,l,F){function D(u){const m=
{};switch(u){case "esriGeometryPoint":return(h,f,d,c)=>F.unquantizePoint(f,m,h,d,c);case "esriGeometryPolygon":return(h,f,d,c)=>F.unquantizePolygon(f,m,h,d,c);case "esriGeometryPolyline":return(h,f,d,c)=>F.unquantizePolyline(f,m,h,d,c);case "esriGeometryMultipoint":return(h,f,d,c)=>F.unquantizeMultipoint(f,m,h,d,c);default:return l.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n("mapview-arcade",`Unable to handle geometryType: ${u}`)),h=>h}}const A=new Map;return function(u,m,h,f,d){if(null==
u)return null;if(u.referencesGeometry()&&d){const {transform:c,hasZ:a,hasM:b}=d;A.has(f)||A.set(f,D(f));f=A.get(f)(m.geometry,c,a,b);m={...m,geometry:f}}m=u.repurposeFeature(m);try{return u.evaluate({...h,$feature:m},u.services)}catch(c){return l.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(n,l){function F({scale:x,translate:E},B){return Math.round((B-
E[0])/x[0])}function D({scale:x,translate:E},B){return Math.round((E[1]-B)/x[1])}function A(x,E,B){const G=[];let H,I,J,L;for(let K=0;K<B.length;K++){const S=B[K];if(0<K){if(J=F(x,S[0]),L=D(x,S[1]),J!==H||L!==I)G.push(E(S,J-H,L-I)),H=J,I=L}else H=F(x,S[0]),I=D(x,S[1]),G.push(E(S,H,I))}return 0<G.length?G:null}function u(x,E,B,G){return A(x,B?G?C:r:G?r:z,E)}function m(x,E,B,G){const H=[];B=B?G?C:r:G?r:z;for(G=0;G<E.length;G++){const I=A(x,B,E[G]);I&&3<=I.length&&H.push(I)}return H.length?H:null}function h(x,
E,B,G){const H=[];B=B?G?C:r:G?r:z;for(G=0;G<E.length;G++){const I=A(x,B,E[G]);I&&2<=I.length&&H.push(I)}return H.length?H:null}function f({scale:x,translate:E},B){return B*x[0]+E[0]}function d({scale:x,translate:E},B){return E[1]-B*x[1]}function c(x,E,B){const G=Array(B.length);if(!B.length)return G;const [H,I]=x.scale;let J=f(x,B[0][0]);x=d(x,B[0][1]);G[0]=E(B[0],J,x);for(let L=1;L<B.length;L++){const K=B[L];J+=K[0]*H;x-=K[1]*I;G[L]=E(K,J,x)}return G}function a(x,E,B){const G=Array(B.length);for(let H=
0;H<B.length;H++)G[H]=c(x,E,B[H]);return G}function b(x,E,B,G){return c(x,B?G?C:r:G?r:z,E)}function g(x,E,B,G){return a(x,B?G?C:r:G?r:z,E)}function e(x,E,B,G){return a(x,B?G?C:r:G?r:z,E)}function k(x,E,B){let [G,H]=B[0],I=Math.min(G,E[0]),J=Math.min(H,E[1]),L=Math.max(G,E[2]);E=Math.max(H,E[3]);for(let K=1;K<B.length;K++){const [S,W]=B[K];G+=S;H+=W;0>S&&(I=Math.min(I,G));0<S&&(L=Math.max(L,G));0>W?J=Math.min(J,H):0<W&&(E=Math.max(E,H))}x[0]=I;x[1]=J;x[2]=L;x[3]=E;return x}function p(x,E){if(!E.length)return null;
x[0]=x[1]=Number.POSITIVE_INFINITY;x[2]=x[3]=Number.NEGATIVE_INFINITY;for(let B=0;B<E.length;B++)k(x,x,E[B]);return x}function q(x,E,B,G,H){E.xmin=F(x,B.xmin);E.ymin=D(x,B.ymin);E.xmax=F(x,B.xmax);E.ymax=D(x,B.ymax);E!==B&&(G&&(E.zmin=B.zmin,E.zmax=B.zmax),H&&(E.mmin=B.mmin,E.mmax=B.mmax));return E}function t(x,E,B,G,H){E.points=u(x,B.points,G,H)??[];return E}function v(x,E,B,G,H){E.x=F(x,B.x);E.y=D(x,B.y);E!==B&&(G&&(E.z=B.z),H&&(E.m=B.m));return E}function y(x,E,B,G,H){x=m(x,B.rings,G,H);if(!x)return null;
E.rings=x;return E}function w(x,E,B,G,H){x=h(x,B.paths,G,H);if(!x)return null;E.paths=x;return E}const z=(x,E,B)=>[E,B],r=(x,E,B)=>[E,B,x[2]],C=(x,E,B)=>[E,B,x[2],x[3]];n.equals=function(x,E){if(x===E||null==x&&null==E)return!0;if(null==x||null==E)return!1;let B,G,H,I;x&&"upperLeft"===x.originPosition?(B=x.translate[0],G=x.translate[1],x=x.scale[0]):(B=null!=x.extent?x.extent.xmin:0,G=null!=x.extent?x.extent.ymax:0,x=x.tolerance);E&&"upperLeft"===E.originPosition?(H=E.translate[0],I=E.translate[1],
E=E.scale[0]):(H=null!=E.extent?E.extent.xmin:0,I=null!=E.extent?E.extent.ymax:0,E=E.tolerance);return B===H&&G===I&&x===E};n.getQuantizedBoundsCoordsArray=k;n.getQuantizedBoundsCoordsArrayArray=p;n.getQuantizedBoundsPaths=function(x){return p([0,0,0,0],x)};n.getQuantizedBoundsPoints=function(x){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return k(E,E,x)};n.getQuantizedBoundsRings=function(x){return p([0,0,0,0],x)};n.quantizeBounds=
function(x,E,B){E[0]=F(x,B[0]);E[3]=D(x,B[1]);E[2]=F(x,B[2]);E[1]=D(x,B[3]);return E};n.quantizeExtent=q;n.quantizeGeometry=function(x,E){return x&&E?l.isPoint(E)?v(x,{},E,!1,!1):l.isPolyline(E)?w(x,{},E,!1,!1):l.isPolygon(E)?y(x,{},E,!1,!1):l.isMultipoint(E)?t(x,{},E,!1,!1):l.isExtent(E)?q(x,{},E,!1,!1):null:null};n.quantizeMultipoint=t;n.quantizePaths=h;n.quantizePoint=v;n.quantizePoints=u;n.quantizePolygon=y;n.quantizePolyline=w;n.quantizeRings=m;n.quantizeX=F;n.quantizeY=D;n.toQuantizationTransform=
function(x){return x?{originPosition:"upper-left"===x.originPosition?"upperLeft":"lower-left"===x.originPosition?"lowerLeft":x.originPosition,scale:x.tolerance?[x.tolerance,x.tolerance]:[1,1],translate:null!=x.extent?[x.extent.xmin,x.extent.ymax]:[0,0]}:null};n.unquantizeBounds=function(x,E,B){return B?(E[0]=f(x,B[0]),E[1]=d(x,B[3]),E[2]=f(x,B[2]),E[3]=d(x,B[1]),E):[f(x,E[0]),d(x,E[3]),f(x,E[2]),d(x,E[1])]};n.unquantizeCoordsArray=c;n.unquantizeCoordsArrayArray=a;n.unquantizeExtent=function(x,E,B,
G,H){E.xmin=f(x,B.xmin);E.ymin=d(x,B.ymin);E.xmax=f(x,B.xmax);E.ymax=d(x,B.ymax);E!==B&&(G&&(E.zmin=B.zmin,E.zmax=B.zmax),H&&(E.mmin=B.mmin,E.mmax=B.mmax));return E};n.unquantizeMultipoint=function(x,E,B,G,H){null!=B&&(E.points=b(x,B.points,G,H));return E};n.unquantizePaths=g;n.unquantizePoint=function(x,E,B,G,H){if(null==B)return E;E.x=f(x,B.x);E.y=d(x,B.y);E!==B&&(G&&(E.z=B.z),H&&(E.m=B.m));return E};n.unquantizePoints=b;n.unquantizePolygon=function(x,E,B,G,H){null!=B&&(E.rings=e(x,B.rings,G,H));
return E};n.unquantizePolyline=function(x,E,B,G,H){null!=B&&(E.paths=g(x,B.paths,G,H));return E};n.unquantizeRings=e;n.unquantizeX=f;n.unquantizeY=d;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(n){function l(h,f){h%=f;return 0<=h?h:h+f}const F=Number.POSITIVE_INFINITY,D=Math.PI,A=128/D,u=256/360,m=1/Math.LN2;n.C_2PI=2*D;n.C_DEG_TO_256=u;n.C_DEG_TO_RAD=D/180;n.C_INFINITY=F;n.C_PI=D;n.C_RAD_TO_256=
A;n.between=function(h,f,d){return h>=f&&h<=d||h>=d&&h<=f};n.degToByte=function(h){return l(h*u,256)};n.interpolate=function(h,f,d){return h*(1-d)+f*d};n.log2=function(h){return Math.log(h)*m};n.positiveMod=l;n.radToByte=function(h){return l(h*A,256)};n.sqr=function(h){return h*h};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/mathUtils"],function(n,l,F){n.rasterizeDash=function(D,
A){var u="Butt"===A,m="Square"===A;A=!u&&!m;1===D.length%2&&(D=[...D,...D]);var h=0;for(var f of D)h+=f;f=Math.round(15.5*h);h=new Float32Array(31*f);let d=0,c=0,a=.5,b=!0;for(var g of D){d=c;for(c+=15.5*g;a<=c;){for(D=.5;31>D;){const e=A?(D-15.5)*(D-15.5):Math.abs(D-15.5);h[(D-.5)*f+a-.5]=b?u?Math.max(Math.max(d+7.75-a,e),Math.max(a-c+7.75,e)):e:A?Math.min((a-d)*(a-d)+e,(a-c)*(a-c)+e):m?Math.min(Math.max(a-d,e),Math.max(c-a,e)):Math.min(Math.max(a-d+7.75,e),Math.max(c+7.75-a,e));D++}a++}b=!b}u=h.length;
g=new Uint8Array(4*u);for(m=0;m<u;++m)l.packFloatRGBA((A?Math.sqrt(h[m]):h[m])/15.5,g,4*m);return[g,f,31]};n.rasterizeSimpleFill=function(D,A,u){u=F.nextPowerOfTwo(Math.ceil(u));var m="vertical"===A||"horizontal"===A||"cross"===A||"esriSFSCross"===A||"esriSFSVertical"===A||"esriSFSHorizontal"===A?8*u:16*u;const h=2*u;D.width=m;D.height=m;const f=D.getContext("2d");f.strokeStyle="#FFFFFF";f.lineWidth=u;f.beginPath();if("vertical"===A||"cross"===A||"esriSFSCross"===A||"esriSFSVertical"===A)f.moveTo(m/
2,-h),f.lineTo(m/2,m+h);if("horizontal"===A||"cross"===A||"esriSFSCross"===A||"esriSFSHorizontal"===A)f.moveTo(-h,m/2),f.lineTo(m+h,m/2);if("forward-diagonal"===A||"diagonal-cross"===A||"esriSFSDiagonalCross"===A||"esriSFSForwardDiagonal"===A)f.moveTo(-h,-h),f.lineTo(m+h,m+h),f.moveTo(m-h,-h),f.lineTo(m+h,h),f.moveTo(-h,m-h),f.lineTo(h,m+h);if("backward-diagonal"===A||"diagonal-cross"===A||"esriSFSBackwardDiagonal"===A||"esriSFSDiagonalCross"===A)f.moveTo(m+h,-h),f.lineTo(-h,m+h),f.moveTo(h,-h),f.lineTo(-h,
h),f.moveTo(m+h,m-h),f.lineTo(m-h,m+h);f.stroke();A=f.getImageData(0,0,D.width,D.height);A=new Uint8Array(A.data);for(m=0;m<A.length;m+=4)u=A[m+3]/255,A[m]*=u,A[m+1]*=u,A[m+2]*=u;return[A,D.width,D.height]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(n,l){function F(m,h=0){let f=0;for(let d=0;4>d;d++)f+=m[h+d]*A[d];return f}const D=[1,256,65536,16777216],A=[1/256,1/65536,1/16777216,1/4294967296],u=F(new Uint8ClampedArray([255,
255,255,255]));n.packFloatRGBA=function(m,h,f=0){m=l.clamp(m,0,u);for(let a=0;4>a;a++){var d=Math,c=m*D[a];h[f+a]=d.floor.call(d,256*(c-Math.floor(c)))}};n.unpackFloatRGBA=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(n,l,F,D,A){function u(h){if(!h)return null;switch(h.type){case "CIMPointSymbol":h=h.symbolLayers;
if(!h||1!==h.length)break;return u(h[0]);case "CIMVectorMarker":h=h.markerGraphics;if(!h||1!==h.length)break;var f=h[0];if(!f)break;h=f.geometry;if(!h)break;f=f.symbol;if(!f||"CIMPolygonSymbol"!==f.type&&"CIMLineSymbol"!==f.type||f.symbolLayers?.some(d=>!!d.effects))break;return{geom:h,asFill:"CIMPolygonSymbol"===f.type};case "sdf":return{geom:h.geom,asFill:h.asFill}}return null}function m(h){let f=Infinity,d=-Infinity,c=Infinity,a=-Infinity;for(const b of h)for(const g of b)g[0]<f&&(f=g[0]),g[0]>
d&&(d=g[0]),g[1]<c&&(c=g[1]),g[1]>a&&(a=g[1]);return[f,c,d,a]}n.buildSDF=function(h){var f=h.geom;var d=f?f.rings?f.rings:f.paths?f.paths:void 0!==f.xmin&&void 0!==f.ymin&&void 0!==f.xmax&&void 0!==f.ymax?[[[f.xmin,f.ymin],[f.xmin,f.ymax],[f.xmax,f.ymax],[f.xmax,f.ymin],[f.xmin,f.ymin]]]:null:null;f=Infinity;var c=-Infinity;var a=Infinity;var b=-Infinity;for(var g of d)for(var e of g)e[0]<f&&(f=e[0]),e[0]>c&&(c=e[0]),e[1]<a&&(a=e[1]),e[1]>b&&(b=e[1]);a=new D(f,a,c-f,b-a);g=A.SPRITE_PADDING;f=Math.floor(.5*
(64-g));b=(128-2*(f+g))/Math.max(a.width,a.height);g=Math.round(a.width*b)+2*f;e=Math.round(a.height*b)+2*f;c=[];for(var k of d)if(k&&1<k.length){d=[];for(var p of k){let [B,G]=p;B-=a.x;G-=a.y;B*=b;G*=b;B+=f-.5;G+=f-.5;h.asFill?d.push([B,G]):d.push([Math.round(B),Math.round(G)])}if(h.asFill){var q=d.length-1;d[0][0]===d[q][0]&&d[0][1]===d[q][1]||d.push(d[0])}c.push(d)}p=g*e;k=Array(p);d=f*f+1;for(a=0;a<p;++a)k[a]=d;for(var t of c)for(d=t.length,a=1;a<d;++a){b=t[a-1];q=t[a];var v=void 0,y=void 0;b[0]<
q[0]?(v=b[0],y=q[0]):(v=q[0],y=b[0]);var w=void 0,z=void 0;b[1]<q[1]?(w=b[1],z=q[1]):(w=q[1],z=b[1]);var r=Math.floor(v)-f;y=Math.floor(y)+f;w=Math.floor(w)-f;z=Math.floor(z)+f;0>r&&(r=0);y>g&&(y=g);0>w&&(w=0);z>e&&(z=e);v=q[0]-b[0];const B=q[1]-b[1],G=v*v+B*B;for(;r<y;r++)for(let H=w;H<z;H++){var C=(r-b[0])*v+(H-b[1])*B,x=void 0;0>C?(x=b[0],C=b[1]):C>G?(x=q[0],C=q[1]):(C/=G,x=b[0]+C*v,C=b[1]+C*B);x=(r-x)*(r-x)+(H-C)*(H-C);C=(e-H-1)*g+r;x<k[C]&&(k[C]=x)}}for(t=0;t<p;++t)k[t]=Math.sqrt(k[t]);if(h.asFill)for(var E of c)for(h=
E.length,t=1;t<h;++t)for(c=E[t-1],p=E[t],c[0]<p[0]?(d=c[0],a=p[0]):(d=p[0],a=c[0]),c[1]<p[1]?(q=c[1],b=p[1]):(q=p[1],b=c[1]),d=Math.floor(d),a=Math.floor(a)+1,q=Math.floor(q),b=Math.floor(b)+1,d<f&&(d=f),a>g-f&&(a=g-f),q<f&&(q=f),b>e-f&&(b=e-f);q<b;++q)if(c[1]>q!==p[1]>q){y=(e-q-1)*g;for(w=d;w<a;++w)w<(p[0]-c[0])*(q-c[1])/(p[1]-c[1])+c[0]&&(k[y+w]=-k[y+w]);for(w=f;w<d;++w)k[y+w]=-k[y+w]}E=2*f;f=k.length;h=new Uint8Array(4*f);for(t=0;t<f;++t)l.packFloatRGBA(.5-k[t]/E,h,4*t);return[h,g,e]};n.getExtent=
function(h){return h?h.rings?m(h.rings):h.paths?m(h.paths):F.isExtent(h)?[h.xmin,h.ymin,h.xmax,h.ymax]:null:null};n.getSDFInfo=u;n.getSDFMetrics=function(h,f,d,c,a){const [b,g,e,k]=h;if(e<b||k<g)return[0,0,0];var p=e-b,q=k-g,t=A.SPRITE_PADDING;h=Math.floor(.5*(64-t));t=(128-2*(h+t))/Math.max(p,q);const v=Math.round(p*t),y=Math.round(q*t)+2*h;q=1;f&&(q=y/t/(f.ymax-f.ymin));let w=0,z=0;p=1;c&&(a?f&&d&&0<f.ymax-f.ymin&&(p=(f.xmax-f.xmin)/(f.ymax-f.ymin),w=c.x/(d*p),z=c.y/d):(w=c.x,z=c.y));f&&(w=.5*(f.xmax+
f.xmin)+w*(f.xmax-f.xmin),z=.5*(f.ymax+f.ymin)+z*(f.ymax-f.ymin));w=(w-b)*t+h;z=(z-g)*t+h;f=w/(v+2*h)-.5;c=z/y-.5;a&&d&&(f*=d*p,c*=d);return[q,f,c]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(n,l,F,D,
A,u,m,h){function f(c){const a=new Set;for(const b of c)a.add(Math.floor(b/256));return a}function d(c,a,b){c.has(a)||c.set(a,b().then(()=>{c.delete(a)}).catch(g=>{c.delete(a);F.throwIfNotAbortError(g)}));return c.get(a)}return function(){function c(b,g,e){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this._preloadCache={};this.width=b;this.height=g;this._glyphSource=e;this._binPack=new A(b-4,g-4);
this._glyphData.push(new Uint8Array(b*g));this._dirties.push(!0);this._textures.push(null);this._initDecorationGlyphs()}var a=c.prototype;a.dispose=function(){this._binPack=null;for(const b of this._textures)b&&b.dispose();this._textures.length=0;this._glyphData.length=0};a._initDecorationGlyphs=function(){var b=[117,149,181,207,207,181,149,117];const g=[];var e=[];for(let k=0;k<b.length;k++){const p=b[k];for(let q=0;11>q;q++){const t=3<=k&&5>k&&3<=q&&8>q?255:0;g.push(p);e.push(t)}}b={metrics:{width:5,
height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(g)};e={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(b);this._recordGlyph(e)};a.getGlyphItems=async function(b,g,e){const k=this._getGlyphCache(b);await this._fetchRanges(b,g,e);return g.map(p=>this._getMosaicItem(k,b,p))};a.bind=function(b,g,e,k){const p=this._getTexture(b,e);p.setSamplingMode(g);this._dirties[e]&&(p.setData(this._glyphData[e]),this._dirties[e]=!1);b.bindTexture(p,k)};a.preloadASCIIGlyphCache=
function(b){var g=this._preloadCache[b];if(null!=g)return g;g=this._glyphSource.preloadASCIIRange(b).then(()=>{const e=this._getGlyphCache(b);for(let k=0;256>k;k++)this._getMosaicItem(e,b,k)});return this._preloadCache[b]=g};a._getGlyphCache=function(b){this._glyphCache[b]||(this._glyphCache[b]={});return this._glyphCache[b]};a._getTexture=function(b,g){if(!this._textures[g]){const e=new h.TextureDescriptor;e.pixelFormat=u.PixelFormat.ALPHA;e.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;e.width=this.width;
e.height=this.height;this._textures[g]=new m.Texture(b,e,new Uint8Array(this.width*this.height))}return this._textures[g]};a._invalidate=function(){this._dirties[this._currentPage]=!0};a._fetchRanges=async function(b,g,e){const k=[];f(g).forEach(p=>{k.push(this._fetchRange(b,p,e))});await Promise.all(k)};a._fetchRange=async function(b,g,e){if(!(256<g))return d(this._rangePromises,b+g,()=>this._glyphSource.getRange(b,g,e))};a._getMosaicItem=function(b,g,e){if(!b[e]){g=this._glyphSource.getGlyph(g,
e);if(!g||!g.metrics)return{rect:new D(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0};const k=this._recordGlyph(g);b[e]={rect:k,page:this._currentPage,metrics:g.metrics,code:e,sdf:!0};this._invalidate()}return b[e]};a._recordGlyph=function(b){var g=b.metrics;if(0===g.width)g=new D(0,0,0,0);else{const e=g.width+6,k=g.height+6;g=this._binPack.allocate(e,k);g.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,
this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new A(this.width-4,this.height-4),g=this._binPack.allocate(e,k));const p=this._glyphData[this._currentPage];b=b.bitmap;let q,t;if(b)for(let v=0;v<k;v++){q=e*v;t=this.width*(g.y+v)+g.x;for(let y=0;y<e;y++)p[t+y]=b[q+y]}l("esri-glyph-debug")&&this._showDebugPage(p)}return g};a._showDebugPage=function(b){const g=document.createElement("canvas"),e=g.getContext("2d"),
k=new ImageData(this.width,this.height),p=k.data;g.width=this.width;g.height=this.height;g.style.border="1px solid black";for(let q=0;q<b.length;++q)p[4*q]=b[q],p[4*q+1]=0,p[4*q+2]=0,p[4*q+3]=255;e.putImageData(k,0,0);document.body.appendChild(g)};return n._createClass(c)}()})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./Rect"],function(n,l){return function(){function F(A,u){this._height=this._width=0;this._free=[];this._width=
A;this._height=u;this._free.push(new l(0,0,A,u))}var D=F.prototype;D.allocate=function(A,u){if(A>this._width||u>this._height)return new l;let m=null,h=-1;for(let f=0;f<this._free.length;++f){const d=this._free[f];A<=d.width&&u<=d.height&&(null===m||d.y<=m.y&&d.x<=m.x)&&(m=d,h=f)}if(null===m)return new l;this._free.splice(h,1);m.width<m.height?(m.width>A&&this._free.push(new l(m.x+A,m.y,m.width-A,u)),m.height>u&&this._free.push(new l(m.x,m.y+u,m.width,m.height-u))):(m.width>A&&this._free.push(new l(m.x+
A,m.y,m.width-A,m.height)),m.height>u&&this._free.push(new l(m.x,m.y+u,A,m.height-u)));return new l(m.x,m.y,A,u)};D.release=function(A){for(let u=0;u<this._free.length;++u){const m=this._free[u];if(m.y===A.y&&m.height===A.height&&m.x+m.width===A.x)m.width+=A.width;else if(m.x===A.x&&m.width===A.width&&m.y+m.height===A.y)m.height+=A.height;else if(A.y===m.y&&A.height===m.height&&A.x+A.width===m.x)m.x=A.x,m.width+=A.width;else if(A.x===m.x&&A.width===m.width&&A.y+A.height===m.y)m.y=A.y,m.height+=A.height;
else continue;this._free.splice(u,1);this.release(A)}this._free.push(A)};n._createClass(F,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);return F}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../request","../../../../core/pbf"],function(n,l,F){let D=function(){function u(h){this._metrics=[];for(this._bitmaps=[];h.next();)switch(h.tag()){case 1:const f=h.getMessage();
for(;f.next();)switch(f.tag()){case 3:const d=f.getMessage();let c,a,b,g,e,k,p;for(;d.next();)switch(d.tag()){case 1:c=d.getUInt32();break;case 2:a=d.getBytes();break;case 3:b=d.getUInt32();break;case 4:g=d.getUInt32();break;case 5:e=d.getSInt32();break;case 6:k=d.getSInt32();break;case 7:p=d.getUInt32();break;default:d.skip()}d.release();c&&(this._metrics[c]={width:b,height:g,left:e,top:k,advance:p},this._bitmaps[c]=a);break;default:f.skip()}f.release();break;default:h.skip()}}var m=u.prototype;
m.getMetrics=function(h){return this._metrics[h]};m.getBitmap=function(h){return this._bitmaps[h]};return n._createClass(u)}(),A=function(){function u(){this._ranges=[]}var m=u.prototype;m.getRange=function(h){return this._ranges[h]};m.addRange=function(h,f){this._ranges[h]=f};return n._createClass(u)}();return function(){function u(h){this._glyphInfo={};this._baseURL=h}var m=u.prototype;m.getRange=function(h,f,d){const c=this._getFontStack(h);if(c.getRange(f))return Promise.resolve();const a=256*
f,b=a+255;h=this._baseURL.replace("{fontstack}",h).replace("{range}",a+"-"+b);return l(h,{responseType:"array-buffer",...d}).then(g=>{c.addRange(f,new D(new F(new Uint8Array(g.data),new DataView(g.data))))})};m.preloadASCIIRange=async function(h){const f=this._getFontStack(h);h=this._baseURL.replace("{fontstack}",h).replace("{range}","0-255");h=await l(h,{responseType:"array-buffer"});h=new D(new F(new Uint8Array(h.data),new DataView(h.data)));for(let d=0;255>=d;d++)f.getRange(d)||f.addRange(d,h)};
m.getGlyph=function(h,f){if(h=this._getFontStack(h))if(h=h.getRange(Math.floor(f/256)))return{metrics:h.getMetrics(f),bitmap:h.getBitmap(f)}};m._getFontStack=function(h){let f=this._glyphInfo[h];f||(f=this._glyphInfo[h]=new A);return f};return n._createClass(u)}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/floatRGBA","../../../../core/promiseUtils"],function(n,l,F){return function(){function D(u){this._svg=null;
this.size=u;const m=document.createElement("canvas");m.width=m.height=u;this._context=m.getContext("2d");this._gridOuter=new Float64Array(u*u);this._gridInner=new Float64Array(u*u);this._f=new Float64Array(u);this._d=new Float64Array(u);this._z=new Float64Array(u+1);this._v=new Int16Array(u)}var A=D.prototype;A.dispose=function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg&&(document.body.removeChild(this._svg),this._svg=null)};A.draw=function(u,m,
h=31){this._initSVG();const f=this.createSVGString(u);return new Promise((d,c)=>{const a=new Image;a.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(f);a.onload=()=>{a.onload=null;this._context.clearRect(0,0,this.size,this.size);this._context.drawImage(a,0,0,this.size,this.size);var g=this._context.getImageData(0,0,this.size,this.size);const e=new Uint8Array(this.size*this.size*4);for(let k=0;k<this.size*this.size;k++){const p=g.data[4*k+3]/255;this._gridOuter[k]=1===p?0:0===p?1E20:
Math.max(0,.5-p)**2;this._gridInner[k]=1===p?1E20:0===p?0:Math.max(0,p-.5)**2}this._edt(this._gridOuter,this.size,this.size);this._edt(this._gridInner,this.size,this.size);for(g=0;g<this.size*this.size;g++)l.packFloatRGBA(.5-(this._gridOuter[g]-this._gridInner[g])/(2*h),e,4*g);d(e)};const b=m&&m.signal;if(b)F.onAbort(b,()=>c(F.createAbortError()))})};A._initSVG=function(){if(!this._svg){const u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("style","position: absolute;");
u.setAttribute("width","0");u.setAttribute("height","0");u.setAttribute("aria-hidden","true");u.setAttribute("role","presentation");document.body.appendChild(u);this._svg=u}return this._svg};A.createSVGString=function(u){const m=this._initSVG(),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",u);m.appendChild(h);u=h.getBBox();var f=u.width/u.height;const d=this.size/2;let c,a,b;1<f?(a=c=d/u.width,b=this.size/4,f=d-1/f*d/2):(c=a=d/u.height,b=d-d*f/2,f=this.size/4);
h.setAttribute("style",`transform: matrix(${c}, 0, 0, ${a}, ${-u.x*c+b}, ${-u.y*a+f})`);u=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${m.innerHTML}</svg>`;m.removeChild(h);return u};A._edt=function(u,m,h){const f=this._f,d=this._d,c=this._v,a=this._z;for(var b=0;b<m;b++){for(var g=0;g<h;g++)f[g]=u[g*m+b];this._edt1d(f,d,c,a,h);for(g=0;g<h;g++)u[g*m+b]=d[g]}for(b=0;b<h;b++){for(g=0;g<m;g++)f[g]=u[b*m+g];this._edt1d(f,d,c,a,m);for(g=0;g<m;g++)u[b*
m+g]=Math.sqrt(d[g])}};A._edt1d=function(u,m,h,f,d){h[0]=0;f[0]=-1E20;f[1]=1E20;for(let c=1,a=0;c<d;c++){let b=(u[c]+c*c-(u[h[a]]+h[a]*h[a]))/(2*c-2*h[a]);for(;b<=f[a];)a--,b=(u[c]+c*c-(u[h[a]]+h[a]*h[a]))/(2*c-2*h[a]);a++;h[a]=c;f[a]=b;f[a+1]=1E20}for(let c=0,a=0;c<d;c++){for(;f[a+1]<c;)a++;m[c]=(c-h[a])*(c-h[a])+u[h[a]]}};return n._createClass(D)}()})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/has ./definitions ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f,d){function c(b){return b&&"static"===b.type}let a=0;return function(){function b(e,k,p=0){this._mosaicPages=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=e||0>=k)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=e;this._pageHeight=k;0<p&&(this._maxItemSize=p);this.pixelRatio=window.devicePixelRatio||1;this._binPack=
new m(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}var g=b.prototype;g.getWidth=function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]};g.getHeight=function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]};g.getPageTexture=function(e){return e<this._mosaicPages.length?
this._mosaicPages[e].texture:null};g.has=function(e){return this._mosaicRects.has(e)};g.getSpriteItem=function(e){return this._mosaicRects.get(e)};g.addSpriteItem=function(e,k,p,q,t,v,y=1){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);let w,z,r;c(p)?[w,z,r]=this._allocateImage(k[0],k[1]):(w=new u(0,0,k[0],k[1]),z=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:p,size:[k[0]+2*D.SPRITE_PADDING,k[1]+2*D.SPRITE_PADDING],dirty:!0,texture:void 0}));if(0>=w.width||0>=w.height)return null;
v={rect:w,width:k[0],height:k[1],sdf:t,simplePattern:v,pixelRatio:y,page:z};this._mosaicRects.set(e,v);c(p)&&(F("esri-mosaic-debug")&&this._showDebugSprite(k,p.data),this._copy({rect:w,spriteSize:k,spriteData:p.data,page:z,pageSize:r,repeat:q,sdf:t}));return v};g.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};g.processNextItem=function(){const e=this._spriteCopyQueue.pop();e&&this._copy(e)};g.getSpriteItems=function(e){const k={};for(const p of e)k[p]=this.getSpriteItem(p);
return k};g.getMosaicItemPosition=function(e){const k=(e=this.getSpriteItem(e))&&e.rect;if(!k)return null;k.width=e.width;k.height=e.height;const p=D.SPRITE_PADDING,q=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(k.x+p)/q[0],(k.y+p)/q[1]],br:[(k.x+p+e.width)/q[0],(k.y+p+e.height)/q[1]],page:e.page}};g.bind=function(e,k,p=0,q=0){const t=this._mosaicPages[p],v=t.mosaicsData;var y=t.texture;if(!y){y=t.size;const w=new d.TextureDescriptor;w.width=y[0];w.height=y[1];w.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;
y=new f.Texture(e,w,null);t.texture=y}y.setSamplingMode(k);c(v)?(e.bindTexture(y,q),t.dirty&&(y.setData(new Uint8Array(v.data.buffer)),y.generateMipmap(),F("esri-mosaic-debug")&&this._showDebugPage(p))):(v.data.bindFrame(e,y,q),y.generateMipmap());t.dirty=!1};g.dispose=function(){this._binPack=null;for(const k of this._mosaicPages){var e=k.texture;e&&e.dispose();e=k.mosaicsData;c(e)||e.data.destroy()}this._mosaicPages=null;this._mosaicRects.clear()};b._copyBits=function(e,k,p,q,t,v,y,w,z,r,C){let x=
q*k+p;y=w*v+y;if(C)for(y-=v,C=-1;C<=r;C++,x=((C+r)%r+q)*k+p,y+=v)for(w=-1;w<=z;w++)t[y+w]=e[x+(w+z)%z];else for(p=0;p<r;p++){for(q=0;q<z;q++)t[y+q]=e[x+q];x+=k;y+=v}};g._copy=function(e){if(!(e.page>=this._mosaicPages.length)){var k=this._mosaicPages[e.page],p=k.mosaicsData;if(!c(k.mosaicsData))throw new l("mapview-invalid-resource","unsuitable data type!");var q=e.spriteData;(p=p.data)&&q||console.error("Source or target images are uninitialized!");b._copyBits(q,e.spriteSize[0],0,0,p,e.pageSize[0],
e.rect.x+D.SPRITE_PADDING,e.rect.y+D.SPRITE_PADDING,e.spriteSize[0],e.spriteSize[1],e.repeat);k.dirty=!0}};g._allocateImage=function(e,k){e+=2*D.SPRITE_PADDING;k+=2*D.SPRITE_PADDING;var p=Math.max(e,k);if(this._maxItemSize&&this._maxItemSize<p){p=2**Math.ceil(A.log2(e));const q=2**Math.ceil(A.log2(k));e=new u(0,0,e,k);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(p*q)},size:[p,q],dirty:!0,texture:void 0});return[e,this._mosaicPages.length-1,[p,q]]}p=this._binPack.allocate(e,
k);return 0>=p.width?(p=this._mosaicPages[this._currentPage],!p.dirty&&c(p.mosaicsData)&&(p.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new m(this._pageWidth,this._pageHeight),this._allocateImage(e,k)):[p,this._currentPage,[this._pageWidth,this._pageHeight]]};g._showDebugSprite=function([e,k],
p){const q=document.createElement("canvas");q.width=e;q.height=k;q.setAttribute("style",`position: absolute; top: ${4+204*a++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const t=q.getContext("2d");e=new ImageData(e,k);e.data.set(new Uint8Array(p.buffer));t.putImageData(e,0,0);document.body.appendChild(q)};g._showDebugPage=function(e){const {size:[k,p],mosaicsData:q}=this._mosaicPages[e];if(c(q)){var t=`mosaicDebugPage${e}`,v=document.getElementById(t)??document.createElement("canvas");
v.id=t;v.width=k;v.height=p;v.setAttribute("style",`position: absolute; top: ${4+204*e}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);e=v.getContext("2d");t=new ImageData(k,p);t.data.set(new Uint8Array(q.data.buffer));e.putImageData(t,0,0);document.body.appendChild(v)}else console.error("Could not show sprite mosaic debug for non-static resource")};n._createClass(b,[{key:"itemCount",get:function(){return this._mosaicRects.size}}]);return b}()})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./utils"],function(n,l,F,D){let A=function(){function u(h,f,d,c){this._animation=h;this._frameData=null;this.frameCount=this._animation.frameDurations.length;this.width=this._animation.width;this.height=this._animation.height;this._playHandle=D.play(this._animation,d,c,a=>{this._frameData=a;f.requestRender()})}var m=u.prototype;m.destroy=function(){this._playHandle.remove()};m.bindFrame=function(h,f,d){h.bindTexture(f,d);null!=this._frameData&&
(f.updateData(0,F.SPRITE_PADDING,F.SPRITE_PADDING,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)};return l._createClass(u)}();n.AnimatableTextureResource=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ../../../../../symbols/cim/enums ../grouping".split(" "),
function(n,l,F,D,A,u){function m(k){return F.Milliseconds(k.frameDurations.reduce((p,q)=>p+q,0))}function h(k){const {width:p,height:q}=k;return{frameDurations:k.frameDurations.reverse(),getFrame:t=>k.getFrame(k.frameDurations.length-1-t),width:p,height:q}}function f(k,p){const {width:q,height:t,getFrame:v}=k,y=m(k),w=p/y;return{frameDurations:k.frameDurations.map(z=>F.Milliseconds(z*w)),getFrame:v,width:q,height:t}}function d(k,p){const {width:q,height:t,getFrame:v}=k;k=k.frameDurations.slice();
const y=k.shift();k.unshift(F.Milliseconds(y+p));return{frameDurations:k,getFrame:v,width:q,height:t}}function c(k,p){const {width:q,height:t,getFrame:v}=k;k=k.frameDurations.slice();const y=k.pop();k.push(F.Milliseconds(y+p));return{frameDurations:k,getFrame:v,width:q,height:t}}function a(k,p,q,t){let {repeatType:v}=p;null==v&&(v=A.AnimatedSymbolRepeatType.Loop);!0===p.reverseAnimation&&(k=h(k));null!=p.duration&&(k=f(k,F.Milliseconds(1E3*p.duration)));if(null!=p.repeatDelay){const y=1E3*p.repeatDelay;
v===A.AnimatedSymbolRepeatType.Loop?k=c(k,F.Milliseconds(y)):v===A.AnimatedSymbolRepeatType.Oscillate&&(k=d(c(k,F.Milliseconds(y/2)),F.Milliseconds(y/2)))}null!=p.startTimeOffset?p=F.Milliseconds(1E3*p.startTimeOffset):null!=p.randomizeStartTime?(q=u.getMaterialGroup(q),p=u.getRandomValue(q,null!=p.randomizeStartSeed?p.randomizeStartSeed:82749913),p=F.Milliseconds(p*m(k))):p=F.Milliseconds(0);return new b(k,p,v,t)}let b=function(){function k(p,q,t,v){this._animation=p;this._repeatType=t;this._onFrameData=
v;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(p=0;q>p;)p+=this.timeToFrame,this.nextFrame();q=this._animation.getFrame(this._currentFrame);this._onFrameData(q)}k.prototype.nextFrame=function(){this._currentFrame+=this._direction;if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case A.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case A.AnimatedSymbolRepeatType.Loop:this._currentFrame=
0;break;case A.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case A.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case A.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case A.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];
const p=this._animation.getFrame(this._currentFrame);this._onFrameData(p)};return l._createClass(k)}();const g=document.createElement("canvas"),e=g.getContext("2d");n.Player=b;n.adjustDuration=f;n.appendDelay=c;n.createPlayer=a;n.getDuration=m;n.play=function(k,p,q,t){function v(){r=y?setTimeout(()=>{w.nextFrame();z=w.timeToFrame;v()},z):void 0}const y=null!=p.playAnimation?p.playAnimation:!0,w=a(k,p,q,t);let z=w.timeToFrame,r;v();return{remove:()=>{y&&clearTimeout(r)}}};n.prependDelay=d;n.resize=
function(k,p,q){g.width=p;g.height=q;const t=[],v=k.frameDurations.length;for(let y=0;y<v;y++){const w=k.getFrame(y);e.clearRect(0,0,p,q);w instanceof ImageData?e.drawImage(D.imageTypeToCanvas(w),0,0,p,q):e.drawImage(w,0,0,p,q);t.push(e.getImageData(0,0,p,q))}return{width:p,height:q,frameDurations:k.frameDurations,getFrame:y=>t[y]}};n.reverse=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],
function(n,l){function F(D,A){if("string"===typeof D)D=l.numericHash(D+`-seed(${A})`);else{let u=12;D^=A;do D=107*(D>>8^D)+u|0;while(0!==--u)}return(1+D/-2147483648)/2}n.getMaterialGroup=function(D){return Math.floor(10*F(D,53290320))};n.getRandomValue=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Result":function(){define(["exports","../../../../../core/Error"],function(n,l){n.ok=function(F,D){return F&&"name"in F?(D&&D.error(new l(F.name,F.message,
F.details)),!1):!0};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["exports"],function(n){n.keyFromSymbol=function(l){switch(l.type){case "esriSMS":return`${l.style}.${l.path}`;case "esriSLS":return`${l.style}.${l.cap}`;case "esriSFS":return`${l.style}`;case "esriPFS":case "esriPMS":return l.imageData?`${l.imageData}${l.width}${l.height}`:`${l.url}${l.width}${l.height}`;default:return"mosaicHash"in l?l.mosaicHash:JSON.stringify(l)}};
Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","./definitions","../../../webgl/contextUtils"],function(n,l,F,D,A){let u=function(){function m(f,d){this._queue=[];this._context=f;this._refreshable=d}var h=m.prototype;h.destroy=function(){this._queue=[]};h.enqueueTextureUpdate=function(f,d){const c=F.createResolver(),a=D.TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE,
b=Math.ceil(f.height/a);F.throwIfAborted(d);if(this._context.type===A.ContextType.WEBGL1)this._queue.push({type:"no-chunk",request:f,resolver:c,options:d});else for(let g=0;g<b;g++){const e=g===b-1;this._queue.push({type:"chunk",request:f,resolver:c,chunk:g,chunkOffset:g*a,destHeight:e?f.height-a*g:a,chunkIsLast:e,options:d})}F.onAbortOrThrow(d,g=>c.reject(g));return c.promise};h.upload=function(){let f=0;for(;this._queue.length;){var d=performance.now();const c=this._queue.shift();if(c&&(null==c.options.signal||
!c.options.signal.aborted)){switch(c.type){case "chunk":this._uploadChunk(c);break;case "no-chunk":this._uploadNoChunk(c)}d=performance.now()-d;f+=d;if(f+d>=D.TEXTURE_UPLOAD_MANAGER_BUDGET)break}}this._queue.length&&this._refreshable.requestRender()};h._uploadChunk=function(f){const {request:d,resolver:c,chunkOffset:a,chunkIsLast:b,destHeight:g}=f,{data:e,texture:k,width:p}=d;null!=e&&(k.updateData(0,0,a,p,g,e,a),b&&c.resolve())};h._uploadNoChunk=function(f){const {request:d,resolver:c}=f,{data:a,
texture:b}=d;b.setData(a);c.resolve()};return l._createClass(m)}();n.TextureUploadManager=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/common ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./VertexStream ./shaders/StencilPrograms ../../../webgl/enums ../../../webgl/ProgramTemplate".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){const g=m.fromValues(-.5,-.5);m=function(){function e(){this._centerNdc=f.create();this._pxToNdc=f.create();this._worldDimensionsPx=f.create();this._mat3=u.create();this._initialized=!1}var k=e.prototype;k.dispose=function(){this._program=F.disposeMaybe(this._program);this._quad=F.disposeMaybe(this._quad)};k.render=function(p,q){const {context:t}=p;if(!this._updateGeometry(p,q))return!1;this._initialized||this._initialize(t);t.setDepthWriteEnabled(!1);t.setDepthTestEnabled(!1);
t.setColorMask(!1,!1,!1,!1);t.setBlendingEnabled(!1);t.setStencilOp(a.StencilOperation.KEEP,a.StencilOperation.KEEP,a.StencilOperation.REPLACE);t.setStencilFunction(a.CompareFunction.ALWAYS,1,255);t.setStencilTestEnabled(!0);t.useProgram(this._program);this._program.setUniformMatrix3fv("u_worldExtent",this._mat3);this._quad.draw();this._quad.unbind();return!0};k._initialize=function(p){if(!this._initialized){var q=b.createProgram(p,c.stencil);q&&(this._program=q,this._quad=new d(p,[0,0,1,0,0,1,1,
1]),this._initialized=!0)}};k._updateGeometry=function(p,q){const {state:t,pixelRatio:v}=p,{size:y,rotation:w}=t,z=Math.round(y[0]*v),r=Math.round(y[1]*v);if(!t.spatialReference.isWrappable)return!1;p=D.toRadian(w);const C=Math.abs(Math.cos(p)),x=Math.abs(Math.sin(p)),E=Math.round(t.worldScreenWidth);if(Math.round(z*C+r*x)<=E)return!1;const B=(q.left-q.right)*v/z;q=(q.bottom-q.top)*v/r;h.set(this._worldDimensionsPx,E*v,z*x+r*C,1);h.set(this._pxToNdc,2/z,-2/r,1);h.set(this._centerNdc,B,q,1);q=this._mat3;
A.fromTranslation(q,this._centerNdc);A.scale(q,q,this._pxToNdc);0!==w&&A.rotate(q,q,p);A.scale(q,q,this._worldDimensionsPx);A.translate(q,q,g);return!0};return l._createClass(e)}();n.WorldExtentClipRenderer=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports","./sources/resolver"],function(n,l){l={shaders:{vertexShader:l.resolveIncludes("stencil/stencil.vert"),fragmentShader:l.resolveIncludes("stencil/stencil.frag")},
attributes:new Map([["a_pos",0]])};n.stencil=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../definitions ../VertexStream ./Effect".split(" "),function(n,l,F,D,A,u){u=function(m){function h(){var d=m.apply(this,arguments)||this;d.defines=[];d._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])};
return d}l._inherits(h,m);var f=h.prototype;f.dispose=function(){this._quad&&this._quad.dispose()};f.bind=function(){};f.unbind=function(){};f.draw=function(d,c){if(c?.size){var {context:a,renderingOptions:b}=d;this._quad||(this._quad=new A(a,[0,0,1,0,0,1,1,1]));var g=a.getBoundFramebufferObject(),{x:e,y:k,width:p,height:q}=a.getViewport();c.bindTextures(a);var t=c.getBlock(D.ATTRIBUTE_DATA_ANIMATION);if(null!=t){var v=t.getFBO(a);t=t.getFBO(a,1);a.setViewport(0,0,c.size,c.size);this._computeDelta(d,
t,b.labelsAnimationTime);this._updateAnimationState(d,t,v);a.bindFramebuffer(g);a.setViewport(e,k,p,q)}}};f._computeDelta=function(d,c,a){const {context:b,painter:g,displayLevel:e}=d,k=g.materialManager.getProgram(this._desc,["delta"]);b.bindFramebuffer(c);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);b.useProgram(k);c=F("featurelayer-animation-enabled")?a:1;k.setUniform1i("u_maskTexture",D.TEXTURE_BINDING_ATTRIBUTE_DATA_0);k.setUniform1i("u_sourceTexture",D.TEXTURE_BINDING_ATTRIBUTE_DATA_1);
k.setUniform1f("u_timeDelta",d.deltaTime);k.setUniform1f("u_animationTime",c);k.setUniform1f("u_zoomLevel",Math.round(10*e));this._quad.draw()};f._updateAnimationState=function(d,c,a){const {context:b,painter:g}=d;d=g.materialManager.getProgram(this._desc,["update"]);b.bindTexture(c.colorTexture,1);b.useProgram(d);d.setUniform1i("u_sourceTexture",1);b.bindFramebuffer(a);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._quad.draw()};return l._createClass(h)}(u.Effect);n.AnimationEffect=
u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ../shaders/BlendPrograms ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(n,l,F,D,A,u,m,h,f,d,c){const a=D.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");
D=function(){function b(){this._size=[0,0]}var g=b.prototype;g.dispose=function(e){this._backBufferTexture=A.disposeMaybe(this._backBufferTexture);this._quad=A.disposeMaybe(this._quad)};g.draw=function(e,k,p,q,t){const {context:v,drawPhase:y}=e;this._setupShader(v);q&&"normal"!==q&&y!==u.WGLDrawPhase.LABEL?this._drawBlended(e,k,p,q,t):(e=h.createProgramTemplate("normal"),(e=v.programCache.acquire(e.shaders.vertexShader,e.shaders.fragmentShader,e.attributes))?(v.useProgram(e),k.setSamplingMode(p),
v.bindTexture(k,0),e.setUniform1i("u_layerTexture",0),e.setUniform1f("u_opacity",t),v.setBlendingEnabled(!0),v.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),k=this._quad,k.draw(),k.unbind(),e.dispose()):a.error(new F("mapview-BlendEffect",'Error creating shader program for blend mode "normal"')))};g._drawBlended=function(e,k,p,q,t){const {context:v,state:y,pixelRatio:w,inFadeTransition:z}=e;var {size:r}=y,C=v.getBoundFramebufferObject();let x;null!=C?(x=C.width,r=C.height):
(x=Math.round(w*r[0]),r=Math.round(w*r[1]));this._createOrResizeTexture(e,x,r);e=this._backBufferTexture;C.copyToTexture(0,0,x,r,0,0,e);v.setStencilTestEnabled(!1);v.setStencilWriteMask(0);v.setBlendingEnabled(!0);v.setDepthTestEnabled(!1);v.setDepthWriteEnabled(!1);C=h.createProgramTemplate(q);(C=v.programCache.acquire(C.shaders.vertexShader,C.shaders.fragmentShader,C.attributes))?(v.useProgram(C),e.setSamplingMode(p),v.bindTexture(e,0),C.setUniform1i("u_backbufferTexture",0),k.setSamplingMode(p),
v.bindTexture(k,1),C.setUniform1i("u_layerTexture",1),C.setUniform1f("u_opacity",t),C.setUniform1f("u_inFadeOpacity",z?1:0),v.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ZERO),k=this._quad,k.draw(),k.unbind(),C.dispose(),v.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA)):a.error(new F("mapview-BlendEffect",`Error creating shader program for blend mode ${q}`))};g._setupShader=function(e){this._quad||(this._quad=new m(e,[-1,-1,1,-1,-1,1,1,1]))};g._createOrResizeTexture=function(e,
k,p){({context:e}=e);if(null===this._backBufferTexture||k!==this._size[0]||p!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(k,p);else{const q=new c.TextureDescriptor;q.internalFormat=f.PixelFormat.RGBA;q.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;q.width=k;q.height=p;this._backBufferTexture=new d.Texture(e,q)}this._size[0]=k;this._size[1]=p}};return l._createClass(b)}();n.BlendEffect=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BlendPrograms":function(){define(["exports",
"./sources/resolver"],function(n,l){n.createProgramTemplate=function(F){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:`#define ${F.replace("-","_").toUpperCase()}\n`+l.resolveIncludes("blend/blend.vert"),fragmentShader:`#define ${F.replace("-","_").toUpperCase()}\n`+l.resolveIncludes("blend/blend.frag")}}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Effect","../../../../webgl/enums"],function(n,l,F,D){F=function(A){function u(h){var f=A.call(this)||this;f.name=f.constructor.name;f.defines=[h];return f}l._inherits(u,A);var m=u.prototype;m.dispose=function(){};m.bind=function({context:h,painter:f}){this._prev=h.getBoundFramebufferObject();const {width:d,height:c}=h.getViewport();f=f.getFbos(d,c).effect0;h.bindFramebuffer(f);h.setColorMask(!0,!0,!0,!0);h.setClearColor(0,0,0,0);h.clear(h.gl.COLOR_BUFFER_BIT)};m.unbind=function(){};m.draw=function(h,
f){const {context:d,painter:c}=h;f=c.getPostProcessingEffects(f);const a=d.getBoundFramebufferObject();for(const {postProcessingEffect:b,effect:g}of f)b.draw(h,a,g);d.bindFramebuffer(this._prev);d.setStencilTestEnabled(!1);c.blitTexture(d,a.colorTexture,D.TextureSamplingMode.NEAREST);d.setStencilTestEnabled(!0)};return l._createClass(u)}(F.Effect);n.FeatureEffect=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightRenderer ./highlight/HighlightSurfaces ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m){return function(h){function f(){var c=h.apply(this,arguments)||this;c.defines=["highlight"];c._hlRenderer=new A;c._width=void 0;c._height=void 0;c._boundFBO=null;c._hlSurfaces=new u;c._adjustedWidth=void 0;c._adjustedHeight=void 0;c._blitRenderer=new F.BitBlitRenderer;return c}n._inherits(f,h);var d=f.prototype;d.dispose=function(){this._hlSurfaces?.dispose();this._hlRenderer?.dispose();this._boundFBO=null};d.bind=function(c){const {context:a,painter:b}=c,{width:g,height:e}=
a.getViewport(),k=b.getFbos(g,e).effect0;this.setup(c,g,e);a.bindFramebuffer(k);a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};d.unbind=function(){};d.setup=function({context:c},a,b){this._width=a;this._height=b;const g=a%4,e=b%4;a+=2>g?-g:4-g;b+=2>e?-e:4-e;this._adjustedWidth=a;this._adjustedHeight=b;this._boundFBO=c.getBoundFramebufferObject();a=Math.round(1*a);b=Math.round(1*b);this._hlRenderer.setup(c,a,b);this._hlSurfaces.setup(c,a,b)};d.draw=function(c){const {context:a,
highlightGradient:b}=c;b&&(c=a.getBoundFramebufferObject(),a.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),a.setStencilTestEnabled(!1),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(a,c.colorTexture,m.TextureSamplingMode.NEAREST,1),a.setStencilTestEnabled(!1),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!0),a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),
this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex),a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex),a.bindFramebuffer(this._boundFBO),a.setBlendingEnabled(!0),a.setColorMask(!0,!0,!0,!0),a.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,b),this._boundFBO=null)};return n._createClass(f)}(D.Effect)})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/enums ../../../../../webgl/ProgramTemplate ../../../../../webgl/VertexArrayObject ../../../../../webgl/VertexElementDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f){return function(){function d(){this._height=this._width=void 0;this._resources=null}var c=d.prototype;c.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};c.preBlur=function(a,b){a.bindTexture(b,l.TEXTURE_BINDING_HIGHLIGHT_0);a.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",
[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",F.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);a.bindVAO()};c.finalBlur=function(a,b){a.bindTexture(b,l.TEXTURE_BINDING_HIGHLIGHT_0);a.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",F.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
a.bindVAO(this._resources.quadVAO);a.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);a.bindVAO()};c.renderHighlight=function(a,b,g){a.bindTexture(b,l.TEXTURE_BINDING_HIGHLIGHT_0);a.useProgram(this._resources.highlightProgram);g.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA);a.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);a.bindVAO()};c._initialize=function(a,
b,g){this._width=b;this._height=g;b=A.BufferObject.createVertex(a,u.Usage.STATIC_DRAW,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);g=new h.VertexArrayObject(a,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new f.VertexElementDescriptor("a_position",2,u.DataType.BYTE,0,4),new f.VertexElementDescriptor("a_texcoord",2,u.DataType.UNSIGNED_BYTE,2,4)]},{geometry:b});const e=m.createProgram(a,D.highlight),k=m.createProgram(a,D.blur);a.useProgram(e);e.setUniform1i("u_texture",l.TEXTURE_BINDING_HIGHLIGHT_0);
e.setUniform1i("u_shade",l.TEXTURE_BINDING_HIGHLIGHT_1);e.setUniform1f("u_sigma",F.SIGMA);a.useProgram(k);k.setUniform1i("u_texture",l.TEXTURE_BINDING_HIGHLIGHT_0);k.setUniform1f("u_sigma",F.SIGMA);this._resources={quadGeometry:b,quadVAO:g,highlightProgram:e,blurProgram:k}};c.setup=function(a,b,g){this._resources?(this._width=b,this._height=g):this._initialize(a,b,g)};return n._createClass(d)}()})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],
function(n,l){const F={shaders:{vertexShader:l.resolveIncludes("highlight/textured.vert"),fragmentShader:l.resolveIncludes("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};l={shaders:{vertexShader:l.resolveIncludes("highlight/textured.vert"),fragmentShader:l.resolveIncludes("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};n.blur=l;n.highlight=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/RenderbufferDescriptor ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u){function m(h,f,d){const c=new u.TextureDescriptor(f,d);c.wrapMode=F.TextureWrapMode.CLAMP_TO_EDGE;return new D.FramebufferObject(h,c,new A.RenderbufferDescriptor(F.RenderbufferFormat.STENCIL_INDEX8,f,d))}return function(){function h(){this._height=this._width=void 0;this._resources=null}var f=h.prototype;f.dispose=function(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=l.nullifyNonNullableForDispose(this._resources))};
f._initialize=function(d,c,a){this._width=c;this._height=a;const b=m(d,c,a);d=m(d,c,a);this._resources={sharedBlur1Fbo:b,sharedBlur2Fbo:d}};f.setup=function(d,c,a){!this._resources||this._width===c&&this._height===a||this.dispose();this._resources||this._initialize(d,c,a)};n._createClass(h,[{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Fbo.colorTexture}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Fbo.colorTexture}},
{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]);return h}()})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./Effect","../../../../webgl/enums"],function(n,l,F,D,A){D=function(u){function m(){var f=u.apply(this,arguments)||this;f.name=f.constructor.name;f.defines=["hittest"];return f}l._inherits(m,u);var h=m.prototype;h.dispose=function(){null!=this._fbo&&this._fbo.dispose()};
h.createOptions=function({pixelRatio:f},d,c=F.HITTEST_RADIUS){if(!d.length)return null;d=d.shift();const a=d.x,b=d.y;this._outstanding=d;return{type:"hittest",distance:c*f,position:[a,b]}};h.bind=function(f){const {context:d,attributeView:c}=f;c.size&&(f=c.getBlock(F.ATTRIBUTE_DATA_GPGPU),null!=f&&(f=f.getFBO(d),d.setViewport(0,0,c.size,c.size),d.bindFramebuffer(f),d.setColorMask(!0,!0,!0,!0),d.setClearColor(0,0,0,0),d.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)))};h.unbind=function(f){};h.draw=
function(f){if(null!=this._outstanding){var d=this._outstanding;this._outstanding=null;this._resolve(f,d.resolvers)}};h._resolve=async function(f,d){const {context:c,attributeView:a}=f;f=a.getBlock(F.ATTRIBUTE_DATA_GPGPU);if(null==f)d.forEach(e=>e.resolve([]));else{var b=f.getFBO(c);f=new Uint8Array(b.width*b.height*4);try{await b.readPixelsAsync(0,0,b.width,b.height,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,f)}catch(e){d.forEach(k=>k.resolve([]));return}b=[];for(let e=0;e<f.length;e+=4){const k=
f[e+3];f[e]&&b.push({id:e/4,directHits:k})}b.sort((e,k)=>k.directHits===e.directHits?k.id-e.id:k.directHits-e.directHits);var g=b.map(e=>e.id);d.forEach(e=>e.resolve(g))}};return l._createClass(m)}(D.Effect);n.HittestEffect=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HittestEffectVTL":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./Effect","../../../../webgl/enums"],function(n,l,F,D,A){D=function(u){function m(){var f=
u.apply(this,arguments)||this;f.name=f.constructor.name;f.defines=["id"];f._lastSize=0;f._boundFBO=null;return f}l._inherits(m,u);var h=m.prototype;h.dispose=function(){null!=this._fbo&&this._fbo.dispose()};h.bind=function({context:f,painter:d}){const {width:c,height:a}=f.getViewport();this._boundFBO=f.getBoundFramebufferObject();d=d.getFbos(c,a).effect0;f.bindFramebuffer(d);f.setColorMask(!0,!0,!0,!0);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT)};h.unbind=function({context:f}){f.bindFramebuffer(this._boundFBO);
this._boundFBO=null};h.draw=function(f,d,c=2*F.HITTEST_RADIUS){this._resolve(f,d,c)};h._resolve=async function({context:f,state:d,pixelRatio:c},a,b){const g=f.getBoundFramebufferObject(),e=d.size[1]*c,k=Math.round(b*c),p=k/2,q=k/2;this._ensureBuffer(k);a.forEach(async(t,v)=>{var y=new Map;await g.readPixelsAsync(Math.floor(v.x*c-k/2),Math.floor(e-v.y*c-k/2),k,k,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,this._buf);for(let r=0;r<this._buf32.length;r++){const C=this._buf32[r];if(4294967295!==C&&0!==
C){var w=r%k,z=k-Math.floor(r/k);w=(p-w)*(p-w)+(q-z)*(q-z);z=y.has(C)?y.get(C):4294967295;y.set(C,Math.min(w,z))}}y=Array.from(y).sort((r,C)=>r[1]-C[1]).map(r=>r[0]);t.resolve(y);a.delete(v)})};h._ensureBuffer=function(f){this._lastSize!==f&&(this._lastSize=f,this._buf=new Uint8Array(4*f*f),this._buf32=new Uint32Array(this._buf.buffer))};return l._createClass(m)}(D.Effect);n.HittestEffectVTL=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Bloom ./Blur ./Colorize ./DropShadow ./Opacity".split(" "),
function(n,l,F,D,A,u,m){const h={colorize:()=>new A.Colorize,blur:()=>new D.Blur,bloom:()=>new F.Bloom,opacity:()=>new m.Opacity,"drop-shadow":()=>new u.DropShadow};let f=function(){function d(){this._effectMap=new Map}var c=d.prototype;c.dispose=function(){this._effectMap.forEach(a=>a.dispose());this._effectMap.clear()};c.getPostProcessingEffects=function(a){if(!a||0===a.length)return[];const b=[];for(const g of a){a:switch(a=g.type,a){case "bloom":case "blur":case "opacity":case "drop-shadow":break a;
default:a="colorize"}let e=this._effectMap.get(a);e||(e=h[a](),this._effectMap.set(a,e));b.push({postProcessingEffect:e,effect:g})}return b};return l._createClass(d)}();n.EffectManager=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m){const h=[1,0],f=[0,1],d=[1,.8,.6,.4,.2],c=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];let a=function(){function b(){this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0];this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",
attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}var g=b.prototype;g.dispose=function(){this._quad=F.disposeMaybe(this._quad);this._intensityFBO=F.disposeMaybe(this._intensityFBO);this._compositeFBO=F.disposeMaybe(this._compositeFBO);if(this._mipsFBOs){for(let e=0;e<this._nMips;e++)this._mipsFBOs[e]&&
(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}};g.draw=function(e,k,p){const {width:q,height:t}=k,{context:v,painter:y}=e,{materialManager:w}=y;var z=v.gl;const r=this._programDesc,{strength:C,radius:x,threshold:E}=p;this._quad||(this._quad=new D(v,[-1,-1,1,-1,-1,1,1,1]));this._createOrResizeResources(e,q,t);v.setStencilTestEnabled(!1);v.setBlendingEnabled(!0);v.setBlendFunction(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setStencilWriteMask(0);
e=this._quad;e.bind();v.bindFramebuffer(this._intensityFBO);p=w.getProgram(r.luminosityHighPass);v.useProgram(p);v.bindTexture(k.colorTexture,0);p.setUniform1i("u_texture",0);p.setUniform3fv("u_defaultColor",[0,0,0]);p.setUniform1f("u_defaultOpacity",0);p.setUniform1f("u_luminosityThreshold",E);p.setUniform1f("u_smoothWidth",.01);p=[Math.round(q/2),Math.round(t/2)];v.setViewport(0,0,p[0],p[1]);v.setClearColor(0,0,0,0);v.clear(z.COLOR_BUFFER_BIT);e.draw();v.setBlendingEnabled(!1);z=this._intensityFBO.colorTexture;
for(let B=0;B<this._nMips;B++){const G=w.getProgram(r.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[B]}]);v.useProgram(G);v.bindTexture(z,B+1);G.setUniform1i("u_colorTexture",B+1);G.setUniform2fv("u_texSize",p);G.setUniform2fv("u_direction",h);v.setViewport(0,0,p[0],p[1]);const H=this._mipsFBOs[B];v.bindFramebuffer(H.horizontal);e.draw();z=H.horizontal.colorTexture;v.bindFramebuffer(H.vertical);v.bindTexture(z,B+1);G.setUniform2fv("u_direction",f);e.draw();z=H.vertical.colorTexture;p[0]=
Math.round(p[0]/2);p[1]=Math.round(p[1]/2)}v.setViewport(0,0,q,t);p=w.getProgram(r.composite,[{name:"nummips",value:5}]);v.bindFramebuffer(this._compositeFBO);v.useProgram(p);p.setUniform1f("u_bloomStrength",C);p.setUniform1f("u_bloomRadius",x);p.setUniform1fv("u_bloomFactors",d);p.setUniform3fv("u_bloomTintColors",c);v.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);p.setUniform1i("u_blurTexture1",1);v.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);p.setUniform1i("u_blurTexture2",
2);v.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3);p.setUniform1i("u_blurTexture3",3);v.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);p.setUniform1i("u_blurTexture4",4);v.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);p.setUniform1i("u_blurTexture5",5);e.draw();v.bindFramebuffer(k);v.setBlendingEnabled(!0);k=w.getProgram(r.blit);v.useProgram(k);v.bindTexture(this._compositeFBO.colorTexture,6);k.setUniform1i("u_texture",6);v.setBlendFunction(A.BlendFactor.ONE,A.BlendFactor.ONE);
e.draw();e.unbind();v.setBlendFunction(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setStencilTestEnabled(!0)};g._createOrResizeResources=function(e,k,p){({context:e}=e);if(!this._compositeFBO||this._size[0]!==k||this._size[1]!==p){this._size[0]=k;this._size[1]=p;var q=[Math.round(k/2),Math.round(p/2)];this._compositeFBO?this._compositeFBO.resize(k,p):(k=new m.TextureDescriptor(k,p),k.internalFormat=A.PixelFormat.RGBA,k.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE,this._compositeFBO=new u.FramebufferObject(e,
k));this._intensityFBO?this._intensityFBO.resize(q[0],q[1]):(k=new m.TextureDescriptor(q[0],q[1]),k.internalFormat=A.PixelFormat.RGBA,k.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE,this._intensityFBO=new u.FramebufferObject(e,k));for(k=0;k<this._nMips;k++)this._mipsFBOs[k]?(this._mipsFBOs[k].horizontal.resize(q[0],q[1]),this._mipsFBOs[k].vertical.resize(q[0],q[1])):(p=new m.TextureDescriptor(q[0],q[1]),p.internalFormat=A.PixelFormat.RGBA,p.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE,this._mipsFBOs[k]={horizontal:new u.FramebufferObject(e,
p),vertical:new u.FramebufferObject(e,p)}),q[0]=Math.round(q[0]/2),q[1]=Math.round(q[1]/2)}};return l._createClass(b)}();n.Bloom=a;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),function(n,l,F,D,A,u){const m=[1,0],
h=[0,1];let f=function(){function d(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}var c=d.prototype;c.dispose=function(){this._blurFBO&&(this._blurFBO.dispose(),
this._blurFBO=null)};c.draw=function(a,b,g){const {context:e}=a,{type:k,radius:p}=g;0!==p&&(this._createOrResizeResources(a),this._quad||(this._quad=new F(e,[-1,-1,1,-1,-1,1,1,1])),g=this._quad,g.bind(),"blur"===k?this._gaussianBlur(a,b,p):this._radialBlur(a,b),g.unbind())};c._gaussianBlur=function(a,b,g){const {context:e,state:k,painter:p,pixelRatio:q}=a;var {size:t}=k,{materialManager:v}=p;a=this._quad;t=[Math.round(q*t[0]),Math.round(q*t[1])];const y=this._blurFBO;v=v.getProgram(this._programDesc.gaussianBlur,
[{name:"radius",value:Math.ceil(g)}]);e.useProgram(v);e.setBlendingEnabled(!1);e.bindFramebuffer(y);e.bindTexture(b.colorTexture,4);v.setUniform1i("u_colorTexture",4);v.setUniform2fv("u_texSize",t);v.setUniform2fv("u_direction",m);v.setUniform1f("u_sigma",g);a.draw();e.bindFramebuffer(b);e.setStencilWriteMask(0);e.setStencilTestEnabled(!1);e.setDepthWriteEnabled(!1);e.setDepthTestEnabled(!1);e.bindTexture(y?.colorTexture,5);v.setUniform1i("u_colorTexture",5);v.setUniform2fv("u_direction",h);a.draw();
e.setBlendingEnabled(!0);e.setBlendFunction(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA);e.setStencilTestEnabled(!0)};c._radialBlur=function(a,b){const {context:g,painter:e}=a,{materialManager:k}=e,p=this._programDesc;a=this._quad;const q=this._blurFBO;g.bindFramebuffer(q);const t=k.getProgram(p.radialBlur);g.useProgram(t);g.setBlendingEnabled(!1);g.bindTexture(b.colorTexture,4);t.setUniform1i("u_colorTexture",4);a.draw();g.bindFramebuffer(b);g.setStencilWriteMask(0);g.setStencilTestEnabled(!1);
g.setDepthWriteEnabled(!1);g.setDepthTestEnabled(!1);g.setBlendingEnabled(!0);b=k.getProgram(p.blit);g.useProgram(b);g.bindTexture(q?.colorTexture,5);b.setUniform1i("u_texture",5);g.setBlendFunction(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA);a.draw()};c._createOrResizeResources=function(a){const {context:b,state:g,pixelRatio:e}=a;var {size:k}=g;a=Math.round(e*k[0]);k=Math.round(e*k[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===k||(this._size[0]=a,this._size[1]=k,this._blurFBO?this._blurFBO.resize(a,
k):(a=new u.TextureDescriptor(a,k),a.internalFormat=D.PixelFormat.RGBA,a.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE,this._blurFBO=new A.FramebufferObject(b,a)))};return l._createClass(d)}();n.Blur=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m){let h=function(){function f(){this._layerFBOTexture=null;this._size=[0,0];this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}var d=f.prototype;d.dispose=function(){this._layerFBOTexture=F.disposeMaybe(this._layerFBOTexture)};d.draw=function(c,a,b){const {width:g,height:e}=a;this._createOrResizeResources(c,g,e);const {context:k,painter:p}=c,{materialManager:q}=p,t=this._programDesc;c=this._quad;b=b.colorMatrix;
c.bind();const v=this._layerFBOTexture;k.bindFramebuffer(a);a.copyToTexture(0,0,g,e,0,0,v);k.setBlendingEnabled(!1);k.setStencilTestEnabled(!1);a=q.getProgram(t);k.useProgram(a);k.bindTexture(v,2);a.setUniformMatrix4fv("u_coefficients",b);a.setUniform1i("u_colorTexture",2);c.draw();k.setBlendingEnabled(!0);k.setBlendFunction(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);k.setStencilTestEnabled(!0);c.unbind()};d._createOrResizeResources=function(c,a,b){({context:c}=c);if(!this._layerFBOTexture||
this._size[0]!==a||this._size[1]!==b){this._size[0]=a;this._size[1]=b;if(this._layerFBOTexture)this._layerFBOTexture.resize(a,b);else{const g=new m.TextureDescriptor;g.internalFormat=A.PixelFormat.RGBA;g.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;g.width=a;g.height=b;this._layerFBOTexture=new u.Texture(c,g)}this._quad||(this._quad=new D(c,[-1,-1,1,-1,-1,1,1,1]))}};return l._createClass(f)}();n.Colorize=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f){const d=[1,0],c=[0,1];let a=function(){function b(){this._verticalBlurFBO=this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}var g=b.prototype;g.dispose=function(){this._layerFBOTexture=F.disposeMaybe(this._layerFBOTexture);this._horizontalBlurFBO=F.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=F.disposeMaybe(this._verticalBlurFBO)};g.draw=function(e,k,p){const {context:q,state:t,painter:v}=e,{materialManager:y}=v,w=this._programDesc,z=k.width,r=k.height,C=[Math.round(z),Math.round(r)],{blurRadius:x,offsetX:E,offsetY:B,color:G}=p;p=[D.pt2px(E),D.pt2px(B)];this._createOrResizeResources(e,
z,r,C);const H=this._horizontalBlurFBO;e=this._verticalBlurFBO;q.setStencilWriteMask(0);q.setStencilTestEnabled(!1);q.setDepthWriteEnabled(!1);q.setDepthTestEnabled(!1);const I=this._layerFBOTexture;k.copyToTexture(0,0,z,r,0,0,I);this._quad||(this._quad=new A(q,[-1,-1,1,-1,-1,1,1,1]));q.setViewport(0,0,C[0],C[1]);const J=this._quad;J.bind();q.setBlendingEnabled(!1);const L=y.getProgram(w.blur,[{name:"radius",value:Math.ceil(x)}]);q.useProgram(L);q.bindFramebuffer(H);q.bindTexture(k.colorTexture,4);
L.setUniform1i("u_colorTexture",4);L.setUniform2fv("u_texSize",C);L.setUniform2fv("u_direction",d);L.setUniform1f("u_sigma",x);J.draw();q.bindFramebuffer(e);q.bindTexture(H?.colorTexture,5);L.setUniform1i("u_colorTexture",5);L.setUniform2fv("u_direction",c);J.draw();q.bindFramebuffer(k);q.setViewport(0,0,z,r);k=y.getProgram(w.composite);q.useProgram(k);q.bindTexture(e?.colorTexture,2);k.setUniform1i("u_blurTexture",2);q.bindTexture(I,3);k.setUniform1i("u_layerFBOTexture",3);k.setUniform4fv("u_shadowColor",
[G[0]/255*G[3],G[1]/255*G[3],G[2]/255*G[3],G[3]]);k.setUniformMatrix3fv("u_displayViewMat3",t.displayMat3);k.setUniform2fv("u_shadowOffset",p);J.draw();q.setBlendingEnabled(!0);q.setStencilTestEnabled(!0);q.setBlendFunction(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA);J.unbind()};g._createOrResizeResources=function(e,k,p,q){({context:e}=e);if(!this._horizontalBlurFBO||this._size[0]!==k||this._size[1]!==p){this._size[0]=k;this._size[1]=p;if(this._horizontalBlurFBO)this._horizontalBlurFBO.resize(q[0],
q[1]);else{const t=new f.TextureDescriptor(q[0],q[1]);t.internalFormat=u.PixelFormat.RGBA;t.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;this._horizontalBlurFBO=new m.FramebufferObject(e,t)}this._verticalBlurFBO?this._verticalBlurFBO.resize(q[0],q[1]):(q=new f.TextureDescriptor(q[0],q[1]),q.internalFormat=u.PixelFormat.RGBA,q.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE,this._verticalBlurFBO=new m.FramebufferObject(e,q));this._layerFBOTexture?this._layerFBOTexture.resize(k,p):(q=new f.TextureDescriptor,q.internalFormat=
u.PixelFormat.RGBA,q.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE,q.width=k,q.height=p,this._layerFBOTexture=new h.Texture(e,q))}};return l._createClass(b)}();n.DropShadow=a;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u){let m=function(){function h(){this._size=[0,0];this._layerFBOTexture=null}var f=h.prototype;f.dispose=function(){this._layerFBOTexture=F.disposeMaybe(this._layerFBOTexture)};f.draw=function(d,c,a){const {width:b,height:g}=c;this._createOrResizeResources(d,b,g);const {context:e,painter:k}=d;({amount:d}=a);a=e.gl;const p=this._layerFBOTexture;e.bindFramebuffer(c);c.copyToTexture(0,0,b,g,0,0,p);e.setBlendingEnabled(!0);e.setStencilTestEnabled(!1);e.setDepthTestEnabled(!1);e.setClearColor(0,
0,0,0);e.clear(a.COLOR_BUFFER_BIT);k.blitTexture(e,p,D.TextureSamplingMode.NEAREST,d)};f._createOrResizeResources=function(d,c,a){({context:d}=d);if(!this._layerFBOTexture||this._size[0]!==c||this._size[1]!==a)if(this._size[0]=c,this._size[1]=a,this._layerFBOTexture)this._layerFBOTexture.resize(c,a);else{const b=new u.TextureDescriptor;b.internalFormat=D.PixelFormat.RGBA;b.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE;b.samplingMode=D.TextureSamplingMode.NEAREST;b.width=c;b.height=a;this._layerFBOTexture=
new A.Texture(d,b)}};return l._createClass(h)}();n.Opacity=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/arrayUtils","../enums","../../../../webgl/enums"],function(n,l,F,D){return function(){function A(m,h){this.brushes=m;this.name=h.name;this.drawPhase=h.drawPhase||F.WGLDrawPhase.MAP;this._targetFn=h.target;this.effects=h.effects||[];this.enableDefaultDraw=
h.enableDefaultDraw??(()=>!0);this.forceDrawByDisplayOrder=!!h.forceDrawByDisplayOrder}var u=A.prototype;u.render=function(m){const {context:h,profiler:f}=m,d=this._targetFn();var c=this.drawPhase&m.drawPhase;f.recordPassStart(this.name);if(c){this.enableDefaultDraw()&&this._doRender(m,d);f.recordPassEnd();for(const a of this.effects){if(!a.enable())continue;c=a.apply;const b=a.args&&a.args(),g=h.getViewport(),e=h.getBoundFramebufferObject(),k=m.passOptions;this._bindEffect(m,c,b);this._doRender(m,
d,c.defines);this._drawAndUnbindEffect(m,c,g,e,k,b)}}};u._doRender=function(m,h,f){if(null!=h){var {profiler:d,context:c}=m;if(this.forceDrawByDisplayOrder){for(var a of this.brushes){d.recordBrushStart(a.name);if(null!=a.brushEffect){var b=c.getViewport(),g=c.getBoundFramebufferObject(),e=m.passOptions;this._bindEffect(m,a.brushEffect);this._drawWithBrush(a,m,h,f);this._drawAndUnbindEffect(m,a.brushEffect,b,g,e)}else this._drawWithBrush(a,m,h,f);d.recordBrushEnd()}m.attributeView.bindTextures(m.context);
for(const q of h)if(q.visible)if(q.commit(m),m.context.setStencilFunction(D.CompareFunction.EQUAL,q.stencilRef,255),b=q.getGeometry(F.WGLGeometryType.MARKER),h=q.getGeometry(F.WGLGeometryType.TEXT),null!=b&&b.records&&null!=h&&h.records){a=new Map;for(g=b.records.getCursor();g.next();)a.set(g.id,[g.getDrawInfo(b,F.WGLGeometryType.MARKER)]);for(b=h.records.getCursor();b.next();)g=a.get(b.id),e=b.getDrawInfo(h,F.WGLGeometryType.TEXT),g?g.push(e):a.set(b.id,[e]);h=Array.from(a.entries()).sort(([t],[v])=>
v-t);for(var [,k]of h)for(var p of k)h=m.painter.getBrush(p.geometryType,F.WGLSymbologyType.DEFAULT),h.prepareState(m,f),h.drawGeometry(m,q,p,f)}else if(b){const t=m.painter.getBrush(F.WGLGeometryType.MARKER,F.WGLSymbologyType.DEFAULT);t.prepareState(m,f);b.forEachCommand(v=>{t.drawGeometry(m,q,v,f)})}else if(h){const t=m.painter.getBrush(F.WGLGeometryType.TEXT,F.WGLSymbologyType.DEFAULT);t.prepareState(m,f);h.forEachCommand(v=>{t.drawGeometry(m,q,v,f)})}}else for(b of this.brushes)d.recordBrushStart(b.name),
null!=b.brushEffect?(k=c.getViewport(),p=c.getBoundFramebufferObject(),a=m.passOptions,this._bindEffect(m,b.brushEffect),this._drawWithBrush(b,m,h,f),this._drawAndUnbindEffect(m,b.brushEffect,k,p,a)):this._drawWithBrush(b,m,h,f),d.recordBrushEnd()}};u._drawWithBrush=function(m,h,f,d){l.isArrayLike(f)?(m.prepareState(h,d),m.drawMany(h,f,d)):f.visible&&(m.prepareState(h,d),m.draw(h,f,d))};u._bindEffect=function(m,h,f){const {profiler:d}=m;d.recordPassStart(this.name+"."+h.name);h.bind(m,f);h=h.createOptions(m,
f);m.passOptions=h};u._drawAndUnbindEffect=function(m,h,f,d,c,a){const {profiler:b,context:g}=m;m.passOptions=c;b.recordBrushStart(h.name);h.draw(m,a);h.unbind(m,a);g.bindFramebuffer(d);const {x:e,y:k,width:p,height:q}=f;g.setViewport(e,k,p,q);b.recordBrushEnd();b.recordPassEnd()};return n._createClass(A)}()})},"esri/views/2d/engine/webgl/Profiler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../webgl/capabilities/DisjointTimerQuery".split(" "),
function(n,l,F,D,A,u){const m=A("esri-2d-profiler");A=function(){function h(d,c){this._events=new D;this._entries=new Map;this._timings=new F(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(m){this._ext=u.createDisjointTimerQuery(d.gl,{});this._debugOutput=c;var a=d.gl;if(this.enableCommandLogging)for(var b in a)if("function"===typeof a[b]){const g=a[b],e=b.includes("draw");a[b]=(...k)=>{this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,
brush:this._currentBrush,method:b,args:k,isDrawCommand:e});this._currentSummary&&(this._currentSummary.commands++,e&&this._currentSummary.drawCommands++);return g.apply(a,k)}}}}var f=h.prototype;f.recordContainerStart=function(d){m&&(this._currentContainer=d)};f.recordContainerEnd=function(){m&&(this._currentContainer=null)};f.recordPassStart=function(d){m&&(this._currentPass=d,this._initSummary())};f.recordPassEnd=function(){m&&(this._currentPass=null,this._emitSummary())};f.recordBrushStart=function(d){m&&
(this._currentBrush=d)};f.recordBrushEnd=function(){m&&(this._currentBrush=null)};f.recordStart=function(d){if(m&&null!=this._ext){if(this._entries.has(d)){const e=this._entries.get(d);var c=this._ext.resultAvailable(e.query),a=this._ext.disjoint();if(c&&!a){c=this._ext.getResult(e.query)/1E6;a=0;if(null!=this._timings.enqueue(c)){a=this._timings.entries;const k=a.length;let p=0;for(var b of a)p+=b;a=p/k}b=c.toFixed(2);c=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${d}, ${b} ms (${c} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),
console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${d}, ${b} ms (${c} last 10 avg)`);this._debugOutput.innerHTML=`${b} (${c})`}for(const k of e.handles)k.remove();this._ext.deleteQuery(e.query);this._entries.delete(d)}const g={name:d,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(g.handles.push(this._events.on("command",
e=>{g.commandsLen++;g.commands.push(e);e.isDrawCommand&&g.drawCommands++})),g.handles.push(this._events.on("summary",e=>{g.summaries.push(e)})));this._ext.beginTimeElapsed(g.query);this._entries.set(d,g)}};f.recordEnd=function(d){m&&null!=this._ext&&this._entries.has(d)&&this._ext.endTimeElapsed()};f._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};f._emitSummary=function(){this.enableCommandLogging&&
this._currentSummary&&this._events.emit("summary",this._currentSummary)};l._createClass(h,[{key:"enableCommandLogging",get:function(){return!("object"===typeof m&&m.disableCommands)}}]);return h}();n.Profiler=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(D){this._start=this.size=0;this.maxSize=D;this._buffer=Array(D)}var F=l.prototype;F.enqueue=function(D){if(this.size===
this.maxSize){const A=this._buffer[this._start];this._buffer[this._start]=D;this._start=(this._start+1)%this.maxSize;return A}this._buffer[(this._start+this.size++)%this.maxSize]=D;return null};F.dequeue=function(){if(0===this.size)return null;const D=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return D};F.peek=function(){return 0===this.size?null:this._buffer[this._start]};F.find=function(D){if(0===this.size)return null;for(const A of this._buffer)if(null!=
A&&D(A))return A;return null};F.clear=function(D){let A=this.dequeue();for(;null!=A;)D&&D(A),A=this.dequeue()};n._createClass(l,[{key:"entries",get:function(){return this._buffer}}]);return l}()})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./isWebGL2Context"],function(n,l,F){let D=l._createClass(function(A,u,m,h,f,d,c,a,b){this.createQuery=A;this.deleteQuery=u;this.resultAvailable=m;this.getResult=h;this.disjoint=f;
this.beginTimeElapsed=d;this.endTimeElapsed=c;this.createTimestamp=a;this.timestampBits=b});n.hasRunningElapsedTimer=!1;n.DisjointTimerQuery=D;n.createDisjointTimerQuery=function(A,u){if(u.disjointTimerQuery)return null;let m=A.getExtension("EXT_disjoint_timer_query_webgl2");return m&&F(A)?new D(()=>A.createQuery(),h=>{A.deleteQuery(h);n.hasRunningElapsedTimer=!1},h=>A.getQueryParameter(h,A.QUERY_RESULT_AVAILABLE),h=>A.getQueryParameter(h,A.QUERY_RESULT),()=>A.getParameter(m.GPU_DISJOINT_EXT),h=>
{n.hasRunningElapsedTimer||(n.hasRunningElapsedTimer=!0,A.beginQuery(m.TIME_ELAPSED_EXT,h))},()=>{A.endQuery(m.TIME_ELAPSED_EXT);n.hasRunningElapsedTimer=!1},h=>m.queryCounterEXT(h,m.TIMESTAMP_EXT),()=>A.getQuery(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):(m=A.getExtension("EXT_disjoint_timer_query"))?new D(()=>m.createQueryEXT(),h=>{m.deleteQueryEXT(h);n.hasRunningElapsedTimer=!1},h=>m.getQueryObjectEXT(h,m.QUERY_RESULT_AVAILABLE_EXT),h=>m.getQueryObjectEXT(h,m.QUERY_RESULT_EXT),()=>A.getParameter(m.GPU_DISJOINT_EXT),
h=>{n.hasRunningElapsedTimer||(n.hasRunningElapsedTimer=!0,m.beginQueryEXT(m.TIME_ELAPSED_EXT,h))},()=>{m.endQueryEXT(m.TIME_ELAPSED_EXT);n.hasRunningElapsedTimer=!1},h=>m.queryCounterEXT(h,m.TIMESTAMP_EXT),()=>m.getQueryEXT(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./contextUtils ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q){function t(w,z,r,C){z?C!==z&&w.bindBuffer(r,z.glName):w.bindBuffer(r,null);return z}function v(w,z){switch(w){case f.PrimitiveType.POINTS:return 2*z;case f.PrimitiveType.TRIANGLES:return z/3;case f.PrimitiveType.TRIANGLE_STRIP:return z-2;case f.PrimitiveType.TRIANGLE_FAN:return z-2;default:return 0}}let y=function(){function w(r,C){this.gl=r;this.instanceCounter=new d.InstanceCounter;this.programCache=new a.ProgramCache(this);this._state=new m.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=q(r)?h.ContextType.WEBGL2:h.ContextType.WEBGL1;this._loadExtensions();this.configure(C)}var z=w.prototype;z.configure=function(r){this._capabilities=new p.Capabilities(this.gl,r);this._parameters=new c.Parameters(this.gl,this._capabilities,r);g.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new m.ContextState;this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]};
this._stateTracker=new b.StateTracker({setBlending:C=>{C?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(C.opRgb,C.opAlpha),this.setBlendFunctionSeparate(C.srcRgb,C.dstRgb,C.srcAlpha,C.dstAlpha),C=C.color,this.setBlendColor(C.r,C.g,C.b,C.a)):this.setBlendingEnabled(!1)},setCulling:C=>{C?(this.setFaceCullingEnabled(!0),this.setCullFace(C.face),this.setFrontFace(C.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:C=>{C?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(C.factor,
C.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:C=>{C?(this.setDepthTestEnabled(!0),this.setDepthFunction(C.func)):this.setDepthTestEnabled(!1)},setStencilTest:C=>{if(C){this.setStencilTestEnabled(!0);const x=C.function;this.setStencilFunction(x.func,x.ref,x.mask);C=C.operation;this.setStencilOp(C.fail,C.zFail,C.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:C=>{C?(this.setDepthWriteEnabled(!0),this.setDepthRange(C.zNear,C.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:C=>
{C?this.setColorMask(C.r,C.g,C.b,C.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:C=>{C?this.setStencilWriteMask(C.mask):this.setStencilWriteMask(0)}});this.enforceState();F.disposeMaybe(this._driverTest);this._driverTest=new k.WebGLDriverTest(this)};z.dispose=function(){F.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(f.BufferType.ARRAY_BUFFER);this.unbindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER);this.type===h.ContextType.WEBGL2&&(this.unbindBuffer(f.BufferType.UNIFORM_BUFFER),
this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(f.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(f.BufferType.COPY_READ_BUFFER),this.unbindBuffer(f.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;u.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)};z.setPipelineState=function(r){this._stateTracker.setPipeline(r)};z.setBlendingEnabled=function(r){this._state.blend!==r&&(!0===r?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._state.blend=r,this._stateTracker.invalidateBlending())};z.externalProgramUpdate=function(){this._state.program?.stop();this._state.program=null};z.externalTextureUnitUpdate=function(r,C){for(let x=0;x<r.length;++x)this._state.textureUnitMap[r[x]]=null;0<=C&&(this._state.activeTexture=C)};z.externalVertexArrayObjectUpdate=function(){const r=this.capabilities.vao;r&&(r.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=
null};z.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};z.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};z.setBlendColor=function(r,C,x,E){if(r!==this._state.blendColor.r||C!==this._state.blendColor.g||x!==this._state.blendColor.b||E!==this._state.blendColor.a)this.gl.blendColor(r,C,x,E),this._state.blendColor.r=r,this._state.blendColor.g=C,this._state.blendColor.b=x,this._state.blendColor.a=E,this._stateTracker.invalidateBlending()};z.setBlendFunction=function(r,
C){if(r!==this._state.blendFunction.srcRGB||C!==this._state.blendFunction.dstRGB)this.gl.blendFunc(r,C),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=C,this._state.blendFunction.dstAlpha=C,this._stateTracker.invalidateBlending()};z.setBlendFunctionSeparate=function(r,C,x,E){if(this._state.blendFunction.srcRGB!==r||this._state.blendFunction.srcAlpha!==x||this._state.blendFunction.dstRGB!==C||this._state.blendFunction.dstAlpha!==E)this.gl.blendFuncSeparate(r,
C,x,E),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=x,this._state.blendFunction.dstRGB=C,this._state.blendFunction.dstAlpha=E,this._stateTracker.invalidateBlending()};z.setBlendEquation=function(r){this._state.blendEquation.mode!==r&&(this.gl.blendEquation(r),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())};z.setBlendEquationSeparate=function(r,C){if(this._state.blendEquation.mode!==r||this._state.blendEquation.modeAlpha!==
C)this.gl.blendEquationSeparate(r,C),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=C,this._stateTracker.invalidateBlending()};z.setColorMask=function(r,C,x,E){if(this._state.colorMask.r!==r||this._state.colorMask.g!==C||this._state.colorMask.b!==x||this._state.colorMask.a!==E)this.gl.colorMask(r,C,x,E),this._state.colorMask.r=r,this._state.colorMask.g=C,this._state.colorMask.b=x,this._state.colorMask.a=E,this._stateTracker.invalidateColorWrite()};z.setClearColor=function(r,
C,x,E){if(this._state.clearColor.r!==r||this._state.clearColor.g!==C||this._state.clearColor.b!==x||this._state.clearColor.a!==E)this.gl.clearColor(r,C,x,E),this._state.clearColor.r=r,this._state.clearColor.g=C,this._state.clearColor.b=x,this._state.clearColor.a=E};z.setFaceCullingEnabled=function(r){this._state.faceCulling!==r&&(!0===r?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=r,this._stateTracker.invalidateCulling())};z.setPolygonOffsetFillEnabled=
function(r){this._state.polygonOffsetFill!==r&&(!0===r?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=r,this._stateTracker.invalidatePolygonOffset())};z.setPolygonOffset=function(r,C){if(this._state.polygonOffset[0]!==r||this._state.polygonOffset[1]!==C)this._state.polygonOffset[0]=r,this._state.polygonOffset[1]=C,this.gl.polygonOffset(r,C),this._stateTracker.invalidatePolygonOffset()};z.setCullFace=function(r){this._state.cullFace!==
r&&(this.gl.cullFace(r),this._state.cullFace=r,this._stateTracker.invalidateCulling())};z.setFrontFace=function(r){this._state.frontFace!==r&&(this.gl.frontFace(r),this._state.frontFace=r,this._stateTracker.invalidateCulling())};z.setScissorTestEnabled=function(r){this._state.scissorTest!==r&&(!0===r?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=r)};z.setScissorRect=function(r,C,x,E){if(this._state.scissorRect.x!==r||this._state.scissorRect.y!==
C||this._state.scissorRect.width!==x||this._state.scissorRect.height!==E)this.gl.scissor(r,C,x,E),this._state.scissorRect.x=r,this._state.scissorRect.y=C,this._state.scissorRect.width=x,this._state.scissorRect.height=E};z.setDepthTestEnabled=function(r){this._state.depthTest!==r&&(!0===r?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=r,this._stateTracker.invalidateDepthTest())};z.setClearDepth=function(r){this._state.clearDepth!==r&&(this.gl.clearDepth(r),
this._state.clearDepth=r)};z.setDepthFunction=function(r){this._state.depthFunction!==r&&(this.gl.depthFunc(r),this._state.depthFunction=r,this._stateTracker.invalidateDepthTest())};z.setDepthWriteEnabled=function(r){this._state.depthWrite!==r&&(this.gl.depthMask(r),this._state.depthWrite=r,this._stateTracker.invalidateDepthWrite())};z.setDepthRange=function(r,C){if(this._state.depthRange.zNear!==r||this._state.depthRange.zFar!==C)this.gl.depthRange(r,C),this._state.depthRange.zNear=r,this._state.depthRange.zFar=
C,this._stateTracker.invalidateDepthWrite()};z.setStencilTestEnabled=function(r){this._state.stencilTest!==r&&(!0===r?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=r,this._stateTracker.invalidateStencilTest())};z.setClearStencil=function(r){r!==this._state.clearStencil&&(this.gl.clearStencil(r),this._state.clearStencil=r)};z.setStencilFunction=function(r,C,x){if(this._state.stencilFunction.func!==r||this._state.stencilFunction.ref!==C||this._state.stencilFunction.mask!==
x)this.gl.stencilFunc(r,C,x),this._state.stencilFunction.face=f.Face.FRONT_AND_BACK,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=C,this._state.stencilFunction.mask=x,this._stateTracker.invalidateStencilTest()};z.setStencilFunctionSeparate=function(r,C,x,E){if(this._state.stencilFunction.face!==r||this._state.stencilFunction.func!==C||this._state.stencilFunction.ref!==x||this._state.stencilFunction.mask!==E)this.gl.stencilFuncSeparate(r,C,x,E),this._state.stencilFunction.face=
r,this._state.stencilFunction.func=C,this._state.stencilFunction.ref=x,this._state.stencilFunction.mask=E,this._stateTracker.invalidateStencilTest()};z.setStencilWriteMask=function(r){this._state.stencilWriteMask!==r&&(this.gl.stencilMask(r),this._state.stencilWriteMask=r,this._stateTracker.invalidateStencilWrite())};z.setStencilOp=function(r,C,x){if(this._state.stencilOperation.face!==f.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==r||this._state.stencilOperation.zFail!==C||this._state.stencilOperation.zPass!==
x)this.gl.stencilOp(r,C,x),this._state.stencilOperation.face=f.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=C,this._state.stencilOperation.zPass=x,this._stateTracker.invalidateStencilTest()};z.setStencilOpSeparate=function(r,C,x,E){if(this._state.stencilOperation.face!==r||this._state.stencilOperation.fail!==C||this._state.stencilOperation.zFail!==x||this._state.stencilOperation.zPass!==E)this.gl.stencilOpSeparate(r,C,x,E),this._state.stencilOperation.face=
r,this._state.stencilOperation.fail=C,this._state.stencilOperation.zFail=x,this._state.stencilOperation.zPass=E,this._stateTracker.invalidateStencilTest()};z.setActiveTexture=function(r,C=!1){const x=this._state.activeTexture;0<=r&&(C||r!==this._state.activeTexture)&&(this.gl.activeTexture(f.BASE_TEXTURE_UNIT+r),this._state.activeTexture=r);return x};z.clear=function(r){r&&this.gl.clear(r)};z.clearSafe=function(r,C=255){r&&(r&f.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),r&f.ClearBufferBit.DEPTH_BUFFER_BIT&&
this.setDepthWriteEnabled(!0),r&f.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(C),this.gl.clear(r))};z.drawArrays=function(r,C,x){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(r,x));this.gl.drawArrays(r,C,x);u.webglDebugEnabled()&&(r=e.getErrorString(this))&&console.error("drawArrays:",r)};z.drawElements=function(r,C,x,E){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(r,C));this.gl.drawElements(r,C,x,E);if(u.webglDebugEnabled()){const B=
e.getErrorString(this);if(B){const G=this.getBoundVAO(),H=G?.indexBuffer,I=H?.size??0,J=E+C;console.error(`drawElements: ${B}${I<J?`. Buffer is too small. Attempted to draw index ${J} of ${I}`:""}`,{args:{mode:r,count:C,type:x,offset:E},vao:{indexBuffer:H,vertexBuffers:G?.vertexBuffers}})}}};z.logInfo=function(){u.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};z.resetInfo=function(){u.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=
0)};z.setViewport=function(r,C,x,E){x=Math.max(Math.round(x),1);E=Math.max(Math.round(E),1);const B=this._state.viewport;if(B.x!==r||B.y!==C||B.width!==x||B.height!==E)B.x=r,B.y=C,B.width=x,B.height=E,this.gl.viewport(r,C,x,E)};z.getViewport=function(){const r=this._state.viewport;return{x:r.x,y:r.y,width:r.width,height:r.height}};z.useProgram=function(r){this._state.program!==r&&(this._state.program?.stop(),this._state.program=r,this.gl.useProgram(r?.glName??null))};z.bindTexture=function(r,C,x=
!1){(C>=this.parameters.maxTextureImageUnits||0>C)&&console.error("Input texture unit is out of range of available units!");const E=this._state.textureUnitMap[C];if(null==r||null==r.glName)return null!=E&&(this.setActiveTexture(C,x),this.gl.bindTexture(E.descriptor.target,null)),this._state.textureUnitMap[C]=null,E;if(!x&&E===r)return r.isDirty&&(this.setActiveTexture(C,x),r.applyChanges()),E;this.setActiveTexture(C,x);this.gl.bindTexture(r.descriptor.target,r.glName);r.applyChanges();this._state.textureUnitMap[C]=
r;return E};z.unbindTexture=function(r){if(null!=r)for(let C=0;C<this.parameters.maxTextureImageUnits;C++)this._state.textureUnitMap[C]===r&&(this.bindTexture(null,C),this._state.textureUnitMap[C]=null)};z.bindFramebuffer=function(r,C=!1){if(C||this._state.readFramebuffer!==r||this._state.drawFramebuffer!==r)null==r?(this.gl.bindFramebuffer(f.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(r.initializeAndBind(f.FramebufferTarget.FRAMEBUFFER),
this._state.readFramebuffer=r,this._state.drawFramebuffer=r)};z.bindFramebufferSeparate=function(r,C,x=!1){const E=C===f.FramebufferTarget.READ_FRAMEBUFFER,B=E?this._state.readFramebuffer:this._state.drawFramebuffer;if(x||B!==r)null==r?this.gl.bindFramebuffer(C,null):r.initializeAndBind(C),E?this._state.readFramebuffer=r??null:this._state.drawFramebuffer=r??null};z.blitFramebuffer=function(r,C,x=0,E=0,B=r.width,G=r.height,H=0,I=0,J=C.width,L=C.height,K=f.ClearBufferBit.COLOR_BUFFER_BIT,S=f.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(r,
f.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(C,f.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(x,E,B,G,H,I,J,L,K,S)};z.bindBuffer=function(r,C){if(r)switch(C??(C=r.bufferType),C){case f.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,r,C,this._state.vertexBuffer);break;case f.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,r,C,this._state.indexBuffer);break;case f.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,r,C,this._state.uniformBuffer);
break;case f.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=t(this.gl,r,C,this._state.pixelPackBuffer);break;case f.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,r,C,this._state.pixelUnpackBuffer);break;case f.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=t(this.gl,r,C,this._state.copyReadBuffer);break;case f.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,r,C,this._state.copyWriteBuffer)}};z.bindRenderbuffer=function(r){const C=this.gl;
r||(C.bindRenderbuffer(C.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==r&&(C.bindRenderbuffer(C.RENDERBUFFER,r.glName),this._state.renderbuffer=r)};z._getBufferBinding=function(r,C){if(C>=this.parameters.maxUniformBufferBindings||0>C)return console.error("Uniform buffer binding point is out of range!"),null;r=this._state.uniformBufferBindingPoints;let x=r[C];null==x&&(x={buffer:null,offset:0,size:0},r[C]=x);return x};z.bindBufferBase=function(r,C,x){const E=this._getBufferBinding(r,
C);null==E||E.buffer===x&&0===E.offset&&0===E.size||(this.gl.bindBufferBase(r,C,x?x.glName:null),E.buffer=x,E.offset=0,E.size=0)};z.bindBufferRange=function(r,C,x,E,B){const G=this._getBufferBinding(r,C);null==G||G.buffer===x&&G.offset===E&&G.size===B||(0!==E%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(r,C,x.glName,E,B),G.buffer=x,G.offset=E,G.size=B))};z.bindUBO=function(r,
C,x,E){null==C?this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,r,null):(u.webglDebugEnabled()&&(E??C.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),C.initialize(),void 0!==x&&void 0!==E?this.bindBufferRange(f.BufferType.UNIFORM_BUFFER,r,C.buffer,x,E):this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,r,C.buffer))};z.unbindUBO=function(r){for(let C=0,x=this._state.uniformBufferBindingPoints.length;C<x;C++){const E=this._state.uniformBufferBindingPoints[C];
null!=E&&E.buffer===r.buffer&&this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,C,null)}};z.unbindBuffer=function(r){switch(r){case f.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,null,r,this._state.vertexBuffer);break;case f.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,null,r,this._state.indexBuffer);break;case f.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,null,r,this._state.uniformBuffer);break;case f.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=
t(this.gl,null,r,this._state.pixelPackBuffer);break;case f.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,null,r,this._state.pixelUnpackBuffer);break;case f.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=t(this.gl,null,r,this._state.copyReadBuffer);break;case f.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,null,r,this._state.copyWriteBuffer)}};z.bindVAO=function(r=null){null==r?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null):this._state.vertexArrayObject!==r&&(r.bind(),this._state.vertexArrayObject=r)};z.clientWaitAsync=async function(r=A.Milliseconds(10)){const C=this.gl,x=C.fenceSync(f.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!x)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(f.ResourceType.Sync,x);C.flush();let E;do await D.after(r),E=C.clientWaitSync(x,0,0);while(E===f.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(f.ResourceType.Sync,
x);C.deleteSync(x);if(E===f.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");};z.getBoundFramebufferObject=function(r=f.FramebufferTarget.FRAMEBUFFER){return r===f.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};z.getBoundVAO=function(){return this._state.vertexArrayObject};z.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(f.BufferType.ARRAY_BUFFER);this.unbindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER);
this.type===h.ContextType.WEBGL2&&(this.unbindBuffer(f.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(f.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(f.BufferType.COPY_READ_BUFFER),this.unbindBuffer(f.BufferType.COPY_WRITE_BUFFER));for(let r=0;r<this.parameters.maxTextureImageUnits;++r)this.bindTexture(null,r);this.setBlendingEnabled(!1);this.setBlendFunction(f.BlendFactor.ONE,f.BlendFactor.ZERO);this.setBlendEquation(f.BlendOperation.ADD);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(f.Face.BACK);this.setFrontFace(f.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(f.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(f.CompareFunction.ALWAYS,0,0);this.setStencilOp(f.StencilOperation.KEEP,
f.StencilOperation.KEEP,f.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};z.enforceState=function(){var r=this.capabilities.vao;r&&r.bindVertexArray(null);const {gl:C,gl2:x}=this;for(var E=0;E<this.parameters.maxVertexAttributes;E++)C.disableVertexAttribArray(E);this._state.vertexBuffer?
C.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):C.bindBuffer(f.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?C.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):C.bindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER,null);if(null!=x){this._state.uniformBuffer?x.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):x.bindBuffer(f.BufferType.UNIFORM_BUFFER,null);for(E=0;E<this._parameters.maxUniformBufferBindings;E++){const B=
this._state.uniformBufferBindingPoints[E];if(null!=B){const {buffer:G,offset:H,size:I}=B;null!==G?0===H&&0===I?x.bindBufferBase(f.BufferType.UNIFORM_BUFFER,E,G.glName):x.bindBufferRange(f.BufferType.UNIFORM_BUFFER,E,G.glName,H,I):x.bindBufferBase(f.BufferType.UNIFORM_BUFFER,E,null)}}this._state.pixelPackBuffer?x.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):x.bindBuffer(f.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?x.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):x.bindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?x.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):x.bindBuffer(f.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?x.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):x.bindBuffer(f.BufferType.COPY_WRITE_BUFFER,null);x.bindFramebuffer(f.FramebufferTarget.READ_FRAMEBUFFER,null);x.readBuffer(x.BACK);this._state.readFramebuffer&&
(x.bindFramebuffer(f.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),x.readBuffer(f.ColorAttachment.COLOR_ATTACHMENT0));x.bindFramebuffer(f.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,C.bindFramebuffer(f.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(r&&this._state.vertexArrayObject){if(r=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(r)}C.useProgram(this._state.program?.glName??null);C.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);C.bindRenderbuffer(C.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?C.enable(this.gl.BLEND):C.disable(this.gl.BLEND);C.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);C.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);C.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);C.clearDepth(this._state.clearDepth);C.clearStencil(this._state.clearStencil);C.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);C.cullFace(this._state.cullFace);C.depthFunc(this._state.depthFunction);C.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?C.enable(C.DEPTH_TEST):C.disable(C.DEPTH_TEST);C.depthMask(this._state.depthWrite);C.frontFace(this._state.frontFace);C.lineWidth(1);!0===this._state.faceCulling?C.enable(C.CULL_FACE):C.disable(C.CULL_FACE);C.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?C.enable(C.POLYGON_OFFSET_FILL):C.disable(C.POLYGON_OFFSET_FILL);C.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?C.enable(C.SCISSOR_TEST):C.disable(C.SCISSOR_TEST);C.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);C.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?C.enable(C.STENCIL_TEST):C.disable(C.STENCIL_TEST);C.stencilMask(this._state.stencilWriteMask);
for(r=0;r<this.parameters.maxTextureImageUnits;r++)C.activeTexture(f.BASE_TEXTURE_UNIT+r),C.bindTexture(f.TextureType.TEXTURE_2D,null),C.bindTexture(f.TextureType.TEXTURE_CUBE_MAP,null),this.type===h.ContextType.WEBGL2&&(C.bindTexture(f.TextureType.TEXTURE_3D,null),C.bindTexture(f.TextureType.TEXTURE_2D_ARRAY,null)),E=this._state.textureUnitMap[r],null!=E&&C.bindTexture(E.descriptor.target,E.glName);C.activeTexture(f.BASE_TEXTURE_UNIT+this._state.activeTexture);r=this._state.viewport;C.viewport(r.x,
r.y,r.width,r.height);this.resetInfo()};z._loadExtensions=function(){this.type===h.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};l._createClass(w,[{key:"gl2",get:function(){return this.type===h.ContextType.WEBGL1?null:this.gl}},{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",
get:function(){return this._capabilities}}]);return w}();n.RenderingContext=y;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums"],function(n,l,F){l=l._createClass(function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:F.BlendFactor.ONE,dstRGB:F.BlendFactor.ZERO,srcAlpha:F.BlendFactor.ONE,dstAlpha:F.BlendFactor.ZERO};this.blendEquation={mode:F.BlendOperation.ADD,
modeAlpha:F.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=F.Face.BACK;this.frontFace=F.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=F.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:F.Face.FRONT_AND_BACK,func:F.CompareFunction.ALWAYS,
ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:F.Face.FRONT_AND_BACK,fail:F.StencilOperation.KEEP,zFail:F.StencilOperation.KEEP,zPass:F.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=
0;this.textureUnitMap=[];this.vertexArrayObject=null});n.ContextState=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(n,l,F,D){const A={RECORD_ALLOCATIONS:!1};let u=function(){function m(){this._current=[];this._max=[];for(this._allocations=new F.AllocationTracer(A.RECORD_ALLOCATIONS);this._current.length<D.ResourceType.COUNT;)this._current.push(0),
this._max.push(0)}var h=m.prototype;h.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};h.increment=function(f,d){const c=++this._current[f];this._max[f]=Math.max(c,this._max[f]);this._allocations.add(d)};h.decrement=function(f,d){--this._current[f];this._allocations.remove(d)};l._createClass(m,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((f,
d)=>f+d,0)}},{key:"resourceInformation",get:function(){let f="";if(0<this.total){f+="Live objects:\n";for(let d=0;d<D.ResourceType.COUNT;++d){const c=this._current[d];0<c&&(f+=`${D.ResourceType[d]}: ${c}\n`)}}return f+=this._allocations.information}}]);return m}();n.InstanceCounter=u;n.test=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(u){this._allocations=
new Map;u?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var A=D.prototype;A.add=function(u){this._allocations.set(u,Error().stack)};A.remove=function(u){this._allocations.delete(u)};l._createClass(D,[{key:"information",get:function(){let u="";if(0<this._allocations.size){u+=`${this._allocations.size} live object allocations:\n`;const m=new Map;this._allocations.forEach(h=>{m.set(h,(m.get(h)??0)+1)});m.forEach((h,f)=>{f=f.split("\n");f.shift();f.shift();u+=`${h}: ${f.shift()}\n`;
f.forEach(d=>u+=`   ${d}\n`)})}return u}}]);return D}();n.AllocationTracer=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./capabilities/isWebGL2Context"],function(n,l,F){l=l._createClass(function(D,A,u){A=A.textureFilterAnisotropic;u=u.maxAnisotropy??Infinity;this.versionString=D.getParameter(D.VERSION);this.maxVertexTextureImageUnits=D.getParameter(D.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=D.getParameter(D.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=A?Math.min(D.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY),u):1;this.maxTextureImageUnits=D.getParameter(D.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=D.getParameter(D.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=D.getParameter(D.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=D.getParameter(D.MAX_VIEWPORT_DIMS);F(D)?(this.maxUniformBufferBindings=D.getParameter(D.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=D.getParameter(D.MAX_VERTEX_UNIFORM_BLOCKS),
this.maxFragmentUniformBlocks=D.getParameter(D.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=D.getParameter(D.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=D.getParameter(D.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=D.getParameter(D.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=D.getParameter(D.MAX_SAMPLES)):(this.maxUniformBlockSize=this.maxFragmentUniformBlocks=this.maxVertexUniformBlocks=this.maxUniformBufferBindings=0,this.maxSamples=this.maxArrayTextureLayers=
this.uniformBufferOffsetAlignment=1)});n.Parameters=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(n,l,F,D){function A(K){return C.intern(K)}function u(K){return x.intern(K)}function m(K){return E.intern(K)}function h(K){return B.intern(K)}function f(K){return G.intern(K)}function d(K){return H.intern(K)}function c(K){return I.intern(K)}
function a(K){return J.intern(K)}function b(K){return"["+K.join(",")+"]"}function g(K){return K?b([K.srcRgb,K.srcAlpha,K.dstRgb,K.dstAlpha,K.opRgb,K.opAlpha,K.color.r,K.color.g,K.color.b,K.color.a]):null}function e(K){return K?b([K.face,K.mode]):null}function k(K){return K?b([K.factor,K.units]):null}function p(K){return K?b([K.func]):null}function q(K){return K?b([K.function.func,K.function.ref,K.function.mask,K.operation.fail,K.operation.zFail,K.operation.zPass]):null}function t(K){return K?b([K.zNear,
K.zFar]):null}function v(K){return K?b([K.r,K.g,K.b,K.a]):null}function y(K){return K?b([K.mask]):null}const w={face:D.Face.BACK,mode:D.CullMode.CCW},z={face:D.Face.FRONT,mode:D.CullMode.CCW};var r=function(){function K(S,W){this._makeKey=S;this._makeRef=W;this._interns=new Map}K.prototype.intern=function(S){if(!S)return null;const W=this._makeKey(S),X=this._interns;X.has(W)||X.set(W,this._makeRef(S));return X.get(W)??null};return l._createClass(K)}();const C=new r(g,K=>({__tag:"Blending",...K})),
x=new r(e,K=>({__tag:"Culling",...K})),E=new r(k,K=>({__tag:"PolygonOffset",...K})),B=new r(p,K=>({__tag:"DepthTest",...K})),G=new r(q,K=>({__tag:"StencilTest",...K})),H=new r(t,K=>({__tag:"DepthWrite",...K})),I=new r(v,K=>({__tag:"ColorWrite",...K})),J=new r(y,K=>({__tag:"StencilWrite",...K})),L=new r(function(K){return K?b([g(K.blending),e(K.culling),k(K.polygonOffset),p(K.depthTest),q(K.stencilTest),t(K.depthWrite),v(K.colorWrite),y(K.stencilWrite)]):null},K=>({blending:A(K.blending),culling:u(K.culling),
polygonOffset:m(K.polygonOffset),depthTest:h(K.depthTest),stencilTest:f(K.stencilTest),depthWrite:d(K.depthWrite),colorWrite:c(K.colorWrite),stencilWrite:a(K.stencilWrite)}));r=function(){function K(W){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=W}var S=K.prototype;S.setPipeline=function(W){if(this._pipelineInvalid||
W!==this._pipeline)this._setBlending(W.blending),this._setCulling(W.culling),this._setPolygonOffset(W.polygonOffset),this._setDepthTest(W.depthTest),this._setStencilTest(W.stencilTest),this._setDepthWrite(W.depthWrite),this._setColorWrite(W.colorWrite),this._setStencilWrite(W.stencilWrite),this._pipeline=W;this._pipelineInvalid=!1};S.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};S.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};S.invalidatePolygonOffset=
function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};S.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};S.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};S.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};S.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};S.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};S._setBlending=
function(W){this._blending=this._setSubState(W,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};S._setCulling=function(W){this._culling=this._setSubState(W,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};S._setPolygonOffset=function(W){this._polygonOffset=this._setSubState(W,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};S._setDepthTest=function(W){this._depthTest=
this._setSubState(W,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};S._setStencilTest=function(W){this._stencilTest=this._setSubState(W,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};S._setDepthWrite=function(W){this._depthWrite=this._setSubState(W,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};S._setColorWrite=function(W){this._colorWrite=
this._setSubState(W,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};S._setStencilWrite=function(W){this._stencilWrite=this._setSubState(W,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};S._setSubState=function(W,X,Z,V){if(Z||W!==X)V(W),this._pipelineInvalid=!0;return W};return l._createClass(K)}();n.StateTracker=r;n.backFaceCullingParams=w;n.cullingParams=K=>K===F.CullFaceOptions.Back?
w:K===F.CullFaceOptions.Front?z:null;n.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};n.defaultDepthWriteParams={zNear:0,zFar:1};n.frontFaceCullingParams=z;n.makeBlending=A;n.makeColorWrite=c;n.makeCulling=u;n.makeDepthTest=h;n.makeDepthWrite=d;n.makePipelineState=function(K){return L.intern(K)};n.makePolygonOffset=m;n.makeStencilTest=f;n.makeStencilWrite=a;n.separateBlendingParams=function(K,S,W,X,Z=D.BlendOperation.ADD,V=D.BlendOperation.ADD,O=[0,0,0,0]){return{srcRgb:K,srcAlpha:S,dstRgb:W,dstAlpha:X,
opRgb:Z,opAlpha:V,color:{r:O[0],g:O[1],b:O[2],a:O[3]}}};n.simpleBlendingParams=function(K,S,W=D.BlendOperation.ADD,X=[0,0,0,0]){return{srcRgb:K,srcAlpha:K,dstRgb:S,dstAlpha:S,opRgb:W,opAlpha:W,color:{r:X[0],g:X[1],b:X[2],a:X[3]}}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(n){n.CullFaceOptions=void 0;(function(l){l[l.None=0]="None";l[l.Front=1]="Front";l[l.Back=2]="Back";l[l.COUNT=3]="COUNT"})(n.CullFaceOptions||
(n.CullFaceOptions={}));n.DepthTestFunction=void 0;(function(l){l[l.Less=0]="Less";l[l.Lequal=1]="Lequal";l[l.COUNT=2]="COUNT"})(n.DepthTestFunction||(n.DepthTestFunction={}));n.RenderRequestType=void 0;(function(l){l[l.BACKGROUND=0]="BACKGROUND";l[l.UPDATE=1]="UPDATE"})(n.RenderRequestType||(n.RenderRequestType={}));n.ResourceState=void 0;(function(l){l[l.NOT_LOADED=0]="NOT_LOADED";l[l.LOADING=1]="LOADING";l[l.LOADED=2]="LOADED"})(n.ResourceState||(n.ResourceState={}));n.StencilBits=void 0;(function(l){l[l.IntegratedMeshMaskExcluded=
1]="IntegratedMeshMaskExcluded";l[l.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(n.StencilBits||(n.StencilBits={}));n.Object3DState=void 0;(function(l){l[l.Highlight=0]="Highlight";l[l.MaskOccludee=1]="MaskOccludee";l[l.COUNT=2]="COUNT"})(n.Object3DState||(n.Object3DState={}));n.ValidationState=void 0;(function(l){l[l.CHANGED=0]="CHANGED";l[l.UNCHANGED=1]="UNCHANGED"})(n.ValidationState||(n.ValidationState={}));n.AlphaDiscardMode=void 0;(function(l){l[l.Blend=0]="Blend";l[l.Opaque=1]=
"Opaque";l[l.Mask=2]="Mask";l[l.MaskBlend=3]="MaskBlend";l[l.COUNT=4]="COUNT"})(n.AlphaDiscardMode||(n.AlphaDiscardMode={}));n.Decorations=void 0;(function(l){l[l.OFF=0]="OFF";l[l.ON=1]="ON"})(n.Decorations||(n.Decorations={}));n.TextureEncodingMimeType=void 0;(function(l){l.DDS_ENCODING="image/vnd-ms.dds";l.KTX2_ENCODING="image/ktx2";l.BASIS_ENCODING="image/x.basis"})(n.TextureEncodingMimeType||(n.TextureEncodingMimeType={}));Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),
function(n,l,F,D,A,u,m){let h=function(){function f(d){this.rctx=d;this.floatBufferBlend=new A.FloatBufferBlend(d);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(d);this.doublePrecisionRequiresObfuscation=new D.DoublePrecisionRequiresObfuscation(d);this.ignoresSamplerPrecision=new u.IgnoresSamplerPrecision(d);this.drawArraysRequiresIndicesTypeReset=new F.DrawArraysRequiresIndicesTypeReset(d)}f.prototype.dispose=function(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();
this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()};return l._createClass(f)}();n.WebGLDriverTest=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./contextUtils ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){c=function(a){function b(e){var k=a.call(this)||this;k._rctx=e;k._helperProgram=null;k._rctx.type===m.ContextType.WEBGL2&&F("mac")&&F("chrome")&&(k._program=k._prepareProgram(),k._helperProgram=k._prepareHelperProgram());return k}l._inherits(b,a);var g=b.prototype;g.dispose=function(){l._get(l._getPrototypeOf(b.prototype),"dispose",this).call(this);this._helperProgram?.dispose();this._helperProgram=null};g._test=function(e){const k=this._rctx;k.resetState();var p=new d.TextureDescriptor(1);
p.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;p.samplingMode=h.TextureSamplingMode.NEAREST;p=new f.FramebufferObject(k,p);const q=u.BufferObject.createIndex(this._rctx,h.Usage.STATIC_DRAW,new Uint8Array([0]));k.bindFramebuffer(p);k.setViewport(0,0,1,1);k.useProgram(this._helperProgram);k.bindBuffer(q,h.BufferType.ELEMENT_ARRAY_BUFFER);k.drawElements(h.PrimitiveType.POINTS,1,h.DataType.UNSIGNED_BYTE,0);k.useProgram(e);k.bindVAO(null);k.drawArrays(h.PrimitiveType.TRIANGLES,0,258);e=new Uint8Array(4);p.readPixels(0,
0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,e);p.dispose();q.dispose();return 255===e[0]};g._prepareProgram=function(){const e=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${D.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
k=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${D.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(e,k,new Map([]))};g._prepareHelperProgram=function(){const e=A.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))};return l._createClass(b)}(c.WebGLDriverTestModule);
n.DrawArraysRequiresIndicesTypeReset=c;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){function F(D,...A){let u="";for(let m=0;m<A.length;m++)u+=D[m]+A[m];return u+=D[D.length-1]}l=l._createClass(function(){});(function(D){D.int=function(A){return Math.round(A).toString()};D.float=function(A){return A.toPrecision(8)}})(F||(F={}));
n.NoParameters=l;n.glsl=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./BufferObject","./enums"],function(n,l,F,D){let A=function(){function u(h){this._rctx=h;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}u.getShaderSources=function(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",
fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}};var m=u.prototype;m._createHelperProgram=function(){const h=u.getShaderSources();return this._rctx.programCache.acquire(h.vertex,h.fragment,new Map([]))};m._createIndexbuffer=function(){return F.BufferObject.createIndex(this._rctx,D.Usage.STATIC_DRAW,new Uint32Array([0]))};m.resetIndicesType=function(){this._program.compiled&&this._indexBuffer&&
(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,D.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(D.PrimitiveType.POINTS,1,D.DataType.UNSIGNED_INT,0))};m.dispose=function(){this._program.dispose();this._indexBuffer.dispose()};return l._createClass(u)}();n.AppleAmdDriverHelper=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/maybe"],function(n,l,F){let D=function(){function A(){this._result=!1}A.prototype.dispose=function(){this._program=F.disposeMaybe(this._program)};l._createClass(A,[{key:"result",get:function(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}]);return A}();n.WebGLDriverTestModule=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g){function e(k,p){return k.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${p?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}g=function(k){function p(t){var v=k.call(this)||this;v._rctx=t;v._program=e(v._rctx,!1);v._obfuscated=e(v._rctx,!0);return v}l._inherits(p,k);var q=p.prototype;q.dispose=function(){l._get(l._getPrototypeOf(p.prototype),"dispose",this).call(this);this._obfuscated=A.disposeMaybe(this._obfuscated)};q._test=function(t){if(D("force-double-precision-obfuscation"))return!0;
if(null==this._obfuscated)return!1;t=this._runProgram(t);const v=this._runProgram(this._obfuscated);return 0!==t&&(0===v||5<t/v)};q._runProgram=function(t){var v=this._rctx;v.resetState();var y=new c.TextureDescriptor(1);y.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;y.samplingMode=f.TextureSamplingMode.NEAREST;y=new d.FramebufferObject(v,y);var w=m.BufferObject.createVertex(v,f.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));w=new a.VertexArrayObject(v,new Map([["position",0]]),{geometry:[new b.VertexElementDescriptor("position",
2,f.DataType.UNSIGNED_SHORT,0,4)]},{geometry:w});const z=u.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),r=u.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),C=new Float32Array(6);h.encodeDoubleArray(z,C,3);const x=new Float32Array(6);h.encodeDoubleArray(r,x,3);v.useProgram(t);t.setUniform3f("u_highA",C[0],C[2],C[4]);t.setUniform3f("u_lowA",C[1],C[3],C[5]);t.setUniform3f("u_highB",x[0],x[2],x[4]);t.setUniform3f("u_lowB",x[1],x[3],x[5]);v.bindFramebuffer(y);v.setViewport(0,
0,1,1);v.bindVAO(w);v.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4);t=new Uint8Array(4);y.readPixels(0,0,1,1,f.PixelFormat.RGBA,f.PixelType.UNSIGNED_BYTE,t);w.dispose();y.dispose();v=(z[2]-r[2])/25;t=F.unpackFloatRGBA(t);return Math.abs(v-t)};return l._createClass(p)}(g.WebGLDriverTestModule);n.DoublePrecisionRequiresObfuscation=g;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(n){const l=new Float32Array(2);
n.decodeDoubleArray=function(F,D,A){for(let u=0;u<A;++u)D[u]=F[2*u]+F[2*u+1]};n.encodeDoubleArray=function(F,D,A){for(let u=0;u<A;++u)D[2*u]=F[u],D[2*u+1]=F[u]-D[2*u]};n.encodeDoubleHi=function(F,D){const A=F.length;for(let u=0;u<A;++u)l[0]=F[u],D[u]=l[0];return D};n.encodeDoubleLo=function(F,D){const A=F.length;for(let u=0;u<A;++u)l[0]=F[u],l[1]=F[u]-l[0],D[u]=l[1];return D};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./contextUtils ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){a=function(b){function g(e){var k=b.call(this)||this;k._rctx=e;if(!e.gl)return l._possibleConstructorReturn(k);if(e.type===A.ContextType.WEBGL1)return k._result=!(!e.capabilities.textureFloat?.textureFloat||!e.capabilities.colorBufferFloat?.textureFloat),l._possibleConstructorReturn(k);if(!(e.capabilities.textureFloat?.textureFloat&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend))return l._possibleConstructorReturn(k);k._program=
e.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]));return k}l._inherits(g,b);g.prototype._test=function(e){const k=this._rctx;var p=new f.TextureDescriptor(1);p.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;p.dataType=u.PixelType.FLOAT;p.internalFormat=
u.SizedPixelFormat.RGBA32F;p.samplingMode=u.TextureSamplingMode.NEAREST;p=new m.FramebufferObject(k,p);var q=D.BufferObject.createVertex(k,u.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));q=new d.VertexArrayObject(k,new Map([["a_pos",0]]),{geometry:[new c.VertexElementDescriptor("a_pos",2,u.DataType.UNSIGNED_SHORT,0,4)]},{geometry:q});k.useProgram(e);e=k.getBoundFramebufferObject();const {x:t,y:v,width:y,height:w}=k.getViewport();k.bindFramebuffer(p);k.setViewport(0,0,1,1);k.bindVAO(q);k.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,
0,4);var z=h.makePipelineState({blending:F.blendingAlpha});k.setPipelineState(z);k.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);z=k.gl.getError();k.setViewport(t,v,y,w);k.bindFramebuffer(e);q.dispose();p.dispose();return 1282===z?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};return l._createClass(g)}(a.WebGLDriverTestModule);n.FloatBufferBlend=a;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports",
"./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(n,l,F,D){const A=D.separateBlendingParams(F.BlendFactor.SRC_ALPHA,F.BlendFactor.ONE,F.BlendFactor.ONE_MINUS_SRC_ALPHA,F.BlendFactor.ONE_MINUS_SRC_ALPHA),u=D.simpleBlendingParams(F.BlendFactor.ONE,F.BlendFactor.ONE),m=D.simpleBlendingParams(F.BlendFactor.ZERO,F.BlendFactor.ONE_MINUS_SRC_ALPHA),h={factor:-1,units:-2};n.OITPolygonOffset=h;n.OITPolygonOffsetLimit=5E5;n.blendingAlpha=m;n.blendingColor=u;n.blendingDefault=
A;n.getOITPolygonOffset=function(f){return f?h:null};n.oitBlending=function(f){return f===l.TransparencyPassType.FrontFace?null:f===l.TransparencyPassType.Alpha?m:u};n.oitDepthTest=function(f,d=F.CompareFunction.LESS){return f===l.TransparencyPassType.NONE||f===l.TransparencyPassType.FrontFace?d:F.CompareFunction.LEQUAL};n.oitDepthWrite=function(f){return f===l.TransparencyPassType.FrontFace?D.defaultDepthWriteParams:null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],
function(n){n.TransparencyPassType=void 0;var l=n.TransparencyPassType||(n.TransparencyPassType={});l[l.Color=0]="Color";l[l.Alpha=1]="Alpha";l[l.FrontFace=2]="FrontFace";l[l.NONE=3]="NONE";l[l.COUNT=4]="COUNT";Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){c=function(a){function b(g){var e=a.call(this)||this;e._rctx=g;e._program=g.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]));return e}l._inherits(b,a);b.prototype._test=function(g){const e=this._rctx;var k=new h.TextureDescriptor(1);k.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;k.samplingMode=A.TextureSamplingMode.NEAREST;const p=new u.FramebufferObject(e,k),q=new Uint8Array(4);var t=D.BufferObject.createVertex(e,A.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,
1]));t=new f.VertexArrayObject(e,new Map([["a_position",0]]),{geometry:[new d.VertexElementDescriptor("a_position",2,A.DataType.SHORT,0,4)]},{geometry:t});e.useProgram(g);k=new m.Texture(e,k,new Uint8Array([2,255,0,0]));g.setUniform1i("u_texture",0);e.bindTexture(k,0);k=e.getBoundFramebufferObject();e.bindFramebuffer(p);e.useProgram(g);const {x:v,y,width:w,height:z}=e.getViewport();e.setViewport(0,0,1,1);e.bindVAO(t);e.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4);e.setViewport(v,y,w,z);p.readPixels(0,
0,1,1,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,q);t.dispose();p.dispose();(g=255!==q[0]||255!==q[1]||255!==q[2]||255!==q[3])&&F.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${q[0]}.${q[1]}.${q[2]}.${q[3]}]`);
e.bindFramebuffer(k);return g};return l._createClass(b)}(c.WebGLDriverTestModule);n.IgnoresSamplerPrecision=c;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(n,l,F,D,A,u,m,h,f,d){d=function(a){function b(e){var k=
a.call(this)||this;k._rctx=e;k._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]));return k}l._inherits(b,a);var g=b.prototype;
g.dispose=function(){l._get(l._getPrototypeOf(b.prototype),"dispose",this).call(this)};g._test=function(e){const k=this._rctx;if(!k.gl)return e.dispose(),!0;var p=new h.TextureDescriptor(1);p.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;p.samplingMode=A.TextureSamplingMode.NEAREST;p=new u.FramebufferObject(k,p);var q=D.BufferObject.createVertex(k,A.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));q=new f.VertexArrayObject(k,new Map([["a_pos",0]]),F.Pos2us,{geometry:q});var t=new h.TextureDescriptor;
t.samplingMode=A.TextureSamplingMode.LINEAR;t.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;t=new m.Texture(k,t,c);k.useProgram(e);k.bindTexture(t,0);e.setUniform1i("u_texture",0);e=k.getBoundFramebufferObject();const {x:v,y,width:w,height:z}=k.getViewport();k.bindFramebuffer(p);k.setViewport(0,0,1,1);k.setClearColor(0,0,0,0);k.setBlendingEnabled(!1);k.clearSafe(A.ClearBufferBit.COLOR_BUFFER_BIT);k.bindVAO(q);k.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4);const r=new Uint8Array(4);p.readPixels(0,0,1,
1,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,r);q.dispose();p.dispose();t.dispose();k.setViewport(v,y,w,z);k.bindFramebuffer(e);return 255!==r[0]};return l._createClass(b)}(d.WebGLDriverTestModule);const c=new Image;c.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";c.width=
5;c.height=5;c.decode();n.SVGPremultipliedAlpha=d;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),function(n,l,F,D,A,u,m,h){let f=function(){function d(c,a){this._gl=c;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=
this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=this._instancing=null;this._disabledExtensions=a.disabledExtensions||{};this._debugWebGLExtensions=a.debugWebGLExtensions||{}}d.prototype.enable=function(c){return this[c]};l._createClass(d,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=D.load(this._gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",
get:function(){this._instancing||(this._instancing=A.load(this._gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=h.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=u.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||
(this._compressedTextureS3TC=u.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=u.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=F.createDisjointTimerQuery(this._gl,this._disabledExtensions));
return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=u.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=u.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=u.loadMinMaxBlending(this._gl,this._disabledExtensions));
return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=u.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=m.load(this._gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=
u.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=u.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return d}();n.Capabilities=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],
function(n,l){n.load=function(F,D){return D.disjointTimerQuery?null:l(F)?{drawBuffers:F.drawBuffers.bind(F),MAX_DRAW_BUFFERS:F.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:F.MAX_COLOR_ATTACHMENTS}:D.drawBuffers?null:(F=F.getExtension("WEBGL_draw_buffers"))?{drawBuffers:F.drawBuffersWEBGL.bind(F),MAX_DRAW_BUFFERS:F.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:F.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports",
"./isWebGL2Context"],function(n,l){n.load=function(F){return l(F)?F:(F=F.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:F.drawArraysInstancedANGLE.bind(F),drawElementsInstanced:F.drawElementsInstancedANGLE.bind(F),vertexAttribDivisor:F.vertexAttribDivisorANGLE.bind(F)}:null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(n,l){n.loadBooleanExtension=function(F,D,A,u,m){if(u&&
l(F))return!0;if(D[A])return!1;for(const h of m)if(F.getExtension(h))return!0;return!1};n.loadColorBufferFloat=function(F,D){if(l(F)){var A=!D.colorBufferHalfFloat&&F.getExtension("EXT_color_buffer_half_float")||!D.colorBufferFloat&&F.getExtension("EXT_color_buffer_float"),u=!D.colorBufferFloat&&F.getExtension("EXT_color_buffer_float");D=!D.floatBlend&&!D.colorBufferFloat&&F.getExtension("EXT_float_blend");return A||u||D?{textureFloat:!!u,textureHalfFloat:!!A,floatBlend:!!D,R16F:F.R16F,RG16F:F.RG16F,
RGBA16F:F.RGBA16F,R32F:F.R32F,RG32F:F.RG32F,RGBA32F:F.RGBA32F,R11F_G11F_B10F:F.R11F_G11F_B10F,RGB16F:F.RGB16F}:null}return F instanceof WebGLRenderingContext?(A=!D.colorBufferHalfFloat&&F.getExtension("EXT_color_buffer_half_float"),u=!D.colorBufferFloat&&F.getExtension("WEBGL_color_buffer_float"),F=!D.floatBlend&&!D.colorBufferFloat&&F.getExtension("EXT_float_blend"),A||u||F?{textureFloat:!!u,textureHalfFloat:!!A,floatBlend:!!F,RGBA16F:A?A.RGBA16F_EXT:void 0,RGB16F:A?A.RGB16F_EXT:void 0,RGBA32F:u?
u.RGBA32F_EXT:void 0}:null):null};n.loadCompressedTextureETC=function(F,D){return D.compressedTextureETC?null:(F=F.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:F.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:F.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:F.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:F.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:F.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:F.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:F.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};n.loadCompressedTextureS3TC=function(F,D){return D.compressedTextureS3TC?null:(F=F.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:F.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:F.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:F.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:F.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};n.loadMinMaxBlending=function(F,D){return l(F)?{MIN:F.MIN,MAX:F.MAX}:D.blendMinMax?null:(F=F.getExtension("EXT_blend_minmax"))?{MIN:F.MIN_EXT,MAX:F.MAX_EXT}:null};n.loadTextureFilterAnisotropicCapability=function(F,D){return D.textureFilterAnisotropic?null:(F=F.getExtension("EXT_texture_filter_anisotropic")||F.getExtension("MOZ_EXT_texture_filter_anisotropic")||F.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:F.MAX_TEXTURE_MAX_ANISOTROPY_EXT,
TEXTURE_MAX_ANISOTROPY:F.TEXTURE_MAX_ANISOTROPY_EXT}:null};n.loadTextureFloat=function(F,D){if(l(F))return{textureFloat:!0,textureFloatLinear:!D.textureFloatLinear&&!!F.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:F.HALF_FLOAT,R16F:F.R16F,RG16F:F.RG16F,RGBA16F:F.RGBA16F,R32F:F.R32F,RG32F:F.RG32F,RGBA32F:F.RGBA32F,R11F_G11F_B10F:F.R11F_G11F_B10F,RGB16F:F.RGB16F};if(F instanceof WebGLRenderingContext){const A=!D.textureHalfFloat&&F.getExtension("OES_texture_half_float");
return{textureFloat:!D.textureFloat&&!!F.getExtension("OES_texture_float"),textureFloatLinear:!D.textureFloatLinear&&!!F.getExtension("OES_texture_float_linear"),textureHalfFloat:!!A,textureHalfFloatLinear:!D.textureHalfFloatLinear&&!!F.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:A?A.HALF_FLOAT_OES:void 0}}return null};n.loadTextureNorm16=function(F,D){return!l(F)||D.textureNorm16?null:(F=F.getExtension("EXT_texture_norm16"))?{R16:F.R16_EXT,RG16:F.RG16_EXT,RGB16:F.RGB16_EXT,RGBA16:F.RGBA16_EXT,
R16_SNORM:F.R16_SNORM_EXT,RG16_SNORM:F.RG16_SNORM_EXT,RGB16_SNORM:F.RGB16_SNORM_EXT,RGBA16_SNORM:F.RGBA16_SNORM_EXT}:null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(n){n.load=function(l,F){const D=F.loseContext&&l.getExtension("WEBGL_lose_context");return D?{loseRenderingContext:()=>D.loseContext()}:null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports",
"./isWebGL2Context"],function(n,l){n.load=function(F,D){return l(F)?{createVertexArray:F.createVertexArray.bind(F),deleteVertexArray:F.deleteVertexArray.bind(F),bindVertexArray:F.bindVertexArray.bind(F)}:D.vao?null:(F=F.getExtension("OES_vertex_array_object")||F.getExtension("MOZ_OES_vertex_array_object")||F.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:F.createVertexArrayOES.bind(F),deleteVertexArray:F.deleteVertexArrayOES.bind(F),bindVertexArray:F.bindVertexArrayOES.bind(F)}:
null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/HandleOwner ../../core/has ../../core/Logger ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g){n.LabelManager=function(e){function k(q){var t=e.call(this,q)||this;t.collisionEngine=new g.CollisionEngine;t.lastUpdateId=-1;t.updateRequested=!1;t.view=null;t._applyVisibilityPass=f.throttle(v=>{const y=t.view;if(y)try{const w=y.featuresTilingScheme.getClosestInfoForScale(v.state.scale).level;t.collisionEngine.run(y.allLayerViews.items,v,w)}catch(w){}},32,l._assertThisInitialized(t));t.addHandles(t._applyVisibilityPass);return t}l._inherits(k,e);var p=k.prototype;
p.update=function(q){this._applyVisibilityPass(q)};p.viewChange=function(){this.requestUpdate()};p.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())};p.processUpdate=function(q){this.updateRequested&&(this.updateRequested=!1,this.update(q))};l._createClass(k,[{key:"updating",get:function(){m("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`);return this.updateRequested}}]);
return k}(u.HandleOwnerMixin(D));F.__decorate([d.property()],n.LabelManager.prototype,"updateRequested",void 0);F.__decorate([d.property()],n.LabelManager.prototype,"updating",null);F.__decorate([d.property()],n.LabelManager.prototype,"view",void 0);n.LabelManager=F.__decorate([b.subclass("esri.views.2d.LabelManager")],n.LabelManager);Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/throttle":function(){define(["exports"],function(n){n.throttle=function(l,F,D,A){let u=null,
m=1E3;"number"===typeof F?(m=F,A=D):(u=F??null,m=D);let h=0,f;const d=()=>{h=0;l.apply(A,f)};F=(...c)=>{u&&u.apply(A,c);f=c;m?h||(h=setTimeout(d,m)):d()};F.remove=()=>{h&&(clearTimeout(h),h=0)};F.forceUpdate=()=>{h&&(clearTimeout(h),d())};F.hasPendingUpdates=()=>!!h;return F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./CollisionGrid"],
function(n,l,F,D){function A(m,h){const f=[];m.forEachTile(d=>f.push(d));f.sort((d,c)=>d.instanceId-c.instanceId);f.forEach(d=>{null!=d.labelMetrics&&d.isReady&&h(d,d.labelMetrics.getCursor())})}let u=function(){function m(){}var h=m.prototype;h.run=function(f,d,c){const a=[];for(let b=f.length-1;0<=b;b--){const g=f[b];g.labelingCollisionInfos&&a.push(...g.labelingCollisionInfos)}this._transformMetrics(a);this._runCollision(a,d,c)};h._runCollision=function(f,d,c){const [a,b]=d.state.size,g=new D.CollisionBitsetGrid(a,
b,d.pixelRatio);for(const {tileRenderer:e,deconflictionEnabled:k,visible:p}of f){const q=e.featuresView.attributeView;k?p?(this._prepare(e),this._collideVisible(g,e,c),this._collideInvisible(g,e)):A(e,(t,v)=>{for(;v.nextId();)q.setLabelMinZoom(v.id,255)}):A(e,(t,v)=>{for(;v.nextId();)q.setLabelMinZoom(v.id,0),p&&g.insertMetrics(v)})}};h._isFiltered=function(f,d,c){f=d.getFilterFlags(f);d=null==c.featureEffect||c.featureEffect.excludedLabelsVisible||!!(f&F.EFFECT_FLAG_0);return!((!c.hasFilter||f&F.FILTER_FLAG_0)&&
d)};h._prepare=function(f){const d=f.featuresView.attributeView,c=new Set;A(f,(a,b)=>{for(;b.nextId();)c.has(b.id)||(c.add(b.id),this._isFiltered(b.id,d,f.layerView)?d.setLabelMinZoom(b.id,254):0!==d.getLabelMinZoom(b.id)?d.setLabelMinZoom(b.id,255):d.setLabelMinZoom(b.id,0))})};h._collideVisible=function(f,d,c){const a=d.featuresView.attributeView,b=new Set;A(d,(g,e)=>{for(;e.nextId();)if(!b.has(e.id))if(g.key.level!==c)a.setLabelMinZoom(e.id,254);else if(0===a.getLabelMinZoom(e.id))switch(f.insertMetrics(e)){case D.HAS_COLLISION:a.setLabelMinZoom(e.id,
254);b.add(e.id);break;case D.NONE:a.setLabelMinZoom(e.id,0),b.add(e.id)}})};h._collideInvisible=function(f,d){const c=d.featuresView.attributeView,a=new Set;A(d,(b,g)=>{for(;g.nextId();)if(!a.has(g.id)&&255===c.getLabelMinZoom(g.id))switch(f.insertMetrics(g)){case D.HAS_COLLISION:c.setLabelMinZoom(g.id,255);a.add(g.id);break;case D.NONE:c.setLabelMinZoom(g.id,0),a.add(g.id)}})};h._transformMetrics=function(f){for(const {tileRenderer:d,geometryType:c,vvEvaluators:a}of f)A(d,(b,g)=>{const e=d.featuresView.attributeView;
b=b.transforms.labelMat2d;b[4]=Math.round(b[4]);b[5]=Math.round(b[5]);const k="polyline"===c;for(;g.next();){const w=g.boundsCount,z=g.anchorX,r=g.anchorY;var p=g.size,q=a[0];if(null!=q){var t=e.getVVSize(g.id);q=q(t);p=isNaN(q)||null==q||Infinity===q?p:q}q=p/2*g.directionX;p=p/2*g.directionY;for(t=0;t<w;t++){var v=z,y=g.anchorY;k?(v=v+g.boundsX(t)+q,y=y+g.boundsY(t)+p,v=b[0]*v+b[2]*y+b[4],y=b[1]*v+b[3]*y+b[5],g.setBoundsComputedAnchorX(t,Math.floor(v)),g.setBoundsComputedAnchorY(t,Math.floor(y))):
(v=b[0]*z+b[2]*r+b[4],y=b[1]*z+b[3]*r+b[5],v=v+g.boundsX(t)+q,y=y+g.boundsY(t)+p,g.setBoundsComputedAnchorX(t,v),g.setBoundsComputedAnchorY(t,y))}}})};return l._createClass(m)}();n.CollisionEngine=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(n,l,F,D){let A=
function(){function u(h,f,d){this._debugMap=new Map;this._width=h*d;this._height=f*d;this._pixelRatio=d;h=Math.ceil(this._width/1);f=Math.ceil(this._height/1);this._cols=h;this._rows=f;this._cells=D.StaticBitSet.create(h*f)}var m=u.prototype;m.insertMetrics=function(h){const f=this._hasCollision(h);0===f&&this._markMetrics(h);return f};m.getCellId=function(h,f){return h+f*this._cols};m.has=function(h){return this._cells.has(h)};m.hasRange=function(h,f){return this._cells.hasRange(h,f)};m.set=function(h){this._cells.set(h)};
m.setRange=function(h,f){this._cells.setRange(h,f)};m._collide=function(h,f,d,c){h-=d/2;f-=c/2;d=h+d;var a=f+c;if(0>d||0>a||h>this._width||f>this._height)return 1;c=F.clamp(Math.floor(h/1),0,this._cols);var b=F.clamp(Math.floor(f/1),0,this._rows);h=F.clamp(Math.ceil(d/1),0,this._cols);f=F.clamp(Math.ceil(a/1),0,this._rows);for(d=b;d<=f;d++)for(a=c;a<=h;a++)if(b=this.getCellId(a,d),this.has(b))return 2;return 0};m._mark=function(h,f,d,c,a){h-=d/2;f-=c/2;d=h+d;var b=f+c;c=F.clamp(Math.floor(h/1),0,
this._cols);var g=F.clamp(Math.floor(f/1),0,this._rows);h=F.clamp(Math.ceil(d/1),0,this._cols);f=F.clamp(Math.ceil(b/1),0,this._rows);for(d=g;d<=f;d++)for(b=c;b<=h;b++)g=this.getCellId(b,d),this._debugMap.set(g,a),this.set(g);return!1};m._hasCollision=function(h){const f=h.id;let d=0,c=0;h.save();do{const a=h.boundsCount;d+=a;for(let b=0;b<a;b++){const g=h.boundsComputedAnchorX(b),e=h.boundsComputedAnchorY(b),k=(h.boundsWidth(b)+2)*this._pixelRatio,p=(h.boundsHeight(b)+2)*this._pixelRatio;switch(this._collide(g,
e,k,p)){case 2:return 2;case 1:c++}}}while(h.peekId()===f&&h.next());h.restore();return d===c?1:0};m._markMetrics=function(h){const f=h.id;h.save();do{const d=h.boundsCount;for(let c=0;c<d;c++){const a=h.boundsComputedAnchorX(c),b=h.boundsComputedAnchorY(c),g=(h.boundsWidth(c)+2)*this._pixelRatio,e=(h.boundsHeight(c)+2)*this._pixelRatio;this._mark(a,b,g,e,h.id)}}while(h.peekId()===f&&h.next());h.restore()};return l._createClass(u)}();n.CollisionBitsetGrid=A;n.HAS_COLLISION=2;n.NONE=0;n.OUTSIDE_EXTENT=
1;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(u,m){this._mask=0;this._buf=u;this._mask=m}D.fromBuffer=function(u,m){return new D(u,m)};D.create=function(u,m=4294967295){u=new Uint32Array(Math.ceil(u/32));return new D(u,m)};var A=D.prototype;A._getIndex=function(u){return Math.floor(u/32)};A.has=function(u){u&=
this._mask;return!!(this._buf[this._getIndex(u)]&1<<u%32)};A.hasRange=function(u,m){for(;u%32&&u!==m;){if(this.has(u))return!0;u++}for(;m%32&&u!==m;){if(this.has(u))return!0;m--}if(u===m)return!1;for(u/=32;u!==m/32;u++)if(this._buf[u])return!0;return!1};A.set=function(u){u&=this._mask;const m=this._getIndex(u);this._buf[m]|=1<<u%32};A.setRange=function(u,m){for(;u%32&&u!==m;)this.set(u++);for(;m%32&&u!==m;)this.set(m--);if(u!==m)for(u/=32;u!==m/32;u++)this._buf[u]=4294967295};A.unset=function(u){u&=
this._mask;const m=this._getIndex(u);this._buf[m]&=4294967295^1<<u%32};A.resize=function(u){const m=this._buf;u=new Uint32Array(Math.ceil(u/32));u.set(m);this._buf=u};A.or=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]|=u._buf[m];return this};A.and=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]&=u._buf[m];return this};A.xor=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]^=u._buf[m];return this};A.ior=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]|=
~u._buf[m];return this};A.iand=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]&=~u._buf[m];return this};A.ixor=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]^=~u._buf[m];return this};A.any=function(){for(let u=0;u<this._buf.length;u++)if(this._buf[u])return!0;return!1};A.copy=function(u){for(let m=0;m<this._buf.length;m++)this._buf[m]=u._buf[m];return this};A.clone=function(){return new D(this._buf.slice(),this._mask)};A.clear=function(){for(let u=0;u<this._buf.length;u++)this._buf[u]=
0};A.forEachSet=function(u){for(let m=0;m<this._buf.length;m++){let h=this._buf[m],f=32*m;if(h)for(;h;)h&1&&u(f),h>>>=1,f++}};A.countSet=function(){let u=0;this.forEachSet(m=>{u++});return u};return l._createClass(D)}();n.StaticBitSet=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/BidiText ../../../../core/HandleOwner ../../../../core/has ../../../../core/Identifiable ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtilsSync ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/support/defaults ../../engine/webgl/definitions ../../engine/webgl/enums ../../engine/webgl/GraphicTile ../../engine/webgl/TileData ../../engine/webgl/WGLDisplayObject ../../engine/webgl/mesh/MeshData ../../engine/webgl/mesh/factories/WGLMeshFactory ../../engine/webgl/mesh/templates/WGLTemplateStore ../../engine/webgl/util/Matcher ../features/schemaUtils ../features/support/AttributeStore ../features/support/ComputedAttributeStorage ../features/support/GraphicsReader ./GraphicStore ./graphicsUtils ../support/cimSymbolUtils ../../../webgl/capabilities ../features/createSymbolSchema".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v,y,w,z,r,C,x,E,B,G,H,I,J,L,K,S,W,X,Z,V,O,P){function M(R,aa,ba){let N=ba.get(R);N||(N={tile:aa,addedOrModified:[],removed:[]},ba.set(R,N));return N}const Q=m("esri-2d-graphic-debug");F=function(R){function aa(N){N=R.call(this,N)||this;N._storage=new S.ComputedAttributeStorage;N._displayIds=new Map;N._controller=new AbortController;N._tiles=new Map;N._graphicStoreUpdate=!1;N._graphicsSet=new Set;N._matcher=Promise.resolve(null);N._tileUpdateSet=new Set;
N._tilesToUpdate=new Map;N._graphicIdToAbortController=new Map;N._attached=!1;N._updatingGraphicsTimer=null;N._hashToExpandedSymbol=new Map;N._hashToExpandedSymbolPromise=new Map;N._hashToCIMSymbolPromise=new Map;N._hashToCIM=new Map;N._processing=!1;N._needsProcessing=!1;N._pendingUpdate={added:new Set,updated:new Set,removed:new Set};N.lastUpdateId=-1;N.renderer=null;N.updateRequested=!1;N.defaultPointSymbolEnabled=!0;N.graphicUpdateHandler=N.graphicUpdateHandler.bind(n._assertThisInitialized(N));
return N}n._inherits(aa,R);var ba=aa.prototype;ba.destroy=function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating"));this._controller.abort();this.container.destroy();this._set("graphics",null);this._graphicStore.clear();this._attributeStore=null;this._hashToExpandedSymbol.clear();this.renderer=this.view=null;this._hashToCIM.clear();this._hashToCIMSymbolPromise.clear();this._hashToExpandedSymbolPromise.clear()};
ba._createMatcher=function(N,T,U){if(N){const Y=L.createSymbolSchemaOptions(N);N=L.createMatcherSchema({indexCount:0,fields:{}},"feature",N,Y);this._matcher=J.createMatcher(N,T,null,U)}};ba._createDisplayId=function(N){let T=this._displayIds.get(N);T||(T=this._storage.createDisplayId(),this._displayIds.set(N,T));return T};ba.initialize=function(){this._attributeStore=new K({type:"local",initialize:T=>Promise.resolve(this.container.attributeView.initialize(T)),update:T=>this.container.attributeView.requestUpdate(T),
render:()=>this.container.requestRender()},O.getWebGLCapabilities("2d"));this.container.hasHighlight=()=>this._attributeStore.hasHighlight;const N=new I.WGLTemplateStore(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new X(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,T=>{this._createDisplayId(T.uid);this._setFilterState(T.uid,T.visible)},T=>{const U=this._displayIds.get(T.uid);this._displayIds.delete(T.uid);
this._storage.releaseDisplayId(U)},this._hashToCIM);this._meshFactory=new H.WGLMeshFactory(null,this.uid,N);this._templateStore=N;this.handles.add([c.watch(()=>this._effectiveRenderer,T=>{this._createMatcher(T,N,this.container.stage.resourceManager);for(const U of this.graphics)this._pendingUpdate.updated.add(U);this.requestUpdate()}),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{Q&&this.container.enableRenderingBounds(()=>this._graphicStore.getAllBounds());
0<this.graphics.items.length&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]});this.handles.add(this.graphics.on("change",U=>this._graphicsChangeHandler(U)),"graphics");const T=this.container.stage.resourceManager;this._createMatcher(this._effectiveRenderer,N,T);this._graphicStore.setResourceManager(T);this._attached=!0;this.notifyChange("updating")})]);this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})};ba.hitTest=function(N){if(!this.view||
this.view.suspended)return[];const {resolution:T,rotation:U}=this.view.state;return this._graphicStore.hitTest(N.x,N.y,2,T,U)};ba.update=function(N){d.throwIfAborted(this._controller.signal);({resolution:N}=N.state);this._graphicStore.updateLevel(N);this._graphicStoreUpdate=!0;this.updateRequested=!1;0<this._pendingUpdate.updated.size&&(this._processing?this._needsProcessing=!0:this._updateGraphics())};ba.viewChange=function(){this.requestUpdate()};ba.requestUpdate=function(){this.updateRequested||
(this.updateRequested=!0,this.requestUpdateCallback())};ba.processUpdate=function(N){this.updateRequested&&(this.updateRequested=!1,this.update(N))};ba.graphicUpdateHandler=function(N){const {graphic:T,property:U}=N;switch(U){case "attributes":case "geometry":case "symbol":this._pendingUpdate.updated.add(T);this.requestUpdate();break;case "visible":this._setFilterState(T.uid,T.visible),this._attributeStore.sendUpdates()}};ba.setHighlight=function(N){const T=N.map(U=>this._displayIds.get(U)).filter(D.isSome);
this._attributeStore.setHighlight(N,T)};ba._getIntersectingTiles=function(N){N=this._graphicStore.getBounds(N);if(!N||0===k.width(N)||0===k.height(N))return[];const T=Z.intersectingInternationalDateline(N,this.view.spatialReference);return null!=T?[...(new Set([...this.view.graphicsTileStore.boundsIntersections(T[0]),...this.view.graphicsTileStore.boundsIntersections(T[1])]))]:this.view.graphicsTileStore.boundsIntersections(N)};ba._updateTile=async function(N){d.throwIfAborted(this._controller.signal);
const T=N.tile;var U=this._getGraphicsData(this._templateStore,T,N.addedOrModified);U=await this._processGraphics(T,U);d.throwIfAborted(this._controller.signal);this._patchTile(T.key,{type:"update",addOrUpdate:U,remove:N.removed,end:!0,clear:!1,sort:!1});return U};ba._patchTile=function(N,T){if(N=this._tiles.get(N))this.container.onTileData(N,T),this.container.requestRender()};ba._graphicsChangeHandler=function(N){const T=this._pendingUpdate;for(const U of N.added)T.added.add(U);for(const U of N.moved)T.updated.add(U);
for(const U of N.removed)this._pendingUpdate.added.has(U)?T.added.delete(U):T.removed.add(U);this._processing?this._needsProcessing=!0:this._updateGraphics()};ba._getGraphicsToUpdate=function(){const N={added:[],removed:[],updated:[]};if(!this.graphics)return N;const T=this._pendingUpdate;for(const U of this.graphics.items)T.added.has(U)?N.added.push(U):T.updated.has(U)&&N.updated.push(U);for(const U of T.removed)this._graphicStore.has(U)&&N.removed.push(U);T.added.clear();T.removed.clear();T.updated.clear();
return N};ba._updateGraphics=async function(){this._processing=!0;const {added:N,removed:T,updated:U}=this._getGraphicsToUpdate(),Y=this._tilesToUpdate;try{if(!this._graphicStoreUpdate){var {resolution:ca}=this.view.state;this._graphicStore.updateLevel(ca)}ca=[];const ja=Array(N.length+T.length);for(let ha=0;ha<U.length;ha++){var da=U[ha];const ka=this._getIntersectingTiles(da);for(const ma of ka){var ea=ma.id;M(ea,ma,Y).removed.push(this._displayIds.get(da.uid))}ca.push(this._updateGraphic(da,null));
ja[ha]=da}var fa=U.length;for(da=0;da<N.length;da++){const ha=N[da];ja[fa+da]=ha;this._graphicsSet.add(ha);ca.push(this._addGraphic(ha))}for(const ha of T){this._abortProcessingGraphic(ha.uid);const ka=this._getIntersectingTiles(ha);for(const ma of ka)ea=ma.id,M(ea,ma,Y).removed.push(this._displayIds.get(ha.uid));this._graphicsSet.delete(ha);this._graphicStore.remove(ha)}this._flipUpdatingGraphics();await Promise.all(ca);let ia;for(fa=0;fa<ja.length;fa++){ia=ja[fa];const ha=this._getIntersectingTiles(ia);
for(const ka of ha)ea=ka.id,M(ea,ka,Y).addedOrModified.push(ia)}this._graphicStore.updateZ();ea=[];for(const [,ha]of Y)ea.push(this._updateTile(ha));await Promise.all(ea)}catch(ja){d.isAbortError(ja)}for(const ja of T)try{const ia=await this._getSymbolForGraphic(ja,null);if(ia){const ha=ia.hash();this._hashToExpandedSymbol.delete(ha)}}catch(ia){d.isAbortError(ia)}Y.clear();this.notifyChange("updating");this._processing=!1;this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())};ba._getArcadeInfo=
function(N){const T=(N.attributes?Object.keys(N.attributes):[]).map(U=>({name:U,alias:U,type:"string"===typeof N.attributes[U]?"esriFieldTypeString":"esriFieldTypeDouble"}));return null==N.geometry?null:{geometryType:q.getJsonType(N.geometry),spatialReference:e.fromJSON(N.geometry.spatialReference),fields:T}};ba._getSymbolForGraphic=function(N,T){d.throwIfAborted(this._controller.signal);return null!=N.symbol?Promise.resolve(N.symbol):null!=this._effectiveRenderer?this._effectiveRenderer.getSymbolAsync(N,
{scale:this.view.state.scale,signal:null!=T?T.signal:null}):Promise.resolve(this._getNullSymbol(N))};ba._getCIMSymbol=function(N,T,U){var Y=this._hashToCIM.get(T);if(Y)return Promise.resolve(Y);N=w.symbolToCIM(N);if(null!=N){if("CIMSymbolReference"===N.type)return Y=N,this._hashToCIM.set(T,Y),Promise.resolve(Y);if(Y=this._hashToCIMSymbolPromise.get(T))return Y;Y=N.fetchCIMSymbol(U).then(ca=>{this._hashToCIM.set(T,ca.data);this._hashToCIMSymbolPromise.delete(T);return ca}).catch(ca=>{this._hashToCIMSymbolPromise.delete(T);
d.throwIfAbortError(ca);return null});this._hashToCIMSymbolPromise.set(T,Y);return Y}return Promise.resolve(null)};ba._expandCIMSymbol=function(N,T,U,Y){var ca=this._hashToExpandedSymbol.get(U);if(ca)return Promise.resolve(ca);if(ca=this._hashToExpandedSymbolPromise.get(U))return ca;ca=this.container.stage;T=this._getArcadeInfo(T);const da=L.createSymbolSchemaOptions(null);N=P.createSymbolSchema(N,da);ca=V.expandSymbol(N,T,ca.resourceManager,Y);this._hashToExpandedSymbolPromise.set(U,ca);ca.then(ea=>
{this._hashToExpandedSymbol.set(U,ea);this._hashToExpandedSymbolPromise.delete(U);return ea});return ca};ba._getSymbolResources=async function(N,T){d.throwIfAborted(this._controller.signal);return this.container.stage?this._getSymbolForGraphic(N,T).then(U=>{if(!U)return null;const Y=U.hash();return this._getCIMSymbol(U,Y,T).then(ca=>null==ca?null:this._expandCIMSymbol(ca,N,Y,T).then(da=>{const ea=da.layers.filter(fa=>"text"===fa.type&&"string"===typeof fa.text);if(ea&&0<ea.length){const fa=Array(ea.length);
for(let ia=0;ia<ea.length;ia++){const ha=ea[ia],ka=[],[ma]=A.bidiText(ha.text);ha.text=ma;for(let na=0;na<ma.length;na++)ka.push(ma.charCodeAt(na));fa[ia]={symbol:ha,id:ia,glyphIds:ka}}const ja=new Map;return this.container.getMaterialItems(fa).then(ia=>{f.assertIsSome(ia);for(let ha=0;ha<ea.length;ha++){const ka=ea[ha];ja.set(ka.cim,{text:ka.text,mosaicItem:ia[ha].mosaicItem})}return{symbol:da,textInfo:ja,hash:Y}})}return{symbol:da,hash:Y}}))}).catch(U=>{d.throwIfAbortError(U);return null}):null};
ba._projectAndNormalizeGeometry=async function(N,T){d.throwIfAborted(this._controller.signal);if(null==N.geometry||"mesh"===N.geometry.type)return null;var U=N.geometry;q.isPolygon(U)?U.rings=U.rings:q.isPolyline(U)?U.paths=U.paths:q.isExtent(U)&&(N=await this._getSymbolForGraphic(N,T),d.throwIfAborted(this._controller.signal),U=N&&(Z.isMarkerSymbol(N.type)||Z.isTextSymbol(N.type))?U.center:Z.polygonFromExtent(U));await y.checkProjectionSupport(U.spatialReference,this.view.spatialReference);N=t.normalizeCentralMeridianForDisplay(U);
(U=y.project(N,U.spatialReference,this.view.spatialReference))&&p.closeRingsAndFixWinding(U);return U};ba._onTileUpdate=function(N){const T=v.getInfo(this.view.spatialReference);if(N.added&&0<N.added.length)for(const U of N.added)this._addNewTile(U,T);if(N.removed&&0<N.removed.length)for(const U of N.removed)this._removeTile(U.key)};ba._addGraphic=async function(N){this._abortProcessingGraphic(N.uid);d.throwIfAborted(this._controller.signal);var T=new AbortController;this._graphicIdToAbortController.set(N.uid,
T);T={signal:T.signal};try{await this._addOrUpdateGraphic(N,T),d.throwIfAborted(this._controller.signal),this._graphicIdToAbortController.delete(N.uid)}catch(U){if(this._graphicIdToAbortController.delete(N.uid),!d.isAbortError(U))throw U;}};ba._updateGraphic=function(N,T){d.throwIfAborted(this._controller.signal);const U=this._projectAndNormalizeGeometry(N,T);T=this._getSymbolResources(N,T);return Promise.all([U,T]).then(([Y,ca])=>{d.throwIfAborted(this._controller.signal);this._graphicStore.addOrModify(N,
ca,Y)})};ba._addOrUpdateGraphic=function(N,T){d.throwIfAborted(this._controller.signal);const U=this._projectAndNormalizeGeometry(N,T);T=this._getSymbolResources(N,T);return Promise.all([U,T]).then(([Y,ca])=>{d.throwIfAborted(this._controller.signal);this._graphicsSet.has(N)&&this._graphicStore.addOrModify(N,ca,Y)})};ba._addTile=function(N){var T=this.view.featuresTilingScheme.getTileBounds(k.create(),N);const U=this.view.featuresTilingScheme.getTileResolution(N.level);T=new x.GraphicTile(N,U,T[0],
T[3]);this._tiles.set(N,T);this.container.addChild(T);return T};ba._addNewTile=async function(N,T){const U=this._addTile(N.key),Y=this._graphicStore.queryTileData(this._templateStore,N);if(0!==Y.length){if(T){T=Math.round((T.valid[1]-T.valid[0])/N.resolution);for(var ca of Y)ca.geometry&&(q.isPoint(ca.geometry)||q.isMultipoint(ca.geometry))&&this._wrapPoints(ca,T)}ca=N.key;this._tileUpdateSet.add(N.key);this.notifyChange("updating");try{const da={type:"update",clear:!1,addOrUpdate:await this._processGraphics(N,
Y),remove:[],end:!0,sort:!1};U.patch(da);this._tileUpdateSet.delete(ca);this.notifyChange("updating")}catch(da){if(this._tileUpdateSet.delete(ca),this.notifyChange("updating"),!d.isAbortError(da))throw da;}}};ba._removeTile=function(N){if(this._tiles.has(N)){var T=this._tiles.get(N);this.container.removeChild(T);T.destroy();this._tiles.delete(N)}};ba._setFilterState=function(N,T){const U=this._displayIds.get(N);N=this._attributeStore.getHighlightFlag(N);this._attributeStore.setData(U,0,0,N|(T?r.FILTER_FLAG_0:
0))};ba._getGraphicsData=function(N,T,U){const Y=v.getInfo(this.view.spatialReference);N=this._graphicStore.getGraphicsData(N,T,U);if(Y){T=Math.round((Y.valid[1]-Y.valid[0])/T.resolution);for(const ca of N)ca.geometry&&(q.isPoint(ca.geometry)||q.isMultipoint(ca.geometry))&&this._wrapPoints(ca,T)}return N};ba._wrapPoints=function(N,T){const U=N.geometry;q.isMultipoint(U)?this._wrapMultipoint(U,T):this._wrapPoint(N,T)};ba._wrapMultipoint=function(N,T){var U=N.points;const Y=[];let ca=0,da=0;for(const [ea,
fa]of U)Y.push([ea+ca,fa]),ca=0,T===Z.TILE_SIZE?(U=5*Z.PIXEL_BUFFER,ea+da<U?(Y.push([T,0]),ca=-T):ea+da>Z.TILE_SIZE-U&&(Y.push([-T,0]),ca=T)):ea+da<-Z.PIXEL_BUFFER?(Y.push([T,0]),ca=-T):ea+da>Z.TILE_SIZE+Z.PIXEL_BUFFER&&(Y.push([-T,0]),ca=T),da+=ea;N.points=Y};ba._wrapPoint=function(N,T){const U=N.geometry;if(T===Z.TILE_SIZE){const Y=5*Z.PIXEL_BUFFER;U.x<Y?N.geometry={points:[[U.x,U.y],[T,0]]}:U.x>Z.TILE_SIZE-Y&&(N.geometry={points:[[U.x,U.y],[-T,0]]})}else U.x<-Z.PIXEL_BUFFER?N.geometry={points:[[U.x,
U.y],[T,0]]}:U.x>Z.TILE_SIZE+Z.PIXEL_BUFFER&&(N.geometry={points:[[U.x,U.y],[-T,0]]})};ba._processGraphics=function(N,T,U){if(!T||!T.length||!this._meshFactory)return Promise.resolve(null);const Y=W.GraphicsReader.from(T,this.uid,N.transform),ca=this._meshFactory;return this._matcher.then(da=>ca.analyzeGraphics(Y,this.container.stage.resourceManager,da,null,null,U).then(()=>{this._attributeStore.sendUpdates();return this._processAnalyzedGraphics(N,Y)}))};ba._processAnalyzedGraphics=function(N,T){const U=
this._meshFactory;var Y=T.getSize();T=T.getCursor();const ca=new G.MeshData(N.key.id,{features:Y,records:Y,metrics:0},C.WGLSymbologyType.DEFAULT,!1,!1);for(Y=[];T.next();){const da=T.readGraphic();da.insertAfter=-1===da.insertAfter?-1:this._displayIds.get(da.insertAfter);da.displayId=this._displayIds.get(da.attributes[this.uid]);const ea=new B(da.displayId);ea.insertAfter=da.insertAfter;Y.push(ea);U.writeGraphic(ca,T,N.level,this.container.stage.resourceManager)}N=ca.serialize(N.tileInfoView.tileInfo.isWrappable);
return 1!==N.length?new E.TileData:E.TileData.fromVertexData(N[0].message,Y)};ba._abortProcessingGraphic=function(N){this._graphicIdToAbortController.get(N)?.abort()};ba._getNullSymbol=function(N){N=N.geometry;return q.isPolyline(N)?z.errorPolylineSymbol2D:q.isPolygon(N)||q.isExtent(N)?z.errorPolygonSymbol2D:this.defaultPointSymbolEnabled?z.errorPointSymbol2D:null};ba._flipUpdatingGraphics=function(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer);this._updatingGraphicsTimer=
setTimeout(()=>{this._updatingGraphicsTimer=null;this.notifyChange("updating")},160);this.notifyChange("updating")};n._createClass(aa,[{key:"_effectiveRenderer",get:function(){return"function"===typeof this.renderer?this.renderer():this.renderer}},{key:"updating",get:function(){return!this._attached||null!==this._updatingGraphicsTimer||0<this._pendingUpdate.added.size||0<this._pendingUpdate.removed.size||0<this._pendingUpdate.updated.size||0<this._tileUpdateSet.size||0<this._tilesToUpdate.size||this._attributeStore?.updatingHandles.updating||
this._processing}}]);return aa}(h.IdentifiableMixin(u.HandleOwnerMixin(F)));l.__decorate([a.property()],F.prototype,"_effectiveRenderer",null);l.__decorate([a.property({constructOnly:!0})],F.prototype,"requestUpdateCallback",void 0);l.__decorate([a.property()],F.prototype,"container",void 0);l.__decorate([a.property({constructOnly:!0})],F.prototype,"graphics",void 0);l.__decorate([a.property()],F.prototype,"renderer",void 0);l.__decorate([a.property()],F.prototype,"updating",null);l.__decorate([a.property()],
F.prototype,"view",void 0);l.__decorate([a.property()],F.prototype,"updateRequested",void 0);l.__decorate([a.property()],F.prototype,"defaultPointSymbolEnabled",void 0);return F=l.__decorate([g.subclass("esri.views.2d.layers.support.GraphicsView2D")],F)})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),function(n,l,F,D,A,
u,m,h){function f(v,y){if(null==v)return null;var w=v.spatialReference,z=h.getInfo(w);v="toJSON"in v?v.toJSON():v;if(!z)return v;w=h.isWebMercator(w)?102100:4326;const r=m.cutParams[w].maxX,C=m.cutParams[w].minX;if(u.isPoint(v))return c(v,r,C);if(u.isMultipoint(v))v.points=v.points.map(x=>c(x,r,C));else{if(u.isExtent(v))return d(v,z);if(u.isPolygon(v)||u.isPolyline(v)){w=D.getBoundsXY(q,v);z=w[0];w=w[2];const x=2*m.offsetMagnitude(z,C)*r;v=0===x?v:m.updatePolyGeometry(v,x);z+=x;w+=x;return w>r?k(v,
r,y):z<C?k(v,C,y):v}}return v}function d(v,y){if(!y)return v;const w=a(v,y).map(z=>z.extent);return 2>w.length?w[0]||v:2<w.length?(v.xmin=y.valid[0],v.xmax=y.valid[1],v):{rings:w.map(z=>[[z.xmin,z.ymin],[z.xmin,z.ymax],[z.xmax,z.ymax],[z.xmax,z.ymin],[z.xmin,z.ymin]])}}function c(v,y,w){if(Array.isArray(v)){var z=v[0];z>y?(w=m.offsetMagnitude(z,y),v[0]=z+-2*w*y):z<w&&(y=m.offsetMagnitude(z,w),v[0]=z+-2*y*w)}else z=v.x,z>y?(w=m.offsetMagnitude(z,y),v.x+=-2*w*y):z<w&&(y=m.offsetMagnitude(z,w),v.x+=
-2*y*w);return v}function a(v,y){const w=[],{ymin:z,ymax:r,xmin:C,xmax:x}=v;var E=v.xmax-v.xmin;const [B,G]=y.valid,{x:H,frameId:I}=b(v.xmin,y),{x:J,frameId:L}=b(v.xmax,y);v=H===J&&0<E;if(E>2*G){E={xmin:C<x?H:J,ymin:z,xmax:G,ymax:r};v={xmin:B,ymin:z,xmax:C<x?J:H,ymax:r};y={xmin:0,ymin:z,xmax:G,ymax:r};const K={xmin:B,ymin:z,xmax:0,ymax:r},S=[],W=[];g(E,y)&&S.push(I);g(E,K)&&W.push(I);g(v,y)&&S.push(L);g(v,K)&&W.push(L);for(let X=I+1;X<L;X++)S.push(X),W.push(X);w.push(new p(E,[I]),new p(v,[L]),new p(y,
S),new p(K,W))}else H>J||v?w.push(new p({xmin:H,ymin:z,xmax:G,ymax:r},[I]),new p({xmin:B,ymin:z,xmax:J,ymax:r},[L])):w.push(new p({xmin:H,ymin:z,xmax:J,ymax:r},[I]));return w}function b(v,y){const [w,z]=y.valid;y=2*z;var r=0;v>z?(r=Math.ceil(Math.abs(v-z)/y),v-=r*y):v<w&&(r=Math.ceil(Math.abs(v-w)/y),v+=r*y,r=-r);return{x:v,frameId:r}}function g(v,y){const {xmin:w,ymin:z,xmax:r,ymax:C}=y;return e(v,w,z)&&e(v,w,C)&&e(v,r,C)&&e(v,r,z)}function e(v,y,w){return y>=v.xmin&&y<=v.xmax&&w>=v.ymin&&w<=v.ymax?
!0:!1}function k(v,y,w=!0){const z=!u.isPolyline(v);z&&A.closeRings(v);if(w)return(new t).cut(v,y);w=z?v.rings:v.paths;const r=z?4:2,C=w.length;y*=-2;for(let x=0;x<C;x++){const E=w[x];if(E&&E.length>=r){const B=[];for(const G of E)B.push([G[0]+y,G[1]]);w.push(B)}}z?v.rings=w:v.paths=w;return v}let p=l._createClass(function(v,y){this.extent=v;this.frameIds=y});const q=F.create();let t=function(){function v(){this._linesIn=[];this._linesOut=[]}var y=v.prototype;y.cut=function(w,z){this._xCut=z;if(w.rings)this._closed=
!0,z=w.rings,this._minPts=4;else if(w.paths)this._closed=!1,z=w.paths,this._minPts=2;else return null;for(var r of z)if(r&&!(r.length<this._minPts)){z=!0;for(const C of r)z?(this.moveTo(C),z=!1):this.lineTo(C);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();z=[];for(const C of this._linesIn)C&&C.length>=this._minPts&&z.push(C);r=-2*this._xCut;for(const C of this._linesOut)if(C&&C.length>=this._minPts){for(const x of C)x[0]+=r;z.push(C)}this._closed?w.rings=z:w.paths=z;return w};
y.moveTo=function(w){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(w[0]);this._moveTo(w[0],w[1],this._prevSide);this._firstPt=this._prevPt=w};y.lineTo=function(w){const z=this._side(w[0]);if(-1===z*this._prevSide){const r=this._intersect(this._prevPt,w);this._lineTo(this._xCut,r,0);this._prevSide=0}this._lineTo(w[0],w[1],z);this._prevSide=z;this._prevPt=w};y.close=function(){const w=this._firstPt,z=this._prevPt;w[0]===z[0]&&w[1]===z[1]||this.lineTo(w);this._checkClosingPt(this._lineIn);
this._checkClosingPt(this._lineOut)};y._moveTo=function(w,z,r){this._closed?(this._lineIn.push([0>=r?w:this._xCut,z]),this._lineOut.push([0<=r?w:this._xCut,z])):(0>=r&&this._lineIn.push([w,z]),0<=r&&this._lineOut.push([w,z]))};y._lineTo=function(w,z,r){this._closed?(this._addPolyVertex(this._lineIn,0>=r?w:this._xCut,z),this._addPolyVertex(this._lineOut,0<=r?w:this._xCut,z)):0>r?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([w,z])):0<r?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([w,
z])):0>this._prevSide?(this._lineIn.push([w,z]),this._lineOut.push([w,z])):0<this._prevSide&&(this._lineOut.push([w,z]),this._lineIn.push([w,z]))};y._addPolyVertex=function(w,z,r){const C=w.length;1<C&&w[C-1][0]===z&&w[C-2][0]===z?w[C-1][1]=r:w.push([z,r])};y._checkClosingPt=function(w){const z=w.length;3<z&&w[0][0]===this._xCut&&w[z-2][0]===this._xCut&&w[1][0]===this._xCut&&(w[0][1]=w[z-2][1],w.pop())};y._side=function(w){return w<this._xCut?-1:w>this._xCut?1:0};y._intersect=function(w,z){return w[1]+
(this._xCut-w[0])/(z[0]-w[0])*(z[1]-w[1])};y._pushLineIn=function(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]};y._pushLineOut=function(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]};return l._createClass(v)}();n.CutVertical=t;n.normalizeCentralMeridianForDisplay=function(v){return f(v,!1)};n.normalizeCentralMeridianSync=function(v){return f(v,!0)};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(n,l,F,D,A,u,m){function h(e,k){if(!k)return null;if("x"in k){var p={x:0,y:0};[p.x,p.y]=e(k.x,k.y,c);null!=k.z&&(p.z=k.z);null!=k.m&&(p.m=k.m);return p}return"xmin"in
k?(p={xmin:0,ymin:0,xmax:0,ymax:0},[p.xmin,p.ymin]=e(k.xmin,k.ymin,c),[p.xmax,p.ymax]=e(k.xmax,k.ymax,c),k.hasZ&&(p.zmin=k.zmin,p.zmax=k.zmax,p.hasZ=!0),k.hasM&&(p.mmin=k.mmin,p.mmax=k.mmax,p.hasM=!0),p):"rings"in k?{rings:f(k.rings,e),hasM:k.hasM,hasZ:k.hasZ}:"paths"in k?{paths:f(k.paths,e),hasM:k.hasM,hasZ:k.hasZ}:"points"in k?{points:d(k.points,e),hasM:k.hasM,hasZ:k.hasZ}:null}function f(e,k){const p=[];for(const q of e)p.push(d(q,k));return p}function d(e,k){const p=[];for(const q of e)e=k(q[0],
q[1],[0,0]),p.push(e),2<q.length&&e.push(q[2]),3<q.length&&e.push(q[3]);return p}const c=[0,0],a=h.bind(null,m.lngLatToXY),b=h.bind(null,m.xyToLngLat),g=new (function(){function e(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var k=e.prototype;k.push=async function(p,q,t){if(!(p&&p.length&&q&&t)||u.equals(q,t))return p;const v={geometries:p,inSpatialReference:q,outSpatialReference:t,resolve:null};this._jobs.push(v);return new Promise(y=>{v.resolve=y;null===this._timer&&(this._timer=
setTimeout(this._process,10))})};k._process=function(){this._timer=null;const p=this._jobs.shift();if(p){var {geometries:q,inSpatialReference:t,outSpatialReference:v,resolve:y}=p;m.canProject(t,v)?u.isWebMercator(v)?y(q.map(a)):y(q.map(b)):y(D.projectMany(A.jsonAdapter,q,t,v,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return l._createClass(e)}());n.checkProjectionSupport=async function(e,k){e&&k&&(e=Array.isArray(e)?e.map(p=>null!=p.geometry?p.geometry.spatialReference:
null).filter(F.isSome):[e],await D.initializeProjection(e.map(p=>({source:p,dest:k}))))};n.project=function(e,k,p,q){if(!e)return e;p||(p=k,k=e.spatialReference);return u.isValid(k)&&u.isValid(p)&&!u.equals(k,p)?m.canProject(k,p)?(e=u.isWebMercator(p)?a(e):b(e),e.spatialReference=p,e):D.projectMany(A.jsonAdapter,[e],k,p,null,q)[0]:e};n.projectMany=function(e,k,p){return g.push(e,k,p)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=l._createClass(function(h,f,d){this.x=h;this.y=f;this.spatialReference=d;this.m=this.z=void 0}),D=l._createClass(function(h,f,d,c){this.rings=h;this.spatialReference=f;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}),A=l._createClass(function(h,f,d,c){this.paths=h;this.spatialReference=f;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}),u=l._createClass(function(h,f,d,c){this.points=h;this.spatialReference=f;
this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}),m=l._createClass(function(h,f,d,c,a){this.xmin=h;this.ymin=f;this.xmax=d;this.ymax=c;this.spatialReference=a;this.mmax=this.mmin=this.zmax=this.zmin=void 0});n.jsonAdapter={convertToGEGeometry:function(h,f){return null==f?null:h.convertJSONToGeometry(f)},exportPoint:function(h,f,d){d=new F(h.getPointX(f),h.getPointY(f),d);const c=h.hasZ(f),a=h.hasM(f);c&&(d.z=h.getPointZ(f));a&&(d.m=h.getPointM(f));return d},exportPolygon:function(h,f,
d){return new D(h.exportPaths(f),d,h.hasZ(f),h.hasM(f))},exportPolyline:function(h,f,d){return new A(h.exportPaths(f),d,h.hasZ(f),h.hasM(f))},exportMultipoint:function(h,f,d){return new u(h.exportPoints(f),d,h.hasZ(f),h.hasM(f))},exportExtent:function(h,f,d){var c=h.hasZ(f);const a=h.hasM(f);d=new m(h.getXMin(f),h.getYMin(f),h.getXMax(f),h.getYMax(f),d);c&&(c=h.getZExtent(f),d.zmin=c.vmin,d.zmax=c.vmax);a&&(h=h.getMExtent(f),d.mmin=h.vmin,d.mmax=h.vmax);return d}};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/GraphicTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./DirtyMap ./DisplayRecordStore ./WGLBuffers ./WGLTile".split(" "),function(n,l,F,D,A,u){u=function(m){function h(){var d=m.apply(this,arguments)||this;d._data=null;d._displayList=null;d._lastCommitTime=0;d._hasData=!1;d._invalidated=!1;d._wglBuffers=null;d._dirtyMap=new F;return d}l._inherits(h,m);var f=h.prototype;f.destroy=function(){l._get(l._getPrototypeOf(h.prototype),
"destroy",this).call(this);this.clear()};f.getGeometry=function(d){return this._wglBuffers&&this._wglBuffers.has(d)?this._wglBuffers.get(d):null};f.getDisplayList=function(){return this._displayList};f.patch=function(d){if(!0===d.clear)this.clear(),this._hasData=!1;else{var c=d.addOrUpdate,a=d.remove;!this._data&&c&&c.tileDisplayData?.displayObjects.length?(c.tileDisplayData.computeDisplayList(),this._dirtyMap=new F,this._dispRecStore=D.fromTileData(c,this._dirtyMap),this._data=c,this._dirtyMap.markAllDirty(),
this._hasData=!0,d.end&&this.ready()):this._data?c&&c.tileDisplayData?.displayObjects.length||a.length?this._doPatchData(d):d.end&&this.ready():d.end&&this.ready();d.end&&!this._data&&this.clear();this.requestRender();this.emit("change")}};f.commit=function(d){if(!d.time||d.time!==this._lastCommitTime)if(this._lastCommitTime=d.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new A(d.context)),this._dirtyMap.hasDirty()||this._invalidated))this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,
this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean()};f.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)};f._doPatchData=function(d){this._invalidated=!0;this._patchData(d)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=D.fromTileData(this._data,this._dirtyMap));
this.requestRender()};f._patchData=function(d){let c=!0;var a=d.addOrUpdate&&d.addOrUpdate.tileDisplayData&&d.addOrUpdate.tileDisplayData.displayObjects||[],b=(d.remove||[]).slice();for(var g of a)null!=g.insertAfter&&b.push(g.id);let e;0<b.length&&(e=new Set(b));g=this._data.tileDisplayData;for(var k of b)if(b=g.displayObjectRegistry.get(k)){g.displayList.removeFromList(b.displayRecords);for(var p of b.displayRecords)this._dispRecStore.delete(p);g.displayObjectRegistry.delete(k)}e?.size&&(g.displayObjects=
g.displayObjects.filter(w=>!e.has(w.id)));for(const w of a){a=g.displayObjectRegistry.get(w.id);let z;if(a){k=a.displayRecords;a.set(w);a.displayRecords=k;k=a.displayRecords.length;for(p=0;p<k;++p){b=a.displayRecords[p];var q=w.displayRecords[p];if(p>=w.displayRecords.length||b.geometryType!==q.geometryType||b.symbolLevel!==q.symbolLevel||b.zOrder!==q.zOrder||b.materialKey!==q.materialKey)this._dispRecStore.delete(a.displayRecords[p]),p<w.displayRecords.length&&(a.displayRecords[p]=void 0)}a.displayRecords.length=
w.displayRecords.length}else if(a=w.copy(),a.displayRecords=[],g.displayObjectRegistry.set(w.id,a),k=g.displayObjects,null!=a.insertAfter?(z={},0<=a.insertAfter?(p=g.displayObjectRegistry.get(a.insertAfter))?(q=k.indexOf(p)+1,q<k.length?k.splice(q,0,a):(k.push(a),q=k.length)):(k.push(a),q=k.length):(k.unshift(a),q=0)):(k.push(a),q=k.length),z)for(p=0<w.displayRecords.length?1:0,b=0,--q;0<=q&&b<p;--q)for(var t=k[q].displayRecords.length-1;0<=t&&b<p;--t){var v=k[q].displayRecords[t],y=g.displayList.getDPInfoType();
z[y]||(z[y]=v,++b)}k=w.displayRecords.length;for(p=0;p<k;++p){b=w.displayRecords[p];(q=a.displayRecords[p])?(q.meshData=b.meshData,q.materialKey=b.materialKey):(q=b.copy(),q.vertexFrom=void 0,q.indexFrom=void 0,a.displayRecords[p]=q);v=b.geometryType;t=g.displayList.getDPInfoType();y=d.addOrUpdate.tileBufferData.geometries[v];v=y.vertexBuffer;y=y.indexBuffer;let r=void 0;z&&(r=z[t]?g.displayList.splitAfter(z[t]):-1);c=this._dispRecStore.setMeshData(q,b,v,y,r)&&c;z&&null!=q.indexFrom&&null!=q.indexFrom&&
(z[t]=q)}}return c};l._createClass(h,[{key:"hasData",get:function(){return!!this._hasData}},{key:"displayObjects",get:function(){return this._displayObjects??[]}}]);return h}(u.WGLTile);n.GraphicTile=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(){this._dirties=[{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,
vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1}]}var F=l.prototype;F.hasDirty=function(){return this._dirties.some(D=>-1!==D.indexCount||D.allDirty)};F.markAllClean=function(){for(const D of this._dirties)D.indexFrom=-1,D.indexCount=-1,D.vertexFrom=-1,D.vertexCount=-1,D.allDirty=!1};
F.markAllDirty=function(){for(const D of this._dirties)D.allDirty=!0};F.forEach=function(D){for(let A=0;A<this._dirties.length;++A){const {indexCount:u,indexFrom:m,vertexCount:h,vertexFrom:f,allDirty:d}=this._dirties[A],c={};let a=void 0,b=!1;if(d||-1!==f&&0<h)c.geometry={count:h,from:f,allDirty:d},b=!0;if(d||-1!==m&&0<u)a={count:u,from:m,allDirty:d},b=!0;b&&D({indices:a,vertices:c},A)}};F.markDirtyIndices=function(D,A,u){D=this._dirties[D];if(!D.allDirty)if(-1!==D.indexCount){const m=Math.min(D.indexFrom,
A);A=Math.max(D.indexFrom+D.indexCount,A+u)-m;D.indexFrom=m;D.indexCount=A}else D.indexFrom=A,D.indexCount=u};F.markDirtyVertices=function(D,A,u,m){D=this._dirties[D];D.allDirty||(-1!==D.vertexCount?(A=Math.min(D.vertexFrom,u),u=Math.max(D.vertexFrom+D.vertexCount,u+m)-A,D.vertexFrom=A,D.vertexCount=u):(D.vertexFrom=u,D.vertexCount=m))};return n._createClass(l)}()})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has",
"./FreeList","./Utils"],function(n,l,F,D){const A=["FILL","LINE","MARKER","TEXT","LABEL"];return function(){function u(h,f,d,c){this._strides=h;this._displayList=f;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=d;for(const a in h){this._freeListsAndStorage[a]={vtxFreeList:c?new F.FreeList(c):null,idxFreeList:c?new F.FreeList(c):null,vertexBuffers:{},indexBuffer:c?new Uint32Array(c):null};for(const b in h[a])this._freeListsAndStorage[a].vertexBuffers[b]={data:c?D.allocateTypedArrayBuffer(c,
h[a][b]):null,stride:h[a][b]}}}u.fromTileData=function(h,f){var d=h.getStrides(),c={};for(var a=0;a<d.length;a++)c[A[a]]=d[a];d=[0,0,0,0,0];a=[0,0,0,0,0];for(var b of h.tileDisplayData.displayObjects)for(var g of b.displayRecords)d[g.geometryType]=Math.max(d[g.geometryType],g.vertexFrom+g.vertexCount),a[g.geometryType]=Math.max(a[g.geometryType],g.indexFrom+g.indexCount);f=new u(c,h.tileDisplayData.displayList,f,void 0);h=h.tileBufferData?.geometries??[];for(c=0;c<h.length;++c){b=d[c];var e=a[c],
k=h[c];g=f._storageFor(A[c]);var p=h[c].indexBuffer;g.indexBuffer=p;g.idxFreeList=new F.FreeList(p.length);g.idxFreeList.allocate(e);e=0;for(const q in k.vertexBuffer)k=h[c].vertexBuffer[q],g.vertexBuffers[q].data=k.data,g.vertexBuffers[q].stride=k.stride,p=D.strideToPackingFactor(k.stride),k=k.data.length*p/k.stride,e||(e=k);g.vtxFreeList=new F.FreeList(e);g.vtxFreeList.allocate(b)}return f};var m=u.prototype;m.delete=function(h){const f=A[h.geometryType];this._freeVertices(f,h.vertexFrom,h.vertexCount);
this._freeIndices(f,h.indexFrom,h.indexCount);this._displayList.removeFromList(h);h.vertexFrom=void 0;h.indexFrom=void 0};m.setMeshData=function(h,f,d,c,a){const b=A[h.geometryType];h.meshData=null;let g=void 0,e=void 0;void 0===h.vertexFrom?(e=f.vertexCount,g=this._allocateVertices(b,e)):f.vertexCount>h.vertexCount?(this._freeVertices(b,h.vertexFrom,h.vertexCount),e=f.vertexCount,g=this._allocateVertices(b,e)):f.vertexCount===h.vertexCount?(g=h.vertexFrom,e=h.vertexCount):(this._freeVertices(b,h.vertexFrom+
f.vertexCount,h.vertexCount-f.vertexCount),g=h.vertexFrom,e=f.vertexCount);let k=!0,p=void 0,q=void 0,t=void 0;void 0===h.indexFrom?(p=a,t=f.indexCount,q=this._allocateIndices(b,t)):f.indexCount>h.indexCount?(p=this._displayList.removeFromList(h),this._freeIndices(b,h.indexFrom,h.indexCount),t=f.indexCount,q=this._allocateIndices(b,t)):f.indexCount===h.indexCount?(k=!1,q=h.indexFrom,t=h.indexCount):(p=this._displayList.removeFromList(h),this._freeIndices(b,h.indexFrom+f.indexCount,h.indexCount-f.indexCount),
q=h.indexFrom,t=f.indexCount);if(-1!==g&&-1!==q){a=this._storageFor(b);D.copyMeshData(g,q,a.vertexBuffers,a.indexBuffer,f,d,c);h.vertexFrom=g;h.indexFrom=q;h.vertexCount=f.vertexCount;h.indexCount=f.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(h.geometryType,h.indexFrom,h.indexCount);for(const v in d)this._dirtyMap.markDirtyVertices(h.geometryType,v,h.vertexFrom,h.vertexCount)}k&&this._displayList.addToList(h,p);return!0}-1!==g&&this._freeVertices(b,g,e);-1!==q&&this._freeIndices(b,
q,t);h.setMeshDataFromBuffers(f,d,c);h.vertexFrom=void 0;h.vertexCount=0;h.indexFrom=void 0;h.indexCount=0;return!1};m.tryAddMeshData=function(h,f){const d=f.vertexBuffer;f=f.indexBuffer;var c=A[h.geometryType];const a=this._allocateVertices(c,h.vertexCount);if(-1===a)return this._freeVertices(c,a,h.vertexCount),!1;const b=this._allocateIndices(c,h.indexCount);if(-1===b)return this._freeVertices(c,a,h.vertexCount),this._freeIndices(c,b,h.indexCount),!1;c=this._storageFor(c);D.copyMeshData(a,b,c.vertexBuffers,
c.indexBuffer,h,d,f);h.vertexFrom=a;h.indexFrom=b;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(h.geometryType,h.indexFrom,h.indexCount);for(const g in d)this._dirtyMap.markDirtyVertices(h.geometryType,g,a,h.vertexCount)}this._displayList.addToList(h);return!0};m._allocateVertices=function(h,f){h=this._storageFor(h);f=h.vtxFreeList?.allocate(f);if(null==f||-1===f)return-1;h=h.vtxFreeList?.fragmentation;return null==h||.5<h?-1:f};m._freeVertices=function(h,f,d){this._storageFor(h).vtxFreeList?.free(f,
d)};m._freeIndices=function(h,f,d){this._storageFor(h).idxFreeList?.free(f,d)};m._allocateIndices=function(h,f){h=this._storageFor(h);f=h.idxFreeList?.allocate(f);if(null==f||-1===f)return-1;h=h.idxFreeList?.fragmentation;return null==h||.5<h?-1:f};m._storageFor=function(h){return this._freeListsAndStorage[h]};m._stridesFor=function(h,f){return this._strides[h][f]};return n._createClass(u)}()})},"esri/views/2d/engine/webgl/FreeList":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(n,l){let F=function(){function A(m){this._largestRange=null;this._parent=m;this._updateLargestRange()}var u=A.prototype;u.rangeCreated=function(m){if(!this._largestRange||m.count>this._largestRange.count)this._largestRange=m};u.rangeResized=function(m,h){if(m===this._largestRange)m.count<h&&this._updateLargestRange();else if(!this._largestRange||m.count>this._largestRange.count)this._largestRange=m};u.findBestRange=function(m){let h=this._parent._freeHead,f=null;for(;null!==h;)h.count>=m&&
(!f||h.count-m<f.count-m)&&(f=h),h=h.next;return f};u.findAdjacentRanges=function(m,h){let f=!0,d=!1,c=null,a=this._parent._freeHead;for(;f&&!d;){const b=null!==a?a.from:this._parent._size;m>=(null!==c?c.from+c.count:0)&&m+h<=b?(f=!1,d=!0):null!==a?(c=a,a=a.next):f=!1}return[c,a]};u._updateLargestRange=function(){let m=null,h=this._parent._freeHead;for(;null!==h;){if(!m||h.count>m.count)m=h;h=h.next}this._largestRange=m};l._createClass(A,[{key:"largestRange",get:function(){return this._largestRange}}]);
return A}(),D=function(){function A(m,h){this._allocated=0;this._size=m;this._freeHead=0<m?{from:0,count:m,prev:null,next:null}:null;this._bookKeeper=h||new F(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}var u=A.prototype;u.allocate=function(m){const h=this._bookKeeper.findBestRange(m);if(null==h)return-1;const f=h.from,d=h.count;h.from+=m;h.count-=m;this._bookKeeper.rangeResized(h,f,d);this._allocated+=m;0===h.count&&(m=null!==h.prev?this._freeHead:h.next,A._removeRange(h),
this._freeHead=m);return f};u.free=function(m,h){const [f,d]=this._bookKeeper.findAdjacentRanges(m,h);m={from:m,count:h,prev:f??null,next:d??null};null!=f&&(f.next=m);null!=d&&(d.prev=m);this._bookKeeper.rangeCreated(m);this._allocated-=h;if(null!=d&&m.from+m.count===d.from){h=m.from;var c=m.count;A._fuse(m,d);A._removeRange(d);this._bookKeeper.rangeResized(m,h,c);this._bookKeeper.rangeResized(d,void 0,0)}null!=f&&f.from+f.count===m.from&&(h=f.from,c=f.count,A._fuse(f,m),A._removeRange(m),this._bookKeeper.rangeResized(f,
h,c),this._bookKeeper.rangeResized(m,void 0,0));this._freeHead=null!==m.prev?this._freeHead:m};A._removeRange=function(m){null!==m.prev?null!==m.next?(m.prev.next=m.next,m.next.prev=m.prev):m.prev.next=null:null!==m.next&&(m.next.prev=null)};A._fuse=function(m,h){m.count+=h.count;m.next=h.next;h.from+=h.count;h.count=0;null!==h.next&&(h.next.prev=m)};l._createClass(A,[{key:"fragmentation",get:function(){const m=this._size-this._allocated;return 0===m?0:1-this._bookKeeper.largestRange.count/m}}]);
return A}();n.FreeList=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(n,l,F,D,A){return function(){function u(h){this.geometryMap=l.createGeometryData(()=>({indexBuffer:F.BufferObject.createIndex(h,D.Usage.STATIC_DRAW),vao:null}),(f,d)=>({vertexBuffer:F.BufferObject.createVertex(h,
l.C_VBO_INFO[d])}))}var m=u.prototype;m.dispose=function(){for(let h=0;5>h;h++){const f=this.geometryMap[h];if(f){f.data.vao?.disposeVAOOnly();f.data.indexBuffer?.dispose();for(const d in f.buffers)f.buffers[d]?.data.vertexBuffer.dispose()}}};m.get=function(h){const f=this.geometryMap[h];return{getVAO(d,c,a){if(!f.data.vao){const b={};for(const g in f.buffers)b[g]=f.buffers[g].data.vertexBuffer;f.data.vao=new A.VertexArrayObject(d,a,c,b,f.data.indexBuffer)}return f.data.vao}}};m.has=function(h){return null!=
this.geometryMap[h]};m.upload=function(h,f){f.forEach((d,c)=>{this._upload(d,c,h)})};m._upload=function(h,f,d){h.indices&&(h.indices.allDirty?this._uploadIndices(d,f):null!=h.indices.from&&null!=h.indices.count&&this._uploadIndices(d,f,h.indices.from,h.indices.count));if(h.vertices){h=h.vertices;for(const c in h){const a=h[c];a.allDirty?this._uploadVertices(d,f,c):null!=a.from&&null!=a.count&&this._uploadVertices(d,f,c,a.from,a.count)}}};m._uploadVertices=function(h,f,d,c,a){const b=this.geometryMap[f];
if(b&&(h=h.geometries[f].vertexBuffer[d])){var {data:g,stride:e}=h;b.buffers[d]&&0<g.length&&(h=e/g.BYTES_PER_ELEMENT,null!=c&&null!=a?b.buffers[d].data.vertexBuffer.setSubData(g,c*h,c*h,(c+a)*h):b.buffers[d].data.vertexBuffer.setData(g))}};m._uploadIndices=function(h,f,d,c){const a=this.geometryMap[f];a&&(h=h.geometries[f].indexBuffer,a.data.indexBuffer&&0<h.length&&(null!=d&&null!=c?a.data.indexBuffer.setSubData(h,d,d,d+c):a.data.indexBuffer.setData(h)))};return n._createClass(u)}()})},"esri/views/2d/engine/webgl/WGLTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat2d ../../../../chunks/mat2df32 ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./definitions ./TiledDisplayObject".split(" "),
function(n,l,F,D,A,u,m,h){let f=function(){function d(){}var c=d.prototype;c.acquire=function(a){return{refCount:1,version:-1,labelMat2d:D.create(),tileMat3:u.create(),dvs:u.create()}};c.release=function(a){};return l._createClass(d)}();h=function(d){function c(b,g,e,k){return d.call(this,b,g,e,k,m.TILE_SIZE,m.TILE_SIZE)||this}l._inherits(c,d);var a=c.prototype;a.destroy=function(){l._get(l._getPrototypeOf(c.prototype),"destroy",this).call(this);this._transforms&&c.TransformCache.release(this.key.hash)};
a.setTransform=function(b){var g=this.resolution/b.resolution,e=this.transforms.tileMat3;const [k,p]=b.toScreenNoRotation([0,0],[this.x,this.y]);var q=this.width/this.rangeX*g;g*=this.height/this.rangeY;A.set(e,q,0,0,0,g,0,k,p,1);A.multiply(this.transforms.dvs,b.displayViewMat3,e);e=this.transforms.labelMat2d;const t=window.devicePixelRatio;q=F.set(D.create(),q*t,0,0,g*t,k*t,p*t);F.multiply(e,b.viewMat2d,q)};a._createTransforms=function(){return c.TransformCache.acquire(this.key.hash)};return l._createClass(c)}(h.TiledDisplayObject);
h.TransformCache=new f;n.WGLTile=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(n,l,F,D,A){D=function(u){function m(f,d,c,a,b,g,e=b,k=g){var p=u.call(this)||this;p.triangleCountReportedInDebug=0;p.triangleCount=0;p.texture=null;p.key=new A(f);p.resolution=d;p.x=c;p.y=a;p.width=b;
p.height=g;p.rangeX=e;p.rangeY=k;return p}l._inherits(m,u);var h=m.prototype;h.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};h.setTransform=function(f){const d=this.resolution/(f.resolution*f.pixelRatio),c=this.transforms.tileMat3,[a,b]=f.toScreenNoRotation([0,0],[this.x,this.y]);F.set(c,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,a,b,1);F.multiply(this.transforms.dvs,f.displayViewMat3,c)};return l._createClass(m)}(D.DisplayObject);n.TiledDisplayObject=
D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileData":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ./enums ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./WGLDisplayRecord ./cpuMapped/DisplayRecordReader ./mesh/VertexBuffer ./mesh/VertexVector ./util/Writer".split(" "),function(n,l,F,D,A,u,m,h,f,d,c,a,b){const g=new A,e=new A;A=function(){function k(){this.tileBufferData=this.tileDisplayData=
null}var p=k.prototype;p.reshuffle=function(){g.reset();if(this.tileDisplayData){var q=[[],[],[],[],[]],t=this.tileDisplayData.displayObjects;for(var v of t)for(var y of v.displayRecords)q[y.geometryType].push(y);for(var w of q)for(var z of w)z&&g.needMore(z.geometryType,z.meshData?z.meshData.vertexCount:z.vertexCount,z.meshData?z.meshData.indexData.length:z.indexCount);t=q.length;v=new u;for(y=0;y<t;++y)if(v.geometries[y].indexBuffer=new Uint32Array(Math.round(F.ReallocGrowthFactor*g.indicesFor(y))),
z=[],w=this.tileBufferData?.geometries[y].vertexBuffer){for(var r in w)z.push(w[r].stride);z=k._computeVertexAlignment(z);var C=Math.round(F.ReallocGrowthFactor*g.verticesFor(y));z=k._align(C,z);for(var x in w)C=w[x].stride,v.geometries[y].vertexBuffer[x]={stride:C,data:h.allocateTypedArrayBuffer(z,C)}}e.reset();this.tileDisplayData.displayList?.clear();for(r=0;r<t;++r){x=q[r];for(const G of x){if(G.meshData)G.writeMeshDataToBuffers(e.verticesFor(r),v.geometries[r].vertexBuffer,e.indicesFor(r),v.geometries[r].indexBuffer),
G.meshData=null;else if(y=this.tileBufferData?.geometries[r]){x=y.vertexBuffer;y=y.indexBuffer;w=v.geometries[r].vertexBuffer;z=v.geometries[r].indexBuffer;C=e.verticesFor(r);const H=e.indicesFor(r);h.copyMeshData(C,H,w,z,G,x,y);G.vertexFrom=C;G.indexFrom=H}e.needMore(r,G.vertexCount,G.indexCount)}}var {displayList:E,displayObjects:B}=this.tileDisplayData;if(E)for(const G of B)E.addToList(G.displayRecords);this.tileBufferData=v}};p.getStrides=function(){const q=[],t=this.tileBufferData?.geometries;
if(!t)return q;for(let v=0;v<t.length;++v){const y=t[v];q[v]={};for(const w in y.vertexBuffer)q[v][w]=y.vertexBuffer[w].stride}return q};p.clone=function(){const q=new k;q.tileBufferData=this.tileBufferData?.clone()??null;q.tileDisplayData=this.tileDisplayData?.clone()??null;return q};p._guessSize=function(){const q=this.tileDisplayData?.displayObjects??[],t=Math.min(q.length,4);let v=0;for(let y=0;y<t;y++)v=Math.max(v,q[y].displayRecords.length);return 2*(12*q.length+q.length*v*40)};p.serialize=
function(){const q=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),v=this.tileDisplayData.serialize(new b(Int32Array,this._guessSize())).buffer();t.push(v);return{result:{displayData:v,bufferData:q},transferList:t}};k.fromVertexData=function(q,t){const v={},y=new Map;for(const w of t)y.set(w.id,w);h.forEachGeometryType(w=>{const z=q.data[w];if(null!=z){const C=d.DisplayRecordReader.from(z.records).getCursor();for(;C.next();){var r=C.id;const x=C.materialKey,E=C.indexFrom,B=C.indexCount,
G=C.vertexFrom,H=C.vertexCount,I=y.get(r);r=new f(r,w,x);r.indexFrom=E;r.indexCount=B;r.vertexFrom=G;r.vertexCount=H;I.displayRecords.push(r)}v[w]=c.VertexBuffers.fromVertexData(z,w)}else v[w]=(new a.VertexVectors(w,0,D.WGLSymbologyType.DEFAULT)).intoBuffers()});return k.fromMeshData({displayObjects:t,vertexBuffersMap:v})};k.fromMeshData=function(q){const t=new k,v=new m,y=new u;v.displayObjects=q.displayObjects;for(const w in q.vertexBuffersMap){const z=w,r=q.vertexBuffersMap[z];y.geometries[z].indexBuffer=
r.indexBuffer;y.geometries[z].vertexBuffer=r.namedBuffers}t.tileDisplayData=v;t.tileBufferData=y;return t};k.bind=function(q,t){const v=new k;v.tileDisplayData=q;v.tileBufferData=t;return v};k.create=function(q,t){const v=new k;v.tileDisplayData=new m;v.tileDisplayData.displayObjects=q;const y=[0,0,0,0,0],w=[0,0,0,0,0],z=[[],[],[],[],[]];for(var r of q)for(var C of r.displayRecords)z[C.geometryType].push(C),y[C.geometryType]+=C.meshData.vertexCount,w[C.geometryType]+=C.meshData.indexData.length;q=
new u;t=[t.fill||{},t.line||{},t.icon||{},t.text||{},t.label||{}];for(r=0;5>r;r++){C=new Uint32Array(w[r]);var x=t[r],E=y[r];const B={};for(const G in x){const H={data:h.allocateTypedArrayBuffer(E,x[G]),stride:x[G]};B[G]=H}x=B;f.writeAllMeshDataToBuffers(z[r],x,C);q.geometries[r]={indexBuffer:C,vertexBuffer:x}}v.tileBufferData=q;return v};k._align=function(q,t){const v=q%t;return 0===v?q:q+(t-v)};k._computeVertexAlignment=function(q){let t=!1,v=!1;for(const y of q)2===y%4?t=!0:0!==y%4&&(v=!0);return v?
4:t?2:1};return l._createClass(k)}();n.TileData=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(){this._byGeometryType=null}var F=l.prototype;F.reset=function(){this._byGeometryType=null};F.verticesFor=function(D){return this._byGeometryType?this._byGeometryType[D].vertices:0};F.indicesFor=function(D){return this._byGeometryType?
this._byGeometryType[D].indices:0};F.needMore=function(D,A,u){if(A||u)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),D=this._byGeometryType[D],D.vertices+=A,D.indices+=u};n._createClass(l,[{key:"satisfied",get:function(){return!this._byGeometryType}}]);return l}()})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./Utils"],
function(n,l){return function(){function F(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}var D=F.prototype;D.clone=function(){const A=new F;for(let u=0;u<this.geometries.length;u++){const m=this.geometries[u],h=A.geometries[u];h.indexBuffer=m.indexBuffer.slice();h.vertexBuffer={};for(const f in m.vertexBuffer){const {data:d,stride:c}=m.vertexBuffer[f];
h.vertexBuffer[f]={data:d.slice(),stride:c}}}return A};F.deserialize=function(A){const u=new F;for(let m=0;5>m;++m){u.geometries[m].indexBuffer=new Uint32Array(A.geometries[m].indexBuffer);u.geometries[m].vertexBuffer={};for(const h in A.geometries[m].vertexBuffer)u.geometries[m].vertexBuffer[h]={data:l.allocateTypedArrayBufferwithData(A.geometries[m].vertexBuffer[h].data,A.geometries[m].vertexBuffer[h].stride),stride:A.geometries[m].vertexBuffer[h].stride}}return u};D.serialize=function(){const A=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]};for(let u=0;5>u;++u)for(const m in this.geometries[u].vertexBuffer)A.geometries[u].vertexBuffer[m]={data:this.geometries[u].vertexBuffer[m].data.buffer,
stride:this.geometries[u].vertexBuffer[m].stride};return A};D.getBuffers=function(){const A=[];for(let u=0;5>u;++u){A.push(this.geometries[u].indexBuffer.buffer);for(const m in this.geometries[u].vertexBuffer)A.push(this.geometries[u].vertexBuffer[m].data.buffer)}return A};return n._createClass(F)}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./GraphicDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(n,l,
F,D){return function(){function A(){this.displayObjects=[];this._displayList=null}var u=A.prototype;u.computeDisplayList=function(){this._displayList=new l;for(const m of this.displayObjects)for(const h of m.displayRecords)this._displayList.addToList(h)};u.clone=function(){const m=new A;this.displayObjects&&(m.displayObjects=this.displayObjects.map(h=>h.clone()));return m};u.serialize=function(m){D.serializeList(m,this.displayObjects);return m};u._deserializeObjects=function(m){var h=m.readInt32();
h=Array(h);const f=new Map;for(let d=0;d<h.length;++d){const c=F.deserialize(m);h[d]=c;f.set(c.id,c)}this.displayObjects=h;this._displayList=null;this._displayObjectRegistry=f};A.deserialize=function(m){const h=new A;h._deserializeObjects(m);return h};n._createClass(A,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const m of this.displayObjects)this._displayObjectRegistry.set(m.id,m)}return this._displayObjectRegistry}},{key:"displayList",
get:function(){return this._displayList}}]);return A}()})},"esri/views/2d/engine/webgl/GraphicDisplayList":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./materialKey/MaterialKey"],function(n,l){function F(f,d,c,...a){d<f.length?f.splice(d,c,...a):f.push(...a)}let D=function(){function f(){this.symbolLevels=[]}var d=f.prototype;d.replay=function(c,a,b){for(const k of this.symbolLevels)for(const p of k.zLevels){var g=p.geometryDPInfo.unified;if(g)for(const q of g){const {geometryType:t,
materialKey:v,indexFrom:y,indexCount:w}=q;g=l.MaterialKeyBase.load(v).symbologyType;g=c.painter.getBrush(t,g);var e=a.getGeometry(t);e={geometryType:t,materialKey:v,indexFrom:y,indexCount:w,target:e};g.prepareState(c);g.drawGeometry(c,a,e,b)}}};d.clear=function(){this.symbolLevels.length=0};d.addToList=function(c,a){if(Array.isArray(c))for(const b of c)this._addToList(b,a);else this._addToList(c,a)};d.removeFromList=function(c){Array.isArray(c)||(c=[c]);let a=null;for(const b of c)a=this._removeFromList(b);
return a};d.clone=function(){const c=new f;for(const a of this.symbolLevels)c.symbolLevels.push(a.clone());return c};d.splitAfter=function(c){const a=this._getDisplayList(c.symbolLevel,c.zOrder),b=a.length,g=c.indexFrom+c.indexCount;for(let e=0;e<b;++e){const k=a[e];if(k.geometryType===c.geometryType&&g>k.indexFrom&&g<=k.indexFrom+k.indexCount)return g<k.indexFrom+k.indexCount&&(c=new A,c.geometryType=k.geometryType,c.materialKey=k.materialKey,c.indexFrom=g,c.indexCount=k.indexFrom+k.indexCount-g,
a.splice(e+1,0,c),k.indexCount=g-k.indexFrom),e}};d._addToList=function(c,a){const b=this._getDisplayList(c.symbolLevel,c.zOrder);a=null!=a?a:b.length-1;var g=0<=a&&a<b.length?b[a]:null;null!==g&&g.materialKey===c.materialKey&&g.indexFrom+g.indexCount===c.indexFrom&&g.geometryType===c.geometryType?g.indexCount+=c.indexCount:(g=new A,g.indexFrom=c.indexFrom,g.indexCount=c.indexCount,g.materialKey=c.materialKey,g.geometryType=c.geometryType,F(b,a+1,0,g))};d._removeFromList=function(c){const a=this._getDisplayList(c.symbolLevel,
c.zOrder);var b=a.length;let g=void 0;for(var e=0;e<b;++e){var k=a[e];if(c.indexFrom+c.indexCount>k.indexFrom&&c.indexFrom<k.indexFrom+k.indexCount&&k.geometryType===c.geometryType){g=e;break}}if(void 0!==g){b=a[g];if(c.indexFrom===b.indexFrom)return b.indexCount-=c.indexCount,b.indexFrom+=c.indexCount,0===b.indexCount&&F(a,g,1),g-1;if(c.indexFrom+c.indexCount===b.indexFrom+b.indexCount)return b.indexCount-=c.indexCount,0===b.indexCount?(F(a,g,1),g-1):g;e=b.indexFrom;k=c.indexFrom-b.indexFrom;const p=
c.indexCount;c=b.indexFrom+b.indexCount-(c.indexFrom+c.indexCount);b.indexCount=k;const q=new A;q.geometryType=b.geometryType;q.materialKey=b.materialKey;q.indexFrom=e+k+p;q.indexCount=c;F(a,g+1,0,q);return g}return null};d._getDisplayList=function(c,a){let b;var g=this.symbolLevels.length;for(let k=0;k<g;k++)if(this.symbolLevels[k].symbolLevel===c){b=this.symbolLevels[k];break}b||(b=new h,b.symbolLevel=c,this.symbolLevels.push(b));let e;c=b.zLevels.length;for(g=0;g<c;g++)if(b.zLevels[g].zLevel===
a){e=b.zLevels[g];break}e||(e=new m,e.geometryDPInfo=new u,e.zLevel=a,b.zLevels.push(e));e.geometryDPInfo.unified||(e.geometryDPInfo.unified=[]);return e.geometryDPInfo.unified};d.getDPInfoType=function(){return"unified"};n._createClass(f,[{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}}]);return f}(),A=function(){function f(){this.materialKey=null;this.indexCount=this.indexFrom=0}f.prototype.clone=function(){const d=new f;d.geometryType=this.geometryType;d.materialKey=
this.materialKey;d.indexFrom=this.indexFrom;d.indexCount=this.indexCount;return d};return n._createClass(f)}(),u=function(){function f(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}f.prototype.clone=function(){const d=new f;d.fill=this.fill&&this.fill.map(c=>c.clone());d.line=this.line&&this.line.map(c=>c.clone());d.marker=this.marker&&this.marker.map(c=>c.clone());d.text=this.text&&this.text.map(c=>c.clone());d.label=this.label&&this.label.map(c=>c.clone());d.unified=this.unified&&
this.unified.map(c=>c.clone());return d};return n._createClass(f)}(),m=function(){function f(){this.geometryDPInfo=new u}f.prototype.clone=function(){const d=new f;d.zLevel=this.zLevel;d.geometryDPInfo=this.geometryDPInfo.clone();return d};return n._createClass(f)}(),h=function(){function f(){this.zLevels=[]}f.prototype.clone=function(){const d=new f;d.symbolLevel=this.symbolLevel;for(const c of this.zLevels)d.zLevels.push(c.clone());return d};return n._createClass(f)}();return D})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./WGLDisplayRecord","./util/serializationUtils"],function(n,l,F){return function(){function D(u){this.insertAfter=null;this.id=u;this.displayRecords=[]}var A=D.prototype;A.copy=function(){const u=new D(this.id);u.set(this);return u};A.clone=function(){const u=new D(this.id);u.displayRecords=this.displayRecords.map(m=>m.clone());u.insertAfter=this.insertAfter;return u};A.set=function(u){this.id=u.id;this.displayRecords=u.displayRecords;this.insertAfter=u.insertAfter};A.serialize=function(u){u.push(this.id);
F.serializeList(u,this.displayRecords);return u};D.deserialize=function(u){const m=u.readInt32(),h=new D(m);h.displayRecords=F.deserializeList(u,l,{id:m})??[];return h};return n._createClass(D)}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./MeshData","./Utils"],function(n,l,F){return function(){function D(u,m,h,f=0,d=0){this.id=u;this.geometryType=m;this.materialKey=h;this.minZoom=f;this.maxZoom=d;this.meshData=null;this.indexCount=
this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0;this._sortKey=null}var A=D.prototype;A.clone=function(){return this.copy()};A.copy=function(){const u=new D(this.id,this.geometryType,this.materialKey);u.vertexFrom=this.vertexFrom;u.vertexCount=this.vertexCount;u.indexFrom=this.indexFrom;u.indexCount=this.indexCount;u.zOrder=this.zOrder;u.symbolLevel=this.symbolLevel;u.meshData=this.meshData;u.minZoom=this.minZoom;u.maxZoom=this.maxZoom;return u};A.setMeshDataFromBuffers=
function(u,m,h){const f=new l;for(const d in m){const c=m[d].stride,a=m[d].data;if(!a)continue;const b=[],g=F.strideToPackingFactor(c);for(let e=0;e<c*u.vertexCount/g;++e)b[e]=a[e+c*u.vertexFrom/g];f.vertexData.set(d,b)}f.indexData.length=0;for(m=0;m<u.indexCount;++m)f.indexData[m]=h[m+u.indexFrom]-u.vertexFrom;f.vertexCount=u.vertexCount;this.meshData=f};A.readMeshDataFromBuffers=function(u,m){this.meshData?this.meshData.clear():this.meshData=new l;for(const h in u){const f=u[h].stride,d=u[h].data,
c=[],a=F.strideToPackingFactor(f);for(let b=0;b<f*this.vertexCount/a;++b)c[b]=d[b+f*this.vertexFrom/a];this.meshData.vertexData.set(h,c)}this.meshData.indexData.length=0;for(u=0;u<this.indexCount;++u)this.meshData.indexData[u]=m[u+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};A.writeMeshDataToBuffers=function(u,m,h,f){if(this.meshData){for(const d in m){const c=m[d].stride,a=this.meshData.vertexData.get(d),b=m[d].data,g=F.strideToPackingFactor(c);for(let e=0;e<c*this.meshData.vertexCount/
g;++e)b[e+c*u/g]=a[e]}for(m=0;m<this.meshData.indexData.length;++m)f[m+h]=this.meshData.indexData[m]+u;this.vertexFrom=u;this.vertexCount=this.meshData.vertexCount;this.indexFrom=h;this.indexCount=this.meshData.indexData.length}};D.writeAllMeshDataToBuffers=function(u,m,h){let f=0,d=0;for(const c of u)c.writeMeshDataToBuffers(f,m,d,h),f+=c.vertexCount,d+=c.indexCount};A._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};A.serialize=function(u){u.push(this.geometryType);
u.push(this.materialKey);u.push(this.vertexFrom);u.push(this.vertexCount);u.push(this.indexFrom);u.push(this.indexCount);u.push(this.minZoom);u.push(this.maxZoom);return u};D.deserialize=function(u,m){const h=u.readInt32(),f=u.readInt32();m=new D(m.id,h,f);m.vertexFrom=u.readInt32();m.vertexCount=u.readInt32();m.indexFrom=u.readInt32();m.indexCount=u.readInt32();m.minZoom=u.readInt32();m.maxZoom=u.readInt32();return m};n._createClass(D,[{key:"sortKey",get:function(){null==this._sortKey&&this._computeSortKey();
return this._sortKey}}]);return D}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}var F=l.prototype;F.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};F.update=function(D,A,u){for(const m in D)this.vertexData.set(m,D[m]);for(const m in this.vertexData)null===D[m]&&this.vertexData.delete(m);this.vertexCount=
A;this.indexData=u};return n._createClass(l)}()})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(n){n.deserializeList=function(l,F,D){var A=l.readInt32();A=Array(A);for(let u=0;u<A.length;u++)A[u]=F.deserialize(l,D);return A};n.serializeList=function(l,F){if(null===F)l.push(0);else{l.push(F.length);for(const D of F)D.serialize(l);return l}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/DisplayRecordReader":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../definitions","../FeatureDisplayList"],function(n,l,F,D){let A=function(){function m(f){this._cursor=this._head=f}m.from=function(f,d=0,c=f.byteLength/u.BYTES_PER_RECORD-d){f=new u(new Int32Array(f,d*u.BYTES_PER_RECORD,c*u.ELEMENTS_PER_RECORD));return new m(f)};var h=m.prototype;h.size=function(){let f=this._cursor,d=0;for(;f;)d+=f.size(),f=f._link;return d};h.seekIndex=function(f){for(this._cursor=this._head;this._cursor;){const d=this._cursor.size();
if(f<d)return this._cursor._index=f,!0;f-=d;this._cursor=this._cursor._link}return!1};h.forEach=function(f){const d=this.getCursor();for(;d.next();)f(d)};h.link=function(f){if(this._head){for(var d=this._head;d._link;)d=d._link;d._link=f._head;d._link._indexStart=d._indexStart+d.size()}else this._head=f._head};h.getCursor=function(){return this.copy()};h.getDrawInfo=function(f,d){return new D.FeatureDisplayListInfo(f,d,this.materialKey,this.indexFrom,this.indexCount)};h.lookup=function(f){for(this._cursor=
this._head;this._cursor&&!this._cursor.lookup(f);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor};h.copy=function(){const f=new m(this._head?.copy());if(!f._head)return f;let d=f._head,c=f._head._link;for(;c;)d._link=c.copy(),d=c,c=d._link;return f};h.next=function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;return this.next()}return!0};h.peekId=function(){return this._cursor.peekId()??
this._cursor._link.peekId()};h.delete=function(f){let d=this._head,c=null;for(;d;){if(d.delete(f))return d.isEmpty()&&(null!=c&&(c._link=d._link),d===this._head&&(this._head=d._link),d===this._cursor&&(this._cursor=d._link)),!0;c=d;d=d._link}return!1};l._createClass(m,[{key:"id",get:function(){return this._cursor.id},set:function(f){this._cursor.id=f}},{key:"materialKey",get:function(){return this._cursor.materialKey},set:function(f){this._cursor.materialKey=f}},{key:"insertAfter",get:function(){return this._cursor.insertAfter}},
{key:"indexFrom",get:function(){return this._cursor.indexFrom},set:function(f){this._cursor.indexFrom=f}},{key:"indexCount",get:function(){return this._cursor.indexCount},set:function(f){this._cursor.indexCount=f}},{key:"vertexFrom",get:function(){return this._cursor.vertexFrom},set:function(f){this._cursor.vertexFrom=f}},{key:"vertexCount",get:function(){return this._cursor.vertexCount},set:function(f){this._cursor.vertexCount=f}},{key:"sortKey",get:function(){return this._cursor.sortKey},set:function(f){this._cursor.sortKey=
f}},{key:"index",get:function(){return this._cursor._indexStart+this._cursor._index}}]);return m}();A.ELEMENTS_PER_RECORD=F.DISPLAY_RECORD_INT_PER_ELEMENT;A.BYTES_PER_RECORD=A.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;let u=function(){function m(f){this._link=null;this._index=-1;this._indexStart=0;this._packedRecordsF32=null;this._deletedCount=0;this._offsets={instance:null};this._packedRecords=f}m.from=function(f,d=0,c=f.byteLength/this.BYTES_PER_RECORD-d){return new m(new Int32Array(f,d*
this.BYTES_PER_RECORD,c*this.ELEMENTS_PER_RECORD))};var h=m.prototype;h.delete=function(f){const d=this._index,c=this.lookup(f);if(c)for(this.id=2147483647,++this._deletedCount;this.next()&&this.id===f;)this.id=2147483647,++this._deletedCount;this._index=d;return c};h.isEmpty=function(){return this._deletedCount===this.size()};h.link=function(f){this._link?this._link.link(f):this._link=f};h.lookup=function(f){if(null==this._offsets.instance){this._offsets.instance=new Map;var d=this.copy();d._index=
-1;let c=0;for(;d.next();)d.id!==c&&(this._offsets.instance.set(d.id,d._index),c=d.id)}if(!this._offsets.instance.has(f))return!1;d=this._index;this._index=this._offsets.instance.get(f);return 2147483647===this.id?(this._index=d,!1):!0};h.size=function(){return this._packedRecords.length/m.ELEMENTS_PER_RECORD};h.next=function(){for(;++this._index<this.size()&&2147483647===this.id;);return this._index<this.size()};h.peekId=function(){const f=(this._index+1)*m.ELEMENTS_PER_RECORD;return f>=this._packedRecords.length?
0:this._packedRecords[f]};h.getCursor=function(){return this.copy()};h.copy=function(){const f=new m(this._packedRecords);f._indexStart=this._indexStart;f._link=this._link;f._index=this._index;f._offsets=this._offsets;f._deletedCount=this._deletedCount;return f};l._createClass(m,[{key:"id",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD]},set:function(f){this._packedRecords[this._index*m.ELEMENTS_PER_RECORD]=f}},{key:"materialKey",get:function(){return this._packedRecords[this._index*
m.ELEMENTS_PER_RECORD+1]},set:function(f){this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+1]=f}},{key:"insertAfter",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+2]}},{key:"indexFrom",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+3]},set:function(f){this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+3]=f}},{key:"indexCount",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+4]},set:function(f){this._packedRecords[this._index*
m.ELEMENTS_PER_RECORD+4]=f}},{key:"vertexFrom",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+5]},set:function(f){this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+5]=f}},{key:"vertexCount",get:function(){return this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+6]},set:function(f){this._packedRecords[this._index*m.ELEMENTS_PER_RECORD+6]=f}},{key:"sortKey",get:function(){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer));
return this._packedRecordsF32[this._index*m.ELEMENTS_PER_RECORD+7]},set:function(f){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer));this._packedRecordsF32[this._index*m.ELEMENTS_PER_RECORD+7]=f}},{key:"index",get:function(){return this._index}}]);return m}();u.ELEMENTS_PER_RECORD=F.DISPLAY_RECORD_INT_PER_ELEMENT;u.BYTES_PER_RECORD=u.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;n.DisplayRecordReader=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./cpuMapped/FreeList"],function(n,l,F){let D=function(){function u(m,h,f,d,c){this.target=m;this.geometryType=h;this.materialKey=f;this.indexFrom=d;this.indexCount=c}u.prototype.extend=function(m){this.indexCount+=m};l._createClass(u,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}}]);return u}(),A=function(){function u(h,f){this.geometryType=0;this._target=
h;this.geometryType=f}u.from=function(h,f,d,c){h=new u(h,f);if(null!=c)for(const a of c)d.seekIndex(a),h.addRecord(d);else for(;d.next();)h.addRecord(d);return h};var m=u.prototype;m.addRecord=function(h){var f=this._target,d=this.geometryType,c=h.materialKey;let a=h.indexFrom,b=h.indexCount;const g=h.vertexFrom;h=h.vertexCount;b||(a=g,b=h);if(null==this._head)c=new D(f,d,c,a,b),this._head=new F.List(c);else{f=null;for(d=this._head;d;){if(a<d.data.indexFrom)return this._insert(c,a,b,f,d);f=d;d=d.next}this._insert(c,
a,b,f,null)}};m.forEach=function(h){null!=this._head&&this._head.forEach(h)};m.infos=function*(){if(null!=this._head)for(const h of this._head.values())yield h};m._insert=function(h,f,d,c,a){if(null==c&&null==a){const b=new D(this._target,this.geometryType,h,f,d);this._head=new F.List(b)}if(null==c&&null!=a)return this._insertAtHead(h,f,d,a);if(null!=c&&null==a)return this._insertAtEnd(h,f,d,c);if(null!=c&&null!=a)return this._insertAtMiddle(h,f,d,c,a)};m._insertAtHead=function(h,f,d,c){h===c.data.materialKey&&
f+d===c.data.indexFrom?(c.data.indexFrom=f,c.data.indexCount+=d):(h=new D(this._target,this.geometryType,h,f,d),this._head=new F.List(h),this._head.next=c)};m._insertAtEnd=function(h,f,d,c){c.data.materialKey===h&&c.data.indexEnd===f?c.data.indexCount+=d:(h=new D(this._target,this.geometryType,h,f,d),h=new F.List(h),c.next=h)};m._insertAtMiddle=function(h,f,d,c,a){c.data.materialKey===h&&c.data.indexEnd===f?(c.data.indexCount+=d,c.data.materialKey===a.data.materialKey&&c.data.indexEnd===a.data.indexFrom&&
(c.data.indexCount+=a.data.indexCount,c.next=a.next)):h===a.data.materialKey&&f+d===a.data.indexFrom?(a.data.indexFrom=f,a.data.indexCount+=d):(h=new D(this._target,this.geometryType,h,f,d),h=new F.List(h),c.next=h,h.next=a)};return l._createClass(u)}();n.FeatureDisplayList=A;n.FeatureDisplayListInfo=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../Utils"],
function(n,l,F){let D=function(){function u(m,h){this.data=m;this.stride=h}u.decode=function(m){const h=F.allocateTypedArrayBufferwithData(m.data,m.stride);return new u(h,m.stride)};u.fromVertexVector=function(m){const h=F.allocateTypedArrayBufferwithData(m.data.buffer(),m.stride);return new u(h,m.stride)};return l._createClass(u)}(),A=function(){function u(m,h,f){this.geometryType=m;this.indexBuffer=new Uint32Array(h);this.namedBuffers=f}u.decode=function(m){const h=m.geometryType,f=m.indexBuffer,
d={};for(const c in m.namedBuffers)d[c]=D.decode(m.namedBuffers[c]);return new u(h,f,d)};u.fromVertexData=function(m,h){const f=m.indices,d=F.allocateTypedArrayBufferwithData(m.vertices,m.stride);m={geometry:new D(d,m.stride)};return new u(h,f,m)};u.fromVertexVectors=function(m){const h=m.geometryType,f=m.indexVector.buffer(),d={};let c;for(c in m.namedVectors)d[c]=D.fromVertexVector(m.namedVectors[c]);return new u(h,f,d)};return l._createClass(u)}();n.VertexBuffers=A;Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../Utils","./VertexBuffer","../util/Writer"],function(n,l,F,D,A){let u=function(){function h(f,d){this.data=f;this.stride=d}h.prototype.transfer=function(f,d){const c=this.data.buffer();f.vertexCount=this.vertexCount;f.data=c;f.stride=this.stride;d.push(c)};l._createClass(h,[{key:"vertexCount",get:function(){const f=this.data.length/(this.stride/4);f!==
(f|0)&&console.debug("Corrupted stride");return f}}]);return h}(),m=function(){function h(d,c,a){this.geometryType=d;this.indexVector=new A(Uint32Array,6*c);this.namedVectors={};d=F.getStrides(d,a);for(const b in d){a=d[b];let g;switch(a%4){case 0:case 2:g=new A(Uint32Array,a*c);break;case 1:case 3:g=new A(Uint8Array,a*c)}this.namedVectors[b]=new u(g,a)}}var f=h.prototype;f.get=function(d){return this.namedVectors[d].data};f.getVector=function(d){return this.namedVectors[d]};f.transfer=function(d,
c){const a=this.indexVector.buffer(),b={};c.push(a);let g;for(g in this.namedVectors){const e=this.namedVectors[g];b[g]={};e.transfer(b[g],c)}d.geometryType=this.geometryType;d.indexBuffer=a;d.namedBuffers=b;this.destroy()};f.intoBuffers=function(){const d=D.VertexBuffers.fromVertexVectors(this);this.destroy();return d};f.destroy=function(){this.namedVectors=this.indexVector=null};return l._createClass(h)}();n.VertexVector=u;n.VertexVectors=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/util/Writer":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(D,A){this._pos=0;A=A?this._roundToNearest(A,D.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(A);this._buffer=new D(this._array);this._ctor=D;this._i16View=new Int16Array(this._array)}var F=l.prototype;F._roundToNearest=function(D,A){D=Math.round(D);return 1===A?D:D+(A-D%A)};F._ensureSize=function(D){if(this._pos+D>=this._buffer.length){D=this._roundToNearest(1.25*
(this._array.byteLength+D*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);D=new ArrayBuffer(D);const A=new this._ctor(D);A.set(this._buffer,0);this._array=D;this._buffer=A;this._i16View=new Int16Array(this._array)}};F.ensureSize=function(D){this._ensureSize(D)};F.writeF32=function(D){this._ensureSize(1);const A=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=D;this._pos++;return A};F.push=function(D){this._ensureSize(1);const A=this._pos;this._buffer[this._pos++]=D;return A};
F.writeFixed=function(D){this._buffer[this._pos++]=D};F.setValue=function(D,A){this._buffer[D]=A};F.i1616Add=function(D,A,u){this._i16View[2*D]+=A;this._i16View[2*D+1]+=u};F.getValue=function(D){return this._buffer[D]};F.incr=function(D){if(this._buffer.length<D)throw Error("Increment index overflows the target buffer");this._buffer[D]++};F.decr=function(D){this._buffer[D]--};F.writeRegion=function(D){this._ensureSize(D.length);const A=this._pos;this._buffer.set(D,this._pos);this._pos+=D.length;return A};
F.writeManyFrom=function(D,A,u){for(this._ensureSize(u-A);A!==u;A++)this.writeFixed(D._buffer[A])};F.buffer=function(){const D=this._array.slice(0,4*this._pos);this.destroy();return D};F.toArray=function(){return[...this._buffer]};F.seek=function(D){this._pos=D};F.destroy=function(){this._buffer=this._array=null};n._createClass(l,[{key:"length",get:function(){return this._pos}}]);return l}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../tiling/PagedTileQueue ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ../DisplayId ../enums ../Utils ./VertexDataWriter ../../../layers/features/support/tileUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){function g(k){switch(k){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function e(k){switch(k){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}F=function(){function k(q,t,v,y,w,z=0){this.hasRecords=this._hasAggregate=!1;this._data={self:new Map,neighbors:[]};this._version=0;this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,
vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0};this.hint=t;this.tileKey=q;this._hasAggregate=y;this._pixelBufferEnabled=w;this._version=z;this._symbologyType=v}var p=k.prototype;p.serialize=function(q){const t=[];t.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self));this._data.neighbors.forEach((v,y)=>{var w=1<<y;y=g(w);w=e(w);y=b.getPow2NeighborKey(new A(this.tileKey),y,w,q);y=this._serializeTileVertexData(this.tileKey,y.id,v.vertexData);y.message.bufferIds=
v.displayIds;t.push(y)});return t};p._serializeTileVertexData=function(q,t,v){const y=[];v={[d.WGLGeometryType.MARKER]:v.get(d.WGLGeometryType.MARKER)?.serialize(y),[d.WGLGeometryType.FILL]:v.get(d.WGLGeometryType.FILL)?.serialize(y),[d.WGLGeometryType.LINE]:v.get(d.WGLGeometryType.LINE)?.serialize(y),[d.WGLGeometryType.TEXT]:v.get(d.WGLGeometryType.TEXT)?.serialize(y),[d.WGLGeometryType.LABEL]:v.get(d.WGLGeometryType.LABEL)?.serialize(y)};return{message:{tileKeyOrigin:q,tileKey:t,data:v,version:this._version},
transferList:y}};p.featureStart=function(q,t){this._current.insertAfter=q;this._current.sortKey=t};p.featureEnd=function(){};p.recordStart=function(q,t,v,y){this._current.writer=this._getVertexWriter(v);this._current.overlaps=0;this._current.indexStart=this._current.writer.indexCount;this._current.vertStart=this._current.writer.vertexCount;this._current.bufferingEnabled=y;this._current.id=q;this._current.materialKey=t;this._current.geometryType=v;this._current.isDotDensity=!1;this._current.writer.recordStart()};
p.recordCount=function(){return this._current.writer.recordCount};p.vertexCount=function(){return this._current.writer.vertexCount};p.indexCount=function(){return this._current.writer.indexCount};p.vertexEnsureSize=function(q){this._current.writer.vertexEnsureSize(q)};p.indexEnsureSize=function(q){this._current.writer.indexEnsureSize(q)};p.vertexBounds=function(q,t,v,y){this._current.bufferingEnabled&&this._addOverlap(q,t,v,y)};p.vertexWrite=function(q){this._current.writer.writeVertex(q)};p.vertexWriteF32=
function(q){this._current.writer.writeVertexF32(q)};p.vertexEnd=function(){};p.vertexWriter=function(){return this._current.writer.vertexWriter};p.indexWrite=function(q){this._current.writer.writeIndex(q)};p.indexWriter=function(){return this._current.writer.indexWriter};p.metricWriter=function(){return this._current.writer.metricWriter};p.metricStart=function(q,t,v,y,w,z,r,C){this._current.writer=this._getVertexWriter(d.WGLGeometryType.LABEL);const x=this._current.writer.metricWriter;x.push(f.getDisplayIdTexel(q));
x.push(t);x.push(v);x.push(y);x.push(w);x.push(z);x.push(r);x.push(C);x.push(255);this._current.metricBoxLenPointer=x.push(0)};p.metricEnd=function(){const q=this._current.writer.metricWriter;0===q.getValue(this._current.metricBoxLenPointer)&&q.seek(q.length-10)};p.metricBoxWrite=function(q,t,v,y){const w=this._current.writer.metricWriter;w.incr(this._current.metricBoxLenPointer);w.push(0);w.push(0);w.push(q);w.push(t);w.push(v);w.push(y)};p.recordEnd=function(){var q=this._current.vertStart,t=this._current.writer.vertexCount-
q;if(!t)return!1;this.hasRecords=!0;var v=this._current.indexStart;this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,v,this._current.writer.indexCount-v,q,t,this._current.sortKey);if(!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===d.WGLGeometryType.LABEL)return!0;q=this._current.writer;for(t=0;8>t;t++){var y=1<<t;if(this._current.overlaps&y){this._data.neighbors[t]||(this._data.neighbors[t]={vertexData:new Map,
displayIds:new Set});v=this._data.neighbors[t];var w=this._current.geometryType;if(!v.vertexData.has(w)){var z=c.getStrides(w,this._symbologyType).geometry;z=new a.VertexDataWriter(w,z,h.PATCH_PIXEL_BUFFER_ALLOC_SIZE);v.vertexData.set(w,z)}w=v.vertexData.get(this._current.geometryType);z=4096*-g(y);y=4096*-e(y);w?.copyLastFrom(q,z,y);v.displayIds.add(this._current.id)}}return!0};p._addOverlap=function(q,t,v,y){this._current.overlaps|=255^((q<0+v?148:q>=h.TILE_SIZE-v?41:189)|(t<0+y?224:t>=h.TILE_SIZE-
y?7:231))};p._getVertexWriter=function(q){if(!this._data.self.has(q)){const t=this._data.self,v=c.getStrides(q,this._symbologyType).geometry;t.set(q,new a.VertexDataWriter(q,v,this.hint.records))}return this._data.self.get(q)};l._createClass(k,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}}]);return k}();n.MeshData=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],
function(n){n.AGGREGATE_VALID_FILTERS_MASK=254;n.DISPLAY_ID_TEXEL_MASK=8388607;n.DISPLAY_ID_TYPE_AGGREGATE=1;n.DISPLAY_ID_TYPE_FEATURE=0;n.DISPLAY_ID_TYPE_MASK=8388608;n.NONAGGREGATE_VALID_FILTERS_MASK=255;n.createDisplayId=function(l,F){return((F?8388608:0)|l)>>>0};n.getDisplayIdFilterMask=l=>1===(l&8388608)>>>23?254:255;n.getDisplayIdTexel=l=>l&8388607;n.getDisplayIdType=l=>(l&8388608)>>>23;n.isAggregateId=function(l){return 1===(l&8388608)>>>23};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../definitions","./heuristics","../util/Writer"],function(n,l,F,D,A){let u=function(){function m(f,d,c){this._start={index:0,vertex:0};c=D.getMeshSizeHint(f,d,c);d/=4;this.geometryType=f;this._records=new A(Int32Array,c.recordBytes);this._indices=new A(Uint32Array,c.indexBytes);this._vertices=new A(Uint32Array,c.vertexBytes);this._metrics=new A(Float32Array,0);this._strideInt=
d}var h=m.prototype;h.serialize=function(f){const d=this._records.buffer(),c=this._indices.buffer(),a=this._vertices.buffer(),b=this._metrics.length?this._metrics.buffer():null,g=4*this._strideInt;f.push(d,c,a);return{stride:g,records:d,indices:c,vertices:a,metrics:b}};h.vertexEnsureSize=function(f){this._vertices.ensureSize(f)};h.indexEnsureSize=function(f){this._indices.ensureSize(f)};h.recordStart=function(){this._start.index=this._indices.length;this._start.vertex=this._vertices.length};h.recordEnd=
function(f,d,c,a,b,g,e,k){this._records.push(f);this._records.push(d??0);this._records.push(c);this._records.push(a);this._records.push(b);this._records.push(g);this._records.push(e);this._records.writeF32(k)};h.writeIndex=function(f){this._indices.push(f)};h.writeVertex=function(f){this._vertices.push(f)};h.writeVertexF32=function(f){this._vertices.writeF32(f)};h.copyLastFrom=function(f,d,c){var a=f._records.length-F.DISPLAY_RECORD_INT_PER_ELEMENT;const b=f._records.getValue(a),g=f._records.getValue(a+
1),e=f._records.getValue(a+2),k=f._records.getValue(a+4),p=f._records.getValue(a+6);a=f._records.getValue(a+7);const q=this._vertices.length;var t=(f._start.vertex-this._vertices.length)/this._strideInt;const v=this._indices.length,y=this.vertexCount;for(var w=f._start.index;w!==f._indices.length;w++){const z=f._indices.getValue(w);this._indices.push(z-t)}for(t=f._start.vertex;t!==f._vertices.length;t++)w=f._vertices.getValue(t),this._vertices.push(w);for(f=q;f<=this._vertices.length;f+=this._strideInt)this._vertices.i1616Add(f,
d,c);this._records.push(b);this._records.push(g);this._records.push(e);this._records.push(v);this._records.push(k);this._records.push(y);this._records.push(p);this._records.push(a)};l._createClass(m,[{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/F.DISPLAY_RECORD_INT_PER_ELEMENT}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",
get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}}]);return m}();n.VertexDataWriter=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/heuristics":function(){define(["exports","../definitions","../enums"],function(n,l,F){const D=new Map;D.set(F.WGLGeometryType.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4});D.set(F.WGLGeometryType.LINE,
{multiplier:1,indicesPerRecord:24,verticesPerRecord:8});D.set(F.WGLGeometryType.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10});D.set(F.WGLGeometryType.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});D.set(F.WGLGeometryType.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});n.getMeshSizeHint=function(A,u,m){const {indicesPerRecord:h,multiplier:f,verticesPerRecord:d}=D.get(A);return{recordBytes:m*l.DISPLAY_RECORD_INT_PER_ELEMENT*Uint32Array.BYTES_PER_ELEMENT,indexBytes:f*
h*m*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:f*d*m*u}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(n){n.getPow2NeighborKey=function(l,F,D,A){l=l.clone();const u=1<<l.level;F=l.col+F;D=l.row+D;A&&0>F?(l.col=F+u,--l.world):F>=u?(l.col=F-u,l.world+=1):l.col=F;l.row=D;return l};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../../../geometry/libtess ../../DisplayId ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(n,l,F,D,A,u,m,h,f){F=function(){function d(a,b,g){this._loadPromise=A.loadLibtess();this._geometryType=a;this._idField=b;this._templateStore=g}var c=d.prototype;c.update=function(a,b){null!=a.mesh.labels&&(this._labelTemplates=this._createLabelTemplates(a.mesh.labels,b));this._schema=a};c._createLabelTemplates=function(a,b){const g=new Map;if("simple"===a.type){for(var e of a.classes)a=m.fromLabelClass(e,b),g.set(e.index,a);return g}for(const k in a.classes){e=a.classes[k];for(const p of e)e=
m.fromLabelClass(p,b),g.set(p.index,e)}return g};c.analyze=async function(a,b,g,e,k,p,q){if(!D.isAborted(q)){var t;"dictionary"===g?.type&&(t=await g.analyze(this._idField,a.copy(),b,k,p,q));for(b=0;a.next();){var v=null;v=t?t[b++]:null!=e&&u.isAggregateId(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?e.match(this._idField,a,this._geometryType,k,p):g.match(this._idField,a,this._geometryType,k,p);a.setGroupId(v);if(f.isDynamicId(v)){v=this._templateStore.getDynamicTemplateGroup(v).templates;
for(const y of v)y&&y.analyze&&y.analyze(this._templateStore,a,k,p)}}await this._loadPromise;return this._templateStore.finalize(q)}};c.analyzeGraphics=async function(a,b,g,e,k,p){if(!D.isAborted(p)){a=a.getCursor();for(g&&await g.analyze(this._idField,a.copy(),b,e,k,p);a.next();){b=a.getGroupId();if(null==b||-1===b)b=g?.match(this._idField,a,a.geometryType,e,k),a.setGroupId(b);if(f.isDynamicId(b)){const q=this._templateStore.getDynamicTemplateGroup(b).templates;for(const t of q)t&&t.analyze&&t.analyze(this._templateStore,
a,e,k)}a.setGroupId(b)}await this._loadPromise;return this._templateStore.finalize(p)}};c.writeGraphic=function(a,b,g,e){const k=b.getGroupId(),p=b.getDisplayId(),q=this._templateStore.getTemplateGroup(k);a.featureStart(b.insertAfter,0);if(null!=p){if(f.isDynamicId(k))for(const t of q.templates)t&&t.bindFeature(b,null,null);if(q){for(const t of q.templates)t&&t.write(a,b,g,e);a.featureEnd()}}};c.writeCursor=function(a,b,g,e,k,p,q){const t=b.getGroupId(),v=b.getDisplayId();var y=this._templateStore.getTemplateGroup(t);
const w=y.templates;y=this._getSortKeyValue(b,y);a.featureStart(0,y);if(null!=v&&w){if(f.isDynamicId(t))for(const z of w)z.bindFeature(b,g,e);for(const z of w)z.write(a,b,k,q);null!=p&&a.hasRecords&&(g=p&&this._findLabelRef(w),this._writeLabels(a,b,p,g,k,q));a.featureEnd()}};c._getSortKeyValue=function(a,b){const g=this._schema.mesh.sortKey;if(null==g)return 0;let e=0;e=!0===g.byRenderer&&null!=b.sortKey?b.sortKey:null!=g.fieldIndex?a.getComputedNumericAtIndex(g.fieldIndex):null!=g.field?a.readAttribute(g.field):
a.readAttribute(this._idField);e*="asc"===g.order?1:-1;return null==e||isNaN(e)?0:e};c._findLabelRef=function(a){for(const b of a)if(b instanceof h)return b;return null};c._writeLabels=function(a,b,g,e,k,p){for(const q of g)if(null!=q&&q){const {glyphs:t,rtl:v,index:y}=q;if(g=this._labelTemplates.get(y))g.setZoomLevel(k),g.bindReferenceTemplate(e),g.bindTextInfo(t,v),g.write(a,b,null,p)}};l._createClass(d,[{key:"templates",get:function(){return this._templateStore}}]);return d}();n.WGLMeshFactory=
F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(n,l,F,D){async function A(){m=await (D("esri-csp-restrictions")?await (new Promise((h,f)=>n(["../chunks/libtess-asm"],h,f))).then(h=>h.libtessAsm):await (new Promise((h,f)=>n(["../chunks/libtess"],h,f))).then(h=>h.libtess)).load({locateFile:h=>F.getAssetUrl(`esri/core/libs/libtess/${h}`)})}let u=null,m=null;l.loadLibtess=async function(){u||
(u=A());return u};l.triangulate=function(h,f){return m.triangulate(h,f,Math.max(h.length,128E3))};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./segmentUtils ./WGLTextTemplate".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k){const p=F.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),q=(v,y="mapview-labeling")=>p.error(new l(y,v)),t=function(v){const y=new Map;return w=>{y.has(w)||y.set(w,v(w));return y.get(w)}}(v=>{let y=0;if(0===v)return Infinity;for(;!(v%2);)y++,v/=2;return y});return function(v){function y(z,r,C,x){var E=v.call(this,z,C.font?.size,C.haloSize||0,C.font?.size,C.color&&d.premultiplyAlphaRGBAArray(C.color)||0,C.haloColor&&d.premultiplyAlphaRGBAArray(C.haloColor)||
0,C.horizontalAlignment,C.verticalAlignment,f.isMapAligned(r.labelPlacement)?h.Alignment.MAP:h.Alignment.SCREEN,C.font?.decoration,!1,C.angle||0,C.xoffset,C.yoffset,C.lineWidth,C.lineHeight,null,null,!1,null,null,C.backgroundColor&&d.premultiplyAlphaRGBAArray(C.backgroundColor),C.borderLineColor&&d.premultiplyAlphaRGBAArray(C.borderLineColor),C.borderLineSize)||this;E._outLineLabelAngle=0;E._refPlacementPadding=0;E._refPlacementDirX=0;E._refPlacementDirY=0;E._refOffsetX=0;E._refOffsetY=0;E._zoomLevel=
0;E.geometryType=a.WGLGeometryType.LABEL;E._allowOverrun=r.allowOverrun??!1;E._repeatLabel=r.repeatLabel??!0;E._labelPosition=r.labelPosition??"curved";var B=!!r.minScale&&x.scaleToZoom(r.minScale)||0;B=D.clamp(B,0,25.5);x=!!r.maxScale&&x.scaleToZoom(r.maxScale)||255;x=D.clamp(x,0,25.5);const [G,H]=f.getAlignmentFromPlacement(r.labelPlacement);E._xAlignD=G;E._yAlignD=H;E._minZoom=B;E._maxZoom=x;E._minBackgroundZoom=B;E._maxBackgroundZoom=x;E._refPlacementPadding=A.pt2px(C.haloSize)+c.TEXT_PLACEMENT_PADDING;
E._repeatLabelDistance=r.repeatLabelDistance?A.pt2px(r.repeatLabelDistance):128;z=g.LabelMaterialKey.load(z);z.sdf=!0;E._materialKey=z.data;return E}n._inherits(y,v);y.fromLabelClass=function(z,r){if("esriServerLinePlacementCenterAlong"===z.labelPlacement){const C=z.symbol;C.xoffset=0;C.yoffset=0;C.angle=0;C.font.decoration="none"}return new y(z.materialKey,z,z.symbol,r)};var w=y.prototype;w.setZoomLevel=function(z){this._zoomLevel=z};w.bindReferenceTemplate=function(z){let r=f.getXDirection(this._xAlignD),
C=f.getYDirection(this._yAlignD);this._refOffsetY=this._refOffsetX=0;if(null==z)this._refSymbolAndPlacementOffset=b.i8888to32(0,0,Math.floor(127*r+127),Math.floor(127*C+127));else{if("circle"===z.boundsType&&(r||C)){var x=Math.sqrt(r*r+C*C);r/=x;C/=x}x=Math.max(z.height,z.width);this._refSymbolAndPlacementOffset=b.i8888to32(4*this._refPlacementPadding,x,Math.floor(127*r+127),Math.floor(127*C+127));this._referenceSize=x;this._refPlacementDirX=r;this._refPlacementDirY=C;this._refOffsetX=z.xOffset;this._refOffsetY=
z.yOffset}};w._write=function(z,r){if(null!=this._shapingInfo){var C=this._shapingInfo,x=r.getDisplayId(),E="esriGeometryPolygon"===r.geometryType?r.readLegacyCentroid():r.readLegacyGeometry();if(E)switch(this._current={out:z,inId:x,inShaping:C,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===r.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&p.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),
r.geometryType){case "esriGeometryPolyline":this._placeLineLabels(E);break;case "esriGeometryPoint":case "esriGeometryPolygon":this._placePointLabels(E);break;default:q(`Geometry of type ${r.geometryType} is not supported`)}}};w._isVisible=function(z,r){const C=Math.floor(10*this._current.zoomLevel);return Math.floor(10*z)<=C&&C<=Math.floor(10*r)};w._placePointLabels=function(z){const {out:r,inId:C,inShaping:x}=this._current;this._writeGlyphs(r,C,z,x)};w._placeLineLabels=function(z){z=e.smoothPaths(z.paths,
this._current.inShaping.bounds.width);const r=this._placeSubdivGlyphs.bind(this),C=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const x of z)e.pathDivide(x,C,r,this._repeatLabel)};w._placeSubdivGlyphs=function(z,r,C,x){var E=t(r),B=this._shapedBox.width/2,G=Math.sqrt(this._repeatLabelDistance)/2;C=Math.min(C,x-C);B=this._current.inShaping.isMultiline?25:Math.log2(C/(G+B/2));E=Math.max(this._minZoom,this._current.zoomLevel+1-(0===r?B:Math.min(E,B)));B=this._current.zoomLevel-E;G=this._shapedBox.width/
2*2**B;this._current.inShaping.isMultiline?0===r&&this._placeStraight(z,E):this._allowOverrun&&0>B?this._placeStraightAlong(z,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(z,E):"curved"===this._labelPosition&&this._placeCurved(z,E,G)};w._placeStraight=function(z,r){const {out:C,inId:x,inShaping:E}=this._current,B=Math.ceil((180/Math.PI*z.angle+180)%360);this._outLineLabelAngle=Math.round(254/360*Math.ceil(180/Math.PI*z.angle%360));this._writeGlyphs(C,x,z,E,r);this._outLineLabelAngle=
Math.round(254/360*B);this._writeGlyphs(C,x,z,E,r)};w._placeCurved=function(z,r,C){const {out:x,inId:E}=this._current;x.metricStart(E,r,z.x,z.y,0,0,0,0);const B=z.clone(),G=(180/Math.PI*z.angle+180)%360;this._outLineLabelAngle=Math.round(180/Math.PI*z.angle%360*(254/360));this._placeFirst(B,r,1);this._placeBack(z,B,r,C,1);this._placeForward(z,B,r,C,1);this._outLineLabelAngle=Math.round(254/360*G);this._placeFirst(B,r,0);this._placeBack(z,B,r,C,0);this._placeForward(z,B,r,C,0);x.metricEnd()};w._placeStraightAlong=
function(z,r){const {out:C,inId:x,inShaping:E}=this._current;C.metricStart(x,r,z.x,z.y,0,0,0,0);const B=z.clone(),G=180/Math.PI*z.angle%360,H=(180/Math.PI*z.angle+180)%360;var I=0<E.glyphs.length&&(this._borderLineColor||this._backgroundColor);this._maxBackgroundZoom=25;this._minBackgroundZoom=Math.max(r,0);if(I){I=g.LabelMaterialKey.load(this._materialKey);I.textureBinding=E.glyphs[0].textureBinding;const J=u.fromRotation(m.create(),-z.angle),[L,K]=E.shapeBackground(J);this._outLineLabelAngle=Math.round(254/
360*G);C.recordStart(x,I.data,this.geometryType,!0);this._writeBackgroundGeometry(C,x,z,L,K);C.recordEnd();this._outLineLabelAngle=Math.round(254/360*H);C.recordStart(x,I.data,this.geometryType,!0);this._writeBackgroundGeometry(C,x,z,L,K);C.recordEnd()}this._outLineLabelAngle=Math.round(254/360*G);this._placeFirst(B,r,1,!0);this._outLineLabelAngle=Math.round(254/360*H);this._placeFirst(B,r,0,!0);C.metricEnd()};w._placeBack=function(z,r,C,x,E){const B=z.clone();for(z=z.backwardLength+0;B.prev()&&!(z>=
x);)this._placeOnSegment(B,r,z,C,-1,E),z+=B.length+0};w._placeForward=function(z,r,C,x,E){const B=z.clone();for(z=z.remainingLength+0;B.next()&&!(z>=x);)this._placeOnSegment(B,r,z,C,1,E),z+=B.length+0};w._placeFirst=function(z,r,C,x=!1){const E=this._current.inShaping;var B=E.glyphs;const G=this._current.zoomLevel,{out:H,inId:I}=this._current;for(const J of B)B=J.x>E.bounds.x?C:1-C,B=Math.max(0,G+Math.log2(Math.abs(J.x+J.width/2-E.bounds.x)/(B*z.remainingLength+(1-B)*z.backwardLength))),B=Math.max(r,
x?0:B),J.maxZoom=25,J.angle=z.angle+(1-C)*Math.PI,J.minZoom=B,this._writeGlyph(H,I,z.x,z.y,J),C&&this._isVisible(J.minZoom,J.maxZoom)&&(B=J.bounds,H.metricBoxWrite(B.center[0],B.center[1],B.width,B.height))};w._placeOnSegment=function(z,r,C,x,E,B){var G=this._current.inShaping.glyphs;const {out:H,inId:I}=this._current,J=this._current.inShaping,L=this._current.zoomLevel;var K=z.x+z.dx/z.length*-E*C,S=z.y+z.dy/z.length*-E*C;for(const X of G)if((G=X.x>J.bounds.x?B:1-B)&&1===E||!G&&-1===E){var W=Math.abs(X.x+
X.width/2-J.bounds.x);G=Math.max(0,L+Math.log2(W/C)-.1);W=Math.max(x,L+Math.log2(W/(C+z.length+0)));0!==G&&(X.angle=z.angle+(1-B)*Math.PI,X.minZoom=W,X.maxZoom=G,this._writeGlyph(H,I,K,S,X),B&&this._isVisible(X.minZoom,X.maxZoom)&&(G=X.bounds,H.metricBoxWrite(G.center[0]+(z.x-r.x),G.center[1]+(z.y-r.y),G.width,G.height)))}};w._writeGlyphs=function(z,r,C,x,E=this._minZoom){if(!(0>C.x||512<=C.x||0>C.y||512<=C.y)){if(0<x.glyphs.length&&(this._borderLineColor||this._backgroundColor)){var B=g.LabelMaterialKey.load(this._materialKey);
B.textureBinding=x.glyphs[0].textureBinding;z.recordStart(r,B.data,this.geometryType,!0);this._writeBackgroundGeometry(z,r,C,x.bounds,x.background);z.recordEnd()}B=C.x+this._refOffsetX;C=C.y-this._refOffsetY;for(const G of x.glyphs)G.minZoom=E,G.maxZoom=this._maxZoom,this._writeGlyph(z,r,B,C,G);x=x.boundsT;z.metricStart(r,E,B,C,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey);z.metricBoxWrite(x.center[0],x.center[1],x.width,x.height);z.metricEnd()}};w._writeVertexCommon=
function(z,r,C,x){const E=this._color,B=this._haloColor,G=b.i8888to32(0,0,this._size,this._haloSize);x=b.i8888to32(Math.floor(10*Math.max(x.minZoom,this._minZoom)),Math.floor(10*Math.min(x.maxZoom,this._maxZoom)),this._outLineLabelAngle,0);z.vertexWrite(C);z.vertexWrite(r);z.vertexWrite(E);z.vertexWrite(B);z.vertexWrite(G);z.vertexWrite(this._refSymbolAndPlacementOffset);z.vertexWrite(x)};w._writeBackgroundVertex=function(z,r,C,x,E,B){const G=b.i8888to32(0,0,this._size,this._haloSize),H=b.i8888to32(0,
0,0,0),I=b.i8888to32(Math.floor(10*this._minBackgroundZoom),Math.floor(10*this._maxBackgroundZoom),this._outLineLabelAngle,1);z.vertexWrite(C);z.vertexWrite(r);z.vertexWrite(x);z.vertexWrite(H);z.vertexWrite(G);z.vertexWrite(this._refSymbolAndPlacementOffset);z.vertexWrite(I);z.vertexWrite(E);z.vertexWrite(B);z.vertexEnd()};n._createClass(y,[{key:"_shapedBox",get:function(){return this._shapingInfo.bounds}}]);return y}(k)})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports",
"../../../../../../chunks/_rollupPluginBabelHelpers","./util"],function(n,l,F){function D(f){return f.length-1}function A(f){let d=0;for(let c=0;c<D(f);c++)d+=u(f,c);return d}function u(f,d,c=1){const [a,b]=f[d+1];return Math.sqrt(a*a+b*b)*c}function m(f,d,c,a,b){if(!(c<d)){var g=a.clone().seek(c/2);null!=g&&(f(g.clone(),c,b),c=(c-d)/2,g=g.seek(d/2),m(f,d,c,a,b+1),m(f,d,c,g,b+1))}}let h=function(){function f(c,a,b,g,e){this._segments=c;this._index=a;this._distance=b;this._xStart=g;this._yStart=e;
this._done=!1}f.create=function(c){return new f(c,0,0,c[0][0],c[0][1])};var d=f.prototype;d.clone=function(){return new f(this._segments,this._index,this._distance,this.xStart,this.yStart)};d.equals=function(c){return this._index===c._index||c._index===this._index-1&&(0===this._distance||1===c._distance)||c._index===this._index+1&&(1===this._distance||0===c._distance)};d.leq=function(c){return this._index<c._index||this._index===c._index&&this._distance<=c._distance};d.geq=function(c){return this._index>
c._index||this._index===c._index&&this._distance>=c._distance};d.hasPrev=function(){return 0<=this._index-1};d.hasNext=function(){return this._index+1<D(this._segments)};d.next=function(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this};d.prev=function(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this};d._seekBackwards=function(c,a){var b=this.backwardLength;
if(c<=b)return this._distance=(b-c)/this.length,this;for(b=this.backwardLength;this.prev();){if(b+this.length>c)return this._seekBackwards(c-b);b+=this.length}this._distance=0;return a?this:null};d.seek=function(c,a=!1){if(0>c)return this._seekBackwards(Math.abs(c),a);if(c<=this.remainingLength)return this._distance=(this.backwardLength+c)/this.length,this;let b=this.remainingLength;for(;this.next();){if(b+this.length>c)return this.seek(c-b,a);b+=this.length}this._distance=1;return a?this:null};l._createClass(f,
[{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){const c=this.dy;let a=Math.acos((0*c+-1*-this.dx)/(1*this.length));0<c&&(a=2*Math.PI-a);return a}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},
{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){const {dx:c,dy:a}=this;return Math.sqrt(c*c+a*a)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},
{key:"done",get:function(){return this._done}}]);return f}();n.SegmentCursor=h;n.pathDivide=function(f,d,c,a=!0){const b=A(f);f=h.create(f);const g=b/2;if(a){a=Math.floor(Math.max((b-d)/2,0)/d);f.seek(g-a*d);for(let e=-a;e<=a;e++)512>f.x&&0<=f.x&&512>f.y&&0<=f.y&&c(f.clone(),e,g+e*d,b),f.seek(d)}else f.seek(g),c(f.clone(),0,g+0*d,b)};n.pathLength=A;n.pathSubdivide=function(f,d,c){m(c,d,A(f),h.create(f),0)};n.segmentAt=function(f,d){return f[d+1]};n.segmentCount=D;n.segmentLength=u;n.smoothPaths=function(f,
d){for(let x=0;x<f.length;x++){let E=f[x];a:{var c=E,a=d;if(0>=a)break a;const B=c.length;if(3>B)break a;const G=[];var b=0;G.push(0);for(var g=1;g<B;g++)b+=F.dist(c[g],c[g-1]),G.push(b);a=Math.min(a,.2*b);b=[];b.push(c[0][0]);b.push(c[0][1]);g=c[B-1][0];const H=c[B-1][1];var e=F.sub([0,0],c[0],c[1]);F.normalize(e);c[0][0]+=a*e[0];c[0][1]+=a*e[1];F.sub(e,c[B-1],c[B-2]);F.normalize(e);c[B-1][0]+=a*e[0];c[B-1][1]+=a*e[1];for(e=1;e<B;e++)G[e]+=a;G[B-1]+=a;e=.5*a;for(let I=1;I<B-1;I++){let J=0,L=0,K=
0;for(var k=I-1;0<=k&&!(G[k+1]<G[I]-e);k--){var p=e+G[k+1]-G[I],q=G[k+1]-G[k],t=G[I]-G[k]<e?1:p/q;if(1E-6>Math.abs(t))break;var v=t*t,y=t*p-.5*v*q,w=t*q/a,z=c[k+1],r=c[k][0]-z[0],C=c[k][1]-z[1];J+=w/y*(z[0]*t*p+.5*v*(p*r-q*z[0])-v*t*q*r/3);L+=w/y*(z[1]*t*p+.5*v*(p*C-q*z[1])-v*t*q*C/3);K+=w}for(k=I+1;k<B&&!(G[k-1]>G[I]+e);k++){p=e-G[k-1]+G[I];q=G[k]-G[k-1];t=G[k]-G[I]<e?1:p/q;if(1E-6>Math.abs(t))break;v=t*t;y=t*p-.5*v*q;w=t*q/a;z=c[k-1];r=c[k][0]-z[0];C=c[k][1]-z[1];J+=w/y*(z[0]*t*p+.5*v*(p*r-q*z[0])-
v*t*q*r/3);L+=w/y*(z[1]*t*p+.5*v*(p*C-q*z[1])-v*t*q*C/3);K+=w}b.push(J/K);b.push(L/K)}b.push(g);b.push(H);for(let I=0,J=0;I<B;I++)c[I][0]=b[J++],c[I][1]=b[J++]}c=[];c.push(E[0]);for(a=1;a<E.length;a++){const [B,G]=E[a-1],[H,I]=E[a];c.push([Math.round(H-B),Math.round(I-G)])}E=f[x]=c}return f};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["exports"],function(n){function l(F,D){return Math.sqrt(F*F+D*D)}n.DEFAULT_MAX_ZOOM=
100;n.DEFAULT_MIN_ZOOM=0;n.dist=function(F,D){return l(F[0]-D[0],F[1]-D[1])};n.getLimitCosine=function(F=2){return 1/Math.max(F,1)};n.getMinMaxZoom=function(F,D){const A=!!F?.minScale&&D.scaleToZoom(F.minScale)||0;F=!!F?.maxScale&&D.scaleToZoom(F.maxScale)||100;return[A,F]};n.isExtent=function(F){return void 0!==F.xmin&&void 0!==F.ymin&&void 0!==F.xmax&&void 0!==F.ymax};n.isMultipoint=function(F){return void 0!==F.points};n.isPoint=function(F){return void 0!==F.x&&void 0!==F.y};n.isPolygon=function(F){return void 0!==
F.rings};n.isPolyline=function(F){return void 0!==F.paths};n.len=l;n.normalize=function(F){const D=l(F[0],F[1]);F[0]/=D;F[1]/=D};n.sub=function(F,D,A){F[0]=D[0]-A[0];F[1]=D[1]-A[1];return F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/BidiText ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLMeshTemplate".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){return function(b){function g(e,k,p,q,t,v,y,w,z,r,C,x,E,B,G,H,I,J,L,K,S,W,X,Z){var V=b.call(this)||this;V._xOffset=F.pt2px(E);V._yOffset=F.pt2px(B);V._decoration=r||"none";V._backgroundColor=W;V._borderLineColor=X;V._borderLineSize=Z;V._color=t;V._haloColor=v;V._haloSize=Math.min(Math.floor(5*F.pt2px(F.toPt(p))),127);V._size=Math.min(Math.round(F.pt2px(k)),127);k=Math.min(Math.round(F.pt2px(q||k)),127);V._referenceSize=Math.round(Math.sqrt(256*k));V._scale=V._size/
m.GLYPH_SIZE;V._angle=x;V._justify=A.getJustification(y||"center");V._xAlignD=A.getXAnchorDirection(y||"center");V._yAlignD=A.getYAnchorDirection(w||"baseline");V._baseline="baseline"===(w||"baseline");V._bitset=(z===D.Alignment.MAP?1:0)|(C?1:0)<<1;e=f.MaterialKeyBase.load(e);e.sdf=!0;V._materialKey=e.data;V._lineWidth=F.pt2px(G)||512;V._lineHeight=H||1;V._textPlacement=I;V._effects=J;V._isCIM=L??!1;V._minMaxZoom=h.i1616to32(Math.round(K*m.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(S*m.MIN_MAX_ZOOM_PRECISION_FACTOR));
return V}n._inherits(g,b);g.fromText=function(e,k){const p=e.font?.size,q=new g(e.materialKey,p,e.haloSize||0,p,e.color&&u.premultiplyAlphaRGBAArray(e.color)||0,e.haloColor&&u.premultiplyAlphaRGBAArray(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,D.Alignment.SCREEN,e.font?.decoration,!1,e.angle||0,e.xoffset||0,e.yoffset||0,e.lineWidth||0,e.lineHeight||0,null,null,!1,d.DEFAULT_MIN_ZOOM,d.DEFAULT_MAX_ZOOM,e.backgroundColor&&u.premultiplyAlphaRGBAArray(e.backgroundColor),e.borderLineColor&&
u.premultiplyAlphaRGBAArray(e.borderLineColor),e.borderLineSize),[,t]=l.bidiText(e.text);q.bindTextInfo(k??[],t);q._vertexBoundsScale=e.maxVVSize&&p?e.maxVVSize/p:1;return q};g.fromCIMText=function(e,k,p){var q=e.scaleFactor||1;const t=e.size*e.sizeRatio*q,[v,y]=d.getMinMaxZoom(e.scaleInfo,p);p=new g(e.materialKey,t,e.outlineSize*e.sizeRatio,e.referenceSize,u.premultiplyAlphaRGBA(e.color),u.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked??
!1,e.angle,e.offsetX*e.sizeRatio*q,e.offsetY*e.sizeRatio*q,512,1,e.markerPlacement,e.effects,!0,v,y,e.backgroundColor?u.premultiplyAlphaRGBA(e.backgroundColor):void 0,e.borderLineColor?u.premultiplyAlphaRGBA(e.borderLineColor):void 0,e.borderLineWidth);[,q]=l.bidiText(e.text);p.bindTextInfo(k,q);p._vertexBoundsScale=e.maxVVSize?e.maxVVSize/t:1;return p};return n._createClass(g)}(c(a))})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./shapingUtils".split(" "),
function(n,l,F,D,A,u,m,h,f){const d=m.i1616to32(4,4),c=m.i1616to32(16,4),a=m.i1616to32(4,2),b=m.i1616to32(4,6),g=[a,a,b,b],e=[a,b,a,b],k=[b,b,d,d],p=[d,d,b,b],q=[b,d,b,d],t=[d,b,d,b];return v=>function(y){function w(...r){r=y.call(this,...r)||this;r._isCIM=!1;r._vertexBoundsScale=1;r.geometryType=u.WGLGeometryType.TEXT;r._aux=m.i8888to32(0,0,r._referenceSize,r._bitset);return r}n._inherits(w,y);var z=w.prototype;z.bindTextInfo=function(r,C){this._shapingInfo=r&&r.length?f.shapeGlyphs(r,C,{scale:this._scale,
angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:A.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize}):null};z._write=function(r,C,x,E){const B=C.getDisplayId();this._writeGeometry(r,C,B,x,E)};z._writeGeometry=function(r,C,x,E,B){const G=this._shapingInfo;
if(null!=G){if(this._textPlacement)return this._writePlacedText(r,x,G,E,C,B);C=B?B.asOptimized():"esriGeometryPolygon"===C.geometryType?C.readCentroid():C.readGeometryForDisplay();if(null!=C){if(C.isPoint){const [H,I]=C.coords;return!r.hasAggregates&&r.hasPixelBufferEnabled&&(0>H||512<=H||0>I||512<=I)?void 0:this._writeGlyphs(r,x,{x:H,y:I},G)}C.forEachVertex((H,I)=>this._writeGlyphs(r,x,{x:H,y:I},G))}}};z._writePlacedText=function(r,C,x,E,B,G){var H=this._textPlacement;if(B=G||F.GeometryCursor.fromFeatureSetReaderCIM(B))if(E=
D.CIMMarkerPlacementHelper.getPlacement(B,-1,H,l.pt2px(1),r.tileKey,E.geometryEngine)){H=x.bounds;H=Math.sqrt(H.height*H.height+H.width*H.width);for(var I;I=E.next();)B=I.tx,G=-I.ty,0<=B+H&&512>B-H&&0<=G+H&&512>G-H&&(I=-I.getAngle(),x.setRotation(I),this._writeGlyphs(r,C,{x:B,y:G},x),x.setRotation(-I))}};z._writeGlyphs=function(r,C,x,E){const B=h.MaterialKeyBase.load(this._materialKey),G=m.i1616to32(Math.round(8*x.x),Math.round(8*x.y)),H=this._vertexBoundsScale,{bounds:I,background:J,glyphs:L}=E;
0<L.length&&(this._borderLineColor||this._backgroundColor)&&(B.textureBinding=L[0].textureBinding,r.recordStart(C,B.data,this.geometryType,!0),this._writeBackgroundGeometry(r,C,x,I,J),r.recordEnd());const K=2*Math.max(I.width,I.height);for(const S of E.glyphs)B.textureBinding=S.textureBinding,r.recordStart(C,B.data,this.geometryType,!0),r.vertexBounds(x.x+I.x+this._xOffset,x.y+I.y-this._yOffset,K*H,K*H),this._writeVertices(r,C,G,S),r.recordEnd()};z._writeGlyph=function(r,C,x,E,B){var G=h.MaterialKeyBase.load(this._materialKey);
const H=m.i1616to32(Math.round(8*x),Math.round(8*E));G.textureBinding=B.textureBinding;r.recordStart(C,G.data,this.geometryType,!0);G=B.bounds;const I=this._vertexBoundsScale;r.vertexBounds(x+G.x*I,E+G.y*I,G.width*I,G.height*I);this._writeVertices(r,C,H,B);r.recordEnd()};z._writeVertices=function(r,C,x,E){const B=r.vertexCount();this._writeVertexCommon(r,C,x,E);r.vertexWrite(E.offsets.upperLeft);r.vertexWrite(E.texcoords.upperLeft);r.vertexEnd();this._writeVertexCommon(r,C,x,E);r.vertexWrite(E.offsets.upperRight);
r.vertexWrite(E.texcoords.upperRight);r.vertexEnd();this._writeVertexCommon(r,C,x,E);r.vertexWrite(E.offsets.lowerLeft);r.vertexWrite(E.texcoords.lowerLeft);r.vertexEnd();this._writeVertexCommon(r,C,x,E);r.vertexWrite(E.offsets.lowerRight);r.vertexWrite(E.texcoords.lowerRight);r.vertexEnd();r.indexWrite(B+0);r.indexWrite(B+1);r.indexWrite(B+2);r.indexWrite(B+1);r.indexWrite(B+3);r.indexWrite(B+2)};z._writeVertexCommon=function(r,C,x,E){E=this._color;const B=this._haloColor,G=m.i8888to32(0,0,this._referenceSize,
this._bitset),H=m.i8888to32(0,0,this._size,this._haloSize);r.vertexWrite(x);r.vertexWrite(C);r.vertexWrite(E);r.vertexWrite(B);r.vertexWrite(H);r.vertexWrite(G);r.vertexWrite(this._minMaxZoom)};z._writeBackgroundVertex=function(r,C,x,E,B,G){const H=m.i8888to32(0,1,this._referenceSize,this._bitset),I=m.i8888to32(0,0,this._size,this._haloSize),J=m.i8888to32(0,0,0,0);r.vertexWrite(x);r.vertexWrite(C);r.vertexWrite(E);r.vertexWrite(J);r.vertexWrite(I);r.vertexWrite(H);r.vertexWrite(this._minMaxZoom);
r.vertexWrite(B);r.vertexWrite(G);r.vertexEnd()};z._writeBackgroundQuad=function(r,C,x,E,B,G){const H=r.vertexCount();this._writeBackgroundVertex(r,C,x,E,B.upperLeft,G[0]);this._writeBackgroundVertex(r,C,x,E,B.upperRight,G[1]);this._writeBackgroundVertex(r,C,x,E,B.lowerLeft,G[2]);this._writeBackgroundVertex(r,C,x,E,B.lowerRight,G[3]);r.indexWrite(H+0);r.indexWrite(H+1);r.indexWrite(H+2);r.indexWrite(H+1);r.indexWrite(H+3);r.indexWrite(H+2)};z._writeBackgroundGeometry=function(r,C,x,E,B){const G=m.i1616to32(Math.round(8*
x.x),Math.round(8*x.y)),{x:H,y:I,width:J,height:L}=E;E=2*Math.max(J,L);r.vertexBounds(x.x+H+this._xOffset,x.y+I-this._yOffset,E*this._vertexBoundsScale,E*this._vertexBoundsScale);this._backgroundColor&&this._writeBackgroundQuad(r,C,G,this._backgroundColor,B.main,[c,c,c,c]);if(this._borderLineColor||this._backgroundColor){const [K,S,W,X,Z]=this._borderLineColor&&this._borderLineSize&&0<this._borderLineSize?[g,g,e,e,this._borderLineColor]:[k,p,q,t,this._backgroundColor];this._writeBackgroundQuad(r,
C,G,Z,B.top,K);this._writeBackgroundQuad(r,C,G,Z,B.bot,S);this._writeBackgroundQuad(r,C,G,Z,B.left,W);this._writeBackgroundQuad(r,C,G,Z,B.right,X)}};return n._createClass(w)}(v)})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../CIMOperators"],function(n,l,F){let D=function(){function A(){}A.getPlacement=function(u,m,h,f,d,c){const a=F.getPlacementOperator(h);if(!a)return null;-1===m&&u.invertY();return a.execute(u,
h,f,d,c)};return l._createClass(A)}();n.CIMMarkerPlacementHelper=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../geometry/GeometryCursor","../../../../../../symbols/cim/effects/CIMEffectHelper"],function(n,l,F){return function(){function D(){this._materialKey=null}var A=D.prototype;A.bindFeature=function(u,m,h){};A.write=function(u,
m,h,f){if(this._effects&&0<this._effects.length){if(h=l.GeometryCursor.fromFeatureSetReaderCIM(m)){h.invertY();const d=F.CIMEffectHelper.executeEffects(this._effects,h,u.tileKey,f.geometryEngine);for(;h=d.next();)h.invertY(),this._write(u,m,f,h)}}else this._write(u,m,f)};A._write=function(u,m,h,f){};return n._createClass(D)}()})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),
function(n,l,F,D,A,u,m){const h=96/72;let f=function(){function d(){}d.executeEffects=function(c,a,b,g){const e=m.getEffectsInflateSize(c);a=new A.SimpleEffectCursor(a);for(const k of c)(c=u.getEffectOperator(k))&&(a=c.execute(a,k,h,b,g,e));return a};d.applyEffects=function(c,a,b){if(!c)return a;var g=m.getEffectsInflateSize(c);a=new A.SimpleEffectCursor(F.GeometryCursor.fromJSONCIM(a));for(var e of c)(c=u.getEffectOperator(e))&&(a=c.execute(a,e,1,null,b,g));g=[];for(e=null;b=a.next();)g.push(...D.collectMultipath(b)),
e=b.geometryType;return 0===g.length||null===e?null:"esriGeometryPolygon"===e?{rings:g}:{paths:g}};return l._createClass(d)}();n.CIMEffectHelper=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){return function(g){function e(k,p,q,t,v,y,w,z,r,C,x,E,B,G,H,I,J,L,K,S,W,X,Z,V){var O=g.call(this)||this;O.angle=t;O.height=w;O.width=y;O.xOffset=p*K;O.yOffset=q*K;O._markerPlacement=S||void 0;O._effects=W||void 0;O._anchorX=I;O._anchorY=J;O._minMaxZoom=f.i1616to32(Math.round(X*m.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(Z*m.MIN_MAX_ZOOM_PRECISION_FACTOR));p=(G===A.Alignment.MAP?m.BITSET_MARKER_ALIGNMENT_MAP:m.BITSET_MARKER_ALIGNMENT_SCREEN)|(x?m.BITSET_GENERIC_LOCK_COLOR:
0)|(B?m.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(E?m.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0);q=H&&H.sdf;k=d.MarkerMaterialKey.load(k);k.sdf=q;k.pattern=!0;k.textureBinding=H.textureBinding;O._materialKey=k.data;O._fillColor=v;O._outlineColor=r;O._sizeOutlineWidth=f.i8888to32(Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*w),255)),Math.round(Math.min(Math.sqrt(128*C),255)),Math.round(Math.min(Math.sqrt(128*z),255)));k.symbologyType===h.WGLSymbologyType.PIE_CHART?
(O._computedWidth=y*L*K,O._computedHeight=w*L*K,O._texUpperLeft=f.i1616to32(0,1),O._texUpperRight=f.i1616to32(1,1),O._texBottomLeft=f.i1616to32(0,0),O._texBottomRight=f.i1616to32(1,0)):O._computeSize(y,w,L,C,K,H,k.hasSizeVV(),V);O._bitestAndDistRatio=f.i1616to32(p,Math.round(64*L));v=D.create();y=F.create();O._applyTransformation(y,v);return O}n._inherits(e,g);e.fromCIMMarker=function(k,p,q){const t=k.size,v=(p&&p.width||1)/(p&&p.height||1)*k.scaleX;var y=k.scaleSymbolsProportionally&&k.frameHeight?
t/k.frameHeight:1;const w=u.premultiplyAlphaRGBA(k.color),z=u.premultiplyAlphaRGBA(k.outlineColor),r=l.pt2px(t),C=r*v,x=l.pt2px(k.offsetX||0),E=l.pt2px(k.offsetY||0);y*=l.pt2px(k.outlineWidth||0);const B=k.alignment||A.Alignment.SCREEN,G=l.pt2px(k.referenceSize),[H,I]=c.getMinMaxZoom(k.scaleInfo,q);q=k.rotation||0;k.rotateClockwise||(q=-q);let J=0,L=0;const K=k.anchorPoint;K&&(k.isAbsoluteAnchorPoint?t&&(J=K.x/(t*v),L=K.y/t):(J=K.x,L=K.y));p=new e(k.materialKey,x,E,q,w,C,r,G,z,y,k.colorLocked,k.scaleSymbolsProportionally,
!1,B,p,J,L,k.sizeRatio,k.scaleFactor??1,k.markerPlacement,k.effects,H,I,!0);p._vertexBoundsScaleX=k.maxVVSize?k.maxVVSize/C:1;p._vertexBoundsScaleY=k.maxVVSize?k.maxVVSize/r:1;return p};e.fromPictureMarker=function(k,p){const q=Math.round(l.pt2px(k.width)),t=Math.round(l.pt2px(k.height)),v=m.PICTURE_FILL_COLOR,y=Math.round(l.pt2px(k.xoffset||0)),w=Math.round(l.pt2px(k.yoffset||0));p=new e(k.materialKey,y,w,k.angle,v,q,t,t,0,0,!1,!1,!1,A.Alignment.SCREEN,p,0,0,1,1,null,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM,
!1);p._vertexBoundsScaleX=k.maxVVSize?k.maxVVSize/k.width:1;p._vertexBoundsScaleY=k.maxVVSize?k.maxVVSize/k.height:1;return p};e.fromSimpleMarker=function(k,p){const q=k.style,t=u.premultiplyAlphaRGBAArray(k.color),v=Math.round(l.pt2px(k.size));let y=v;"esriSMSTriangle"===q&&(y*=p.height/p.width);const w=Math.round(l.pt2px(k.xoffset||0)),z=Math.round(l.pt2px(k.yoffset||0));var r=k.outline;const C=(r?.color&&u.premultiplyAlphaRGBAArray(r.color))|0;r=(r?.width&&Math.round(l.pt2px(r.width)))|0;p=new e(k.materialKey,
w,z,k.angle??0,t,v,y,y,C,r,!1,!1,"esriSMSCross"===q||"esriSMSX"===q,A.Alignment.SCREEN,p,0,0,2,1,null,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM,!1);p.boundsType="esriSMSCircle"===q?"circle":"square";p._vertexBoundsScaleX=k.maxVVSize?k.maxVVSize/k.size:1;p._vertexBoundsScaleY=k.maxVVSize?k.maxVVSize/k.size:1;return p};e.fromLineSymbolMarker=function(k,p){const q=u.premultiplyAlphaRGBAArray(k.color),t=Math.round(l.pt2px(6*k.lineWidth)),v="cross"===k.style||"x"===k.style;switch(k.placement){case "begin-end":var y=
A.ExtremityPlacement.Both;break;case "begin":y=A.ExtremityPlacement.JustBegin;break;case "end":y=A.ExtremityPlacement.JustEnd;break;default:y=A.ExtremityPlacement.None}y={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:y,offsetAlongLine:0};p=new e(k.materialKey,0,0,0,q,t,t,t/6,q,v?Math.round(l.pt2px(k.lineWidth)):0,!1,!1,v,A.Alignment.MAP,p,0,0,2,1,y,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM,!1);p.boundsType="circle"===k.style?"circle":"square";return p};return n._createClass(e)}(a(b))})},
"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../../../../../geometry/GeometryCursor ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey".split(" "),function(n,
l,F,D,A,u,m,h,f,d,c,a){const b=3.14159265359/180;return g=>function(e){function k(...q){q=e.call(this,...q)||this;q.angle=0;q.xOffset=0;q.yOffset=0;q.width=0;q.height=0;q.boundsType="square";q._anchorX=0;q._anchorY=0;q._computedWidth=0;q._computedHeight=0;q._allowBorrowing=!0;q._vertexBoundsScaleX=1;q._vertexBoundsScaleY=1;q.geometryType=d.WGLGeometryType.MARKER;return q}n._inherits(k,e);var p=k.prototype;p._write=function(q,t,v,y){const w=t.getDisplayId();q.recordStart(w,this._materialKey,this.geometryType,
!0);this._writeGeometry(q,t,w,v,y);q.recordEnd()};p._writeGeometry=function(q,t,v,y,w){if(null!=this._markerPlacement)return this._writePlacedMarkers(q,t,y,w);this._allowBorrowing=!0;if(!w&&"esriGeometryPoint"===t.geometryType)return y=t.getX(),t=t.getY(),!q.hasAggregates&&q.hasPixelBufferEnabled&&(0>y||513<=y||0>t||513<=t)?void 0:this._writeVertices(q,v,this._getPos(y,t),y,t);t=w?w.asOptimized():"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(null!=t){if(t.isPoint){const [z,
r]=t.coords;return!q.hasAggregates&&q.hasPixelBufferEnabled&&(0>z||512<=z||0>r||512<=r)?void 0:this._writeVertices(q,v,this._getPos(z,r),z,r)}t.forEachVertex((z,r)=>{const C=2*f.TILE_SIZE;z<-C||z>=C||r<-C||r>=C||this._writeVertices(q,v,this._getPos(z,r),z,r)})}};p._writePlacedMarkers=function(q,t,v,y){if(y=y||m.GeometryCursor.fromFeatureSetReaderCIM(t))if(v=h.CIMMarkerPlacementHelper.getPlacement(y,-1,this._markerPlacement,l.pt2px(1),q.tileKey,v.geometryEngine)){this._allowBorrowing="esriGeometryPolygon"!==
t.geometryType;t=t.getDisplayId();y=u.create();for(var w=D.create(),z=v.next();null!=z;){const r=z.tx,C=-z.ty;-128<=r&&640>=r&&-128<=C&&640>=C&&(this._applyTransformation(w,y,-z.getAngle()/b),this._writeVertices(q,t,this._getPos(r,C),r,C));z=v.next()}}};p._writeVertices=function(q,t,v,y,w){const z=a.MarkerMaterialKey.load(this._materialKey);switch(z.symbologyType){case d.WGLSymbologyType.HEATMAP:return this._writeHeatmapVertices(q,t,v);default:return this._writeMarkerVertices(q,t,z,v,y,w)}};p._writeMarkerVertices=
function(q,t,v,y,w,z){var r=v.vvRotation;v=q.vertexCount();let C=this._computedWidth*this._vertexBoundsScaleX;var x=this._computedHeight*this._vertexBoundsScaleY;this.angle&&(C=x=Math.max(C,x));r&&(r=Math.max(this.xOffset,this.yOffset),C+=r,x+=r);this._allowBorrowing&&q.vertexBounds(w+this.xOffset,z-this.yOffset,C,x);q.vertexWrite(y);q.vertexWrite(this._offsetUpperLeft);q.vertexWrite(this._texUpperLeft);q.vertexWrite(this._bitestAndDistRatio);q.vertexWrite(t);q.vertexWrite(this._fillColor);q.vertexWrite(this._outlineColor);
q.vertexWrite(this._sizeOutlineWidth);q.vertexWrite(this._minMaxZoom);q.vertexEnd();q.vertexWrite(y);q.vertexWrite(this._offsetUpperRight);q.vertexWrite(this._texUpperRight);q.vertexWrite(this._bitestAndDistRatio);q.vertexWrite(t);q.vertexWrite(this._fillColor);q.vertexWrite(this._outlineColor);q.vertexWrite(this._sizeOutlineWidth);q.vertexWrite(this._minMaxZoom);q.vertexEnd();q.vertexWrite(y);q.vertexWrite(this._offsetBottomLeft);q.vertexWrite(this._texBottomLeft);q.vertexWrite(this._bitestAndDistRatio);
q.vertexWrite(t);q.vertexWrite(this._fillColor);q.vertexWrite(this._outlineColor);q.vertexWrite(this._sizeOutlineWidth);q.vertexWrite(this._minMaxZoom);q.vertexEnd();q.vertexWrite(y);q.vertexWrite(this._offsetBottomRight);q.vertexWrite(this._texBottomRight);q.vertexWrite(this._bitestAndDistRatio);q.vertexWrite(t);q.vertexWrite(this._fillColor);q.vertexWrite(this._outlineColor);q.vertexWrite(this._sizeOutlineWidth);q.vertexWrite(this._minMaxZoom);q.vertexEnd();this._writeIndices(q,v)};p._writeHeatmapVertices=
function(q,t,v){const y=q.vertexCount();q.vertexWrite(v);q.vertexWrite(this._offsetUpperLeft);q.vertexWrite(t);q.vertexEnd();q.vertexWrite(v);q.vertexWrite(this._offsetUpperRight);q.vertexWrite(t);q.vertexEnd();q.vertexWrite(v);q.vertexWrite(this._offsetBottomLeft);q.vertexWrite(t);q.vertexEnd();q.vertexWrite(v);q.vertexWrite(this._offsetBottomRight);q.vertexWrite(t);q.vertexEnd();this._writeIndices(q,y)};p._writeIndices=function(q,t){q.indexWrite(t+0);q.indexWrite(t+1);q.indexWrite(t+2);q.indexWrite(t+
1);q.indexWrite(t+3);q.indexWrite(t+2)};p._applyTransformation=function(q,t,v=0){v?F.fromRotation(q,b*v):F.identity(q);F.translate(q,q,u.fromValues(this.xOffset,-this.yOffset));this.angle&&F.rotate(q,q,b*this.angle);v=this._computedWidth;const y=this._computedHeight,w=-(.5+this._anchorX)*v,z=-(.5-this._anchorY)*y;A.set(t,w,z);A.transformMat2d(t,t,q);this._offsetUpperLeft=c.i1616to32(16*t[0],16*t[1]);A.set(t,w+v,z);A.transformMat2d(t,t,q);this._offsetUpperRight=c.i1616to32(16*t[0],16*t[1]);A.set(t,
w,z+y);A.transformMat2d(t,t,q);this._offsetBottomLeft=c.i1616to32(16*t[0],16*t[1]);A.set(t,w+v,z+y);A.transformMat2d(t,t,q);this._offsetBottomRight=c.i1616to32(16*t[0],16*t[1])};p._computeSize=function(q,t,v,y,w,z,r,C){const x=q*v;v*=t;z.sdf&&!r?(y+=2,q=Math.min((C&&q>t?x:q)+y,x),t=Math.min(t+y,v)):(q=x,t=v);C=f.SDF_TEXTURE_SIZE/Math.max(x,v);r=.5*(x-q)*C;var E=.5*(v-t)*C;C=z.rect.x+f.SPRITE_PADDING+r;y=z.rect.y+f.SPRITE_PADDING+E;r=C+z.width-2*r;z=y+z.height-2*E;E=Math.floor(C);const B=Math.floor(y),
G=Math.ceil(r),H=Math.ceil(z);q*=(G-E)/(r-C);t*=(H-B)/(z-y);this._texUpperLeft=c.i1616to32(E,B);this._texUpperRight=c.i1616to32(G,B);this._texBottomLeft=c.i1616to32(E,H);this._texBottomRight=c.i1616to32(G,H);this._anchorX*=x/q;this._anchorY*=v/t;this._computedWidth=q*w;this._computedHeight=t*w};p._getPos=function(q,t){return c.i1616to32(Math.round(8*q),Math.round(8*t))};return n._createClass(k)}(g)})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaultsJSON ../../enums ../../materialKey/MaterialKey ./WGLDynamicFillTemplate ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/Lock ../../util/Result ../../../../layers/features/textUtils ../../../../layers/support/cimSymbolUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t,v){function y(B,G){const H=B.length;B.push(null);G.then(I=>B[H]=I);return B}function w(B){return null!=B&&!!(B&1)}const z=D.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),r={sortKey:null,templates:[]};D={isOutline:!1,placement:null,symbologyType:m.WGLSymbologyType.DEFAULT,vvFlags:0};const C={...u.errorPointSymbolJSON,hash:JSON.stringify(u.errorPointSymbolJSON),materialKey:h.createMaterialKey(m.WGLGeometryType.MARKER,D)},x={...u.errorPolylineSymbolJSON,
hash:JSON.stringify(u.errorPolylineSymbolJSON),materialKey:h.createMaterialKey(m.WGLGeometryType.LINE,D)},E={...u.errorPolygonSymbolJSON,hash:JSON.stringify(u.errorPolygonSymbolJSON),materialKey:h.createMaterialKey(m.WGLGeometryType.FILL,D)};u=function(){function B(H,I){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=new Map;this._cimAnalyses=[];this._lock=new p.Lock;this._fetchResource=
H;this._tileInfo=I}var G=B.prototype;G.createTemplateGroup=function(H,I,J=null){this._initErrorTemplates();const L=H.hash;var K=this._symbolToTemplate.get(L);if(null!=K)return K;K=[];J={sortKey:J,templates:K};I&&this._createMeshTemplates(K,I,!0);this._createMeshTemplates(K,H,!1);I=this._createGroupId;if(K="expanded-cim"===H.type)a:{if(H.layers)for(const S of H.layers)if("function"===typeof S.materialHash){K=!0;break a}K=!1}H=I.call(this,K);this._idToTemplateGroup.set(H,J);this._symbolToTemplate.set(L,
H);return H};G.getTemplateGroup=function(H){return this._idToTemplateGroup.get(H)??r};G.getDynamicTemplateGroup=function(H){if(!this._idToTemplateGroup.has(H))return r;w(H)||z.error("mapview-template-store",`Id ${H} does not refer to a dynamic template`);return this._idToTemplateGroup.get(H)};G.getMosaicItem=function(H,I){const J=this._createTemplateId(),L=new Promise(K=>this._idToResolver.set(J,K));this._fetchQueue.push({symbol:H,id:J,glyphIds:I});return L};G.finalize=function(H){return this._fetchQueue.length||
this._lock.isHeld()?p.withLock(this._lock,this._fetchAllQueuedResources.bind(this),H):Promise.resolve()};G._initErrorTemplates=function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],E,!1),marker:this._createMeshTemplates([],C,!1),line:this._createMeshTemplates([],x,!1)})};G._fetchAllQueuedResources=function(H){if(!this._fetchQueue.length)return Promise.resolve();const I=this._fetchQueue,J=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return Promise.all(J).then(()=>
this._fetchResource(I,H).then(L=>{for(const {id:K,mosaicItem:S}of L)this._idToResolver.get(K)(S),this._idToResolver.delete(K)})).catch(L=>{A.isAbortError(L)?this._fetchQueue=this._fetchQueue.concat(I):"worker:port-closed"!==L.name&&z.error(new F("mapview-template-store","Unable to fetch requested texture resources",L))})};G._createGroupId=function(H){return this._idCounter++<<1|(H?1:0)};G._createTemplateId=function(){return this._templateIdCounter++};G._createSMS=async function(H){const {spriteMosaicItem:I}=
await this.getMosaicItem(H);return q.ok(I,z)?e.fromSimpleMarker(H,I):this._markerError};G._createPMS=async function(H){const {spriteMosaicItem:I}=await this.getMosaicItem(H);return q.ok(I,z)?e.fromPictureMarker(H,I):this._markerError};G._createSFS=async function(H,I){const {spriteMosaicItem:J}=await this.getMosaicItem(H);return q.ok(J,z)?b.fromSimpleFill(H,J,I):this._fillError};G._createPFS=async function(H,I){const {spriteMosaicItem:J}=await this.getMosaicItem(H);return q.ok(J,z)?b.fromPictureFill(H,
J,I):this._fillError};G._createSLS=async function(H,I){({spriteMosaicItem:I}=await this.getMosaicItem(H));return q.ok(I,z)?g.fromSimpleLine(H,I):this._lineError};G._createLMS=async function(H){const {spriteMosaicItem:I}=await this.getMosaicItem(H);return q.ok(I,z)?e.fromLineSymbolMarker(H,I):this._markerError};G._createTS=async function(H){const {glyphMosaicItems:I}=await this.getMosaicItem(H);return k.fromText(H,I??[])};G._createCIMText=async function(H){const {glyphMosaicItems:I}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(H),
t.codepoints(H.text));return q.ok(I,z)?k.fromCIMText(H,I,this._tileInfo):this._textError};G._createCIMFill=async function(H){const {spriteMosaicItem:I}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(H));return q.ok(I,z)?b.fromCIMFill(H,I,this._tileInfo):this._fillError};G._createCIMLine=async function(H){const {spriteMosaicItem:I}=await this.getMosaicItem(v.cimLayerToRasterizationInfo(H));return q.ok(I,z)?g.fromCIMLine(H,I,this._tileInfo):this._lineError};G._createCIMMarker=async function(H){const {spriteMosaicItem:I}=
await this.getMosaicItem(v.cimLayerToRasterizationInfo(H));return q.ok(I,z)?e.fromCIMMarker(H,I,this._tileInfo):this._markerError};G._createCIM=async function(H){const I=H.templateHash;let J=this._cimTemplateCache.get(I);if(null!=J)return J;switch(H.type){case "marker":J=await this._createCIMMarker(H);break;case "line":J=await this._createCIMLine(H);break;case "fill":J=await this._createCIMFill(H);break;case "text":J=await this._createCIMText(H)}this._cimTemplateCache.set(I,J);return J};G._createDynamicCIM=
async function(H){const I=H.templateHash;let J=this._cimTemplateCache.get(I);if(null!=J)return J;switch(H.type){case "marker":J=c.fromCIMMarker(H,this._tileInfo);break;case "line":J=d.fromCIMLine(H,this._tileInfo);break;case "fill":J=f.fromCIMFill(H,this._tileInfo);break;case "text":J=a.fromCIMText(H,this._tileInfo)}this._cimTemplateCache.set(I,J);return J};G._createPrimitiveMeshTemplates=function(H,I,J){switch(I.type){case "esriSMS":return y(H,this._createSMS(I));case "esriPMS":return y(H,this._createPMS(I));
case "esriSFS":return y(H,this._createSFS(I,J));case "line-marker":return y(H,this._createLMS(I));case "esriPFS":return y(H,this._createPFS(I,J));case "esriSLS":return y(H,this._createSLS(I,!1));case "esriTS":return y(H,this._createTS(I));default:return z.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),H}};G._createMeshTemplates=function(H,I,J){if(I.type.includes("3d"))return z.error("3D symbols are not supported with MapView"),H;if("expanded-cim"===I.type){for(const L of I.layers)"function"===
typeof L.materialHash?y(H,this._createDynamicCIM(L)):y(H,this._createCIM(L));return H}if("composite-symbol"===I.type){for(const L of I.layers)this._createPrimitiveMeshTemplates(H,L,J);return H}return"cim"===I.type||"label"===I.type||"web-style"===I.type?H:this._createPrimitiveMeshTemplates(H,I,J)};l._createClass(B,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},
{key:"_textError",get:function(){return this._errorTemplates.line[0]}}]);return B}();n.WGLTemplateStore=u;n.errorPointSchema2D=C;n.errorPolygonSchema2D=E;n.errorPolylineSchema2D=x;n.isDynamicId=w;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicFillTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){return function(b){function g(e,k,p){var q=b.call(this,e)||this;q._minMaxZoom=m.i1616to32(Math.round(k*A.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(p*A.MIN_MAX_ZOOM_PRECISION_FACTOR));F.isFeatureValueFn(e.color)?q._dynamicPropertyMap.set("fillColor",(r,C,x)=>(r=e.color(r,C,x))&&D.premultiplyAlphaRGBA(r)||0):(k=e.color,q.fillColor=k&&D.premultiplyAlphaRGBA(k)||0);const t="CIMMarkerPlacementInsidePolygon"===e.cim.placement?.type&&e.cim.placement.shiftOddRows?2:1,v=e.height;
F.isFeatureValueFn(v)?q._dynamicPropertyMap.set("_height",(r,C,x)=>v(r,C,x)*t):q._height=(v||0)*t;const y=e.offsetX;F.isFeatureValueFn(y)?q._dynamicPropertyMap.set("_offsetX",(r,C,x)=>l.pt2px(y(r,C,x))):q._offsetX=l.pt2px(y||0);const w=e.offsetY;F.isFeatureValueFn(w)?q._dynamicPropertyMap.set("_offsetY",(r,C,x)=>l.pt2px(-w(r,C,x))):q._offsetY=l.pt2px(-w||0);k=e.scaleX;F.isFeatureValueFn(k)?q._dynamicPropertyMap.set("_scaleX",k):q._scaleX=k||1;const z=e.angle;F.isFeatureValueFn(z)?q._dynamicPropertyMap.set("_angle",
(r,C,x)=>u.degToByte(z(r,C,x))):q._angle=u.degToByte(z)||0;null!=e.effects&&(k=e.effects,F.isFeatureValueFn(k)?q._dynamicPropertyMap.set("_effects",k):q._effects=k);q._cimFillLayer=e;q._bitset=(e.colorLocked?A.BITSET_GENERIC_LOCK_COLOR:0)|(e.applyRandomOffset?A.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(e.sampleAlphaOnly?A.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(e.hasUnresolvedReplacementColor?A.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);q._fillMaterialKey=e.materialKey;return q}n._inherits(g,b);g.fromCIMFill=
function(e,k){const [p,q]=f.getMinMaxZoom(e.scaleInfo,k);return new g(e,p,q)};g.prototype.bindFeature=function(e,k,p){const q=e.readLegacyFeature();this._dynamicPropertyMap.forEach((y,w)=>{this[w]=y(q,k,p)});e=h.FillMaterialKey.load(this._fillMaterialKey);var t=this._materialCache,v=this._cimFillLayer.materialHash;v=v(q,k,p);v=t.get(v);t=null;v&&a.ok(v.spriteMosaicItem)&&(t=v.spriteMosaicItem);if(t){const {rect:y,width:w,height:z}=t;v=y.x+A.SPRITE_PADDING;const r=y.y+A.SPRITE_PADDING,C=v+w,x=r+z;
let E=l.pt2px(this._height);0>=E&&(E=x-r);E<A.MAX_SIZE_FOR_U16_COMPRESSION&&(E*=A.COMPRESSION_FACTOR_FOR_U16,this._bitset|=A.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR);E=Math.round(E);let B=l.pt2px(this._height/z*w);0>=B&&(B=C-v);B<A.MAX_SIZE_FOR_U16_COMPRESSION&&(B*=A.COMPRESSION_FACTOR_FOR_U16,this._bitset|=A.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR);B=Math.round(B);const G=this._scaleX;this.tl=m.i1616to32(v,r);this.br=m.i1616to32(C,x);this.aux21=m.i1616to32(B,E);this.aux22=m.i1616to32(this._offsetX,
this._offsetY);this.aux3=m.i8888to32(G*A.COMPRESSION_FACTOR_FOR_U16,1*A.COMPRESSION_FACTOR_FOR_U16,this._angle,0);e.sdf=t.sdf;e.pattern=!0;e.textureBinding=t.textureBinding}else this.aux3=this.aux22=this.aux21=this.br=this.tl=0,e.sdf=!1,e.pattern=!1,e.textureBinding=0;this._materialKey=e.data};return n._createClass(g)}(d(c))})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseFillTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../enums ../../number ../../Utils ../../materialKey/MaterialKey ./templateUtils ./WGLLineTemplate".split(" "),
function(n,l,F,D,A,u,m){return h=>function(f){function d(...a){a=f.call(this,...a)||this;a.forceLibtess=!1;a._bitset=0;a._lineTemplate=null;a.geometryType=l.WGLGeometryType.FILL;return a}n._inherits(d,f);var c=d.prototype;c._maybeAddLineTemplate=function(a){this._lineTemplate=m.fromFillOutline(a)};c._write=function(a,b,g,e){g="esriGeometryPoint"===b.geometryType;const k=A.FillMaterialKey.load(this._materialKey);a.recordStart(b.getDisplayId(),this._materialKey,this.geometryType,g);this._writeGeometry(a,
b,k,e,g);A.hasOutlineFillSymbology(k)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(a,b,e,g);a.recordEnd()};c._writeGeometry=function(a,b,g,e,k){e=this._getGeometry(b,e,k);null!=e&&(k=[],100<e.maxLength||this.forceLibtess||!u.triangulate(k,e)?(e=u.triangulateLibtess(e),this._writeVertices(a,b,e,[e.length/2],g)):k.length&&this._writeVertices(a,b,e.coords,e.lengths,g,k))};c._writeVertex=function(a,b,g,e,k,p){const q=F.i1616to32(1*e,1*k);a.vertexBounds(e,k,0,0);a.vertexWrite(q);a.vertexWrite(b);
g.symbologyType===l.WGLSymbologyType.DOT_DENSITY?a.vertexWriteF32(1/Math.abs(p.readGeometryArea())):(a.vertexWrite(this.fillColor),b=A.hasSimpleSymbology(g),b||(a.vertexWrite(this.tl),a.vertexWrite(this.br)),a.vertexWrite(this.aux21),a.vertexWrite(this.aux22),a.vertexWrite(this.aux3),b||a.vertexWrite(this._minMaxZoom))};c._writeVertices=function(a,b,g,e,k,p){var q=b.getDisplayId();q|=this._bitset<<24;var t=e.reduce((y,w)=>y+w);const v=D.getStrides(k.geometryType,k.symbologyType).geometry/4;e=a.vertexCount();
a.vertexEnsureSize(v*t);t=0;if(p)for(const y of p)this._writeVertex(a,q,k,g[2*y],g[2*y+1],b),t++;else for(p=0;p<g.length;p+=2)this._writeVertex(a,q,k,Math.round(g[p]),Math.round(g[p+1]),b),t++;a.indexEnsureSize(t);for(b=0;b<t;b++)a.indexWrite(b+e)};c._getGeometry=function(a,b,g){return(a=b?.asOptimized()||a.readGeometryForDisplay())?u.clipMarshall(a,g?256:8):null};return n._createClass(d)}(h)})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(n,l,F,D,A,u,m){function h(a,b,g){let e=0;for(let k=1;k<g;k++)e+=(a[2*(b+k)]-a[2*(b+k-1)])*(a[2*(b+k)+1]+a[2*(b+k-1)+1]);return e}function f(a,b,g,e,k){let p=0;for(;g<e;g+=3){const q=2*(a[g]-k),t=2*(a[g+1]-k),v=2*(a[g+2]-k);p+=Math.abs((b[q]-b[v])*(b[t+1]-b[q+1])-(b[q]-b[t])*(b[v+1]-b[q+1]))}return p}const d=new D.TileClipper(0,0,0,1,0),c=new D.TileClipper(0,0,0,1,0);d.setExtent(u.TILE_SIZE);c.setExtent(u.TILE_SIZE);n.area=h;n.clipLinesMarshall=function(a,b){c.setPixelMargin(b);const g=-b;
b=u.TILE_SIZE+b;let e=[];var k=!1;if(!a.nextPath())return null;let p=!0;for(;p;){a.seekPathStart();const q=[];if(!a.numPoints)return null;c.reset(D.GeometryType.LineString);a.nextPoint();let t=a.x,v=a.y;if(k)c.moveTo(t,v);else{if(t<g||t>b||v<g||v>b){k=!0;continue}q.push({x:t,y:v})}let y=!1;for(;a.nextPoint();)if(t=a.x,v=a.y,k)c.lineTo(t,v);else{if(t<g||t>b||v<g||v>b){y=!0;break}q.push({x:t,y:v})}if(y)k=!0;else{if(k){if(k=c.resultWithStarts())for(const w of k)e.push(w)}else e.push({line:q,start:0});
p=a.nextPath();k=!1}}e=e.filter(q=>1<q.line.length);return 0===e.length?null:e};n.clipMarshall=function(a,b){if(null==a)return null;a:{var g=u.TILE_SIZE+128;var e=0;for(var k=0;k<a.lengths.length;k++){var p=a.lengths[k];for(var q=0;q<p;q++){const t=a.coords[2*(q+e)],v=a.coords[2*(q+e)+1];if(-128>t||t>g||-128>v||v>g){g=!0;break a}}e+=p}g=!1}if(!g)return a;d.setPixelMargin(b);d.reset(D.GeometryType.Polygon);b=0;for(g=0;g<a.lengths.length;g++){e=a.lengths[g];k=a.coords[2*(0+b)];p=a.coords[2*(0+b)+1];
d.moveTo(k,p);for(q=1;q<e;q++)k=a.coords[2*(q+b)],p=a.coords[2*(q+b)+1],d.lineTo(k,p);d.close();b+=e}g=d.result(!1);if(!g)return null;a=[];b=[];for(const t of g){g=0;for(const v of t)b.push(v.x),b.push(v.y),g++;a.push(g)}return new A(a,b)};n.triangleAreaArray=f;n.triangulate=function(a,b){const {coords:g,lengths:e,hasIndeterminateRingOrder:k}=b;if(k)return!1;b=0;for(var p=0;p<e.length;){let v=p,y=e[p];p=h(g,b,y);for(var q=[];++v<e.length;){var t=e[v];const w=h(g,b+y,t);if(!(0<w))break;p+=w;q.push(b+
y);y+=t}t=a.length;m.bufcut(a,g,b,b+y,q,2,0);q=f(a,g,t,a.length,0);p=Math.abs(p);if(1E-5<Math.abs((q-p)/Math.max(1E-7,p)))return a.length=0,!1;p=v;b+=y}return!0};n.triangulateEarcut=function(a,b,g){const {coords:e,lengths:k,hasIndeterminateRingOrder:p}=b;if(p)return!1;let q=0;for(var t=0;t<k.length;){let y=t,w=k[t];for(t=[];++y<k.length;){var v=k[y];if(!(0<h(e,q+w,v)))break;t.push(q+w-q);w+=v}v=b.coords.slice(2*q,2*(q+w));t=l.earcut(v,t,2);for(const z of t)a.push(z+g+q);t=y;q+=w}return!0};n.triangulateLibtess=
function(a){const {coords:b,lengths:g}=a;({buffer:a}=F.triangulate(b,g));return a};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(n,l){var F={exports:{}};F.exports;(function(D){(function(A){A=A();void 0!==A&&(D.exports=A)})(function(){function A(x,E,B){B=B||2;var G=E&&E.length,H=G?E[0]*B:x.length,I=u(x,0,H,B,!0),J=[];if(!I||I.next===I.prev)return J;var L;if(G){var K=I;var S=B;I=[];var W;G=0;for(W=E.length;G<
W;G++){var X=E[G]*S;var Z=G<W-1?E[G+1]*S:x.length;X=u(x,X,Z,S,!1);X===X.next&&(X.steiner=!0);Z=I;var V=Z.push,O=X,P=X;do{if(O.x<P.x||O.x===P.x&&O.y<P.y)P=O;O=O.next}while(O!==X);V.call(Z,P)}I.sort(d);for(G=0;G<I.length;G++)S=I[G],E=K,(K=a(S,E))?(W=y(K,S),S=m(K,K.next),W=c(W),m(W,W.next),S=c(S),K=c(E===K?S:E)):K=E,K=m(K,K.next);I=K}if(x.length>80*B){var M=L=x[0];var Q=G=x[1];for(S=B;S<H;S+=B)E=x[S],K=x[S+1],E<M&&(M=E),K<Q&&(Q=K),E>L&&(L=E),K>G&&(G=K);L=Math.max(L-M,G-Q);L=0!==L?1/L:0}h(I,J,B,M,Q,L);
return J}function u(x,E,B,G,H){if(H===0<C(x,E,B,G))for(H=E;H<B;H+=G)var I=w(H,x[H],x[H+1],I);else for(H=B-G;H>=E;H-=G)I=w(H,x[H],x[H+1],I);I&&k(I,I.next)&&(x=I.next,z(I),I=x);return I}function m(x,E){if(!x)return x;E||(E=x);do{var B=!1;if(x.steiner||!k(x,x.next)&&0!==e(x.prev,x,x.next))x=x.next;else{E=x.prev;z(x);x=E;if(x===x.next)break;B=!0}}while(B||x!==E);return E}function h(x,E,B,G,H,I,J){if(x){if(!J&&I){var L=x,K=L;do null===K.z&&(K.z=b(K.x,K.y,G,H,I)),K.prevZ=K.prev,K=K.nextZ=K.next;while(K!==
L);K.prevZ.nextZ=null;K.prevZ=null;L=K;var S,W,X,Z,V=1;do{K=L;var O=L=null;for(W=0;K;){W++;var P=K;for(S=X=0;S<V&&(X++,P=P.nextZ,P);S++);for(Z=V;0<X||0<Z&&P;)0!==X&&(0===Z||!P||K.z<=P.z)?(S=K,K=K.nextZ,X--):(S=P,P=P.nextZ,Z--),O?O.nextZ=S:L=S,S.prevZ=O,O=S;K=P}O.nextZ=null;V*=2}while(1<W)}for(L=x;x.prev!==x.next;){K=x.prev;P=x.next;if(I)O=f(x,G,H,I);else a:if(O=x,W=O.prev,X=O,V=O.next,0<=e(W,X,V))O=!1;else{for(S=O.next.next;S!==O.prev;){if(g(W.x,W.y,X.x,X.y,V.x,V.y,S.x,S.y)&&0<=e(S.prev,S,S.next)){O=
!1;break a}S=S.next}O=!0}if(O)E.push(K.i/B),E.push(x.i/B),E.push(P.i/B),z(x),L=x=P.next;else if(x=P,x===L){if(!J)h(m(x),E,B,G,H,I,1);else if(1===J){x=m(x);J=E;L=B;K=x;do P=K.prev,O=K.next.next,!k(P,O)&&p(P,K,K.next,O)&&v(P,O)&&v(O,P)&&(J.push(P.i/L),J.push(K.i/L),J.push(O.i/L),z(K),z(K.next),K=x=O),K=K.next;while(K!==x);x=m(K);h(x,E,B,G,H,I,2)}else if(2===J)a:{J=x;do{for(L=J.next.next;L!==J.prev;){if(K=J.i!==L.i){O=O=O=O=void 0;K=J;P=L;if(O=K.next.i!==P.i&&K.prev.i!==P.i){b:{O=K;do{if(O.i!==K.i&&
O.next.i!==K.i&&O.i!==P.i&&O.next.i!==P.i&&p(O,O.next,K,P)){O=!0;break b}O=O.next}while(O!==K);O=!1}O=!O}if(O){if(O=v(K,P)&&v(P,K)){O=K;W=!1;X=(K.x+P.x)/2;V=(K.y+P.y)/2;do O.y>V!==O.next.y>V&&O.next.y!==O.y&&X<(O.next.x-O.x)*(V-O.y)/(O.next.y-O.y)+O.x&&(W=!W),O=O.next;while(O!==K);O=W}O=O&&(e(K.prev,K,P.prev)||e(K,P.prev,P))||k(K,P)&&0<e(K.prev,K,K.next)&&0<e(P.prev,P,P.next)}K=O}if(K){x=y(J,L);J=m(J,J.next);x=m(x,x.next);h(J,E,B,G,H,I);h(x,E,B,G,H,I);break a}L=L.next}J=J.next}while(J!==x)}break}}}}
function f(x,E,B,G){var H=x.prev,I=x.next;if(0<=e(H,x,I))return!1;var J=H.x>x.x?H.x>I.x?H.x:I.x:x.x>I.x?x.x:I.x,L=H.y>x.y?H.y>I.y?H.y:I.y:x.y>I.y?x.y:I.y,K=b(H.x<x.x?H.x<I.x?H.x:I.x:x.x<I.x?x.x:I.x,H.y<x.y?H.y<I.y?H.y:I.y:x.y<I.y?x.y:I.y,E,B,G);E=b(J,L,E,B,G);B=x.prevZ;for(G=x.nextZ;B&&B.z>=K&&G&&G.z<=E;){if(B!==x.prev&&B!==x.next&&g(H.x,H.y,x.x,x.y,I.x,I.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ;if(G!==x.prev&&G!==x.next&&g(H.x,H.y,x.x,x.y,I.x,I.y,G.x,G.y)&&0<=e(G.prev,G,G.next))return!1;
G=G.nextZ}for(;B&&B.z>=K;){if(B!==x.prev&&B!==x.next&&g(H.x,H.y,x.x,x.y,I.x,I.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ}for(;G&&G.z<=E;){if(G!==x.prev&&G!==x.next&&g(H.x,H.y,x.x,x.y,I.x,I.y,G.x,G.y)&&0<=e(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function d(x,E){return x.x-E.x}function c(x){if(x.next.prev===x)return x;let E=x;do{const B=E.next;if(B.prev===E||B===E||B===x)break;E=B}while(1);return E}function a(x,E){var B=E,G=x.x,H=x.y,I=-Infinity;do{if(H<=B.y&&H>=B.next.y&&B.next.y!==
B.y){var J=B.x+(H-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(J<=G&&J>I){I=J;if(J===G){if(H===B.y)return B;if(H===B.next.y)return B.next}var L=B.x<B.next.x?B:B.next}}B=B.next}while(B!==E);if(!L)return null;if(G===I)return L;E=L;J=L.x;var K=L.y,S=Infinity;B=L;do{if(G>=B.x&&B.x>=J&&G!==B.x&&g(H<K?G:I,H,J,K,H<K?I:G,H,B.x,B.y)){var W=Math.abs(H-B.y)/(G-B.x);var X;if((X=v(B,x))&&!(X=W<S)&&(X=W===S)&&!(X=B.x>L.x)&&(X=B.x===L.x)){X=L;var Z=B;X=0>e(X.prev,X,Z.prev)&&0>e(Z.next,X,X.next)}X&&(L=B,S=W)}B=B.next}while(B!==
E);return L}function b(x,E,B,G,H){x=32767*(x-B)*H;E=32767*(E-G)*H;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;return(x|x<<1)&1431655765|((E|E<<1)&1431655765)<<1}function g(x,E,B,G,H,I,J,L){return 0<=(H-J)*(E-L)-(x-J)*(I-L)&&0<=(x-J)*(G-L)-(B-J)*(E-L)&&0<=(B-J)*(I-L)-(H-J)*(G-L)}function e(x,E,B){return(E.y-x.y)*(B.x-E.x)-(E.x-x.x)*(B.y-E.y)}function k(x,E){return x.x===E.x&&x.y===E.y}function p(x,E,B,G){var H=t(e(x,E,
B)),I=t(e(x,E,G)),J=t(e(B,G,x)),L=t(e(B,G,E));return H!==I&&J!==L||0===H&&q(x,B,E)||0===I&&q(x,G,E)||0===J&&q(B,x,G)||0===L&&q(B,E,G)?!0:!1}function q(x,E,B){return E.x<=Math.max(x.x,B.x)&&E.x>=Math.min(x.x,B.x)&&E.y<=Math.max(x.y,B.y)&&E.y>=Math.min(x.y,B.y)}function t(x){return 0<x?1:0>x?-1:0}function v(x,E){return 0>e(x.prev,x,x.next)?0<=e(x,E,x.next)&&0<=e(x,x.prev,E):0>e(x,E,x.prev)||0>e(x,x.next,E)}function y(x,E){var B=new r(x.i,x.x,x.y),G=new r(E.i,E.x,E.y),H=x.next,I=E.prev;x.next=E;E.prev=
x;B.next=H;H.prev=B;G.next=B;B.prev=G;I.next=G;G.prev=I;return G}function w(x,E,B,G){x=new r(x,E,B);G?(x.next=G.next,x.prev=G,G.next.prev=x,G.next=x):(x.prev=x,x.next=x);return x}function z(x){x.next.prev=x.prev;x.prev.next=x.next;x.prevZ&&(x.prevZ.nextZ=x.nextZ);x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function r(x,E,B){this.i=x;this.x=E;this.y=B;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function C(x,E,B,G){for(var H=0,I=B-G;E<B;E+=G)H+=(x[I]-x[E])*(x[E+1]+x[I+1]),I=E;return H}
A.deviation=function(x,E,B,G){var H=E&&E.length,I=Math.abs(C(x,0,H?E[0]*B:x.length,B));if(H){H=0;for(var J=E.length;H<J;H++)I-=Math.abs(C(x,E[H]*B,H<J-1?E[H+1]*B:x.length,B))}for(H=E=0;H<G.length;H+=3){J=G[H]*B;var L=G[H+1]*B,K=G[H+2]*B;E+=Math.abs((x[J]-x[K])*(x[L+1]-x[J+1])-(x[J]-x[L])*(x[K+1]-x[J+1]))}return 0===I&&0===E?0:Math.abs((E-I)/I)};A.flatten=function(x){for(var E=x[0][0].length,B={vertices:[],holes:[],dimensions:E},G=0,H=0;H<x.length;H++){for(var I=0;I<x[H].length;I++)for(var J=0;J<E;J++)B.vertices.push(x[H][I][J]);
0<H&&(G+=x[H-1].length,B.holes.push(G))}return B};return A})})(F);l=l.getDefaultExportFromCjs(F.exports);n.earcut=l})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(n,l){function F(w,z,r,C,x,E,B){let G;r=0;for(let H=C,I=x-E;H<x;H+=E)r+=(w[I+z*E]-w[H+z*E])*(w[H+1+z*E]+w[I+1+z*E]),I=H;if(B===0<r)for(;C<x;C+=E)G=m(C+z*E,w[C+z*E],w[C+1+z*E],G);else for(x-=E;x>=C;x-=E)G=m(x+z*E,w[x+z*E],w[x+1+z*E],G);G&&k(G,G.next)&&(h(G),
G=G.next);return G}function D(w,z=w){if(!w)return w;let r;do if(r=!1,w.steiner||!k(w,w.next)&&0!==c(w.prev,w,w.next))w=w.next;else{h(w);w=z=w.prev;if(w===w.next)break;r=!0}while(r||w!==z);return z}function A(w,z,r,C,x,E,B,G){if(w){!G&&E&&(w=d(w,C,x,E));for(var H=w;w.prev!==w.next;){var I=w.prev,J=w.next;if(E)var L=u(w,C,x,E);else a:{L=w;var K=L.prev,S=L;const W=L.next;if(0<=c(K,S,W)){L=!1;break a}let X=L.next.next;const Z=X;let V=0;for(;X!==L.prev&&(0===V||X!==Z);){V++;if(b(K.x,K.y,S.x,S.y,W.x,W.y,
X.x,X.y)&&0<=c(X.prev,X,X.next)){L=!1;break a}X=X.next}L=!0}if(L)z.push(I.index/r+B),z.push(w.index/r+B),z.push(J.index/r+B),h(w),H=w=J.next;else if(w=J,w===H){if(!G)A(D(w),z,r,C,x,E,B,1);else if(1===G){G=z;H=r;I=B;J=w;do L=J.prev,K=J.next.next,!k(L,K)&&a(L,J,J.next,K)&&g(L,K)&&g(K,L)&&(G.push(L.index/H+I),G.push(J.index/H+I),G.push(K.index/H+I),h(J),h(J.next),J=w=K),J=J.next;while(J!==w);w=J;A(w,z,r,C,x,E,B,2)}else if(2===G)a:{G=w;do{for(H=G.next.next;H!==G.prev;){if(I=G.index!==H.index){L=L=L=void 0;
I=G;J=H;if(L=I.next.index!==J.index&&I.prev.index!==J.index){b:{L=I;do{if(L.index!==I.index&&L.next.index!==I.index&&L.index!==J.index&&L.next.index!==J.index&&a(L,L.next,I,J)){L=!0;break b}L=L.next}while(L!==I);L=!1}L=!L}if(L=L&&g(I,J)&&g(J,I)){L=I;K=!1;S=(I.x+J.x)/2;J=(I.y+J.y)/2;do L.y>J!==L.next.y>J&&L.next.y!==L.y&&S<(L.next.x-L.x)*(J-L.y)/(L.next.y-L.y)+L.x&&(K=!K),L=L.next;while(L!==I);L=K}I=L}if(I){w=q(G,H);G=D(G,G.next);w=D(w,w.next);A(G,z,r,C,x,E,B,0);A(w,z,r,C,x,E,B,0);break a}H=H.next}G=
G.next}while(G!==w)}break}}}}function u(w,z,r,C){const x=w.prev,E=w.next;if(0<=c(x,w,E))return!1;const B=x.x>w.x?x.x>E.x?x.x:E.x:w.x>E.x?w.x:E.x,G=x.y>w.y?x.y>E.y?x.y:E.y:w.y>E.y?w.y:E.y,H=e(x.x<w.x?x.x<E.x?x.x:E.x:w.x<E.x?w.x:E.x,x.y<w.y?x.y<E.y?x.y:E.y:w.y<E.y?w.y:E.y,z,r,C);z=e(B,G,z,r,C);r=w.prevZ;for(C=w.nextZ;r&&r.z>=H&&C&&C.z<=z;){if(r!==w.prev&&r!==w.next&&b(x.x,x.y,w.x,w.y,E.x,E.y,r.x,r.y)&&0<=c(r.prev,r,r.next))return!1;r=r.prevZ;if(C!==w.prev&&C!==w.next&&b(x.x,x.y,w.x,w.y,E.x,E.y,C.x,
C.y)&&0<=c(C.prev,C,C.next))return!1;C=C.nextZ}for(;r&&r.z>=H;){if(r!==w.prev&&r!==w.next&&b(x.x,x.y,w.x,w.y,E.x,E.y,r.x,r.y)&&0<=c(r.prev,r,r.next))return!1;r=r.prevZ}for(;C&&C.z<=z;){if(C!==w.prev&&C!==w.next&&b(x.x,x.y,w.x,w.y,E.x,E.y,C.x,C.y)&&0<=c(C.prev,C,C.next))return!1;C=C.nextZ}return!0}function m(w,z,r,C){w=t.create(w,z,r);C?(w.next=C.next,w.prev=C,C.next.prev=w,C.next=w):(w.prev=w,w.next=w);return w}function h(w){w.next.prev=w.prev;w.prev.next=w.next;w.prevZ&&(w.prevZ.nextZ=w.nextZ);w.nextZ&&
(w.nextZ.prevZ=w.prevZ)}function f(w,z){let r=z;const C=w.x,x=w.y;let E=-Infinity,B;do{if(x<=r.y&&x>=r.next.y&&r.next.y!==r.y){var G=r.x+(x-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(G<=C&&G>E){E=G;if(G===C){if(x===r.y)return r;if(x===r.next.y)return r.next}B=r.x<r.next.x?r:r.next}}r=r.next}while(r!==z);if(!B)return null;if(C===E)return B.prev;z=B;G=B.x;const H=B.y;let I=Infinity,J;for(r=B.next;r!==z;)C>=r.x&&r.x>=G&&C!==r.x&&b(x<H?C:E,x,G,H,x<H?E:C,x,r.x,r.y)&&(J=Math.abs(x-r.y)/(C-r.x),(J<I||J===I&&
r.x>B.x)&&g(r,w)&&(B=r,I=J)),r=r.next;return B}function d(w,z,r,C){for(var x;x!==w;x=x.next){x=x||w;null===x.z&&(x.z=e(x.x,x.y,z,r,C));if(x.prev.next!==x||x.next.prev!==x)return x.prev.next=x,x.next.prev=x,d(w,z,r,C);x.prevZ=x.prev;x.nextZ=x.next}w.prevZ.nextZ=null;w.prevZ=null;a:for(r=1;;){C=w;z=w=null;let E=0;for(;C;){E++;x=C;let B=0;for(;B<r&&x;B++)x=x.nextZ;let G=r;for(;0<B||0<G&&x;){let H;0===B?(H=x,x=x.nextZ,G--):0!==G&&x?C.z<=x.z?(H=C,C=C.nextZ,B--):(H=x,x=x.nextZ,G--):(H=C,C=C.nextZ,B--);
z?z.nextZ=H:w=H;H.prevZ=z;z=H}C=x}z.nextZ=null;r*=2;if(2>E)break a}return w}function c(w,z,r){return(z.y-w.y)*(r.x-z.x)-(z.x-w.x)*(r.y-z.y)}function a(w,z,r,C){return k(w,z)&&k(r,C)||k(w,C)&&k(r,z)?!0:0<c(w,z,r)!==0<c(w,z,C)&&0<c(r,C,w)!==0<c(r,C,z)}function b(w,z,r,C,x,E,B,G){return 0<=(x-B)*(z-G)-(w-B)*(E-G)&&0<=(w-B)*(C-G)-(r-B)*(z-G)&&0<=(r-B)*(E-G)-(x-B)*(C-G)}function g(w,z){return 0>c(w.prev,w,w.next)?0<=c(w,z,w.next)&&0<=c(w,w.prev,z):0>c(w,z,w.prev)||0>c(w,w.next,z)}function e(w,z,r,C,x){w=
32767*(w-r)*x;z=32767*(z-C)*x;w=(w|w<<8)&16711935;w=(w|w<<4)&252645135;w=(w|w<<2)&858993459;z=(z|z<<8)&16711935;z=(z|z<<4)&252645135;z=(z|z<<2)&858993459;return(w|w<<1)&1431655765|((z|z<<1)&1431655765)<<1}function k(w,z){return w.x===z.x&&w.y===z.y}function p(w,z){return w.x-z.x}function q(w,z){const r=t.create(w.index,w.x,w.y),C=t.create(z.index,z.x,z.y),x=w.next,E=z.prev;w.next=z;z.prev=w;r.next=x;x.prev=r;C.next=r;r.prev=C;E.next=C;C.prev=E;return C}let t=function(){function w(){this.y=this.x=
this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}w.create=function(z,r,C){const x=y<v.length?v[y++]:new w;x.index=z;x.x=r;x.y=C;x.prev=null;x.next=null;x.z=null;x.prevZ=null;x.nextZ=null;x.steiner=!1;return x};return l._createClass(w)}();const v=[];let y=0;for(let w=0;8096>w;w++)v.push(new t);n.bufcut=function(w,z,r,C,x,E,B){y=0;var G=(C-r)*E,H=x&&x.length;const I=H?(x[0]-r)*E:G;var J=F(z,r,C,0,I,E,!0);if(J&&J.next!==J.prev){var L;if(H){const Z=[];for(let V=0,O=x.length;V<
O;V++){const P=F(z,r,C,x[V]*E,V<O-1?x[V+1]*E:C*E,E,!1);P===P.next&&(P.steiner=!0);H=Z;var K=H.push;let M=P,Q=P;do{if(M.x<Q.x||M.x===Q.x&&M.y<Q.y)Q=M;M=M.next}while(M!==P);K.call(H,Q)}Z.sort(p);for(var S of Z)if(C=S,x=f(C,J))C=q(x,C),D(C,C.next),J=D(x,x.next)}if(G>80*E){var W=G=z[r*E];var X=L=z[1+r*E];for(S=E;S<I;S+=E)C=z[S+r*E],x=z[S+1+r*E],W=Math.min(W,C),X=Math.min(X,x),G=Math.max(G,C),L=Math.max(L,x);L=Math.max(G-W,L-X);L=0!==L?1/L:0}A(J,w,E,W,X,L,B,0)}};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),function(n,l,F,D,A,u,m,h,f,d,c,a){return function(b){function g(e,k,p,q,t,v,y,w,z,r,C,x,E,B,G,H,I,J,L,K){var S=
b.call(this)||this;e=f.LineMaterialKey.load(e);k&&(e.sdf=k.sdf,e.pattern=!0,e.textureBinding=k.textureBinding);S._capType=q;S._joinType=t;S._miterLimitCosine=d.getLimitCosine(v);S.tessellationProperties._fillColor=y;S.tessellationProperties._tl=w;S.tessellationProperties._br=z;S._hasPattern=r;S._isDashed=C;S._zOrder=I;S._effects=J||null;S._minMaxZoom=m.i1616to32(Math.round(L*u.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(K*u.MIN_MAX_ZOOM_PRECISION_FACTOR));S._materialKey=e.data;S.tessellationProperties._bitset=
(E?u.BITSET_GENERIC_LOCK_COLOR:0)|(B?u.BITSET_TYPE_FILL_OUTLINE:0)|(x?u.BITSET_LINE_SCALE_DASH:0)|(G?u.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0);S.tessellationProperties._halfWidth=.5*p;S.tessellationProperties._halfReferenceWidth=.5*H;S.tessellationProperties.offset=0;S._initializeTessellator(!1);return S}n._inherits(g,b);g.fromCIMLine=function(e,k,p){var q=e.color,t=e.scaleFactor||1;const v=!!e.dashTemplate;let y=e.cap;v&&y===D.CapType.ROUND&&(y=D.CapType.SQUARE);const w=e.join;t*=F.pt2px(e.width);
const z=F.pt2px(e.referenceWidth),r=F.pt2px(e.miterLimit);q=q&&A.premultiplyAlphaRGBA(q)||0;const [C,x]=d.getMinMaxZoom(e.scaleInfo,p);if(!k)return new g(e.materialKey,k,t,y,w,r,q,0,0,!1,v,e.scaleDash??!1,e.colorLocked??!1,!1,e.sampleAlphaOnly,z,e.zOrder,e.effects,C,x);const {rect:E,width:B,height:G}=k;var H=E.x+u.SPRITE_PADDING;const I=E.y+u.SPRITE_PADDING;p=H+B;const J=I+G;H=m.i1616to32(H,I);p=m.i1616to32(p,J);return new g(e.materialKey,k,t,y,w,r,q,H,p,!0,v,e.scaleDash??!1,e.colorLocked??!1,!1,
e.sampleAlphaOnly,z,e.zOrder,e.effects,C,x)};g.fromFillOutline=function(e){const k=f.FillMaterialKey.load(e.materialKey);return f.hasOutlineFillSymbology(k)&&e.outline&&"esriSLSSolid"===e.outline?.style?g.fromSimpleLine({hash:"",materialKey:e.materialKey,...e.outline},null,!0):null};g.fromSimpleLine=function(e,k,p=!1){var {color:q}=e;const t="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,v=h.getCapType(e.cap||"round"),y=h.getJoinType(e.join||"round");q=q&&"esriSLSNull"!==e.style&&A.premultiplyAlphaRGBAArray(q)||
0;"esriSLSNull"===e.style&&(q=0);const w=F.pt2px(e.width),z=e.miterLimit;if(!k)return new g(e.materialKey,k,w,v,y,z,q,0,0,!1,t,!0,!1,p,!1,w,0,null,d.DEFAULT_MIN_ZOOM,d.DEFAULT_MAX_ZOOM);const {rect:r,width:C,height:x}=k;var E=r.x+u.SPRITE_PADDING;const B=r.y+u.SPRITE_PADDING;var G=E+C;const H=B+x;E=m.i1616to32(E,B);G=m.i1616to32(G,H);return new g(e.materialKey,k,w,v,y,z,q,E,G,!0,t,!0,!1,p,!1,w,0,null,d.DEFAULT_MIN_ZOOM,d.DEFAULT_MAX_ZOOM)};g.fromPictureLineSymbol=function(e,k,p,q){l.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!");
return null};return n._createClass(g)}(c(a))})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../geometry/GeometryCursor ../../definitions ../../enums ../../number ../../TurboLine ../../materialKey/MaterialKey ./templateUtils".split(" "),function(n,l,F,D,A,u,m,h){const f=(a,b,g)=>(e,k,p,q,t,v,y,w,z,r,C)=>{p=A.i1616to32(C,Math.ceil(16*a._halfWidth));y=A.i8888to32(Math.round(16*y),Math.round(16*w),
Math.round(16*z),Math.round(16*r));t=A.i8888to32(16*t,16*v,0,a._bitset);v=a.out;v.vertexBounds(e,k,b,g);v.vertexWrite(A.i1616to32(8*e,8*k));v.vertexWrite(a.id);v.vertexWrite(a._fillColor);v.vertexWrite(y);v.vertexWrite(p);v.vertexWrite(a._tl);v.vertexWrite(a._br);v.vertexWrite(t);v.vertexWrite(A.i1616to32(Math.ceil(16*a._halfReferenceWidth),0));v.vertexWrite(a.minMaxZoom);v.vertexEnd();return a.offset+a.vertexCount++},d=(a,b,g)=>(e,k,p,q,t,v,y,w,z,r,C)=>{p=A.i1616to32(16*a._halfWidth,16*a._halfReferenceWidth);
y=A.i8888to32(16*y+128,16*w+128,16*z+128,16*r+128);w=a.out;z=a._bitset<<24|a.id;w.vertexBounds(e,k,b,g);w.vertexWrite(A.i1616to32(8*e,8*k));w.vertexWrite(z);w.vertexWrite(a._fillColor);e=m.hasSimpleSymbology(a.key);e||(w.vertexWrite(0),w.vertexWrite(0));w.vertexWrite(0);w.vertexWrite(p);w.vertexWrite(y);e||w.vertexWrite(a.minMaxZoom);w.vertexEnd();return a.offset+a.vertexCount++},c=a=>(b,g,e)=>{const k=a.out;k.indexWrite(b);k.indexWrite(g);k.indexWrite(e);a.indexCount+=3};return a=>function(b){function g(...k){k=
b.call(this,...k)||this;k.tessellationProperties={};k._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0};k.geometryType=D.WGLGeometryType.LINE;return k}n._inherits(g,b);var e=g.prototype;e.writeGeometry=function(k,p,q,t){this._writeGeometry(k,p,q,t)};e._initializeTessellator=function(k){var p=m.LineMaterialKey.load(this._materialKey),q=m.FillMaterialKey.load(this._materialKey),t=this._tessellationOptions;p=p.vvSizeFieldStops||p.vvSizeMinMaxValue||p.vvSizeScaleStops||p.vvSizeUnitValue;k=
this.tessellationProperties._halfWidth<F.THIN_LINE_HALF_WIDTH_THRESHOLD&&!k&&!p;this.tessellationProperties.minMaxZoom=this._minMaxZoom;t.wrapDistance=65535;t.textured=this._isDashed||this._hasPattern;t.offset=this.tessellationProperties.offset;t.halfWidth=this.tessellationProperties._halfWidth;t=k?0:1;q=m.hasOutlineFillSymbology(q)?d:f;this._lineTessellator=new u.LineTessellation(q(this.tessellationProperties,t,t),c(this.tessellationProperties),k)};e._write=function(k,p,q,t){q="esriGeometryPoint"===
p.geometryType;k.recordStart(p.getDisplayId(),this._materialKey,this.geometryType,q);this._writeGeometry(k,p,t,q);k.recordEnd()};e._writeGeometry=function(k,p,q,t){if(q=q||l.GeometryCursor.fromFeatureSetReaderCIM(p))t=this._getLines(q,t),null!=t&&this._writeVertices(k,p,t)};e._getLines=function(k,p){return h.clipLinesMarshall(k,p?256:16)};e._writeVertices=function(k,p,q){const t=p.getDisplayId(),v=k.vertexCount(),y=this.tessellationProperties;p=this._tessellationOptions;y.out=k;y.id=t;y.indexCount=
0;y.vertexCount=0;y.offset=v;p.capType=this._capType;p.joinType=this._joinType;k=m.FillMaterialKey.load(this._materialKey);this.tessellationProperties.key=m.hasOutlineFillSymbology(k)?k:m.LineMaterialKey.load(this._materialKey);for(const {line:w,start:z}of q)p.initialDistance=z%65535,this._lineTessellator.tessellate(w,p)};return n._createClass(g)}(a)})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../symbols/cim/enums",
"./definitions"],function(n,l,F,D){function A(b,g){return b.x===g.x&&b.y===g.y}function u(b,g){b.x=g.y;b.y=-g.x;return b}function m(b,g){b.x=-g.y;b.y=g.x;return b}function h(b,g){b.x=g.x;b.y=g.y;return b}function f(b,g){b.x=-g.x;b.y=-g.y;return b}function d(b){return Math.sqrt(b.x*b.x+b.y*b.y)}function c(b,g,e,k){b.x=g.x*e+g.y*k;b.y=g.x*k-g.y*e;return b}let a=function(){function b(e,k,p){this._writeVertex=e;this._writeTriangle=k;this._canUseThinTessellation=p;this._prevNormal={x:void 0,y:void 0};
this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,y:-1};this._textureNormal={x:void 0,y:void 0};this._joinNormal={x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};this._bevelStart={x:void 0,y:void 0};
this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}var g=b.prototype;g.tessellate=function(e,k){if(e){var p=e.length;if(!(1>=p)){var q=0;for(let t=1;t<p;t++)A(e[t],e[q])||++q===t||(e[q]=e[t]);e.length=q+1}}this._canUseThinTessellation&&k.halfWidth<D.THIN_LINE_HALF_WIDTH_THRESHOLD&&!k.offset?this._tessellateThin(e,k):this._tessellate(e,k)};g._tessellateThin=function(e,k){if(!(2>e.length)){var p=k.wrapDistance||65535;k=k.initialDistance||0;var q=!1,t=e[0].x,v=e[0].y,y=e.length;
for(let C=1;C<y;++C){q&&(q=!1,k=0);let x=e[C].x,E=e[C].y;var w=x-t;let B=E-v;var z=Math.sqrt(w*w+B*B);w/=z;B/=z;if(k+z>p){q=!0;var r=(p-k)/z;z=p-k;x=(1-r)*t+r*x;E=(1-r)*v+r*E;--C}r=this._writeVertex(t,v,0,0,w,B,B,-w,0,-1,k);t=this._writeVertex(t,v,0,0,w,B,-B,w,0,1,k);k+=z;z=this._writeVertex(x,E,0,0,w,B,B,-w,0,-1,k);w=this._writeVertex(x,E,0,0,w,B,-B,w,0,1,k);this._writeTriangle(r,t,z);this._writeTriangle(t,z,w);t=x;v=E}}};g._tessellate=function(e,k){var p=e[e.length-1];const q=A(e[0],p);if(!(e.length<
(q?3:2))){var t=k.pixelCoordRatio,v=null!=k.capType?k.capType:F.CapType.BUTT,y=null!=k.joinType?k.joinType:F.JoinType.MITER,w=null!=k.miterLimit?Math.min(k.miterLimit,4):2,z=null!=k.roundLimit?Math.min(k.roundLimit,1.05):1.05,r=null!=k.halfWidth?k.halfWidth:2,C=!!k.textured,x=null,E=this._prevNormal,B=this._nextNormal,G=-1,H=-1,I=this._joinNormal,J=this._textureNormalLeft,L=this._textureNormalRight,K=this._textureNormal,S=-1,W=-1,X=k.wrapDistance||65535,Z=k.initialDistance||0,V=this._writeVertex,
O=this._writeTriangle;k=(ha,ka,ma,na,oa,pa)=>{ha=V(M,Q,ba,N,ma,na,ha,ka,oa,pa,Z);0<=S&&0<=W&&0<=ha&&O(S,W,ha);S=W;return W=ha};if(q){var P=e[e.length-2];B.x=p.x-P.x;B.y=p.y-P.y;H=d(B);B.x/=H;B.y/=H}p=!1;for(let ha=0;ha<e.length;++ha){p&&(p=!1,Z=0);P&&(E.x=-B.x,E.y=-B.y,G=H,Z+G>X&&(p=!0));p?(x=(X-Z)/G,G=X-Z,P={x:(1-x)*P.x+x*e[ha].x,y:(1-x)*P.y+x*e[ha].y},--ha):P=e[ha];var M=P.x;var Q=P.y;var R=0>=ha&&!p,aa=ha===e.length-1;R||(Z+=G);(x=aa?q?e[1]:null:e[ha+1])?(B.x=x.x-M,B.y=x.y-Q,H=d(B),B.x/=H,B.y/=
H):(B.x=void 0,B.y=void 0);if(!q){if(R){m(I,B);var ba=I.x;var N=I.y;v===F.CapType.SQUARE&&(k(-B.y-B.x,B.x-B.y,B.x,B.y,0,-1),k(B.y-B.x,-B.x-B.y,B.x,B.y,0,1));v===F.CapType.ROUND&&(k(-B.y-B.x,B.x-B.y,B.x,B.y,-1,-1),k(B.y-B.x,-B.x-B.y,B.x,B.y,-1,1));if(v===F.CapType.ROUND||v===F.CapType.BUTT)k(-B.y,B.x,B.x,B.y,0,-1),k(B.y,-B.x,B.x,B.y,0,1);continue}if(aa){u(I,E);ba=I.x;N=I.y;if(v===F.CapType.ROUND||v===F.CapType.BUTT)k(E.y,-E.x,-E.x,-E.y,0,-1),k(-E.y,E.x,-E.x,-E.y,0,1);v===F.CapType.SQUARE&&(k(E.y-E.x,
-E.x-E.y,-E.x,-E.y,0,-1),k(-E.y-E.x,E.x-E.y,-E.x,-E.y,0,1));v===F.CapType.ROUND&&(k(E.y-E.x,-E.x-E.y,-E.x,-E.y,1,-1),k(-E.y-E.x,E.x-E.y,-E.x,-E.y,1,1));continue}}var T=void 0;R=-(E.x*B.y-E.y*B.x);.01>Math.abs(R)?0<E.x*B.x+E.y*B.y?(I.x=E.x,I.y=E.y,R=1,T=Number.MAX_VALUE,x=!0):(m(I,B),T=R=1,x=!1):(I.x=(E.x+B.x)/R,I.y=(E.y+B.y)/R,T=d(I),x=(T-1)*r*t,x=4<T||x>G&&x>H);ba=I.x;N=I.y;var U=y;switch(y){case F.JoinType.BEVEL:1.05>T&&(U=F.JoinType.MITER);break;case F.JoinType.ROUND:T<z&&(U=F.JoinType.MITER);
break;case F.JoinType.MITER:T>w&&(U=F.JoinType.BEVEL)}switch(U){case F.JoinType.MITER:k(I.x,I.y,-E.x,-E.y,0,-1);k(-I.x,-I.y,-E.x,-E.y,0,1);if(aa)break;C&&(x=p?0:Z,S=this._writeVertex(M,Q,ba,N,B.x,B.y,I.x,I.y,0,-1,x),W=this._writeVertex(M,Q,ba,N,B.x,B.y,-I.x,-I.y,0,1,x));break;case F.JoinType.BEVEL:R=0>R;var Y=void 0;R?(U=S,S=W,W=U,Y=J,U=L):(Y=L,U=J);var ca=void 0,da=void 0;x?(ca=R?m(this._innerPrev,E):u(this._innerPrev,E),da=R?u(this._innerNext,B):m(this._innerNext,B)):ca=da=R?f(this._inner,I):h(this._inner,
I);T=R?u(this._bevelStart,E):m(this._bevelStart,E);k(ca.x,ca.y,-E.x,-E.y,Y.x,Y.y);ca=k(T.x,T.y,-E.x,-E.y,U.x,U.y);if(aa)break;aa=R?m(this._bevelEnd,B):u(this._bevelEnd,B);x?(x=this._writeVertex(M,Q,ba,N,-E.x,-E.y,0,0,0,0,Z),S=this._writeVertex(M,Q,ba,N,B.x,B.y,da.x,da.y,Y.x,Y.y,Z),W=this._writeVertex(M,Q,ba,N,B.x,B.y,aa.x,aa.y,U.x,U.y,Z),this._writeTriangle(ca,x,W)):(C?(x=this._bevelMiddle,x.x=(T.x+aa.x)/2,x.y=(T.y+aa.y)/2,c(K,x,-E.x,-E.y),k(x.x,x.y,-E.x,-E.y,K.x,K.y),c(K,x,B.x,B.y),S=this._writeVertex(M,
Q,ba,N,B.x,B.y,x.x,x.y,K.x,K.y,Z),W=this._writeVertex(M,Q,ba,N,B.x,B.y,da.x,da.y,Y.x,Y.y,Z)):(x=S,S=W,W=x),k(aa.x,aa.y,B.x,B.y,U.x,U.y));R&&(x=S,S=W,W=x);break;case F.JoinType.ROUND:R=0>R;var ea=void 0;R?(U=S,S=W,W=U,U=J,ea=L):(U=L,ea=J);var fa=R?f(this._inner,I):h(this._inner,I);x?(da=R?m(this._innerPrev,E):u(this._innerPrev,E),Y=R?u(this._innerNext,B):m(this._innerNext,B)):Y=da=fa;ca=R?u(this._roundStart,E):m(this._roundStart,E);var ja=R?m(this._roundEnd,B):u(this._roundEnd,B);da=k(da.x,da.y,-E.x,
-E.y,U.x,U.y);ca=k(ca.x,ca.y,-E.x,-E.y,ea.x,ea.y);if(aa)break;aa=this._writeVertex(M,Q,ba,N,-E.x,-E.y,0,0,0,0,Z);x||this._writeTriangle(S,W,aa);fa=f(this._outer,fa);ea=this._writeVertex(M,Q,ba,N,B.x,B.y,ja.x,ja.y,ea.x,ea.y,Z);let ka,ma;if(ja=2<T){var ia=void 0;T!==Number.MAX_VALUE?(fa.x/=T,fa.y/=T,ia=E.x*fa.x+E.y*fa.y,ia=(T*(ia*ia-1)+1)/ia):ia=-1;ka=R?u(this._startBreak,E):m(this._startBreak,E);ka.x+=E.x*ia;ka.y+=E.y*ia;ma=R?m(this._endBreak,B):u(this._endBreak,B);ma.x+=B.x*ia;ma.y+=B.y*ia}c(K,fa,
-E.x,-E.y);T=this._writeVertex(M,Q,ba,N,-E.x,-E.y,fa.x,fa.y,K.x,K.y,Z);c(K,fa,B.x,B.y);fa=C?this._writeVertex(M,Q,ba,N,B.x,B.y,fa.x,fa.y,K.x,K.y,Z):T;ia=aa;const na=C?this._writeVertex(M,Q,ba,N,B.x,B.y,0,0,0,0,Z):aa;let oa=-1,pa=-1;ja&&(c(K,ka,-E.x,-E.y),oa=this._writeVertex(M,Q,ba,N,-E.x,-E.y,ka.x,ka.y,K.x,K.y,Z),c(K,ma,B.x,B.y),pa=this._writeVertex(M,Q,ba,N,B.x,B.y,ma.x,ma.y,K.x,K.y,Z));C?ja?(this._writeTriangle(ia,ca,oa),this._writeTriangle(ia,oa,T),this._writeTriangle(na,fa,pa),this._writeTriangle(na,
pa,ea)):(this._writeTriangle(ia,ca,T),this._writeTriangle(na,fa,ea)):ja?(this._writeTriangle(aa,ca,oa),this._writeTriangle(aa,oa,pa),this._writeTriangle(aa,pa,ea)):(this._writeTriangle(aa,ca,T),this._writeTriangle(aa,fa,ea));x?S=this._writeVertex(M,Q,ba,N,B.x,B.y,Y.x,Y.y,U.x,U.y,Z):(S=C?this._writeVertex(M,Q,ba,N,B.x,B.y,Y.x,Y.y,U.x,U.y,Z):da,this._writeTriangle(S,na,ea));W=ea;R&&(x=S,S=W,W=x)}}}};return l._createClass(b)}();n.LineTessellation=a;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../symbols/cim/cimAnalyzer","../../../../../../symbols/cim/utils","./WGLMeshTemplate"],function(n,l,F,D,A){const u=l.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");return function(m){function h(f){var d=m.call(this)||this;d._ongoingMaterialRequestMap=new Map;d._materialCache=new Map;d._dynamicPropertyMap=
new Map;d._cimLayer=f;return d}n._inherits(h,m);h.prototype.analyze=async function(f,d,c,a,b){if(b&&0===b.length)return null;const g=b&&0<b.length,e=d.readLegacyFeature();d=d.getObjectId();const k=this._materialCache;var p=this._cimLayer.materialHash;if(!p)return u.error("A Dynamic mesh template must have a material hash value or function!"),null;const q="function"===typeof p?p(e,c,a,d):p;p=k.get(q);if(null!=p||(p=this._ongoingMaterialRequestMap.get(q)))return p;p=this._cimLayer;const t=F.analyzeCIMResource(p.cim,
this._cimLayer.materialOverrides);t.mosaicHash=q;const {type:v,url:y}=p;d={cim:t,type:v,mosaicHash:q,url:y,size:null,dashTemplate:null,text:null,fontName:null,objectId:d,animatedSymbolProperties:null};switch(v){case "marker":d.size=D.evaluateValueOrFunction(p.size,e,c,a);d.animatedSymbolProperties=D.evaluateValueOrFunction(p.animatedSymbolProperties,e,c,a);break;case "line":d.dashTemplate=p.dashTemplate;break;case "text":d.text=D.evaluateValueOrFunction(p.text,e,c,a),d.fontName=D.evaluateValueOrFunction(p.fontName,
e,c,a)}f=f.getMosaicItem(d,b).then(w=>{g||(this._ongoingMaterialRequestMap.delete(q),k.set(q,w));return w}).catch(w=>{this._ongoingMaterialRequestMap.delete(q);u.error(".analyze()",w.message);return null});g||this._ongoingMaterialRequestMap.set(q,f);return f};return n._createClass(h)}(A)})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolDrawHelper ./CIMSymbolHelper ./enums ./quantizeTime ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/arcade/callExpressionWithFeature ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/grouping".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t){function v(x){switch(x){case "Butt":return a.CapType.BUTT;case "Square":return a.CapType.SQUARE;default:return a.CapType.ROUND}}function y(x){switch(x){case "Bevel":return a.JoinType.BEVEL;case "Miter":return a.JoinType.MITER;default:return a.JoinType.ROUND}}function w(x){return x&&0===x.indexOf("Level_")&&(x=parseInt(x.substr(6),10),!isNaN(x))?x:0}function z(x){if(!x||0===x.length)return null;x=(new F(x)).toRgba();return{r:x[0],g:x[1],b:x[2],a:x[3]}}
function r(x){return x?x.charAt(0).toLowerCase()+x.substr(1):x}const C=u.getLogger("esri.symbols.cim.cimAnalyzer");u=function(){function x(B,G){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];this._resourceManager=B;this._info=G}var E=x.prototype;E.analyzeSymbolReference=async function(B,G,H){this._cimLayers=H??[];if(!B)return this._cimLayers;if(B.primitiveOverrides){this._primitiveOverrides=B.primitiveOverrides;this._poMap={};H=[];const J=this._info;for(const L of this._primitiveOverrides){var I=
L.valueExpressionInfo;I&&J?(I=f.createRendererExpression(I.expression,J.spatialReference,J.fields).then(K=>{null!=K&&this._setPoMap(L.primitiveName,L.propertyName,K)}),H.push(I)):null!=L.value&&this._setPoMap(L.primitiveName,L.propertyName,L.value);0<H.length&&await Promise.all(H)}}B=B.symbol;H=[];c.CIMSymbolHelper.fetchResources(B,this._resourceManager,H);0<H.length&&await Promise.all(H);this._analyzeSymbol(B,G);return this._cimLayers};E._analyzeSymbol=function(B,G){switch(B?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(B,
G,1,0,0,0)}};E._analyzeMultiLayerSymbol=function(B,G,H,I,J,L){const K=B?.symbolLayers;if(K){var S=B.effects,W=a.Alignment.SCREEN,X=c.CIMSymbolHelper.getSize(B)??0;"CIMPointSymbol"===B.type&&"Map"===B.angleAlignment&&(W=a.Alignment.MAP);for(var Z="CIMPolygonSymbol"===B.type,V=K.length;V--;){const P=K[V];if(!P||!1===P.enable)continue;let M;S&&S.length&&(M=[...S]);var O=P.effects;O&&O.length&&(S?M.push(...O):M=[...O]);O=[];c.OverrideHelper.findEffectOverrides(M,this._primitiveOverrides,O);O=0<O.length?
this._createEffectsOverrideFunction(M,O):M;c.OverrideHelper.findApplicableOverrides(P,this._primitiveOverrides,[]);switch(P.type){case "CIMSolidFill":this._analyzeSolidFill(P,O);break;case "CIMPictureFill":this._analyzePictureFill(P,O);break;case "CIMHatchFill":this._analyzeHatchFill(P,O);break;case "CIMGradientFill":this._analyzeGradientFill(P,O);break;case "CIMSolidStroke":this._analyzeSolidStroke(P,O,Z,X);break;case "CIMPictureStroke":this._analyzePictureStroke(P,O,Z,X);break;case "CIMGradientStroke":this._analyzeGradientStroke(P,
O,Z,X);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":"CIMLineSymbol"===B.type&&(W=(W=P.markerPlacement)&&W.angleToLine?a.Alignment.MAP:a.Alignment.SCREEN);const Q=[],R=P.primitiveName;R&&Q.push(R);this._analyzeMarker(P,O,null,Q,W,X,1,G,H,I,J,L);break;default:C.error("Cannot analyze CIM layer",P.type)}}}};E._analyzeSolidFill=function(B,G){const H=B.primitiveName,I=e.fromCIMColor(B.color),[J,L]=this._analyzePrimitiveOverrides(H,G,null,null),K=h.numericHash(JSON.stringify(B)+
L).toString();this._cimLayers.push({type:"fill",templateHash:K,materialHash:J?()=>K:K,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,color:this._createOverrideFunction(H,"Color",I,z),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:G,applyRandomOffset:!1,sampleAlphaOnly:!0})};E._analyzePictureFill=function(B,G){const H=B.primitiveName,I=e.getTintColor(B),[J,L]=this._analyzePrimitiveOverrides(H,G,null,null),K=h.numericHash(JSON.stringify(B)+L).toString(),S=h.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}`).toString(),
W=e.getValue(B.height,d.DEFAULT_PICTURE_FILL_HEIGHT);let X=e.getValue(B.scaleX,1);if("width"in B&&"number"===typeof B.width){const Z=B.width;let V=1;const O=this._resourceManager.getResource(B.url);null!=O&&(V=O.width/O.height);X/=W/Z*V}this._cimLayers.push({type:"fill",templateHash:K,materialHash:J?()=>S:S,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,effects:G,color:this._createOverrideFunction(H,"TintColor",I,z),height:this._createOverrideFunction(H,"Height",W),scaleX:this._createOverrideFunction(H,
"ScaleX",X),angle:this._createOverrideFunction(H,"Rotation",e.getValue(B.rotation)),offsetX:this._createOverrideFunction(H,"OffsetX",e.getValue(B.offsetX)),offsetY:this._createOverrideFunction(H,"OffsetY",e.getValue(B.offsetY)),url:B.url,applyRandomOffset:!1,sampleAlphaOnly:!1})};E._analyzeHatchFill=function(B,G){const H=B.primitiveName,I=this._analyzeMaterialOverrides(H,["Rotation","OffsetX","OffsetY"]);let [J,L]=this._analyzePrimitiveOverrides(H,G,null,null);const K=h.numericHash(JSON.stringify(B)+
L).toString(),S=h.numericHash(`${B.separation}${JSON.stringify(B.lineSymbol)}`).toString();let W={r:255,g:255,b:255,a:1};var X=!1;const Z=B.lineSymbol?.symbolLayers?.find(V=>"CIMSolidStroke"===V.type&&null!=this._poMap[V.primitiveName]?.Color);Z&&(W=e.fromCIMColor(Z.color),W=this._createOverrideFunction(Z.primitiveName,"Color",W,z),X="function"===typeof W,J=J||X,X=null!=Z.color||X);this._cimLayers.push({type:"fill",templateHash:K,materialHash:J&&I?this._createMaterialHashFunction(S,I):S,cim:B,materialOverrides:I,
colorLocked:!!B.colorLocked,effects:G,color:W,height:this._createOverrideFunction(H,"Separation",e.getValue(B.separation,d.DEFAULT_HATCH_FILL_SEPARATION)),scaleX:1,angle:this._createOverrideFunction(H,"Rotation",e.getValue(B.rotation)),offsetX:this._createOverrideFunction(H,"OffsetX",e.getValue(B.offsetX)),offsetY:this._createOverrideFunction(H,"OffsetY",e.getValue(B.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!X})};E._analyzeGradientFill=function(B,G){const [H,
I]=this._analyzePrimitiveOverrides(B.primitiveName,G,null,null),J=h.numericHash(JSON.stringify(B)+I).toString();this._cimLayers.push({type:"fill",templateHash:J,materialHash:H?()=>J:J,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked,effects:G,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})};E._analyzeSolidStroke=function(B,G,H,I){const J=B.primitiveName,L=e.fromCIMColor(B.color),K=e.getValue(B.width,d.DEFAULT_STROKE_WIDTH),
S=v(B.capStyle),W=y(B.joinStyle),X=B.miterLimit,[Z,V]=this._analyzePrimitiveOverrides(J,G,null,null),O=h.numericHash(JSON.stringify(B)+V).toString();let P;if(G&&G instanceof Array&&0<G.length){const Q=G[G.length-1];if("CIMGeometricEffectDashes"===Q.type&&"NoConstraint"===Q.lineDashEnding&&null===Q.offsetAlongLine){G=[...G];var M=G.pop();P=M.dashTemplate;M=M.scaleDash}}this._cimLayers.push({type:"line",templateHash:O,materialHash:Z?()=>O:O,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,
effects:G,color:this._createOverrideFunction(J,"Color",L,z),width:this._createOverrideFunction(J,"Width",K),cap:this._createOverrideFunction(J,"CapStyle",S),join:this._createOverrideFunction(J,"JoinStyle",W),miterLimit:X&&this._createOverrideFunction(J,"MiterLimit",X),referenceWidth:I,zOrder:w(B.name),dashTemplate:P,scaleDash:M,sampleAlphaOnly:!0})};E._analyzePictureStroke=function(B,G,H,I){const J=h.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}`).toString(),L=B.primitiveName,K=e.getTintColor(B),
S=e.getValue(B.width,d.DEFAULT_STROKE_WIDTH),W=v(B.capStyle),X=y(B.joinStyle),Z=B.miterLimit,[V,O]=this._analyzePrimitiveOverrides(L,G,null,null),P=h.numericHash(JSON.stringify(B)+O).toString();this._cimLayers.push({type:"line",templateHash:P,materialHash:V?()=>J:J,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,effects:G,color:this._createOverrideFunction(L,"TintColor",K,z),width:this._createOverrideFunction(L,"Width",S),cap:this._createOverrideFunction(L,"CapStyle",W),join:this._createOverrideFunction(L,
"JoinStyle",X),miterLimit:Z&&this._createOverrideFunction(L,"MiterLimit",Z),referenceWidth:I,zOrder:w(B.name),dashTemplate:null,scaleDash:!1,url:B.url,sampleAlphaOnly:!1})};E._analyzeGradientStroke=function(B,G,H,I){const J=B.primitiveName,L=e.getValue(B.width,d.DEFAULT_STROKE_WIDTH),K=v(B.capStyle),S=y(B.joinStyle),W=B.miterLimit,[X,Z]=this._analyzePrimitiveOverrides(J,G,null,null),V=h.numericHash(JSON.stringify(B)+Z).toString();this._cimLayers.push({type:"line",templateHash:V,materialHash:X?()=>
V:V,cim:B,materialOverrides:null,isOutline:H,colorLocked:!!B.colorLocked,effects:G,color:{r:128,g:128,b:128,a:1},width:this._createOverrideFunction(J,"Width",L),cap:this._createOverrideFunction(J,"CapStyle",K),join:this._createOverrideFunction(J,"JoinStyle",S),miterLimit:W&&this._createOverrideFunction(J,"MiterLimit",W),referenceWidth:I,zOrder:w(B.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})};E._analyzeMarker=function(B,G,H,I,J,L,K,S,W,X,Z,V,O=!1){if(!this._analyzeMarkerInsidePolygon(B,
G)){W=e.getValue(B.size,d.DEFAULT_MARKER_SIZE);var P=e.getValue(B.rotation),M=e.getValue(B.offsetX),Q=e.getValue(B.offsetY);W=this._createOverrideFunction(B.primitiveName,"Size",W);P=this._createOverrideFunction(B.primitiveName,"Rotation",P);M=this._createOverrideFunction(B.primitiveName,"OffsetX",M);Q=this._createOverrideFunction(B.primitiveName,"OffsetY",Q);W=this._transformSize(W,K);P=this._transformRotation(P,!!B.rotateClockwise,X);Z=this._transformOffsetX(M,Q,X,K,Z);X=this._transformOffsetY(M,
Q,X,K,V);M=Z;Q=X;switch(B.type){case "CIMPictureMarker":this._analyzePictureMarker(B,G,H,I,J,L,W,P,M,Q,B.colorLocked||O);break;case "CIMVectorMarker":this._analyzeVectorMarker(B,G,H,I,J,L,K,S,W,P,M,Q,B.colorLocked||O)}}};E._analyzeMarkerInsidePolygon=function(B,G){const {markerPlacement:H,type:I}=B;if(!H||"CIMMarkerPlacementInsidePolygon"!==H.type)return!1;if("CIMVectorMarker"===I||"CIMPictureMarker"===I){var J=B.primitiveName;if(J&&([J]=this._analyzePrimitiveOverrides([J],G,null,null),J))return!1;
if(J=H.primitiveName)if([J]=this._analyzePrimitiveOverrides([J],G,null,null),J)return!1;if("CIMVectorMarker"===I){if({markerGraphics:J}=B,J)for(var L of J)if({symbol:J}=L,"CIMPolygonSymbol"===J?.type&&J.symbolLayers){({symbolLayers:J}=J);for(var K of J)if("CIMSolidStroke"===K.type)return!1}}else if({animatedSymbolProperties:L}=B,L)return!1}var S=Math.abs(H.stepX),W=Math.abs(H.stepY);if(0===S||0===W)return!0;const X=["Rotation","OffsetX","OffsetY"];L=this._primitiveOverrides.filter(O=>O.primitiveName!==
B.primitiveName||!X.includes(O.propertyName));K="url"in B&&"string"===typeof B.url?B.url:void 0;J=h.numericHash(JSON.stringify(B)).toString();let Z=null;if("Random"===H.gridType){var V=m.px2pt(q.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE);const O=Math.max(Math.floor(V/S),1),P=Math.max(Math.floor(V/W),1);V=W*P;Z=M=>M?M*P:0;S=O*S/V}else H.shiftOddRows?(V=2*W,Z=O=>O?2*O:0,S=S/W*.5):(V=W,Z=null,S/=W);W=e.getTintColor(B);this._cimLayers.push({type:"fill",templateHash:J,materialHash:J,cim:B,materialOverrides:L,
colorLocked:!!B.colorLocked,effects:G,color:W,height:this._createOverrideFunction(H.primitiveName,"StepY",V,Z),scaleX:S,angle:H.gridAngle,offsetX:e.getValue(H.offsetX),offsetY:e.getValue(H.offsetY),url:K,applyRandomOffset:"Random"===H.gridType,sampleAlphaOnly:!K,hasUnresolvedReplacementColor:!0});return!0};E._analyzePictureMarker=function(B,G,H,I,J,L,K,S,W,X,Z){let V=e.getValue(B.scaleX,1);const O=e.getTintColor(B),P=h.numericHash(`${B.url}${JSON.stringify(B.colorSubstitutions)}${JSON.stringify(B.animatedSymbolProperties)}`).toString();
H||(H=this._createMarkerPlacementOverrideFunction(B.markerPlacement));const M=this._createAnimatedSymbolPropertiesOverrideFunction(B.animatedSymbolProperties),[Q,R]=this._analyzePrimitiveOverrides(I,G,H,M);I=h.numericHash(JSON.stringify(B)+R).toString();const aa=B.anchorPoint??{x:0,y:0};if("width"in B&&"number"===typeof B.width){const N=B.width;let T=1;var ba=this._resourceManager.getResource(B.url);null!=ba&&(T=ba.width/ba.height);ba=e.getValue(B.size);V/=ba/N*T}this._cimLayers.push({type:"marker",
templateHash:I,materialHash:B.animatedSymbolProperties&&!0===B.animatedSymbolProperties.randomizeStartTime?(N,T,U,Y)=>{U=t.getMaterialGroup(Y??0);N=null!=M?e.evaluateValueOrFunction(M,N,T):null;return P+`-MATERIALGROUP(${U})`+`-ASP(${JSON.stringify(N)})`}:Q?(N,T)=>{N=null!=M?e.evaluateValueOrFunction(M,N,T):null;return P+`-ASP(${JSON.stringify(N)})`}:P,cim:B,materialOverrides:null,colorLocked:!!B.colorLocked||!!Z,effects:G,scaleSymbolsProportionally:!1,alignment:J,size:K,scaleX:this._createOverrideFunction(B.primitiveName,
"ScaleX",V),rotation:S,offsetX:W,offsetY:X,color:this._createOverrideFunction(B.primitiveName,"TintColor",O,z),anchorPoint:{x:aa.x,y:aa.y},isAbsoluteAnchorPoint:"Relative"!==B.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:!1,referenceSize:L,sizeRatio:1,markerPlacement:H,url:B.url,animatedSymbolProperties:M})};E._analyzeVectorMarker=function(B,G,H,I,J,L,K,S,W,X,Z,V,O){var P=B.markerGraphics;if(P){var M=B.frame,Q=0,R=1;B.scaleSymbolsProportionally&&M&&
(Q=M.ymax-M.ymin,R=this._transformSize(W,1/Q));R=this._transformSize(R,K);H||(H=this._createMarkerPlacementOverrideFunction(B.markerPlacement));for(const N of P)if(N&&(K=N.symbol)){(P=N.primitiveName)&&I.push(P);var aa=Z,ba=V;if(("CIMPointSymbol"===K.type||"CIMTextSymbol"===K.type)&&M){let T=ba=0;aa=N.geometry;"x"in aa&&"y"in aa&&(ba+=aa.x-.5*(M.xmin+M.xmax),T+=aa.y-.5*(M.ymin+M.ymax));if(aa=B.anchorPoint)"Absolute"===B.anchorPointUnits?(ba-=aa.x,T-=aa.y):M&&(ba-=(M.xmax-M.xmin)*aa.x,T-=(M.ymax-M.ymin)*
aa.y);aa=this._transformOffsetX(ba,T,X,R,Z);ba=this._transformOffsetY(ba,T,X,R,V)}switch(K.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":S?this._analyzeMultiLayerGraphicNonSDF(B,G,H,null,N,I,J,L,Q,!!O||!!B.colorLocked):this._analyzeMultiLayerGraphic(B,G,H,null,N,I,J,L,Q,R,W,X,aa,ba,!!O||!!B.colorLocked);break;case "CIMTextSymbol":this._analyzeTextGraphic(B,G,H,N,I,J,L,Q,R,W,X,aa,ba,O)}P&&I.pop()}}};E._analyzeMultiLayerGraphic=function(B,G,H,I,J,L,K,S,W,X,Z,V,O,P,M){var Q=
J.symbol;const R=Q.symbolLayers;if(R){var aa=R.length;if(R&&2===R.length&&R[0].enable&&R[1].enable&&"CIMSolidStroke"===R[0].type&&"CIMSolidFill"===R[1].type&&!R[0].effects&&!R[1].effects)this._analyzeCompositeMarkerGraphic(B,G,H,I,J,R,L,K,S,W,Z,V,O,P,!!M||!!B.colorLocked);else{var ba=this._resourceManager.geometryEngine;if(Q=k.CIMEffectHelper.applyEffects(Q.effects,J.geometry,ba))for(;aa--;){const da=R[aa];if(!da||!1===da.enable)continue;const ea=da.primitiveName;ea&&L.push(ea);switch(da.type){case "CIMSolidFill":case "CIMSolidStroke":var N=
k.CIMEffectHelper.applyEffects(da.effects,Q,ba),T=g.getExtent(N);if(!T)continue;const fa="Relative"!==B.anchorPointUnits,[ja,ia,ha]=g.getSDFMetrics(T,B.frame,B.size,B.anchorPoint,fa);var U="CIMSolidFill"===da.type;N={type:"sdf",geom:N,asFill:U};T=da.path;const ka=U?e.fromCIMColor(e.getFillColor(da)):e.fromCIMColor(e.getStrokeColor(da)),ma=U?{r:0,g:0,b:0,a:0}:e.fromCIMColor(e.getStrokeColor(da)),na=e.getStrokeWidth(da)??0;if(!U&&!na)break;var Y=J.primitiveName;let oa=null;!U||da.colorLocked||M||(oa=
this._createOverrideFunction(Y,"FillColor",ka,z));U=null;da.colorLocked||M||(U=this._createOverrideFunction(Y,"StrokeColor",ma,z));Y=this._createOverrideFunction(Y,"StrokeWidth",na);let pa=!1;var ca="";for(const ua of this._primitiveOverrides)L.includes(ua.primitiveName)&&(null!=ua.value?ca+=`-${ua.primitiveName}-${ua.propertyName}-${JSON.stringify(ua.value)}`:ua.valueExpressionInfo&&(pa=!0));if(null!=G&&"function"===typeof G||null!=H&&"function"===typeof H)pa=!0;if(e.isFeatureValueFn(Z)||e.isFeatureValueFn(V)||
e.isFeatureValueFn(O)||e.isFeatureValueFn(P))pa=!0;const Ea=JSON.stringify({...B,markerGraphics:null}),ta=h.numericHash(JSON.stringify(N)+T).toString();ca=h.numericHash(JSON.stringify(J)+JSON.stringify(da)+Ea+ca).toString();this._cimLayers.push({type:"marker",templateHash:ca,materialHash:pa?()=>ta:ta,cim:N,materialOverrides:null,colorLocked:!!da.colorLocked||!!M,effects:G,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:K,anchorPoint:{x:ia,y:ha},isAbsoluteAnchorPoint:fa,size:Z,
rotation:V,offsetX:O,offsetY:P,scaleX:1,frameHeight:W,rotateClockwise:!1,referenceSize:S,sizeRatio:ja,color:e.isFeatureValueFn(oa)?oa:this._createOverrideFunction(ea,"Color",ka,z),outlineColor:e.isFeatureValueFn(U)?U:this._createOverrideFunction(ea,"Color",ma,z),outlineWidth:e.isFeatureValueFn(Y)?Y:this._createOverrideFunction(ea,"Width",na),markerPlacement:H,animatedSymbolProperties:I,path:T});break;case "CIMVectorMarker":da.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(B,G,H,I,J,L,K,S,W,
!!M||!!da.colorLocked):this._analyzeMarker(da,G,H,L,K,S,X,!1,Z,V,O,P,!!M||!!B.colorLocked);break;default:this._analyzeMultiLayerGraphicNonSDF(B,G,H,I,J,L,K,S,W,!!M||!!B.colorLocked)}ea&&L.pop()}}}};E._analyzeTextGraphic=function(B,G,H,I,J,L,K,S,W,X,Z,V,O,P){c.OverrideHelper.findApplicableOverrides(I,this._primitiveOverrides,[]);S=I.geometry;if("x"in S&&"y"in S){S=I.symbol;X=e.fromCIMFontDecoration(S);var M=e.fromCIMFontStyle(S.fontStyleName),Q=D.getFontFamily(S.fontFamilyName);S.font={family:Q,decoration:X,
...M};var R=e.getValue(S.height,d.DEFAULT_TEXT_HEIGHT),aa=e.getValue(S.angle),ba=e.getValue(S.offsetX),N=e.getValue(S.offsetY);R=this._transformSize(R,W);aa=this._transformRotation(aa,!1,Z);V=this._transformOffsetX(ba,N,Z,W,V);N=this._transformOffsetY(ba,N,Z,W,O);ba=V;Z=e.fromCIMColor(e.getFillColor(S));O=e.fromCIMColor(e.getStrokeColor(S));V=e.getStrokeWidth(S)??0;V||(O=e.fromCIMColor(e.getFillColor(S.haloSymbol)),V=e.getValue(S.haloSize));V=this._transformSize(V,W);var T=W=null,U=0;if(S.callout&&
"CIMBackgroundCallout"===S.callout.type){var Y=S.callout;if(Y.backgroundSymbol&&(Y=Y.backgroundSymbol.symbolLayers))for(const ja of Y)"CIMSolidFill"===ja.type?W=e.fromCIMColor(ja.color):"CIMSolidStroke"===ja.type&&(T=e.fromCIMColor(ja.color),U=e.getValue(ja.width,d.DEFAULT_STROKE_WIDTH))}var [ca,da]=this._analyzePrimitiveOverrides(J,G,H,null);J=JSON.stringify(B.effects)+Number(B.colorLocked||P).toString()+JSON.stringify(B.anchorPoint)+B.anchorPointUnits+JSON.stringify(B.markerPlacement)+B.size.toString();
J=h.numericHash(JSON.stringify(I)+J+da).toString();var ea=this._createOverrideFunction(I.primitiveName,"TextString",I.textString??"",e.adjustTextCase,S.textCase);if(null!=ea){({fontStyleName:I}=S);var fa=Q+(I?"-"+I.toLowerCase():"-regular");"string"===typeof ea&&ea.includes("[")&&S.fieldMap&&(ea=e.createLabelOverrideFunction(S.fieldMap,ea,S.textCase));this._cimLayers.push({type:"text",templateHash:J,materialHash:ca||"function"===typeof ea||/\[(.*?)\]/.test(ea)?(ja,ia,ha)=>fa+"-"+e.evaluateValueOrFunction(ea,
ja,ia,ha):fa+"-"+h.numericHash(ea),cim:S,materialOverrides:null,colorLocked:!!B.colorLocked||!!P,effects:G,alignment:L,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:"Relative"!==B.anchorPointUnits,fontName:fa,decoration:X,weight:M.weight,style:M.style,size:R,angle:aa,offsetX:ba,offsetY:N,horizontalAlignment:e.fromCIMHorizontalAlignment(S.horizontalAlignment),verticalAlignment:e.fromCIMVerticalAlignment(S.verticalAlignment),text:ea,color:Z,outlineColor:O,outlineSize:V,backgroundColor:W,borderLineColor:T,
borderLineWidth:U,referenceSize:K,sizeRatio:1,markerPlacement:H})}}};E._analyzeMultiLayerGraphicNonSDF=function(B,G,H,I,J,L,K,S,W,X){J=this._buildSimpleMarker(B,J);const Z=B.primitiveName,V=this._analyzeMaterialOverrides(Z,["Rotation","OffsetX","OffsetY"]);var [,O]=this._analyzePrimitiveOverrides(L,null,null,null);const [P,M,Q]=c.CIMSymbolHelper.getTextureAnchor(J,this._resourceManager);L=e.getValue(B.rotation);const R=e.getValue(B.offsetX),aa=e.getValue(B.offsetY);O=h.numericHash(JSON.stringify(J)+
O).toString();this._cimLayers.push({type:"marker",templateHash:O,materialHash:(V&&0<V.length||null!=G&&"function"===typeof G)&&V?this._createMaterialHashFunction(O,V):O,cim:J,materialOverrides:V,colorLocked:!!B.colorLocked||!!X,effects:G,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:K,anchorPoint:{x:P,y:M},isAbsoluteAnchorPoint:!1,size:e.getValue(B.size,d.DEFAULT_MARKER_SIZE),rotation:this._createOverrideFunction(Z,"Rotation",L),offsetX:this._createOverrideFunction(Z,"OffsetX",
R),offsetY:this._createOverrideFunction(Z,"OffsetY",aa),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:W,rotateClockwise:!!B.rotateClockwise,referenceSize:S,sizeRatio:Q/m.pt2px(B.size),markerPlacement:H,animatedSymbolProperties:I,avoidSDFRasterization:!0})};E._buildSimpleMarker=function(B,G){return{type:B.type,enable:!0,name:B.name,colorLocked:B.colorLocked,primitiveName:B.primitiveName,anchorPoint:B.anchorPoint,anchorPointUnits:B.anchorPointUnits,
offsetX:0,offsetY:0,rotateClockwise:B.rotateClockwise,rotation:0,size:B.size,billboardMode3D:B.billboardMode3D,depth3D:B.depth3D,frame:B.frame,markerGraphics:[G],scaleSymbolsProportionally:B.scaleSymbolsProportionally,respectFrame:B.respectFrame,clippingPath:B.clippingPath}};E._analyzeCompositeMarkerGraphic=function(B,G,H,I,J,L,K,S,W,X,Z,V,O,P,M){var Q=J.geometry;const R=L[0],aa=L[1];var ba=g.getExtent(Q);if(ba){L="Relative"!==B.anchorPointUnits;var [N,T,U]=g.getSDFMetrics(ba,B.frame,B.size,B.anchorPoint,
L);Q={type:"sdf",geom:Q,asFill:!0};ba=aa.path;var Y=aa.primitiveName,ca=R.primitiveName,da=e.fromCIMColor(aa.color),ea=e.fromCIMColor(R.color),fa=e.getValue(R.width,d.DEFAULT_STROKE_WIDTH),ja=J.primitiveName,ia=null;aa.colorLocked||M||(ia=this._createOverrideFunction(ja,"FillColor",da,z));var ha=null;R.colorLocked||M||(ha=this._createOverrideFunction(ja,"StrokeColor",ea,z));ja=this._createOverrideFunction(ja,"StrokeWidth",fa);var ka=!1,ma="";for(const oa of this._primitiveOverrides)if(oa.primitiveName===
Y||oa.primitiveName===ca||K.includes(oa.primitiveName))null!=oa.value?ma+=`-${oa.primitiveName}-${oa.propertyName}-${JSON.stringify(oa.value)}`:oa.valueExpressionInfo&&(ka=!0);null!=H&&"function"===typeof H&&(ka=!0);if(e.isFeatureValueFn(Z)||e.isFeatureValueFn(V)||e.isFeatureValueFn(O)||e.isFeatureValueFn(P))ka=!0;K=JSON.stringify({...B,markerGraphics:null});var na=h.numericHash(JSON.stringify(Q)+ba).toString();J=h.numericHash(JSON.stringify(J)+JSON.stringify(aa)+JSON.stringify(R)+K+ma).toString();
this._cimLayers.push({type:"marker",templateHash:J,materialHash:ka?()=>na:na,cim:Q,materialOverrides:null,colorLocked:!!M,effects:G,scaleSymbolsProportionally:!!B.scaleSymbolsProportionally,alignment:S,anchorPoint:{x:T,y:U},isAbsoluteAnchorPoint:L,size:Z,rotation:V,offsetX:O,offsetY:P,scaleX:1,frameHeight:X,rotateClockwise:!1,referenceSize:W,sizeRatio:N,color:e.isFeatureValueFn(ia)?ia:this._createOverrideFunction(Y,"Color",da,z),outlineColor:e.isFeatureValueFn(ha)?ha:this._createOverrideFunction(ca,
"Color",ea,z),outlineWidth:e.isFeatureValueFn(ja)?ja:this._createOverrideFunction(ca,"Width",fa),markerPlacement:H,path:ba,animatedSymbolProperties:I})}};E._createMaterialHashFunction=function(B,G){const H=this._info?.geometryType;if(H){const I=this._poMap;for(const J of G)if(J.valueExpressionInfo){const L=I[J.primitiveName]&&I[J.primitiveName][J.propertyName];L instanceof f.ArcadeExpression&&(J.fn=(K,S,W)=>p(L,K,{$view:W},H,S))}}return(I,J,L)=>{for(const K of G)K.fn&&(K.value=K.fn(I,J,L));return h.numericHash(B+
c.OverrideHelper.buildOverrideKey(G)).toString()}};E._setPoMap=function(B,G,H){let I;this._poMap[B]?I=this._poMap[B]:(I={},this._poMap[B]=I);I[G]=H};E._createOverrideFunction=function(B,G,H,I,J){if(null==B)return H;B=this._poMap[B];if(null==B)return H;const L=B[G];if("string"===typeof L||"number"===typeof L||L instanceof Array)return I?I.call(null,L,J):L;const K=this._info?.geometryType;return null!=L&&L instanceof f.ArcadeExpression&&null!=K?(S,W,X)=>{S=p(L,S,{$view:X},K,W);null!==S&&I&&(S=I.call(null,
S,J));return null!==S?S:H}:H};E._createEffectsOverrideFunction=function(B,G){const H=this._poMap,I=this._info?.geometryType;for(const J of G)if(J.valueExpressionInfo&&I){const L=H[J.primitiveName]&&H[J.primitiveName][J.propertyName];L instanceof f.ArcadeExpression&&(J.fn=(K,S,W)=>p(L,K,{$view:W},I,S))}return(J,L,K)=>{for(var S of G)S.fn&&(S.value=S.fn(J,L,K));J=[];for(let W of B){if(L=W?.primitiveName){K=!1;for(const X of G)X.primitiveName===L&&(S=r(X.propertyName),null!=X.value&&X.value!==W[S]&&
(K||(W=A.clone(W),K=!0),W[S]=X.value))}J.push(W)}return J}};E._createMarkerPlacementOverrideFunction=function(B){const G=[];c.OverrideHelper.findApplicableOverrides(B,this._primitiveOverrides,G);if(null==B||0===G.length)return B;const H=this._poMap,I=this._info?.geometryType;for(const J of G)if(J.valueExpressionInfo&&I){const L=H[J.primitiveName]&&H[J.primitiveName][J.propertyName];L instanceof f.ArcadeExpression&&(J.fn=(K,S,W)=>p(L,K,{$view:W},I,S))}return(J,L,K)=>{for(const S of G)S.fn&&(S.value=
S.fn(J,L,K));J=A.clone(B);L=B.primitiveName;for(const S of G)S.primitiveName===L&&(K=r(S.propertyName),null!=S.value&&S.value!==J[K]&&(J[K]=S.value));return J}};E._createAnimatedSymbolPropertiesOverrideFunction=function(B){const G=[];c.OverrideHelper.findApplicableOverrides(B,this._primitiveOverrides,G);if(null==B||0===G.length)return B;const H=this._info?.geometryType;if(H){const I=this._poMap;for(const J of G)if(J.valueExpressionInfo){const L=I[J.primitiveName]&&I[J.primitiveName][J.propertyName];
L instanceof f.ArcadeExpression&&(J.fn=(K,S,W)=>p(L,K,{$view:W},H,S))}}return(I,J,L)=>{for(var K of G)K.fn&&(K.value=K.fn(I,J,L));I=A.clone(B);J=B.primitiveName;for(const S of G)S.primitiveName===J&&(L=r(S.propertyName),null!=S.value&&(K=b.quantizeIfNeeded(S.value,S.propertyName),K!==I[L]&&(I[L]=K)));return I}};E._analyzePrimitiveOverrides=function(B,G,H,I){let J=!1,L="";"string"===typeof B&&(B=[B]);for(const K of this._primitiveOverrides)B?.includes(K.primitiveName)&&(null!=K.value?L+=`-${K.primitiveName}-${K.propertyName}-${JSON.stringify(K.value)}`:
K.valueExpressionInfo&&(J=!0));null!=G&&"function"===typeof G&&(J=!0);null!=H&&"function"===typeof H&&(J=!0);null!=I&&"function"===typeof I&&(J=!0);return[J,L]};E._analyzeMaterialOverrides=function(B,G){return this._primitiveOverrides.filter(H=>H.primitiveName!==B||!G.includes(H.propertyName))};E._transformSize=function(B,G){return e.isFeatureValueFn(B)||e.isFeatureValueFn(G)?(H,I,J)=>{const L=e.isFeatureValueFn(B)?B(H,I,J):B;H=e.isFeatureValueFn(G)?G(H,I,J):G;return L*H}:B*G};E._transformRotation=
function(B,G,H){return e.isFeatureValueFn(B)||e.isFeatureValueFn(H)?(I,J,L)=>{const K=e.isFeatureValueFn(B)?B(I,J,L):B;I=e.isFeatureValueFn(H)?H(I,J,L):H;return G?I-K:I+K}:G?H-B:H+B};E._transformOffsetX=function(B,G,H,I,J){if(!(e.isFeatureValueFn(B)||e.isFeatureValueFn(G)||e.isFeatureValueFn(H)||e.isFeatureValueFn(I)||e.isFeatureValueFn(J))){const L=H*Math.PI/180;return L?(Math.cos(L)*B-Math.sin(L)*G)*I+J:B*I+J}return(L,K,S)=>{var W=e.isFeatureValueFn(H)?H(L,K,S):H;const X=e.isFeatureValueFn(I)?I(L,
K,S):I,Z=e.isFeatureValueFn(B)?B(L,K,S):B,V=e.isFeatureValueFn(J)?J(L,K,S):J;if(W){W*=Math.PI/180;const O=Math.cos(W);W=Math.sin(W);L=e.isFeatureValueFn(G)?G(L,K,S):G;return(O*Z-W*L)*X+V}return Z*X+V}};E._transformOffsetY=function(B,G,H,I,J){if(!(e.isFeatureValueFn(B)||e.isFeatureValueFn(G)||e.isFeatureValueFn(H)||e.isFeatureValueFn(I)||e.isFeatureValueFn(J))){const L=H*Math.PI/180;return L?(Math.sin(L)*B+Math.cos(L)*G)*I+J:G*I+J}return(L,K,S)=>{var W=e.isFeatureValueFn(H)?H(L,K,S):H;const X=e.isFeatureValueFn(I)?
I(L,K,S):I,Z=e.isFeatureValueFn(G)?G(L,K,S):G,V=e.isFeatureValueFn(J)?J(L,K,S):J;if(W){W*=Math.PI/180;const O=Math.cos(W);W=Math.sin(W);L=e.isFeatureValueFn(B)?B(L,K,S):B;return(W*L+O*Z)*X+V}return Z*X+V}};return l._createClass(x)}();n.CIMAnalyzer=u;n.analyzeCIMResource=function(x,E){if(!E||0===E.length)return x;x=A.clone(x);c.OverrideHelper.applyOverrides(x,E);return x};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/quantizeTime":function(){define(["exports"],function(n){const l=
new Set(["StartTimeOffset","Duration","RepeatDelay"]);n.quantizeIfNeeded=function(F,D){return l.has(D)?.05*Math.max(Math.round(F/.05),1):F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){return function(a){function b(g,e,k){var p=a.call(this,g)||this;p._minMaxZoom=u.i1616to32(Math.round(e*A.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(k*A.MIN_MAX_ZOOM_PRECISION_FACTOR));p._cimLineLayer=g;let q=0;F.isFeatureValueFn(g.width)||(q=.5*l.pt2px(g.width));p._dynamicPropertyMap.set("_halfWidth",(y,w,z)=>F.isFeatureValueFn(g.width)?.5*l.pt2px(g.width(y,w,z)):q);F.isFeatureValueFn(g.cap)?p._dynamicPropertyMap.set("_capType",g.cap):p._capType=g.cap;F.isFeatureValueFn(g.join)?
p._dynamicPropertyMap.set("_joinType",g.join):p._joinType=g.join;const t=g.color;F.isFeatureValueFn(t)?p._dynamicPropertyMap.set("_fillColor",(y,w,z)=>D.premultiplyAlphaRGBA(t(y,w,z))):p._fillColor=t&&D.premultiplyAlphaRGBA(t)||0;const v=g.miterLimit;F.isFeatureValueFn(v)?p._dynamicPropertyMap.set("_miterLimitCosine",(y,w,z)=>h.getLimitCosine(v(y,w,z))):p._miterLimitCosine=h.getLimitCosine(v);null!=g.effects&&(e=g.effects,F.isFeatureValueFn(e)?p._dynamicPropertyMap.set("_effects",e):p._effects=e);
p._scaleFactor=g.scaleFactor||1;p._isDashed=null!=g.dashTemplate;p.tessellationProperties._bitset=(g.colorLocked?A.BITSET_GENERIC_LOCK_COLOR:0)|(g.scaleDash?A.BITSET_LINE_SCALE_DASH:0)|(g.sampleAlphaOnly?A.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0);p._materialKey=g.materialKey;p._initializeTessellator(!0);return p}n._inherits(b,a);b.fromCIMLine=function(g,e){const [k,p]=h.getMinMaxZoom(g.scaleInfo,e);return new b(g,k,p)};b.prototype.bindFeature=function(g,e,k){const p=g.readLegacyFeature();this._dynamicPropertyMap.forEach((t,
v)=>{this[v]=t(p,e,k)});this._halfWidth*=this._scaleFactor;g=this._materialCache;var q=this._cimLineLayer.materialHash;q=q(p,e,k);q=g.get(q);g=null;q&&c.ok(q.spriteMosaicItem)&&(g=q.spriteMosaicItem);if(g){this._hasPattern=!0;const {rect:t,width:v,height:y}=g;q=t.x+A.SPRITE_PADDING;const w=t.y+A.SPRITE_PADDING,z=q+v,r=w+y;this.tessellationProperties._tl=u.i1616to32(q,w);this.tessellationProperties._br=u.i1616to32(z,r)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=
0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties.offset=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;q=m.LineMaterialKey.load(this._materialKey);g&&(q.sdf=g.sdf,q.pattern=!0,q.textureBinding=g.textureBinding);this._materialKey=q.data};return n._createClass(b)}(f(d))})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k){const p=u.create(),q=A.create();return function(t){function v(y,w,z){var r=t.call(this,y)||this;r._cimMarkerLayer=y;r._minMaxZoom=c.i1616to32(Math.round(w*d.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(z*d.MIN_MAX_ZOOM_PRECISION_FACTOR));const C=y.color;h.isFeatureValueFn(C)?r._dynamicPropertyMap.set("_fillColor",(I,J,L)=>f.premultiplyAlphaRGBA(C(I,J,L))):r._fillColor=f.premultiplyAlphaRGBA(C);const x=y.outlineColor;h.isFeatureValueFn(x)?r._dynamicPropertyMap.set("_outlineColor",
(I,J,L)=>f.premultiplyAlphaRGBA(x(I,J,L))):r._outlineColor=f.premultiplyAlphaRGBA(x);const E=y.size;h.isFeatureValueFn(E)?r._dynamicPropertyMap.set("_size",(I,J,L)=>D.pt2px(E(I,J,L))):r._size=D.pt2px(E)||0;w=y.scaleX;h.isFeatureValueFn(w)?r._dynamicPropertyMap.set("_scaleX",w):r._scaleX=w;const B=y.offsetX;h.isFeatureValueFn(B)?r._dynamicPropertyMap.set("xOffset",(I,J,L)=>D.pt2px(B(I,J,L))):r.xOffset=D.pt2px(B)||0;const G=y.offsetY;h.isFeatureValueFn(G)?r._dynamicPropertyMap.set("yOffset",(I,J,L)=>
D.pt2px(G(I,J,L))):r.yOffset=D.pt2px(G)||0;const H=y.outlineWidth;h.isFeatureValueFn(H)?r._dynamicPropertyMap.set("_outlineWidth",(I,J,L)=>D.pt2px(H(I,J,L))):r._outlineWidth=D.pt2px(H)||0;w=y.rotation;h.isFeatureValueFn(w)?r._dynamicPropertyMap.set("_angle",w):r._angle=w||0;null!=y.effects&&(w=y.effects,h.isFeatureValueFn(w)?r._dynamicPropertyMap.set("_effects",w):r._effects=w);null!=y.markerPlacement&&(w=y.markerPlacement,h.isFeatureValueFn(w)?r._dynamicPropertyMap.set("_markerPlacement",w):r._markerPlacement=
w);r._scaleFactor=y.scaleFactor??1;r._bitSet=(y.alignment===m.Alignment.MAP?d.BITSET_MARKER_ALIGNMENT_MAP:d.BITSET_MARKER_ALIGNMENT_SCREEN)|(y.colorLocked?d.BITSET_GENERIC_LOCK_COLOR:0)|(y.scaleSymbolsProportionally?d.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0);r._materialKey=y.materialKey;return r}n._inherits(v,t);v.fromCIMMarker=function(y,w){const [z,r]=b.getMinMaxZoom(y.scaleInfo,w);return new v(y,z,r)};v.prototype.bindFeature=function(y,w,z){const r=y.readLegacyFeature();y=y.getObjectId();
this._dynamicPropertyMap.forEach((Z,V)=>{this[V]=Z(r,w,z)});var C=this._cimMarkerLayer.materialHash;y="function"===typeof C?C(r,w,z,y):C;if((y=this._materialCache.get(y))&&k.ok(y.spriteMosaicItem)&&y.spriteMosaicItem){y=y.spriteMosaicItem;C=this._cimMarkerLayer.sizeRatio;var x=y.width/y.height*this._scaleX,E=a.MarkerMaterialKey.load(this._materialKey);E.sdf=y.sdf;E.pattern=!0;E.textureBinding=y.textureBinding;this._materialKey=E.data;var B=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,
G=this._size,H=G*x,I=this.xOffset,J=this.yOffset;this.xOffset*=this._scaleFactor;this.yOffset*=this._scaleFactor;var L=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/D.pt2px(this._cimMarkerLayer.frameHeight):1;L*=this._outlineWidth;var K=D.pt2px(this._cimMarkerLayer.referenceSize),S=0,W=0,X=this._cimMarkerLayer.anchorPoint;X&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(S=D.pt2px(X.x)/(this._size*x),W=D.pt2px(X.y)/this._size):(S=X.x,W=X.y));
this._anchorX=S;this._anchorY=W;this._sizeOutlineWidth=c.i8888to32(Math.round(Math.min(Math.sqrt(128*H),255)),Math.round(Math.min(Math.sqrt(128*G),255)),Math.round(Math.min(Math.sqrt(128*L),255)),Math.round(Math.min(Math.sqrt(128*K),255)));this.angle=B;this._bitestAndDistRatio=c.i1616to32(this._bitSet,Math.round(64*C));this._computeSize(H,G,C,L,this._scaleFactor,y,E.hasSizeVV(),!0);this._applyTransformation(q,p);this.xOffset=I;this.yOffset=J}else F.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new l("mapview-cim",
"Encountered an error when binding feature"))};return n._createClass(v)}(g(e))})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../../../../../symbols/cim/utils ../../alignmentUtils ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){return function(g){function e(p,q,t){var v=g.call(this,p)||this;v._horizontalAlignment="center";v._verticalAlignment="middle";v._textToGlyphs=new Map;v._minMaxZoom=h.i1616to32(Math.round(q*m.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(t*m.MIN_MAX_ZOOM_PRECISION_FACTOR));q=p.scaleFactor||1;v._cimTextLayer=p;const y=p.color;D.isFeatureValueFn(y)?v._dynamicPropertyMap.set("_color",(x,E,B)=>u.premultiplyAlphaRGBA(y(x,E,B))):v._color=u.premultiplyAlphaRGBA(y);const w=
p.outlineColor;D.isFeatureValueFn(w)?v._dynamicPropertyMap.set("_haloColor",(x,E,B)=>u.premultiplyAlphaRGBA(w(x,E,B))):v._haloColor=u.premultiplyAlphaRGBA(w);let z;D.isFeatureValueFn(p.size)||(z=Math.min(Math.round(l.pt2px(p.size*p.sizeRatio)),127));v._dynamicPropertyMap.set("_size",(x,E,B)=>D.isFeatureValueFn(p.size)?Math.min(Math.round(l.pt2px(p.size(x,E,B)*p.sizeRatio)),127):z);D.isFeatureValueFn(p.outlineSize)?v._dynamicPropertyMap.set("_haloSize",(x,E,B)=>Math.min(Math.floor(5*l.pt2px(p.outlineSize(x,
E,B)*p.sizeRatio)),127)):v._haloSize=Math.min(Math.floor(5*l.pt2px(p.outlineSize*p.sizeRatio)),127);let r;D.isFeatureValueFn(p.offsetX)||(r=Math.round(l.pt2px(p.offsetX*p.sizeRatio)));v._dynamicPropertyMap.set("_xOffset",(x,E,B)=>D.isFeatureValueFn(p.offsetX)?Math.round(l.pt2px(p.offsetX(x,E,B)*p.sizeRatio)):r);let C;D.isFeatureValueFn(p.offsetY)||(C=Math.round(l.pt2px(p.offsetY*p.sizeRatio)));v._dynamicPropertyMap.set("_yOffset",(x,E,B)=>D.isFeatureValueFn(p.offsetY)?Math.round(l.pt2px(p.offsetY(x,
E,B)*p.sizeRatio)):C);D.isFeatureValueFn(p.angle)?v._dynamicPropertyMap.set("_angle",p.angle):v._angle=p.angle;D.isFeatureValueFn(p.horizontalAlignment)?v._dynamicPropertyMap.set("_horizontalAlignment",p.horizontalAlignment):v._horizontalAlignment=p.horizontalAlignment;D.isFeatureValueFn(p.verticalAlignment)?v._dynamicPropertyMap.set("_verticalAlignment",p.verticalAlignment):v._verticalAlignment=p.verticalAlignment;null!=p.effects&&(t=p.effects,D.isFeatureValueFn(t)?v._dynamicPropertyMap.set("_effects",
t):v._effects=t);null!=p.markerPlacement&&(t=p.markerPlacement,D.isFeatureValueFn(t)?v._dynamicPropertyMap.set("_markerPlacement",t):v._textPlacement=t);D.isFeatureValueFn(p.text)?v._dynamicPropertyMap.set("_text",p.text):v._text=p.text;v._backgroundColor=p.backgroundColor&&u.premultiplyAlphaRGBA(p.backgroundColor);v._borderLineColor=p.borderLineColor&&u.premultiplyAlphaRGBA(p.borderLineColor);v._borderLineSize=p.borderLineWidth;v._scaleFactor=q;q=Math.min(Math.round(l.pt2px(p.referenceSize*p.sizeRatio)),
127);v._referenceSize=Math.round(Math.sqrt(256*q));v._materialKey=p.materialKey;q=f.TextMaterialKey.load(v._materialKey);q.sdf=!0;v._bitset=(p.alignment===F.Alignment.MAP?1:0)|(p.colorLocked?1:0)<<1;v._materialKey=q.data;v._decoration="none";v._lineHeight=1;v._lineWidth=512;v._isCIM=!0;return v}n._inherits(e,g);e.fromCIMText=function(p,q){const [t,v]=d.getMinMaxZoom(p.scaleInfo,q);return new e(p,t,v)};var k=e.prototype;k.analyze=async function(p,q,t,v){var y=q.readLegacyFeature();var w=this._cimTextLayer;
y="string"===typeof w.text?w.text:"function"===typeof w.text?w.text(y,t,v)??"":"";(p=await n._get(n._getPrototypeOf(e.prototype),"analyze",this).call(this,p,q,t,v,b.codepoints(y)))&&p.glyphMosaicItems&&this._textToGlyphs.set(y,p.glyphMosaicItems);return p};k.bindFeature=function(p,q,t){const v=p.readLegacyFeature();this._dynamicPropertyMap.forEach((y,w)=>{this[w]=y(v,q,t)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/m.GLYPH_SIZE,this._xOffset*=this._scaleFactor,
this._yOffset*=this._scaleFactor,this._xAlignD=A.getXAnchorDirection(this._horizontalAlignment??"center"),this._yAlignD=A.getYAnchorDirection(this._verticalAlignment??"baseline"),p=this._textToGlyphs.get(this._text)??[],this.bindTextInfo(p,!1)):this._shapingInfo=null};return n._createClass(e)}(c(a))})},"esri/views/2d/layers/features/textUtils":function(){define(["exports"],function(n){n.codepoints=function(l){if(null==l)return[];const F=Array(l.length);for(let D=0;D<l.length;D++)F[D]=l.charCodeAt(D);
return F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLMeshTemplate".split(" "),function(n,l,F,D,A,u,m,h,f,d){return function(c){function a(b,g,e,k,p,q,t,v,y,w,z,r,C,x,E,B){var G=c.call(this)||
this;G._effects=x||void 0;b=m.FillMaterialKey.load(b);g&&(b.sdf=g.sdf,b.pattern=!0,b.textureBinding=g.textureBinding);G.fillColor=e;G.tl=k;G.br=p;G.aux21=u.i1616to32(q,t);G.aux22=u.i1616to32(v,y);G.aux3=u.i8888to32(w,z,r,0);G._bitset=C;G._minMaxZoom=u.i1616to32(Math.round(E*D.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(B*D.MIN_MAX_ZOOM_PRECISION_FACTOR));G._materialKey=b.data;return G}n._inherits(a,c);a.fromCIMFill=function(b,g,e){var k=b.color;k=k&&F.premultiplyAlphaRGBA(k)||0;const p=b.materialKey,
[q,t]=h.getMinMaxZoom(b.scaleInfo,e);e=(b.colorLocked?D.BITSET_GENERIC_LOCK_COLOR:0)|(b.applyRandomOffset?D.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(b.sampleAlphaOnly?D.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(b.hasUnresolvedReplacementColor?D.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);if(!g)return new a(p,null,k,0,0,0,0,0,0,0,0,0,e,b.effects,q,t);const {rect:v,width:y,height:w}=g;var z=b.scaleX||1,r=v.x+D.SPRITE_PADDING;const C=v.y+D.SPRITE_PADDING;var x=r+y;const E=C+w;var B=l.pt2px(b.height);z*=
B;"CIMHatchFill"===b.cim.type&&(z*=y/w);0>=B&&(B=E-C);B<D.MAX_SIZE_FOR_U16_COMPRESSION&&(B*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR);B=Math.round(B);0>=z&&(z=x-r);z<D.MAX_SIZE_FOR_U16_COMPRESSION&&(z*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR);z=Math.round(z);const G=l.pt2px(b.offsetX||0),H=l.pt2px(-b.offsetY||0);r=u.i1616to32(r,C);x=u.i1616to32(x,E);return new a(p,g,k,r,x,z,B,G,H,D.COMPRESSION_FACTOR_FOR_U16,D.COMPRESSION_FACTOR_FOR_U16,
A.degToByte(b.angle),e,b.effects,q,t)};a.fromSimpleFill=function(b,g,e=!1){var {color:k}=b;k=k&&"esriSFSNull"!==b.style&&F.premultiplyAlphaRGBAArray(k)||0;e=e?D.BITSET_GENERIC_LOCK_COLOR:0;const p=b.materialKey;if(g){const {rect:w,width:z,height:r,pixelRatio:C}=g;var q=w.x+D.SPRITE_PADDING,t=w.y+D.SPRITE_PADDING,v=q+z,y=t+r;q=u.i1616to32(q,t);v=u.i1616to32(v,y);y=z/C;y<D.MAX_SIZE_FOR_U16_COMPRESSION&&(y*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR);y=Math.round(y);
t=r/C;t<D.MAX_SIZE_FOR_U16_COMPRESSION&&(t*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR);t=Math.round(t);g=new a(p,g,k,q,v,y,t,0,0,D.COMPRESSION_FACTOR_FOR_U16,D.COMPRESSION_FACTOR_FOR_U16,0,e,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM)}else g=new a(p,null,k,0,0,0,0,0,0,0,0,0,e,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);g._maybeAddLineTemplate(b);return g};a.fromPictureFill=function(b,g,e=!1){const k=D.PICTURE_FILL_COLOR,{rect:p,width:q,height:t}=g;var v=p.x+
D.SPRITE_PADDING,y=p.y+D.SPRITE_PADDING,w=v+q,z=y+t;v=u.i1616to32(v,y);w=u.i1616to32(w,z);e=e?D.BITSET_GENERIC_LOCK_COLOR:0;z=l.pt2px(b.width);z<D.MAX_SIZE_FOR_U16_COMPRESSION&&(z*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR);z=Math.round(z);y=l.pt2px(b.height);y<D.MAX_SIZE_FOR_U16_COMPRESSION&&(y*=D.COMPRESSION_FACTOR_FOR_U16,e|=D.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR);y=Math.round(y);const r=l.pt2px(b.xoffset),C=l.pt2px(-b.yoffset);g=new a(b.materialKey,
g,k,v,w,z,y,r,C,D.COMPRESSION_FACTOR_FOR_U16*b.xscale,D.COMPRESSION_FACTOR_FOR_U16*b.yscale,0,e,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);g._maybeAddLineTemplate(b);return g};return n._createClass(a)}(f(d))})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/promiseUtils"],function(n,l,F){let D=function(){function A(){this._resolver=null}var u=A.prototype;u.isHeld=function(){return!!this._resolver};u.acquire=
async function(){this._resolver?(await this._resolver.promise,await this.acquire()):this._resolver=F.createResolver()};u.release=function(){const m=this._resolver;this._resolver=null;m?.resolve()};return l._createClass(A)}();n.Lock=D;n.withLock=async function(A,u,m){try{await A.acquire(),await u(m),A.release()}catch(h){throw A.release(),h;}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/cimSymbolUtils":function(){define(["exports","../../../../symbols/cim/cimAnalyzer",
"../../../../symbols/cim/ExpandedCIM","./webStyleUtils"],function(n,l,F,D){const A=async(u,m,h)=>{m=new l.CIMAnalyzer(h,m);return new F.ExpandedCIM(await m.analyzeSymbolReference(u.data,!1),u.data,u.rendererKey,u.maxVVSize)};n.cimLayerToRasterizationInfo=function(u){if(!u)return null;const {avoidSDFRasterization:m,type:h,cim:f,url:d,materialHash:c,maxVVSize:a}=u,b={cim:f,type:h,mosaicHash:c,url:d,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:m};
switch(h){case "marker":a&&"size"in f&&(f.size=Math.max(a,f.size));b.size=u.size;b.path=u.path;b.animatedSymbolProperties=u.animatedSymbolProperties;break;case "line":b.dashTemplate=u.dashTemplate;break;case "text":b.text=u.text,b.fontName=u.fontName}return b};n.expandSymbol=async function(u,m,h,f){return u?"cim"===u.type?A(u,m,h):"web-style"===u.type?(u={type:"cim",data:await D.fetchCIMSymbolReference(u,null,f)??void 0,rendererKey:u.rendererKey,maxVVSize:u.maxVVSize},A(u,m,h)):u:null};Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/ExpandedCIM":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../views/2d/engine/webgl/enums","../../views/2d/engine/webgl/materialKey/MaterialKey"],function(n,l,F,D){const A={marker:F.WGLGeometryType.MARKER,fill:F.WGLGeometryType.FILL,line:F.WGLGeometryType.LINE,text:F.WGLGeometryType.TEXT};let u=function(){function m(h,f,d,c){const a={minScale:f?.minScale,maxScale:f?.maxScale};var b=a.minScale||a.maxScale?a.minScale+
"-"+a.maxScale:"";this.layers=h;this.data=f;this.hash=this._createHash()+b;this.rendererKey=d;f={isOutline:!1,placement:null,symbologyType:F.WGLSymbologyType.DEFAULT,vvFlags:d};for(const g of h)h=A[g.type],f.isOutline="line"===g.type&&g.isOutline,g.materialKey=D.createMaterialKey(h,f),g.maxVVSize=c,g.scaleInfo=a,g.templateHash+=b}m.prototype._createHash=function(){let h="";for(const f of this.layers)h+=f.templateHash;return h};l._createClass(m,[{key:"type",get:function(){return"expanded-cim"}}]);
return m}();n.ExpandedCIM=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/webStyleUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../core/Error ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../portal/Portal ../../../../chunks/persistableUrlUtils ../../../../symbols/support/styleUtils ../../../../symbols/support/webStyleSymbolUtils".split(" "),function(n,l,F,D,A,u,m,h,f){async function d(a,b){a=h.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,
a.name);try{const g=await h.requestJSON(a,b);return h.makeCIMSymbolRef(g.data)}catch(g){return D.throwIfAbortError(g),null}}async function c(a,b,g,e){g={portal:g&&null!=g.portal?g.portal:u.getDefault(),url:A.urlToObject(a.baseUrl),origin:"portal-item"};a=f.getStyleItemFromStyle(b,a.data);if(!a)throw new F("symbolstyleutils:symbol-name-not-found",`The symbol name '${b}' could not be found`,{symbolName:b});b=m.fromJSON(h.symbolUrlFromStyleItem(a,"cimRef"),g);l.isDevEnvironment()&&(b=l.adjustStaticAGOUrl(b));
try{const k=await h.requestJSON(b,e);return h.makeCIMSymbolRef(k.data)}catch(k){return D.throwIfAbortError(k),null}}n.fetchCIMSymbolReference=async function(a,b,g){if(!a.name)throw new F("style-symbol-reference-name-missing","Missing name in style symbol reference");if(a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName)return d(a,g);try{const e=await h.fetchStyle(a,b,g);return c(e,a.name,b,g)}catch(e){return D.throwIfAbortError(e),null}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/core/devEnvironmentUtils":function(){define(["exports"],function(n){const l=/^devext.arcgis.com$/,F=/^qaext.arcgis.com$/,D=/^[\w-]*\.mapsdevext.arcgis.com$/,A=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,l,F,/^jsapps.esri.com$/,D,A];n.adjustStaticAGOUrl=function(m,h){return m?(h=h||globalThis.location.hostname)?null!=h.match(l)||null!=h.match(D)?m.replace("static.arcgis.com","staticdev.arcgis.com"):null!=h.match(F)||null!=h.match(A)?m.replace("static.arcgis.com",
"staticqa.arcgis.com"):m:m:m};n.isDevEnvironment=function(m){m=m||globalThis.location.hostname;return u.some(h=>null!=m?.match(h))};n.isTelemetryDevEnvironment=function(m){m=m||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(u).some(h=>null!=m?.match(h))};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/maybe ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){function b(k,p){return p.items.find(q=>q.name===k)}function g(k,p,q,t,v,y){const w=q&&null!=q.portal?q.portal:m.getDefault(),z={portal:w,url:u.urlToObject(k.baseUrl),origin:"portal-item"},r=b(p,k.data);if(!r)return Promise.reject(new D("symbolstyleutils:symbol-name-not-found",`The symbol name '${p}' could not be found`,{symbolName:p}));v=h.fromJSON(v(r,t),z);let C=r.thumbnail?.href??null;const x=r.thumbnail&&r.thumbnail.imageData;F.isDevEnvironment()&&(v=F.adjustStaticAGOUrl(v)??
"",C=F.adjustStaticAGOUrl(C));const E={portal:w,url:u.urlToObject(u.removeFile(v)),origin:"portal-item"};return c.requestJSON(v,y).then(B=>{B="cimRef"===t?c.makeCIMSymbolRef(B.data):B.data;if((B=f.fromJSON(B,E))&&l.isSymbol3D(B)){if(C){const G=h.fromJSON(C,z);B.thumbnail=new a.Thumbnail({url:G})}else x&&(B.thumbnail=new a.Thumbnail({url:`data:image/png;base64,${x}`}));k.styleUrl?B.styleOrigin=new d({portal:q.portal,styleUrl:k.styleUrl,name:p}):k.styleName&&(B.styleOrigin=new d({portal:q.portal,styleName:k.styleName,
name:p}))}return B})}function e(k,p,q){const t=c.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,k),v=null!=p.portal?p.portal:m.getDefault();return c.requestJSON(t,q).then(y=>{y=c.makeCIMSymbolRef(y.data);return f.fromJSON(y,{portal:v,url:u.urlToObject(u.removeFile(t)),origin:"portal-item"})})}n.fetchSymbolFromStyle=g;n.getStyleItemFromStyle=b;n.resolveWebStyleSymbol=function(k,p,q,t){const v=k.name;return null==v?Promise.reject(new D("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
k.styleName&&"Esri2DPointSymbolsStyle"===k.styleName?e(v,p,t):c.fetchStyle(k,p,t).then(y=>g(A.unwrapOrThrow(y),v,p,q,c.symbolUrlFromStyleItem,t))};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/Logger ../../../../../core/LRUCache ../../../../../support/arcadeOnDemand ../../../arcade/callExpressionWithFeature ../../../layers/support/cimSymbolUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d){async function c(y,w,z,r){switch(y.type){case "simple":case "heatmap":return e.fromBasicRenderer(y,w,z,r);case "map":return q.fromUVRenderer(y,w,z,r);case "interval":return p.fromCBRenderer(y,w,z,r);case "dictionary":return v.fromDictionaryRenderer(y,w,z,r);case "pie-chart":return k.fromPieChartRenderer(y,w,z,r);case "subtype":return k.fromSubtypes(y,w,z,r)}}async function a(y,w){const z=y||1;if("number"===typeof z)return(C,x,E)=>z;const r=await h.createRendererExpression(z,
w.spatialReference,w.fields);return(C,x,E)=>f(r,C,{$view:E},w.geometryType,x)||1}async function b(){t||(t=new Promise((y,w)=>n(["../../../layers/features/createSymbolSchema"],y,w)));return t}const g=u.getLogger("esri/views/2d/engine/webgl/util/Matcher");let e=function(){function y(){this.type="feature";this._defaultResult=null}y.fromBasicRenderer=async function(z,r,C,x){const E=new y;z.symbol&&(z=await d.expandSymbol(z.symbol,C,x),r=r.createTemplateGroup(z,null),E.setDefault(r));return E};y.fromPieChartRenderer=
async function(z,r,C,x){const E=new y;if(z.markerSymbol){const B=await d.expandSymbol(z.markerSymbol,C,x);let G;z.fillSymbol&&(G=await d.expandSymbol(z.fillSymbol,C,x));z=r.createTemplateGroup(B,G);E.setDefault(z)}return E};var w=y.prototype;w.size=function(){return 1};w.getDefault=function(){return this._defaultResult};w.setDefault=function(z){this._defaultResult=z};w.match=function(z,r,C,x,E){return this.getDefault()};w.analyze=async function(z,r,C,x,E,B){return null};return F._createClass(y)}(),
k=function(y){function w(z,r){var C=y.call(this)||this;C._subMatchers=z;C._subtypeField=r;return C}F._inherits(w,y);w.fromSubtypes=async function(z,r,C,x){const E=new Map,B=[];for(const G in z.renderers){const H=parseInt(G,10),I=c(z.renderers[G],r,C,x).then(J=>E.set(H,J));B.push(I)}await Promise.all(B);return new w(E,z.subtypeField)};w.prototype.match=function(z,r,C,x,E){var B=r.readAttribute(this._subtypeField);return(B=this._subMatchers.get(B))?B.match(z,r,C,x,E):null};return F._createClass(w)}(e),
p=function(y){function w(r,C,x,E){var B=y.call(this)||this;B.type="interval";B._intervals=[];B._isMaxInclusive=C;B._fieldIndex=E;B._field=r;B._normalizationInfo=x;return B}F._inherits(w,y);w.fromCBRenderer=async function(r,C,x,E){const {isMaxInclusive:B,normalizationField:G,normalizationTotal:H,normalizationType:I}=r,J=new w(r.field,B,{normalizationField:G,normalizationTotal:H,normalizationType:I},r.fieldIndex),L=await d.expandSymbol(r.backgroundFillSymbol,x,E);await Promise.all(r.intervals.map(async K=>
{var S=await d.expandSymbol(K.symbol,x,E);S=await C.createTemplateGroup(S,L);J.add({min:K.min,max:K.max},S)}));if(r=await d.expandSymbol(r.defaultSymbol,x,E))r=await C.createTemplateGroup(r,L),J.setDefault(r);return J};var z=w.prototype;z.add=function(r,C){this._intervals.push({interval:r,result:C});this._intervals.sort((x,E)=>x.interval.min-E.interval.min)};z.size=function(){return F._get(F._getPrototypeOf(w.prototype),"size",this).call(this)+this._intervals.length};z.match=function(r,C,x,E,B){if(null==
this._fieldIndex&&!this._field)return this.getDefault();r=null!=this._fieldIndex?C.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(C);if(null===r||void 0===r||isNaN(r)||Infinity===r||-Infinity===r)return this.getDefault();for(C=0;C<this._intervals.length;C++){const {interval:G,result:H}=this._intervals[C];x=this._isMaxInclusive?r<=G.max:r<G.max;if(r>=G.min&&x)return H}return this.getDefault()};z._needsNormalization=function(){const r=this._normalizationInfo;return r&&(r.normalizationField||
r.normalizationTotal||r.normalizationType)};z._getValueFromField=function(r){const C=r.readAttribute(this._field);if(!this._needsNormalization()||null==C)return C;const {normalizationField:x,normalizationTotal:E,normalizationType:B}=this._normalizationInfo;r=r.readAttribute(x)??1;if(B)switch(B){case "esriNormalizeByField":return(r||void 0)&&C/r;case "esriNormalizeByLog":return Math.log(C)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return C/E*100;default:g.error(`Found unknown normalization type: ${B}`)}else g.error("Normalization is required, but no type was set!")};
return F._createClass(w)}(e),q=function(y){function w(r,C,x){var E=y.call(this)||this;E.type="map";E._nullResult=null;E._resultsMap=new Map;E._fields=[];E._fieldsIndex=x;E._fields=r;E._seperator=C||"";return E}F._inherits(w,y);w.fromUVRenderer=async function(r,C,x,E){const B=r.fieldDelimiter,G=[r.field];r.field2&&G.push(r.field2);r.field3&&G.push(r.field3);const H=await d.expandSymbol(r.backgroundFillSymbol,x,E),I=new w(G,B,r.fieldIndex);await Promise.all(r.map.map(async(J,L)=>{const K=await d.expandSymbol(J.symbol,
x,E);L=await C.createTemplateGroup(K,H,L+1);"\x3cNull\x3e"===J.value?I.setNullResult(L):I.add(J.value,L)}));if(r=await d.expandSymbol(r.defaultSymbol,x,E))r=await C.createTemplateGroup(r,H,Number.MAX_SAFE_INTEGER),I.setDefault(r);return I};var z=w.prototype;z.setNullResult=function(r){this._nullResult=r};z.add=function(r,C){this._resultsMap.set(r.toString(),C)};z.size=function(){return F._get(F._getPrototypeOf(w.prototype),"size",this).call(this)+this._resultsMap.size};z.match=function(r,C,x,E,B){if(null==
this._fieldsIndex&&!this._fields)return this.getDefault();r=null!=this._fieldsIndex?C.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(C);if(null!==this._nullResult&&(null==r||""===r||"\x3cNull\x3e"===r))return this._nullResult;if(null==r)return this.getDefault();r=r.toString();return this._resultsMap.has(r)?this._resultsMap.get(r):this.getDefault()};z._getValueFromFields=function(r){const C=[];for(const x of this._fields){const E=r.readAttribute(x);null==E||""===E?C.push("\x3cNull\x3e"):
C.push(E)}return C.join(this._seperator)};return F._createClass(w)}(e),t,v=function(y){function w(r,C,x,E,B,G){var H=y.call(this)||this;H.type="dictionary";H._groupIdCache=new m.LRUCache(100);H._loader=r;H._fieldMap=r.fieldMap;H._symbolFields=r.getSymbolFields();H._templates=C;H._info=x;H._scaleFn=E;H._schemaUtilsModule=B;H._symbolOptions=G;return H}F._inherits(w,y);w.fromDictionaryRenderer=async function(r,C,x,E){const [{DictionaryLoader:B},G]=await Promise.all([new Promise((I,J)=>n(["../../../../../renderers/support/DictionaryLoader"],
I,J)),b()]);E=new B(r.url,r.config,r.fieldMap);await E.fetchResources({spatialReference:x.spatialReference,fields:x.fields});const H=await a(r.scaleExpression,x);return new w(E,C,x,H,G,r.symbolOptions)};var z=w.prototype;z._analyzeFeature=async function(r,C,x,E,B){r=r.readLegacyFeature();const G=this._scaleFn(r,x,E);x=this._attributeHash(r)+"-"+G;const H=this._groupIdCache.get(x);if(H)return H;E=await this._loader.getSymbolAsync(r,{...E,spatialReference:this._info.spatialReference,abortOptions:B,
fields:this._info.fields});E=this._schemaUtilsModule.createSymbolSchema(E,this._symbolOptions);C=d.expandSymbol(E,this._info,C,B).then(I=>{if("expanded-cim"!==I?.type)return g.error(new A("mapview-bad-type",`Found unexpected type ${I?.type} in dictionary response`)),null;I.hash+="-"+G;for(const J of I.layers)J.scaleFactor=G,J.templateHash+="-"+G;return this._templates.createTemplateGroup(I,null)});this._groupIdCache.put(x,C,1);return C};z.analyze=async function(r,C,x,E,B,G){r=C.getCursor();for(C=
[];r.next();)C.push(this._analyzeFeature(r,x,E,B,G));return Promise.all(C).then(H=>H.filter(D.isSome))};z.match=function(r,C,x,E,B){return null};z._attributeHash=function(r){let C="";for(const x of this._symbolFields){const E=this._fieldMap?.[x];E&&(C+=r.attributes[E]+"-")}return C};return F._createClass(w)}(e);l.DictionaryMatcher=v;l.FeatureMatcher=e;l.IntervalMatcher=p;l.MapMatcher=q;l.SubtypeMatcher=k;l.createMatcher=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schemaUtils":function(){define("exports ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/screenUtils ../../../../core/sql ../../../../core/accessorSupport/diffUtils ../../../../layers/support/labelingInfo ../../engine/webgl/enums ../../engine/webgl/Utils ../../engine/webgl/techniques/utils ../../engine/webgl/util/vvFlagUtils ./createSymbolSchema ./support/pixelBuffering ./support/rendererUtils ../support/clusterUtils ../support/util".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q){function t(N,T){let U=0,Y=0,ca=d.WGLSymbologyType.DEFAULT;if(null!=N){Y=e.getPtMaxVVSize(N,T);"visualVariables"in N&&(U=b.getVVFlags(N.visualVariables||[]),"dot-density"===N.type&&(ca=d.WGLSymbologyType.DOT_DENSITY));"heatmap"===N.type&&(ca=d.WGLSymbologyType.HEATMAP);if("dictionary"===N.type)return{maxVVSize:Y,vvFlags:U,symbologyType:d.WGLSymbologyType.DEFAULT};if("pie-chart"===N.type)return{maxVVSize:Y,vvFlags:U,symbologyType:d.WGLSymbologyType.PIE_CHART};
if(ca!==d.WGLSymbologyType.DOT_DENSITY&&ca!==d.WGLSymbologyType.HEATMAP){var da=N.getSymbols();"backgroundFillSymbol"in N&&N.backgroundFillSymbol&&da.push(N.backgroundFillSymbol);T=N=!0;for(const fa of da){if("cim"===fa.type||"web-style"===fa.type)T=!1;if("simple-fill"===fa.type||"picture-fill"===fa.type){da=(da=fa.outline)&&"none"!==da.style&&"solid"!==da.style;var ea="simple-fill"===fa.type&&"none"!==fa.style&&"solid"!==fa.style;ea="picture-fill"===fa.type||ea||da;da&&(N=!1);ea&&(T=!1)}}N?ca=T?
d.WGLSymbologyType.OUTLINE_FILL_SIMPLE:d.WGLSymbologyType.OUTLINE_FILL:T&&(ca=d.WGLSymbologyType.SIMPLE)}}return{vvFlags:U,maxVVSize:Y,symbologyType:ca}}function v(N,T=!1){try{const Y=H(N,T);var U="heatmap"===N.renderer?.type&&"raster"===k.getSupportedHeatmapRenderer()?{type:"heatmap"}:{type:"symbol"};const ca={};Y.map(da=>y(ca,N,da));return{source:{definitionExpression:m.sqlAnd(N.definitionExpression,null!=N.subtypeCode?`${N.subtypeField} = ${N.subtypeCode}`:null),fields:N.fields.map(da=>da.toJSON()),
gdbVersion:N.gdbVersion,historicMoment:N.historicMoment?.getTime(),outFields:N.availableFields,pixelBuffer:N.pixelBuffer,spatialReference:N.spatialReference.toJSON(),timeExtent:N.timeExtent?.toJSON(),customParameters:N.customParameters},attributes:{fields:{},indexCount:0},processors:Y,tileRenderer:U,targets:ca}}catch(Y){if("ValidationError"===Y.fieldName)return aa.error(Y),null;throw Y;}}function y(N,T,U){switch(U.target){case "feature":r(N,z(T),U);break;case "aggregate":if("featureReduction"in T){var Y=
T.featureReduction;switch(Y?.type){case "selection":throw new F("ValidationError","Mapview does not support `selection` reduction type",Y);case "binning":r(N,z(T),U);x(N,Y,T.fields.map(ca=>ca.toJSON()),U);break;case "cluster":r(N,z(T),U),E(N,Y,T.fields.map(ca=>ca.toJSON()),U)}}}}function w(N,T){for(const Y in T){const ca=T[Y];if(ca.target===N.name){var U=N.attributes[Y];U?.context?(U=U.context,U.mesh=U.mesh||ca.context?.mesh,U.storage=U.storage||ca.context?.storage):N.attributes[Y]=ca}}return N}function z(N){return[N.filter?.toJSON()??
null,N.featureEffect?.filter?.toJSON()??null]}function r(N,T,U){N.feature||(N.feature={name:"feature",input:"source",filters:T,attributes:{}});w(N.feature,U.attributes.fields);return N}function C(N,T){const {onStatisticExpression:U,onStatisticField:Y,statisticType:ca}=N;switch(ca){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":if(U)return{returnType:T}=U,T?"string"===T?"esriFieldTypeString":"esriFieldTypeDouble":(aa.error(new F("ValidationError",
"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",N)),"esriFieldTypeString");T=T.find(da=>da.name===Y);return T?T.type:(aa.error(new F("ValidationError","Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",N)),"esriFieldTypeString")}}function x(N,T,U,Y){N.aggregate||(N.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:T.fixedBinLevel,fields:(T.fields??[]).map(ca=>({...ca.toJSON(),
type:C(ca,U)}))},attributes:{}});w(N.aggregate,Y.attributes.fields);return N}function E(N,T,U,Y){const ca=Y.aggregateFields??[],da=new Set;for(const ea of ca)da.add(ea.name);for(const ea of T?.fields??[])da.has(ea.name)||ca.push(ea);N.aggregate||(N.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:u.pt2px(T.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(u.pt2px(T.clusterMaxSize)/64),fields:ca.map(ea=>({...ea.toJSON(),type:C(ea,U)}))}});w(N.aggregate,
Y.attributes.fields);return N}function B(N,T){return T.field?G(N,{...T,type:"field",field:T.field}):T.valueExpression?G(N,{...T,type:"expression",valueExpression:T.valueExpression}):{field:void 0,fieldIndex:void 0}}function G(N,T){switch(T.type){case "expression":var U=T.valueExpression;if(!N.fields[U]){var Y=N.indexCount++;N.fields[U]={...T,name:U,fieldIndex:Y}}return{fieldIndex:N.fields[U].fieldIndex};case "label-expression":return U=JSON.stringify(T.label),N.fields[U]||(Y=N.indexCount++,N.fields[U]=
{...T,name:U,fieldIndex:Y}),{fieldIndex:N.fields[U].fieldIndex};case "field":U=T.field;if("aggregate"===T.target&&N.fields[U])return{field:U};N.fields[U]={...T,name:U};return{field:U};case "statistic":return N.fields[T.name]={...T},{field:T.name}}}function H(N,T=!1){const U=[];let Y=0;U.push(L(N,Y++,T));return U}function I(N,T,U,Y,ca,da=!1){N=G(N,{type:"label-expression",target:U,context:{mesh:!0},resultType:"string",label:{labelExpression:T.labelExpression,labelExpressionInfo:T.labelExpressionInfo?
{expression:T.labelExpressionInfo.expression}:null,symbol:!!T.symbol,where:T.where}});({fieldIndex:N}=N);return{...g.createSymbolSchema(T,ca,da),fieldIndex:N,target:U,index:Y}}function J(N,T,U){const Y="featureReduction"in T&&T.featureReduction;if(!Y)return{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};const ca=[];let da=null,ea=q.toJSONGeometryType(T.geometryType),fa=[];var ja=null;if(Y)switch(Y.type){case "selection":return aa.error(new F("ValidationError","Mapview does not support `selection` reduction type",
Y)),{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};case "cluster":case "binning":ca.push(...(Y.fields??[])),"cluster"===Y.type?ea="esriGeometryPoint":"binning"===Y.type&&(ea="esriGeometryPolygon"),Y.renderer&&!Y.renderer.authoringInfo?.isAutoGenerated?("cluster"===Y.type?{renderer:ja}=p.injectDynamicLevelDependentSizeVisualVariable(Y.renderer,Y,null):ja=Y.renderer,T=t(Y.renderer,Y),da=V(N,"aggregate",Y.renderer,T,U),fa=Y&&Y.labelsVisible&&Y.labelingInfo||[]):"cluster"===Y.type&&(ja=
p.createClusterRenderer(ca,T.renderer,Y,null,!0),Y.symbol&&(T=t(ja,Y),da={type:"simple",symbol:g.createSymbolSchema(Y.symbol,T,U),symbologyType:T.symbologyType}),fa=Y&&Y.labelsVisible&&Y.labelingInfo||[])}S(N,ca);return{labels:f.validateLabelingInfo(fa,"binning"===Y.type?"esriGeometryPolygon":ea),matcher:da,fields:ca,rendererOverride:ja}}function L(N,T,U=!1){const Y={indexCount:0,fields:{}};var ca="featureReduction"in N?N.featureReduction??void 0:void 0;T=ca?"aggregate":"feature";if("sublayers"in
N){var da={type:"subtype",subtypeField:N.subtypeField,renderers:{},symbologyType:d.WGLSymbologyType.DEFAULT},ea={type:"subtype",mapping:{},target:"feature",subtypeField:N.subtypeField},fa={type:"subtype",classes:{}},ja={type:"symbol",target:"feature",aggregateFields:[],attributes:Y,storage:ea,mesh:{matcher:da,aggregateMatcher:null,labels:fa,sortKey:null}};ca=new Set;let ka=0;for(const {renderer:ma,subtypeCode:na,labelingInfo:oa,labelsVisible:pa}of N.sublayers){N=0;"visualVariables"in ma&&ma.visualVariables&&
(ma.visualVariables.some(wa=>"rotation"!==wa.type)&&aa.warnOnce("SubtypeGroupLayer currently only supports rotation visualVariables. All other visualVariable types will be ignored."),N=b.getVVFlags(ma.visualVariables.filter(wa=>"size"!==wa.type)));const Ea={symbologyType:d.WGLSymbologyType.DEFAULT,vvFlags:N,maxVVSize:0};N=V(Y,T,ma,Ea,U);const ta=W(Y,T,ma),ua=pa&&oa;if("dictionary"===N.type)throw new F("ValidationError","Dictionary renderer is not supported in subtype layers");if("subtype"===N.type)throw new F("ValidationError",
"Nested subtype renderers is not supported");if(null!=ta&&"subtype"===ta.type)throw new F("ValidationError","Nested subtype storage is not supported");if(null!=ta&&null!=ta.attributeMapping)throw new F("ValidationError","Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===N.type)throw new F("ValidationError","Heatmaps are not supported in subtype layers");if("pie-chart"===N.type)throw new F("ValidationError","Pie-charts are not supported in subtype layers");if(ca.has(na))throw new F("ValidationError",
"Subtype codes for sublayers must be unique");ca.add(na);da.renderers[na]=N;ea.mapping[na]=ta;ua&&(fa.classes[na]=ua.map(wa=>I(Y,wa,"feature",ka++,Ea,U)))}return ja}if("heatmap"===N.renderer?.type&&"raster"===k.getSupportedHeatmapRenderer()){const {radius:ka,fieldOffset:ma,field:na}=N.renderer;return{type:"heatmap",aggregateFields:[],attributes:Y,target:T,storage:null,mesh:{radius:ka,fieldOffset:ma,field:B(Y,{target:T,field:na,resultType:"numeric"}).field}}}da=J(Y,N,U);fa=q.toJSONGeometryType(N.geometryType);
ja=da.rendererOverride??N.renderer;const ia=t(ja,ca);ea=V(Y,T,ja,ia,U);ja=W(Y,T,ja);ca=K(Y,N.orderBy,N.renderer,ca);let ha=0;N=[...f.validateLabelingInfo(N.labelsVisible&&N.labelingInfo||[],fa).map(ka=>I(Y,ka,"feature",ha++,ia,U)),...da.labels.map(ka=>I(Y,ka,"aggregate",ha++,ia,U))];return{type:"symbol",target:T,attributes:Y,aggregateFields:da.fields,storage:ja,mesh:{matcher:ea,labels:{type:"simple",classes:N},aggregateMatcher:da.matcher,sortKey:ca}}}function K(N,T,U,Y){if(null!=Y)return null;if(null!=
T&&T.length){1<T.length&&aa.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${T.length}. All but the first will be discarded`);T=T[0];U="ascending"===T.order?"asc":"desc";if(T.field)return{field:T.field,order:U};if(T.valueExpression)return{fieldIndex:G(N,{type:"expression",target:"feature",valueExpression:T.valueExpression,resultType:"numeric"}).fieldIndex,order:U};aa.error(new F("ValidationError","Expected to find a field or valueExpression for OrderByInfo",T));
return null}return null!=U&&"unique-value"===U.type&&U.orderByClassesEnabled?{byRenderer:!0,order:"asc"}:null}function S(N,T){const U={mesh:!0,storage:!0};for(const Y of T){const {name:ca,onStatisticField:da,onStatisticExpression:ea,statisticType:fa}=Y;let ja=T=void 0;ea?ja=G(N,{type:"expression",target:"feature",valueExpression:ea.expression,resultType:"numeric"}).fieldIndex:T=G(N,{type:"field",target:"feature",field:da,resultType:"numeric"}).field;G(N,{type:"statistic",target:"aggregate",name:ca,
context:U,inField:T,inFieldIndex:ja,statisticType:fa})}}function W(N,T,U){let Y;switch(U.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":Y={visualVariables:!0,attributes:null};break;default:Y=a.getTechniqueFromRenderer(U).getStorageSpec(U)}return X(N,T,Y,U)}function X(N,T,U,Y){if(null==U)return null;const {visualVariables:ca,attributes:da}=U;U=null;ca&&"visualVariables"in Y&&(U=Z(N,T,Y.visualVariables));const ea=null!=U?4:0;Y=null;null!=da&&(Y=da.map((fa,ja)=>{const {field:ia,
fieldIndex:ha}=B(N,{valueExpression:fa.valueExpression,field:fa.field,resultType:"numeric",target:T});return{binding:ja+ea,field:ia,fieldIndex:ha}}));return{type:"simple",target:T,attributeMapping:Y,vvMapping:U}}function Z(N,T,U){if(!U||!U.length)return[];const Y={storage:!0};return k.simplifyVisualVariables(U).map(ca=>{const da=c.getVVType(ca.type),{field:ea,fieldIndex:fa}=B(N,{target:T,valueExpression:ca.valueExpression,field:ca.field,context:Y,resultType:"numeric"});switch(ca.type){case "size":return"$view.scale"===
ca.valueExpression?null:{type:"size",binding:da,field:ea,fieldIndex:fa,normalizationField:B(N,{target:T,field:ca.normalizationField,context:Y,resultType:"numeric"}).field,valueRepresentation:ca.valueRepresentation??null};case "color":return{type:"color",binding:da,field:ea,fieldIndex:fa,normalizationField:B(N,{target:T,field:ca.normalizationField,context:Y,resultType:"numeric"}).field};case "opacity":return{type:"opacity",binding:da,field:ea,fieldIndex:fa,normalizationField:B(N,{target:T,field:ca.normalizationField,
context:Y,resultType:"numeric"}).field};case "rotation":return{type:"rotation",binding:da,field:ea,fieldIndex:fa}}}).filter(l.isSome)}function V(N,T,U,Y,ca=!1){N=N??{indexCount:0,fields:{}};switch(U.type){case "simple":case "dot-density":return O(N,U,Y,ca);case "class-breaks":return M(N,T,U,Y,ca);case "unique-value":return Q(N,T,U,Y,ca);case "dictionary":return{type:"dictionary",config:U.config,fieldMap:U.fieldMap,scaleExpression:U.scaleExpression,url:U.url,symbolOptions:Y,symbologyType:Y.symbologyType};
case "heatmap":return R(N,U,Y,ca);case "pie-chart":return P(N,U,Y,ca)}}function O(N,T,U,Y=!1){N=T.getSymbols();return{type:"simple",symbol:g.createSymbolSchema(N.length?N[0]:null,U,Y),symbologyType:U.symbologyType}}function P(N,T,U,Y=!1){N=T.getSymbols();T=1<N.length?N[1]:null;return{type:"pie-chart",markerSymbol:g.createSymbolSchema(N[0],U,Y),fillSymbol:g.createSymbolSchema(T,U,Y),symbologyType:U.symbologyType}}function M(N,T,U,Y,ca=!1){const da=U.backgroundFillSymbol,{field:ea,fieldIndex:fa}=B(N,
{target:T,field:U.field,valueExpression:U.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}});T=U.normalizationType;T="log"===T?"esriNormalizeByLog":"percent-of-total"===T?"esriNormalizeByPercentOfTotal":"field"===T?"esriNormalizeByField":null;const ja=U.classBreakInfos.map(ia=>({symbol:g.createSymbolSchema(ia.symbol,Y,ca),min:ia.minValue,max:ia.maxValue})).sort((ia,ha)=>ia.min-ha.min);return{type:"interval",attributes:N.fields,field:ea,fieldIndex:fa,backgroundFillSymbol:g.createSymbolSchema(da,
Y,ca),defaultSymbol:g.createSymbolSchema(U.defaultSymbol,Y,ca),intervals:ja,normalizationField:U.normalizationField,normalizationTotal:U.normalizationTotal,normalizationType:T,isMaxInclusive:U.isMaxInclusive,symbologyType:Y.symbologyType}}function Q(N,T,U,Y,ca=!1){const da=[],ea=U.backgroundFillSymbol;T={target:T,context:{mesh:!0},resultType:"string"};if(U.field&&"string"!==typeof U.field)throw new F("ValidationError","Expected renderer.field to be a string",U);const {field:fa,fieldIndex:ja}=B(N,
{...T,field:U.field,valueExpression:U.valueExpression});for(const ia of U.uniqueValueInfos??[])da.push({value:""+ia.value,symbol:g.createSymbolSchema(ia.symbol,Y,ca)});return{type:"map",attributes:N.fields,field:fa,fieldIndex:ja,field2:B(N,{...T,field:U.field2}).field,field3:B(N,{...T,field:U.field3}).field,fieldDelimiter:U.fieldDelimiter??void 0,backgroundFillSymbol:g.createSymbolSchema(ea,Y),defaultSymbol:g.createSymbolSchema(U.defaultSymbol,Y),map:da,symbologyType:Y.symbologyType}}function R(N,
T,U,Y=!1){N=T.getSymbols();return{type:"heatmap",symbol:g.createSymbolSchema(N.length?N[0]:null,U,Y),symbologyType:U.symbologyType}}const aa=A.getLogger("esri.views.2d.layers.features.schemaUtils");let ba=null;n.createSymbolSchema=g.createSymbolSchema;n.addAggregateFields=S;n.createMatcherSchema=V;n.createRendererAttributeSchema=B;n.createSchema=function(N){if(D("esri-2d-update-debug")){const T=v(N,!0);console.debug("Created new schema",T);console.debug("Schema diff",h.diff(ba,T));ba=T}return v(N)};
n.createSymbolSchemaOptions=t;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["exports","../enums","../visualVariablesUtils"],function(n,l,F){n.getVVFlags=function(D){if(!D)return l.WGLVVFlag.NONE;let A=0;for(const u of D)"size"===u.type?(D=F.getTypeOfSizeVisualVariable(u),A|=D,"outline"===u.target&&(A|=D<<4)):"color"===u.type?A|=l.WGLVVFlag.COLOR:"opacity"===u.type?A|=l.WGLVVFlag.OPACITY:"rotation"===u.type&&(A|=l.WGLVVFlag.ROTATION);
return A};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define(["exports","../../../../core/Error","../../../../core/Logger","./enums","./Utils"],function(n,l,F,D,A){n.getTypeOfSizeVisualVariable=function(u){if(A.isNumber(u.minDataValue)&&A.isNumber(u.maxDataValue)&&null!=u.minSize&&null!=u.maxSize)return D.WGLVVFlag.SIZE_MINMAX_VALUE;if((u.expression&&"view.scale"===u.expression||u.valueExpression&&"$view.scale"===u.valueExpression)&&
Array.isArray(u.stops))return D.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=u.field||u.expression&&"view.scale"!==u.expression||u.valueExpression&&"$view.scale"!==u.valueExpression)&&(Array.isArray(u.stops)||"levels"in u&&u.levels))return D.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=u.field||u.expression&&"view.scale"!==u.expression||u.valueExpression&&"$view.scale"!==u.valueExpression)&&null!=u.valueUnit)return D.WGLVVFlag.SIZE_UNIT_VALUE;F.getLogger("esri.views.2d.engine.webgl").error(new l("mapview-bad-type",
"Found invalid size VisualVariable",u));return D.WGLVVFlag.NONE};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/createSymbolSchema":function(){define(["exports","../../engine/webgl/enums","../../engine/webgl/materialKey/MaterialKey"],function(n,l,F){function D(m){switch(m.type){case "line-marker":return{type:"line-marker",color:m.color?.toJSON(),placement:m.placement,style:m.style};default:return m.constructor.fromJSON(m.toJSON()).toJSON()}}function A(m,
h,f){var d=F.createMaterialKey(l.WGLGeometryType.FILL,h);d=f?F.hydrateMaterialKey(d):d;var c=m.clone();m=c.outline;const a=F.isOutlineFillSymbology(h.symbologyType);a||(c.outline=null);c={materialKey:d,hash:c.hash(),...D(c)};if(a)return c;d=[];d.push(c);m&&(h=F.createMaterialKey(l.WGLGeometryType.LINE,{...h,isOutline:!0}),f={materialKey:f?F.hydrateMaterialKey(h):h,hash:m.hash(),...D(m)},d.push(f));return{type:"composite-symbol",layers:d,hash:d.reduce((b,g)=>g.hash+b,"")}}function u(m,h,f){var d=F.isOutlineFillSymbology(h.symbologyType)?
l.WGLSymbologyType.DEFAULT:h.symbologyType;d=F.createMaterialKey(l.WGLGeometryType.LINE,{...h,symbologyType:d});const c=f?F.hydrateMaterialKey(d):d;m=m.clone();d=m.marker;m.marker=null;const a=[];a.push({materialKey:c,hash:m.hash(),...D(m)});d&&(h=F.createMaterialKey(l.WGLGeometryType.MARKER,h),f=f?F.hydrateMaterialKey(h):h,d.color=d.color??m.color,a.push({materialKey:f,hash:d.hash(),lineWidth:m.width,...D(d)}));return{type:"composite-symbol",layers:a,hash:a.reduce((b,g)=>g.hash+b,"")}}n.createSymbolSchema=
function(m,h,f=!1){if(!m)return null;switch(m.type){case "simple-fill":case "picture-fill":return A(m,h,f);case "simple-marker":case "picture-marker":var d=F.createMaterialKey(l.WGLGeometryType.MARKER,h);f=f?F.hydrateMaterialKey(d):d;d=D(m);return{materialKey:f,hash:m.hash(),...d,angle:m.angle,maxVVSize:h.maxVVSize};case "simple-line":return u(m,h,f);case "text":return d=F.createMaterialKey(l.WGLGeometryType.TEXT,h),f=f?F.hydrateMaterialKey(d):d,d=D(m),{materialKey:f,hash:m.hash(),...d,angle:m.angle,
maxVVSize:h.maxVVSize};case "label":return d=m.toJSON(),h=F.createMaterialKey(l.WGLGeometryType.LABEL,{...h,placement:d.labelPlacement}),{materialKey:f?F.hydrateMaterialKey(h):h,hash:m.hash(),...d,labelPlacement:d.labelPlacement};case "cim":return{type:"cim",rendererKey:h.vvFlags,data:m.data,maxVVSize:h.maxVVSize};case "CIMSymbolReference":return{type:"cim",rendererKey:h.vvFlags,data:m,maxVVSize:h.maxVVSize};case "web-style":return{...D(m),type:"web-style",hash:m.hash(),rendererKey:h.vvFlags,maxVVSize:h.maxVVSize};
default:throw Error(`symbol not supported ${m.type}`);}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/pixelBuffering":function(){define("exports ../../../../../core/screenUtils ../../../../../symbols/cim/CIMSymbolHelper ../../../../../symbols/cim/Rect ../../../engine/webgl/definitions ../../graphics/graphicsUtils ../../support/cimSymbolUtils".split(" "),function(n,l,F,D,A,u,m){function h(p,q){if(!("visualVariables"in p&&p.hasVisualVariables("size")))return 0;
p=p.getVisualVariablesForType("size");if(!p[0])return 0;p=p[0];if(q&&"cluster_count"===p.field&&"cluster"===q.type)return q.clusterMaxSize;if("outline"===p.target)return 0;if("stops"===p.transformationType)return p.stops.map(t=>t.size).reduce(b,0);if("clamped-linear"===p.transformationType){let t=q=-Infinity;q="number"===typeof p.maxSize?p.maxSize:p.maxSize.stops.map(v=>v.size).reduce(b,0);t="number"===typeof p.minSize?p.minSize:p.minSize.stops.map(v=>v.size).reduce(b,0);return Math.max(q,t)}if("real-world-size"===
p.transformationType)return 30}function f(p,q){return null==p?q:p}async function d(p,q,t,v,y,w){if("simple-marker"===p.type)return q=Math.max(f(p.size,12),q),a(p)+.707*q;if("picture-marker"===p.type)return t=Math.max(f(p.height,12),q),q=f(p.width,12)*(t/f(p.height,12))/2,t/=2,a(p)+Math.sqrt(q*q+t*t);if("text"===p.type){if(t=p.text&&p.text.length){q=[];for(v=0;v<t;v++)q.push({...k,code:p.text.charCodeAt(v)});q={glyphMosaicItems:q}}else q={glyphMosaicItems:[k]};u.getTextSymbolSize(e,p.toJSON(),q);return Math.max(Math.abs(e[0]),
Math.abs(e[1]))+Math.max(e[2],e[3])}return"simple-line"===p.type?(t=Math.max(f(p.width,.75),q)/2,p.marker?Math.max(6*p.width,2*q):t):"simple-fill"===p.type||"picture-fill"===p.type?(t=Math,v=t.max,p=null==p.outline?0:f(p.outline.width,0),v.call(t,p,q)/2):"cim"===p.type?(await m.expandSymbol({type:"cim",rendererKey:0,data:p.data,maxVVSize:q},{geometryType:v,fields:y,spatialReference:w},t),(p=F.CIMSymbolHelper.getEnvelope(p.data,null,t))?Math.sqrt(p.width*p.width+p.height*p.height):0):"web-style"===
p.type?d(await p.fetchCIMSymbol(),q,t,v,y,w):0}async function c(p,q,t,v,y,w){return p.type in g?Math.min(await d(p,q,t,v,y,w),75):0}function a(p){const q=f(p.xoffset,0);p=f(p.yoffset,0);return Math.sqrt(q*q+p*p)}function b(p,q){return Math.max(p,q)}const g={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},e=[0,0,0,0],k={sdf:!0,code:99,metrics:A.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new D(0,0,24,24),page:0,textureBinding:2};n.computePxBuffer=
async function(p,q,t,v,y,w){if(!p||w&&"cluster"===w.type)return 0;if("heatmap"===p.type)return Math.round(l.pt2px(p.radius));if("dot-density"===p.type)return 0;if("dictionary"===p.type)return"esriGeometryPoint"===q||"esriGeometryMultipoint"===q?100:200;w=p.getSymbols();p=h(p);const z=[];for(const r of w)z.push(c(r,p,t,q,v,y));q=await Promise.all(z);return l.pt2px(q.reduce(b,0))};n.getPtMaxVVSize=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/BidiText ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/alignmentUtils ../../engine/webgl/definitions ../../engine/webgl/mesh/templates/shapingUtils".split(" "),
function(n,l,F,D,A,u,m,h,f){n.PIXEL_BUFFER=50;n.TILE_SIZE=512;n.getTextSymbolSize=function(d,c,a){if(!a?.glyphMosaicItems?.length)return d;const b=l.bidiText(c.text)[1];c=f.shapeGlyphs(a.glyphMosaicItems,b,{scale:F.pt2px(c.font.size)/h.GLYPH_SIZE,angle:c.angle??0,xOffset:c.xoffset??0,yOffset:c.yoffset??0,hAlign:m.getXAnchorDirection(c.horizontalAlignment||"center"),vAlign:m.getYAnchorDirection(c.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(c.lineWidth||512,512)),lineHeight:h.MAGIC_LABEL_LINE_HEIGHT*
Math.max(.25,Math.min(c.lineHeight||1,4)),decoration:c.font.decoration||"none",isCIM:!1,hasBackground:!!c.backgroundColor,borderLineSize:c.borderLineSize}).bounds;d[0]=F.pt2px(c.x-c.halfWidth);d[1]=F.pt2px(c.y-c.halfHeight);d[2]=F.pt2px(c.width);d[3]=F.pt2px(c.height);return d};n.graphicGeometryToNumber=function(d){switch(d.geometry.type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};n.intersectingInternationalDateline=function(d,c){c=u.getInfo(c);if(!c)return null;const [a,
b]=c.valid;return d[2]>b?[A.create([d[0],d[1],b,d[3]]),A.create([a,d[1],a+d[2]-b,d[3]])]:d[0]<a?[A.create([a,d[1],d[2],d[3]]),A.create([b-(a-d[0]),d[1],b,d[3]])]:null};n.isMarkerSymbol=function(d){return"simple-marker"===d||"picture-marker"===d||"esriSMS"===d||"esriPMS"===d};n.isTextSymbol=function(d){return"text"===d||"esriTS"===d};n.polygonFromExtent=function(d){if(!d)return null;const {xmin:c,ymin:a,xmax:b,ymax:g,spatialReference:e}=d;return new D({rings:[[[c,a],[c,g],[b,g],[b,a],[c,a]]],spatialReference:e})};
Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/screenUtils ../../../../webgl/capabilities".split(" "),function(n,l,F,D,A,u){function m(c){return("size"===c.type||"color"===c.type||"opacity"===c.type)&&null!=c.stops}function h(c){var a=c.type;var b=c.stops??[];if(8>=b.length)a=b;else if(d.warn(`Found ${b.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),
16<b.length){const [w,...z]=b;var g=z.pop(),e=z[0].value,k=z[z.length-1].value,p=(k-e)/6;const r=[];for(;e<k;e+=p){for(var q=0;e>=z[q].value;)q++;var t=z[q],v=b[q-1],y=e-v.value;t=t.value===v.value?1:y/(t.value-v.value);"color"===a?(v=z[q],q=b[q-1],y=v.color.clone(),y.r=(1-t)*q.color.r+t*y.r,y.g=(1-t)*q.color.g+t*y.g,y.b=(1-t)*q.color.b+t*y.b,y.a=(1-t)*q.color.a+t*y.a,r.push({value:e,color:y,label:v.label})):"size"===a?(v=z[q],y=b[q-1],q=A.toPt(v.size),y=A.toPt(y.size),r.push({value:e,size:(1-t)*
y+t*q,label:v.label})):(v=z[q],r.push({value:e,opacity:(1-t)*b[q-1].opacity+t*v.opacity,label:v.label}))}a=[w,...r,g]}else{const [w,...z]=b;for(a=z.pop();6<z.length;){g=b=0;for(k=1;k<z.length;k++)p=Math.abs(z[k].value-z[k-1].value),p>g&&(g=p,b=k);z.splice(b,1)}a=[w,...z,a]}c.stops=a;return c}function f(){if(F("heatmap-force-raster"))return"raster";const {supportsTextureFloat:c,supportsTextureHalfFloat:a,supportsColorBufferFloat:b,supportsColorBufferFloatBlend:g,supportsColorBufferHalfFloat:e}=u.getWebGLCapabilities("2d");
return c&&b&&g||a&&e?"symbol":F("heatmap-allow-raster-fallback")?"raster":"none"}const d=D.getLogger("esri.views.2d.layers.features.support.rendererUtils");n.getSupportedHeatmapRenderer=f;n.isRendererSupported=function(c){if(!c)return!0;switch(c.type){case "dot-density":if(!u.getWebGLCapabilities("2d").supportsTextureFloat)return d.error(new l("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case "heatmap":if(c=f(),"none"===c||"raster"===
c&&!F("heatmap-force-raster")){const a=u.getWebGLCapabilities("2d"),b=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(g=>!a[g]).join(", ");if("none"===c)return d.errorOnce(new l("webgl-missing-extension",`Missing WebGL${a.type} requirements for Heatmap: ${b}`)),!1;"raster"===c&&d.warnOnce(`Missing WebGL${a.type} requirements for accelerated Heatmap: ${b}. Feature support may be limited.`)}}return!0};
n.simplifyVVRenderer=c=>{if(!("visualVariables"in c&&c.visualVariables&&c.visualVariables.length))return c;c=c.clone();const a=c.visualVariables.map(b=>m(b)?h(b):b);c.visualVariables=a;return c};n.simplifyVisualVariables=function(c){return c.map(a=>m(a)?h(a.clone()):a)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/util":function(){define(["exports","../../../../core/jsonMap"],function(n,l){const F=new l.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",
esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});n.analyzeRings=function(D,A,u){const m=[],h=[];let f=0,d=0;for(const c of D){D=d;let a=c[0][0],b=c[0][1];m[d++]=a;m[d++]=b;let g=0;for(let e=1;e<c.length;++e){const k=a,p=b;a=c[e][0];b=c[e][1];g+=b*k-a*p;m[d++]=a;m[d++]=b}A(g/2);0<g?(0<D-f&&(u(f,D,m,h),f=D),h.length=0):0>g?0<D-f?h.push(.5*(D-f)):d=D:d=D}0<d-f&&u(f,d,m,h)};n.canUseMajorityInterpolationOnDataSource=function(D){const {bandCount:A,
attributeTable:u,colormap:m,pixelType:h}=D.raster.rasterInfo;return 1===A&&(null!=u||null!=m||"u8"===h||"s8"===h)};n.toJSONGeometryType=function(D){return F.toJSON(D)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("require ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../core/support/WatchUpdatingTracking ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/util/debug ../tileRenderers/support/visualVariablesUtils ../../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p){function q(r,C){return x=>C(r(x))}const t=A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),v=e.createDebugLogger(e.DEBUG_ATTR_UPDATES,t);var y=D("esri-shared-array-buffer"),w=D("esri-atomics");let z=function(){function r(x,E,B,G){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:H,layout:I,textureOnly:J}=G;this.textureOnly=J||!1;this.pixelType=H;this._ctype=E;this.layout=I;this._resetRange();this._shared=x;
this.size=B;J||(this.data=this._initData(H,B,x,E))}var C=r.prototype;C.unsetComponentAllTexels=function(x,E){const B=this.data;for(let G=0;G<this.size*this.size;G++)B[G*this.texelSize+x]&=~E;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1};C.setComponentAllTexels=function(x,E){const B=this.data;for(let G=0;G<this.size*this.size;G++)B[G*this.texelSize+x]|=255&E;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1};C.setComponent=function(x,E,B){const G=this.data;for(const H of B)G[H*this.texelSize+
x]|=E,this.dirtyStart=Math.min(this.dirtyStart,H),this.dirtyEnd=Math.max(this.dirtyEnd,H)};C.setComponentTexel=function(x,E,B){this.data[B*this.texelSize+x]|=E;this.dirtyStart=Math.min(this.dirtyStart,B);this.dirtyEnd=Math.max(this.dirtyEnd,B)};C.unsetComponentTexel=function(x,E,B){this.data[B*this.texelSize+x]&=~E;this.dirtyStart=Math.min(this.dirtyStart,B);this.dirtyEnd=Math.max(this.dirtyEnd,B)};C.getData=function(x,E){x=b.getDisplayIdTexel(x);return this.data[x*this.texelSize+E]};C.setData=function(x,
E,B){x=b.getDisplayIdTexel(x);0===(this.layout&1<<E)?t.error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[x*this.texelSize+E]=B,this.dirtyStart=Math.min(this.dirtyStart,x),this.dirtyEnd=Math.max(this.dirtyEnd,x))};C.lock=function(){this.pixelType===p.PixelType.UNSIGNED_BYTE&&this._shared&&w&&"local"!==this._ctype&&Atomics.store(this.data,0,1)};C.unlock=function(){this.pixelType===p.PixelType.UNSIGNED_BYTE&&this._shared&&w&&"local"!==
this._ctype&&Atomics.store(this.data,0,0)};C.expand=function(x){this.size=x;this.textureOnly||(x=this._initData(this.pixelType,x,this._shared,this._ctype),x.set(this.data),this.data=x)};C.toMessage=function(){const x=this.dirtyStart,E=this.dirtyEnd;var B=this.texelSize;if(x>E)return null;this._resetRange();const G=this.pixelType,H=this.layout,I=this.data;B=!this._shared&&"local"!==this._ctype&&I.slice(x*B,(E+1)*B)||null;return{start:x,end:E,data:B,pixelType:G,layout:H}};C._initData=function(x,E,B,
G){B=B&&"local"!==G?SharedArrayBuffer:ArrayBuffer;x=g.getPixelArrayCtor(x);E=new x(new B(E*E*4*x.BYTES_PER_ELEMENT));for(x=0;x<E.length;x+=4)E[x+1]=255;return E};C._resetRange=function(){this.dirtyStart=2147483647;this.dirtyEnd=0};l._createClass(r,[{key:"buffer",get:function(){return m.applySome(this.data,x=>x.buffer)}}]);return r}();return function(){function r(x,E){this._client=x;this.config=E;this.updatingHandles=new d.WatchUpdatingTracking;this._blocks=[];this._filters=Array(a.MAX_FILTERS);this._attributeComputeInfo=
null;this._targetType=0;this._abortController=new AbortController;this._hasScaleExpr=!1;this._size=32;this._currUpdate=this._nextUpdate=null;this._idsToHighlight=new Set;x=E.supportsTextureFloat?p.PixelType.FLOAT:p.PixelType.UNSIGNED_BYTE;v(`Creating AttributeStore ${y?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:p.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:p.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},
{pixelType:x,layout:15},{pixelType:x,layout:15},{pixelType:x,layout:15},{pixelType:x,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}var C=r.prototype;C.destroy=function(){this._abortController.abort();this.updatingHandles.destroy()};C.isUpdating=function(){const x=this.updatingHandles.updating||!!this._nextUpdate;D("esri-2d-log-updating")&&console.log(`Updating AttributeStore: ${x}\n  -> updatingHandles ${this.updatingHandles.updating} (currUpdate: ${!!this._currUpdate})\n  -> nextUpdate: ${!!this._nextUpdate}\n`);
return x};C.update=function(x,E){this.config=E;E=E.schema.processors[0].storage;const B=f.diff(this._schema,E);if(x.targets.feature||x.targets.aggregate)x.storage.data=!0;if(B&&(D("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",B),x.storage.data=!0,this._schema=E,this._attributeComputeInfo=null,null!=E)){switch(E.target){case "feature":this._targetType=b.DISPLAY_ID_TYPE_FEATURE;break;case "aggregate":this._targetType=b.DISPLAY_ID_TYPE_AGGREGATE}if("subtype"===E.type){this._attributeComputeInfo=
{isSubtype:!0,subtypeField:E.subtypeField,map:new Map};for(const G in E.mapping)if(x=E.mapping[G],null!=x&&null!=x.vvMapping)for(const H of x.vvMapping)this._bindAttribute(H,parseInt(G,10))}else{this._attributeComputeInfo={isSubtype:!1,map:new Map};if(null!=E.vvMapping)for(const G of E.vvMapping)this._bindAttribute(G);if(null!=E.attributeMapping)for(const G of E.attributeMapping)this._bindAttribute(G)}}};C.onTileData=function(x,E){if(null!=E.addOrUpdate)for(x=E.addOrUpdate.getCursor();x.next();)E=
x.getDisplayId(),this.setAttributeData(E,x)};C.setHighlight=async function(x,E){const B=this._getBlock(0);E=E.map(G=>b.getDisplayIdTexel(G));B.lock();B.unsetComponentAllTexels(0,1);B.setComponent(0,1,E);B.unlock();this._idsToHighlight.clear();for(const G of x)this._idsToHighlight.add(G);await this.sendUpdates()};C.updateFilters=async function(x,E,B){D("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters");const {service:G,spatialReference:H}=B;({filters:E}=E);E=E.map((I,J)=>this._updateFilter(I,
J,G,H));E=(await Promise.all(E)).some(I=>I);D("esri-2d-update-debug")&&console.debug("AttributeStore::updateFilters - finsihed");E&&(x.storage.filters=!0,D("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))};C.setData=function(x,E,B,G){const H=b.getDisplayIdTexel(x);this._ensureSizeForTexel(H);this._getBlock(E).setData(x,B,G)};C.getData=function(x,E,B){return this._getBlock(E).getData(x,B)};C.getHighlightFlag=function(x){return this._idsToHighlight.has(x)?
a.HIGHLIGHT_FLAG:0};C.unsetAttributeData=function(x){x=b.getDisplayIdTexel(x);this._getBlock(0).setData(x,0,0)};C.setAttributeData=function(x,E){const B=b.getDisplayIdTexel(x);this._ensureSizeForTexel(B);this._getBlock(0).setData(B,0,this.getFilterFlags(E));if(this._targetType===b.getDisplayIdType(x)){x=this._attributeComputeInfo;var G=this.config.supportsTextureFloat?1:2,H=null;x&&(H=x.isSubtype?x.map.get(E.readAttribute(x.subtypeField)):x.map)&&H.size&&H.forEach((I,J)=>{const L=J*G%4;J=this._getBlock(Math.floor(J*
G/4)+a.ATTRIBUTE_DATA_VV);I=I(E);if(this.config.supportsTextureFloat)J.setData(B,L,I);else if(I===a.NAN_MAGIC_NUMBER)J.setData(B,L,255),J.setData(B,L+1,255);else{I=u.clamp(Math.round(I),-32767,32766)+32768;const K=(I&65280)>>8;J.setData(B,L,I&255);J.setData(B,L+1,K)}})}};C.sendUpdates=function(){D("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate");if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=h.createResolver(),this.updatingHandles.addPromise(this._nextUpdate.promise),
this._nextUpdate.promise;const x={blocks:this._blocks.map(E=>null!=E?E.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{var E=()=>{this._currUpdate=null;if(this._nextUpdate){const B=this._nextUpdate;this._nextUpdate=null;this.sendUpdates().then(()=>B.resolve())}else D("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::No additional updates queued")};D("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::client.update");E=this.updatingHandles.addPromise(this._client.update(x,
this._signal).then(E).catch(E));this._client.render(this._signal);return E}).catch(E=>{if(h.isAbortError(E))return this._createResourcesPromise=null,this._createResources();t.error(new F("mapview-attribute-store","Encountered an error during client update",E))})};C._ensureSizeForTexel=function(x){for(;x>=this._size*this._size&&!this._expand(););};C._bindAttribute=function(x,E){function B(){const {normalizationField:K}=x;return K?S=>{const W=S.readAttribute(K);return W?S.readAttribute(x.field)/W:null}:
S=>S.readAttribute(x.field)}function G(){x.normalizationField&&t.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported.");return K=>K.getComputedNumericAtIndex(x.fieldIndex)}let H;if(null!=x.fieldIndex)H=G();else if(x.field)H=B();else return;const {valueRepresentation:I}=x;I&&(H=q(H,K=>k.getVisualVariableSizeValueRepresentationRatio(K,I)));const J=K=>null===K||isNaN(K)||Infinity===K||-Infinity===K?a.NAN_MAGIC_NUMBER:K,L=this._attributeComputeInfo;
if(L.isSubtype){const K=L.map.get(E)??new Map;K.set(x.binding,q(H,J));L.map.set(E,K)}else L.map.set(x.binding,q(H,J))};C._createResources=function(){if(null!=this._createResourcesPromise)return this._createResourcesPromise;this._getBlock(a.ATTRIBUTE_DATA_ANIMATION);this._getBlock(a.ATTRIBUTE_DATA_GPGPU);v("Initializing AttributeStore");var x={shared:y&&"local"!==this._client.type,size:this._size,blocks:m.mapMany(this._blocks,E=>({textureOnly:E.textureOnly,buffer:E.buffer,pixelType:E.pixelType}))};
this._createResourcesPromise=x=this._client.initialize(x,this._signal).catch(E=>{h.isAbortError(E)?this._createResourcesPromise=null:t.error(new F("mapview-attribute-store","Encountered an error during client initialization",E))});x.then(()=>null==this._createResourcesPromise?this._createResources():void 0);return x};C._getBlock=function(x){var E=this._blocks[x];if(null!=E)return E;v(`Initializing AttributeBlock at index ${x}`);E=new z(y,this._client.type,this._size,this._blockDescriptors[x]);this._blocks[x]=
E;this._createResourcesPromise=null;return E};C._expand=function(){if(this._size<this.config.maxTextureSize){const x=this._size<<=1;v("Expanding block size to",x,this._blocks);m.forEachSome(this._blocks,E=>E.expand(x));this._createResourcesPromise=null;this._size=x;return 0}t.error(new F("mapview-limitations","Maximum number of onscreen features exceeded."));return-1};C._updateFilter=async function(x,E,B,G){const H=this._filters[E];if(!H&&!x||(null!=H&&H.hash)===JSON.stringify(x))return!1;if(null==
x){if(!H)return!1;x=1<<E+1;B=this._getBlock(0);this._filters[E]=null;B.setComponentAllTexels(0,x);this.sendUpdates();return!0}await (await this._getFilter(E,B)).update(x,G);return!0};C._getFilter=async function(x,E){var B=this._filters[x];if(null!=B)return B;({default:B}=await new Promise((G,H)=>n(["./FeatureFilter"],I=>G(Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"}))),H)));E=new B({geometryType:E.geometryType,hasM:!1,hasZ:!1,timeInfo:E.timeInfo,
fieldsIndex:new c(E.fields)});return this._filters[x]=E};C.isVisible=function(x){return!!(this._getBlock(0).getData(x,0)&2)};C.getFilterFlags=function(x){let E=0;var B=b.getDisplayIdFilterMask(x.getDisplayId());for(let H=0;H<this._filters.length;H++){var G=this._filters[H];G=!(B&1<<H)||null==G||G.check(x);E|=(G?1:0)<<H}B=0;this._idsToHighlight.size&&(x=x.getObjectId(),B=this.getHighlightFlag(x));return E<<1|B};l._createClass(r,[{key:"hasScaleExpr",get:function(){return this._hasScaleExpr}},{key:"_signal",
get:function(){return this._abortController.signal}},{key:"hasHighlight",get:function(){return 0<this._idsToHighlight.size}}]);return r}()})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(n){n.DEBUG_ATTR_UPDATES=!1;n.createDebugLogger=(l,F)=>l&&((...D)=>F.warn("DEBUG:",...D))||(()=>null);Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define("exports ../../../../../../core/screenUtils ../../../../engine/webgl/color ../../../../engine/webgl/definitions ../../../../engine/webgl/enums ../../../../engine/webgl/visualVariablesUtils".split(" "),
function(n,l,F,D,A,u){function m(g){return{value:g.value,size:l.toPt(g.size)}}function h(g){return(g??[]).map(e=>m(e))}function f(g){return"string"===typeof g||"number"===typeof g?l.toPt(g):{type:"size",expression:g.expression,stops:h(g.stops)}}function d(g){const e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"===typeof g.field)if(g.stops){if(8<g.stops.length)return null;g=g.stops;for(var k=0;8>k;++k){const p=g[Math.min(k,g.length-1)];e.values[k]=p.value;e.opacities[k]=p.opacity}}else return null;
else if(g.stops&&0<=g.stops.length)for(g=g.stops&&0<=g.stops.length?g.stops[0].opacity:0,k=0;8>k;k++)e.values[k]=Infinity,e.opacities[k]=g;else return null;return e}function c(g,e,k){g[4*e]=k.r/255;g[4*e+1]=k.g/255;g[4*e+2]=k.b/255;g[4*e+3]=k.a}function a(g){if(null==g||g.normalizationField)return null;const e={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"===typeof g.field)if(g.stops){if(8<g.stops.length)return null;e.field=
g.field;g=g.stops;for(var k=0;8>k;++k){const p=g[Math.min(k,g.length-1)];e.values[k]=p.value;c(e.colors,k,p.color)}}else return null;else if(g.stops&&0<=g.stops.length)for(g=g.stops&&0<=g.stops.length&&g.stops[0].color,k=0;8>k;k++)e.values[k]=Infinity,c(e.colors,k,g);else return null;for(g=0;32>g;g+=4)F.premultiplyAlpha(e.colors,g,!0);return e}const b=g=>{const e=[],k=[];g=h(g);const p=g.length;for(let q=0;6>q;q++){const t=g[Math.min(q,p-1)];e.push(t.value);k.push(null==t.size?D.NAN_MAGIC_NUMBER:
l.pt2px(t.size))}return{values:new Float32Array(e),sizes:new Float32Array(k)}};n.convertColorVariable=a;n.convertVisualVariables=function(g){const e=g&&0<g.length?{}:null,k=e?{}:null;if(!e||!k)return{vvFields:e,vvRanges:k};for(const p of g)if(p.field&&(e[p.type]=p.field),"size"===p.type)switch(k.size||(k.size={}),g=p,u.getTypeOfSizeVisualVariable(g)){case A.WGLVVFlag.SIZE_MINMAX_VALUE:k.size.minMaxValue={minDataValue:g.minDataValue,maxDataValue:g.maxDataValue,minSize:f(g.minSize),maxSize:f(g.maxSize)};
break;case A.WGLVVFlag.SIZE_SCALE_STOPS:k.size.scaleStops={stops:h(g.stops)};break;case A.WGLVVFlag.SIZE_FIELD_STOPS:if(g.levels){const q={};for(const t in g.levels)q[t]=b(g.levels[t]);k.size.fieldStops={type:"level-dependent",levels:q}}else k.size.fieldStops={type:"static",...b(g.stops)};break;case A.WGLVVFlag.SIZE_UNIT_VALUE:k.size.unitValue={unit:g.valueUnit,valueRepresentation:g.valueRepresentation??void 0}}else"color"===p.type?k.color=a(p):"opacity"===p.type?k.opacity=d(p):"rotation"===p.type&&
(k.rotation={type:p.rotationType});return{vvFields:e,vvRanges:k}};n.getVisualVariableSizeValueRepresentationRatio=function(g,e){if(!g||!e)return g;switch(e){case "radius":case "distance":return 2*g;case "area":return Math.sqrt(g)}return g};n.normalizeSizeElement=f;n.normalizeSizeStops=h;n.stopToSizeStop=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../engine/webgl/DisplayId","./DisplayIdGenerator","./StaticBitSet"],function(n,l,F,D,A){function u(h,f,d){if(!(h.length>f))for(;h.length<=f;)h.push(d)}let m=function(){function h(){this._numerics=[];this._strings=[];this._idGenerator=new D.DisplayIdGenerator;this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[]}var f=h.prototype;f.createBitset=function(){const d=this._bitsets.length;this._bitsets.push(A.StaticBitSet.create(this._allocatedSize,F.DISPLAY_ID_TEXEL_MASK));
return d+1};f.getBitset=function(d){return this._bitsets[d-1]};f._expand=function(){this._allocatedSize<<=1;for(const d of this._bitsets)d.resize(this._allocatedSize)};f._ensureNumeric=function(d,c){this._numerics[d]||(this._numerics[d]=[]);u(this._numerics[d],c,0)};f._ensureInstanceId=function(d){u(this._instanceIds,d,0)};f._ensureString=function(d,c){this._strings[d]||(this._strings[d]=[]);u(this._strings[d],c,null)};f.createDisplayId=function(d=!1){const c=this._idGenerator.createId();c>this._allocatedSize&&
this._expand();return F.createDisplayId(c,d)};f.releaseDisplayId=function(d){for(const c of this._bitsets)c.unset(d);return this._idGenerator.releaseId(d&F.DISPLAY_ID_TEXEL_MASK)};f.getComputedNumeric=function(d,c){return this.getComputedNumericAtIndex(d&F.DISPLAY_ID_TEXEL_MASK,0)};f.setComputedNumeric=function(d,c,a){return this.setComputedNumericAtIndex(d&F.DISPLAY_ID_TEXEL_MASK,a,0)};f.getComputedString=function(d,c){return this.getComputedStringAtIndex(d&F.DISPLAY_ID_TEXEL_MASK,0)};f.setComputedString=
function(d,c,a){return this.setComputedStringAtIndex(d&F.DISPLAY_ID_TEXEL_MASK,0,a)};f.getComputedNumericAtIndex=function(d,c){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureNumeric(c,d);return this._numerics[c][d]};f.setComputedNumericAtIndex=function(d,c,a){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureNumeric(c,d);this._numerics[c][d]=a};f.getInstanceId=function(d){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureInstanceId(d);return this._instanceIds[d]};f.setInstanceId=function(d,c){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureInstanceId(d);
this._instanceIds[d]=c};f.getComputedStringAtIndex=function(d,c){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureString(c,d);return this._strings[c][d]};f.setComputedStringAtIndex=function(d,c,a){d&=F.DISPLAY_ID_TEXEL_MASK;this._ensureString(c,d);this._strings[c][d]=a};f.getXMin=function(d){return this._bounds[4*(d&F.DISPLAY_ID_TEXEL_MASK)]};f.getYMin=function(d){return this._bounds[4*(d&F.DISPLAY_ID_TEXEL_MASK)+1]};f.getXMax=function(d){return this._bounds[4*(d&F.DISPLAY_ID_TEXEL_MASK)+2]};f.getYMax=function(d){return this._bounds[4*
(d&F.DISPLAY_ID_TEXEL_MASK)+3]};f.setBounds=function(d,c){c=c.readHydratedGeometry();if(!c||!c.coords.length)return!1;let a=Infinity,b=Infinity,g=-Infinity,e=-Infinity;c.forEachVertex((k,p)=>{a=Math.min(a,k);b=Math.min(b,p);g=Math.max(g,k);e=Math.max(e,p)});d&=F.DISPLAY_ID_TEXEL_MASK;u(this._bounds,4*d+4,0);this._bounds[4*d]=a;this._bounds[4*d+1]=b;this._bounds[4*d+2]=g;this._bounds[4*d+3]=e;return!0};return l._createClass(h)}();n.ComputedAttributeStorage=m;Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../engine/webgl/DisplayId"],function(n,l,F){let D=function(){function A(){this._freeIds=[];this._idCounter=1}var u=A.prototype;u.createId=function(m=!1){return F.createDisplayId(this._getFreeId(),m)};u.releaseId=function(m){this._freeIds.push(m)};u._getFreeId=function(){return this._freeIds.length?this._freeIds.pop():this._idCounter++};
return l._createClass(A)}();n.DisplayIdGenerator=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/jsonUtils ../../../../../layers/graphics/featureConversionUtils ./FeatureSetReader ./FeatureSetReaderJSON".split(" "),function(n,l,F,D,A,u){u=function(m){function h(d,c,a){d=m.call(this,d,c,null)||this;d._transform=a;return d}
l._inherits(h,m);h.from=function(d,c,a){const b=A.FeatureSetReader.createInstance(),g=[];d=d.filter(e=>!!e.geometry);for(const e of d)d=F.getJsonType(e.geometry),D.convertFromGraphics(g,[e],d,!1,!1,c);return new h(b,g,a)};var f=h.prototype;f.readGraphic=function(){return this._current};f.getCursor=function(){return this.copy()};f.copy=function(){const d=new h(this.instance,this._features,this._transform);this.copyInto(d);return d};l._createClass(h,[{key:"geometryType",get:function(){const d=this._current;
return d?d.geometryType:null}},{key:"insertAfter",get:function(){return this._current.insertAfter}}]);return h}(u.FeatureSetReaderJSON);n.GraphicsReader=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../arcade/arcadeTimeUtils ../../../../../core/has ../../../../../core/maybe ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){let b=0;F=u("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const g=F[0],e=F[1],k=F[2],p=F[3];F=u("featurelayer-simplify-payload-size-factors")??[1,2,4];const q=F[0],t=F[1],v=F[2],y=u("featurelayer-simplify-mobile-factor")??2,w=u("esri-mobile");u=function(){function z(C,x){this.type="FeatureSetReader";this.arcadeDeclaredClass="esri.arcade.Feature";this.seen=!1;this._ty=this._tx=this.instance=0;this._sy=this._sx=1;this._deleted=null;this._joined=[];this._objectIdToIndex=
null;this._level=0;this.contextTimeReference=this._datetimeMetadata=null;this.instance=C;this._layerSchema=x}z.createInstance=function(){b++;return b=65535<b?0:b};var r=z.prototype;r.getAreaSimplificationThreshold=function(C,x){let E=1;const B=w?y:1;4E6<x?E=v*B:1E6<x?E=t*B:5E5<x?E=q*B:1E5<x&&(E=B);x=0;4E3<C?x=p*E:2E3<C?x=k*E:100<C?x=e:15<C&&(x=g);C=8;4>this._level?C=1:5>this._level?C=2:6>this._level&&(C=4);return x*C};r.createQuantizedExtrudedQuad=function(C,x){return new d([5],[C-1,x,1,-1,1,1,-1,
1,-1,-1])};r.parseTimestampOffset=function(C){return C};r.setArcadeSpatialReference=function(C){this._arcadeSpatialReference=C};r.attachStorage=function(C){this._storage=C};r.getQuantizationTransform=function(){throw Error("Unable to find transform for featureSet");};r.getStorage=function(){return this._storage};r.getComputedNumeric=function(C){return this.getComputedNumericAtIndex(0)};r.setComputedNumeric=function(C,x){return this.setComputedNumericAtIndex(x,0)};r.getComputedString=function(C){return this.getComputedStringAtIndex(0)};
r.setComputedString=function(C,x){return this.setComputedStringAtIndex(0,x)};r.getComputedNumericAtIndex=function(C){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),C)};r.setComputedNumericAtIndex=function(C,x){this._storage.setComputedNumericAtIndex(this.getDisplayId(),C,x)};r.getComputedStringAtIndex=function(C){return this._storage.getComputedStringAtIndex(this.getDisplayId(),C)};r.setComputedStringAtIndex=function(C,x){return this._storage.setComputedStringAtIndex(this.getDisplayId(),
C,x)};r.transform=function(C,x,E,B){const G=this.copy();G._tx+=C;G._ty+=x;G._sx*=E;G._sy*=B;return G};r.readAttribute=function(C,x=!1){var E=this._readAttribute(C,x);if(void 0!==E)return E;for(const B of this._joined)if(B.setIndex(this.getIndex()),E=B._readAttribute(C,x),void 0!==E)return E};r.readAttributes=function(){const C=this._readAttributes();for(const x of this._joined){x.setIndex(this.getIndex());const E=x._readAttributes();for(const B of Object.keys(E))C[B]=E[B]}return C};r.joinAttributes=
function(C){this._joined.push(C)};r.readArcadeFeature=function(){return this};r.hasField=function(C){return this.fields.has(C)};r.geometry=function(){var C=this.readHydratedGeometry();C=f.convertToGeometry(C,this.geometryType,this.hasZ,this.hasM);if(C=a.fromJSON(C))C.spatialReference=this._arcadeSpatialReference;return C};r.autocastArcadeDate=function(C,x){return x&&x instanceof Date?this.isUnknownDateTimeField(C)?D.ArcadeDate.unknownDateJSToArcadeDate(x):D.ArcadeDate.dateJSAndZoneToArcadeDate(x,
this.contextTimeReference?.timeZone??"system"):x};r.isUnknownDateTimeField=function(C){return"unknown"===this.dateTimeReferenceFieldIndex?.fieldTimeZone(C)};r.fieldSourceTimeZone=function(C){return this.dateTimeReferenceFieldIndex?.fieldTimeZone(C)??""};r.field=function(C){if(this.hasField(C))return this.autocastArcadeDate(C,this.readAttribute(C,!0));for(var x of this._joined)if(x.setIndex(this.getIndex()),x.hasField(C))return x=x._readAttribute(C,!0),this.autocastArcadeDate(C,x);throw Error(`Field ${C} does not exist`);
};r.setField=function(C,x){throw Error("Unable to update feature attribute values, feature is readonly");};r.keys=function(){return this.fields.fields.map(C=>C.name)};r.castToText=function(C=!1){if(!C)return JSON.stringify(this.readLegacyFeature());C=this.readLegacyFeature();if(!C)return JSON.stringify(null);C={geometry:C.geometry,attributes:{...(C.attributes??{})}};for(const x in C.attributes){const E=C.attributes[x];E instanceof Date&&(C.attributes[x]=E.getTime())}return JSON.stringify(C)};r.gdbVersion=
function(){return null};r.fullSchema=function(){return this._layerSchema};r.castAsJson=function(C=null){return{attributes:this._readAttributes(),geometry:!0===C?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}};r.castAsJsonAsync=function(C,x=null){return Promise.resolve(this.castAsJson(x))};r.removeIds=function(C){if(null==this._objectIdToIndex){var x=new Map;const E=this.getCursor();for(;E.next();){const B=m.unwrapOrThrow(E.getObjectId());x.set(B,E.getIndex())}this._objectIdToIndex=
x}x=this._objectIdToIndex;for(const E of C)x.has(E)&&this.removeAtIndex(x.get(E))};r.removeAtIndex=function(C){null==this._deleted&&(this._deleted=c.StaticBitSet.create(this.getSize()));this._deleted.set(C)};r.readGeometryForDisplay=function(){return this.readUnquantizedGeometry(!0)};r.readLegacyGeometryForDisplay=function(){return this.readLegacyGeometry(!0)};r.features=function*(){const C=this.getCursor();for(;C.next();)yield C.readOptimizedFeature()};r._getExists=function(){return null==this._deleted||
!this._deleted.has(this.getIndex())};r._computeCentroid=function(){if("esriGeometryPolygon"!==this.geometryType)return null;const C=this.readUnquantizedGeometry();if(!C||C.hasIndeterminateRingOrder)return null;const x=this.getQuantizationTransform()??null;return h.getCentroidOptimizedGeometry(new d,C,this.hasM,this.hasZ,x)};r.copyInto=function(C){C.seen=this.seen;C._storage=this._storage;C._arcadeSpatialReference=this._arcadeSpatialReference;C._joined=this._joined;C._tx=this._tx;C._ty=this._ty;C._sx=
this._sx;C._sy=this._sy;C._deleted=this._deleted;C._objectIdToIndex=this._objectIdToIndex};l._createClass(z,[{key:"isEmpty",get:function(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}},{key:"level",set:function(C){this._level=C}},{key:"dateTimeReferenceFieldIndex",get:function(){return this._datetimeMetadata?this._datetimeMetadata:this._datetimeMetadata=A.DateTimeReferenceFieldIndex.create(this._layerSchema.fields,this._layerSchema)}},{key:"layerPreferredTimeZone",get:function(){return this.dateTimeReferenceFieldIndex?.layerPreferredTimeZone??
""}}]);return z}();n.FeatureSetReader=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./executionError","../chunks/datetime"],function(n,l,F,D){function A(d){if(d instanceof D.Zone)return d;if("system"===d.toLowerCase())return"system";if("utc"===d.toLowerCase())return"utc";if("unknown"===d.toLowerCase())return u.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(d)){const c=D.FixedOffsetZone.parseSpecifier("UTC"+
(d.startsWith("+")||d.startsWith("-")?"":"+")+d);if(c)return c}d=D.IANAZone.create(d);if(!d.isValid)throw new h(n.ArcadeDateErrorCodes.TimeZoneNotRecognised);return d}let u=l._createClass(function(){});u.instance=new D.IANAZone("Etc/UTC");n.ArcadeDateErrorCodes=void 0;(n.ArcadeDateErrorCodes||(n.ArcadeDateErrorCodes={})).TimeZoneNotRecognised="TimeZoneNotRecognised";const m={[n.ArcadeDateErrorCodes.TimeZoneNotRecognised]:"Timezone identifier has not been recognised."};let h=function(d){function c(a,
b){a=d.call(this,F.doSubstitutions(m[a],b))||this;a.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(l._assertThisInitialized(a),c);return a}l._inherits(c,d);return l._createClass(c)}(l._wrapNativeSuper(Error)),f=function(){function d(a){this._date=a;this.declaredRootClass="esri.arcade.arcadedate"}d.fromParts=function(a=0,b=1,g=1,e=0,k=0,p=0,q=0,t){if(isNaN(a)||isNaN(b)||isNaN(g)||isNaN(e)||isNaN(k)||isNaN(p)||isNaN(q))return null;let v=0;var y=
D.DateTime.local(a,b).daysInMonth;1>g&&(v=g-1,g=1);g>y&&(v=g-y,g=y);y=0;12<b?(y=b-12,b=12):1>b&&(y=b-1,b=1);let w=0;59<k?(w=k-59,k=59):0>k&&(w=k,k=0);let z=0;59<p?(z=p-59,p=59):0>p&&(z=p,p=0);let r=0;999<q?(r=q-999,q=999):0>q&&(r=q,q=0);a=D.DateTime.fromObject({day:g,year:a,month:b,hour:e,minute:k,second:p,millisecond:q},{zone:A(t)});0!==y&&(a=a.plus({months:y}));0!==v&&(a=a.plus({days:v}));0!==w&&(a=a.plus({minutes:w}));0!==z&&(a=a.plus({seconds:z}));0!==r&&(a=a.plus({milliseconds:r}));return new d(a)};
d.arcadeDateAndZoneToArcadeDate=function(a,b){const g=A(b);return a.isUnknownTimeZone||g===u.instance?d.fromParts(a.year,a.monthJS+1,a.day,a.hour,a.minute,a.second,a.millisecond,g):new d(a._date.setZone(b))};d.dateJSToArcadeDate=function(a){return new d(D.DateTime.fromJSDate(a,{zone:"system"}))};d.dateJSAndZoneToArcadeDate=function(a,b="system"){return new d(D.DateTime.fromJSDate(a,{zone:b}))};d.unknownEpochToArcadeDate=function(a){return new d(D.DateTime.fromMillis(a,{zone:u.instance}))};d.unknownDateJSToArcadeDate=
function(a){return new d(D.DateTime.fromMillis(a.getTime(),{zone:u.instance}))};d.epochToArcadeDate=function(a,b="system"){return new d(D.DateTime.fromMillis(a,{zone:b}))};d.dateTimeToArcadeDate=function(a){return new d(a)};var c=d.prototype;c.clone=function(){return new d(this._date)};c.changeTimeZone=function(a){a=A(a);return d.dateTimeToArcadeDate(this._date.setZone(a))};d.dateTimeAndZoneToArcadeDate=function(a,b){b=A(b);return a.zone===u.instance||b===u.instance?d.fromParts(a.year,a.month,a.day,
a.hour,a.minute,a.second,a.millisecond,b):new d(a.setZone(b))};d.nowToArcadeDate=function(a){return new d(D.DateTime.fromJSDate(new Date,{zone:a}))};d.nowUTCToArcadeDate=function(){return new d(D.DateTime.utc())};c.equals=function(a){return this.isSystem&&a.isSystem?this.toNumber()===a.toNumber():this.isUnknownTimeZone!==a.isUnknownTimeZone?!1:this._date.equals(a._date)};c.stringify=function(){return JSON.stringify(this.toJSDate())};c.plus=function(a){return new d(this._date.plus(a))};c.diff=function(a,
b="milliseconds"){return this._date.diff(a._date,b)[b]};c.toISOString=function(a){return a?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})};c.toFormat=function(a,b){return this._date.toFormat(a,b)};c.toJSDate=function(){return this._date.toJSDate()};c.toSQLString=function(){return"timestamp '"+this._date.toFormat("yyyy-LL-dd HH:mm:ss")+"'"};c.toDateTime=function(){return this._date};c.toNumber=function(){return this._date.toMillis()};
c.getTime=function(){return this._date.toMillis()};c.toUTC=function(){return new d(this._date.toUTC())};c.toLocal=function(){return new d(this._date.toLocal())};c.toString=function(){return this.toISOString(!0)};l._createClass(d,[{key:"isSystem",get:function(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}},{key:"isUnknownTimeZone",get:function(){return this._date.zone===u.instance}},{key:"isValid",get:function(){return this._date.isValid}},{key:"hour",get:function(){return this._date.hour}},
{key:"second",get:function(){return this._date.second}},{key:"day",get:function(){return this._date.day}},{key:"dayOfWeekISO",get:function(){return this._date.weekday}},{key:"dayOfWeekJS",get:function(){let a=this._date.weekday;6<a&&(a=0);return a}},{key:"millisecond",get:function(){return this._date.millisecond}},{key:"monthISO",get:function(){return this._date.month}},{key:"weekISO",get:function(){return this._date.weekNumber}},{key:"yearISO",get:function(){return this._date.weekYear}},{key:"monthJS",
get:function(){return this._date.month-1}},{key:"year",get:function(){return this._date.year}},{key:"minute",get:function(){return this._date.minute}},{key:"zone",get:function(){return this._date.zone}},{key:"timeZoneOffset",get:function(){return this.isUnknownTimeZone?0:this._date.offset}},{key:"timeZone",get:function(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const a=this.zone;return"fixed"===a.type?0===a.fixed?"utc":a.formatOffset(0,"short"):a.name}}],
[{key:"systemTimeZoneCanonicalName",get:function(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}}]);return d}();n.ArcadeDate=f;n.ArcadeDateError=h;n.ArcadeDateErrorMessages=m;n.UnknownTimeZone=u;n.createDateTimeZone=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],function(n,l){function F(b){return b&&b.loc?`Line : ${b.loc.start?.line}, ${b.loc.start?.column}: `:""}
function D(b,g){try{if(!g)return b;for(const e in g){let k=g[e];k||(k="");b=b.replace("{"+e+"}",g[e])}}catch(e){}return b}n.ExecutionErrorCodes=void 0;(function(b){b.AsyncNotEnabled="AsyncNotEnabled";b.ModulesNotSupported="ModulesNotSupported";b.CircularModules="CircularModules";b.NeverReach="NeverReach";b.UnsupportedHashType="UnsupportedHashType";b.InvalidParameter="InvalidParameter";b.UnexpectedToken="UnexpectedToken";b.Unrecognised="Unrecognised";b.UnrecognisedType="UnrecognisedType";b.MaximumCallDepth=
"MaximumCallDepth";b.BooleanConditionRequired="BooleanConditionRequired";b.TypeNotAllowedInFeature="TypeNotAllowedInFeature";b.KeyMustBeString="KeyMustBeString";b.WrongNumberOfParameters="WrongNumberOfParameters";b.CallNonFunction="CallNonFunction";b.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";b.NoFunctionInDictionary="NoFunctionInDictionary";b.NoFunctionInArray="NoFunctionInArray";b.AssignModuleFunction="AssignModuleFunction";b.LogicExpressionOrAnd="LogicExpressionOrAnd";b.LogicalExpressionOnlyBoolean=
"LogicalExpressionOnlyBoolean";b.FunctionNotFound="FunctionNotFound";b.InvalidMemberAccessKey="InvalidMemberAccessKey";b.UnsupportedUnaryOperator="UnsupportUnaryOperator";b.InvalidIdentifier="InvalidIdentifier";b.MemberOfNull="MemberOfNull";b.UnsupportedOperator="UnsupportedOperator";b.Cancelled="Cancelled";b.ModuleAccessorMustBeString="ModuleAccessorMustBeString";b.ModuleExportNotFound="ModuleExportNotFound";b.Immutable="Immutable";b.OutOfBounds="OutOfBounds";b.IllegalResult="IllegalResult";b.FieldNotFound=
"FieldNotFound";b.PortalRequired="PortalRequired";b.LogicError="LogicError";b.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";b.KeyAccessorMustBeString="KeyAccessorMustBeString";b.WrongSpatialReference="WrongSpatialReference"})(n.ExecutionErrorCodes||(n.ExecutionErrorCodes={}));const A={[n.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[n.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[n.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",
[n.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[n.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",[n.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[n.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[n.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[n.ExecutionErrorCodes.FunctionNotFound]:"Function not found",[n.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",
[n.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",[n.ExecutionErrorCodes.Cancelled]:"Execution cancelled",[n.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[n.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[n.ExecutionErrorCodes.PortalRequired]:"Portal is required",[n.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",[n.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",
[n.ExecutionErrorCodes.Unrecognised]:"Unrecognised code structure",[n.ExecutionErrorCodes.UnrecognisedType]:"Unrecognised type",[n.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[n.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[n.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[n.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",
[n.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[n.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[n.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[n.ExecutionErrorCodes.Immutable]:"Object is immutable",[n.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",[n.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",[n.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",
[n.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",[n.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognised",[n.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[n.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[n.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",[n.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",[n.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",
[n.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[n.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26"};let u=function(b){function g(...e){return b.call(this,...e)||this}l._inherits(g,b);return l._createClass(g)}(l._wrapNativeSuper(Error)),m=function(b){function g(e,k){e=b.call(this,F(k)+e.message,{cause:e})||this;e.loc=null;Error.captureStackTrace&&Error.captureStackTrace(l._assertThisInitialized(e),g);
k&&k.loc&&(e.loc=k.loc);return e}l._inherits(g,b);return l._createClass(g)}(u),h=function(b){function g(e,k,p,q){e=b.call(this,"Execution error - "+F(p)+D(A[k],q))||this;e.loc=null;e.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(l._assertThisInitialized(e),g);p&&p.loc&&(e.loc=p.loc);return e}l._inherits(g,b);return l._createClass(g)}(l._wrapNativeSuper(Error)),f=function(b){function g(e,k,p,q){e=b.call(this,"Compilation error - "+F(p)+D(A[k],
q))||this;e.loc=null;e.declaredRootClass="esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(l._assertThisInitialized(e),g);p&&p.loc&&(e.loc=p.loc);return e}l._inherits(g,b);return l._createClass(g)}(l._wrapNativeSuper(Error)),d=function(b){function g(){var e=b.call(this,"Uncompilable code structures")||this;e.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(l._assertThisInitialized(e),g);return e}l._inherits(g,
b);return l._createClass(g)}(l._wrapNativeSuper(Error));n.ModuleErrorCodes=void 0;(function(b){b.UnrecognisedUri="UnrecognisedUri";b.UnsupportedUriProtocol="UnsupportedUriProtocol"})(n.ModuleErrorCodes||(n.ModuleErrorCodes={}));const c={[n.ModuleErrorCodes.UnrecognisedUri]:"Unrecognised uri - {uri}",[n.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognised uri protocol"};let a=function(b){function g(e,k){e=b.call(this,D(c[e],k))||this;e.declaredRootClass="esri.arcade.arcademoduleerror";Error.captureStackTrace&&
Error.captureStackTrace(l._assertThisInitialized(e),g);return e}l._inherits(g,b);return l._createClass(g)}(l._wrapNativeSuper(Error));n.ArcadeCompilationError=f;n.ArcadeExecutionError=h;n.ArcadeUncompilableError=d;n.ErrorWithCause=u;n.ExecutionErrorMessages=A;n.LocatableArcadeExecutionError=m;n.ModuleError=a;n.ModuleErrorMessages=c;n.doSubstitutions=D;n.ensureArcadeExecutionError=function(b,g,e){return"esri.arcade.arcadeexecutionerror"===e.declaredRootClass||"esri.arcade.arcadecompilationerror"===
e.declaredRootClass?null===e.loc&&g&&g.loc?new m(e,{cause:e}):e:g&&g.loc?new m(e,{cause:e}):e};n.parsingValidationMessage=function(b,g,e){return"Parsing error - "+F(b)+D(A[g],e)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/arcadeTimeUtils":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./ArcadeDate ../layers/support/FieldsIndex ../time/TimeReference ../chunks/datetime ../time/timeReferenceUtils".split(" "),function(n,l,F,D,A,u,m){function h(d){return d?.timeZoneIANA?
d?.timeZoneIANA:d?.timeZone?m.convertLegacyTimeZone(d,""):""}let f=function(){function d(){this.dateTimeReferenceMetaData=null;this._fieldTimeZoneIndex={};this._ianaLayerDateFields=this._ianaEditFields=this._ianaTimeInfo=this._ianaPreferred=this._fieldIndex=null}d.create=function(a,b){const g=new d;g.dateTimeReferenceMetaData=b;g._fieldIndex=a instanceof D?a:new D(a);return g};d.createFromLayer=function(a){if(!a)return null;if(!a.fieldsIndex)return!a.declaredClass&&a.fields?d.create(a.fields,a):null;
const b=new d;b._fieldIndex=a.fieldsIndex;b.dateTimeReferenceMetaData={timeInfo:a?.timeInfo?.toJSON()??null,editFieldsInfo:a?.editFieldsInfo?.toJSON()??null,dateFieldsTimeReference:a?.dateFieldsTimeReference?.toJSON()??null,preferredTimeReference:a?.preferredTimeReference?.toJSON()??null,datesInUnknownTimezone:!0===a?.datesInUnknownTimezone};return b};var c=d.prototype;c.fieldTimeZone=function(a){a=this._fieldIndex?.get(a);if(!a||"date"!==a.type&&"esriFieldTypeDate"!==a.type)return null;var b=this._fieldTimeZoneIndex[a.name];
if(void 0!==b)return b;b=[{field:this.dateTimeReferenceMetaData?.editFieldsInfo?.creationDateField,timeReference:this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.editFieldsInfo?.editDateField,timeReference:this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.timeInfo?.startTimeField,
timeReference:this.dateTimeReferenceMetaData?.timeInfo?.timeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.timeInfo?.endTimeField,timeReference:this.dateTimeReferenceMetaData?.timeInfo?.timeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone}];for(var g of b)if(g.field===a.name)return g=this.convertToIANA(g.timeReference,g.isunknown),this._fieldTimeZoneIndex[a.name]=g;g=this.convertToIANA(this.dateTimeReferenceMetaData?.dateFieldsTimeReference,
this.dateTimeReferenceMetaData?.datesInUnknownTimezone);return this._fieldTimeZoneIndex[a.name]=g};c.convertToIANA=function(a,b){return b?"unknown":h(a)};l._createClass(d,[{key:"layerPreferredTimeZone",get:function(){if(null!==this._ianaPreferred)return this._ianaPreferred;this._ianaPreferred="";return this._ianaPreferred=this.convertToIANA(this.dateTimeReferenceMetaData?.preferredTimeReference,!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone)}},{key:"layerTimeInfoTimeZone",get:function(){if(null!==
this._ianaTimeInfo)return this._ianaTimeInfo;this._ianaTimeInfo="";return this._ianaTimeInfo=this.convertToIANA(this.dateTimeReferenceMetaData?.timeInfo?.timeReference,!1)}},{key:"layerEditFieldsTimeZone",get:function(){if(null!==this._ianaEditFields)return this._ianaEditFields;this._ianaEditFields="";return this._ianaEditFields=this.convertToIANA(this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference,this.dateTimeReferenceMetaData?.datesInUnknownTimezone)}},{key:"layerDateFieldsTimeZone",
get:function(){if(null!==this._ianaLayerDateFields)return this._ianaLayerDateFields;this._ianaLayerDateFields="";return this._ianaLayerDateFields=this.convertToIANA(this.dateTimeReferenceMetaData?.dateFieldsTimeReference,!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone)}}]);return d}();n.DateTimeReferenceFieldIndex=f;n.convertTimeReference=function(d){if(!d)return null;d instanceof A&&(d=h(d.toJSON()));if(d instanceof u.Zone)return d;if("unknown"===d.toLowerCase())return F.UnknownTimeZone.instance;
if("system"===d.toLowerCase())return u.SystemZone.instance;if("utc"===d.toLowerCase())return u.FixedOffsetZone.utcInstance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(d)){const c=u.FixedOffsetZone.parseSpecifier("UTC"+(d.startsWith("+")||d.startsWith("-")?"":"+")+d);if(c)return c}d=u.IANAZone.create(d);if(!d.isValid)throw new F.ArcadeDateError(F.ArcadeDateErrorCodes.TimeZoneNotRecognised);return d};n.convertToIANA=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],
function(n){function l(D,A,u,m,h,f,d=1){f=h?f?4:3:f?3:2;let c=u,a=u+f,b=0,g=0,e=u=0,k=0;for(let p=0,q=m-1;p<q;p++,c+=f,a+=f){m=A[c];const t=A[c+1],v=A[c+2],y=A[a],w=A[a+1],z=A[a+2];let r=m*w-y*t;e+=r;b+=(m+y)*r;g+=(t+w)*r;h&&(r=m*z-y*v,u+=(v+z)*r,k+=r);m<D[0]&&(D[0]=m);m>D[1]&&(D[1]=m);t<D[2]&&(D[2]=t);t>D[3]&&(D[3]=t);h&&(v<D[4]&&(D[4]=v),v>D[5]&&(D[5]=v))}0<e*d&&(e*=-1);0<k*d&&(k*=-1);if(!e)return null;D=[b,g,.5*e];h&&(D[3]=u,D[4]=.5*k);return D}function F(D,A,u,m,h){h=m?h?4:3:h?3:2;let f=A,d=A+
h,c=0,a=0,b=0,g=0;for(let q=0,t=u-1;q<t;q++,f+=h,d+=h){var e=D[f];const v=D[f+1],y=D[f+2],w=D[d],z=D[d+1],r=D[d+2];if(m){var k=w-e;var p=z-v;const C=r-y;k=Math.sqrt(k*k+p*p+C*C)}else k=w-e,p=z-v,k=Math.sqrt(k*k+p*p);k&&(c+=k,m?(e=[e+.5*(w-e),v+.5*(z-v),y+.5*(r-y)],a+=k*e[0],b+=k*e[1],g+=k*e[2]):(e=[e+.5*(w-e),v+.5*(z-v)],a+=k*e[0],b+=k*e[1]))}return 0<c?m?[a/c,b/c,g/c]:[a/c,b/c]:0<u?m?[D[A],D[A+1],D[A+2]]:[D[A],D[A+1]]:null}n.getCentroidOptimizedGeometry=function(D,A,u,m,h){if(null==A||!A.lengths.length)return null;
const f="upperLeft"===h?.originPosition?-1:1;D.lengths.length&&(D.lengths.length=0);D.coords.length&&(D.coords.length=0);h=D.coords;const d=[],c=u?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:a,coords:b}=A,g=u?m?4:3:m?3:2;let e=0;for(var k of a){const p=l(c,b,e,k,u,m,f);p&&d.push(p);
e+=k*g}d.sort((p,q)=>{let t=f*p[2]-f*q[2];0===t&&u&&(t=p[4]-q[4]);return t});d.length&&(k=6*d[0][2],h[0]=d[0][0]/k,h[1]=d[0][1]/k,u&&(k=6*d[0][4],h[2]=0!==k?d[0][3]/k:0),h[0]<c[0]||h[0]>c[1]||h[1]<c[2]||h[1]>c[3]||u&&(h[2]<c[4]||h[2]>c[5]))&&(h.length=0);if(!h.length)if(A=A.lengths[0]?F(b,0,a[0],u,m):null)h[0]=A[0],h[1]=A[1],u&&2<A.length&&(h[2]=A[2]);else return null;return D};n.lineCentroid=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/support/FieldsIndex ./FeatureSetReader".split(" "),
function(n,l,F,D,A,u){function m({coords:f,lengths:d}){let c=0;for(const a of d){for(d=1;d<a;d++)f[2*(c+d)]+=f[2*(c+d)-2],f[2*(c+d)+1]+=f[2*(c+d)-1];c+=a}}let h=function(f){function d(a,b,g){a=f.call(this,a,g)||this;a._exceededTransferLimit=!1;a._featureIndex=-1;a._fieldsIndex=null;a._geometryType=g?.geometryType;a._features=b;return a}l._inherits(d,f);d.fromFeatures=function(a,b){const {objectIdField:g,geometryType:e}=b,k=F.convertFromFeatures([],a,e,!1,!1,g);for(let p=0;p<k.length;p++)k[p].displayId=
a[p].displayId;return d.fromOptimizedFeatures(k,b)};d.fromFeatureSet=function(a,b){a=F.convertFromFeatureSet(a,b.objectIdField);return d.fromOptimizedFeatureSet(a,b)};d.fromOptimizedFeatureSet=function(a,b){var {features:g}=a;g=d.fromOptimizedFeatures(g,b);g._exceededTransferLimit=a.exceededTransferLimit;g._transform=a.transform;g._fieldsIndex=new A(b.fields);return g};d.fromOptimizedFeatures=function(a,b,g){const e=u.FeatureSetReader.createInstance();a=new d(e,a,b);a._fieldsIndex=new A(b.fields);
a._transform=g;return a};var c=d.prototype;c.removeIds=function(a){const b=new Set(a);this._features=this._features.filter(g=>!(null!=g.objectId&&b.has(g.objectId)))};c.append=function(a){for(const b of a)this._features.push(b)};c.getSize=function(){return this._features.length};c.getCursor=function(){return this.copy()};c.getQuantizationTransform=function(){return this._transform};c.getAttributeHash=function(){let a="";for(const b in this._current.attributes)a+=this._current.attributes[b];return a};
c.getIndex=function(){return this._featureIndex};c.setIndex=function(a){this._featureIndex=a};c.getObjectId=function(){return this._current?.objectId};c.getDisplayId=function(){return this._current.displayId};c.setDisplayId=function(a){this._current.displayId=a};c.getGroupId=function(){return this._current.groupId};c.setGroupId=function(a){this._current.groupId=a};c.copy=function(){const a=new d(this.instance,this._features,this.fullSchema());this.copyInto(a);return a};c.next=function(){for(;++this._featureIndex<
this._features.length&&!this._getExists(););return this._featureIndex<this._features.length};c.readLegacyFeature=function(){return F.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)};c.readOptimizedFeature=function(){return this._current};c.readLegacyPointGeometry=function(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null};c.readLegacyGeometry=function(){const a=this.readUnquantizedGeometry();return F.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM)};c.readLegacyCentroid=
function(){const a=this.readCentroid();return null==a?null:{x:a.coords[0]*this._sx+this._tx,y:a.coords[1]*this._sy+this._ty}};c.readGeometryArea=function(){return D.hasGeometry(this._current)?F.getQuantizedArea(this._current.geometry,2):0};c.readUnquantizedGeometry=function(){var a=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!a)return a;a=a.clone();m(a);return a};c.readHydratedGeometry=function(){var a=this._current.geometry;if(null==a)return null;a=a.clone();null!=this._transform&&
F.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,this._transform);return a};c.getXHydrated=function(){if(!D.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[0],b=this.getQuantizationTransform();return null==b?a:a*b.scale[0]+b.translate[0]};c.getYHydrated=function(){if(!D.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[1],b=this.getQuantizationTransform();return null==b?a:b.translate[1]-a*b.scale[1]};c.getX=function(){return D.hasGeometry(this._current)?
this._current.geometry.coords[0]*this._sx+this._tx:0};c.getY=function(){return D.hasGeometry(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0};c.readGeometry=function(){if(!D.hasGeometry(this._current)){if(null!=this._current.centroid){const [g,e]=this._current.centroid.coords;return this.createQuantizedExtrudedQuad(g,e)}return null}const a=this._current.geometry.clone();if(a.isPoint)return a.coords[0]=a.coords[0]*this._sx+this._tx,a.coords[1]=a.coords[1]*this._sy+this._ty,a;let b=
0;for(const g of a.lengths)a.coords[2*b]=a.coords[2*b]*this._sx+this._tx,a.coords[2*b+1]=a.coords[2*b+1]*this._sy+this._ty,b+=g;return a};c.readCentroid=function(){return D.hasGeometry(this._current)?this._computeCentroid():this._current.centroid};c._readAttribute=function(a,b){var g=this._fieldsIndex.get(a);if(g){g=this._current.attributes[g.name];if(null==g)return g;"esriFieldTypeTimestampOffset"===this.fields.get(a)?.type&&(g=this.parseTimestampOffset(g));return b&&this.fields.isDateField(a)?new Date(g):
g}};c.copyInto=function(a){l._get(l._getPrototypeOf(d.prototype),"copyInto",this).call(this,a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._fieldsIndex=this._fieldsIndex};c._readAttributes=function(){return this._current.attributes};l._createClass(d,[{key:"fields",get:function(){return this._fieldsIndex}},{key:"_current",get:function(){return this._features[this._featureIndex]}},{key:"geometryType",get:function(){return this._geometryType}},{key:"hasFeatures",get:function(){return!!this._features.length}},
{key:"hasNext",get:function(){return this._featureIndex+1<this._features.length}},{key:"exceededTransferLimit",get:function(){return this._exceededTransferLimit}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}}]);return d}(u.FeatureSetReader);n.FeatureSetReaderJSON=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../symbols/cim/CIMSymbolDrawHelper ../../../../symbols/cim/CIMSymbolHelper ./GraphicStoreItem ./graphicsUtils".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){function a(p,q,t,v,y){g.minX=q;g.minY=t;g.maxX=v;g.maxY=y;return p.search(g)}function b(p){return{minX:p.bounds[0],minY:p.bounds[1],maxX:p.bounds[2],maxY:p.bounds[3]}}const g={minX:0,minY:0,maxX:0,maxY:0},e=D.create(),k=(p,q)=>{const t=c.graphicGeometryToNumber(p.graphic),v=c.graphicGeometryToNumber(q.graphic);return t===v?q.zorder-p.zorder:t-v};return function(){function p(t,v,y,w,z,r,C){this._graphics=w;this._onAdd=z;this._onRemove=r;this._hashToCIM=C;this._index=
F.rbush(9,b);this._itemByGraphic=new Map;this._inflatedSizeHelper=new f.CIMSymbolInflatedSizeHelper;this._tileInfoView=t;this._uidFieldName=y;if(t=t.getClosestInfoForScale(v))this._resolution=this._tileInfoView.getTileResolution(t.level)}var q=p.prototype;q.setResourceManager=function(t){this._cimResourceManager=t;this._hittestDrawHelper=new h.HittestDrawHelper(t)};q.hitTest=function(t,v,y,w,z){t=u.normalizeMapX(t,this._tileInfoView.spatialReference);var r=.5*w*window.devicePixelRatio*y;e[0]=t-r;
e[1]=v-r;e[2]=t+r;e[3]=v+r;y=.5*w*(y+c.PIXEL_BUFFER);v=a(this._index,t-y,v-y,t+y,v+y);if(!v||0===v.length)return[];t=[];y=D.create();r=D.create();for(var C of v){const {geometry:x,symbolResource:E}=C;this._getSymbolBounds(y,E,x,r,z);r[3]=r[2]=r[1]=r[0]=0;D.intersects(y,e)&&C.graphic?.visible&&t.push(C)}if(0===t.length)return[];C=this._hittestDrawHelper;v=[];for(const x of t){const {geometry:E,symbolResource:B}=x,{hash:G,textInfo:H}=B;(t=this._hashToCIM.get(G))&&C.hitTest(e,t.symbol,E,H,z,w)&&v.push(x)}v.sort(k);
return v.map(x=>x.graphic)};q.getGraphicsData=function(t,v,y){const w=this._searchForItems(v);if(0===w.length||0===y.length)return[];w.sort((G,H)=>G.zorder-H.zorder);w[0].insertAfter=-1;for(var z=1;z<w.length;z++)w[z].insertAfter=w[z-1].graphic.uid;w.sort((G,H)=>G.graphic.uid-H.graphic.uid);y.sort((G,H)=>G.uid-H.uid);let r=z=0,C;const x=v.resolution,E=[],B={originPosition:"upperLeft",scale:[x,x],translate:[v.bounds[0],v.bounds[3]]};for(const G of y){for(r=-2;z<w.length;)if(C=w[z],z++,G.uid===C.graphic.uid){r=
C.insertAfter;break}if(!C?.geometry||-2===r)continue;y=C.getGeometryQuantized(B,v.bounds,this._tileInfoView.spatialReference,x);const H={...C.graphic.attributes};H[this._uidFieldName]=G.uid;null==C.groupId&&(C.groupId=t.createTemplateGroup(C.symbol,null));E.push({centroid:d.getCentroidQuantized(C,B),geometry:y,attributes:H,symbol:C.symbol,groupId:C.groupId,insertAfter:r,zorder:C.zorder})}E.sort((G,H)=>G.zorder-H.zorder);return E};q.queryTileData=function(t,v){if(0===this._graphics.length)return[];
const {bounds:y,resolution:w}=v,z=this._searchForItems(v),r=[];if(0===z.length)return r;this._createTileGraphics(r,t,z,{originPosition:"upperLeft",scale:[w,w],translate:[y[0],y[3]]},v);return r};q.has=function(t){return this._itemByGraphic.has(t)};q.getBounds=function(t){return(t=this._itemByGraphic.get(t))?t.bounds:null};q.getAllBounds=function(){return Array.from(this._itemByGraphic.values()).filter(t=>t.graphic.visible).map(t=>t.bounds)};q.addOrModify=function(t,v,y){if(t&&null!=v){this.has(t)&&
this.remove(t);this._onAdd(t);var w=[0,0,0,0],z=this._getSymbolBounds(null,v,y,w,0);v=d.acquire(t,v,y,null!=z?z:null,w);this._itemByGraphic.set(t,v);y&&this._index.insert(v);return v.bounds}};q.remove=function(t){if(this._itemByGraphic.has(t)){this._onRemove(t);var v=this._itemByGraphic.get(t);v?.bounds&&this._index.remove(v);this._itemByGraphic.delete(t)}};q.updateZ=function(){const t=this._graphics.items;for(let y=0;y<t.length;y++){var v=t[y];if(v=this._itemByGraphic.get(v))v.zorder=y}};q.update=
function(t,v,y){const w=this._itemByGraphic.get(t);w.groupId=null;const z=D.clone(w.bounds);this._index.remove(w);const r=this._getSymbolBounds(w.bounds,v,y,w.size,0);null!=r&&w.set(t,v,y,r,w.size);y&&this._index.insert(w);return{oldBounds:z,newBounds:w.bounds}};q.updateLevel=function(t){if(this._resolution!==t){this._resolution=t;this._index.clear();var v=this._itemByGraphic;t=[];for(const [,y]of v)v=this._getSymbolBounds(y.bounds,y.symbolResource,y.geometry,y.size,0),y.geometry&&null!=v&&(y.bounds=
v,t.push(y));this._index.load(t)}};q.clear=function(){this._itemByGraphic.clear();this._index.clear()};q._createTileGraphics=function(t,v,y,w,z){const r=this._uidFieldName,C=this._tileInfoView.spatialReference,{bounds:x,resolution:E}=z;y.sort((I,J)=>I.zorder-J.zorder);let B,G,H;for(let I=0;I<y.length;I++){G=y[I];z=G.graphic;B=G.getGeometryQuantized(w,x,C,E);H=0===I?-1:y[I-1].graphic.uid;const J={...G.graphic.attributes};J[r]=z.uid;null==G.groupId&&(G.groupId=v.createTemplateGroup(G.symbol,null));
t.push({centroid:d.getCentroidQuantized(G,w),geometry:B,attributes:J,symbol:G.symbol,groupId:G.groupId,insertAfter:H,zorder:G.zorder})}};q._searchForItems=function(t){var v=this._tileInfoView.spatialReference,y=t.bounds,w=m.getInfo(v);if(w&&v.isWrappable){const [z,r]=w.valid;v=1E-5>Math.abs(y[2]-r);w=1E-5>Math.abs(y[0]-z);if(!(v&&w||!v&&!w))return t=t.resolution,t=v?D.create([z,y[1],z+t*c.PIXEL_BUFFER,y[3]]):D.create([r-t*c.PIXEL_BUFFER,y[1],r,y[3]]),y=a(this._index,y[0],y[1],y[2],y[3]),t=a(this._index,
t[0],t[1],t[2],t[3]),[...(new Set([...y,...t]))]}return a(this._index,y[0],y[1],y[2],y[3])};q._getSymbolBounds=function(t,v,y,w,z){if(!v||!v.symbol||!y)return null;t||(t=D.create());A.getBoundsXY(t,y);if(!w||0===w[0]&&0===w[1]&&0===w[2]&&0===w[3]){const {hash:r,textInfo:C}=v;v=this._hashToCIM.get(r);if(!v)return null;w||(w=[0,0,0,0]);z=this._inflatedSizeHelper.getSymbolInflateSize(w,v.symbol,this._cimResourceManager,z,C);w[0]=l.pt2px(z[0]);w[1]=l.pt2px(z[1]);w[2]=l.pt2px(z[2]);w[3]=l.pt2px(z[3])}z=
this._resolution;w=f.CIMSymbolInflatedSizeHelper.safeSize(w);t[0]-=w*z;t[1]-=w*z;t[2]+=w*z;t[3]+=w*z;return t};return n._createClass(p)}()})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry".split(" "),
function(n,l,F,D,A,u,m,h){function f(a){a.coords.length=0;a.lengths.length=0}const d=new h,c=new h;h=function(){function a(){this.bounds=l.create();this.graphic=null}a.acquire=function(g=null,e,k,p,q){let t;0===a._pool.length?t=new a:(t=a._pool.pop(),this._set.delete(t));t.acquire(g,e,k,p,q);return t};a.release=function(g){g&&!this._set.has(g)&&(g.release(),this._pool.push(g),this._set.add(g))};a.getCentroidQuantized=function(g,e){if(D.isPolygon(g.geometry)){const k=g.symbol;if(null==k)return null;
if(0<k?.layers.length&&k.layers.some(p=>"text"===p.type||"marker"===p.type))return g=F.polygonCentroid(g.geometry),null!==g?A.quantizePoint(e,{},{x:g[0],y:g[1]},!1,!1):null}return null};var b=a.prototype;b.acquire=function(g=null,e,k,p,q){g&&this.set(g,e,k,p,q)};b.release=function(){this.geometry=this.symbolResource=this.graphic=null};b.set=function(g,e,k,p,q){this.graphic=g;this.geometry=k;this.symbolResource=e;this.bounds=p;q&&(this.size=q)};b.getGeometryQuantized=function(g,e,k,p){var q=this.geometry;
const t=D.getJsonType(q);if(null==t)return null;switch(t){case "esriGeometryPolygon":({rings:q}=q);if(!q||0===q.length)return null;k=1===q.length&&2===q[0].length?A.quantizeGeometry(g,{paths:[[q[0][0],q[0][1]]]}):A.quantizeGeometry(g,this.geometry);if(!k&&(k=A.quantizeGeometry(g,{x:q[0][0][0],y:q[0][0][1]}))){const {x:y,y:w}=k;return{rings:[[[y-1,w],[1,-1],[1,1],[-1,1],[-1,-1]]]}}return k;case "esriGeometryPolyline":return f(d),f(c),k=q.hasZ??!1,p=q.hasM??!1,m.convertFromPolyline(d,q),m.generalizeOptimizedGeometry(c,
d,k,p,"esriGeometryPolyline",g.scale[0]),m.quantizeOptimizedGeometry(d,c,k,p,"esriGeometryPolyline",g),m.convertToPolyline(d,q.hasZ??!1,q.hasM??!1);case "esriGeometryMultipoint":const v=.5*p*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]);k=u.getInfo(k);q=q.points;if(k){const [y,w]=k.valid,z=w-y;q=q.filter(r=>{if(r[0]+v>w||r[0]-v<y){const C=[...r];C[0]=r[0]+v>w?C[0]-z:C[0]+z;return l.containsPointWithMargin(e,r,v)||l.containsPointWithMargin(e,
C,v)}return l.containsPointWithMargin(e,r,v)})}return 0===q.length?{points:q}:A.quantizeGeometry(g,{points:q})}return A.quantizeGeometry(g,this.geometry)};n._createClass(a,[{key:"symbol",get:function(){return this.symbolResource.symbol}}]);return a}();h._pool=[];h._set=new Set;return h})},"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../engine/webgl/enums","./BaseGraphicContainer"],function(n,l,F){return function(D){function A(){return D.apply(this,
arguments)||this}n._inherits(A,D);var u=A.prototype;u.renderChildren=function(m){this.attributeView.update();this.children.some(h=>h.hasData)&&(this.attributeView.bindTextures(m.context,!1),n._get(n._getPrototypeOf(A.prototype),"renderChildren",this).call(this,m),m.drawPhase===l.WGLDrawPhase.MAP&&this._renderChildren(m),this.hasHighlight()&&m.drawPhase===l.WGLDrawPhase.HIGHLIGHT&&this._renderHighlight(m),this._boundsRenderer&&this._boundsRenderer.doRender(m))};u._renderHighlight=function(m){var {painter:h}=
m;h=h.effects.highlight;h.bind(m);this._renderChildren(m,h.defines);h.draw(m);h.unbind()};return n._createClass(A)}(F)})},"esri/views/2d/layers/graphics/BaseGraphicContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../engine/FeatureContainer","./GraphicBoundsRenderer","../../../webgl/enums"],function(n,l,F,D,A){return function(u){function m(f){f=u.call(this,f)||this;f.hasHighlight=()=>!0;return f}n._inherits(m,u);var h=m.prototype;h.destroy=function(){n._get(n._getPrototypeOf(m.prototype),
"destroy",this).call(this);this._boundsRenderer=l.destroyMaybe(this._boundsRenderer)};h.enableRenderingBounds=function(f){this._boundsRenderer=new D(f);this.requestRender()};h.onTileData=function(f,d){f.patch(d);this.contains(f)||this.addChild(f);this.requestRender()};h.onTileError=function(f){f.clear();this.contains(f)||this.addChild(f)};h._renderChildren=function(f,d){for(const c of this.children)c.isReady&&c.hasData&&(c.commit(f),f.context.setStencilFunction(A.CompareFunction.EQUAL,c.stencilRef,
255),c.getDisplayList().replay(f,c,d))};n._createClass(m,[{key:"hasLabels",get:function(){return!1}}]);return m}(F.FeatureContainer)})},"esri/views/2d/engine/FeatureContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/promiseUtils ../../../core/Queue ./webgl/AttributeStoreView ./webgl/TileContainer ./webgl/WGLRendererInfo".split(" "),function(n,l,F,D,A,u,m){u=function(h){function f(c){var a=h.call(this,c)||this;a._rendererInfo=new m.WGLRendererInfo;a._materialItemsRequestQueue=
new D;a.attributeView=new A.AttributeStoreView(()=>a.onAttributeStoreUpdate());return a}l._inherits(f,h);var d=f.prototype;d.destroy=function(){this.children.forEach(c=>c.destroy());this.removeAllChildren();this.attributeView.destroy();this._materialItemsRequestQueue.clear()};d.setRendererInfo=function(c,a,b){this._rendererInfo.setInfo(c,a,b);this.requestRender()};d.getMaterialItems=async function(c,a){if(!c||0===c.length)return[];const b=F.createResolver();this._materialItemsRequestQueue.push({items:c,
abortOptions:a,resolver:b});this.requestRender();return b.promise};d.doRender=function(c){c.context.capabilities.enable("textureFloat");c.context.capabilities.enable("vao");if(0<this._materialItemsRequestQueue.length){let a=this._materialItemsRequestQueue.pop();for(;a;)this._processMaterialItemRequest(c,a),a=this._materialItemsRequestQueue.pop()}l._get(l._getPrototypeOf(f.prototype),"doRender",this).call(this,c)};d.renderChildren=function(c){for(const a of this.children)a.commit(c);this._rendererInfo.update(c.state);
l._get(l._getPrototypeOf(f.prototype),"renderChildren",this).call(this,c)};d.updateTransforms=function(c){if(this.children.some(a=>a.hasData))for(const a of this.children)a.setTransform(c)};d.createRenderParams=function(c){c=l._get(l._getPrototypeOf(f.prototype),"createRenderParams",this).call(this,c);c.rendererInfo=this._rendererInfo;c.attributeView=this.attributeView;return c};d.onAttributeStoreUpdate=function(){};d._processMaterialItemRequest=function(c,{items:a,abortOptions:b,resolver:g}){const {painter:e,
pixelRatio:k}=c;c=a.map(p=>e.textureManager.rasterizeItem(p.symbol,k,p.glyphIds,b));Promise.all(c).then(p=>{this.stage?(p=p.map((q,t)=>({id:a[t].id,mosaicItem:q})),g.resolve(p)):g.reject()},g.reject)};return l._createClass(f)}(u);n.FeatureContainer=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ./definitions ./DisplayId ./Utils ./util/debug ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e){const k=A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),p=c.createDebugLogger(c.DEBUG_ATTR_UPDATES,k);let q=function(){function t(y,w,z){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;const {buffer:r,pixelType:C,textureOnly:x}=y;y=d.getPixelArrayCtor(C);this.shared=z;this.pixelType=C;this.size=w;this.textureOnly=x;x||(this.data=new y(r));this._resetRange()}var v=t.prototype;v.destroy=function(){u.applySome(this._texture,y=>
y.dispose());for(const y in this._fbos)u.applySome(this._fbos[y],w=>{"0"===y&&w.detachColorTexture();w.dispose()}),this._fbos[y]=null;this._texture=null};v.setData=function(y,w,z){y=f.getDisplayIdTexel(y);const r=this.data;w=y*this.texelSize+w;!r||w>=r.length||(r[w]=z,this.dirtyStart=Math.min(this.dirtyStart,y),this.dirtyEnd=Math.max(this.dirtyEnd,y))};v.getData=function(y,w){if(null==this.data)return null;y=f.getDisplayIdTexel(y)*this.texelSize+w;return!this.data||y>=this.data.length?null:this.data[y]};
v.getTexture=function(y){return this._texture??this._initTexture(y)};v.getFBO=function(y,w=0){if(!this._fbos[w]){const z=0===w?this.getTexture(y):this._textureDesc;this._fbos[w]=new b.FramebufferObject(y,z)}return this._fbos[w]};v.updateTexture=function(y,w){if(!this.locked){try{const z=this.dirtyStart,r=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const C=this.data.buffer,x=this.getTexture(y),E=(z-z%this.size)/this.size,B=(r-r%this.size)/this.size,G=E*this.size*4,H=4*(this.size+B*this.size)-
G,I=d.getPixelArrayCtor(this.pixelType),J=new I(C,G*I.BYTES_PER_ELEMENT,H),L=this.size;y=B-E+1;if(y>this.size){k.error(new F("mapview-webgl","Out-of-bounds index when updating AttributeData"));return}x.updateData(0,0,E,L,y,J)}catch(z){}w()}};v.update=function(y){const {data:w,start:z,end:r}=y;if(null!=w&&null!=this.data){const C=this.data,x=z*this.texelSize;for(let E=0;E<w.length;E++)y.layout&1<<E%this.texelSize&&(C[x+E]=w[E])}this.dirtyStart=Math.min(this.dirtyStart,z);this.dirtyEnd=Math.max(this.dirtyEnd,
r)};v.resize=function(y,w){const z=this.size;this.size=w;this.textureOnly?z!==this.size&&(this._lastTexture=this._texture,this._texture=null):(w=d.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new w(y.buffer))};v._resetRange=function(){this.dirtyStart=2147483647;this.dirtyEnd=0};v._initTexture=function(y){const w=new g.Texture(y,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const C=this._lastTexture.descriptor.width,x=this._lastTexture.descriptor.height,
E=this._lastTexture.descriptor.dataType,B=this._lastTexture.descriptor.pixelFormat,G=this.getFBO(y);var z=d.getPixelBytes(E),r=d.getPixelArrayCtor(E);z=new ArrayBuffer(C*x*z*this.texelSize);r=new r(z);z=y.getBoundFramebufferObject();const {x:H,y:I,width:J,height:L}=y.getViewport();y.bindFramebuffer(G);G.readPixels(0,0,C,x,B,E,r);w.updateData(0,0,0,2*C,x/2,r);y.setViewport(H,I,J,L);y.bindFramebuffer(z)}this.destroy();return this._texture=w};l._createClass(t,[{key:"_textureDesc",get:function(){const y=
new e.TextureDescriptor;y.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;y.samplingMode=a.TextureSamplingMode.NEAREST;y.dataType=this.pixelType;y.width=this.size;y.height=this.size;return y}},{key:"locked",get:function(){return this.pixelType===a.PixelType.UNSIGNED_BYTE&&this.shared&&!this.textureOnly&&D("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1}},{key:"hasDirty",get:function(){return this.dirtyEnd>=this.dirtyStart}}]);return t}();A=function(){function t(y){this._onUpdate=y;this._locked=
this._forceNextUpload=this._initialized=!1}var v=t.prototype;v.initialize=function(y){const {blocks:w,shared:z,size:r}=y;this.shared=z;this.size=r;p("Initializing AttributeStoreView",y);if(null==this._data)this._data=u.mapMany(w,C=>new q(C,r,z));else for(y=0;y<this._data.length;y++){const C=this._data[y],x=w[y];null!=x&&(null==C?this._data[y]=new q(x,r,z):C.resize(x,r))}this._initialized=!0};v.destroy=function(){u.applySome(this._data,y=>u.mapMany(y,w=>w.destroy()));u.applySome(this._defaultTexture,
y=>y.dispose())};v.isEmpty=function(){return null==this._data};v.isUpdating=function(){const y=null!=this._pendingAttributeUpdate;D("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${y}\n  -> hasPendingUpdate ${y}`);return y};v.getBlock=function(y){return null==this._data?null:this._data[y]};v.setLabelMinZoom=function(y,w){this.setData(y,0,1,w)};v.getLabelMinZoom=function(y){return this.getData(y,0,1,255)};v.getFilterFlags=function(y){return this.getData(y,0,0,0)};v.getVVSize=function(y){return this.getData(y,
h.ATTRIBUTE_DATA_VV,0,0)};v.getData=function(y,w,z,r){if(!this._data)return 0;w=this._data[w];if(null==w)return 0;y=w.getData(y,z);return null!=y?y:r};v.setData=function(y,w,z,r){this._data[w].setData(y,z,r)};v.lockTextureUpload=function(){this._locked=!0};v.unlockTextureUpload=function(){this._locked=!1};v.forceTextureUpload=function(){this._forceNextUpload=!0};v.requestUpdate=async function(y){if(this._pendingAttributeUpdate)k.error(new F("mapview-webgl","Tried to update attribute data with a pending update"));
else{var w=m.createResolver();p("AttributeStoreView Update Requested",y);this._pendingAttributeUpdate={data:y,resolver:w};this._onUpdate();return w.promise}};v.update=function(){if(this._initialized&&null!=this._pendingAttributeUpdate){D("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");const {data:y,resolver:w}=this._pendingAttributeUpdate,z=this._data;for(let r=0;r<y.blocks.length;r++){const C=y.blocks[r];u.applySome(z[r],x=>u.applySome(C,E=>{p(`Updating block ${r}`,E);x.update(E)}))}this._pendingAttributeUpdate=
null;w();this._onUpdate()}};v.bindTextures=function(y,w=!0){const z=this._getDefaultTexture(y);if(this._initialized){var r=this._data;if(!this._locked||this._forceNextUpload)u.forEachSome(r,C=>C.updateTexture(y,()=>this._onUpdate())),this._forceNextUpload=!1;y.bindTexture(r[h.ATTRIBUTE_DATA_FILTER_FLAGS]?.getTexture(y)??z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_0);w&&(y.bindTexture(r[h.ATTRIBUTE_DATA_GPGPU]?.getTexture(y)??z,h.TEXTURE_BINDING_GPGPU),y.bindTexture(r[h.ATTRIBUTE_DATA_ANIMATION]?.getTexture(y)??
z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_1),y.bindTexture(r[h.ATTRIBUTE_DATA_VV]?.getTexture(y)??z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_2),y.bindTexture(r[h.ATTRIBUTE_DATA_DD1]?.getTexture(y)??z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_3),y.bindTexture(r[h.TEXTURE_BINDING_ATTRIBUTE_DATA_4]?.getTexture(y)??z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_4),y.bindTexture(r[h.TEXTURE_BINDING_ATTRIBUTE_DATA_5]?.getTexture(y)??z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_5))}else y.bindTexture(z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_0),w&&(y.bindTexture(z,
h.TEXTURE_BINDING_ATTRIBUTE_DATA_1),y.bindTexture(z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_2),y.bindTexture(z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_3),y.bindTexture(z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_4),y.bindTexture(z,h.TEXTURE_BINDING_ATTRIBUTE_DATA_5),y.bindTexture(z,h.TEXTURE_BINDING_GPGPU))};v._getDefaultTexture=function(y){if(null==this._defaultTexture){const w=new e.TextureDescriptor;w.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;w.samplingMode=a.TextureSamplingMode.NEAREST;w.width=1;w.height=1;this._defaultTexture=
new g.Texture(y,w,new Uint8Array(4))}return this._defaultTexture};return l._createClass(t)}();n.AttributeStoreView=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ./enums ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),function(n,l,F,D,A,u){const m=(h,f)=>0!==h.key.level-f.key.level?h.key.level-f.key.level:0!==h.key.row-f.key.row?
h.key.row-f.key.row:h.key.col-f.key.col;return function(h){function f(c){var a=h.call(this)||this;a._tileInfoView=c;return a}n._inherits(f,h);var d=f.prototype;d.renderChildren=function(c){this.sortChildren(m);this.setStencilReference(c);n._get(n._getPrototypeOf(f.prototype),"renderChildren",this).call(this,c)};d.createRenderParams=function(c){const {state:a}=c;c=n._get(n._getPrototypeOf(f.prototype),"createRenderParams",this).call(this,c);c.requiredLevel=this._tileInfoView.getClosestInfoForScale(a.scale).level;
c.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(a.scale);return c};d.prepareRenderPasses=function(c){const a=n._get(n._getPrototypeOf(f.prototype),"prepareRenderPasses",this).call(this,c);a.push(c.registerRenderPass({name:"stencil",brushes:[u],drawPhase:F.WGLDrawPhase.DEBUG|F.WGLDrawPhase.MAP|F.WGLDrawPhase.HIGHLIGHT,target:()=>this.getStencilTarget()}));l("esri-tiles-debug")&&a.push(c.registerRenderPass({name:"tileInfo",brushes:[A],drawPhase:F.WGLDrawPhase.DEBUG,target:()=>this.children}));
return a};d.getStencilTarget=function(){return this.children};d.setStencilReference=function(c){c=1;for(const a of this.children)a.stencilRef=c++};n._createClass(f,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return f}(D)})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3f32 ../brushes ../Container ./ClippingInfo ./enums".split(" "),function(n,l,F,D,A,u,m){return function(h){function f(){var c=
h.apply(this,arguments)||this;c.name=c.constructor.name;return c}n._inherits(f,h);var d=f.prototype;d.beforeRender=function(c){n._get(n._getPrototypeOf(f.prototype),"beforeRender",this).call(this,c);this.updateTransforms(c.state)};d._createTransforms=function(){return{dvs:F.create()}};d.doRender=function(c){c=this.createRenderParams(c);const {painter:a,globalOpacity:b,profiler:g,drawPhase:e}=c,k=e===m.WGLDrawPhase.LABEL||e===m.WGLDrawPhase.HIGHLIGHT?1:b*this.computedOpacity;g.recordContainerStart(this.name);
a.beforeRenderLayer(c,this._clippingInfos?255:0,k);this.renderChildren(c);a.compositeLayer(c,k);g.recordContainerEnd()};d.renderChildren=function(c){null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(c.painter));for(const a of this._renderPasses)try{a.render(c)}catch(b){}};d.createRenderParams=function(c){c.requireFBO=this.requiresDedicatedFBO;return c};d.prepareRenderPasses=function(c){return[c.registerRenderPass({name:"clip",brushes:[D.brushes.clip],target:()=>this._clippingInfos,
drawPhase:m.WGLDrawPhase.MAP|m.WGLDrawPhase.LABEL|m.WGLDrawPhase.LABEL_ALPHA|m.WGLDrawPhase.DEBUG|m.WGLDrawPhase.HIGHLIGHT})]};d.updateTransforms=function(c){for(const a of this.children)a.setTransform(c)};d.onAttach=function(){n._get(n._getPrototypeOf(f.prototype),"onAttach",this).call(this);this._updateClippingInfo()};d.onDetach=function(){n._get(n._getPrototypeOf(f.prototype),"onDetach",this).call(this);this._updateClippingInfo()};d._updateClippingInfo=function(){null!=this._clippingInfos&&(this._clippingInfos.forEach(b=>
b.destroy()),this._clippingInfos=null);const c=this.stage;if(c){var a=this._clips;null!=a&&a.length&&(this._clippingInfos=a.items.map(b=>u.fromClipArea(c,b)));this.requestRender()}};n._createClass(f,[{key:"clips",set:function(c){this._clips=c;this.children.forEach(a=>a.clips=c);this._updateClippingInfo()}}]);return f}(A.Container)})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../chunks/mat3f32 ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h){return function(f){function d(a,b){var g=f.call(this)||this;g._clip=b;g._cache={};g.stage=a;g._handle=D.watch(()=>b.version,()=>g._invalidate());g.ready();return g}n._inherits(d,f);d.fromClipArea=function(a,b){return new d(a,b)};var c=d.prototype;c._destroyGL=function(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)};c.destroy=function(){this._destroyGL();this._handle.remove()};
c.getVAO=function(a,b,g,e){const [k,p]=b.size;if("geometry"===this._clip.type||this._lastWidth!==k||this._lastHeight!==p)this._lastWidth=k,this._lastHeight=p,this._destroyGL();if(null==this._cache.vao){b=this._createMesh(b,this._clip);const q=b.getIndexBuffer(a),t=b.getVertexBuffers(a);this._cache.mesh=b;this._cache.vao=new h.VertexArrayObject(a,g,e,t,q)}return this._cache.vao};c._createTransforms=function(){return{dvs:A.create()}};c._invalidate=function(){this._destroyGL();this.requestRender()};
c._createScreenRect=function(a,b){const [g,e]=a.size;a="string"===typeof b.left?parseFloat(b.left)/100*g:b.left;const k="string"===typeof b.right?parseFloat(b.right)/100*g:b.right,p="string"===typeof b.top?parseFloat(b.top)/100*e:b.top;b="string"===typeof b.bottom?parseFloat(b.bottom)/100*e:b.bottom;return{x:a,y:p,width:Math.max(g-k-a,0),height:Math.max(e-b-p,0)}};c._createMesh=function(a,b){switch(b.type){case "rect":return m.fromRect(this._createScreenRect(a,b));case "path":return m.fromPath(b);
case "geometry":return m.fromGeometry(a,b);default:return F.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new l("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),m.fromRect({x:0,y:0,width:1,height:1})}};return n._createClass(d)}(u.DisplayObject)})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/Logger ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c){const a=({coords:b,lengths:g},e)=>{const k=[];for(let t=0,v=0;t<g.length;v+=g[t],t+=1){const y=v;for(var p=[];t<g.length-1;t+=1,v+=g[t]){var q=v+g[t];let w=0;for(let z=1;z<g[t+1];z++)w+=(b[2*(q+z)]-b[2*(q+z-1)])*(b[2*(q+z)+1]+b[2*(q+z-1)+1]);if(!(e?0<w:0>w))break;p.push(v+g[t]-y)}q=b.slice(2*y,2*(v+g[t]));p=D.earcut(q,p,2);for(const w of p)k.push(w+y)}return k};return function(){function b(e,k,p,q=!1){this._cache={};this.vertices=e;this.indices=k;this.primitiveType=
p;this.isMapSpace=q}b.fromRect=function({x:e,y:k,width:p,height:q}){return b.fromScreenExtent({xmin:e,ymin:k,xmax:e+p,ymax:k+q})};b.fromPath=function(e){var k=m.convertFromNestedArray(new h,e.path,!1,!1);e=k.coords;k=new Uint32Array(a(k,!0));const p=new Uint32Array(e.length/2);for(let q=0;q<p.length;q++)p[q]=f.i1616to32(Math.floor(e[2*q]),Math.floor(e[2*q+1]));return new b({geometry:p},k,c.PrimitiveType.TRIANGLES)};b.fromGeometry=function(e,k){const p=k.geometry?.type;switch(p){case "polygon":return b.fromPolygon(e,
k.geometry);case "extent":return b.fromMapExtent(e,k.geometry);default:return F.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new l("mapview-bad-type",`Unable to create a mesh from type ${p}`,k)),b.fromRect({x:0,y:0,width:1,height:1})}};b.fromPolygon=function(e,k){var p=m.convertFromPolygon(new h,k,!1,!1);k=p.coords;p=new Uint32Array(a(p,!1));const q=new Uint32Array(k.length/2),t=u.create(),v=u.create();for(let y=0;y<q.length;y++)A.set(t,k[2*y],k[2*y+1]),e.toScreen(v,t),q[y]=f.i1616to32(Math.floor(v[0]),
Math.floor(v[1]));return new b({geometry:q},p,c.PrimitiveType.TRIANGLES,!0)};b.fromScreenExtent=function({xmin:e,xmax:k,ymin:p,ymax:q}){e={geometry:new Uint32Array([f.i1616to32(e,p),f.i1616to32(k,p),f.i1616to32(e,q),f.i1616to32(e,q),f.i1616to32(k,p),f.i1616to32(k,q)])};k=new Uint32Array([0,1,2,3,4,5]);return new b(e,k,c.PrimitiveType.TRIANGLES)};b.fromMapExtent=function(e,k){const [p,q]=e.toScreen([0,0],[k.xmin,k.ymin]),[t,v]=e.toScreen([0,0],[k.xmax,k.ymax]);e={geometry:new Uint32Array([f.i1616to32(p,
q),f.i1616to32(t,q),f.i1616to32(p,v),f.i1616to32(p,v),f.i1616to32(t,q),f.i1616to32(t,v)])};k=new Uint32Array([0,1,2,3,4,5]);return new b(e,k,c.PrimitiveType.TRIANGLES)};var g=b.prototype;g.destroy=function(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)null!=this._cache.vertexBuffers[e]&&this._cache.vertexBuffers[e].dispose()};g.getIndexBuffer=function(e,k=c.Usage.STATIC_DRAW){this._cache.indexBuffer||(this._cache.indexBuffer=d.BufferObject.createIndex(e,
k,this.indices));return this._cache.indexBuffer};g.getVertexBuffers=function(e,k=c.Usage.STATIC_DRAW){this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((p,q)=>({...p,[q]:d.BufferObject.createVertex(e,k,this.vertices[q])}),{}));return this._cache.vertexBuffers};n._createClass(b,[{key:"elementType",get:function(){a:switch(this.indices.BYTES_PER_ELEMENT){case 1:var e=c.DataType.UNSIGNED_BYTE;break a;case 2:e=c.DataType.UNSIGNED_SHORT;break a;case 4:e=c.DataType.UNSIGNED_INT;
break a;default:throw new l("Cannot get DataType of array");}return e}}]);return b}()})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../core/unitUtils ../../../../renderers/support/lengthUtils ./Utils ./techniques/Technique ./techniques/utils ../../../webgl/capabilities".split(" "),function(n,l,F,D,A,u,m,h,f){function d(a,b){const g=b.length;if(a<b[0].value||1===g)return b[0].size;for(let e=
1;e<g;e++)if(a<b[e].value)return b[e-1].size+(a-b[e-1].value)/(b[e].value-b[e-1].value)*(b[e].size-b[e-1].size);return b[g-1].size}let c=function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.outsideLabelsVisible=!1;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",
vvOpacityEnabled:!1};this._technique=m.Technique}var b=a.prototype;b.getSizeVVFieldStops=function(g){var e=this._vvSizeFieldStops;if(e)switch(e.type){case "static":return e;case "level-dependent":var k;if(null!=(k=e.levels[g]))e=k;else{{let p=Infinity;k=0;for(const q in e.levels){const t=parseFloat(q),v=Math.abs(g-t);v<p&&(p=v,k=t)}Infinity===p?e={sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])}:(g=2**((g-k)/2),e=e.levels[k],k=new Float32Array(e.values),k[2]*=g,k[3]*=
g,e={sizes:e.sizes,values:k})}}return e}};b.update=function(g){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,g)};b.setInfo=function(g,e,k){this._updateEffects(k);this._vvInfo=e;this._technique=h.getTechniqueFromRenderer(g);this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,g)};b.getVariation=function(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:f.getWebGLCapabilities("2d").supportsTextureFloat}};
b.getVariationHash=function(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)};b._updateEffects=function(g){this.outsideLabelsVisible=null!=g?g.excludedLabelsVisible:!1};b._updateVisualVariables=function(g,e){const k=this._vvMaterialParameters;k.vvOpacityEnabled=!1;k.vvSizeEnabled=!1;k.vvColorEnabled=!1;k.vvRotationEnabled=!1;if(g){var p=g.size;if(p){k.vvSizeEnabled=!0;if(p.minMaxValue){const t=p.minMaxValue;let v;if(u.isDefined(t.minSize)&&u.isDefined(t.maxSize))if(u.isNumber(t.minSize)&&
u.isNumber(t.maxSize)){v=F.pt2px(t.minSize);var q=F.pt2px(t.maxSize)}else q=e.scale,v=F.pt2px(d(q,t.minSize.stops)),q=F.pt2px(d(q,t.maxSize.stops));this.vvSizeMinMaxValue.set([t.minDataValue,t.maxDataValue,v,q])}p.scaleStops&&(this.vvSizeScaleStopsValue=F.pt2px(d(e.scale,p.scaleStops.stops)));p.unitValue&&(this.vvSizeUnitValueToPixelsRatio=D.getMetersPerUnitForSR(e.spatialReference)/A.meterIn[p.unitValue.unit]/e.resolution);p.fieldStops&&(this._vvSizeFieldStops=p.fieldStops)}if(e=g.color)k.vvColorEnabled=
!0,this.vvColorValues.set(e.values),this.vvColors.set(e.colors);if(e=g.opacity)k.vvOpacityEnabled=!0,this.vvOpacityValues.set(e.values),this.vvOpacities.set(e.opacities);if(g=g.rotation)k.vvRotationEnabled=!0,k.vvRotationType=g.type}};l._createClass(a,[{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}}]);return a}();n.WGLRendererInfo=c;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a){const b=Math.PI/180,g=()=>f.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:c.DataType.FLOAT}]});return function(e){function k(q){var t=e.call(this)||this;t._program=null;t._vao=null;t._vertexBuffer=null;t._indexBuffer=null;t._dvsMat3=D.create();t._localOrigin={x:0,y:0};t._getBounds=q;return t}n._inherits(k,e);var p=k.prototype;p.destroy=function(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=
null);this._program=l.disposeMaybe(this._program)};p.doRender=function(q){const {context:t}=q,v=this._getBounds();1>v.length||(this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(q),this._updateBufferData(t,v),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),q=this._program,t.bindVAO(this._vao),t.useProgram(q),q.setUniformMatrix3fv("u_dvsMat3",
this._dvsMat3),t.gl.lineWidth(1),t.drawElements(c.PrimitiveType.LINES,8*v.length,c.DataType.UNSIGNED_INT,0),t.bindVAO())};p._createTransforms=function(){return{dvs:D.create()}};p._createShaderProgram=function(q){this._program||(this._program=q.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }",
"precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",g().attributes))};p._updateMatricesAndLocalOrigin=function(q){var {state:t}=q;const {displayMat3:v,size:y,resolution:w,pixelRatio:z,rotation:r,viewpoint:C}=t;q=b*r;const {x,y:E}=C.targetGeometry;t=m.normalizeMapX(x,t.spatialReference);this._localOrigin.x=t;this._localOrigin.y=E;t=z*y[0];const B=z*y[1],G=w*t,H=w*B,I=F.identity(this._dvsMat3);F.multiply(I,I,v);F.translate(I,I,A.fromValues(t/
2,B/2));F.scale(I,I,u.fromValues(y[0]/G,-B/H,1));F.rotate(I,I,-q)};p._updateBufferData=function(q,t){const {x:v,y}=this._localOrigin,w=new Float32Array(8*t.length),z=new Uint32Array(8*t.length);let r=0,C=0;for(const x of t)x&&(w[2*r]=x[0]-v,w[2*r+1]=x[1]-y,w[2*r+2]=x[0]-v,w[2*r+3]=x[3]-y,w[2*r+4]=x[2]-v,w[2*r+5]=x[3]-y,w[2*r+6]=x[2]-v,w[2*r+7]=x[1]-y,z[C]=r+0,z[C+1]=r+3,z[C+2]=r+3,z[C+3]=r+2,z[C+4]=r+2,z[C+5]=r+1,z[C+6]=r+1,z[C+7]=r+0,r+=4,C+=8);this._vertexBuffer?this._vertexBuffer.setData(w.buffer):
this._vertexBuffer=d.BufferObject.createVertex(q,c.Usage.DYNAMIC_DRAW,w.buffer);this._indexBuffer?this._indexBuffer.setData(z):this._indexBuffer=d.BufferObject.createIndex(q,c.Usage.DYNAMIC_DRAW,z);this._vao||(t=g(),this._vao=new a.VertexArrayObject(q,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer))};return n._createClass(k)}(h.DisplayObject)})},"esri/chunks/vec3f32":function(){define(["exports"],function(n){function l(){return new Float32Array(3)}function F(p){const q=
new Float32Array(3);q[0]=p[0];q[1]=p[1];q[2]=p[2];return q}function D(p,q,t){const v=new Float32Array(3);v[0]=p;v[1]=q;v[2]=t;return v}function A(p,q){return new Float32Array(p,q,3)}function u(){return l()}function m(){return D(1,1,1)}function h(){return D(1,0,0)}function f(){return D(0,1,0)}function d(){return D(0,0,1)}const c=l(),a=m(),b=h(),g=f(),e=d(),k=Object.freeze(Object.defineProperty({__proto__:null,ONES:a,UNIT_X:b,UNIT_Y:g,UNIT_Z:e,ZEROS:c,clone:F,create:l,createView:A,fromValues:D,ones:m,
unitX:h,unitY:f,unitZ:d,zeros:u},Symbol.toStringTag,{value:"Module"}));n.ONES=a;n.UNIT_X=b;n.UNIT_Y=g;n.UNIT_Z=e;n.ZEROS=c;n.clone=F;n.create=l;n.createView=A;n.fromValues=D;n.ones=m;n.unitX=h;n.unitY=f;n.unitZ=d;n.vec3f32=k;n.zeros=u})},"esri/views/2d/navigation/MapViewNavigation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Viewpoint ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k){const p=new F({targetGeometry:new c}),q=[0,0];F=function(t){function v(w){w=t.call(this,w)||this;w._endTimer=null;w._lastEventTimestamp=null;w.animationManager=null;w.interacting=!1;return w}n._inherits(v,t);var y=v.prototype;y.initialize=function(){this.pan=new g({navigation:this});this.rotate=new k({navigation:this});this.pinch=new e({navigation:this});this.zoomBox=new b({view:this.view,navigation:this})};y.destroy=function(){this.pan=A.destroyMaybe(this.pan);
this.rotate=A.destroyMaybe(this.rotate);this.pinch=A.destroyMaybe(this.pinch);this.zoomBox=A.destroyMaybe(this.zoomBox);this.animationManager=null};y.begin=function(){this._set("interacting",!0)};y.end=function(){this._lastEventTimestamp=performance.now();this._startTimer(250)};y.zoom=async function(w,z=this._getDefaultAnchor()){this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>w?this.zoomIn(z):this.zoomOut(z);this.setViewpoint(z,w,0,[0,0])};
y.zoomIn=async function(w){var z=this.view;z=z.constraints.snapToNextScale(z.scale);return this._zoomToScale(z,w)};y.zoomOut=async function(w){var z=this.view;z=z.constraints.snapToPreviousScale(z.scale);return this._zoomToScale(z,w)};y.setViewpoint=function(w,z,r,C){this.begin();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,w,z,r,C);this.end()};y.setViewpointImmediate=function(w,z=0,r=[0,0],C=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=
this._scaleRotateTranslateViewpoint(this.view.viewpoint,C,w,z,r)};y.continousRotateClockwise=function(){const w=this.get("view.viewpoint");this.animationManager?.animateContinous(w,z=>{a.rotateBy(z,z,-1)})};y.continousRotateCounterclockwise=function(){const w=this.get("view.viewpoint");this.animationManager?.animateContinous(w,z=>{a.rotateBy(z,z,1)})};y.resetRotation=function(){this.view.rotation=0};y.continousPanLeft=function(){this._continuousPan([-10,0])};y.continousPanRight=function(){this._continuousPan([10,
0])};y.continousPanUp=function(){this._continuousPan([0,10])};y.continousPanDown=function(){this._continuousPan([0,-10])};y.stop=function(){this.pan.stopMomentumNavigation();this.animationManager?.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))};y._continuousPan=function(w){const z=this.view.viewpoint;this.animationManager?.animateContinous(z,r=>{a.translateBy(r,r,w);this.view.constraints.constrainByGeometry(r)})};y._startTimer=
function(w){return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(()=>{this._endTimer=null;const z=performance.now()-(this._lastEventTimestamp??0);250>z?this._endTimer=this._startTimer(z):this._set("interacting",!1)},w)};y._getDefaultAnchor=function(){const {size:w,padding:{left:z,right:r,top:C,bottom:x}}=this.view;q[0]=.5*(w[0]-r+z);q[1]=.5*(w[1]-x+C);return q};y._zoomToScale=async function(w,z=this._getDefaultAnchor()){const {view:r}=this,{constraints:C,scale:x,viewpoint:E,size:B,
padding:G}=r,H=C.canZoomInTo(w),I=C.canZoomOutTo(w);if(!(w<x&&!H||w>x&&!I))return a.padAndScaleAndRotateBy(p,E,w/x,0,z,B,G),C.constrainByGeometry(p),r.goTo(p,{animate:!0})};y._scaleRotateTranslateViewpoint=function(w,z,r,C,x){var {view:E}=this;const {size:B,padding:G,constraints:H,scale:I,viewpoint:J}=E;var L=I*r;E=H.canZoomInTo(L);L=H.canZoomOutTo(L);if(1>r&&!E||1<r&&!L)r=1;a.translateBy(J,J,x);a.padAndScaleAndRotateBy(w,J,r,C,z,B,G);return H.constrainByGeometry(w)};return n._createClass(v)}(D);
l.__decorate([u.property()],F.prototype,"animationManager",void 0);l.__decorate([u.property({type:Boolean,readOnly:!0})],F.prototype,"interacting",void 0);l.__decorate([u.property()],F.prototype,"pan",void 0);l.__decorate([u.property()],F.prototype,"pinch",void 0);l.__decorate([u.property()],F.prototype,"rotate",void 0);l.__decorate([u.property()],F.prototype,"view",void 0);l.__decorate([u.property()],F.prototype,"zoomBox",void 0);return F=l.__decorate([d.subclass("esri.views.2d.navigation.MapViewNavigation")],
F)})},"esri/views/2d/navigation/ZoomBox":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../input/InputManager".split(" "),function(n,l,F,D,A,u,m,h,f,d){F=function(c){function a(g){g=c.call(this,g)||this;g._container=null;g._overlay=
null;g._backgroundShape=null;g._boxShape=null;g._box={x:0,y:0,width:0,height:0};g._rafId=null;g._handles=null;g._redraw=g._redraw.bind(n._assertThisInitialized(g));return g}n._inherits(a,c);var b=a.prototype;b.destroy=function(){this.view=null};b._start=function(){this._createContainer();this._createOverlay();this.navigation.begin()};b._update=function(g,e,k,p){this._box.x=g;this._box.y=e;this._box.width=k;this._box.height=p;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))};b._end=function(g,
e,k,p,q){const t=this.view;g=t.toMap(D.createScreenPoint(g+.5*k,e+.5*p));k=Math.max(k/t.width,p/t.height);-1===q&&(k=1/k);this._destroyOverlay();this.navigation.end();t.goTo({center:g,scale:t.scale*k})};b._updateBox=function(g,e,k,p){const q=this._boxShape;q.setAttributeNS(null,"x",""+g);q.setAttributeNS(null,"y",""+e);q.setAttributeNS(null,"width",""+k);q.setAttributeNS(null,"height",""+p);q.setAttributeNS(null,"class","esri-zoom-box__outline")};b._updateBackground=function(g,e,k,p){this._backgroundShape.setAttributeNS(null,
"d",this._toSVGPath(g,e,k,p,this.view.width,this.view.height))};b._createContainer=function(){const g=document.createElement("div");g.className="esri-zoom-box__container";this.view.root.appendChild(g);this._container=g};b._createOverlay=function(){var g=this.view.width,e=this.view.height;const k=document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M 0 0 L "+g+" 0 L "+g+" "+e+" L 0 "+e+" Z");k.setAttributeNS(null,"class","esri-zoom-box__overlay-background");g=document.createElementNS("http://www.w3.org/2000/svg",
"rect");e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");e.setAttributeNS(null,"class","esri-zoom-box__overlay");e.appendChild(k);e.appendChild(g);this._container.appendChild(e);this._backgroundShape=k;this._boxShape=g;this._overlay=e};b._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=
this._boxShape=this._overlay=null};b._toSVGPath=function(g,e,k,p,q,t){k=g+k;p=e+p;return"M 0 0 L "+q+" 0 L "+q+" "+t+" L 0 "+t+" ZM "+g+" "+e+" L "+g+" "+p+" L "+k+" "+p+" L "+k+" "+e+" Z"};b._handleDrag=function(g,e){var k=g.x,p=g.y,q=g.origin.x;const t=g.origin.y;let v;k>q?(v=q,q=k-q):(v=k,q-=k);p>t?(k=t,p-=t):(k=p,p=t-p);switch(g.action){case "start":this._start();break;case "update":this._update(v,k,q,p);break;case "end":this._end(v,k,q,p,e)}g.stopPropagation()};b._redraw=function(){if(this._rafId&&
(this._rafId=null,this._overlay)){var {x:g,y:e,width:k,height:p}=this._box;this._updateBox(g,e,k,p);this._updateBackground(g,e,k,p);this._rafId=requestAnimationFrame(this._redraw)}};n._createClass(a,[{key:"view",set:function(g){this._handles&&this._handles.forEach(e=>{e.remove()});this._handles=null;this._destroyOverlay();this._set("view",g);g&&(g.on("drag",["Shift"],e=>this._handleDrag(e,1),d.ViewEventPriorities.INTERNAL),g.on("drag",["Shift","Ctrl"],e=>this._handleDrag(e,-1),d.ViewEventPriorities.INTERNAL))}}]);
return a}(F);l.__decorate([A.property()],F.prototype,"navigation",void 0);l.__decorate([A.property()],F.prototype,"view",null);return F=l.__decorate([f.subclass("esri.views.2d.navigation.ZoomBox")],F)})},"esri/views/2d/navigation/actions/Pan":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator ../../../../geometry/Point".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p){F=function(q){function t(y){var w=q.call(this,y)||this;w.animationTime=0;w.momentumEstimator=new k.PanPlanarMomentumEstimator(500,6,.92);w.momentum=null;w.tmpMomentum=g.create();w.momentumFinished=!1;w.viewpoint=new D({targetGeometry:new p,scale:0,rotation:0});w._previousDrag=null;u.when(()=>w.momentumFinished,()=>w.navigation.stop());return w}n._inherits(t,q);var v=t.prototype;v.begin=function(y,w){this.navigation.begin();this.momentumEstimator.reset();
this.addToEstimator(w);this._previousDrag=w};v.update=function(y,w){this.addToEstimator(w);let z=w.center.x,r=w.center.y;const C=this._previousDrag;z=C?C.center.x-z:-z;r=C?r-C.center.y:r;y.viewpoint=e.translateBy(this.viewpoint,y.viewpoint,[z||0,r||0]);this._previousDrag=w};v.end=function(y,w){this.addToEstimator(w);this.momentum=y.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(y);this._previousDrag=null;this.navigation.end()};
v.addToEstimator=function(y){var w=y.center.x;const z=y.center.y,r=m.createScreenPointArray(-w,z);w=g.fromValues(-w,z,0);this.momentumEstimator.add(r,w,.001*y.timestamp)};v.onAnimationUpdate=function(y){this.navigation.animationManager?.animateContinous(y.viewpoint,(w,z)=>{const {momentum:r,animationTime:C,tmpMomentum:x}=this;var E=this.momentumFinished=!r||r.isFinished(C);z*=.001;E||(E=r.valueDelta(C,z),b.scale(x,r.direction,E),e.translateBy(w,w,x),y.constraints.constrainByGeometry(w));this.animationTime+=
z})};v.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())};return n._createClass(t)}(A);l.__decorate([h.property()],F.prototype,"momentumFinished",void 0);l.__decorate([h.property()],F.prototype,"viewpoint",void 0);l.__decorate([h.property()],F.prototype,"navigation",void 0);return F=l.__decorate([a.subclass("esri.views.2d.navigation.actions.Pan")],F)})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,l,F,D,A,u){let m=function(h){function f(d,c,a,b,g){d=h.call(this,d,c,a)||this;d._sceneVelocity=b;d.direction=g;return d}l._inherits(f,h);f.prototype.value=function(d){return l._get(l._getPrototypeOf(f.prototype),"valueFromInitialVelocity",this).call(this,this._sceneVelocity,d)};return l._createClass(f)}(u.Momentum);u=function(){function h(d=300,c=12,a=.84){this._minimumInitialVelocity=d;this._stopVelocity=c;this._friction=a;this.enabled=!0;this._time=new A.FilteredFiniteDifference(.6);
this._screen=[new A.FilteredFiniteDifference(.4),new A.FilteredFiniteDifference(.4)];this._scene=[new A.FilteredFiniteDifference(.6),new A.FilteredFiniteDifference(.6),new A.FilteredFiniteDifference(.6)];this._tmpDirection=D.create()}var f=h.prototype;f.add=function(d,c,a){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(a)||(this._screen[0].update(d[0]),this._screen[1].update(d[1]),this._scene[0].update(c[0]),this._scene[1].update(c[1]),this._scene[2].update(c[2]),this._time.update(a))};
f.reset=function(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()};f.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var d=this._screen[0].filteredDelta,c=this._screen[1].filteredDelta;d=null==d||null==c?0:Math.sqrt(d*d+c*c);c=this._time.filteredDelta;d=null==c||null==d?0:d/c;return Math.abs(d)<this._minimumInitialVelocity?null:this.createMomentum(d,
this._stopVelocity,this._friction)};f.createMomentum=function(d,c,a){F.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const b=F.length(this._tmpDirection);0<b&&F.scale(this._tmpDirection,this._tmpDirection,1/b);const g=this._time.filteredDelta;return new m(d,c,a,null==g?0:b/g,this._tmpDirection)};return l._createClass(h)}();n.PanPlanarMomentum=m;n.PanPlanarMomentumEstimator=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(u){this._gain=u;this.filteredDelta=this.lastValue=void 0}var A=D.prototype;A.update=function(u){if(this.hasLastValue()){const m=this.computeDelta(u);this._updateDelta(m)}this.lastValue=u};A.reset=function(){this.filteredDelta=this.lastValue=void 0};A.hasLastValue=function(){return void 0!==this.lastValue};A.hasFilteredDelta=function(){return void 0!==
this.filteredDelta};A.computeDelta=function(u){return void 0===this.lastValue?NaN:u-this.lastValue};A._updateDelta=function(u){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*u:u};return l._createClass(D)}();n.FilteredFiniteDifference=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(n,l){let F=function(){function D(u,m,h){this._initialVelocity=
u;this._stopVelocity=m;this._friction=h;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var A=D.prototype;A.isFinished=function(u){return u>this.duration};A.value=function(u){return this.valueFromInitialVelocity(this._initialVelocity,u)};A.valueDelta=function(u,m){const h=this.value(u);return this.value(u+m)-h};A.valueFromInitialVelocity=function(u,m){m=Math.min(m,this.duration);const h=1-this.friction;return u*(h**m-1)/Math.log(h)};
l._createClass(D,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return D}();n.Momentum=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator ../../../../geometry/Point".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p){F=function(q){function t(y){var w=q.call(this,y)||this;w._animationTime=0;w._momentumFinished=!1;w._previousAngle=0;w._previousRadius=0;w._previousCenter=null;w._rotationMomentumEstimator=new e.RotationMomentumEstimator(.6,.15,.95);w._rotationDirection=1;w._startAngle=0;w._startRadius=0;w._updateTimestamp=null;w._zoomDirection=1;w._zoomMomentumEstimator=new k.ZoomMomentumEstimator;w._zoomOnly=null;w.zoomMomentum=null;w.rotateMomentum=null;w.viewpoint=new D({targetGeometry:new p,
scale:0,rotation:0});w.addHandles(u.when(()=>w._momentumFinished,()=>w.navigation.stop()));return w}n._inherits(t,q);var v=t.prototype;v.begin=function(y,w){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=w.angle;this._previousRadius=this._startRadius=w.radius;this._previousCenter=w.center;this._updateTimestamp=null;y.constraints.rotationEnabled&&this.addToRotateEstimator(0,w.timestamp);this.addToZoomEstimator(w,
1)};v.update=function(y,w){null===this._updateTimestamp&&(this._updateTimestamp=w.timestamp);const z=w.angle,r=w.radius,C=w.center,x=Math.abs(180*(z-this._startAngle)/Math.PI),E=Math.abs(r-this._startRadius),B=this._startRadius/r;if(this._previousRadius&&this._previousCenter){const G=r/this._previousRadius;let H=180*(z-this._previousAngle)/Math.PI;this._rotationDirection=0<=H?1:-1;this._zoomDirection=1<=G?1:-1;y.constraints.rotationEnabled?(null===this._zoomOnly&&200<w.timestamp-this._updateTimestamp&&
(this._zoomOnly=0<E-x),null===this._zoomOnly||this._zoomOnly?H=0:this.addToRotateEstimator(z-this._startAngle,w.timestamp)):H=0;this.addToZoomEstimator(w,B);this.navigation.setViewpoint([C.x,C.y],1/G,H,[this._previousCenter.x-C.x,C.y-this._previousCenter.y])}this._previousAngle=z;this._previousRadius=r;this._previousCenter=C};v.end=function(y){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=
0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(y);this.navigation.end()};v.addToRotateEstimator=function(y,w){this._rotationMomentumEstimator.add(y,.001*w)};v.addToZoomEstimator=function(y,w){this._zoomMomentumEstimator.add(w,.001*y.timestamp)};v.canZoomIn=function(y){const w=y.scale;y=y.constraints.effectiveMaxScale;return 0===y||w>y};v.canZoomOut=function(y){const w=y.scale;y=y.constraints.effectiveMinScale;return 0===y||w<y};v.onAnimationUpdate=function(y){this.navigation.animationManager?.animateContinous(y.viewpoint,
(w,z)=>{var r=!this.canZoomIn(y)&&1<this._zoomDirection||!this.canZoomOut(y)&&1>this._zoomDirection,C=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime);r=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime);z*=.001;this._momentumFinished=C&&r;if(!this._momentumFinished){C=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,z))*this._rotationDirection*180/Math.PI:0;r=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,
z)):1;const E=b.create();var x=b.create();if(this._previousCenter){a.set(E,this._previousCenter.x,this._previousCenter.y);g.getPaddingScreenTranslation(x,y.size,y.padding);a.add(E,E,x);const {constraints:B,scale:G}=y;x=G*r;1>r&&!B.canZoomInTo(x)?(r=G/B.effectiveMaxScale,this.rotateMomentum=this.zoomMomentum=null):1<r&&!B.canZoomOutTo(x)&&(r=G/B.effectiveMinScale,this.rotateMomentum=this.zoomMomentum=null);g.scaleAndRotateBy(w,y.viewpoint,r,C,E,y.size);y.constraints.constrainByGeometry(w)}}this._animationTime+=
z})};v.stopMomentumNavigation=function(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()};return n._createClass(t)}(A);l.__decorate([m.property()],F.prototype,"_momentumFinished",void 0);l.__decorate([m.property()],F.prototype,"viewpoint",void 0);l.__decorate([m.property()],F.prototype,"navigation",void 0);return F=
l.__decorate([c.subclass("esri.views.2d.navigation.actions.Pinch")],F)})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(n,l,F){F=function(D){function A(u=3,m=.01,h=.95,f=12){return D.call(this,u,m,h,f)||this}l._inherits(A,D);A.prototype.add=function(u,m){const h=this.value.lastValue;if(null!=h){for(u-=h;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;u=h+u}l._get(l._getPrototypeOf(A.prototype),
"add",this).call(this,u,m)};return l._createClass(A)}(F.MomentumEstimator);n.RotationMomentumEstimator=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(n,l,F,D,A){let u=function(){function m(f=2.5,d=.01,c=.95,a=12){this._minimumInitialVelocity=f;this._stopVelocity=d;this._friction=c;this._maxVelocity=
a;this.enabled=!0;this.value=new D.FilteredFiniteDifference(.8);this.time=new D.FilteredFiniteDifference(.3)}var h=m.prototype;h.add=function(f,d){if(this.enabled&&null!=d){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta()){const c=this.value.computeDelta(f);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(d);this.value.update(f)}};h.reset=function(){this.value.reset();this.time.reset()};h.evaluateMomentum=function(){if(!this.enabled||
!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let f=this.value.filteredDelta/this.time.filteredDelta;f=F.clamp(f,-this._maxVelocity,this._maxVelocity);return Math.abs(f)<this._minimumInitialVelocity?null:this.createMomentum(f,this._stopVelocity,this._friction)};h.createMomentum=function(f,d,c){return new A.Momentum(f,d,c)};return l._createClass(m)}();n.MomentumEstimator=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(n,l,F,D){let A=function(u){function m(f,d,c){return u.call(this,f,d,c)||this}l._inherits(m,u);var h=m.prototype;h.value=function(f){f=l._get(l._getPrototypeOf(m.prototype),"value",this).call(this,f);return Math.exp(f)};h.valueDelta=function(f,d){const c=l._get(l._getPrototypeOf(m.prototype),"value",this).call(this,f);f=l._get(l._getPrototypeOf(m.prototype),"value",this).call(this,f+d);return Math.exp(f-c)};return l._createClass(m)}(F.Momentum);
F=function(u){function m(f=2.5,d=.01,c=.95,a=12){return u.call(this,f,d,c,a)||this}l._inherits(m,u);var h=m.prototype;h.add=function(f,d){l._get(l._getPrototypeOf(m.prototype),"add",this).call(this,Math.log(f),d)};h.createMomentum=function(f,d,c){return new A(f,d,c)};return l._createClass(m)}(D.MomentumEstimator);n.ZoomMomentum=A;n.ZoomMomentumEstimator=F;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Rotate":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../viewpointUtils ../../../../geometry/Point".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g){const e=a.create(),k=a.create();F=function(p){function q(v){v=p.call(this,v)||this;v._previousCenter=a.create();v.viewpoint=new D({targetGeometry:new g,scale:0,rotation:0});return v}n._inherits(q,p);var t=q.prototype;t.begin=function(v,y){this.navigation.begin();c.set(this._previousCenter,y.center.x,y.center.y)};t.update=function(v,y){const {state:{size:w,padding:z}}=v;c.set(e,y.center.x,y.center.y);b.getAnchor(k,w,z);v.viewpoint=b.rotateBy(this.viewpoint,v.state.paddedViewState.viewpoint,
b.angleBetween(k,this._previousCenter,e));c.copy(this._previousCenter,e)};t.end=function(){this.navigation.end()};return n._createClass(q)}(A);l.__decorate([u.property()],F.prototype,"viewpoint",void 0);l.__decorate([u.property()],F.prototype,"navigation",void 0);return F=l.__decorate([d.subclass("esri.views.2d.actions.Rotate")],F)})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/urlUtils ../../../chunks/mat3f32 ../engine/DisplayObject ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/enums ../engine/webgl/shaders/MagnifierPrograms ../../magnifier/resources ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/VertexArrayObject".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b,g,e,k,p,q,t){return function(v){function y(){var z=v.call(this)||this;z._handles=new D;z._resourcePixelRatio=1;z.visible=!1;return z}n._inherits(y,v);var w=y.prototype;w.destroy=function(){this._handles=u.destroyMaybe(this._handles);this._disposeRenderResources();this._resourcesTask=u.abortMaybe(this._resourcesTask)};w._createTransforms=function(){return{dvs:f.create()}};w.doRender=function(z){const r=z.context;if(!this._resourcesTask)this._reloadResources();else if(z.drawPhase===
a.WGLDrawPhase.MAP&&this._canRender()){this._updateResources(z);var C=this._magnifier;if(null!=C.position){var x=z.pixelRatio,E=C.size*x,B=Math.ceil(1/C.factor*E);this._readbackTexture.resize(B,B);var {size:G}=z.state;z=x*G[0];G=x*G[1];var H=.5*B,I=.5*B,J=A.clamp(x*C.position.x,H,z-H-1),L=A.clamp(G-x*C.position.y,I,G-I-1);r.setBlendingEnabled(!0);H=J-H;I=L-I;var K=this._readbackTexture;r.bindTexture(K,0);r.gl.copyTexImage2D(K.descriptor.target,0,K.descriptor.pixelFormat,H,I,B,B,0);B=(B=this.backgroundColor)?
[B.a*B.r/255,B.a*B.g/255,B.a*B.b/255,B.a]:[1,1,1,1];J=-1+(J+C.offset.x*x)/z*2;x=-1+(L-C.offset.y*x)/G*2;z=E/z*2;E=E/G*2;G=this._program;r.bindVAO(this._vertexArrayObject);r.bindTexture(this._overlayTexture,6);r.bindTexture(this._maskTexture,7);r.useProgram(G);G.setUniform4fv("u_background",B);G.setUniform1i("u_readbackTexture",0);G.setUniform1i("u_overlayTexture",6);G.setUniform1i("u_maskTexture",7);G.setUniform4f("u_drawPos",J,x,z,E);G.setUniform1i("u_maskEnabled",C.maskEnabled?1:0);G.setUniform1i("u_overlayEnabled",
C.overlayEnabled?1:0);r.setStencilTestEnabled(!1);r.setColorMask(!0,!0,!0,!0);r.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);r.bindVAO()}}};w._canRender=function(){return this.mask&&this.overlay&&null!=this._magnifier};w._reloadResources=function(){this._resourcesTask&&this._resourcesTask.abort();const z=null!=this._magnifier?this._magnifier.maskUrl:null,r=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=F.createTask(async C=>{const x=null==z||null==r?g.loadMagnifierResources(C):
null,E=null!=z?l(z,{responseType:"image",signal:C}).then(H=>H.data):x.then(H=>H.mask);C=null!=r?l(r,{responseType:"image",signal:C}).then(H=>H.data):x.then(H=>H.overlay);const [B,G]=await Promise.all([E,C]);this.mask=B;this.overlay=G;this._disposeRenderResources();this.requestRender()})};w._disposeRenderResources=function(){this._readbackTexture=u.disposeMaybe(this._readbackTexture);this._overlayTexture=u.disposeMaybe(this._overlayTexture);this._maskTexture=u.disposeMaybe(this._maskTexture);this._vertexArrayObject=
u.disposeMaybe(this._vertexArrayObject);this._program=u.disposeMaybe(this._program)};w._updateResources=function(z){z.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources();if(!this._readbackTexture){var r=z.context;this._resourcePixelRatio=z.pixelRatio;var C=Math.ceil(this._magnifier.size*z.pixelRatio);this._program=b.createMagnifierProgram(r);var x=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new t.VertexArrayObject(r,b.magnifierProgramTemplate.attributes,c.Pos2us,{geometry:e.BufferObject.createVertex(r,
k.Usage.STATIC_DRAW,x)});this.overlay.width=C;this.overlay.height=C;x=new q.TextureDescriptor;x.internalFormat=k.PixelFormat.RGBA;x.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=k.TextureSamplingMode.NEAREST;x.flipped=!0;x.preMultiplyAlpha=!h.isSVG(this.overlay.src)||!z.context.driverTest.svgPremultipliesAlpha.result;this._overlayTexture=new p.Texture(r,x,this.overlay);this.mask.width=C;this.mask.height=C;x.pixelFormat=x.internalFormat=k.PixelFormat.ALPHA;this._maskTexture=new p.Texture(r,
x,this.mask);z=1/this._magnifier.factor;x.pixelFormat=x.internalFormat=k.PixelFormat.RGBA;x.width=x.height=Math.ceil(z*C);x.samplingMode=k.TextureSamplingMode.LINEAR;x.flipped=!1;this._readbackTexture=new p.Texture(r,x)}};n._createClass(y,[{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(z){this._backgroundColor=z;this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(z){this._magnifier=z;this._handles.removeAll();this._handles.add([m.watch(()=>
z.version,()=>{this.visible=z.visible&&null!=z.position&&0<z.size;this.requestRender()},m.initial),m.watch(()=>[z.maskUrl,z.overlayUrl],()=>this._reloadResources()),m.watch(()=>z.size,()=>{this._disposeRenderResources();this.requestRender()})])}}]);return y}(d.DisplayObject)})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/ProgramTemplate"],function(n,l,F){const D={shaders:{vertexShader:l.resolveIncludes("magnifier/magnifier.vert"),
fragmentShader:l.resolveIncludes("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};n.createMagnifierProgram=function(A){return F.createProgram(A,D)};n.magnifierProgramTemplate=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(n,l,F,D){const A=u=>Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}));
l.loadMagnifierResources=async function(u){var m=new Promise((f,d)=>n(["./mask-svg"],c=>f(A(c)),d)),h=new Promise((f,d)=>n(["./overlay-svg"],c=>f(A(c)),d));m=D.requestImage((await m).default,{signal:u});h=D.requestImage((await h).default,{signal:u});h={mask:await m,overlay:await h};F.throwIfAborted(u);return h};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(n,l){n.requestImage=async function(F,D){({data:F}=
await l(F,{responseType:"image",...D}));return F};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports","../../../chunks/mat4"],function(n,l){n.mat4=l.mat4;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","../../../chunks/mat4f32"],function(n,l){n.mat4f32=l.mat4f32;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports",
"../../../chunks/vec3f32"],function(n,l){n.vec3f32=l.vec3f32;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports","../../../chunks/vec4f32"],function(n,l){n.vec4f32=l.vec4f32;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/contextUtils ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(n,l,F,D,A,u,m,h,f,d,c,a,b){function g(p){return p&&"render"in p}function e(p){const q=document.createElement("canvas");q.width=p.width;q.height=p.height;p.render(q.getContext("2d"));return q}function k(p){return g(p)?p instanceof f?F.applySome(p.getRenderedRasterPixels(),q=>q.renderedRasterPixels):e(p):p}h=function(p){function q(v=null,y=!1){var w=p.call(this)||this;w.blendFunction="standard";w._sourceWidth=0;w._sourceHeight=0;w._textureInvalidated=!1;w._texture=null;w.stencilRef=0;w.coordScale=
[1,1];w._height=void 0;w.pixelRatio=1;w.resolution=0;w.rotation=0;w._source=null;w._width=void 0;w.x=0;w.y=0;w.immutable=y;w.source=v;w.requestRender=w.requestRender.bind(l._assertThisInitialized(w));return w}l._inherits(q,p);var t=q.prototype;t.destroy=function(){this._texture&&(this._texture.dispose(),this._texture=null);null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)};t.beforeRender=function(v){l._get(l._getPrototypeOf(q.prototype),"beforeRender",this).call(this,
v);this.updateTexture(v)};t.setSourceAsync=async function(v,y){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const w=new AbortController,z=D.createResolver();D.onAbortOrThrow(y,()=>w.abort());D.onAbortOrThrow(w,r=>z.reject(r));this._uploadStatus={controller:w,resolver:z};this.source=v;return z.promise};t.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=
this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))};t.updateTransitionProperties=function(v,y){64<=v&&(this.inFadeTransition=this.fadeTransitionEnabled=!1);l._get(l._getPrototypeOf(q.prototype),"updateTransitionProperties",this).call(this,v,y)};t.setTransform=function(v){const y=A.identity(this.transforms.dvs),[w,z]=v.toScreenNoRotation([0,0],[this.x,this.y]);var r=this.resolution/this.pixelRatio/v.resolution;const C=r*this.width;
r*=this.height;const x=Math.PI*this.rotation/180;A.translate(y,y,m.fromValues(w,z));A.translate(y,y,m.fromValues(C/2,r/2));A.rotate(y,y,-x);A.translate(y,y,m.fromValues(-C/2,-r/2));A.scaleByVec2(y,y,m.fromValues(C,r));A.multiply(this.transforms.dvs,v.displayViewMat3,y)};t.setSamplingProfile=function(v){this._texture&&(v.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(v.samplingMode))};t.bind=function(v,y){this._texture&&v.bindTexture(this._texture,
y)};t.updateTexture=async function({context:v,painter:y}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(v)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);v=k(this.source);try{if(null!=this._uploadStatus){const {controller:w,resolver:z}=this._uploadStatus,r={signal:w.signal},{width:C,height:x}=this;await y.textureUploadManager.enqueueTextureUpdate({data:v,texture:this._texture,width:C,height:x},r);z.resolve();
this._uploadStatus=null}else this._texture.setData(v);this.ready()}catch(w){D.throwIfNotAbortError(w)}}else this._texture.setData(null)};t.onDetach=function(){this.destroy()};t._createTransforms=function(){return{dvs:u.create()}};t._createTexture=function(v){const y=this.immutable&&v.type===d.ContextType.WEBGL2,w=new b.TextureDescriptor;w.internalFormat=y?c.SizedPixelFormat.RGBA8:c.PixelFormat.RGBA;w.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;w.isImmutable=y;w.width=this._sourceWidth;w.height=this._sourceHeight;
return new a.Texture(v,w)};l._createClass(q,[{key:"isSourceScaled",get:function(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this._sourceHeight},set:function(v){this._height=v}},{key:"source",get:function(){return this._source},set:function(v){if(null!=v||null!=this._source)this._source=v,this.invalidateTexture(),this.requestRender()}},{key:"width",get:function(){return void 0!==this._width?this._width:
this._sourceWidth},set:function(v){this._width=v}}]);return q}(h.DisplayObject);n.Bitmap=h;n.isImageSource=g;n.rasterize=e;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(n){return function(){function l(D,A,u){this.pixelBlock=D;this.extent=A;this.originalPixelBlock=u}var F=l.prototype;F.render=function(D){var A=this.pixelBlock;if(null!=A){var u=this.filter({extent:this.extent,
pixelBlock:this.originalPixelBlock??A});null!=u.pixelBlock&&(u.pixelBlock.maskIsAlpha&&(u.pixelBlock.premultiplyAlpha=!0),A=u.pixelBlock.getAsRGBA(),u=D.createImageData(u.pixelBlock.width,u.pixelBlock.height),u.data.set(A),D.putImageData(u,0,0))}};F.getRenderedRasterPixels=function(){const D=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});if(null==D.pixelBlock)return null;D.pixelBlock.maskIsAlpha&&(D.pixelBlock.premultiplyAlpha=!0);return{width:D.pixelBlock.width,height:D.pixelBlock.height,
renderedRasterPixels:new Uint8Array(D.pixelBlock.getAsRGBA().buffer)}};n._createClass(l,[{key:"width",get:function(){return null!=this.pixelBlock?this.pixelBlock.width:0}},{key:"height",get:function(){return null!=this.pixelBlock?this.pixelBlock.height:0}}]);return l}()})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./brushes","./webgl/enums","./webgl/WGLContainer"],function(n,l,F,D,A){A=function(u){function m(){var f=u.apply(this,
arguments)||this;f._hasCrossfade=!1;return f}l._inherits(m,u);var h=m.prototype;h.beforeRender=function(f){l._get(l._getPrototypeOf(m.prototype),"beforeRender",this).call(this,f);this._manageFade()};h.prepareRenderPasses=function(f){const d=f.registerRenderPass({name:"bitmap",brushes:[F.brushes.bitmap],target:()=>this.children,drawPhase:D.WGLDrawPhase.MAP});return[...l._get(l._getPrototypeOf(m.prototype),"prepareRenderPasses",this).call(this,f),d]};h._manageFade=function(){2<=this.children.reduce((f,
d)=>f+(d.inFadeTransition?1:0),0)?(this.children.forEach(f=>f.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(f=>f.blendFunction="standard"),this._hasCrossfade=!1)};l._createClass(m,[{key:"requiresDedicatedFBO",get:function(){return this._hasCrossfade}}]);return m}(A);n.BitmapContainer=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat3f32",
"./Bitmap","./webgl/TiledDisplayObject"],function(n,l,F,D,A){A=function(u){function m(f,d,c,a,b,g,e=null){var k=u.call(this,f,d,c,a,b,g)||this;k.bitmap=new D.Bitmap(e);k.bitmap.coordScale=[b,g];k.bitmap.once("isReady",()=>k.ready());return k}l._inherits(m,u);var h=m.prototype;h.destroy=function(){l._get(l._getPrototypeOf(m.prototype),"destroy",this).call(this);this.bitmap.destroy()};h.beforeRender=function(f){l._get(l._getPrototypeOf(m.prototype),"beforeRender",this).call(this,f);this.bitmap.beforeRender(f)};
h.afterRender=function(f){l._get(l._getPrototypeOf(m.prototype),"afterRender",this).call(this,f);this.bitmap.afterRender(f)};h._createTransforms=function(){return{dvs:F.create(),tileMat3:F.create()}};h.setTransform=function(f){l._get(l._getPrototypeOf(m.prototype),"setTransform",this).call(this,f);this.bitmap.transforms.dvs=this.transforms.dvs};h.onAttach=function(){this.bitmap.stage=this.stage};h.onDetach=function(){this.bitmap&&(this.bitmap.stage=null)};l._createClass(m,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},
set:function(f){this.bitmap.stencilRef=f}}]);return m}(A.TiledDisplayObject);n.BitmapTile=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./BitmapTile ./brushes ./webgl/enums ./webgl/TileContainer".split(" "),function(n,l,F,D,A,u,m){m=function(h){function f(){return h.apply(this,arguments)||this}l._inherits(f,h);var d=f.prototype;
d.createTile=function(c){const a=this._tileInfoView.getTileBounds(F.create(),c),b=this._tileInfoView.getTileResolution(c.level),[g,e]=this._tileInfoView.tileInfo.size;return new D.BitmapTile(c,b,a[0],a[3],g,e)};d.prepareRenderPasses=function(c){const a=c.registerRenderPass({name:"bitmap (tile)",brushes:[A.brushes.bitmap],target:()=>this.children.map(b=>b.bitmap),drawPhase:u.WGLDrawPhase.MAP});return[...l._get(l._getPrototypeOf(f.prototype),"prepareRenderPasses",this).call(this,c),a]};d.doRender=function(c){this.visible&&
c.drawPhase===u.WGLDrawPhase.MAP&&l._get(l._getPrototypeOf(f.prototype),"doRender",this).call(this,c)};l._createClass(f,[{key:"requiresDedicatedFBO",get:function(){return this.children.some(c=>"additive"===c.bitmap.blendFunction)}}]);return f}(m);n.BitmapTileContainer=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("exports ./engine/Stage ./LabelManager ./layers/graphics/GraphicsView2D ./layers/graphics/GraphicContainer ./navigation/MapViewNavigation ./magnifier/MagnifierView2D".split(" "),function(n,l,F,D,A,u,m){n.Stage=l.Stage;Object.defineProperty(n,"LabelManager",{enumerable:!0,get:()=>F.LabelManager});n.GraphicsView2D=D;n.GraphicContainer=A;n.MapViewNavigation=u;n.MagnifierView2D=m;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});