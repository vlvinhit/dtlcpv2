// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/arrayUtils ./core/has ./core/accessorSupport/decorators/subclass".split(" "),function(z,n,p,q,t,w,h,r){p=function(k){function m(){var e=k.apply(this,arguments)||this;e.isAggregate=!0;return e}z._inherits(m,k);var d=m.prototype;d.getEffectivePopupTemplate=function(e){return this.popupTemplate?this.popupTemplate:
(e=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null};d.getObjectId=function(){return this.attributes.aggregateId};return z._createClass(m)}(p);n.__decorate([q.property({type:Boolean})],p.prototype,"isAggregate",void 0);return p=n.__decorate([r.subclass("esri.AggregateGraphic")],p)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),
function(z,n,p,q,t,w,h,r,k){p=function(m){function d(g){var c=m.call(this,g)||this;c._filter=null;c.duration=q("mapview-transitions-duration");c._excludedEffectView=new k.EffectView(g);c._includedEffectView=new k.EffectView(g);return c}z._inherits(d,m);var e=d.prototype;e.transitionStep=function(g,c){this._set("scale",c);this.transitioning?(this._includedEffectView.transitionStep(g,c),this._excludedEffectView.transitionStep(g,c),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=
c,this._includedEffectView.scale=c)};e.endTransitions=function(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();this._filter=null};e._transitionTo=function(g){const c=this._get("featureEffect"),b=g?.includedEffect,l=g?.excludedEffect,u=this._includedEffectView.canTransitionTo(b)&&this._excludedEffectView.canTransitionTo(l);this._includedEffectView.effect=b;this._excludedEffectView.effect=l;this._set("featureEffect",g);this._filter=g?.filter||c?.filter||null;u||
this.endTransitions()};z._createClass(d,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(g){this._get("featureEffect")!==g&&this._transitionTo(g)}},{key:"filter",get:function(){return this._filter||this.featureEffect?.filter||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",
set:function(g){this._set("scale",g);this._excludedEffectView.scale=g;this._includedEffectView.scale=g}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}}]);return d}(p);n.__decorate([t.property()],p.prototype,"_filter",void 0);n.__decorate([t.property()],p.prototype,"_excludedEffectView",void 0);n.__decorate([t.property()],p.prototype,"_includedEffectView",void 0);n.__decorate([t.property()],p.prototype,"duration",void 0);
n.__decorate([t.property()],p.prototype,"excludedEffects",null);n.__decorate([t.property()],p.prototype,"featureEffect",null);n.__decorate([t.property()],p.prototype,"filter",null);n.__decorate([t.property()],p.prototype,"hasEffects",null);n.__decorate([t.property()],p.prototype,"includedEffects",null);n.__decorate([t.property({value:0})],p.prototype,"scale",null);n.__decorate([t.property()],p.prototype,"transitioning",null);return p=n.__decorate([r.subclass("esri.layers.effects.FeatureEffectView")],
p)})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(z,n,p,q,t,w,h,r,k,m,d,e){q=function(g){function c(){var b=
g.apply(this,arguments)||this;b.features=[];return b}z._inherits(c,g);c.prototype.readFeatures=function(b,l){l=e.fromJSON(l.spatialReference);const u=[];for(let G=0;G<b.length;G++){var A=b[G];const v=p.fromJSON(A);var B=A.geometry&&A.geometry.spatialReference;null==v.geometry||B||(v.geometry.spatialReference=l);A=A.aggregateGeometries;B=v.aggregateGeometries;if(A&&null!=B)for(const H in B){const E=B[H],F=A[H]?.spatialReference;null==E||F||(E.spatialReference=l)}u.push(v)}return u};return z._createClass(c)}(d);
n.__decorate([t.property({type:[p],json:{write:!0}})],q.prototype,"features",void 0);n.__decorate([k.reader("features")],q.prototype,"readFeatures",null);return q=n.__decorate([m.subclass("esri.rest.support.AggregateFeatureSet")],q)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g,c,b,l,u){const A=q.ofType({key:"type",base:null,typeMap:{rect:b,path:u,geometry:l}});z.LayerView2DMixin=B=>{B=function(G){function v(){var E=G.apply(this,arguments)||this;E.attached=!1;E.clips=new A;E.lastUpdateId=-1;E.moving=!1;E.updateRequested=!1;E.visibleAtCurrentScale=!1;E.highlightOptions=null;return E}n._inherits(v,G);var H=v.prototype;H.initialize=function(){const E=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&E&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new w("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new g.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([h.watch(()=>this.suspended,F=>{this.container&&(this.container.visible=!F);this.view&&!F&&this.updateRequested&&this.view.requestUpdate()},h.syncAndInitial),
h.watch(()=>this.layer?.opacity??1,F=>{this.container&&(this.container.opacity=F)},h.syncAndInitial),h.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",F=>{this.container&&(this.container.blendMode=F)},h.syncAndInitial),h.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,F=>{this.container&&(this.container.effect=F)},h.syncAndInitial),h.watch(()=>this.highlightOptions,F=>this.container.highlightOptions=F,h.syncAndInitial),h.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},h.syncAndInitial),h.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:F})=>{F=null!=F?this.isVisibleAtScale(F):!1;F!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",F)},h.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(F=>{F===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};H.destroy=function(){this.processDetach();this.updateRequested=!1};H.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};H.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};H.isVisibleAtScale=function(E){const F=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!F)return!0;
const {minScale:x,maxScale:C}=F;return(0===x||E<=x)&&(0===C||E>=C)};H.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};H.processUpdate=function(E){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",E),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(E)))};H.hitTest=function(E,F){return Promise.resolve(null)};H.supportsSpatialReference=function(E){return!0};
H.canResume=function(){return this.spatialReferenceSupported?n._get(n._getPrototypeOf(v.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};H.getSuspendInfo=function(){const E=n._get(n._getPrototypeOf(v.prototype),"getSuspendInfo",this).call(this),F=!this.spatialReferenceSupported,x=this.visibleAtCurrentScale;F&&(E.spatialReferenceNotSupported=F);x&&(E.outsideScaleRange=x);return E};H.addAttachHandles=function(E){this.addHandles(E,"attach")};n._createClass(v,[{key:"spatialReferenceSupported",
get:function(){const E=this.view?.spatialReference;return null==E||this.supportsSpatialReference(E)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return v}(B);p.__decorate([r.property()],B.prototype,"attached",void 0);p.__decorate([r.property({type:A,set(G){G=t.referenceSetter(G,this._get("clips"),A);this._set("clips",G)}})],B.prototype,"clips",void 0);p.__decorate([r.property()],
B.prototype,"container",void 0);p.__decorate([r.property()],B.prototype,"moving",void 0);p.__decorate([r.property({readOnly:!0})],B.prototype,"spatialReferenceSupported",null);p.__decorate([r.property({readOnly:!0})],B.prototype,"updateParameters",void 0);p.__decorate([r.property()],B.prototype,"updateRequested",void 0);p.__decorate([r.property()],B.prototype,"updating",null);p.__decorate([r.property()],B.prototype,"view",void 0);p.__decorate([r.property({readOnly:!0})],B.prototype,"visibleAtCurrentScale",
void 0);p.__decorate([r.property({type:c})],B.prototype,"highlightOptions",void 0);return B=p.__decorate([e.subclass("esri.views.2d.layers.LayerView2D")],B)};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(z,n,p,q,t,w,h,r){var k;q=k=function(m){function d(g){g=m.call(this,g)||this;g.type="rect";g.left=null;g.right=null;g.top=null;g.bottom=null;return g}z._inherits(d,m);var e=d.prototype;e.clone=function(){return new k({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};e.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return z._createClass(d)}(r);n.__decorate([p.property({type:[Number,
String],json:{write:!0}})],q.prototype,"left",void 0);n.__decorate([p.property({type:[Number,String],json:{write:!0}})],q.prototype,"right",void 0);n.__decorate([p.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);n.__decorate([p.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);return q=k=n.__decorate([h.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(z,n,p,q,t,w,h,r){p=function(k){function m(){return k.apply(this,arguments)||this}z._inherits(m,k);z._createClass(m,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return m}(p.JSONSupport);n.__decorate([q.property({readOnly:!0})],p.prototype,"version",null);return p=n.__decorate([r.subclass("esri.views.layers.support.ClipArea")],p)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g){var c;p={base:k,key:"type",typeMap:{extent:e,polygon:g}};d=c=function(b){function l(A){A=b.call(this,A)||this;A.type="geometry";A.geometry=null;return A}z._inherits(l,b);var u=l.prototype;u.clone=function(){return new c({geometry:this.geometry?.clone()??null})};u.commitVersionProperties=function(){this.commitProperty("geometry")};return z._createClass(l)}(d);n.__decorate([q.property({types:p,json:{read:m.fromJSON,write:!0}})],d.prototype,"geometry",void 0);return d=
c=n.__decorate([r.subclass("esri.views.layers.support.Geometry")],d)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(z,n,p,q,t,w,h,r){q=function(k){function m(d){d=k.call(this,d)||this;d.type="path";d.path=[];return d}
z._inherits(m,k);m.prototype.commitVersionProperties=function(){this.commitProperty("path")};return z._createClass(m)}(r);n.__decorate([p.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);return q=n.__decorate([h.subclass("esri.views.layers.support.Path")],q)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["exports","./tileRenderers/HeatmapTileRenderer","./tileRenderers/SymbolTileRenderer"],function(z,n,p){z.createOrReuseTileRenderer=function(q,t){if(!q)return null;
switch(q.type){case "symbol":return new p.SymbolTileRenderer(t);case "heatmap":return new n.HeatmapTileRenderer(t)}};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/HeatmapTileRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g){z.HeatmapTileRenderer=function(c){function b(u){var A=c.call(this,u)||this;A._intensityInfo={minDensity:0,maxDensity:0};A.type="heatmap";A.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}};A._container=new d.BitmapTileContainer(u.tileInfoView);return A}n._inherits(b,c);var l=b.prototype;l.createTile=function(u){const A=this._container.createTile(u);this.tileInfoView.getTileCoords(A.bitmap,u);A.bitmap.resolution=this.tileInfoView.getTileResolution(u);
return A};l.onConfigUpdate=function(){const u=this.layer.renderer;if("heatmap"===u.type){const {minDensity:A,maxDensity:B,colorStops:G}=u;this._intensityInfo.minDensity=A;this._intensityInfo.maxDensity=B;this._gradient=m.generateGradient(G);this.tiles.forEach(v=>{const H=v.bitmap.source;H&&(H.minDensity=A,H.maxDensity=B,H.gradient=this._gradient,v.bitmap.invalidateTexture(),v.bitmap.requestRender())})}};l.hitTest=function(){return Promise.resolve([])};l.install=function(u){u.addChild(this._container)};
l.uninstall=function(u){this._container.removeAllChildren();u.removeChild(this._container)};l.disposeTile=function(u){this._container.removeChild(u);u.destroy()};l.supportsRenderer=function(u){return u&&"heatmap"===u.type};l.onTileData=function(u){const A=this.tiles.get(u.tileKey);if(A){u=u.intensityInfo;var {minDensity:B,maxDensity:G}=this._intensityInfo,v=A.bitmap.source||new g.HeatmapSource;v.intensities=u&&u.matrix||null;v.minDensity=B;v.maxDensity=G;v.gradient=this._gradient;A.bitmap.source=
v;this._container.addChild(A);this._container.requestRender();this.requestUpdate()}};l.onTileError=function(u){console.error(u)};l.lockGPUUploads=function(){};l.unlockGPUUploads=function(){};l.fetchResource=function(u,A){console.error(u);return Promise.reject()};return n._createClass(b)}(e);z.HeatmapTileRenderer=p.__decorate([k.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],z.HeatmapTileRenderer);Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/has ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(z,n,p,q,t,w,h,r){p=function(k){function m(e){e=k.call(this,e)||this;e.tiles=new Map;return e}z._inherits(m,k);var d=m.prototype;d.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};d.acquireTile=function(e){const g=this.createTile(e);g.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(e.id,g);this.notifyChange("updating");return g};d.forceAttributeTextureUpload=function(){};d.forEachTile=function(e){this.tiles.forEach(e)};d.releaseTile=
function(e){this.tiles.delete(e.key.id);this.notifyChange("updating");this.disposeTile(e)};d.isUpdating=function(){let e=!0;this.tiles.forEach(c=>{e=e&&c.isReady});const g=!e;if(q("esri-2d-log-updating")){let c="";this.tiles.forEach(b=>{c+=`-> ${b.key.id}: isReady: ${b.isReady} status: ${b.updateStatus}\n`;e=e&&b.isReady});console.log(`Updating BaseTileRenderer ${g}\n${c}`)}return g};d.setHighlight=function(){};d.invalidateLabels=function(){};d.requestUpdate=function(){this.layerView.requestUpdate()};
z._createClass(m,[{key:"updating",get:function(){return this.isUpdating()}}]);return m}(p.HandleOwner);n.__decorate([t.property()],p.prototype,"layer",void 0);n.__decorate([t.property()],p.prototype,"layerView",void 0);n.__decorate([t.property()],p.prototype,"tileInfoView",void 0);n.__decorate([t.property()],p.prototype,"updating",null);return p=n.__decorate([r.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],p)})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["exports",
"../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../renderers/support/heatmapUtils"],function(z,n,p){let q=function(){function t(){this.gradient=null;this.height=512;this.intensities=null;this.width=512}t.prototype.render=function(w){p.drawHeatmap(w,512,this.intensities,this.gradient,this.minDensity,this.maxDensity)};return n._createClass(t)}();z.HeatmapSource=q;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/SymbolTileRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g,c,b,l,u){z.SymbolTileRenderer=function(A){function B(){var v=A.apply(this,arguments)||this;v.type="symbol";return v}n._inherits(B,A);var G=B.prototype;G.install=function(v){const H=new u.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=H;v.addChild(H)};G.uninstall=function(v){v.removeChild(this.featuresView);this.featuresView=t.destroyMaybe(this.featuresView)};G.fetchResource=function(v,H){({url:v}=v);
const E=this.featuresView.stage;try{return E.resourceManager.fetchResource(v,{signal:H.signal})}catch(F){return w.isAbortError(F)?Promise.resolve({width:0,height:0}):Promise.reject(F)}};G.isUpdating=function(){const v=n._get(n._getPrototypeOf(B.prototype),"isUpdating",this).call(this),H=!this.featuresView||this.featuresView.isUpdating();var E=this.featuresView?.hasEmptyAttributeView();E=v||H||v&&E;q("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${E}\n  -> updatingTiles ${v}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${H}`);
return E};G.hitTest=function(v){return this.featuresView.hitTest(v)};G.supportsRenderer=function(v){return null!=v&&"simple class-breaks unique-value dot-density dictionary heatmap pie-chart".split(" ").includes(v.type)};G.onConfigUpdate=function(v){var H=null;v&&"visualVariables"in v&&(H=(c.simplifyVVRenderer(v).visualVariables||[]).map(E=>{const F=E.clone();"normalizationField"in E&&(F.normalizationField=null);E.valueExpression&&"$view.scale"!==E.valueExpression&&(F.valueExpression=null,F.field=
"nop");return F}),H=l.convertVisualVariables(H));this.featuresView.setRendererInfo(v,H,this.layerView.featureEffect)};G.onTileData=function(v){const H=this.tiles.get(v.tileKey);if(H&&v.data)this.featuresView.onTileData(H,v.data);this.layerView.view.labelManager.requestUpdate()};G.onTileError=function(v){if(v=this.tiles.get(v.tileKey))this.featuresView.onTileError(v)};G.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()};G.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload();
this.tiles.forEach(v=>v.lock())};G.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(v=>v.unlock())};G.getMaterialItems=async function(v){return this.featuresView.getMaterialItems(v)};G.invalidateLabels=function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()};G.createTile=function(v){const H=this.tileInfoView.getTileBounds(e.create(),v),E=this.tileInfoView.getTileResolution(v.level);return new g.FeatureTile(v,E,H[0],
H[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())};G.disposeTile=function(v){this.featuresView.removeChild(v);v.destroy();this.layerView.view.labelManager.requestUpdate()};return n._createClass(B)}(b);z.SymbolTileRenderer=p.__decorate([d.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],z.SymbolTileRenderer);Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/CircularArray ../../../../core/has ../../../../chunks/mat2df32 ./enums ./Utils ./WGLTile ./collisions/MetricReader ./cpuMapped/Geometry".split(" "),
function(z,n,p,q,t,w,h,r,k,m){let d=0;r=function(e){function g(b,l,u,A,B,G){b=e.call(this,b,l,u,A)||this;b.instanceId=d++;b.patchCount=0;b._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1};b._patches=new p(100);b._bufferPatches=new p(100);b._lastCommitTime=0;b.transforms.labelMat2d=t.create();b._store=B;b._requestLabelUpdate=G;return b}n._inherits(g,e);var c=g.prototype;c.destroy=function(){n._get(n._getPrototypeOf(g.prototype),"destroy",this).call(this);
this._renderState.current.geometry.forEach(b=>b.destroy());null!=this._renderState.next&&this._renderState.next.geometry.forEach(b=>b.destroy());this._renderState.current=null;this._renderState.next=null};c.getGeometry=function(b){return this._renderState.current.geometry.get(b)};c.patch=function(b,l){this.patchCount++;b.clear&&50<=this._patches.size&&this._dropPatches();const u=b.addOrUpdate&&this.key.id!==b.addOrUpdate.tileKeyOrigin;l&&u?this._bufferPatches.enqueue(b):(b.sort=b.sort&&!l,this._patches.enqueue(b));
this.requestRender()};c.commit=function(b){if(this._lastCommitTime!==b.time){this._lastCommitTime=b.time;for(b=0;4>b;b++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}};c.lock=function(){this._renderState.locked=!0};c.unlock=function(){this._renderState.locked=!1;this._flushUpdates();this._swap()};c._swapRenderStates=function(){this._renderState.next&&(this._renderState.locked?(this._renderState.swap=!0,this.requestRender()):
(this._renderState.swap=!0,this._swap()))};c._swap=function(){this._renderState.swap&&(this._renderState.swap=!1,null!=this._renderState.next&&(this._renderState.current.geometry.forEach(b=>b.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))};c._flushUpdates=function(){let b=this._patches.maxSize;for(;this._patches.size&&b--;)this._updateMesh(),this._swap()};c._updateBufferMesh=function(){var b=this._bufferPatches.peek();if(null==
b||!b.clear||null===this._renderState.next)for(;this._bufferPatches.size;)b=this._bufferPatches.dequeue(),null!=b&&this._patchBuffer(b)};c._updateMesh=function(){const b=this._patches.dequeue();if(null!=b){if(q("esri-2d-update-debug")){var l=b.addOrUpdate?.tileKeyOrigin;l=this.key.id===l?"SELF":l;let u="";for(let A=0;5>A;A++)u+=b.addOrUpdate?.data[A]?.records?.byteLength?1:0;console.debug(this.key.id,"FeatureTile:patch",`[clear: ${b.clear} origin: ${l}, end:${b.end} data:${u}]`)}!0===b.clear&&(null!=
this._renderState.next&&(this._renderState.next.geometry.forEach(u=>u.destroy()),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},q("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState"));this.requestRender();this._patch(b);b.end&&(q("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}};c._patch=function(b){h.forEachGeometryType(l=>
{this._remove(l,b.remove);this._insert(l,b,!1)})};c._patchBuffer=function(b){h.forEachGeometryType(l=>{this._insert(l,b,!0)})};c._insert=function(b,l,u){try{const A=l.addOrUpdate?.data[b],B=(this._renderState.next??this._renderState.current).geometry;null!=A&&(B.has(b)||(q("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Creating geometry buffer ${b}`),B.set(b,new m.Geometry(b,this.stage))),q("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Inserting into ${b}, version=${l.addOrUpdate?.version} stride=${A.stride}`),
B.get(b).insert(A,l.sort,u),b===w.WGLGeometryType.LABEL&&this._insertLabelMetrics(l.type,A.metrics,l.clear))}catch(A){}};c._insertLabelMetrics=function(b,l,u){u=this._renderState.next??this._renderState.current;if(null!=l)if(l=k.MetricReader.from(l),null==u.metrics)u.metrics=l;else{if("update"===b)for(b=l.getCursor();b.next();)u.metrics.delete(b.id);u.metrics.link(l)}};c._remove=function(b,l){b=(this._renderState.next??this._renderState.current).geometry.get(b);l&&l.length&&b&&(b.remove(l),this._removeLabelMetrics(l))};
c._removeLabelMetrics=function(b){const {metrics:l}=this._renderState.next??this._renderState.current;if(null!=l&&b.length)for(const u of b)for(;l.delete(u););};c._dropPatches=function(){const b=[];let l=!1;for(;this._patches.size;){const u=this._patches.dequeue();if(null==u)break;if(u.clear){if(l)break;l=!0}b.push(u)}this._patches.clear();b.forEach(u=>this._patches.enqueue(u))};n._createClass(g,[{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},
{key:"updateStatus",get:function(){return`renderState:${!!this._renderState.current}, ${!!this._renderState.next}, hasData:${this.hasData}, queue:${this._patches.size}`}}]);return g}(r.WGLTile);z.FeatureTile=r;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/MetricReader":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(z,n){let p=function(){function t(h){this._savedOffset=this._savedCursor=null;this._cursor=
this._head=h}t.from=function(h){h=q.from(new Float32Array(h));return new t(h)};var w=t.prototype;w.computedMinZoom=function(){return this._cursor.computedMinZoom()};w.setComputedMinZoom=function(h){return this._cursor.setComputedMinZoom(h)};w.boundsComputedAnchorX=function(h){return this._cursor.boundsComputedAnchorX(h)};w.boundsComputedAnchorY=function(h){return this._cursor.boundsComputedAnchorY(h)};w.setBoundsComputedAnchorX=function(h,r){return this._cursor.setBoundsComputedAnchorX(h,r)};w.setBoundsComputedAnchorY=
function(h,r){return this._cursor.setBoundsComputedAnchorY(h,r)};w.boundsX=function(h){return this._cursor.boundsX(h)};w.boundsY=function(h){return this._cursor.boundsY(h)};w.boundsWidth=function(h){return this._cursor.boundsWidth(h)};w.boundsHeight=function(h){return this._cursor.boundsHeight(h)};w.link=function(h){if(null!=h._head)return this._cursor.link(h._head)};w.getCursor=function(){return this.copy()};w.copy=function(){const h=new t(this._head?.copy());if(!h._head)return h;let r=h._head,k=
h._head._link;for(;k;)r._link=k.copy(),r=k,k=r._link;return h};w.peekId=function(){return this._cursor.peekId()??this._cursor._link.peekId()};w.nextId=function(){const h=this.id;for(;h===this.id;)if(!this.next())return!1;return!0};w.save=function(){this._savedCursor=this._cursor;this._savedOffset=this._cursor._offset};w.restore=function(){this._savedCursor&&(this._cursor=this._savedCursor);null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)};w.next=function(){if(!this._cursor)return!1;
if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;this._cursor._offset=0}return!0};w.lookup=function(h){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(h);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor};w.delete=function(h){let r=this._head,k=null;for(;r;){if(r.delete(h))return r.isEmpty()&&null!=k&&(k._link=r._link),!0;k=r;r=r._link}return!1};n._createClass(t,[{key:"id",get:function(){return this._cursor.id}},
{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}}]);
return t}(),q=function(){function t(h){this._offset=-1;this._link=null;this._deletedCount=this._count=0;this._offsets={instance:null};this._buffer=h}t.from=function(h){return new t(new Float32Array(h))};var w=t.prototype;w.isEmpty=function(){return this._deletedCount===this.count};w.computedMinZoom=function(){return this._buffer[this._offset+8]};w.setComputedMinZoom=function(h){this._buffer[this._offset+8]=h};w.boundsComputedAnchorX=function(h){return this._buffer[this._offset+10+6*h]};w.boundsComputedAnchorY=
function(h){return this._buffer[this._offset+10+6*h+1]};w.setBoundsComputedAnchorX=function(h,r){this._buffer[this._offset+10+6*h]=r};w.setBoundsComputedAnchorY=function(h,r){this._buffer[this._offset+10+6*h+1]=r};w.boundsX=function(h){return this._buffer[this._offset+10+6*h+2]};w.boundsY=function(h){return this._buffer[this._offset+10+6*h+3]};w.boundsWidth=function(h){return this._buffer[this._offset+10+6*h+4]};w.boundsHeight=function(h){return this._buffer[this._offset+10+6*h+5]};w.link=function(h){let r=
this;for(;r._link;)r=r._link;r._link=h};w.getCursor=function(){return this.copy()};w.copy=function(){const h=new t(this._buffer);h._link=this._link;h._offset=this._offset;h._deletedCount=this._deletedCount;h._offsets=this._offsets;h._count=this._count;return h};w.peekId=function(){const h=this._offset+10+6*this.boundsCount+0;return h>=this._buffer.length?0:this._buffer[h]};w.next=function(){let h=0;for(;this._offset<this._buffer.length&&100>h++&&(this._offset=-1===this._offset?0:this._offset+(10+
6*this.boundsCount),4294967296===this.id););return 4294967296!==this.id&&this._offset<this._buffer.length};w.delete=function(h){const r=this._offset,k=this.lookup(h);if(k)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===h;)this.id=4294967295,++this._deletedCount;this._offset=r;return k};w.lookup=function(h){const r=this._offset;if(null==this._offsets.instance){this._offsets.instance=new Map;const k=this.copy();k._offset=-1;let m=0;for(;k.next();)k.id!==m&&(this._offsets.instance.set(k.id,
k._offset),m=k.id)}if(!this._offsets.instance.has(h))return!1;this._offset=this._offsets.instance.get(h);return 4294967296===this.id?(this._offset=r,!1):!0};w._computeCount=function(){const h=this._offset;let r=0;for(this._offset=-1;this.next();)r++;this._offset=h;return r};n._createClass(t,[{key:"count",get:function(){this._count||(this._count=this._computeCount());return this._count}},{key:"id",get:function(){return this._buffer[this._offset]},set:function(h){this._buffer[this._offset]=h}},{key:"baseZoom",
get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"boundsCount",get:function(){return this._buffer[this._offset+
9]}}]);return t}();z.MetricReader=p;z.MetricReaderNode=q;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Geometry":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../FeatureDisplayList ./Buffer ./DisplayRecordReader ../../../../webgl/VertexArrayObject".split(" "),function(z,n,p,q,t,w,h){let r=function(){function k(d,e){this._vaos=new Map;this._indicesInvalid=!1;this.geometryType=d;this._stage=
e}var m=k.prototype;m.destroy=function(){for(const [,d]of this._vaos)d?.disposeVAOOnly();this._indexBuffer=p.destroyMaybe(this._indexBuffer);this._vertexBuffer=p.destroyMaybe(this._vertexBuffer)};m.insert=function(d,e,g){if(d.records.byteLength)if(g=d.stride,this._vertexBuffer&&this._indexBuffer){var c=d.vertices.byteLength/g;this._indexBuffer.ensure(d.indices.byteLength/4);this._vertexBuffer.ensure(c);const {vertices:b,indices:l}=d;d=w.DisplayRecordReader.from(d.records);const u=this._vertexBuffer.insert(b,
0,b.byteLength/g,0),A=this._indexBuffer.insert(l,0,l.byteLength/4,u);d.forEach(B=>{B.indexFrom+=A;B.vertexFrom+=u});p.unwrapOrThrow(this._records,"Expected records to be defined").link(d);if(e)this._indicesInvalid=!0;else if(this._displayList)for(e=d.getCursor();e.next();)this._displayList.addRecord(e)}else{c=d.indices.byteLength/4;const b=d.vertices.byteLength/g,l=g/Uint32Array.BYTES_PER_ELEMENT,u=this._stage.bufferPool;this._records=w.DisplayRecordReader.from(d.records);this._indexBuffer=new t.Buffer("index",
c,1,u);this._vertexBuffer=new t.Buffer("vertex",b,l,u);this._indexBuffer.insert(d.indices,0,d.indices.byteLength/4,0);this._vertexBuffer.insert(d.vertices,0,d.vertices.byteLength/g,0);e&&(this._indicesInvalid=!0)}};m.remove=function(d){if(null!=this._records)for(const e of d){d=this._records.getCursor();if(!d.lookup(e))continue;const g=d.indexFrom,c=d.vertexFrom;let b=d.indexCount,l=d.vertexCount;for(;d.next()&&d.id===e;)b+=d.indexCount,l+=d.vertexCount;this._indexBuffer.free(g,b);this._vertexBuffer.free(c,
l,!0);this._records.delete(e)}};m.getVAO=function(d,e,g,c){if(!this._vertexBuffer||!this._indexBuffer||null==this._records||!this._vertexBuffer.bufferSize)return null;const b=c?1:0;let l=this._vaos.get(b);if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||c&&this._indexBuffer.invalidatedComputeBuffer)l?.disposeVAOOnly(),l=null;this._vertexBuffer.upload();this._indexBuffer.upload();c=this._indexBuffer.getGPUBuffer(d,1===b);const u=this._vertexBuffer.getGPUBuffer(d);l||(l=new h.VertexArrayObject(d,
g,e,{geometry:u},c),this._vaos.set(b,l));return l};m.forEachCommand=function(d){if(null!=this._records){this._sortIndices(this._records);if(!this._displayList){const e=this._cursorIndexOrder;this._displayList=q.FeatureDisplayList.from(this,this.geometryType,this._records.getCursor(),e)}this._displayList.forEach(d)}};m._sortIndices=function(d){const e=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var g=0,c=d.getCursor(),b=[],l=[],u=[];c.next();)l.push(c.index),
u.push(c.sortKey),b.push(c.id);l.sort((G,v)=>{const H=u[v],E=u[G];return E===H?b[v]-b[G]:H-E});d=d.getCursor();c=e?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const G of l){if(!d.seekIndex(G))throw Error("Expected to find index");if(e){const {indexFrom:v,indexCount:H}=d;d.indexFrom=g;for(var A=0;A<H;A++)this._indexBuffer.set(g++,c.array[v+A])}else{const {vertexFrom:v,vertexCount:H}=d;var B=this._vertexBuffer.strideInt;const E=v*B;A=E+H*B;d.vertexFrom=g/B;for(B=E;B<A;B++)this._vertexBuffer.set(g++,
c.array[B])}}this._cursorIndexOrder=l;this._displayList=null}};n._createClass(k,[{key:"records",get:function(){return this._records}}]);return k}();z.Geometry=r;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../BufferPool ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(z,n,p,q,t,w,h){let r=function(){function k(d,
e,g,c){c=q.TypedBuffer.create(e*g*Uint32Array.BYTES_PER_ELEMENT,c);this.size=e;this.strideInt=g;this.bufferType=d;this.dirty={start:Infinity,end:0};this._gpu=null;this._cpu=c;this.clear()}var m=k.prototype;m.invalidate=function(){this._invalidateTriangleBuffer();p.applySome(this._gpu,d=>d.dispose());this._gpu=null};m._invalidateTriangleBuffer=function(){p.applySome(this._gpuComputeTriangles,d=>d.dispose());this._gpuComputeTriangles=null};m.destroy=function(){p.applySome(this._gpu,d=>d.dispose());
p.applySome(this._gpuComputeTriangles,d=>d.dispose());p.applySome(this._cpu,d=>d.destroy());p.applySome(this._cpu2,d=>d.destroy())};m.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new t.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};m.ensure=function(d){if(!(this.maxAvailableSpace()>=d)&&d*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt;d=Math.round(1.25*(e+d));this._cpu.expand(d*this.strideInt*
Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(e,d-e)}};m.set=function(d,e){this._cpu.array[d]!==e&&(this._cpu.array[d]=e,this.dirty.start=Math.min(d,this.dirty.start),this.dirty.end=Math.max(d,this.dirty.end))};m.getGPUBuffer=function(d,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(d));return this._gpuComputeTriangles}null==
this._gpu&&(this._gpu=this._createBuffer(d));return this._gpu};m.getCPUBuffer=function(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);this._cpu2.set(this._cpu);return this._cpu2};m.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};m.insert=function(d,e,g,c){const b=g*this.strideInt;if(!b)return 0;d=new Uint32Array(d,e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,b);g=p.unwrapOrThrow(this.freeList.firstFit(g),
"First fit region must be defined")*this.strideInt;e=g/this.strideInt-e;if(0!==c)for(let l=0;l<d.length;l++)d[l]+=c;this._cpu.array.set(d,g);this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,g+b);this.fillPointer=Math.max(this.fillPointer,g+b);return e};m.free=function(d,e,g){const c=d*this.strideInt,b=(d+e)*this.strideInt;if(!0===g)for(g=d;g!==d+e;g++)this._cpu.array[g*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,c);this.dirty.end=Math.max(this.dirty.end,
b);this.freeList.free(d,e)};m.upload=function(){this.dirty.end&&(this._invalidateTriangleBuffer(),null!=this._gpu&&this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)};m._createBuffer=function(d){const e=h.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?w.BufferObject.createIndex(d,e,this._cpu.array):w.BufferObject.createVertex(d,e,this._cpu.array)};m._createComputeBuffer=function(d){const e=h.Usage.DYNAMIC_DRAW,g=new Uint32Array(this.fillPointer/
3);for(let c=0;c<this.fillPointer;c+=3)g[c/3]=this._cpu.array[c];return w.BufferObject.createIndex(d,e,g)};n._createClass(k,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return 0<this.bufferSize&&!this._gpu}},{key:"invalidatedComputeBuffer",get:function(){return 0<this.bufferSize&&!this._gpuComputeTriangles}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}}]);return k}();z.Buffer=r;Object.defineProperty(z,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),function(z,n,p,q,t,w,h){const r=p("featurelayer-order-by-server-enabled");w=function(k){function m(e,g,c,b){e=k.call(this,e)||this;e._hitTestsRequests=[];e._layer=c;
e._layerView=g;e._onUpdate=b;return e}n._inherits(m,k);var d=m.prototype;d.renderChildren=function(e){this.attributeView.update();this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView);n._get(n._getPrototypeOf(m.prototype),"renderChildren",this).call(this,e)};d.hasEmptyAttributeView=function(){return this.attributeView.isEmpty()};d.isUpdating=function(){return this.attributeView.isUpdating()};d.hitTest=function(e){let g=this._hitTestsRequests.find(({x:b,y:l})=>b===e.x&&l===e.y);const c=
q.createResolver();g?g.resolvers.push(c):(g={x:e.x,y:e.y,resolvers:[c]},this._hitTestsRequests.push(g));this.requestRender();return c.promise};d.onTileData=function(e,g){const c=r&&"orderBy"in this._layer&&this._layer.orderBy,b=c&&c?.length&&!c[0].valueExpression&&c[0].field;e.patch(g,!!c&&this._layerView.orderByFields===b);this.contains(e)||this.addChild(e);this.requestRender()};d.onTileError=function(e){this.contains(e)||this.addChild(e)};d.updateTransitionProperties=function(e,g){n._get(n._getPrototypeOf(m.prototype),
"updateTransitionProperties",this).call(this,e,g);this._layerView.featureEffectView.transitionStep(e,g);this._layerView.featureEffectView.transitioning&&this.requestRender()};d.doRender=function(e){const {minScale:g,maxScale:c}=this._layer.effectiveScaleRange,b=e.state.scale;b<=(g||Infinity)&&b>=c&&n._get(n._getPrototypeOf(m.prototype),"doRender",this).call(this,e)};d.afterRender=function(e){n._get(n._getPrototypeOf(m.prototype),"afterRender",this).call(this,e);this._hitTestsRequests.length&&this.requestRender()};
d.onAttributeStoreUpdate=function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();this._onUpdate()};d.setStencilReference=function(e){const {rendererSchema:g}=e.rendererInfo;if("dot-density"===g?.type&&1<g?.dotSize||"heatmap"===g?.type)for(const c of this.children)c.stencilRef=c.key.level+1;else n._get(n._getPrototypeOf(m.prototype),"setStencilReference",this).call(this,e)};d.prepareRenderPasses=function(e){const g=n._get(n._getPrototypeOf(m.prototype),"prepareRenderPasses",this).call(this,
e),c=e.registerRenderPass({name:"label",brushes:[t.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:h.WGLDrawPhase.LABEL|h.WGLDrawPhase.LABEL_ALPHA});if(p("featurelayer-force-marker-text-draw-order")){var b=e.registerRenderPass({name:"geometry",brushes:[t.brushes.fill,t.brushes.dotDensity,t.brushes.line,t.brushes.heatmap,t.brushes.pieChart],target:()=>this.children,forceDrawByDisplayOrder:!0,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:e.effects.outsideEffect,
enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:e.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:e.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]});g.push(b)}else b=e.registerRenderPass({name:"geometry",brushes:[t.brushes.fill,t.brushes.dotDensity,t.brushes.line,t.brushes.marker,t.brushes.heatmap,
t.brushes.pieChart,t.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:e.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:e.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:e.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>
this._hitTestsRequests}]}),g.push(b);e=e.registerRenderPass({name:"highlight",brushes:[t.brushes.fill,t.brushes.dotDensity,t.brushes.line,t.brushes.marker,t.brushes.pieChart,t.brushes.text],target:()=>this.children,drawPhase:h.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:e.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});g.push(e);g.push(c);return g};n._createClass(m,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in
this._layer)return this._layer.sublayers.some(g=>!!g.labelingInfo?.length&&g.labelsVisible);var e=this._layer.featureReduction;e=e&&"labelingInfo"in e&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!e}}]);return m}(w.FeatureContainer);z.WGLFeatureView=w;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(z,n,p,q,t,w,h,r,k){function m(c){return c.some(b=>b.globalId)}function d(c){return c.filter(b=>!b.error).map(b=>b.objectId??b.globalId).filter(b=>null!=b)}function e(c,b){c=new Set(c);for(const l of b.values())c.add(l);return c}function g(c,b){c=new Set(c);for(const l of b.values())c.delete(l);return c}p=function(c){function b(u){var A=c.call(this,u)||this;A._hasGlobalIds=!1;A._notifyUpdating=()=>{A.notifyChange("updating")};return A}z._inherits(b,c);var l=b.prototype;l.normalizeCtorArgs=
function(u){this._queueProcessor=new k.QueueProcessor({concurrency:1,process:u.process});return{}};l.destroy=function(){this.clear()};l.clear=function(){this._queueProcessor.clear()};l.push=function(u){const A=this._queueProcessor;var B=A.last();switch(u.type){case "update":case "refresh":if(B?.type===u.type)return;A.push(u).then(this._notifyUpdating,this._notifyUpdating);break;case "edit":(B="processed-edit"===B?.type?B:null)&&A.popLast();u=this._mergeEdits(B,u);for(const G of u)G&&A.push(G).then(this._notifyUpdating,
this._notifyUpdating)}this.notifyChange("updating")};l._mergeEdits=function(u,A){const {addedFeatures:B,deletedFeatures:G,updatedFeatures:v}=A.edits;if(this._hasGlobalIds=this._hasGlobalIds||m(B)||m(v)||m(G))return A=[...B,...v],[u,{type:"processed-edit",edits:{addOrModified:A,removed:G}}];A=new Set(d(u?.edits.addOrModified??[]));u=new Set(d(u?.edits.removed??[]));const H=new Set([...d(B),...d(v)]),E=new Set(d(G));A=Array.from(e(g(A,E),H)).map(F=>({objectId:F}));u=Array.from(e(g(u,H),E)).map(F=>({objectId:F}));
return[{type:"processed-edit",edits:{addOrModified:A,removed:u}}]};z._createClass(b,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return b}(p);n.__decorate([q.property({readOnly:!0})],p.prototype,"updating",null);n.__decorate([q.property()],p.prototype,"process",void 0);return p=n.__decorate([r.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],p)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(z,n,p,q,t,w,h,r,k,m){p=function(d){function e(c){c=d.call(this,c)||this;c._startupResolver=q.createResolver();c.isReady=!1;return c}z._inherits(e,d);var g=e.prototype;g.initialize=function(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))};g.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};g.startup=async function(c,b,l,u){await this.when();var A=this._controller.signal;A=Array.isArray(l.source)?
{transferList:l.source,signal:A}:void 0;c=c.tileInfo.toJSON();await this._connection.invoke("startup",{service:l,config:b,tileInfo:c,tiles:u},A);this._startupResolver.resolve();this._set("isReady",!0)};g.updateTiles=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("updateTiles",c))};g.update=async function(c){c={config:c};await this._startupResolver.promise;return this._connection.invoke("update",c)};g.applyUpdate=async function(c){await this._startupResolver.promise;
return this._connection.invoke("applyUpdate",c)};g.setHighlight=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",c))};g.stop=async function(){await this._startupResolver.promise;if(!this.closed)return q.ignoreAbortErrors(this._connection.invoke("stop"))};g.refresh=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.refresh",c))};g.querySummaryStatistics=
async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",{query:c.toJSON(),params:b},l)};g.queryAggregateSummaryStatistics=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateSummaryStatistics",{query:c.toJSON(),params:b},l)};g.queryUniqueValues=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",{query:c.toJSON(),
params:b},l)};g.queryAggregateUniqueValues=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateUniqueValues",{query:c.toJSON(),params:b},l)};g.queryClassBreaks=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",{query:c.toJSON(),params:b},l)};g.queryAggregateClassBreaks=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateClassBreaks",
{query:c.toJSON(),params:b},l)};g.queryHistogram=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",{query:c.toJSON(),params:b},l)};g.queryAggregateHistogram=async function(c,b,l){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateHistogram",{query:c.toJSON(),params:b},l)};g.queryFeatures=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",
c?.toJSON(),b)};g.queryVisibleFeatures=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",c?.toJSON(),b)};g.queryObjectIds=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",c?.toJSON(),b)};g.queryFeatureCount=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",c?.toJSON(),b)};g.queryExtent=async function(c,
b){return this._connection.invoke("controller.queryExtent",c.toJSON(),b)};g.queryLatestObservations=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",c.toJSON(),b)};g.queryStatistics=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",c)};g.queryAggregates=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregates",
c?.toJSON(),b)};g.queryAggregateCount=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateCount",c?.toJSON(),b)};g.queryAggregateIds=async function(c,b){await this._startupResolver.promise;return this._connection.invoke("controller.queryAggregateIds",c?.toJSON(),b)};g.getObjectId=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",c)};g.getDisplayId=async function(c){await this._startupResolver.promise;
return this._connection.invoke("controller.getDisplayId",c)};g.getFeatures=async function(c){await this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",c)};g.getAggregates=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")};g.getAggregateValueRanges=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")};g.mapValidDisplayIds=async function(c){await this._startupResolver.promise;
return this._connection.invoke("controller.mapValidDisplayIds",c)};g.onEdits=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.onEdits",c))};g.enableEvent=async function(c,b){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:c,value:b}))};g.pauseStream=async function(){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))};
g.resumeStream=async function(){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))};g.sendMessageToSocket=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToSocket",c))};g.sendMessageToClient=async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToClient",c))};g.updateCustomParameters=
async function(c){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.updateCustomParameters",c))};g._startWorker=async function(c){try{this._connection=await t.open("Pipeline",{client:this.client,strategy:"dedicated",signal:c})}catch(b){q.throwIfNotAbortError(b)}};z._createClass(e,[{key:"tileRenderer",set:function(c){this.client.tileRenderer=c}},{key:"closed",get:function(){return this._connection.closed}}]);return e}(p.EsriPromise);n.__decorate([w.property()],
p.prototype,"isReady",void 0);n.__decorate([w.property({constructOnly:!0})],p.prototype,"client",void 0);n.__decorate([w.property()],p.prototype,"tileRenderer",null);return p=n.__decorate([m.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],p)})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],function(z,n,p,q){function t(k,
m){switch(m.transformationType){case q.TransformationType.Additive:var d=w(m.minSize,k);return k+(d||m.minDataValue);case q.TransformationType.Constant:return d=(d=m.stops)&&d.length&&d[0].size,null==d&&(d=m.minSize),w(d,k);case q.TransformationType.ClampedLinear:d=m.minDataValue;var e=m.maxDataValue,g=(k-d)/(e-d),c=w(m.minSize,k);m=w(m.maxSize,k);k=k<=d?c:k>=e?m:c+g*(m-c);return k;case q.TransformationType.Proportional:return d=k/m.minDataValue,e=w(m.minSize,k),k=w(m.maxSize,k),n.clamp(d*e,e,k);
case q.TransformationType.Stops:{const [b,l,u]=h(k,m.cache.ipData);b===l?k=w(m.stops[b].size,k):(d=w(m.stops[b].size,k),k=w(m.stops[l].size,k),k=d+(k-d)*u)}return k;case q.TransformationType.RealWorldSize:return d=p.meterIn[m.valueUnit],e=w(m.minSize,k),g=w(m.maxSize,k),{valueRepresentation:m}=m,c=null,c="area"===m?2*Math.sqrt(k/r)/d:"radius"===m||"distance"===m?2*k/d:k/d,n.clamp(c,e,g);case q.TransformationType.Identity:return k;case q.TransformationType.Unknown:return null}}function w(k,m){return"number"===
typeof k?k:t(m,k)}function h(k,m){if(m){var d=0,e=m.length-1;m.some((g,c)=>{if(k<g)return e=c,!0;d=c;return!1});return[d,e,(k-m[d])/(m[e]-m[d])]}}const r=Math.PI;z.getSizeForValueSimple=t;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TileCoverage","./TileKey"],function(z,n,p,q){let t=function(){function w(r){this._tiles=new Map;this.buffer=0;this.acquireTile=r.acquireTile;
this.releaseTile=r.releaseTile;this.tileInfoView=r.tileInfoView;this.buffer=r.buffer}var h=w.prototype;h.destroy=function(){};h.clear=function(){this._tiles.forEach(r=>this._releaseTile(r))};h.tileKeys=function(){const r=[];this._tiles.forEach((k,m)=>r.push(m));return r};h.update=function(r){r=this.tileInfoView.getTileCoverage(r.state,this.buffer,!0,"closest");const {spans:k,lodInfo:m}=r,{level:d}=m,e=[],g=[],c=new Set,b=new Set;for(const {row:l,colFrom:u,colTo:A}of k)for(let B=u;B<=A;B++){const G=
q.getId(d,l,m.normalizeCol(B),m.getWorldForColumn(B)),v=this._getOrAcquireTile(e,G);c.add(G);v.isReady?v.visible=!0:b.add(v.key)}b.forEach(l=>this._addPlaceholders(c,l));this._tiles.forEach(l=>{c.has(l.key.id)||(g.push(l.key.id),this._releaseTile(l))});p.pool.release(r);return{hasMissingTiles:0<b.size,added:e,removed:g}};h._getOrAcquireTile=function(r,k){if(!this._tiles.has(k)){const m=this.acquireTile(new q(k));r.push(k);this._tiles.set(k,m);m.visible=!1}return this._tiles.get(k)};h._getTile=function(r){return this._tiles.get(r)};
h._releaseTile=function(r){this._tiles.delete(r.key.id);this.releaseTile(r)};h._addPlaceholders=function(r,k){const m=this._addPlaceholderChildren(r,k);1E-6>Math.abs(1-m)||this._addPlaceholderParent(r,k)||(this._getTile(k.id).visible=!0)};h._addPlaceholderChildren=function(r,k){let m=0;this._tiles.forEach(d=>{m+=this._addPlaceholderChild(r,d,k)});return m};h._addPlaceholderChild=function(r,k,m){if(k.key.level<=m.level||!k.hasData||!m.contains(k.key))return 0;k.visible=!0;r.add(k.key.id);return 1/
(1<<2*(k.key.level-m.level))};h._addPlaceholderParent=function(r,k){k=k.getParentKey();var m=0;let d=null;for(;null!=k;){if(r.has(k.id))return!0;const e=this._getTile(k.id);if(e?.isReady){for(const g of r)(m=this._getTile(g))&&k.contains(m.key)&&(m.visible=!1);e.visible=!0;r.add(e.key.id);return!0}e?.hasData&&e.patchCount>m&&(m=e.patchCount,d=e);k=k.getParentKey()}return d?(d.visible=!0,r.add(d.key.id),!0):!1};return n._createClass(w)}();z.TileManager=t;Object.defineProperty(z,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g,c,b,l,u,A,B){const G=q.getLogger("esri.views.layers.FeatureLayerView");return v=>{v=function(H){function E(...x){x=H.call(this,...x)||this;x._updatingRequiredFieldsPromise=null;x.filter=null;x.timeExtent=null;x.layer=null;x.requiredFields=[];x.view=null;return x}z._inherits(E,H);var F=E.prototype;F.initialize=function(){this.handles.add([w.watch(()=>{const x=this.layer;return[x?.elevationInfo?.featureExpressionInfo,x&&"displayField"in x?x.displayField:null,x&&"timeInfo"in
x&&x.timeInfo,x&&"renderer"in x&&x.renderer,x&&"labelingInfo"in x&&x.labelingInfo,x&&"floorInfo"in x&&x.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),w.syncAndInitial),w.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),w.on(()=>{const x=this.layer;return x&&"sublayers"in x?x.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])};F.highlight=function(x){throw Error("missing implementation");};F.createQuery=function(){var x=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};x=null!=this.filter?this.filter.createQuery(x):new u(x);if("feature"===this.layer.type){const C=l.getFloorFilterClause(this);null!=C&&(x.where=x.where?`(${x.where}) AND (${C})`:C)}null!=this.timeExtent&&(x.timeExtent=null!=x.timeExtent?x.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return x};F.createAggregateQuery=function(){return new u({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})};
F.queryFeatures=function(x,C){throw Error("missing implementation");};F.queryObjectIds=function(x,C){throw Error("missing implementation");};F.queryFeatureCount=function(x,C){throw Error("missing implementation");};F.queryExtent=function(x,C){throw Error("missing implementation");};F.fetchPopupFeatures=async function(x,C){if(x=this.validateFetchPopupFeatures(C))throw x;return this.fetchClientPopupFeatures(C)};F._loadArcadeModules=function(x){return x.get("expressionInfos.length")||Array.isArray(x.content)&&
x.content.some(C=>"expression"===C.type)?A.loadArcade():Promise.resolve()};F._handleRequiredFieldsChange=function(){const x=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",x);x.then(()=>{this._updatingRequiredFieldsPromise===x&&this._set("_updatingRequiredFieldsPromise",null)})};F._updateRequiredFields=async function(){if(this.layer&&this.view){var x="3d"===this.view.type,{layer:C,layer:{fieldsIndex:L,objectIdField:N}}=this,Q="renderer"in C&&C.renderer,O="orderBy"in C&&C.orderBy,
S="featureReduction"in C?C.featureReduction:null,K=new Set;Q=await t.eachAlways([Q?Q.collectRequiredFields(K,L):null,b.collectLabelingFields(K,C),x?b.collectElevationFields(K,C):null,null!=this.filter?b.collectFilterFields(K,C,this.filter):null,null!=this.featureEffect?b.collectFilterFields(K,C,this.featureEffect.filter):null,S?b.collectFeatureReductionFields(K,C,S):null,O?b.collectOrderByInfos(K,C,O):null]);"timeInfo"in C&&C.timeInfo&&this.timeExtent&&b.collectFields(K,C.fieldsIndex,[C.timeInfo.startField,
C.timeInfo.endField]);"feature"===C.type&&(C.floorInfo&&b.collectFields(K,C.fieldsIndex,[C.floorInfo.floorField]),x&&null!=C.infoFor3D&&(null==C.globalIdField&&G.error("globalIdField missing on 3DObjectFeatureLayer"),b.collectFields(K,C.fieldsIndex,[C.globalIdField])));"subtype-group"===C.type&&(b.collectField(K,L,C.subtypeField),O=C.sublayers.map(W=>Promise.all([W.renderer?.collectRequiredFields(K,L),b.collectLabelingFields(K,W)])),await t.eachAlways(O));for(const W of Q)W.error&&G.error(W.error);
b.collectField(K,L,N);x&&"displayField"in C&&C.displayField&&b.collectField(K,L,C.displayField);x=Array.from(K).sort();this._set("requiredFields",x)}};F.validateFetchPopupFeatures=function(x){if(null==x)return null;for(const C of x.clientGraphics??[]){const L=C.layer;if("popupEnabled"in L&&!L.popupEnabled)return new p("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:L});if(C.isAggregate){const N="featureReduction"in L?L.featureReduction:null;if(!(N&&"popupTemplate"in N&&N.popupEnabled&&
N.popupTemplate))return new p("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:L})}else if("popupTemplate"in L&&!B.getFetchPopupTemplate(L,x))return new p("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:L})}};F.fetchClientPopupFeatures=async function(x){const C=null!=x?x.clientGraphics:null;if(!C||0===C.length)return[];const L=Array(C.length),N=new Map,Q=await this.createPopupQuery(x);for(let S=0;S<C.length;S++){const K=C[S];if(K.isAggregate){L[S]=
K;continue}var O=K.layer;if(!("popupEnabled"in O))continue;const W=b.unpackFieldNames(this.layer.fieldsIndex,Q.outFields);O=B.getFetchPopupTemplate(O,x);if(null==O)continue;const Z=await this._loadArcadeModules(O);Z&&Z.arcadeUtils.hasGeometryOperations(O)||!b.featureHasFields(W,K)?N.set(K.getObjectId(),{graphic:K,index:S}):L[S]=K}if("stream"===this.layer.type||0===N.size)return L.filter(Boolean);Q.objectIds=Array.from(N.keys());try{const S=await this.layer.queryFeatures(Q);for(const K of S.features){const {graphic:{geometry:W},
index:Z}=N.get(K.getObjectId());K.geometry||(K.geometry=W);L[Z]=K}}catch{}return L.filter(Boolean)};F.createPopupQuery=async function(x){const C=this.layer.createQuery(),L=new Set;var N=!1,Q=null!=x&&x.clientGraphics?x.clientGraphics.map(O=>O.layer):[this.layer];for(const O of Q)if("popupEnabled"in O&&(Q=B.getFetchPopupTemplate(O,x),null!=Q)){N=(N=await this._loadArcadeModules(Q))&&N.arcadeUtils.hasGeometryOperations(Q);N=!("point"!==this.layer.geometryType&&!N);Q=await B.getRequiredFields(this.layer,
Q);for(const S of Q)L.add(S)}C.returnGeometry=N;C.returnZ=N;C.returnM=N;C.outFields=Array.from(L);C.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(x=l.getFloorFilterClause(this),null!=x&&(C.where=C.where?`(${C.where}) AND (${x})`:x));return C};F.canResume=function(){return!z._get(z._getPrototypeOf(E.prototype),"canResume",this).call(this)||null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0};z._createClass(E,[{key:"availableFields",get:function(){const {layer:x,layer:{fieldsIndex:C},
requiredFields:L}=this;return"outFields"in x&&x.outFields?b.fixFields(C,[...b.unpackFieldNames(C,x.outFields),...L]):b.fixFields(C,L)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(x){this._override("featureEffect",x)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(x){G.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",
get:function(){return!1}}]);return E}(v);n.__decorate([h.property()],v.prototype,"_updatingRequiredFieldsPromise",void 0);n.__decorate([h.property({readOnly:!0})],v.prototype,"availableFields",null);n.__decorate([h.property({type:g})],v.prototype,"featureEffect",null);n.__decorate([h.property({type:c})],v.prototype,"filter",void 0);n.__decorate([h.property(e.combinedViewLayerTimeExtentProperty)],v.prototype,"timeExtent",void 0);n.__decorate([h.property()],v.prototype,"layer",void 0);n.__decorate([h.property({type:Number})],
v.prototype,"maximumNumberOfFeatures",null);n.__decorate([h.property({readOnly:!0,type:Boolean})],v.prototype,"maximumNumberOfFeaturesExceeded",null);n.__decorate([h.property({readOnly:!0})],v.prototype,"requiredFields",void 0);n.__decorate([h.property()],v.prototype,"suspended",void 0);n.__decorate([h.property()],v.prototype,"view",void 0);return v=n.__decorate([d.subclass("esri.views.layers.FeatureLayerView")],v)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(z){function n(p,
q){if(!p?.length)return null;p=p.filter(t=>""!==t).map(t=>`'${t}'`);p.push("''");return`${q} IN (${p.join(",")}) OR ${q} IS NULL`}z.getFloorFilterClause=function(p){const q=p.layer;return"floorInfo"in q&&q.floorInfo?.floorField&&"floors"in p.view?n(p.view.floors,q.floorInfo.floorField):null};z.getLayerFloorFilterClause=function(p,q){return"floorInfo"in q&&q.floorInfo?.floorField?n(p,q.floorInfo.floorField):null};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(z,n){function p(q,t){return q.popupTemplate?q.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=q.defaultPopupTemplate?q.defaultPopupTemplate:null}z.getFetchPopupTemplate=p;z.getRequiredFields=async function(q,t=q.popupTemplate){if(null==t)return[];const w=await t.getRequiredFields(q.fieldsIndex);({lastEditInfoEnabled:t}=t);const {objectIdField:h,typeIdField:r,globalIdField:k,relationships:m}=q;if(w.includes("*"))return["*"];t=t?await n.getFeatureEditFields(q):
[];const d=n.fixFields(q.fieldsIndex,[...w,...t]);r&&d.push(r);d&&h&&q.fieldsIndex?.has(h)&&!d.includes(h)&&d.push(h);d&&k&&q.fieldsIndex?.has(k)&&!d.includes(k)&&d.push(k);m&&m.forEach(e=>{({keyField:e}=e);d&&e&&q.fieldsIndex?.has(e)&&!d.includes(e)&&d.push(e)});return d};z.hasPopupTemplate=function(q,t){return null!=p(q,{defaultPopupTemplateEnabled:t})};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(z,n,p,q,t,w,h,r,k,m){return d=>{d=function(e){function g(){return e.apply(this,arguments)||this}z._inherits(g,e);g.prototype.initialize=function(){this.handles.add(t.on(()=>this.layer,"refresh",c=>{this.doRefresh(c.dataChanged).catch(b=>{q.isAbortError(b)||p.getLogger(this).error(b)})}),"RefreshableLayerView")};return z._createClass(g)}(d);n.__decorate([w.property()],d.prototype,"layer",void 0);return d=n.__decorate([m.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../layers/support/layerUtils ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./features/support/rendererUtils ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ./support/visualVariableSimpleUtils ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../webgl/capabilities ../../../geometry/Extent".split(" "),
function(z,n,p,q,t,w,h,r,k,m,d,e,g,c,b,l,u,A,B,G,v,H,E,F,x,C,L,N,Q,O,S,K,W,Z,ia,ja,ka,la,ma,na){function ha(T){return T&&"openPorts"in T}function oa(T){for(const U of T)if(T=("featureReduction"in U&&U.featureReduction&&"labelingInfo"in U.featureReduction?U.featureReduction:void 0)?.labelingInfo||[],T=[...(U.labelingInfo||[]),...T],U.labelsVisible&&T.length&&T.some(D=>"none"===D.deconflictionStrategy))return!0;return!1}function pa(T){return U=>b.pt2px(Z.getSizeForValueSimple(U,T))}q=function(T){function U(){var a=
T.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._commandsQueue=new S({process:f=>{switch(f.type){case "processed-edit":return a._doEdit(f);case "refresh":return a._doRefresh(f.dataChanged);case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._highlightIds=new Map;a._updateHighlight=g.debounce(async()=>a._proxy.setHighlight(Array.from(a._highlightIds.keys())));a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.featureEffectView=new B;a._lastDefinitionExpression=null;return a}
z._inherits(U,T);var D=U.prototype;D.destroy=function(){e.applySome(this._updateClusterSizeTask,a=>a.remove());this._proxy?.destroy();this._commandsQueue.destroy()};D.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()]));this.addHandles([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),c.watch(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},c.syncAndInitial)],"constructor");this.featureEffectView.endTransitions()};
D._initProxy=async function(){var a=this.layer;if("isTable"in a&&a.isTable)throw new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});if(("feature"===a.type||"subtype-group"===a.type)&&!v.getEffectiveLayerCapabilities(a)?.operations.supportsQuery)throw new r("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:a});this._proxy&&this._proxy.destroy();a=this._createClientOptions();this._set("_proxy",new K({client:a}));
return this._proxy.when()};D._initServiceOptions=async function(){this._set("_serviceOptions",await this._createServiceOptions());return this._serviceOptions};D.highlight=function(a){let f;a instanceof t?f=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?f=[a]:h.isCollection(a)&&0<a.length?f=a.map(I=>I?.getObjectId()).toArray():Array.isArray(a)&&0<a.length&&(f="number"===typeof a[0]||"string"===typeof a[0]?a:a.map(I=>I?.getObjectId()));const y=f?.filter(w.isSome);if(!y||!y.length)return{remove:()=>
{}};this._addHighlight(y);return{remove:()=>this._removeHighlight(y)}};D.hasHighlight=function(){return!!this._highlightIds.size};D.hitTest=async function(a,f){if(!this.tileRenderer)return null;f=await this.tileRenderer.hitTest(f);if(0===f.length)return null;k("featurelayer-force-marker-text-draw-order")&&f.sort((J,M)=>J-M);const {features:y,aggregates:I}=await this._proxy.getFeatures(f);return[...I.map(J=>this._createGraphicHit(a,p.fromJSON(J))),...y.map(J=>this._createGraphicHit(a,t.fromJSON(J)))]};
D.queryStatistics=function(){return this._proxy.queryStatistics()};D.querySummaryStatistics=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(a),f,y)};D.queryAggregateSummaryStatistics=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryAggregateSummaryStatistics(this._cleanUpAggregateQuery(a),f,y)};D.queryUniqueValues=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(a),
f,y)};D.queryAggregateUniqueValues=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryAggregateUniqueValues(this._cleanUpAggregateQuery(a),f,y)};D.queryClassBreaks=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(a),f,y)};D.queryAggregateClassBreaks=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryAggregateClassBreaks(this._cleanUpAggregateQuery(a),f,y)};D.queryHistogram=async function(a,
f,y){f={...f,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(a),f,y)};D.queryAggregateHistogram=async function(a,f,y){f={...f,scale:this.view.scale};return this._proxy.queryAggregateHistogram(this._cleanUpAggregateQuery(a),f,y)};D.queryFeatures=function(a,f){return this.queryFeaturesJSON(a,f).then(y=>{y=E.fromJSON(y);y.features.forEach(I=>this._setLayersForFeature(I));return y})};D.queryVisibleFeatures=function(a,f){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),
f).then(y=>{y=E.fromJSON(y);y.features.forEach(I=>this._setLayersForFeature(I));return y})};D.queryAggregates=async function(a,f){a=await this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),f);a=H.fromJSON(a);a.features.forEach(y=>this._setLayersForFeature(y));return a};D.queryAggregateIds=function(a,f){return this._proxy.queryAggregateIds(this._cleanUpAggregateQuery(a),f)};D.queryAggregateCount=function(a,f){return this._proxy.queryAggregateCount(this._cleanUpAggregateQuery(a),f)};D.queryAggregateJSON=
function(a,f){return this._proxy.queryAggregates(this._cleanUpAggregateQuery(a),f)};D.queryFeaturesJSON=function(a,f){return this._proxy.queryFeatures(this._cleanUpQuery(a),f)};D.queryObjectIds=function(a,f){return this._proxy.queryObjectIds(this._cleanUpQuery(a),f)};D.queryFeatureCount=function(a,f){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),f)};D.queryExtent=function(a,f){return this._proxy.queryExtent(this._cleanUpQuery(a),f).then(y=>({count:y.count,extent:na.fromJSON(y.extent)}))};
D.setVisibility=function(a,f){f?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};D.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:f,added:y,removed:I}=this._tileStrategy.update(a);(y.length||I.length)&&this._proxy.updateTiles({added:y,removed:I});f&&this.requestUpdate();this.notifyChange("updating")}};D.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new ia.TileManager({acquireTile:a=>
this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.addAttachHandles(c.watch(()=>this.renderingConfigHash,()=>this._update(),c.initial));"stream"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",a=>this._edit(a)))};D.detach=function(){this._commandsQueue.clear();this._proxy?.stop();this.container.removeAllChildren();this.tileRenderer?.uninstall(this.container);this.tileRenderer=null;this._tileStrategy=e.destroyMaybe(this._tileStrategy);
this._tileRendererHash=null};D.moveStart=function(){this.requestUpdate()};D.viewChange=function(){this.requestUpdate()};D.moveEnd=function(){this.requestUpdate()};D.isUpdating=function(){const a="renderer"in this.layer&&null!=this.layer.renderer,f=this._commandsQueue.updating,y=null!=this._updatingRequiredFieldsPromise,I=!this._proxy||!this._proxy.isReady,J=this._pipelineIsUpdating,M=null==this.tileRenderer||this.tileRenderer?.updating,P=a&&(f||y||I||J||M);k("esri-2d-log-updating")&&console.log(`Updating FLV2D (${this.layer.id}): ${P}\n  -> hasRenderer ${a}\n  -> hasPendingCommand ${f}\n  -> updatingRequiredFields ${y}\n  -> updatingProxy ${I}\n  -> updatingPipeline ${J}\n  -> updatingTileRenderer ${M}\n`);
return P};D._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};D._detectQueryMode=async function(a){a="path"in a;const {layer:f}=this;var y="refreshInterval"in f&&!!f.refreshInterval;y=!("editingInfo"in f&&f.editingInfo?.lastEditDate)&&y;const I=v.getEffectiveLayerCapabilities(f);if(a&&("feature"===f.type||"subtype-group"===f.type)&&"point"===f.geometryType&&I?.query.supportsPagination&&!I?.operations.supportsEditing&&
!y&&k("featurelayer-snapshot-enabled"))try{const P=await f.queryFeatureCount();var J=k("featurelayer-snapshot-point-min-threshold");if(P<=J)return{mode:"snapshot",featureCount:P};const Y=k("featurelayer-snapshot-point-max-threshold"),R=k("featurelayer-snapshot-point-coverage"),X=this.view.extent;var M=f.fullExtent;J=M?.clone().intersection(X);const V=null!=J?J.width*J.height:0;M=M?.width*M?.height;if(P<=Y&&(0===M?0:V/M)>=R)return{mode:"snapshot",featureCount:P}}catch(P){d.getLogger(this).warn("mapview-feature-layer",
"Encountered an error when querying for featureCount",{error:P})}return{mode:"on-demand"}};D._createServiceOptions=async function(){var a=this.layer;if("stream"===a.type)return null;const f=v.getEffectiveLayerCapabilities(a),{capabilities:y,objectIdField:I}=a,J=a.fields.map(aa=>aa.toJSON()),M=null!=a.fullExtent?a.fullExtent.toJSON():null,P=W.toJSONGeometryType(a.geometryType),Y="timeInfo"in a&&a.timeInfo&&a.timeInfo.toJSON()||null,R=a.spatialReference?a.spatialReference.toJSON():null,X="feature"===
a.type?a.globalIdField:null;let V;"ogc-feature"===a.type?V=a.source.getSource():ha(a.source)?V=await a.source.openPorts():a.parsedUrl&&(V=m.clone(a.parsedUrl),"dynamicDataSource"in a&&a.dynamicDataSource&&(V.query={layer:JSON.stringify({source:a.dynamicDataSource})}));a="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;const da=("subtypeField"in this.layer?this.layer.subtypeField:null)??null,{mode:ea,featureCount:fa}=await this._detectQueryMode(V);let ba=this.layer.objectIdField;
if("feature"===this.layer.type&&null!=this.layer.orderBy&&this.layer.orderBy.length){const aa=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;aa&&(ba=aa)}return{type:ea,timeReferenceUnknownClient:a,subtypeField:da,featureCount:fa,globalIdField:X,maxRecordCount:y.query.maxRecordCount,tileMaxRecordCount:y.query.tileMaxRecordCount,capabilities:y,effectiveCapabilities:f,fields:J,fullExtent:M,geometryType:P,objectIdField:I,source:V,timeInfo:Y,spatialReference:R,orderByFields:ba,datesInUnknownTimezone:a,
dateFieldsTimeReference:("dateFieldsTimeReference"in this.layer?this.layer.dateFieldsTimeReference?.toJSON():null)||null,preferredTimeReference:("preferredTimeReference"in this.layer?this.layer.preferredTimeReference?.toJSON():null)||null,editFieldsInfo:"editFieldsInfo"in this.layer?this.layer.editFieldsInfo?.toJSON():null}};D._createMemoryServiceOptions=async function(a){a=await a.openPorts();return{...this._createServiceOptions(),type:"memory",source:a}};D._cleanUpQuery=function(a){a=F.from(a)||
this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};D._cleanUpAggregateQuery=function(a){a=F.from(a)||this.createAggregateQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};D._update=async function(){return this._commandsQueue.push({type:"update"})};D._edit=async function(a){if(this.suspended)this._clearTiles();else if(this._validateEdit(a))return this._commandsQueue.push({type:"edit",edits:a})};D.doRefresh=
async function(a){if(this.attached&&this._tileStrategy.tileKeys().length){if(!this.suspended||!a)return this._commandsQueue.push({type:"refresh",dataChanged:a});this._clearTiles()}};D._clearTiles=function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())};D._validateEdit=function(a){const f="globalIdField"in this.layer&&this.layer.globalIdField,
y=a.deletedFeatures.some(J=>-1===J.objectId||!J.objectId),I=f&&this.availableFields.includes(f);return y&&!I?(d.getLogger(this).error(new r("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${f} to be included the layer's outFields for updates to be reflected on the map`)),null):a};D._doUpdate=async function(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:a,filter:f}=this;await this._updateRequiredFields();
if(!this.destroyed){var {renderer:y}=this._getEffectiveRenderer();this._set("_effectiveRenderer",y);var I=this._createSchemaConfig(),J=this._createConfiguration(I,f,a.filter),M=this._lastDefinitionExpression!==J.schema.source.definitionExpression;this._lastDefinitionExpression=J.schema.source.definitionExpression;var P=J.schema.tileRenderer,Y=this._createTileRendererHash(P);"snapshot"===this._serviceOptions.type&&(J.schema.source.initialFeatureCount=this._serviceOptions.featureCount);if(Y!==this._tileRendererHash){this._initTileRenderer(P,
y);const R=this.layer,X="stream"===R.type?await this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(y);"stream"!==R.type&&ha(R.source)&&(X.source=await R.source.openPorts());const V={added:this._tileStrategy.tileKeys(),removed:[]};k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Proxy startup");await this._proxy.startup(this.view.featuresTilingScheme,J,X,V);k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy startup");this.hasHighlight()&&
(k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating highlight"),await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished highlight update"));k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate start");this.tileRenderer.onConfigUpdate(y);k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate end")}else{"snapshot"===this._serviceOptions.type&&M&&(J.schema.source.changedFeatureCount=
await this.layer.queryFeatureCount());k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating proxy");const R=await this._proxy.update(J);k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy update");if(R.mesh||R.targets?.aggregate)k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Locking GPU Uploads"),this._lockGPUUploads();try{k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Applying update to proxy"),await this._proxy.applyUpdate(R),
k("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished applying update to proxy")}catch(X){g.isAbortError(X)||d.getLogger(this).error(X)}(R.mesh||R.targets?.aggregate)&&this._unlockGPUUploads();this.tileRenderer.onConfigUpdate(y);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=Y;this.tileRenderer.invalidateLabels();this.requestUpdate()}}}catch(R){}};D._doEdit=async function(a){try{await this._proxy.onEdits(a)}catch(f){g.isAbortError(f)}};
D._doRefresh=async function(a){this._lockGPUUploads();try{let f;a&&"snapshot"===this.queryMode&&"queryFeatureCount"in this.layer&&(f=await this.layer.queryFeatureCount());await this._proxy.refresh({dataChanged:a,featureCount:f})}catch(f){g.isAbortError(f)}this._unlockGPUUploads();this._effectiveFeatureReduction&&this._updateClusterSizeVariable()};D._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=
!1)};D._createUpdateClusterSizeTask=function(a,f){return c.watch(()=>this._aggregateValueRanges,y=>{this._updateClusterEffectiveRendererSizeVariable(a,f,y);this._needsClusterSizeUpdate=!0;this._uploadsLocked||this._updateClusterSizeVariable()})};D._updateClusterEffectiveRendererSizeVariable=async function(a,f,y){if(a.dynamicClusterSize&&"visualVariables"in a&&a.visualVariables){var I=O.findSizeVV(a.visualVariables);null!=I&&"cluster_count"===I.field&&(I=a.visualVariables.indexOf(I),a.visualVariables[I]=
O.createClusterCountSizeVariable(f,y),a=a.clone(),a.dynamicClusterSize=!0,this._set("_effectiveRenderer",a))}};D._getEffectiveRenderer=function(){var a=this.layer,f="renderer"in a?a.renderer:null;a=this._effectiveFeatureReduction;this._updateClusterSizeTask=e.removeMaybe(this._updateClusterSizeTask);if(a&&"renderer"in a&&a.renderer&&!a.renderer.authoringInfo?.isAutoGenerated){var y=a.fields;if("cluster"===a.type){const {renderer:I,didInject:J}=O.injectDynamicLevelDependentSizeVisualVariable(a.renderer,
a,this._aggregateValueRanges);J&&(this._updateClusterSizeTask=this._createUpdateClusterSizeTask(I,a));return{renderer:I,aggregateFields:y,featureReduction:a}}return{renderer:a.renderer,aggregateFields:y,featureReduction:a}}return a&&"cluster"===a.type&&f&&O.isClusterCompatibleRenderer(f)?(y=[],f=O.createClusterRenderer(y,f,a,this._aggregateValueRanges,!0),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(f,a),{renderer:f,aggregateFields:y,featureReduction:a}):{renderer:f,aggregateFields:[],
featureReduction:null}};D._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};D._releaseTile=function(a){this.tileRenderer.releaseTile(a)};D._initTileRenderer=function(a,f){a=N.createOrReuseTileRenderer(a,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer=e.destroyMaybe(this.tileRenderer));if(this.destroyed)return null;
this._proxy.tileRenderer=a;this._set("tileRenderer",a);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(f);this.requestUpdate();return this.tileRenderer};D._createTileRendererHash=function(a){return`${a.type}`};D._injectOverrides=function(a){var f=null!=a?a.timeExtent:null;f=null!=this.timeExtent&&null!=f?this.timeExtent.intersection(f):this.timeExtent||f;let y=null;const I="floorInfo"in this.layer&&this.layer.floorInfo;I&&(y=this._addFloorFilterClause(null!=a?a.where:null));
if(!this._visibilityOverrides.size&&!f&&!I)return null!=a?a.toJSON():null;a=null!=a&&a.clone()||new G;a.timeExtent=f;y&&(a.where=y);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a};D._addFloorFilterClause=function(a){var f=this.layer;a=a||"";if("floorInfo"in f&&f.floorInfo){var y=this.view.floors;if(!y||!y.length)return a;f.floorInfo.viewAllLevelIds?.length&&(y=f.floorInfo.viewAllLevelIds);y=y.filter(I=>""!==I).map(I=>"'"+I+"'");y.push("''");f=f.floorInfo.floorField;y=("("+
f+" IN ({ids}) OR "+f+" IS NULL)").replace("{ids}",y.join(", "));if(null!=a&&a.includes(f)){let I=new RegExp("AND \\("+f+".*NULL\\)","g");a=a.replace(I,"");I=new RegExp("\\("+f+".*NULL\\)","g");a=a.replace(I,"");a=a.replaceAll(/\s+/g," ").trim()}a=""!==a?"("+a+") AND "+y:y}return""!==a?a:null};D._createConfiguration=function(a,f,y){const I="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,J="feature"===this.layer.type?this.layer.gdbVersion??void 0:void 0,
M=Array(x.MAX_FILTERS);f=this._injectOverrides(f);M[0]=f;M[1]=null!=y?y.toJSON():null;a=L.createSchema(a);if(null==a)return null;y=ma.getWebGLCapabilities("2d");return{availableFields:this.availableFields,gdbVersion:J,historicMoment:I,devicePixelRatio:window.devicePixelRatio||1,filters:M,schema:a,supportsTextureFloat:y.supportsTextureFloat,maxTextureSize:y.maxTextureSize}};D._hasRequiredSupport=function(a){return"renderer"in a?Q.isRendererSupported(a.renderer):!0};D._lockGPUUploads=function(){this.tileRenderer&&
(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};D._unlockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};D._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};D._createSchemaConfig=function(){const a=this.layer;return{renderer:"renderer"in a?a.renderer:null,spatialReference:a.spatialReference,timeExtent:"timeExtent"in a?a.timeExtent:null,definitionExpression:a.definitionExpression,
featureReduction:this._effectiveFeatureReduction,fields:a.fields,geometryType:a.geometryType,historicMoment:"historicMoment"in a?a.historicMoment:null,labelsVisible:"labelsVisible"in a&&a.labelsVisible,labelingInfo:"labelingInfo"in a?a.labelingInfo:null,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"gdbVersion"in a?a.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in a&&a.orderBy?a.orderBy:null,customParameters:{...("customParameters"in a?a.customParameters:
void 0),token:"apiKey"in a?a.apiKey??void 0:void 0},subtypeCode:"subtypeCode"in a?a.subtypeCode:void 0,subtypeField:"subtypeField"in a?a.subtypeField:void 0}};D._addHighlight=function(a){for(const f of a)this._highlightIds.has(f)?(a=this._highlightIds.get(f),this._highlightIds.set(f,a+1)):this._highlightIds.set(f,1);this._updateHighlight().catch(f=>{g.isAbortError(f)||d.getLogger(this).error(f)})};D._removeHighlight=function(a){for(const f of a)this._highlightIds.has(f)&&(a=this._highlightIds.get(f)-
1,0===a?this._highlightIds.delete(f):this._highlightIds.set(f,a));this._updateHighlight().catch(f=>{g.isAbortError(f)||d.getLogger(this).error(f)})};D._setLayersForFeature=function(a){const f=this.layer;a.layer=f;a.sourceLayer=f};D._createGraphicHit=function(a,f){this._setLayersForFeature(f);null!=f.geometry&&(f.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:f,layer:this.layer,mapPoint:a}};z._createClass(U,[{key:"_effectiveFeatureReduction",get:function(){if(!("featureReduction"in
this.layer))return null;const a=this.layer.featureReduction;return a?!("maxScale"in a&&a.maxScale)||a.maxScale<this.view.scale?a:null:null}},{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions?.type?this._serviceOptions?.orderByFields:void 0}},{key:"labelsVisible",get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(f=>f.labelingInfo&&f.labelsVisible)}},{key:"labelingCollisionInfos",get:function(){const {tileRenderer:a,
layer:f}=this;if(null==a)return null;const y=f.geometryType,I=!oa("subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer]),J={};if("subtype-group"!==f.type){if("heatmap"===a?.type)return null;a:{var M=f.renderer;if(M=null!=M&&"visualVariables"in M&&M.visualVariables)for(P of M)if("size"===P.type){var P=pa(P);break a}P=null}J[0]=P}return[{tileRenderer:a,vvEvaluators:J,deconflictionEnabled:I,geometryType:y,visible:!this.suspended}]}},{key:"queryMode",get:function(){return this._serviceOptions?.type}},
{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields;var f=this.layer;const y=this.view.floors,{definitionExpression:I}=f,J="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,M="renderer"in f&&f.renderer,P="gdbVersion"in f?f.gdbVersion:void 0,Y="historicMoment"in f?f.historicMoment?.getTime():void 0,{timeExtent:R}=this,X="customParameters"in f?JSON.stringify(f.customParameters):void 0,V="apiKey"in f?f.apiKey:void 0;f="stream"===
f.type?`${JSON.stringify(f.geometryDefinition)}${f.definitionExpression}`:null;const da=JSON.stringify(this.clips),ea=this._effectiveFeatureReduction?.toJSON(),fa="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ba="sublayers"in this.layer&&this.layer.sublayers.items.reduce((aa,ca)=>aa+`${ca.visible?1:0}.${JSON.stringify(ca.renderer)}.${ca.labelsVisible}\n.${JSON.stringify(ca.labelingInfo)}`,"");return JSON.stringify({orderBy:fa,sublayerHash:ba,subtypeCode:"subtypeCode"in this.layer&&this.layer.subtypeCode,
filterHash:null!=this.filter&&this.filter.toJSON(),effectHash:null!=this.featureEffect&&this.featureEffect.toJSON(),streamFilter:f,gdbVersion:P,definitionExpression:I,historicMoment:Y,availableFields:a,renderer:M,labelingInfo:J,timeExtent:R,floors:y,clipsHash:da,featureReduction:ea,customParameters:X,apiKey:V})}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||
!!this.timeExtent}}]);return U}(ja(la(C.LayerView2DMixin(ka))));n.__decorate([l.property()],q.prototype,"_serviceOptions",void 0);n.__decorate([l.property()],q.prototype,"_proxy",void 0);n.__decorate([l.property()],q.prototype,"_pipelineIsUpdating",void 0);n.__decorate([l.property()],q.prototype,"_effectiveRenderer",void 0);n.__decorate([l.property()],q.prototype,"_effectiveFeatureReduction",null);n.__decorate([l.property()],q.prototype,"_aggregateValueRanges",void 0);n.__decorate([l.property()],
q.prototype,"_commandsQueue",void 0);n.__decorate([l.property()],q.prototype,"featureEffectView",void 0);n.__decorate([l.property()],q.prototype,"labelsVisible",null);n.__decorate([l.property()],q.prototype,"labelingCollisionInfos",null);n.__decorate([l.property({readOnly:!0})],q.prototype,"queryMode",null);n.__decorate([l.property()],q.prototype,"renderingConfigHash",null);n.__decorate([l.property()],q.prototype,"tileRenderer",void 0);n.__decorate([l.property()],q.prototype,"updating",void 0);return q=
n.__decorate([A.subclass("esri.views.2d.layers.FeatureLayerView2D")],q)});