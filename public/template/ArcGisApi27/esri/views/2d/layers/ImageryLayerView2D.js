// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(v,
F,O,w,L,I,J,E,R,P,G,U,X,aa){w=function(S){function n(){var t=S.apply(this,arguments)||this;t._loadImagery=(z,a,c,e,g)=>U.loadImagery(t.layer,z,a,c,e,g);t._createFlowMesh=(z,a,c,e)=>t.layer.createFlowMesh({meshType:z,flowData:c,simulationSettings:a},{signal:e});t.attached=!1;t.type="flow";t.timeExtent=null;t.redrawOrRefetch=async()=>{t._updateVisualization()};return t}v._inherits(n,S);var r=n.prototype;r.attach=function(){const {layer:t}=this,z=()=>{this._loadImagery=(a,c,e,g,b)=>U.loadImagery(t,a,
c,e,g,b);this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles(L.watch(()=>t.multidimensionalDefinition,z)):this.addHandles([L.watch(()=>t.mosaicRule,z),L.watch(()=>t.rasterFunction,z),L.watch(()=>t.definitionExpression,z)]);this.container=new X;this._strategy=new aa({flowContainer:this.container});this._updateVisualization()};r.detach=function(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()};r.update=function(t){t.stationary?
this._strategy.update(t):this.layerView.requestUpdate()};r.hitTest=function(t){return new O({attributes:{},geometry:t.clone(),layer:this.layer})};r.moveEnd=function(){};r.doRefresh=async function(){};r._updateVisualization=function(){var t=this.layer.renderer;null!=t&&"flow"===t.type&&(t=G(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=t,this.layerView.requestUpdate())};v._createClass(n,[{key:"updating",get:function(){return!this.attached||
this._strategy.updating}}]);return n}(w);F.__decorate([I.property()],w.prototype,"_strategy",void 0);F.__decorate([I.property()],w.prototype,"attached",void 0);F.__decorate([I.property()],w.prototype,"container",void 0);F.__decorate([I.property()],w.prototype,"layer",void 0);F.__decorate([I.property()],w.prototype,"layerView",void 0);F.__decorate([I.property()],w.prototype,"type",void 0);F.__decorate([I.property()],w.prototype,"updating",null);F.__decorate([I.property()],w.prototype,"timeExtent",
void 0);return w=F.__decorate([P.subclass("esri.views.2d.engine.flow.FlowView2D")],w)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(v,F,O,w,L){return function(I,J){const {flowSpeed:E,trailLength:R}=I,P=v.getFlowSimulationSettings(I);let G=null;const U={opacity:v.getOpacity(I),size:v.getSize(I)};let X=v.getColor(I);"none"===I.background?U.color=X:("constant"===X.kind&&(X={kind:"ramp",
stops:[0,1],values:[0,0,0,1,X.value[0],X.value[1],X.value[2],X.value[3]],count:2}),G=new F.Imagery({loadImagery:J.loadImagery,timeExtent:J.timeExtent,color:X,opacity:{kind:"constant",value:[1]}}),U.color=v.getForegroundColor());J={loadImagery:J.loadImagery,createFlowMesh:J.createFlowMesh,simulationSettings:P,timeExtent:J.timeExtent,trailLength:R,flowSpeed:E,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:U.color,opacity:U.opacity,size:U.size};I="butt"===I.trailCap||
4>=v.getMax(v.getSize(I))?new L(J):new O.Particles(J);return null!=G?new w.Stack([G,I]):I}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils"],function(v,F){function O(E){return"constant"===E.kind?E.value[0]:E.values[E.values.length-1]}function w(E){E=E.toRgba();return[E[0]/255,E[1]/255,E[2]/255,E[3]]}function L(E){if(!E.hasVisualVariables("size"))return{kind:"constant",value:[F.pt2px(E.trailWidth)]};const R=E.getVisualVariablesForType("size")[0];E=[];
const P=[];if(R.stops){for(G of R.stops)E.push(G.value),P.push(F.pt2px(G.size));var G=R.stops.length}else E.push(R.minDataValue,R.maxDataValue),P.push(F.pt2px(R.minSize),F.pt2px(R.maxSize)),G=2;return{kind:"ramp",stops:E,values:P,count:G}}function I(E,R,P,G){switch(R){case "int":E.setUniform1iv(P,G);break;case "float":E.setUniform1fv(P,G);break;case "vec2":E.setUniform2fv(P,G);break;case "vec3":E.setUniform3fv(P,G);break;case "vec4":E.setUniform4fv(P,G)}}function J(E,R){return E===R?!0:null!=E&&null!=
R?E.equals(R):!1}v.areStreamlinesCompatible=function(E,R){var P=E.simulationSettings,G=R.simulationSettings;let U;U=(U=(U=(U=(U=(U=(U=(U=(U=(U=(U=P.collisions===G.collisions)&&P.density===G.density)&&P.interpolate===G.interpolate)&&P.lineCollisionWidth===G.lineCollisionWidth)&&P.lineSpacing===G.lineSpacing)&&P.maxTurnAngle===G.maxTurnAngle)&&P.minSpeedThreshold===G.minSpeedThreshold)&&P.segmentLength===G.segmentLength)&&P.smoothing===G.smoothing)&&P.velocityScale===G.velocityScale)&&P.verticesPerLine===
G.verticesPerLine;return U&&J(E.timeExtent,R.timeExtent)?P=(P=(P=(P=(P=E.loadImagery===R.loadImagery)&&E.createFlowMesh===R.createFlowMesh)&&E.color.kind===R.color.kind)&&E.opacity.kind===R.opacity.kind)&&E.size.kind===R.size.kind:!1};v.getColor=function(E){if(!E.hasVisualVariables("color"))return{kind:"constant",value:w(E.color)};E=E.getVisualVariablesForType("color")[0];const R=[],P=[];for(const G of E.stops)R.push(G.value),Array.prototype.push.apply(P,w(G.color));return{kind:"ramp",stops:R,values:P,
count:E.stops.length}};v.getFlowSimulationSettings=function(E){var R=L(E);R=O(R);const P=Math.max(R/2,5),G=Math.round(F.pt2px(E.maxPathLength)/P)+1,{density:U}=E;return{smoothing:F.pt2px(E.smoothing),interpolate:!0,velocityScale:"flow-from"===E.flowRepresentation?1:-1,verticesPerLine:G,minSpeedThreshold:.001,segmentLength:P,maxTurnAngle:1,collisions:!0,lineCollisionWidth:R,lineSpacing:10,density:U}};v.getForegroundColor=function(E){return{kind:"constant",value:[.1,.1,.1,1]}};v.getMax=O;v.getOpacity=
function(E){if(!E.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};E=E.getVisualVariablesForType("opacity")[0];const R=[],P=[];for(const G of E.stops)R.push(G.value),P.push(G.opacity);return{kind:"ramp",stops:R,values:P,count:E.stops.length}};v.getSize=L;v.setUniform=I;v.setUniforms=function(E,R,P,G){"constant"===G.kind?I(E,P,`u_${R}`,G.value):(I(E,"float",`u_${R}_stops`,G.stops),I(E,P,`u_${R}_values`,G.values),E.setUniform1i(`u_${R}_count`,G.count))};v.timeExtentsEqual=J;v.toRgba=
w;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(v,F,O,w,L,I,J,E,R,P){let G=function(){function n(t){this._params=
t;this.animated=!1}var r=n.prototype;r.isCompatible=function(t){if(!(t instanceof n&&w.timeExtentsEqual(this._params.timeExtent,t._params.timeExtent)))return!1;let z;return z=(z=(z=this._params.loadImagery===t._params.loadImagery)&&this._params.color.kind===t._params.color.kind)&&this._params.opacity.kind===t._params.opacity.kind};r.load=async function(t,z){const {extent:a,size:c}=t;O.throwIfAborted(z);t=await this._params.loadImagery(a,c[0],c[1],this._params.timeExtent,z);return new S(t,{color:this._params.color,
opacity:this._params.opacity})};r.render=function(t,z,a){({context:t}=t);const {program:c}=a;t.setFaceCullingEnabled(!1);t.setBlendingEnabled(!0);t.setBlendFunction(I.BlendFactor.ONE,I.BlendFactor.ONE_MINUS_SRC_ALPHA);t.useProgram(c);c.setUniformMatrix3fv("u_dvsMat3",z.dvsMat3);t.bindTexture(a.texture,0);c.setUniform1i("u_texture",0);c.setUniform1f("u_Min",a.min);c.setUniform1f("u_Max",a.max);w.setUniforms(c,"color","vec4",this._params.color);w.setUniforms(c,"opacity","float",this._params.opacity);
t.bindVAO(a.vertexArray);t.drawArrays(I.PrimitiveType.TRIANGLE_STRIP,0,4)};return F._createClass(n)}();const U=new Map;U.set("a_position",0);U.set("a_texcoord",1);const X={geometry:[new P.VertexElementDescriptor("a_position",2,I.DataType.UNSIGNED_SHORT,0,8),new P.VertexElementDescriptor("a_texcoord",2,I.DataType.UNSIGNED_SHORT,4,8)]},aa={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:U};let S=function(){function n(t,z){this._flowData=t;this._values=z}var r=n.prototype;r.attach=
function(t){var {context:z}=t;const {width:a,height:c}=this._flowData;var e={geometry:L.BufferObject.createVertex(z,I.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,c,0,0,a,c,1,0]))};e=new R.VertexArrayObject(z,U,X,e);var g=[];"ramp"===this._values.color.kind&&g.push("vvColor");"ramp"===this._values.opacity.kind&&g.push("vvOpacity");t=t.painter.materialManager.getProgram(aa,g);g=1E6;let b=-1E6;for(var f=0;f<c;f++)for(var h=0;h<a;h++)if(0!==this._flowData.mask[f*a+h]){var k=this._flowData.data[2*
(f*a+h)],m=this._flowData.data[2*(f*a+h)+1];k=Math.sqrt(k*k+m*m);g=Math.min(g,k);b=Math.max(b,k)}f=new Uint8Array(4*a*c);for(h=0;h<c;h++)for(k=0;k<a;k++)if(0!==this._flowData.mask[h*a+k]){m=this._flowData.data[2*(h*a+k)];const q=this._flowData.data[2*(h*a+k)+1];f[4*(h*a+k)]=(Math.sqrt(m*m+q*q)-g)/(b-g)*255;f[4*(h*a+k)+1]=0;f[4*(h*a+k)+2]=0;f[4*(h*a+k)+3]=255}else f[4*(h*a+k)]=0,f[4*(h*a+k)+1]=0,f[4*(h*a+k)+2]=0,f[4*(h*a+k)+3]=0;h=new E.TextureDescriptor;h.internalFormat=I.PixelFormat.RGBA;h.wrapMode=
I.TextureWrapMode.CLAMP_TO_EDGE;h.flipped=!0;h.width=a;h.height=c;z=new J.Texture(z,h,f);this.vertexArray=e;this.program=t;this.texture=z;this.min=g;this.max=b;this._flowData=null};r.detach=function(){this.vertexArray.dispose();this.texture.dispose()};F._createClass(n,[{key:"ready",get:function(){return this.program.compiled}}]);return n}();v.Imagery=G;v.ImageryResources=S;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(v,F,O,w,L,I,J,E){let R=function(){function aa(n){this._params=n}var S=aa.prototype;S.isCompatible=function(n){return n instanceof aa?w.areStreamlinesCompatible(this._params,n._params):!1};S.load=async function(n,r){const {extent:t,size:z}=n;O.throwIfAborted(r);n=await this._params.loadImagery(t,z[0],z[1],this._params.timeExtent,r);const {vertexData:a,indexData:c}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,n,r);return new X(a,c,{color:this._params.color,
opacity:this._params.opacity,size:this._params.size})};S.render=function(n,r,t){({context:n}=n);const {program:z}=t;n.setFaceCullingEnabled(!1);n.setBlendingEnabled(!0);n.setBlendFunction(I.BlendFactor.ONE,I.BlendFactor.ONE_MINUS_SRC_ALPHA);n.useProgram(z);z.setUniform1f("u_time",r.time);z.setUniform1f("u_trailLength",this._params.trailLength);z.setUniform1f("u_flowSpeed",this._params.flowSpeed);z.setUniform1f("u_featheringSize",this._params.featheringSize);z.setUniform1f("u_featheringOffset",this._params.featheringOffset);
z.setUniform1f("u_introFade",this._params.introFade?1:0);z.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);z.setUniform1f("u_decayRate",this._params.decayRate);z.setUniformMatrix3fv("u_dvsMat3",r.dvsMat3);z.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3);w.setUniforms(z,"color","vec4",this._params.color);w.setUniforms(z,"opacity","float",this._params.opacity);w.setUniforms(z,"size","float",this._params.size);n.bindVAO(t.vertexArray);n.drawElements(I.PrimitiveType.TRIANGLES,t.indexCount,
I.DataType.UNSIGNED_INT,0)};F._createClass(aa,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return aa}();const P=new Map;P.set("a_xyts0",0);P.set("a_xyts1",1);P.set("a_typeIdDurationSeed",2);P.set("a_extrudeInfo",3);const G={geometry:[new E.VertexElementDescriptor("a_xyts0",4,I.DataType.FLOAT,0,64),new E.VertexElementDescriptor("a_xyts1",4,I.DataType.FLOAT,16,64),new E.VertexElementDescriptor("a_typeIdDurationSeed",4,I.DataType.FLOAT,32,64),new E.VertexElementDescriptor("a_extrudeInfo",
4,I.DataType.FLOAT,48,64)]},U={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:P};let X=function(){function aa(n,r,t){this._vertexData=n;this._indexData=r;this._values=t}var S=aa.prototype;S.attach=function(n){var {context:r}=n,t=L.BufferObject.createVertex(r,I.Usage.STATIC_DRAW,this._vertexData);const z=L.BufferObject.createIndex(r,I.Usage.STATIC_DRAW,this._indexData);r=new J.VertexArrayObject(r,P,G,{geometry:t},z);t=[];"ramp"===this._values.color.kind&&t.push("vvColor");
"ramp"===this._values.opacity.kind&&t.push("vvOpacity");"ramp"===this._values.size.kind&&t.push("vvSize");n=n.painter.materialManager.getProgram(U,t);this.vertexArray=r;this.program=n;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};S.detach=function(){this.vertexArray.dispose()};F._createClass(aa,[{key:"ready",get:function(){return this.program.compiled}}]);return aa}();v.Particles=R;v.ParticlesResources=X;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(v,F){let O=function(){function L(J){this._styles=J}var I=L.prototype;I.isCompatible=function(J){if(!(J instanceof L)||this._styles.length!==J._styles.length)return!1;const E=this._styles.length;for(let R=0;R<E;R++)if(!this._styles[R].isCompatible(J._styles[R]))return!1;return!0};I.load=async function(J,E){const R=await Promise.all(this._styles.map(P=>P.load(J,E)));return new w(R)};
I.render=function(J,E,R){for(let P=0;P<this._styles.length;P++)this._styles[P].render(J,E,R.resources[P])};F._createClass(L,[{key:"animated",get:function(){return this._styles.reduce((J,E)=>J||E.animated,!1)}}]);return L}(),w=function(){function L(J){this.resources=J}var I=L.prototype;I.attach=function(J){for(const E of this.resources)E.attach(J)};I.detach=function(){for(const J of this.resources)J.detach()};F._createClass(L,[{key:"ready",get:function(){return this.resources.reduce((J,E)=>J&&E.ready,
!0)}}]);return L}();v.Stack=O;v.StackResources=w;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(v,F,O,w,L,I,J){let E=function(){function X(S){this._params=S}var aa=X.prototype;
aa.isCompatible=function(S){return S instanceof X?O.areStreamlinesCompatible(this._params,S._params):!1};aa.load=async function(S,n){const {extent:r,size:t}=S;F.throwIfAborted(n);S=await this._params.loadImagery(r,t[0],t[1],this._params.timeExtent,n);const {vertexData:z,indexData:a}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,S,n);return new U(z,a,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})};aa.render=function(S,n,r){({context:S}=
S);const {program:t}=r;S.setFaceCullingEnabled(!1);S.setBlendingEnabled(!0);S.setBlendFunction(L.BlendFactor.ONE,L.BlendFactor.ONE_MINUS_SRC_ALPHA);S.useProgram(t);t.setUniform1f("u_time",n.time);t.setUniform1f("u_trailLength",this._params.trailLength);t.setUniform1f("u_flowSpeed",this._params.flowSpeed);t.setUniform1f("u_featheringSize",this._params.featheringSize);t.setUniform1f("u_featheringOffset",this._params.featheringOffset);t.setUniform1f("u_introFade",this._params.introFade?1:0);t.setUniform1f("u_fadeToZero",
this._params.fadeToZero?1:0);t.setUniform1f("u_decayRate",this._params.decayRate);t.setUniformMatrix3fv("u_dvsMat3",n.dvsMat3);t.setUniformMatrix3fv("u_displayViewMat3",n.displayViewMat3);O.setUniforms(t,"color","vec4",this._params.color);O.setUniforms(t,"opacity","float",this._params.opacity);O.setUniforms(t,"size","float",this._params.size);S.bindVAO(r.vertexArray);S.drawElements(L.PrimitiveType.TRIANGLES,r.indexCount,L.DataType.UNSIGNED_INT,0)};v._createClass(X,[{key:"animated",get:function(){return 0<
this._params.flowSpeed}}]);return X}();const R=new Map;R.set("a_positionAndSide",0);R.set("a_timeInfo",1);R.set("a_extrude",2);R.set("a_speed",3);const P={geometry:[new J.VertexElementDescriptor("a_positionAndSide",3,L.DataType.FLOAT,0,36),new J.VertexElementDescriptor("a_timeInfo",3,L.DataType.FLOAT,12,36),new J.VertexElementDescriptor("a_extrude",2,L.DataType.FLOAT,24,36),new J.VertexElementDescriptor("a_speed",1,L.DataType.FLOAT,32,36)]},G={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",
attributes:R};let U=function(){function X(S,n,r){this._vertexData=S;this._indexData=n;this._values=r}var aa=X.prototype;aa.attach=function(S){var {context:n}=S,r=w.BufferObject.createVertex(n,L.Usage.STATIC_DRAW,this._vertexData);const t=w.BufferObject.createIndex(n,L.Usage.STATIC_DRAW,this._indexData);n=new I.VertexArrayObject(n,R,P,{geometry:r},t);r=[];"ramp"===this._values.color.kind&&r.push("vvColor");"ramp"===this._values.opacity.kind&&r.push("vvOpacity");"ramp"===this._values.size.kind&&r.push("vvSize");
S=S.painter.materialManager.getProgram(G,r);this.vertexArray=n;this.program=S;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};aa.detach=function(){this.vertexArray.dispose()};v._createClass(X,[{key:"ready",get:function(){return this.program.compiled}}]);return X}();return E})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(v,F,O,w,L,I,J,E,R){function P(a,c){const e=X(c.data,c.width,c.height,a.smoothing);return a.interpolate?(g,b)=>{const f=Math.floor(g),h=Math.floor(b);if(0>f||f>=c.width||0>h||h>=c.height)return[0,0];g-=f;b-=h;const k=f<c.width-1?f+1:f,m=h<c.height-1?h+1:h;return[(e[2*(h*c.width+f)]*(1-b)+e[2*(m*c.width+f)]*b)*(1-g)+(e[2*(h*c.width+k)]*(1-b)+e[2*(m*c.width+k)]*b)*g,(e[2*(h*c.width+f)+1]*(1-b)+e[2*(m*c.width+f)+1]*b)*(1-g)+(e[2*(h*c.width+k)+1]*(1-b)+e[2*(m*c.width+k)+1]*b)*g]}:(g,b)=>{g=Math.round(g);
b=Math.round(b);return 0>g||g>=c.width||0>b||b>=c.height?[0,0]:[e[2*(b*c.width+g)],e[2*(b*c.width+g)+1]]}}function G(a,c,e,g,b,f,h,k,m){const q=[];let A=0,[C,x]=c(e,g);C*=a.velocityScale;x*=a.velocityScale;q.push({x:e,y:g,t:A,speed:Math.sqrt(C*C+x*x)});for(let N=0;N<a.verticesPerLine;N++){let [K,W]=c(e,g);K*=a.velocityScale;W*=a.velocityScale;const V=Math.sqrt(K*K+W*W);if(V<a.minSpeedThreshold)break;const ba=K/V,d=W/V;e+=ba*a.segmentLength;g+=d*a.segmentLength;A+=a.segmentLength/V;if(Math.acos(ba*
D+d*M)>a.maxTurnAngle)break;if(a.collisions){var D=Math.round(e*m);var M=Math.round(g*m);if(0>D||D>h-1||0>M||M>k-1)break;const l=f[M*h+D];if(-1!==l&&l!==b)break;f[M*h+D]=b}q.push({x:e,y:g,t:A,speed:V});D=ba;M=d}return q}function U(a,c,e,g){const b=[],f=new J,h=1/Math.max(a.lineCollisionWidth,1),k=Math.round(e*h),m=Math.round(g*h),q=new Int32Array(k*m);for(var A=0;A<q.length;A++)q[A]=-1;A=[];for(let C=0;C<g;C+=a.lineSpacing)for(let x=0;x<e;x+=a.lineSpacing)A.push({x,y:C,sort:f.getFloat()});A.sort((C,
x)=>C.sort-x.sort);for(const {x:C,y:x}of A)f.getFloat()<a.density&&(e=G(a,c,C,x,b.length,q,k,m,h),2>e.length||b.push(e));return b}function X(a,c,e,g){if(0===g)return a;const b=Math.round(3*g),f=Array(2*b+1);var h=0;for(var k=-b;k<=b;k++){var m=Math.exp(-k*k/(g*g));f[k+b]=m;h+=m}for(g=-b;g<=b;g++)f[g+b]/=h;h=new Float32Array(a.length);for(g=0;g<e;g++)for(k=0;k<c;k++){var q=m=0;for(var A=-b;A<=b;A++)if(!(0>k+A||k+A>=c)){var C=f[A+b];m+=C*a[2*(g*c+(k+A))];q+=C*a[2*(g*c+(k+A))+1]}h[2*(g*c+k)]=m;h[2*(g*
c+k)+1]=q}a=new Float32Array(a.length);for(g=0;g<c;g++)for(k=0;k<e;k++){q=m=0;for(A=-b;A<=b;A++)0>k+A||k+A>=e||(C=f[A+b],m+=C*h[2*((k+A)*c+g)],q+=C*h[2*((k+A)*c+g)+1]);a[2*(k*c+g)]=m;a[2*(k*c+g)+1]=q}return a}function aa(a,c){const e=new J;var g=a.reduce((k,m)=>k+m.length,0);g=new Float32Array(4*g);const b=Array(a.length);let f=0,h=0;for(const k of a){a=f;for(const m of k)g[4*f]=m.x,g[4*f+1]=m.y,g[4*f+2]=m.t,g[4*f+3]=m.speed,f++;b[h++]={startVertex:a,numberOfVertices:k.length,totalTime:k[k.length-
1].t,timeSeed:c?e.getFloat():0}}return{lineVertices:g,lineDescriptors:b}}function S(a,c){function e(D,M,N,K,W,V,ba,d){const l=9*m;let p=0;k[l+p++]=D;k[l+p++]=M;k[l+p++]=1;k[l+p++]=N;k[l+p++]=V;k[l+p++]=ba;k[l+p++]=K/2;k[l+p++]=W/2;k[l+p++]=d;m++;k[l+p++]=D;k[l+p++]=M;k[l+p++]=-1;k[l+p++]=N;k[l+p++]=V;k[l+p++]=ba;k[l+p++]=-K/2;k[l+p++]=-W/2;k[l+p++]=d;m++}const {lineVertices:g,lineDescriptors:b}=a;var f=a=0;for(var h of b)a+=2*h.numberOfVertices,f+=6*(h.numberOfVertices-1);const k=new Float32Array(9*
a);h=new Uint32Array(f);let m=0;a=0;for(const D of b){const {totalTime:M,timeSeed:N}=D;let K=f=null,W=null;var q=null,A=null,C=null;for(let V=0;V<D.numberOfVertices;V++){q=g[4*(D.startVertex+V)];const ba=g[4*(D.startVertex+V)+1],d=g[4*(D.startVertex+V)+2],l=g[4*(D.startVertex+V)+3];let p=null,u=null;var x=null;let H=null;0<V&&(p=q-f,u=ba-K,x=Math.sqrt(p*p+u*u),p/=x,u/=x,1<V?(A=p+A,C=u+C,x=Math.sqrt(A*A+C*C),A/=x,C/=x,x=Math.min(1/(A*p+C*u),c),A*=x,C*=x,x=-C,H=A):(x=-u,H=p),null!==x&&null!==H&&(e(f,
K,W,x,H,M,N,l),h[a++]=m-2,h[a++]=m,h[a++]=m-1,h[a++]=m,h[a++]=m+1,h[a++]=m-1));f=q;K=ba;W=d;A=p;C=u;q=l}e(f,K,W,-C,A,M,N,q)}return{vertexData:k,indexData:h}}function n(a){function c(Q,T){var B=d+p,Z=l+u,Y=Math.sqrt(B*B+Z*Z);B/=Y;Z/=Y;var ea=d*B+l*Z,da=p+H,ca=u+y;Y=Math.sqrt(da*da+ca*ca);da/=Y;ca/=Y;var fa=p*da+u*ca;Y=x;var ia=D,ja=M,ha=N;Z=-(Z/ea);B/=ea;ea=K;var ma=W,na=V,oa=ba;ca=-(ca/fa);da/=fa;fa=16*A;let la=0;for(const ra of[1,2])for(const sa of[1,2,3,4])m[fa+la++]=Y,m[fa+la++]=ia,m[fa+la++]=
ja,m[fa+la++]=ha,m[fa+la++]=ea,m[fa+la++]=ma,m[fa+la++]=na,m[fa+la++]=oa,m[fa+la++]=ra,m[fa+la++]=sa,m[fa+la++]=Q,m[fa+la++]=T,m[fa+la++]=Z/2,m[fa+la++]=B/2,m[fa+la++]=ca/2,m[fa+la++]=da/2,A++;q[C++]=A-8;q[C++]=A-7;q[C++]=A-6;q[C++]=A-7;q[C++]=A-5;q[C++]=A-6;q[C++]=A-4;q[C++]=A-3;q[C++]=A-2;q[C++]=A-3;q[C++]=A-1;q[C++]=A-2}function e(Q,T,B,Z,Y,ea){d=p;l=u;p=H;u=y;null==d&&null==l&&(d=p,l=u);if(null!=K&&null!=W){H=Q-K;y=T-W;const da=Math.sqrt(H*H+y*y);H/=da;y/=da}null!=d&&null!=l&&c(Y,ea);x=K;D=W;
M=V;N=ba;K=Q;W=T;V=B;ba=Z}function g(Q,T){d=p;l=u;p=H;u=y;null==d&&null==l&&(d=p,l=u);null!=d&&null!=l&&c(Q,T)}const {lineVertices:b,lineDescriptors:f}=a;let h=a=0;for(var k of f){const Q=k.numberOfVertices-1;a+=8*Q;h+=12*Q}const m=new Float32Array(16*a),q=new Uint32Array(h);let A=0,C=0,x,D,M,N,K,W,V,ba,d,l,p,u,H,y;for(const Q of f){y=H=u=p=l=d=ba=V=W=K=N=M=D=x=null;const {totalTime:T,timeSeed:B}=Q;for(k=0;k<Q.numberOfVertices;k++)e(b[4*(Q.startVertex+k)],b[4*(Q.startVertex+k)+1],b[4*(Q.startVertex+
k)+2],b[4*(Q.startVertex+k)+3],T,B);g(T,B)}return{vertexData:m,indexData:q}}function r(a,c){const e=c.pixels,{width:g,height:b}=c,f=new Float32Array(g*b*2),h=c.mask||new Uint8Array(g*b*2);c.mask||h.fill(255);if("vector-uv"===a)for(a=0;a<g*b;a++)f[2*a]=e[0][a],f[2*a+1]=-e[1][a];else if("vector-magdir"===a)for(a=0;a<g*b;a++){c=e[0][a];const k=L.deg2rad(e[1][a]),m=Math.sin(k-Math.PI/2);f[2*a]=Math.cos(k-Math.PI/2)*c;f[2*a+1]=m*c}return{data:f,mask:h,width:g,height:b}}async function t(a,c,e,g,b,f){const h=
{requestProjectedLocalDirections:!0,signal:f};null!=b&&(h.timeExtent=b);if("imagery"===a.type)return await a.load({signal:f}),b=a.rasterInfo.dataType,(a=await a.fetchImage(c,e,g,h))&&null!=a.pixelData&&null!=a.pixelData.pixelBlock?r(b,a.pixelData.pixelBlock):{data:new Float32Array(e*g*2),mask:new Uint8Array(e*g),width:e,height:g};await a.load({signal:f});b=a.rasterInfo.dataType;return(a=await a.fetchPixels(c,e,g,h))&&null!=a.pixelBlock?r(b,a.pixelBlock):{data:new Float32Array(e*g*2),mask:new Uint8Array(e*
g),width:e,height:g}}const z=w.getLogger("esri.views.2d.engine.flow.dataUtils");v.createAnimatedLinesData=aa;v.createFlowMesh=async function(a,c,e,g){const b=performance.now();var f=P(c,e);const h=performance.now();e=U(c,f,e.width,e.height);c=performance.now();f=aa(e,!0);e=performance.now();a="Streamlines"===a?S(f,10):n(f);f=performance.now();O("esri-2d-profiler")&&(z.info("I.1","_createFlowFieldFromData (ms)",Math.round(h-b)),z.info("I.2","_getStreamlines (ms)",Math.round(c-h)),z.info("I.3","createAnimatedLinesData (ms)",
Math.round(e-c)),z.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(f-e)),z.info("I.5","createFlowMesh (ms)",Math.round(f-b)),z.info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();I.throwIfAborted(g);return a};v.createParticlesMesh=n;v.createStreamlinesMesh=S;v.loadImagery=async function(a,c,e,g,b,f){const h=performance.now();var k=E.getInfo(c.spatialReference);if(!k)return e=await t(a,c,e,g,b,f),O("esri-2d-profiler")&&
z.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-h)),O("esri-2d-profiler")&&z.info("I.9","Number of parts",1),e;const [m,q]=k.valid,A=Math.ceil(c.width/(q-m)),C=c.width/A,x=Math.round(e/A);let D=c.xmin;const M=[];k=performance.now();for(let N=0;N<A;N++){const K=new R({xmin:D,xmax:D+C,ymin:c.ymin,ymax:c.ymax,spatialReference:c.spatialReference});M.push(t(a,K,x,g,b,f));D+=C}a=await Promise.all(M);O("esri-2d-profiler")&&z.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-
k));O("esri-2d-profiler")&&z.info("I.9","Number of parts",a.length);g={data:new Float32Array(e*g*2),mask:new Uint8Array(e*g),width:e,height:g};c=0;for(const N of a){for(a=0;a<N.height;a++)for(b=0;b<N.width;b++)c+b>=e||(g.data[2*(a*e+c+b)]=N.data[2*(a*N.width+b)],g.data[2*(a*e+c+b)+1]=N.data[2*(a*N.width+b)+1],g.mask[a*e+c+b]=N.mask[a*N.width+b]);c+=N.width}O("esri-2d-profiler")&&z.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-h));return g};Object.defineProperty(v,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(v,F,O,w){return function(L){function I(){var E=L.apply(this,arguments)||this;E.flowStyle=null;return E}v._inherits(I,L);var J=I.prototype;J.doRender=function(E){v._get(v._getPrototypeOf(I.prototype),"doRender",this).call(this,E)};J.prepareRenderPasses=function(E){const R=E.registerRenderPass({name:"flow",brushes:[F],
target:()=>this.children,drawPhase:O.WGLDrawPhase.MAP});return[...v._get(v._getPrototypeOf(I.prototype),"prepareRenderPasses",this).call(this,E),R]};v._createClass(I,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return I}(w)})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(v,F,O,w){return function(L){function I(){var E=L.apply(this,arguments)||
this;E._visualState={time:0,dvsMat3:F.create(),displayViewMat3:F.create()};return E}v._inherits(I,L);var J=I.prototype;J.dispose=function(){};J.prepareState=function(E){({context:E}=E);E.setColorMask(!0,!0,!0,!0);E.setStencilFunction(w.CompareFunction.EQUAL,0,255)};J.draw=function(E,R){const {requestRender:P,allowDelayedRender:G}=E,{displayData:U}=R;if(null!=U&&("loaded"===U.state.name&&U.attach(E),"attached"===U.state.name)){var X=U.state.resources;G&&!X.ready&&null!=P?P():(this._visualState.time=
E.time/1E3,this._visualState.dvsMat3=R.transforms.dvs,this._visualState.displayViewMat3=E.state.displayViewMat3,U.flowStyle.render(E,this._visualState,X),U.flowStyle.animated&&null!=P&&P())}};return v._createClass(I)}(O)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n){function r(t,z){const a=new X({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference});var c=t.xmax-t.xmin;const e=t.ymax-t.ymin,g=Math.abs(Math.cos(I.deg2rad(z))),b=Math.abs(Math.sin(I.deg2rad(z)));z=g*c+b*e;c=b*c+g*e;t=new n({xmin:a.x-z/2,ymin:a.y-c/2,xmax:a.x+z/2,ymax:a.y+c/2,spatialReference:t.spatialReference});t.centerAt(a);return t}O=function(t){function z(c){c=t.call(this,c)||this;c._flowDisplayObject=new S.FlowDisplayObject;
c._loading=null;return c}v._inherits(z,t);var a=z.prototype;a.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};a.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};a.update=function(c){var {flowStyle:e}=this.flowContainer;if(null==e)this._clear();else{var {extent:g,rotation:b,resolution:f,pixelRatio:h}=c.state;c=r(g,b);c.expand(1.15);e=new aa(e,c,[Math.round((c.xmax-c.xmin)/f),Math.round((c.ymax-c.ymin)/f)],h);if(null!=this._loading){if(this._loading.update(e))return;
this._loading.detach();this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(e)||(e.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},k=>{J.isAbortError(k)||(L.getLogger(this).error("A resource failed to load.",k),this._loading=null)}),this._loading=e)}};a._clear=function(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)};v._createClass(z,
[{key:"updating",get:function(){return null!=this._loading}}]);return z}(w);F.__decorate([E.property()],O.prototype,"_loading",void 0);F.__decorate([E.property()],O.prototype,"flowContainer",void 0);F.__decorate([E.property()],O.prototype,"updating",null);return O=F.__decorate([U.subclass("esri.views.2d.engine.flow.FlowStrategy")],O)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(v,F){return function(){function O(L,
I,J,E){this.state={name:"created"};this.flowStyle=L;this.extent=I;this.size=J;this.pixelRatio=E}var w=O.prototype;w.load=async function(){const L=new AbortController;this.state={name:"loading",abortController:L};this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},L.signal)}};w.attach=function(L){if("loaded"!==this.state.name)F.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");
else{var I=this.state.resources;I.attach(L);this.state={name:"attached",resources:I}}};w.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};w.update=function(L){if(!this.flowStyle.isCompatible(L.flowStyle)||!this.extent.equals(L.extent)||this.size[0]!==L.size[0]||this.size[1]!==L.size[1]||this.pixelRatio!==L.pixelRatio)return!1;this.flowStyle=L.flowStyle;
return!0};return v._createClass(O)}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(v,F,O,w,L,I){I=function(J){function E(){var P=J.apply(this,arguments)||this;P._displayData=null;return P}F._inherits(E,J);var R=E.prototype;R.clear=function(){null!=this._displayData&&(this._displayData.detach(),this._displayData=
null,this.requestRender())};R.setTransform=function(P){var {displayData:G}=this;if(null!=G){var U=[0,0];P.toScreen(U,[G.extent.xmin,G.extent.ymax]);G=(G.extent.xmax-G.extent.xmin)/G.size[0]/P.resolution;var X=O.deg2rad(P.rotation),{dvs:aa}=this.transforms;w.fromTranslation(aa,[-1,1,0]);w.scale(aa,aa,[2/(P.size[0]*P.pixelRatio),-2/(P.size[1]*P.pixelRatio),1]);w.translate(aa,aa,[U[0],U[1],0]);w.rotate(aa,aa,X);w.scale(aa,aa,[G*P.pixelRatio,G*P.pixelRatio,1])}};R._createTransforms=function(){return{dvs:L.create()}};
F._createClass(E,[{key:"displayData",get:function(){return this._displayData},set:function(P){this._displayData=P;this.requestRender()}}]);return E}(I.DisplayObject);v.FlowDisplayObject=I;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n,r){const t=w.ofType({key:"type",base:null,typeMap:{rect:S,path:r,geometry:n}});v.LayerView2DMixin=z=>{z=function(a){function c(){var g=a.apply(this,arguments)||this;g.attached=!1;g.clips=new t;g.lastUpdateId=-1;g.moving=!1;g.updateRequested=!1;g.visibleAtCurrentScale=!1;g.highlightOptions=null;return g}F._inherits(c,a);var e=c.prototype;e.initialize=function(){const g=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&g&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new I("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new X.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([J.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},J.syncAndInitial),
J.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},J.syncAndInitial),J.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},J.syncAndInitial),J.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},J.syncAndInitial),J.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,J.syncAndInitial),J.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},J.syncAndInitial),J.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},J.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};e.destroy=function(){this.processDetach();this.updateRequested=!1};e.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};e.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};e.isVisibleAtScale=function(g){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:f,maxScale:h}=b;return(0===f||g<=f)&&(0===h||g>=h)};e.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};e.processUpdate=function(g){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",g),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(g)))};e.hitTest=function(g,b){return Promise.resolve(null)};e.supportsSpatialReference=function(g){return!0};
e.canResume=function(){return this.spatialReferenceSupported?F._get(F._getPrototypeOf(c.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};e.getSuspendInfo=function(){const g=F._get(F._getPrototypeOf(c.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,f=this.visibleAtCurrentScale;b&&(g.spatialReferenceNotSupported=b);f&&(g.outsideScaleRange=f);return g};e.addAttachHandles=function(g){this.addHandles(g,"attach")};F._createClass(c,[{key:"spatialReferenceSupported",
get:function(){const g=this.view?.spatialReference;return null==g||this.supportsSpatialReference(g)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return c}(z);O.__decorate([E.property()],z.prototype,"attached",void 0);O.__decorate([E.property({type:t,set(a){a=L.referenceSetter(a,this._get("clips"),t);this._set("clips",a)}})],z.prototype,"clips",void 0);O.__decorate([E.property()],
z.prototype,"container",void 0);O.__decorate([E.property()],z.prototype,"moving",void 0);O.__decorate([E.property({readOnly:!0})],z.prototype,"spatialReferenceSupported",null);O.__decorate([E.property({readOnly:!0})],z.prototype,"updateParameters",void 0);O.__decorate([E.property()],z.prototype,"updateRequested",void 0);O.__decorate([E.property()],z.prototype,"updating",null);O.__decorate([E.property()],z.prototype,"view",void 0);O.__decorate([E.property({readOnly:!0})],z.prototype,"visibleAtCurrentScale",
void 0);O.__decorate([E.property({type:aa})],z.prototype,"highlightOptions",void 0);return z=O.__decorate([U.subclass("esri.views.2d.layers.LayerView2D")],z)};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(v,F,O,w,L,I,J,E){var R;w=R=function(P){function G(X){X=P.call(this,X)||this;X.type="rect";X.left=null;X.right=null;X.top=null;X.bottom=null;return X}v._inherits(G,P);var U=G.prototype;U.clone=function(){return new R({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};U.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return v._createClass(G)}(E);F.__decorate([O.property({type:[Number,
String],json:{write:!0}})],w.prototype,"left",void 0);F.__decorate([O.property({type:[Number,String],json:{write:!0}})],w.prototype,"right",void 0);F.__decorate([O.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);F.__decorate([O.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);return w=R=F.__decorate([J.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(v,F,O,w,L,I,J,E){O=function(R){function P(){return R.apply(this,arguments)||this}v._inherits(P,R);v._createClass(P,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return P}(O.JSONSupport);F.__decorate([w.property({readOnly:!0})],O.prototype,"version",null);return O=F.__decorate([E.subclass("esri.views.layers.support.ClipArea")],O)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X){var aa;O={base:R,key:"type",typeMap:{extent:U,polygon:X}};G=aa=function(S){function n(t){t=S.call(this,t)||this;t.type="geometry";t.geometry=null;return t}v._inherits(n,S);var r=n.prototype;r.clone=function(){return new aa({geometry:this.geometry?.clone()??null})};r.commitVersionProperties=function(){this.commitProperty("geometry")};return v._createClass(n)}(G);F.__decorate([w.property({types:O,json:{read:P.fromJSON,write:!0}})],G.prototype,"geometry",void 0);return G=
aa=F.__decorate([E.subclass("esri.views.layers.support.Geometry")],G)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(v,F,O,w,L,I,J,E){w=function(R){function P(G){G=R.call(this,G)||this;G.type="path";G.path=[];
return G}v._inherits(P,R);P.prototype.commitVersionProperties=function(){this.commitProperty("path")};return v._createClass(P)}(E);F.__decorate([O.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);return w=F.__decorate([J.subclass("esri.views.layers.support.Path")],w)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G){O=function(U){function X(){return U.apply(this,arguments)||this}v._inherits(X,U);var aa=X.prototype;aa.doRender=function(S){S.drawPhase===R.WGLDrawPhase.HIGHLIGHT&&v._get(v._getPrototypeOf(X.prototype),"doRender",this).call(this,S)};aa.renderChildren=function(S){this.attributeView.update();if(this.children.some(r=>r.hasData)){this.attributeView.bindTextures(S.context);v._get(v._getPrototypeOf(X.prototype),"renderChildren",this).call(this,S);var {painter:n}=S;n=n.effects.highlight;
n.bind(S);S.context.setColorMask(!0,!0,!0,!0);S.context.clear(G.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(S,n.defines.concat(["highlightAll"]));n.draw(S);n.unbind()}};return v._createClass(X)}(P);return O=F.__decorate([E.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],O)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n){w=function(r){function t(){var a=r.apply(this,arguments)||this;a.attached=!1;a.container=new aa.Container;a.updateRequested=!1;a.type="imagery";a._bitmapView=new X.BitmapContainer;return a}v._inherits(t,r);var z=t.prototype;z.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};z.update=function(a){this.strategy.update(a).catch(c=>{I.isAbortError(c)||L.getLogger(this).error(c)})};z.hitTest=function(a){return new O({attributes:{},
geometry:a.clone(),layer:this.layer})};z.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new n({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};z.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();
this.container.removeAllChildren();this.updateRequested=!1};z.redraw=function(){this.strategy.updateExports(async a=>{const {source:c}=a;if(c&&!(c instanceof ImageBitmap)){var e=await this.layer.applyRenderer({extent:c.extent,pixelBlock:c.originalPixelBlock??c.pixelBlock});c.filter=g=>this.layer.pixelFilter?this.layer.applyFilter(g):{...e,extent:c.extent}}}).catch(a=>{I.isAbortError(a)||L.getLogger(this).error(a)})};z.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};
z.isUpdating=function(){return this.strategy.updating||this.updateRequested};z.getPixelData=function(){if(this.updating)return null;var a=this.strategy.bitmaps;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){const c=this.view.extent;a=a.map(e=>e.source).filter(e=>e.extent&&e.extent.intersects(c)).map(e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}));a=U.mosaicPixelData(a,c);return null!=a?{extent:a.extent,pixelBlock:a.pixelBlock}:
null}return null};z._fetchImage=async function(a,c,e,g){g=g||{};g.timeExtent=this.timeExtent;g.requestAsImageElement=!0;g.returnImageBitmap=!0;a=await this.layer.fetchImage(a,c,e,g);if(a.imageBitmap)return a.imageBitmap;g=await this.layer.applyRenderer(a.pixelData,{signal:g.signal});g=new S(g.pixelBlock,g.extent?.clone(),a.pixelData.pixelBlock);g.filter=b=>this.layer.applyFilter(b);return g};v._createClass(t,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return t}(w);
F.__decorate([J.property()],w.prototype,"attached",void 0);F.__decorate([J.property()],w.prototype,"container",void 0);F.__decorate([J.property()],w.prototype,"layer",void 0);F.__decorate([J.property()],w.prototype,"strategy",void 0);F.__decorate([J.property()],w.prototype,"timeExtent",void 0);F.__decorate([J.property()],w.prototype,"view",void 0);F.__decorate([J.property()],w.prototype,"updateRequested",void 0);F.__decorate([J.property()],w.prototype,"updating",null);F.__decorate([J.property()],
w.prototype,"type",void 0);return w=F.__decorate([G.subclass("esri.views.2d.layers.imagery.ImageryView2D")],w)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(v,F,O){function w(a){return null!=a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function L(a,c,e,g,b){const f=a.length;b=F.createEmptyBand(b,f);if(c)for(let h=0;h<f;h++)c[h]&&(b[h]=e[a[h]-g]);else for(c=0;c<f;c++)b[c]=
e[a[c]-g];return b}function I(a,c,e,g){const b=null!=e&&2<=e.length?new Set(e):null;e=1===e?.length?e[0]:null;const f=!!c?.length;for(let h=0;h<a.length;h++)if(g[h]){const k=a[h];if(f){let m=!1;for(let q=0;q<c.length;q+=2)if(k>=c[q]&&k<=c[q+1]){m=!0;break}m||(g[h]=0)}g[h]&&(k===e||b?.has(k))&&(g[h]=0)}}function J(a,c){const e=a[0].length;for(let g=0;g<e;g++)if(c[g]){let b=!1;for(let f=0;f<a.length;f++)if(a[f][g]){b=!0;break}b||(c[g]=0)}}function E(a,c){const e=a[0].length;for(let g=0;g<e;g++)if(c[g]){let b=
!1;for(let f=0;f<a.length;f++)if(0===a[f][g]){b=!0;break}b&&(c[g]=0)}}function R(a,c,e,g,b,f,h,k){return{xmin:b<=e*a?0:b<e*a+a?b-e*a:a,ymin:f<=g*c?0:f<g*c+c?f-g*c:c,xmax:b+h<=e*a?0:b+h<e*a+a?b+h-e*a:a,ymax:f+k<=g*c?0:f+k<g*c+c?f+k-g*c:c}}function P(a,c,e,g,b,f){const {width:h,height:k}=e.block,{x:m,y:q}=e.offset,{width:A,height:C}=e.mosaic;e=R(h,k,g,b,m,q,A,C);let x=0;var D=0;if(f){var M=f.hasGCSSShiftTransform?360:f.halfWorldWidth??0,N=h*f.resolutionX;const K=f.startX+g*N;K<M&&K+N>M?D=f.rightPadding:
K>=M&&(x=f.leftMargin-f.rightPadding,D=0)}e.xmax-=D;if("number"===typeof c)for(f=e.ymin;f<e.ymax;f++)for(D=(b*k+f-q)*A+(g*h-m)+x,M=e.xmin;M<e.xmax;M++)a[D+M]=c;else for(f=e.ymin;f<e.ymax;f++)for(D=(b*k+f-q)*A+(g*h-m)+x,M=f*h,N=e.xmin;N<e.xmax;N++)a[D+N]=c[M+N]}function G(a,c,e={}){const {clipOffset:g,clipSize:b,alignmentInfo:f,blockWidths:h}=e;if(h)return U(a,c,{blockWidths:h});var k=a.find(ba=>w(ba));if(null==k)return null;e=b?b.width:c.width;const m=b?b.height:c.height;var q=k.width,A=k.height;
const C=c.width/q,x=c.height/A;c={offset:g||{x:0,y:0},mosaic:b||c,block:{width:q,height:A}};q=k.pixelType;var D=F.getPixelArrayConstructor(q);k=k.pixels.length;A=[];for(var M=0;M<k;M++){var N=new D(e*m);for(var K=0;K<x;K++)for(var W=0;W<C;W++){var V=a[K*C+W];w(V)&&(V=V.pixels[M],P(N,V,c,W,K,f))}A.push(N)}D=a.some(ba=>null==ba||null!=ba.mask&&0<ba.mask.length);N=a.some(ba=>null!=ba&&ba.bandMasks&&1<ba.bandMasks.length);D=D?new Uint8Array(e*m):void 0;N=N?[]:void 0;if(D){for(M=0;M<x;M++)for(K=0;K<C;K++)W=
a[M*C+K],V=null!=W?W.mask:null,null!=V?P(D,V,c,K,M,f):W?P(D,255,c,K,M,f):P(D,0,c,K,M,f);if(N)for(M=0;M<k;M++){K=new Uint8Array(e*m);for(W=0;W<x;W++)for(V=0;V<C;V++){const ba=a[W*C+V],d=ba?.bandMasks?.[M]??ba?.mask;null!=d?P(K,d,c,V,W,f):ba?P(K,255,c,V,W,f):P(K,0,c,V,W,f)}N.push(K)}}a=new F({width:e,height:m,pixels:A,pixelType:q,bandMasks:N,mask:D});a.updateStatistics();return a}function U(a,c,e){const g=a.find(K=>null!=K);if(null==g)return null;var b=a.some(K=>null!=K?!!K.mask:!0);const {width:f,
height:h}=c;c=b?new Uint8Array(f*h):null;({blockWidths:e}=e);const k=[],m=g.getPlaneCount(),q=F.getPixelArrayConstructor(g.pixelType);if(b)for(let K=0,W=0;K<a.length;W+=e[K],K++)if(b=a[K],w(b)){var A=b.mask;for(var C=0;C<h;C++)for(var x=0;x<e[K];x++)c[C*f+x+W]=null==A?255:A[C*b.width+x]}A=(b=a.some(K=>null!=K&&K.bandMasks&&1<K.bandMasks.length))?[]:void 0;C=f*h;for(x=0;x<m;x++){const K=new q(C),W=b?new Uint8Array(C):void 0;for(let V=0,ba=0;V<a.length;ba+=e[V],V++){const d=a[V];if(w(d)){var D=d.pixels[x];
if(null!=D){for(var M=0;M<h;M++)for(var N=0;N<e[V];N++)K[M*f+N+ba]=D[M*d.width+N];if(W)for(D=d.bandMasks?.[x]??d.mask,M=0;M<h;M++)for(N=0;N<e[V];N++)W[M*f+N+ba]=D?D[M*d.width+N]:255}}}k.push(K);A&&W&&A.push(W)}a=new F({width:f,height:h,mask:c,bandMasks:A,pixels:k,pixelType:g.pixelType});a.updateStatistics();return a}function X(a){if(!w(a))return null;const c=a.clone(),{width:e,height:g,pixels:b}=a;var f=b[0];const h=c.pixels[0];a=a.mask;for(let q=2;q<g-1;q++){const A=new Map;for(var k=q-2;k<q+2;k++)for(var m=
0;4>m;m++){const C=k*e+m;n(A,f[C],a?a[C]:1)}h[q*e]=aa(A);h[q*e+1]=h[q*e+2]=h[q*e];for(k=3;k<e-1;k++)m=(q-2)*e+k+1,n(A,f[m],a?a[m]:1),m=(q-1)*e+k+1,n(A,f[m],a?a[m]:1),m=q*e+k+1,n(A,f[m],a?a[m]:1),m=(q+1)*e+k+1,n(A,f[m],a?a[m]:1),m=(q-2)*e+k-3,S(A,f[m],a?a[m]:1),m=(q-1)*e+k-3,S(A,f[m],a?a[m]:1),m=q*e+k-3,S(A,f[m],a?a[m]:1),m=(q+1)*e+k-3,S(A,f[m],a?a[m]:1),h[q*e+k]=aa(A);h[q*e+k+1]=h[q*e+k]}for(f=0;f<e;f++)h[f]=h[e+f]=h[2*e+f],h[(g-1)*e+f]=h[(g-2)*e+f];c.updateStatistics();return c}function aa(a){if(0===
a.size)return 0;let c=0,e=-1,g=0;const b=a.keys();let f=b.next();for(;!f.done;)g=a.get(f.value),g>c&&(e=f.value,c=g),f=b.next();return e}function S(a,c,e){0!==e&&(e=a.get(c),1===e?a.delete(c):a.set(c,e-1))}function n(a,c,e){0!==e&&a.set(c,a.has(c)?a.get(c)+1:1)}function r(a,c,e){let {x:g,y:b}=c;const {width:f,height:h}=e;if(0===g&&0===b&&h===a.height&&f===a.width)return a;const {width:k,height:m}=a;c=Math.max(0,b);const q=Math.max(0,g),A=Math.min(g+f,k),C=Math.min(b+h,m);if(0>A||0>C||!w(a))return null;
g=Math.max(0,-g);b=Math.max(0,-b);var {pixels:x}=a,D=f*h,M=x.length;const N=[];for(var K=0;K<M;K++){var W=x[K],V=F.createEmptyBand(a.pixelType,D);for(let ba=c;ba<C;ba++){const d=ba*k;let l=(ba+b-c)*f+g;for(let p=q;p<A;p++)V[l++]=W[d+p]}N.push(V)}x=new Uint8Array(D);D=a.mask;for(M=c;M<C;M++)for(K=M*k,W=(M+b-c)*f+g,V=q;V<A;V++)x[W++]=D?D[K+V]:1;a=new F({width:e.width,height:e.height,pixelType:a.pixelType,pixels:N,mask:x});a.updateStatistics();return a}function t(a,c=!0){if(!w(a))return null;const {pixels:e,
width:g,height:b,mask:f,pixelType:h}=a;a=[];const k=Math.round(g/2),m=Math.round(b/2),q=b-1,A=g-1;for(var C=0;C<e.length;C++){var x=e[C],D=F.createEmptyBand(h,k*m),M=0;for(var N=0;N<b;N+=2)for(var K=0;K<g;K+=2){var W=x[N*g+K];if(c){var V=K===A?W:x[N*g+K+1];const ba=N===q?W:x[N*g+K+g],d=K===A?ba:N===q?V:x[N*g+K+g+1];D[M++]=(W+V+ba+d)/4}else D[M++]=W}a.push(D)}C=null;if(null!=f)for(C=new Uint8Array(k*m),x=0,D=0;D<b;D+=2)for(M=0;M<g;M+=2)N=f[D*g+M],c?(K=M===A?N:f[D*g+M+1],W=D===q?N:f[D*g+M+g],V=M===
A?W:D===q?K:f[D*g+M+g+1],C[x++]=N*K*W*V?1:0):C[x++]=N;return new F({width:k,height:m,pixelType:h,pixels:a,mask:C})}function z(a,c,e,g,b=0){const {width:f,height:h}=a,{width:k,height:m}=c;a=g.cols;g=g.rows;c=Math.ceil(k/a-.1/a);const q=Math.ceil(m/g-.1/g);let A,C,x,D,M;const N=c*a;var K=N*q*g;const W=new Float32Array(K),V=new Float32Array(K),ba=new Uint32Array(K),d=new Uint32Array(K);let l=0,p,u;for(let Q=0;Q<q;Q++)for(let T=0;T<c;T++){var H=12*(Q*c+T);K=e[H];A=e[H+1];C=e[H+2];x=e[H+3];D=e[H+4];M=
e[H+5];for(var y=0;y<g;y++){l=(Q*g+y)*N+T*a;u=(y+.5)/g;for(let B=0;B<y;B++)p=(B+.5)/a,W[l+B]=(K*p+A*u+C)*f+b,V[l+B]=(x*p+D*u+M)*h+b,ba[l+B]=Math.floor(W[l+B]),d[l+B]=Math.floor(V[l+B])}H+=6;K=e[H];A=e[H+1];C=e[H+2];x=e[H+3];D=e[H+4];M=e[H+5];for(H=0;H<g;H++)for(l=(Q*g+H)*N+T*a,u=(H+.5)/g,y=H;y<a;y++)p=(y+.5)/a,W[l+y]=(K*p+A*u+C)*f+b,V[l+y]=(x*p+D*u+M)*h+b,ba[l+y]=Math.floor(W[l+y]),d[l+y]=Math.floor(V[l+y])}return{offsets_x:W,offsets_y:V,offsets_xi:ba,offsets_yi:d,gridWidth:N}}v.NoDataInterpretation=
void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(v.NoDataInterpretation||(v.NoDataInterpretation={}));v.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(v.MissingBandAction||(v.MissingBandAction={}));v.MAX_MAP_SIZE_GPU=6;v.approximateTransform=function(a,c,e,g,b="nearest"){if(!w(a))return null;"majority"===b&&(a=X(a));const {pixels:f,mask:h,bandMasks:k,pixelType:m}=a,q=a.width;var A=a.height;const C=F.getPixelArrayConstructor(m),x=
f.length,{width:D,height:M}=c;a=!1;for(var N=0;N<e.length;N+=3)-1===e[N]&&-1===e[N+1]&&-1===e[N+2]&&(a=!0);const {offsets_x:K,offsets_y:W,offsets_xi:V,offsets_yi:ba,gridWidth:d}=z({width:q,height:A},c,e,g,"majority"===b?.5:0);let l;c=(u,H,y,Q)=>{const T=u instanceof Float32Array||u instanceof Float64Array?0:.5;for(let B=0;B<M;B++){l=B*d;for(let Z=0;Z<D;Z++){if(0>K[l]||0>W[l])u[B*D+Z]=0;else if(Q)u[B*D+Z]=H[V[l]+ba[l]*q];else{const Y=Math.floor(K[l]),ea=Math.floor(W[l]),da=Math.ceil(K[l]),ca=Math.ceil(W[l]),
fa=K[l]-Y,ia=W[l]-ea;u[B*D+Z]=!y||y[Y+ea*q]&&y[da+ea*q]&&y[Y+ca*q]&&y[da+ca*q]?(1-ia)*((1-fa)*H[Y+ea*q]+fa*H[da+ea*q])+ia*((1-fa)*H[Y+ca*q]+fa*H[da+ca*q])+T:H[V[l]+ba[l]*q]}l++}}};e=[];g=k?.length===x;A=[];for(N=0;N<x;N++){if(g){var p=new Uint8Array(D*M);c(p,k[N],k[N],!0);A.push(p)}p=new C(D*M);c(p,f[N],g?k[N]:h,"nearest"===b||"majority"===b);e.push(p)}b=new F({width:D,height:M,pixelType:m,pixels:e,bandMasks:g?A:void 0});if(null!=h)b.mask=new Uint8Array(D*M),c(b.mask,h,h,!0);else if(a)for(b.mask=
new Uint8Array(D*M),a=0;a<D*M;a++)b.mask[a]=0>K[a]||0>W[a]?0:1;b.updateStatistics();return b};v.clip=r;v.colorize=function(a,c){if(!w(a)||!c||!c.indexedColormap&&!c.indexed2DColormap)return a;const e=a.clone();var g=e.pixels;let b=e.mask;const f=e.width*e.height;if(1!==g.length)return a;const {indexedColormap:h,indexed2DColormap:k,offset:m,alphaSpecified:q}=c;a=0;g=g[0];c=new Uint8Array(g.length);const A=new Uint8Array(g.length),C=new Uint8Array(g.length);var x=0;if(h){const D=h.length-1;if(null!=
b)for(a=0;a<f;a++)b[a]&&(x=4*(g[a]-m),x<m||x>D?b[a]=0:(c[a]=h[x],A[a]=h[x+1],C[a]=h[x+2],b[a]=h[x+3]));else{b=new Uint8Array(f);for(a=0;a<f;a++)x=4*(g[a]-m),x<m||x>D?b[a]=0:(c[a]=h[x],A[a]=h[x+1],C[a]=h[x+2],b[a]=h[x+3]);e.mask=b}}else if(k)if(null!=b)for(a=0;a<f;a++)b[a]&&(x=k[g[a]],c[a]=x[0],A[a]=x[1],C[a]=x[2],b[a]=x[3]);else{b=new Uint8Array(f);for(a=0;a<f;a++)x=k[g[a]],c[a]=x[0],A[a]=x[1],C[a]=x[2],b[a]=x[3];e.mask=b}e.pixels=[c,A,C];e.statistics=null;e.pixelType="u8";e.maskIsAlpha=q;return e};
v.compositeBands=function(a){if(!a?.length||a.some(m=>!w(m)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:c,height:e,pixelType:g}=a[0];if(a.some(m=>m.width!==c||m.height!==e))return null;const b=a.map(({mask:m})=>m).filter(m=>null!=m);let f=null;b.length&&(f=new Uint8Array(c*e),f.set(b[0]),1<b.length&&E(b.slice(1),f));const h=[];a.forEach(({pixels:m})=>h.push(...m));const k=[];a.map(({statistics:m})=>m).filter(m=>m?.length).forEach(m=>k.push(...m));return new F({pixelType:g,
width:c,height:e,mask:f,pixels:h,statistics:k.length?k:null})};v.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((q,A)=>q[0]-A[0]);var e=0;0>c[0][0]&&(e=c[0][0]);var g=Math.max(256,c[c.length-1][0]-e+1),b=new Uint8Array(4*g),f=[],h=0,k=0,m=5===c[0].length;if(65536<g)return c.forEach(q=>{f[q[0]-e]=m?q.slice(1):q.slice(1).concat([255])}),{indexed2DColormap:f,offset:e,alphaSpecified:m};if(a.fillUnspecified)for(a=c[k],h=a[0]-e;h<g;h++)b[4*h]=a[1],b[4*h+1]=a[2],b[4*h+
2]=a[3],b[4*h+3]=m?a[4]:255,h===a[0]-e&&(a=k===c.length-1?a:c[++k]);else for(h=0;h<c.length;h++)a=c[h],k=4*(a[0]-e),b[k]=a[1],b[k+1]=a[2],b[k+2]=a[3],b[k+3]=m?a[4]:255;return{indexedColormap:b,offset:e,alphaSpecified:m}}}};v.createMaskLUT=function(a,c,e){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var g=a.includes("16")?65536:256;a=a.includes("s")?-g/2:0;g=new Uint8Array(g);if(c)for(let f=0;f<c.length;f++){var b=Math.ceil(c[2*f]-a);const h=Math.floor(c[2*f+1]-a);for(;b<=h;b++)g[b]=255}else g.fill(255);
if(e)for(c=0;c<e.length;c++)g[e[c]-a]=0;return{lut:g,offset:a}};v.createRemapLUT=function(a){const {srcPixelType:c,inputRanges:e,outputValues:g,allowUnmatched:b,noDataRanges:f,isLastInputRangeInclusive:h,outputPixelType:k}=a;if("u8"!==c&&"s8"!==c&&"u16"!==c&&"s16"!==c)return null;var m=c.includes("16")?65536:256;a=c.includes("s")?-m/2:0;const q=F.createEmptyBand(k,m);m=new Uint8Array(m);b&&m.fill(255);const [A,C]=O.getPixelValueRange(k);if(e?.length&&g?.length){var x=e.map(K=>K-1E-6);x[0]=e[0];h&&
(x[x.length-1]=e[e.length-1]);for(var D=0;D<x.length;D++){var M=g[D]>C?C:g[D]<A?A:g[D],N=Math.ceil(x[2*D]-a);const K=Math.floor(x[2*D+1]-a);for(;N<=K;N++)q[N]=M,m[N]=255}}if(f?.length)for(x=0;x<f.length;x++)for(M=Math.ceil(f[2*x]-a),D=Math.floor(f[2*x+1]-a);M<=D;M++)m[M]=0;return{lut:q,offset:a,mask:m}};v.extractBands=function(a,c){return c?.length&&w(a)?a.extractBands(c):a};v.getClipBounds=R;v.getLocalArithmeticNorthRotations=function(a,c){const {coefficients:e,spacing:g}=c,{offsets_x:b,offsets_y:f,
gridWidth:h}=z(a,a,e,{rows:g[0],cols:g[1]}),{width:k,height:m}=a;a=new Float32Array(k*m);c=180/Math.PI;for(let C=0;C<m;C++)for(let x=0;x<k;x++){var q=C*h+x,A=0===C?q:q-h;const D=C===m-1?q:q+h;q=b[A]-b[D];A=f[D]-f[A];isNaN(q)||isNaN(A)?a[C*k+x]=90:(A=Math.atan2(A,q)*c,A=(360+A)%360,a[C*k+x]=A)}return a};v.interpolateOffsets=z;v.isValidPixelBlock=w;v.lookupBandValues=L;v.lookupPixels=function(a,c){if(!w(a))return null;const {pixels:e,mask:g}=a,b=e.length;let f=c.lut;const {offset:h}=c;f&&1===f[0].length&&
(f=e.map(()=>f));const k=[];c=c.outputPixelType||"u8";for(let m=0;m<b;m++){const q=L(e[m],g,f[m],h||0,c);k.push(q)}a=new F({width:a.width,height:a.height,pixels:k,mask:g,pixelType:c});a.updateStatistics();return a};v.mask=function(a,c){if(!w(a))return null;const {width:e,height:g,pixels:b}=a;var f=e*g;const h=new Uint8Array(f);a.mask?h.set(a.mask):h.fill(255);a=b.length;const {includedRanges:k,noDataValues:m,outputPixelType:q,matchAll:A,lookups:C}=c;if(C){f=[];for(c=0;c<a;c++){var x=C[c];x=L(b[c],
h,x.lut,x.offset||0,"u8");f.push(x)}1===f.length?h.set(f[0]):A?J(f,h):E(f,h)}else if(A){c=[];for(x=0;x<a;x++){const D=new Uint8Array(f);D.set(h);I(b[x],k?.slice(2*x,2*x+2),m?.[x],D);c.push(D)}1===c.length?h.set(c[0]):J(c,h)}else for(f=0;f<a;f++)I(b[f],k?.slice(2*f,2*f+2),m?.[f],h);return new F({width:e,height:g,pixelType:q,pixels:b,mask:h})};v.mosaic=G;v.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var e=a.find(C=>C.pixelBlock);if(!e||null==e.pixelBlock)return null;var g=(e.extent.xmax-
e.extent.xmin)/e.pixelBlock.width;const b=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,f=.01*Math.min(g,b),h=a.sort((C,x)=>Math.abs(C.extent.ymax-x.extent.ymax)>f?x.extent.ymax-C.extent.ymax:Math.abs(C.extent.xmin-x.extent.xmin)>f?C.extent.xmin-x.extent.xmin:0);var k=Math.min.apply(null,h.map(C=>C.extent.xmin));const m=Math.min.apply(null,h.map(C=>C.extent.ymin)),q=Math.max.apply(null,h.map(C=>C.extent.xmax)),A=Math.max.apply(null,h.map(C=>C.extent.ymax));a={x:Math.round((c.xmin-k)/g),y:Math.round((A-
c.ymax)/b)};k={width:Math.round((q-k)/g),height:Math.round((A-m)/b)};g={width:Math.round((c.xmax-c.xmin)/g),height:Math.round((c.ymax-c.ymin)/b)};if(Math.round(k.width/e.pixelBlock.width)*Math.round(k.height/e.pixelBlock.height)!==h.length||0>a.x||0>a.y||k.width<g.width||k.height<g.height)return null;e=h.map(C=>C.pixelBlock);e=G(e,k,{clipOffset:a,clipSize:g});return{extent:c,pixelBlock:e}};v.remap=function(a,c){if(!w(a))return null;const {width:e,height:g}=a,{inputRanges:b,outputValues:f,outputPixelType:h,
noDataRanges:k,allowUnmatched:m,isLastInputRangeInclusive:q}=c;c=a.pixels[0];const A=F.createEmptyBand(h,c.length),C=a.mask,x=new Uint8Array(e*g);C?x.set(C):x.fill(255);const D=a.pixelType.startsWith("f")?1E-6:0;a=b.map(l=>l-D);a[0]=b[0];a[a.length-1]=b[b.length-1]+(q?1E-6:0);var M=b.length/2;const [N,K]=O.getPixelValueRange(h);for(var W=0;W<g;W++)for(var V=0;V<e;V++){var ba=W*e+V;if(x[ba]){var d=c[ba];let l=!1;for(let p=M-1;0<=p;p--)if(d===a[2*p]||d>a[2*p]&&d<a[2*p+1]){A[ba]=f[p];l=!0;break}l||(m?
A[ba]=d>K?K:d<N?N:d:x[ba]=0)}}if(a=k?.length)for(M=0;M<g;M++)for(W=0;W<e;W++)if(V=M*e+W,!C||C[V])for(ba=c[V],d=0;d<a;d+=2)if(ba>=k[d]&&ba<=k[d+1]){A[V]=0;x[V]=0;break}return new F({width:e,height:g,pixelType:h,pixels:[A],mask:x})};v.remapColor=function(a,c){if(!w(a))return null;a=a.clone();var {pixels:e}=a;const g=a.width*a.height,b=c.length,f=Math.floor(b/2),h=c[Math.floor(f)];e=e[0];let k,m,q,A,C,x,D=!1;const M=new Uint8Array(g),N=new Uint8Array(g),K=new Uint8Array(g);let W=a.mask;const V=4===c[0].mappedColor.length;
W||(W=new Uint8Array(g),W.fill(V?255:1),a.mask=W);for(C=0;C<g;C++)if(W[C]){k=e[C];D=!1;x=f;m=h;q=0;for(A=b-1;1<A-q;){if(k===m.value){D=!0;break}k>m.value?q=x:A=x;x=Math.floor((q+A)/2);m=c[Math.floor(x)]}D||(k===c[q].value?(m=c[q],D=!0):k===c[A].value?(m=c[A],D=!0):k<c[q].value?(D=!1,m=null):k>c[q].value&&(k<c[A].value?(m=c[q],D=!0):A===b-1?(D=!1,m=null):(m=c[A],D=!0)));D?(M[C]=m.mappedColor[0],N[C]=m.mappedColor[1],K[C]=m.mappedColor[2],W[C]=m.mappedColor[3]):M[C]=N[C]=K[C]=W[C]=0}a.pixels=[M,N,K];
a.mask=W;a.pixelType="u8";a.maskIsAlpha=V;return a};v.resampleByMajority=X;v.setValidBoundary=function(a,c,e){if(!w(a))return null;const {width:g,height:b}=a,f=c.x;c=c.y;const h=e.width+f;e=e.height+c;if(0>f||0>c||h>g||e>b||0===f&&0===c&&h===g&&e===b)return a;a.mask||(a.mask=new Uint8Array(g*b));const k=a.mask;for(let m=0;m<b;m++){const q=m*g;for(let A=0;A<g;A++)k[q+A]=m<c||m>=e||A<f||A>=h?0:1}a.updateStatistics();return a};v.split=function(a,c,e){if(!w(a))return null;const {width:g,height:b}=c;let {width:f,
height:h}=a;const k=new Map,m={x:0,y:0};e=null==e?1:1+e;for(let q=0;q<e;q++){const A=Math.ceil(f/g),C=Math.ceil(h/b);for(let x=0;x<C;x++){m.y=x*b;for(let D=0;D<A;D++){m.x=D*g;const M=r(a,m,c);k.set(`${q}/${x}/${D}`,M)}}q<e-1&&(a=t(a));f=Math.round(f/2);h=Math.round(h/2)}return k};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G){var U;w=U=function(X){function aa(n){n=X.call(this,n)||this;n.width=null;n.height=null;n.pixelType="f32";n.validPixelCount=null;n.mask=null;n.maskIsAlpha=!1;n.premultiplyAlpha=!1;n.statistics=null;n.depthCount=1;return n}v._inherits(aa,X);aa.createEmptyBand=function(n,r){return new (U.getPixelArrayConstructor(n))(r)};aa.getPixelArrayConstructor=function(n){let r;switch(n){case "u1":case "u2":case "u4":case "u8":r=Uint8Array;break;case "u16":r=Uint16Array;break;case "u32":r=
Uint32Array;break;case "s8":r=Int8Array;break;case "s16":r=Int16Array;break;case "s32":r=Int32Array;break;case "f32":r=Float32Array;break;case "f64":r=Float64Array;break;case "c64":case "c128":case "unknown":r=Float32Array}return r};var S=aa.prototype;S.castPixelType=function(n){if(!n)return"f32";n=n.toLowerCase();["u1","u2","u4"].includes(n)?n="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(n)||(n="f32");return n};S.getPlaneCount=function(){return this.pixels?.length};S.addData=
function(n){if(!n.pixels||n.pixels.length!==this.width*this.height)throw new O("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(n.pixels);this.statistics.push(n.statistics??new P.SimpleBandStatistics)};S.getAsRGBA=function(){const n=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(n);
break;default:this._fillFrom8Bit(n)}return new Uint8ClampedArray(n)};S.getAsRGBAFloat=function(){const n=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(n);return n};S.updateStatistics=function(){if(this.pixels){this.statistics=this.pixels.map(t=>this._calculateBandStatistics(t,this.mask));var n=this.mask,r=0;if(null!=n)for(let t=0;t<n.length;t++)n[t]&&r++;else r=this.width*this.height;this.validPixelCount=r}};S.clamp=function(n){if(n&&"f64"!==n&&"f32"!==n&&this.pixels){var [r,t]=G.getPixelValueRange(n),
z=this.pixels,a=this.width*this.height,c=z.length,e=[];for(let h=0;h<c;h++){var g=U.createEmptyBand(n,a);var b=z[h];for(let k=0;k<a;k++){var f=b[k];g[k]=f>t?t:f<r?r:f}e.push(g)}this.pixels=e;this.pixelType=n}};S.extractBands=function(n){const {pixels:r,statistics:t}=this;if(null==n||0===n.length||!r||0===r.length)return this;var z=r.length,a=n.some(h=>h>=r.length),c=z===n.length&&!n.some((h,k)=>h!==k);if(a||c)return this;z=this.bandMasks?.length===z?n.map(h=>this.bandMasks[h]):void 0;let {mask:e,
validPixelCount:g}=this;const {width:b,height:f}=this;if(z){if(1===z.length)e=z[0];else for(a=b*f,e=(new Uint8Array(a)).fill(255),c=0;c<z.length;c++){const h=z[c];for(let k=0;k<a;k++)h[k]||(e[k]=0)}g=e.filter(h=>!!h).length}return new U({pixelType:this.pixelType,width:b,height:f,mask:e,bandMasks:z,validPixelCount:g,maskIsAlpha:this.maskIsAlpha,pixels:n.map(h=>r[h]),statistics:t&&n.map(h=>t[h])})};S.clone=function(){const n=new U({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,
validPixelCount:this.validPixelCount});null!=this.mask&&(n.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));this.bandMasks&&(n.bandMasks=this.bandMasks.map(z=>new Uint8Array(z)));let r;const t=U.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){n.pixels=[];const z=!!this.pixels[0].slice;for(r=0;r<this.pixels.length;r++)n.pixels[r]=z?this.pixels[r].slice(0,this.pixels[r].length):new t(this.pixels[r])}if(this.statistics)for(n.statistics=
[],r=0;r<this.statistics.length;r++)n.statistics[r]=L.clone(this.statistics[r]);n.premultiplyAlpha=this.premultiplyAlpha;return n};S._fillFrom8Bit=function(n){const {mask:r,maskIsAlpha:t,premultiplyAlpha:z,pixels:a}=this;if(n&&a&&a.length){var c,e;var g=c=e=a[0];3<=a.length?(c=a[1],e=a[2]):2===a.length&&(c=a[1]);var b=new Uint32Array(n),f=this.width*this.height;if(g.length!==f)I.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=r&&r.length===
f)if(t)for(n=0;n<f;n++){const h=r[n];if(h){const k=h/255;b[n]=z?h<<24|e[n]*k<<16|c[n]*k<<8|g[n]*k:h<<24|e[n]<<16|c[n]<<8|g[n]}}else for(n=0;n<f;n++)r[n]&&(b[n]=-16777216|e[n]<<16|c[n]<<8|g[n]);else for(n=0;n<f;n++)b[n]=-16777216|e[n]<<16|c[n]<<8|g[n]}else I.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};S._fillFromNon8Bit=function(n){const {pixels:r,mask:t,statistics:z}=this;if(n&&r&&r.length){var a=this.pixelType,c=1,e=0;c=1;if(z&&0<z.length){for(var g of z)null!=
g.minValue&&(e=Math.min(e,g.minValue)),null!=g.maxValue&&null!=g.minValue&&(c=Math.max(c,g.maxValue-g.minValue));c=255/c}else c=255,"s8"===a?(e=-128,c=127):"u16"===a?c=65535:"s16"===a?(e=-32768,c=32767):"u32"===a?c=4294967295:"s32"===a?(e=-2147483648,c=2147483647):"f32"===a?(e=-3.4*1E39,c=3.4*1E39):"f64"===a&&(e=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-e);n=new Uint32Array(n);a=this.width*this.height;var b,f,h;g=b=f=r[0];if(g.length!==a)return I.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=r.length)if(b=r[1],3<=r.length&&(f=r[2]),null!=t&&t.length===a)for(h=0;h<a;h++)t[h]&&(n[h]=-16777216|(f[h]-e)*c<<16|(b[h]-e)*c<<8|(g[h]-e)*c);else for(h=0;h<a;h++)n[h]=-16777216|(f[h]-e)*c<<16|(b[h]-e)*c<<8|(g[h]-e)*c;else if(null!=t&&t.length===a)for(h=0;h<a;h++)b=(g[h]-e)*c,t[h]&&(n[h]=-16777216|b<<16|b<<8|b);else for(h=0;h<a;h++)b=(g[h]-e)*c,n[h]=-16777216|b<<16|b<<8|b}else I.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};S._fillFrom32Bit=
function(n){const {pixels:r,mask:t}=this;if(!n||!r||!r.length)return I.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let z,a,c,e;z=a=c=r[0];3<=r.length?(a=r[1],c=r[2]):2===r.length&&(a=r[1]);const g=this.width*this.height;if(z.length!==g)return I.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let b=0;if(null!=t&&t.length===g)for(e=0;e<g;e++)n[b++]=z[e],n[b++]=a[e],n[b++]=c[e],n[b++]=t[e]&1;
else for(e=0;e<g;e++)n[b++]=z[e],n[b++]=a[e],n[b++]=c[e],n[b++]=1};S._calculateBandStatistics=function(n,r){let t=Infinity,z=-Infinity;const a=n.length;let c,e=0;if(null!=r)for(c=0;c<a;c++)r[c]&&(e=n[c],t=e<t?e:t,z=e>z?e:z);else for(c=0;c<a;c++)e=n[c],t=e<t?e:t,z=e>z?e:z;return new P.SimpleBandStatistics(t,z)};return v._createClass(aa)}(w.JSONSupport);F.__decorate([J.property({json:{write:!0}})],w.prototype,"width",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"height",void 0);
F.__decorate([J.property({json:{write:!0}})],w.prototype,"pixelType",void 0);F.__decorate([E.cast("pixelType")],w.prototype,"castPixelType",null);F.__decorate([J.property({json:{write:!0}})],w.prototype,"validPixelCount",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"mask",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"maskIsAlpha",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"pixels",void 0);F.__decorate([J.property()],w.prototype,"premultiplyAlpha",
void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"statistics",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"depthCount",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"noDataValues",void 0);F.__decorate([J.property({json:{write:!0}})],w.prototype,"bandMasks",void 0);return w=U=F.__decorate([R.subclass("esri.layers.support.PixelBlock")],w)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(v,F){F=F._createClass(function(O=null,w=null,L=null){this.minValue=O;this.maxValue=w;this.noDataValue=L});v.SimpleBandStatistics=F;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(v){function F(w){return O[w]??[-3.4028234663852886E38,3.4028234663852886E38]}const O={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,
2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};v.convertNoDataToMask=function(w,L,I){if(!(w.depthCount&&1<w.depthCount)){var {pixels:J,statistics:E,pixelType:R}=w,P=J[0].length,G=w.bandMasks??[],U=w.mask??(new Uint8Array(P)).fill(255),X="f32"===R||"f64"===R,aa=F(R),S=!1;for(let t=0;t<J.length;t++){const z="number"===typeof L?L:L[t];if(null==z)continue;var n=E?.[t].maxValue??aa[1];if((E?.[t].minValue??aa[0])>
z+Number.EPSILON||n<z-Number.EPSILON)continue;n=G[t]||(new Uint8Array(P)).fill(255);const a=J[t];var r=I?.customFloatTolerance;if(X&&0!==r){r||(r=9.999999E37<=Math.abs(z)?2E-7*Math.abs(z):"f32"===R?2**-23:Number.EPSILON);for(let c=0;c<a.length;c++)n[c]&&Math.abs(a[c]-z)<r&&(a[c]=0,n[c]=0,U[c]=0,S=!0)}else for(r=0;r<a.length;r++)n[r]&&a[r]===z&&(a[r]=0,n[r]=0,U[r]=0,S=!0);G[t]=n}S&&(w.bandMasks=G,w.mask=U);S&&"updateStatistics"in w&&w.updateStatistics()}};v.getPixelValueRange=F;Object.defineProperty(v,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n){const r=P.create(),t=[0,0],z=new n(0,0,0,0);O=function(a){function c(g){var b=a.call(this,g)||this;b._imagePromise=null;b.bitmaps=[];b.hidpi=!1;b.imageMaxWidth=2048;b.imageMaxHeight=2048;b.imageRotationSupported=!1;b.imageNormalizationSupported=!1;b.update=L.debounce(async(f,h)=>{L.throwIfAborted(h);if(f.stationary&&!b.destroyed){var k=f.state,m=G.getInfo(k.spatialReference);f=b.hidpi?f.pixelRatio:1;var q=b.imageNormalizationSupported&&k.worldScreenWidth&&
k.worldScreenWidth<k.size[0],A=b.imageMaxWidth??0,C=b.imageMaxHeight??0;q?(t[0]=k.worldScreenWidth,t[1]=k.size[1]):b.imageRotationSupported?(t[0]=k.size[0],t[1]=k.size[1]):X.getOuterSize(t,k);m=m&&(k.extent.xmin<m.valid[0]||k.extent.xmax>m.valid[1]);var x=!b.imageNormalizationSupported&&m,D=!(Math.floor(t[0]*f)>A||Math.floor(t[1]*f)>C)&&!x,M=b.imageRotationSupported?k.rotation:0;m=b.container.children.slice();D?(q=q?k.paddedViewState.center:k.center,b._imagePromise&&console.error("Image promise was not defined!"),
b._imagePromise=b._singleExport(k,t,q,k.resolution,M,f,h)):(q=Math.min(A,C),x&&(q=Math.min(k.worldScreenWidth,q)),b._imagePromise=b._tiledExport(k,q,f,h));try{const N=await b._imagePromise??[];L.throwIfAborted(h);h=[];b._imagePromise=null;if(!b.destroyed){b.bitmaps=N;for(const K of m)N.includes(K)||h.push(K.fadeOut().then(()=>{K.remove();K.destroy()}));for(const K of N)h.push(K.fadeIn());await Promise.all(h)}}catch(N){b._imagePromise=null,L.throwIfAbortError(N)}}},5E3);b.updateExports=L.debounce(async f=>
{const h=[];for(const k of b.container.children){if(!k.visible||!k.stage)return;h.push(f(k).then(()=>{k.invalidateTexture();k.requestRender()}))}b._imagePromise=L.eachAlways(h).then(()=>b._imagePromise=null);await b._imagePromise});return b}v._inherits(c,a);var e=c.prototype;e.destroy=function(){this.bitmaps.forEach(g=>g.destroy());this.bitmaps=[]};e._export=async function(g,b,f,h,k,m){f=await this.fetchSource(g,Math.floor(b*k),Math.floor(f*k),{rotation:h,pixelRatio:k,signal:m});L.throwIfAborted(m);
const q=new aa.Bitmap(null,!0);q.x=g.xmin;q.y=g.ymax;q.resolution=g.width/b;q.rotation=h;q.pixelRatio=k;q.opacity=0;this.container.addChild(q);await q.setSourceAsync(f,m);L.throwIfAborted(m);return q};e._singleExport=async function(g,b,f,h,k,m,q){X.getBBox(r,f,h,b);g=P.toExtent(r,g.spatialReference);return[await this._export(g,b[0],b[1],k,m,q)]};e._tiledExport=function(g,b,f,h){var k=U.create({size:b,spatialReference:g.spatialReference,scales:[g.scale]});const m=new S(k);k=m.getTileCoverage(g);if(!k)return null;
const q=[];k.forEach((A,C,x,D)=>{z.set(A,C,x,0);m.getTileBounds(r,z);const M=P.toExtent(r,g.spatialReference);q.push(this._export(M,b,b,0,f,h).then(N=>{0!==D&&(z.set(A,C,x,D),m.getTileBounds(r,z),N.x=r[0],N.y=r[3]);return N}))});return Promise.all(q)};v._createClass(c,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return c}(O);F.__decorate([I.property()],O.prototype,"_imagePromise",void 0);F.__decorate([I.property()],O.prototype,"bitmaps",void 0);F.__decorate([I.property()],
O.prototype,"container",void 0);F.__decorate([I.property()],O.prototype,"fetchSource",void 0);F.__decorate([I.property()],O.prototype,"hidpi",void 0);F.__decorate([I.property()],O.prototype,"imageMaxWidth",void 0);F.__decorate([I.property()],O.prototype,"imageMaxHeight",void 0);F.__decorate([I.property()],O.prototype,"imageRotationSupported",void 0);F.__decorate([I.property()],O.prototype,"imageNormalizationSupported",void 0);F.__decorate([I.property()],O.prototype,"requestUpdate",void 0);F.__decorate([I.property()],
O.prototype,"updating",null);return O=F.__decorate([R.subclass("esri.views.2d.layers.support.ExportStrategy")],O)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(v){const F=Math.PI/180;v.getBBox=function(O,w,L,I){const [J,E]=w,[R,P]=I;w=.5*L;O[0]=J-w*R;O[1]=E-w*P;O[2]=J+w*R;O[3]=E+w*P;return O};v.getOuterSize=function(O,w){var L=w.rotation*F;const I=Math.abs(Math.cos(L));L=Math.abs(Math.sin(L));const [J,E]=w.size;O[0]=Math.round(E*L+J*I);O[1]=Math.round(E*I+J*L);return O};
Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/HandleOwner ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n){L=function(r){function t(){var a=r.apply(this,arguments)||this;a.attached=!1;a.container=new S.RasterVFContainer;a.type="imageryVF";a._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};a._fetchpixels=async(c,e,g,b)=>{const f=await a._projectFullExtentPromise,{symbolTileSize:h}=a.layer.renderer,{extent:k,width:m,height:q}=aa.snapImageToSymbolTile(c,e,g,h,f);if(null!=f&&!f.intersects(c))return{extent:k,pixelBlock:null};c={bbox:`${k.xmin}, ${k.ymin}, ${k.xmax}, ${k.ymax}`,
exportParametersVersion:a.layer.exportImageServiceParameters.version,symbolTileSize:h,time:JSON.stringify(a.timeExtent||"")};if(a._canReuseVectorFieldData(c)&&(e=a.getPixelData(),null!=e&&`${e.extent.xmin}, ${e.extent.ymin}, ${e.extent.xmax}, ${e.extent.ymax}`===c.bbox))return e;({pixelData:b}=await a.layer.fetchImage(k,m,q,{timeExtent:a.timeExtent,requestAsImageElement:!1,signal:b}));a._dataParameters=c;b=b?.pixelBlock;if(null==b)return{extent:k,pixelBlock:null};b="vector-uv"===a.layer.rasterInfo.dataType?
aa.convertVectorFieldData(b,"vector-uv"):b;return{extent:k,pixelBlock:b}};return a}v._inherits(t,r);var z=t.prototype;z.attach=function(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new n({container:this.container,fetchPixels:this._fetchpixels});this.handles.add(I.watch(()=>this.layer.renderer,a=>this._updateSymbolizerParams(a),I.syncAndInitial),"attach")};z.detach=function(){this._strategy.destroy();this.container.children.forEach(a=>a.destroy());
this.container.removeAllChildren();this.handles.remove("attach");this._strategy=this.container=this._projectFullExtentPromise=null};z.getPixelData=function(){const a=this.container.children[0]?.rawPixelData;if(this.updating||!a)return null;const {extent:c,pixelBlock:e}=a;return{extent:c,pixelBlock:e}};z.hitTest=function(a){return new O({attributes:{},geometry:a.clone(),layer:this.layer})};z.update=function(a){this._strategy.update(a,this._symbolizerParams)};z.redraw=function(){const {renderer:a}=
this.layer;a&&(this._updateSymbolizerParams(a),this._strategy.redraw(this._symbolizerParams))};z._canReuseVectorFieldData=function(a){const c=this._dataParameters.time===a.time,e=this._dataParameters.symbolTileSize===a.symbolTileSize,g=this._dataParameters.bbox===a.bbox;return this._dataParameters.exportParametersVersion===a.exportParametersVersion&&c&&e&&g};z._getProjectedFullExtent=async function(a){try{return await X.projectExtent(this.layer.fullExtent,a)}catch(c){try{const e=(await w(this.layer.url,
{query:{option:"footprints",outSR:a.wkid||JSON.stringify(a.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return e?U.fromJSON(e):null}catch{return null}}};z._updateSymbolizerParams=function(a){"vector-field"===a.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))};v._createClass(t,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return t}(L.HandleOwner);F.__decorate([J.property()],L.prototype,
"attached",void 0);F.__decorate([J.property()],L.prototype,"container",void 0);F.__decorate([J.property()],L.prototype,"layer",void 0);F.__decorate([J.property()],L.prototype,"timeExtent",void 0);F.__decorate([J.property()],L.prototype,"type",void 0);F.__decorate([J.property()],L.prototype,"view",void 0);F.__decorate([J.property()],L.prototype,"updating",null);return L=F.__decorate([G.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],L)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G){function U(d,l,p){return!J.canProjectWithoutEngine(d,l,p)}function X(d,l,p){if((d=U(d,l,p))&&!J.isLoaded())throw new w("rasterprojectionhelper-project","projection engine is not loaded");return d}function aa(d,l,p,u=null){const H=d.spatialReference;if(H.equals(l))return d;X(H,l,u);p=p.center;p=new E({xmin:p.x-d.x/2,xmax:p.x+d.x/2,ymin:p.y-d.y/2,ymax:p.y+d.y/2,spatialReference:H});u=J.project(p,l,u);p=q(l);null==u||null!=p&&u.width>=p?(l=L.getMetersPerUnitForSR(H)/L.getMetersPerUnitForSR(l),
d={x:d.x*l,y:d.y*l}):d={x:u.width,y:u.height};return d}function S(d,l=.01){return L.getMetersPerUnitForSR(d)?l/L.getMetersPerUnitForSR(d):0}function n(d,l,p=null,u=!0){const H=d.spatialReference;if(H.equals(l))return d;X(H,l,p);p=J.project(d,l,p);if(!u||!p)return p;r([d],[p],H,l);return p}function r(d,l,p,u){const H=A(p,!0),y=A(u,!0);p=S(p,500);u=S(u,500);if(p&&null!=H&&null!=y)for(let Q=0;Q<d.length;Q++){const T=l[Q];if(!T)continue;const {x:B}=d[Q],{x:Z}=T;Z>=y[1]-u&&Math.abs(B-H[0])<p?T.x-=y[1]-
y[0]:Z<=y[0]+u&&Math.abs(B-H[1])<p&&(T.x+=y[1]-y[0])}}function t(d){const {inSR:l,outSR:p,datumTransformation:u,preferPE:H}=d;if(l.equals(p))return{points:d}=g(d,null),d;if(l.isWebMercator&&p.isWGS84||l.isWGS84&&p.isWebMercator){const {cols:B,rows:Z,xres:Y,yres:ea,usePixelCenter:da,inSR:ca,outSR:fa}=d;let {xmin:ia,ymax:ja}=d;da&&(ia+=Y/2,ja-=ea/2);d=[];const ha=[];var y=Math.max(B,Z);for(var Q=0;Q<y;Q++){var T=J.project(new R({x:ia+Y*Math.min(B,Q),y:ja-ea*Math.min(Z,Q),spatialReference:ca}),fa);Q<=
B&&d.push(T.x);Q<=Z&&ha.push(T.y)}y=[];for(Q=0;Q<B;Q++)for(T=0;T<Z;T++)y.push([d[Q],ha[T]]);return y}return X(l,p,u)&&H&&(l.isGeographic||null!=c(l))?a(d):z(d)}function z(d){var {points:l}=g(d,null);const {inSR:p,outSR:u,datumTransformation:H}=d;d=l.map(y=>new R(y[0],y[1],p));l=J.project(d,u,H);H&&r(d,l,p,u);return l.map(y=>y?[y.x,y.y]:[NaN,NaN])}function a(d){const {inSR:l,outSR:p,datumTransformation:u}=d;var H=c(l);const {points:y,mask:Q}=g(d,H);l.isGeographic||(d=l.wkid?I.PeFactory.coordsys(l.wkid):
I.PeFactory.fromString(l.isGeographic?I.PeDefs.PE_TYPE_GEOGCS:I.PeDefs.PE_TYPE_PROJCS,l.wkt),I.PeCSTransformations.projToGeog(d,y.length,y));if(null!=u&&u.steps.length){var T;p.isGeographic&&(T=y.map(([B])=>179.9955<B?1:-179.9955>B?-1:0));u.steps.forEach(B=>{const Z=B.wkid?I.PeFactory.geogtran(B.wkid):I.PeFactory.fromString(I.PeDefs.PE_TYPE_GEOGTRAN,B.wkt);I.PeGTTransformations.geogToGeog(Z,y.length,y,null,B.isInverse?I.PeDefs.PE_TRANSFORM_2_TO_1:I.PeDefs.PE_TRANSFORM_1_TO_2)});if(T)for(d=0;d<y.length;d++){H=
T[d];const B=y[d][0],Z=179.9955<B?1:-179.9955>B?-1:0;H&&Z&&H!==Z&&(y[d][0]=0<H?B+360:B-360)}}p.isGeographic||(T=c(p,!0),b(y,null!=T&&T.isEnvelope?[T.bbox[1],T.bbox[3]]:[-90,90]),T=p.wkid?I.PeFactory.coordsys(p.wkid):I.PeFactory.fromString(p.isGeographic?I.PeDefs.PE_TYPE_GEOGCS:I.PeDefs.PE_TYPE_PROJCS,p.wkt),I.PeCSTransformations.geogToProj(T,y.length,y));T=y;if(Q&&y.length!==Q.length){T=[];for(let B=0,Z=0;B<Q.length;B++)Q[B]?T.push(y[Z++]):T.push([NaN,NaN])}return T}function c(d,l=!1){var p=d.wkid||
d.wkt;if(!p||d.isGeographic)return null;p=String(p);if(V.has(p))return p=V.get(p),l?p?.gcs:p?.pcs;var u=d.wkid?I.PeFactory.coordsys(d.wkid):I.PeFactory.fromString(d.isGeographic?I.PeDefs.PE_TYPE_GEOGCS:I.PeDefs.PE_TYPE_PROJCS,d.wkt);d=S(d,1E-4);d=e(u,d);u=e(u,0,!0);V.set(p,{pcs:d,gcs:u});return l?u:d}function e(d,l=0,p=!1){var u=I.PePCSInfo.generate(d),H=p?d.horizonGcsGenerate():d.horizonPcsGenerate();if(!u||!H?.length)return null;d=!1;var y=H.find(Y=>1===Y.getInclusive()&&1===Y.getKind());if(!y){y=
H.find(Y=>1===Y.getInclusive()&&0===Y.getKind());if(!y)return null;d=!0}p=p?0:(2===u.getNorthPoleLocation()?1:0)|(2===u.getSouthPoleLocation()?2:0);u=u.isPannableRectangle();y=y.getCoord();if(d)return{isEnvelope:d,isPannable:u,vertices:y,coef:null,bbox:[y[0][0]-l,y[0][1]-l,y[1][0]+l,y[1][1]+l],poleLocation:p};l=0;d=[];let [Q,T]=y[0],[B,Z]=y[0];for(let Y=0,ea=y.length;Y<ea;Y++){l++;l===ea&&(l=0);const [da,ca]=y[Y],[fa,ia]=y[l];if(ia===ca)d.push([da,fa,ca,ia,2]);else{H=(fa-da)/(ia-ca||1E-4);const ja=
da-H*ca;ca<ia?d.push([H,ja,ca,ia,0]):d.push([H,ja,ia,ca,1])}Q=Q<da?Q:da;T=T<ca?T:ca;B=B>da?B:da;Z=Z>ca?Z:ca}return{isEnvelope:!1,isPannable:u,vertices:y,coef:d,bbox:[Q,T,B,Z],poleLocation:p}}function g(d,l){const p=[],{cols:u,rows:H,xres:y,yres:Q,usePixelCenter:T}=d;let {xmin:B,ymax:Z}=d;T&&(B+=y/2,Z-=Q/2);if(null==l){for(d=0;d<u;d++)for(l=0;l<H;l++)p.push([B+y*d,Z-Q*l]);return{points:p}}d=new Uint8Array(u*H);if(l.isEnvelope){const {bbox:[ja,ha,ma,na]}=l;for(let oa=0,la=0;oa<u;oa++){var Y=B+y*oa,
ea=l.isPannable||Y>=ja&&Y<=ma;for(var da=0;da<H;da++,la++){var ca=Z-Q*da;ea&&ca>=ha&&ca<=na&&(p.push([Y,ca]),d[la]=1)}}return{points:p,mask:d}}Y=l.coef;l=[];for(ea=0;ea<H;ea++){var fa=Z-Q*ea;da=[];ca=[];for(var ia=0;ia<Y.length;ia++){const [ja,ha,ma,na,oa]=Y[ia];fa===ma&&ma===na?(da.push(ja),da.push(ha),ca.push(2),ca.push(2)):fa>=ma&&fa<=na&&(da.push(ja*fa+ha),ca.push(oa))}fa=da;if(2<da.length){ia=2===ca[0]?0:ca[0];let ja=da[0];fa=[];for(let ha=1;ha<ca.length;ha++)if(2!==ca[ha]||ha===ca.length-1)ca[ha]!==
ia&&(fa.push(0===ia?Math.min(ja,da[ha-1]):Math.max(ja,da[ha-1])),ia=ca[ha],ja=da[ha]),ha===ca.length-1&&fa.push(0===ca[ha]?Math.min(ja,da[ha]):Math.max(ja,da[ha]));fa.sort((ha,ma)=>ha-ma)}else da[0]>da[1]&&(fa=[da[1],da[0]]);l.push(fa)}for(let ja=0,ha=0;ja<u;ja++)for(Y=B+y*ja,ea=0;ea<H;ea++,ha++)if(da=Z-Q*ea,ca=l[ea],2===ca.length)Y>=ca[0]&&Y<=ca[1]&&(p.push([Y,da]),d[ha]=1);else if(2<ca.length){fa=!1;for(ia=0;ia<ca.length;ia+=2)if(Y>=ca[ia]&&Y<=ca[ia+1]){fa=!0;break}fa&&(p.push([Y,da]),d[ha]=1)}return{points:p,
mask:d}}function b(d,l){const [p,u]=l;for(l=0;l<d.length;l++){const H=d[l][1];if(H<p||H>u)d[l]=[NaN,NaN]}}function f(d){const l=q(d[0].spatialReference);if(2>d.length||null==l)return d[0];const p=S(d[0].spatialReference);d=d.filter(T=>T.width>p);if(1===d.length)return d[0];let {xmin:u,xmax:H,ymin:y,ymax:Q}=d[0];for(let T=1;T<d.length;T++){const B=d[T];H=B.xmax+l*T;y=Math.min(y,B.ymin);Q=Math.max(Q,B.ymax)}return new E({xmin:u,xmax:H,ymin:y,ymax:Q,spatialReference:d[0].spatialReference})}function h(d,
l,p=null,u=!0){var H=d.spatialReference;if(H.equals(l))return d;var y=x(d);const Q=q(H,!0);var T=q(l);if(0===y||null==Q||null==T)return y=m(d,l,p,u),null==Q&&null!=T&&Math.abs(y.width-T)<S(l)&&J.isLoaded()&&(H=c(H),null!=H&&H.poleLocation===N.None&&d.width<(H.bbox[2]-H.bbox[0])/2)?k(d,l)||y:y;T=d.clone().normalize();if(1===T.length&&d.xmax<Q&&d.xmax-Q/2>S(H)){const {xmin:B,xmax:Z}=d;for(let Y=0;Y<=y;Y++)T[Y]=new E({xmin:0===Y?B:-Q/2,xmax:Y===y?Z-Q*Y:Q/2,ymin:d.ymin,ymax:d.ymax,spatialReference:H})}d=
T.map(B=>m(B,l,p,u));return f(d.filter(O.isSome))}function k(d,l){const p=q(l);if(null==p)return null;let {xmin:u,ymin:H,xmax:y,ymax:Q}=d;var T=d.spatialReference;d=new P({spatialReference:T,rings:[[[u,H],[y,H],[y,Q],[u,Q],[u,H]]]});d=J.project(d,l);if(2!==d.rings.length||!d.rings[0].length||!d.rings[1].length)return null;({rings:d}=d);T=S(T);l=new E({spatialReference:l});for(let B=0;2>B;B++){u=y=d[B][0][0];H=Q=d[B][0][1];for(let Z=0;Z<d[B].length;Z++)u=u>d[B][Z][0]?d[B][Z][0]:u,y=y<d[B][Z][0]?d[B][Z][0]:
y,H=H>d[B][Z][1]?d[B][Z][1]:H,Q=Q<d[B][Z][1]?d[B][Z][1]:Q;if(0===B)l.ymin=H,l.ymax=Q,l.xmin=u,l.xmax=y;else if(l.ymin=Math.min(l.ymin,H),l.ymax=Math.max(l.ymax,Q),Math.abs(y-p/2)<T)l.xmin=u,l.xmax+=p;else if(Math.abs(u+p/2)<T)l.xmax=y+p;else return null}return l}function m(d,l,p=null,u=!0,H=!0){const y=d.spatialReference;if(y.equals(l)||!l)return d;X(y,l,p);const Q=J.project(d,l,p);if(H&&l.isWebMercator&&Q&&(Q.ymax=Math.min(2.0037508342787E7,Q.ymax),Q.ymin=Math.max(-2.0037508342787E7,Q.ymin),Q.ymin>=
Q.ymax))return null;if(!u||!Q)return Q;var T=A(y,!0);u=A(l,!0);if(null==T||null==u)return Q;H=S(y,.001);const B=S(y,500);var Z=S(l,.001);if(Math.abs(Q.xmin-u[0])<Z&&Math.abs(Q.xmax-u[1])<Z){Z=Math.abs(d.xmin-T[0]);T=Math.abs(T[1]-d.xmax);if(Z<H&&T>B){Q.xmin=u[0];var Y=[];Y.push(new R(d.xmax,d.ymin,y));Y.push(new R(d.xmax,(d.ymin+d.ymax)/2,y));Y.push(new R(d.xmax,d.ymax,y));Y=Y.map(ea=>n(ea,l,p)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x);Q.xmax=Math.max.apply(null,Y)}T<H&&Z>B&&(Q.xmax=u[1],u=[],u.push(new R(d.xmin,
d.ymin,y)),u.push(new R(d.xmin,(d.ymin+d.ymax)/2,y)),u.push(new R(d.xmin,d.ymax,y)),d=u.map(ea=>n(ea,l,p)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x),Q.xmin=Math.min.apply(null,d))}else d=S(l,.001),Math.abs(Q.xmin-u[0])<d&&(Q.xmin=u[0]),Math.abs(Q.xmax-u[1])<d&&(Q.xmax=u[1]);return Q}function q(d,l=!1){return d?d.isWebMercator?2*(l?2.0037508342787E7:2.0037508342788905E7):d.wkid&&d.isGeographic?360:2*W[d.wkid]||null:null}function A(d,l=!1){if(d.isGeographic)return[-180,180];d=q(d,l);return null!=d?[-d/
2,d/2]:null}function C(d,l,p,u){d=(d-l)/p;0!==d-Math.floor(d)?d=Math.floor(d):u&&--d;return d}function x(d,l=!1){var p=q(d.spatialReference);if(null==p)return 0;const u=l?0:-(p/2),H=S(d.spatialReference),y=!l&&Math.abs(d.xmin+p/2)<H?-p/2:d.xmin;d=C(!l&&Math.abs(d.xmax-p/2)<H?p/2:d.xmax,u,p,!0);p=C(y,u,p,!1);return d-p}function D(d){const {projectedExtent:l,srcBufferExtent:p,pixelSize:u,datumTransformation:H,rasterTransform:y}=d;var Q=l.spatialReference;const T=p.spatialReference;var B=X(Q,T);const {xmin:Z,
ymin:Y,xmax:ea,ymax:da}=l,ca=q(T),fa=null!=ca&&(d.hasWrapAround||"gcs-shift"===y?.type);d=d.spacing||[32,32];var ia=d[0]*u.x,ja=d[1]*u.y;const ha=1===d[0],ma=Math.ceil((ea-Z)/ia-.1/d[0])+(ha?0:1),na=Math.ceil((da-Y)/ja-.1/d[1])+(ha?0:1);ia=t({cols:ma,rows:na,xmin:Z,ymax:da,xres:ia,yres:ja,inSR:Q,outSR:T,datumTransformation:H,preferPE:4>=d[0],usePixelCenter:ha});ja=[];let oa,la=0;const ra=ha?-1:NaN,{xmin:sa,xmax:ta,ymax:ua,width:va,height:wa}=p,xa=S(T,500),ya=null!=ca&&0<sa&&ta>ca/2;var pa=!1;B&&(pa=
c(Q),pa=null!=pa&&0<pa.poleLocation);for(Q=0;Q<ma;Q++){B=[];for(let qa=0;qa<na;qa++){var ka=ia[Q*na+qa];fa&&ka[0]>ta&&ka[0]>ca/2-xa?ka[0]-=ca:fa&&0===Q&&0>ka[0]&&ya&&!y&&(ka[0]+=ca);!ka||isNaN(ka[0])||isNaN(ka[1])?(ja.push(ra),ja.push(ra),B.push(null),la++):(y&&(ka=y.inverseTransform(new R({x:ka[0],y:ka[1],spatialReference:T})),ka=[ka.x,ka.y]),B.push(ka),0<Q&&fa&&oa[qa]&&ka[0]<oa[qa][0]&&(ka[0]+=ca,pa&&ka[0]>ta&&ka[0]>ca&&(ka[0]-=ca)),ja.push((ka[0]-sa)/va),ja.push((ua-ka[1])/wa))}oa=B}return{offsets:ja,
error:null,coefficients:null,outofBoundPointCount:la,spacing:d,size:ha?[ma,na]:[ma-1,na-1]}}function M(d,l,p){const {cols:u,rows:H}=l;l=new Float32Array((u-1)*(H-1)*12);const y=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),Q=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let da=0;da<u-1;da++){for(var T=0;T<H-1;T++){var B=da*H*2+2*T,Z=d[B];const ca=d[B+1];var Y=d[B+2],ea=d[B+3];B+=2*H;const fa=d[B],ia=d[B+1],ja=d[B+2];B=d[B+3];let ha=0,ma=12*(T*(u-1)+da);for(let na=0;3>na;na++)l[ma++]=y[ha++]*Z+y[ha++]*
Y+y[ha++]*ja;ha=0;for(Y=0;3>Y;Y++)l[ma++]=y[ha++]*ca+y[ha++]*ea+y[ha++]*B;ha=0;for(ea=0;3>ea;ea++)l[ma++]=Q[ha++]*Z+Q[ha++]*fa+Q[ha++]*ja;ha=0;for(Z=0;3>Z;Z++)l[ma++]=Q[ha++]*ca+Q[ha++]*ia+Q[ha++]*B}if(p)for(T=0;T<l.length;T++)isNaN(l[T])&&(l[T]=-1)}return l}var N;(function(d){d[d.None=0]="None";d[d.North=1]="North";d[d.South=2]="South";d[d.Both=3]="Both"})(N||(N={}));const K=(d,l,p,u=0)=>{if(1===p[0])return[0,0];var H=1,y=-1,Q=1,T=-1;for(var B=0;B<d.length;B+=2)isNaN(d[B])||(H=H>d[B]?d[B]:H,y=y>
d[B]?y:d[B],Q=Q>d[B+1]?d[B+1]:Q,T=T>d[B+1]?T:d[B+1]);const {cols:Z,rows:Y}=l;l=(y-H)/Z/p[0];p=(T-Q)/Y/p[1];u*=2;Q=0;T=!1;H=[0,0];for(y=0;y<Z-3;y++){for(B=0;B<Y-3;B++){var ea=y*Y*2+2*B;const da=Math.abs(((d[ea]+d[ea+4]+d[ea+4*Y]+d[ea+4*Y+4])/4-d[ea+2*Y+2])/l);ea=Math.abs(((d[ea+1]+d[ea+5]+d[ea+4*Y+1]+d[ea+4*Y+5])/4-d[ea+2*Y+3])/p);da+ea>Q&&(Q=da+ea,H=[da,ea]);if(u&&Q>u){T=!0;break}}if(T)break}return H},W={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,
4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,
54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},V=new Map,ba=new Map;v.computeProjectedScales=function(d,l,p){var u=p?.tileSize??512,H=p?.alignGlobalDatasetWithAGOL??!0,y=!!p?.limitToSrcResolution;const {extent:Q,spatialReference:T,pixelSize:B}=d;p=aa(new R({x:B.x,y:B.y,spatialReference:T}),l,Q);if(null==p)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const Z=(p.x+p.y)/
2,Y=L.getMetersPerUnitForSR(l);var ea=Z*Y*96*39.37,da=l.isGeographic?256/u*2.958287637958547E8:256/u*5.91657527591555E8,ca="vector-magdir"===d.dataType||"vector-uv"===d.dataType,fa=h(Q,l),ia=Math.min(Math.ceil(Math.log(Math.min(d.width,d.height)/32)/Math.LN2),Math.ceil(Math.log(da/2/ea)/Math.LN2));!ca&&H&&(l.isGeographic||l.isWebMercator)&&(ca=0>fa.xmin*fa.xmax,!ca&&3>ia&&(H=q(l),null!=H&&(ca=2**ia*Z*u,u=Math.ceil(H/ca),ca=1===u||2===u&&H/2-fa.xmax<ca)));u=ea;d=Math.min(2,Math.max(1.414,d.storageInfo?.pyramidScalingFactor||
2));if(ca)u=da,da=l.isGeographic?1.341104507446289E-6:.29858214164761665,ia=96*da*Y*39.37,l=aa(new R({x:da,y:da,spatialReference:{wkid:l.isGeographic?4326:3857}}),T,fa),l.x*=u/ia,l.y*=u/ia;else{l={x:B.x,y:B.y};for(fa=0;u<.5005*da&&fa<ia;)fa++,u*=d,l.x*=d,l.y*=d;1.001>=Math.max(u,da)/Math.min(u,da)&&(u=da)}da=[u];fa=[{x:l.x,y:l.y}];for(ea=Math.min(70.5310735,ea)/1.001;u>=ea;)u/=d,l.x/=d,l.y/=d,da.push(u),fa.push({x:l.x,y:l.y});if(y){const ja=.001*B.x;y=fa.findIndex(ha=>ha.x>=B.x-ja&&ha.x<=B.x+ja);
-1<y?(fa.length=y+1,da.length=y+1):(y=fa.findIndex(ha=>ha.x<=B.x+ja),0<y&&(fa.length=y,da.length=y))}return{projectedPixelSize:p,scales:da,srcResolutions:fa,isCustomTilingScheme:!ca}};v.defaultGridSpacing=32;v.defaultProjectionToleranceInPixels=4;v.getDefaultDatumTransformationForDataset=function(d,l,p){X(d.spatialReference,l);return p?J.getTransformation(l,d.spatialReference,d):J.getTransformation(d.spatialReference,l,d)};v.getProjectedGridPoints=t;v.getProjectionOffsetGrid=function(d){var l=d.isAdaptive&&
null==d.spacing;let p=d.spacing||[32,32],u=D(d);var H={cols:u.size[0]+1,rows:u.size[1]+1};const y=0<u.outofBoundPointCount&&u.outofBoundPointCount<u.offsets.length/2;let Q=u.outofBoundPointCount===u.offsets.length/2||l&&y?[0,0]:K(u.offsets,H,p,4);const T=(Q[0]+Q[1])/2;var B=d.projectedExtent.spatialReference;const Z=d.srcBufferExtent.spatialReference;l&&(y||4<T)&&(U(B,Z,d.datumTransformation)&&(B.isGeographic||null!=c(B)),p=[4,4],u=D({...d,spacing:p}),H={cols:u.size[0]+1,rows:u.size[1]+1},Q=K(u.offsets,
H,p,4));u.error=Q;1<p[0]&&(u.coefficients=M(u.offsets,H,y));!d.includeGCSGrid||B.isGeographic||B.isWebMercator||(Z.isGeographic?u.gcsGrid={offsets:u.offsets,coefficients:u.coefficients,spacing:p}:(l=c(B),null==l||l.isEnvelope||(B&&!B.isGeographic&&(l=String(B.wkid||B.wkt),ba.has(l)?B=ba.get(l):(B=(B.wkid?I.PeFactory.coordsys(B.wkid):I.PeFactory.fromString(I.PeDefs.PE_TYPE_PROJCS,B.wkt)).getGeogcs().getCode(),ba.set(l,B)),B=new G({wkid:B})),B=h(d.projectedExtent,B),{offsets:d}=D({...d,srcBufferExtent:B,
spacing:p}),H=M(d,H,y),u.gcsGrid={offsets:d,coefficients:H,spacing:p})));return u};v.getRasterDatasetAlignmentInfo=function(d){const l=d.storageInfo.origin.x;var p=q(d.spatialReference,!0);if(null==p)return{originX:l,halfWorldWidth:null,pyramidsInfo:null};const u=p/2,{nativePixelSize:H,storageInfo:y,extent:Q}=d,{maximumPyramidLevel:T,blockWidth:B,pyramidScalingFactor:Z}=y;let Y=H.x;const ea=[];d=null!=d.transform&&"gcs-shift"===d.transform.type;const da=l+(d?0:u);p=d?p-l:u-l;for(let ca=0;ca<=T;ca++){const fa=
(Q.xmax-l)/Y/B,ia=p/Y/B;ea.push({resolutionX:Y,blockWidth:B,datsetColumnCount:0===fa-Math.floor(fa)?fa:Math.ceil(fa),worldColumnCountFromOrigin:0===ia-Math.floor(ia)?ia:Math.ceil(ia),leftMargin:Math.round(da/Y)%B,rightPadding:(B-Math.round(p/Y)%B)%B,originColumnOffset:Math.floor(da/Y/B)});Y*=Z}return{originX:l,halfWorldWidth:u,pyramidsInfo:ea,hasGCSSShiftTransform:d}};v.getWorldWidth=q;v.getWorldWrapCount=x;v.load=async function(){J.isLoaded()||await J.load()};v.minimumGridSpacing=4;v.projectExtent=
h;v.projectPoint=n;v.projectPolygon=function(d,l,p){if("extent"===d.type){const {xmin:u,ymin:H,xmax:y,ymax:Q,spatialReference:T}=d;d=new P({rings:[[[u,Q],[y,Q],[y,H],[u,H],[u,Q]]],spatialReference:T})}if(d.spatialReference.equals(l))return d;X(d.spatialReference,l,p);return J.project(d,l,p)};v.projectResolution=aa;v.requirePE=U;v.snapExtent=function(d){d=d.clone().normalize();return 1===d.length?d[0]:f(d)};v.snapPyramid=function(d,l,p){const {storageInfo:u,pixelSize:H}=l;var y=0;let Q=!1;var {pyramidResolutions:T}=
u,B="mixed"===u.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,u.tileInfo.dpi/96)):1;B=(d.x+d.y)/2/B;if(null!=T&&T.length){d=T[T.length-1];d=(d.x+d.y)/2;var Z=(H.x+H.y)/2;if(B<=Z)y=0;else if(B>=d)y=T.length,Q=8<B/d;else{d=Z;for(let Y=1;Y<=T.length;Y++){Z=(T[Y-1].x+T[Y-1].y)/2;if(B<=Z){B===Z?y=Y:"down"===p?(y=Y-1,Q=8<B/d):y="up"===p?Y:B-d>Z-B||2<B/d?Y:Y-1;break}d=Z}}p=0===y?H:T[y-1];Q&&(T=Math.min(p.x,p.y),B=L.getMetersPerUnitForSR(l.spatialReference),19567<T*B&&(Q=!1));return{pyramidLevel:y,
pyramidResolution:new R({x:p.x,y:p.y,spatialReference:l.spatialReference}),excessiveReading:Q}}y=Math.log(d.x/H.x)/Math.LN2;B=Math.log(d.y/H.y)/Math.LN2;T=l.storageInfo.maximumPyramidLevel||0;y="down"===p?Math.floor(Math.min(y,B)):"up"===p?Math.ceil(Math.max(y,B)):Math.round((y+B)/2);0>y?y=0:y>T&&(Q=y>T+3,y=T);p=2**y;l=new R({x:p*l.nativePixelSize.x,y:p*l.nativePixelSize.y,spatialReference:l.spatialReference});return{pyramidLevel:y,pyramidResolution:l,excessiveReading:Q}};Object.defineProperty(v,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(v,F,O,w){function L(b,f){return n.get(b)/n.get(f)||1}function I(b,f="geographic"){const [h,k]=b;b=Math.sqrt(h*h+k*k);let m=Math.atan2(k,h)*r;m=(360+m)%360;"geographic"===f&&(m=(450-m)%360);return[b,m]}function J(b,f="geographic"){let h=b[1];"geographic"===f&&(h=(450-h)%360);h%=360;b=b[0];return[b*Math.cos(h/r),
b*Math.sin(h/r)]}function E(b,f,h="geographic",k=1){if(!w.isValidPixelBlock(b))return b;const {pixels:m,width:q,height:A}=b;var C=q*A;const x=m[0],D=m[1],M=b.pixelType.startsWith("f")?b.pixelType:"f32",N=O.createEmptyBand(M,C);C=O.createEmptyBand(M,C);let K=0;for(let W=0;W<A;W++)for(let V=0;V<q;V++)"vector-uv"===f?([N[K],C[K]]=I([x[K],D[K]],h),N[K]*=k):([N[K],C[K]]=J([x[K],D[K]],h),N[K]*=k,C[K]*=k),K++;b=new O({pixelType:M,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,
maskIsAlpha:b.maskIsAlpha,pixels:[N,C]});b.updateStatistics();return b}function R(b=0,f=0,h=Math.PI,k=!0){k&&(h=(2*Math.PI-h)%(2*Math.PI));k=k?-1:1;const m=-7*k,q=-2*k,A=-16*k,[C,x]=G(0,f+13*k,h,21.75),[D,M]=G(b-5.5,f+m,h,21.75),[N,K]=G(b+5.5,f+m,h,21.75),[W,V]=G(b-1.5,f+q,h,21.75),[ba,d]=G(b+1.5,f+q,h,21.75),[l,p]=G(b-1.5,f+A,h,21.75),[u,H]=G(b+1.5,f+A,h,21.75);return[C,x,D,M,W,V,ba,d,N,K,l,p,u,H]}function P(b=0,f=Math.PI,h=!0){h&&(f=(2*Math.PI-f)%(2*Math.PI));var k=h?-1:1,m=5*k;const q=20*k,A=25*
k;k*=2;const C=h?1:-1;h=5*C;let [x,D]=[0+h,0-q],[M,N]=[x+2*C,D],[K,W]=[M-0*C,N+k],[V,ba]=[0-h,0-A],[d,l]=[V+0*C,ba-k],p=Math.ceil(b/5),u=Math.floor(p/10);p-=8*u;b=[];const H=[];for(let ca=0;ca<p/2;ca++,u--){0>=u&&1===p%2&&ca===(p-1)/2&&(V=0,d=V+0*C,ba=(ba+D)/2,l=ba-k);const [fa,ia]=G(V,ba,f,45);if(0<u){const [ja,ha]=G(M,ba,f,45),[ma,na]=G(x,D,f,45);b.push(ja);b.push(ha);b.push(fa);b.push(ia);b.push(ma);b.push(na)}else{const [ja,ha]=G(M,N,f,45),[ma,na]=G(K,W,f,45),[oa,la]=G(d,l,f,45);H.push(fa);H.push(ia);
H.push(oa);H.push(la);H.push(ma);H.push(na);H.push(ja);H.push(ha)}ba+=m;D+=m;N+=m;W+=m;l+=m}const [y,Q]=G(0+h,0+q,f,45);m=7*C;const [T,B]=G(0+m,0+q,f,45),[Z,Y]=G(0+h,0-A,f,45),[ea,da]=G(0+m,0-A,f,45);return{pennants:b,barbs:H,shaft:[y,Q,T,B,Z,Y,ea,da]}}function G(b,f,h,k=1){return[Math.sqrt(b*b+f*f)/k,(2*Math.PI+(2*Math.PI+Math.atan2(f,b))%(2*Math.PI)-h)%(2*Math.PI)]}function U(b,f,h,k){h=L(k||"knots",h);for(k=1;k<f.length;k++)if(k===f.length-1){if(b<f[k]*h)break}else if(b<=f[k]*h)break;return Math.min(k-
1,f.length-2)}function X(b,f,h,k,m){let q=0;switch(f){case "beaufort_kn":q=U(b,a,"knots",h);break;case "beaufort_km":q=U(b,a,"kilometer-per-hour",h);break;case "beaufort_ft":q=U(b,a,"feet-per-second",h);break;case "beaufort_m":q=U(b,a,"meter-per-second",h);break;case "classified_arrow":q=U(b,m??[],k,h);break;case "ocean_current_m":q=U(b,c,"meter-per-second",h);break;case "ocean_current_kn":q=U(b,e,"knots",h)}return q}function aa(b,f){const {style:h,inputUnit:k,outputUnit:m,breakValues:q}=f,A=t.fromJSON(k),
C=t.fromJSON(m);let x=0,D=0;const {width:M,height:N,mask:K}=b,W=b.pixels[0];b=b.pixels[1];var V=null!=K?K.filter(l=>0<l).length:M*N;const ba=new Float32Array(42*V);V=new Uint32Array(15*V);f=f.invertDirection?R(0,0,0,!1):z;for(let l=0;l<N;l++)for(let p=0;p<M;p++){var d=l*M+p;if(!K||K[l*M+p]){const u=(b[d]+360)%360/180*Math.PI,H=X(W[d],h,A,C,q);for(let y=0;y<f.length;y+=2)ba[x++]=(p+.5)/M,ba[x++]=(l+.5)/N,ba[x++]=f[y],ba[x++]=f[y+1]+u,ba[x++]=H,ba[x++]=W[d];d=7*(x/42-1);V[D++]=d;V[D++]=d+1;V[D++]=d+
2;V[D++]=d+0;V[D++]=d+4;V[D++]=d+3;V[D++]=d+0;V[D++]=d+2;V[D++]=d+3;V[D++]=d+2;V[D++]=d+5;V[D++]=d+3;V[D++]=d+5;V[D++]=d+6;V[D++]=d+3}}return{vertexData:ba,indexData:V}}function S(b,f){let h=0,k=0;const {width:m,height:q,mask:A}=b;b=b.pixels[0];const C=[],x=[];var D=t.fromJSON(f.inputUnit);D=L(D,"knots");f="wind_speed"===f.style?5:Number.MAX_VALUE;for(let N=0;N<q;N++)for(let K=0;K<m;K++){var M=b[N*m+K]*D;if((!A||A[N*m+K])&&M<f){for(let W=0;4>W;W++)C[h++]=(K+.5)/m,C[h++]=(N+.5)/q,C[h++]=2>W?-.5:.5,
C[h++]=0===W%2?-.5:.5,C[h++]=0,C[h++]=M;M=4*(h/24-1);x[k++]=M;x[k++]=M+1;x[k++]=M+2;x[k++]=M+1;x[k++]=M+2;x[k++]=M+3}}return{vertexData:new Float32Array(C),indexData:new Uint32Array(x)}}const n=new Map;n.set("meter-per-second",1);n.set("kilometer-per-hour",.277778);n.set("knots",.514444);n.set("feet-per-second",.3048);n.set("mile-per-hour",.44704);const r=180/Math.PI,t=new F.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",
esriMilesPerHour:"mile-per-hour"}),z=R(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],c=[0,.5,1,1.5,2],e=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],g=[];v.convertToLocalDirections=function(b,f,h,k="geographic"){if(!w.isValidPixelBlock(b)||null==h)return b;b="vector-magdir"===f?b.clone():E(b,f);const m=b.pixels[1];for(let q=0;q<m.length;q++)m[q]="geographic"===k?(m[q]+h[q]+270)%360:(m[q]+360-h[q])%360;return"vector-magdir"===f?b:E(b,"vector-magdir")};v.convertVectorFieldData=E;v.convertVectorFieldUnit=function(b,
f,h=1){if(1===h||!w.isValidPixelBlock(b))return b;b=b.clone();const {pixels:k,width:m,height:q}=b,A=k[0],C=k[1];let x=0;for(let D=0;D<q;D++)for(let M=0;M<m;M++)"vector-uv"===f?(A[x]*=h,C[x]*=h):A[x]*=h,x++;b.updateStatistics();return b};v.createVFMesh=function(b,f){if("simple_scalar"===f.style)f=S(b,f);else if("wind_speed"===f.style){if(0===g.length)for(var h=0;30>h;h++)g.push(P(5*h,0,!f.invertDirection));f=t.fromJSON(f.inputUnit);f=L(f,"knots");const {width:A,height:C,mask:x}=b;h=b.pixels[0];b=b.pixels[1];
const D=[],M=[];let N=0,K=0;for(let W=0;W<C;W++)for(let V=0;V<A;V++){var k=W*A+V,m=h[k]*f;if((!x||x[W*A+V])&&5<=m){const ba=(b[k]+360)%360/180*Math.PI,{pennants:d,barbs:l,shaft:p}=g[Math.min(Math.floor(m/5),29)];if(0===d.length+l.length)continue;k=D.length/6;const u=(V+.5)/A,H=(W+.5)/C;for(var q=0;q<d.length;q+=2)D[N++]=u,D[N++]=H,D[N++]=d[q],D[N++]=d[q+1]+ba,D[N++]=0,D[N++]=m;for(q=0;q<l.length;q+=2)D[N++]=u,D[N++]=H,D[N++]=l[q],D[N++]=l[q+1]+ba,D[N++]=0,D[N++]=m;for(q=0;q<p.length;q+=2)D[N++]=u,
D[N++]=H,D[N++]=p[q],D[N++]=p[q+1]+ba,D[N++]=0,D[N++]=m;for(m=0;m<d.length/6;m++)M[K++]=k,M[K++]=k+1,M[K++]=k+2,k+=3;for(m=0;m<l.length/8;m++)M[K++]=k,M[K++]=k+1,M[K++]=k+2,M[K++]=k+1,M[K++]=k+2,M[K++]=k+3,k+=4;M[K++]=k+0;M[K++]=k+1;M[K++]=k+2;M[K++]=k+1;M[K++]=k+3;M[K++]=k+2;k+=4}}f={vertexData:new Float32Array(D),indexData:new Uint32Array(M)}}else f=aa(b,f);return f};v.createVFMeshScalar=S;v.getUnitConversionFactor=L;v.sampleVectorField=function(b,f,h,k=[0,0],m=.5){const {width:q,height:A,mask:C}=
b,[x,D]=b.pixels,[M,N]=k;b=Math.round((q-M)/h);k=Math.round((A-N)/h);var K=b*k;const W=new Float32Array(K),V=new Float32Array(K);K=new Uint8Array(K);f="vector-uv"===f;for(let d=0;d<k;d++)for(let l=0;l<b;l++){let p=0;const u=d*b+l,H=Math.max(0,d*h+N),y=Math.max(0,l*h+M),Q=Math.min(A,H+h),T=Math.min(q,y+h);for(let B=H;B<Q;B++)for(let Z=y;Z<T;Z++){var ba=B*q+Z;if(!C||C[ba]){p++;ba=f?[x[ba],D[ba]]:[x[ba],(360+D[ba])%360];const [Y,ea]=f?ba:J(ba);W[u]+=Y;V[u]+=ea}}if(p>=(Q-H)*(T-y)*(1-m)){K[u]=1;const [B,
Z]=I([W[u]/p,V[u]/p]);W[u]=B;V[u]=Z}else K[u]=0,W[u]=0,V[u]=0}h=new O({width:b,height:k,pixels:[W,V],mask:K});h.updateStatistics();return h};v.snapImageToSymbolTile=function(b,f,h,k,m){if(null==m||!m.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(f/k),height:Math.round(h/k),resolution:b.width/f};const q=m.xmin;m=m.ymax;f=(b.xmax-b.xmin)/f*k;h=(b.ymax-b.ymin)/h*k;b.xmin=q+Math.floor((b.xmin-q)/f)*f;b.xmax=q+Math.ceil((b.xmax-q)/f)*f;b.ymin=m+Math.floor((b.ymin-m)/h)*h;
b.ymax=m+Math.ceil((b.ymax-m)/h)*h;return{extent:b,width:Math.round(b.width/f),height:Math.round(b.height/h),resolution:(f+h)/2}};v.unitKebabDict=t;v.uvComponentToVector=I;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(v,F,O,w,L){L=function(I){function J(){var R=I.apply(this,arguments)||
this;R.symbolTypes=["triangle"];return R}F._inherits(J,I);var E=J.prototype;E.prepareRenderPasses=function(R){const P=R.registerRenderPass({name:"imagery (vf)",brushes:[O],target:()=>this.children,drawPhase:w.WGLDrawPhase.MAP});return[...F._get(F._getPrototypeOf(J.prototype),"prepareRenderPasses",this).call(this,R),P]};E.doRender=function(R){this.visible&&R.drawPhase===w.WGLDrawPhase.MAP&&this.symbolTypes.forEach(P=>{R.renderPass=P;F._get(F._getPrototypeOf(J.prototype),"doRender",this).call(this,
R)})};F._createClass(J,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return J}(L);v.RasterVFContainer=L;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(v,F,O){const w=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,
.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),L=new Float32Array([0,
92/255,230/255,1]),I={beaufort_ft:w,beaufort_m:w,beaufort_km:w,beaufort_mi:w,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,
.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,
1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:L,single_arrow:L,wind_speed:new Float32Array([0,0,0,1])},J=[0,20];return function(E){function R(){var G=E.apply(this,arguments)||this;G._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};
return G}v._inherits(R,E);var P=R.prototype;P.dispose=function(){};P.prepareState=function({context:G}){G.setBlendingEnabled(!0);G.setBlendFunctionSeparate(O.BlendFactor.ONE,O.BlendFactor.ONE_MINUS_SRC_ALPHA,O.BlendFactor.ONE,O.BlendFactor.ONE_MINUS_SRC_ALPHA);G.setColorMask(!0,!0,!0,!0);G.setStencilWriteMask(0);G.setStencilTestEnabled(!0);G.setStencilOp(O.StencilOperation.KEEP,O.StencilOperation.KEEP,O.StencilOperation.REPLACE)};P.draw=function(G,U){if(null!=U.source&&0!==U.source.validPixelCount){var {context:X,
timeline:aa}=G;aa.begin(this.name);X.setStencilFunction(O.CompareFunction.EQUAL,U.stencilRef,255);U.updateVectorFieldVAO(G);if("scalar"===G.renderPass){var S=U.vaoData.scalar;S&&this._drawScalars(G,U,S.vao,S.elementCount)}else(S=U.vaoData.magdir)&&this._drawTriangles(G,U,S.vao,S.elementCount);aa.end(this.name)}};P._drawTriangles=function(G,U,X,aa){const {context:S,painter:n,requestRender:r,allowDelayedRender:t}=G,{symbolizerParameters:z}=U;var a=z.dataRange?["dataRange"]:[];"geographic"===z.rotationType&&
a.push("rotationGeographic");a=n.materialManager.getProgram(this._desc.magdir,a);if(t&&null!=r&&!a.compiled)r();else{S.useProgram(a);var {coordScale:c,opacity:e,transforms:g}=U;a.setUniform2fv("u_coordScale",c);a.setUniform1f("u_opacity",e);a.setUniformMatrix3fv("u_dvsMat3",g.dvs);var {style:b,dataRange:f,rotation:h,symbolPercentRange:k}=z;a.setUniform4fv("u_colors",I[b]);a.setUniform2fv("u_dataRange",f||J);a.setUniform1f("u_rotation",h);a.setUniform2fv("u_symbolPercentRange",k);G=this._getSymbolSize(G,
U);a.setUniform2fv("u_symbolSize",G);S.bindVAO(X);S.drawElements(O.PrimitiveType.TRIANGLES,aa,O.DataType.UNSIGNED_INT,0)}};P._drawScalars=function(G,U,X,aa){const {context:S,painter:n,requestRender:r,allowDelayedRender:t}=G,{symbolizerParameters:z}=U;var a=[];"wind_speed"===z.style?a.push("innerCircle"):z.dataRange&&a.push("dataRange");"geographic"===z.rotationType&&a.push("rotationGeographic");a=n.materialManager.getProgram(this._desc.scalar,a);if(t&&null!=r&&!a.compiled)r();else{S.useProgram(a);
var {coordScale:c,opacity:e,transforms:g}=U;a.setUniform2fv("u_coordScale",c);a.setUniform1f("u_opacity",e);a.setUniformMatrix3fv("u_dvsMat3",g.dvs);var {dataRange:b,symbolPercentRange:f}=z;a.setUniform2fv("u_dataRange",b||J);a.setUniform2fv("u_symbolPercentRange",f);G=this._getSymbolSize(G,U);a.setUniform2fv("u_symbolSize",G);S.bindVAO(X);S.drawElements(O.PrimitiveType.TRIANGLES,aa,O.DataType.UNSIGNED_INT,0)}};P._getSymbolSize=function(G,U){G=U.key?2**(G.displayLevel-U.key.level):U.resolution/G.state.resolution;
const {symbolTileSize:X}=U.symbolizerParameters;return[X/(Math.round((U.width-U.offset[0])/X)*X)/G,X/(Math.round((U.height-U.offset[1])/X)*X)/G]};return v._createClass(R)}(F)})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U){O=function(X){function aa(n){var r=X.call(this,n)||this;r._loading=null;r.update=L.debounce((t,z)=>r._update(t,z).catch(a=>{L.isAbortError(a)||w.getLogger(v._assertThisInitialized(r)).error(a)}));return r}v._inherits(aa,X);var S=aa.prototype;S.redraw=function(n){if(this.container.children.length){var r=this.container.children[0];r.symbolizerParameters=n;r.invalidateVAO();this.container.symbolTypes="wind_speed"===n.style?["scalar","triangle"]:"simple_scalar"===n.style?
["scalar"]:["triangle"];this.container.requestRender()}};S._update=async function(n,r,t){if(n.stationary){var {extent:z,spatialReference:a}=n.state,c=new G({xmin:z.xmin,ymin:z.ymin,xmax:z.xmax,ymax:z.ymax,spatialReference:a}),[e,g]=n.state.size;this._loading=this.fetchPixels(c,e,g,t);t=await this._loading;this._addToDisplay(t,r,n.state);this._loading=null}};S._addToDisplay=function(n,r,t){if(null==n.pixelBlock)this.container.children.forEach(e=>e.destroy()),this.container.removeAllChildren();else{var {extent:z,
pixelBlock:a}=n,c=new U.RasterVFDisplayObject(a);c.offset=[0,0];c.symbolizerParameters=r;c.rawPixelData=n;c.invalidateVAO();c.x=z.xmin;c.y=z.ymax;c.pixelRatio=t.pixelRatio;c.rotation=t.rotation;c.resolution=t.resolution;c.width=a.width*r.symbolTileSize;c.height=a.height*r.symbolTileSize;this.container.children.forEach(e=>e.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===r.style?["scalar","triangle"]:"simple_scalar"===r.style?["scalar"]:["triangle"];this.container.addChild(c)}};
v._createClass(aa,[{key:"updating",get:function(){return!!this._loading}}]);return aa}(O);F.__decorate([I.property()],O.prototype,"fetchPixels",void 0);F.__decorate([I.property()],O.prototype,"container",void 0);F.__decorate([I.property()],O.prototype,"_loading",void 0);F.__decorate([I.property()],O.prototype,"updating",null);return O=F.__decorate([P.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],O)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U){O=function(X){function aa(n=null){var r=X.call(this)||this;r._source=null;r._symbolizerParameters=null;r._vaoInvalidated=!0;r.coordScale=[1,1];r.height=null;r.key=null;r.offset=null;r.stencilRef=0;r.resolution=null;r.pixelRatio=1;r.x=0;r.y=0;r.rotation=0;r.rawPixelData=null;r.vaoData=null;r.width=null;r.source=n;return r}F._inherits(aa,X);var S=aa.prototype;S.destroy=function(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),
this.vaoData=null)};S.invalidateVAO=function(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};S.updateVectorFieldVAO=function(n){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:r}=this.symbolizerParameters;switch(r){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":r=
J.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(n.context,r)};break;case "simple_scalar":r=J.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(n.context,r)};break;case "wind_speed":r=J.createVFMesh(this.source,this.symbolizerParameters);r=this._createVectorFieldVAO(n.context,r);const t=J.createVFMeshScalar(this.source,this.symbolizerParameters);n=this._createVectorFieldVAO(n.context,t);this.vaoData=
{magdir:r,scalar:n}}}this.ready();this.requestRender()}};S._createTransforms=function(){return{dvs:L.create()}};S.setTransform=function(n){const r=w.identity(this.transforms.dvs),[t,z]=n.toScreenNoRotation([0,0],[this.x,this.y]);var a=this.resolution/this.pixelRatio/n.resolution;const c=a*this.width;a*=this.height;const e=Math.PI*this.rotation/180;w.translate(r,r,I.fromValues(t,z));w.translate(r,r,I.fromValues(c/2,a/2));w.rotate(r,r,-e);w.translate(r,r,I.fromValues(-c/2,-a/2));w.scaleByVec2(r,r,I.fromValues(c,
a));w.multiply(this.transforms.dvs,n.displayViewMat3,r)};S.onAttach=function(){this.invalidateVAO()};S.onDetach=function(){this.invalidateVAO()};S._createVectorFieldVAO=function(n,r){const {vertexData:t,indexData:z}=r;r=P.BufferObject.createVertex(n,G.Usage.STATIC_DRAW,new Float32Array(t));const a=P.BufferObject.createIndex(n,G.Usage.STATIC_DRAW,new Uint32Array(z)),c=R.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:G.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:G.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:G.DataType.FLOAT,normalized:!1}]});return{vao:new U.VertexArrayObject(n,c.attributes,c.bufferLayouts,{geometry:r},a),elementCount:z.length}};F._createClass(aa,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(n){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(n)&&(this._symbolizerParameters=n,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(n){this._source=n;this.invalidateVAO()}}]);return aa}(E.DisplayObject);v.RasterVFDisplayObject=O;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(v,F,O,w,L,I,J,E,R,P,G,U){return X=>{X=function(aa){function S(){var r=aa.apply(this,arguments)||this;r.view=null;return r}v._inherits(S,aa);var n=S.prototype;n.fetchPopupFeatures=async function(r,t){const {layer:z}=this;if(!r)throw new O("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:z});var {popupEnabled:a}=z;const c=U.getFetchPopupTemplate(z,t);if(!a||null==c)throw new O("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:a,popupTemplate:c});const e=await c.getRequiredFields();a=new G;a.timeExtent=this.timeExtent;a.geometry=r;a.outFields=e;a.outSpatialReference=r.spatialReference;const {resolution:g,spatialReference:b}=this.view;r="2d"===this.view.type?new R(g,g,b):new R(.5*g,.5*g,b);const {returnTopmostRaster:f,showNoDataRecords:h}=c.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return z.queryVisibleRasters(a,{returnDomainValues:!0,returnTopmostRaster:f,pixelSize:r,showNoDataRecords:h,
signal:null!=t?t.signal:null}).then(k=>k)};n.canResume=function(){return!v._get(v._getPrototypeOf(S.prototype),"canResume",this).call(this)||this.timeExtent?.isEmpty?!1:!0};return v._createClass(S)}(X);F.__decorate([w.property()],X.prototype,"layer",void 0);F.__decorate([w.property()],X.prototype,"suspended",void 0);F.__decorate([w.property(P.combinedViewLayerTimeExtentProperty)],X.prototype,"timeExtent",void 0);F.__decorate([w.property()],X.prototype,"view",void 0);return X=F.__decorate([E.subclass("esri.views.layers.ImageryLayerView")],
X)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(v,F){function O(w,L){return w.popupTemplate?w.popupTemplate:null!=L&&L.defaultPopupTemplateEnabled&&null!=w.defaultPopupTemplate?w.defaultPopupTemplate:null}v.getFetchPopupTemplate=O;v.getRequiredFields=async function(w,L=w.popupTemplate){if(null==L)return[];const I=await L.getRequiredFields(w.fieldsIndex);({lastEditInfoEnabled:L}=L);const {objectIdField:J,typeIdField:E,globalIdField:R,
relationships:P}=w;if(I.includes("*"))return["*"];L=L?await F.getFeatureEditFields(w):[];const G=F.fixFields(w.fieldsIndex,[...I,...L]);E&&G.push(E);G&&J&&w.fieldsIndex?.has(J)&&!G.includes(J)&&G.push(J);G&&R&&w.fieldsIndex?.has(R)&&!G.includes(R)&&G.push(R);P&&P.forEach(U=>{({keyField:U}=U);G&&U&&w.fieldsIndex?.has(U)&&!G.includes(U)&&G.push(U)});return G};v.hasPopupTemplate=function(w,L){return null!=O(w,{defaultPopupTemplateEnabled:L})};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(v,F,O,w,L,I,J,E,R,P){return G=>{G=function(U){function X(){return U.apply(this,arguments)||this}v._inherits(X,U);X.prototype.initialize=
function(){this.handles.add(L.on(()=>this.layer,"refresh",aa=>{this.doRefresh(aa.dataChanged).catch(S=>{w.isAbortError(S)||O.getLogger(this).error(S)})}),"RefreshableLayerView")};return v._createClass(X)}(G);F.__decorate([I.property()],G.prototype,"layer",void 0);return G=F.__decorate([P.subclass("esri.layers.mixins.RefreshableLayerView")],G)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(v,
F,O,w,L,I,J,E,R,P,G,U,X,aa,S,n,r,t,z,a){J=function(c){function e(){var b=c.apply(this,arguments)||this;b._exportImageVersion=-1;b._highlightGraphics=new G.GraphicsCollection;b._highlightView=void 0;b.layer=null;b.subview=null;return b}v._inherits(e,c);var g=e.prototype;g.hitTest=async function(b,f){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(b),layer:this.layer,mapPoint:b}]:null};g.update=function(b){this.subview?.update(b)};g.attach=function(){this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.view&&(this._highlightView=new aa({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new S(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([L.watch(()=>this.layer.blendMode??"normal",b=>this.subview&&(this.subview.container.blendMode=b),L.syncAndInitial),L.watch(()=>this.layer.effect??null,b=>this.subview&&(this.subview.container.effect=b),L.syncAndInitial),
L.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},L.sync),L.watch(()=>this.timeExtent,b=>{const {subview:f}=this;f&&(f.timeExtent=b,"redraw"in f?this.requestUpdate():f.redrawOrRefetch())},L.sync),this.layer.on("redraw",()=>{const {subview:b}=this;b&&("redraw"in b?b.redraw():b.redrawOrRefetch())}),L.watch(()=>this.layer.renderer,()=>this._setSubView())])};g.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1};g.moveStart=function(){};g.viewChange=function(){};g.moveEnd=function(){this.requestUpdate()};g.highlight=function(b,f){if(!((Array.isArray(b)?b[0]:w.isCollection(b)?b.at(0):b)instanceof O))return{remove:()=>{}};let h=[];Array.isArray(b)||w.isCollection(b)?h=b.map(k=>k.clone()):b instanceof O&&(h=[b.clone()]);this._highlightGraphics.addMany(h);
return{remove:()=>{this._highlightGraphics.removeMany(h)}}};g.doRefresh=async function(){this.requestUpdate()};g.isUpdating=function(){return!this.subview||this.subview.updating};g._setSubView=function(){if(this.view){var b=this.layer.renderer?.type,f="imagery";"vector-field"===b?f="imageryVF":"flow"===b&&(f="flow");if(this.subview){({type:b}=this.subview);if(b===f){this._attachSubview(this.subview);"flow"===b?this.subview.redrawOrRefetch():"imagery"===b&&"lerc"===this.layer.format?this.subview.redraw():
this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===f?new n({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===f?new r({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new U({layer:this.layer,layerView:this});this._attachSubview(this.subview);this.requestUpdate()}};g._attachSubview=function(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0),b.container.blendMode=this.layer.blendMode,
b.container.effect=this.layer.effect)};g._detachSubview=function(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)};v._createClass(e,[{key:"pixelData",get:function(){const {subview:b}=this;return this.updating||!b?null:"getPixelData"in b?b.getPixelData():null}}]);return e}(t(a(X.LayerView2DMixin(z))));F.__decorate([I.property()],J.prototype,"pixelData",null);F.__decorate([I.property()],J.prototype,"subview",void 0);return J=F.__decorate([P.subclass("esri.views.2d.layers.ImageryLayerView2D")],
J)});