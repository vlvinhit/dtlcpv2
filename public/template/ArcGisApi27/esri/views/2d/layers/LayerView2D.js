// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(p,h,e,r,t,u,d,g,B,C,D,v,w,x,y,z,A){const n=r.ofType({key:"type",base:null,typeMap:{rect:y,path:A,geometry:z}});p.LayerView2DMixin=c=>{c=function(k){function l(){var a=k.apply(this,arguments)||this;a.attached=!1;a.clips=new n;a.lastUpdateId=-1;a.moving=!1;a.updateRequested=!1;a.visibleAtCurrentScale=!1;a.highlightOptions=null;return a}h._inherits(l,k);var f=l.prototype;f.initialize=function(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new u("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new w.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([d.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},d.syncAndInitial),
d.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},d.syncAndInitial),d.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},d.syncAndInitial),d.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},d.syncAndInitial),d.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,d.syncAndInitial),d.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},d.syncAndInitial),d.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},d.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};f.destroy=function(){this.processDetach();this.updateRequested=!1};f.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};f.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};f.isVisibleAtScale=function(a){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:m,maxScale:q}=b;return(0===m||a<=m)&&(0===q||a>=q)};f.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};f.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};f.hitTest=function(a,b){return Promise.resolve(null)};f.supportsSpatialReference=function(a){return!0};
f.canResume=function(){return this.spatialReferenceSupported?h._get(h._getPrototypeOf(l.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};f.getSuspendInfo=function(){const a=h._get(h._getPrototypeOf(l.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,m=this.visibleAtCurrentScale;b&&(a.spatialReferenceNotSupported=b);m&&(a.outsideScaleRange=m);return a};f.addAttachHandles=function(a){this.addHandles(a,"attach")};h._createClass(l,[{key:"spatialReferenceSupported",
get:function(){const a=this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return l}(c);e.__decorate([g.property()],c.prototype,"attached",void 0);e.__decorate([g.property({type:n,set(k){k=t.referenceSetter(k,this._get("clips"),n);this._set("clips",k)}})],c.prototype,"clips",void 0);e.__decorate([g.property()],
c.prototype,"container",void 0);e.__decorate([g.property()],c.prototype,"moving",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"spatialReferenceSupported",null);e.__decorate([g.property({readOnly:!0})],c.prototype,"updateParameters",void 0);e.__decorate([g.property()],c.prototype,"updateRequested",void 0);e.__decorate([g.property()],c.prototype,"updating",null);e.__decorate([g.property()],c.prototype,"view",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"visibleAtCurrentScale",
void 0);e.__decorate([g.property({type:x})],c.prototype,"highlightOptions",void 0);return c=e.__decorate([v.subclass("esri.views.2d.layers.LayerView2D")],c)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});