// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),function(q,l,g,r,z,A,B,x,y){function m(d){return d.some(b=>b.globalId)}function k(d){return d.filter(b=>!b.error).map(b=>b.objectId??b.globalId).filter(b=>
null!=b)}function t(d,b){d=new Set(d);for(const e of b.values())d.add(e);return d}function u(d,b){d=new Set(d);for(const e of b.values())d.delete(e);return d}g=function(d){function b(a){var c=d.call(this,a)||this;c._hasGlobalIds=!1;c._notifyUpdating=()=>{c.notifyChange("updating")};return c}q._inherits(b,d);var e=b.prototype;e.normalizeCtorArgs=function(a){this._queueProcessor=new y.QueueProcessor({concurrency:1,process:a.process});return{}};e.destroy=function(){this.clear()};e.clear=function(){this._queueProcessor.clear()};
e.push=function(a){const c=this._queueProcessor;var f=c.last();switch(a.type){case "update":case "refresh":if(f?.type===a.type)return;c.push(a).then(this._notifyUpdating,this._notifyUpdating);break;case "edit":(f="processed-edit"===f?.type?f:null)&&c.popLast();a=this._mergeEdits(f,a);for(const h of a)h&&c.push(h).then(this._notifyUpdating,this._notifyUpdating)}this.notifyChange("updating")};e._mergeEdits=function(a,c){const {addedFeatures:f,deletedFeatures:h,updatedFeatures:n}=c.edits;if(this._hasGlobalIds=
this._hasGlobalIds||m(f)||m(n)||m(h))return c=[...f,...n],[a,{type:"processed-edit",edits:{addOrModified:c,removed:h}}];c=new Set(k(a?.edits.addOrModified??[]));a=new Set(k(a?.edits.removed??[]));const v=new Set([...k(f),...k(n)]),w=new Set(k(h));c=Array.from(t(u(c,w),v)).map(p=>({objectId:p}));a=Array.from(t(u(a,v),w)).map(p=>({objectId:p}));return[{type:"processed-edit",edits:{addOrModified:c,removed:a}}]};q._createClass(b,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);
return b}(g);l.__decorate([r.property({readOnly:!0})],g.prototype,"updating",null);l.__decorate([r.property()],g.prototype,"process",void 0);return g=l.__decorate([x.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],g)});