// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(k,d,e,b,a,c,f,l,h,m){k.BitmapTileLayerView2D=g=>{g=function(p){function u(){return p.apply(this,arguments)||this}d._inherits(u,
p);var z=u.prototype;z.attach=function(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new m.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)};z.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren()};return d._createClass(u)}(g);return g=e.__decorate([h.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],g)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g,p,u,z,y,A,n){const J=b.ofType({key:"type",base:null,typeMap:{rect:y,path:n,geometry:A}});k.LayerView2DMixin=D=>{D=function(M){function S(){var q=M.apply(this,arguments)||this;q.attached=!1;q.clips=new J;q.lastUpdateId=-1;q.moving=!1;q.updateRequested=!1;q.visibleAtCurrentScale=!1;q.highlightOptions=null;return q}d._inherits(S,M);var K=S.prototype;K.initialize=function(){const q=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&q&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new u.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([f.watch(()=>this.suspended,B=>{this.container&&(this.container.visible=!B);this.view&&!B&&this.updateRequested&&this.view.requestUpdate()},f.syncAndInitial),
f.watch(()=>this.layer?.opacity??1,B=>{this.container&&(this.container.opacity=B)},f.syncAndInitial),f.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",B=>{this.container&&(this.container.blendMode=B)},f.syncAndInitial),f.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,B=>{this.container&&(this.container.effect=B)},f.syncAndInitial),f.watch(()=>this.highlightOptions,B=>this.container.highlightOptions=B,f.syncAndInitial),f.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},f.syncAndInitial),f.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:B})=>{B=null!=B?this.isVisibleAtScale(B):!1;B!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",B)},f.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(B=>{B===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};K.destroy=function(){this.processDetach();this.updateRequested=!1};K.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};K.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};K.isVisibleAtScale=function(q){const B=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!B)return!0;
const {minScale:V,maxScale:X}=B;return(0===V||q<=V)&&(0===X||q>=X)};K.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};K.processUpdate=function(q){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",q),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(q)))};K.hitTest=function(q,B){return Promise.resolve(null)};K.supportsSpatialReference=function(q){return!0};
K.canResume=function(){return this.spatialReferenceSupported?d._get(d._getPrototypeOf(S.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};K.getSuspendInfo=function(){const q=d._get(d._getPrototypeOf(S.prototype),"getSuspendInfo",this).call(this),B=!this.spatialReferenceSupported,V=this.visibleAtCurrentScale;B&&(q.spatialReferenceNotSupported=B);V&&(q.outsideScaleRange=V);return q};K.addAttachHandles=function(q){this.addHandles(q,"attach")};d._createClass(S,[{key:"spatialReferenceSupported",
get:function(){const q=this.view?.spatialReference;return null==q||this.supportsSpatialReference(q)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return S}(D);e.__decorate([l.property()],D.prototype,"attached",void 0);e.__decorate([l.property({type:J,set(M){M=a.referenceSetter(M,this._get("clips"),J);this._set("clips",M)}})],D.prototype,"clips",void 0);e.__decorate([l.property()],
D.prototype,"container",void 0);e.__decorate([l.property()],D.prototype,"moving",void 0);e.__decorate([l.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);e.__decorate([l.property({readOnly:!0})],D.prototype,"updateParameters",void 0);e.__decorate([l.property()],D.prototype,"updateRequested",void 0);e.__decorate([l.property()],D.prototype,"updating",null);e.__decorate([l.property()],D.prototype,"view",void 0);e.__decorate([l.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",
void 0);e.__decorate([l.property({type:z})],D.prototype,"highlightOptions",void 0);return D=e.__decorate([p.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(k,d,e,b,a,c,f,l){var h;b=h=function(m){function g(u){u=m.call(this,u)||this;u.type="rect";u.left=null;u.right=null;u.top=null;u.bottom=null;return u}k._inherits(g,m);var p=g.prototype;p.clone=function(){return new h({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};p.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return k._createClass(g)}(l);d.__decorate([e.property({type:[Number,
String],json:{write:!0}})],b.prototype,"left",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],b.prototype,"right",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0);d.__decorate([e.property({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0);return b=h=d.__decorate([f.subclass("esri.views.layers.support.ClipRect")],b)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(k,d,e,b,a,c,f,l){e=function(h){function m(){return h.apply(this,arguments)||this}k._inherits(m,h);k._createClass(m,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return m}(e.JSONSupport);d.__decorate([b.property({readOnly:!0})],e.prototype,"version",null);return e=d.__decorate([l.subclass("esri.views.layers.support.ClipArea")],e)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g,p,u){var z;e={base:h,key:"type",typeMap:{extent:p,polygon:u}};g=z=function(y){function A(J){J=y.call(this,J)||this;J.type="geometry";J.geometry=null;return J}k._inherits(A,y);var n=A.prototype;n.clone=function(){return new z({geometry:this.geometry?.clone()??null})};n.commitVersionProperties=function(){this.commitProperty("geometry")};return k._createClass(A)}(g);d.__decorate([b.property({types:e,json:{read:m.fromJSON,write:!0}})],g.prototype,"geometry",void 0);return g=
z=d.__decorate([l.subclass("esri.views.layers.support.Geometry")],g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(k,d,e,b,a,c,f,l){b=function(h){function m(g){g=h.call(this,g)||this;g.type="path";g.path=[];return g}
k._inherits(m,h);m.prototype.commitVersionProperties=function(){this.commitProperty("path")};return k._createClass(m)}(l);d.__decorate([e.property({type:[[[Number]]],json:{write:!0}})],b.prototype,"path",void 0);return b=d.__decorate([f.subclass("esri.views.layers.support.Path")],b)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g){e=function(p){function u(){return p.apply(this,arguments)||this}k._inherits(u,p);var z=u.prototype;z.doRender=function(y){y.drawPhase===h.WGLDrawPhase.HIGHLIGHT&&k._get(k._getPrototypeOf(u.prototype),"doRender",this).call(this,y)};z.renderChildren=function(y){this.attributeView.update();if(this.children.some(n=>n.hasData)){this.attributeView.bindTextures(y.context);k._get(k._getPrototypeOf(u.prototype),"renderChildren",this).call(this,y);var {painter:A}=y;A=A.effects.highlight;
A.bind(y);y.context.setColorMask(!0,!0,!0,!0);y.context.clear(g.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(y,A.defines.concat(["highlightAll"]));A.draw(y);A.unbind()}};return k._createClass(u)}(m);return e=d.__decorate([l.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],e)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],function(k){function d(e){const b=document.createElement("canvas");[b.width,b.height]=e;return b}k.createBlankImage=d;k.resampleImage=
function(e,b,a,c){if(a.level===c.level)return b;const f=e.tileInfo.size;var l=e.getTileResolution(a.level),h=e.getTileResolution(c.level),m=e.getLODInfoAt(c.level),g=m.getXForColumn(c.col);c=m.getYForRow(c.row);m=e.getLODInfoAt(a.level);e=m.getXForColumn(a.col);const p=m.getYForRow(a.row);m=(b instanceof HTMLImageElement?b.naturalWidth:b.width)/f[0];a=(b instanceof HTMLImageElement?b.naturalHeight:b.height)/f[1];g=Math.round((g-e)/l*m);c=Math.round(-(c-p)/l*a);e=Math.round(h/l*f[0]*m);l=Math.round(h/
l*f[1]*a);h=d(f);h.getContext("2d").drawImage(b,g,c,e,l,0,0,f[0],f[1]);return h};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(k,d,e,b,a,c,f,l,h,m){return g=>{g=function(p){function u(){return p.apply(this,arguments)||this}k._inherits(u,p);u.prototype.initialize=function(){this.handles.add(a.on(()=>this.layer,"refresh",z=>{this.doRefresh(z.dataChanged).catch(y=>{b.isAbortError(y)||e.getLogger(this).error(y)})}),"RefreshableLayerView")};return k._createClass(u)}(g);d.__decorate([c.property()],g.prototype,"layer",void 0);return g=d.__decorate([m.subclass("esri.layers.mixins.RefreshableLayerView")],g)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/fieldUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ./popupUtils".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g,p,u,z,y,A,n,J,D,M,S,K,q,B,V,X,Y,Z){function aa(T,N,L){const t=[],x=v=>{var I=0===v.minScale||N<=v.minScale;const C=0===v.maxScale||N>=v.maxScale;v.visible&&I&&C&&(v.sublayers?v.sublayers.forEach(x):v.popupEnabled&&(I=Z.getFetchPopupTemplate(v,{...L,defaultPopupTemplateEnabled:!1}),null!=I&&t.unshift({sublayer:v,popupTemplate:I})))};(T?.toArray()??[]).reverse().map(x);return t}function ha(T){return T.expressionInfos?.length||Array.isArray(T.content)&&T.content.some(N=>
"expression"===N.type)?X.loadArcade():Promise.resolve()}async function ia(T,N){if(T.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(N.map(({sublayer:L})=>L.load().then(()=>L.capabilities.operations.supportsQuery)))}catch{return!1}}async function ja(T,N){const L=T.renderer;L&&"defaultSymbol"in L&&!L.defaultSymbol&&(N=L.valueExpression?await Promise.all(N.map(t=>L.getSymbolAsync(t).then(x=>x?t:null))).then(t=>t.filter(x=>null!=x)):N.filter(t=>null!=L.getSymbol(t)));return N}
let ba=null;d.MapServiceLayerViewHelper=function(T){function N(t){var x=T.call(this,t)||this;x._featuresResolutions=new WeakMap;x.highlightGraphics=null;x.highlightGraphicUpdated=null;x.updateHighlightedFeatures=u.debounce(async v=>{x.destroyed||x.updatingHandles.addPromise(x._updateHighlightedFeaturesGeometries(v).catch(()=>{}))});return x}e._inherits(N,T);var L=N.prototype;L.initialize=function(){const t=x=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(x).catch(()=>{}));
this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([z.on(()=>this.highlightGraphics,"change",x=>t(x.added),{onListenerAdd:x=>t(x)})])};L.fetchPopupFeatures=async function(t,x){const {layerView:{layer:v,view:{scale:I}}}=this;if(!t)throw new h("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:v});const C=aa(v.sublayers,I,x);if(!C.length)return[];const O=await ia(v,C);if(!((v.capabilities?.operations?.supportsIdentify??!0)&&10.5<=v.version||O))throw new h("fetchPopupFeatures:not-supported",
"query operation is disabled for this service",{layer:v});return O?this._fetchPopupFeaturesUsingQueries(t,C,x):this._fetchPopupFeaturesUsingIdentify(t,C,x)};L.clearHighlights=function(){this.highlightGraphics?.removeAll()};L.highlight=function(t){const x=this.highlightGraphics;if(!x)return{remove(){}};let v=null;t instanceof a?v=[t]:l.isCollection(t)&&0<t.length?v=t.toArray():Array.isArray(t)&&0<t.length&&(v=t);v=v?.filter(f.isSome);if(!v||!v.length)return m.makeHandle();for(const I of v)t=I.sourceLayer,
null!=t&&"geometryType"in t&&"point"===t.geometryType&&(I.visible=!1);x.addMany(v);return{remove:()=>{x.removeMany(v??[])}}};L._updateHighlightedFeaturesSymbols=async function(t){const {layerView:{view:x},highlightGraphics:v,highlightGraphicUpdated:I}=this;if(v&&I)for(const C of t){const O=C.sourceLayer&&"renderer"in C.sourceLayer&&C.sourceLayer.renderer;C.sourceLayer&&"geometryType"in C.sourceLayer&&"point"===C.sourceLayer.geometryType&&O&&"getSymbolAsync"in O&&O.getSymbolAsync(C).then(async w=>
{w||(w=new Y);let G=null;const H="visualVariables"in O?O.visualVariables?.find(F=>"size"===F.type):void 0;H&&(ba||(ba=(await new Promise((F,U)=>k(["../../../renderers/visualVariables/support/visualVariableUtils"],F,U))).getSize),G=ba(H,C,{view:x.type,scale:x.scale,shape:"simple-marker"===w.type?w.style:null}));G||(G="width"in w&&"height"in w&&null!=w.width&&null!=w.height?Math.max(w.width,w.height):"size"in w?w.size:16);v.includes(C)&&(C.symbol=new Y({style:"square",size:G,xoffset:"xoffset"in w?w.xoffset:
0,yoffset:"yoffset"in w?w.yoffset:0}),I(C,"symbol"),C.visible=!0)})}};L._updateHighlightedFeaturesGeometries=async function(t){const {layerView:{layer:x,view:v},highlightGraphics:I,highlightGraphicUpdated:C}=this;this._highlightGeometriesResolution=t;if(C&&I?.length&&x.capabilities.operations.supportsQuery){var O=this._getTargetResolution(t);t=new Map;for(var w of I)(!this._featuresResolutions.has(w)||this._featuresResolutions.get(w)>O)&&p.getOrCreateMapValue(t,w.sourceLayer,()=>new Map).set(w.getObjectId(),
w);w=Array.from(t,([G,H])=>{const F=G.createQuery();F.objectIds=[...H.keys()];F.outFields=[G.objectIdField];F.returnGeometry=!0;F.maxAllowableOffset=O;F.outSpatialReference=v.spatialReference;return G.queryFeatures(F)});w=await Promise.all(w);if(!this.destroyed)for(const {features:G}of w)for(const H of G)(w=t.get(H.sourceLayer).get(H.getObjectId()))&&I.includes(w)&&(w.geometry=H.geometry,C(w,"geometry"),this._featuresResolutions.set(w,O))}};L._getTargetResolution=function(t){const x=t*y.getMetersPerUnitForSR(this.layerView.view.spatialReference),
v=x/16;return 10>=v?0:t/x*v};L._fetchPopupFeaturesUsingIdentify=async function(t,x,v){t=await this._createIdentifyParameters(t,x,v);if(null==t)return[];({results:t}=await B.identify(this.layerView.layer.parsedUrl,t));return t.map(I=>I.feature)};L._createIdentifyParameters=async function(t,x,v){const {floors:I,layer:C,timeExtent:O,view:{spatialReference:w,scale:G}}=this.layerView,H=null!=v?v.event:null;if(!x.length)return null;await Promise.all(x.map(({sublayer:P})=>P.load().catch(()=>{})));x=Math.min(g("mapservice-popup-identify-max-tolerance"),
C.allSublayers.reduce((P,ea)=>ea.renderer?q.calculateTolerance({renderer:ea.renderer,event:H}):P,2));var F=this.createFetchPopupFeaturesQueryGeometry(t,x);const U=M.getResolutionForScale(G,w);v=Math.round(F.width/U);F=new D({xmin:F.center.x-U*v,ymin:F.center.y-U*v,xmax:F.center.x+U*v,ymax:F.center.y+U*v,spatialReference:F.spatialReference});return new V({floors:I,gdbVersion:"gdbVersion"in C?C.gdbVersion:void 0,geometry:t,height:v,layerOption:"popup",mapExtent:F,returnGeometry:!0,spatialReference:w,
sublayers:C.sublayers,timeExtent:O,tolerance:x,width:v})};L._fetchPopupFeaturesUsingQueries=async function(t,x,v){const {layerView:{floors:I,timeExtent:C}}=this,O=null!=v?v.event:null;x=x.map(async({sublayer:w,popupTemplate:G})=>{await w.load().catch(()=>{});if(w.capabilities&&!w.capabilities.operations.supportsQuery)return[];var H=w.createQuery(),F=q.calculateTolerance({renderer:w.renderer,event:O}),U=this.createFetchPopupFeaturesQueryGeometry(t,F),P=new Set;const [ea]=await Promise.all([Z.getRequiredFields(w,
G),w.renderer?.collectRequiredFields(P,w.fieldsIndex)]);S.collectFields(P,w.fieldsIndex,ea);P=Array.from(P).sort();H.geometry=U;H.outFields=P;H.timeExtent=C;I&&(P=I.clone(),P=K.getLayerFloorFilterClause(P,w),null!=P&&(H.where=H.where?`(${H.where}) AND (${P})`:P));F=this._getTargetResolution(U.width/F);U=await ha(G);G="point"===w.geometryType||U&&U.arcadeUtils.hasGeometryOperations(G);G||(H.maxAllowableOffset=F);({features:H}=await w.queryFeatures(H));G=G?0:F;H=await ja(w,H);for(const ma of H)this._featuresResolutions.set(ma,
G);return H});return(await u.eachAlways(x)).reverse().reduce((w,G)=>G.value?[...w,...G.value]:w,[]).filter(f.isSome)};return e._createClass(N)}(c);b.__decorate([A.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);b.__decorate([A.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"layerView",void 0);b.__decorate([A.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);b.__decorate([A.property({constructOnly:!0})],
d.MapServiceLayerViewHelper.prototype,"highlightGraphicUpdated",void 0);b.__decorate([A.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);d.MapServiceLayerViewHelper=b.__decorate([J.subclass("esri.views.layers.support.MapService")],d.MapServiceLayerViewHelper);d.collectPopupProviders=aa;d.isMapServiceLayerView=function(T,N){return"tile"===N.type||"map-image"===N.type};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports",
"../../core/unitUtils"],function(k,d){function e(b,a){a=d.getMetersPerUnitForSR(a);return b/(a*d.inchesPerMeter*96)}k.getExtentForScale=function(b,a){const c=b.extent;b=b.width-(b.padding?b.padding.left+b.padding.right:0);a=e(a,c.spatialReference);return c.clone().expand(a*b/c.width)};k.getResolutionForScale=e;k.getResolutionInMetersForScale=function(b){return b/(96*d.inchesPerMeter)};k.getScale=function(b,a){a=a||b.extent;b=b.width;const c=d.getMetersPerUnitForSR(a&&a.spatialReference);return a&&
b?a.width/b*c*d.inchesPerMeter*96:0};k.getScaleForResolution=function(b,a){a=d.getMetersPerUnitForSR(a);return b*a*d.inchesPerMeter*96};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(k){function d(e,b){if(!e?.length)return null;e=e.filter(a=>""!==a).map(a=>`'${a}'`);e.push("''");return`${b} IN (${e.join(",")}) OR ${b} IS NULL`}k.getFloorFilterClause=function(e){const b=e.layer;return"floorInfo"in b&&b.floorInfo?.floorField&&
"floors"in e.view?d(e.view.floors,b.floorInfo.floorField):null};k.getLayerFloorFilterClause=function(e,b){return"floorInfo"in b&&b.floorInfo?.floorField?d(e,b.floorInfo.floorField):null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(k){function d(a,c){return c?"xoffset"in c&&c.xoffset?Math.max(a,Math.abs(c.xoffset)):"yoffset"in c&&c.yoffset?Math.max(a,Math.abs(c.yoffset||0)):a:a}function e(a,c){if("number"===
typeof a)return a;if(a&&a.stops&&a.stops.length){a=a.stops;let f=c=0;for(let l=0;l<a.length;l++){const h=a[l].size;"number"===typeof h&&(c+=h,f++)}return c/f}return c}function b(a,c){if(!c)return a;c=c.filter(h=>"size"===h.type).map(h=>{const {maxSize:m,minSize:g}=h;return(e(m,a)+e(g,a))/2});let f=0;const l=c.length;if(0===l)return a;for(let h=0;h<l;h++)f+=c[h];return Math.max(Math.floor(f/l),a)}k.calculateTolerance=function(a){const c=a&&a.renderer;a="touch"===(a&&a.event&&a.event.pointerType)?9:
6;if(!c)return a;a="visualVariables"in c?b(a,c.visualVariables):a;if("simple"===c.type)return d(a,c.symbol);if("unique-value"===c.type){let f=a;c.uniqueValueInfos?.forEach(l=>{f=d(f,l.symbol)});return f}if("class-breaks"===c.type){let f=a;c.classBreakInfos.forEach(l=>{f=d(f,l.symbol)});return f}return a};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/rest/identify":function(){define("exports ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),
function(k,d,e,b,a,c,f){function l(g){g=g.data;g.results=g.results||[];g.exceededTransferLimit=!!g.exceededTransferLimit;g.results=g.results.map(p=>f.fromJSON(p));return g}function h(g){return g=c.from(g)}function m(g,p){function u(y){z.set(y.id,y);y.sublayers&&y.sublayers.forEach(u)}if(!p?.length)return g;const z=new Map;p.forEach(u);for(const y of g.results)y.feature.sourceLayer=z.get(y.layerId);return g}k.identify=async function(g,p,u){p=h(p);const z=p.geometry?[p.geometry]:[],y=b.parseUrl(g);
y.path+="/identify";return e.normalizeCentralMeridian(z).then(A=>{A=a.identifyToIdentifyRESTParameters(p,{geometry:A&&A[0]});A=b.encode({...y.query,f:"json",...A});A=b.asValidOptions(A,u);return d(y.path,A).then(l).then(n=>m(n,p.sublayers))})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),
function(k,d,e,b,a,c){function f(h){const {mapExtent:m,floors:g,width:p,sublayers:u,layerIds:z,layerOption:y,gdbVersion:A}=h;var n=u?.find(q=>null!=q.layer)?.layer?.serviceSublayers;const J="popup"===y;h={};const D=b.getScale({extent:m,width:p,spatialReference:m?.spatialReference}),M=[],S=q=>{const B=0===D,V=0===q.minScale||D<=q.minScale,X=0===q.maxScale||D>=q.maxScale;q.visible&&(B||V&&X)&&(q.sublayers?q.sublayers.forEach(S):!1!==z?.includes(q.id)&&(!J||q.popupTemplate&&q.popupEnabled)&&M.unshift(q))};
u?.forEach(S);if(u&&!M.length)h.layerIds=[];else{n=c.isExportDynamic(M,n,A);var K=M.map(q=>{const B=a.getLayerFloorFilterClause(g,q);return q.toExportImageJSON(B)});if(n)h.dynamicLayers=JSON.stringify(K);else if(u?(n=M.map(({id:q})=>q),z&&(n=n.filter(q=>z.includes(q))),h.layerIds=n):z?.length&&(h.layerIds=z),n=l(g,M),null!=n&&n.length){K={};for(const q of n)q.definitionExpression&&(K[q.id]=q.definitionExpression);Object.keys(K).length&&(h.layerDefs=JSON.stringify(K))}}return h}function l(h,m){const g=
!!h?.length;m=m.filter(p=>null!=p.definitionExpression||g&&null!=p.floorInfo);return m.length?m.map(p=>{var u=a.getLayerFloorFilterClause(h,p);u=d.sqlAnd(u,p.definitionExpression);return{id:p.id,definitionExpression:u??void 0}}):null}k.identifyToIdentifyRESTParameters=function(h,m){const {dpi:g,gdbVersion:p,geometry:u,geometryPrecision:z,height:y,layerOption:A,mapExtent:n,maxAllowableOffset:J,returnFieldName:D,returnGeometry:M,returnUnformattedValues:S,returnZ:K,spatialReference:q,timeExtent:B,tolerance:V,
width:X}=h.toJSON(),{dynamicLayers:Y,layerDefs:Z,layerIds:aa}=f(h);m=m&&null!=m.geometry?m.geometry:null;h={geometryPrecision:z,maxAllowableOffset:J,returnFieldName:D,returnGeometry:M,returnUnformattedValues:S,returnZ:K,tolerance:V};m=m&&m.toJSON()||u;h.imageDisplay=`${X},${y},${g}`;p&&(h.gdbVersion=p);m&&(delete m.spatialReference,h.geometry=JSON.stringify(m),h.geometryType=e.getJsonType(m));q?h.sr=q.wkid||JSON.stringify(q):m&&m.spatialReference?h.sr=m.spatialReference.wkid||JSON.stringify(m.spatialReference):
n&&n.spatialReference&&(h.sr=n.spatialReference.wkid||JSON.stringify(n.spatialReference));h.time=B?[B.start,B.end].join():null;if(n){const {xmin:ha,ymin:ia,xmax:ja,ymax:ba}=n;h.mapExtent=`${ha},${ia},${ja},${ba}`}Z&&(h.layerDefs=Z);Y&&!Z&&(h.dynamicLayers=Y);h.layers="popup"===A?"visible":A;aa&&!Y&&(h.layers+=`:${aa.join(",")}`);return h};k.toDynamicLayersJSON=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],
function(k,d){function e(b,a){if(!b||!b.length||null==a)return!0;a=a.slice().reverse().flatten(({sublayers:l})=>l&&l.toArray().reverse()).map(l=>l.id).toArray();if(b.length>a.length)return!1;let c=0;const f=a.length;for(const {id:l}of b){for(;c<f&&a[c]!==l;)c++;if(c>=f)return!1}return!0}k.isExportDynamic=function(b,a,c){return b.some(f=>{const l=f.source;return!(!l||"map-layer"===l.type&&l.mapLayerId===f.id&&(null==l.gdbVersion||l.gdbVersion===c))||f.originIdOf("renderer")>d.OriginId.SERVICE||f.originIdOf("labelingInfo")>
d.OriginId.SERVICE||f.originIdOf("opacity")>d.OriginId.SERVICE||f.originIdOf("labelsVisible")>d.OriginId.SERVICE})?!0:!e(b,a)};k.isSublayerOverhaul=function(b){return!!b&&b.some(a=>null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale)};k.shouldWriteSublayerStructure=function(b,a,c){return a.flatten(({sublayers:f})=>f).length!==b.length||b.some(f=>f.originIdOf("minScale")>c||f.originIdOf("maxScale")>c||f.originIdOf("renderer")>c||f.originIdOf("labelingInfo")>c||f.originIdOf("opacity")>
c||f.originIdOf("labelsVisible")>c||f.originIdOf("source")>c)?!0:!e(b,a)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g,p,u){var z;a=z=function(y){function A(n){n=y.call(this,n)||this;n.dpi=96;n.floors=null;n.gdbVersion=null;n.geometry=null;n.geometryPrecision=null;n.height=400;n.layerIds=null;n.layerOption="top";n.mapExtent=null;n.maxAllowableOffset=null;n.returnFieldName=!0;n.returnGeometry=!1;n.returnM=!1;n.returnUnformattedValues=!0;n.returnZ=!1;n.spatialReference=null;n.sublayers=null;n.timeExtent=null;n.tolerance=null;n.width=400;return n}k._inherits(A,y);A.from=function(n){return f.ensureClass(z,
n)};return k._createClass(A)}(a.JSONSupport);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"dpi",void 0);d.__decorate([c.property()],a.prototype,"floors",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],a.prototype,"gdbVersion",void 0);d.__decorate([c.property({types:e.geometryTypes,json:{read:g.fromJSON,write:!0}})],a.prototype,"geometry",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"geometryPrecision",void 0);d.__decorate([c.property({type:Number,
json:{write:!0}})],a.prototype,"height",void 0);d.__decorate([c.property({type:[Number],json:{write:!0}})],a.prototype,"layerIds",void 0);d.__decorate([c.property({type:["top","visible","all","popup"],json:{write:!0}})],a.prototype,"layerOption",void 0);d.__decorate([c.property({type:p,json:{write:!0}})],a.prototype,"mapExtent",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"maxAllowableOffset",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,
"returnFieldName",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnGeometry",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnM",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnUnformattedValues",void 0);d.__decorate([c.property({type:Boolean,json:{write:!0}})],a.prototype,"returnZ",void 0);d.__decorate([c.property({type:u,json:{write:!0}})],a.prototype,"spatialReference",void 0);d.__decorate([c.property()],
a.prototype,"sublayers",void 0);d.__decorate([c.property({type:b,json:{write:!0}})],a.prototype,"timeExtent",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"tolerance",void 0);d.__decorate([c.property({type:Number,json:{write:!0}})],a.prototype,"width",void 0);return a=z=d.__decorate([m.subclass("esri.rest.support.IdentifyParameters")],a)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),
function(k,d,e,b,a,c,f,l,h,m,g,p,u){e=function(z){function y(n){n=z.call(this,n)||this;n.displayFieldName=null;n.feature=null;n.layerId=null;n.layerName=null;return n}k._inherits(y,z);var A=y.prototype;A.readFeature=function(n,J){return b.fromJSON({attributes:{...J.attributes},geometry:{...J.geometry}})};A.writeFeature=function(n,J){if(n){var {attributes:D,geometry:M}=n;D&&(J.attributes={...D});null!=M&&(J.geometry=M.toJSON(),J.geometryType=u.typeKebabDictionary.toJSON(M.type))}};return k._createClass(y)}(a.JSONSupport);
d.__decorate([c.property({type:String,json:{write:!0}})],e.prototype,"displayFieldName",void 0);d.__decorate([c.property({type:b})],e.prototype,"feature",void 0);d.__decorate([m.reader("feature",["attributes","geometry"])],e.prototype,"readFeature",null);d.__decorate([p.writer("feature")],e.prototype,"writeFeature",null);d.__decorate([c.property({type:Number,json:{write:!0}})],e.prototype,"layerId",void 0);d.__decorate([c.property({type:String,json:{write:!0}})],e.prototype,"layerName",void 0);return e=
d.__decorate([g.subclass("esri.rest.support.IdentifyResult")],e)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(k,d){function e(b,a){return b.popupTemplate?b.popupTemplate:null!=a&&a.defaultPopupTemplateEnabled&&null!=b.defaultPopupTemplate?b.defaultPopupTemplate:null}k.getFetchPopupTemplate=e;k.getRequiredFields=async function(b,a=b.popupTemplate){if(null==a)return[];const c=await a.getRequiredFields(b.fieldsIndex);({lastEditInfoEnabled:a}=
a);const {objectIdField:f,typeIdField:l,globalIdField:h,relationships:m}=b;if(c.includes("*"))return["*"];a=a?await d.getFeatureEditFields(b):[];const g=d.fixFields(b.fieldsIndex,[...c,...a]);l&&g.push(l);g&&f&&b.fieldsIndex?.has(f)&&!g.includes(f)&&g.push(f);g&&h&&b.fieldsIndex?.has(h)&&!g.includes(h)&&g.push(h);m&&m.forEach(p=>{({keyField:p}=p);g&&p&&b.fieldsIndex?.has(p)&&!g.includes(p)&&g.push(p)});return g};k.hasPopupTemplate=function(b,a){return null!=e(b,{defaultPopupTemplateEnabled:a})};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../geometry","../../core/unitUtils","../../renderers/support/clickToleranceUtils","../../geometry/Extent"],function(k,d,e,b,a){function c(l,h,m,g=new a){let p=0;if("2d"===m.type)p=h*(m.resolution??0);else if("3d"===m.type){var u=m.overlayPixelSizeInMapUnits(l),z=m.basemapSpatialReference;p=null==z||z.equals(m.spatialReference)?h*u:e.getMetersPerUnitForSR(z)/e.getMetersPerUnitForSR(m.spatialReference)}h=
l.x-p;u=l.y-p;z=l.x+p;l=l.y+p;({spatialReference:m}=m);g.xmin=Math.min(h,z);g.ymin=Math.min(u,l);g.xmax=Math.max(h,z);g.ymax=Math.max(u,l);g.spatialReference=m;return g}const f=new a;k.createQueryGeometry=c;k.intersectsDrapedGeometry=function(l,h,m){l=m.toMap(l);if(null==l)return!1;const g=b.calculateTolerance();return c(l,g,m,f).intersects(h)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/scheduling ../../../request ../../../config ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/contextUtils ../../../chunks/builtins ../engine/webgl/definitions ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../core/accessorSupport/tracking/Flags ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils".split(" "),function(k,
d,e,b,a,c,f,l,h,m,g,p,u,z,y,A,n,J,D,M,S,K,q,B,V,X,Y,Z,aa,ha,ia,ja,ba,T,N,L,t,x,v,I,C,O,w,G,H,F,U,P,ea,ma,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,qa,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,ra,sa,ta,ka,ua,na,va,wa,xa,ya,oa,za){const Aa=[0,0];f=function(pa){function ca(){var r=pa.apply(this,arguments)||this;r._fetchQueue=null;r._highlightGraphics=new p.GraphicsCollection;r._highlightView=null;r._popupHighlightHelper=null;r._tileStrategy=null;r.layer=null;return r}k._inherits(ca,pa);var Q=ca.prototype;
Q.update=function(r){this._fetchQueue.pause();this._fetchQueue.state=r.state;this._tileStrategy.update(r);this._fetchQueue.resume();this._highlightView?.processUpdate(r)};Q.attach=function(){const r="tileServers"in this.layer?this.layer.tileServers:null,E=this.tilemapCache;this._tileInfoView=new ua(this.layer.tileInfo,this.layer.fullExtent,E?.effectiveMinLOD,E?.effectiveMaxLOD);this._fetchQueue=new va({tileInfoView:this._tileInfoView,concurrency:r&&10*r.length||10,process:(R,W)=>this.fetchTile(R,
W)});this._tileStrategy=new wa({cachePolicy:"keep",resampling:this.resampling,acquireTile:R=>this.acquireTile(R),releaseTile:R=>this.releaseTile(R),tileInfoView:this._tileInfoView});if(oa.isMapServiceLayerView(this,this.layer)){const R=this._highlightView=new qa({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new ta(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container);this._popupHighlightHelper=
new oa.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(W,da)=>za.createQueryGeometry(W,da,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(W,da)=>{R.graphicUpdateHandler({graphic:W,property:da})},layerView:this,updatingHandles:this.updatingHandles})}this.requestUpdate();this.addAttachHandles(a.watch(()=>this.resampling,()=>{this.doRefresh()}));k._get(k._getPrototypeOf(ca.prototype),"attach",this).call(this)};Q.detach=function(){k._get(k._getPrototypeOf(ca.prototype),
"detach",this).call(this);this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._popupHighlightHelper?.destroy();this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null};Q.fetchPopupFeatures=async function(r,E){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(r,E):[]};Q.highlight=function(r){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(r):{remove(){}}};Q.moveStart=function(){this.requestUpdate()};
Q.viewChange=function(){this.requestUpdate()};Q.moveEnd=function(){this.requestUpdate()};Q.supportsSpatialReference=function(r){return g.equals(this.layer.tileInfo?.spatialReference,r)};Q.doRefresh=async function(){!this.attached||this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.refresh(r=>this._enqueueTileFetch(r)))};Q.isUpdating=function(){return this._fetchQueue?.updating??!1};Q.acquireTile=function(r){r=this._bitmapView.createTile(r);const E=r.bitmap;[E.x,E.y]=
this._tileInfoView.getTileCoords(Aa,r.key);E.resolution=this._tileInfoView.getTileResolution(r.key);[E.width,E.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(r);this._bitmapView.addChild(r);this.requestUpdate();return r};Q.releaseTile=function(r){this._fetchQueue.abort(r.key.id);this._bitmapView.removeChild(r);r.once("detach",()=>r.destroy());this.requestUpdate()};Q.fetchTile=async function(r,E={}){var R=this.tilemapCache;const {signal:W,resamplingLevel:da=0}=E;if(!R)try{return await this._fetchImage(r,
W)}catch(fa){if(!b.isAbortError(fa)&&!this.resampling)return ka.createBlankImage(this._tileInfoView.tileInfo.size);if(3>da&&(R=this._tileInfoView.getTileParentId(r.id)))return R=new na(R),E=await this.fetchTile(R,{...E,resamplingLevel:da+1}),ka.resampleImage(this._tileInfoView,E,R,r);throw fa;}E=new na(0,0,0,0);let la;try{await R.fetchAvailabilityUpsample(r.level,r.row,r.col,E,{signal:W});if(E.level!==r.level&&!this.resampling)return ka.createBlankImage(this._tileInfoView.tileInfo.size);la=await this._fetchImage(E,
W)}catch(fa){if(b.isAbortError(fa))throw fa;la=await this._fetchImage(r,W)}return this.resampling?ka.resampleImage(this._tileInfoView,la,E,r):la};Q._enqueueTileFetch=async function(r){if(!this._fetchQueue.has(r.key.id)){try{const E=await this._fetchQueue.push(r.key);r.bitmap.source=E;r.bitmap.width=this._tileInfoView.tileInfo.size[0];r.bitmap.height=this._tileInfoView.tileInfo.size[1];r.requestRender();r.once("attach",()=>this.requestUpdate())}catch(E){b.isAbortError(E)||e.getLogger(this).error(E)}this.requestUpdate()}};
Q._fetchImage=async function(r,E){return this.layer.fetchImageBitmapTile(r.level,r.row,r.col,{signal:E})};k._createClass(ca,[{key:"resampling",get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling}},{key:"tilemapCache",get:function(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}}]);return ca}(ya(ra.BitmapTileLayerView2D(sa.LayerView2DMixin(xa))));d.__decorate([c.property()],f.prototype,"_fetchQueue",void 0);d.__decorate([c.property()],f.prototype,"resampling",
null);d.__decorate([c.property()],f.prototype,"tilemapCache",null);return f=d.__decorate([m.subclass("esri.views.2d.layers.TileLayerView2D")],f)});