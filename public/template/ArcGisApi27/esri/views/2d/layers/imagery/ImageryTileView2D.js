// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),function(l,p,u,m,A,B,w,x,y,z){m=function(v){function n(){var a=v.apply(this,arguments)||this;a.type="raster";return a}l._inherits(n,
v);var h=n.prototype;h.attach=function(){l._get(l._getPrototypeOf(n.prototype),"attach",this).call(this);this.container=new x.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()};h.detach=function(){l._get(l._getPrototypeOf(n.prototype),"detach",this).call(this);this.container.removeAllChildren();this.container=null};h.canUseWebGLForProcessing=function(){const {symbolizer:a}=this.layer;var b=a.lookup?.colormapLut?.indexedColormap;
b=b&&b.length>this._maxIndexedColormapSize;return this.useWebGLForProcessing&&a.canRenderInWebGL&&!b&&!("majority"===this.layer.interpolation&&z.canUseMajorityInterpolationOnDataSource(this.layer))};h.fetchTile=function(a,b){return this.layer.fetchTile(a.level,a.row,a.col,b)};h.updateRasterFunctionParameters=function(){const {raster:a,type:b}=this.layer,{container:e}=this;if("Function"!==a.datasetFormat||"wcs"===b)e.rasterFunctionChain=null,e.children.forEach(c=>{({bitmap:c}=c);c&&(c.suspended=!0,
c.processed=!1,c.projected&&(c.invalidateTexture(),c.rasterTexture=null))}),this._rasterFunctionState="na";else{var k=this._rasterFunctionState,{rasterFunction:g,primaryRasters:d}=a,f=g.supportsGPU&&(!d||1>=d.rasters.length),q=f?g.flatWebGLFunctionChain:null,{renderer:r}=this.layer;f=!f||!q?.functions.length||"raster-stretch"===r?.type&&r.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();e.rasterFunctionChain=f?null:q;var t=null==g?"na":e.rasterFunctionChain?"gpu":"cpu";e.children.forEach(c=>
{({bitmap:c}=c);c&&(c.suspended=k!==t,c.processed=!1,c.processedTexture=null)});this._rasterFunctionState=t}};h.updateTileSource=async function(a,b){const e=this._getBandIds(),k=this._getLayerInterpolation(),g=this.canUseWebGLForProcessing(),{source:d,globalSymbolizerParams:f,suspended:q,coords:r,resolution:t}=b;b=this.layerView.hasTilingEffects?f:b.symbolizerParams;({bitmap:a}=a);[a.x,a.y]=r;a.resolution=t;if(d&&null!=d&&null!=d.pixelBlock){var c={extent:d.extent,pixelBlock:d.pixelBlock};a.rawPixelData=
c;g?(a.source=d.pixelBlock,a.isRendereredSource=!1):(c=await this.layer.applyRenderer(c,"stretch"===f?.type?f:void 0),a.source=c,a.isRendereredSource=!0);a.symbolizerParameters=g?b:null;g?a.transformGrid||(a.transformGrid=d.transformGrid):a.transformGrid=null}else c=this.createEmptyTilePixelBlock(),a.source=c,a.symbolizerParameters=g?b:null,a.transformGrid=null;a.bandIds=g?e:null;a.width=this._tileInfoView.tileInfo.size[0];a.height=this._tileInfoView.tileInfo.size[1];a.interpolation=k;a.suspended=
q;a.invalidateTexture()};h.updateTileSymbolizerParameters=async function(a,b){const {local:e,global:k}=b;b=this._getBandIds();const g=this._getLayerInterpolation(),d=this.canUseWebGLForProcessing();({bitmap:a}=a);const {rawPixelData:f}=a;d||null==f?(a.isRendereredSource&&null!=f&&(a.source=f.pixelBlock),a.isRendereredSource=!1):(a.source=await this.layer.applyRenderer(f,"stretch"===k?.type?k:void 0),a.isRendereredSource=!0);a.symbolizerParameters=d?this.layerView.hasTilingEffects?k:e:null;a.bandIds=
d?b:null;a.interpolation=g;a.suspended=!1};h._getLayerInterpolation=function(){const {interpolation:a,renderer:b}=this.layer;if(!b)return a;const e=b.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":"raster-stretch"===b.type&&null!=b.colorRamp?"bilinear"===a||"cubic"===a?"bilinear":"nearest":a};return l._createClass(n)}(y.BaseImageryTileSubView2D);p.__decorate([u.property()],m.prototype,"container",void 0);p.__decorate([u.property()],m.prototype,"layer",void 0);p.__decorate([u.property()],
m.prototype,"type",void 0);return m=p.__decorate([w.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],m)});