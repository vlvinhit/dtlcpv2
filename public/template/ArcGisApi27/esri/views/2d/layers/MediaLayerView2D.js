// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(g,k,f,u,w,M,m,h,x,
C,y,d,p){g.MediaElementView=function(r){function F(n){return r.call(this,n)||this}k._inherits(F,r);k._createClass(F,[{key:"bounds",get:function(){const n=this.coords;return null==n||null==n.extent?null:d.fromExtent(n.extent)}},{key:"coords",get:function(){return y.projectOrLoad(this.element.georeference?.coords,this.spatialReference).geometry}},{key:"normalizedCoords",get:function(){return C.fromJSON(p.normalizeCentralMeridianSync(this.coords))}},{key:"normalizedBounds",get:function(){const n=null!=
this.normalizedCoords?this.normalizedCoords.extent:null;return null!=n?d.fromExtent(n):null}}]);return F}(u);f.__decorate([w.property()],g.MediaElementView.prototype,"spatialReference",void 0);f.__decorate([w.property()],g.MediaElementView.prototype,"element",void 0);f.__decorate([w.property()],g.MediaElementView.prototype,"bounds",null);f.__decorate([w.property()],g.MediaElementView.prototype,"coords",null);f.__decorate([w.property()],g.MediaElementView.prototype,"normalizedCoords",null);f.__decorate([w.property()],
g.MediaElementView.prototype,"normalizedBounds",null);g.MediaElementView=f.__decorate([x.subclass("esri.layers.support.MediaElementView")],g.MediaElementView);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/contextUtils ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexArrayObject".split(" "),
function(g,k,f,u,w,M,m,h,x,C,y,d,p,r,F,n,A,G){const v=x.create();return function(I){function E(e){var a=I.call(this)||this;a.elementView=e;a.isWrapAround=!1;a.perspectiveTransform=y.create();a._vertices=new Float32Array(20);a._handles=[];a._handles.push(h.watch(()=>a.elementView.element.opacity,c=>a.opacity=c,h.initial),h.watch(()=>[a.elementView.coords],()=>{a.requestRender()},h.initial),h.when(()=>a.elementView.element.loaded,()=>{const c=a.elementView.element;a.ready();"video"===c.type&&null!=
c.content&&a._handles.push(f.on(c.content,"play",()=>a.requestRender()))},h.initial));e.element.load().catch(c=>{u.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new k("element-load-error","Element cannot be displayed",{element:e,error:c}))});return a}g._inherits(E,I);var B=E.prototype;B.destroy=function(){this._handles.forEach(e=>e.remove());this.texture=M.disposeMaybe(this.texture)};B.beforeRender=function(e){const {context:a}=e,c=this.elementView.element.content;if(null!=c){var q=c instanceof
HTMLImageElement;const H=c instanceof HTMLVideoElement,J=q?c.naturalWidth:H?c.videoWidth:c.width;q=q?c.naturalHeight:H?c.videoHeight:c.height;this._updatePerspectiveTransform(J,q);if(this.texture)H&&!c.paused&&(this.texture.setData(c),this.requestRender(),(a.type===r.ContextType.WEBGL2||w.isPowerOfTwo(J)&&w.isPowerOfTwo(q))&&this.texture.generateMipmap());else{const K=new A.TextureDescriptor;K.wrapMode=F.TextureWrapMode.CLAMP_TO_EDGE;K.preMultiplyAlpha=!0;K.width=J;K.height=q;this.texture=new n.Texture(a,
K,c);(a.type===r.ContextType.WEBGL2||w.isPowerOfTwo(J)&&w.isPowerOfTwo(q))&&this.texture.generateMipmap();H&&!c.paused&&this.requestRender()}}g._get(g._getPrototypeOf(E.prototype),"beforeRender",this).call(this,e)};B._createTransforms=function(){return null};B.updateDrawCoords=function(e,a){var c=this.elementView.coords;if(null!=c){var [q,H,J,K]=c.rings[0];c=this._vertices;var {x:z,y:L}=e;(e=0!==a)?c.set([H[0]-z,H[1]-L,q[0]-z,q[1]-L,J[0]-z,J[1]-L,K[0]-z,K[1]-L,K[0]-z,K[1]-L,H[0]+a-z,H[1]-L,H[0]+a-
z,H[1]-L,q[0]+a-z,q[1]-L,J[0]+a-z,J[1]-L,K[0]+a-z,K[1]-L]):c.set([H[0]-z,H[1]-L,q[0]-z,q[1]-L,J[0]-z,J[1]-L,K[0]-z,K[1]-L]);this.isWrapAround=e}};B.getVAO=function(e,a,c){if(null==this.elementView.coords)return null;var q=this._vertices;this._vao?this._geometryVbo.setData(q):(this._geometryVbo=p.BufferObject.createVertex(e,F.Usage.DYNAMIC_DRAW,q),q=p.BufferObject.createVertex(e,F.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new G.VertexArrayObject(e,c,a,
{geometry:this._geometryVbo,tex:q}));return this._vao};B._updatePerspectiveTransform=function(e,a){const c=this._vertices;m.getProjectiveTransform(v,[0,0,e,0,0,a,e,a],[c[0],c[1],c[4],c[5],c[2],c[3],c[6],c[7]]);C.set(this.perspectiveTransform,v[6]/v[8]*e,v[7]/v[8]*a)};g._createClass(E,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return E}(d.DisplayObject)})},"esri/core/perspectiveUtils":function(){define("exports ../chunks/mat3 ../chunks/mat3f64 ../chunks/vec2 ../chunks/vec3 ../chunks/vec3f64".split(" "),
function(g,k,f,u,w,M){function m(d,p,r,F,n,A,G,v,I){k.set(d,p,F,A,r,n,G,1,1,1);w.set(h,v,I,1);k.adjoint(x,d);const [E,B,e]=w.transformMat3(h,h,k.transpose(x,x));k.set(x,E,0,0,0,B,0,0,0,e);return k.multiply(d,x,d)}const h=M.create(),x=f.create(),C=f.create(),y=f.create();g.getProjectiveTransform=function(d,p,r){m(C,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7]);m(y,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]);k.multiply(d,k.adjoint(C,C),y);0!==d[8]&&(d[0]/=d[8],d[1]/=d[8],d[2]/=d[8],d[3]/=d[8],d[4]/=d[8],d[5]/=
d[8],d[6]/=d[8],d[7]/=d[8],d[8]/=d[8]);return d};g.transformProjective=function(d,p,r){w.set(h,p[0],p[1],1);w.transformMat3(h,h,k.transpose(x,r));return 0===h[2]?u.set(d,h[0],h[1]):u.set(d,h[0]/h[2],h[1]/h[2])};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(g){function k(){return[1,0,0,0,1,0,0,0,1]}function f(m){return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8]]}function u(m,h,x,C,y,d,p,r,F){return[m,h,x,C,y,d,p,r,F]}
function w(m,h){return new Float64Array(m,h,9)}const M=Object.freeze(Object.defineProperty({__proto__:null,clone:f,create:k,createView:w,fromValues:u},Symbol.toStringTag,{value:"Module"}));g.clone=f;g.create=k;g.createView=w;g.fromValues=u;g.mat3f64=M})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),
function(g,k,f,u,w,M,m,h,x,C,y,d){return function(p){function r(){var n=p.apply(this,arguments)||this;n._localOrigin=k.createScreenPoint(0,0);n._viewStateId=-1;n._dvsMat3=u.create();n.requiresDedicatedFBO=!1;return n}g._inherits(r,p);var F=r.prototype;F.beforeRender=function(n){this._updateMatrices(n);this._updateOverlays(n,this.children);for(const A of this.children)A.beforeRender(n)};F.prepareRenderPasses=function(n){const A=n.registerRenderPass({name:"overlay",brushes:[C.brushes.overlay],target:()=>
this.children,drawPhase:y.WGLDrawPhase.MAP});return[...g._get(g._getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,n),A]};F._updateMatrices=function(n){var {state:A}=n;const {id:G,size:v,pixelRatio:I,resolution:E,rotation:B,viewpoint:e,displayMat3:a}=A;if(this._viewStateId!==G){n=Math.PI/180*B;var c=I*v[0],q=I*v[1],{x:H,y:J}=e.targetGeometry;A=m.normalizeMapX(H,A.spatialReference);this._localOrigin.x=A;this._localOrigin.y=J;A=E*c;var K=E*q,z=f.identity(this._dvsMat3);f.multiply(z,
z,a);f.translate(z,z,w.fromValues(c/2,q/2));f.scale(z,z,M.fromValues(c/A,-q/K,1));f.rotate(z,z,-n);this._viewStateId=G}};F._updateOverlays=function(n,A){const {state:G}=n,{rotation:v,spatialReference:I,worldScreenWidth:E,size:B,viewpoint:e}=G;n=this._localOrigin;let a=0;var c=h.getInfo(I);if(c&&I.isWrappable){var q=180/Math.PI*v,H=Math.round(B[0]*Math.abs(Math.cos(q))+B[1]*Math.abs(Math.sin(q)));const [K,z]=c.valid;c=x.getWorldWidth(I);const {x:L,y:aa}=e.targetGeometry;q=[0,0];G.toScreen(q,[L,aa]);
const T=[0,0];H=H>E?.5*E:.5*H;var J=Math.floor((L+.5*c)/c);const ba=K+J*c;J=z+J*c;const W=[q[0]+H,0];G.toMap(T,W);T[0]>J&&(a=c);W[0]=q[0]-H;G.toMap(T,W);T[0]<ba&&(a=-c);for(const U of A){A=U.elementView.bounds;if(null==A)continue;const [Y,,Z]=A;Y<K&&Z>K?U.updateDrawCoords(n,c):Z>z&&Y<z?U.updateDrawCoords(n,-c):U.updateDrawCoords(n,a)}}else for(q of A)q.updateDrawCoords(n,a)};g._createClass(r,[{key:"dvsMat3",get:function(){return this._dvsMat3}}]);return r}(d)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(g,k,f,u,w,M,m,h,x,C,y,d,p,r,F,n,A){const G=u.ofType({key:"type",base:null,typeMap:{rect:F,path:A,geometry:n}});g.LayerView2DMixin=v=>{v=function(I){function E(){var e=I.apply(this,arguments)||this;e.attached=!1;e.clips=new G;e.lastUpdateId=-1;e.moving=!1;e.updateRequested=!1;e.visibleAtCurrentScale=!1;e.highlightOptions=null;return e}k._inherits(E,I);var B=E.prototype;B.initialize=function(){const e=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&e&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new M("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([m.watch(()=>this.suspended,a=>{this.container&&(this.container.visible=!a);this.view&&!a&&this.updateRequested&&this.view.requestUpdate()},m.syncAndInitial),
m.watch(()=>this.layer?.opacity??1,a=>{this.container&&(this.container.opacity=a)},m.syncAndInitial),m.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",a=>{this.container&&(this.container.blendMode=a)},m.syncAndInitial),m.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,a=>{this.container&&(this.container.effect=a)},m.syncAndInitial),m.watch(()=>this.highlightOptions,a=>this.container.highlightOptions=a,m.syncAndInitial),m.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},m.syncAndInitial),m.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:a})=>{a=null!=a?this.isVisibleAtScale(a):!1;a!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",a)},m.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(a=>{a===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};B.destroy=function(){this.processDetach();this.updateRequested=!1};B.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};B.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};B.isVisibleAtScale=function(e){const a=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!a)return!0;
const {minScale:c,maxScale:q}=a;return(0===c||e<=c)&&(0===q||e>=q)};B.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};B.processUpdate=function(e){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e)))};B.hitTest=function(e,a){return Promise.resolve(null)};B.supportsSpatialReference=function(e){return!0};
B.canResume=function(){return this.spatialReferenceSupported?k._get(k._getPrototypeOf(E.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};B.getSuspendInfo=function(){const e=k._get(k._getPrototypeOf(E.prototype),"getSuspendInfo",this).call(this),a=!this.spatialReferenceSupported,c=this.visibleAtCurrentScale;a&&(e.spatialReferenceNotSupported=a);c&&(e.outsideScaleRange=c);return e};B.addAttachHandles=function(e){this.addHandles(e,"attach")};k._createClass(E,[{key:"spatialReferenceSupported",
get:function(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return E}(v);f.__decorate([h.property()],v.prototype,"attached",void 0);f.__decorate([h.property({type:G,set(I){I=w.referenceSetter(I,this._get("clips"),G);this._set("clips",I)}})],v.prototype,"clips",void 0);f.__decorate([h.property()],
v.prototype,"container",void 0);f.__decorate([h.property()],v.prototype,"moving",void 0);f.__decorate([h.property({readOnly:!0})],v.prototype,"spatialReferenceSupported",null);f.__decorate([h.property({readOnly:!0})],v.prototype,"updateParameters",void 0);f.__decorate([h.property()],v.prototype,"updateRequested",void 0);f.__decorate([h.property()],v.prototype,"updating",null);f.__decorate([h.property()],v.prototype,"view",void 0);f.__decorate([h.property({readOnly:!0})],v.prototype,"visibleAtCurrentScale",
void 0);f.__decorate([h.property({type:r})],v.prototype,"highlightOptions",void 0);return v=f.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],v)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(g,k,f,u,w,M,m,h){var x;u=x=function(C){function y(p){p=C.call(this,p)||this;p.type="rect";p.left=null;p.right=null;p.top=null;p.bottom=null;return p}g._inherits(y,C);var d=y.prototype;d.clone=function(){return new x({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};d.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return g._createClass(y)}(h);k.__decorate([f.property({type:[Number,
String],json:{write:!0}})],u.prototype,"left",void 0);k.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0);k.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0);k.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0);return u=x=k.__decorate([m.subclass("esri.views.layers.support.ClipRect")],u)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(g,k,f,u,w,M,m,h){f=function(x){function C(){return x.apply(this,arguments)||this}g._inherits(C,x);g._createClass(C,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return C}(f.JSONSupport);k.__decorate([u.property({readOnly:!0})],f.prototype,"version",null);return f=k.__decorate([h.subclass("esri.views.layers.support.ClipArea")],f)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(g,k,f,u,w,M,m,h,x,C,y,d,p){var r;f={base:x,key:"type",typeMap:{extent:d,polygon:p}};y=r=function(F){function n(G){G=F.call(this,G)||this;G.type="geometry";G.geometry=null;return G}g._inherits(n,F);var A=n.prototype;A.clone=function(){return new r({geometry:this.geometry?.clone()??null})};A.commitVersionProperties=function(){this.commitProperty("geometry")};return g._createClass(n)}(y);k.__decorate([u.property({types:f,json:{read:C.fromJSON,write:!0}})],y.prototype,"geometry",void 0);return y=
r=k.__decorate([h.subclass("esri.views.layers.support.Geometry")],y)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(g,k,f,u,w,M,m,h){u=function(x){function C(y){y=x.call(this,y)||this;y.type="path";y.path=[];return y}
g._inherits(C,x);C.prototype.commitVersionProperties=function(){this.commitProperty("path")};return g._createClass(C)}(h);k.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],u.prototype,"path",void 0);return u=k.__decorate([m.subclass("esri.views.layers.support.Path")],u)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../symbols ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/Error ../../../core/scheduling ../../../request ../../../config ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/contextUtils ../../../chunks/builtins ../engine/webgl/definitions ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../core/accessorSupport/tracking/Flags ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ../tiling/PagedTileQueue ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView ../../../geometry/Extent".split(" "),function(g,
k,f,u,w,M,m,h,x,C,y,d,p,r,F,n,A,G,v,I,E,B,e,a,c,q,H,J,K,z,L,aa,T,ba,W,U,Y,Z,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ea,fa,ha,ia,ja,ka,la){function ca(R,P,D){R.getTileBounds(N,P.key,!0);V.xmin=N[0];V.ymin=N[1];V.xmax=N[2];V.ymax=N[3];return H.extentIntersectsPolygon(V,D)}let S=function(R){function P(){var b=R.apply(this,arguments)||this;b._overlayContainer=null;
b._fetchQueue=null;b._tileStrategy=null;b._elementReferences=new Map;b._debugGraphicsView=null;b.layer=null;b.elements=new F;return b}g._inherits(P,R);var D=P.prototype;D.attach=function(){this.addAttachHandles([I.on(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(b=>this._updateTile(b));this.requestUpdate()}),I.on(()=>this.layer.effectiveSource,"change",({element:b})=>this._elementUpdateHandler(b))]);this._overlayContainer=new ia;this.container.addChild(this._overlayContainer);
this._fetchQueue=new ea({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(b,l)=>this._queryElements(b,l)});this._tileStrategy=new fa({cachePolicy:"purge",resampling:!0,acquireTile:b=>this._acquireTile(b),releaseTile:b=>this._releaseTile(b),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()};D.detach=function(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();
this._elementReferences.clear();this._debugGraphicsView?.destroy()};D.supportsSpatialReference=function(b){return!0};D.moveStart=function(){this.requestUpdate()};D.viewChange=function(){this.requestUpdate()};D.moveEnd=function(){this.requestUpdate()};D.update=function(b){this._tileStrategy.update(b);this._debugGraphicsView?.update(b)};D.hitTest=async function(b,l){l=[];var t=b.normalize();t=[t.x,t.y];for(const {projectedElement:{normalizedCoords:O,element:X}}of this._elementReferences.values())null!=
O&&q.ringsContainsCoords(O.rings,t)&&l.push({type:"media",element:X,layer:this.layer,mapPoint:b});return l.reverse()};D.canResume=function(){return null!=this.layer.source&&g._get(g._getPrototypeOf(P.prototype),"canResume",this).call(this)};D.doRefresh=async function(){this._fetchQueue.reset();this._tileStrategy.refresh(b=>this._updateTile(b))};D._acquireTile=function(b){b=new ma(b.clone());this._updateTile(b);return b};D._updateTile=function(b){this.updatingHandles.addPromise(this._fetchQueue.push(b.key).then(l=>
{const [t,O]=b.setElements(l);this._referenceElements(b,t);this._dereferenceElements(b,O);this.requestUpdate()},l=>{v.isAbortError(l)||A.getLogger(this).error(l)}))};D._releaseTile=function(b){this._fetchQueue.abort(b.key.id);b.elements&&this._dereferenceElements(b,b.elements);this.requestUpdate()};D._queryElements=async function(b,l){const t=this.layer.effectiveSource;if(null==t)return[];this.view.featuresTilingScheme.getTileBounds(N,b,!0);b=new la({xmin:N[0],ymin:N[1],xmax:N[2],ymax:N[3],spatialReference:this.view.spatialReference});
return t.queryElements(b,l)};D._referenceElements=function(b,l){if(null!=this.layer.source)for(const t of l)this._referenceElement(b,t)};D._referenceElement=function(b,l){G.getOrCreateMapValue(this._elementReferences,l.uid,()=>{const t=new J.MediaElementView({element:l,spatialReference:this.view.spatialReference}),O=new ha(t);this._overlayContainer.addChild(O);this.elements.add(l);return{tiles:new Set,projectedElement:t,overlay:O,debugGraphic:null}}).tiles.add(b)};D._dereferenceElements=function(b,
l){for(const t of l)this._dereferenceElement(b,t)};D._dereferenceElement=function(b,l){const t=this._elementReferences.get(l.uid);t.tiles.delete(b);t.tiles.size||(this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(l.uid),this.elements.remove(l),this._debugGraphicsView?.graphics.remove(t.debugGraphic))};D._elementUpdateHandler=function(b){var l=this._elementReferences.get(b.uid);if(l){const X=l.projectedElement.normalizedCoords;
if(null==X)this._overlayContainer.removeChild(l.overlay),l.overlay.destroy(),l.projectedElement.destroy(),this._elementReferences.delete(b.uid),this.elements.remove(b),this._debugGraphicsView?.graphics.remove(l.debugGraphic);else{var t=[],O=[];for(const Q of this._tileStrategy.tiles){const da=ca(this.view.featuresTilingScheme,Q,X);l.tiles.has(Q)?da||O.push(Q):da&&t.push(Q)}for(const Q of t)this._referenceElement(Q,b);for(const Q of O)this._dereferenceElement(Q,b);l=this._elementReferences.get(b.uid);
l?.debugGraphic&&(l.debugGraphic.geometry=l.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:l.debugGraphic,property:"geometry"}))}}else if(l=(new J.MediaElementView({element:b,spatialReference:this.view.spatialReference})).normalizedCoords,null!=l)for(t of this._tileStrategy.tiles)ca(this.view.featuresTilingScheme,t,l)&&this._referenceElement(t,b)};return g._createClass(P)}(ja.LayerView2DMixin(ka));k.__decorate([E.property()],S.prototype,"_fetchQueue",void 0);
k.__decorate([E.property()],S.prototype,"layer",void 0);k.__decorate([E.property({readOnly:!0})],S.prototype,"elements",void 0);S=k.__decorate([a.subclass("esri.views.2d.layers.MediaLayerView2D")],S);const N=c.create(),V={xmin:0,ymin:0,xmax:0,ymax:0};let ma=function(){function R(D){this.key=D;this.elements=null;this.isReady=!1;this.visible=!0}var P=R.prototype;P.setElements=function(D){const b=[],l=new Set(this.elements);this.elements=D;for(const t of D)l.has(t)?l.delete(t):b.push(t);this.isReady=
!0;return[b,Array.from(l)]};P.destroy=function(){};return g._createClass(R)}();return S});