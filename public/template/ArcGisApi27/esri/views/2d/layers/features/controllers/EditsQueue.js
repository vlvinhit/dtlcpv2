// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),function(d,p,m,w,q,r,B,C,D,x){d.EditsQueue=function(t){function k(a){a=t.call(this,a)||this;a._queue=[];a._onGoingRequest=
null;a._abortController=new AbortController;return a}p._inherits(k,t);var l=k.prototype;l.destroy=function(){this.clear()};l.clear=function(){if(this.destroyed)throw Error("instance is already destroyed");let a=this._queue.pop();for(;a;)a.resolver.reject(q.createAbortError()),a=this._queue.pop();this._queue.length=0;this._abortController.abort();this._abortController=new AbortController};l.push=async function(a){if(this.destroyed)throw Error("instance is already destroyed");const e=q.createResolver();
this._queue.push({event:a,resolver:e});this.notifyChange("updating");Promise.resolve().then(()=>{this._processNext()});return e.promise};l._processNext=async function(){if(!this._onGoingRequest){for(var a=[],e=new Set,f=new Set,g=new Set,n=this._queue.shift();n;){const {event:{addedFeatures:c,deletedFeatures:y,updatedFeatures:z},resolver:A}=n;a.push(A);for(const {objectId:b,error:h}of c)h||null==b||(e.add(b),f.add(b),g.delete(b));for(const {objectId:b,error:h}of z)h||null==b||(f.add(b),g.delete(b));
for(const {objectId:b,error:h}of y)h||null==b||(e.has(b)?e.delete(b):g.add(b),f.delete(b));n=this._queue.shift()}if(f.size||g.size){var u=[],v=[];f.size&&f.forEach(c=>{u.push(c)});g.size&&g.forEach(c=>{v.push(c)});this._onGoingRequest=Promise.resolve().then(()=>this.processEdits(u,v,{signal:this._abortController.signal})).catch(()=>{});this.notifyChange("updating");await this._onGoingRequest;this._onGoingRequest=null;this.notifyChange("updating");a.forEach(c=>c());0<this._queue.length&&this._processNext()}else this.notifyChange("updating"),
a.forEach(c=>c())}};p._createClass(k,[{key:"updating",get:function(){return!this.destroyed&&(0<this._queue.length||null!=this._onGoingRequest)}}]);return k}(w);m.__decorate([r.property({constructOnly:!0})],d.EditsQueue.prototype,"processEdits",void 0);m.__decorate([r.property({readOnly:!0})],d.EditsQueue.prototype,"updating",null);d.EditsQueue=m.__decorate([x.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],d.EditsQueue);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});