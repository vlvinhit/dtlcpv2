// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../arcade/arcadeTimeUtils ../../../../../core/has ../../../../../core/maybe ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),function(m,q,f,n,r,h,t,u,v,p,w,x){let k=0;f=h("featurelayer-simplify-thresholds")??
[.5,.5,.5,.5];const y=f[0],z=f[1],A=f[2],B=f[3];f=h("featurelayer-simplify-payload-size-factors")??[1,2,4];const C=f[0],D=f[1],E=f[2],F=h("featurelayer-simplify-mobile-factor")??2,G=h("esri-mobile");h=function(){function l(a,b){this.type="FeatureSetReader";this.arcadeDeclaredClass="esri.arcade.Feature";this.seen=!1;this._ty=this._tx=this.instance=0;this._sy=this._sx=1;this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._level=0;this.contextTimeReference=this._datetimeMetadata=null;
this.instance=a;this._layerSchema=b}l.createInstance=function(){k++;return k=65535<k?0:k};var c=l.prototype;c.getAreaSimplificationThreshold=function(a,b){let d=1;const e=G?F:1;4E6<b?d=E*e:1E6<b?d=D*e:5E5<b?d=C*e:1E5<b&&(d=e);b=0;4E3<a?b=B*d:2E3<a?b=A*d:100<a?b=z:15<a&&(b=y);a=8;4>this._level?a=1:5>this._level?a=2:6>this._level&&(a=4);return b*a};c.createQuantizedExtrudedQuad=function(a,b){return new p([5],[a-1,b,1,-1,1,1,-1,1,-1,-1])};c.parseTimestampOffset=function(a){return a};c.setArcadeSpatialReference=
function(a){this._arcadeSpatialReference=a};c.attachStorage=function(a){this._storage=a};c.getQuantizationTransform=function(){throw Error("Unable to find transform for featureSet");};c.getStorage=function(){return this._storage};c.getComputedNumeric=function(a){return this.getComputedNumericAtIndex(0)};c.setComputedNumeric=function(a,b){return this.setComputedNumericAtIndex(b,0)};c.getComputedString=function(a){return this.getComputedStringAtIndex(0)};c.setComputedString=function(a,b){return this.setComputedStringAtIndex(0,
b)};c.getComputedNumericAtIndex=function(a){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),a)};c.setComputedNumericAtIndex=function(a,b){this._storage.setComputedNumericAtIndex(this.getDisplayId(),a,b)};c.getComputedStringAtIndex=function(a){return this._storage.getComputedStringAtIndex(this.getDisplayId(),a)};c.setComputedStringAtIndex=function(a,b){return this._storage.setComputedStringAtIndex(this.getDisplayId(),a,b)};c.transform=function(a,b,d,e){const g=this.copy();g._tx+=
a;g._ty+=b;g._sx*=d;g._sy*=e;return g};c.readAttribute=function(a,b=!1){var d=this._readAttribute(a,b);if(void 0!==d)return d;for(const e of this._joined)if(e.setIndex(this.getIndex()),d=e._readAttribute(a,b),void 0!==d)return d};c.readAttributes=function(){const a=this._readAttributes();for(const b of this._joined){b.setIndex(this.getIndex());const d=b._readAttributes();for(const e of Object.keys(d))a[e]=d[e]}return a};c.joinAttributes=function(a){this._joined.push(a)};c.readArcadeFeature=function(){return this};
c.hasField=function(a){return this.fields.has(a)};c.geometry=function(){var a=this.readHydratedGeometry();a=v.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM);if(a=x.fromJSON(a))a.spatialReference=this._arcadeSpatialReference;return a};c.autocastArcadeDate=function(a,b){return b&&b instanceof Date?this.isUnknownDateTimeField(a)?n.ArcadeDate.unknownDateJSToArcadeDate(b):n.ArcadeDate.dateJSAndZoneToArcadeDate(b,this.contextTimeReference?.timeZone??"system"):b};c.isUnknownDateTimeField=function(a){return"unknown"===
this.dateTimeReferenceFieldIndex?.fieldTimeZone(a)};c.fieldSourceTimeZone=function(a){return this.dateTimeReferenceFieldIndex?.fieldTimeZone(a)??""};c.field=function(a){if(this.hasField(a))return this.autocastArcadeDate(a,this.readAttribute(a,!0));for(var b of this._joined)if(b.setIndex(this.getIndex()),b.hasField(a))return b=b._readAttribute(a,!0),this.autocastArcadeDate(a,b);throw Error(`Field ${a} does not exist`);};c.setField=function(a,b){throw Error("Unable to update feature attribute values, feature is readonly");
};c.keys=function(){return this.fields.fields.map(a=>a.name)};c.castToText=function(a=!1){if(!a)return JSON.stringify(this.readLegacyFeature());a=this.readLegacyFeature();if(!a)return JSON.stringify(null);a={geometry:a.geometry,attributes:{...(a.attributes??{})}};for(const b in a.attributes){const d=a.attributes[b];d instanceof Date&&(a.attributes[b]=d.getTime())}return JSON.stringify(a)};c.gdbVersion=function(){return null};c.fullSchema=function(){return this._layerSchema};c.castAsJson=function(a=
null){return{attributes:this._readAttributes(),geometry:!0===a?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}};c.castAsJsonAsync=function(a,b=null){return Promise.resolve(this.castAsJson(b))};c.removeIds=function(a){if(null==this._objectIdToIndex){var b=new Map;const d=this.getCursor();for(;d.next();){const e=t.unwrapOrThrow(d.getObjectId());b.set(e,d.getIndex())}this._objectIdToIndex=b}b=this._objectIdToIndex;for(const d of a)b.has(d)&&this.removeAtIndex(b.get(d))};c.removeAtIndex=
function(a){null==this._deleted&&(this._deleted=w.StaticBitSet.create(this.getSize()));this._deleted.set(a)};c.readGeometryForDisplay=function(){return this.readUnquantizedGeometry(!0)};c.readLegacyGeometryForDisplay=function(){return this.readLegacyGeometry(!0)};c.features=function*(){const a=this.getCursor();for(;a.next();)yield a.readOptimizedFeature()};c._getExists=function(){return null==this._deleted||!this._deleted.has(this.getIndex())};c._computeCentroid=function(){if("esriGeometryPolygon"!==
this.geometryType)return null;const a=this.readUnquantizedGeometry();if(!a||a.hasIndeterminateRingOrder)return null;const b=this.getQuantizationTransform()??null;return u.getCentroidOptimizedGeometry(new p,a,this.hasM,this.hasZ,b)};c.copyInto=function(a){a.seen=this.seen;a._storage=this._storage;a._arcadeSpatialReference=this._arcadeSpatialReference;a._joined=this._joined;a._tx=this._tx;a._ty=this._ty;a._sx=this._sx;a._sy=this._sy;a._deleted=this._deleted;a._objectIdToIndex=this._objectIdToIndex};
q._createClass(l,[{key:"isEmpty",get:function(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}},{key:"level",set:function(a){this._level=a}},{key:"dateTimeReferenceFieldIndex",get:function(){return this._datetimeMetadata?this._datetimeMetadata:this._datetimeMetadata=r.DateTimeReferenceFieldIndex.create(this._layerSchema.fields,this._layerSchema)}},{key:"layerPreferredTimeZone",get:function(){return this.dateTimeReferenceFieldIndex?.layerPreferredTimeZone??""}}]);return l}();
m.FeatureSetReader=h;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});