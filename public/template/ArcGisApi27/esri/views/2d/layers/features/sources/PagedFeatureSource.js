// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Error ../../../../../core/Logger ../../../../../core/promiseUtils ./BaseFeatureSource".split(" "),function(t,u,x,y,h,p){p=function(v){function q(a){return v.call(this,a)||this}u._inherits(q,v);var w=q.prototype;w._fetchDataTile=async function(a){const d=this._subscriptions.get(a.key.id);let f=!1,m=0,e=0;const l=(g,c)=>{e--;h.throwIfAborted(d);const k=a.id,b=g.reader;g=g.query;b.exceededTransferLimit?(c={id:k,addOrUpdate:b,
end:f&&0===e,type:"append"},d.add({message:c,query:g}),this._onMessage(c)):(f=!0,c={id:k,addOrUpdate:b,end:0===e,type:"append"},d.add({message:c,query:g}),this._onMessage(c))};let r=0,z=0;for(;!f&&20>z++;){let g;for(let c=0;c<r+1;c++){const k=m++;e++;g=this._fetchDataTilePage(a,k,d).then(b=>b&&l(b,k)).catch(b=>{f=!0;if(!h.isAbortError(b)){y.getLogger("esri.views.2d.layers.features.sources.PagedFeatureSource").error(new x("mapview-query-error","Encountered error when fetching tile",{tile:a,error:b}));
b={id:a.id,addOrUpdate:null,end:f,type:"append"};var n={start:this.pageSize*m,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:a.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(n.maxRecordCountFactor=this.maxRecordCountFactor);n=this.createTileQuery(a,n);d.add({message:b,query:n});this._onMessage(b)}})}await g;h.throwIfAborted(d);r=Math.min(r+2,6)}};w._fetchDataTilePage=async function(a,d,f){h.throwIfAborted(f);const m=this._queryInfo;var e={start:this.pageSize*
d,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:a.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(e.maxRecordCountFactor=this.maxRecordCountFactor);e=this.createTileQuery(a,e);try{const l=await this.enqueueQuery({tile:a,query:e,signal:f.signal,depth:d});h.throwIfAborted(f);return l?m!==this._queryInfo?this._fetchDataTilePage(a,d,f):{reader:l,query:e}:null}catch(l){return h.throwIfNotAbortError(l),null}};return u._createClass(q)}(p.BaseFeatureSource);t.PagedFeatureSource=
p;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});