// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),function(m,e,n,q,c,k,l){const r=n("featurelayer-order-by-server-enabled");k=function(p){function h(a,b,d,f){a=p.call(this,a)||this;a._hitTestsRequests=[];a._layer=d;a._layerView=b;a._onUpdate=f;return a}e._inherits(h,p);var g=h.prototype;g.renderChildren=function(a){this.attributeView.update();
this.hasAnimation&&a.painter.effects.integrate.draw(a,a.attributeView);e._get(e._getPrototypeOf(h.prototype),"renderChildren",this).call(this,a)};g.hasEmptyAttributeView=function(){return this.attributeView.isEmpty()};g.isUpdating=function(){return this.attributeView.isUpdating()};g.hitTest=function(a){let b=this._hitTestsRequests.find(({x:f,y:t})=>f===a.x&&t===a.y);const d=q.createResolver();b?b.resolvers.push(d):(b={x:a.x,y:a.y,resolvers:[d]},this._hitTestsRequests.push(b));this.requestRender();
return d.promise};g.onTileData=function(a,b){const d=r&&"orderBy"in this._layer&&this._layer.orderBy,f=d&&d?.length&&!d[0].valueExpression&&d[0].field;a.patch(b,!!d&&this._layerView.orderByFields===f);this.contains(a)||this.addChild(a);this.requestRender()};g.onTileError=function(a){this.contains(a)||this.addChild(a)};g.updateTransitionProperties=function(a,b){e._get(e._getPrototypeOf(h.prototype),"updateTransitionProperties",this).call(this,a,b);this._layerView.featureEffectView.transitionStep(a,
b);this._layerView.featureEffectView.transitioning&&this.requestRender()};g.doRender=function(a){const {minScale:b,maxScale:d}=this._layer.effectiveScaleRange,f=a.state.scale;f<=(b||Infinity)&&f>=d&&e._get(e._getPrototypeOf(h.prototype),"doRender",this).call(this,a)};g.afterRender=function(a){e._get(e._getPrototypeOf(h.prototype),"afterRender",this).call(this,a);this._hitTestsRequests.length&&this.requestRender()};g.onAttributeStoreUpdate=function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();
this._onUpdate()};g.setStencilReference=function(a){const {rendererSchema:b}=a.rendererInfo;if("dot-density"===b?.type&&1<b?.dotSize||"heatmap"===b?.type)for(const d of this.children)d.stencilRef=d.key.level+1;else e._get(e._getPrototypeOf(h.prototype),"setStencilReference",this).call(this,a)};g.prepareRenderPasses=function(a){const b=e._get(e._getPrototypeOf(h.prototype),"prepareRenderPasses",this).call(this,a),d=a.registerRenderPass({name:"label",brushes:[c.brushes.label],target:()=>this.hasLabels?
this.children:null,drawPhase:l.WGLDrawPhase.LABEL|l.WGLDrawPhase.LABEL_ALPHA});if(n("featurelayer-force-marker-text-draw-order")){var f=a.registerRenderPass({name:"geometry",brushes:[c.brushes.fill,c.brushes.dotDensity,c.brushes.line,c.brushes.heatmap,c.brushes.pieChart],target:()=>this.children,forceDrawByDisplayOrder:!0,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:a.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},
{apply:a.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:a.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]});b.push(f)}else f=a.registerRenderPass({name:"geometry",brushes:[c.brushes.fill,c.brushes.dotDensity,c.brushes.line,c.brushes.marker,c.brushes.heatmap,c.brushes.pieChart,c.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,
effects:[{apply:a.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:a.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:a.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),b.push(f);a=a.registerRenderPass({name:"highlight",brushes:[c.brushes.fill,c.brushes.dotDensity,
c.brushes.line,c.brushes.marker,c.brushes.pieChart,c.brushes.text],target:()=>this.children,drawPhase:l.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:a.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});b.push(a);b.push(d);return b};e._createClass(h,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some(b=>!!b.labelingInfo?.length&&b.labelsVisible);var a=this._layer.featureReduction;
a=a&&"labelingInfo"in a&&a.labelsVisible&&a.labelingInfo&&a.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!a}}]);return h}(k.FeatureContainer);m.WGLFeatureView=k;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});