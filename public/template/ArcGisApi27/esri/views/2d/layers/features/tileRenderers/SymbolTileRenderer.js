// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),
function(f,g,l,m,n,p,y,z,A,B,q,r,t,u,v,w,x){f.SymbolTileRenderer=function(k){function h(){var a=k.apply(this,arguments)||this;a.type="symbol";return a}g._inherits(h,k);var c=h.prototype;c.install=function(a){const b=new x.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=b;a.addChild(b)};c.uninstall=function(a){a.removeChild(this.featuresView);this.featuresView=n.destroyMaybe(this.featuresView)};c.fetchResource=function(a,b){({url:a}=a);
const d=this.featuresView.stage;try{return d.resourceManager.fetchResource(a,{signal:b.signal})}catch(e){return p.isAbortError(e)?Promise.resolve({width:0,height:0}):Promise.reject(e)}};c.isUpdating=function(){const a=g._get(g._getPrototypeOf(h.prototype),"isUpdating",this).call(this),b=!this.featuresView||this.featuresView.isUpdating();var d=this.featuresView?.hasEmptyAttributeView();d=a||b||a&&d;m("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${d}\n  -> updatingTiles ${a}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${b}`);
return d};c.hitTest=function(a){return this.featuresView.hitTest(a)};c.supportsRenderer=function(a){return null!=a&&"simple class-breaks unique-value dot-density dictionary heatmap pie-chart".split(" ").includes(a.type)};c.onConfigUpdate=function(a){var b=null;a&&"visualVariables"in a&&(b=(u.simplifyVVRenderer(a).visualVariables||[]).map(d=>{const e=d.clone();"normalizationField"in d&&(e.normalizationField=null);d.valueExpression&&"$view.scale"!==d.valueExpression&&(e.valueExpression=null,e.field=
"nop");return e}),b=w.convertVisualVariables(b));this.featuresView.setRendererInfo(a,b,this.layerView.featureEffect)};c.onTileData=function(a){const b=this.tiles.get(a.tileKey);if(b&&a.data)this.featuresView.onTileData(b,a.data);this.layerView.view.labelManager.requestUpdate()};c.onTileError=function(a){if(a=this.tiles.get(a.tileKey))this.featuresView.onTileError(a)};c.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()};c.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload();
this.tiles.forEach(a=>a.lock())};c.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(a=>a.unlock())};c.getMaterialItems=async function(a){return this.featuresView.getMaterialItems(a)};c.invalidateLabels=function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()};c.createTile=function(a){const b=this.tileInfoView.getTileBounds(r.create(),a),d=this.tileInfoView.getTileResolution(a.level);return new t.FeatureTile(a,d,b[0],
b[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())};c.disposeTile=function(a){this.featuresView.removeChild(a);a.destroy();this.layerView.view.labelManager.requestUpdate()};return g._createClass(h)}(v);f.SymbolTileRenderer=l.__decorate([q.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],f.SymbolTileRenderer);Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});