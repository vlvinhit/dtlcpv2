// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/has","../../../../../core/promiseUtils","./BaseFeatureSource"],function(n,p,e,q,f){var v=(e=e("esri-mobile"))?1:4,w=e?1:3;f=function(r){function g(a){return r.call(this,a)||this}p._inherits(g,r);g.prototype._fetchDataTile=async function(a){const x=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,h=this._subscriptions.get(a.key.id),t=h.signal,y=a.getQuantizationParameters();let k=0;const m=async(b,
d)=>{const z=this._queryInfo,l=this.createTileQuery(b,{maxRecordCountFactor:x?w:void 0,returnExceededLimitFeatures:!1,quantizationParameters:y});k++;try{const c=await this.enqueueQuery({tile:a,query:l,signal:t,depth:d});k--;q.throwIfAborted(t);if(c)if(z!==this._queryInfo)m(b,d);else if(c.exceededTransferLimit&&d<v)for(const A of b.createChildTiles())m(A,d+1);else{var u={id:a.id,addOrUpdate:c,end:0===k,type:"append"};h.add({query:l,message:u});this._onMessage(u)}}catch(c){q.isAbortError(c)||(b={id:a.id,
addOrUpdate:null,end:!0,type:"append"},h.add({query:l,message:b}),this._onMessage(b))}};m(a,0)};return p._createClass(g)}(f.BaseFeatureSource);n.DrillDownFeatureSource=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});