// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/support/FieldsIndex ./FeatureSetReader".split(" "),function(p,l,h,g,q,r){function t({coords:f,lengths:e}){let b=0;for(const a of e){for(e=1;e<a;e++)f[2*(b+e)]+=f[2*(b+e)-2],f[2*(b+e)+1]+=f[2*(b+e)-1];b+=a}}let u=function(f){function e(a,c,d){a=f.call(this,a,d)||this;a._exceededTransferLimit=!1;a._featureIndex=-1;
a._fieldsIndex=null;a._geometryType=d?.geometryType;a._features=c;return a}l._inherits(e,f);e.fromFeatures=function(a,c){const {objectIdField:d,geometryType:k}=c,n=h.convertFromFeatures([],a,k,!1,!1,d);for(let m=0;m<n.length;m++)n[m].displayId=a[m].displayId;return e.fromOptimizedFeatures(n,c)};e.fromFeatureSet=function(a,c){a=h.convertFromFeatureSet(a,c.objectIdField);return e.fromOptimizedFeatureSet(a,c)};e.fromOptimizedFeatureSet=function(a,c){var {features:d}=a;d=e.fromOptimizedFeatures(d,c);
d._exceededTransferLimit=a.exceededTransferLimit;d._transform=a.transform;d._fieldsIndex=new q(c.fields);return d};e.fromOptimizedFeatures=function(a,c,d){const k=r.FeatureSetReader.createInstance();a=new e(k,a,c);a._fieldsIndex=new q(c.fields);a._transform=d;return a};var b=e.prototype;b.removeIds=function(a){const c=new Set(a);this._features=this._features.filter(d=>!(null!=d.objectId&&c.has(d.objectId)))};b.append=function(a){for(const c of a)this._features.push(c)};b.getSize=function(){return this._features.length};
b.getCursor=function(){return this.copy()};b.getQuantizationTransform=function(){return this._transform};b.getAttributeHash=function(){let a="";for(const c in this._current.attributes)a+=this._current.attributes[c];return a};b.getIndex=function(){return this._featureIndex};b.setIndex=function(a){this._featureIndex=a};b.getObjectId=function(){return this._current?.objectId};b.getDisplayId=function(){return this._current.displayId};b.setDisplayId=function(a){this._current.displayId=a};b.getGroupId=
function(){return this._current.groupId};b.setGroupId=function(a){this._current.groupId=a};b.copy=function(){const a=new e(this.instance,this._features,this.fullSchema());this.copyInto(a);return a};b.next=function(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length};b.readLegacyFeature=function(){return h.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)};b.readOptimizedFeature=function(){return this._current};
b.readLegacyPointGeometry=function(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null};b.readLegacyGeometry=function(){const a=this.readUnquantizedGeometry();return h.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM)};b.readLegacyCentroid=function(){const a=this.readCentroid();return null==a?null:{x:a.coords[0]*this._sx+this._tx,y:a.coords[1]*this._sy+this._ty}};b.readGeometryArea=function(){return g.hasGeometry(this._current)?h.getQuantizedArea(this._current.geometry,2):0};
b.readUnquantizedGeometry=function(){var a=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!a)return a;a=a.clone();t(a);return a};b.readHydratedGeometry=function(){var a=this._current.geometry;if(null==a)return null;a=a.clone();null!=this._transform&&h.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,this._transform);return a};b.getXHydrated=function(){if(!g.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[0],c=this.getQuantizationTransform();return null==
c?a:a*c.scale[0]+c.translate[0]};b.getYHydrated=function(){if(!g.hasGeometry(this._current))return 0;const a=this._current.geometry.coords[1],c=this.getQuantizationTransform();return null==c?a:c.translate[1]-a*c.scale[1]};b.getX=function(){return g.hasGeometry(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0};b.getY=function(){return g.hasGeometry(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0};b.readGeometry=function(){if(!g.hasGeometry(this._current)){if(null!=
this._current.centroid){const [d,k]=this._current.centroid.coords;return this.createQuantizedExtrudedQuad(d,k)}return null}const a=this._current.geometry.clone();if(a.isPoint)return a.coords[0]=a.coords[0]*this._sx+this._tx,a.coords[1]=a.coords[1]*this._sy+this._ty,a;let c=0;for(const d of a.lengths)a.coords[2*c]=a.coords[2*c]*this._sx+this._tx,a.coords[2*c+1]=a.coords[2*c+1]*this._sy+this._ty,c+=d;return a};b.readCentroid=function(){return g.hasGeometry(this._current)?this._computeCentroid():this._current.centroid};
b._readAttribute=function(a,c){var d=this._fieldsIndex.get(a);if(d){d=this._current.attributes[d.name];if(null==d)return d;"esriFieldTypeTimestampOffset"===this.fields.get(a)?.type&&(d=this.parseTimestampOffset(d));return c&&this.fields.isDateField(a)?new Date(d):d}};b.copyInto=function(a){l._get(l._getPrototypeOf(e.prototype),"copyInto",this).call(this,a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._fieldsIndex=this._fieldsIndex};b._readAttributes=function(){return this._current.attributes};
l._createClass(e,[{key:"fields",get:function(){return this._fieldsIndex}},{key:"_current",get:function(){return this._features[this._featureIndex]}},{key:"geometryType",get:function(){return this._geometryType}},{key:"hasFeatures",get:function(){return!!this._features.length}},{key:"hasNext",get:function(){return this._featureIndex+1<this._features.length}},{key:"exceededTransferLimit",get:function(){return this._exceededTransferLimit}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}}]);
return e}(r.FeatureSetReader);p.FeatureSetReaderJSON=u;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});