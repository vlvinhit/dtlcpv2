// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/workers/Connection ../../../../../../geometry/support/quantizationUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),function(m,f,t,u,q,n,r,p,k,v){async function w(b){const c=new u;await c.open(b,{});
return c}let l=function(){function b(c){this.service=c}b.prototype.destroy=function(){};return f._createClass(b)}(),x=function(b){function c(d){var e=b.call(this,d)||this;e._portsOpen=w(d.source).then(h=>e.client=h);return e}f._inherits(c,b);var a=c.prototype;a.destroy=function(){this.client.close();this.client=null};a.executeQuery=async function(d,e){await this._portsOpen;d=await this.client.invoke("queryFeatures",d.toJSON(),e);return k.FeatureSetReaderJSON.fromFeatureSet(d,this.service)};return f._createClass(c)}(l),
y=function(b){function c(){return b.apply(this,arguments)||this}f._inherits(c,b);c.prototype.executeQuery=async function(a,d){({data:d}=await p.executeQueryPBFBuffer(this.service.source,a,d));return v.FeatureSetReaderPBF.fromBuffer(d,this.service,!a.quantizationParameters)};return f._createClass(c)}(l),C=function(b){function c(){return b.apply(this,arguments)||this}f._inherits(c,b);c.prototype.executeQuery=async function(a,d){const {source:e,capabilities:h,spatialReference:z,objectIdField:A,geometryType:B}=
this.service;if(null!=a.quantizationParameters&&!h.query.supportsQuantization){const g=a.clone();a=q.toQuantizationTransform(g.quantizationParameters);g.quantizationParameters=null;({data:d}=await p.executeQuery(e,g,z,d));d=n.convertFromFeatureSet(d,A);n.quantizeOptimizedFeatureSet(a,d);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(d,this.service)}({data:a}=await p.executeQuery(e,a,this.service.spatialReference,d));"esriGeometryPoint"===B&&(a.features=a.features?.filter(g=>null!=g.geometry?
(g=g.geometry,Number.isFinite(g.x)&&Number.isFinite(g.y)):!0));return k.FeatureSetReaderJSON.fromFeatureSet(a,this.service)};return f._createClass(c)}(l),D=function(b){function c(){return b.apply(this,arguments)||this}f._inherits(c,b);c.prototype.executeQuery=async function(a,d){var {capabilities:e}=this.service;if(a.quantizationParameters&&!e.query.supportsQuantization){const h=a.clone();e=q.toQuantizationTransform(h.quantizationParameters);h.quantizationParameters=null;a=await r.queryOptimizedFeatureSet(this.service.source,
a,d);n.quantizeOptimizedFeatureSet(e,a);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,this.service)}a=await r.queryOptimizedFeatureSet(this.service.source,a,d);return k.FeatureSetReaderJSON.fromOptimizedFeatureSet(a,this.service)};return f._createClass(c)}(l);m.SourceAdapter=l;m.createSourceAdapter=function(b){const {capabilities:c}=b;return"ogc-source"===b.source?.type?new D(b):Array.isArray(b.source)?new x(b):c.query.supportsFormatPBF&&t("featurelayer-pbf")?new y(b):new C(b)};Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})});