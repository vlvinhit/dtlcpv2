// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/Container ../engine/webgl/GroupContainer ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(n,t,u,v,w,g,l,E,F,
G,x,y,z,A,p,q,B){const C=Object.freeze({remove(){},pause(){},resume(){}});l=function(r){function m(){var a=r.apply(this,arguments)||this;a._highlightIds=new Map;a.container=new z.GroupContainer;return a}n._inherits(m,r);var e=m.prototype;e.fetchPopupFeatures=async function(a){return Array.from(this.graphicsViews(),b=>b.hitTest(a).filter(c=>!!c.popupTemplate)).flat()};e.graphicsViews=function*(){null!=this._graphicsViewsFeatureCollectionMap?yield*this._graphicsViewsFeatureCollectionMap.keys():null!=
this._graphicsViews?yield*this._graphicsViews:yield*[]};e.hitTest=async function(a,b){return Array.from(this.graphicsViews(),c=>{const d=c.hitTest(a);if(null!=this._graphicsViewsFeatureCollectionMap){c=this._graphicsViewsFeatureCollectionMap.get(c);for(const f of d)!f.popupTemplate&&c.popupTemplate&&(f.popupTemplate=c.popupTemplate),f.sourceLayer=f.layer=this.layer}return d}).flat().map(c=>({type:"graphic",graphic:c,layer:this.layer,mapPoint:a}))};e.highlight=function(a){let b;"number"===typeof a?
b=[a]:a instanceof u?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(d=>d&&d.uid):w.isCollection(a)&&(b=a.map(d=>d&&d.uid).toArray());const c=b?.filter(v.isSome);if(!c?.length)return C;this._addHighlight(c);return{remove:()=>{this._removeHighlight(c)}}};e.update=function(a){for(const b of this.graphicsViews())b.processUpdate(a)};e.attach=function(){const a=this.view,b=()=>this.requestUpdate();var c=this.layer.featureCollections;if(null!=c&&c.length){this._graphicsViewsFeatureCollectionMap=
new Map;for(const d of c){c=new p(this.view.featuresTilingScheme);const f=new q({view:a,graphics:d.source,renderer:d.renderer,requestUpdateCallback:b,container:c});this._graphicsViewsFeatureCollectionMap.set(f,d);this.container.addChild(f.container);this.addHandles([g.watch(()=>d.visible,k=>f.container.visible=k,g.initial),g.watch(()=>f.updating,()=>this.notifyChange("updating"),g.initial)],"layerView")}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles(g.on(()=>this.layer.sublayers,
"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),"sublayers")};e.detach=function(){this._destroyGraphicsViews();this.removeHandles("sublayers")};e.moveStart=function(){};e.moveEnd=function(){};e.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};e.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};e._destroyGraphicsViews=function(){this.container.removeAllChildren();
this.removeHandles("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};e._createGraphicsViews=function(){this._destroyGraphicsViews();if(null!=this.layer.sublayers){var a=[],b=this.view,c=()=>this.requestUpdate();for(const d of this.layer.sublayers){const f=new y.Container,k=new p(this.view.featuresTilingScheme);k.fadeTransitionEnabled=!0;const h=new q({view:b,graphics:d.graphics,requestUpdateCallback:c,container:k});this.addHandles([d.on("graphic-update",
h.graphicUpdateHandler),g.watch(()=>d.visible,D=>h.container.visible=D,g.initial),g.watch(()=>h.updating,()=>this.notifyChange("updating"),g.initial)],"layerView");f.addChild(h.container);this.container.addChild(f);a.push(h)}this._graphicsViews=a;this._updateHighlight()}};e._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()};e._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&
(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()};e._updateHighlight=function(){const a=Array.from(this._highlightIds.keys());for(const b of this.graphicsViews())b.setHighlight(a)};return n._createClass(m)}(A.LayerView2DMixin(B));return l=t.__decorate([x.subclass("esri.views.2d.layers.MapNotesLayerView2D")],l)});