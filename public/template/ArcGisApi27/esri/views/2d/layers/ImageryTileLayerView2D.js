// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],function(r,H,B){function h(u,e,d){const p=e.shift();0===d.length&&d.push({sliceId:-1,multidimensionalDefinition:[]});const n=d.length;for(let D=0;D<n;D++){const a=d.shift().multidimensionalDefinition;p.values?.forEach(c=>{d.push({sliceId:-1,multidimensionalDefinition:[...a,{variableName:u,dimensionName:p.name,values:[c]}]})})}e.length&&h(u,
e,d)}function w(u,e){return Array.isArray(u)?e[0]===e[1]?u[0]===e[0]||u[1]===e[0]:u[0]>=e[0]&&u[0]<=e[1]&&u[1]>=e[0]&&u[1]<=e[1]:u>=e[0]&&u<=e[1]}function z(u,e){return u[0]<=e[0]&&u[1]>=e[0]||u[0]<=e[1]&&u[1]>=e[1]||u[0]>=e[0]&&u[1]<=e[1]}function x(u){return 1===u.length?[u[0],u[0]]:[u[0],u[u.length-1]]}function y(u,e,d){if(!e?.subsetDefinitions?.length)return u;if(d){const {variables:n}=e;if(n.length&&!n.includes(d))return null;e=e.subsetDefinitions.find(D=>D.dimensionName===u.name&&D.variableName===
d);if(!e?.values?.length)return u;e=x(e.values)}else e=e.dimensions.find(({name:n})=>n===u.name)?.extent;const p=e;if(!p||!p?.length)return u;e=u.values.filter(n=>w(n,p));return{...u,extent:[...p],values:e}}function C(u,e,d){if(!e?.subsetDefinitions?.length)return!1;const {variables:p}=e;if(p.length&&u.some(({variableName:n})=>n&&!p.includes(n)))return!0;for(let n=0;n<u.length;n++){const D=u[n],a=e.subsetDefinitions.find(c=>(""===D.variableName||c.variableName===D.variableName)&&c.dimensionName===
D.dimensionName);if(a?.values.length){const c=x(a.values);if(!D.isSlice&&2===D.values.length&&!Array.isArray(D.values[0])&&D.values[0]!==D.values[1]&&d){if(!z(D.values,c))return!0}else if(D.values.some(f=>!w(f,c)))return!0}}return!1}function E(u,e){var d=u.dimensions.find(({name:a})=>"StdTime"===a);if(null==d||null==e.start&&null==e.end)return e;e=e.clone();const {start:p,end:n}=e.toJSON(),D=p===n?[p]:null!=p&&null!=n?[p,n]:[p??n];if(2===D.length&&d?.extent.length&&(D[0]=Math.max(D[0],d.extent[0]),
D[1]=Math.min(D[1],d.extent[1]??d.extent[0]),D[1]<D[0]))return null;d=new B({variableName:"",dimensionName:"StdTime",isSlice:1===D.length,values:D});if(C([d],u,!0))return null;e.start=new Date(D[0]);e.end=new Date(D[1]??D[0]);return e}function v(u,e={}){const {multidimensionalInfo:d,keyProperties:p}=u;if(null==d)return null;const {variableName:n,multidimensionalSubset:D,multidimensionalDefinition:a}=e;u=null!=a?a[0]?.variableName:null;const c=n||u||p?.DefaultVariable;({variables:u}=d);D?.variables?.length&&
(u=u.filter(({name:f})=>D.variables.includes(f)));return c?u.find(({name:f})=>f===c)??u[0]:u[0]}function F(u,e){var {values:d}=e;if(d?.length){e=Array.isArray(d[0]);var p=Array.isArray(u);return e!==p?-1:e&&p?d.findIndex(D=>D[0]===u[0]&&D[1]===u[1]):d.indexOf(u)}({extent:p}=e);if(Array.isArray(u)||u<p[0]||u>p[1])return-1;d=e.interval||1;if("ISO8601"!==e.unit)return Math.round((u-p[0])/d);p=p[0];let n=-1;switch(e.intervalUnit?.toLowerCase()||"seconds"){case "seconds":n=Math.round((u-p)/1E3/d);break;
case "minutes":n=Math.round((u-p)/6E4/d);break;case "hours":n=Math.round((u-p)/36E5/d);break;case "days":n=Math.round((u-p)/864E5/d);break;case "months":e=(new Date(u)).getUTCFullYear()-(new Date(p)).getUTCFullYear();d=(new Date(p)).getUTCMonth();p=(new Date(u)).getUTCMonth();n=0===e?p-d:p+11-d+12*(e-1);break;case "years":n=Math.round(((new Date(u)).getUTCFullYear()-(new Date(p)).getUTCFullYear())/d);break;case "decades":n=Math.round(((new Date(u)).getUTCFullYear()-(new Date(p)).getUTCFullYear())/
10/d)}return n}function P(u){var e=u.values?.length;if(e)return e;const {extent:d,unit:p}=u;e=u.interval||1;var n=d?d[1]-d[0]:0;if("ISO8601"!==p)return Math.round(n/e);switch(u.intervalUnit?.toLowerCase()??"seconds"){case "seconds":e=Math.round(n/1E3/e);break;case "minutes":e=Math.round(n/6E4/e);break;case "hours":e=Math.round(n/36E5/e);break;case "days":e=Math.round(n/864E5/e);break;case "months":u=(new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear();e=(new Date(d[0])).getUTCMonth();
n=(new Date(d[1])).getUTCMonth();e=0===u?n-e+1:n+11-e+12*(u-1)+1;break;case "years":e=Math.round(((new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear())/e);break;case "decades":e=Math.round(((new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear())/10/e);break;default:e=0}return e}r.createSlices=function(u,e){const d=[];let p=0;(e?u.variables.filter(n=>n.name.toLowerCase()===e.toLowerCase()):[...u.variables].sort((n,D)=>n.name>D.name?1:-1)).forEach(n=>{const D=[],a=[...n.dimensions].sort((c,
f)=>c.name>f.name?-1:1);h(n.name,a,D);D.forEach(c=>{d.push({...c,sliceId:p++})})});return d};r.getDefaultMultidimensionalDefinition=function(u,e={}){var d=v(u,e);if(!d)return null;u=[];const {dimensions:p,name:n}=d;if(0===p.length)return[new B({variableName:n,dimensionName:"",values:[],isSlice:!0})];for(d=0;d<p.length;d++){const D=y(p[d],e.multidimensionalSubset,n);if(!D)return null;const {values:a,extent:c}=D;let f=a?.[0]??c[0];"stdz"===D.name.toLowerCase()&&!D.hasRanges&&Math.abs(c[1])<=Math.abs(c[0])&&
(f=a?.length?a[a.length-1]:c[1]);u.push(new B({variableName:n,dimensionName:D.name,values:[f],isSlice:e.useRangeForRangedDimensionInfo?!!D.hasRanges:!0}))}return u};r.getDefaultVariablInfo=v;r.getSliceIds=function(u,e,d){let p=u;e&&(e=[...e].sort((n,D)=>n.dimensionName<D.dimensionName?-1:1),e.forEach(({dimensionName:n,values:D,isSlice:a})=>{D.length&&(p=p.filter(c=>{c=c.multidimensionalDefinition.find(l=>l.dimensionName===n);if(null==c)return!1;const f=c.values[0];return"number"===typeof f?"number"===
typeof D[0]?D.includes(f):D.some(l=>l[0]<=f&&l[1]>=f):"number"===typeof D[0]?D.some(l=>f[0]<=l&&f[1]>=l):a?D.some(l=>l[0]===f[0]&&l[0]===f[1]):D.some(l=>l[0]>=f[0]&&l[0]<=f[1]||l[1]>=f[0]&&l[1]<=f[1]||l[0]<f[0]&&l[1]>f[1])}))}));if(p.length&&d&&null!=d.start&&null!=d.end){const n=d.start.getTime(),D=d.end.getTime(),a=p[0].multidimensionalDefinition.findIndex(c=>"StdTime"===c.dimensionName);-1<a&&(p=p.filter(c=>{c=c.multidimensionalDefinition[a].values[0];return n<=c&&D>=c}))}return p.map(n=>n.sliceId)};
r.getSliceIndex=function(u,e){let d=0;var p=u[0].variableName;e=[...e.variables].sort((D,a)=>D.name>a.name?1:-1);for(var n=0;n<e.length;n++){const D=e[n],a=[...D.dimensions].sort((c,f)=>c.name>f.name?-1:1);if(D.name!==p)d+=a.map(c=>P(c)).reduce((c,f)=>c*f);else{p=a.map(c=>P(c));e=a.length;for(let c=0;c<e;c++){n=u.find(f=>f.dimensionName===a[c].name);if(null==n)return null;n=F(n.values[0],a[c]);if(-1===n)return null;p.shift();d=c===e-1?d+n:d+n*p.reduce((f,l)=>f*l)}break}}return d};r.getSubsetVariablesFromMdInfo=
function(u,e){if(null==e||null==u)return null;e=e.variables.map(d=>({...d}));u?.variables?.length&&(e=e.filter(({name:d})=>u.variables.includes(d)),e.forEach(d=>{d.dimensions=d.dimensions.map(p=>y(p,u,d.name)).filter(H.isSome)}));return e};r.hasExcludedVariableOrDimension=C;r.intersectMultimensionalSubset=function(u,e){if(null==u)return{isOutside:!1};const {geometry:d,timeExtent:p,multidimensionalDefinition:n}=e;e=null;if(null!=p&&(e=E(u,p),null==e))return{isOutside:!0};const {areaOfInterest:D}=u;
if(D&&d){const a="point"===d.type?d:"extent"===d.type?d.center:"polygon"===d.type?d.centroid:null;if(a&&!D.contains(a))return{isOutside:!0}}return null!=n&&n.length&&C(n,u,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:d,timeExtent:e,multidimensionalDefinition:n}}};r.isMultiSliceOrRangeDefinition=function(u){return null!=u&&u.length?u.some(e=>{if(null==e.values)return!0;const d=e.values.length;return 0===d||1<d||!e.isSlice&&Array.isArray(e.values[0])}):!1};Object.defineProperty(r,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(r,H,B,h,w,z,x){var y;B=y=function(C){function E(v){v=C.call(this,v)||this;v.variableName=null;v.dimensionName=null;v.values=[];v.isSlice=!1;return v}r._inherits(E,
C);E.prototype.clone=function(){return new y({variableName:this.variableName,dimensionName:this.dimensionName,values:h.clone(this.values),isSlice:this.isSlice})};return r._createClass(E)}(B.JSONSupport);H.__decorate([w.property({type:String,json:{write:!0}})],B.prototype,"variableName",void 0);H.__decorate([w.property({type:String,json:{write:!0}})],B.prototype,"dimensionName",void 0);H.__decorate([w.property({type:z.types.array(z.types.oneOf([z.types.native(Number),z.types.array(z.types.native(Number))])),
json:{write:!0}})],B.prototype,"values",void 0);H.__decorate([w.property({type:Boolean,json:{write:!0}})],B.prototype,"isSlice",void 0);return B=y=H.__decorate([x.subclass("esri.layers.support.DimensionalDefinition")],B)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P,u){h=function(e){function d(){var n=e.apply(this,arguments)||this;n._loadImagery=(D,a,c,f,l)=>F.loadImagery(n.layer,D,a,c,f,l);n._createFlowMesh=(D,a,c,f)=>n.layer.createFlowMesh({meshType:D,flowData:c,simulationSettings:a},{signal:f});n.attached=!1;n.type="flow";n.timeExtent=null;n.redrawOrRefetch=async()=>{n._updateVisualization()};return n}r._inherits(d,e);var p=d.prototype;p.attach=function(){const {layer:n}=this,D=()=>{this._loadImagery=(a,c,f,l,b)=>F.loadImagery(n,
a,c,f,l,b);this._updateVisualization()};"multidimensionalDefinition"in n?this.addHandles(w.watch(()=>n.multidimensionalDefinition,D)):this.addHandles([w.watch(()=>n.mosaicRule,D),w.watch(()=>n.rasterFunction,D),w.watch(()=>n.definitionExpression,D)]);this.container=new P;this._strategy=new u({flowContainer:this.container});this._updateVisualization()};p.detach=function(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()};p.update=function(n){n.stationary?
this._strategy.update(n):this.layerView.requestUpdate()};p.hitTest=function(n){return new B({attributes:{},geometry:n.clone(),layer:this.layer})};p.moveEnd=function(){};p.doRefresh=async function(){};p._updateVisualization=function(){var n=this.layer.renderer;null!=n&&"flow"===n.type&&(n=v(n,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=n,this.layerView.requestUpdate())};r._createClass(d,[{key:"updating",get:function(){return!this.attached||
this._strategy.updating}}]);return d}(h);H.__decorate([z.property()],h.prototype,"_strategy",void 0);H.__decorate([z.property()],h.prototype,"attached",void 0);H.__decorate([z.property()],h.prototype,"container",void 0);H.__decorate([z.property()],h.prototype,"layer",void 0);H.__decorate([z.property()],h.prototype,"layerView",void 0);H.__decorate([z.property()],h.prototype,"type",void 0);H.__decorate([z.property()],h.prototype,"updating",null);H.__decorate([z.property()],h.prototype,"timeExtent",
void 0);return h=H.__decorate([E.subclass("esri.views.2d.engine.flow.FlowView2D")],h)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(r,H,B,h,w){return function(z,x){const {flowSpeed:y,trailLength:C}=z,E=r.getFlowSimulationSettings(z);let v=null;const F={opacity:r.getOpacity(z),size:r.getSize(z)};let P=r.getColor(z);"none"===z.background?F.color=P:("constant"===P.kind&&(P={kind:"ramp",
stops:[0,1],values:[0,0,0,1,P.value[0],P.value[1],P.value[2],P.value[3]],count:2}),v=new H.Imagery({loadImagery:x.loadImagery,timeExtent:x.timeExtent,color:P,opacity:{kind:"constant",value:[1]}}),F.color=r.getForegroundColor());x={loadImagery:x.loadImagery,createFlowMesh:x.createFlowMesh,simulationSettings:E,timeExtent:x.timeExtent,trailLength:C,flowSpeed:y,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:F.color,opacity:F.opacity,size:F.size};z="butt"===z.trailCap||
4>=r.getMax(r.getSize(z))?new w(x):new B.Particles(x);return null!=v?new h.Stack([v,z]):z}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils"],function(r,H){function B(y){return"constant"===y.kind?y.value[0]:y.values[y.values.length-1]}function h(y){y=y.toRgba();return[y[0]/255,y[1]/255,y[2]/255,y[3]]}function w(y){if(!y.hasVisualVariables("size"))return{kind:"constant",value:[H.pt2px(y.trailWidth)]};const C=y.getVisualVariablesForType("size")[0];y=[];
const E=[];if(C.stops){for(v of C.stops)y.push(v.value),E.push(H.pt2px(v.size));var v=C.stops.length}else y.push(C.minDataValue,C.maxDataValue),E.push(H.pt2px(C.minSize),H.pt2px(C.maxSize)),v=2;return{kind:"ramp",stops:y,values:E,count:v}}function z(y,C,E,v){switch(C){case "int":y.setUniform1iv(E,v);break;case "float":y.setUniform1fv(E,v);break;case "vec2":y.setUniform2fv(E,v);break;case "vec3":y.setUniform3fv(E,v);break;case "vec4":y.setUniform4fv(E,v)}}function x(y,C){return y===C?!0:null!=y&&null!=
C?y.equals(C):!1}r.areStreamlinesCompatible=function(y,C){var E=y.simulationSettings,v=C.simulationSettings;let F;F=(F=(F=(F=(F=(F=(F=(F=(F=(F=(F=E.collisions===v.collisions)&&E.density===v.density)&&E.interpolate===v.interpolate)&&E.lineCollisionWidth===v.lineCollisionWidth)&&E.lineSpacing===v.lineSpacing)&&E.maxTurnAngle===v.maxTurnAngle)&&E.minSpeedThreshold===v.minSpeedThreshold)&&E.segmentLength===v.segmentLength)&&E.smoothing===v.smoothing)&&E.velocityScale===v.velocityScale)&&E.verticesPerLine===
v.verticesPerLine;return F&&x(y.timeExtent,C.timeExtent)?E=(E=(E=(E=(E=y.loadImagery===C.loadImagery)&&y.createFlowMesh===C.createFlowMesh)&&y.color.kind===C.color.kind)&&y.opacity.kind===C.opacity.kind)&&y.size.kind===C.size.kind:!1};r.getColor=function(y){if(!y.hasVisualVariables("color"))return{kind:"constant",value:h(y.color)};y=y.getVisualVariablesForType("color")[0];const C=[],E=[];for(const v of y.stops)C.push(v.value),Array.prototype.push.apply(E,h(v.color));return{kind:"ramp",stops:C,values:E,
count:y.stops.length}};r.getFlowSimulationSettings=function(y){var C=w(y);C=B(C);const E=Math.max(C/2,5),v=Math.round(H.pt2px(y.maxPathLength)/E)+1,{density:F}=y;return{smoothing:H.pt2px(y.smoothing),interpolate:!0,velocityScale:"flow-from"===y.flowRepresentation?1:-1,verticesPerLine:v,minSpeedThreshold:.001,segmentLength:E,maxTurnAngle:1,collisions:!0,lineCollisionWidth:C,lineSpacing:10,density:F}};r.getForegroundColor=function(y){return{kind:"constant",value:[.1,.1,.1,1]}};r.getMax=B;r.getOpacity=
function(y){if(!y.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};y=y.getVisualVariablesForType("opacity")[0];const C=[],E=[];for(const v of y.stops)C.push(v.value),E.push(v.opacity);return{kind:"ramp",stops:C,values:E,count:y.stops.length}};r.getSize=w;r.setUniform=z;r.setUniforms=function(y,C,E,v){"constant"===v.kind?z(y,E,`u_${C}`,v.value):(z(y,"float",`u_${C}_stops`,v.stops),z(y,E,`u_${C}_values`,v.values),y.setUniform1i(`u_${C}_count`,v.count))};r.timeExtentsEqual=x;r.toRgba=
h;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(r,H,B,h,w,z,x,y,C,E){let v=function(){function d(n){this._params=
n;this.animated=!1}var p=d.prototype;p.isCompatible=function(n){if(!(n instanceof d&&h.timeExtentsEqual(this._params.timeExtent,n._params.timeExtent)))return!1;let D;return D=(D=(D=this._params.loadImagery===n._params.loadImagery)&&this._params.color.kind===n._params.color.kind)&&this._params.opacity.kind===n._params.opacity.kind};p.load=async function(n,D){const {extent:a,size:c}=n;B.throwIfAborted(D);n=await this._params.loadImagery(a,c[0],c[1],this._params.timeExtent,D);return new e(n,{color:this._params.color,
opacity:this._params.opacity})};p.render=function(n,D,a){({context:n}=n);const {program:c}=a;n.setFaceCullingEnabled(!1);n.setBlendingEnabled(!0);n.setBlendFunction(z.BlendFactor.ONE,z.BlendFactor.ONE_MINUS_SRC_ALPHA);n.useProgram(c);c.setUniformMatrix3fv("u_dvsMat3",D.dvsMat3);n.bindTexture(a.texture,0);c.setUniform1i("u_texture",0);c.setUniform1f("u_Min",a.min);c.setUniform1f("u_Max",a.max);h.setUniforms(c,"color","vec4",this._params.color);h.setUniforms(c,"opacity","float",this._params.opacity);
n.bindVAO(a.vertexArray);n.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4)};return H._createClass(d)}();const F=new Map;F.set("a_position",0);F.set("a_texcoord",1);const P={geometry:[new E.VertexElementDescriptor("a_position",2,z.DataType.UNSIGNED_SHORT,0,8),new E.VertexElementDescriptor("a_texcoord",2,z.DataType.UNSIGNED_SHORT,4,8)]},u={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:F};let e=function(){function d(n,D){this._flowData=n;this._values=D}var p=d.prototype;p.attach=
function(n){var {context:D}=n;const {width:a,height:c}=this._flowData;var f={geometry:w.BufferObject.createVertex(D,z.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,c,0,0,a,c,1,0]))};f=new C.VertexArrayObject(D,F,P,f);var l=[];"ramp"===this._values.color.kind&&l.push("vvColor");"ramp"===this._values.opacity.kind&&l.push("vvOpacity");n=n.painter.materialManager.getProgram(u,l);l=1E6;let b=-1E6;for(var k=0;k<c;k++)for(var m=0;m<a;m++)if(0!==this._flowData.mask[k*a+m]){var q=this._flowData.data[2*
(k*a+m)],G=this._flowData.data[2*(k*a+m)+1];q=Math.sqrt(q*q+G*G);l=Math.min(l,q);b=Math.max(b,q)}k=new Uint8Array(4*a*c);for(m=0;m<c;m++)for(q=0;q<a;q++)if(0!==this._flowData.mask[m*a+q]){G=this._flowData.data[2*(m*a+q)];const L=this._flowData.data[2*(m*a+q)+1];k[4*(m*a+q)]=(Math.sqrt(G*G+L*L)-l)/(b-l)*255;k[4*(m*a+q)+1]=0;k[4*(m*a+q)+2]=0;k[4*(m*a+q)+3]=255}else k[4*(m*a+q)]=0,k[4*(m*a+q)+1]=0,k[4*(m*a+q)+2]=0,k[4*(m*a+q)+3]=0;m=new y.TextureDescriptor;m.internalFormat=z.PixelFormat.RGBA;m.wrapMode=
z.TextureWrapMode.CLAMP_TO_EDGE;m.flipped=!0;m.width=a;m.height=c;D=new x.Texture(D,m,k);this.vertexArray=f;this.program=n;this.texture=D;this.min=l;this.max=b;this._flowData=null};p.detach=function(){this.vertexArray.dispose();this.texture.dispose()};H._createClass(d,[{key:"ready",get:function(){return this.program.compiled}}]);return d}();r.Imagery=v;r.ImageryResources=e;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(r,H,B,h,w,z,x,y){let C=function(){function u(d){this._params=d}var e=u.prototype;e.isCompatible=function(d){return d instanceof u?h.areStreamlinesCompatible(this._params,d._params):!1};e.load=async function(d,p){const {extent:n,size:D}=d;B.throwIfAborted(p);d=await this._params.loadImagery(n,D[0],D[1],this._params.timeExtent,p);const {vertexData:a,indexData:c}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,d,p);return new P(a,c,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})};e.render=function(d,p,n){({context:d}=d);const {program:D}=n;d.setFaceCullingEnabled(!1);d.setBlendingEnabled(!0);d.setBlendFunction(z.BlendFactor.ONE,z.BlendFactor.ONE_MINUS_SRC_ALPHA);d.useProgram(D);D.setUniform1f("u_time",p.time);D.setUniform1f("u_trailLength",this._params.trailLength);D.setUniform1f("u_flowSpeed",this._params.flowSpeed);D.setUniform1f("u_featheringSize",this._params.featheringSize);D.setUniform1f("u_featheringOffset",this._params.featheringOffset);D.setUniform1f("u_introFade",
this._params.introFade?1:0);D.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);D.setUniform1f("u_decayRate",this._params.decayRate);D.setUniformMatrix3fv("u_dvsMat3",p.dvsMat3);D.setUniformMatrix3fv("u_displayViewMat3",p.displayViewMat3);h.setUniforms(D,"color","vec4",this._params.color);h.setUniforms(D,"opacity","float",this._params.opacity);h.setUniforms(D,"size","float",this._params.size);d.bindVAO(n.vertexArray);d.drawElements(z.PrimitiveType.TRIANGLES,n.indexCount,z.DataType.UNSIGNED_INT,
0)};H._createClass(u,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return u}();const E=new Map;E.set("a_xyts0",0);E.set("a_xyts1",1);E.set("a_typeIdDurationSeed",2);E.set("a_extrudeInfo",3);const v={geometry:[new y.VertexElementDescriptor("a_xyts0",4,z.DataType.FLOAT,0,64),new y.VertexElementDescriptor("a_xyts1",4,z.DataType.FLOAT,16,64),new y.VertexElementDescriptor("a_typeIdDurationSeed",4,z.DataType.FLOAT,32,64),new y.VertexElementDescriptor("a_extrudeInfo",4,z.DataType.FLOAT,
48,64)]},F={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:E};let P=function(){function u(d,p,n){this._vertexData=d;this._indexData=p;this._values=n}var e=u.prototype;e.attach=function(d){var {context:p}=d,n=w.BufferObject.createVertex(p,z.Usage.STATIC_DRAW,this._vertexData);const D=w.BufferObject.createIndex(p,z.Usage.STATIC_DRAW,this._indexData);p=new x.VertexArrayObject(p,E,v,{geometry:n},D);n=[];"ramp"===this._values.color.kind&&n.push("vvColor");"ramp"===this._values.opacity.kind&&
n.push("vvOpacity");"ramp"===this._values.size.kind&&n.push("vvSize");d=d.painter.materialManager.getProgram(F,n);this.vertexArray=p;this.program=d;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};e.detach=function(){this.vertexArray.dispose()};H._createClass(u,[{key:"ready",get:function(){return this.program.compiled}}]);return u}();r.Particles=C;r.ParticlesResources=P;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(r,H){let B=function(){function w(x){this._styles=x}var z=w.prototype;z.isCompatible=function(x){if(!(x instanceof w)||this._styles.length!==x._styles.length)return!1;const y=this._styles.length;for(let C=0;C<y;C++)if(!this._styles[C].isCompatible(x._styles[C]))return!1;return!0};z.load=async function(x,y){const C=await Promise.all(this._styles.map(E=>E.load(x,y)));return new h(C)};z.render=function(x,y,C){for(let E=0;E<this._styles.length;E++)this._styles[E].render(x,
y,C.resources[E])};H._createClass(w,[{key:"animated",get:function(){return this._styles.reduce((x,y)=>x||y.animated,!1)}}]);return w}(),h=function(){function w(x){this.resources=x}var z=w.prototype;z.attach=function(x){for(const y of this.resources)y.attach(x)};z.detach=function(){for(const x of this.resources)x.detach()};H._createClass(w,[{key:"ready",get:function(){return this.resources.reduce((x,y)=>x&&y.ready,!0)}}]);return w}();r.Stack=B;r.StackResources=h;Object.defineProperty(r,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(r,H,B,h,w,z,x){let y=function(){function P(e){this._params=e}var u=P.prototype;u.isCompatible=function(e){return e instanceof P?B.areStreamlinesCompatible(this._params,e._params):
!1};u.load=async function(e,d){const {extent:p,size:n}=e;H.throwIfAborted(d);e=await this._params.loadImagery(p,n[0],n[1],this._params.timeExtent,d);const {vertexData:D,indexData:a}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,e,d);return new F(D,a,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})};u.render=function(e,d,p){({context:e}=e);const {program:n}=p;e.setFaceCullingEnabled(!1);e.setBlendingEnabled(!0);e.setBlendFunction(w.BlendFactor.ONE,
w.BlendFactor.ONE_MINUS_SRC_ALPHA);e.useProgram(n);n.setUniform1f("u_time",d.time);n.setUniform1f("u_trailLength",this._params.trailLength);n.setUniform1f("u_flowSpeed",this._params.flowSpeed);n.setUniform1f("u_featheringSize",this._params.featheringSize);n.setUniform1f("u_featheringOffset",this._params.featheringOffset);n.setUniform1f("u_introFade",this._params.introFade?1:0);n.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);n.setUniform1f("u_decayRate",this._params.decayRate);n.setUniformMatrix3fv("u_dvsMat3",
d.dvsMat3);n.setUniformMatrix3fv("u_displayViewMat3",d.displayViewMat3);B.setUniforms(n,"color","vec4",this._params.color);B.setUniforms(n,"opacity","float",this._params.opacity);B.setUniforms(n,"size","float",this._params.size);e.bindVAO(p.vertexArray);e.drawElements(w.PrimitiveType.TRIANGLES,p.indexCount,w.DataType.UNSIGNED_INT,0)};r._createClass(P,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return P}();const C=new Map;C.set("a_positionAndSide",0);C.set("a_timeInfo",1);C.set("a_extrude",
2);C.set("a_speed",3);const E={geometry:[new x.VertexElementDescriptor("a_positionAndSide",3,w.DataType.FLOAT,0,36),new x.VertexElementDescriptor("a_timeInfo",3,w.DataType.FLOAT,12,36),new x.VertexElementDescriptor("a_extrude",2,w.DataType.FLOAT,24,36),new x.VertexElementDescriptor("a_speed",1,w.DataType.FLOAT,32,36)]},v={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:C};let F=function(){function P(e,d,p){this._vertexData=e;this._indexData=d;this._values=p}var u=P.prototype;
u.attach=function(e){var {context:d}=e,p=h.BufferObject.createVertex(d,w.Usage.STATIC_DRAW,this._vertexData);const n=h.BufferObject.createIndex(d,w.Usage.STATIC_DRAW,this._indexData);d=new z.VertexArrayObject(d,C,E,{geometry:p},n);p=[];"ramp"===this._values.color.kind&&p.push("vvColor");"ramp"===this._values.opacity.kind&&p.push("vvOpacity");"ramp"===this._values.size.kind&&p.push("vvSize");e=e.painter.materialManager.getProgram(v,p);this.vertexArray=d;this.program=e;this.indexCount=this._indexData.length;
this._indexData=this._vertexData=null};u.detach=function(){this.vertexArray.dispose()};r._createClass(P,[{key:"ready",get:function(){return this.program.compiled}}]);return P}();return y})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(r,
H,B,h,w,z,x,y,C){function E(a,c){const f=P(c.data,c.width,c.height,a.smoothing);return a.interpolate?(l,b)=>{const k=Math.floor(l),m=Math.floor(b);if(0>k||k>=c.width||0>m||m>=c.height)return[0,0];l-=k;b-=m;const q=k<c.width-1?k+1:k,G=m<c.height-1?m+1:m;return[(f[2*(m*c.width+k)]*(1-b)+f[2*(G*c.width+k)]*b)*(1-l)+(f[2*(m*c.width+q)]*(1-b)+f[2*(G*c.width+q)]*b)*l,(f[2*(m*c.width+k)+1]*(1-b)+f[2*(G*c.width+k)+1]*b)*(1-l)+(f[2*(m*c.width+q)+1]*(1-b)+f[2*(G*c.width+q)+1]*b)*l]}:(l,b)=>{l=Math.round(l);
b=Math.round(b);return 0>l||l>=c.width||0>b||b>=c.height?[0,0]:[f[2*(b*c.width+l)],f[2*(b*c.width+l)+1]]}}function v(a,c,f,l,b,k,m,q,G){const L=[];let M=0,[t,I]=c(f,l);t*=a.velocityScale;I*=a.velocityScale;L.push({x:f,y:l,t:M,speed:Math.sqrt(t*t+I*I)});for(let U=0;U<a.verticesPerLine;U++){let [S,Y]=c(f,l);S*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(S*S+Y*Y);if(X<a.minSpeedThreshold)break;const aa=S/X,g=Y/X;f+=aa*a.segmentLength;l+=g*a.segmentLength;M+=a.segmentLength/X;if(Math.acos(aa*
K+g*R)>a.maxTurnAngle)break;if(a.collisions){var K=Math.round(f*G);var R=Math.round(l*G);if(0>K||K>m-1||0>R||R>q-1)break;const A=k[R*m+K];if(-1!==A&&A!==b)break;k[R*m+K]=b}L.push({x:f,y:l,t:M,speed:X});K=aa;R=g}return L}function F(a,c,f,l){const b=[],k=new x,m=1/Math.max(a.lineCollisionWidth,1),q=Math.round(f*m),G=Math.round(l*m),L=new Int32Array(q*G);for(var M=0;M<L.length;M++)L[M]=-1;M=[];for(let t=0;t<l;t+=a.lineSpacing)for(let I=0;I<f;I+=a.lineSpacing)M.push({x:I,y:t,sort:k.getFloat()});M.sort((t,
I)=>t.sort-I.sort);for(const {x:t,y:I}of M)k.getFloat()<a.density&&(f=v(a,c,t,I,b.length,L,q,G,m),2>f.length||b.push(f));return b}function P(a,c,f,l){if(0===l)return a;const b=Math.round(3*l),k=Array(2*b+1);var m=0;for(var q=-b;q<=b;q++){var G=Math.exp(-q*q/(l*l));k[q+b]=G;m+=G}for(l=-b;l<=b;l++)k[l+b]/=m;m=new Float32Array(a.length);for(l=0;l<f;l++)for(q=0;q<c;q++){var L=G=0;for(var M=-b;M<=b;M++)if(!(0>q+M||q+M>=c)){var t=k[M+b];G+=t*a[2*(l*c+(q+M))];L+=t*a[2*(l*c+(q+M))+1]}m[2*(l*c+q)]=G;m[2*(l*
c+q)+1]=L}a=new Float32Array(a.length);for(l=0;l<c;l++)for(q=0;q<f;q++){L=G=0;for(M=-b;M<=b;M++)0>q+M||q+M>=f||(t=k[M+b],G+=t*m[2*((q+M)*c+l)],L+=t*m[2*((q+M)*c+l)+1]);a[2*(q*c+l)]=G;a[2*(q*c+l)+1]=L}return a}function u(a,c){const f=new x;var l=a.reduce((q,G)=>q+G.length,0);l=new Float32Array(4*l);const b=Array(a.length);let k=0,m=0;for(const q of a){a=k;for(const G of q)l[4*k]=G.x,l[4*k+1]=G.y,l[4*k+2]=G.t,l[4*k+3]=G.speed,k++;b[m++]={startVertex:a,numberOfVertices:q.length,totalTime:q[q.length-
1].t,timeSeed:c?f.getFloat():0}}return{lineVertices:l,lineDescriptors:b}}function e(a,c){function f(K,R,U,S,Y,X,aa,g){const A=9*G;let J=0;q[A+J++]=K;q[A+J++]=R;q[A+J++]=1;q[A+J++]=U;q[A+J++]=X;q[A+J++]=aa;q[A+J++]=S/2;q[A+J++]=Y/2;q[A+J++]=g;G++;q[A+J++]=K;q[A+J++]=R;q[A+J++]=-1;q[A+J++]=U;q[A+J++]=X;q[A+J++]=aa;q[A+J++]=-S/2;q[A+J++]=-Y/2;q[A+J++]=g;G++}const {lineVertices:l,lineDescriptors:b}=a;var k=a=0;for(var m of b)a+=2*m.numberOfVertices,k+=6*(m.numberOfVertices-1);const q=new Float32Array(9*
a);m=new Uint32Array(k);let G=0;a=0;for(const K of b){const {totalTime:R,timeSeed:U}=K;let S=k=null,Y=null;var L=null,M=null,t=null;for(let X=0;X<K.numberOfVertices;X++){L=l[4*(K.startVertex+X)];const aa=l[4*(K.startVertex+X)+1],g=l[4*(K.startVertex+X)+2],A=l[4*(K.startVertex+X)+3];let J=null,N=null;var I=null;let T=null;0<X&&(J=L-k,N=aa-S,I=Math.sqrt(J*J+N*N),J/=I,N/=I,1<X?(M=J+M,t=N+t,I=Math.sqrt(M*M+t*t),M/=I,t/=I,I=Math.min(1/(M*J+t*N),c),M*=I,t*=I,I=-t,T=M):(I=-N,T=J),null!==I&&null!==T&&(f(k,
S,Y,I,T,R,U,A),m[a++]=G-2,m[a++]=G,m[a++]=G-1,m[a++]=G,m[a++]=G+1,m[a++]=G-1));k=L;S=aa;Y=g;M=J;t=N;L=A}f(k,S,Y,-t,M,R,U,L)}return{vertexData:q,indexData:m}}function d(a){function c(V,W){var Q=g+J,ba=A+N,Z=Math.sqrt(Q*Q+ba*ba);Q/=Z;ba/=Z;var ea=g*Q+A*ba,da=J+T,ca=N+O;Z=Math.sqrt(da*da+ca*ca);da/=Z;ca/=Z;var fa=J*da+N*ca;Z=I;var ia=K,ja=R,ha=U;ba=-(ba/ea);Q/=ea;ea=S;var ma=Y,na=X,oa=aa;ca=-(ca/fa);da/=fa;fa=16*M;let la=0;for(const ra of[1,2])for(const sa of[1,2,3,4])G[fa+la++]=Z,G[fa+la++]=ia,G[fa+
la++]=ja,G[fa+la++]=ha,G[fa+la++]=ea,G[fa+la++]=ma,G[fa+la++]=na,G[fa+la++]=oa,G[fa+la++]=ra,G[fa+la++]=sa,G[fa+la++]=V,G[fa+la++]=W,G[fa+la++]=ba/2,G[fa+la++]=Q/2,G[fa+la++]=ca/2,G[fa+la++]=da/2,M++;L[t++]=M-8;L[t++]=M-7;L[t++]=M-6;L[t++]=M-7;L[t++]=M-5;L[t++]=M-6;L[t++]=M-4;L[t++]=M-3;L[t++]=M-2;L[t++]=M-3;L[t++]=M-1;L[t++]=M-2}function f(V,W,Q,ba,Z,ea){g=J;A=N;J=T;N=O;null==g&&null==A&&(g=J,A=N);if(null!=S&&null!=Y){T=V-S;O=W-Y;const da=Math.sqrt(T*T+O*O);T/=da;O/=da}null!=g&&null!=A&&c(Z,ea);
I=S;K=Y;R=X;U=aa;S=V;Y=W;X=Q;aa=ba}function l(V,W){g=J;A=N;J=T;N=O;null==g&&null==A&&(g=J,A=N);null!=g&&null!=A&&c(V,W)}const {lineVertices:b,lineDescriptors:k}=a;let m=a=0;for(var q of k){const V=q.numberOfVertices-1;a+=8*V;m+=12*V}const G=new Float32Array(16*a),L=new Uint32Array(m);let M=0,t=0,I,K,R,U,S,Y,X,aa,g,A,J,N,T,O;for(const V of k){O=T=N=J=A=g=aa=X=Y=S=U=R=K=I=null;const {totalTime:W,timeSeed:Q}=V;for(q=0;q<V.numberOfVertices;q++)f(b[4*(V.startVertex+q)],b[4*(V.startVertex+q)+1],b[4*(V.startVertex+
q)+2],b[4*(V.startVertex+q)+3],W,Q);l(W,Q)}return{vertexData:G,indexData:L}}function p(a,c){const f=c.pixels,{width:l,height:b}=c,k=new Float32Array(l*b*2),m=c.mask||new Uint8Array(l*b*2);c.mask||m.fill(255);if("vector-uv"===a)for(a=0;a<l*b;a++)k[2*a]=f[0][a],k[2*a+1]=-f[1][a];else if("vector-magdir"===a)for(a=0;a<l*b;a++){c=f[0][a];const q=w.deg2rad(f[1][a]),G=Math.sin(q-Math.PI/2);k[2*a]=Math.cos(q-Math.PI/2)*c;k[2*a+1]=G*c}return{data:k,mask:m,width:l,height:b}}async function n(a,c,f,l,b,k){const m=
{requestProjectedLocalDirections:!0,signal:k};null!=b&&(m.timeExtent=b);if("imagery"===a.type)return await a.load({signal:k}),b=a.rasterInfo.dataType,(a=await a.fetchImage(c,f,l,m))&&null!=a.pixelData&&null!=a.pixelData.pixelBlock?p(b,a.pixelData.pixelBlock):{data:new Float32Array(f*l*2),mask:new Uint8Array(f*l),width:f,height:l};await a.load({signal:k});b=a.rasterInfo.dataType;return(a=await a.fetchPixels(c,f,l,m))&&null!=a.pixelBlock?p(b,a.pixelBlock):{data:new Float32Array(f*l*2),mask:new Uint8Array(f*
l),width:f,height:l}}const D=h.getLogger("esri.views.2d.engine.flow.dataUtils");r.createAnimatedLinesData=u;r.createFlowMesh=async function(a,c,f,l){const b=performance.now();var k=E(c,f);const m=performance.now();f=F(c,k,f.width,f.height);c=performance.now();k=u(f,!0);f=performance.now();a="Streamlines"===a?e(k,10):d(k);k=performance.now();B("esri-2d-profiler")&&(D.info("I.1","_createFlowFieldFromData (ms)",Math.round(m-b)),D.info("I.2","_getStreamlines (ms)",Math.round(c-m)),D.info("I.3","createAnimatedLinesData (ms)",
Math.round(f-c)),D.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(k-f)),D.info("I.5","createFlowMesh (ms)",Math.round(k-b)),D.info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();z.throwIfAborted(l);return a};r.createParticlesMesh=d;r.createStreamlinesMesh=e;r.loadImagery=async function(a,c,f,l,b,k){const m=performance.now();var q=y.getInfo(c.spatialReference);if(!q)return f=await n(a,c,f,l,b,k),B("esri-2d-profiler")&&
D.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-m)),B("esri-2d-profiler")&&D.info("I.9","Number of parts",1),f;const [G,L]=q.valid,M=Math.ceil(c.width/(L-G)),t=c.width/M,I=Math.round(f/M);let K=c.xmin;const R=[];q=performance.now();for(let U=0;U<M;U++){const S=new C({xmin:K,xmax:K+t,ymin:c.ymin,ymax:c.ymax,spatialReference:c.spatialReference});R.push(n(a,S,I,l,b,k));K+=t}a=await Promise.all(R);B("esri-2d-profiler")&&D.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-
q));B("esri-2d-profiler")&&D.info("I.9","Number of parts",a.length);l={data:new Float32Array(f*l*2),mask:new Uint8Array(f*l),width:f,height:l};c=0;for(const U of a){for(a=0;a<U.height;a++)for(b=0;b<U.width;b++)c+b>=f||(l.data[2*(a*f+c+b)]=U.data[2*(a*U.width+b)],l.data[2*(a*f+c+b)+1]=U.data[2*(a*U.width+b)+1],l.mask[a*f+c+b]=U.mask[a*U.width+b]);c+=U.width}B("esri-2d-profiler")&&D.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-m));return l};Object.defineProperty(r,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(r,H,B,h){return function(w){function z(){var y=w.apply(this,arguments)||this;y.flowStyle=null;return y}r._inherits(z,w);var x=z.prototype;x.doRender=function(y){r._get(r._getPrototypeOf(z.prototype),"doRender",this).call(this,y)};x.prepareRenderPasses=function(y){const C=y.registerRenderPass({name:"flow",brushes:[H],
target:()=>this.children,drawPhase:B.WGLDrawPhase.MAP});return[...r._get(r._getPrototypeOf(z.prototype),"prepareRenderPasses",this).call(this,y),C]};r._createClass(z,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return z}(h)})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(r,H,B,h){return function(w){function z(){var y=w.apply(this,arguments)||
this;y._visualState={time:0,dvsMat3:H.create(),displayViewMat3:H.create()};return y}r._inherits(z,w);var x=z.prototype;x.dispose=function(){};x.prepareState=function(y){({context:y}=y);y.setColorMask(!0,!0,!0,!0);y.setStencilFunction(h.CompareFunction.EQUAL,0,255)};x.draw=function(y,C){const {requestRender:E,allowDelayedRender:v}=y,{displayData:F}=C;if(null!=F&&("loaded"===F.state.name&&F.attach(y),"attached"===F.state.name)){var P=F.state.resources;v&&!P.ready&&null!=E?E():(this._visualState.time=
y.time/1E3,this._visualState.dvsMat3=C.transforms.dvs,this._visualState.displayViewMat3=y.state.displayViewMat3,F.flowStyle.render(y,this._visualState,P),F.flowStyle.animated&&null!=E&&E())}};return r._createClass(z)}(B)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P,u,e,d){function p(n,D){const a=new P({x:(n.xmax+n.xmin)/2,y:(n.ymax+n.ymin)/2,spatialReference:n.spatialReference});var c=n.xmax-n.xmin;const f=n.ymax-n.ymin,l=Math.abs(Math.cos(z.deg2rad(D))),b=Math.abs(Math.sin(z.deg2rad(D)));D=l*c+b*f;c=b*c+l*f;n=new d({xmin:a.x-D/2,ymin:a.y-c/2,xmax:a.x+D/2,ymax:a.y+c/2,spatialReference:n.spatialReference});n.centerAt(a);return n}B=function(n){function D(c){c=n.call(this,c)||this;c._flowDisplayObject=new e.FlowDisplayObject;
c._loading=null;return c}r._inherits(D,n);var a=D.prototype;a.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};a.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};a.update=function(c){var {flowStyle:f}=this.flowContainer;if(null==f)this._clear();else{var {extent:l,rotation:b,resolution:k,pixelRatio:m}=c.state;c=p(l,b);c.expand(1.15);f=new u(f,c,[Math.round((c.xmax-c.xmin)/k),Math.round((c.ymax-c.ymin)/k)],m);if(null!=this._loading){if(this._loading.update(f))return;
this._loading.detach();this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(f)||(f.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},q=>{x.isAbortError(q)||(w.getLogger(this).error("A resource failed to load.",q),this._loading=null)}),this._loading=f)}};a._clear=function(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)};r._createClass(D,
[{key:"updating",get:function(){return null!=this._loading}}]);return D}(h);H.__decorate([y.property()],B.prototype,"_loading",void 0);H.__decorate([y.property()],B.prototype,"flowContainer",void 0);H.__decorate([y.property()],B.prototype,"updating",null);return B=H.__decorate([F.subclass("esri.views.2d.engine.flow.FlowStrategy")],B)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(r,H){return function(){function B(w,
z,x,y){this.state={name:"created"};this.flowStyle=w;this.extent=z;this.size=x;this.pixelRatio=y}var h=B.prototype;h.load=async function(){const w=new AbortController;this.state={name:"loading",abortController:w};this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},w.signal)}};h.attach=function(w){if("loaded"!==this.state.name)H.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");
else{var z=this.state.resources;z.attach(w);this.state={name:"attached",resources:z}}};h.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};h.update=function(w){if(!this.flowStyle.isCompatible(w.flowStyle)||!this.extent.equals(w.extent)||this.size[0]!==w.size[0]||this.size[1]!==w.size[1]||this.pixelRatio!==w.pixelRatio)return!1;this.flowStyle=w.flowStyle;
return!0};return r._createClass(B)}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(r,H,B,h,w,z){z=function(x){function y(){var E=x.apply(this,arguments)||this;E._displayData=null;return E}H._inherits(y,x);var C=y.prototype;C.clear=function(){null!=this._displayData&&(this._displayData.detach(),this._displayData=
null,this.requestRender())};C.setTransform=function(E){var {displayData:v}=this;if(null!=v){var F=[0,0];E.toScreen(F,[v.extent.xmin,v.extent.ymax]);v=(v.extent.xmax-v.extent.xmin)/v.size[0]/E.resolution;var P=B.deg2rad(E.rotation),{dvs:u}=this.transforms;h.fromTranslation(u,[-1,1,0]);h.scale(u,u,[2/(E.size[0]*E.pixelRatio),-2/(E.size[1]*E.pixelRatio),1]);h.translate(u,u,[F[0],F[1],0]);h.rotate(u,u,P);h.scale(u,u,[v*E.pixelRatio,v*E.pixelRatio,1])}};C._createTransforms=function(){return{dvs:w.create()}};
H._createClass(y,[{key:"displayData",get:function(){return this._displayData},set:function(E){this._displayData=E;this.requestRender()}}]);return y}(z.DisplayObject);r.FlowDisplayObject=z;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P,u,e,d,p){const n=h.ofType({key:"type",base:null,typeMap:{rect:e,path:p,geometry:d}});r.LayerView2DMixin=D=>{D=function(a){function c(){var l=a.apply(this,arguments)||this;l.attached=!1;l.clips=new n;l.lastUpdateId=-1;l.moving=!1;l.updateRequested=!1;l.visibleAtCurrentScale=!1;l.highlightOptions=null;return l}H._inherits(c,a);var f=c.prototype;f.initialize=function(){const l=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&l&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new P.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([x.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},x.syncAndInitial),
x.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=b)},x.syncAndInitial),x.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},x.syncAndInitial),x.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},x.syncAndInitial),x.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,x.syncAndInitial),x.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},x.syncAndInitial),x.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},x.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};f.destroy=function(){this.processDetach();this.updateRequested=!1};f.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};f.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};f.isVisibleAtScale=function(l){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;
const {minScale:k,maxScale:m}=b;return(0===k||l<=k)&&(0===m||l>=m)};f.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};f.processUpdate=function(l){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",l),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(l)))};f.hitTest=function(l,b){return Promise.resolve(null)};f.supportsSpatialReference=function(l){return!0};
f.canResume=function(){return this.spatialReferenceSupported?H._get(H._getPrototypeOf(c.prototype),"canResume",this).call(this)?this.visibleAtCurrentScale:!1:!1};f.getSuspendInfo=function(){const l=H._get(H._getPrototypeOf(c.prototype),"getSuspendInfo",this).call(this),b=!this.spatialReferenceSupported,k=this.visibleAtCurrentScale;b&&(l.spatialReferenceNotSupported=b);k&&(l.outsideScaleRange=k);return l};f.addAttachHandles=function(l){this.addHandles(l,"attach")};H._createClass(c,[{key:"spatialReferenceSupported",
get:function(){const l=this.view?.spatialReference;return null==l||this.supportsSpatialReference(l)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return c}(D);B.__decorate([y.property()],D.prototype,"attached",void 0);B.__decorate([y.property({type:n,set(a){a=w.referenceSetter(a,this._get("clips"),n);this._set("clips",a)}})],D.prototype,"clips",void 0);B.__decorate([y.property()],
D.prototype,"container",void 0);B.__decorate([y.property()],D.prototype,"moving",void 0);B.__decorate([y.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);B.__decorate([y.property({readOnly:!0})],D.prototype,"updateParameters",void 0);B.__decorate([y.property()],D.prototype,"updateRequested",void 0);B.__decorate([y.property()],D.prototype,"updating",null);B.__decorate([y.property()],D.prototype,"view",void 0);B.__decorate([y.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",
void 0);B.__decorate([y.property({type:u})],D.prototype,"highlightOptions",void 0);return D=B.__decorate([F.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(r,H,B,h,w,z,x,y){var C;h=C=function(E){function v(P){P=E.call(this,P)||this;P.type="rect";P.left=null;P.right=null;P.top=null;P.bottom=null;return P}r._inherits(v,E);var F=v.prototype;F.clone=function(){return new C({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};F.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return r._createClass(v)}(y);H.__decorate([B.property({type:[Number,
String],json:{write:!0}})],h.prototype,"left",void 0);H.__decorate([B.property({type:[Number,String],json:{write:!0}})],h.prototype,"right",void 0);H.__decorate([B.property({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0);H.__decorate([B.property({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0);return h=C=H.__decorate([x.subclass("esri.views.layers.support.ClipRect")],h)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(r,H,B,h,w,z,x,y){B=function(C){function E(){return C.apply(this,arguments)||this}r._inherits(E,C);r._createClass(E,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return E}(B.JSONSupport);H.__decorate([h.property({readOnly:!0})],B.prototype,"version",null);return B=H.__decorate([y.subclass("esri.views.layers.support.ClipArea")],B)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P){var u;B={base:C,key:"type",typeMap:{extent:F,polygon:P}};v=u=function(e){function d(n){n=e.call(this,n)||this;n.type="geometry";n.geometry=null;return n}r._inherits(d,e);var p=d.prototype;p.clone=function(){return new u({geometry:this.geometry?.clone()??null})};p.commitVersionProperties=function(){this.commitProperty("geometry")};return r._createClass(d)}(v);H.__decorate([h.property({types:B,json:{read:E.fromJSON,write:!0}})],v.prototype,"geometry",void 0);return v=
u=H.__decorate([y.subclass("esri.views.layers.support.Geometry")],v)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(r,H,B,h,w,z,x,y){h=function(C){function E(v){v=C.call(this,v)||this;v.type="path";v.path=[];return v}
r._inherits(E,C);E.prototype.commitVersionProperties=function(){this.commitProperty("path")};return r._createClass(E)}(y);H.__decorate([B.property({type:[[[Number]]],json:{write:!0}})],h.prototype,"path",void 0);return h=H.__decorate([x.subclass("esri.views.layers.support.Path")],h)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(r,H,B,h,w,z,x,y,C,E){h=function(v){function F(){var u=v.apply(this,arguments)||this;u.type="raster";return u}r._inherits(F,v);var P=F.prototype;P.attach=function(){r._get(r._getPrototypeOf(F.prototype),"attach",this).call(this);this.container=new y.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()};P.detach=function(){r._get(r._getPrototypeOf(F.prototype),"detach",this).call(this);this.container.removeAllChildren();
this.container=null};P.canUseWebGLForProcessing=function(){const {symbolizer:u}=this.layer;var e=u.lookup?.colormapLut?.indexedColormap;e=e&&e.length>this._maxIndexedColormapSize;return this.useWebGLForProcessing&&u.canRenderInWebGL&&!e&&!("majority"===this.layer.interpolation&&E.canUseMajorityInterpolationOnDataSource(this.layer))};P.fetchTile=function(u,e){return this.layer.fetchTile(u.level,u.row,u.col,e)};P.updateRasterFunctionParameters=function(){const {raster:u,type:e}=this.layer,{container:d}=
this;if("Function"!==u.datasetFormat||"wcs"===e)d.rasterFunctionChain=null,d.children.forEach(b=>{({bitmap:b}=b);b&&(b.suspended=!0,b.processed=!1,b.projected&&(b.invalidateTexture(),b.rasterTexture=null))}),this._rasterFunctionState="na";else{var p=this._rasterFunctionState,{rasterFunction:n,primaryRasters:D}=u,a=n.supportsGPU&&(!D||1>=D.rasters.length),c=a?n.flatWebGLFunctionChain:null,{renderer:f}=this.layer;a=!a||!c?.functions.length||"raster-stretch"===f?.type&&f.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();
d.rasterFunctionChain=a?null:c;var l=null==n?"na":d.rasterFunctionChain?"gpu":"cpu";d.children.forEach(b=>{({bitmap:b}=b);b&&(b.suspended=p!==l,b.processed=!1,b.processedTexture=null)});this._rasterFunctionState=l}};P.updateTileSource=async function(u,e){const d=this._getBandIds(),p=this._getLayerInterpolation(),n=this.canUseWebGLForProcessing(),{source:D,globalSymbolizerParams:a,suspended:c,coords:f,resolution:l}=e;e=this.layerView.hasTilingEffects?a:e.symbolizerParams;({bitmap:u}=u);[u.x,u.y]=f;
u.resolution=l;if(D&&null!=D&&null!=D.pixelBlock){var b={extent:D.extent,pixelBlock:D.pixelBlock};u.rawPixelData=b;n?(u.source=D.pixelBlock,u.isRendereredSource=!1):(b=await this.layer.applyRenderer(b,"stretch"===a?.type?a:void 0),u.source=b,u.isRendereredSource=!0);u.symbolizerParameters=n?e:null;n?u.transformGrid||(u.transformGrid=D.transformGrid):u.transformGrid=null}else b=this.createEmptyTilePixelBlock(),u.source=b,u.symbolizerParameters=n?e:null,u.transformGrid=null;u.bandIds=n?d:null;u.width=
this._tileInfoView.tileInfo.size[0];u.height=this._tileInfoView.tileInfo.size[1];u.interpolation=p;u.suspended=c;u.invalidateTexture()};P.updateTileSymbolizerParameters=async function(u,e){const {local:d,global:p}=e;e=this._getBandIds();const n=this._getLayerInterpolation(),D=this.canUseWebGLForProcessing();({bitmap:u}=u);const {rawPixelData:a}=u;D||null==a?(u.isRendereredSource&&null!=a&&(u.source=a.pixelBlock),u.isRendereredSource=!1):(u.source=await this.layer.applyRenderer(a,"stretch"===p?.type?
p:void 0),u.isRendereredSource=!0);u.symbolizerParameters=D?this.layerView.hasTilingEffects?p:d:null;u.bandIds=D?e:null;u.interpolation=n;u.suspended=!1};P._getLayerInterpolation=function(){const {interpolation:u,renderer:e}=this.layer;if(!e)return u;const d=e.type;return"raster-colormap"===d||"unique-value"===d||"class-breaks"===d?"nearest":"raster-stretch"===e.type&&null!=e.colorRamp?"bilinear"===u||"cubic"===u?"bilinear":"nearest":u};return r._createClass(F)}(C.BaseImageryTileSubView2D);H.__decorate([B.property()],
h.prototype,"container",void 0);H.__decorate([B.property()],h.prototype,"layer",void 0);H.__decorate([B.property()],h.prototype,"type",void 0);return h=H.__decorate([x.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],h)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ./BrushRasterBitmap ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(r,H,B,h,w,z,x,y){y=function(C){function E(){var F=C.apply(this,arguments)||this;F.isCustomTilingScheme=!1;return F}H._inherits(E,C);var v=E.prototype;v.createTile=function(F){const P=this._getTileBounds(F),[u,e]=this._tileInfoView.tileInfo.size,d=this._tileInfoView.getTileResolution(F.level);return new z.RasterTile(F,d,P[0],P[3],u,e)};v.prepareRenderPasses=function(F){const P=F.registerRenderPass({name:"imagery (tile)",brushes:[w],target:()=>this.children.map(u=>u.bitmap),drawPhase:x.WGLDrawPhase.MAP});
return[...H._get(H._getPrototypeOf(E.prototype),"prepareRenderPasses",this).call(this,F),P]};v.doRender=function(F){if(this.visible&&F.drawPhase===x.WGLDrawPhase.MAP){var {rasterFunctionChain:P}=this;if(P){var [u,e]=this._tileInfoView.tileInfo.size;F.renderPass="raster";F.rasterFunction={name:"Reproject",parameters:{targetImageSize:[u,e],requireBilinear:P.hasSurfaceFunction},pixelType:"f32",id:0,isNoopProcess:!1};H._get(H._getPrototypeOf(E.prototype),"doRender",this).call(this,F);if(P?.functions.length){const {functions:d,
hasBranches:p}=P;for(P=0;P<d.length;P++){const n=d[P];"Constant"!==n.name&&"Identity"!==n.name&&(F.renderPass="raster",F.rasterFunction=n,F.hasBranches=p,H._get(H._getPrototypeOf(E.prototype),"doRender",this).call(this,F))}}F.rasterFunction=null;F.renderPass="bitmap"}else F.renderPass="raster-bitmap";H._get(H._getPrototypeOf(E.prototype),"doRender",this).call(this,F)}};v._getTileBounds=function(F){const P=this._tileInfoView.getTileBounds(B.create(),F);if(this.isCustomTilingScheme&&F.world){var {tileInfo:u}=
this._tileInfoView,e=h.getWorldWidth(u.spatialReference);if(e){var d=u.lodAt(F.level);if(!d)return P;({resolution:d}=d);u=(e=e/d%u.size[0])?(u.size[0]-e)*d:0;P[0]-=u*F.world;P[2]-=u*F.world}}return P};return H._createClass(E)}(y);r.RasterTileContainer=y;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushRasterBitmap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./RasterBitmap ./colorizer/rasterColorizer ./processor/rasterProcessor ../webgl/definitions ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/rasterUtils".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v){return function(F){function P(){var e=F.apply(this,arguments)||this;e.name="raster";e._quad=null;e._rendererUniformInfos=new Map;e._fbo=null;return e}r._inherits(P,F);var u=P.prototype;u.dispose=function(){H.disposeMaybe(this._quad);H.disposeMaybe(this._fbo)};u.prepareState=function(e){const {context:d,renderPass:p}=e;e="raster"===p;d.setBlendingEnabled(!e);d.setBlendFunctionSeparate(C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA,C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA);
d.setColorMask(!0,!0,!0,!0);d.setStencilWriteMask(0);d.setStencilTestEnabled(!e)};u.draw=function(e,d){if(B.hasSource(d)&&!d.suspended){var {renderPass:p}=e;if("raster-bitmap"===p)this._drawBitmap(e,d);else{if("raster"===p)return this._process(e,d);this._drawBitmap(e,d,!0)}}};u._process=function(e,d){var {rasterFunction:p}=e;p="Reproject"===p.name;if(!(p?d.rasterTexture&&d.projected:d.processed)){var {timeline:n,context:D}=e;n.begin(this.name);var a=D.getBoundFramebufferObject(),c=D.getViewport();
p||(d.processedTexture=H.disposeMaybe(d.processedTexture));D.setStencilFunction(C.CompareFunction.EQUAL,d.stencilRef,255);d.updateTexture(e);this._initQuad(D);var {isStandardRasterTileSize:f,fbo:l}=this._getRasterFBO(D,d.width,d.height);w.process(e,this._quad,l,d);f||l.dispose();D.bindFramebuffer(a);D.setViewport(c.x,c.y,c.width,c.height);n.end(this.name)}};u._drawBitmap=function(e,d,p=!1){const {timeline:n,context:D}=e;n.begin(this.name);D.setStencilFunction(C.CompareFunction.EQUAL,d.stencilRef,
255);d.updateTexture(e);if(p&&!d.processedTexture){d.updateProcessedTexture();if(!d.processedTexture){n.end(this.name);return}d.processed=!0}this._initBitmapCommonUniforms(d);var a=d.symbolizerParameters.type;const c=h.getColorizer(a),{requestRender:f,allowDelayedRender:l}=e,{defines:b,program:k}=c.createProgram(e,d,p);l&&null!=f&&!k.compiled?f():(D.useProgram(k),a=this._getUniformInfos(a,D,k,b),this._quad||(this._quad=new x(D,[0,0,1,0,0,1,1,1])),c.bindTextureAndUniforms(e,k,d,a,p),this._quad.draw(),
n.end(this.name))};u._initBitmapCommonUniforms=function(e){if(!e.commonUniforms){const d=v.getBasicGridUniforms(1,[0,0]),{transformGrid:p,width:n,height:D}=e,a=v.getCommonUniforms(p,[n,D],[e.source.width,e.source.height],1,!1);e.commonUniforms={...d,...a,u_coordScale:e.coordScale}}};u._getRasterFBO=function(e,d,p){const n=d===z.TILE_SIZE||p===z.TILE_SIZE;return n?(this._fbo||(this._fbo=this._createNewFBO(e,d,p)),{isStandardRasterTileSize:n,fbo:this._fbo}):{isStandardRasterTileSize:n,fbo:this._createNewFBO(e,
d,p)}};u._createNewFBO=function(e,d,p){d=w.createTextureDescriptor(e,d,p);return new E.FramebufferObject(e,d)};u._initQuad=function(e){this._quad||(this._quad=new x(e,[0,0,1,0,0,1,1,1]))};u._getUniformInfos=function(e,d,p,n){e=0<n.length?e+"-"+n.join("-"):e;if(this._rendererUniformInfos.has(e))return this._rendererUniformInfos.get(e);d=v.getUniformLocationInfos(d,p);this._rendererUniformInfos.set(e,d);return d};return r._createClass(P)}(y)})},"esri/views/2d/engine/imagery/RasterBitmap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../DisplayObject ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),
function(r,H,B,h,w,z,x,y,C){const E={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};x=function(F){function P(e=null,d=null,p=null){var n=F.call(this)||this;n._textureInvalidated=!0;n._colormapTextureInvalidated=!0;n._rasterTexture=null;n._rasterTextureBandIds=null;n._transformGridTexture=null;n._colormapTexture=null;n._colormap=
null;n._supportsBilinearTexture=!0;n._processedTexture=null;n.functionTextures=[];n.projected=!1;n.stencilRef=0;n.coordScale=[1,1];n._processed=!1;n._symbolizerParameters=null;n.height=null;n.isRendereredSource=!1;n.pixelRatio=1;n.resolution=0;n.rotation=0;n._source=null;n.rawPixelData=null;n._suspended=!1;n._bandIds=null;n._interpolation=null;n._transformGrid=null;n.width=null;n.x=0;n.y=0;n.source=e;n.transformGrid=d;n.interpolation=p;return n}H._inherits(P,F);var u=P.prototype;u.destroy=function(){this._disposeTextures()};
u.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())};u._createTransforms=function(){return{dvs:w.create()}};u.setTransform=function(e){const d=h.identity(this.transforms.dvs),[p,n]=e.toScreenNoRotation([0,0],[this.x,this.y]);var D=this.resolution/this.pixelRatio/e.resolution;const a=D*this.width;D*=this.height;const c=Math.PI*this.rotation/180;h.translate(d,d,z.fromValues(p,n));h.translate(d,d,z.fromValues(a/2,D/2));h.rotate(d,d,-c);h.translate(d,
d,z.fromValues(-a/2,-D/2));h.scaleByVec2(d,d,z.fromValues(a,D));h.multiply(this.transforms.dvs,e.displayViewMat3,d)};u.getTextures=function({forProcessing:e=!1,useProcessedTexture:d=!1}={}){const p=d?this._processedTexture??this._rasterTexture:this._rasterTexture,n=[],D=[];if(!p)return{names:n,textures:D};if(d)return D.push(p),n.push("u_image"),this._colormapTexture&&(D.push(this._colormapTexture),n.push("u_colormap")),{names:n,textures:D};this._transformGridTexture&&(D.push(this._transformGridTexture),
n.push("u_transformGrid"));D.push(p);n.push("u_image");this._colormapTexture&&!e&&(D.push(this._colormapTexture),n.push("u_colormap"));return{names:n,textures:D}};u.onAttach=function(){this.invalidateTexture()};u.onDetach=function(){this.invalidateTexture()};u.updateTexture=function({context:e}){if(this.stage){var d=this._isValidSource(this.source);d&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(e));this._textureInvalidated&&(this._textureInvalidated=
!1,this._createOrDestroyRasterTexture(e),this._rasterTexture&&(d?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=C.createTransformTexture(e,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()};u.updateProcessedTexture=function(){const {functionTextures:e}=this;0!==e.length&&(this.processedTexture=e.shift(),e.forEach(d=>d?.dispose()),e.length=0)};u._createOrDestroyRasterTexture=function(e){const d=
this.source?.extractBands(this.bandIds);if(this._isValidSource(d)){var p=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(p)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!e.capabilities.textureFloat?.textureFloatLinear;p=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=C.createRasterTexture(e,d,p,this.isRendereredSource||!e.capabilities.textureFloat?.textureFloat);this._processed=this.projected=
!1;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};u._isBandIdschanged=function(e){const d=this._rasterTextureBandIds;return!(null==d&&null==e||d&&e&&d.join("")===e.join(""))};u._isValidSource=function(e){return null!=e&&0<e.pixels?.length};u._getTextureSamplingMethod=function(e){const {type:d,colormap:p}=this.symbolizerParameters;return!this._supportsBilinearTexture||"lut"===
d||"stretch"===d&&null!=p||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"};u._updateColormapTexture=function(e){const d=this._colormap,p=this.symbolizerParameters.colormap;if(!p)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!d)this._colormapTexture=C.createColormapTexture(e,p),this._colormap=p;else if(p.length!==d.length||p.some((n,D)=>n!==d[D]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=
C.createColormapTexture(e,p),this._colormap=p};u._disposeTextures=function(e=!1){this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);!e&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormap=this._colormapTexture=null,this._colormapTextureInvalidated=!0);!e&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null);this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=
null)};H._createClass(P,[{key:"processedTexture",get:function(){return this._processedTexture},set:function(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}},{key:"rasterTexture",get:function(){return this._rasterTexture},set:function(e){this._rasterTexture!==e&&(this._rasterTexture?.dispose(),this._rasterTexture=e)}},{key:"processed",get:function(){return this._processed},set:function(e){this._processed=e;e||(B.disposeMaybe(this.processedTexture),this.invalidateTexture())}},
{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||E},set:function(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}},{key:"source",get:function(){return this._source},set:function(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null),this.projected=!1,this.invalidateTexture())}},{key:"suspended",get:function(){return this._suspended},
set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender());this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e;this._isBandIdschanged(e)&&(this.projected=!1,this.invalidateTexture())}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(e){this._interpolation=e;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?y.TextureSamplingMode.LINEAR:
y.TextureSamplingMode.NEAREST)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e;this._transformGridTexture=B.disposeMaybe(this._transformGridTexture)}}]);return P}(x.DisplayObject);let v=function(F){function P(){return F.apply(this,arguments)||this}H._inherits(P,F);H._createClass(P,[{key:"source",get:function(){return this._source}}]);return P}(x);r.RasterBitmap=x;r.RasterBitmapWithSource=v;r.hasSource=function(F){return null!=F.source};Object.defineProperty(r,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./contextUtils ./enums ./Texture ./TextureDescriptor".split(" "),function(r,H,B,h,w,z){r.createColormapTexture=function(x,y){const C=new z.TextureDescriptor;C.internalFormat=h.PixelFormat.RGBA;C.width=y.length/4;C.height=1;C.samplingMode=h.TextureSamplingMode.NEAREST;C.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new w.Texture(x,C,y)};r.createRasterTexture=function(x,y,C="nearest",
E=!1){const v=(E=!(E&&"u8"===y.pixelType))?h.PixelType.FLOAT:h.PixelType.UNSIGNED_BYTE,F=null==y.pixels||0===y.pixels.length?null:E?y.getAsRGBAFloat():y.getAsRGBA(),P=x.capabilities.textureFloat?.textureFloatLinear,u=new z.TextureDescriptor;u.width=y.width;u.height=y.height;u.internalFormat=x.type===B.ContextType.WEBGL2&&E?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;u.samplingMode=!P||"bilinear"!==C&&"cubic"!==C?h.TextureSamplingMode.NEAREST:h.TextureSamplingMode.LINEAR;u.dataType=v;u.wrapMode=
h.TextureWrapMode.CLAMP_TO_EDGE;return new w.Texture(x,u,F)};r.createTransformTexture=function(x,y){const {spacing:C,offsets:E,coefficients:v,size:[F,P]}=y;var u=1<C[0];y=new z.TextureDescriptor;y.width=u?4*F:F;y.height=P;y.internalFormat=x.type===B.ContextType.WEBGL2?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;y.dataType=h.PixelType.FLOAT;y.samplingMode=h.TextureSamplingMode.NEAREST;y.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;const e=new Float32Array(u?F*P*16:2*E.length);if(u&&null!=v)for(let d=
0,p=0;d<v.length;d++)e[p++]=v[d],2===d%3&&(e[p++]=1);else for(u=0;u<P;u++)for(let d=0;d<F;d++){const p=4*(u*F+d),n=2*(d*P+u);e[p]=E[n];e[p+1]=E[n+1];e[p+3]=-1===E[n]?0:1}return new w.Texture(x,y,e)};r.getBasicGridUniforms=function(x,y){return{u_scale:x,u_offset:y}};r.getColormapUniforms=function(x,y){return{u_colormapOffset:y||0,u_colormapMaxIndex:x?x.length/4-1:0}};r.getCommonUniforms=function(x,y,C,E=1,v=!0){return{u_flipY:v,u_applyTransform:!!x,u_opacity:E,u_transformSpacing:x?x.spacing:H.ZEROS,
u_transformGridSize:x?x.size:H.ZEROS,u_targetImageSize:y,u_srcImageSize:C}};r.getShadedReliefUniforms=function(x){return{u_hillshadeType:x.hillshadeType,u_sinZcosAs:x.sinZcosAs,u_sinZsinAs:x.sinZsinAs,u_cosZs:x.cosZs,u_weights:x.weights,u_factor:x.factor,u_minValue:x.minValue,u_maxValue:x.maxValue}};r.getStretchUniforms=function(x){return{u_bandCount:x.bandCount,u_minOutput:x.outMin,u_maxOutput:x.outMax,u_minCutOff:x.minCutOff,u_maxCutOff:x.maxCutOff,u_factor:x.factor,u_useGamma:x.useGamma,u_gamma:x.gamma,
u_gammaCorrection:x.gammaCorrection}};r.getUniformLocationInfos=function(x,y){x=x.gl;y=y.glName;const C=new Map;if(null==y)return C;const E=x.getProgramParameter(y,x.ACTIVE_UNIFORMS);let v;for(let F=0;F<E;F++)(v=x.getActiveUniform(y,F))&&C.set(v.name,{location:x.getUniformLocation(y,v.name),info:v});return C};r.setTextures=function(x,y,C,E){C.length===E.length&&(E.some(v=>null==v)||C.some(v=>null==v)||C.forEach((v,F)=>{y.setUniform1i(v,F);x.bindTexture(E[F],F)}))};r.setUniforms=function(x,y,C){Object.keys(C).forEach(E=>
{var v=y.get(E)||y.get(E+"[0]");if(v){var F=C[E];if(null!==v&&null!=F)switch({info:v}=v,v.type){case h.UniformType.FLOAT:1<v.size?x.setUniform1fv(E,F):x.setUniform1f(E,F);break;case h.UniformType.FLOAT_VEC2:x.setUniform2fv(E,F);break;case h.UniformType.FLOAT_VEC3:x.setUniform3fv(E,F);break;case h.UniformType.FLOAT_VEC4:x.setUniform4fv(E,F);break;case h.UniformType.FLOAT_MAT3:x.setUniformMatrix3fv(E,F);break;case h.UniformType.FLOAT_MAT4:x.setUniformMatrix4fv(E,F);break;case h.UniformType.INT:1<v.size?
x.setUniform1iv(E,F):x.setUniform1i(E,F);break;case h.UniformType.BOOL:x.setUniform1i(E,F?1:0);break;case h.UniformType.INT_VEC2:case h.UniformType.BOOL_VEC2:x.setUniform2iv(E,F);break;case h.UniformType.INT_VEC3:case h.UniformType.BOOL_VEC3:x.setUniform3iv(E,F);break;case h.UniformType.INT_VEC4:case h.UniformType.BOOL_VEC4:x.setUniform4iv(E,F)}}})};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/rasterColorizer":function(){define(["exports",
"./lut","./shadedrelief","./stretch"],function(r,H,B,h){const w=new Map;w.set("lut",H);w.set("hillshade",B);w.set("stretch",h);r.getColorizer=function(z){return w.get(z)};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/lut":function(){define(["./utils","../../../../webgl/rasterUtils"],function(r,H){const B={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,w,z){w=
z?[]:r.getProjectionDefines(w.transformGrid);h=h.painter.materialManager.getProgram(B,w);return{defines:w,program:h}},bindTextureAndUniforms:function(h,w,z,x,y=!1){const {names:C,textures:E}=z.getTextures({useProcessedTexture:y});H.setTextures(h.context,w,C,E);H.setUniforms(w,x,z.commonUniforms);w.setUniformMatrix3fv("u_dvsMat3",z.transforms.dvs);const {colormap:v,colormapOffset:F}=z.symbolizerParameters;h=H.getColormapUniforms(v,F);H.setUniforms(w,x,h)}}})},"esri/views/2d/engine/imagery/colorizer/utils":function(){define(["exports"],
function(r){r.getInterpolationDefines=function(H,B,h){h=!h.capabilities.textureFloat?.textureFloatLinear;const w=[];"cubic"===H?w.push("bicubic"):"bilinear"===H&&(B?(w.push("bilinear"),w.push("nnedge")):h&&w.push("bilinear"));return w};r.getProjectionDefines=function(H){const B=[];H&&(B.push("applyProjection"),1===H.spacing[0]&&B.push("lookupProjection"));return B};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/shadedrelief":function(){define(["./utils",
"../../../../webgl/rasterUtils"],function(r,H){const B={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,w,z){const {colormap:x}=w.symbolizerParameters;z=z?[]:r.getProjectionDefines(w.transformGrid);w=r.getInterpolationDefines(w.interpolation,null!=x,h.context);w=[...z,...w];null!=x&&w.push("applyColormap");h=h.painter.materialManager.getProgram(B,w);return{defines:w,program:h}},bindTextureAndUniforms:function(h,
w,z,x,y=!1){const {names:C,textures:E}=z.getTextures({useProcessedTexture:y});H.setTextures(h.context,w,C,E);H.setUniforms(w,x,z.commonUniforms);w.setUniformMatrix3fv("u_dvsMat3",z.transforms.dvs);h=z.symbolizerParameters;const {colormap:v,colormapOffset:F}=h;null!=v&&(z=H.getColormapUniforms(v,F),H.setUniforms(w,x,z));h=H.getShadedReliefUniforms(h);H.setUniforms(w,x,h)}}})},"esri/views/2d/engine/imagery/colorizer/stretch":function(){define(["./utils","../../../../webgl/rasterUtils"],function(r,H){const B=
{vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,w,z){const {colormap:x}=w.symbolizerParameters;var y=z?[]:r.getProjectionDefines(w.transformGrid);const C=r.getInterpolationDefines(w.interpolation,null!=x,h.context);y=[...y,...C];w.isRendereredSource&&!z?y.push("noop"):null!=x&&y.push("applyColormap");h=h.painter.materialManager.getProgram(B,y);return{defines:y,program:h}},bindTextureAndUniforms:function(h,w,z,
x,y=!1){const {names:C,textures:E}=z.getTextures({useProcessedTexture:y});H.setTextures(h.context,w,C,E);H.setUniforms(w,x,z.commonUniforms);w.setUniformMatrix3fv("u_dvsMat3",z.transforms.dvs);h=z.symbolizerParameters;const {colormap:v,colormapOffset:F}=h;null!=v&&(z=H.getColormapUniforms(v,F),H.setUniforms(w,x,z));h=H.getStretchUniforms(h);H.setUniforms(w,x,h)}}})},"esri/views/2d/engine/imagery/processor/rasterProcessor":function(){define("exports ./aspectProcessor ./bandArithmeticProcessor ./compositeBandProcessor ./convolutionProcessor ./curvatureProcessor ./extractBandProcessor ./localProcessor ./maskProcessor ./ndviProcessor ./remapProcessor ./reprojectProcessor ./slopeProcessor ./stretchProcessor ../../../../webgl/contextUtils ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P,u,e,d,p,n){function D(c,f,l){const b=new n.TextureDescriptor;b.width=f;b.height=l;b.internalFormat=c.type===e.ContextType.WEBGL2?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA;b.samplingMode=d.TextureSamplingMode.NEAREST;b.dataType=d.PixelType.FLOAT;b.isImmutable=c.type===e.ContextType.WEBGL2;b.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return b}const a=new Map;a.set("aspect",H);a.set("bandarithmetic",B);a.set("compositeband",h);a.set("convolution",w);a.set("curvature",
z);a.set("extractband",x);a.set("local",y);a.set("mask",C);a.set("ndvi",E);a.set("remap",v);a.set("slope",P);a.set("stretch",u);r.createTextureDescriptor=D;r.process=function(c,f,l,b){const k=c.rasterFunction.name.toLowerCase(),m="reproject"===k?F:a.get(k.toLowerCase());if(null!=m){{const {context:I,requestRender:K,allowDelayedRender:R}=c;var q=m.createProgram(c,b);if(R&&null!=K&&!q.compiled)K(),q=null;else{var {width:G,height:L}=b;I.bindFramebuffer(l);I.setViewport(0,0,G,L);I.useProgram(q)}}if(q){m.bindTextureAndUniforms(c,
q,b);f.draw();var {width:M,height:t}=b;f=D(c.context,M,t);f=new p.Texture(c.context,f);l.copyToTexture(0,0,M,t,0,0,f);"reproject"===k?(b.rasterTexture=f,b.projected=!0):b.functionTextures[c.hasBranches?c.rasterFunction.id:0]=f}}};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/aspectProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",
1]])};return{createProgram:function(B,h){return B.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);const {width:z,height:x,resolution:y}=w;h.setUniform2fv("u_srcImageSize",[z,x]);h.setUniform2fv("u_cellSize",[y,y])}}})},"esri/views/2d/engine/imagery/processor/utils":function(){define(["exports","../../../../webgl/rasterUtils"],function(r,H){function B(z,x,y){const {context:C,rasterFunction:E,hasBranches:v}=
z;({raster:z}=E.parameters);H.setTextures(C,x,["u_image"],[y.functionTextures[v?z?.id??-1:0]??y.rasterTexture])}const h=[1,1],w=[2,0,0,0,2,0,-1,-1,0];r.setCoordsAndTransforms=function(z){z.setUniform2fv("u_coordScale",h);z.setUniformMatrix3fv("u_dvsMat3",w)};r.setMultipleImageTextures=function(z,x,y){var {rasters:C}=z.rasterFunction.parameters;if(C){if(2>C.length)return B(z,x,y);var E=C.filter(v=>"Constant"!==v.name).map(v=>null!=v.id&&"Identity"!==v.name?y.functionTextures[v.id]:y.rasterTexture);
H.setTextures(z.context,x,["u_image","u_image1","u_image2"].slice(0,E.length),E);if(E.length!==C.length)if(2===C.length)E=C.findIndex(v=>"Constant"===v.name),z=0===E?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:C}=C[E].parameters,x.setUniform1f("u_image1Const",C),x.setUniformMatrix3fv("u_imageSwap",z);else if(3===C.length){const v=[];C.forEach((F,P)=>"Constant"===F.name&&v.push(P));1===v.length?({value:C}=C[v[0]].parameters,x.setUniform1f("u_image1Const",C),x.setUniformMatrix3fv("u_imageSwap",0===
v[0]?[0,1,0,0,0,1,1,0,0]:1===v[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])):2===v.length&&({value:z}=C[v[0]].parameters,x.setUniform1f("u_image1Const",z),{value:z}=C[v[1]].parameters,x.setUniform1f("u_image2Const",z),C=C.findIndex(F=>"Constant"!==F.name),x.setUniformMatrix3fv("u_imageSwap",0===C?[1,0,0,0,1,0,0,0,1]:1===C?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0]))}}};r.setSingleImageTextures=B;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/bandArithmeticProcessor":function(){define(["./utils"],
function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B;({indexType:B}=z.parameters);return w.materialManager.getProgram(H,[B])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);({bandIndexMat3:B}=B.rasterFunction.parameters);h.setUniformMatrix3fv("u_bandIndexMat3",B)}}})},"esri/views/2d/engine/imagery/processor/compositeBandProcessor":function(){define(["./utils"],
function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){return B.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(B,h,w){r.setMultipleImageTextures(B,h,w);r.setCoordsAndTransforms(h)}}})},"esri/views/2d/engine/imagery/processor/convolutionProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B,{kernelRows:x,kernelCols:y}=z.parameters;return w.materialManager.getProgram(H,[{name:"rows",value:x},{name:"cols",value:y}])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);h.setUniform2fv("u_srcImageSize",[w.width,w.height]);const {kernel:z,clampRange:x}=B.rasterFunction.parameters;h.setUniform1fv("u_kernel",z);h.setUniform2fv("u_clampRange",x)}}})},
"esri/views/2d/engine/imagery/processor/curvatureProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B;({curvatureType:B}=z.parameters);return w.materialManager.getProgram(H,[B])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);const {width:z,height:x,resolution:y}=
w;({zFactor:B}=B.rasterFunction.parameters);h.setUniform2fv("u_srcImageSize",[z,x]);h.setUniform1f("u_zlFactor",200*B/y/y)}}})},"esri/views/2d/engine/imagery/processor/extractBandProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){return B.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,
h,w);r.setCoordsAndTransforms(h);({bandIndexMat3:B}=B.rasterFunction.parameters);h.setUniformMatrix3fv("u_bandIndexMat3",B)}}})},"esri/views/2d/engine/imagery/processor/localProcessor":function(){define(["./utils","../../../../webgl/contextUtils"],function(r,H){const B={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},h=new Set("sinh cosh tanh asinh acosh atanh".split(" "));return{createProgram:function(w){const {painter:z,rasterFunction:x}=
w,{imageCount:y,operationName:C,rasters:E,isOutputRounded:v}=x.parameters;var F=C.toLowerCase();w.context.type===H.ContextType.WEBGL1&&h.has(F)&&(F=`polyfill${F}`);w=[F];2===y&&w.push("twoImages");F=E.filter(P=>"Constant"===P.name);F.length&&(w.push("oneConstant"),2===F.length&&w.push("twoConstant"));v&&w.push("roundOutput");return z.materialManager.getProgram(B,w)},bindTextureAndUniforms:function(w,z,x){r.setMultipleImageTextures(w,z,x);r.setCoordsAndTransforms(z);({domainRange:w}=w.rasterFunction.parameters);
z.setUniform2fv("u_domainRange",w)}}})},"esri/views/2d/engine/imagery/processor/maskProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B;return w.materialManager.getProgram(H,1<z.parameters.bandCount?["multiBand"]:[])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);
const {includedRanges:z,noDataValues:x}=B.rasterFunction.parameters;h.setUniform1fv("u_includedRanges",z);h.setUniform1fv("u_noDataValues",x)}}})},"esri/views/2d/engine/imagery/processor/ndviProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B;return w.materialManager.getProgram(H,z.parameters.scaled?["scaled"]:[])},
bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);({bandIndexMat3:B}=B.rasterFunction.parameters);h.setUniformMatrix3fv("u_bandIndexMat3",B)}}})},"esri/views/2d/engine/imagery/processor/remapProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){return B.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(B,
h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);const {noDataRanges:z,rangeMaps:x,allowUnmatched:y,clampRange:C}=B.rasterFunction.parameters;h.setUniform1fv("u_noDataRanges",z);h.setUniform1fv("u_rangeMaps",x);h.setUniform1f("u_unmatchMask",y?1:0);h.setUniform2fv("u_clampRange",C)}}})},"esri/views/2d/engine/imagery/processor/reprojectProcessor":function(){define(["../../../../../chunks/vec2f64","../../../../webgl/rasterUtils"],function(r,H){const B={vsPath:"raster/common",fsPath:"raster/reproject",
attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,w){const {painter:z}=h,x=[],{interpolation:y,transformGrid:C}=w;w=!!h.rasterFunction?.parameters?.requireBilinear;h="bilinear"===y?!h.context.capabilities.textureFloat?.textureFloatLinear:w;"cubic"===y?x.push("bicubic"):h&&x.push("bilinear");C&&(x.push("applyProjection"),1===C.spacing[0]&&x.push("lookupProjection"));return z.materialManager.getProgram(B,x)},bindTextureAndUniforms:function(h,w,z){const {names:x,
textures:y}=z.getTextures({forProcessing:!0});H.setTextures(h.context,w,x,y);w.setUniform1f("u_scale",1);w.setUniform2fv("u_offset",[0,0]);w.setUniform2fv("u_coordScale",[1,1]);w.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]);w.setUniform1i("u_flipY",0);w.setUniform1f("u_opacity",1);const {width:C,height:E,source:v,transformGrid:F}=z;w.setUniform2fv("u_srcImageSize",[v.width,v.height]);w.setUniform2fv("u_targetImageSize",[C,E]);w.setUniform2fv("u_transformSpacing",F?F.spacing:r.ZEROS);w.setUniform2fv("u_transformGridSize",
F?F.size:r.ZEROS)}}})},"esri/views/2d/engine/imagery/processor/slopeProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {painter:w,rasterFunction:z}=B;({slopeType:B}=z.parameters);return w.materialManager.getProgram(H,"percent-rise"===B?["percentRise"]:[])},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);
const {width:z,height:x,resolution:y}=w,{zFactor:C,slopeType:E,pixelSizePower:v,pixelSizeFactor:F}=B.rasterFunction.parameters;h.setUniform2fv("u_srcImageSize",[z,x]);h.setUniform2fv("u_cellSize",[y,y]);h.setUniform1f("u_zFactor",C);h.setUniform1f("u_pixelSizePower","adjusted"===E?v:0);h.setUniform1f("u_pixelSizeFactor","adjusted"===E?F:0)}}})},"esri/views/2d/engine/imagery/processor/stretchProcessor":function(){define(["./utils"],function(r){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",
attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(B,h){const {useGamma:w,bandCount:z,isOutputRounded:x}=B.rasterFunction.parameters;h=[];w&&h.push("useGamma");1<z&&h.push("multiBand");x&&h.push("roundOutput");return B.painter.materialManager.getProgram(H,h)},bindTextureAndUniforms:function(B,h,w){r.setSingleImageTextures(B,h,w);r.setCoordsAndTransforms(h);const {width:z,height:x}=w;B=B.rasterFunction.parameters;h.setUniform2fv("u_srcImageSize",[z,x]);h.setUniform1f("u_minOutput",
B.outMin);h.setUniform1f("u_maxOutput",B.outMax);h.setUniform1fv("u_factor",B.factor);h.setUniform1fv("u_minCutOff",B.minCutOff);h.setUniform1fv("u_maxCutOff",B.maxCutOff);h.setUniform1fv("u_gamma",B.gamma);h.setUniform1fv("u_gammaCorrection",B.gammaCorrection)}}})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(r,H,B,h,w){w=function(z){function x(C,
E,v,F,P,u,e=null){var d=z.call(this,C,E,v,F,P,u)||this;d.bitmap=null;d.bitmap=new h.RasterBitmap(e,null,null);d.bitmap.coordScale=[P,u];d.bitmap.once("isReady",()=>d.ready());return d}H._inherits(x,z);var y=x.prototype;y.destroy=function(){H._get(H._getPrototypeOf(x.prototype),"destroy",this).call(this);this.bitmap.destroy();this.stage=this.bitmap=null};y.setTransform=function(C){H._get(H._getPrototypeOf(x.prototype),"setTransform",this).call(this,C);this.bitmap.transforms.dvs=this.transforms.dvs};
y._createTransforms=function(){return{dvs:B.create(),tileMat3:B.create()}};y.onAttach=function(){this.bitmap.stage=this.stage};y.onDetach=function(){this.bitmap.stage=null};H._createClass(x,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(C){this.bitmap.stencilRef=C}}]);return x}(w.TiledDisplayObject);r.RasterTile=w;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../renderers/support/rasterRendererChecks ../../tiling/PagedTileQueue ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F,P,u,e,d,p,n,D,a,c,f,l,b,k,m){const q=[0,0];r.BaseImageryTileSubView2D=function(G){function L(){var t=G.apply(this,arguments)||this;t._emptyTilePixelBlock=null;t._tileStrategy=null;t._tileInfoView=null;t._fetchQueue=null;t._blockCacheRegistryUrl=null;t._blockCacheRegistryId=null;t._srcResolutions=[];t.previousLOD=null;t._needBlockCacheUpdate=!1;t._globalSymbolizerParams=null;t._symbolizerParams=null;t._abortController=null;t._isCustomTilingScheme=!1;t._maxIndexedColormapSize=
0;t._rasterFunctionState="na";t._globalUpdateRequested=!1;t.attached=!1;t.timeExtent=null;t.redrawOrRefetch=x.debounce(async(I={})=>{if(t.previousLOD&&!t.layerView.suspended){var K=t._rasterFunctionState;I.reprocess&&(await t.updatingHandles.addPromise(t.layer.updateRasterFunction()),t.updateRasterFunctionParameters());var R=t._rasterFunctionState,{type:U}=H._assertThisInitialized(t);return I.refetch||"raster"!==U&&I.reprocess||"cpu"===R||"cpu"===K?t.updatingHandles.addPromise(t.doRefresh()):t.updatingHandles.addPromise(t._redrawImage(I.signal))}});
return t}H._inherits(L,G);var M=L.prototype;M.update=function(t){this._fetchQueue.pause();this._fetchQueue.state=t.state;this._tileStrategy.update(t);this._fetchQueue.resume();const {extent:I,resolution:K,scale:R}=t.state;t=this._tileInfoView.getClosestInfoForScale(R);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const U=this._srcResolutions[t.level],S=I.toJSON?I:m.fromJSON(I);d.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,S,K,U,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=
!1;this.previousLOD?.level!==t.level&&(this.previousLOD=t,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}};M.moveEnd=function(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});
const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t);this.layerView.requestUpdate()};M.attach=function(){var t=k.getWebGLCapabilities("2d");this._maxIndexedColormapSize=4*(t.maxTextureSize||4096);t.supportsTextureFloat||(this.useWebGLForProcessing=!1);this._initializeTileInfo();this._tileInfoView=new a(this.layerView.tileInfo,this.layerView.fullExtent);t=this._computeFetchConcurrency();this._fetchQueue=new f({tileInfoView:this._tileInfoView,concurrency:t,process:(I,
K)=>this._fetchTile1(I,K)});t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new l({cachePolicy:"purge",acquireTile:I=>this.acquireTile(I),releaseTile:I=>this.releaseTile(I),cacheSize:t,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()};M.detach=function(){this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;d.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);
this._blockCacheRegistryUrl=this._blockCacheRegistryId=null};M.acquireTile=function(t){t=this.container.createTile(t);this._enqueueTileFetch(t);this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;return t};M.releaseTile=function(t){this._fetchQueue.abort(t.key.id);this.container.removeChild(t);t.once("detach",()=>{t.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()};M.createEmptyTilePixelBlock=
function(t=null){const I=null==t||t.join(",")===this._tileInfoView.tileInfo.size.join(",");if(I&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;t=t||this._tileInfoView.tileInfo.size;const [K,R]=t;t=new u({width:K,height:R,pixels:[new Uint8Array(K*R)],mask:new Uint8Array(K*R),pixelType:"u8"});I&&(this._emptyTilePixelBlock=t);return t};M._getBandIds=function(){if(!("rasterFunctionChain"in this.container&&this.container.rasterFunctionChain))return this.layer.bandIds;const {bandIds:t,
raster:I}=this.layer,K="rasterFunction"in I?I.rasterFunction.rawInputBandIds:null;return t?.length&&K?.length&&1!==I.rasterInfo.bandCount?t.map(R=>K[Math.min(R,K.length-1)]):t||K};M.updateRasterFunctionParameters=function(){};M._fetchTile1=function(t,I){I=null!=I?I.signal:null;const K=this.canUseWebGLForProcessing(),{layerView:R}=this,{tileInfo:U}=R,S=!U.isWrappable&&null!=p.getWorldWidth(R.view.spatialReference);return this.fetchTile(t,{allowPartialFill:!0,datumTransformation:R.datumTransformation,
interpolation:K?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:K&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:I,srcResolution:this._srcResolutions[t.level],timeExtent:R.timeExtent,tileInfo:U,disableWrapAround:S})};M._getCacheSize=function(t){return t?40:0};M._initializeTileInfo=function(){const {layerView:t}=this;var I=t.view.spatialReference;if(this._canUseLayerLODs()){const {origin:Y,
lods:X}=this.layer.tileInfo;var K=X.map(({scale:aa})=>aa);I=e.create({spatialReference:I,size:b.TILE_SIZE,scales:K,origin:Y});t.set("tileInfo",I);this._srcResolutions=X.map(({resolution:aa})=>({x:aa,y:aa}))}else{K=n.isShadedReliefRendererSupported(this.layer.rasterInfo);var {scales:R,srcResolutions:U,isCustomTilingScheme:S}=p.computeProjectedScales(this.layer.rasterInfo,I,{tileSize:b.TILE_SIZE,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:K});K=e.create({spatialReference:I,size:b.TILE_SIZE,scales:R});
I=new P({x:t.fullExtent.xmin,y:t.fullExtent.ymax,spatialReference:I});if(0===K.origin.x||K.origin.x>I.x)K.origin=I;this._isCustomTilingScheme=S;t.set("tileInfo",K);this._srcResolutions=U??[]}};M._canUseLayerLODs=function(){const {layer:t,layerView:I}=this;if("Map"!==t.raster.tileType)return!1;const {lods:K}=t.tileInfo,R=I.view.constraints?.effectiveLODs;return R?.length===K.length&&R.every(({scale:U},S)=>.001>Math.abs(U-K[S].scale))};M._computeFetchConcurrency=function(){var {blockBoundary:t}=this.layer.rasterInfo.storageInfo;
t=t[t.length-1];return 64<(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)?2:10};M._enqueueTileFetch=async function(t,I){this.updatingHandles.addPromise(this._enqueueTileFetch1(t,I))};M._enqueueTileFetch1=async function(t,I){if(!this._fetchQueue.has(t.key.id)){try{const K=await this._fetchQueue.push(t.key),R=this._getBandIds();let U=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){U=
!1;try{await this._redrawImage(this._abortController?.signal)}catch(X){x.isAbortError(X)&&z.getLogger(this).error(X)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const S=this._tileInfoView.getTileCoords(q,t.key),Y=this._tileInfoView.getTileResolution(t.key);await this.updateTileSource(t,{source:K,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,
suspended:U,bandIds:R,coords:S,resolution:Y});t.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(t)}catch(K){x.isAbortError(K)||z.getLogger(this).error(K)}this.layerView.requestUpdate()}};M._redrawImage=async function(t){0!==this.container.children.length&&(await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(t):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),t=this.container.children.map(async I=>this.updateTileSymbolizerParameters(I,
{local:this._symbolizerParams,global:this._globalSymbolizerParams})),await x.eachAlways(t),this.container.requestRender())};M._updateGlobalSymbolizerParams=async function(t){if((t=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:t}))&&t.pixelBlock){var {resolution:I}=this.previousLOD,K=this._getBandIds();t=this.layer.symbolizer.generateWebGLParameters({pixelBlock:t.pixelBlock.extractBands(K),
isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:I,y:I},bandIds:K});!this.canUseWebGLForProcessing()&&t&&"stretch"===t.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(t.factor=t.factor.map(R=>255*R),t.outMin=Math.round(255*t.outMin),t.outMax=Math.round(255*t.outMax));this._globalSymbolizerParams=t}};M._updateSymbolizerParams=function(){const {resolution:t}=this.previousLOD,I=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,
isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:I})};M._updateBlockCacheRegistry=function(t=!1){const {layer:I,layerView:K}=this,{url:R,raster:U}=I;var {multidimensionalDefinition:S}=I.normalizeRasterFetchOptions({multidimensionalDefinition:I.multidimensionalDefinition,timeExtent:K.timeExtent});S=U.rasterInfo.multidimensionalInfo?U.getSliceIndex(S):null;S=d.getRasterId(R,S);if(S!==this._blockCacheRegistryUrl){null!=this._blockCacheRegistryUrl&&d.unregister(this._blockCacheRegistryUrl,
this._blockCacheRegistryId);this._blockCacheRegistryId=d.register(S,U.rasterInfo);if(t){({view:t}=K);const Y=this._tileInfoView.getClosestInfoForScale(t.scale);d.update(S,this._blockCacheRegistryId,t.extent,t.resolution,this._srcResolutions[Y.level],U.ioConfig.sampling)}this._blockCacheRegistryUrl=S}};M.doRefresh=async function(){if(this.attached){await this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();
var t=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;this._tileStrategy.refresh(I=>t.push(this._enqueueTileFetch(I)));await x.eachAlways(t)}};H._createClass(L,[{key:"useWebGLForProcessing",get:function(){return this._get("useWebGLForProcessing")??!0},set:function(t){this._set("useWebGLForProcessing",t)}},{key:"useProgressiveUpdate",get:function(){return this._get("useProgressiveUpdate")??!0},set:function(t){if(this._tileStrategy&&this.useProgressiveUpdate!==
t){this._tileStrategy.destroy();this.container.removeAllChildren();const I=this._getCacheSize(t);this._tileStrategy=new l({cachePolicy:"purge",acquireTile:K=>this.acquireTile(K),releaseTile:K=>this.releaseTile(K),cacheSize:I,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",t);this.layerView.requestUpdate()}}},{key:"updating",get:function(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return L}(w.HandleOwner);
B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"_fetchQueue",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"attached",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"container",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"layer",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"layerView",
void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"type",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);B.__decorate([y.property()],r.BaseImageryTileSubView2D.prototype,"updating",null);r.BaseImageryTileSubView2D=B.__decorate([F.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],
r.BaseImageryTileSubView2D);Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),function(r,H,B,h,
w,z,x,y,C,E,v){var F;h=F=function(P){function u(d){d=P.call(this,d)||this;d.width=null;d.height=null;d.pixelType="f32";d.validPixelCount=null;d.mask=null;d.maskIsAlpha=!1;d.premultiplyAlpha=!1;d.statistics=null;d.depthCount=1;return d}r._inherits(u,P);u.createEmptyBand=function(d,p){return new (F.getPixelArrayConstructor(d))(p)};u.getPixelArrayConstructor=function(d){let p;switch(d){case "u1":case "u2":case "u4":case "u8":p=Uint8Array;break;case "u16":p=Uint16Array;break;case "u32":p=Uint32Array;
break;case "s8":p=Int8Array;break;case "s16":p=Int16Array;break;case "s32":p=Int32Array;break;case "f32":p=Float32Array;break;case "f64":p=Float64Array;break;case "c64":case "c128":case "unknown":p=Float32Array}return p};var e=u.prototype;e.castPixelType=function(d){if(!d)return"f32";d=d.toLowerCase();["u1","u2","u4"].includes(d)?d="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(d)||(d="f32");return d};e.getPlaneCount=function(){return this.pixels?.length};e.addData=function(d){if(!d.pixels||
d.pixels.length!==this.width*this.height)throw new B("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(d.pixels);this.statistics.push(d.statistics??new E.SimpleBandStatistics)};e.getAsRGBA=function(){const d=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(d);
break;default:this._fillFrom8Bit(d)}return new Uint8ClampedArray(d)};e.getAsRGBAFloat=function(){const d=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(d);return d};e.updateStatistics=function(){if(this.pixels){this.statistics=this.pixels.map(n=>this._calculateBandStatistics(n,this.mask));var d=this.mask,p=0;if(null!=d)for(let n=0;n<d.length;n++)d[n]&&p++;else p=this.width*this.height;this.validPixelCount=p}};e.clamp=function(d){if(d&&"f64"!==d&&"f32"!==d&&this.pixels){var [p,n]=v.getPixelValueRange(d),
D=this.pixels,a=this.width*this.height,c=D.length,f=[];for(let m=0;m<c;m++){var l=F.createEmptyBand(d,a);var b=D[m];for(let q=0;q<a;q++){var k=b[q];l[q]=k>n?n:k<p?p:k}f.push(l)}this.pixels=f;this.pixelType=d}};e.extractBands=function(d){const {pixels:p,statistics:n}=this;if(null==d||0===d.length||!p||0===p.length)return this;var D=p.length,a=d.some(m=>m>=p.length),c=D===d.length&&!d.some((m,q)=>m!==q);if(a||c)return this;D=this.bandMasks?.length===D?d.map(m=>this.bandMasks[m]):void 0;let {mask:f,
validPixelCount:l}=this;const {width:b,height:k}=this;if(D){if(1===D.length)f=D[0];else for(a=b*k,f=(new Uint8Array(a)).fill(255),c=0;c<D.length;c++){const m=D[c];for(let q=0;q<a;q++)m[q]||(f[q]=0)}l=f.filter(m=>!!m).length}return new F({pixelType:this.pixelType,width:b,height:k,mask:f,bandMasks:D,validPixelCount:l,maskIsAlpha:this.maskIsAlpha,pixels:d.map(m=>p[m]),statistics:n&&d.map(m=>n[m])})};e.clone=function(){const d=new F({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,
validPixelCount:this.validPixelCount});null!=this.mask&&(d.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));this.bandMasks&&(d.bandMasks=this.bandMasks.map(D=>new Uint8Array(D)));let p;const n=F.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){d.pixels=[];const D=!!this.pixels[0].slice;for(p=0;p<this.pixels.length;p++)d.pixels[p]=D?this.pixels[p].slice(0,this.pixels[p].length):new n(this.pixels[p])}if(this.statistics)for(d.statistics=
[],p=0;p<this.statistics.length;p++)d.statistics[p]=w.clone(this.statistics[p]);d.premultiplyAlpha=this.premultiplyAlpha;return d};e._fillFrom8Bit=function(d){const {mask:p,maskIsAlpha:n,premultiplyAlpha:D,pixels:a}=this;if(d&&a&&a.length){var c,f;var l=c=f=a[0];3<=a.length?(c=a[1],f=a[2]):2===a.length&&(c=a[1]);var b=new Uint32Array(d),k=this.width*this.height;if(l.length!==k)z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=p&&p.length===
k)if(n)for(d=0;d<k;d++){const m=p[d];if(m){const q=m/255;b[d]=D?m<<24|f[d]*q<<16|c[d]*q<<8|l[d]*q:m<<24|f[d]<<16|c[d]<<8|l[d]}}else for(d=0;d<k;d++)p[d]&&(b[d]=-16777216|f[d]<<16|c[d]<<8|l[d]);else for(d=0;d<k;d++)b[d]=-16777216|f[d]<<16|c[d]<<8|l[d]}else z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};e._fillFromNon8Bit=function(d){const {pixels:p,mask:n,statistics:D}=this;if(d&&p&&p.length){var a=this.pixelType,c=1,f=0;c=1;if(D&&0<D.length){for(var l of D)null!=
l.minValue&&(f=Math.min(f,l.minValue)),null!=l.maxValue&&null!=l.minValue&&(c=Math.max(c,l.maxValue-l.minValue));c=255/c}else c=255,"s8"===a?(f=-128,c=127):"u16"===a?c=65535:"s16"===a?(f=-32768,c=32767):"u32"===a?c=4294967295:"s32"===a?(f=-2147483648,c=2147483647):"f32"===a?(f=-3.4*1E39,c=3.4*1E39):"f64"===a&&(f=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-f);d=new Uint32Array(d);a=this.width*this.height;var b,k,m;l=b=k=p[0];if(l.length!==a)return z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=p.length)if(b=p[1],3<=p.length&&(k=p[2]),null!=n&&n.length===a)for(m=0;m<a;m++)n[m]&&(d[m]=-16777216|(k[m]-f)*c<<16|(b[m]-f)*c<<8|(l[m]-f)*c);else for(m=0;m<a;m++)d[m]=-16777216|(k[m]-f)*c<<16|(b[m]-f)*c<<8|(l[m]-f)*c;else if(null!=n&&n.length===a)for(m=0;m<a;m++)b=(l[m]-f)*c,n[m]&&(d[m]=-16777216|b<<16|b<<8|b);else for(m=0;m<a;m++)b=(l[m]-f)*c,d[m]=-16777216|b<<16|b<<8|b}else z.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};e._fillFrom32Bit=
function(d){const {pixels:p,mask:n}=this;if(!d||!p||!p.length)return z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let D,a,c,f;D=a=c=p[0];3<=p.length?(a=p[1],c=p[2]):2===p.length&&(a=p[1]);const l=this.width*this.height;if(D.length!==l)return z.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let b=0;if(null!=n&&n.length===l)for(f=0;f<l;f++)d[b++]=D[f],d[b++]=a[f],d[b++]=c[f],d[b++]=n[f]&1;
else for(f=0;f<l;f++)d[b++]=D[f],d[b++]=a[f],d[b++]=c[f],d[b++]=1};e._calculateBandStatistics=function(d,p){let n=Infinity,D=-Infinity;const a=d.length;let c,f=0;if(null!=p)for(c=0;c<a;c++)p[c]&&(f=d[c],n=f<n?f:n,D=f>D?f:D);else for(c=0;c<a;c++)f=d[c],n=f<n?f:n,D=f>D?f:D;return new E.SimpleBandStatistics(n,D)};return r._createClass(u)}(h.JSONSupport);H.__decorate([x.property({json:{write:!0}})],h.prototype,"width",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"height",void 0);H.__decorate([x.property({json:{write:!0}})],
h.prototype,"pixelType",void 0);H.__decorate([y.cast("pixelType")],h.prototype,"castPixelType",null);H.__decorate([x.property({json:{write:!0}})],h.prototype,"validPixelCount",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"mask",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"maskIsAlpha",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"pixels",void 0);H.__decorate([x.property()],h.prototype,"premultiplyAlpha",void 0);H.__decorate([x.property({json:{write:!0}})],
h.prototype,"statistics",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"depthCount",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"noDataValues",void 0);H.__decorate([x.property({json:{write:!0}})],h.prototype,"bandMasks",void 0);return h=F=H.__decorate([C.subclass("esri.layers.support.PixelBlock")],h)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(r,H){H=H._createClass(function(B=
null,h=null,w=null){this.minValue=B;this.maxValue=h;this.noDataValue=w});r.SimpleBandStatistics=H;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(r){function H(h){return B[h]??[-3.4028234663852886E38,3.4028234663852886E38]}const B={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,
3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};r.convertNoDataToMask=function(h,w,z){if(!(h.depthCount&&1<h.depthCount)){var {pixels:x,statistics:y,pixelType:C}=h,E=x[0].length,v=h.bandMasks??[],F=h.mask??(new Uint8Array(E)).fill(255),P="f32"===C||"f64"===C,u=H(C),e=!1;for(let n=0;n<x.length;n++){const D="number"===typeof w?w:w[n];if(null==D)continue;var d=y?.[n].maxValue??u[1];if((y?.[n].minValue??u[0])>D+Number.EPSILON||d<D-Number.EPSILON)continue;
d=v[n]||(new Uint8Array(E)).fill(255);const a=x[n];var p=z?.customFloatTolerance;if(P&&0!==p){p||(p=9.999999E37<=Math.abs(D)?2E-7*Math.abs(D):"f32"===C?2**-23:Number.EPSILON);for(let c=0;c<a.length;c++)d[c]&&Math.abs(a[c]-D)<p&&(a[c]=0,d[c]=0,F[c]=0,e=!0)}else for(p=0;p<a.length;p++)d[p]&&a[p]===D&&(a[p]=0,d[p]=0,F[p]=0,e=!0);v[n]=d}e&&(h.bandMasks=v,h.mask=F);e&&"updateStatistics"in h&&h.updateStatistics()}};r.getPixelValueRange=H;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports",
"../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper","../../../geometry/Point"],function(r,H,B,h,w){function z(C,E){return(C=x.get(C))?C[E]??null:null}const x=new Map,y=new B;r.decreaseRefCount=function(C,E,v){const F=x.get(C);if(!F)return null==E?y.decreaseRefCount(C,v):0;if(null==E||null==F[E])return y.decreaseRefCount(C,v);E=F[E]?.cache;C=E?.get(v);if(E&&C){C.refCount--;if(0===C.refCount){E.delete(v);for(E=0;E<F.length;E++)F[E]?.cache.delete(v);C.controller&&
C.controller.abort()}return C.refCount}return 0};r.deleteBlock=function(C,E,v){const F=x.get(C);F?null==E||null==F[E]?y.deleteBlock(C,v):F[E]?.cache.delete(v):null==E&&y.deleteBlock(C,v)};r.deleteRaster=function(C){x.delete(C)};r.getBlock=function(C,E,v){const F=x.get(C);if(!F)return null==E?y.getBlock(C,v):null;if(null==E||null==F[E]){for(E=0;E<F.length;E++){var P=F[E]?.cache.get(v);if(P)return P.refCount++,P.block}return y.getBlock(C,v)}if(C=F[E]?.cache.get(v))return C.refCount++,C.block;for(C=
0;C<F.length;C++){if(C===E||!F[C])continue;P=F[C]?.cache;const u=P?.get(v);if(P&&u)return u.refCount++,P.set(v,u),u.block}return null};r.getRasterId=function(C,E){return null==E?C:`${C}?sliceId=${E}`};r.putBlock=function(C,E,v,F,P=null){const u=x.get(C);if(u)if(null==E||null==u[E])y.putBlock(C,v,F,P);else{var e={refCount:1,block:F,isResolved:!1,isRejected:!1,controller:P};F.then(()=>e.isResolved=!0).catch(()=>e.isRejected=!0);u[E]?.cache.set(v,e)}else null==E&&y.putBlock(C,v,F,P)};r.register=function(C,
E){E={extent:null,rasterInfo:E,cache:new Map};const v=x.get(C);if(v)return v.push(E),v.length-1;x.set(C,[E]);return 0};r.unregister=function(C,E){const v=x.get(C);v&&(v[E]=null,v.some(F=>null!=F)||x.delete(C))};r.update=function(C,E,v,F,P,u,e=null){if(C=z(C,E)){E=C.extent;var {cache:d,rasterInfo:p}=C;if(!E||E.xmin!==v.xmin||E.xmax!==v.xmax||E.ymin!==v.ymin||E.ymax!==v.ymax){F=F??0;E=v.clone().normalize();var {spatialReference:n,transform:D}=p,a=new Set;for(let m=0;m<E.length;m++){var c=E[m];if(c.xmax-
c.xmin<=F||c.ymax-c.ymin<=F)continue;var f=h.projectExtent(c,n,e);null!=D&&(f=D.inverseTransform(f));var l=new w({x:F,y:F,spatialReference:c.spatialReference});if(null==P&&(P=h.projectResolution(l,n,c,e),!P))return;const {pyramidLevel:q,pyramidResolution:G,excessiveReading:L}=h.snapPyramid(P,p,u||"closest");if(L)return;({storageInfo:c}=p);var {origin:b}=c;l=Math.max(0,Math.floor((f.xmin-b.x)/G.x));b=Math.max(0,Math.floor((b.y-f.ymax)/G.y));const M=0<q?c.pyramidBlockWidth:c.blockWidth,t=0<q?c.pyramidBlockHeight:
c.blockHeight;c=Math.max(0,Math.floor(l/M)-1);var k=Math.max(0,Math.floor(b/t)-1);l=Math.floor((l+Math.ceil((f.xmax-f.xmin)/G.x-.1)-1)/M)+1;f=Math.floor((b+Math.ceil((f.ymax-f.ymin)/G.y-.1)-1)/t)+1;for(b=k;b<=f;b++)for(k=c;k<=l;k++)a.add(`${q}/${b}/${k}`)}d.forEach((m,q)=>{a.has(q)||(m=d.get(q),(null==m||m.isResolved||m.isRejected)&&d.delete(q))});C.extent={xmin:v.xmin,ymin:v.ymin,xmax:v.xmax,ymax:v.ymax}}}};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],
function(r){return function(){function H(h=15E3,w=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=h;this._interval=Math.min(h,w)}var B=H.prototype;B.decreaseRefCount=function(h,w){h=h+"/"+w;w=this._cachedBlocks;if(w.has(h)){const z=w.get(h);z.refCount--;0>=z.refCount&&(w.delete(h),z.controller&&z.controller.abort());return z.refCount}return 0};B.getBlock=function(h,w){h=h+"/"+w;w=this._cachedBlocks;if(w.has(h)){const z=w.get(h);z.ts=Date.now();z.refCount++;w.delete(h);
w.set(h,z);return z.block}return null};B.putBlock=function(h,w,z,x){const y=this._cachedBlocks;h=h+"/"+w;y.has(h)?(z=y.get(h),z.ts=Date.now(),z.refCount++):y.set(h,{block:z,ts:Date.now(),refCount:1,controller:x});this._trim();this._updateTimer()};B.deleteBlock=function(h,w){const z=this._cachedBlocks;h=h+"/"+w;z.has(h)&&z.delete(h)};B.updateMaxSize=function(h){this._size=h;this._trim()};B.empty=function(){this._cachedBlocks.clear();this._clearTimer()};B.getCurrentSize=function(){return this._cachedBlocks.size};
B._updateTimer=function(){if(null==this._timer){var h=this._cachedBlocks;this._timer=setInterval(()=>{const w=Array.from(h),z=Date.now();for(let x=0;x<w.length;x++)if(w[x][1].ts<=z-this._duration)h.delete(w[x][0]);else break;0===h.size&&this._clearTimer()},this._interval)}};B._trim=function(){const h=this._cachedBlocks;if(!(-1===this._size||this._size>=h.size)){var w=Array.from(h);for(let z=0;z<w.length-this._size;z++)h.delete(w[z][0])}};B._clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),
this._timer=null)};return r._createClass(H)}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),function(r,H,B,h,w,z,x,y,C,E,v){function F(g,A,J){return!x.canProjectWithoutEngine(g,A,J)}function P(g,A,J){if((g=
F(g,A,J))&&!x.isLoaded())throw new h("rasterprojectionhelper-project","projection engine is not loaded");return g}function u(g,A,J,N=null){const T=g.spatialReference;if(T.equals(A))return g;P(T,A,N);J=J.center;J=new y({xmin:J.x-g.x/2,xmax:J.x+g.x/2,ymin:J.y-g.y/2,ymax:J.y+g.y/2,spatialReference:T});N=x.project(J,A,N);J=L(A);null==N||null!=J&&N.width>=J?(A=w.getMetersPerUnitForSR(T)/w.getMetersPerUnitForSR(A),g={x:g.x*A,y:g.y*A}):g={x:N.width,y:N.height};return g}function e(g,A=.01){return w.getMetersPerUnitForSR(g)?
A/w.getMetersPerUnitForSR(g):0}function d(g,A,J=null,N=!0){const T=g.spatialReference;if(T.equals(A))return g;P(T,A,J);J=x.project(g,A,J);if(!N||!J)return J;p([g],[J],T,A);return J}function p(g,A,J,N){const T=M(J,!0),O=M(N,!0);J=e(J,500);N=e(N,500);if(J&&null!=T&&null!=O)for(let V=0;V<g.length;V++){const W=A[V];if(!W)continue;const {x:Q}=g[V],{x:ba}=W;ba>=O[1]-N&&Math.abs(Q-T[0])<J?W.x-=O[1]-O[0]:ba<=O[0]+N&&Math.abs(Q-T[1])<J&&(W.x+=O[1]-O[0])}}function n(g){const {inSR:A,outSR:J,datumTransformation:N,
preferPE:T}=g;if(A.equals(J))return{points:g}=l(g,null),g;if(A.isWebMercator&&J.isWGS84||A.isWGS84&&J.isWebMercator){const {cols:Q,rows:ba,xres:Z,yres:ea,usePixelCenter:da,inSR:ca,outSR:fa}=g;let {xmin:ia,ymax:ja}=g;da&&(ia+=Z/2,ja-=ea/2);g=[];const ha=[];var O=Math.max(Q,ba);for(var V=0;V<O;V++){var W=x.project(new C({x:ia+Z*Math.min(Q,V),y:ja-ea*Math.min(ba,V),spatialReference:ca}),fa);V<=Q&&g.push(W.x);V<=ba&&ha.push(W.y)}O=[];for(V=0;V<Q;V++)for(W=0;W<ba;W++)O.push([g[V],ha[W]]);return O}return P(A,
J,N)&&T&&(A.isGeographic||null!=c(A))?a(g):D(g)}function D(g){var {points:A}=l(g,null);const {inSR:J,outSR:N,datumTransformation:T}=g;g=A.map(O=>new C(O[0],O[1],J));A=x.project(g,N,T);T&&p(g,A,J,N);return A.map(O=>O?[O.x,O.y]:[NaN,NaN])}function a(g){const {inSR:A,outSR:J,datumTransformation:N}=g;var T=c(A);const {points:O,mask:V}=l(g,T);A.isGeographic||(g=A.wkid?z.PeFactory.coordsys(A.wkid):z.PeFactory.fromString(A.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,A.wkt),z.PeCSTransformations.projToGeog(g,
O.length,O));if(null!=N&&N.steps.length){var W;J.isGeographic&&(W=O.map(([Q])=>179.9955<Q?1:-179.9955>Q?-1:0));N.steps.forEach(Q=>{const ba=Q.wkid?z.PeFactory.geogtran(Q.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_GEOGTRAN,Q.wkt);z.PeGTTransformations.geogToGeog(ba,O.length,O,null,Q.isInverse?z.PeDefs.PE_TRANSFORM_2_TO_1:z.PeDefs.PE_TRANSFORM_1_TO_2)});if(W)for(g=0;g<O.length;g++){T=W[g];const Q=O[g][0],ba=179.9955<Q?1:-179.9955>Q?-1:0;T&&ba&&T!==ba&&(O[g][0]=0<T?Q+360:Q-360)}}J.isGeographic||(W=
c(J,!0),b(O,null!=W&&W.isEnvelope?[W.bbox[1],W.bbox[3]]:[-90,90]),W=J.wkid?z.PeFactory.coordsys(J.wkid):z.PeFactory.fromString(J.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,J.wkt),z.PeCSTransformations.geogToProj(W,O.length,O));W=O;if(V&&O.length!==V.length){W=[];for(let Q=0,ba=0;Q<V.length;Q++)V[Q]?W.push(O[ba++]):W.push([NaN,NaN])}return W}function c(g,A=!1){var J=g.wkid||g.wkt;if(!J||g.isGeographic)return null;J=String(J);if(X.has(J))return J=X.get(J),A?J?.gcs:J?.pcs;var N=g.wkid?
z.PeFactory.coordsys(g.wkid):z.PeFactory.fromString(g.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,g.wkt);g=e(g,1E-4);g=f(N,g);N=f(N,0,!0);X.set(J,{pcs:g,gcs:N});return A?N:g}function f(g,A=0,J=!1){var N=z.PePCSInfo.generate(g),T=J?g.horizonGcsGenerate():g.horizonPcsGenerate();if(!N||!T?.length)return null;g=!1;var O=T.find(Z=>1===Z.getInclusive()&&1===Z.getKind());if(!O){O=T.find(Z=>1===Z.getInclusive()&&0===Z.getKind());if(!O)return null;g=!0}J=J?0:(2===N.getNorthPoleLocation()?
1:0)|(2===N.getSouthPoleLocation()?2:0);N=N.isPannableRectangle();O=O.getCoord();if(g)return{isEnvelope:g,isPannable:N,vertices:O,coef:null,bbox:[O[0][0]-A,O[0][1]-A,O[1][0]+A,O[1][1]+A],poleLocation:J};A=0;g=[];let [V,W]=O[0],[Q,ba]=O[0];for(let Z=0,ea=O.length;Z<ea;Z++){A++;A===ea&&(A=0);const [da,ca]=O[Z],[fa,ia]=O[A];if(ia===ca)g.push([da,fa,ca,ia,2]);else{T=(fa-da)/(ia-ca||1E-4);const ja=da-T*ca;ca<ia?g.push([T,ja,ca,ia,0]):g.push([T,ja,ia,ca,1])}V=V<da?V:da;W=W<ca?W:ca;Q=Q>da?Q:da;ba=ba>ca?
ba:ca}return{isEnvelope:!1,isPannable:N,vertices:O,coef:g,bbox:[V,W,Q,ba],poleLocation:J}}function l(g,A){const J=[],{cols:N,rows:T,xres:O,yres:V,usePixelCenter:W}=g;let {xmin:Q,ymax:ba}=g;W&&(Q+=O/2,ba-=V/2);if(null==A){for(g=0;g<N;g++)for(A=0;A<T;A++)J.push([Q+O*g,ba-V*A]);return{points:J}}g=new Uint8Array(N*T);if(A.isEnvelope){const {bbox:[ja,ha,ma,na]}=A;for(let oa=0,la=0;oa<N;oa++){var Z=Q+O*oa,ea=A.isPannable||Z>=ja&&Z<=ma;for(var da=0;da<T;da++,la++){var ca=ba-V*da;ea&&ca>=ha&&ca<=na&&(J.push([Z,
ca]),g[la]=1)}}return{points:J,mask:g}}Z=A.coef;A=[];for(ea=0;ea<T;ea++){var fa=ba-V*ea;da=[];ca=[];for(var ia=0;ia<Z.length;ia++){const [ja,ha,ma,na,oa]=Z[ia];fa===ma&&ma===na?(da.push(ja),da.push(ha),ca.push(2),ca.push(2)):fa>=ma&&fa<=na&&(da.push(ja*fa+ha),ca.push(oa))}fa=da;if(2<da.length){ia=2===ca[0]?0:ca[0];let ja=da[0];fa=[];for(let ha=1;ha<ca.length;ha++)if(2!==ca[ha]||ha===ca.length-1)ca[ha]!==ia&&(fa.push(0===ia?Math.min(ja,da[ha-1]):Math.max(ja,da[ha-1])),ia=ca[ha],ja=da[ha]),ha===ca.length-
1&&fa.push(0===ca[ha]?Math.min(ja,da[ha]):Math.max(ja,da[ha]));fa.sort((ha,ma)=>ha-ma)}else da[0]>da[1]&&(fa=[da[1],da[0]]);A.push(fa)}for(let ja=0,ha=0;ja<N;ja++)for(Z=Q+O*ja,ea=0;ea<T;ea++,ha++)if(da=ba-V*ea,ca=A[ea],2===ca.length)Z>=ca[0]&&Z<=ca[1]&&(J.push([Z,da]),g[ha]=1);else if(2<ca.length){fa=!1;for(ia=0;ia<ca.length;ia+=2)if(Z>=ca[ia]&&Z<=ca[ia+1]){fa=!0;break}fa&&(J.push([Z,da]),g[ha]=1)}return{points:J,mask:g}}function b(g,A){const [J,N]=A;for(A=0;A<g.length;A++){const T=g[A][1];if(T<J||
T>N)g[A]=[NaN,NaN]}}function k(g){const A=L(g[0].spatialReference);if(2>g.length||null==A)return g[0];const J=e(g[0].spatialReference);g=g.filter(W=>W.width>J);if(1===g.length)return g[0];let {xmin:N,xmax:T,ymin:O,ymax:V}=g[0];for(let W=1;W<g.length;W++){const Q=g[W];T=Q.xmax+A*W;O=Math.min(O,Q.ymin);V=Math.max(V,Q.ymax)}return new y({xmin:N,xmax:T,ymin:O,ymax:V,spatialReference:g[0].spatialReference})}function m(g,A,J=null,N=!0){var T=g.spatialReference;if(T.equals(A))return g;var O=I(g);const V=
L(T,!0);var W=L(A);if(0===O||null==V||null==W)return O=G(g,A,J,N),null==V&&null!=W&&Math.abs(O.width-W)<e(A)&&x.isLoaded()&&(T=c(T),null!=T&&T.poleLocation===U.None&&g.width<(T.bbox[2]-T.bbox[0])/2)?q(g,A)||O:O;W=g.clone().normalize();if(1===W.length&&g.xmax<V&&g.xmax-V/2>e(T)){const {xmin:Q,xmax:ba}=g;for(let Z=0;Z<=O;Z++)W[Z]=new y({xmin:0===Z?Q:-V/2,xmax:Z===O?ba-V*Z:V/2,ymin:g.ymin,ymax:g.ymax,spatialReference:T})}g=W.map(Q=>G(Q,A,J,N));return k(g.filter(B.isSome))}function q(g,A){const J=L(A);
if(null==J)return null;let {xmin:N,ymin:T,xmax:O,ymax:V}=g;var W=g.spatialReference;g=new E({spatialReference:W,rings:[[[N,T],[O,T],[O,V],[N,V],[N,T]]]});g=x.project(g,A);if(2!==g.rings.length||!g.rings[0].length||!g.rings[1].length)return null;({rings:g}=g);W=e(W);A=new y({spatialReference:A});for(let Q=0;2>Q;Q++){N=O=g[Q][0][0];T=V=g[Q][0][1];for(let ba=0;ba<g[Q].length;ba++)N=N>g[Q][ba][0]?g[Q][ba][0]:N,O=O<g[Q][ba][0]?g[Q][ba][0]:O,T=T>g[Q][ba][1]?g[Q][ba][1]:T,V=V<g[Q][ba][1]?g[Q][ba][1]:V;if(0===
Q)A.ymin=T,A.ymax=V,A.xmin=N,A.xmax=O;else if(A.ymin=Math.min(A.ymin,T),A.ymax=Math.max(A.ymax,V),Math.abs(O-J/2)<W)A.xmin=N,A.xmax+=J;else if(Math.abs(N+J/2)<W)A.xmax=O+J;else return null}return A}function G(g,A,J=null,N=!0,T=!0){const O=g.spatialReference;if(O.equals(A)||!A)return g;P(O,A,J);const V=x.project(g,A,J);if(T&&A.isWebMercator&&V&&(V.ymax=Math.min(2.0037508342787E7,V.ymax),V.ymin=Math.max(-2.0037508342787E7,V.ymin),V.ymin>=V.ymax))return null;if(!N||!V)return V;var W=M(O,!0);N=M(A,!0);
if(null==W||null==N)return V;T=e(O,.001);const Q=e(O,500);var ba=e(A,.001);if(Math.abs(V.xmin-N[0])<ba&&Math.abs(V.xmax-N[1])<ba){ba=Math.abs(g.xmin-W[0]);W=Math.abs(W[1]-g.xmax);if(ba<T&&W>Q){V.xmin=N[0];var Z=[];Z.push(new C(g.xmax,g.ymin,O));Z.push(new C(g.xmax,(g.ymin+g.ymax)/2,O));Z.push(new C(g.xmax,g.ymax,O));Z=Z.map(ea=>d(ea,A,J)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x);V.xmax=Math.max.apply(null,Z)}W<T&&ba>Q&&(V.xmax=N[1],N=[],N.push(new C(g.xmin,g.ymin,O)),N.push(new C(g.xmin,(g.ymin+g.ymax)/
2,O)),N.push(new C(g.xmin,g.ymax,O)),g=N.map(ea=>d(ea,A,J)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x),V.xmin=Math.min.apply(null,g))}else g=e(A,.001),Math.abs(V.xmin-N[0])<g&&(V.xmin=N[0]),Math.abs(V.xmax-N[1])<g&&(V.xmax=N[1]);return V}function L(g,A=!1){return g?g.isWebMercator?2*(A?2.0037508342787E7:2.0037508342788905E7):g.wkid&&g.isGeographic?360:2*Y[g.wkid]||null:null}function M(g,A=!1){if(g.isGeographic)return[-180,180];g=L(g,A);return null!=g?[-g/2,g/2]:null}function t(g,A,J,N){g=(g-A)/J;0!==
g-Math.floor(g)?g=Math.floor(g):N&&--g;return g}function I(g,A=!1){var J=L(g.spatialReference);if(null==J)return 0;const N=A?0:-(J/2),T=e(g.spatialReference),O=!A&&Math.abs(g.xmin+J/2)<T?-J/2:g.xmin;g=t(!A&&Math.abs(g.xmax-J/2)<T?J/2:g.xmax,N,J,!0);J=t(O,N,J,!1);return g-J}function K(g){const {projectedExtent:A,srcBufferExtent:J,pixelSize:N,datumTransformation:T,rasterTransform:O}=g;var V=A.spatialReference;const W=J.spatialReference;var Q=P(V,W);const {xmin:ba,ymin:Z,xmax:ea,ymax:da}=A,ca=L(W),fa=
null!=ca&&(g.hasWrapAround||"gcs-shift"===O?.type);g=g.spacing||[32,32];var ia=g[0]*N.x,ja=g[1]*N.y;const ha=1===g[0],ma=Math.ceil((ea-ba)/ia-.1/g[0])+(ha?0:1),na=Math.ceil((da-Z)/ja-.1/g[1])+(ha?0:1);ia=n({cols:ma,rows:na,xmin:ba,ymax:da,xres:ia,yres:ja,inSR:V,outSR:W,datumTransformation:T,preferPE:4>=g[0],usePixelCenter:ha});ja=[];let oa,la=0;const ra=ha?-1:NaN,{xmin:sa,xmax:ta,ymax:ua,width:va,height:wa}=J,xa=e(W,500),ya=null!=ca&&0<sa&&ta>ca/2;var pa=!1;Q&&(pa=c(V),pa=null!=pa&&0<pa.poleLocation);
for(V=0;V<ma;V++){Q=[];for(let qa=0;qa<na;qa++){var ka=ia[V*na+qa];fa&&ka[0]>ta&&ka[0]>ca/2-xa?ka[0]-=ca:fa&&0===V&&0>ka[0]&&ya&&!O&&(ka[0]+=ca);!ka||isNaN(ka[0])||isNaN(ka[1])?(ja.push(ra),ja.push(ra),Q.push(null),la++):(O&&(ka=O.inverseTransform(new C({x:ka[0],y:ka[1],spatialReference:W})),ka=[ka.x,ka.y]),Q.push(ka),0<V&&fa&&oa[qa]&&ka[0]<oa[qa][0]&&(ka[0]+=ca,pa&&ka[0]>ta&&ka[0]>ca&&(ka[0]-=ca)),ja.push((ka[0]-sa)/va),ja.push((ua-ka[1])/wa))}oa=Q}return{offsets:ja,error:null,coefficients:null,
outofBoundPointCount:la,spacing:g,size:ha?[ma,na]:[ma-1,na-1]}}function R(g,A,J){const {cols:N,rows:T}=A;A=new Float32Array((N-1)*(T-1)*12);const O=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),V=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let da=0;da<N-1;da++){for(var W=0;W<T-1;W++){var Q=da*T*2+2*W,ba=g[Q];const ca=g[Q+1];var Z=g[Q+2],ea=g[Q+3];Q+=2*T;const fa=g[Q],ia=g[Q+1],ja=g[Q+2];Q=g[Q+3];let ha=0,ma=12*(W*(N-1)+da);for(let na=0;3>na;na++)A[ma++]=O[ha++]*ba+O[ha++]*Z+O[ha++]*ja;ha=0;for(Z=0;3>
Z;Z++)A[ma++]=O[ha++]*ca+O[ha++]*ea+O[ha++]*Q;ha=0;for(ea=0;3>ea;ea++)A[ma++]=V[ha++]*ba+V[ha++]*fa+V[ha++]*ja;ha=0;for(ba=0;3>ba;ba++)A[ma++]=V[ha++]*ca+V[ha++]*ia+V[ha++]*Q}if(J)for(W=0;W<A.length;W++)isNaN(A[W])&&(A[W]=-1)}return A}var U;(function(g){g[g.None=0]="None";g[g.North=1]="North";g[g.South=2]="South";g[g.Both=3]="Both"})(U||(U={}));const S=(g,A,J,N=0)=>{if(1===J[0])return[0,0];var T=1,O=-1,V=1,W=-1;for(var Q=0;Q<g.length;Q+=2)isNaN(g[Q])||(T=T>g[Q]?g[Q]:T,O=O>g[Q]?O:g[Q],V=V>g[Q+1]?g[Q+
1]:V,W=W>g[Q+1]?W:g[Q+1]);const {cols:ba,rows:Z}=A;A=(O-T)/ba/J[0];J=(W-V)/Z/J[1];N*=2;V=0;W=!1;T=[0,0];for(O=0;O<ba-3;O++){for(Q=0;Q<Z-3;Q++){var ea=O*Z*2+2*Q;const da=Math.abs(((g[ea]+g[ea+4]+g[ea+4*Z]+g[ea+4*Z+4])/4-g[ea+2*Z+2])/A);ea=Math.abs(((g[ea+1]+g[ea+5]+g[ea+4*Z+1]+g[ea+4*Z+5])/4-g[ea+2*Z+3])/J);da+ea>V&&(V=da+ea,T=[da,ea]);if(N&&V>N){W=!0;break}}if(W)break}return T},Y={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,
4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,
54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},X=new Map,aa=new Map;r.computeProjectedScales=function(g,A,J){var N=J?.tileSize??512,T=J?.alignGlobalDatasetWithAGOL??!0,O=!!J?.limitToSrcResolution;const {extent:V,spatialReference:W,pixelSize:Q}=g;J=u(new C({x:Q.x,y:Q.y,spatialReference:W}),A,V);if(null==J)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ba=(J.x+J.y)/2,Z=w.getMetersPerUnitForSR(A);
var ea=ba*Z*96*39.37,da=A.isGeographic?256/N*2.958287637958547E8:256/N*5.91657527591555E8,ca="vector-magdir"===g.dataType||"vector-uv"===g.dataType,fa=m(V,A),ia=Math.min(Math.ceil(Math.log(Math.min(g.width,g.height)/32)/Math.LN2),Math.ceil(Math.log(da/2/ea)/Math.LN2));!ca&&T&&(A.isGeographic||A.isWebMercator)&&(ca=0>fa.xmin*fa.xmax,!ca&&3>ia&&(T=L(A),null!=T&&(ca=2**ia*ba*N,N=Math.ceil(T/ca),ca=1===N||2===N&&T/2-fa.xmax<ca)));N=ea;g=Math.min(2,Math.max(1.414,g.storageInfo?.pyramidScalingFactor||2));
if(ca)N=da,da=A.isGeographic?1.341104507446289E-6:.29858214164761665,ia=96*da*Z*39.37,A=u(new C({x:da,y:da,spatialReference:{wkid:A.isGeographic?4326:3857}}),W,fa),A.x*=N/ia,A.y*=N/ia;else{A={x:Q.x,y:Q.y};for(fa=0;N<.5005*da&&fa<ia;)fa++,N*=g,A.x*=g,A.y*=g;1.001>=Math.max(N,da)/Math.min(N,da)&&(N=da)}da=[N];fa=[{x:A.x,y:A.y}];for(ea=Math.min(70.5310735,ea)/1.001;N>=ea;)N/=g,A.x/=g,A.y/=g,da.push(N),fa.push({x:A.x,y:A.y});if(O){const ja=.001*Q.x;O=fa.findIndex(ha=>ha.x>=Q.x-ja&&ha.x<=Q.x+ja);-1<O?
(fa.length=O+1,da.length=O+1):(O=fa.findIndex(ha=>ha.x<=Q.x+ja),0<O&&(fa.length=O,da.length=O))}return{projectedPixelSize:J,scales:da,srcResolutions:fa,isCustomTilingScheme:!ca}};r.defaultGridSpacing=32;r.defaultProjectionToleranceInPixels=4;r.getDefaultDatumTransformationForDataset=function(g,A,J){P(g.spatialReference,A);return J?x.getTransformation(A,g.spatialReference,g):x.getTransformation(g.spatialReference,A,g)};r.getProjectedGridPoints=n;r.getProjectionOffsetGrid=function(g){var A=g.isAdaptive&&
null==g.spacing;let J=g.spacing||[32,32],N=K(g);var T={cols:N.size[0]+1,rows:N.size[1]+1};const O=0<N.outofBoundPointCount&&N.outofBoundPointCount<N.offsets.length/2;let V=N.outofBoundPointCount===N.offsets.length/2||A&&O?[0,0]:S(N.offsets,T,J,4);const W=(V[0]+V[1])/2;var Q=g.projectedExtent.spatialReference;const ba=g.srcBufferExtent.spatialReference;A&&(O||4<W)&&(F(Q,ba,g.datumTransformation)&&(Q.isGeographic||null!=c(Q)),J=[4,4],N=K({...g,spacing:J}),T={cols:N.size[0]+1,rows:N.size[1]+1},V=S(N.offsets,
T,J,4));N.error=V;1<J[0]&&(N.coefficients=R(N.offsets,T,O));!g.includeGCSGrid||Q.isGeographic||Q.isWebMercator||(ba.isGeographic?N.gcsGrid={offsets:N.offsets,coefficients:N.coefficients,spacing:J}:(A=c(Q),null==A||A.isEnvelope||(Q&&!Q.isGeographic&&(A=String(Q.wkid||Q.wkt),aa.has(A)?Q=aa.get(A):(Q=(Q.wkid?z.PeFactory.coordsys(Q.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_PROJCS,Q.wkt)).getGeogcs().getCode(),aa.set(A,Q)),Q=new v({wkid:Q})),Q=m(g.projectedExtent,Q),{offsets:g}=K({...g,srcBufferExtent:Q,
spacing:J}),T=R(g,T,O),N.gcsGrid={offsets:g,coefficients:T,spacing:J})));return N};r.getRasterDatasetAlignmentInfo=function(g){const A=g.storageInfo.origin.x;var J=L(g.spatialReference,!0);if(null==J)return{originX:A,halfWorldWidth:null,pyramidsInfo:null};const N=J/2,{nativePixelSize:T,storageInfo:O,extent:V}=g,{maximumPyramidLevel:W,blockWidth:Q,pyramidScalingFactor:ba}=O;let Z=T.x;const ea=[];g=null!=g.transform&&"gcs-shift"===g.transform.type;const da=A+(g?0:N);J=g?J-A:N-A;for(let ca=0;ca<=W;ca++){const fa=
(V.xmax-A)/Z/Q,ia=J/Z/Q;ea.push({resolutionX:Z,blockWidth:Q,datsetColumnCount:0===fa-Math.floor(fa)?fa:Math.ceil(fa),worldColumnCountFromOrigin:0===ia-Math.floor(ia)?ia:Math.ceil(ia),leftMargin:Math.round(da/Z)%Q,rightPadding:(Q-Math.round(J/Z)%Q)%Q,originColumnOffset:Math.floor(da/Z/Q)});Z*=ba}return{originX:A,halfWorldWidth:N,pyramidsInfo:ea,hasGCSSShiftTransform:g}};r.getWorldWidth=L;r.getWorldWrapCount=I;r.load=async function(){x.isLoaded()||await x.load()};r.minimumGridSpacing=4;r.projectExtent=
m;r.projectPoint=d;r.projectPolygon=function(g,A,J){if("extent"===g.type){const {xmin:N,ymin:T,xmax:O,ymax:V,spatialReference:W}=g;g=new E({rings:[[[N,V],[O,V],[O,T],[N,T],[N,V]]],spatialReference:W})}if(g.spatialReference.equals(A))return g;P(g.spatialReference,A,J);return x.project(g,A,J)};r.projectResolution=u;r.requirePE=F;r.snapExtent=function(g){g=g.clone().normalize();return 1===g.length?g[0]:k(g)};r.snapPyramid=function(g,A,J){const {storageInfo:N,pixelSize:T}=A;var O=0;let V=!1;var {pyramidResolutions:W}=
N,Q="mixed"===N.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,N.tileInfo.dpi/96)):1;Q=(g.x+g.y)/2/Q;if(null!=W&&W.length){g=W[W.length-1];g=(g.x+g.y)/2;var ba=(T.x+T.y)/2;if(Q<=ba)O=0;else if(Q>=g)O=W.length,V=8<Q/g;else{g=ba;for(let Z=1;Z<=W.length;Z++){ba=(W[Z-1].x+W[Z-1].y)/2;if(Q<=ba){Q===ba?O=Z:"down"===J?(O=Z-1,V=8<Q/g):O="up"===J?Z:Q-g>ba-Q||2<Q/g?Z:Z-1;break}g=ba}}J=0===O?T:W[O-1];V&&(W=Math.min(J.x,J.y),Q=w.getMetersPerUnitForSR(A.spatialReference),19567<W*Q&&(V=!1));return{pyramidLevel:O,
pyramidResolution:new C({x:J.x,y:J.y,spatialReference:A.spatialReference}),excessiveReading:V}}O=Math.log(g.x/T.x)/Math.LN2;Q=Math.log(g.y/T.y)/Math.LN2;W=A.storageInfo.maximumPyramidLevel||0;O="down"===J?Math.floor(Math.min(O,Q)):"up"===J?Math.ceil(Math.max(O,Q)):Math.round((O+Q)/2);0>O?O=0:O>W&&(V=O>W+3,O=W);J=2**O;A=new C({x:J*A.nativePixelSize.x,y:J*A.nativePixelSize.y,spatialReference:A.spatialReference});return{pyramidLevel:O,pyramidResolution:A,excessiveReading:V}};Object.defineProperty(r,
Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rasterRendererChecks":function(){define(["exports"],function(r){function H(B){return["u8","s8"].includes(B.pixelType)&&null!=B.statistics?.[0]?.min&&null!=B.statistics[0]?.max&&1===B.bandCount}r.isClassBreaksSupported=function(B,h=!1){const {attributeTable:w,bandCount:z}=B;return 1===z&&(!h||null!=w||null!=B.histograms)};r.isColormapRendererSupported=function(B,h=!1){const {bandCount:w,colormap:z,pixelType:x}=B;return 1===w&&(!!z?.length||
!h&&"u8"===x)};r.isFlowRendererSupported=function(B){({dataType:B}=B);return"vector-uv"===B||"vector-magdir"===B};r.isShadedReliefRendererSupported=function(B){const {bandCount:h,dataType:w,pixelType:z}=B;return"elevation"===w||"generic"===w&&1===h&&("s16"===z||"s32"===z||"f32"===z||"f64"===z)};r.isSingleBand8BitRasterWithStats=H;r.isUVRendererSupported=function(B,h){const {attributeTable:w,bandCount:z}=B;return null==w&&H(B)?!0:null==w||1<z||h&&null==w.fields.find(x=>x.name.toLowerCase()===h.toLowerCase())?
!1:!0};r.isVectorFieldRendererSupported=function(B){({dataType:B}=B);return"vector-uv"===B||"vector-magdir"===B};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v){w=function(F){function P(){var e=F.apply(this,arguments)||this;e._handle=null;e.type="rasterVF";return e}r._inherits(P,F);var u=P.prototype;u.canUseWebGLForProcessing=function(){return!1};u.fetchTile=async function(e,d){d={...d,interpolation:"nearest",requestProjectedLocalDirections:!0};e=await this.layer.fetchTile(e.level,e.row,e.col,d);"vector-magdir"===this.layer.rasterInfo.dataType&&e?.pixelBlock&&(e.pixelBlock=await this.layer.convertVectorFieldData(e.pixelBlock,
d));return e};u.updateTileSource=function(e,d){const p=d.symbolizerParams,{tileData:n}=e;n.key=e.key;n.width=this._tileInfoView.tileInfo.size[0];n.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:e}=p);({source:d}=d);n.offset=this._getTileSymbolOffset(n.key,e);null!=d&&null!=d.pixelBlock?(n.rawPixelData={extent:d.extent,pixelBlock:d.pixelBlock},n.symbolizerParameters=p,n.source=this._sampleVectorFieldData(d.pixelBlock,p,n.offset)):(d=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo.size[0]-
n.offset[0])/e),Math.round((this._tileInfoView.tileInfo.size[1]-n.offset[1])/e)]),n.source=d,n.symbolizerParameters=p);n.invalidateVAO();return Promise.resolve()};u.updateTileSymbolizerParameters=function(e,d){var p=d.local;({symbolTileSize:d}=p);({tileData:e}=e);e.offset=this._getTileSymbolOffset(e.key,d);const n=e.symbolizerParameters.symbolTileSize;e.symbolizerParameters=p;p=e.rawPixelData?.pixelBlock;null!=p&&n!==d&&(e.source=this._sampleVectorFieldData(p,e.symbolizerParameters,e.offset));return Promise.resolve()};
u.attach=function(){r._get(r._getPrototypeOf(P.prototype),"attach",this).call(this);this.container=new E.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=B.watch(()=>this.layer.renderer,e=>this._updateSymbolType(e))};u.detach=function(){r._get(r._getPrototypeOf(P.prototype),"detach",this).call(this);this.container.removeAllChildren();this._handle?.remove();this.container=this._handle=null};
u._getTileSymbolOffset=function(e,d){const p=e.col*this._tileInfoView.tileInfo.size[0]%d;e=e.row*this._tileInfoView.tileInfo.size[1]%d;return[p>d/2?d-p:-p,e>d/2?d-e:-e]};u._sampleVectorFieldData=function(e,d,p){({symbolTileSize:d}=d);return C.sampleVectorField(e,"vector-uv",d,p)};u._updateSymbolType=function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])};return r._createClass(P)}(v.BaseImageryTileSubView2D);
H.__decorate([h.property()],w.prototype,"container",void 0);H.__decorate([h.property()],w.prototype,"layer",void 0);H.__decorate([h.property()],w.prototype,"type",void 0);return w=H.__decorate([y.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],w)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(r,H,B,h){function w(b,k){return d.get(b)/d.get(k)||1}function z(b,k="geographic"){const [m,
q]=b;b=Math.sqrt(m*m+q*q);let G=Math.atan2(q,m)*p;G=(360+G)%360;"geographic"===k&&(G=(450-G)%360);return[b,G]}function x(b,k="geographic"){let m=b[1];"geographic"===k&&(m=(450-m)%360);m%=360;b=b[0];return[b*Math.cos(m/p),b*Math.sin(m/p)]}function y(b,k,m="geographic",q=1){if(!h.isValidPixelBlock(b))return b;const {pixels:G,width:L,height:M}=b;var t=L*M;const I=G[0],K=G[1],R=b.pixelType.startsWith("f")?b.pixelType:"f32",U=B.createEmptyBand(R,t);t=B.createEmptyBand(R,t);let S=0;for(let Y=0;Y<M;Y++)for(let X=
0;X<L;X++)"vector-uv"===k?([U[S],t[S]]=z([I[S],K[S]],m),U[S]*=q):([U[S],t[S]]=x([I[S],K[S]],m),U[S]*=q,t[S]*=q),S++;b=new B({pixelType:R,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[U,t]});b.updateStatistics();return b}function C(b=0,k=0,m=Math.PI,q=!0){q&&(m=(2*Math.PI-m)%(2*Math.PI));q=q?-1:1;const G=-7*q,L=-2*q,M=-16*q,[t,I]=v(0,k+13*q,m,21.75),[K,R]=v(b-5.5,k+G,m,21.75),[U,S]=v(b+5.5,k+G,m,21.75),[Y,X]=v(b-1.5,k+L,m,21.75),[aa,g]=
v(b+1.5,k+L,m,21.75),[A,J]=v(b-1.5,k+M,m,21.75),[N,T]=v(b+1.5,k+M,m,21.75);return[t,I,K,R,Y,X,aa,g,U,S,A,J,N,T]}function E(b=0,k=Math.PI,m=!0){m&&(k=(2*Math.PI-k)%(2*Math.PI));var q=m?-1:1,G=5*q;const L=20*q,M=25*q;q*=2;const t=m?1:-1;m=5*t;let [I,K]=[0+m,0-L],[R,U]=[I+2*t,K],[S,Y]=[R-0*t,U+q],[X,aa]=[0-m,0-M],[g,A]=[X+0*t,aa-q],J=Math.ceil(b/5),N=Math.floor(J/10);J-=8*N;b=[];const T=[];for(let ca=0;ca<J/2;ca++,N--){0>=N&&1===J%2&&ca===(J-1)/2&&(X=0,g=X+0*t,aa=(aa+K)/2,A=aa-q);const [fa,ia]=v(X,aa,
k,45);if(0<N){const [ja,ha]=v(R,aa,k,45),[ma,na]=v(I,K,k,45);b.push(ja);b.push(ha);b.push(fa);b.push(ia);b.push(ma);b.push(na)}else{const [ja,ha]=v(R,U,k,45),[ma,na]=v(S,Y,k,45),[oa,la]=v(g,A,k,45);T.push(fa);T.push(ia);T.push(oa);T.push(la);T.push(ma);T.push(na);T.push(ja);T.push(ha)}aa+=G;K+=G;U+=G;Y+=G;A+=G}const [O,V]=v(0+m,0+L,k,45);G=7*t;const [W,Q]=v(0+G,0+L,k,45),[ba,Z]=v(0+m,0-M,k,45),[ea,da]=v(0+G,0-M,k,45);return{pennants:b,barbs:T,shaft:[O,V,W,Q,ba,Z,ea,da]}}function v(b,k,m,q=1){return[Math.sqrt(b*
b+k*k)/q,(2*Math.PI+(2*Math.PI+Math.atan2(k,b))%(2*Math.PI)-m)%(2*Math.PI)]}function F(b,k,m,q){m=w(q||"knots",m);for(q=1;q<k.length;q++)if(q===k.length-1){if(b<k[q]*m)break}else if(b<=k[q]*m)break;return Math.min(q-1,k.length-2)}function P(b,k,m,q,G){let L=0;switch(k){case "beaufort_kn":L=F(b,a,"knots",m);break;case "beaufort_km":L=F(b,a,"kilometer-per-hour",m);break;case "beaufort_ft":L=F(b,a,"feet-per-second",m);break;case "beaufort_m":L=F(b,a,"meter-per-second",m);break;case "classified_arrow":L=
F(b,G??[],q,m);break;case "ocean_current_m":L=F(b,c,"meter-per-second",m);break;case "ocean_current_kn":L=F(b,f,"knots",m)}return L}function u(b,k){const {style:m,inputUnit:q,outputUnit:G,breakValues:L}=k,M=n.fromJSON(q),t=n.fromJSON(G);let I=0,K=0;const {width:R,height:U,mask:S}=b,Y=b.pixels[0];b=b.pixels[1];var X=null!=S?S.filter(A=>0<A).length:R*U;const aa=new Float32Array(42*X);X=new Uint32Array(15*X);k=k.invertDirection?C(0,0,0,!1):D;for(let A=0;A<U;A++)for(let J=0;J<R;J++){var g=A*R+J;if(!S||
S[A*R+J]){const N=(b[g]+360)%360/180*Math.PI,T=P(Y[g],m,M,t,L);for(let O=0;O<k.length;O+=2)aa[I++]=(J+.5)/R,aa[I++]=(A+.5)/U,aa[I++]=k[O],aa[I++]=k[O+1]+N,aa[I++]=T,aa[I++]=Y[g];g=7*(I/42-1);X[K++]=g;X[K++]=g+1;X[K++]=g+2;X[K++]=g+0;X[K++]=g+4;X[K++]=g+3;X[K++]=g+0;X[K++]=g+2;X[K++]=g+3;X[K++]=g+2;X[K++]=g+5;X[K++]=g+3;X[K++]=g+5;X[K++]=g+6;X[K++]=g+3}}return{vertexData:aa,indexData:X}}function e(b,k){let m=0,q=0;const {width:G,height:L,mask:M}=b;b=b.pixels[0];const t=[],I=[];var K=n.fromJSON(k.inputUnit);
K=w(K,"knots");k="wind_speed"===k.style?5:Number.MAX_VALUE;for(let U=0;U<L;U++)for(let S=0;S<G;S++){var R=b[U*G+S]*K;if((!M||M[U*G+S])&&R<k){for(let Y=0;4>Y;Y++)t[m++]=(S+.5)/G,t[m++]=(U+.5)/L,t[m++]=2>Y?-.5:.5,t[m++]=0===Y%2?-.5:.5,t[m++]=0,t[m++]=R;R=4*(m/24-1);I[q++]=R;I[q++]=R+1;I[q++]=R+2;I[q++]=R+1;I[q++]=R+2;I[q++]=R+3}}return{vertexData:new Float32Array(t),indexData:new Uint32Array(I)}}const d=new Map;d.set("meter-per-second",1);d.set("kilometer-per-hour",.277778);d.set("knots",.514444);d.set("feet-per-second",
.3048);d.set("mile-per-hour",.44704);const p=180/Math.PI,n=new H.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),D=C(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],c=[0,.5,1,1.5,2],f=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],l=[];r.convertToLocalDirections=function(b,k,m,q="geographic"){if(!h.isValidPixelBlock(b)||null==m)return b;b="vector-magdir"===k?b.clone():y(b,k);const G=b.pixels[1];
for(let L=0;L<G.length;L++)G[L]="geographic"===q?(G[L]+m[L]+270)%360:(G[L]+360-m[L])%360;return"vector-magdir"===k?b:y(b,"vector-magdir")};r.convertVectorFieldData=y;r.convertVectorFieldUnit=function(b,k,m=1){if(1===m||!h.isValidPixelBlock(b))return b;b=b.clone();const {pixels:q,width:G,height:L}=b,M=q[0],t=q[1];let I=0;for(let K=0;K<L;K++)for(let R=0;R<G;R++)"vector-uv"===k?(M[I]*=m,t[I]*=m):M[I]*=m,I++;b.updateStatistics();return b};r.createVFMesh=function(b,k){if("simple_scalar"===k.style)k=e(b,
k);else if("wind_speed"===k.style){if(0===l.length)for(var m=0;30>m;m++)l.push(E(5*m,0,!k.invertDirection));k=n.fromJSON(k.inputUnit);k=w(k,"knots");const {width:M,height:t,mask:I}=b;m=b.pixels[0];b=b.pixels[1];const K=[],R=[];let U=0,S=0;for(let Y=0;Y<t;Y++)for(let X=0;X<M;X++){var q=Y*M+X,G=m[q]*k;if((!I||I[Y*M+X])&&5<=G){const aa=(b[q]+360)%360/180*Math.PI,{pennants:g,barbs:A,shaft:J}=l[Math.min(Math.floor(G/5),29)];if(0===g.length+A.length)continue;q=K.length/6;const N=(X+.5)/M,T=(Y+.5)/t;for(var L=
0;L<g.length;L+=2)K[U++]=N,K[U++]=T,K[U++]=g[L],K[U++]=g[L+1]+aa,K[U++]=0,K[U++]=G;for(L=0;L<A.length;L+=2)K[U++]=N,K[U++]=T,K[U++]=A[L],K[U++]=A[L+1]+aa,K[U++]=0,K[U++]=G;for(L=0;L<J.length;L+=2)K[U++]=N,K[U++]=T,K[U++]=J[L],K[U++]=J[L+1]+aa,K[U++]=0,K[U++]=G;for(G=0;G<g.length/6;G++)R[S++]=q,R[S++]=q+1,R[S++]=q+2,q+=3;for(G=0;G<A.length/8;G++)R[S++]=q,R[S++]=q+1,R[S++]=q+2,R[S++]=q+1,R[S++]=q+2,R[S++]=q+3,q+=4;R[S++]=q+0;R[S++]=q+1;R[S++]=q+2;R[S++]=q+1;R[S++]=q+3;R[S++]=q+2;q+=4}}k={vertexData:new Float32Array(K),
indexData:new Uint32Array(R)}}else k=u(b,k);return k};r.createVFMeshScalar=e;r.getUnitConversionFactor=w;r.sampleVectorField=function(b,k,m,q=[0,0],G=.5){const {width:L,height:M,mask:t}=b,[I,K]=b.pixels,[R,U]=q;b=Math.round((L-R)/m);q=Math.round((M-U)/m);var S=b*q;const Y=new Float32Array(S),X=new Float32Array(S);S=new Uint8Array(S);k="vector-uv"===k;for(let g=0;g<q;g++)for(let A=0;A<b;A++){let J=0;const N=g*b+A,T=Math.max(0,g*m+U),O=Math.max(0,A*m+R),V=Math.min(M,T+m),W=Math.min(L,O+m);for(let Q=
T;Q<V;Q++)for(let ba=O;ba<W;ba++){var aa=Q*L+ba;if(!t||t[aa]){J++;aa=k?[I[aa],K[aa]]:[I[aa],(360+K[aa])%360];const [Z,ea]=k?aa:x(aa);Y[N]+=Z;X[N]+=ea}}if(J>=(V-T)*(W-O)*(1-G)){S[N]=1;const [Q,ba]=z([Y[N]/J,X[N]/J]);Y[N]=Q;X[N]=ba}else S[N]=0,Y[N]=0,X[N]=0}m=new B({width:b,height:q,pixels:[Y,X],mask:S});m.updateStatistics();return m};r.snapImageToSymbolTile=function(b,k,m,q,G){if(null==G||!G.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(k/q),height:Math.round(m/q),resolution:b.width/
k};const L=G.xmin;G=G.ymax;k=(b.xmax-b.xmin)/k*q;m=(b.ymax-b.ymin)/m*q;b.xmin=L+Math.floor((b.xmin-L)/k)*k;b.xmax=L+Math.ceil((b.xmax-L)/k)*k;b.ymin=G+Math.floor((b.ymin-G)/m)*m;b.ymax=G+Math.ceil((b.ymax-G)/m)*m;return{extent:b,width:Math.round(b.width/k),height:Math.round(b.height/m),resolution:(k+m)/2}};r.unitKebabDict=n;r.uvComponentToVector=z;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock",
"../rasterFormats/pixelRangeUtils"],function(r,H,B){function h(a){return null!=a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function w(a,c,f,l,b){const k=a.length;b=H.createEmptyBand(b,k);if(c)for(let m=0;m<k;m++)c[m]&&(b[m]=f[a[m]-l]);else for(c=0;c<k;c++)b[c]=f[a[c]-l];return b}function z(a,c,f,l){const b=null!=f&&2<=f.length?new Set(f):null;f=1===f?.length?f[0]:null;const k=!!c?.length;for(let m=0;m<a.length;m++)if(l[m]){const q=a[m];if(k){let G=!1;for(let L=
0;L<c.length;L+=2)if(q>=c[L]&&q<=c[L+1]){G=!0;break}G||(l[m]=0)}l[m]&&(q===f||b?.has(q))&&(l[m]=0)}}function x(a,c){const f=a[0].length;for(let l=0;l<f;l++)if(c[l]){let b=!1;for(let k=0;k<a.length;k++)if(a[k][l]){b=!0;break}b||(c[l]=0)}}function y(a,c){const f=a[0].length;for(let l=0;l<f;l++)if(c[l]){let b=!1;for(let k=0;k<a.length;k++)if(0===a[k][l]){b=!0;break}b&&(c[l]=0)}}function C(a,c,f,l,b,k,m,q){return{xmin:b<=f*a?0:b<f*a+a?b-f*a:a,ymin:k<=l*c?0:k<l*c+c?k-l*c:c,xmax:b+m<=f*a?0:b+m<f*a+a?b+
m-f*a:a,ymax:k+q<=l*c?0:k+q<l*c+c?k+q-l*c:c}}function E(a,c,f,l,b,k){const {width:m,height:q}=f.block,{x:G,y:L}=f.offset,{width:M,height:t}=f.mosaic;f=C(m,q,l,b,G,L,M,t);let I=0;var K=0;if(k){var R=k.hasGCSSShiftTransform?360:k.halfWorldWidth??0,U=m*k.resolutionX;const S=k.startX+l*U;S<R&&S+U>R?K=k.rightPadding:S>=R&&(I=k.leftMargin-k.rightPadding,K=0)}f.xmax-=K;if("number"===typeof c)for(k=f.ymin;k<f.ymax;k++)for(K=(b*q+k-L)*M+(l*m-G)+I,R=f.xmin;R<f.xmax;R++)a[K+R]=c;else for(k=f.ymin;k<f.ymax;k++)for(K=
(b*q+k-L)*M+(l*m-G)+I,R=k*m,U=f.xmin;U<f.xmax;U++)a[K+U]=c[R+U]}function v(a,c,f={}){const {clipOffset:l,clipSize:b,alignmentInfo:k,blockWidths:m}=f;if(m)return F(a,c,{blockWidths:m});var q=a.find(aa=>h(aa));if(null==q)return null;f=b?b.width:c.width;const G=b?b.height:c.height;var L=q.width,M=q.height;const t=c.width/L,I=c.height/M;c={offset:l||{x:0,y:0},mosaic:b||c,block:{width:L,height:M}};L=q.pixelType;var K=H.getPixelArrayConstructor(L);q=q.pixels.length;M=[];for(var R=0;R<q;R++){var U=new K(f*
G);for(var S=0;S<I;S++)for(var Y=0;Y<t;Y++){var X=a[S*t+Y];h(X)&&(X=X.pixels[R],E(U,X,c,Y,S,k))}M.push(U)}K=a.some(aa=>null==aa||null!=aa.mask&&0<aa.mask.length);U=a.some(aa=>null!=aa&&aa.bandMasks&&1<aa.bandMasks.length);K=K?new Uint8Array(f*G):void 0;U=U?[]:void 0;if(K){for(R=0;R<I;R++)for(S=0;S<t;S++)Y=a[R*t+S],X=null!=Y?Y.mask:null,null!=X?E(K,X,c,S,R,k):Y?E(K,255,c,S,R,k):E(K,0,c,S,R,k);if(U)for(R=0;R<q;R++){S=new Uint8Array(f*G);for(Y=0;Y<I;Y++)for(X=0;X<t;X++){const aa=a[Y*t+X],g=aa?.bandMasks?.[R]??
aa?.mask;null!=g?E(S,g,c,X,Y,k):aa?E(S,255,c,X,Y,k):E(S,0,c,X,Y,k)}U.push(S)}}a=new H({width:f,height:G,pixels:M,pixelType:L,bandMasks:U,mask:K});a.updateStatistics();return a}function F(a,c,f){const l=a.find(S=>null!=S);if(null==l)return null;var b=a.some(S=>null!=S?!!S.mask:!0);const {width:k,height:m}=c;c=b?new Uint8Array(k*m):null;({blockWidths:f}=f);const q=[],G=l.getPlaneCount(),L=H.getPixelArrayConstructor(l.pixelType);if(b)for(let S=0,Y=0;S<a.length;Y+=f[S],S++)if(b=a[S],h(b)){var M=b.mask;
for(var t=0;t<m;t++)for(var I=0;I<f[S];I++)c[t*k+I+Y]=null==M?255:M[t*b.width+I]}M=(b=a.some(S=>null!=S&&S.bandMasks&&1<S.bandMasks.length))?[]:void 0;t=k*m;for(I=0;I<G;I++){const S=new L(t),Y=b?new Uint8Array(t):void 0;for(let X=0,aa=0;X<a.length;aa+=f[X],X++){const g=a[X];if(h(g)){var K=g.pixels[I];if(null!=K){for(var R=0;R<m;R++)for(var U=0;U<f[X];U++)S[R*k+U+aa]=K[R*g.width+U];if(Y)for(K=g.bandMasks?.[I]??g.mask,R=0;R<m;R++)for(U=0;U<f[X];U++)Y[R*k+U+aa]=K?K[R*g.width+U]:255}}}q.push(S);M&&Y&&
M.push(Y)}a=new H({width:k,height:m,mask:c,bandMasks:M,pixels:q,pixelType:l.pixelType});a.updateStatistics();return a}function P(a){if(!h(a))return null;const c=a.clone(),{width:f,height:l,pixels:b}=a;var k=b[0];const m=c.pixels[0];a=a.mask;for(let L=2;L<l-1;L++){const M=new Map;for(var q=L-2;q<L+2;q++)for(var G=0;4>G;G++){const t=q*f+G;d(M,k[t],a?a[t]:1)}m[L*f]=u(M);m[L*f+1]=m[L*f+2]=m[L*f];for(q=3;q<f-1;q++)G=(L-2)*f+q+1,d(M,k[G],a?a[G]:1),G=(L-1)*f+q+1,d(M,k[G],a?a[G]:1),G=L*f+q+1,d(M,k[G],a?a[G]:
1),G=(L+1)*f+q+1,d(M,k[G],a?a[G]:1),G=(L-2)*f+q-3,e(M,k[G],a?a[G]:1),G=(L-1)*f+q-3,e(M,k[G],a?a[G]:1),G=L*f+q-3,e(M,k[G],a?a[G]:1),G=(L+1)*f+q-3,e(M,k[G],a?a[G]:1),m[L*f+q]=u(M);m[L*f+q+1]=m[L*f+q]}for(k=0;k<f;k++)m[k]=m[f+k]=m[2*f+k],m[(l-1)*f+k]=m[(l-2)*f+k];c.updateStatistics();return c}function u(a){if(0===a.size)return 0;let c=0,f=-1,l=0;const b=a.keys();let k=b.next();for(;!k.done;)l=a.get(k.value),l>c&&(f=k.value,c=l),k=b.next();return f}function e(a,c,f){0!==f&&(f=a.get(c),1===f?a.delete(c):
a.set(c,f-1))}function d(a,c,f){0!==f&&a.set(c,a.has(c)?a.get(c)+1:1)}function p(a,c,f){let {x:l,y:b}=c;const {width:k,height:m}=f;if(0===l&&0===b&&m===a.height&&k===a.width)return a;const {width:q,height:G}=a;c=Math.max(0,b);const L=Math.max(0,l),M=Math.min(l+k,q),t=Math.min(b+m,G);if(0>M||0>t||!h(a))return null;l=Math.max(0,-l);b=Math.max(0,-b);var {pixels:I}=a,K=k*m,R=I.length;const U=[];for(var S=0;S<R;S++){var Y=I[S],X=H.createEmptyBand(a.pixelType,K);for(let aa=c;aa<t;aa++){const g=aa*q;let A=
(aa+b-c)*k+l;for(let J=L;J<M;J++)X[A++]=Y[g+J]}U.push(X)}I=new Uint8Array(K);K=a.mask;for(R=c;R<t;R++)for(S=R*q,Y=(R+b-c)*k+l,X=L;X<M;X++)I[Y++]=K?K[S+X]:1;a=new H({width:f.width,height:f.height,pixelType:a.pixelType,pixels:U,mask:I});a.updateStatistics();return a}function n(a,c=!0){if(!h(a))return null;const {pixels:f,width:l,height:b,mask:k,pixelType:m}=a;a=[];const q=Math.round(l/2),G=Math.round(b/2),L=b-1,M=l-1;for(var t=0;t<f.length;t++){var I=f[t],K=H.createEmptyBand(m,q*G),R=0;for(var U=0;U<
b;U+=2)for(var S=0;S<l;S+=2){var Y=I[U*l+S];if(c){var X=S===M?Y:I[U*l+S+1];const aa=U===L?Y:I[U*l+S+l],g=S===M?aa:U===L?X:I[U*l+S+l+1];K[R++]=(Y+X+aa+g)/4}else K[R++]=Y}a.push(K)}t=null;if(null!=k)for(t=new Uint8Array(q*G),I=0,K=0;K<b;K+=2)for(R=0;R<l;R+=2)U=k[K*l+R],c?(S=R===M?U:k[K*l+R+1],Y=K===L?U:k[K*l+R+l],X=R===M?Y:K===L?S:k[K*l+R+l+1],t[I++]=U*S*Y*X?1:0):t[I++]=U;return new H({width:q,height:G,pixelType:m,pixels:a,mask:t})}function D(a,c,f,l,b=0){const {width:k,height:m}=a,{width:q,height:G}=
c;a=l.cols;l=l.rows;c=Math.ceil(q/a-.1/a);const L=Math.ceil(G/l-.1/l);let M,t,I,K,R;const U=c*a;var S=U*L*l;const Y=new Float32Array(S),X=new Float32Array(S),aa=new Uint32Array(S),g=new Uint32Array(S);let A=0,J,N;for(let V=0;V<L;V++)for(let W=0;W<c;W++){var T=12*(V*c+W);S=f[T];M=f[T+1];t=f[T+2];I=f[T+3];K=f[T+4];R=f[T+5];for(var O=0;O<l;O++){A=(V*l+O)*U+W*a;N=(O+.5)/l;for(let Q=0;Q<O;Q++)J=(Q+.5)/a,Y[A+Q]=(S*J+M*N+t)*k+b,X[A+Q]=(I*J+K*N+R)*m+b,aa[A+Q]=Math.floor(Y[A+Q]),g[A+Q]=Math.floor(X[A+Q])}T+=
6;S=f[T];M=f[T+1];t=f[T+2];I=f[T+3];K=f[T+4];R=f[T+5];for(T=0;T<l;T++)for(A=(V*l+T)*U+W*a,N=(T+.5)/l,O=T;O<a;O++)J=(O+.5)/a,Y[A+O]=(S*J+M*N+t)*k+b,X[A+O]=(I*J+K*N+R)*m+b,aa[A+O]=Math.floor(Y[A+O]),g[A+O]=Math.floor(X[A+O])}return{offsets_x:Y,offsets_y:X,offsets_xi:aa,offsets_yi:g,gridWidth:U}}r.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(r.NoDataInterpretation||(r.NoDataInterpretation={}));r.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]=
"bestMatch";a[a.fail=1]="fail"})(r.MissingBandAction||(r.MissingBandAction={}));r.MAX_MAP_SIZE_GPU=6;r.approximateTransform=function(a,c,f,l,b="nearest"){if(!h(a))return null;"majority"===b&&(a=P(a));const {pixels:k,mask:m,bandMasks:q,pixelType:G}=a,L=a.width;var M=a.height;const t=H.getPixelArrayConstructor(G),I=k.length,{width:K,height:R}=c;a=!1;for(var U=0;U<f.length;U+=3)-1===f[U]&&-1===f[U+1]&&-1===f[U+2]&&(a=!0);const {offsets_x:S,offsets_y:Y,offsets_xi:X,offsets_yi:aa,gridWidth:g}=D({width:L,
height:M},c,f,l,"majority"===b?.5:0);let A;c=(N,T,O,V)=>{const W=N instanceof Float32Array||N instanceof Float64Array?0:.5;for(let Q=0;Q<R;Q++){A=Q*g;for(let ba=0;ba<K;ba++){if(0>S[A]||0>Y[A])N[Q*K+ba]=0;else if(V)N[Q*K+ba]=T[X[A]+aa[A]*L];else{const Z=Math.floor(S[A]),ea=Math.floor(Y[A]),da=Math.ceil(S[A]),ca=Math.ceil(Y[A]),fa=S[A]-Z,ia=Y[A]-ea;N[Q*K+ba]=!O||O[Z+ea*L]&&O[da+ea*L]&&O[Z+ca*L]&&O[da+ca*L]?(1-ia)*((1-fa)*T[Z+ea*L]+fa*T[da+ea*L])+ia*((1-fa)*T[Z+ca*L]+fa*T[da+ca*L])+W:T[X[A]+aa[A]*L]}A++}}};
f=[];l=q?.length===I;M=[];for(U=0;U<I;U++){if(l){var J=new Uint8Array(K*R);c(J,q[U],q[U],!0);M.push(J)}J=new t(K*R);c(J,k[U],l?q[U]:m,"nearest"===b||"majority"===b);f.push(J)}b=new H({width:K,height:R,pixelType:G,pixels:f,bandMasks:l?M:void 0});if(null!=m)b.mask=new Uint8Array(K*R),c(b.mask,m,m,!0);else if(a)for(b.mask=new Uint8Array(K*R),a=0;a<K*R;a++)b.mask[a]=0>S[a]||0>Y[a]?0:1;b.updateStatistics();return b};r.clip=p;r.colorize=function(a,c){if(!h(a)||!c||!c.indexedColormap&&!c.indexed2DColormap)return a;
const f=a.clone();var l=f.pixels;let b=f.mask;const k=f.width*f.height;if(1!==l.length)return a;const {indexedColormap:m,indexed2DColormap:q,offset:G,alphaSpecified:L}=c;a=0;l=l[0];c=new Uint8Array(l.length);const M=new Uint8Array(l.length),t=new Uint8Array(l.length);var I=0;if(m){const K=m.length-1;if(null!=b)for(a=0;a<k;a++)b[a]&&(I=4*(l[a]-G),I<G||I>K?b[a]=0:(c[a]=m[I],M[a]=m[I+1],t[a]=m[I+2],b[a]=m[I+3]));else{b=new Uint8Array(k);for(a=0;a<k;a++)I=4*(l[a]-G),I<G||I>K?b[a]=0:(c[a]=m[I],M[a]=m[I+
1],t[a]=m[I+2],b[a]=m[I+3]);f.mask=b}}else if(q)if(null!=b)for(a=0;a<k;a++)b[a]&&(I=q[l[a]],c[a]=I[0],M[a]=I[1],t[a]=I[2],b[a]=I[3]);else{b=new Uint8Array(k);for(a=0;a<k;a++)I=q[l[a]],c[a]=I[0],M[a]=I[1],t[a]=I[2],b[a]=I[3];f.mask=b}f.pixels=[c,M,t];f.statistics=null;f.pixelType="u8";f.maskIsAlpha=L;return f};r.compositeBands=function(a){if(!a?.length||a.some(G=>!h(G)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:c,height:f,pixelType:l}=a[0];if(a.some(G=>G.width!==c||G.height!==
f))return null;const b=a.map(({mask:G})=>G).filter(G=>null!=G);let k=null;b.length&&(k=new Uint8Array(c*f),k.set(b[0]),1<b.length&&y(b.slice(1),k));const m=[];a.forEach(({pixels:G})=>m.push(...G));const q=[];a.map(({statistics:G})=>G).filter(G=>G?.length).forEach(G=>q.push(...G));return new H({pixelType:l,width:c,height:f,mask:k,pixels:m,statistics:q.length?q:null})};r.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((L,M)=>L[0]-M[0]);var f=0;0>c[0][0]&&(f=c[0][0]);
var l=Math.max(256,c[c.length-1][0]-f+1),b=new Uint8Array(4*l),k=[],m=0,q=0,G=5===c[0].length;if(65536<l)return c.forEach(L=>{k[L[0]-f]=G?L.slice(1):L.slice(1).concat([255])}),{indexed2DColormap:k,offset:f,alphaSpecified:G};if(a.fillUnspecified)for(a=c[q],m=a[0]-f;m<l;m++)b[4*m]=a[1],b[4*m+1]=a[2],b[4*m+2]=a[3],b[4*m+3]=G?a[4]:255,m===a[0]-f&&(a=q===c.length-1?a:c[++q]);else for(m=0;m<c.length;m++)a=c[m],q=4*(a[0]-f),b[q]=a[1],b[q+1]=a[2],b[q+2]=a[3],b[q+3]=G?a[4]:255;return{indexedColormap:b,offset:f,
alphaSpecified:G}}}};r.createMaskLUT=function(a,c,f){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var l=a.includes("16")?65536:256;a=a.includes("s")?-l/2:0;l=new Uint8Array(l);if(c)for(let k=0;k<c.length;k++){var b=Math.ceil(c[2*k]-a);const m=Math.floor(c[2*k+1]-a);for(;b<=m;b++)l[b]=255}else l.fill(255);if(f)for(c=0;c<f.length;c++)l[f[c]-a]=0;return{lut:l,offset:a}};r.createRemapLUT=function(a){const {srcPixelType:c,inputRanges:f,outputValues:l,allowUnmatched:b,noDataRanges:k,isLastInputRangeInclusive:m,
outputPixelType:q}=a;if("u8"!==c&&"s8"!==c&&"u16"!==c&&"s16"!==c)return null;var G=c.includes("16")?65536:256;a=c.includes("s")?-G/2:0;const L=H.createEmptyBand(q,G);G=new Uint8Array(G);b&&G.fill(255);const [M,t]=B.getPixelValueRange(q);if(f?.length&&l?.length){var I=f.map(S=>S-1E-6);I[0]=f[0];m&&(I[I.length-1]=f[f.length-1]);for(var K=0;K<I.length;K++){var R=l[K]>t?t:l[K]<M?M:l[K],U=Math.ceil(I[2*K]-a);const S=Math.floor(I[2*K+1]-a);for(;U<=S;U++)L[U]=R,G[U]=255}}if(k?.length)for(I=0;I<k.length;I++)for(R=
Math.ceil(k[2*I]-a),K=Math.floor(k[2*I+1]-a);R<=K;R++)G[R]=0;return{lut:L,offset:a,mask:G}};r.extractBands=function(a,c){return c?.length&&h(a)?a.extractBands(c):a};r.getClipBounds=C;r.getLocalArithmeticNorthRotations=function(a,c){const {coefficients:f,spacing:l}=c,{offsets_x:b,offsets_y:k,gridWidth:m}=D(a,a,f,{rows:l[0],cols:l[1]}),{width:q,height:G}=a;a=new Float32Array(q*G);c=180/Math.PI;for(let t=0;t<G;t++)for(let I=0;I<q;I++){var L=t*m+I,M=0===t?L:L-m;const K=t===G-1?L:L+m;L=b[M]-b[K];M=k[K]-
k[M];isNaN(L)||isNaN(M)?a[t*q+I]=90:(M=Math.atan2(M,L)*c,M=(360+M)%360,a[t*q+I]=M)}return a};r.interpolateOffsets=D;r.isValidPixelBlock=h;r.lookupBandValues=w;r.lookupPixels=function(a,c){if(!h(a))return null;const {pixels:f,mask:l}=a,b=f.length;let k=c.lut;const {offset:m}=c;k&&1===k[0].length&&(k=f.map(()=>k));const q=[];c=c.outputPixelType||"u8";for(let G=0;G<b;G++){const L=w(f[G],l,k[G],m||0,c);q.push(L)}a=new H({width:a.width,height:a.height,pixels:q,mask:l,pixelType:c});a.updateStatistics();
return a};r.mask=function(a,c){if(!h(a))return null;const {width:f,height:l,pixels:b}=a;var k=f*l;const m=new Uint8Array(k);a.mask?m.set(a.mask):m.fill(255);a=b.length;const {includedRanges:q,noDataValues:G,outputPixelType:L,matchAll:M,lookups:t}=c;if(t){k=[];for(c=0;c<a;c++){var I=t[c];I=w(b[c],m,I.lut,I.offset||0,"u8");k.push(I)}1===k.length?m.set(k[0]):M?x(k,m):y(k,m)}else if(M){c=[];for(I=0;I<a;I++){const K=new Uint8Array(k);K.set(m);z(b[I],q?.slice(2*I,2*I+2),G?.[I],K);c.push(K)}1===c.length?
m.set(c[0]):x(c,m)}else for(k=0;k<a;k++)z(b[k],q?.slice(2*k,2*k+2),G?.[k],m);return new H({width:f,height:l,pixelType:L,pixels:b,mask:m})};r.mosaic=v;r.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var f=a.find(t=>t.pixelBlock);if(!f||null==f.pixelBlock)return null;var l=(f.extent.xmax-f.extent.xmin)/f.pixelBlock.width;const b=(f.extent.ymax-f.extent.ymin)/f.pixelBlock.height,k=.01*Math.min(l,b),m=a.sort((t,I)=>Math.abs(t.extent.ymax-I.extent.ymax)>k?I.extent.ymax-t.extent.ymax:Math.abs(t.extent.xmin-
I.extent.xmin)>k?t.extent.xmin-I.extent.xmin:0);var q=Math.min.apply(null,m.map(t=>t.extent.xmin));const G=Math.min.apply(null,m.map(t=>t.extent.ymin)),L=Math.max.apply(null,m.map(t=>t.extent.xmax)),M=Math.max.apply(null,m.map(t=>t.extent.ymax));a={x:Math.round((c.xmin-q)/l),y:Math.round((M-c.ymax)/b)};q={width:Math.round((L-q)/l),height:Math.round((M-G)/b)};l={width:Math.round((c.xmax-c.xmin)/l),height:Math.round((c.ymax-c.ymin)/b)};if(Math.round(q.width/f.pixelBlock.width)*Math.round(q.height/f.pixelBlock.height)!==
m.length||0>a.x||0>a.y||q.width<l.width||q.height<l.height)return null;f=m.map(t=>t.pixelBlock);f=v(f,q,{clipOffset:a,clipSize:l});return{extent:c,pixelBlock:f}};r.remap=function(a,c){if(!h(a))return null;const {width:f,height:l}=a,{inputRanges:b,outputValues:k,outputPixelType:m,noDataRanges:q,allowUnmatched:G,isLastInputRangeInclusive:L}=c;c=a.pixels[0];const M=H.createEmptyBand(m,c.length),t=a.mask,I=new Uint8Array(f*l);t?I.set(t):I.fill(255);const K=a.pixelType.startsWith("f")?1E-6:0;a=b.map(A=>
A-K);a[0]=b[0];a[a.length-1]=b[b.length-1]+(L?1E-6:0);var R=b.length/2;const [U,S]=B.getPixelValueRange(m);for(var Y=0;Y<l;Y++)for(var X=0;X<f;X++){var aa=Y*f+X;if(I[aa]){var g=c[aa];let A=!1;for(let J=R-1;0<=J;J--)if(g===a[2*J]||g>a[2*J]&&g<a[2*J+1]){M[aa]=k[J];A=!0;break}A||(G?M[aa]=g>S?S:g<U?U:g:I[aa]=0)}}if(a=q?.length)for(R=0;R<l;R++)for(Y=0;Y<f;Y++)if(X=R*f+Y,!t||t[X])for(aa=c[X],g=0;g<a;g+=2)if(aa>=q[g]&&aa<=q[g+1]){M[X]=0;I[X]=0;break}return new H({width:f,height:l,pixelType:m,pixels:[M],
mask:I})};r.remapColor=function(a,c){if(!h(a))return null;a=a.clone();var {pixels:f}=a;const l=a.width*a.height,b=c.length,k=Math.floor(b/2),m=c[Math.floor(k)];f=f[0];let q,G,L,M,t,I,K=!1;const R=new Uint8Array(l),U=new Uint8Array(l),S=new Uint8Array(l);let Y=a.mask;const X=4===c[0].mappedColor.length;Y||(Y=new Uint8Array(l),Y.fill(X?255:1),a.mask=Y);for(t=0;t<l;t++)if(Y[t]){q=f[t];K=!1;I=k;G=m;L=0;for(M=b-1;1<M-L;){if(q===G.value){K=!0;break}q>G.value?L=I:M=I;I=Math.floor((L+M)/2);G=c[Math.floor(I)]}K||
(q===c[L].value?(G=c[L],K=!0):q===c[M].value?(G=c[M],K=!0):q<c[L].value?(K=!1,G=null):q>c[L].value&&(q<c[M].value?(G=c[L],K=!0):M===b-1?(K=!1,G=null):(G=c[M],K=!0)));K?(R[t]=G.mappedColor[0],U[t]=G.mappedColor[1],S[t]=G.mappedColor[2],Y[t]=G.mappedColor[3]):R[t]=U[t]=S[t]=Y[t]=0}a.pixels=[R,U,S];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};r.resampleByMajority=P;r.setValidBoundary=function(a,c,f){if(!h(a))return null;const {width:l,height:b}=a,k=c.x;c=c.y;const m=f.width+k;f=f.height+c;if(0>
k||0>c||m>l||f>b||0===k&&0===c&&m===l&&f===b)return a;a.mask||(a.mask=new Uint8Array(l*b));const q=a.mask;for(let G=0;G<b;G++){const L=G*l;for(let M=0;M<l;M++)q[L+M]=G<c||G>=f||M<k||M>=m?0:1}a.updateStatistics();return a};r.split=function(a,c,f){if(!h(a))return null;const {width:l,height:b}=c;let {width:k,height:m}=a;const q=new Map,G={x:0,y:0};f=null==f?1:1+f;for(let L=0;L<f;L++){const M=Math.ceil(k/l),t=Math.ceil(m/b);for(let I=0;I<t;I++){G.y=I*b;for(let K=0;K<M;K++){G.x=K*l;const R=p(a,G,c);q.set(`${L}/${I}/${K}`,
R)}}L<f-1&&(a=n(a));k=Math.round(k/2);m=Math.round(m/2)}return q};Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),function(r,H,B,h,w,z,x){x=function(y){function C(){var v=y.apply(this,arguments)||this;v.isCustomTilingScheme=!1;v.symbolTypes=
["triangle"];return v}H._inherits(C,y);var E=C.prototype;E.createTile=function(v){const F=this._tileInfoView.getTileBounds(B.create(),v),[P,u]=this._tileInfoView.tileInfo.size,e=this._tileInfoView.getTileResolution(v.level);return new w.RasterVFTile(v,e,F[0],F[3],P,u)};E.prepareRenderPasses=function(v){const F=v.registerRenderPass({name:"imagery (vf tile)",brushes:[h],target:()=>this.children.map(P=>P.tileData),drawPhase:z.WGLDrawPhase.MAP});return[...H._get(H._getPrototypeOf(C.prototype),"prepareRenderPasses",
this).call(this,v),F]};E.doRender=function(v){this.visible&&v.drawPhase===z.WGLDrawPhase.MAP&&this.symbolTypes.forEach(F=>{v.renderPass=F;H._get(H._getPrototypeOf(C.prototype),"doRender",this).call(this,v)})};return H._createClass(C)}(x);r.RasterVFTileContainer=x;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(r,
H,B){const h=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,
.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),w=new Float32Array([0,92/255,230/255,1]),z={beaufort_ft:h,beaufort_m:h,beaufort_km:h,beaufort_mi:h,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,
.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,
1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,
.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:w,single_arrow:w,wind_speed:new Float32Array([0,0,0,1])},x=[0,20];return function(y){function C(){var v=y.apply(this,arguments)||this;v._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",
1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};return v}r._inherits(C,y);var E=C.prototype;E.dispose=function(){};E.prepareState=function({context:v}){v.setBlendingEnabled(!0);v.setBlendFunctionSeparate(B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA,B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setColorMask(!0,!0,!0,!0);v.setStencilWriteMask(0);v.setStencilTestEnabled(!0);v.setStencilOp(B.StencilOperation.KEEP,
B.StencilOperation.KEEP,B.StencilOperation.REPLACE)};E.draw=function(v,F){if(null!=F.source&&0!==F.source.validPixelCount){var {context:P,timeline:u}=v;u.begin(this.name);P.setStencilFunction(B.CompareFunction.EQUAL,F.stencilRef,255);F.updateVectorFieldVAO(v);if("scalar"===v.renderPass){var e=F.vaoData.scalar;e&&this._drawScalars(v,F,e.vao,e.elementCount)}else(e=F.vaoData.magdir)&&this._drawTriangles(v,F,e.vao,e.elementCount);u.end(this.name)}};E._drawTriangles=function(v,F,P,u){const {context:e,
painter:d,requestRender:p,allowDelayedRender:n}=v,{symbolizerParameters:D}=F;var a=D.dataRange?["dataRange"]:[];"geographic"===D.rotationType&&a.push("rotationGeographic");a=d.materialManager.getProgram(this._desc.magdir,a);if(n&&null!=p&&!a.compiled)p();else{e.useProgram(a);var {coordScale:c,opacity:f,transforms:l}=F;a.setUniform2fv("u_coordScale",c);a.setUniform1f("u_opacity",f);a.setUniformMatrix3fv("u_dvsMat3",l.dvs);var {style:b,dataRange:k,rotation:m,symbolPercentRange:q}=D;a.setUniform4fv("u_colors",
z[b]);a.setUniform2fv("u_dataRange",k||x);a.setUniform1f("u_rotation",m);a.setUniform2fv("u_symbolPercentRange",q);v=this._getSymbolSize(v,F);a.setUniform2fv("u_symbolSize",v);e.bindVAO(P);e.drawElements(B.PrimitiveType.TRIANGLES,u,B.DataType.UNSIGNED_INT,0)}};E._drawScalars=function(v,F,P,u){const {context:e,painter:d,requestRender:p,allowDelayedRender:n}=v,{symbolizerParameters:D}=F;var a=[];"wind_speed"===D.style?a.push("innerCircle"):D.dataRange&&a.push("dataRange");"geographic"===D.rotationType&&
a.push("rotationGeographic");a=d.materialManager.getProgram(this._desc.scalar,a);if(n&&null!=p&&!a.compiled)p();else{e.useProgram(a);var {coordScale:c,opacity:f,transforms:l}=F;a.setUniform2fv("u_coordScale",c);a.setUniform1f("u_opacity",f);a.setUniformMatrix3fv("u_dvsMat3",l.dvs);var {dataRange:b,symbolPercentRange:k}=D;a.setUniform2fv("u_dataRange",b||x);a.setUniform2fv("u_symbolPercentRange",k);v=this._getSymbolSize(v,F);a.setUniform2fv("u_symbolSize",v);e.bindVAO(P);e.drawElements(B.PrimitiveType.TRIANGLES,
u,B.DataType.UNSIGNED_INT,0)}};E._getSymbolSize=function(v,F){v=F.key?2**(v.displayLevel-F.key.level):F.resolution/v.state.resolution;const {symbolTileSize:P}=F.symbolizerParameters;return[P/(Math.round((F.width-F.offset[0])/P)*P)/v,P/(Math.round((F.height-F.offset[1])/P)*P)/v]};return r._createClass(C)}(H)})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RasterVFDisplayObject ../webgl/TiledDisplayObject".split(" "),
function(r,H,B,h,w,z){z=function(x){function y(E,v,F,P,u,e,d=null){var p=x.call(this,E,v,F,P,u,e)||this;p.tileData=new w.RasterVFDisplayObject(d);p.tileData.coordScale=[u,e];p.tileData.once("isReady",()=>p.ready());return p}H._inherits(y,x);var C=y.prototype;C.destroy=function(){H._get(H._getPrototypeOf(y.prototype),"destroy",this).call(this);this.tileData.destroy();this.stage=this.tileData=null};C._createTransforms=function(){return{dvs:h.create(),tileMat3:h.create()}};C.setTransform=function(E){H._get(H._getPrototypeOf(y.prototype),
"setTransform",this).call(this,E);const v=this.resolution/(E.resolution*E.pixelRatio),F=this.transforms.tileMat3,[P,u]=this.tileData.offset,[e,d]=E.toScreenNoRotation([0,0],[this.x+P*this.resolution,this.y-u*this.resolution]),{symbolTileSize:p}=this.tileData.symbolizerParameters;B.set(F,Math.round((this.width-this.tileData.offset[0])/p)*p/this.rangeX*v,0,0,0,Math.round((this.height-this.tileData.offset[1])/p)*p/this.rangeY*v,0,e,d,1);B.multiply(this.transforms.dvs,E.displayViewMat3,F);this.tileData.transforms.dvs=
this.transforms.dvs};C.onAttach=function(){this.tileData.stage=this.stage};C.onDetach=function(){this.tileData.stage=null};H._createClass(y,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(E){this.tileData.stencilRef=E}}]);return y}(z.TiledDisplayObject);r.RasterVFTile=z;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F){B=function(P){function u(d=null){var p=P.call(this)||this;p._source=null;p._symbolizerParameters=null;p._vaoInvalidated=!0;p.coordScale=[1,1];p.height=null;p.key=null;p.offset=null;p.stencilRef=0;p.resolution=null;p.pixelRatio=1;p.x=0;p.y=0;p.rotation=0;p.rawPixelData=null;p.vaoData=null;p.width=null;p.source=d;return p}H._inherits(u,P);var e=u.prototype;e.destroy=function(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),
this.vaoData=null)};e.invalidateVAO=function(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};e.updateVectorFieldVAO=function(d){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:p}=this.symbolizerParameters;switch(p){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":p=
x.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(d.context,p)};break;case "simple_scalar":p=x.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(d.context,p)};break;case "wind_speed":p=x.createVFMesh(this.source,this.symbolizerParameters);p=this._createVectorFieldVAO(d.context,p);const n=x.createVFMeshScalar(this.source,this.symbolizerParameters);d=this._createVectorFieldVAO(d.context,n);this.vaoData=
{magdir:p,scalar:d}}}this.ready();this.requestRender()}};e._createTransforms=function(){return{dvs:w.create()}};e.setTransform=function(d){const p=h.identity(this.transforms.dvs),[n,D]=d.toScreenNoRotation([0,0],[this.x,this.y]);var a=this.resolution/this.pixelRatio/d.resolution;const c=a*this.width;a*=this.height;const f=Math.PI*this.rotation/180;h.translate(p,p,z.fromValues(n,D));h.translate(p,p,z.fromValues(c/2,a/2));h.rotate(p,p,-f);h.translate(p,p,z.fromValues(-c/2,-a/2));h.scaleByVec2(p,p,z.fromValues(c,
a));h.multiply(this.transforms.dvs,d.displayViewMat3,p)};e.onAttach=function(){this.invalidateVAO()};e.onDetach=function(){this.invalidateVAO()};e._createVectorFieldVAO=function(d,p){const {vertexData:n,indexData:D}=p;p=E.BufferObject.createVertex(d,v.Usage.STATIC_DRAW,new Float32Array(n));const a=E.BufferObject.createIndex(d,v.Usage.STATIC_DRAW,new Uint32Array(D)),c=C.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:v.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:v.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:v.DataType.FLOAT,normalized:!1}]});return{vao:new F.VertexArrayObject(d,c.attributes,c.bufferLayouts,{geometry:p},a),elementCount:D.length}};H._createClass(u,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(d){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(d)&&(this._symbolizerParameters=d,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(d){this._source=d;this.invalidateVAO()}}]);return u}(y.DisplayObject);r.RasterVFDisplayObject=B;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(r,H,B,h,w,z,x,y,C,E,v,F){return P=>{P=function(u){function e(){var p=u.apply(this,arguments)||this;p._rasterFieldPrefix="Raster.";p.layer=null;p.view=null;p.tileInfo=null;return p}r._inherits(e,u);var d=e.prototype;d._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)};d.supportsSpatialReference=function(p){return!!this.projectFullExtent(p)};d.projectFullExtent=function(p){const n=this.layer.fullExtent,D=v.getDefaultDatumTransformationForDataset(n,p,!1);return v.projectExtent(n,
p,D)};d.fetchPopupFeatures=async function(p,n){const {layer:D}=this;if(!p)throw new h("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:D});var {popupEnabled:a}=D;n=F.getFetchPopupTemplate(D,n);if(!a||null==n)throw new h("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:n});a=[];const {value:c,magdirValue:f,processedValue:l}=await D.identify(p,{timeExtent:this.timeExtent});let b="";if(c&&c.length){b=
"imagery-tile"===D.type&&D.hasStandardTime()&&null!=c[0]?c.map(m=>D.getStandardTimeValue(m)).join(", "):c.join(", ");p={ObjectId:0};p["Raster.ServicePixelValue"]=l?.join(", ")??b;p["Raster.ServicePixelValue.Raw"]=b;n=D.rasterInfo.attributeTable;if(null!=n){const {fields:m,features:q}=n,G=m.find(({name:L})=>"value"===L.toLowerCase());if(n=G?q.find(L=>String(L.attributes[G.name])===b):null)for(var k in n.attributes)n.attributes.hasOwnProperty(k)&&(p[this._rasterFieldPrefix+k]=n.attributes[k])}k=D.rasterInfo.dataType;
if("vector-magdir"===k||"vector-uv"===k)p["Raster.Magnitude"]=f?.[0],p["Raster.Direction"]=f?.[1];k=new B(this.fullExtent.clone(),null,p);k.layer=D;k.sourceLayer=k.layer;a.push(k)}return a};r._createClass(e,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}},{key:"datumTransformation",get:function(){return v.getDefaultDatumTransformationForDataset(this.layer.fullExtent,
this.view.spatialReference,!0)}}]);return e}(P);H.__decorate([w.property()],P.prototype,"layer",void 0);H.__decorate([w.property(E.combinedViewLayerTimeExtentProperty)],P.prototype,"timeExtent",void 0);H.__decorate([w.property()],P.prototype,"view",void 0);H.__decorate([w.property()],P.prototype,"fullExtent",null);H.__decorate([w.property()],P.prototype,"tileInfo",void 0);H.__decorate([w.property({readOnly:!0})],P.prototype,"hasTilingEffects",null);H.__decorate([w.property()],P.prototype,"datumTransformation",
null);return P=H.__decorate([C.subclass("esri.views.layers.ImageryTileLayerView")],P)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(r,H){function B(h,w){return h.popupTemplate?h.popupTemplate:null!=w&&w.defaultPopupTemplateEnabled&&null!=h.defaultPopupTemplate?h.defaultPopupTemplate:null}r.getFetchPopupTemplate=B;r.getRequiredFields=async function(h,w=h.popupTemplate){if(null==w)return[];const z=await w.getRequiredFields(h.fieldsIndex);
({lastEditInfoEnabled:w}=w);const {objectIdField:x,typeIdField:y,globalIdField:C,relationships:E}=h;if(z.includes("*"))return["*"];w=w?await H.getFeatureEditFields(h):[];const v=H.fixFields(h.fieldsIndex,[...z,...w]);y&&v.push(y);v&&x&&h.fieldsIndex?.has(x)&&!v.includes(x)&&v.push(x);v&&C&&h.fieldsIndex?.has(C)&&!v.includes(C)&&v.push(C);E&&E.forEach(F=>{({keyField:F}=F);v&&F&&h.fieldsIndex?.has(F)&&!v.includes(F)&&v.push(F)});return v};r.hasPopupTemplate=function(h,w){return null!=B(h,{defaultPopupTemplateEnabled:w})};
Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(r,H,B,h,w,z,x,y,C,E){return v=>{v=function(F){function P(){return F.apply(this,
arguments)||this}r._inherits(P,F);P.prototype.initialize=function(){this.handles.add(w.on(()=>this.layer,"refresh",u=>{this.doRefresh(u.dataChanged).catch(e=>{h.isAbortError(e)||B.getLogger(this).error(e)})}),"RefreshableLayerView")};return r._createClass(P)}(v);H.__decorate([z.property()],v.prototype,"layer",void 0);return v=H.__decorate([E.subclass("esri.layers.mixins.RefreshableLayerView")],v)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(r,
H,B,h,w,z,x,y,C,E,v,F,P,u,e,d,p,n,D,a){y=function(c){function f(){var b=c.apply(this,arguments)||this;b._useWebGLForProcessing=!0;b._useProgressiveUpdate=!0;b.subview=null;return b}r._inherits(f,c);var l=f.prototype;l.update=function(b){this.subview?.update(b);this.notifyChange("updating")};l.isUpdating=function(){return!this.subview||this.subview.updating};l.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._updateSubview();this.addAttachHandles([z.watch(()=>this.displayParameters,
(b,k)=>{const m=b.interpolation!==k?.interpolation&&("majority"===b.interpolation||"majority"===k?.interpolation)&&p.canUseMajorityInterpolationOnDataSource(this.layer),q=b.renderer!==k?.renderer&&k?.renderer?.type!==b.renderer?.type;q&&this._updateSubview();const G=b.rasterFunction!==k?.rasterFunction,L=G&&!this._useWebGLForProcessing;this.subview.redrawOrRefetch({refetch:b.multidimensionalDefinition!==k?.multidimensionalDefinition||m||q||L,reprocess:G}).catch(M=>{w.isAbortError(M)||h.getLogger(this).error(M)});
this.notifyChange("updating")}),z.watch(()=>this.layer.blendMode??"normal",b=>{this.subview.container.blendMode=b},z.syncAndInitial),z.watch(()=>this.layer.effect??null,b=>{this.subview.container.effect=b},z.syncAndInitial),z.watch(()=>this.layer.multidimensionalSubset??null,(b,k)=>{const {multidimensionalDefinition:m}=this.layer;null!=m&&F.hasExcludedVariableOrDimension(m,b)!==F.hasExcludedVariableOrDimension(m,k)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(q=>{w.isAbortError(q)||h.getLogger(this).error(q)}),
this.notifyChange("updating"))},z.sync),z.watch(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch({refetch:!0}).catch(b=>{w.isAbortError(b)||h.getLogger(this).error(b)})},z.initial)])};l.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null};l.moveStart=function(){this.requestUpdate()};l.viewChange=function(){this.requestUpdate()};l.moveEnd=function(){this.subview.moveEnd()};
l.hitTest=async function(b,k){return[{type:"graphic",layer:this.layer,mapPoint:b,graphic:new B({attributes:{},geometry:b.clone()})}]};l.doRefresh=function(){return this.subview?this.subview.doRefresh():Promise.resolve()};l._updateSubview=function(){var b=this.layer.renderer?.type;if(b){b="vector-field"===b?"rasterVF":"flow"===b?"flow":"raster";if(this.subview){if(this.subview.type===b){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=
null}var {layer:k}=this;b="rasterVF"===b?new d({layer:k,layerView:this}):"flow"===b?new P({layer:k,layerView:this}):new e({layer:k,layerView:this});"useWebGLForProcessing"in b&&(b.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in b&&(b.useProgressiveUpdate=this._useProgressiveUpdate);"previousLOD"in b&&({subview:k}=this,b.previousLOD=k&&"previousLOD"in k?k.previousLOD:null);this._attachSubview(b);this.subview=b;this.requestUpdate()}};l._attachSubview=function(b){b&&!b.attached&&
(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0),b.container.blendMode=this.layer.blendMode,b.container.effect=this.layer.effect)};l._detachSubview=function(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)};r._createClass(f,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(b){this._useWebGLForProcessing=b;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=b)}},{key:"useProgressiveUpdate",
get:function(){return this._useWebGLForProcessing},set:function(b){this._useProgressiveUpdate=b;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=b)}},{key:"displayParameters",get:function(){const {layer:b}=this,k=this._get("displayParameters");return b.renderer?{bandIds:b.bandIds,renderer:b.renderer,interpolation:b.interpolation,multidimensionalDefinition:b.multidimensionalDefinition,rasterFunction:"imagery-tile"===b.type?b.rasterFunction:null}:k}}]);return f}(n(a(u.LayerView2DMixin(D))));
H.__decorate([x.property()],y.prototype,"subview",void 0);H.__decorate([x.property()],y.prototype,"useWebGLForProcessing",null);H.__decorate([x.property()],y.prototype,"useProgressiveUpdate",null);H.__decorate([x.property({readOnly:!0})],y.prototype,"displayParameters",null);return y=H.__decorate([v.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],y)});