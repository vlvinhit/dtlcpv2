// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ./checkWebGLError ./contextUtils ./enums ./ShaderTranspiler".split(" "),function(p,y,z,u,q,v,m,w){function x(g,d,a){g=g.gl;const b=g.createShader(d);g.shaderSource(b,a);g.compileShader(b);q.webglValidateShadersEnabled()&&!g.getShaderParameter(b,g.COMPILE_STATUS)&&(console.error("Compile error in ".concat(d===m.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(g.getShaderInfoLog(b)),console.error(A(a)));
n.enabled&&(n.compiledLOC+=a.match(/\n/g).length+1);return b}function A(g){let d=2;return g.replaceAll("\n",()=>{var a=d++;a=1E3<=a?a.toString():("  "+a).slice(-3);return"\n"+a+":"})}function k(g,d,a){const b=g.get(d);return b?z.update(b,a):(g.set(d,Array.from(a)),!0)}u=function(){function g(a,b,c,f,h=new Map){this._context=a;this._locations=f;this._uniformBlockBindings=h;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=
new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;a||console.error("RenderingContext isn't initialized!");0===b.length&&console.error("Shaders source should not be empty!");this._context.type===v.ContextType.WEBGL2&&(b=w.transpileShader(b,m.ShaderType.VERTEX_SHADER),c=w.transpileShader(c,m.ShaderType.FRAGMENT_SHADER));this._vShader=x(this._context,m.ShaderType.VERTEX_SHADER,b);this._fShader=x(this._context,m.ShaderType.FRAGMENT_SHADER,
c);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(m.ResourceType.Shader,this);q.webglValidateShadersEnabled()&&(this.vertexShader=b,this.fragmentShader=c);const e=this._context.gl,l=e.createProgram();e.attachShader(l,this._vShader);e.attachShader(l,this._fShader);this._locations.forEach((r,t)=>e.bindAttribLocation(l,r,t));e.linkProgram(l);q.webglValidateShadersEnabled()&&!e.getProgramParameter(l,e.LINK_STATUS)&&console.error("Could not link shader\n"+
`validated: ${e.getProgramParameter(l,e.VALIDATE_STATUS)}`+`, gl error ${e.getError()}`+`, vertex: ${e.getShaderParameter(this._vShader,e.COMPILE_STATUS)}`+`, fragment: ${e.getShaderParameter(this._fShader,e.COMPILE_STATUS)}`+`, info log: ${e.getProgramInfoLog(l)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===v.ContextType.WEBGL2)for(const [r,t]of this._uniformBlockBindings)a=e.getUniformBlockIndex(l,r),4294967295>a&&e.uniformBlockBinding(l,
a,t);this._glName=l;this._context.instanceCounter.increment(m.ResourceType.Program,this)}var d=g.prototype;d.dispose=function(){if(!(0<--this._refCount)){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(m.ResourceType.Shader,this));this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(m.ResourceType.Program,
this))}};d.ref=function(){++this._refCount};d._getUniformLocation=function(a){void 0===this._nameToUniformLocation[a]&&null!=this.glName&&(++n.numUniforms,this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this.glName,a));return this._nameToUniformLocation[a]};d.hasUniform=function(a){return null!==this._getUniformLocation(a)};d.setUniform1i=function(a,b){const c=this._nameToUniform1[a];if(void 0===c||b!==c)this._context.gl.uniform1i(this._getUniformLocation(a),b),this._nameToUniform1[a]=
b};d.setUniform1iv=function(a,b){k(this._nameToUniform1v,a,b)&&this._context.gl.uniform1iv(this._getUniformLocation(a),b)};d.setUniform2iv=function(a,b){k(this._nameToUniform2,a,b)&&this._context.gl.uniform2iv(this._getUniformLocation(a),b)};d.setUniform3iv=function(a,b){k(this._nameToUniform3,a,b)&&this._context.gl.uniform3iv(this._getUniformLocation(a),b)};d.setUniform4iv=function(a,b){k(this._nameToUniform4,a,b)&&this._context.gl.uniform4iv(this._getUniformLocation(a),b)};d.setUniform1f=function(a,
b){const c=this._nameToUniform1[a];if(void 0===c||b!==c)this._context.gl.uniform1f(this._getUniformLocation(a),b),this._nameToUniform1[a]=b};d.setUniform1fv=function(a,b){k(this._nameToUniform1v,a,b)&&this._context.gl.uniform1fv(this._getUniformLocation(a),b)};d.setUniform2f=function(a,b,c){const f=this._nameToUniform2.get(a);if(void 0===f)this._context.gl.uniform2f(this._getUniformLocation(a),b,c),this._nameToUniform2.set(a,[b,c]);else if(b!==f[0]||c!==f[1])this._context.gl.uniform2f(this._getUniformLocation(a),
b,c),f[0]=b,f[1]=c};d.setUniform2fv=function(a,b){k(this._nameToUniform2,a,b)&&this._context.gl.uniform2fv(this._getUniformLocation(a),b)};d.setUniform3f=function(a,b,c,f){const h=this._nameToUniform3.get(a);if(void 0===h)this._context.gl.uniform3f(this._getUniformLocation(a),b,c,f),this._nameToUniform3.set(a,[b,c,f]);else if(b!==h[0]||c!==h[1]||f!==h[2])this._context.gl.uniform3f(this._getUniformLocation(a),b,c,f),h[0]=b,h[1]=c,h[2]=f};d.setUniform3fv=function(a,b){k(this._nameToUniform3,a,b)&&this._context.gl.uniform3fv(this._getUniformLocation(a),
b)};d.setUniform4f=function(a,b,c,f,h){const e=this._nameToUniform4.get(a);if(void 0===e)this._context.gl.uniform4f(this._getUniformLocation(a),b,c,f,h),this._nameToUniform4.set(a,[b,c,f,h]);else if(void 0===e||b!==e[0]||c!==e[1]||f!==e[2]||h!==e[3])this._context.gl.uniform4f(this._getUniformLocation(a),b,c,f,h),e[0]=b,e[1]=c,e[2]=f,e[3]=h};d.setUniform4fv=function(a,b){k(this._nameToUniform4,a,b)&&this._context.gl.uniform4fv(this._getUniformLocation(a),b)};d.setUniformMatrix3fv=function(a,b,c=!1){k(this._nameToUniformMatrix3,
a,b)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(a),c,b)};d.setUniformMatrix4fv=function(a,b,c=!1){k(this._nameToUniformMatrix4,a,b)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(a),c,b)};d.stop=function(){};y._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"hasGLName",get:function(){return null!=this._glName}},{key:"compiled",get:function(){if(this._compiled)return!0;const a=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==
a||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,a.COMPLETION_STATUS_KHR)}}]);return g}();const n={compiledLOC:0,numUniforms:0,enabled:!1};p.Program=u;p.test=n;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});