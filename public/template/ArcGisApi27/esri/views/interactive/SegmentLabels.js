// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/analysisThemeUtils ../../core/asyncUtils ../../core/handleUtils ../../core/promiseUtils ../../core/quantityFormatUtils ../../core/reactiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/vec2 ../../chunks/vec2f64 ../../chunks/vec3 ../../geometry/support/coordsUtils ../../intl/messages ../../support/elevationInfoUtils ../../support/getDefaultUnitForView ../overlay/TextOverlayItem ../support/automaticLengthMeasurementUtils".split(" "),
function(d,y,k,F,z,G,H,I,J,A,B,l,V,W,X,K,m,C,L,M,N,O,P,Q,R){const S={default:15,far:25};d.SegmentLabels=function(D){function u(a){a=D.call(this,a)||this;a.context=null;a.stagedVertex=null;a.visible=!0;a.edgeDistance="default";a._messagesUnits=null;a._labelInfos=[];a._nextLabelIndex=0;return a}y._inherits(u,D);var n=u.prototype;n.initialize=function(){const a=G.createTask(async b=>{const g=await N.fetchMessageBundle("esri/core/t9n/Units");I.throwIfAborted(b);this._messagesUnits=g});this.addHandles([A.watch(()=>
[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(b=>A.on(()=>this.context?.editGeometryOperations,b,()=>this._update())),H.makeHandle(()=>a.abort())])};n.destroy=function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())};n._update=function(){this._nextLabelIndex=0;const a=this.context;if(null!=
a){var {components:b,geometry:g,coordinateHelper:p}=a.editGeometryOperations.data;if(g){var q=b.length;for(let r=0;r<q;++r){const c=[];b[r].iterateVertices(x=>{c.push(p.toXYZ(x.pos))});0===r&&null!=this.stagedVertex&&c.push(p.toXYZ(this.stagedVertex));if(2>c.length)continue;var f=c[0],h=c[c.length-1];"polygon"===g.type&&2<c.length&&!L.equals(f,h)&&c.push(f);h=1===q?!M.isClockwise(c,!1,!1):!1;let v=T,w=U;this.toScreenPointArray(a,f,v);for(f=1;f<c.length;++f){const x=c[f-1],E=c[f];this.toScreenPointArray(a,
E,w);this._addLabel(a,x,v,E,w,h);[v,w]=[w,v]}}}}this._destroyUnusedLabels()};n._addLabel=function(a,b,g,p,q,f){const {label:h}=this._getOrCreateLabel(a);if(!this.visible||3025>m.squaredDistance(g,q))h.visible=!1;else{var r=null!=a.graphicState?a.graphicState.isDraped?"on-the-ground":"absolute-height":O.getGeometryEffectiveElevationMode(a.editGeometryOperations.data.geometry,a.elevationInfo),{spatialReference:c}=a.editGeometryOperations.data;b=R.autoDirectDistanceByElevationMode(b,p,c,r);p=this._messagesUnits;
a=P.getDefaultUnitForView(a.view);h.text=null!=p&&null!=b?J.formatLength(p,b,a):"";h.visible=!0;a=q[0]-g[0];b=q[1]-g[1];f?m.set(e,-b,a):m.set(e,b,-a);m.normalize(e,e);m.scale(e,e,this._edgeDistancePixels);m.lerp(t,g,q,.5);m.add(t,t,e);h.position=[t[0],t[1]];h.anchor=Math.abs(e[0])>Math.abs(e[1])?0<e[0]?"left":"right":0>-e[1]?"top":"bottom"}};n._getOrCreateLabel=function(a){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const b=new Q({anchor:"center",
fontSize:10,textColor:z.getTextColor(),backgroundColor:z.getTextHaloColor(.6)});a.view.overlay?.items.add(b);a={label:b};this._labelInfos.push(a);this._nextLabelIndex=this._labelInfos.length;return a};n._destroyUnusedLabels=function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())};n._destroyLabel=function({label:a}){this.context?.view.overlay?.items.remove(a);a.destroy()};y._createClass(u,[{key:"updating",get:function(){return null==this._messagesUnits}},
{key:"test",get:function(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(a=>a.label.text)}}},{key:"_edgeDistancePixels",get:function(){return S[this.edgeDistance]}}]);return u}(F);k.__decorate([l.property()],d.SegmentLabels.prototype,"context",void 0);k.__decorate([l.property()],d.SegmentLabels.prototype,"stagedVertex",void 0);k.__decorate([l.property()],d.SegmentLabels.prototype,"visible",void 0);k.__decorate([l.property()],d.SegmentLabels.prototype,"edgeDistance",void 0);
k.__decorate([l.property()],d.SegmentLabels.prototype,"updating",null);k.__decorate([l.property()],d.SegmentLabels.prototype,"_messagesUnits",void 0);k.__decorate([l.property()],d.SegmentLabels.prototype,"_edgeDistancePixels",null);d.SegmentLabels=k.__decorate([K.subclass("esri.views.interactive")],d.SegmentLabels);const e=C.create(),t=C.create(),T=B.createScreenPointArray(),U=B.createScreenPointArray();Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});