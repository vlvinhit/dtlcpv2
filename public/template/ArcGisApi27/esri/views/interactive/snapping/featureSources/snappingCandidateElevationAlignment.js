// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/LRUCache ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/unitUtils ../../../../symbols/support/unitConversionUtils".split(" "),function(p,n,D,t,u,v,w,x){function q(g,{x:d,y:a,z:b}){return`${g}-${d}-${a}-${b??0}}`}function y(){return[]}let z=function(){function g(){}var d=g.prototype;d.alignCandidates=async function(a,b){return a};d.notifyElevationSourceChange=function(){};return n._createClass(g)}(),
C=function(){function g(a,b,c){this._elevationInfo=a;this._alignPointsInFeatures=b;this.spatialReference=c;this._alignmentsCache=new t.LRUCache(1024);this._cacheVersion=0;this._metersPerVerticalUnit=w.getMetersPerVerticalUnitForSR(c)}var d=g.prototype;d.alignCandidates=async function(a,b){const c=this._elevationInfo;return null==c||"absolute-height"!==c.mode||c.featureExpressionInfo?this._alignComputedElevationCandidates(a,b):(this._alignAbsoluteElevationCandidates(a,c),a)};d.notifyElevationSourceChange=
function(){this._alignmentsCache.clear();this._cacheVersion++};d._alignAbsoluteElevationCandidates=function(a,b){const {offset:c,unit:f}=b;if(null!=c){b=x.getMetersPerUnit(f??"meters")/this._metersPerVerticalUnit;b*=c;for(const e of a)switch(e.type){case "edge":e.start.z+=b;e.end.z+=b;continue;case "vertex":e.target.z+=b}}};d._alignComputedElevationCandidates=async function(a,b){var c=new Map;for(const h of a)u.getOrCreateMapValue(c,h.objectId,y).push(h);const [f,e,k]=this._prepareQuery(c);c=await this._alignPointsInFeatures(f,
b);v.throwIfAborted(b);if(k!==this._cacheVersion)return this._alignComputedElevationCandidates(a,b);this._applyCacheAndResponse(f,c,e);const {drapedObjectIds:l,failedObjectIds:m}=c;b=[];for(const h of a)({objectId:a}=h),l.has(a)&&"edge"===h.type&&(h.draped=!0),m.has(a)||b.push(h);return b};d._prepareQuery=function(a){const b=[],c=[];for(const [f,e]of a){a=[];for(const k of e)this._addToQueriesOrCachedResult(f,k.target,a,c),"edge"===k.type&&(this._addToQueriesOrCachedResult(f,k.start,a,c),this._addToQueriesOrCachedResult(f,
k.end,a,c));0!==a.length&&b.push({objectId:f,points:a})}return[b,c,this._cacheVersion]};d._addToQueriesOrCachedResult=function(a,b,c,f){a=q(a,b);a=this._alignmentsCache.get(a);null!=a?f.push(new A(b,a)):c.push(b)};d._applyCacheAndResponse=function(a,{elevations:b,drapedObjectIds:c,failedObjectIds:f},e){for(var k of e)k.apply();e=0;k=this._alignmentsCache;for(const {objectId:l,points:m}of a)if(f.has(l))e+=m.length;else{a=!c.has(l);for(const h of m){const B=q(l,h),r=b[e++];h.z=r;a&&k.put(B,r,1)}}};
return n._createClass(g)}(),A=function(){function g(d,a){this.point=d;this.z=a}g.prototype.apply=function(){this.point.z=this.z};return n._createClass(g)}();p.getSnappingCandidateElevationAligner=function(g=!1,d){if(g){const {elevationInfo:a,alignPointsInFeatures:b,spatialReference:c}=d;return new C(a,b,c)}return new z};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});