// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/elevationInfoUtils ../snappingUtils ./queryEngineUtils ./snappingCandidateElevationAlignment ./snappingCandidateElevationFilter ./symbologySnappingCandidates".split(" "),
function(e,p,f,w,k,l,g,B,C,D,x,y,q,r,t,z,u){e.FeatureCollectionSnappingSource=function(v){function m(a){a=v.call(this,a)||this;a.view=null;a._layerView3D=null;return a}p._inherits(m,v);var n=m.prototype;n.initialize=function(){const {view:a}=this,{layer:b}=this.layerSource;null!=a&&"3d"===a.type&&"subtype-group"!==b.type&&(a.whenLayerView(b).then(c=>this._layerView3D=c),this.addHandles([a.elevationProvider.on("elevation-change",({context:c})=>{const {elevationInfo:d}=b;y.elevationContextAffectsAlignment(c,
d)&&this._snappingElevationAligner.notifyElevationSourceChange()}),l.watch(()=>b.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),l.initial),l.watch(()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),l.initial),l.on(()=>this._layerView3D?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())]))};n.refresh=function(){};n.fetchCandidates=async function(a,
b){var {layer:c}=this.layerSource,d=c.source;if(!d?.querySnapping)return[];c=q.makeFilter(c);a=q.makeSnappingQuery(a,this.view?.type??"2d",c);d=await d.querySnapping(a,{signal:b});k.throwIfAborted(b);d=await this._snappingElevationAligner.alignCandidates(d.candidates,b);k.throwIfAborted(b);c=await this._symbologySnappingFetcher.fetch(d,b);k.throwIfAborted(b);b=0===c.length?d:[...d,...c];b=this._snappingElevationFilter.filter(a,b);const h=this._getGroundElevation;return b.map(A=>r.convertSnappingCandidate(A,
h))};p._createClass(m,[{key:"availability",get:function(){return 1}},{key:"updating",get:function(){return this.layerSource.updating}},{key:"_snappingElevationAligner",get:function(){const {view:a}=this,{layer:b}=this.layerSource,c=null!=a&&"3d"===a.type;return c&&"subtype-group"!==b.type?t.getSnappingCandidateElevationAligner(c,{elevationInfo:b.elevationInfo,alignPointsInFeatures:async(d,h)=>(await k.whenOrAbort(a.whenLayerView(b),h)).elevationAlignPointsInFeatures(d,h),spatialReference:a.spatialReference}):
t.getSnappingCandidateElevationAligner()}},{key:"_snappingElevationFilter",get:function(){const {view:a}=this;return z.getSnappingCandidateElevationFilter(null!=a&&"3d"===a.type&&"subtype-group"!==this.layerSource.layer.type)}},{key:"_symbologySnappingFetcher",get:function(){const {view:a}=this,{layer:b}=this.layerSource;return null==a||"3d"!==a.type||"subtype-group"===b.type?u.getSymbologySnappingCandidatesFetcher():u.getSymbologySnappingCandidatesFetcher(this._symbologySnappingSupported,async(c,
d)=>{const h=await a.whenLayerView(b);k.throwIfAborted(d);return h.queryForSymbologySnapping({candidates:c,spatialReference:a.spatialReference},d)})}},{key:"_symbologySnappingSupported",get:function(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}},{key:"_getGroundElevation",get:function(){return r.makeGetGroundElevation(this.view)}}]);return m}(w);f.__decorate([g.property({constructOnly:!0})],e.FeatureCollectionSnappingSource.prototype,"layerSource",void 0);f.__decorate([g.property({constructOnly:!0})],
e.FeatureCollectionSnappingSource.prototype,"view",void 0);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationAligner",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_snappingElevationFilter",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_symbologySnappingFetcher",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_layerView3D",void 0);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,
"_symbologySnappingSupported",null);f.__decorate([g.property()],e.FeatureCollectionSnappingSource.prototype,"_getGroundElevation",null);e.FeatureCollectionSnappingSource=f.__decorate([x.subclass("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],e.FeatureCollectionSnappingSource);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});