// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],function(a,l,g,h){let m=function(){function c(b,d){this.data=b;this.resolution=d;this.state={type:a.StateType.CREATED};this.alive=!0}var f=c.prototype;f.process=function(b){switch(this.state.type){case a.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,b),this.state.task.promise.then(b.resume,b.resume);case a.StateType.FETCHED_COUNT:return this.state=
this._gotoFetchFeatures(this.state,b),this.state.task.promise.then(b.resume,b.resume);case a.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,b)}return null};f._gotoFetchCount=function(b,d){return{type:a.StateType.FETCH_COUNT,previous:b,task:g.createTask(async e=>{e=await g.resultOrAbort(d.fetchCount(this,e));this.state.type===a.StateType.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,e.ok?e.value:Infinity))})}};f._gotoFetchedCount=function(b,d){return{type:a.StateType.FETCHED_COUNT,
featureCount:d,previous:b}};f._gotoFetchFeatures=function(b,d){return{type:a.StateType.FETCH_FEATURES,previous:b,task:g.createTask(async e=>{e=await g.resultOrAbort(d.fetchFeatures(this,b.featureCount,e));this.state.type===a.StateType.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,e.ok?e.value:[]))})}};f._gotoFetchedFeatures=function(b,d){return{type:a.StateType.FETCHED_FEATURES,previous:b,features:d}};f._goToDone=function(b,d){d.finish(this,b.features);return{type:a.StateType.DONE,
previous:b}};f.reset=function(){const b=this.state;this.state={type:a.StateType.CREATED};switch(b.type){case a.StateType.FETCH_COUNT:case a.StateType.FETCH_FEATURES:b.task.abort()}};f.intersects=function(b){if(null==b||!this.data.extent)return!0;h.fromExtent(b,k);return h.intersects(this.data.extent,k)};l._createClass(c,[{key:"debugInfo",get:function(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}},{key:"_featureCount",get:function(){switch(this.state.type){case a.StateType.CREATED:case a.StateType.FETCH_COUNT:return 0;
case a.StateType.FETCHED_COUNT:return this.state.featureCount;case a.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case a.StateType.FETCHED_FEATURES:return this.state.features.length;case a.StateType.DONE:return this.state.previous.features.length}}},{key:"_stateToString",get:function(){switch(this.state.type){case a.StateType.CREATED:return"created";case a.StateType.FETCH_COUNT:return"fetch-count";case a.StateType.FETCHED_COUNT:return"fetched-count";case a.StateType.FETCH_FEATURES:return"fetch-features";
case a.StateType.FETCHED_FEATURES:return"fetched-features";case a.StateType.DONE:return"done"}}}]);return c}();a.StateType=void 0;(function(c){c[c.CREATED=0]="CREATED";c[c.FETCH_COUNT=1]="FETCH_COUNT";c[c.FETCHED_COUNT=2]="FETCHED_COUNT";c[c.FETCH_FEATURES=3]="FETCH_FEATURES";c[c.FETCHED_FEATURES=4]="FETCHED_FEATURES";c[c.DONE=5]="DONE"})(a.StateType||(a.StateType={}));const k=h.create();a.PendingFeatureTile=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});