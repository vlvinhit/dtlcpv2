// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Evented ../../core/HandleOwner ../../core/handleUtils ../../core/maybe ../../core/quantityUtils ../../core/reactiveUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/GraphicsLayer ../../support/elevationInfoUtils ./support/createUtils ./support/helpMessageUtils ./support/surfaceCoordinateSystems ../interactive/InteractiveToolBase ../interactive/sketch/SketchLabelOptions ../interactive/sketch/SketchTooltipOptions ../interactive/tooltip/DrawTooltipInfos ../interactive/tooltip/Tooltip ../support/automaticAreaMeasurementUtils ../support/automaticLengthMeasurementUtils".split(" "),
function(c,C,d,I,J,K,L,v,p,y,M,e,S,T,U,N,O,P,n,z,D,Q,E,F,u,R,G,A){let H=C._createClass(function(){this.rectangle=this.circle=this.outline=this.full=this.activeVertex=this.regularVertices=null});c.DrawGraphicTool=function(w){function B(a){a=w.call(this,a)||this;a._graphic=null;a._createOperationGeometry=null;a.defaultZ=0;a.geometryType=null;a.hasZ=!0;a.labelOptions=new E;a.geometryToPlace=null;a.mode=null;a.snappingManager=null;a.snapToScene=!1;a.tooltip=null;a.tooltipOptions=new F;return a}C._inherits(B,
w);var h=B.prototype;h.initialize=function(){this.internalGraphicsLayer=new O({listMode:"hide",internal:!0});this.view.map.layers.add(this.internalGraphicsLayer);this.drawOperation=this.makeDrawOperation();this.handles.add([this.drawOperation.on("vertex-add",a=>this.onVertexAdd(a)),this.drawOperation.on("vertex-remove",a=>this.onVertexRemove(a)),this.drawOperation.on("vertex-update",a=>this.onVertexUpdate(a)),this.drawOperation.on("cursor-update",a=>this.onCursorUpdate(a)),this.drawOperation.on("complete",
a=>this.onComplete(a)),y.watch(()=>this.tooltipOptions.enabled,a=>{this.tooltip=a?new R.Tooltip({view:this.view,info:this._tooltipInfo}):v.destroyMaybe(this.tooltip)},y.syncAndInitial),y.watch(()=>this._tooltipInfo,a=>{null!=this.tooltip&&(this.tooltip.info=a)},y.syncAndInitial)]);this.finishToolCreation()};h.destroy=function(){this.drawOperation=v.destroyMaybe(this.drawOperation);this.tooltip=v.destroyMaybe(this.tooltip);this._destroyAllVisualisations();this.view.map.remove(this.internalGraphicsLayer);
this.internalGraphicsLayer=v.destroyMaybe(this.internalGraphicsLayer);this._set("view",null)};h.completeCreateOperation=function(){this.drawOperation.complete()};h.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};h.redo=function(){this.drawOperation.redo()};h.reset=function(){};h.undo=function(){this.drawOperation.undo()};h._destroyAllVisualisations=function(){this.handles.remove(q.outline);this.handles.remove(q.regularVertices);this.handles.remove(q.activeVertex);this.handles.remove("create-operation-graphic")};
h._createOrUpdateGraphic=function(a){if(null!=this._graphic)return this._updateGraphicGeometry(this._graphic,a),this._graphic;const b=this._graphic=new I({...this.graphicProperties,symbol:this.graphicSymbol});this._updateGraphicGeometry(b,a);this.internalGraphicsLayer.add(b);this.handles.add(this.initializeGraphic(b));this.notifyChange("graphic");this.handles.add(L.makeHandle(()=>{this.internalGraphicsLayer.remove(b);v.destroyMaybe(b);this._graphic===b&&(this._graphic=null)}),"create-operation-graphic");
return b};h._updateGraphicGeometry=function(a,b){a.geometry=b};h._getCreateOperationGeometry=function(a={operationComplete:!1}){var {drawOperation:b}=this;if(null==b||0===b.numVertices)return null;const {coordinateHelper:g,view:m}=b;var l=b.stagedVertex,k=b.committedVertices;b=k.slice();var r=null!=l;r&&b.push(g.pointToArray(l));var t=r?g.pointToArray(l):k.splice(-1)[0];l=b.length;r=m.spatialReference;const x="3d"===m.type&&"global"===m.viewingMode,f=new H;switch(this.geometryType){case "point":case "mesh":f.regularVertices=
k;f.activeVertex=t;f.full=g.arrayToPoint(b[0]);break;case "multipoint":f.regularVertices=k;f.activeVertex=t;0<l&&(f.full=n.createMultipoint(b,r));break;case "polyline":f.regularVertices=k;f.activeVertex=t;0<l&&(f.full=n.createPolyline([b],r,x));break;case "polygon":f.regularVertices=k;f.activeVertex=t;0<l&&(f.full=n.createPolygon([b],r,x,!0));break;case "circle":0<l&&(k=D.createViewAlignedCoordinateSystem(m,b[0]),1===l&&a.operationComplete?(a=b[0],t=k.makeMapPoint(a[0]+48*m.resolution,a[1]),f.circle=
n.createCircle([a,t],k,!0),f.full=null!=f.circle?f.circle.geometry:null):2===l&&(this.forceUniformSize?(f.circle=n.createCircle(b,k,this.centered),f.full=null!=f.circle?f.circle.geometry:null):(f.rectangle=n.createEllipse(b,k,this.centered),f.full=f.rectangle.geometry)));break;case "rectangle":0<l&&(k=D.createViewAlignedCoordinateSystem(m,b[0]),1===l&&a.operationComplete?(a=b[0],t=k.makeMapPoint(a[0]+48*m.resolution,a[1]),f.rectangle=n.createSquare([a,t],k,!0),f.full=f.rectangle.geometry):2===l&&
(f.rectangle=this.forceUniformSize?n.createSquare(b,k,this.centered):n.createRectangle(b,k,this.centered),f.full=f.rectangle.geometry));break;default:return null}switch(this.geometryType){case "polyline":f.outline=1<l?n.createPolyline([b],r,x):null;break;case "polygon":f.outline=1<l?n.createPolygon([b],r,x):null;break;case "circle":case "rectangle":f.outline="polygon"===f.full?.type?n.createPolygon(f.full.rings,r,x):null}return f};h.initializeGraphic=function(a){return null};h.onComplete=function(a){this._updateGraphic();
let b=null;if(this.drawOperation.isCompleted){const g=this._getCreateOperationGeometry({operationComplete:!0});null!=g&&(b=this._createOrUpdateGraphic(g.full).clone())}this._createOperationGeometry=null;this.emit("complete",{graphic:b,...a})};h.onCursorUpdate=function(a){this._updateGraphic();this.emit("cursor-update",a)};h.onDeactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()};h.onVertexAdd=function(a){this._updateGraphic();this.emit("vertex-add",a)};h.onVertexRemove=
function(a){this._updateGraphic();this.emit("vertex-remove",a)};h.onVertexUpdate=function(a){this._updateGraphic();this.emit("vertex-update",a)};h._updateGraphic=function(){const a=this._getCreateOperationGeometry();this._createOperationGeometry=a;null==a?this._destroyAllVisualisations():(null!=a.outline?this.handles.add(this.onOutlineChanged(a.outline),q.outline):this.handles.remove(q.outline),null!=a.regularVertices?this.handles.add(this.onRegularVerticesChanged(a.regularVertices),q.regularVertices):
this.handles.remove(q.regularVertices),null!=a.activeVertex?this.handles.add(this.onActiveVertexChanged(a.activeVertex),q.activeVertex):this.handles.remove(q.activeVertex),null!=a.full?this._createOrUpdateGraphic(a.full):this.handles.remove("create-operation-graphic"))};C._createClass(B,[{key:"_defaultElevation",get:function(){return p.createLength(this.defaultZ,"meters")}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},
{key:"centered",set:function(a){this._set("centered",a);this._updateGraphic()}},{key:"enabled",set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)}},{key:"forceUniformSize",set:function(a){this._set("forceUniformSize",a);this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(a){this._set("graphicSymbol",a);null!=this._graphic&&(this._graphic.symbol=a)}},{key:"updating",get:function(){return this.drawOperation?.updating??!1}},
{key:"_tooltipInfo",get:function(){const {drawOperation:a}=this;if(!a)return null;switch(this.geometryType){case "point":return this._drawPointTooltipInfo;case "polyline":return this._drawPolylineTooltipInfo;case "polygon":return this._drawPolygonTooltipInfo;case "rectangle":return this._drawRectangleTooltipInfo;case "circle":return this._drawCircleTooltipInfo;case "mesh":return this._drawMeshTooltipInfo;default:return null}}},{key:"_drawPointTooltipInfo",get:function(){const {view:a,graphic:b}=this,
g=b?.geometry;return"point"!==g?.type||"2d"===a.type&&0===this.defaultZ?null:new u.DrawPointTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:a.type,helpMessage:z.getDrawHelpMessage("point",g,a)})}},{key:"_drawPolylineTooltipInfo",get:function(){var a=this._createOperationGeometry;a=null!=a?a.full:null;if("polyline"!==a?.type)return null;const b=A.autoLengthByElevationMode(a,this._elevationMode),{view:g}=this;return new u.DrawPolylineTooltipInfo({tooltipOptions:this.tooltipOptions,
elevation:this._elevationTooltipDetail,totalLength:b??p.zeroMeters,viewType:g.type,helpMessage:z.getDrawHelpMessage("polyline",a,g)})}},{key:"_drawPolygonTooltipInfo",get:function(){var a=this._createOperationGeometry;a=null!=a?a.full:null;if("polygon"!==a?.type)return null;const b=G.autoAreaByElevationMode(a,this._elevationMode),{view:g}=this;return new u.DrawPolygonTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:b??p.zeroSquareMeters,viewType:g.type,helpMessage:z.getDrawHelpMessage("polygon",
a,g)})}},{key:"_drawMeshTooltipInfo",get:function(){const {view:a,graphic:b}=this,g=b?.geometry;return"mesh"!==g?.type||"2d"===a.type&&0===this.defaultZ?null:new u.DrawMeshTooltipInfo({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:a.type,helpMessage:z.getDrawHelpMessage("mesh",g,a)})}},{key:"_drawRectangleTooltipInfo",get:function(){return null==this.drawOperation?null:new u.DrawRectangleTooltipInfo({tooltipOptions:this.tooltipOptions,xSize:this._xSize??p.zeroMeters,
ySize:this._ySize??p.zeroMeters,area:this._fullGeometryArea??p.zeroSquareMeters})}},{key:"_drawCircleTooltipInfo",get:function(){if(null==this.drawOperation)return null;const a=this.forceUniformSize;return new u.DrawCircleTooltipInfo({tooltipOptions:this.tooltipOptions,radius:a?this._circleRadius??p.zeroMeters:null,xSize:a?null:this._xSize??p.zeroMeters,ySize:a?null:this._ySize??p.zeroMeters,area:this._fullGeometryArea??p.zeroSquareMeters})}},{key:"_circleRadius",get:function(){const a=this._createOperationGeometry;
return null!=a&&null!=a.circle&&null!=a.circle.center&&null!=a.circle.edge?A.autoHorizontalDistanceByElevationModeBetweenPoints(a.circle.center,a.circle.edge,this._elevationMode):null}},{key:"_xSize",get:function(){var a=this._createOperationGeometry;if(null==a?.rectangle)return null;({midpoints:a}=a.rectangle);return null!=a?A.autoHorizontalDistanceByElevationModeBetweenPoints(a.left,a.right,this._elevationMode):null}},{key:"_ySize",get:function(){var a=this._createOperationGeometry;if(null==a?.rectangle)return null;
({midpoints:a}=a.rectangle);return null!=a?A.autoHorizontalDistanceByElevationModeBetweenPoints(a.top,a.bottom,this._elevationMode):null}},{key:"_fullGeometryArea",get:function(){var a=this._createOperationGeometry;a=null!=a?a.full:null;return"polygon"!==a?.type?null:G.autoAreaByElevationMode(a,this._elevationMode)}},{key:"_elevationTooltipDetail",get:function(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}},{key:"_vertexTooltipElevation",get:function(){const {tooltipOptions:a,
view:b,drawOperation:g}=this;if(null==g)return this._defaultElevation;var m=g.stagedVertex??g.lastVertex;if(null==m||"2d"===b.type)return this._defaultElevation;m=(P.getConvertedElevation(b,m,g.elevationInfo,{mode:a.elevation.mode,offset:0})??0)*M.getMetersPerVerticalUnitForSR(m.spatialReference);return p.createLength(m,"meters")}},{key:"_elevationMode",get:function(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}}]);return B}(K.HandleOwnerMixin(J.EventedMixin(Q.InteractiveToolBase)));
d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_createOperationGeometry",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_defaultElevation",null);d.__decorate([e.property({value:!0})],c.DrawGraphicTool.prototype,"centered",null);d.__decorate([e.property({nonNullable:!0})],c.DrawGraphicTool.prototype,"defaultZ",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"drawOperation",void 0);d.__decorate([e.property({value:!0})],c.DrawGraphicTool.prototype,"enabled",
null);d.__decorate([e.property({value:!0})],c.DrawGraphicTool.prototype,"forceUniformSize",null);d.__decorate([e.property({constructOnly:!0})],c.DrawGraphicTool.prototype,"geometryType",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"graphic",null);d.__decorate([e.property({constructOnly:!0})],c.DrawGraphicTool.prototype,"graphicProperties",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"graphicSymbol",null);d.__decorate([e.property({constructOnly:!0})],c.DrawGraphicTool.prototype,
"hasZ",void 0);d.__decorate([e.property({constructOnly:!0,type:E})],c.DrawGraphicTool.prototype,"labelOptions",void 0);d.__decorate([e.property({constructOnly:!0})],c.DrawGraphicTool.prototype,"geometryToPlace",void 0);d.__decorate([e.property({constructOnly:!0})],c.DrawGraphicTool.prototype,"mode",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"snappingManager",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"snapToScene",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,
"tooltip",void 0);d.__decorate([e.property({constructOnly:!0,type:F})],c.DrawGraphicTool.prototype,"tooltipOptions",void 0);d.__decorate([e.property({readOnly:!0})],c.DrawGraphicTool.prototype,"type",void 0);d.__decorate([e.property({readOnly:!0})],c.DrawGraphicTool.prototype,"updating",null);d.__decorate([e.property({constructOnly:!0,nonNullable:!0})],c.DrawGraphicTool.prototype,"view",void 0);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_tooltipInfo",null);d.__decorate([e.property()],
c.DrawGraphicTool.prototype,"_drawPointTooltipInfo",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_drawPolylineTooltipInfo",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_drawPolygonTooltipInfo",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_drawMeshTooltipInfo",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_drawRectangleTooltipInfo",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_drawCircleTooltipInfo",null);d.__decorate([e.property()],
c.DrawGraphicTool.prototype,"_circleRadius",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_xSize",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_ySize",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_fullGeometryArea",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_elevationTooltipDetail",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,"_vertexTooltipElevation",null);d.__decorate([e.property()],c.DrawGraphicTool.prototype,
"_elevationMode",null);c.DrawGraphicTool=d.__decorate([N.subclass("esri.views.draw.DrawGraphicTool")],c.DrawGraphicTool);const q={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};c.CreateOperationGeometry=H;c.geometryTypeToDrawOperationGeometryType=function(w){switch(w){case "point":case "polyline":case "polygon":case "multipoint":return w;case "circle":case "rectangle":return"segment";case "mesh":return"point"}};Object.defineProperty(c,Symbol.toStringTag,
{value:"Module"})});