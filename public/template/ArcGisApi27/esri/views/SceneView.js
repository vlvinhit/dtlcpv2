// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/chunks/boundedPlane":function(){define("exports ./_rollupPluginBabelHelpers ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(ba=Z){return{plane:h.create(ba.plane),origin:f.clone(ba.origin),basis1:f.clone(ba.basis1),
basis2:f.clone(ba.basis2)}}function t(ba,aa,da){const ca=ia.get();ca.origin=ba;ca.basis1=aa;ca.basis2=da;ca.plane=h.wrap(0,0,0,0);D(ca);return ca}function w(ba,aa=m()){return x(ba.origin,ba.basis1,ba.basis2,aa)}function r(ba,aa){d.copy(aa.origin,ba.origin);d.copy(aa.basis1,ba.basis1);d.copy(aa.basis2,ba.basis2);h.copy(aa.plane,ba.plane)}function x(ba,aa,da,ca=m()){d.copy(ca.origin,ba);d.copy(ca.basis1,aa);d.copy(ca.basis2,da);D(ca);1E-6<Math.abs(d.dot(ca.basis1,ca.basis2)/(d.length(ca.basis1)*d.length(ca.basis2)))&&
Y.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(d.dot(ca.basis1,Q(ca)))&&Y.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-d.dot(Q(ca),ca.origin)-ca.plane[3])&&Y.warn("fromValues()","Plane offset is not consistent with plane origin");return ca}function D(ba){h.fromVectorsAndPoint(ba.basis2,ba.basis1,ba.origin,ba.plane)}function A(ba,aa,da){ba!==da&&w(ba,da);ba=d.scale(l.sv3d.get(),Q(ba),aa);d.add(da.origin,da.origin,ba);
da.plane[3]-=aa;return da}function v(ba,aa,da){B(aa,da);A(da,N(ba,ba.origin),da);return da}function B(ba,aa=m()){const da=(ba[2]-ba[0])/2,ca=(ba[3]-ba[1])/2;d.set(aa.origin,ba[0]+da,ba[1]+ca,0);d.set(aa.basis1,da,0,0);d.set(aa.basis2,0,ca,0);h.fromValues(0,0,1,0,aa.plane);return aa}function C(ba,aa,da){return h.intersectRay(ba.plane,aa,da)?S(ba,da):!1}function E(ba,aa,da){if(C(ba,aa,da))return da;ba=F(ba,aa,l.sv3d.get());d.add(da,aa.origin,d.scale(l.sv3d.get(),aa.direction,d.distance(aa.origin,ba)/
d.length(aa.direction)));return da}function F(ba,aa,da){const ca=ea.get();var na=ea.get();X(ba,aa,ca,na);na=Number.POSITIVE_INFINITY;for(const ua of oa){var qa=V(ba,ua,ja.get());const sa=l.sv3d.get();h.intersectLineSegment(ca,qa,sa)&&(qa=d.direction(l.sv3d.get(),aa.origin,sa),qa=Math.abs(p.acosClamped(d.dot(aa.direction,qa))),qa<na&&(na=qa,d.copy(da,sa)))}return na===Number.POSITIVE_INFINITY?M(ba,aa,da):da}function M(ba,aa,da){if(C(ba,aa,da))return da;const ca=ea.get(),na=ea.get();X(ba,aa,ca,na);
let qa=Number.POSITIVE_INFINITY;for(const sa of oa){var ua=V(ba,sa,ja.get());const pa=l.sv3d.get();h.intersectLineSegmentClamp(ca,ua,pa)&&(ua=z.distance2(aa,pa),h.isPointInside(na,pa)&&ua<qa&&(qa=ua,d.copy(da,pa)))}L(ba,aa.origin)<qa&&K(ba,aa.origin,da);return da}function K(ba,aa,da){var ca=h.projectPoint(ba.plane,aa,l.sv3d.get());aa=e.projectPointClamp(U(ba,ba.basis1),ca,-1,1,l.sv3d.get());ca=e.projectPointClamp(U(ba,ba.basis2),ca,-1,1,l.sv3d.get());d.subtract(da,d.add(l.sv3d.get(),aa,ca),ba.origin);
return da}function G(ba,aa,da){const {origin:ca,basis1:na,basis2:qa}=ba,ua=d.subtract(l.sv3d.get(),aa,ca);aa=n.projectPointSignedLength(na,ua);const sa=n.projectPointSignedLength(qa,ua);ba=n.projectPointSignedLength(Q(ba),ua);return d.set(da,aa,sa,ba)}function L(ba,aa){aa=G(ba,aa,l.sv3d.get());const {basis1:da,basis2:ca}=ba;ba=d.length(da);var na=d.length(ca);ba=Math.max(Math.abs(aa[0])-ba,0);na=Math.max(Math.abs(aa[1])-na,0);aa=aa[2];return ba*ba+na*na+aa*aa}function O(ba,aa){return Math.sqrt(L(ba,
aa))}function I(ba,aa){let da=Number.NEGATIVE_INFINITY;for(const na of oa){var ca=V(ba,na,ja.get());ca=e.distance2(ca,aa);ca>da&&(da=ca)}return Math.sqrt(da)}function H(ba,aa){return h.isPointInside(ba.plane,aa)&&S(ba,aa)}function J(ba,aa,da,ca){switch(da){case g.Axis.X:d.copy(ca,ba.basis1);d.normalize(ca,ca);break;case g.Axis.Y:d.copy(ca,ba.basis2);d.normalize(ca,ca);break;case g.Axis.Z:d.copy(ca,Q(ba))}return ca}function N(ba,aa){const da=-ba.plane[3];return n.projectPointSignedLength(Q(ba),aa)-
da}function R(ba,aa,da,ca){const na=N(ba,aa);ba=d.scale(ha,Q(ba),da-na);d.add(ca,aa,ba);return ca}function W(ba,aa){return d.exactEquals(ba.basis1,aa.basis1)&&d.exactEquals(ba.basis2,aa.basis2)&&d.exactEquals(ba.origin,aa.origin)}function T(ba,aa,da){ba!==da&&w(ba,da);q.invert(ma,aa);q.transpose(ma,ma);d.transformMat4(da.basis1,ba.basis1,ma);d.transformMat4(da.basis2,ba.basis2,ma);d.transformMat4(h.normal(da.plane),h.normal(ba.plane),ma);d.transformMat4(da.origin,ba.origin,aa);h.setOffsetFromPoint(da.plane,
da.plane,da.origin);return da}function P(ba,aa,da,ca){ba!==ca&&w(ba,ca);q.fromRotation(fa,aa,da);d.transformMat4(ca.basis1,ba.basis1,fa);d.transformMat4(ca.basis2,ba.basis2,fa);D(ca);return ca}function Q(ba){return h.normal(ba.plane)}function S(ba,aa){const da=d.subtract(l.sv3d.get(),aa,ba.origin);aa=d.squaredLength(ba.basis1);const ca=d.squaredLength(ba.basis2),na=d.dot(ba.basis1,da);ba=d.dot(ba.basis2,da);return 0>-na-aa&&0>na-aa&&0>-ba-ca&&0>ba-ca}function U(ba,aa){const da=ja.get();d.copy(da.origin,
ba.origin);d.copy(da.vector,aa);return da}function V(ba,aa,da){const {basis1:ca,basis2:na,origin:qa}=ba;ba=d.scale(l.sv3d.get(),ca,aa.origin[0]);const ua=d.scale(l.sv3d.get(),na,aa.origin[1]);d.add(da.origin,ba,ua);d.add(da.origin,da.origin,qa);ba=d.scale(l.sv3d.get(),ca,aa.direction[0]);aa=d.scale(l.sv3d.get(),na,aa.direction[1]);d.scale(da.vector,d.add(ba,ba,aa),2);return da}function X(ba,aa,da,ca){ba=Q(ba);h.fromVectorsAndPoint(ba,aa.direction,aa.origin,da);h.fromVectorsAndPoint(h.normal(da),ba,
aa.origin,ca)}const Y=y.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");b=b._createClass(function(){this.plane=h.create();this.origin=f.create();this.basis1=f.create();this.basis2=f.create()});const Z={plane:h.create(),origin:f.fromValues(0,0,0),basis1:f.fromValues(1,0,0),basis2:f.fromValues(0,1,0)},ea=new u.ObjectStack(h.create),ja=new u.ObjectStack(e.create),ha=f.create(),ia=new u.ObjectStack(()=>m()),oa=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,
1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ma=k.create(),fa=k.create();u=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,UP:Z,altitudeAt:N,axisAt:J,closestPoint:M,closestPointOnSilhouette:F,copy:w,copyWithoutVerify:r,create:m,distance:O,distance2:L,distanceToSilhouette:I,elevate:A,equals:W,extrusionContainsPoint:H,fromAABoundingRect:B,fromValues:x,intersectRay:C,intersectRayClosestSilhouette:E,normal:Q,projectPoint:K,projectPointLocal:G,rotate:P,setAltitudeAt:R,
setExtent:v,transform:T,updateUnboundedPlane:D,wrap:t},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.UP=Z;a.altitudeAt=N;a.axisAt=J;a.boundedPlane=u;a.closestPoint=M;a.closestPointOnSilhouette=F;a.copy=w;a.copyWithoutVerify=r;a.create=m;a.distance=O;a.distance2=L;a.distanceToSilhouette=I;a.elevate=A;a.equals=W;a.extrusionContainsPoint=H;a.fromAABoundingRect=B;a.fromValues=x;a.intersectRay=C;a.intersectRayClosestSilhouette=E;a.normal=Q;a.projectPoint=K;a.projectPointLocal=G;a.rotate=
P;a.setAltitudeAt=R;a.setExtent=v;a.transform=T;a.updateUnboundedPlane=D;a.wrap=t})},"esri/core/ObjectStack":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","./nextTick"],function(a,b,c){let y=function(){function p(q){this._allocator=q;this._items=[];this._itemsPtr=0;this._grow()}var u=p.prototype;u.get=function(){0===this._itemsPtr&&c.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};u._reset=function(){this._items.length=
Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};u._grow=function(){for(let q=0;q<Math.max(8,Math.min(this._items.length,1024));q++)this._items.push(this._allocator())};return b._createClass(p)}();a.ObjectStack=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,y,p,u){function q(n){return n?{origin:p.clone(n.origin),vector:p.clone(n.vector)}:{origin:p.create(),vector:p.create()}}function k(n,l){const m=z.get();m.origin=n;m.vector=l;return m}function d(n,l,m=q()){y.copy(m.origin,n);y.copy(m.vector,l);return m}function f(n,l){l=y.subtract(u.sv3d.get(),
l,n.origin);var m=y.dot(n.vector,l);const t=y.dot(n.vector,n.vector);m=b.clamp(m/t,0,1);n=y.subtract(u.sv3d.get(),y.scale(u.sv3d.get(),n.vector,m),l);return y.dot(n,n)}function g(n,l,m,t,w){const {vector:r,origin:x}=n;l=y.subtract(u.sv3d.get(),l,x);l=y.dot(r,l)/y.squaredLength(r);y.scale(w,r,b.clamp(l,m,t));return y.add(w,w,n.origin)}function e(n,l,m,t){const w=n.origin;var r=y.add(u.sv3d.get(),w,n.vector);n=l.origin;var x=y.add(u.sv3d.get(),n,l.vector),D=u.sv3d.get();l=u.sv3d.get();D[0]=w[0]-n[0];
D[1]=w[1]-n[1];D[2]=w[2]-n[2];l[0]=x[0]-n[0];l[1]=x[1]-n[1];l[2]=x[2]-n[2];if(1E-6>Math.abs(l[0])&&1E-6>Math.abs(l[1])&&1E-6>Math.abs(l[2]))return!1;x=u.sv3d.get();x[0]=r[0]-w[0];x[1]=r[1]-w[1];x[2]=r[2]-w[2];if(1E-6>Math.abs(x[0])&&1E-6>Math.abs(x[1])&&1E-6>Math.abs(x[2]))return!1;r=D[0]*l[0]+D[1]*l[1]+D[2]*l[2];var A=l[0]*x[0]+l[1]*x[1]+l[2]*x[2];const v=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],B=(x[0]*x[0]+x[1]*x[1]+x[2]*x[2])*v-A*A;if(1E-6>Math.abs(B))return!1;D=(r*A-(D[0]*x[0]+D[1]*x[1]+D[2]*x[2])*v)/B;
r=(r+A*D)/v;m&&(D=b.clamp(D,0,1),r=b.clamp(r,0,1));m=u.sv3d.get();A=u.sv3d.get();m[0]=w[0]+D*x[0];m[1]=w[1]+D*x[1];m[2]=w[2]+D*x[2];A[0]=n[0]+r*l[0];A[1]=n[1]+r*l[1];A[2]=n[2]+r*l[2];t.tA=D;t.tB=r;t.pA=m;t.pB=A;t.distance2=y.squaredDistance(m,A);return!0}const h={tA:0,tB:0,pA:p.create(),pB:p.create(),distance2:0},z=new c.ObjectStack(()=>q());a.closestLineSegmentDistance2=function(n,l){return e(n,l,!0,h)?h.distance2:null};a.closestLineSegmentPoint=function(n,l,m){return e(n,l,!0,h)?(y.copy(m,h.pA),
!0):!1};a.closestRayDistance2=function(n,l){if(e(n,k(l.origin,l.direction),!1,h)){const {tA:m,pB:t,distance2:w}=h;if(0<=m&&1>=m)return w;if(0>m)return y.squaredDistance(n.origin,t);if(1<m)return y.squaredDistance(y.add(u.sv3d.get(),n.origin,n.vector),t)}return null};a.copy=function(n,l=q()){return d(n.origin,n.vector,l)};a.create=q;a.distance=function(n,l){return Math.sqrt(f(n,l))};a.distance2=f;a.fromPoints=function(n,l,m=q()){y.copy(m.origin,n);y.subtract(m.vector,l,n);return m};a.fromValues=d;
a.pointAt=function(n,l,m){return y.add(m,n.origin,y.scale(m,n.vector,l))};a.projectPoint=function(n,l,m){return g(n,l,0,1,m)};a.projectPointClamp=g;a.wrap=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),y=b.VectorStack.createVec3f64(),p=b.VectorStack.createVec4f64(),u=b.VectorStack.createMat3f64(),q=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();
a.sm3d=u;a.sm4d=q;a.sq4d=b;a.sv2d=c;a.sv3d=y;a.sv4d=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./ByteSizeUnit ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),function(a,b,c,y,p,u,q,k,d,f){let g=function(){function h(n,l,m){this._itemByteSize=n;this._itemCreate=l;this._buffers=[];this._items=[];this._itemsPtr=
0;this._itemsPerBuffer=Math.ceil(m/this._itemByteSize)}var z=h.prototype;z.get=function(){0===this._itemsPtr&&y.nextTick(()=>this._reset());const n=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=n;){const l=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let m=0;m<this._itemsPerBuffer;++m)this._items.push(this._itemCreate(l,m*this._itemByteSize));this._buffers.push(l)}return this._items[this._itemsPtr++]};z._reset=function(){const n=2*(Math.floor(this._itemsPtr/
this._itemsPerBuffer)+1);for(;this._buffers.length>n;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};h.createVec2f64=function(n=e){return new h(16,k.createView,n)};h.createVec3f64=function(n=e){return new h(24,d.createView,n)};h.createVec4f64=function(n=e){return new h(32,f.createView,n)};h.createMat3f64=function(n=e){return new h(72,p.createView,n)};h.createMat4f64=function(n=e){return new h(128,u.createView,n)};h.createQuatf64=function(n=e){return new h(32,
q.createView,n)};b._createClass(h,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}]);return h}();const e=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var b=a.ByteSizeUnit||(a.ByteSizeUnit={});b[b.KILOBYTES=1024]="KILOBYTES";b[b.MEGABYTES=1048576]="MEGABYTES";b[b.GIGABYTES=1073741824]="GIGABYTES";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(q){return[q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7],q[8]]}function y(q,k,d,f,g,e,h,z,n){return[q,k,d,f,g,e,h,z,n]}function p(q,k){return new Float64Array(q,k,9)}const u=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=
p;a.fromValues=y;a.mat3f64=u})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function c(k){return[k[0],k[1],k[2],k[3]]}function y(k,d,f,g){return[k,d,f,g]}function p(k,d){return new Float64Array(k,d,4)}const u=b(),q=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:u,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=u;a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.quatf64=q})},"esri/chunks/vec2f64":function(){define(["exports"],
function(a){function b(){return[0,0]}function c(l){return[l[0],l[1]]}function y(l,m){return[l,m]}function p(l){const m=[0,0],t=Math.min(2,l.length);for(let w=0;w<t;++w)m[w]=l[w];return m}function u(l,m){return new Float64Array(l,m,2)}function q(){return[0,0]}function k(){return[1,1]}function d(){return[1,0]}function f(){return[0,1]}const g=[0,0],e=[1,1],h=[1,0],z=[0,1],n=Object.freeze(Object.defineProperty({__proto__:null,ONES:e,UNIT_X:h,UNIT_Y:z,ZEROS:g,clone:c,create:b,createView:u,fromArray:p,
fromValues:y,ones:k,unitX:d,unitY:f,zeros:q},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=h;a.UNIT_Y=z;a.ZEROS=g;a.clone=c;a.create=b;a.createView=u;a.fromArray=p;a.fromValues=y;a.ones=k;a.unitX=d;a.unitY=f;a.vec2f64=n;a.zeros=q})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,b,c,y,p,u,q,k){function d(E=A){return[E[0],
E[1],E[2],E[3]]}function f(E,F){return g(F[0],F[1],F[2],F[3],E)}function g(E,F,M,K,G=d()){G[0]=E;G[1]=F;G[2]=M;G[3]=K;return G}function e(E,F,M){var K=F[0]*F[0]+F[1]*F[1]+F[2]*F[2];K=1E-5<Math.abs(K-1)&&1E-12<K?1/Math.sqrt(K):1;M[0]=F[0]*K;M[1]=F[1]*K;M[2]=F[2]*K;M[3]=-(M[0]*E[0]+M[1]*E[1]+M[2]*E[2]);return M}function h(E,F,M,K=d()){var G=M[0]-F[0],L=M[1]-F[1],O=M[2]-F[2];M=E[0]-F[0];const I=E[1]-F[1],H=E[2]-F[2];F=L*H-O*I;O=O*M-G*H;G=G*I-L*M;L=F*F+O*O+G*G;L=1E-5<Math.abs(L-1)&&1E-12<L?1/Math.sqrt(L):
1;K[0]=F*L;K[1]=O*L;K[2]=G*L;K[3]=-(K[0]*E[0]+K[1]*E[1]+K[2]*E[2]);return K}function z(E,F,M,K,G){const L=E.length/3;if(3>L)return!1;c.set(t,E[3*M],E[3*M+1],E[3*M+2]);let O=K;for(var I=!1;O<L-1&&!I;)I=3*O,c.set(w,E[I],E[I+1],E[I+2]),O++,I=!c.exactEquals(t,w);if(!I)return!1;O=Math.max(O,G);for(I=!1;O<L&&!I;)I=3*O,c.set(r,E[I],E[I+1],E[I+2]),O++,c.subtract(x,t,w),c.normalize(x,x),c.subtract(D,w,r),c.normalize(D,D),I=!c.exactEquals(t,r)&&!c.exactEquals(w,r)&&.99619469809>Math.abs(c.dot(x,D));if(!I)return 0===
M&&1===K&&2===G?!1:z(E,F,0,1,2);h(t,w,r,F);return!0}function n(E,F,M){E=c.scale(q.sv3d.get(),E,c.dot(E,F));c.subtract(M,F,E);return M}function l(E,F){return c.dot(E,F)+E[3]}function m(E,F,M,K,G){const L=c.dot(E,M);if(0===L)return!1;E=-(c.dot(E,F)+E[3])/L;K&v.CLAMP&&(E=b.clamp(E,0,1));if(!(K&v.INFINITE_MIN)&&0>E||!(K&v.INFINITE_MAX)&&1<E)return!1;c.add(G,F,c.scale(G,M,E));return!0}const t=y.create(),w=y.create(),r=y.create(),x=y.create(),D=y.create(),A=[0,0,1,0];var v;(function(E){E[E.NONE=0]="NONE";
E[E.CLAMP=1]="CLAMP";E[E.INFINITE_MIN=4]="INFINITE_MIN";E[E.INFINITE_MAX=8]="INFINITE_MAX"})(v||(v={}));const B=v.INFINITE_MIN|v.INFINITE_MAX,C=v.INFINITE_MAX;a.UP=A;a.clip=function(E,F){const M=c.dot(E,F.ray.direction);E=-l(E,F.ray.origin);if(0>E&&0<=M)return!1;if(-1E-6<M&&1E-6>M)return 0<E;if((0>E||0>M)&&!(0>E&&0>M))return!0;E/=M;0<M?E<F.c1&&(F.c1=E):E>F.c0&&(F.c0=E);return F.c0<=F.c1};a.clipInfinite=function(E,F){const M=c.dot(E,F.ray.direction);E=-l(E,F.ray.origin);if(-1E-6<M&&1E-6>M)return 0<
E;E/=M;0<M?E<F.c1&&(F.c1=E):E>F.c0&&(F.c0=E);return F.c0<=F.c1};a.copy=f;a.create=d;a.distance=function(E,F){return Math.abs(l(E,F))};a.fromManyPoints=function(E,F){return z(E,F,0,1,2)};a.fromManyPointsSampleAt=z;a.fromNormalAndOffset=function(E,F,M){c.copy(M,E);M[3]=F;return M};a.fromPoints=h;a.fromPositionAndNormal=e;a.fromValues=g;a.fromVectorsAndPoint=function(E,F,M,K){c.cross(r,F,E);return e(M,r,K)};a.intersectLine=function(E,F,M,K){M=c.subtract(q.sv3d.get(),M,F);return m(E,F,M,B,K)};a.intersectLineSegment=
function(E,F,M){return m(E,F.origin,F.vector,v.NONE,M)};a.intersectLineSegmentClamp=function(E,F,M){return m(E,F.origin,F.vector,v.CLAMP,M)};a.intersectRay=function(E,F,M){return null!=F?m(E,F.origin,F.direction,C,M):!1};a.isPointInside=function(E,F){return 0<=l(E,F)};a.isPointOutside=function(E,F){return 0>l(E,F)};a.isSphereFullyInside=function(E,F){return 0<=l(E,p.getCenter(F))-F[3]};a.isSphereFullyOutside=function(E,F){return 0>l(E,p.getCenter(F))+F[3]};a.negate=function(E,F){F[0]=-E[0];F[1]=-E[1];
F[2]=-E[2];F[3]=-E[3];return F};a.normal=function(E){return E};a.projectPoint=function(E,F,M){const K=c.scale(q.sv3d.get(),E,-E[3]);F=c.subtract(q.sv3d.get(),F,K);E=n(E,F,q.sv3d.get());c.add(M,E,K);return M};a.projectPointLocal=function(E,F,M,K){var G=q.sv3d.get(),L=q.sv3d.get();k.tangentFrame(E,G,L);F=c.subtract(q.sv3d.get(),M,F);G=u.projectPointSignedLength(G,F);L=u.projectPointSignedLength(L,F);E=u.projectPointSignedLength(E,F);return c.set(K,G,L,E)};a.projectVector=n;a.setOffsetFromPoint=function(E,
F,M){F!==E&&f(E,F);E[3]=-c.dot(E,M);return E};a.signedDistance=l;a.wrap=function(E=A[0],F=A[1],M=A[2],K=A[3]){return g(E,F,M,K,q.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(){return d.create()}
function n(Q,S=z()){return k.copy(S,Q)}function l(Q,S){return d.fromValues(Q[0],Q[1],Q[2],S)}function m(Q){return Q}function t(Q){Q[0]=Q[1]=Q[2]=Q[3]=0}function w(Q,S){Q[0]=Q[1]=Q[2]=0;Q[3]=S;return Q}function r(Q){return Q[3]}function x(Q){return Q}function D(Q,S,U,V){return d.fromValues(Q,S,U,V)}function A(Q,S,U){Q!==U&&u.copy(U,Q);U[3]=Q[3]+S;return U}function v(Q,S,U){c.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");return Q===U?U:n(Q,U)}function B(Q,
S,U){if(null==S)return!1;const {origin:V,direction:X}=S;var Y=R;Y[0]=V[0]-Q[0];Y[1]=V[1]-Q[1];Y[2]=V[2]-Q[2];S=X[0]*X[0]+X[1]*X[1]+X[2]*X[2];if(0===S)return!1;const Z=2*(X[0]*Y[0]+X[1]*Y[1]+X[2]*Y[2]);Q=Z*Z-4*S*(Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2]-Q[3]*Q[3]);if(0>Q)return!1;Y=Math.sqrt(Q);Q=(-Z-Y)/(2*S);S=(-Z+Y)/(2*S);if(0>Q||S<Q&&0<S)Q=S;if(0>Q)return!1;U&&(U[0]=V[0]+X[0]*Q,U[1]=V[1]+X[1]*Q,U[2]=V[2]+X[2]*Q);return!0}function C(Q,S){return B(Q,S,null)}function E(Q,S,U){if(B(Q,S,U))return U;Q=F(Q,S,h.sv3d.get());
u.add(U,S.origin,u.scale(h.sv3d.get(),S.direction,u.distance(S.origin,Q)/u.length(S.direction)));return U}function F(Q,S,U){const V=h.sv3d.get(),X=h.sm4d.get();u.cross(V,S.origin,S.direction);const Y=Q[3];u.cross(U,V,S.origin);u.scale(U,U,1/u.length(U)*Y);Q=L(Q,S.origin);S=e.angle(S.origin,U);p.fromRotation(X,S+Q,V);u.transformMat4(U,U,X);return U}function M(Q,S,U){if(B(Q,S,U))return U;g.closestPoint(S,Q,U);return K(Q,U,U)}function K(Q,S,U){S=u.subtract(h.sv3d.get(),S,Q);S=u.scale(h.sv3d.get(),S,
Q[3]/u.length(S));return u.add(U,S,Q)}function G(Q,S){S=u.subtract(h.sv3d.get(),S,Q);S=u.squaredLength(S);return Math.sqrt(Math.abs(S-Q[3]*Q[3]))}function L(Q,S){S=u.subtract(h.sv3d.get(),S,Q);S=u.length(S);Q=Q[3];return y.acosClamped(Q/(Q+Math.abs(Q-S)))}function O(Q,S,U,V){Q=u.subtract(W,S,Q);switch(U){case f.Axis.X:return U=y.cartesianToSpherical(Q,W)[2],u.set(V,-Math.sin(U),Math.cos(U),0);case f.Axis.Y:return Q=y.cartesianToSpherical(Q,W),U=Q[1],Q=Q[2],S=Math.sin(U),u.set(V,-S*Math.cos(Q),-S*
Math.sin(Q),Math.cos(U));case f.Axis.Z:return u.normalize(V,Q)}}function I(Q,S){S=u.subtract(T,S,Q);return u.length(S)-Q[3]}function H(Q,S,U,V){const X=I(Q,S);Q=O(Q,S,f.Axis.Z,T);U=u.scale(T,Q,U-X);return u.add(V,S,U)}function J(Q,S){S=u.squaredDistance(Q,S);Q=Q[3];return S<=Q*Q}function N(Q,S,U=z()){const V=u.distance(Q,S),X=Q[3],Y=S[3];if(V+Y<X)return k.copy(U,Q),U;if(V+X<Y)return k.copy(U,S),U;u.lerp(U,Q,S,(V+Y-X)/(2*V));U[3]=(V+X+Y)/2;return U}b=z();const R=q.create(),W=q.create(),T=q.create();
q=z();const P=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:b,altitudeAt:I,angleToSilhouette:L,axisAt:O,clear:t,closestPoint:M,closestPointOnSilhouette:F,containsPoint:J,copy:n,create:z,distanceToSilhouette:G,elevate:A,fromCenterAndRadius:l,fromRadius:w,fromValues:D,getCenter:x,getRadius:r,intersectRay:B,intersectRayClosestSilhouette:E,intersectsRay:C,projectPoint:K,setAltitudeAt:H,setExtent:v,tmpSphere:q,union:N,wrap:m},Symbol.toStringTag,{value:"Module"}));a.NullSphere=b;a.altitudeAt=
I;a.angleToSilhouette=L;a.axisAt=O;a.clear=t;a.closestPoint=M;a.closestPointOnSilhouette=F;a.containsPoint=J;a.copy=n;a.create=z;a.distanceToSilhouette=G;a.elevate=A;a.fromCenterAndRadius=l;a.fromRadius=w;a.fromValues=D;a.getCenter=x;a.getRadius=r;a.intersectRay=B;a.intersectRayClosestSilhouette=E;a.intersectsRay=C;a.projectPoint=K;a.setAltitudeAt=H;a.setExtent=v;a.sphere=P;a.tmpSphere=q;a.union=N;a.wrap=m})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,b,c,y,p,u){function q(e){return e?k(p.clone(e.origin),p.clone(e.direction)):k(p.create(),p.create())}function k(e,h){return{origin:e,direction:h}}function d(e,h,z=q()){y.copy(z.origin,e);y.copy(z.direction,h);return z}function f(e,h){e=y.cross(u.sv3d.get(),y.normalize(u.sv3d.get(),e.direction),y.subtract(u.sv3d.get(),h,e.origin));return y.dot(e,e)}const g=new c.ObjectStack(()=>q());a.closestPoint=function(e,h,z){h=y.dot(e.direction,y.subtract(z,h,e.origin));y.add(z,e.origin,y.scale(z,e.direction,
h));return z};a.copy=function(e,h=q()){return d(e.origin,e.direction,h)};a.create=q;a.distance=function(e,h){return Math.sqrt(f(e,h))};a.distance2=f;a.equals=function(e,h){return b.equals(e.origin,h.origin)&&b.equals(e.direction,h.direction)};a.fromPoints=function(e,h,z=q()){y.copy(z.origin,e);y.subtract(z.direction,h,e);return z};a.fromValues=d;a.wrap=function(e,h){const z=g.get();z.origin=e;z.direction=h;return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports",
"../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,c,y){const p=y.create(),u=y.create();a.angle=function(q,k){q=c.dot(q,k)/(c.length(q)*c.length(k));return-b.acosClamped(q)};a.angleAroundAxis=function(q,k,d){c.normalize(p,q);c.normalize(u,k);q=c.dot(p,u);q=b.acosClamped(q);k=c.cross(p,p,u);return 0>c.dot(k,d)?2*Math.PI-q:q};a.projectPoint=function(q,k,d){k=c.dot(q,k)/c.dot(q,q);return c.scale(d,q,k)};a.projectPointSignedLength=function(q,k){return c.dot(q,k)/c.length(q)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,y){const p=y.create(),u=y.create(),q=y.create(),k=y.create(),d=y.create();a.angle=function(f,g,e){f=c.normalize(k,f);g=c.normalize(d,g);const h=b.acosClamped(c.dot(f,g));return e&&(f=c.cross(q,f,g),0>c.dot(f,e))?-h:h};a.bilerp=function(f,g,e,h,z,n){f+=(g-f)*z;return f+(e+(h-e)*z-f)*
n};a.cosCapped=function(f,g){return f>g?Math.cos(g):Math.cos(f)};a.fovx2fovy=function(f,g,e){return 2*Math.atan(e*Math.tan(.5*f)/g)};a.fovy2fovx=function(f,g,e){return 2*Math.atan(g*Math.tan(.5*f)/e)};a.makeOrthonormal=function(f,g,e){e=e||f;const h=c.dot(f,g);c.set(e,f[0]-h*g[0],f[1]-h*g[1],f[2]-h*g[2]);c.normalize(e,e)};a.makePiecewiseLinearFunction=function(f){const g=f.length;return e=>{if(e<=f[0][0])return f[0][1];if(e>=f[g-1][0])return f[g-1][1];let h=1;for(;e>f[h][0];)h++;const z=f[h][0];e=
(z-e)/(z-f[h-1][0]);return e*f[h-1][1]+(1-e)*f[h][1]}};a.maxScale=function(f){return Math.sqrt(Math.max(f[0]*f[0]+f[4]*f[4]+f[8]*f[8],f[1]*f[1]+f[5]*f[5]+f[9]*f[9],f[2]*f[2]+f[6]*f[6]+f[10]*f[10]))};a.moduloPositive=function(f,g){return(f%g+g)%g};a.planeFromPoints=function(f,g,e,h){c.subtract(p,g,f);c.subtract(u,e,f);c.cross(h,p,u);c.normalize(h,h);h[3]=-c.dot(f,h)};a.scaleFromMatrix=function(f,g){c.set(f,Math.sqrt(g[0]*g[0]+g[4]*g[4]+g[8]*g[8]),Math.sqrt(g[1]*g[1]+g[5]*g[5]+g[9]*g[9]),Math.sqrt(g[2]*
g[2]+g[6]*g[6]+g[10]*g[10]));return f};a.slerp=function(f,g,e,h=y.create()){const z=c.length(f);var n=c.length(g),l=c.dot(f,g)/(z*n);if(.9999999999999999>l){l=Math.acos(l);const m=((1-e)*z+e*n)/Math.sin(l);n=m/n*Math.sin(e*l);c.scale(k,f,m/z*Math.sin((1-e)*l));c.scale(d,g,n);return c.add(h,k,d)}return c.lerp(h,f,g,e)};a.slerpTangent=function(f,g,e,h=y.create(),z=y.create()){const n=c.length(f),l=c.length(g);var m=c.dot(f,g)/(n*l);if(.9999999999999999>m){m=Math.acos(m);const t=Math.sin(m),w=Math.sin(e*
m),r=Math.sin((1-e)*m),x=(1-e)*n+e*l,D=x/t,A=D/l*w;c.scale(k,f,D/n*r);c.scale(d,g,A);c.add(h,k,d);c.scale(k,f,1/n*(-Math.cos((1-e)*m)*m*x+r*(-n+l)));c.scale(d,g,1/l*(Math.cos(e*m)*m*x+w*(-n+l)));c.add(z,k,d);c.scale(z,z,1/t);return z}c.lerp(h,f,g,e);c.subtract(z,g,f);c.normalize(z,z);return z};a.tangentFrame=function(f,g,e){Math.abs(f[0])>Math.abs(f[1])?c.set(g,0,1,0):c.set(g,1,0,0);c.cross(e,f,g);c.normalize(g,g);c.cross(g,e,f);c.normalize(e,e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,c,y,p,u,q,k,d,f){function g(t){return{operations:t,value:t.create()}}function e(t,w,r=g(t)){r.operations=t;t.copy(w,r.value);return r}function h(t,w,r,x){return t.operations.setAltitudeAt(t.value,w,r,x)}const z=2**50,n=y.create(),
l={operations:null,value:null},m=y.create();a.altitudeAt=function(t,w){return t.operations.altitudeAt(t.value,w)};a.axisAt=function(t,w,r,x){return t.operations.axisAt(t.value,w,r,x)};a.closestPoint=function(t,w,r){return t.operations.closestPoint(t.value,w,r)};a.closestPointOnSilhouette=function(t,w,r){return t.operations.closestPointOnSilhouette(t.value,w,r)};a.coordinateSystemFromOneAxisAndNormalVector=function(t,w,r,x,D){c.copy(r,t);c.copy(m,w);c.normalize(m,m);c.cross(x,m,r);c.cross(D,x,r)};
a.create=function(t){const {value:w,operations:r}=t;return{operations:r,value:r.create(w)}};a.createFromOperations=g;a.createGlobal=function(t){return e(f.sphere,f.fromValues(0,0,0,p.getReferenceEllipsoid(t).radius))};a.createLocal=function(){return e(d.boundedPlane,d.fromValues([0,0,0],[z,0,0],[0,z,0]))};a.distanceToSilhouette=function(t,w){return t.operations.distanceToSilhouette(t.value,w)};a.elevate=function(t,w,r){return t.operations.elevate(t.value,w,r.value)};a.fromValues=e;a.intersectRay=
function(t,w,r){return t.operations.intersectRay(t.value,w,r)};a.intersectRayClosestSilhouette=function(t,w,r){return t.operations.intersectRayClosestSilhouette(t.value,w,r)};a.intersectsRay=function(t,w){return t.operations.intersectRay(t.value,w,null)};a.normalAt=function(t,w,r){return t.operations.axisAt(t.value,w,k.Axis.Z,r)};a.renderSRFromViewSR=function(t,w){return t?q.getSphericalPCPF(w):w.isGeographic?u.PlateCarree:w};a.setAltitudeAt=h;a.setAltitudeOfTransformation=function(t,w,r,x){w!==x&&
b.copy(x,w);c.set(n,x[12],x[13],x[14]);h(t,n,r,n);x[12]=n[0];x[13]=n[1];x[14]=n[2];return x};a.setExtent=function(t,w,r){t.operations.setExtent(t.value,w,r.value);return r};a.vectorCoordinates=function(t,w,r,x,D){D[0]=c.dot(t,w);D[1]=c.dot(t,r);D[2]=c.dot(t,x);return D};a.wrap=function(t,w){l.operations=t;l.value=w;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference",
"./support/spatialReferenceUtils"],function(a,b,c,y){const p=new c(b.SphericalECEFSpatialReferenceLike),u=new c(b.SphericalPCPFMarsLike),q=new c(b.SphericalPCPFMoonLike);b=new c(b.WGS84ECEFSpatialReferenceLike);a.SphericalECEFSpatialReference=p;a.SphericalPCPFMars=u;a.SphericalPCPFMoon=q;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(k){return k&&(y.isMars(k)||y.equals(k,u))?u:k&&(y.isMoon(k)||y.equals(k,q))?q:p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports",
"../../core/unitUtils"],function(a,b){function c(y,p){p=b.getMetersPerUnitForSR(p);return y/(p*b.inchesPerMeter*96)}a.getExtentForScale=function(y,p){const u=y.extent;y=y.width-(y.padding?y.padding.left+y.padding.right:0);p=c(p,u.spatialReference);return u.clone().expand(p*y/u.width)};a.getResolutionForScale=c;a.getResolutionInMetersForScale=function(y){return y/(96*b.inchesPerMeter)};a.getScale=function(y,p){p=p||y.extent;y=y.width;const u=b.getMetersPerUnitForSR(p&&p.spatialReference);return p&&
y?p.width/y*u*b.inchesPerMeter*96:0};a.getScaleForResolution=function(y,p){p=b.getMetersPerUnitForSR(p);return y*p*b.inchesPerMeter*96};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(l,m){return m?z[l].valueToClassName[m].split(" "):[]}const z={widthBreakpoint:{getValue(l){const m=l.viewSize[0];l=l.breakpoints;const t=this.values;return m<=l.xsmall?t.xsmall:m<=l.small?t.small:m<=l.medium?t.medium:m<=l.large?t.large:t.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(l){const m=l.viewSize[1];l=l.breakpoints;const t=this.values;return m<=l.xsmall?t.xsmall:m<=l.small?t.small:m<=l.medium?t.medium:m<=l.large?t.large:t.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(l){l=l.viewSize;const m=this.values;return l[1]>=l[0]?m.portrait:m.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},n={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
l=>{l=function(m){function t(...r){r=m.call(this,...r)||this;r._breakpointsHandles=new p;r.orientation=null;r.widthBreakpoint=null;r.heightBreakpoint=null;r.breakpoints=n;return r}b._inherits(t,m);var w=t.prototype;w.initialize=function(){this._breakpointsHandles.add(q.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),q.initial))};w.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=u.destroyMaybe(this._breakpointsHandles))};w._updateClassNames=
function(){if(this.container){var r=y.acquire(),x=y.acquire(),D=!1,A;for(A in z){const v=this[A],B=z[A].getValue({viewSize:this.size,breakpoints:this.breakpoints});v!==B&&(D=!0,this[A]=B,h(A,v).forEach(C=>x.push(C)),h(A,B).forEach(C=>r.push(C)))}D&&(this._applyClassNameChanges(r,x),y.release(r),y.release(x))}};w._applyClassNameChanges=function(r,x){const D=this.container;D&&(x.forEach(A=>D.classList.remove(A)),r.forEach(A=>D.classList.add(A)))};w._removeActiveClassNames=function(){const r=this.container;
if(r)for(var x in z)h(x,this[x]).forEach(D=>r.classList.remove(D))};b._createClass(t,[{key:"breakpoints",set:function(r){var x=this._get("breakpoints");if(r!==x){x=(x=r)&&x.xsmall<x.small&&x.small<x.medium&&x.medium<x.large;if(!x){const D=JSON.stringify(n,null,2);console.warn("provided breakpoints are not valid, using defaults:"+D)}r=x?r:n;this._set("breakpoints",{...r})}}}]);return t}(l);c.__decorate([k.property()],l.prototype,"breakpoints",null);c.__decorate([k.property()],l.prototype,"orientation",
void 0);c.__decorate([k.property()],l.prototype,"widthBreakpoint",void 0);c.__decorate([k.property()],l.prototype,"heightBreakpoint",void 0);return l=c.__decorate([e.subclass("esri.views.BreakpointsOwner")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(m){m&&(y.empty(m),m.parentNode&&m.parentNode.removeChild(m))}const l=[0,0];a.DOMContainer=m=>{m=function(t){function w(...x){var D=t.call(this,...x)||this;D._freqInfo={freq:16,time:750};D._overlayRenderTaskHandle=null;D.height=0;D.overlay=null;D.position=null;D.resizing=!1;D.root=null;D.surface=null;D.suspended=!0;D.ui=null;D.userContent=null;D.width=0;D.widthBreakpoint=null;D.addHandles([q.watch(()=>D.cursor,A=>{const {surface:v}=b._assertThisInitialized(D);
v&&v.setAttribute("data-cursor",A)}),q.watch(()=>D.navigating,A=>{const {surface:v}=b._assertThisInitialized(D);v&&v.setAttribute("data-navigating",A.toString())})]);return D}b._inherits(w,t);var r=w.prototype;r.initialize=function(){this.addHandles([q.watch(()=>this.ui,(x,D)=>this._handleUIChange(x,D),q.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};r.destroy=function(){this.destroyed||(this.ui=u.destroyMaybe(this.ui),this.container=
null)};r.blur=function(){this.surface?.blur()};r.focus=function(){this.surface?.focus()};r.pageToContainer=function(x,D,A){const v=this.position;x-=v?v[0]:0;D-=v?v[1]:0;A?(A[0]=x,A[1]=D):A=[x,D];return A};r.containerToPage=function(x,D,A){const v=this.position;x+=v?v[0]:0;D+=v?v[1]:0;A?(A[0]=x,A[1]=D):A=[x,D];return A};r._handleUIChange=function(x,D){this.removeHandles("ui");D&&D!==x&&D.destroy();x&&(x.view=this,this.addHandles(q.watch(()=>this.root,A=>{if(A){const v=document.createElement("div");
A.appendChild(v);A=v}else A=null;x.container=A},q.initial),"ui"));this._set("ui",x)};r._stopMeasuring=function(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)};r._startMeasuring=function(){const x=this._freqInfo;x.freq=16;x.time=750;this.addHandles([(()=>{const D=()=>{x.freq=16;x.time=750};window.addEventListener("resize",D);return{remove(){window.removeEventListener("resize",D)}}})(),k.addFrameTask({prepare:D=>{const A=this._measure(),v=this._freqInfo;v.time+=D.deltaTime;
A&&(v.freq=16,this._get("resizing")||this._set("resizing",!0));v.time<v.freq||(v.time=0,this._position()||A?v.freq=16:v.freq=Math.min(750,2*v.freq),!A&&512<=v.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};r._measure=function(){var x=this.container;const D=x?x.clientWidth:0;x=x?x.clientHeight:0;if(0===D||0===x)return this.suspended||this._set("suspended",!0),!1;const A=this.width,v=this.height;if(D===A&&x===v)return this.suspended&&this._set("suspended",
!1),!1;this._set("width",D);this._set("height",x);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:A,oldHeight:v,width:D,height:x});return!0};r._position=function(){var x=this.container;const D=this.position;var A;if(A=x)A=(x.ownerDocument||window.document).defaultView,x=x.getBoundingClientRect(),l[0]=x.left+(A?.pageXOffset??0),l[1]=x.top+(A?.pageYOffset??0),A=l;x=A;return x?D&&x[0]===D[0]&&x[1]===D[1]?!1:(this._set("position",[x[0],x[1]]),!0):!1};r.forceDOMReadyCycle=function(){};
b._createClass(w,[{key:"container",get:function(){return this._get("container")??null},set:function(x){var D=this._get("container");const A=y.byId(x);A||"string"!==typeof x||p.getLogger(this).error("#container",`element with id '${x}' not found`);if(D!==A)if(this._stopMeasuring(),D&&(D.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(n(this.root),
this._set("root",null)),this.userContent&&(y.reparent(this.userContent,D),n(this.userContent),this._set("userContent",null))),A){A.classList.add("esri-view");x=document.createElement("div");x.className="esri-view-user-storage";y.reparent(A,x);A.appendChild(x);this._set("userContent",x);x=document.createElement("div");x.className="esri-view-root";A.insertBefore(x,A.firstChild);this._set("root",x);D=document.createElement("div");D.className="esri-view-surface";D.setAttribute("role","application");D.tabIndex=
0;x.appendChild(D);this._set("surface",D);var v=new z;x.appendChild(v.surface);this._set("overlay",v);this.addHandles(q.watch(()=>v.needsRender,B=>{this._overlayRenderTaskHandle=B&&!this._overlayRenderTaskHandle?k.addFrameTask({render:()=>this.overlay?.render()}):u.removeMaybe(this._overlayRenderTaskHandle)}));this.forceDOMReadyCycle();this._set("container",A);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",
null),this._set("container",null)}},{key:"focused",get:function(){const x=document.activeElement===this.surface;return document.hasFocus()&&x}},{key:"size",get:function(){return[this.width,this.height]}}]);return w}(m);c.__decorate([d.property()],m.prototype,"container",null);c.__decorate([d.property({readOnly:!0})],m.prototype,"focused",null);c.__decorate([d.property({readOnly:!0})],m.prototype,"height",void 0);c.__decorate([d.property({type:z})],m.prototype,"overlay",void 0);c.__decorate([d.property({readOnly:!0})],
m.prototype,"position",void 0);c.__decorate([d.property({readOnly:!0})],m.prototype,"resizing",void 0);c.__decorate([d.property({readOnly:!0})],m.prototype,"root",void 0);c.__decorate([d.property({value:null,readOnly:!0})],m.prototype,"size",null);c.__decorate([d.property({readOnly:!0})],m.prototype,"surface",void 0);c.__decorate([d.property({readOnly:!0})],m.prototype,"suspended",void 0);c.__decorate([d.property()],m.prototype,"ui",void 0);c.__decorate([d.property({readOnly:!0})],m.prototype,"userContent",
void 0);c.__decorate([d.property({readOnly:!0})],m.prototype,"width",void 0);c.__decorate([d.property()],m.prototype,"widthBreakpoint",void 0);return m=c.__decorate([h.subclass("esri.views.DOMContainer")],m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){c=function(h){function z(){var l=h.apply(this,arguments)||this;l.items=new y;l._watchUpdatingTracking=new f.WatchUpdatingTracking;l._callbacks=new Map;l._projector=e.createProjector();l._hiddenProjector=e.createProjector();return l}a._inherits(z,h);var n=z.prototype;n.initialize=function(){const l=document.createElement("div");l.className="esri-overlay-surface";this._set("surface",l);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");l.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,m=>{for(const t of m.added){const w=()=>t.render();this._callbacks.set(t,w);this._projector.append(this.surface,w)}for(const t of m.removed)m=this._projector.detach(this._callbacks.get(t)),this.surface.removeChild(m.domNode),this._callbacks.delete(t)})};n.addItem=function(l){this.items.add(l)};n.removeItem=function(l){this.items.remove(l)};n.destroy=function(){this.items.removeAll();
this._callbacks.forEach(l=>this._projector.detach(l));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};n.render=function(){this._projector.renderNow()};n.computeBoundingRect=function(l){const m=this._hiddenSurface,t=this._hiddenProjector;let w;const r=()=>w=l.render();t.append(m,r);t.renderNow();const x={left:0,top:0,right:0,bottom:0};if(w&&w.domNode){const D=w.domNode.getBoundingClientRect();x.left=D.left;x.top=D.top;x.right=D.right;x.bottom=D.bottom}for(t.detach(r);m.firstChild;)m.removeChild(m.firstChild);
return x};n.overlaps=function(l,m){l=this.computeBoundingRect(l);m=this.computeBoundingRect(m);return Math.max(l.left,m.left)<=Math.min(l.right,m.right)&&Math.max(l.top,m.top)<=Math.min(l.bottom,m.bottom)};n.prepare=async function(){await document.fonts.load(this._fontString()).catch(()=>{})};n.renderCanvas=function(l){if(this.items.some(t=>t.visible)){var m=l.getContext("2d");m.save();m.font=this._fontString();this.items.forEach(t=>{m.save();t.renderCanvas(m);m.restore()});m.restore()}};n._fontString=
function(){return`10px ${getComputedStyle(this.surface).fontFamily}`};a._createClass(z,[{key:"needsRender",get:function(){return 0<this.items.length}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some(l=>l.visible)}}]);return z}(c);b.__decorate([p.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([p.property({readOnly:!0})],
c.prototype,"needsRender",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"updating",null);return c=b.__decorate([d.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){c=function(e){function h(n){n=e.call(this,n)||this;n.view=null;n.layerViews=new y;return n}a._inherits(h,e);var z=h.prototype;z.initialize=function(){this.addHandles(p.when(()=>this.view?.map?.ground,n=>n.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};z.destroy=function(){this.removeAllHandles();this._set("view",null);for(const n of this.layerViews)n.destroy();this.layerViews.length=0};z._layerViewsAfterChangesHandler=
function(){this.removeHandles("updating");this.addHandles(this.layerViews.map(n=>p.watch(()=>n.updating,()=>this._updateUpdating(),p.sync)).toArray(),"updating");this._updateUpdating()};z._updateUpdating=function(){this.notifyChange("updating")};a._createClass(h,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new g({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?
!1:this.layerViews.some(n=>n.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return h}(c);b.__decorate([u.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([u.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([u.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([u.property({type:y,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"suspended",
null);return c=b.__decorate([f.subclass("esri.views.GroundView")],c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){c=function(n){function l(t){t=n.call(this,t)||this;t.demResolution={min:-1,max:-1};t.noDataValue=z.ELEVATION_NODATA_VALUE;return t}a._inherits(l,n);var m=l.prototype;m.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};m.elevationAt=function(t,w){if(null==this.extent||!e.extentContainsXYZ(this.extent,t,w)){const r=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:
null;y.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${t}, ${w}) is outside of the sampler extent (${r})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(t,w,0,this.spatialReference,"ground")??this.noDataValue};m.queryElevation=function(t){return h.updateGeometryElevation(t.clone(),this)};a._createClass(l,[{key:"extent",get:function(){const t=this.view.basemapTerrain;if(null==t||null==t.extent||null==t.spatialReference)return null;const w=g.toExtent(t.extent,
t.spatialReference);w.zmin=t.visibleElevationBounds.min;w.zmax=t.visibleElevationBounds.max;return w}},{key:"spatialReference",get:function(){return this.view.basemapTerrain?.spatialReference??f.WGS84}}]);return l}(c.EventedAccessor);b.__decorate([p.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([p.property()],c.prototype,"spatialReference",
null);b.__decorate([p.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(a,b,c,y,p,u,q,k,d){function f(l,m){const t=
g(l,m.spatialReference);if(!t)return null;switch(l.type){case "point":l.z=m.elevationAt(t.x,t.y);break;case "polyline":z.spatialReference=t.spatialReference;var w=l.hasM&&!l.hasZ;for(var r=0;r<l.paths.length;r++){var x=l.paths[r],D=t.paths[r];for(let A=0;A<x.length;A++){const v=x[A],B=D[A];z.x=B[0];z.y=B[1];w&&(v[3]=v[2]);v[2]=m.elevationAt(z.x,z.y)}}l.hasZ=!0;break;case "multipoint":z.spatialReference=t.spatialReference;w=l.hasM&&!l.hasZ;for(r=0;r<l.points.length;r++)x=l.points[r],D=t.points[r],
z.x=D[0],z.y=D[1],w&&(x[3]=x[2]),x[2]=m.elevationAt(z.x,z.y);l.hasZ=!0}return l}function g(l,m){if(null==l)return null;const t=l.spatialReference;if(t.equals(m))return l;(l=k.project(l,m))||e.error(`Cannot project geometry spatial reference (wkid:${t.wkid}) to elevation sampler spatial reference (wkid:${m.wkid})`);return l}const e=p.getLogger("esri.layers.support.ElevationSampler");c=function(){function l(){}var m=l.prototype;m.queryElevation=function(t){return f(t.clone(),this)};m.on=function(){return n};
m.projectIfRequired=function(t,w){return g(t,w)};return b._createClass(l)}();let h=function(l){function m(w,r,x){var D=l.call(this)||this;D.tile=w;D.noDataValue=x;x=w.tile.extent;D.extent=q.toExtent(x,r.spatialReference);D.extent.zmin=w.zmin;D.extent.zmax=w.zmax;D._aaExtent=x;x=u.getMetersPerUnitForSR(r.spatialReference);w=r.lodAt(w.tile.level).resolution*x;D.demResolution={min:w,max:w};return D}b._inherits(m,l);var t=m.prototype;t.contains=function(w){w=this.projectIfRequired(w,this.spatialReference);
return null==w?!1:this.containsAt(w.x,w.y)};t.containsAt=function(w,r){return q.containsXY(this._aaExtent,w,r)};t.elevationAt=function(w,r){if(!this.containsAt(w,r)){const x=this.extent;e.warn("#elevationAt()",`Point used to sample elevation (${w}, ${r}) is outside of the sampler extent (${`${x.xmin}, ${x.ymin}, ${x.xmax}, ${x.ymax}`})`);return this.noDataValue}return this.tile.sample(w,r)??this.noDataValue};b._createClass(m,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);
return m}(c);y=function(l){function m(t,w,r){var x=l.call(this)||this;let D;"number"===typeof w?(x.noDataValue=w,D=null):(D=w,x.noDataValue=r);x.samplers=D?t.map(A=>new h(A,D,x.noDataValue)):t;if(t=x.samplers[0]){x.extent=t.extent.clone();const {min:A,max:v}=t.demResolution;x.demResolution={min:A,max:v};for(t=1;t<x.samplers.length;t++)w=x.samplers[t],x.extent.union(w.extent),x.demResolution.min=Math.min(x.demResolution.min,w.demResolution.min),x.demResolution.max=Math.max(x.demResolution.max,w.demResolution.max)}else x.extent=
q.toExtent(q.create(),D.spatialReference),x.demResolution={min:0,max:0};return x}b._inherits(m,l);m.prototype.elevationAt=function(t,w){for(const r of this.samplers)if(r.containsAt(t,w))return r.elevationAt(t,w);e.warn("#elevationAt()",`Point used to sample elevation (${t}, ${w}) is outside of the sampler`);return this.noDataValue};b._createClass(m,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return m}(c);const z=new d,n={remove(){}};a.ElevationSamplerBase=c;a.MultiTileElevationSampler=
y;a.TileElevationSampler=h;a.updateGeometryElevation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,y){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const p=c.create();y.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,p);c=c.create([-180,-90,180,90]);let u=3;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=
c;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=2;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=p;a.getElevationDesiredResolutionLevel=function(q){return 4>q?3:u};a.test={setElevationDesiredMaxUpscalingDistance(q){u=
null==q?3:q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(){return new y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}c=function(){function t(r){var x=t.checkUnsupported(r);if(null!=x)throw x;this.spatialReference=r.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=k.canProjectToWGS84ComparableLonLat(this.spatialReference)||g.isMars(this.spatialReference)||g.isMoon(this.spatialReference);this.origin=[r.origin.x,r.origin.y];this.pixelSize=
r.size[0];this.dpi=r.dpi;var D=r.lods.reduce((B,C,E)=>{C.level<B.min&&(B.min=C.level,B.minIndex=E);B.max=Math.max(B.max,C.level);return B},{min:Infinity,minIndex:0,max:-Infinity}),A=r.lods[D.minIndex];const v=2**A.level;x=A.resolution*v;A=A.scale*v;this.levels=Array(D.max+1);for(D=0;D<this.levels.length;D++)this.levels[D]={resolution:x,scale:A,tileSize:[x*r.size[0],x*r.size[1]]},x/=2,A/=2}var w=t.prototype;w.clone=function(){return new t(this.toTileInfo())};w.toTileInfo=function(){return new z({dpi:this.dpi,
origin:new n({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((r,x)=>new h({level:x,scale:r.scale,resolution:r.resolution}))})};w.getExtent=function(r,x,D,A){var v=this.levels[r];r=v.tileSize[0];v=v.tileSize[1];A[0]=this.origin[0]+D*r;A[2]=this.origin[0]+(D+1)*r;A[3]=this.origin[1]-x*v;A[1]=this.origin[1]-(x+1)*v};w.convertExtentToRadians=function(r,x){this._isWebMercator?(x[0]=
e.x2lon(r[0]),x[1]=e.y2lat(r[1]),x[2]=e.x2lon(r[2]),x[3]=e.y2lat(r[3])):this._isGCS&&(x[0]=p.deg2rad(r[0]),x[1]=p.deg2rad(r[1]),x[2]=p.deg2rad(r[2]),x[3]=p.deg2rad(r[3]))};w.getExtentGeometry=function(r,x,D,A=new q){this.getExtent(r,x,D,m);A.spatialReference=this.spatialReference;A.xmin=m[0];A.ymin=m[1];A.xmax=m[2];A.ymax=m[3];A.zmin=void 0;A.zmax=void 0;return A};w.ensureMaxLod=function(r){if(null==r)return!1;for(var x=!1;this.levels.length<=r;){x=this.levels[this.levels.length-1];const D=x.resolution/
2;this.levels.push({resolution:D,scale:x.scale/2,tileSize:[D*this.pixelSize,D*this.pixelSize]});x=!0}return x};w.capMaxLod=function(r){this.levels.length>r+1&&(this.levels.length=r+1)};w.getMaxLod=function(){return this.levels.length-1};w.scaleAtLevel=function(r){return this.levels[0].scale/2**r};w.levelAtScale=function(r){const x=this.levels[0].scale;return r>=x?0:Math.log(x/r)*Math.LOG2E};w.resolutionAtLevel=function(r){return this.levels[0].resolution/2**r};w.compatibleWith=function(r){if(!(r instanceof
t)){if(t.checkUnsupported(r))return!1;r=new t(r)}if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const x=Math.min(this.levels.length,r.levels.length)-1,D=this.levels[x].resolution;let A=.5*D;if(!p.floatEqualAbsolute(r.origin[0],this.origin[0],A)||!p.floatEqualAbsolute(r.origin[1],this.origin[1],A))return!1;A=.5*D/2**x/this.pixelSize*12;return p.floatEqualAbsolute(D,r.levels[x].resolution,A)};w.rootTilesInExtent=function(r,x=null,D=Infinity){const A=[],v=
this.levels[0].tileSize;if(null==r||0===v[0]||0===v[1])return A;t.computeRowColExtent(r,v,this.origin,m);r=m[1];let B=m[3],C=m[0],E=m[2];var F=E-C;const M=B-r;F*M>D&&(D=Math.floor(Math.sqrt(D)),M>D&&(r=r+Math.floor(.5*M)-Math.floor(.5*D),B=r+D),F>D&&(C=C+Math.floor(.5*F)-Math.floor(.5*D),E=C+D));for(D=r;D<B;D++)for(F=C;F<E;F++)A.push([0,D,F]);null!=x&&(x[0]=this.origin[0]+C*v[0],x[1]=this.origin[1]-B*v[1],x[2]=this.origin[0]+E*v[0],x[3]=this.origin[1]-r*v[1]);return A};t.computeRowColExtent=function(r,
x,D,A){const v=.001*(r[2]-r[0]+(r[3]-r[1]));A[0]=Math.max(0,Math.floor((r[0]+v-D[0])/x[0]));A[2]=Math.max(0,Math.ceil((r[2]-v-D[0])/x[0]));A[1]=Math.max(0,Math.floor((D[1]-r[3]+v)/x[1]));A[3]=Math.max(0,Math.ceil((D[1]-r[1]-v)/x[1]))};t.isPowerOfTwo=function(r){r=r.lods;const x=r[0].resolution*2**r[0].level;return!r.some(D=>!p.floatEqualRelative(D.resolution,x/2**D.level))};t.hasGapInLevels=function(r){r=r.lods.map(x=>x.level);r.sort((x,D)=>x-D);for(let x=1;x<r.length;x++)if(r[x]!==r[0]+x)return!0;
return!1};t.tileSizeSupported=function(r){const x=r.size[1];return x===r.size[0]&&0===(x&x-1)&&128<=x&&512>=x};t.hasOriginPerLODs=function(r){const x=r.origin;return r.lods.some(D=>null!=D.origin&&(D.origin[0]!==x.x||D.origin[1]!==x.y))};t.getMissingTileInfoError=function(){return new y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};t.checkUnsupported=function(r){return null==r?l():1>r.lods.length?new y("tilingscheme:generic","Tiling scheme must have at least one level"):
t.isPowerOfTwo(r)?t.hasGapInLevels(r)?new y("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):t.tileSizeSupported(r)?t.hasOriginPerLODs(r)?new y("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new y("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new y("tilingscheme:power-of-two","Tiling scheme must be power of two")};t.fromExtent=function(r,x){const D=r[2]-r[0],A=r[3]-r[1],v=
u.getMetersPerUnitForSR(x),B=1.2*Math.max(D,A);r=new t(new z({size:[256,256],origin:new n({x:r[0]-.5*(B-D),y:r[3]+.5*(B-A)}),lods:[new h({level:0,resolution:B/256,scale:1/(256/96*.0254/(B*v))})],spatialReference:x}));r.ensureMaxLod(20);return r};t.makeWebMercatorAuxiliarySphere=function(r){const x=new t(t.WebMercatorAuxiliarySphereTileInfo);x.ensureMaxLod(r);return x};t.makeGCSWithTileSize=function(r,x=256,D=16){const A=256/x;r=new t(new z({size:[x,x],origin:new n({x:-180,y:90,spatialReference:r}),
spatialReference:r,lods:[new h({level:0,resolution:.703125*A,scale:2.95497598570834E8*A})]}));r.ensureMaxLod(D);return r};b._createClass(t,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return t}();c.WebMercatorAuxiliarySphereTileInfo=new z({size:[256,256],origin:new n({x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:d.WebMercator}),spatialReference:d.WebMercator,lods:[new h({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});
c.WebMercatorAuxiliarySphere=c.makeWebMercatorAuxiliarySphere(19);const m=f.create();a.TilingScheme=c;a.getMissingTileInfoError=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){var d;c=d=function(f){function g(e){e=f.call(this,e)||this;e.cols=null;e.level=0;e.levelValue=null;e.origin=null;e.resolution=0;e.rows=null;e.scale=0;return e}a._inherits(g,f);g.prototype.clone=function(){return new d({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return a._createClass(g)}(c.JSONSupport);b.__decorate([y.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,
write:!1}}}})],c.prototype,"cols",void 0);b.__decorate([y.property({type:p.Integer,json:{write:!0}})],c.prototype,"level",void 0);b.__decorate([y.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);b.__decorate([y.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);b.__decorate([y.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);b.__decorate([y.property({json:{write:!0,
origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0);b.__decorate([y.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=d=b.__decorate([k.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){var r;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});y=r=function(x){function D(v){v=x.call(this,v)||this;v.dpi=96;v.format=null;v.origin=null;v.size=null;v.spatialReference=null;return v}a._inherits(D,x);D.create=function(v={}){const {resolutionFactor:B=
1,scales:C,size:E=256,spatialReference:F=z.WebMercator,numLODs:M=24}=v;if(!l.isValid(F)){v=[];if(C)for(var K=0;K<C.length;K++){var G=C[K];v.push(new t({level:K,scale:G,resolution:G}))}else for(K=5E-4,G=M-1;0<=G;G--)v.unshift(new t({level:G,scale:K,resolution:K})),K*=2;return new r({dpi:96,lods:v,origin:new h(0,0,F),size:[E,E],spatialReference:F})}K=l.getInfo(F);v=v.origin?new h({x:v.origin.x,y:v.origin.y,spatialReference:F}):K?new h({x:K.origin[0],y:K.origin[1],spatialReference:F}):new h({x:0,y:0,
spatialReference:F});K=1/(39.37*p.getMetersPerUnitForSR(F)*96);G=[];if(C)for(var L=0;L<C.length;L++){var O=C[L];G.push(new t({level:L,scale:O,resolution:O*K}))}else{var I=l.isGeographic(F)?512/E*5.916575275917094E8:256/E*5.91657527591555E8;L=Math.ceil(M/B);G.push(new t({level:0,scale:I,resolution:I*K}));for(O=1;O<L;O++)I/=2**B,G.push(new t({level:O,scale:I,resolution:I*K}))}return new r({dpi:96,lods:G,origin:v,size:[E,E],spatialReference:F})};var A=D.prototype;A.readOrigin=function(v,B){return h.fromJSON({spatialReference:B.spatialReference,
...v})};A.readSize=function(v,B){return[B.cols,B.rows]};A.writeSize=function(v,B){B.cols=v[0];B.rows=v[1]};A.zoomToScale=function(v){const B=this.scales;if(0>=v)return B[0];if(v>=B.length-1)return B[B.length-1];const C=Math.floor(v);return B[C]/(B[C]/B[C+1])**(v-C)};A.scaleToZoom=function(v){const B=this.scales,C=B.length-1;let E=0;for(;E<C;E++){const F=B[E],M=B[E+1];if(F<=v)break;if(M===v)return E+1;if(F>v&&M<v)return E+Math.log(F/v)/Math.log(F/M)}return E};A.snapScale=function(v,B=.95){v=this.scaleToZoom(v);
return v%Math.floor(v)>=B?this.zoomToScale(Math.ceil(v)):this.zoomToScale(Math.floor(v))};A.tileAt=function(v,B,C,E){var F=this.lodAt(v);if(!F)return null;let M;if("number"===typeof B)M=B,B=C;else{if(l.equals(B.spatialReference,this.spatialReference))M=B.x,B=B.y;else{E=m.project(B,this.spatialReference);if(null==E)return null;M=E.x;B=E.y}E=C}C=F.resolution*this.size[0];F=F.resolution*this.size[1];E||(E=new w.TileKey(null,0,0,0,n.create()));E.level=v;E.row=Math.floor((this.origin.y-B)/F+.001);E.col=
Math.floor((M-this.origin.x)/C+.001);this.updateTileInfo(E);return E};A.updateTileInfo=function(v,B=r.ExtrapolateOptions.NONE){var C=this.lodAt(v.level);C||B!==r.ExtrapolateOptions.POWER_OF_TWO||(B=this.lods[this.lods.length-1],B.level<v.level&&(C=B));if(C){var E=v.level-C.level;B=C.resolution*this.size[0]/2**E;C=C.resolution*this.size[1]/2**E;v.id=`${v.level}/${v.row}/${v.col}`;v.extent||(v.extent=n.create());v.extent[0]=this.origin.x+v.col*B;v.extent[1]=this.origin.y-(v.row+1)*C;v.extent[2]=v.extent[0]+
B;v.extent[3]=v.extent[1]+C}};A.upsampleTile=function(v){const B=this._upsampleLevels[v.level];if(!B||-1===B.parentLevel)return!1;v.level=B.parentLevel;v.row=Math.floor(v.row/B.factor+.001);v.col=Math.floor(v.col/B.factor+.001);this.updateTileInfo(v);return!0};A.getTileBounds=function(v,B){var C=this.lodAt(B.level);if(null==C)return null;var {resolution:E}=C;C=E*this.size[0];E*=this.size[1];v[0]=this.origin.x+B.col*C;v[1]=this.origin.y-(B.row+1)*E;v[2]=v[0]+C;v[3]=v[1]+E;return v};A.lodAt=function(v){return this._levelToLOD?.[v]??
null};A.clone=function(){return r.fromJSON(this.write({}))};A.getOrCreateCompatible=function(v,B){if(256===this.size[0]&&256===this.size[1])return 256===v?this:null;const C=[],E=this.lods.length;for(let F=0;F<E;F++){const M=this.lods[F];C.push(new t({level:M.level,scale:M.scale,resolution:M.resolution*B}))}return new r({size:[v,v],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:C})};A._initializeUpsampleLevels=
function(){const v=this.lods;this._upsampleLevels=[];let B=null;for(let C=0;C<v.length;C++){const E=v[C];this._upsampleLevels[E.level]={parentLevel:B?B.level:-1,factor:B?B.resolution/E.resolution:0};B=E}};a._createClass(D,[{key:"isWrappable",get:function(){const {spatialReference:v,origin:B}=this;if(v&&B){const C=l.getInfo(v);return v.isWrappable&&!!C&&Math.abs(C.origin[0]-B.x)<=C.dx}return!1}},{key:"lods",set:function(v){const B=[],C=this._levelToLOD={};v&&v.forEach(E=>{B.push(E.scale);C[E.level]=
E});this._set("scales",B);this._set("lods",v);this._initializeUpsampleLevels()}}]);return D}(y.JSONSupport);b.__decorate([u.property({type:Number,json:{write:!0}})],y.prototype,"compressionQuality",void 0);b.__decorate([u.property({type:Number,json:{write:!0}})],y.prototype,"dpi",void 0);b.__decorate([u.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],y.prototype,"format",void 0);b.__decorate([u.property({readOnly:!0})],y.prototype,"isWrappable",null);
b.__decorate([u.property({type:h,json:{write:!0}})],y.prototype,"origin",void 0);b.__decorate([f.reader("origin")],y.prototype,"readOrigin",null);b.__decorate([u.property({type:[t],value:null,json:{write:!0}})],y.prototype,"lods",null);b.__decorate([u.property({readOnly:!0})],y.prototype,"scales",void 0);b.__decorate([u.property({cast:x=>Array.isArray(x)?x:"number"===typeof x?[x,x]:[256,256]})],y.prototype,"size",void 0);b.__decorate([f.reader("size",["rows","cols"])],y.prototype,"readSize",null);
b.__decorate([e.writer("size",{cols:{type:q.Integer},rows:{type:q.Integer}})],y.prototype,"writeSize",null);b.__decorate([u.property({type:z,json:{write:!0}})],y.prototype,"spatialReference",void 0);y=r=b.__decorate([g.subclass("esri.layers.support.TileInfo")],y);(function(x){x=x.ExtrapolateOptions||(x.ExtrapolateOptions={});x[x.NONE=0]="NONE";x[x.POWER_OF_TWO=1]="POWER_OF_TWO"})(y||(y={}));return y})},"esri/layers/support/TileKey":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(a,b){b=b._createClass(function(c,y,p,u,q){this.id=c;this.level=y;this.row=p;this.col=u;this.extent=q});a.TileKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/asyncUtils ../core/deprecate ../core/Error ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(r){return null!=r&&"open"in r&&"declaredClass"in r}function t(r){return null!=r&&"declaredClass"in r&&"dockOptions"in r}const w=r=>Object.freeze(Object.defineProperty({__proto__:null,default:r},Symbol.toStringTag,{value:"Module"}));b.PopupView=r=>{r=function(x){function D(){var v=x.apply(this,arguments)||this;v._popupSetupTask=null;v.popup={};v.popupEnabled=!0;return v}c._inherits(D,x);var A=D.prototype;A.initialize=function(){this.addHandles([f.watch(()=>
[this.ui,this.popup],([v,B],C)=>{if(C){const [E,F]=C;E&&m(F)&&(F.view=null,t(F)&&E.remove(F,"popup"))}v&&m(B)&&(B.view=this,t(B)&&v.add(B,{key:"popup",position:"manual",internal:!0}))},f.initial),this.on("click",v=>{this.popup&&this.popupEnabled&&("mouse"!==v.pointerType||0===v.button)&&(!m(this.popup)&&"autoOpenEnabled"in this.popup&&!1===this.popup.autoOpenEnabled||(m(this.popup)?this.popup.viewModel.handleViewClick(v):v.async(async()=>{await this.setupPopup();m(this.popup)&&!this.destroyed&&this.ready&&
this.popupEnabled&&this.popup.viewModel.handleViewClick(v)})))},l.ViewEventPriorities.WIDGET)]);f.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((v,B)=>a(["../widgets/Popup"],C=>v(w(C)),B))})};A.destroy=function(){this.destroyed||this.closePopup()};A.openPopup=async function(v){m(this.popup)&&this.popup.open(v);try{await this.setupPopup(),this.popup?this.popup.open(v):k.getLogger(this).error(new q("view:null-popup","Popup is null and can't be opened"))}catch{}};
A.closePopup=function(){this._popupSetupTask?.abort();m(this.popup)&&this.popup.close()};A.fetchPopupFeatures=async function(v,B){await this.when();const {location:C,queryArea:E,layerViewsAndGraphics:F,clientOnlyGraphics:M}=await this._prepareFetchPopupFeatures(v,B);v=Promise.resolve(M);B=this._queryLayerPopupFeatures(E,F,B);const K=B.map(G=>G.promise);v=d.eachAlwaysValues([v,...K]).then(G=>Array.from(new Set(G.flat())));return{location:C,clientOnlyGraphics:M,allGraphicsPromise:v,promisesPerLayerView:B}};
A.setupPopup=async function(){this._popupSetupTask?.abort();if(this.popup&&!m(this.popup))return this._popupSetupTask=p.createTask(async v=>{const {default:B}=await new Promise((C,E)=>a(["../widgets/Popup"],F=>C(w(F)),E));d.throwIfAborted(v);this.popup&&!m(this.popup)&&(v=this.popup,delete v.open,delete v.close,this.popup=new B(v))}),this._popupSetupTask.promise};A._queryLayerPopupFeatures=function(v,B,C){return B.map(({layerView:E,graphics:F})=>{F=E.fetchPopupFeatures(v,{clientGraphics:F,event:null!=
C?C.event:void 0,signal:null!=C?C.signal:void 0,defaultPopupTemplateEnabled:null!=C?!!C.defaultPopupTemplateEnabled:!1});return{layerView:E,promise:F}})};A._isValidPopupGraphic=function(v,B){return v&&!!v.getEffectivePopupTemplate(null!=B&&B.defaultPopupTemplateEnabled)};A._prepareFetchPopupFeatures=async function(v,B){const {clientGraphics:C,queryArea:E,location:F}=await this._popupHitTestGraphics(v,B);v=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:M,clientOnlyGraphics:K}=this._graphicsPerFetchPopupLayerView(C,
v);return{clientOnlyGraphics:K,layerViewsAndGraphics:M,queryArea:E,location:F}};A._popupHitTestGraphics=async function(v,B){var C=await this.popupHitTest(v);v=C.mapPoint;C=C.results.filter(F=>"graphic"===F.type&&this._isValidPopupGraphic(F.graphic,B));const E=C.length?C[0].mapPoint:null;return{clientGraphics:C.map(F=>F.graphic),queryArea:v,location:v||E}};A._getFetchPopupLayerViews=function(){const v=[];this.allLayerViews.forEach(B=>{this._isValidPopupLayerView(B)&&v.push(B)});null!=this.graphicsView&&
this._isValidPopupLayerView(this.graphicsView)&&v.push(this.graphicsView);return v.reverse()};A._isValidPopupLayerView=function(v){return null!=v&&(!("layer"in v)||!v.suspended)&&"fetchPopupFeatures"in v};A._graphicsPerFetchPopupLayerView=function(v,B){const C=[],E=new Map;B=B.map(F=>{const M=[];"layer"in F?E.set(F.layer,M):E.set(F.graphics,M);return{layerView:F,graphics:M}});for(const F of v)(v=E.get(F.layer)||E.get(F.sourceLayer)||null)?v.push(F):C.push(F);return{layerViewsAndGraphics:B,clientOnlyGraphics:C}};
return c._createClass(D)}(r);y.__decorate([g.property({cast(x){if(!x||m(x))return x;"object"===typeof x&&(x.open=D=>{u.deprecated(k.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"});return this.openPopup(D)},x.close=()=>{u.deprecated(k.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",
{replacement:"Use view.closePopup() instead.",version:"4.27"});return this.closePopup()});return x}})],r.prototype,"popup",void 0);y.__decorate([g.property()],r.prototype,"popupEnabled",void 0);return r=y.__decorate([n.subclass("esri.views.PopupView")],r)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(a,b,c){const y=k=>Object.freeze(Object.defineProperty({__proto__:null,
default:k},Symbol.toStringTag,{value:"Module"})),p=()=>new Promise((k,d)=>a(["./layers/TileLayerView3D"],f=>k(y(f)),d)),u=()=>new Promise((k,d)=>a(["./layers/ElevationLayerView3D"],f=>k(y(f)),d)),q={"base-dynamic":()=>new Promise((k,d)=>a(["./layers/BaseDynamicLayerView3D"],f=>k(y(f)),d)),"base-elevation":u,"base-tile":p,"bing-maps":p,"building-scene":()=>new Promise((k,d)=>a(["./layers/BuildingSceneLayerView3D"],f=>k(y(f)),d)),csv:()=>new Promise((k,d)=>a(["./layers/CSVLayerView3D"],f=>k(y(f)),d)),
dimension:()=>new Promise((k,d)=>a(["./layers/DimensionLayerView3D"],f=>k(y(f)),d)),elevation:u,feature:()=>new Promise((k,d)=>a(["./layers/FeatureLayerView3D"],f=>k(y(f)),d)),geojson:()=>new Promise((k,d)=>a(["./layers/GeoJSONLayerView3D"],f=>k(y(f)),d)),graphics:()=>new Promise((k,d)=>a(["./layers/GraphicsLayerView3D"],f=>k(y(f)),d)),group:()=>new Promise((k,d)=>a(["../layers/GroupLayerView"],f=>k(y(f)),d)),imagery:()=>new Promise((k,d)=>a(["./layers/ImageryLayerView3D"],f=>k(y(f)),d)),"integrated-mesh":()=>
new Promise((k,d)=>a(["./layers/IntegratedMeshLayerView3D"],f=>k(y(f)),d)),"line-of-sight":()=>new Promise((k,d)=>a(["./layers/LineOfSightLayerView3D"],f=>k(y(f)),d)),"map-image":()=>new Promise((k,d)=>a(["./layers/MapImageLayerView3D"],f=>k(y(f)),d)),media:()=>new Promise((k,d)=>a(["./layers/MediaLayerView3D"],f=>k(y(f)),d)),"ogc-feature":()=>new Promise((k,d)=>a(["./layers/OGCFeatureLayerView3D"],f=>k(y(f)),d)),"open-street-map":p,"oriented-imagery":()=>new Promise((k,d)=>a(["./layers/FeatureLayerView3D"],
f=>k(y(f)),d)),"point-cloud":()=>new Promise((k,d)=>a(["./layers/PointCloudLayerView3D"],f=>k(y(f)),d)),voxel:()=>new Promise((k,d)=>a(["./layers/VoxelLayerView3D"],f=>k(y(f)),d)),route:()=>new Promise((k,d)=>a(["./layers/RouteLayerView3D"],f=>k(y(f)),d)),scene:k=>null==k.profile||"mesh-pyramids"===k.profile?new Promise((d,f)=>a(["./layers/SceneLayerView3D"],g=>d(y(g)),f)):new Promise((d,f)=>a(["./layers/SceneLayerGraphicsView3D"],g=>d(y(g)),f)),stream:()=>new Promise((k,d)=>a(["./layers/StreamLayerView3D"],
f=>k(y(f)),d)),tile:p,"imagery-tile":()=>new Promise((k,d)=>a(["./layers/ImageryTileLayerView3D"],f=>k(y(f)),d)),"vector-tile":()=>new Promise((k,d)=>a(["./layers/VectorTileLayerView3D"],f=>k(y(f)),d)),wcs:()=>new Promise((k,d)=>a(["./layers/ImageryTileLayerView3D"],f=>k(y(f)),d)),"web-tile":p,wfs:()=>new Promise((k,d)=>a(["./layers/WFSLayerView3D"],f=>k(y(f)),d)),wms:()=>new Promise((k,d)=>a(["./layers/WMSLayerView3D"],f=>k(y(f)),d)),wmts:()=>new Promise((k,d)=>a(["./layers/WMTSLayerView3D"],f=>
k(y(f)),d)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};b.layerView3DImporter={hasLayerViewModule:k=>null!=q[k.type],importLayerView:k=>{var d=q[k.type];if(null==d)throw k=k.declaredClass?k.declaredClass.slice(k.declaredClass.lastIndexOf(".")+1):"Unknown",d=k.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new c(`${d}:view-not-supported`,`${k} is not supported in 3D`);
return d(k)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(){const t=f.createResolver();t.promise.catch(()=>{});return t}const n=t=>Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}));var l;(function(t){t[t.PENDING=0]="PENDING";t[t.CREATED=1]="CREATED"})(l||(l={}));var m;(function(t){t[t.ADDED=0]="ADDED";t[t.REMOVED=1]="REMOVED"})(m||(m={}));q=function(t){function w(x){x=t.call(this,x)||this;x._allAnalysisViews=new p;x._creatingViewCount=0;x._items=new Map;x._scheduledUpdateHandle=
null;x._attachedToViewResolver=z();x._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return x}b._inherits(w,t);var r=w.prototype;r.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(f.createAbortError("AnalysisViewManager was destroyed"))};r.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};r.detach=function(){this._disconnectOwners();
this._attachedToViewResolver.reject(f.createAbortError());this._attachedToViewResolver=z()};r.whenAnalysisView=async function(x){await this._attachedToViewResolver.promise;const D=this._items.get(x);if(null==D||D.state.list===m.REMOVED)throw new u("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:x});return D.createAnalysisViewTask.promise};r._connectOwners=function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")};r._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};r._connectAnalysesCollection=function(x){for(const v of x)this._addAnalysis(v);const D=x.on("after-add",v=>this._addAnalysis(v.item)),A=x.on("after-remove",v=>this._removeAnalysis(v.item));return{remove:()=>{D.remove();A.remove();for(const v of x)this._removeAnalysis(v)}}};r._addAnalysis=function(x){const D=this._items.get(x);if(null==D){const A={state:{view:l.PENDING,
list:m.ADDED},analysis:x,view:null,createAnalysisViewTask:null};this._items.set(x,A);A.createAnalysisViewTask=y.createTask(v=>this._createAnalysisViewPromise(A,v))}else D.state.list=m.ADDED};r._removeAnalysis=function(x){x=this._items.get(x);null==x?k.getLogger(this).error("Trying to remove analysis which was not added"):(x.state.list=m.REMOVED,this._scheduleUpdate())};r._scheduleUpdate=function(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=g.schedule(()=>this._update()))};r._update=
function(){this._scheduledUpdateHandle=d.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(x=>{if(x.state.list===m.REMOVED)switch(this._items.delete(x.analysis),x.state.view){case l.PENDING:x.createAnalysisViewTask=d.abortMaybe(x.createAnalysisViewTask);break;case l.CREATED:null!=x.view&&(this._allAnalysisViews.remove(x.view),x.view=d.destroyMaybe(x.view),x.createAnalysisViewTask=null)}})};r._createAnalysisViewPromise=async function(x,D){var A=x.analysis;const v=A.type,B=this._analysisModules[v];
this._creatingViewCount+=1;if(null==B.module)try{B.module=await this._loadAnalysisModule(v)}catch(C){throw--this._creatingViewCount,C;}if(f.isAborted(D))throw--this._creatingViewCount,f.createAbortError("AnalysisView creation aborted");A=new B.module.default({analysis:A,view:this.view});try{await A.when()}catch(C){throw--this._creatingViewCount,C;}if(f.isAborted(D))throw--this._creatingViewCount,A.destroy(),f.createAbortError("AnalysisView creation aborted");x.view=A;x.state.view=l.CREATED;this._allAnalysisViews.add(A);
--this._creatingViewCount;return A};r._loadAnalysisModule=function(x){switch(x){case "area-measurement":return new Promise((D,A)=>a(["./AreaMeasurementAnalysisView3D"],v=>D(n(v)),A));case "dimension":return new Promise((D,A)=>a(["./DimensionAnalysisView3D"],v=>D(n(v)),A));case "direct-line-measurement":return new Promise((D,A)=>a(["./DirectLineMeasurementAnalysisView3D"],v=>D(n(v)),A));case "line-of-sight":return new Promise((D,A)=>a(["./LineOfSightAnalysisView3D"],v=>D(n(v)),A));case "slice":return new Promise((D,
A)=>a(["./SliceAnalysisView3D"],v=>D(n(v)),A))}};b._createClass(w,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(x=>x.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return w}(q.HandleOwner);c.__decorate([e.property()],q.prototype,"updating",null);c.__decorate([e.property({constructOnly:!0})],q.prototype,"view",void 0);c.__decorate([e.property()],q.prototype,"_allAnalysisViews",void 0);
c.__decorate([e.property()],q.prototype,"_creatingViewCount",void 0);return q=c.__decorate([h.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],q)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.Constraints=function(h){function z(){var n=h.apply(this,arguments)||this;n.tilt=new e.TiltConstraint;n.altitude=new f.AltitudeConstraint;n.clipDistance=new g.ClipDistanceConstraint;return n}b._inherits(z,h);return b._createClass(z)}(y);c.__decorate([p.property({type:e.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);c.__decorate([p.property({type:f.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);c.__decorate([p.property({type:g.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=c.__decorate([d.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.AltitudeConstraint=function(g){function e(){var h=g.apply(this,arguments)||this;h.min=f.earthAltitudeConstraint.min;h.max=f.earthAltitudeConstraint.max;return h}b._inherits(e,g);return b._createClass(e)}(y);c.__decorate([p.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([p.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([d.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){a.Constraints=function(t){function w(x){x=t.call(this,x)||this;x.collision=new m;x.distance=Infinity;x.minimumPoiDistance=4;x.tilt=null;return x}b._inherits(w,t);var r=w.prototype;r.clampAltitude=function(x){return this.altitude?u.clamp(x,this.altitude.min,this.altitude.max):x};r.clampTilt=function(x,D){if(!this.tilt)return D;x=this.tilt(x);return u.clamp(D,x.min,x.max)};r.clampDistance=function(x){return Math.min(x,this.distance)};r.createDefaultTilt=function(){return this.mode===
h.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};r.createConstantMaxTilt=function(x){return(D,A=l)=>{A.min=n.min;A.max=x;return A}};r._createDefaultTiltLocal=function(){const x=this.collision.enabled?z.makePiecewiseLinearFunction([[4E3,n.max],[1E4,u.deg2rad(88)],[6E6,u.deg2rad(88)]]):()=>n.max;return(D,A=l)=>{A.min=n.min;A.max=x(D);return A}};r._createDefaultTiltGlobal=function(){const x=this.collision.enabled?z.makePiecewiseLinearFunction([[4E3,n.max],[5E4,u.deg2rad(88)],
[6E6,u.deg2rad(88)],[2E7,n.min]]):z.makePiecewiseLinearFunction([[3E5,n.max],[3E6,u.deg2rad(88)],[6E6,u.deg2rad(88)],[2E7,n.min]]);return(D,A=l)=>{A.min=n.min;A.max=x(D);return A}};b._createClass(w,[{key:"altitude",get:function(){return this.mode===h.ViewingMode.Local?null:this._get("altitude")||null},set:function(x){this.mode===h.ViewingMode.Local?p.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",x)}}]);return w}(y);c.__decorate([q.property()],a.Constraints.prototype,
"altitude",null);c.__decorate([q.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([q.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([q.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([q.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([q.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([g.subclass("esri.views.3d.state.Constraints")],a.Constraints);
k={min:-2E5,max:4*e.earth.radius};const n={min:u.deg2rad(.5),max:u.deg2rad(179.5)},l={min:0,max:0};let m=function(t){function w(){var r=t.apply(this,arguments)||this;r.enabled=!0;r.elevationMargin=5;return r}b._inherits(w,t);return b._createClass(w)}(y);c.__decorate([q.property({type:Boolean})],m.prototype,"enabled",void 0);c.__decorate([q.property({type:Number})],m.prototype,"elevationMargin",void 0);m=c.__decorate([g.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],m);a.TiltDefault=
n;a.earthAltitudeConstraint=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){a.ClipDistanceConstraint=
function(f){function g(){var h=f.apply(this,arguments)||this;h.mode="auto";return h}b._inherits(g,f);var e=g.prototype;e.castNear=function(h){return Math.max(1E-8,h)};e.castFar=function(h){return Math.max(1E-8,h)};e.autoUpdate=function(h,z){"auto"===this.mode&&(this._get("near")!==h&&this._set("near",h),this._get("far")!==z&&this._set("far",z))};b._createClass(g,[{key:"near",get:function(){return this._get("near")},set:function(h){this._set("near",h);h>=this._get("far")&&(this.far=h+1E-9);this.mode=
"manual"}},{key:"far",get:function(){return this._get("far")},set:function(h){this._set("far",h);h<=this._get("near")&&(this.near=h-1E-9);this.mode="manual"}}]);return g}(y);c.__decorate([p.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([u.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([p.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);c.__decorate([u.cast("far")],a.ClipDistanceConstraint.prototype,
"castFar",null);c.__decorate([p.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([d.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){var e=p.rad2deg(g.TiltDefault.min),h=p.rad2deg(g.TiltDefault.max);a.TiltConstraint=function(z){function n(){var m=z.apply(this,arguments)||this;m.mode="auto";return m}b._inherits(n,z);var l=n.prototype;l.castMax=function(m){return p.clamp(m,e,h)};l.autoUpdate=function(m){"auto"===this.mode&&this._get("max")!==m&&this._set("max",m)};b._createClass(n,[{key:"max",get:function(){return this._get("max")},set:function(m){this._set("max",m);this.mode="manual"}}]);return n}(y);
c.__decorate([u.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([u.property({type:Number,value:h})],a.TiltConstraint.prototype,"max",null);c.__decorate([q.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([f.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){var l;h=l=function(m){function t(r){r=m.call(this,r)||this;r.atmosphere=new f.SceneViewAtmosphere;r.lighting=new g;r.cachedCameraTrackingEnabled=null;return r}a._inherits(t,m);t.fromWebsceneEnvironment=function(r){r=r.cloneConstructProperties();return new l({...r,lighting:r.lighting?"virtual"===r.lighting.type?e.fromWebsceneLighting(r.lighting):g.fromWebsceneLighting(r.lighting):void 0})};var w=t.prototype;w.castLighting=function(r){return this._convertLighting(r)};
w.applyLighting=function(r){this.lighting=this._convertLighting(r)};w._convertLighting=function(r){return r?r instanceof g||r instanceof e?r:r instanceof z?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(r):new g({...r.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):r instanceof n?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(r):new e({...r.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):
k.ensureOneOfType(d.lightingTypes,r):new g};w.clone=function(){return new l({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:y.clone(this.background)})};w.cloneWithWebsceneEnvironment=function(r){return new l({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:y.clone(this.background),
...r.cloneConstructProperties(),lighting:this._getLighting(r)})};w._getLighting=function(r){switch(r.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(r.lighting):g.fromWebsceneLighting(r.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(r.lighting):e.fromWebsceneLighting(r.lighting);default:return c.neverReached(r.lighting),g.fromWebsceneLighting(r.lighting)}};return a._createClass(t)}(h);
b.__decorate([p.property({type:f.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],h.prototype,"atmosphere",void 0);b.__decorate([p.property({nonNullable:!0})],h.prototype,"lighting",void 0);b.__decorate([u.cast("lighting")],h.prototype,"castLighting",null);return h=l=b.__decorate([q.subclass("esri.views.3d.environment.SceneViewEnvironment")],h)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){var e;const h=p.getLogger("esri.views.3d.environment.SunLighting");y=e=function(n){function l(t){t=n.call(this,t)||this;t.cameraTrackingEnabled=!0;t.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var w=(new Date).getFullYear();w=new Date("March 15, "+w+" 12:00:00 UTC");t._set("defaultDate",w);t._set("date",w);return t}a._inherits(l,n);l.fromWebsceneLighting=function(t){return new e(t.cloneConstructProperties())};var m=l.prototype;m.autoUpdate=function(t,
w){const r=e.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=w.hours;this.positionTimezoneInfo.minutes=w.minutes;this.positionTimezoneInfo.seconds=w.seconds;w=null;null!=t&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(w=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(w=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const x=e.calculateTimezoneOffset(this.positionTimezoneInfo);r!==x&&(z.target=this,z.timezoneOffset=
x,this.emit("timezone-will-change",z),z.target=null);if(null!=t)return isNaN(t.getTime())||w!==t.getTime()};m.clone=function(){const t=this._get("date")===this._get("defaultDate"),w=new e({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});t&&w._set("date",w._get("defaultDate"));w.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;w.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;w.positionTimezoneInfo.minutes=
this.positionTimezoneInfo.minutes;w.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return w};m.cloneWithWebsceneLighting=function(t){const w=this.clone();null!=t.date&&(w.date=t.date);w.directShadowsEnabled=t.directShadowsEnabled;w.displayUTCOffset=t.displayUTCOffset;return w};m.cloneNonPersistentConstructProperties=function(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}};a._createClass(l,[{key:"ambientOcclusionEnabled",get:function(){c.deprecatedProperty(h,"ambientOcclusionEnabled",
{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1},set:function(t){c.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",t)}},{key:"waterReflectionEnabled",get:function(){c.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",
version:"4.27"});return this._get("waterReflectionEnabled")??!1},set:function(t){c.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",t)}},{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(t){const w=this._get("date")===this._get("defaultDate");t=new Date(t.getTime());this._set("defaultDate",t);w&&this._set("date",t)}},
{key:"date",set:function(t){null!=t&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}}]);return l}(y.EventedMixin(g));b.__decorate([u.property({type:Boolean})],y.prototype,"cameraTrackingEnabled",void 0);b.__decorate([u.property({type:Boolean})],y.prototype,"ambientOcclusionEnabled",null);b.__decorate([u.property({type:Boolean})],y.prototype,"waterReflectionEnabled",null);b.__decorate([u.property({type:Date})],y.prototype,"defaultDate",null);b.__decorate([u.property({type:Date})],
y.prototype,"date",null);y=e=b.__decorate([f.subclass("esri.views.3d.environment.SunLighting")],y);(function(n){n.calculateTimezoneOffset=function({hours:l,minutes:m,seconds:t}){return Math.round(l+m/60+t/3600)}})(y||(y={}));const z={target:null,timezoneOffset:0};return y})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,c,y,p,u,q,k,d,f){var g;c=g=function(e){function h(n){n=e.call(this,n)||this;n.type="sun";n.date=null;n.directShadowsEnabled=!1;n.displayUTCOffset=null;return n}a._inherits(h,e);var z=h.prototype;z.readDate=function(n,l){return null!=l.datetime&&new Date(l.datetime)||null};z.writeDate=function(n,l,m){l[m]=n.getTime()};z.readDirectShadowsEnabled=function(n,l){return!!l.directShadows};z.writedirectShadowsEnabled=function(n,l,m){n&&(l[m]=n)};z.writeDisplayUTCOffset=function(n,l){null!=n&&
(l.displayUTCOffset=n)};z.clone=function(){return new g(this.cloneConstructProperties())};z.cloneConstructProperties=function(){const n={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(n.date=new Date(this.date.getTime()));return n};return a._createClass(h)}(c.JSONSupport);b.__decorate([y.property({readOnly:!0,type:["sun"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([y.property({type:Date,json:{type:Number,
write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([k.reader("date",["datetime"])],c.prototype,"readDate",null);b.__decorate([f.writer("date")],c.prototype,"writeDate",null);b.__decorate([y.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([k.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([f.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",
null);b.__decorate([y.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);b.__decorate([f.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=g=b.__decorate([d.subclass("esri.webscene.SunLighting")],c)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){var e;const h=p.getLogger("esri.views.3d.environment.VirtualLighting");y=e=function(z){function n(m){m=z.call(this,m)||this;m.cameraTrackingEnabled=!0;return m}a._inherits(n,z);var l=n.prototype;l.clone=function(){return new e({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})};n.fromWebsceneLighting=function(m){return new e(m.cloneConstructProperties())};l.cloneWithWebsceneLighting=function(m){const t=this.clone();t.directShadowsEnabled=
m.directShadowsEnabled;return t};l.cloneNonPersistentConstructProperties=function(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}};a._createClass(n,[{key:"ambientOcclusionEnabled",get:function(){c.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1},set:function(m){c.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",
version:"4.27"});this._set("ambientOcclusionEnabled",m)}},{key:"waterReflectionEnabled",get:function(){c.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??!1},set:function(m){c.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",
m)}}]);return n}(y.EventedMixin(g));b.__decorate([u.property({type:Boolean})],y.prototype,"ambientOcclusionEnabled",null);b.__decorate([u.property({type:Boolean})],y.prototype,"waterReflectionEnabled",null);b.__decorate([u.property({type:Boolean})],y.prototype,"cameraTrackingEnabled",void 0);return y=e=b.__decorate([f.subclass("esri.views.3d.environment.VirtualLighting")],y)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){var d;c=d=function(f){function g(h){h=f.call(this,h)||this;h.type="virtual";h.directShadowsEnabled=!1;return h}a._inherits(g,f);var e=g.prototype;e.clone=function(){return new d(this.cloneConstructProperties())};e.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return a._createClass(g)}(c.JSONSupport);b.__decorate([y.property({readOnly:!0,type:["virtual"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([y.property({type:Boolean,
json:{default:!1,name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0);return c=d=b.__decorate([k.subclass("esri.webscene.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;a.SceneViewAtmosphere=f=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);e.prototype.clone=function(){return new f({quality:this.quality})};b._createClass(e,[{key:"quality",set:function(h){["low","high"].includes(h)&&this._set("quality",h)}}]);return e}(y);c.__decorate([p.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=f=c.__decorate([d.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){var n;const l=p.getLogger("esri.webscene.Environment");p=(m,t,w)=>({enabled:!w||!w.isPresentation});c=n=function(m){function t(r){r=m.call(this,r)||this;r.lighting=new e;r.background=null;r.atmosphereEnabled=!0;r.starsEnabled=!0;return r}a._inherits(t,m);var w=t.prototype;w.clone=function(){return new n(this.cloneConstructProperties())};w.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?h.prototype.clone.call(this.lighting):
e.prototype.clone.call(this.lighting),background:y.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(t,[{key:"weather",set:function(r){f.validateWeatherType(r?.type,l)&&this._set("weather",r)}}]);return t}(c.JSONSupport);b.__decorate([u.property({types:g.lightingTypes,nonNullable:!0,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([u.property(z.backgroundProperty)],c.prototype,"background",void 0);
b.__decorate([u.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:p}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([u.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:p}}})],c.prototype,"starsEnabled",void 0);b.__decorate([u.property({types:f.weatherTypes,nonNullable:!0,json:{write:!0},value:new d})],c.prototype,"weather",null);return c=n=b.__decorate([k.subclass("esri.webscene.Environment")],c)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;c=f=function(g){function e(h){h=g.call(this,h)||this;h.type="sunny";h.cloudCover=.5;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([k.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([d.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,y,p,u){b={key:"type",base:u,typeMap:{sunny:u,cloudy:b,rainy:y,snowy:p,foggy:c}};const q=Object.keys(b.typeMap);a.validateWeatherType=function(k,d){return q.includes(k)?!0:(d.error(`"${k}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){var f;c=f=function(g){function e(h){h=g.call(this,
h)||this;h.type="cloudy";h.cloudCover=.5;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([k.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([d.subclass("esri.views.3d.environment.CloudyWeather")],c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;c=f=function(g){function e(h){h=g.call(this,h)||this;h.type="foggy";h.fogStrength=.5;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({fogStrength:this.fogStrength})};return a._createClass(e)}(c.JSONSupport);b.__decorate([k.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0);return c=f=b.__decorate([d.subclass("esri.views.3d.environment.FoggyWeather")],
c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){var f;c=f=function(g){function e(h){h=g.call(this,h)||this;h.type=
"rainy";h.cloudCover=.5;h.precipitation=.5;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return a._createClass(e)}(c.JSONSupport);b.__decorate([k.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],
c.prototype,"precipitation",void 0);return c=f=b.__decorate([d.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;c=f=function(g){function e(h){h=g.call(this,h)||this;h.type="snowy";h.cloudCover=.5;h.precipitation=.5;h.snowCover="disabled";return h}a._inherits(e,g);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return a._createClass(e)}(c.JSONSupport);b.__decorate([k.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);b.__decorate([y.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0);return c=f=b.__decorate([d.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes=
{key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(y){return(p,u,q)=>{if(!p)return p;for(const k in y.typeMap)if(p.type===k)return u=new y.typeMap[k],u.read(p,q),u}}(b),write:{overridePolicy:(y,p,u)=>({enabled:!u||!u.isPresentation})}}};
a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k){c=function(d){function f(g){return d.call(this,g)||this}a._inherits(f,
d);f.prototype.clone=function(){};return a._createClass(f)}(c.JSONSupport);b.__decorate([y.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([k.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){var e;p={...f.colorAndTransparencyProperty,nonNullable:!0};g=e=function(h){function z(l){l=h.call(this,l)||this;l.type="color";l.color=new c([0,0,0,1]);return l}a._inherits(z,h);var n=z.prototype;n.clone=function(){return new e(this.cloneProperties())};n.cloneProperties=function(){return{color:this.color.clone()}};return a._createClass(z)}(g);b.__decorate([k.enumeration({color:"color"},{readOnly:!0})],g.prototype,"type",void 0);b.__decorate([y.property(p)],g.prototype,
"color",void 0);return g=e=b.__decorate([d.subclass("esri.webscene.background.ColorBackground")],g)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){a.SceneViewEnvironmentManager=function(O){function I(){var J=O.call(this)||this;J._referencePointUpdateDelay=200;J._referencePointUpdateInterval=3E3;J._referencePointUpdateDistThreshold=1E6;J._referencePosUpdateQuery=null;J._referencePosMapCoordsRequested=null;J._viewHandles=new u;J._preserveAbsoluteDateTime=!1;J._trackingEnabled=!1;J._referencePosResetPreserveAbsoluteTime=!1;J._referencePosUpdateTimer=null;J._referencePosMapCoords=null;
J._mainLight=new B.MainLight;J._ambientLight=new B.AmbientLight;J._moonLight=new B.FillLight;J.disableQueries=!1;J._disableWeather=!1;J._renderer=null;J._referencePosWGS84Comparable=null;J._resetReferencePosition();return J}b._inherits(I,O);var H=I.prototype;H.destroy=function(){this.disconnectView();this._viewHandles.destroy()};H.connectView=function(J){if(!this._renderer){this._renderer=new x.EnvironmentRenderer({view:J});var N=()=>this._updateRenderParameters(),R=()=>this._cameraHandler();this._viewHandles.add([d.watch(()=>
J.environment.lighting,W=>this._updateLightingHandler(W),d.sync),d.watch(()=>"virtual"!==J.environment.lighting.type?J.environment.lighting.date:null,W=>this._lightingDateHandler(W),d.sync),d.watch(()=>J.stationary,()=>this._interactingStationaryHandler()),d.watch(()=>J.environment.lighting.directShadowsEnabled,N,d.sync),d.watch(()=>J.qualitySettings.ambientOcclusion,N,d.sync),d.watch(()=>J.qualitySettings.reflections,N,d.sync),d.watch(()=>J.environment.background?.color,N,d.sync),d.watch(()=>J.spatialReference,
()=>this._resetReferencePosition(!0),d.sync),d.watch(()=>J.environment.weather.type,()=>this._updateLighting(null,v.Update.Faded),d.sync),d.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,v.Update.Faded),d.sync),d.watch(()=>J.viewingMode,()=>this._resetReferencePosition(!0),d.syncAndInitial),d.watch(()=>"virtual"!==J.environment.lighting.type?J.environment.lighting.cameraTrackingEnabled:!1,W=>this._updateCameraTracking(W),d.syncAndInitial),d.watch(()=>J.state.camera,R,d.syncAndInitial),
d.watch(()=>this.disableQueries,R)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};H.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=q.destroyMaybe(this._renderer)};H._updateLightingHandler=function(J){this._updateCameraTracking("virtual"!==J.type?J.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==J.type?J.date:null);this._updateRenderParameters()};H._updateCameraTracking=
function(J){(this._trackingEnabled=J)?this._cameraHandler():(J=this._view.environment.lighting,"virtual"!==J?.type&&(J.positionTimezoneInfo.autoUpdated=!1))};H._lightingDateHandler=function(J){const N=this._view.environment.lighting;if("virtual"===N?.type)this._updateLighting();else if(J){if(!N.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!t.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var R=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(R)){this._requestReferencePositionUpdate(R);
return}}this._preupdateTracking(J);null!=this._referencePosWGS84Comparable&&(R=D.positionToTimezoneInfo(this._referencePosWGS84Comparable,K),null!=R&&(N.autoUpdate(null,R),this._trackingEnabled&&(N.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(J)}};H._preupdateTracking=function(J){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(J)};H._cameraHandler=function(J=null){var N=this._view;N.ready&&
(N=N.stateManager.camera)&&(this._cameraHandlerClientSide(N,J)||this._cameraHandlerServerSide(N))};H._cameraHandlerClientSide=function(J,N){const R=w.isEarth(this._view.spatialReference);if(R&&!t.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;J=J.position;null==this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable=l.create());R?t.projectPointToWGS84ComparableLonLat(J,this._referencePosWGS84Comparable):
n.set(this._referencePosWGS84Comparable,J.longitude??0,J.latitude??0,J.z??0);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,N)||this._updateLighting(N);return!0};H._cameraHandlerServerSide=function(J){J=J.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(J))&&this._requestReferencePositionUpdate(J,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=
(J.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};H._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};H._updateLighting=function(J,N=v.Update.Immediate){var R=this._view;J=J||("virtual"===R.environment.lighting.type?null:R.environment.lighting.date);var W=this._referencePosWGS84Comparable;const T=null!=W?E:F;var P=this.weatherVisible?R.environment.weather.type:"disabled";null!=W?A.computeColorAndIntensity(J,
W,R.state.viewingMode,P,R.state.camera,T):"virtual"===R.environment.lighting.type&&A.computeVirtualLightDirection(R.state.camera,R.state.viewingMode,T.direct.directionToLightSource);J=this._mainLight;R=T.direct;n.scale(J.intensity,R.color,R.intensity*Math.PI);n.copy(J.direction,R.directionToLightSource);J.specularStrength=T.specularStrength;J.environmentStrength=T.environmentStrength;W=this._ambientLight;n.scale(W.intensity,T.ambient.color,T.ambient.intensity);P=this._moonLight;n.lerp(P.intensity,
G,L,T.globalFactor);n.scale(P.intensity,P.intensity,(1-.5*T.globalFactor)*(1-.4*T.noonFactor*(1-T.globalFactor)));n.copy(P.direction,R.directionToLightSource);this._renderer.updateLightSources([J,W,P],T.noonFactor,T.globalFactor,N);this._updateRenderParameters()};H._autoUpdateTimezone=function(J,N=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==J)return!1;const R=M;R.setTime((N||this._view.environment.lighting.date).getTime());
J=D.positionToTimezoneInfo(J,K);if(null==J)return!1;var W=this._view.environment.lighting.positionTimezoneInfo;if(!W.autoUpdated)W=J;else if(W.hours===J.hours&&W.minutes===J.minutes&&W.seconds===J.seconds)return!1;const T=R.getUTCHours()-(J.hours-W.hours),P=R.getUTCMinutes()-(J.minutes-W.minutes);W=R.getUTCSeconds()-(J.seconds-W.seconds);R.setUTCHours(T);R.setUTCMinutes(P);R.setUTCSeconds(W);return N?!1:this._view.environment.lighting.autoUpdate(R,J)};H._updateRenderParameters=function(){const J=
this._view._stage;if(J){var N=null!=this._referencePosWGS84Comparable?A.computeShadowsEnabled(this._referencePosWGS84Comparable[2],this._view.state.viewingMode):!0,R=this._view.environment.background;R=R instanceof C?{type:"color",color:m.fromArray(y.toUnitRGBA(R.color))}:{type:"color",color:m.fromValues(0,0,0,1)};J.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&N,background:R,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,
qualitySettings:this._view.qualitySettings})}};H._resetReferencePosition=function(J=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");J&&this._cameraHandler()};H._requestReferencePositionUpdate=function(J,N=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(J):this._referencePosMapCoordsRequested=
J.clone(),this._referencePosResetPreserveAbsoluteTime=!!N,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const R=this._referencePosUpdateQuery=k.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===R)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==R)}).catch(T=>{"mapcoordshelper:missing-geometry-service"===T.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===R&&(this._referencePosUpdateQuery=
null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),W=this._referencePosUpdateTimer=k.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===W&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};H._doReferencePositionUpdateQuery=async function(J){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=
!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const N=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);J()||isNaN(N[0])||isNaN(N[1])||(J=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=
N[0],this._referencePosWGS84Comparable[1]=N[1],this._referencePosWGS84Comparable[2]=J):this._referencePosWGS84Comparable=[N[0],N[1],J],this._referencePosChanged())};H._executePendingReferencePositionUpdate=function(){const J=this._referencePosMapCoordsRequested;J&&this._requestReferencePositionUpdate(J,this._referencePosResetPreserveAbsoluteTime)};H._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();
this.notifyChange("referencePositionWGS84Comparable")};H._exceedsReferencePosDistThreshold=function(J){return this._referencePosMapCoords?(J=this._referencePosMapCoords.distance(J),this._view.mapCoordsHelper&&(J*=this._view.mapCoordsHelper.unitInMeters),J>this._referencePointUpdateDistThreshold):!0};H._cancelReferencePosUpdates=function(){const J=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return J};b._createClass(I,[{key:"_view",get:function(){return this._renderer?.view}},
{key:"updating",get:function(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}},{key:"weatherEnabled",get:function(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===r.ViewingMode.Global&&w.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){return this.weatherEnabled&&this._renderer?.weatherVisible}},{key:"referencePositionWGS84Comparable",
get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const J=this;return{get renderer(){return J._renderer},set referencePointUpdateInterval(N){J._referencePointUpdateInterval=N},set referencePointUpdateDistThreshold(N){J._referencePointUpdateDistThreshold=N},set referencePosUpdateTimer(N){J._referencePosUpdateTimer=N},set referencePointUpdateDelay(N){J._referencePointUpdateDelay=N},set disableWeather(N){J._disableWeather=N}}}}]);return I}(p.EventedAccessor);c.__decorate([f.property({type:Boolean,
readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,
"referencePositionWGS84Comparable",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([z.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const E=new A.ColorAndIntensity,F=new A.ColorAndIntensity,M=new Date,K={hours:0,minutes:0,seconds:0},G=l.fromValues(.22,.22,
.33),L=l.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsCompositionParameters ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./LocalAtmosphere ./MarsAtmosphere ./Precipitation ./Stars ./weather ./weatherUtils ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/lib/RenderFeature ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H){var J;const N=[I.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,I.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=J=function(Q){function S(V){V=Q.call(this,V)||this;V._context=null;V._atmosphere=null;V._oldWeatherParameters=new R;V._newWeatherParameters=new R;V._fadedWeatherParameters=new R;V._weatherParameters=V._newWeatherParameters;return V}b._inherits(S,Q);var U=S.prototype;U.initialize=function(){this.view._stage.addRenderPlugin(N,
this)};U.destroy=function(){this.removeHandles();this.uninitializeRenderContext();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)};U.updateAnimation=function(V){return null!=this._precipitation?this._precipitation.update(V):!1};U.initializeRenderContext=function(V=null){this._context=V;V=()=>this._setNeedsRender();this.addHandles([k.watch(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),X=>this._updateAtmosphere(X),
k.syncAndInitial),k.watch(()=>this._stars,V),k.watch(()=>this._precipitation,V),k.watch(()=>this._clouds,()=>this._updateWeather(),k.initial),k.watch(()=>this._fog,()=>this._updateFogHaze(),k.initial),k.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},k.sync),k.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},k.syncAndInitial)])};U.uninitializeRenderContext=function(){this._context=null;this._atmosphere=q.destroyMaybe(this._atmosphere);this._set("_stars",
q.destroyMaybe(this._stars));this._set("_precipitation",q.destroyMaybe(this._precipitation));this._set("_clouds",q.destroyMaybe(this._clouds));this._set("_cloudsComposition",q.destroyMaybe(this._cloudsComposition));this._set("_fog",q.destroyMaybe(this._fog))};U.prepareRender=function(V){V.bindParameters.cloudsFade.data=D.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&null!=V.bindParameters.cloudsFade.data?.cubeMap&&(G.updateWeatherFading(V.bindParameters.cloudsFade,
V.bindParameters.camera,this.view.state.mode,V.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(V.bindParameters),V.bindParameters.cloudsFade.renderingStage===D.CloudsRenderingStages.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),V.bindParameters.cloudsFade.data=null))};U.render=function(V){if(V.output===L.ShaderOutput.Color)switch(V.bindParameters.slot){case I.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:null!=
this._stars&&this._stars.render(V);null!=this.atmosphere&&(this.atmosphere.render(V,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(O.RenderFeature.HighResolutionAtmosphere)),null!=this._cloudsComposition&&null!=V.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(V)),G.weatherFadingNeedsRender(V.bindParameters.cloudsFade)&&null!=this._context&&null!=V.bindParameters.cloudsFade.data?.cubeMap&&
this._context.requestRender());break;case I.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(V,this._weatherParameters.hazeAmount,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(O.RenderFeature.HighResolutionAtmosphere)),0<this._weatherParameters.fog.amount&&null!=this._fog&&this._fog.render(V,this._weatherParameters.fog),null!=this._precipitation)){const X=this.view.environment.weather;"rainy"!==
X.type&&"snowy"!==X.type||this._precipitation.render(V,X.precipitation,X.type)}}};U.updateLightSources=function(V,X,Y,Z){if(null!=this._context){const ea=this._context.renderContext;ea.bindParameters.oldLighting.copyFrom(ea.bindParameters.lighting);ea.bindParameters.newLighting.noonFactor=X;ea.bindParameters.newLighting.globalFactor=Y;ea.bindParameters.newLighting.set(V);Z===H.Update.Faded||ea.bindParameters.weatherFading?ea.bindParameters.fadeLighting(0):ea.bindParameters.fadeLighting(1);this._context.requestRender()}};
U._updateWeatherFading=function(V){if(V.weatherFading){var X=V.cloudsFade;X.fadeIn.stage===x.FadeInStages.FADE_IN?(V.fadeLighting(X.fadeIn.factor),this._fadeWeather(X.fadeIn.factor)):X.fadeInOut.stage===x.FadeInOutStages.FADE_IN?(V.fadeLighting(X.fadeInOut.factor),this._fadeWeather(X.fadeInOut.factor)):X.crossFade.enabled?(V.fadeLighting(X.crossFade.factor),this._fadeWeather(X.crossFade.factor)):(V.fadeLighting(0),this._fadeWeather(0))}};U._fadeWeather=function(V){const {_newWeatherParameters:X,_oldWeatherParameters:Y}=
this;1<=V?this._weatherParameters=X:(this._fadedWeatherParameters.lerp(Y,X,V),this._weatherParameters=this._fadedWeatherParameters)};U._updateWeather=function(){const V=this._weatherUpdateParameters;null!=V&&null!=this._clouds&&(this._clouds.applyPreset(v.cloudPresets[V.type],V.weatherAdjustment),this._setNeedsRender())};U._setNeedsRender=function(){null!=this._context&&this._context.requestRender()};U._updateFogHaze=function(){const V=this._weatherUpdateParameters;if(null!=this._fog&&null!=V&&null!=
this._context){var X=this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(V.type){case "foggy":this._newWeatherParameters.fog.strength=u.lerp(3E-5,.005,V.weatherAdjustment**3);h.copy(this._newWeatherParameters.fog.color,T);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=u.lerp(4E-6,2E-4,(V.effect??0)**3);h.copy(this._newWeatherParameters.fog.color,
W);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=u.lerp(4E-6,2E-4,(V.effect??0)**3);h.copy(this._newWeatherParameters.fog.color,T);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}X.weatherFading?
this._fadeWeather(0):this._fadeWeather(1)}};U._updateAtmosphere=function(V){V=this._selectAtmosphereType(V);if(V===t.AtmosphereType.None||!this._context)this._atmosphere=q.destroyMaybe(this._atmosphere);else if(!this._atmosphere||this._atmosphere.type!==V)if(this._atmosphere=q.destroyMaybe(this._atmosphere),V=this._getAtmosphereClass(V))this._atmosphere=new V(this.view,this._context);this._setNeedsRender()};U._getAtmosphereClass=function(V){switch(V){case t.AtmosphereType.Realistic:return w.ChapmanAtmosphere;
case t.AtmosphereType.Local:return C.LocalAtmosphere;case t.AtmosphereType.Mars:return E;default:case t.AtmosphereType.None:return null}};U._selectAtmosphereType=function(V){const {enabled:X,viewingMode:Y}=V;return!X||l.isMoon(this.view.spatialReference)?t.AtmosphereType.None:Y===m.ViewingMode.Local?t.AtmosphereType.Local:null!=this._context&&w.ChapmanAtmosphere.isSupported(this._context)&&l.isEarth(this.view.spatialReference)?t.AtmosphereType.Realistic:l.isMars(this.view.spatialReference)?t.AtmosphereType.Mars:
t.AtmosphereType.None};b._createClass(S,[{key:"atmosphere",get:function(){return this._atmosphere}},{key:"_atmosphereType",get:function(){return null!=this.atmosphere?this.atmosphere.type:t.AtmosphereType.None}},{key:"canRender",get:function(){return!(null===this._atmosphere&&null===this._stars)}},{key:"needsLinearDepth",get:function(){return this._atmosphereType===t.AtmosphereType.Realistic}},{key:"updating",get:function(){return null!=this._stars&&this._stars.updating||null!=this._clouds&&this._clouds.running}},
{key:"weatherVisible",get:function(){return h.length(this.view.state.camera.eye)-n.getReferenceEllipsoid(this.view.spatialReference).radius<=K.weatherHeightLimit}},{key:"_stars",get:function(){const V=this.view,X=V.environment?.starsEnabled??!1,Y=this._get("_stars");return X&&null!=this._context?null!=Y?Y:new M.Stars({view:V,requestRender:()=>this._setNeedsRender()}):(q.destroyMaybe(Y),null)}},{key:"_precipitation",get:function(){const V=this._get("_precipitation");if(!this._precipitationEnabled||
null==this._context)return q.destroyMaybe(V),null;const X=this.view,Y=this._context;if(null!=V&&V.context===Y)return V;q.destroyMaybe(V);return new F.Precipitation({context:Y,view:X})}},{key:"_clouds",get:function(){const V=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return q.destroyMaybe(V),null;if(null!=V)return V;const X=this.view,Y=this._context;q.destroyMaybe(V);return new A.CloudsGenerator({context:Y,view:X,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",
get:function(){const V=this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return q.destroyMaybe(V),null;const X=this.view.state.viewingMode,Y=this._context.renderContext.rctx,Z=n.getReferenceEllipsoid(this.view.spatialReference).radius;if(null!=V&&V.viewingMode===X&&V.planetRadius===Z)return V;q.destroyMaybe(V);return new r.CloudsComposition({rctx:Y,viewingMode:X,planetRadius:Z,requestRender:()=>this._setNeedsRender()})}},{key:"_fog",get:function(){const V=this._get("_fog");
return this.weatherEnabled&&null!=this._context?null!=V?V:new B.Fog({context:this._context,view:this.view,rctx:this._context.renderContext.rctx,viewingMode:this.view.state.viewingMode}):(q.destroyMaybe(V),null)}},{key:"weatherEnabled",get:function(){return!!this.view?.environmentManager?.weatherEnabled}},{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",
get:function(){const V=this.weatherEnabled?this.view.environment.weather:null;return null==V?null:"rainy"===V.type||"snowy"===V.type?{type:V.type,weatherAdjustment:V.cloudCover,effect:V.precipitation}:{type:V.type,weatherAdjustment:"foggy"===V.type?V.fogStrength:V.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),
stubGetAtmosphereClass:V=>{P=J.prototype._getAtmosphereClass;J.prototype._getAtmosphereClass=V},restoreGetAtmosphereClass:()=>{J.prototype._getAtmosphereClass=P}}}}]);return S}(y);c.__decorate([d.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"atmosphere",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);c.__decorate([d.property({type:Boolean,
readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_stars",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);
c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);c.__decorate([d.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=J=c.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let R=function(){function Q(){this.fog=new B.FogParameters;this.hazeAmount=1}var S=Q.prototype;S.copyFrom=function(U){this.fog.amount=U.fog.amount;this.hazeAmount=U.hazeAmount;this.fog.strength=U.fog.strength;h.copy(this.fog.color,U.fog.color)};S.lerp=function(U,V,X){this.fog.amount=u.lerp(U.fog.amount,V.fog.amount,
X);this.hazeAmount=u.lerp(U.hazeAmount,V.hazeAmount,X);this.fog.strength=u.lerp(U.fog.strength,V.fog.strength,X);h.lerp(this.fog.color,U.fog.color,V.fog.color,X)};return b._createClass(Q)}();const W=z.fromValues(.5,.5,.5),T=z.fromValues(1.5,1.5,1.5);let P;a.WeatherParameters=R;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Realistic=
0]="Realistic";b[b.Local=1]="Local";b[b.Mars=2]="Mars";b[b.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Handles ../../../core/mathUtils ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec4 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){let t=function(){function w(x,D){this._view=x;this.type=g.AtmosphereType.Realistic;this._handles=new c;this._passParameters=new h.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=f.earth.radius;this._fadeHaze=0;this._tmpScale=q.create();this._updateRadius(f.earth.radius);x=D.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([p.watch(()=>this._view?.basemapTerrain?.rootTileElevationBounds,
()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),p.watch(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)]);const A=new z.ChapmanAtmosphereTechniqueConfiguration;A.haze=!1;this._atmosphereTechnique=D.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,A);A.haze=!0;this._atmosphereHazeTechnique=D.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,A);A.reduced=!0;A.haze=!1;this._atmosphereReducedTechnique=
D.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,A);A.haze=!0;this._atmosphereHazeReducedTechnique=D.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,A);this._vao=l.createQuadVAO(x,n.Pos2Tex)}var r=w.prototype;r.destroy=function(){this._handles.destroy();this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();this._atmosphereReducedTechnique.release();this._atmosphereHazeReducedTechnique.release();this._vao.dispose()};r.render=function(x,D){this._render(x,D?this._atmosphereTechnique:
this._atmosphereReducedTechnique,x.offscreenRenderingHelper.depthTexture,D,!1)};r.renderHaze=function(x,D,A){this._fadeHaze=D;this._render(x,A?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,x.offscreenRenderingHelper.linearDepthTexture,A,!0)};r._render=function(x,D,A,v,B){if(null!=A){var C=x.offscreenRenderingHelper;this._update(x.bindParameters.camera);this._passParameters.depthTexture=A;var E=C.background.color;k.set(this._passParameters.backgroundColor,E[0]*E[3],E[1]*E[3],E[2]*
E[3]);var F=x.rctx.bindTechnique(D,this._passParameters,x.bindParameters);v?C.renderDepthDetached(()=>this._renderCommon(F,x)):(D=x.rctx.getViewport(),v=k.length(x.bindParameters.camera.eye)-f.earth.radius,v<e.atmosphereHeight?(v=Math.min(1,Math.max(0,v/e.atmosphereHeight)),E=B?y.lerp(.4,.5,v):y.lerp(.2,.3,v)):(v=Math.min(1,Math.max(0,(v-e.atmosphereHeight)/(15*e.atmosphereHeight))),E=B?y.lerp(.5,1,v):y.lerp(.3,.6,v)),v=Math.floor(E*x.bindParameters.camera.fullViewport[2]),E=Math.floor(E*x.bindParameters.camera.fullViewport[3]),
x.rctx.setViewport(0,0,v,E),C.renderToTargets(()=>this._renderCommon(F,x),C.tmpColor,C.tmpDepth,[0,0,0,1],!1,!1),x.rctx.setViewport(D.x,D.y,D.width,D.height),u.set(this._tmpScale,v/x.bindParameters.camera.fullViewport[2],E/x.bindParameters.camera.fullViewport[3]),C.compositeAtmosphereToMain(x.bindParameters,B,A,this._tmpScale))}};r._renderCommon=function(x,D){null!=this._vao&&(D.rctx.bindVAO(this._vao),x.assertCompatibleVertexAttributeLocations(this._vao),D.rctx.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,
0,4))};r._adjustRadiusForTesselation=function(x){return x*Math.cos(Math.PI/16/16)};r._updateRootTileElevationBounds=function(){const x=this._view.basemapTerrain.rootTileElevationBounds.min;x!==this._rootTileElevationMin&&(this._rootTileElevationMin=x,this._lowerBoundEarthRadius=f.earth.radius,this._updateVisibleElevationBounds())};r._updateVisibleElevationBounds=function(){const x=this._adjustRadiusForTesselation(f.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);x<this._lowerBoundEarthRadius&&
this._updateRadius(x)};r._updateRadius=function(x){this._lowerBoundEarthRadius=x;u.set(this._passParameters.radii,x,x+e.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*x-e.innerAtmosphereDepth)*e.innerAtmosphereDepth)};r._update=function(x){if(x){x=k.squaredLength(x.eye);var D=Math.sqrt(x),A=x-this._passParameters.radii[1]*this._passParameters.radii[1],v=y.clamp((D-this._passParameters.radii[0])/e.atmosphereHeight,0,1);d.set(this._passParameters.heightParameters,D,x,A,v);this._passParameters.altitudeFade=
e.computeInnerAltitudeFade(D-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=y.lerp(y.lerp(.6,1,y.smoothstep(9500,10500,D-f.earth.radius)),1,this._fadeHaze)}};w.isSupported=function(x){return x.renderContext.rctx.capabilities.depthTexture};return b._createClass(w)}();a.ChapmanAtmosphere=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function c(R,W){R[0]=W[0];R[1]=W[1];return R}function y(R,
W,T){R[0]=W;R[1]=T;return R}function p(R,W,T){R[0]=W[0]+T[0];R[1]=W[1]+T[1];return R}function u(R,W,T){R[0]=W[0]-T[0];R[1]=W[1]-T[1];return R}function q(R,W,T){R[0]=W[0]*T[0];R[1]=W[1]*T[1];return R}function k(R,W,T){R[0]=W[0]/T[0];R[1]=W[1]/T[1];return R}function d(R,W){R[0]=Math.ceil(W[0]);R[1]=Math.ceil(W[1]);return R}function f(R,W){R[0]=Math.floor(W[0]);R[1]=Math.floor(W[1]);return R}function g(R,W,T){R[0]=Math.min(W[0],T[0]);R[1]=Math.min(W[1],T[1]);return R}function e(R,W,T){R[0]=Math.max(W[0],
T[0]);R[1]=Math.max(W[1],T[1]);return R}function h(R,W){R[0]=Math.round(W[0]);R[1]=Math.round(W[1]);return R}function z(R,W,T){R[0]=W[0]*T;R[1]=W[1]*T;return R}function n(R,W,T,P){R[0]=W[0]+T[0]*P;R[1]=W[1]+T[1]*P;return R}function l(R,W){const T=W[0]-R[0];R=W[1]-R[1];return Math.sqrt(T*T+R*R)}function m(R,W){const T=W[0]-R[0];R=W[1]-R[1];return T*T+R*R}function t(R){const W=R[0];R=R[1];return Math.sqrt(W*W+R*R)}function w(R){const W=R[0];R=R[1];return W*W+R*R}function r(R,W){R[0]=-W[0];R[1]=-W[1];
return R}function x(R,W){R[0]=1/W[0];R[1]=1/W[1];return R}function D(R,W){var T=W[0];const P=W[1];T=T*T+P*P;0<T&&(T=1/Math.sqrt(T),R[0]=W[0]*T,R[1]=W[1]*T);return R}function A(R,W){return R[0]*W[0]+R[1]*W[1]}function v(R,W,T){W=W[0]*T[1]-W[1]*T[0];R[0]=R[1]=0;R[2]=W;return R}function B(R,W,T,P){const Q=W[0];W=W[1];R[0]=Q+P*(T[0]-Q);R[1]=W+P*(T[1]-W);return R}function C(R,W){W=W||1;const T=2*b.RANDOM()*Math.PI;R[0]=Math.cos(T)*W;R[1]=Math.sin(T)*W;return R}function E(R,W,T){const P=W[0];W=W[1];R[0]=
T[0]*P+T[2]*W;R[1]=T[1]*P+T[3]*W;return R}function F(R,W,T){const P=W[0];W=W[1];R[0]=T[0]*P+T[2]*W+T[4];R[1]=T[1]*P+T[3]*W+T[5];return R}function M(R,W,T){const P=W[0];W=W[1];R[0]=T[0]*P+T[3]*W+T[6];R[1]=T[1]*P+T[4]*W+T[7];return R}function K(R,W,T){const P=W[0];W=W[1];R[0]=T[0]*P+T[4]*W+T[12];R[1]=T[1]*P+T[5]*W+T[13];return R}function G(R,W,T,P){const Q=W[0]-T[0];W=W[1]-T[1];const S=Math.sin(P);P=Math.cos(P);R[0]=Q*P-W*S+T[0];R[1]=Q*S+W*P+T[1];return R}function L(R,W){var T=R[0];R=R[1];const P=W[0];
W=W[1];let Q=T*T+R*R;0<Q&&(Q=1/Math.sqrt(Q));let S=P*P+W*W;0<S&&(S=1/Math.sqrt(S));T=(T*P+R*W)*Q*S;return 1<T?0:-1>T?Math.PI:Math.acos(T)}function O(R){return"vec2("+R[0]+", "+R[1]+")"}function I(R,W){return R[0]===W[0]&&R[1]===W[1]}function H(R,W){const T=R[0];R=R[1];const P=W[0];W=W[1];const Q=b.getEpsilon();return Math.abs(T-P)<=Q*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(R-W)<=Q*Math.max(1,Math.abs(R),Math.abs(W))}function J(R,W,T,P,Q){let S=W[0]-T[0];T=W[1]-T[1];Q=(P[0]*S+P[1]*T)*(Q-1);S=
P[0]*Q;T=P[1]*Q;R[0]=W[0]+S;R[1]=W[1]+T;return R}const N=Object.freeze(Object.defineProperty({__proto__:null,add:p,angle:L,ceil:d,copy:c,cross:v,dist:l,distance:l,div:k,divide:k,dot:A,equals:H,exactEquals:I,floor:f,inverse:x,len:t,length:t,lerp:B,max:e,min:g,mul:q,multiply:q,negate:r,normalize:D,projectAndScale:J,random:C,rotate:G,round:h,scale:z,scaleAndAdd:n,set:y,sqrDist:m,sqrLen:w,squaredDistance:m,squaredLength:w,str:O,sub:u,subtract:u,transformMat2:E,transformMat2d:F,transformMat3:M,transformMat4:K},
Symbol.toStringTag,{value:"Module"}));a.add=p;a.angle=L;a.ceil=d;a.copy=c;a.cross=v;a.dist=l;a.distance=l;a.div=k;a.divide=k;a.dot=A;a.equals=H;a.exactEquals=I;a.floor=f;a.inverse=x;a.len=t;a.length=t;a.lerp=B;a.max=e;a.min=g;a.mul=q;a.multiply=q;a.negate=r;a.normalize=D;a.projectAndScale=J;a.random=C;a.rotate=G;a.round=h;a.scale=z;a.scaleAndAdd=n;a.set=y;a.sqrDist=m;a.sqrLen=w;a.squaredDistance=m;a.squaredLength=w;a.str=O;a.sub=u;a.subtract=u;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=
M;a.transformMat4=K;a.vec2=N})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(a,b){a.atmosphereHeight=1E5;a.computeInnerAltitudeFade=function(c){return b.clamp((c-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){k=function(n){function l(){var m=n.apply(this,arguments)||this;m.heightParameters=u.create();m.radii=y.create();m.innerFadeDistance=0;m.altitudeFade=0;m.hazeStrength=1;m.renderScale=y.create();m.backgroundColor=p.create();return m}c._inherits(l,n);return c._createClass(l)}(k.NoParameters);f=function(n){function l(){return n.apply(this,arguments)||this}c._inherits(l,n);var m=l.prototype;m.initializeProgram=function(t){return new e.Program(t.rctx,l.shader.get().build(this.configuration),
g.Default3D)};m.initializePipeline=function(){return this.configuration.reduced?z.makePipelineState({blending:z.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO),depthTest:{func:h.CompareFunction.ALWAYS},colorWrite:z.defaultColorWriteParams}):this.configuration.haze?z.makePipelineState({blending:z.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),colorWrite:z.defaultColorWriteParams}):z.makePipelineState({blending:z.simpleBlendingParams(h.BlendFactor.SRC_ALPHA,
h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:z.defaultColorWriteParams})};return c._createClass(l)}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(q.ChapmanAtmosphere,()=>new Promise((n,l)=>a(["./ChapmanAtmosphere.glsl"],n,l)));b.ChapmanAtmospherePassParameters=k;b.ChapmanAtmosphereTechnique=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){function w(v){const B=new l.ShaderBuilder;B.attributes.add(t.VertexAttribute.POSITION,"vec2");B.include(u.TextureCoordinateAttribute,{textureCoordinateType:u.TextureCoordinateAttributeType.Default});B.varyings.add("worldRay","vec3");B.varyings.add("eyeDir","vec3");const {vertex:C,fragment:E}=B;C.uniforms.add(new n.Matrix4PassUniform("inverseProjectionMatrix",(F,M)=>M.camera.inverseProjectionMatrix),new n.Matrix4PassUniform("inverseViewMatrix",(F,M)=>b.invertOrIdentity(A,
M.camera.viewMatrix)));C.code.add(z.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);E.uniforms.add(new g.Float3PassUniform("backgroundColor",F=>F.backgroundColor),new f.Float2PassUniform("radii",F=>F.radii),new g.Float3PassUniform("cameraPosition",(F,M)=>M.camera.eye),new e.Float4PassUniform("heightParameters",F=>F.heightParameters),new h.FloatPassUniform("innerFadeDistance",F=>F.innerFadeDistance),new h.FloatPassUniform("altitudeFade",F=>F.altitudeFade),new m.Texture2DPassUniform("depthTexture",F=>F.depthTexture),new h.FloatPassUniform("hazeStrength",F=>F.hazeStrength));E.constants.add("betaRayleigh",
"vec3",r);E.constants.add("betaCombined","vec3",D);E.constants.add("betaMie","float",3.996E-6);E.constants.add("scaleHeight","float",p.rayLeighScaleHeight*p.atmosphereHeight);d.addMainLightDirection(E);B.include(k.Gamma);v.haze&&(E.include(q.ReadLinearDepth),E.uniforms.add(new f.Float2PassUniform("nearFar",(F,M)=>M.camera.nearFar)));E.code.add(z.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);E.code.add(z.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);E.code.add(z.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);E.code.add(z.glsl`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${v.haze?z.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${v.haze?"":z.glsl`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${v.haze?"":z.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${v.haze?z.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:z.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${v.haze?"":z.glsl`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${v.haze&&v.reduced?z.glsl`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${v.haze?z.glsl`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${v.reduced?z.glsl`cameraSpaceRay *= -textureBilinear(vuv0);`:z.glsl`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:z.glsl`${v.reduced?"":z.glsl`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${v.haze?z.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:z.glsl`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${v.haze?"":z.glsl`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `);return B}const r=y.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),x=y.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),D=y.fromValues(parseFloat(Number(r[0]+x[0]).toFixed(6)),parseFloat(Number(r[1]+x[1]).toFixed(6)),parseFloat(Number(r[2]+x[2]).toFixed(6))),A=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:r,
build:w},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=c;a.betaRayleigh=r;a.build=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,y){a.TextureCoordinateAttributeType=void 0;(function(p){p[p.None=0]="None";p[p.Default=1]="Default";p[p.Atlas=2]="Atlas";p[p.Compressed=3]="Compressed";p[p.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(p,u){switch(u.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:p.attributes.add(y.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:p.attributes.add(y.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.vertex.code.add(c.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:p.attributes.add(y.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.attributes.add(y.VertexAttribute.UVREGION,"vec4");p.varyings.add("vuvRegion","vec4");p.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(u.textureCoordinateType);case a.TextureCoordinateAttributeType.None:p.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(y,...p){let u="";for(let q=0;q<p.length;q++)u+=y[q]+p[q];return u+=
y[y.length-1]}b=b._createClass(function(){});(function(y){y.int=function(p){return Math.round(p).toString()};y.float=function(p){return p.toPrecision(8)}})(c||(c={}));a.NoParameters=b;a.glsl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0=
"uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL=
"profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0=
"position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(y){y.include(b.RgbaFloatEncoding);y.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,c){function y(u){u.uniforms.add(new b.Float3PassUniform("mainLightDirection",(q,k)=>k.lighting.mainLight.direction))}function p(u){u.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(q,k)=>k.lighting.mainLight.intensity))}a.MainLighting=
function(u){y(u.fragment);p(u.fragment);u.fragment.code.add(c.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=y;a.addMainLightIntensity=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec3",y.BindType.Pass,(d,f,g)=>d.setUniform3fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Float3PassUniform=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderTechnique/BindType"],function(a,b,c){let y=function(){function p(u,q,k,d,f=null){this.name=u;this.type=q;this.arraySize=f;this.bind={[c.BindType.Pass]:null,[c.BindType.Draw]:null};null!=k&&null!=d&&(this.bind[k]=d)}p.prototype.equals=function(u){return this.type===u.type&&this.name===u.name&&
this.arraySize===u.arraySize};return b._createClass(p)}();a.Uniform=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec2",y.BindType.Pass,(d,f,g)=>d.setUniform2fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Float2PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec4",y.BindType.Pass,(d,f,g)=>d.setUniform4fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Float4PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,
k){return p.call(this,q,"float",y.BindType.Pass,(d,f,g)=>d.setUniform1f(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.FloatPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"mat4",y.BindType.Pass,
(d,f,g)=>d.setUniformMatrix4fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Matrix4PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../../../../../core/Logger","../../lib/Util"],function(a,b,c,y,p){const u=y.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");
y=function(){function n(){this._includedModules=new Map}n.prototype.include=function(l,m){if(this._includedModules.has(l)){const t=this._includedModules.get(l);if(t!==m){u.error("Trying to include shader module multiple times with different sets of options.");m=new Set;for(const w of Object.keys(t))t[w]!==l[w]&&m.add(w);for(const w of Object.keys(l))t[w]!==l[w]&&m.add(w);m.forEach(w=>console.error(`  ${w}: current ${t[w]} new ${l[w]}`))}}else this._includedModules.set(l,m),l(this.builder,m)};return b._createClass(n)}();
let q=function(n){function l(){var t=n.apply(this,arguments)||this;t.vertex=new f;t.fragment=new f;t.attributes=new g;t.varyings=new e;t.extensions=new h;t.constants=new z;return t}b._inherits(l,n);var m=l.prototype;m.generate=function(t){const w=this.extensions.generateSource(t),r=this.attributes.generateSource(t),x=this.varyings.generateSource(t);var D="vertex"===t?this.vertex:this.fragment;const A=D.uniforms.generateSource(),v=D.code.generateSource();t="vertex"===t?"precision highp float;\nprecision highp sampler2D;":
"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n\nout vec4 fragColor;";D=this.constants.generateSource().concat(D.constants.generateSource());return`#version 300 es\n${w.join("\n")}\n\n${t}\n\n${D.join("\n")}\n\n${A.join("\n")}\n\n${r.join("\n")}\n\n${x.join("\n")}\n\n${v.join("\n")}`};m.generateBind=function(t,w){const r=new Map;this.vertex.uniforms.entries.forEach(A=>{const v=A.bind[t];
null!=v&&r.set(A.name,v)});this.fragment.uniforms.entries.forEach(A=>{const v=A.bind[t];null!=v&&r.set(A.name,v)});const x=Array.from(r.values()),D=x.length;return(A,v,B)=>{for(let C=0;C<D;++C)x[C](w,A,v,B)}};b._createClass(l,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return l}(y),k=function(){function n(){this._entries=new Map}var l=n.prototype;l.add=function(...m){for(const t of m)this._add(t)};l.get=function(m){return this._entries.get(m)};
l._add=function(m){if(null==m)u.error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(m.name)&&!this._entries.get(m.name).equals(m))throw new c(`Duplicate uniform name ${m.name} for different uniform type`);this._entries.set(m.name,m)}};l.generateSource=function(){return Array.from(this._entries.values()).map(m=>null!=m.arraySize?`uniform ${m.type} ${m.name}[${m.arraySize}];`:`uniform ${m.type} ${m.name};`)};b._createClass(n,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);
return n}(),d=function(){function n(){this._entries=[]}var l=n.prototype;l.add=function(m){this._entries.push(m)};l.generateSource=function(){return this._entries};return b._createClass(n)}(),f=function(n){function l(){var m=n.apply(this,arguments)||this;m.uniforms=new k;m.code=new d;m.constants=new z;return m}b._inherits(l,n);b._createClass(l,[{key:"builder",get:function(){return this}}]);return l}(y),g=function(){function n(){this._entries=[]}var l=n.prototype;l.add=function(m,t){this._entries.push([m,
t])};l.generateSource=function(m){return"fragment"===m?[]:this._entries.map(t=>`in ${t[1]} ${t[0]};`)};return b._createClass(n)}(),e=function(){function n(){this._entries=new Map}var l=n.prototype;l.add=function(m,t){this._entries.has(m)&&p.assert(this._entries.get(m)===t);this._entries.set(m,t)};l.generateSource=function(m){const t=[];this._entries.forEach((w,r)=>t.push("vertex"===m?`out ${w} ${r};`:`in ${w} ${r};`));return t};return b._createClass(n)}(),h=function(){function n(){this._entries=new Set}
var l=n.prototype;l.add=function(m){this._entries.add(m)};l.generateSource=function(m){const t="vertex"===m?n.ALLOWLIST_VERTEX:n.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(w=>t.includes(w)).map(w=>`#extension ${w} : enable`)};return b._createClass(n)}();h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];h.ALLOWLIST_VERTEX=[];let z=function(){function n(){this._entries=new Set}var l=n.prototype;l.add=function(m,t,w){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case "float":r=
n._numberToFloatStr(w);break;case "int":r=n._numberToIntStr(w);break;case "bool":r=w.toString();break;case "vec2":r=`vec2(${n._numberToFloatStr(w[0])},                            ${n._numberToFloatStr(w[1])})`;break;case "vec3":r=`vec3(${n._numberToFloatStr(w[0])},                            ${n._numberToFloatStr(w[1])},                            ${n._numberToFloatStr(w[2])})`;break;case "vec4":r=`vec4(${n._numberToFloatStr(w[0])},                            ${n._numberToFloatStr(w[1])},                            ${n._numberToFloatStr(w[2])},                            ${n._numberToFloatStr(w[3])})`;
break;case "ivec2":r=`ivec2(${n._numberToIntStr(w[0])},                             ${n._numberToIntStr(w[1])})`;break;case "ivec3":r=`ivec3(${n._numberToIntStr(w[0])},                             ${n._numberToIntStr(w[1])},                             ${n._numberToIntStr(w[2])})`;break;case "ivec4":r=`ivec4(${n._numberToIntStr(w[0])},                             ${n._numberToIntStr(w[1])},                             ${n._numberToIntStr(w[2])},                             ${n._numberToIntStr(w[3])})`;
break;case "mat2":case "mat3":case "mat4":r=`${t}(${Array.prototype.map.call(w,x=>n._numberToFloatStr(x)).join(", ")})`}this._entries.add(`const ${t} ${m} = ${r};`);return this};n._numberToIntStr=function(m){return m.toFixed(0)};n._numberToFloatStr=function(m){return Number.isInteger(m)?m.toFixed(1):m.toString()};l.generateSource=function(){return Array.from(this._entries)};return b._createClass(n)}();a.Code=d;a.Includes=y;a.ShaderBuilder=q;a.Stage=f;a.Uniforms=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,y,p){function u(d,f){if(!d)throw f=f||"Assertion",new k(`${f} at ${Error(f).stack}`);}const q=p.create();let k=function(){function d(f){this.message=f}d.prototype.toString=function(){return`AssertException: ${this.message}`};return b._createClass(d)}();a.assert=u;a.isTranslationMatrix=
function(d){return 1===d[0]&&0===d[1]&&0===d[2]&&0===d[3]&&0===d[4]&&1===d[5]&&0===d[6]&&0===d[7]&&0===d[8]&&0===d[9]&&1===d[10]&&0===d[11]&&1===d[15]};a.logWithBase=function(d,f){return Math.log(d)/Math.log(f)};a.project=function(d,f,g,e,h){q[0]=d[0];q[1]=d[1];q[2]=d[2];q[3]=1;y.transformMat4(q,q,f);2<h.length&&(h[2]=-q[2]);y.transformMat4(q,q,g);u(0!==q[3]);h[0]=q[0]/q[3];h[1]=q[1]/q[3];h[2]=q[2]/q[3];h[0]=(.5*h[0]+.5)*e[2]+e[0];h[1]=(.5*h[1]+.5)*e[3]+e[1]};a.rayBoxTest=function(d,f,g,e){let h,
z=(g[0]-d[0])/f[0],n=(e[0]-d[0])/f[0];z>n&&(h=z,z=n,n=h);let l=(g[1]-d[1])/f[1],m=(e[1]-d[1])/f[1];l>m&&(h=l,l=m,m=h);if(z>m||l>n)return!1;l>z&&(z=l);m<n&&(n=m);g=(g[2]-d[2])/f[2];d=(e[2]-d[2])/f[2];g>d&&(h=g,g=d,d=h);if(z>d||g>n)return!1;d<n&&(n=d);return 0>n?!1:!0};a.rayRay2D=function(d,f,g,e,h,z=c.create()){const n=(e[h]-g[h])*(f[0]-d[0])-(e[0]-g[0])*(f[h]-d[h]);if(0===n)return!1;g=((e[0]-g[0])*(d[h]-g[h])-(e[h]-g[h])*(d[0]-g[0]))/n;z[0]=d[0]+g*(f[0]-d[0]);z[1]=d[h]+g*(f[h]-d[h]);return!0};a.setMatrixTranslation3=
function(d,f,g,e){d[12]=f;d[13]=g;d[14]=e};a.verify=function(d,f){d||console.warn("Verify failed: "+(f||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"sampler2D",y.BindType.Pass,(d,f,g)=>d.bindTexture(q,
k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Texture2DPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u,q){this._module=u;this._loadModule=q}var p=y.prototype;p.get=function(){return this._module};p.reload=async function(){return this._module=await this._loadModule()};
return b._createClass(y)}();a.ReloadableShaderModule=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,c,y){let p=function(){function u(k,d,f){this.release=f;this.initializeConfiguration(k,d);this._configuration=d.snapshot();this._program=this.initializeProgram(k);this._pipeline=
this.initializePipeline(k.rctx.capabilities)}var q=u.prototype;q.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._configuration=null};q.reload=function(k){c.disposeMaybe(this._program);this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k.rctx.capabilities)};q.bindPipelineState=function(k,d=null,f){k.setPipelineState(this.getPipelineState(d,f))};q.ensureAttributeLocations=function(k){this.program.assertCompatibleVertexAttributeLocations(k)};
q.getPipelineState=function(k,d){return this._pipeline};q.initializeConfiguration=function(k,d){};b._createClass(u,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.compiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},{key:"primitiveType",get:function(){return y.PrimitiveType.TRIANGLES}}]);return u}();a.ShaderTechnique=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]=
"TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=
776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.MIN=32775]="MIN";b[b.MAX=32776]="MAX";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=
void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||
(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=
515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=
9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode=
{}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=
34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";
b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]=
"RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=
36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=
36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";
b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=
34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=
35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||
(a.FramebufferTarget={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";
b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=
36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=
33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";
b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";
b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]=
"INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=
37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=
37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.NORMALCOMPRESSED,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.COLORFEATUREATTRIBUTE,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,
7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../core/shaderTechnique/BindType","../../../webgl/checkWebGLError"],
function(a,b,c,y,p){let u=function(){function q(d,f,g){this._context=d;this._locations=g;this._textures=new Map;this._freeTextureUnits=new c({deallocator:null});this._glProgram=d.programCache.acquire(f.generate("vertex"),f.generate("fragment"),g);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=f.generateBind(y.BindType.Pass,this);this.bindDraw=f.generateBind(y.BindType.Draw,this);this._fragmentUniforms=p.webglDebugEnabled()?f.fragmentUniforms:null}var k=q.prototype;
k.dispose=function(){this._glProgram.dispose()};k.setUniform1b=function(d,f){this._glProgram.setUniform1i(d,f?1:0)};k.setUniform1i=function(d,f){this._glProgram.setUniform1i(d,f)};k.setUniform1f=function(d,f){this._glProgram.setUniform1f(d,f)};k.setUniform2fv=function(d,f){this._glProgram.setUniform2fv(d,f)};k.setUniform3fv=function(d,f){this._glProgram.setUniform3fv(d,f)};k.setUniform4fv=function(d,f){this._glProgram.setUniform4fv(d,f)};k.setUniformMatrix3fv=function(d,f){this._glProgram.setUniformMatrix3fv(d,
f)};k.setUniformMatrix4fv=function(d,f){this._glProgram.setUniformMatrix4fv(d,f)};k.setUniform1fv=function(d,f){this._glProgram.setUniform1fv(d,f)};k.setUniform1iv=function(d,f){this._glProgram.setUniform1iv(d,f)};k.setUniform2iv=function(d,f){this._glProgram.setUniform3iv(d,f)};k.setUniform3iv=function(d,f){this._glProgram.setUniform3iv(d,f)};k.setUniform4iv=function(d,f){this._glProgram.setUniform4iv(d,f)};k.assertCompatibleVertexAttributeLocations=function(d){d.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};
k.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};k.bindTexture=function(d,f){if(null==f||null==f.glName){if(f=this._textures.get(d))this._context.bindTexture(null,f.unit),this._freeTextureUnit(f),this._textures.delete(d);return null}let g=this._textures.get(d);null==g?(g=this._allocTextureUnit(f),this._textures.set(d,g)):g.texture=f;this._context.useProgram(this);this.setUniform1i(d,g.unit);this._context.bindTexture(f,g.unit);return g.unit};k.rebindTextures=function(){this._context.useProgram(this);
this._textures.forEach((d,f)=>{this._context.bindTexture(d.texture,d.unit);this.setUniform1i(f,d.unit)});null!=this._fragmentUniforms&&this._fragmentUniforms.forEach(d=>{"sampler2D"!==d.type&&"samplerCube"!==d.type||this._textures.has(d.name)||console.error(`Texture sampler ${d.name} has no bound texture`)})};k._allocTextureUnit=function(d){return{texture:d,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};k._freeTextureUnit=function(d){this._freeTextureUnits.push(d.unit)};
b._createClass(q,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"compiled",get:function(){return this._glProgram.compiled}}]);return q}();a.Program=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,c,y){function p(k,d){switch(d){case k.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case k.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case k.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case k.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case k.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case k.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const u=y.getLogger("esri.views.webgl.checkWebGLError"),q=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(k){if(q){const d=k.getError();d&&(k=p(k,d),u.error(new b("webgl-error","WebGL error occured",{message:k,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=q;a.webglDebugEnabled=function(){return q};a.webglValidateShadersEnabled=function(){return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c,y){function p(I){return B.intern(I)}function u(I){return C.intern(I)}function q(I){return E.intern(I)}function k(I){return F.intern(I)}function d(I){return M.intern(I)}function f(I){return K.intern(I)}function g(I){return G.intern(I)}function e(I){return L.intern(I)}function h(I){return"["+I.join(",")+"]"}function z(I){return I?h([I.srcRgb,I.srcAlpha,I.dstRgb,I.dstAlpha,I.opRgb,I.opAlpha,I.color.r,
I.color.g,I.color.b,I.color.a]):null}function n(I){return I?h([I.face,I.mode]):null}function l(I){return I?h([I.factor,I.units]):null}function m(I){return I?h([I.func]):null}function t(I){return I?h([I.function.func,I.function.ref,I.function.mask,I.operation.fail,I.operation.zFail,I.operation.zPass]):null}function w(I){return I?h([I.zNear,I.zFar]):null}function r(I){return I?h([I.r,I.g,I.b,I.a]):null}function x(I){return I?h([I.mask]):null}const D={face:y.Face.BACK,mode:y.CullMode.CCW},A={face:y.Face.FRONT,
mode:y.CullMode.CCW};var v=function(){function I(H,J){this._makeKey=H;this._makeRef=J;this._interns=new Map}I.prototype.intern=function(H){if(!H)return null;const J=this._makeKey(H),N=this._interns;N.has(J)||N.set(J,this._makeRef(H));return N.get(J)??null};return b._createClass(I)}();const B=new v(z,I=>({__tag:"Blending",...I})),C=new v(n,I=>({__tag:"Culling",...I})),E=new v(l,I=>({__tag:"PolygonOffset",...I})),F=new v(m,I=>({__tag:"DepthTest",...I})),M=new v(t,I=>({__tag:"StencilTest",...I})),K=
new v(w,I=>({__tag:"DepthWrite",...I})),G=new v(r,I=>({__tag:"ColorWrite",...I})),L=new v(x,I=>({__tag:"StencilWrite",...I})),O=new v(function(I){return I?h([z(I.blending),n(I.culling),l(I.polygonOffset),m(I.depthTest),t(I.stencilTest),w(I.depthWrite),r(I.colorWrite),x(I.stencilWrite)]):null},I=>({blending:p(I.blending),culling:u(I.culling),polygonOffset:q(I.polygonOffset),depthTest:k(I.depthTest),stencilTest:d(I.stencilTest),depthWrite:f(I.depthWrite),colorWrite:g(I.colorWrite),stencilWrite:e(I.stencilWrite)}));
v=function(){function I(J){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=J}var H=I.prototype;H.setPipeline=function(J){if(this._pipelineInvalid||J!==this._pipeline)this._setBlending(J.blending),this._setCulling(J.culling),this._setPolygonOffset(J.polygonOffset),this._setDepthTest(J.depthTest),this._setStencilTest(J.stencilTest),
this._setDepthWrite(J.depthWrite),this._setColorWrite(J.colorWrite),this._setStencilWrite(J.stencilWrite),this._pipeline=J;this._pipelineInvalid=!1};H.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};H.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};H.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};H.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};H.invalidateStencilTest=
function(){this._pipelineInvalid=this._stencilTestInvalid=!0};H.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};H.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};H.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};H._setBlending=function(J){this._blending=this._setSubState(J,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};H._setCulling=function(J){this._culling=
this._setSubState(J,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};H._setPolygonOffset=function(J){this._polygonOffset=this._setSubState(J,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};H._setDepthTest=function(J){this._depthTest=this._setSubState(J,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};H._setStencilTest=function(J){this._stencilTest=
this._setSubState(J,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};H._setDepthWrite=function(J){this._depthWrite=this._setSubState(J,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};H._setColorWrite=function(J){this._colorWrite=this._setSubState(J,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};H._setStencilWrite=function(J){this._stencilWrite=
this._setSubState(J,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};H._setSubState=function(J,N,R,W){if(R||J!==N)W(J),this._pipelineInvalid=!0;return J};return b._createClass(I)}();a.StateTracker=v;a.backFaceCullingParams=D;a.cullingParams=I=>I===c.CullFaceOptions.Back?D:I===c.CullFaceOptions.Front?A:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=A;a.makeBlending=
p;a.makeColorWrite=g;a.makeCulling=u;a.makeDepthTest=k;a.makeDepthWrite=f;a.makePipelineState=function(I){return O.intern(I)};a.makePolygonOffset=q;a.makeStencilTest=d;a.makeStencilWrite=e;a.separateBlendingParams=function(I,H,J,N,R=y.BlendOperation.ADD,W=y.BlendOperation.ADD,T=[0,0,0,0]){return{srcRgb:I,srcAlpha:H,dstRgb:J,dstAlpha:N,opRgb:R,opAlpha:W,color:{r:T[0],g:T[1],b:T[2],a:T[3]}}};a.simpleBlendingParams=function(I,H,J=y.BlendOperation.ADD,N=[0,0,0,0]){return{srcRgb:I,srcAlpha:I,dstRgb:H,
dstAlpha:H,opRgb:J,opAlpha:J,color:{r:N[0],g:N[1],b:N[2],a:N[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||
(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits=
{}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));
a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.haze=!1;k.reduced=!1;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter()],p.prototype,"haze",void 0);c.__decorate([y.parameter()],p.prototype,"reduced",void 0);a.ChapmanAtmosphereTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(y){function p(){var u=y.call(this)||this;u._key="";u._keyDirty=!1;u._parameterBits=u._parameterBits?u._parameterBits.map(()=>0):[];u._parameterNames||(u._parameterNames=[]);return u}b._inherits(p,y);p.prototype.snapshot=function(){const u=this._parameterNames,q={key:this.key};for(const k of u)q[k]=
this[k];return q};b._createClass(p,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return p}(c.NoParameters);a.ShaderTechniqueConfiguration=c;a.parameter=function(y={}){return(p,u)=>{p._parameterNames=p._parameterNames??[];p._parameterNames.push(u);if(null!=y.constValue)Object.defineProperty(p,u,{get(){return y.constValue}});else{const q=p._parameterNames.length-1,k=Math.ceil(Math.log2(y.count||2)),
d=p._parameterBits??[0];let f=0;for(;16<d[f]+k;)f++,f>=d.length&&d.push(0);p._parameterBits=d;const g=d[f],e=(1<<k)-1<<g;d[f]+=k;Object.defineProperty(p,u,{get(){return this[q]},set(h){if(this[q]!==h&&(this[q]=h,this._keyDirty=!0,this._parameterBits[f]=this._parameterBits[f]&~e|+h<<g&e,"number"!==typeof h&&"boolean"!==typeof h))throw Error("Configuration value for "+u+" must be boolean or number, got "+typeof h);}})}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports",
"./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,y){const p=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],u=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new y.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],q=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new y.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,
c.DataType.FLOAT,12,32),new y.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],k=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new y.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],d=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new y.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new y.VertexElementDescriptor(b.VertexAttribute.UV0,2,
c.DataType.FLOAT,8,16)];a.Pos2=d;a.Pos2Tex=b;a.Pos3=p;a.Pos3Col=k;a.Pos3NormalTex=q;a.Pos3Tex=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,y,p,u,q,k=!1,d=0){this.name=c;this.count=y;this.type=p;this.offset=u;this.stride=q;this.normalized=k;this.divisor=d});a.VertexElementDescriptor=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,c,y,p,u,q,k){a.createColorTexture=function(d,f,g=4){const e=new Uint8Array(g*g*4);for(let h=0;h<e.length;h+=4)e[h]=255*f[0],e[h+1]=255*f[1],e[h+2]=255*f[2],e[h+3]=255*f[3];f=new k.TextureDescriptor;
f.samplingMode=u.TextureSamplingMode.NEAREST;f.width=f.height=g;return new q.Texture(d,f,e)};a.createEmptyDepthTexture=function(d){const f=new k.TextureDescriptor;f.samplingMode=u.TextureSamplingMode.NEAREST;f.width=f.height=1;return new q.Texture(d,f,new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(d,f=4){const g=new k.TextureDescriptor;g.samplingMode=u.TextureSamplingMode.NEAREST;g.width=g.height=f;return new q.Texture(d,g)};a.createQuadVAO=function(d,f=c.Pos2,g=b.Default3D,e=-1,
h=1){let z=null;switch(f){case c.Pos2Tex:z=new Float32Array([e,e,0,0,h,e,1,0,e,h,0,1,h,h,1,1]);break;default:z=new Float32Array([e,e,h,e,e,h,h,h])}return new y.VertexArrayObject(d,g,{geometry:f},{geometry:p.BufferObject.createVertex(d,u.Usage.STATIC_DRAW,z)})};a.createScreenSizeTriangleVAO=function(d,f=c.Pos2,g=b.Default3D){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new y.VertexArrayObject(d,g,{geometry:f},{geometry:p.BufferObject.createVertex(d,u.Usage.STATIC_DRAW,e)})};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/VertexArrayObject"],function(a,b,c){c=function(y){function p(){return y.apply(this,arguments)||this}b._inherits(p,y);return b._createClass(p)}(c.VertexArrayObject);a.VertexArrayObject=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),
function(a,b,c,y,p,u,q){const k=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function d(g,e,h,z,n=null){this._context=g;this._locations=e;this._layout=h;this._buffers=z;this._indexBuffer=n;this._glName=null;this._initialized=!1;g.instanceCounter.increment(u.ResourceType.VertexArrayObject,this)}var f=d.prototype;f.dispose=function(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const g in this._buffers)this._buffers[g]?.dispose(),delete this._buffers[g];
this._indexBuffer=y.disposeMaybe(this._indexBuffer);this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&k.warn("Leaked WebGL VAO")};f.disposeVAOOnly=function(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null);this._context.instanceCounter.decrement(u.ResourceType.VertexArrayObject,this);this._context=y.nullifyNonNullableForDispose(this._context)};f.initialize=function(){if(!this._initialized){var g=this._context.capabilities.vao;
if(g){const e=g.createVertexArray();g.bindVertexArray(e);this._bindLayout();g.bindVertexArray(null);this._glName=e}this._initialized=!0}};f.bind=function(){this.initialize();const g=this._context.capabilities.vao;g?g.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};f._bindLayout=function(){const {_buffers:g,_layout:e,_indexBuffer:h}=this;g||k.error("Vertex buffer dictionary is empty!");const z=this._context.gl;for(const n in g){const l=g[n];l||k.error("Vertex buffer is uninitialized!");
const m=e[n];m||k.error("Vertex element descriptor is empty!");q.bindVertexBufferLayout(this._context,this._locations,l,m)}null!=h&&(this._context.capabilities.vao?z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,h.glName):this._context.bindBuffer(h))};f.unbind=function(){this.initialize();const g=this._context.capabilities.vao;g?g.bindVertexArray(null):this._unbindLayout()};f._unbindLayout=function(){const {_buffers:g,_layout:e}=this;g||k.error("Vertex buffer dictionary is empty!");for(const h in g){const z=
g[h];z||k.error("Vertex buffer is uninitialized!");q.unbindVertexBufferLayout(this._context,this._locations,z,e[h])}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(d,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"byteSize",get:function(){return Object.keys(this._buffers).reduce((g,
e)=>g+this._buffers[e].byteLength,null!=this._indexBuffer?this._indexBuffer.byteLength:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}},{key:"memoryEstimate",get:function(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*p.typedArrayStaticSize}}]);return d}();a.VertexArrayObject=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has",
"./enums"],function(a,b,c){function y(p){return p[0].stride}a.bindVertexBufferLayout=function(p,u,q,k,d=0){const f=p.gl,g=p.capabilities.instancing;p.bindBuffer(q);for(const e of k)if(p=u.get(e.name),void 0===p&&console.error(`There is no location for vertex attribute '${e.name}' defined.`),q=d*e.stride,4>=e.count)f.vertexAttribPointer(p,e.count,e.type,e.normalized,e.stride,e.offset+q),f.enableVertexAttribArray(p),0<e.divisor&&g&&g.vertexAttribDivisor(p,e.divisor);else if(9===e.count)for(k=0;3>k;k++)f.vertexAttribPointer(p+
k,3,e.type,e.normalized,e.stride,e.offset+12*k+q),f.enableVertexAttribArray(p+k),0<e.divisor&&g&&g.vertexAttribDivisor(p+k,e.divisor);else if(16===e.count)for(k=0;4>k;k++)f.vertexAttribPointer(p+k,4,e.type,e.normalized,e.stride,e.offset+16*k+q),f.enableVertexAttribArray(p+k),0<e.divisor&&g&&g.vertexAttribDivisor(p+k,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)};a.getBytesPerElementFormat=function(p){switch(p){case c.PixelFormat.ALPHA:case c.PixelFormat.LUMINANCE:case c.PixelFormat.RED:case c.PixelFormat.RED_INTEGER:case c.SizedPixelFormat.R8:case c.SizedPixelFormat.R8I:case c.SizedPixelFormat.R8UI:case c.SizedPixelFormat.R8_SNORM:case c.RenderbufferFormat.STENCIL_INDEX8:return 1;
case c.PixelFormat.LUMINANCE_ALPHA:case c.PixelFormat.RG:case c.PixelFormat.RG_INTEGER:case c.SizedPixelFormat.RGBA4:case c.SizedPixelFormat.R16F:case c.SizedPixelFormat.R16I:case c.SizedPixelFormat.R16UI:case c.SizedPixelFormat.RG8:case c.SizedPixelFormat.RG8I:case c.SizedPixelFormat.RG8UI:case c.SizedPixelFormat.RG8_SNORM:case c.SizedPixelFormat.RGB565:case c.SizedPixelFormat.RGB5_A1:case c.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case c.PixelFormat.DEPTH_COMPONENT:case c.PixelFormat.RGB:case c.PixelFormat.RGB_INTEGER:case c.SizedPixelFormat.RGB8:case c.SizedPixelFormat.RGB8I:case c.SizedPixelFormat.RGB8UI:case c.SizedPixelFormat.RGB8_SNORM:case c.SizedPixelFormat.SRGB8:case c.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case c.PixelFormat.DEPTH_STENCIL:case c.PixelFormat.DEPTH24_STENCIL8:case c.PixelFormat.RGBA:case c.PixelFormat.RGBA_INTEGER:case c.SizedPixelFormat.RGBA8:case c.SizedPixelFormat.R32F:case c.SizedPixelFormat.R11F_G11F_B10F:case c.SizedPixelFormat.RG16F:case c.SizedPixelFormat.R32I:case c.SizedPixelFormat.R32UI:case c.SizedPixelFormat.RG16I:case c.SizedPixelFormat.RG16UI:case c.SizedPixelFormat.RGBA8I:case c.SizedPixelFormat.RGBA8UI:case c.SizedPixelFormat.RGBA8_SNORM:case c.SizedPixelFormat.SRGB8_ALPHA8:case c.SizedPixelFormat.RGB9_E5:case c.SizedPixelFormat.RGB10_A2UI:case c.SizedPixelFormat.RGB10_A2:case c.RenderbufferFormat.DEPTH_STENCIL:case c.RenderbufferFormat.DEPTH_COMPONENT32F:case c.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case c.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case c.SizedPixelFormat.RGB16F:case c.SizedPixelFormat.RGB16I:case c.SizedPixelFormat.RGB16UI:return 6;case c.SizedPixelFormat.RG32F:case c.SizedPixelFormat.RG32I:case c.SizedPixelFormat.RG32UI:case c.SizedPixelFormat.RGBA16F:case c.SizedPixelFormat.RGBA16I:case c.SizedPixelFormat.RGBA16UI:return 8;case c.SizedPixelFormat.RGB32F:case c.SizedPixelFormat.RGB32I:case c.SizedPixelFormat.RGB32UI:return 12;case c.SizedPixelFormat.RGBA32F:case c.SizedPixelFormat.RGBA32I:case c.SizedPixelFormat.RGBA32UI:return 16;
case c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case c.CompressedTextureFormat.COMPRESSED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case c.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case c.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case c.CompressedTextureFormat.COMPRESSED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case c.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case c.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=function(p){p=p.gl;switch(p.getError()){case p.NO_ERROR:return null;case p.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case p.INVALID_VALUE:return"An unacceptable value has been specified for an argument";
case p.INVALID_OPERATION:return"The specified command is not allowed for the current state";case p.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case p.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case p.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getStride=y;a.unbindVertexBufferLayout=function(p,u,q,k){const d=p.gl,f=p.capabilities.instancing;p.bindBuffer(q);for(const g of k)if(q=u.get(g.name),
4>=g.count)d.disableVertexAttribArray(q),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(q,0);else if(9===g.count)for(k=0;3>k;k++)d.disableVertexAttribArray(q+k),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(q+k,0);else if(16===g.count)for(k=0;4>k;k++)d.disableVertexAttribArray(q+k),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(q+k,0);else console.error("Unsupported vertex attribute element count: "+g.count);p.unbindBuffer(c.BufferType.ARRAY_BUFFER)};a.vertexCount=function(p,u){return p.vertexBuffers[u].byteLength/
y(p.layout[u])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./contextUtils ./enums".split(" "),function(a,b,c,y,p,u,q,k,d){const f=y.getLogger("esri.views.webgl.BufferObject");y=function(){function g(h,z,n,l){this._context=h;this.bufferType=z;this.usage=n;this._glName=null;this._size=
-1;this._indexType=void 0;h.instanceCounter.increment(d.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();q.checkWebGLError(this._context.gl);l&&this.setData(l)}g.createIndex=function(h,z,n){return new g(h,d.BufferType.ELEMENT_ARRAY_BUFFER,z,n)};g.createVertex=function(h,z,n){return new g(h,d.BufferType.ARRAY_BUFFER,z,n)};g.createUniform=function(h,z,n){if(h.type!==k.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new g(h,d.BufferType.UNIFORM_BUFFER,
z,n)};g.createPixelPack=function(h,z=d.Usage.STREAM_READ,n){if(h.type!==k.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");h=new g(h,d.BufferType.PIXEL_PACK_BUFFER,z);n&&h.setSize(n);return h};g.createPixelUnpack=function(h,z=d.Usage.STREAM_DRAW,n){if(h.type!==k.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new g(h,d.BufferType.PIXEL_UNPACK_BUFFER,z,n)};var e=g.prototype;e.dispose=function(){this._context?.gl?(this._glName&&
(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(d.ResourceType.BufferObject,this),this._context=p.nullifyNonNullableForDispose(this._context)):this._glName&&f.warn("Leaked WebGL buffer object")};e.setSize=function(h,z=null){0>=h&&f.error("Buffer size needs to be positive!");if(this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER&&null!=z)switch(this._indexType=z,z){case d.DataType.UNSIGNED_SHORT:h*=2;break;case d.DataType.UNSIGNED_INT:h*=4}this._setBufferData(h)};
e.setData=function(h){if(h){var z=h.byteLength;this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER&&(u.isUint16Array(h)&&(z/=2,this._indexType=d.DataType.UNSIGNED_SHORT),u.isUint32Array(h)&&(z/=4,this._indexType=d.DataType.UNSIGNED_INT));this._setBufferData(z,h)}};e._setBufferData=function(h,z=null){this._size=h;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const l=this._context.gl;null!=z?l.bufferData(this.bufferType,z,this.usage):
l.bufferData(this.bufferType,h,this.usage);q.checkWebGLError(l);this._isVAOAware&&this._context.bindVAO(n)};e.setSubData=function(h,z,n,l){if(h){(0>z||z*h.BYTES_PER_ELEMENT>=this.byteLength)&&f.error("offset is out of range!");n>=l&&f.error("end must be bigger than start!");(z+(l-n))*h.BYTES_PER_ELEMENT>this.byteLength&&f.error("An attempt to write beyond the end of the buffer!");var m=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var t=this._context.gl;
this._context.type===k.ContextType.WEBGL2?t.bufferSubData(this.bufferType,z*h.BYTES_PER_ELEMENT,h,n,l-n):(n=0===n&&l===h.length?h:h.subarray(n,l),t.bufferSubData(this.bufferType,z*h.BYTES_PER_ELEMENT,n));q.checkWebGLError(t);this._isVAOAware&&this._context.bindVAO(m)}};e.getSubData=function(h,z=0,n,l){if(this._context.type!==k.ContextType.WEBGL2)f.error("Get buffer subdata is supported in WebGL2 only!");else if(0>n||0>l)f.error("Problem getting subdata: offset and length were less than zero!");else{var m=
c.isArrayLike(h)?h.BYTES_PER_ELEMENT:1;m*((n??0)+(l??0))>h.byteLength?f.error("Problem getting subdata: offset and length exceeded destination size!"):(z+m*(l??0)>this.byteLength&&f.warn("Potential problem getting subdata: requested data exceeds buffer size!"),m=this._context.gl,this._context.bindBuffer(this,d.BufferType.COPY_READ_BUFFER),m.getBufferSubData(d.BufferType.COPY_READ_BUFFER,z,h,n,l),this._context.unbindBuffer(d.BufferType.COPY_READ_BUFFER))}};e.getSubDataAsync=async function(h,z=0,n,
l){this._context.type!==k.ContextType.WEBGL2?f.error("Get buffer subdata is supported in WebGL2 only!"):(await this._context.clientWaitAsync(),this.getSubData(h,z,n,l))};b._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteLength",get:function(){return this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===d.DataType.UNSIGNED_INT?4*this._size:2*this._size:
this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===d.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===d.BufferType.ARRAY_BUFFER}}]);return g}();a.BufferObject=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/contextUtils":function(){define(["exports","../../core/has"],function(a,b){function c(p,u,q={}){u=u===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const k of u)if(u=p.getContext(k,q))return u;
return null}function y(p){if("3d"===p)return[a.ContextType.WEBGL2];p=b("esri-force-webgl");return p===a.ContextType.WEBGL1||p===a.ContextType.WEBGL2?[p]:b("mac")&&b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}a.ContextType=void 0;(function(p){p[p.WEBGL1=1]="WEBGL1";p[p.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=c;a.createContextForView=function(p,u,q={}){p=y(p);for(const k of p)if(p=c(u,k,q))return p;return null};a.getContextTypes=
y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/has ../../core/mathUtils ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){function e(x,D){(null!=D.width&&0>D.width||null!=D.height&&0>D.height||null!=D.depth&&0>D.depth)&&console.error("Negative dimension parameters are not allowed!");
(x=x.type===q.ContextType.WEBGL2)||!D.isImmutable&&!t(D.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");x||null!=D.width&&p.isPowerOfTwo(D.width)&&null!=D.height&&p.isPowerOfTwo(D.height)||("number"===typeof D.wrapMode?D.wrapMode!==k.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(D.wrapMode.s!==k.TextureWrapMode.CLAMP_TO_EDGE||D.wrapMode.t!==k.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
D.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}function h(x,D){let A=D.samplingMode,v=D.samplingMode;if(A===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||A===k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)A=k.TextureSamplingMode.LINEAR,D.hasMipmap||(v=k.TextureSamplingMode.LINEAR);else if(A===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||A===k.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)A=k.TextureSamplingMode.NEAREST,D.hasMipmap||(v=k.TextureSamplingMode.NEAREST);x.texParameteri(D.target,
x.TEXTURE_MAG_FILTER,A);x.texParameteri(D.target,x.TEXTURE_MIN_FILTER,v)}function z(x,D){"number"===typeof D.wrapMode?(x.texParameteri(D.target,x.TEXTURE_WRAP_S,D.wrapMode),x.texParameteri(D.target,x.TEXTURE_WRAP_T,D.wrapMode)):(x.texParameteri(D.target,x.TEXTURE_WRAP_S,D.wrapMode.s),x.texParameteri(D.target,x.TEXTURE_WRAP_T,D.wrapMode.t))}function n(x,D){const A=x.capabilities.textureFilterAnisotropic;A&&x.gl.texParameterf(D.target,A.TEXTURE_MAX_ANISOTROPY,D.maxAnisotropy??1)}function l(x){return null!=
x&&"type"in x&&"compressed"===x.type}function m(x){return null!=x&&!l(x)&&!(null!=x&&"byteLength"in x)}function t(x){return x===k.TextureType.TEXTURE_3D||x===k.TextureType.TEXTURE_2D_ARRAY}function w(x,D,A,v=1){D=Math.max(D,A);x===k.TextureType.TEXTURE_3D&&(D=Math.max(D,v));return Math.round(Math.log(D)/Math.LN2)+1}y=function(){function x(A,v=null,B=null){this.type=d.GLObjectType.Texture;this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in A)this._descriptor=
A,B=v;else{A=g.ValidatedTextureDescriptor.validate(A,v);if(!A)throw new c("Texture descriptor invalid");this._descriptor=A}this._descriptor.context.instanceCounter.increment(k.ResourceType.Texture,this);if(this._descriptor.context.type!==q.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),t(this._descriptor.target)))throw new c("3D and array textures are not supported in WebGL1");this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(B):this.setData(B)}
var D=x.prototype;D.dispose=function(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(k.ResourceType.Texture,this))};D.release=function(){this.dispose()};D.resize=function(A,v){const B=this._descriptor;if(B.width!==A||B.height!==v){if(this._wasImmutablyAllocated)throw new c("Immutable textures can't be resized!");B.width=A;B.height=
v;this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};D._setDataCubeMap=function(A=null){for(let v=k.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;v<=k.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;v++)this._setData(A,v)};D.setData=function(A){this._setData(A)};D._setData=function(A,v){if(this._descriptor.context&&this._descriptor.context.gl){var B=this._descriptor.context.gl;u.checkWebGLError(B);this._glName||(this._glName=B.createTexture());void 0===A&&(A=
null);var C=this._descriptor,E=v??C.target,F=t(E);null===A&&(C.width=C.width||4,C.height=C.height||4,F&&(C.depth=C.depth??1));v=this._descriptor.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES);e(this._descriptor.context,C);this._configurePixelStorage();u.checkWebGLError(B);var M=this._deriveInternalFormat();if(m(A)){let K=A.width,G=A.height;A instanceof HTMLVideoElement&&(K=A.videoWidth,G=A.videoHeight);C.isImmutable&&!this._wasImmutablyAllocated&&
this._texStorage(E,M,C.hasMipmap,K,G,1);this._texImage(E,0,M,K,G,1,A);u.checkWebGLError(B);C.hasMipmap&&this.generateMipmap();C.width||(C.width=K);C.height||(C.height=G);F&&!C.depth&&(C.depth=1)}else{const {width:K,height:G,depth:L}=C;if(null==K||null==G)throw new c("Width and height must be specified!");if(F&&null==L)throw new c("Depth must be specified!");C.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(E,M,C.hasMipmap,K,G,L);if(l(A)){const O=A.levels;A=w(E,K,G,L);F=Math.min(A-1,O.length-
1);null!=this._descriptor.context.gl2?B.texParameteri(C.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,F):C.hasMipmap=C.hasMipmap&&A===O.length;if(!(M in k.CompressedTextureFormat))throw new c("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((I,H,J,N)=>{this._compressedTexImage(E,I,M,H,J,N,O[Math.min(I,O.length-1)])},F)}else this._texImage(E,0,M,K,G,L,A),u.checkWebGLError(B),C.hasMipmap&&this.generateMipmap()}h(B,this._descriptor);z(B,this._descriptor);
n(this._descriptor.context,this._descriptor);u.checkWebGLError(B);this._descriptor.context.bindTexture(v,x.TEXTURE_UNIT_FOR_UPDATES)}};D.updateData=function(A,v,B,C,E,F,M=0){F||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const K=this._descriptor.context.gl,G=this._descriptor.context.gl2,L=this._descriptor,O=this._deriveInternalFormat(),{pixelFormat:I,dataType:H,target:J,isImmutable:N}=L;if(N&&!this._wasImmutablyAllocated)throw new c("Cannot update immutable texture before allocation!");
const R=this._descriptor.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES,!0);(0>v||0>B||C>L.width||E>L.height||v+C>L.width||B+E>L.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(M){if(!G){console.error("Webgl2 must be enabled to use dataRowOffset!");return}K.pixelStorei(G.UNPACK_SKIP_ROWS,M)}m(F)?G?G.texSubImage2D(J,A,v,B,C,E,I,H,F):K.texSubImage2D(J,A,v,B,I,H,F):l(F)?K.compressedTexSubImage2D(J,A,v,B,C,E,O,F.levels[A]):K.texSubImage2D(J,
A,v,B,C,E,I,H,F);if(M){if(!G){console.error("Webgl2 must be enabled to use dataRowOffset!");return}K.pixelStorei(G.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(R,x.TEXTURE_UNIT_FOR_UPDATES)};D.updateData3D=function(A,v,B,C,E,F,M,K){K||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const G=this._descriptor.context.gl2;if(null==G)throw new c("3D textures are not supported in WebGL1");const L=this._descriptor,
O=this._deriveInternalFormat(),{pixelFormat:I,dataType:H,isImmutable:J,target:N}=L;if(J&&!this._wasImmutablyAllocated)throw new c("Cannot update immutable texture before allocation!");t(N)||console.warn("Attempting to set 3D texture data on a non-3D texture");const R=this._descriptor.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES);(0>v||0>B||0>C||E>L.width||F>L.height||M>L.depth||v+E>L.width||B+F>L.height||C+M>L.depth)&&console.error("An attempt to update out of bounds of the texture!");
this._configurePixelStorage();l(K)?(K=K.levels[A],G.compressedTexSubImage3D(N,A,v,B,C,E,F,M,O,K)):G.texSubImage3D(N,A,v,B,C,E,F,M,I,H,K);this._descriptor.context.bindTexture(R,x.TEXTURE_UNIT_FOR_UPDATES)};D.generateMipmap=function(){const A=this._descriptor;if(!A.hasMipmap){if(this._wasImmutablyAllocated)throw new c("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=A.hasMipmap=!0;e(this._descriptor.context,A)}A.samplingMode===k.TextureSamplingMode.LINEAR?(this._samplingModeDirty=
!0,A.samplingMode=k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):A.samplingMode===k.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,A.samplingMode=k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const v=this._descriptor.context.bindTexture(this,x.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(x.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(A.target);this._descriptor.context.bindTexture(v,x.TEXTURE_UNIT_FOR_UPDATES)};D.setSamplingMode=function(A){A!==
this._descriptor.samplingMode&&(this._descriptor.samplingMode=A,this._samplingModeDirty=!0)};D.setWrapMode=function(A){A!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=A,e(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)};D.applyChanges=function(){const A=this._descriptor.context.gl,v=this._descriptor;this._samplingModeDirty&&(h(A,v),this._samplingModeDirty=!1);this._wrapModeDirty&&(z(A,v),this._wrapModeDirty=!1)};D._deriveInternalFormat=function(){if(this._descriptor.context.type===
q.ContextType.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===k.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=k.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case k.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA32F;case k.PixelFormat.RGB:return this._descriptor.internalFormat=
k.SizedPixelFormat.RGB32F;default:throw new c("Unable to derive format");}case k.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA8;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===k.PixelFormat.DEPTH_STENCIL?k.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat};D._configurePixelStorage=
function(){const A=this._descriptor.context.gl,{unpackAlignment:v,flipped:B,preMultiplyAlpha:C}=this._descriptor;A.pixelStorei(A.UNPACK_ALIGNMENT,v);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,B?1:0);A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C?1:0)};D._texStorage=function(A,v,B,C,E,F){const M=this._descriptor.context.gl2;if(null==M)throw new c("Immutable textures are not supported in WebGL1");if(!(v in k.SizedPixelFormat))throw new c("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){B=
B?w(A,C,E,F):1;if(t(A)){if(null==F)throw new c("Missing depth dimension for 3D texture upload");M.texStorage3D(A,B,v,C,E,F)}else M.texStorage2D(A,B,v,C,E);this._wasImmutablyAllocated=!0}};D._texImage=function(A,v,B,C,E,F,M){const K=this._descriptor.context.gl,G=t(A),{isImmutable:L,pixelFormat:O,dataType:I}=this._descriptor,H=this._descriptor.context.type===q.ContextType.WEBGL2,J=H?K:null;if(!H&&m(M))K.texImage2D(A,0,B,O,I,M);else if(L){if(null!=M)if(G){if(null==F)throw new c("Missing depth dimension for 3D texture upload");
J.texSubImage3D(A,v,0,0,0,C,E,F,O,I,M)}else K.texSubImage2D(A,v,0,0,C,E,O,I,M)}else if(G){if(null==F)throw new c("Missing depth dimension for 3D texture upload");J.texImage3D(A,v,B,C,E,F,0,O,I,M)}else K.texImage2D(A,v,B,C,E,0,O,I,M)};D._compressedTexImage=function(A,v,B,C,E,F,M){const K=this._descriptor.context.gl;let G=null;const L=t(A),O=this._descriptor.isImmutable;if(L){if(this._descriptor.context.type!==q.ContextType.WEBGL2)throw new c("3D textures are not supported in WebGL1");G=K}if(O){if(null!=
M)if(L){if(null==F)throw new c("Missing depth dimension for 3D texture upload");G.compressedTexSubImage3D(A,v,0,0,0,C,E,F,B,M)}else K.compressedTexSubImage2D(A,v,0,0,C,E,B,M)}else if(L){if(null==F)throw new c("Missing depth dimension for 3D texture upload");G.compressedTexImage3D(A,v,B,C,E,F,0,M)}else K.compressedTexImage2D(A,v,B,C,E,0,M)};D._forEachMipmapLevel=function(A,v=Infinity){let {width:B,height:C,depth:E,hasMipmap:F,target:M}=this._descriptor;const K=M===k.TextureType.TEXTURE_3D;if(null==
B||null==C||K&&null==E)throw new c("Missing texture dimensions for mipmap calculation");for(let G=0;;++G){A(G,B,C,E);if(!F||1===B&&1===C&&(!K||1===E)||G>=v)break;B=Math.max(1,B>>1);C=Math.max(1,C>>1);K&&(E=Math.max(1,E>>1))}};b._createClass(x,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},{key:"gpuMemoryUsage",get:function(){r.delete(this);return f.estimateMemory(this._descriptor)}},{key:"isDirty",get:function(){return this._samplingModeDirty||
this._wrapModeDirty}}]);return x}();y.TEXTURE_UNIT_FOR_UPDATES=0;const r=new Map;a.Texture=y;a.clearUnestimatedTextures=function(){const x=[];r.forEach((D,A)=>x.push([A.gpuMemoryUsage,D]));r.clear();x.sort((D,A)=>A[0]-D[0]);return x.reduce((D,A)=>`${D}\n\n${Math.round(A[0]/1024)}KB: ${A[1]}`,"")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var b=a.GLObjectType||(a.GLObjectType={});b[b.Texture=
0]="Texture";b[b.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums","./Util"],function(a,b,c,y){b=b._createClass(function(p=0,u=p){this.width=p;this.height=u;this.target=c.TextureType.TEXTURE_2D;this.pixelFormat=c.PixelFormat.RGBA;this.dataType=c.PixelType.UNSIGNED_BYTE;this.samplingMode=c.TextureSamplingMode.LINEAR;this.wrapMode=c.TextureWrapMode.REPEAT;
this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=!1});a.TextureDescriptor=b;a.estimateMemory=function(p){return 0>=p.width||0>=p.height||null==p.internalFormat?0:p.width*p.height*(p.hasMipmap?4/3:1)*y.getBytesPerElementFormat(p.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"./enums","./TextureDescriptor"],function(a,b,c,y){y=function(p){function u(q,k){var d=p.call(this)||this;d.context=q;Object.assign(b._assertThisInitialized(d),k);switch(d.internalFormat){case c.SizedPixelFormat.R16F:case c.SizedPixelFormat.R16I:case c.SizedPixelFormat.R16UI:case c.SizedPixelFormat.R32F:case c.SizedPixelFormat.R32I:case c.SizedPixelFormat.R32UI:case c.SizedPixelFormat.R8_SNORM:case c.SizedPixelFormat.R8:case c.SizedPixelFormat.R8I:case c.SizedPixelFormat.R8UI:d.pixelFormat=c.PixelFormat.RED}return d}
b._inherits(u,p);u.validate=function(q,k){return new u(q,k)};return b._createClass(u)}(y.TextureDescriptor);a.ValidatedTextureDescriptor=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){a.CloudsComposition=function(l){function m(w){var r=l.call(this,w)||this;r._technique=new g.CloudsCompositionTechnique(w);r._vao=h.createQuadVAO(w.rctx);return r}b._inherits(m,l);var t=m.prototype;t.destroy=function(){this._technique=p.releaseMaybe(this._technique);this._vao=p.disposeMaybe(this._vao)};t.render=function(w){var r=w.bindParameters.cloudsFade;null!=this._vao&&null!=r.data&&(this._technique.compiled?(r=w.rctx.bindTechnique(this._technique,n,w.bindParameters),
w.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),w.rctx.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4)):this.requestRender())};return b._createClass(m)}(y);c.__decorate([u.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([u.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([u.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);c.__decorate([u.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=c.__decorate([f.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const n=new e.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){u=function(e){function h(n){var l;return l=e.call(this,n,new q.ShaderTechniqueConfiguration,()=>l.destroy())||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new d.Program(n.rctx,h.shader.get().build(),k.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};
return c._createClass(h)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(y.CloudsCompositionShader,()=>new Promise((e,h)=>a(["./CloudsComposition.glsl"],e,h)));b.CloudsCompositionTechnique=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(){const w=new n.ShaderBuilder;w.attributes.add(l.VertexAttribute.POSITION,"vec2");w.varyings.add("worldRay","vec3");const {vertex:r,fragment:x}=w;r.uniforms.add(new z.Matrix4PassUniform("inverseProjectionMatrix",(D,A)=>A.camera.inverseProjectionMatrix),new z.Matrix4PassUniform("inverseViewMatrix",(D,A)=>b.invertOrIdentity(t,A.camera.viewMatrix)));r.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);x.include(f.ColorConversion);x.include(g.RgbaFloatEncoding);w.include(y.EvaluateAmbientLighting,{pbrMode:q.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});w.include(k.PiUtils);w.include(p.Gamma);w.include(u.MainLighting);w.include(d.CloudsParallaxShading,{instancedDoublePrecision:!1});x.uniforms.add(new e.Float3PassUniform("cameraPosition",(D,A)=>A.camera.eye));x.code.add(h.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return w}const t=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=c;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,y,p,u,q,k,d){const f=c.create(),g=p.create();a.EvaluateAmbientLighting=function(e,h){e=e.fragment;const z=void 0!==h.lightingSphericalHarmonicsOrder?h.lightingSphericalHarmonicsOrder:2;0===z?(e.uniforms.add(new q.Float3PassUniform("lightingAmbientSH0",(n,l)=>b.set(f,l.lighting.sh.r[0],l.lighting.sh.g[0],l.lighting.sh.b[0]))),e.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===z?(e.uniforms.add(new k.Float4PassUniform("lightingAmbientSH_R",(n,l)=>y.set(g,l.lighting.sh.r[0],l.lighting.sh.r[1],l.lighting.sh.r[2],l.lighting.sh.r[3])),new k.Float4PassUniform("lightingAmbientSH_G",(n,l)=>y.set(g,l.lighting.sh.g[0],l.lighting.sh.g[1],l.lighting.sh.g[2],l.lighting.sh.g[3])),new k.Float4PassUniform("lightingAmbientSH_B",(n,l)=>y.set(g,l.lighting.sh.b[0],l.lighting.sh.b[1],l.lighting.sh.b[2],l.lighting.sh.b[3]))),e.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===z&&(e.uniforms.add(new q.Float3PassUniform("lightingAmbientSH0",(n,l)=>b.set(f,l.lighting.sh.r[0],l.lighting.sh.g[0],l.lighting.sh.b[0])),new k.Float4PassUniform("lightingAmbientSH_R1",(n,l)=>y.set(g,l.lighting.sh.r[1],l.lighting.sh.r[2],l.lighting.sh.r[3],l.lighting.sh.r[4])),new k.Float4PassUniform("lightingAmbientSH_G1",(n,l)=>y.set(g,l.lighting.sh.g[1],l.lighting.sh.g[2],l.lighting.sh.g[3],l.lighting.sh.g[4])),new k.Float4PassUniform("lightingAmbientSH_B1",(n,l)=>y.set(g,l.lighting.sh.b[1],
l.lighting.sh.b[2],l.lighting.sh.b[3],l.lighting.sh.b[4])),new k.Float4PassUniform("lightingAmbientSH_R2",(n,l)=>y.set(g,l.lighting.sh.r[5],l.lighting.sh.r[6],l.lighting.sh.r[7],l.lighting.sh.r[8])),new k.Float4PassUniform("lightingAmbientSH_G2",(n,l)=>y.set(g,l.lighting.sh.g[5],l.lighting.sh.g[6],l.lighting.sh.g[7],l.lighting.sh.g[8])),new k.Float4PassUniform("lightingAmbientSH_B2",(n,l)=>y.set(g,l.lighting.sh.b[5],l.lighting.sh.b[6],l.lighting.sh.b[7],l.lighting.sh.b[8]))),e.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),h.pbrMode!==u.PBRMode.Normal&&h.pbrMode!==u.PBRMode.Schematic||e.code.add(d.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.PBRMode=void 0;(function(g){g[g.Disabled=0]="Disabled";g[g.Normal=1]="Normal";g[g.Schematic=2]="Schematic";g[g.Water=3]="Water";g[g.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";g[g.Terrain=5]="Terrain";g[g.TerrainWithWater=6]="TerrainWithWater";g[g.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));f=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(f.GLTextureMaterialBindParameters);a.PBRBindParameters=f;a.PhysicallyBasedRenderingParameters=
function(g,e){const h=g.fragment,z=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;e.pbrMode===a.PBRMode.Normal&&z&&g.include(c.VertexTextureCoordinates,e);e.pbrMode===a.PBRMode.Schematic?h.code.add(u.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):e.pbrMode===a.PBRMode.Disabled?h.code.add(u.glsl`float getBakedOcclusion() { return 1.0; }`):e.pbrMode===a.PBRMode.Normal&&(h.code.add(u.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),g=e.pbrTextureBindType,e.hasMetallicRoughnessTexture&&(h.uniforms.add(g===d.BindType.Pass?new k.Texture2DPassUniform("texMetallicRoughness",n=>n.textureMetallicRoughness):new q.Texture2DDrawUniform("texMetallicRoughness",n=>n.textureMetallicRoughness)),h.code.add(u.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(h.uniforms.add(g===d.BindType.Pass?new k.Texture2DPassUniform("texEmission",n=>n.textureEmissive):new q.Texture2DDrawUniform("texEmission",n=>n.textureEmissive)),h.code.add(u.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(h.uniforms.add(g===d.BindType.Pass?new k.Texture2DPassUniform("texOcclusion",n=>n.textureOcclusion):new q.Texture2DDrawUniform("texOcclusion",n=>n.textureOcclusion)),h.code.add(u.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):h.code.add(u.glsl`float getBakedOcclusion() { return 1.0; }`),g===d.BindType.Pass?h.uniforms.add(new p.Float3PassUniform("emissionFactor",n=>n.emissiveFactor),new p.Float3PassUniform("mrrFactors",n=>n.mrrFactors)):h.uniforms.add(new y.Float3DrawUniform("emissionFactor",n=>n.emissiveFactor),new y.Float3DrawUniform("mrrFactors",n=>n.mrrFactors)),h.code.add(u.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?u.glsl`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?u.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?u.glsl`applyEmission(${e.hasEmissiveTextureTransform?u.glsl`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?u.glsl`applyOcclusion(${e.hasOcclusionTextureTransform?u.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,y,p){a.VertexTextureCoordinates=function(u,q){u.include(c.TextureCoordinateAttribute,q);switch(q.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:case c.TextureCoordinateAttributeType.Compressed:u.fragment.code.add(p.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:u.include(y.TextureAtlasLookup);u.fragment.code.add(p.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:b.neverReached(q.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec3",y.BindType.Draw,(d,f,g,e)=>d.setUniform3fv(q,k(f,g,e)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Float3DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"sampler2D",y.BindType.Draw,(d,f,g)=>d.bindTexture(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Texture2DDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),
function(a,b,c,y,p,u,q){q=function(d){function f(e){var h=d.call(this,e)||this;h._numLoading=0;h._disposed=!1;h._textureRepository=e.textureRep;h._textureId=e.textureId;h._acquire(e.textureId,z=>h._texture=z);h._acquire(e.normalTextureId,z=>h._textureNormal=z);h._acquire(e.emissiveTextureId,z=>h._textureEmissive=z);h._acquire(e.occlusionTextureId,z=>h._textureOcclusion=z);h._acquire(e.metallicRoughnessTextureId,z=>h._textureMetallicRoughness=z);return h}b._inherits(f,d);var g=f.prototype;g.dispose=
function(){this._texture=c.releaseMaybe(this._texture);this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};g.ensureResources=function(e){return 0===this._numLoading?u.ResourceState.LOADED:u.ResourceState.LOADING};g.updateTexture=function(e){if(null==this._texture||e!==this._texture.id)this._texture=
c.releaseMaybe(this._texture),this._textureId=e,this._acquire(this._textureId,h=>this._texture=h)};g._acquire=function(e,h){null==e?h(null):(e=this._textureRepository.acquire(e),y.isPromiseLike(e)?(++this._numLoading,e.then(z=>{this._disposed?(c.releaseMaybe(z),h(null)):h(z)}).finally(()=>--this._numLoading)):h(e))};b._createClass(f,[{key:"textureBindParameters",get:function(){return new k(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,
null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}}]);return f}(q);let k=function(d){function f(g=null,e=null,h=null,z=null,n=null){var l=d.call(this)||this;l.texture=g;l.textureNormal=e;l.textureEmissive=h;l.textureOcclusion=z;l.textureMetallicRoughness=n;return l}b._inherits(f,d);return b._createClass(f)}(p.NoParameters);a.GLTextureMaterial=
q;a.GLTextureMaterialBindParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b){return function(){function c(p){this._material=p.material;this._techniqueRepository=p.techniqueRep;this._output=p.output}var y=c.prototype;y.dispose=function(){this._techniqueRepository.release(this._technique)};y.ensureTechnique=function(p,u){return this._technique=
this._techniqueRepository.releaseAndAcquire(p,this._material.getConfiguration(this._output,u),this._technique)};y.ensureResources=function(p){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",get:function(){return this._technique}},{key:"_stippleTextureRepository",get:function(){return this._techniqueRepository.constructionContext.stippleTextureRepository}},{key:"_markerTextureRepository",get:function(){return this._techniqueRepository.constructionContext.markerTextureRepository}}]);
return c}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../../../environment/CloudsData ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.CloudsParallaxShading=function(h){h=h.fragment;h.uniforms.add(new g.Matrix4PassUniform("rotationMatrixClouds",(z,n)=>n.cloudsFade.parallax.transform),new g.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(z,n)=>n.cloudsFade.parallaxNew.transform),new k.Float3PassUniform("anchorPosition",(z,n)=>n.cloudsFade.parallax.anchorPointClouds),new k.Float3PassUniform("anchorPositionCrossFade",(z,n)=>n.cloudsFade.parallaxNew.anchorPointClouds),new d.FloatPassUniform("cloudsHeight",
(z,n)=>n.cloudsFade.parallax.cloudsHeight),new d.FloatPassUniform("radiusCurvatureCorrectionFactor",(z,n)=>n.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new d.FloatPassUniform("totalFadeInOut",(z,n)=>n.cloudsFade.fadeInOut.stage===y.FadeInOutStages.FINISHED?n.cloudsFade.fadeInOutHeight.factor+1-n.cloudsFade.fadeIn.factor:n.cloudsFade.fadeInOutHeight.factor+1-n.cloudsFade.fadeInOut.factor),new d.FloatPassUniform("crossFadeAnchorFactor",(z,n)=>b.clamp(n.cloudsFade.crossFade.factor,0,1)),new e.TextureCubePassUniform("cubeMap",
(z,n)=>n.cloudsFade.data?.cubeMap?n.cloudsFade.data.cubeMap.colorTexture:null),new q.BooleanPassUniform("crossFade",(z,n)=>n.cloudsFade.crossFade.enabled),new q.BooleanPassUniform("readChannelsRG",(z,n)=>n.cloudsFade.readChannels===p.CloudsTextureChannels.RG),new q.BooleanPassUniform("fadeTextureChannels",(z,n)=>n.cloudsFade.renderingStage===p.CloudsRenderingStages.FADING_TEXTURE_CHANNELS));h.constants.add("planetRadius","float",c.earth.radius);h.code.add(f.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);h.code.add(f.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);h.code.add(f.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);u.addMainLightDirection(h);u.addMainLightIntensity(h);h.code.add(f.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);h.code.add(f.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);h.code.add(f.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);h.code.add(f.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);h.code.add(f.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat4f64","../../../chunks/vec3f64","./CloudsData"],function(a,b,c,y,p){let u=function(){function k(){this.readChannels=p.CloudsTextureChannels.RG;this.renderingStage=p.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=y.create();this.isCameraPositionFinal=
!0;this.parallax=new q;this.parallaxNew=new q;this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:1,distanceThresholdFactor:.6};this.fadeIn={stage:a.FadeInStages.FINISHED,factor:1,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}}b._createClass(k,[{key:"isFading",get:function(){return this.fadeInOut.stage===a.FadeInOutStages.FADE_OUT||this.fadeInOut.stage===a.FadeInOutStages.FADE_IN||this.fadeIn.stage===
a.FadeInStages.FADE_IN||this.fadeInOutHeight.stage!==a.FadeHeightStages.FINISHED||this.renderingStage===p.CloudsRenderingStages.FADING_TEXTURE_CHANNELS}}]);return k}();a.FadeInStages=void 0;(function(k){k[k.FINISHED=0]="FINISHED";k[k.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";k[k.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(k){k[k.FINISHED=0]="FINISHED";k[k.FADE_OUT=1]="FADE_OUT";k[k.SWITCH=2]="SWITCH";k[k.FADE_IN=3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages=
{}));a.FadeHeightStages=void 0;(function(k){k[k.FINISHED=0]="FINISHED";k[k.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages={}));let q=b._createClass(function(){this.anchorPointClouds=y.create();this.cloudsHeight=1E5;this.radiusCurvatureCorrectionFactor=0;this.transform=c.create()});a.CloudsFadeParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports"],function(a){a.CloudsRenderingStages=void 0;
(function(b){b[b.RENDERING=0]="RENDERING";b[b.FINISHED_RENDERING=1]="FINISHED_RENDERING";b[b.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS";b[b.SWITCH_CHANNELS=3]="SWITCH_CHANNELS";b[b.FINISHED=4]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return null!=b&&!b.running};a.isReadyCloudsData=function(b){return null!=
b?.cubeMap};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"bool",y.BindType.Pass,(d,f,g)=>d.setUniform1b(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.BooleanPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"samplerCube",y.BindType.Pass,(d,f,g)=>d.bindTexture(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.TextureCubePassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L){a.CloudsGenerator=function(J){function N(W){var T=J.call(this,W)||this;T._handles=new p;T._techniques=[];T._techniqueConfiguration=new B.CloudsTechniqueConfiguration;T._bindParameters=new E.BindParameters(null,null,null);T._passParameters=new x.CloudsPassParameters;T._drawParameters=new x.CloudsDrawParameters;T._weatherTile=t.create();T._weatherTileCount=128;T._faceIndex=0;T._tileIndex=0;T.coverage=u.lerp(A.cloudPresets.default.coverage[0],
A.cloudPresets.default.coverage[1],.5);T.density=u.lerp(A.cloudPresets.default.density[0],A.cloudPresets.default.density[1],.5);T.absorption=u.lerp(A.cloudPresets.default.absorption[0],A.cloudPresets.default.absorption[1],.5);T.cloudSize=u.lerp(A.cloudPresets.default.cloudSize[0],A.cloudPresets.default.cloudSize[1],.5);T.detailSize=u.lerp(A.cloudPresets.default.detailSize[0],A.cloudPresets.default.detailSize[1],.5);T.smoothness=u.lerp(A.cloudPresets.default.smoothness[0],A.cloudPresets.default.smoothness[1],
.5);T.cloudHeight=u.lerp(A.cloudPresets.default.cloudHeight[0],A.cloudPresets.default.cloudHeight[1],.5);T.raymarchingSteps=A.cloudPresets.default.raymarchingSteps;T._viewMatrix=l.create();T._dirty=!1;T.running=!1;T._vao=F.createQuadVAO(W.context.renderContext.rctx);return T}b._inherits(N,J);var R=N.prototype;R._getTechnique=function(W){const T=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,P=T===D.CloudsTextureChannels.RG?2*W:2*W+1,Q=this._techniques[P];if(Q)return Q;this._techniqueConfiguration.writeTextureChannels=
T;this._techniqueConfiguration.steps=W;this._techniques[P]=new v.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[P]};R.updateWeatherTile=function(){var W=this.view.camera.position.latitude,T=this.view.camera.position.longitude;null!=W&&null!=T&&(m.set(this._weatherTile,(W+90)/180,(T+180)/360),W=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*
this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-W)*this._weatherTile[1]),T=W=0,null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date&&(T=new Date(this.view.environment.lighting.date),T.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),W=31*T.getUTCMonth()+T.getUTCDate(),T=T.getUTCFullYear()),this._weatherTile[0]=
(this._weatherTile[0]+W)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+T%100)%(4*this._weatherTileCount),m.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())};R.initialize=function(){const W=r.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*W.radius;this.setDirty();this.updateWeatherTile();this._handles.add([this.view.resourceController.scheduler.registerTask(M.TaskPriority.CLOUDS_GENERATOR,this),k.watch(()=>[this.coverage,
this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),k.initial)])};R.destroy=function(){this._handles.destroy();this._techniques.forEach(W=>q.releaseMaybe(W));this._frameBufferCube=q.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao.dispose();this._passParameters.noiseTexture=q.destroyMaybe(this._passParameters.noiseTexture)};R._ensureNoiseTexture=function(){null==this._passParameters.noiseTexture&&
(this._passParameters.noiseTexture=new C.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return null!=this._passParameters.noiseTexture.textureAtlas};R._ensureFrameBufferCube=function(W){null==this._frameBufferCube&&(W=new L.TextureDescriptor(W),W.target=K.TextureType.TEXTURE_CUBE_MAP,W.wrapMode=K.TextureWrapMode.CLAMP_TO_EDGE,this._frameBufferCube=new G.FramebufferObject(this.context.renderContext.rctx,W));return this._frameBufferCube};
R.destroyFrameBufferCube=function(){this._frameBufferCube=q.disposeMaybe(this._frameBufferCube)};R.applyPreset=function(W,T){const P=W.median,Q=S=>{const U=u.lerp(S[0],S[1],P);return.5>T?u.lerp(S[0],U,2*T):u.lerp(U,S[1],2*(T-.5))};this.coverage=Q(W.coverage);this.density=Q(W.density);this.absorption=Q(W.absorption);this.cloudSize=Q(W.cloudSize);this.detailSize=Q(W.detailSize);this.smoothness=Q(W.smoothness);this.cloudHeight=Q(W.cloudHeight);this.raymarchingSteps=W.raymarchingSteps};R.setDirty=function(){this._dirty=
this.running=!0};R.runTask=function(W){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),m.copy(this._passParameters.weatherTile,this._weatherTile));var T=this._getTechnique(this._passParameters.raymarchingSteps);if(!T.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return M.Task.YIELD;0===this._faceIndex&&
0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=D.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const P=this.context.renderContext.rctx,
Q=P.bindTechnique(T,this._passParameters,this._bindParameters);P.bindVAO(this._vao);Q.assertCompatibleVertexAttributeLocations(this._vao);const S=P.getViewport();T=T.configuration.cubeMapSize;const U=T/this._tilesPerFace;P.setViewport(0,this._tileIndex*U,T,U);T=this._ensureFrameBufferCube(T);P.bindFramebuffer(T);n.targetTo(this._viewMatrix,H,O[this._faceIndex],I[this._faceIndex]);z.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);T.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+
this._faceIndex);Q.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);P.gl.drawArrays(P.gl.TRIANGLE_STRIP,0,4);P.gl.flush();P.setViewport(S.x,S.y,S.width,S.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=D.CloudsRenderingStages.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,
this._tileIndex=0);W.madeProgress();return M.Task.YIELD};b._createClass(N,[{key:"_tilesPerFace",get:function(){switch(this._techniqueConfiguration.steps){case B.RayMarchingSteps.SIXTEEN:return 1;case B.RayMarchingSteps.HUNDRED:return 4;case B.RayMarchingSteps.COUNT:case B.RayMarchingSteps.TWOHUNDRED:return 8}}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return N}(y);c.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);c.__decorate([d.property({constructOnly:!0})],
a.CloudsGenerator.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"density",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"detailSize",
void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=c.__decorate([h.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const O=[w.fromValues(1,0,0),w.fromValues(-1,0,0),w.fromValues(0,1,0),w.fromValues(0,
-1,0),w.fromValues(0,0,1)],I=[w.fromValues(0,1,0),w.fromValues(0,1,0),w.fromValues(0,0,-1),w.fromValues(0,0,1),w.fromValues(0,1,0)],H=w.zeros();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function c(I,H){I[0]=H[0];I[1]=H[1];I[2]=H[2];I[3]=H[4];I[4]=H[5];I[5]=H[6];I[6]=H[8];I[7]=H[9];I[8]=H[10];return I}function y(I,H){I[0]=H[0];I[1]=H[1];I[2]=H[2];I[3]=H[3];I[4]=H[4];I[5]=H[5];I[6]=H[6];I[7]=H[7];I[8]=H[8];
return I}function p(I,H,J,N,R,W,T,P,Q,S){I[0]=H;I[1]=J;I[2]=N;I[3]=R;I[4]=W;I[5]=T;I[6]=P;I[7]=Q;I[8]=S;return I}function u(I){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function q(I,H){if(I===H){const J=H[1],N=H[2],R=H[5];I[1]=H[3];I[2]=H[6];I[3]=J;I[5]=H[7];I[6]=N;I[7]=R}else I[0]=H[0],I[1]=H[3],I[2]=H[6],I[3]=H[1],I[4]=H[4],I[5]=H[7],I[6]=H[2],I[7]=H[5],I[8]=H[8];return I}function k(I,H){const J=H[0],N=H[1],R=H[2],W=H[3],T=H[4],P=H[5],Q=H[6],S=H[7];H=H[8];const U=H*
T-P*S,V=-H*W+P*Q,X=S*W-T*Q;let Y=J*U+N*V+R*X;if(!Y)return null;Y=1/Y;I[0]=U*Y;I[1]=(-H*N+R*S)*Y;I[2]=(P*N-R*T)*Y;I[3]=V*Y;I[4]=(H*J-R*Q)*Y;I[5]=(-P*J+R*W)*Y;I[6]=X*Y;I[7]=(-S*J+N*Q)*Y;I[8]=(T*J-N*W)*Y;return I}function d(I,H){const J=H[0],N=H[1],R=H[2],W=H[3],T=H[4],P=H[5],Q=H[6],S=H[7];H=H[8];I[0]=T*H-P*S;I[1]=R*S-N*H;I[2]=N*P-R*T;I[3]=P*Q-W*H;I[4]=J*H-R*Q;I[5]=R*W-J*P;I[6]=W*S-T*Q;I[7]=N*Q-J*S;I[8]=J*T-N*W;return I}function f(I){const H=I[3],J=I[4],N=I[5],R=I[6],W=I[7],T=I[8];return I[0]*(T*J-N*
W)+I[1]*(-T*H+N*R)+I[2]*(W*H-J*R)}function g(I,H,J){const N=H[0],R=H[1],W=H[2],T=H[3],P=H[4],Q=H[5],S=H[6],U=H[7];H=H[8];const V=J[0],X=J[1],Y=J[2],Z=J[3],ea=J[4],ja=J[5],ha=J[6],ia=J[7];J=J[8];I[0]=V*N+X*T+Y*S;I[1]=V*R+X*P+Y*U;I[2]=V*W+X*Q+Y*H;I[3]=Z*N+ea*T+ja*S;I[4]=Z*R+ea*P+ja*U;I[5]=Z*W+ea*Q+ja*H;I[6]=ha*N+ia*T+J*S;I[7]=ha*R+ia*P+J*U;I[8]=ha*W+ia*Q+J*H;return I}function e(I,H,J){const N=H[0],R=H[1],W=H[2],T=H[3],P=H[4],Q=H[5],S=H[6],U=H[7];H=H[8];const V=J[0];J=J[1];I[0]=N;I[1]=R;I[2]=W;I[3]=
T;I[4]=P;I[5]=Q;I[6]=V*N+J*T+S;I[7]=V*R+J*P+U;I[8]=V*W+J*Q+H;return I}function h(I,H,J){const N=H[0],R=H[1],W=H[2],T=H[3],P=H[4],Q=H[5],S=H[6],U=H[7];H=H[8];const V=Math.sin(J);J=Math.cos(J);I[0]=J*N+V*T;I[1]=J*R+V*P;I[2]=J*W+V*Q;I[3]=J*T-V*N;I[4]=J*P-V*R;I[5]=J*Q-V*W;I[6]=S;I[7]=U;I[8]=H;return I}function z(I,H,J){const N=J[0],R=J[1];J=J[2];I[0]=N*H[0];I[1]=N*H[1];I[2]=N*H[2];I[3]=R*H[3];I[4]=R*H[4];I[5]=R*H[5];I[6]=J*H[6];I[7]=J*H[7];I[8]=J*H[8];return I}function n(I,H,J){const N=J[0];J=J[1];I[0]=
N*H[0];I[1]=N*H[1];I[2]=N*H[2];I[3]=J*H[3];I[4]=J*H[4];I[5]=J*H[5];return I}function l(I,H){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=H[0];I[7]=H[1];I[8]=1;return I}function m(I,H){const J=Math.sin(H);H=Math.cos(H);I[0]=H;I[1]=J;I[2]=0;I[3]=-J;I[4]=H;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function t(I,H){I[0]=H[0];I[1]=0;I[2]=0;I[3]=0;I[4]=H[1];I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function w(I,H){I[0]=H[0];I[1]=H[1];I[2]=0;I[3]=H[2];I[4]=H[3];I[5]=0;I[6]=H[4];I[7]=H[5];I[8]=1;return I}function r(I,
H){var J=H[0],N=H[1],R=H[2];H=H[3];var W=J+J,T=N+N;const P=R+R;J*=W;const Q=N*W;N*=T;const S=R*W,U=R*T;R*=P;W*=H;T*=H;H*=P;I[0]=1-N-R;I[3]=Q-H;I[6]=S+T;I[1]=Q+H;I[4]=1-J-R;I[7]=U-W;I[2]=S-T;I[5]=U+W;I[8]=1-J-N;return I}function x(I,H){const J=H[0],N=H[1],R=H[2],W=H[4],T=H[5],P=H[6],Q=H[8],S=H[9];H=H[10];const U=H*T-P*S,V=-H*W+P*Q,X=S*W-T*Q;var Y=J*U+N*V+R*X;if(!Y)return null;Y=1/Y;I[0]=U*Y;I[1]=(-H*N+R*S)*Y;I[2]=(P*N-R*T)*Y;I[3]=V*Y;I[4]=(H*J-R*Q)*Y;I[5]=(-P*J+R*W)*Y;I[6]=X*Y;I[7]=(-S*J+N*Q)*Y;I[8]=
(T*J-N*W)*Y;return I}function D(I,H){const J=H[0],N=H[1],R=H[2],W=H[3],T=H[4],P=H[5],Q=H[6],S=H[7];var U=H[8],V=H[9],X=H[10],Y=H[11];const Z=H[12],ea=H[13],ja=H[14];H=H[15];const ha=J*P-N*T,ia=J*Q-R*T,oa=J*S-W*T,ma=N*Q-R*P,fa=N*S-W*P,ba=R*S-W*Q,aa=U*ea-V*Z,da=U*ja-X*Z;U=U*H-Y*Z;const ca=V*ja-X*ea;V=V*H-Y*ea;X=X*H-Y*ja;Y=ha*X-ia*V+oa*ca+ma*U-fa*da+ba*aa;if(!Y)return null;Y=1/Y;I[0]=(P*X-Q*V+S*ca)*Y;I[1]=(Q*U-T*X-S*da)*Y;I[2]=(T*V-P*U+S*aa)*Y;I[3]=(R*V-N*X-W*ca)*Y;I[4]=(J*X-R*U+W*da)*Y;I[5]=(N*U-J*
V-W*aa)*Y;I[6]=(ea*ba-ja*fa+H*ma)*Y;I[7]=(ja*oa-Z*ba-H*ia)*Y;I[8]=(Z*fa-ea*oa+H*ha)*Y;return I}function A(I,H,J){I[0]=2/H;I[1]=0;I[2]=0;I[3]=0;I[4]=-2/J;I[5]=0;I[6]=-1;I[7]=1;I[8]=1;return I}function v(I){return"mat3("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+")"}function B(I){return Math.sqrt(I[0]**2+I[1]**2+I[2]**2+I[3]**2+I[4]**2+I[5]**2+I[6]**2+I[7]**2+I[8]**2)}function C(I,H,J){I[0]=H[0]+J[0];I[1]=H[1]+J[1];I[2]=H[2]+J[2];I[3]=H[3]+J[3];I[4]=H[4]+J[4];
I[5]=H[5]+J[5];I[6]=H[6]+J[6];I[7]=H[7]+J[7];I[8]=H[8]+J[8];return I}function E(I,H,J){I[0]=H[0]-J[0];I[1]=H[1]-J[1];I[2]=H[2]-J[2];I[3]=H[3]-J[3];I[4]=H[4]-J[4];I[5]=H[5]-J[5];I[6]=H[6]-J[6];I[7]=H[7]-J[7];I[8]=H[8]-J[8];return I}function F(I,H,J){I[0]=H[0]*J;I[1]=H[1]*J;I[2]=H[2]*J;I[3]=H[3]*J;I[4]=H[4]*J;I[5]=H[5]*J;I[6]=H[6]*J;I[7]=H[7]*J;I[8]=H[8]*J;return I}function M(I,H,J,N){I[0]=H[0]+J[0]*N;I[1]=H[1]+J[1]*N;I[2]=H[2]+J[2]*N;I[3]=H[3]+J[3]*N;I[4]=H[4]+J[4]*N;I[5]=H[5]+J[5]*N;I[6]=H[6]+J[6]*
N;I[7]=H[7]+J[7]*N;I[8]=H[8]+J[8]*N;return I}function K(I,H){return I[0]===H[0]&&I[1]===H[1]&&I[2]===H[2]&&I[3]===H[3]&&I[4]===H[4]&&I[5]===H[5]&&I[6]===H[6]&&I[7]===H[7]&&I[8]===H[8]}function G(I,H){const J=I[0],N=I[1],R=I[2],W=I[3],T=I[4],P=I[5],Q=I[6],S=I[7];I=I[8];const U=H[0],V=H[1],X=H[2],Y=H[3],Z=H[4],ea=H[5],ja=H[6],ha=H[7];H=H[8];const ia=b.getEpsilon();return Math.abs(J-U)<=ia*Math.max(1,Math.abs(J),Math.abs(U))&&Math.abs(N-V)<=ia*Math.max(1,Math.abs(N),Math.abs(V))&&Math.abs(R-X)<=ia*Math.max(1,
Math.abs(R),Math.abs(X))&&Math.abs(W-Y)<=ia*Math.max(1,Math.abs(W),Math.abs(Y))&&Math.abs(T-Z)<=ia*Math.max(1,Math.abs(T),Math.abs(Z))&&Math.abs(P-ea)<=ia*Math.max(1,Math.abs(P),Math.abs(ea))&&Math.abs(Q-ja)<=ia*Math.max(1,Math.abs(Q),Math.abs(ja))&&Math.abs(S-ha)<=ia*Math.max(1,Math.abs(S),Math.abs(ha))&&Math.abs(I-H)<=ia*Math.max(1,Math.abs(I),Math.abs(H))}function L(I){const H=b.getEpsilon(),J=I[0],N=I[1],R=I[2],W=I[3],T=I[4],P=I[5],Q=I[6],S=I[7];I=I[8];return Math.abs(1-(J*J+W*W+Q*Q))<=H&&Math.abs(1-
(N*N+T*T+S*S))<=H&&Math.abs(1-(R*R+P*P+I*I))<=H}const O=Object.freeze(Object.defineProperty({__proto__:null,add:C,adjoint:d,copy:y,determinant:f,equals:G,exactEquals:K,frob:B,fromMat2d:w,fromMat4:c,fromQuat:r,fromRotation:m,fromScaling:t,fromTranslation:l,identity:u,invert:k,isOrthoNormal:L,mul:g,multiply:g,multiplyScalar:F,multiplyScalarAndAdd:M,normalFromMat4:D,normalFromMat4Legacy:x,projection:A,rotate:h,scale:z,scaleByVec2:n,set:p,str:v,sub:E,subtract:E,translate:e,transpose:q},Symbol.toStringTag,
{value:"Module"}));a.add=C;a.adjoint=d;a.copy=y;a.determinant=f;a.equals=G;a.exactEquals=K;a.frob=B;a.fromMat2d=w;a.fromMat4=c;a.fromQuat=r;a.fromRotation=m;a.fromScaling=t;a.fromTranslation=l;a.identity=u;a.invert=k;a.isOrthoNormal=L;a.mat3=O;a.mul=g;a.multiply=g;a.multiplyScalar=F;a.multiplyScalarAndAdd=M;a.normalFromMat4=D;a.normalFromMat4Legacy=x;a.projection=A;a.rotate=h;a.scale=z;a.scaleByVec2=n;a.set=p;a.str=v;a.sub=E;a.subtract=E;a.translate=e;a.transpose=q})},"esri/chunks/vec3f32":function(){define(["exports"],
function(a){function b(){return new Float32Array(3)}function c(m){const t=new Float32Array(3);t[0]=m[0];t[1]=m[1];t[2]=m[2];return t}function y(m,t,w){const r=new Float32Array(3);r[0]=m;r[1]=t;r[2]=w;return r}function p(m,t){return new Float32Array(m,t,3)}function u(){return b()}function q(){return y(1,1,1)}function k(){return y(1,0,0)}function d(){return y(0,1,0)}function f(){return y(0,0,1)}const g=b(),e=q(),h=k(),z=d(),n=f(),l=Object.freeze(Object.defineProperty({__proto__:null,ONES:e,UNIT_X:h,
UNIT_Y:z,UNIT_Z:n,ZEROS:g,clone:c,create:b,createView:p,fromValues:y,ones:q,unitX:k,unitY:d,unitZ:f,zeros:u},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=h;a.UNIT_Y=z;a.UNIT_Z=n;a.ZEROS=g;a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.ones=q;a.unitX=k;a.unitY=d;a.unitZ=f;a.vec3f32=l;a.zeros=u})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(D){const A=new n.ShaderBuilder;A.include(f.ScreenSpacePass,!1);const v=A.fragment;v.uniforms.add(new e.FloatPassUniform("cloudRadius",B=>B.cloudRadius),new e.FloatPassUniform("power",B=>c.lerp(35,120,B.absorption)),new e.FloatPassUniform("sigmaE",B=>1+B.absorption),new e.FloatPassUniform("density",B=>c.lerp(0,.3,B.density)),new e.FloatPassUniform("cloudSize",B=>c.lerp(0,.02,Math.max(.01,1-B.cloudSize))),new e.FloatPassUniform("detailSize",B=>c.lerp(0,
.2,Math.max(.01,1-B.detailSize))),new e.FloatPassUniform("smoothness",B=>c.lerp(0,.5,1-B.smoothness)),new e.FloatPassUniform("cloudHeight",B=>c.lerp(0,1500,B.cloudHeight)),new e.FloatPassUniform("coverage",B=>B.coverage),new z.Matrix3DrawUniform("view",B=>B.viewMatrix),new l.Texture2DPassUniform("cloudShapeTexture",B=>null!=B.noiseTexture?B.noiseTexture.textureAtlas:null),new g.Float2PassUniform("cloudVariables",B=>p.set(r,B.coverage,B.absorption)));v.constants.add("halfCubeMapSize","float",.5*D.cubeMapSize);
v.code.add(h.glsl`
    const int STEPS = ${D.steps===k.RayMarchingSteps.SIXTEEN?h.glsl`16`:D.steps===k.RayMarchingSteps.HUNDRED?h.glsl`100`:h.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);v.code.add(h.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${h.glsl.float(d.ATLAS_SIZE)};
      const float dataWidth = ${h.glsl.float(d.ATLAS_SIZE)};
      const float tileRows = ${h.glsl.float(d.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${h.glsl.float(d.TILE_SIZE)}, ${h.glsl.float(d.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${h.glsl.float(d.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${h.glsl.float(d.WEATHER_MAP_SCALE)} * p) / ${h.glsl.float(d.ATLAS_SIZE)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);v.code.add(h.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);v.code.add(h.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);v.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
v.code.add(h.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);v.code.add(h.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);v.code.add(h.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return A}let t=function(D){function A(){var v=D.apply(this,arguments)||this;v.cloudRadius=0;v.cloudSize=0;v.detailSize=0;v.absorption=0;v.density=0;v.smoothness=0;v.cloudHeight=0;v.coverage=0;v.raymarchingSteps=q.cloudPresets.default.raymarchingSteps;v.weatherTile=u.create();return v}b._inherits(A,D);return b._createClass(A)}(h.NoParameters),w=function(D){function A(){var v=D.apply(this,arguments)||this;v.viewMatrix=y.create();return v}b._inherits(A,D);return b._createClass(A)}(h.NoParameters);
const r=u.create(),x=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:w,CloudsPassParameters:t,build:m},Symbol.toStringTag,{value:"Module"}));a.Clouds=x;a.CloudsDrawParameters=w;a.CloudsPassParameters=t;a.build=m})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./CloudsTechniqueConfiguration"],function(a,b,c){b=b._createClass(function(p,u,q,k,d,f,g,e,h=.5){this.coverage=p;this.density=u;this.absorption=q;
this.cloudSize=k;this.detailSize=d;this.smoothness=f;this.cloudHeight=g;this.raymarchingSteps=e;this.median=h});const y=new b([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],c.RayMarchingSteps.SIXTEEN);c={sunny:y,cloudy:new b([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],c.RayMarchingSteps.TWOHUNDRED,.6),rainy:new b([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],c.RayMarchingSteps.TWOHUNDRED,.4),snowy:new b([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],c.RayMarchingSteps.HUNDRED,
.65),foggy:new b([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],c.RayMarchingSteps.SIXTEEN),default:y};a.CloudPresets=b;a.cloudPresets=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ./CloudsData ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),function(a,b,c,y,p,u){a.RayMarchingSteps=
void 0;(function(k){k[k.SIXTEEN=0]="SIXTEEN";k[k.HUNDRED=1]="HUNDRED";k[k.TWOHUNDRED=2]="TWOHUNDRED";k[k.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let q=function(k){function d(){var f=k.apply(this,arguments)||this;f.steps=a.RayMarchingSteps.SIXTEEN;f.writeTextureChannels=p.CloudsTextureChannels.RG;return f}b._inherits(d,k);return b._createClass(d)}(u.ShaderTechniqueConfiguration);c.__decorate([u.parameter({count:a.RayMarchingSteps.COUNT})],q.prototype,"steps",void 0);c.__decorate([u.parameter({constValue:y("esri-mobile")?
1024:2048})],q.prototype,"cubeMapSize",void 0);c.__decorate([u.parameter()],q.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(b)),y=(b+2)*c;a.ATLAS_SIZE=y;a.TEXTURE_SCALE=b/128;a.TILE_ROWS=c;a.TILE_SIZE=b;a.WEATHER_MAP_SCALE=y/1560;a.WEATHER_MAP_SIZE=
1E5;a.WEATHER_TILE_SIZE=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(y,p=!0){y.attributes.add(c.VertexAttribute.POSITION,"vec2");p&&y.varyings.add("uv","vec2");y.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${p?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"mat3",y.BindType.Draw,(d,f,g)=>d.setUniformMatrix3fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Matrix3DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){q=function(e){function h(n,l){var m;return m=
e.call(this,n,l,()=>m.destroy())||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new d.Program(n.rctx,h.shader.get().build(this.configuration),k.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:g.simpleBlendingParams(f.BlendFactor.CONSTANT_COLOR,f.BlendFactor.ONE_MINUS_CONSTANT_COLOR,f.BlendOperation.ADD,this.configuration.writeTextureChannels===p.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:f.CompareFunction.LEQUAL},
colorWrite:g.defaultColorWriteParams})};return c._createClass(h)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(y.Clouds,()=>new Promise((e,h)=>a(["./Clouds.glsl"],e,h)));b.CloudsTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){a.NoiseTextureAtlas=function(w){function r(D){var A=w.call(this,D)||this;A._needsRender=!0;A._passParameters=new e.NoiseTextureAtlasPassParameters;A._frameBuffer=new m.FramebufferObject(D.context.renderContext.rctx,new t.TextureDescriptor(z.ATLAS_SIZE));A._vao=l.createQuadVAO(D.context.renderContext.rctx);return A}b._inherits(r,w);var x=r.prototype;x._setDirty=function(){this._needsRender=!0};x.updateWeatherMap=function(D){if(this._passParameters.weatherTile[0]!==
D[0]||this._passParameters.weatherTile[1]!==D[1])g.copy(this._passParameters.weatherTile,D),this._setDirty()};x.destroy=function(){this._fullTechniqueCached=p.releaseMaybe(this._fullTechniqueCached);this._weatherMapTechniqueCached=p.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=p.disposeMaybe(this._frameBuffer);this._vao=p.disposeMaybe(this._vao)};x._render=function(D){if(null==this._vao||null==this._frameBuffer)return null;var A=D===h.NoiseTextureRenderMode.Full?this._fullTechnique:
this._weatherMapTechnique;D=this.context.renderContext.rctx;const v=D.getViewport();D.setViewport(0,0,z.ATLAS_SIZE,z.ATLAS_SIZE);D.bindFramebuffer(this._frameBuffer);A=D.bindTechnique(A,this._passParameters,null);D.bindVAO(this._vao);A.assertCompatibleVertexAttributeLocations(this._vao);D.gl.drawArrays(D.gl.TRIANGLE_STRIP,0,4);D.setViewport(v.x,v.y,v.width,v.height);this._needsRender=!1;return this._frameBuffer.colorTexture};b._createClass(r,[{key:"_techniqueRepository",get:function(){return this.context.techniqueRepository}},
{key:"textureAtlas",get:function(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(h.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(h.NoiseTextureRenderMode.Full));return this._texture}},{key:"_fullTechnique",get:function(){if(null==this._fullTechniqueCached){const D=new h.NoiseTextureAtlasTechniqueConfiguration;D.mode=h.NoiseTextureRenderMode.Full;
this._fullTechniqueCached=this._techniqueRepository.acquire(n.NoiseTextureAtlasTechnique,D)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(null==this._weatherMapTechniqueCached){const D=new h.NoiseTextureAtlasTechniqueConfiguration;D.mode=h.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(n.NoiseTextureAtlasTechnique,D)}return this._weatherMapTechniqueCached}}]);return r}(y);c.__decorate([u.property({constructOnly:!0})],
a.NoiseTextureAtlas.prototype,"context",void 0);c.__decorate([u.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=c.__decorate([f.subclass("esri.views.3d.environment.NoiseTextureAtlas")],a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(h){const z=new d.ShaderBuilder;z.include(u.ScreenSpacePass,!1);z.fragment.code.add(k.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);h.mode===y.NoiseTextureRenderMode.Full&&z.fragment.code.add(k.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${k.glsl.float(p.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${k.glsl.float(8)});

      float worley0 = worley(p, ${k.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${k.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${k.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${k.glsl.float(2)});
      float worley1 = worley(p, ${k.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${k.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${k.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);z.fragment.uniforms.add(new q.Float2PassUniform("weatherTile",n=>n.weatherTile));z.fragment.code.add(k.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${k.glsl.float(p.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${k.glsl.float(p.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${k.glsl.float(p.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);z.fragment.code.add(k.glsl`void main() {`);h.mode===y.NoiseTextureRenderMode.Full&&z.fragment.code.add(k.glsl`
        float padWidth = 1.0;
        float paddedSize = ${k.glsl.float(p.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${k.glsl.float(p.TILE_ROWS)} * ${k.glsl.float(p.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${k.glsl.float(p.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${k.glsl.float(p.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${k.glsl.float(p.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${k.glsl.float(p.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${k.glsl.float(p.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${k.glsl.float(p.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${k.glsl.float(p.TILE_ROWS)} * ${k.glsl.float(p.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${k.glsl.float(p.TILE_ROWS)} * ${k.glsl.float(p.TILE_ROWS)});
        p = p_;
        p.z /= (${k.glsl.float(p.TILE_ROWS)} * ${k.glsl.float(p.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);z.fragment.code.add(k.glsl`
      vec2 mapUV = ${k.glsl.float(p.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${k.glsl.float(p.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${h.mode===y.NoiseTextureRenderMode.Full?k.glsl`fragColor.ba = vec2(0.0, map);`:k.glsl`fragColor = vec4(map);`};
    }
  `);return z}let g=function(h){function z(){var n=h.apply(this,arguments)||this;n.weatherTile=c.fromValues(0,0);return n}b._inherits(z,h);return b._createClass(z)}(k.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:g,build:f},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=e;a.NoiseTextureAtlasPassParameters=g;a.build=f})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){a.NoiseTextureRenderMode=void 0;(function(u){u[u.Full=0]="Full";u[u.WeatherMap=1]="WeatherMap";u[u.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.mode=a.NoiseTextureRenderMode.Full;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter({count:a.NoiseTextureRenderMode.COUNT})],
p.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){q=function(e){function h(){return e.apply(this,arguments)||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new d.Program(n.rctx,h.shader.get().build(this.configuration),k.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:this.configuration.mode===p.NoiseTextureRenderMode.Full?g.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO):g.separateBlendingParams(f.BlendFactor.ZERO,f.BlendFactor.ONE,f.BlendFactor.ONE,
f.BlendFactor.ZERO),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:g.defaultColorWriteParams})};return c._createClass(h)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(y.NoiseTextureAtlas,()=>new Promise((e,h)=>a(["./NoiseTextureAtlas.glsl"],e,h)));b.NoiseTextureAtlasTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(m){return null!=m&&"type"in m&&m.type===f.GLObjectType.Texture}function z(m,t){const w=Math.max(m.width,m.height);return w>t?(l.warn(`Resizing FBO attachment size ${m.width}x${m.height} to device limit ${t}`),t/=w,m.width=Math.round(m.width*t),m.height=Math.round(m.height*t),!1):!0}function n(m){return m.descriptor.target===d.TextureType.TEXTURE_CUBE_MAP?d.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:d.TextureType.TEXTURE_2D}const l=y.getLogger("esri.views.webgl.FramebufferObject");
c=function(){function m(w,r,x=null){this._context=w;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._stencilBuffer=this._depthBuffer=null;this._initialized=!1;w.instanceCounter.increment(d.ResourceType.FramebufferObject,this);w=h(r)?r:new e.Texture(this._context,r);this._colorAttachments.set(d.ColorAttachment.COLOR_ATTACHMENT0,w);this._validateTextureDescriptor(w.descriptor);this._validateColorAttachmentPoint(d.ColorAttachment.COLOR_ATTACHMENT0);null!=x&&(h(x)||null!=
x&&"pixelFormat"in x?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=h(x)?x:new e.Texture(this._context,x),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(x=null!=x&&"type"in x&&x.type===f.GLObjectType.RenderBuffer?x:new g.Renderbuffer(this._context,x),w=x.descriptor,w.internalFormat===d.RenderbufferFormat.STENCIL_INDEX8?this._stencilBuffer=x:this._depthBuffer=
x,this._validateRenderBufferDescriptor(w)))}var t=m.prototype;t.dispose=function(){if(0!==this._colorAttachments.size||this._glName){var w=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((r,x)=>this.detachColorTexture(x)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(w);this._context.instanceCounter.decrement(d.ResourceType.FramebufferObject,
this)}};t.getColorTexture=function(w){return(w=this._colorAttachments.get(w))&&h(w)?w:null};t.attachColorTexture=function(w,r=d.ColorAttachment.COLOR_ATTACHMENT0){w&&(this._validateColorAttachmentPoint(r),this._validateTextureDescriptor(w.descriptor),this.detachColorTexture(r)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,r)),this._colorAttachments.set(r,w))};t.detachColorTexture=function(w=d.ColorAttachment.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(w);
if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w)),this._colorAttachments.delete(w),r};t.setColorTextureTarget=function(w,r=d.ColorAttachment.COLOR_ATTACHMENT0){const x=this._colorAttachments.get(r);x&&this._framebufferTexture2D(x.glName,r,w)};t.attachDepthStencil=function(w){if(w)switch(w.type){case f.GLObjectType.Texture:return this._attachDepthStencilTexture(w);case f.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(w)}};t._attachDepthStencilTexture=
function(w){if(null!=w){var r=w.descriptor;r.pixelFormat!==d.PixelFormat.DEPTH_STENCIL&&r.pixelFormat!==d.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");r.dataType!==d.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
this._validateTextureDescriptor(r);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,d.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=w}};t.detachDepthStencilTexture=function(){const w=this._depthStencilTexture;w&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,d.DepthStencilAttachment));this._depthStencilTexture=null;return w};t._attachDepthStencilBuffer=
function(w){if(null!=w){var r=w.descriptor;r.internalFormat!==d.RenderbufferFormat.DEPTH_STENCIL&&r.internalFormat!==d.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");this._validateRenderBufferDescriptor(r);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const x=this._context.gl;r=this._getGLAttachmentPoint(r);x.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,r,x.RENDERBUFFER,w.glName)}this._depthBuffer?.dispose();
this._depthBuffer=w}};t.detachDepthStencilBuffer=function(){const w=this._depthBuffer;if(w&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,x=this._getGLAttachmentPoint(w.descriptor);r.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,x,r.RENDERBUFFER,null);w.dispose()}this._depthBuffer=null;return w};t.copyToTexture=function(w,r,x,D,A,v,B){(0>w||0>r||0>A||0>v)&&console.error("Offsets cannot be negative!");(0>=x||0>=D)&&console.error("Copy width and height must be greater than zero!");
var C=B.descriptor;B.descriptor.target!==d.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==C?.width||null==C?.height||w+x>this.width||r+D>this.height||A+x>C.width||v+D>C.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");C=this._context;B=C.bindTexture(B,e.Texture.TEXTURE_UNIT_FOR_UPDATES);C.setActiveTexture(e.Texture.TEXTURE_UNIT_FOR_UPDATES);C.bindFramebuffer(this);C.gl.copyTexSubImage2D(d.TextureType.TEXTURE_2D,
0,A,v,w,r,x,D);C.bindTexture(B,e.Texture.TEXTURE_UNIT_FOR_UPDATES)};t.readPixels=function(w,r,x,D,A,v,B){(0>=x||0>=D)&&console.error("Copy width and height must be greater than zero!");B||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(w,r,x,D,A,v,B)};t.readPixelsAsync=async function(w,r,x,D,A,v,B){if(this._context.type!==k.ContextType.WEBGL2)q.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),
this.readPixels(w,r,x,D,A,v,B);else{var C=this._context.gl,E=u.BufferObject.createPixelPack(this._context,d.Usage.STREAM_READ,B.byteLength);this._context.bindBuffer(E);this._context.bindFramebuffer(this);C.readPixels(w,r,x,D,A,v,0);this._context.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);await E.getSubDataAsync(B);E.dispose()}};t.resize=function(w,r){if(this.width!==w||this.height!==r){var x={width:w,height:r};z(x,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(D=>D.resize(x.width,
x.height));this._depthStencilTexture?.resize(x.width,x.height);this._initialized&&(z(x,this._context.parameters.maxRenderbufferSize),this._depthBuffer?.resize(x.width,x.height),this._stencilBuffer?.resize(x.width,x.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}};t.initializeAndBind=function(w=d.FramebufferTarget.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)r.bindFramebuffer(w,this.glName);else{this._glName&&r.deleteFramebuffer(this._glName);
var x=r.createFramebuffer();r.bindFramebuffer(w,x);this._colorAttachments.forEach((A,v)=>this._framebufferTexture2D(A.glName,v,n(A),w));var D=this._depthBuffer||this._stencilBuffer;if(D){const A=this._getGLAttachmentPoint(D.descriptor);r.framebufferRenderbuffer(w,A,r.RENDERBUFFER,D.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,n(this._depthStencilTexture),w);q.webglDebugEnabled()&&r.checkFramebufferStatus(w)!==r.FRAMEBUFFER_COMPLETE&&
console.error("Framebuffer is incomplete!");this._glName=x;this._initialized=!0}};t._framebufferTexture2D=function(w,r=d.ColorAttachment.COLOR_ATTACHMENT0,x=d.TextureType.TEXTURE_2D,D=d.FramebufferTarget.FRAMEBUFFER,A=0){this._context.gl.framebufferTexture2D(D,r,x,w,A)};t._disposeDepthStencilAttachments=function(){const w=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);w.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,
r,w.RENDERBUFFER,null)}this._depthBuffer=p.disposeMaybe(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),w.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,w.STENCIL_ATTACHMENT,w.RENDERBUFFER,null)),this._stencilBuffer=p.disposeMaybe(this._stencilBuffer));this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=p.disposeMaybe(this._depthStencilTexture))};
t._validateTextureDescriptor=function(w){w.target!==d.TextureType.TEXTURE_2D&&w.target!==d.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");z(w,this._context.parameters.maxTextureSize);this._validateBufferDimensions(w)};t._validateRenderBufferDescriptor=function(w){z(w,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(w)};t._validateBufferDimensions=function(w){0>=w.width&&(w.width=this.width);0>=w.height&&(w.height=this.height);
0<this.width&&0<this.height&&(this.width!==w.width||this.height!==w.height)&&console.error("Attachment size must match framebuffer size!")};t._getGLAttachmentPoint=function(w){switch(w.internalFormat){case d.RenderbufferFormat.DEPTH_COMPONENT16:case d.RenderbufferFormat.DEPTH_COMPONENT24:case d.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case d.RenderbufferFormat.DEPTH24_STENCIL8:case d.RenderbufferFormat.DEPTH32F_STENCIL8:case d.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;
case d.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}};t._validateColorAttachmentPoint=function(w){if(-1===m._MAX_COLOR_ATTACHMENTS){const r=this._context.capabilities.drawBuffers;m._MAX_COLOR_ATTACHMENTS=r?this._context.gl.getParameter(r.MAX_COLOR_ATTACHMENTS):1}w-=d.ColorAttachment.COLOR_ATTACHMENT0;w+1>m._MAX_COLOR_ATTACHMENTS&&y.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${w+1}. Implementation supports up to ${m._MAX_COLOR_ATTACHMENTS} color attachments`)};
b._createClass(m,[{key:"glName",get:function(){return this._glName}},{key:"colorTexture",get:function(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}},{key:"height",
get:function(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??0}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((w,[,r])=>w+r.gpuMemoryUsage,this.depthStencilAttachment?.gpuMemoryUsage??0)}}]);return m}();c._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=c;a.ensureAttachmentMaxSize=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./contextUtils ./enums ./GLObjectType ./RenderbufferDescriptor".split(" "),
function(a,b,c,y,p,u,q){let k=function(){function d(g,e){this._context=g;this._descriptor=e;this.type=u.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(p.ResourceType.Renderbuffer,this);g=this._context.gl;this.glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:h,height:z,internalFormat:n,multisampled:l}=e;if(l){if(this._context.type!==y.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");g.renderbufferStorageMultisample(g.RENDERBUFFER,
this.samples,n,h,z)}else g.renderbufferStorage(g.RENDERBUFFER,n,h,z)}var f=d.prototype;f.resize=function(g,e){const h=this._descriptor;if(h.width!==g||h.height!==e)h.width=g,h.height=e,g=this._context.gl,this._context.bindRenderbuffer(this),h.multisampled?g.renderbufferStorageMultisample(g.RENDERBUFFER,this.samples,h.internalFormat,h.width,h.height):g.renderbufferStorage(g.RENDERBUFFER,h.internalFormat,h.width,h.height)};f.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),
this._context.instanceCounter.decrement(p.ResourceType.Renderbuffer,this),this._context=c.nullifyNonNullableForDispose(this._context))};b._createClass(d,[{key:"descriptor",get:function(){return this._descriptor}},{key:"samples",get:function(){const g=this._descriptor.samples,e=this._context.parameters.maxSamples;return g?Math.min(g,e):e}},{key:"gpuMemoryUsage",get:function(){return q.estimateMemory(this._descriptor)}}]);return d}();a.Renderbuffer=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Util"],function(a,b,c){b=b._createClass(function(y,p,u=p){this.internalFormat=y;this.width=p;this.height=u;this.multisampled=!1;this.samples=1});a.RenderbufferDescriptor=b;a.estimateMemory=function(y){return 0>=y.width||0>=y.height||null==y.internalFormat?0:y.width*y.height*c.getBytesPerElementFormat(y.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=function(){function h(z,n,l){this.shadowMap=z;this.ssaoHelper=n;this.slicePlane=l;this.slot=d.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=f.TransparencyPassType.NONE;this.alignPixelEnabled=!1;this._camera=new k.Camera;this._inverseViewport=c.create();this.oldLighting=new g.SceneLighting;this.newLighting=new g.SceneLighting;this._fadedLighting=new g.SceneLighting;this._lighting=this.newLighting;this.ssr=new q.SSRUniforms;
this.multipassTerrain=new u.MultipassTerrainUniforms;this.multipassGeometry=new p.MultipassGeometryUniforms;this.overlays=[];this.cloudsFade=new y.CloudsFadeParameters}h.prototype.fadeLighting=function(z){const {oldLighting:n,newLighting:l}=this;1<=z?this._lighting=l:(this._fadedLighting.lerpLighting(n,l,z),this._lighting=this._fadedLighting)};b._createClass(h,[{key:"camera",get:function(){return this._camera},set:function(z){this._camera=this.ssr.camera=z;this._inverseViewport[0]=1/z.fullViewport[2];
this._inverseViewport[1]=1/z.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}}]);return h}();a.BindParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u){b=b._createClass(function(){this.enabled=!1});a.MultipassGeometryUniforms=b;a.multipassGeometryTest=function(q){q.include(c.ReadLinearDepth);q.uniforms.add(new u.Texture2DPassUniform("geometryDepthTexture",(k,d)=>d.multipassGeometry.linearDepthTexture),new y.Float2PassUniform("nearFar",(k,d)=>d.camera.nearFar));q.code.add(p.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,y,p,u){b=b._createClass(function(){this.cullAboveGround=this.enabled=!1});a.MultipassTerrainUniforms=b;a.multipassTerrainTest=
function(q,k){k.hasMultipassTerrain&&(q.fragment.include(c.ReadLinearDepth),q.fragment.uniforms.add(new u.Texture2DPassUniform("terrainDepthTexture",(d,f)=>f.multipassTerrain.linearDepthTexture)),q.fragment.uniforms.add(new y.Float2PassUniform("nearFar",(d,f)=>f.camera.nearFar)),q.fragment.uniforms.add(new y.Float2PassUniform("inverseViewport",(d,f)=>f.inverseViewport)),q.fragment.code.add(p.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${k.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,
b,c,y,p,u,q,k,d){b=b._createClass(function(){this.enabled=!1;this.fadeFactor=1;this.reprojectionMatrix=c.create()});a.SSRUniforms=b;a.ScreenSpaceReflections=function(f,g){f=f.fragment;f.include(y.ReadLinearDepth);f.uniforms.add(new p.Float2PassUniform("nearFar",(e,h)=>h.camera.nearFar));f.uniforms.add(new d.Texture2DPassUniform("depthMap",(e,h)=>h.linearDepthTexture));f.uniforms.add(new k.Matrix4PassUniform("proj",(e,h)=>h.ssr.camera.projectionMatrix));f.uniforms.add(new u.FloatPassUniform("invResolutionHeight",
(e,h)=>1/h.ssr.camera.height));f.uniforms.add(new k.Matrix4PassUniform("reprojectionMatrix",(e,h)=>h.ssr.reprojectionMatrix));f.code.add(q.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${g.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B){var C;a.Camera=C=function(L){function O(H={}){H=L.call(this,H)||this;H._center=t.create();H._up=t.create();H._viewUp=t.create();H._viewForward=t.create();H._viewRight=t.create();H._ray=D.create();H._viewport=r.fromValues(0,0,1,1);H._padding=r.fromValues(0,0,0,0);H._fov=55/180*Math.PI;H._nearFar=l.fromValues(1,1E3);H._viewDirty=!0;H._viewMatrix=z.create();H._viewProjectionDirty=!0;H._viewProjectionMatrix=z.create();H._viewInverseTransposeMatrixDirty=
!0;H._viewInverseTransposeMatrix=z.create();H._frustumDirty=!0;H._frustum=x.create();H._fullViewport=r.create();H._pixelRatio=1;H.relativeElevation=0;return H}b._inherits(O,L);var I=O.prototype;I.depthNDCToWorld=function(H){return 2*this.near*this.far/(this.far+this.near-(2*H-1)*(this.far-this.near))};I.copyFrom=function(H){m.copy(this._ray.origin,H.eye);this.center=H.center;this.up=H.up;w.copy(this._viewport,H.viewport);this.notifyChange("_viewport");w.copy(this._padding,H.padding);this.notifyChange("_padding");
n.copy(this._nearFar,H.nearFar);this.notifyChange("_nearFar");this._fov=H.fov;this.relativeElevation=H.relativeElevation;this._viewDirty=H._viewDirty;this._viewDirty||(h.copy(this._viewMatrix,H.viewMatrix),m.copy(this._viewRight,H.viewRight),m.copy(this._viewUp,H.viewUp),m.copy(this._viewForward,H.viewForward));this._viewProjectionDirty=!0;this._frustumDirty=H._frustumDirty;this._frustumDirty||(x.copy(this._frustum,H.frustum),this._frustumDirty=!1);H._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=
!0:(h.copy(this._viewInverseTransposeMatrix,H.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);w.copy(this._fullViewport,H.fullViewport);this.pixelRatio=H.pixelRatio;return this};I.copyViewFrom=function(H){this.eye=H.eye;this.center=H.center;this.up=H.up};I.clone=function(){return(new C).copyFrom(this)};I.equals=function(H){return m.exactEquals(this.eye,H.eye)&&m.exactEquals(this.center,H.center)&&m.exactEquals(this.up,H.up)&&w.exactEquals(this._viewport,H.viewport)&&w.exactEquals(this._padding,
H.padding)&&n.exactEquals(this.nearFar,H.nearFar)&&this._fov===H.fov&&this.pixelRatio===H.pixelRatio&&this.relativeElevation===H.relativeElevation};I.almostEquals=function(H){if(.001<=Math.abs(H.fov-this._fov)||1<=w.squaredDistance(H.screenPadding,this.screenPadding)||1<=w.squaredDistance(this.screenViewport,H.screenViewport))return!1;m.sub(M,H.eye,H.center);m.sub(K,this.eye,this.center);const J=m.dot(M,K),N=m.sqrLen(M),R=m.sqrLen(K);return J*J>=(1-1E-10)*N*R&&m.sqrDist(H.eye,this.eye)<2.5E-7*Math.max(N,
R)};I.computeRenderPixelSizeAt=function(H){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(H))};I.computeRenderPixelSizeAtDist=function(H){return H*this.perScreenPixelRatio};I.computeScreenPixelSizeAt=function(H){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(H))};I._viewDirectionDistance=function(H){return Math.abs(A.projectPointSignedLength(this.viewForward,m.subtract(M,H,this.eye)))};I.computeScreenPixelSizeAtDist=function(H){return H*this.perScreenPixelRatio};
I.computeDistanceFromRadius=function(H,J){return H/Math.tan(Math.min(this.fovX,this.fovY)/(2*(J||1)))};I.getScreenCenter=function(H=q.createScreenPointArray()){H[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;H[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return H};I.getRenderCenter=function(H,J=.5,N=.5){H[0]=this.padding[a.PaddingSide.LEFT]+this.width*J;H[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*N;H[2]=.5;return H};I.setGLViewport=function(H){const J=
this.viewport,N=this.padding;H.setViewport(J[0]-N[3],J[1]-N[2],J[2]+N[1]+N[3],J[3]+N[0]+N[2])};I.applyProjection=function(H,J){H!==E&&m.copy(E,H);E[3]=1;w.transformMat4(E,E,this.projectionMatrix);H=Math.abs(E[3]);m.scale(E,E,1/H);const N=this.fullViewport;J[0]=u.lerp(0,N[0]+N[2],.5+.5*E[0]);J[1]=u.lerp(0,N[1]+N[3],.5+.5*E[1]);J[2]=.5*(E[2]+1);J[3]=H};I.unapplyProjection=function(H,J){const N=this.fullViewport;E[0]=(H[0]/(N[0]+N[2])*2-1)*H[3];E[1]=(H[1]/(N[1]+N[3])*2-1)*H[3];E[2]=(2*H[2]-1)*H[3];E[3]=
H[3];null!=this.inverseProjectionMatrix&&(w.transformMat4(E,E,this.inverseProjectionMatrix),J[0]=E[0],J[1]=E[1],J[2]=E[2])};I.projectToScreen=function(H,J){this.projectToRenderScreen(H,G);this.renderToScreen(G,J);return J};I.projectToRenderScreen=function(H,J){E[0]=H[0];E[1]=H[1];E[2]=H[2];E[3]=1;w.transformMat4(E,E,this.viewProjectionMatrix);if(0===E[3])return null;m.scale(E,E,1/Math.abs(E[3]));H=this.fullViewport;"x"in J?(J.x=u.lerp(0,H[0]+H[2],.5+.5*E[0]),J.y=u.lerp(0,H[1]+H[3],.5+.5*E[1])):(J[0]=
u.lerp(0,H[0]+H[2],.5+.5*E[0]),J[1]=u.lerp(0,H[1]+H[3],.5+.5*E[1]),2<J.length&&(J[2]=.5*(E[2]+1)));return J};I.unprojectFromScreen=function(H,J){return this.unprojectFromRenderScreen(this.screenToRender(H,G),J)};I.unprojectFromRenderScreen=function(H,J){h.multiply(F,this.projectionMatrix,this.viewMatrix);if(!h.invert(F,F))return null;const N=this.fullViewport;E[0]=2*(H[0]-N[0])/N[2]-1;E[1]=2*(H[1]-N[1])/N[3]-1;E[2]=2*H[2]-1;E[3]=1;w.transformMat4(E,E,F);if(0===E[3])return null;J[0]=E[0]/E[3];J[1]=
E[1]/E[3];J[2]=E[2]/E[3];return J};I.constrainWindowSize=function(H,J,N,R){H*=this.pixelRatio;J*=this.pixelRatio;return[Math.max(H-N/2,0),Math.max(this.fullHeight-J-R/2,0),N- -Math.min(H-N/2,0)- -Math.min(this.fullWidth-H-N/2,0),R- -Math.min(this.fullHeight-J-R/2,0)- -Math.min(J-R/2,0)]};I.computeUp=function(H){H===v.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};I.screenToRender=function(H,J){const N=this.fullHeight-H[1]*this.pixelRatio;J[0]=H[0]*this.pixelRatio;J[1]=N;return J};
I.renderToScreen=function(H,J){const N=(this.fullHeight-H[1])/this.pixelRatio;J[0]=H[0]/this.pixelRatio;J[1]=N};I._computeUpGlobal=function(){m.subtract(M,this.center,this.eye);const H=m.length(this.center);1>H?(m.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(m.dot(M,this.center))>.9999*m.length(M)*H||(m.cross(this._up,M,this.center),m.cross(this._up,this._up,M),m.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};I._computeUpLocal=function(){m.direction(M,
this.eye,this.center);.9999>=Math.abs(M[2])&&(m.scale(M,M,M[2]),m.set(this._up,-M[0],-M[1],1-M[2]),m.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};I._compareAndSetView=function(H,J,N=""){"number"===typeof H[0]&&isFinite(H[0])&&"number"===typeof H[1]&&isFinite(H[1])&&"number"===typeof H[2]&&isFinite(H[2])?m.exactEquals(H,J)||(m.copy(J,H),this._markViewDirty(),N.length&&this.notifyChange(N)):p.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")};
I._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};I._recomputeFrustum=function(){this._frustumDirty&&(x.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};I._ensureViewClean=function(){this._viewDirty&&(h.lookAt(this._viewMatrix,this.eye,this.center,this.up),m.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),m.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),
m.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};b._createClass(O,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(H){this._pixelRatio=0<H?H:1}},{key:"eye",get:function(){return this._ray.origin},set:function(H){this._compareAndSetView(H,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(H){this._compareAndSetView(H,this._center,"_center")}},{key:"ray",
get:function(){m.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(H){this._compareAndSetView(H,this._up,"_up")}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(H){h.copy(this._viewMatrix,H);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},
{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(H){this._nearFar[0]!==H&&(this._nearFar[0]=H,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(H){this._nearFar[1]!==H&&(this._nearFar[1]=
H,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(H){this.x=H[0];this.y=H[1];this.width=H[2];this.height=H[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;const H=w.scale(r.create(),this._viewport,1/this.pixelRatio),J=this._get("screenViewport");return J&&w.equals(H,J)?J:H}},{key:"screenPadding",get:function(){if(1===this.pixelRatio)return this._padding;const H=
w.scale(r.create(),this._padding,1/this.pixelRatio),J=this._get("screenPadding");return J&&w.equals(H,J)?J:H}},{key:"x",get:function(){return this._viewport[0]},set:function(H){H+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==H&&(this._viewport[0]=H,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(H){H+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==H&&(this._viewport[1]=H,this._frustumDirty=
this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(H){this._viewport[2]!==H&&(this._viewport[2]=H,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(H){this._viewport[3]!==H&&(this._viewport[3]=H,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+
this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(H){this.width=H-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]},set:function(H){this.height=H-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];
this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"_aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(H){w.exactEquals(this._padding,H)||(this._viewport[0]+=H[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=H[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=
H[a.PaddingSide.RIGHT]+H[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=H[a.PaddingSide.TOP]+H[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),w.copy(this._padding,H),this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(h.multiply(this._viewProjectionMatrix,this.projectionMatrix,
this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){var H=this.width,J=this.height;const N=this.near*Math.tan(this.fovY/2),R=N*this._aspect;H=h.frustum(z.create(),-R*(1+2*this._padding[a.PaddingSide.LEFT]/H),R*(1+2*this._padding[a.PaddingSide.RIGHT]/H),-N*(1+2*this._padding[a.PaddingSide.BOTTOM]/J),N*(1+2*this._padding[a.PaddingSide.TOP]/J),this.near,this.far);return(J=this._get("projectionMatrix"))&&h.equals(J,H)?J:H}},{key:"inverseProjectionMatrix",
get:function(){return h.invert(z.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||z.create()}},{key:"fov",get:function(){return this._fov},set:function(H){this._fov=H;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovX",get:function(){return B.fovd2fovx(this._fov,this.width,this.height)},set:function(H){this._fov=B.fovx2fovd(H,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovY",get:function(){return B.fovd2fovy(this._fov,this.width,
this.height)},set:function(H){this._fov=B.fovy2fovd(H,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"distance",get:function(){return m.distance(this.center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)h.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&0<=this.relativeElevation}}]);return O}(y);c.__decorate([k.property()],a.Camera.prototype,"_center",void 0);c.__decorate([k.property()],a.Camera.prototype,"_up",void 0);
c.__decorate([k.property()],a.Camera.prototype,"_viewport",void 0);c.__decorate([k.property()],a.Camera.prototype,"_padding",void 0);c.__decorate([k.property()],a.Camera.prototype,"_fov",void 0);c.__decorate([k.property()],a.Camera.prototype,"_nearFar",void 0);c.__decorate([k.property()],a.Camera.prototype,"_pixelRatio",void 0);c.__decorate([k.property()],a.Camera.prototype,"pixelRatio",null);c.__decorate([k.property()],a.Camera.prototype,"eye",null);c.__decorate([k.property()],a.Camera.prototype,
"center",null);c.__decorate([k.property()],a.Camera.prototype,"up",null);c.__decorate([k.property({readOnly:!0})],a.Camera.prototype,"nearFar",null);c.__decorate([k.property()],a.Camera.prototype,"near",null);c.__decorate([k.property()],a.Camera.prototype,"far",null);c.__decorate([k.property()],a.Camera.prototype,"viewport",null);c.__decorate([k.property({readOnly:!0})],a.Camera.prototype,"screenViewport",null);c.__decorate([k.property({readOnly:!0})],a.Camera.prototype,"screenPadding",null);c.__decorate([k.property()],
a.Camera.prototype,"x",null);c.__decorate([k.property()],a.Camera.prototype,"y",null);c.__decorate([k.property()],a.Camera.prototype,"width",null);c.__decorate([k.property()],a.Camera.prototype,"height",null);c.__decorate([k.property()],a.Camera.prototype,"fullWidth",null);c.__decorate([k.property()],a.Camera.prototype,"fullHeight",null);c.__decorate([k.property({readOnly:!0})],a.Camera.prototype,"_aspect",null);c.__decorate([k.property()],a.Camera.prototype,"padding",null);c.__decorate([k.property({readOnly:!0})],
a.Camera.prototype,"projectionMatrix",null);c.__decorate([k.property({readOnly:!0})],a.Camera.prototype,"inverseProjectionMatrix",null);c.__decorate([k.property()],a.Camera.prototype,"fov",null);c.__decorate([k.property()],a.Camera.prototype,"fovX",null);c.__decorate([k.property()],a.Camera.prototype,"fovY",null);a.Camera=C=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.Camera")],a.Camera);const E=r.create(),F=z.create(),M=t.create(),K=t.create(),G=q.createRenderScreenPointArray3();a.PaddingSide=
void 0;(function(L){L[L.TOP=0]="TOP";L[L.RIGHT=1]="RIGHT";L[L.BOTTOM=2]="BOTTOM";L[L.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,y,p,u,q,k,d,f){function g(){return[p.create(),p.create(),p.create(),
p.create(),p.create(),p.create(),p.create(),p.create()]}function e(t,w){d.fromPoints(w[a.PointIndex.FAR_BOTTOM_LEFT],w[a.PointIndex.NEAR_BOTTOM_LEFT],w[a.PointIndex.NEAR_TOP_LEFT],t[a.PlaneIndex.LEFT]);d.fromPoints(w[a.PointIndex.NEAR_BOTTOM_RIGHT],w[a.PointIndex.FAR_BOTTOM_RIGHT],w[a.PointIndex.FAR_TOP_RIGHT],t[a.PlaneIndex.RIGHT]);d.fromPoints(w[a.PointIndex.FAR_BOTTOM_LEFT],w[a.PointIndex.FAR_BOTTOM_RIGHT],w[a.PointIndex.NEAR_BOTTOM_RIGHT],t[a.PlaneIndex.BOTTOM]);d.fromPoints(w[a.PointIndex.NEAR_TOP_LEFT],
w[a.PointIndex.NEAR_TOP_RIGHT],w[a.PointIndex.FAR_TOP_RIGHT],t[a.PlaneIndex.TOP]);d.fromPoints(w[a.PointIndex.NEAR_BOTTOM_LEFT],w[a.PointIndex.NEAR_BOTTOM_RIGHT],w[a.PointIndex.NEAR_TOP_RIGHT],t[a.PlaneIndex.NEAR]);d.fromPoints(w[a.PointIndex.FAR_BOTTOM_RIGHT],w[a.PointIndex.FAR_BOTTOM_LEFT],w[a.PointIndex.FAR_TOP_LEFT],t[a.PlaneIndex.FAR])}function h(t,w){for(let r=0;6>r;r++)if(!d.clip(t[r],w))return!1;return!0}a.PlaneIndex=void 0;(function(t){t[t.LEFT=0]="LEFT";t[t.RIGHT=1]="RIGHT";t[t.BOTTOM=2]=
"BOTTOM";t[t.TOP=3]="TOP";t[t.NEAR=4]="NEAR";t[t.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const z={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,
a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,
a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]},n=[q.fromValues(-1,-1,-1,1),q.fromValues(1,-1,-1,1),q.fromValues(1,1,-1,1),q.fromValues(-1,1,-1,1),q.fromValues(-1,-1,1,1),q.fromValues(1,-1,1,1),q.fromValues(1,1,1,1),q.fromValues(-1,1,1,1)],l=new b.ObjectStack(k.create),m=g();a.NumPlanes=6;a.NumPoints=8;a.computePlanes=e;a.copy=function(t,w){for(let r=0;6>r;r++)d.copy(t[r],w[r])};
a.create=function(t){return t?[d.create(t[0]),d.create(t[1]),d.create(t[2]),d.create(t[3]),d.create(t[4]),d.create(t[5])]:[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]};a.createPoints=g;a.fromMatrix=function(t,w,r,x=m){t=c.multiply(f.sm4d.get(),w,t);c.invert(t,t);for(w=0;8>w;++w){const D=u.transformMat4(f.sv4d.get(),n[w],t);y.set(x[w],D[0]/D[3],D[1]/D[3],D[2]/D[3])}e(r,x)};a.intersectClipRay=function(t,w){for(let r=0;6>r;r++)if(!d.clipInfinite(t[r],w))return!1;return!0};a.intersectsLineSegment=
function(t,w,r){return h(t,k.fromLineSegmentAndDirection(w,r,l.get()))};a.intersectsPoint=function(t,w){for(let r=0;6>r;r++)if(0<d.signedDistance(t[r],w))return!1;return!0};a.intersectsRay=function(t,w){return h(t,k.fromRay(w,l.get()))};a.intersectsSphere=function(t,w){for(let r=0;6>r;r++){const x=t[r];if(x[0]*w[0]+x[1]*w[1]+x[2]*w[2]+x[3]>=w[3])return!1}return!0};a.planePointIndices=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports",
"../../core/ObjectStack","../../chunks/vec3","./ray"],function(a,b,c,y){function p(d){return d?{ray:y.create(d.ray),c0:d.c0,c1:d.c1}:{ray:y.create(),c0:0,c1:Number.MAX_VALUE}}function u(d,f,g,e=p()){y.copy(d,e.ray);e.c0=f;e.c1=g;return e}function q(d,f,g){return c.add(g,d.ray.origin,c.scale(g,d.ray.direction,f))}const k=new b.ObjectStack(()=>p());a.copy=function(d,f=p()){return u(d.ray,d.c0,d.c1,f)};a.create=p;a.fromLineSegmentAndDirection=function(d,f,g=p()){const e=c.length(d.vector);y.fromValues(d.origin,
f,g.ray);g.c0=0;g.c1=e;return g};a.fromRay=function(d,f=p()){y.copy(d,f.ray);f.c0=0;f.c1=Number.MAX_VALUE;return f};a.fromValues=u;a.getAt=q;a.getEnd=function(d,f){return q(d,d.c1,f)};a.getStart=function(d,f){return q(d,d.c0,f)};a.wrap=function(d,f,g){const e=k.get();e.ray=d;e.c0=f;e.c1=g;return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],function(a){a.fovd2fovx=function(b,c,y){return 2*Math.atan(c*Math.tan(.5*
b)/Math.sqrt(c*c+y*y))};a.fovd2fovy=function(b,c,y){return 2*Math.atan(y*Math.tan(.5*b)/Math.sqrt(c*c+y*y))};a.fovx2fovd=function(b,c,y){return 2*Math.atan(Math.sqrt(c*c+y*y)*Math.tan(.5*b)/c)};a.fovy2fovd=function(b,c,y){return 2*Math.atan(Math.sqrt(c*c+y*y)*Math.tan(.5*b)/y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=
0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=
10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=12]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=14]="HUD_MATERIAL";b[b.LABEL_MATERIAL=15]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=16]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";b[b.DRAPED_WATER=19]="DRAPED_WATER";b[b.VOXEL=20]="VOXEL";b[b.MAX_SLOTS=
21]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=void 0;var b=a.TransparencyPassType||(a.TransparencyPassType={});b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),
function(a,b,c,y,p,u,q){let k=b._createClass(function(){this.color=p.create();this.intensity=1}),d=b._createClass(function(){this.direction=p.create();this.ambient=new k;this.diffuse=new k}),f=function(){function e(){this._shOrder=2;this._legacy=new d;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new u.SphericalHarmonicsAmbientLight;this._mainLight=new u.MainLight(p.create(),p.fromValues(1,0,0),!1)}var h=e.prototype;h.set=function(z){q.combineLights(z,this._shOrder,this._mainLight,
this._sphericalHarmonics);y.copy(this._legacy.direction,this._mainLight.direction);z=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*z;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*z;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*z;y.scale(this._legacy.diffuse.color,this._mainLight.intensity,z);y.copy(g,this._legacy.diffuse.color);y.scale(g,g,.4*this.globalFactor);y.add(this._legacy.ambient.color,this._legacy.ambient.color,g)};
h.copyFrom=function(z){this._sphericalHarmonics.r=Array.from(z.sh.r);this._sphericalHarmonics.g=Array.from(z.sh.g);this._sphericalHarmonics.b=Array.from(z.sh.b);y.copy(this._mainLight.direction,z.mainLight.direction);y.copy(this._mainLight.intensity,z.mainLight.intensity);this._mainLight.castShadows=z.mainLight.castShadows;this._mainLight.specularStrength=z.mainLight.specularStrength;this._mainLight.environmentStrength=z.mainLight.environmentStrength;this.globalFactor=z.globalFactor;this.noonFactor=
z.noonFactor};h.lerpLighting=function(z,n,l){y.lerp(this._mainLight.intensity,z.mainLight.intensity,n.mainLight.intensity,l);this._mainLight.environmentStrength=c.lerp(z.mainLight.environmentStrength,n.mainLight.environmentStrength,l);this._mainLight.specularStrength=c.lerp(z.mainLight.specularStrength,n.mainLight.specularStrength,l);y.copy(this._mainLight.direction,n.mainLight.direction);this._mainLight.castShadows=n.mainLight.castShadows;this.globalFactor=c.lerp(z.globalFactor,n.globalFactor,l);
this.noonFactor=c.lerp(z.noonFactor,n.noonFactor,l);if(z.sh.r.length===n.sh.r.length)for(let m=0;m<n.sh.r.length;m++)this._sphericalHarmonics.r[m]=c.lerp(z.sh.r[m],n.sh.r[m],l),this._sphericalHarmonics.g[m]=c.lerp(z.sh.g[m],n.sh.g[m],l),this._sphericalHarmonics.b[m]=c.lerp(z.sh.b[m],n.sh.b[m],l);else for(z=0;z<n.sh.r.length;z++)this._sphericalHarmonics.r[z]=n.sh.r[z],this._sphericalHarmonics.g[z]=n.sh.g[z],this._sphericalHarmonics.b[z]=n.sh.b[z]};b._createClass(e,[{key:"legacy",get:function(){return this._legacy}},
{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",get:function(){return this._mainLight}}]);return e}();const g=p.create();a.SceneLighting=f;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64"],function(a,b,c){let y=b._createClass(function(q=c.create()){this.intensity=q}),p=b._createClass(function(q=
c.create(),k=c.fromValues(.57735,.57735,.57735)){this.intensity=q;this.direction=k}),u=b._createClass(function(q=c.create(),k=c.fromValues(.57735,.57735,.57735),d=!0,f=1,g=1){this.intensity=q;this.direction=k;this.castShadows=d;this.specularStrength=f;this.environmentStrength=g});b=b._createClass(function(){this.r=[0];this.g=[0];this.b=[0]});a.AmbientLight=y;a.FillLight=p;a.MainLight=u;a.SphericalHarmonicsAmbientLight=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,c,y,p,u){function q(r){return(r+1)*(r+1)}function k(r){return b.clamp(Math.floor(Math.sqrt(r)-1),0,2)}function d(r,x,D){const A=r[0],v=r[1];r=r[2];D=D||[];D.length=q(x);0<=x&&(D[0]=.28209479177);1<=x&&(D[1]=.4886025119*A,D[2]=.4886025119*r,D[3]=.4886025119*v);2<=x&&(D[4]=1.09254843059*A*v,D[5]=1.09254843059*v*r,D[6]=.31539156525*(3*r*r-1),D[7]=1.09254843059*A*r,D[8]=.54627421529*(A*A-v*v));return D}function f(r,x){r=q(r);x=x||{r:[],g:[],b:[]};x.r.length=x.g.length=x.b.length=r;for(let D=
0;D<r;D++)x.r[D]=x.g[D]=x.b[D]=0;return x}function g(r,x){const D=k(x.r.length);for(const A of r)c.negate(t,A.direction),d(t,D,l),p.elementwiseProduct(l,w),p.scalarProduct(l,A.intensity[0],m),p.add(x.r,m),p.scalarProduct(l,A.intensity[1],m),p.add(x.g,m),p.scalarProduct(l,A.intensity[2],m),p.add(x.b,m);return x}function e(r,x){d(t,0,l);for(const D of r)x.r[0]+=l[0]*w[0]*D.intensity[0]*4*Math.PI,x.g[0]+=l[0]*w[0]*D.intensity[1]*4*Math.PI,x.b[0]+=l[0]*w[0]*D.intensity[2]*4*Math.PI;return x}const h=[],
z=[],n=[],l=[0],m=[0],t=y.create(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(r,x,D,A){f(x,A);c.set(D.intensity,0,0,0);x=!1;h.length=0;z.length=0;n.length=0;for(const v of r)v instanceof u.MainLight&&!x?(c.copy(D.direction,v.direction),c.copy(D.intensity,v.intensity),D.specularStrength=v.specularStrength,D.environmentStrength=v.environmentStrength,D.castShadows=v.castShadows,x=!0):v instanceof u.MainLight||v instanceof u.FillLight?h.push(v):
v instanceof u.AmbientLight?z.push(v):v instanceof u.SphericalHarmonicsAmbientLight&&n.push(v);g(h,A);e(z,A);for(const v of n)p.add(A.r,v.r),p.add(A.g,v.g),p.add(A.b,v.b)};a.computeCoefficients=d;a.initSHCoefficients=f;a.numberOfCoefficients=q;a.orderFromNumberOfCoefficients=k;a.projectAmbientLights=e;a.projectFillLights=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,y){y=
y||b;y.length=b.length;for(let p=0;p<b.length;p++)y[p]=b[p]+c[p];return y};a.dotProduct=function(b,c){let y=0;for(let p=0;p<b.length;p++)y+=b[p]*c[p];return y};a.elementwiseProduct=function(b,c,y){y=y||b;y.length=b.length;for(let p=0;p<b.length;p++)y[p]=b[p]*c[p];return y};a.scalarProduct=function(b,c,y){y=y||b;y.length=b.length;for(let p=0;p<b.length;p++)y[p]=b[p]*c;return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){a.Fog=function(A){function v(C){var E=A.call(this,C)||this;E._passParameters=new n.FogPassParameters;E._vao=w.createQuadVAO(C.context.renderContext.rctx,t.Pos2Tex);E._technique=new l.FogTechnique(C);C=h.getReferenceEllipsoid(C.view.spatialReference);E._planetRadius=C.radius;E._atmosphereRadius=C.radius+z.atmosphereHeight;return E}b._inherits(v,A);var B=v.prototype;B.destroy=function(){this._technique.release();this._vao.dispose()};B.render=function(C,
E){this._update(C,E);if(!(0>=this._passParameters.fogAmount)){var F=this._technique;if(F.compiled){var M=C.offscreenRenderingHelper;M.renderDepthDetached(()=>{this._passParameters.depthTexture=M.depthTexture;const K=C.rctx.bindTechnique(F,this._passParameters,C.bindParameters);this._renderFog(K,C)})}else this.context.requestRender()}};B._renderFog=function(C,E){E=E.rctx;E.bindVAO(this._vao);C.assertCompatibleVertexAttributeLocations(this._vao);E.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4)};B._update=
function(C,E){var F=C.bindParameters.camera;g.normalize(x,F.eye);C=Math.max(0,g.dot(x,C.bindParameters.lighting.mainLight.direction));const M=E.color;g.scale(D,M,.1);g.lerp(this._passParameters.fogColor,D,M,C);F=g.length(F.eye);this._passParameters.atmosphereC=F*F-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-p.smoothstep(.95*m.weatherHeightLimit,1*m.weatherHeightLimit,Math.abs(F-this._planetRadius)))*E.amount;this._passParameters.fogStrength=E.strength};v.isSupported=
function(C){return C.capabilities.depthTexture};b._createClass(v,[{key:"strength",get:function(){return this._passParameters.fogStrength},set:function(C){this._passParameters.fogStrength=C}}]);return v}(y);c.__decorate([u.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([u.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);c.__decorate([u.property({constructOnly:!0})],a.Fog.prototype,"rctx",void 0);c.__decorate([u.property({constructOnly:!0})],a.Fog.prototype,
"viewingMode",void 0);a.Fog=c.__decorate([f.subclass("esri.views.3d.environment.Fog")],a.Fog);c=b._createClass(function(){this.color=e.create();this.amount=this.strength=0});const x=e.create(),D=e.create();a.FogParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(){const r=new z.ShaderBuilder;r.attributes.add(l.VertexAttribute.POSITION,"vec2");r.include(u.TextureCoordinateAttribute,{textureCoordinateType:u.TextureCoordinateAttributeType.Default});r.varyings.add("worldRay","vec3");r.varyings.add("eyeDir","vec3");const {vertex:x,fragment:D}=r;x.uniforms.add(new h.Matrix4PassUniform("inverseProjectionMatrix",(A,v)=>v.camera.inverseProjectionMatrix),new h.Matrix4PassUniform("inverseViewMatrix",(A,v)=>c.invertOrIdentity(w,
v.camera.viewMatrix)));x.code.add(e.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);D.uniforms.add(new g.FloatPassUniform("atmosphereC",A=>A.atmosphereC),new f.Float3PassUniform("cameraPosition",(A,v)=>v.camera.eye),new d.Float2PassUniform("nearFar",(A,v)=>v.camera.nearFar),new n.Texture2DPassUniform("depthTexture",A=>A.depthTexture),new g.FloatPassUniform("fogStrength",A=>A.fogStrength),new g.FloatPassUniform("fogAmount",A=>A.fogAmount),new f.Float3PassUniform("fogColor",A=>A.fogColor));r.include(k.Gamma);D.include(q.ReadLinearDepth);D.code.add(e.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);D.code.add(e.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);D.code.add(e.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`);return r}let t=function(r){function x(){var D=r.apply(this,arguments)||this;D.fogColor=p.create();D.fogStrength=4E-6;D.atmosphereC=1;D.fogAmount=0;return D}b._inherits(x,r);return b._createClass(x)}(e.NoParameters);const w=y.create();y=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:t,build:m},Symbol.toStringTag,{value:"Module"}));a.Fog=y;a.FogPassParameters=t;a.build=m})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){u=function(e){function h(n){var l;return l=e.call(this,n,new q.ShaderTechniqueConfiguration,()=>l.destroy())||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new d.Program(n.rctx,h.shader.get().build(),k.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE),colorWrite:g.defaultColorWriteParams})};
return c._createClass(h)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(y.Fog,()=>new Promise((e,h)=>a(["./Fog.glsl"],e,h)));b.FogTechnique=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){let D=function(){function B(E,F){this.type=u.AtmosphereType.Local;this._configuration=new d.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new q.SimpleAtmospherePassParameters;this._configuration.geometry=d.SimpleAtmosphereGeometry.Cylinder;this._technique=F.techniqueRepository.acquire(k.SimpleAtmosphereTechnique,this._configuration);E=F.renderContext.rctx;this._vao=this._createVertexArrayObject(E);this._vaoCount=x.vertexCount(this._vao,
"geometry");F=new r.TextureDescriptor;F.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;F.flipped=!0;F.width=1;F.height=512;this._passParameters.texture=new w.Texture(E,F,f.earthAtmosphereTextureSimple)}var C=B.prototype;C.destroy=function(){this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()};C.render=function(E){const F=E.rctx,M=F.bindTechnique(this._technique,this._passParameters,E.bindParameters);var K=A;y.copy(K,E.bindParameters.camera.viewMatrix);
K[12]=0;K[13]=0;K[14]=0;K[15]=1;M.setUniformMatrix4fv("view",A);F.bindVAO(this._vao);M.assertCompatibleVertexAttributeLocations(this._vao);F.drawArrays(t.PrimitiveType.TRIANGLES,0,this._vaoCount)};C.renderHaze=function(){return!1};C._createVertexArrayObject=function(E){var F=z.createPolySphereData(1,2,!1);const M=F.indices[0][1];F=F.vertexAttributes[0][1];for(var K=0;K<M.length;K+=3){var G=M[K];M[K]=M[K+2];M[K+2]=G}F=F.data;K=v.createBuffer(M.length);G=K.position;for(let L=0;L<M.length;++L){const O=
3*M[L];G.set(L,0,F[O]);G.set(L,1,F[O+1]);G.set(L,2,F[O+2])}return new n.VertexArrayObject(E,h.Default3D,{geometry:g.glLayout(v)},{geometry:m.BufferObject.createVertex(E,t.Usage.STATIC_DRAW,K.buffer)})};return b._createClass(B)}();const A=p.create(),v=e.newLayout().vec3f(l.VertexAttribute.POSITION);a.LocalAtmosphere=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(r){const x=new h.ShaderBuilder,{vertex:D,fragment:A}=x;q.addMainLightDirection(D);r.geometry===p.SimpleAtmosphereGeometry.Underground?(x.attributes.add(n.VertexAttribute.POSITION,"vec2"),x.varyings.add("color","vec4"),D.uniforms.add(new d.Float3PassUniform("cameraPosition",(v,B)=>B.camera.eye),new f.FloatPassUniform("undergroundFadeAlpha",v=>v.undergroundFadeAlpha)),D.code.add(g.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),A.code.add(g.glsl`void main() {
fragColor = color;
}`)):(x.include(u.Transform,r),x.attributes.add(n.VertexAttribute.POSITION,"vec3"),x.varyings.add("vtc","vec2"),x.varyings.add("falloff","float"),r=r.geometry===p.SimpleAtmosphereGeometry.Cylinder,D.uniforms.add(new e.Matrix4PassUniform("proj",(v,B)=>B.camera.projectionMatrix),new e.Matrix4PassUniform("view",(v,B)=>B.camera.viewMatrix)),r||(x.varyings.add("innerFactor","float"),D.uniforms.add(new d.Float3PassUniform("silCircleCenter",v=>v.silhouette.center)),D.uniforms.add(new d.Float3PassUniform("silCircleV1",
v=>v.silhouette.v1)),D.uniforms.add(new d.Float3PassUniform("silCircleV2",v=>v.silhouette.v2)),D.uniforms.add(new k.Float2PassUniform("texV",v=>v.texV)),D.uniforms.add(new f.FloatPassUniform("innerScale",v=>v.innerScale))),D.code.add(g.glsl`
		void main(void) {
      ${r?g.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:g.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${g.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${g.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),A.uniforms.add(new z.Texture2DPassUniform("tex",v=>v.texture)),r||A.uniforms.add(new f.FloatPassUniform("altitudeFade",v=>v.altitudeFade)),A.code.add(g.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${r?g.glsl`fragColor = atmosphereColor;`:g.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return x}let m=function(r){function x(){var D=r.apply(this,arguments)||this;D.texV=c.create();D.altitudeFade=0;D.innerScale=0;D.undergroundFadeAlpha=0;D.silhouette=new t;return D}b._inherits(x,r);return b._createClass(x)}(g.NoParameters),t=b._createClass(function(){this.center=y.create();this.v1=y.create();this.v2=y.create()});const w=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:t,SimpleAtmospherePassParameters:m,build:l},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=
t;a.SimpleAtmosphere=w;a.SimpleAtmospherePassParameters=m;a.build=l})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,c,y,p){a.SimpleAtmosphereGeometry=void 0;(function(u){u[u.Cone=0]="Cone";u[u.Cylinder=1]="Cylinder";u[u.Underground=2]="Underground";
u[u.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));p=function(u){function q(){var k=u.apply(this,arguments)||this;k.geometry=a.SimpleAtmosphereGeometry.Cone;return k}b._inherits(q,u);return b._createClass(q)}(p.DefaultTechniqueConfiguration);c.__decorate([y.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],p.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y,p){let u=function(q){function k(){return q.apply(this,arguments)||this}b._inherits(k,q);return b._createClass(k)}(p.ShaderTechniqueConfiguration);c.__decorate([p.parameter({constValue:!0})],u.prototype,"hasSliceHighlight",void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"hasSliceInVertexProgram",void 0);
c.__decorate([p.parameter({constValue:!1})],u.prototype,"instancedDoublePrecision",void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"hasModelTransformation",void 0);c.__decorate([p.parameter({constValue:y.BindType.Pass})],u.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],
function(a,b,c){a.Transform=function(y){b.addCalculateLinearDepth(y);y.vertex.code.add(c.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);y.vertex.code.add(c.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,c,y,p){function u(d){d.varyings.add("linearDepth","float")}function q(d){d.vertex.uniforms.add(new y.Float2PassUniform("nearFar",(f,g)=>g.camera.nearFar))}function k(d){d.vertex.code.add(p.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(d,f){const {vertex:g}=d;switch(f.output){case b.ShaderOutput.Color:if(f.receiveShadows){u(d);g.code.add(p.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.Depth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:d.include(c.VertexPosition,f);u(d);q(d);k(d);g.code.add(p.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}g.code.add(p.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=k;a.addLinearDepth=u;a.addNearFar=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.ShadowHighlight=4]="ShadowHighlight";b[b.ShadowExcludeHighlight=
5]="ShadowExcludeHighlight";b[b.Highlight=6]="Highlight";b[b.Alpha=7]="Alpha";b[b.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor";b[b.COUNT=9]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=function(l){function m(){var t=l.apply(this,arguments)||this;t.transformWorldFromViewTH=p.create();t.transformWorldFromViewTL=p.create();t.transformViewFromCameraRelativeRS=c.create();t.transformProjFromView=y.create();return t}b._inherits(m,l);return b._createClass(m)}(f.NoParameters),n=function(l){function m(){var t=l.apply(this,arguments)||this;t.transformWorldFromModelRS=c.create();t.transformWorldFromModelTH=p.create();t.transformWorldFromModelTL=p.create();
return t}b._inherits(m,l);return b._createClass(m)}(f.NoParameters);a.VertexPosition=function(l,m){l.include(u.PositionAttribute);const t=l.vertex;t.include(q.DoublePrecision,m);l.varyings.add("vPositionWorldCameraRelative","vec3");l.varyings.add("vPosition_view","vec3");t.uniforms.add(new d.Float3PassUniform("transformWorldFromViewTH",w=>w.transformWorldFromViewTH),new d.Float3PassUniform("transformWorldFromViewTL",w=>w.transformWorldFromViewTL),new e.Matrix3PassUniform("transformViewFromCameraRelativeRS",
w=>w.transformViewFromCameraRelativeRS),new h.Matrix4PassUniform("transformProjFromView",w=>w.transformProjFromView),new g.Matrix3DrawUniform("transformWorldFromModelRS",w=>w.transformWorldFromModelRS),new k.Float3DrawUniform("transformWorldFromModelTH",w=>w.transformWorldFromModelTH),new k.Float3DrawUniform("transformWorldFromModelTL",w=>w.transformWorldFromModelTL));t.code.add(f.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);t.code.add(f.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${m.spherical?f.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:f.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);l.fragment.uniforms.add(new d.Float3PassUniform("transformWorldFromViewTL",w=>w.transformWorldFromViewTL));t.code.add(f.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);l.fragment.code.add(f.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=n;a.VertexPositionPassParameters=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(y){y.attributes.add(c.VertexAttribute.POSITION,"vec3");y.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:c},y){y.doublePrecisionRequiresObfuscation?c.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):c.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"mat3",y.BindType.Pass,(d,f,g)=>d.setUniformMatrix3fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Matrix3PassUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,
k,d,f,g){q=function(e){function h(){return e.apply(this,arguments)||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new d.Program(n.rctx,h.shader.get().build(this.configuration),k.Default3D)};z.initializePipeline=function(){return this.configuration.geometry===p.SimpleAtmosphereGeometry.Cylinder?g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:g.backFaceCullingParams,
depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};return c._createClass(h)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(y.SimpleAtmosphere,()=>new Promise((e,h)=>a(["./SimpleAtmosphere.glsl"],e,h)));b.SimpleAtmosphereTechnique=
q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,
0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,
13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,
0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,
50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,
68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,
39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,
99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,
148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,
170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,
96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,
255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,
230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,
b,c){const y={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(p,u=0){const q=p.stride;return Array.from(p.fields.keys()).filter(k=>{k=p.fields.get(k)?.optional;return!(k&&k.glPadding)}).map(k=>{const d=p.fields.get(k),f=d.constructor.ElementCount;var g=y[d.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(k,
f,g,d.offset,q,!(!d.optional||!d.optional.glNormalized),u)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],function(a,b,c,y,p){let u=function(){function g(h,z){this.layout=h;this.buffer="number"===typeof z?new ArrayBuffer(z*h.stride):
z;for(const n of h.fields.keys())z=h.fields.get(n),this[n]=new z.constructor(this.buffer,z.offset,this.stride)}var e=g.prototype;e.getField=function(h,z){return(h=this[h])&&h.elementCount===z.ElementCount&&h.elementType===z.ElementType?h:null};e.slice=function(h,z){return new g(this.layout,this.buffer.slice(h*this.stride,z*this.stride))};e.copyFrom=function(h,z=0,n=0,l=h.count){const m=this.stride;0===m%4?(h=new Uint32Array(h.buffer,z*m,l*m/4),(new Uint32Array(this.buffer,n*m,l*m/4)).set(h)):(h=new Uint8Array(h.buffer,
z*m,l*m),(new Uint8Array(this.buffer,n*m,l*m)).set(h));return this};b._createClass(g,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return g}(),q=function(){function g(h=null){this._lastAligned=this._stride=0;this._fields=new Map;h&&(this._stride=h.stride,h.fields.forEach(z=>this._fields.set(z[0],{...z[1],constructor:f.get(z[1].constructor)})))}var e=
g.prototype;e.vec2f=function(h,z){this._appendField(h,c.BufferViewVec2f,z);return this};e.vec2f64=function(h,z){this._appendField(h,c.BufferViewVec2f64,z);return this};e.vec3f=function(h,z){this._appendField(h,c.BufferViewVec3f,z);return this};e.vec3f64=function(h,z){this._appendField(h,c.BufferViewVec3f64,z);return this};e.vec4f=function(h,z){this._appendField(h,c.BufferViewVec4f,z);return this};e.vec4f64=function(h,z){this._appendField(h,c.BufferViewVec4f64,z);return this};e.mat3f=function(h,z){this._appendField(h,
c.BufferViewMat3f,z);return this};e.mat3f64=function(h,z){this._appendField(h,c.BufferViewMat3f64,z);return this};e.mat4f=function(h,z){this._appendField(h,c.BufferViewMat4f,z);return this};e.mat4f64=function(h,z){this._appendField(h,c.BufferViewMat4f64,z);return this};e.vec4u8=function(h,z){this._appendField(h,c.BufferViewVec4u8,z);return this};e.f32=function(h,z){this._appendField(h,c.BufferViewFloat,z);return this};e.f64=function(h,z){this._appendField(h,c.BufferViewFloat64,z);return this};e.u8=
function(h,z){this._appendField(h,c.BufferViewUint8,z);return this};e.u16=function(h,z){this._appendField(h,c.BufferViewUint16,z);return this};e.i8=function(h,z){this._appendField(h,c.BufferViewInt8,z);return this};e.vec2i8=function(h,z){this._appendField(h,c.BufferViewVec2i8,z);return this};e.vec2i16=function(h,z){this._appendField(h,c.BufferViewVec2i16,z);return this};e.vec2u8=function(h,z){this._appendField(h,c.BufferViewVec2u8,z);return this};e.vec4u16=function(h,z){this._appendField(h,c.BufferViewVec4u16,
z);return this};e.u32=function(h,z){this._appendField(h,c.BufferViewUint32,z);return this};e._appendField=function(h,z,n){if(this._fields.has(h))p.assert(!1,`${h} already added to vertex buffer layout`);else{var l=z.ElementCount*y.elementTypeSize(z.ElementType),m=this._stride;this._stride+=l;this._fields.set(h,{size:l,constructor:z,offset:m,optional:n})}};e.createBuffer=function(h){return new u(this,h)};e.createView=function(h){return new u(this,h)};e.clone=function(){const h=new g;h._stride=this._stride;
h._fields=new Map;this._fields.forEach((z,n)=>h._fields.set(n,z));h.BufferType=this.BufferType;return h};b._createClass(g,[{key:"stride",get:function(){if(this._lastAligned!==this._fields.size){let h=1;this._fields.forEach(z=>h=Math.max(h,y.elementTypeSize(z.constructor.ElementType)));this._stride=Math.floor((this._stride+h-1)/h)*h;this._lastAligned=this._fields.size}return this._stride}},{key:"fields",get:function(){return this._fields}}]);return g}(),k=b._createClass(function(g){this.fields=[];
g.fields.forEach((e,h)=>{var z=e.constructor;this.fields.push([h,{...e,constructor:`${z.ElementType}_${z.ElementCount}`}])});this.stride=g.stride});const d=[c.BufferViewFloat,c.BufferViewVec2f,c.BufferViewVec3f,c.BufferViewVec4f,c.BufferViewMat3f,c.BufferViewMat4f,c.BufferViewFloat64,c.BufferViewVec2f64,c.BufferViewVec3f64,c.BufferViewVec4f64,c.BufferViewMat3f64,c.BufferViewMat4f64,c.BufferViewUint8,c.BufferViewVec2u8,c.BufferViewVec3u8,c.BufferViewVec4u8,c.BufferViewUint16,c.BufferViewVec2u16,c.BufferViewVec3u16,
c.BufferViewVec4u16,c.BufferViewUint32,c.BufferViewVec2u32,c.BufferViewVec3u32,c.BufferViewVec4u32,c.BufferViewInt8,c.BufferViewVec2i8,c.BufferViewVec3i8,c.BufferViewVec4i8,c.BufferViewInt16,c.BufferViewVec2i16,c.BufferViewVec3i16,c.BufferViewVec4i16,c.BufferViewInt32,c.BufferViewVec2i32,c.BufferViewVec3i32,c.BufferViewVec4i32],f=new Map;d.forEach(g=>f.set(`${g.ElementType}_${g.ElementCount}`,g));a.InterleavedBuffer=u;a.InterleavedLayout=q;a.PackedLayout=k;a.newLayout=function(){return new q};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,b,c,y,p,u,q,k){let d=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+
P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);d.ElementType="f32";let f=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);f.ElementType="f32";let g=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,
P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);g.ElementType="f32";let e=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,
Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);e.ElementType="f32";let h=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(c.BufferViewMat3Impl);h.ElementType="f32";c=function(W){function T(P,
Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(c.BufferViewMat3Impl);c.ElementType="f64";let z=function(W){function T(P,Q=0,S,U){P=W.call(this,Float32Array,P,Q,S,U)||this;P.elementType="f32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,
P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(y.BufferViewMat4Impl);z.ElementType="f32";y=function(W){function T(P,Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(y.BufferViewMat4Impl);
y.ElementType="f64";let n=function(W){function T(P,Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);n.ElementType="f64";let l=function(W){function T(P,Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,
W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);l.ElementType="f64";let m=function(W){function T(P,Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+
P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);m.ElementType="f64";let t=function(W){function T(P,Q=0,S,U){P=W.call(this,Float64Array,P,Q,S,U)||this;P.elementType="f64";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);t.ElementType="f64";let w=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint8Array,
P,Q,S,U)||this;P.elementType="u8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);w.ElementType="u8";let r=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint8Array,P,Q,S,U)||this;P.elementType="u8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,
Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);r.ElementType="u8";let x=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint8Array,P,Q,S,U)||this;P.elementType="u8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);x.ElementType="u8";let D=function(W){function T(P,
Q=0,S,U){P=W.call(this,Uint8Array,P,Q,S,U)||this;P.elementType="u8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);D.ElementType="u8";let A=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint16Array,P,Q,S,U)||this;P.elementType="u16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,
P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);A.ElementType="u16";let v=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint16Array,P,Q,S,U)||this;P.elementType="u16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);
v.ElementType="u16";let B=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint16Array,P,Q,S,U)||this;P.elementType="u16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);B.ElementType="u16";let C=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint16Array,P,Q,S,U)||this;P.elementType="u16";return P}b._inherits(T,W);
T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);C.ElementType="u16";let E=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint32Array,P,Q,S,U)||this;P.elementType="u32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};
return b._createClass(T)}(p.BufferViewScalarImpl);E.ElementType="u32";let F=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint32Array,P,Q,S,U)||this;P.elementType="u32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);F.ElementType="u32";let M=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint32Array,P,Q,S,U)||
this;P.elementType="u32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);M.ElementType="u32";let K=function(W){function T(P,Q=0,S,U){P=W.call(this,Uint32Array,P,Q,S,U)||this;P.elementType="u32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,
P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);K.ElementType="u32";let G=function(W){function T(P,Q=0,S,U){P=W.call(this,Int8Array,P,Q,S,U)||this;P.elementType="i8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);G.ElementType="i8";let L=function(W){function T(P,Q=0,S,
U){P=W.call(this,Int8Array,P,Q,S,U)||this;P.elementType="i8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);L.ElementType="i8";let O=function(W){function T(P,Q=0,S,U){P=W.call(this,Int8Array,P,Q,S,U)||this;P.elementType="i8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};
T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);O.ElementType="i8";let I=function(W){function T(P,Q=0,S,U){P=W.call(this,Int8Array,P,Q,S,U)||this;P.elementType="i8";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);I.ElementType=
"i8";let H=function(W){function T(P,Q=0,S,U){P=W.call(this,Int16Array,P,Q,S,U)||this;P.elementType="i16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);H.ElementType="i16";let J=function(W){function T(P,Q=0,S,U){P=W.call(this,Int16Array,P,Q,S,U)||this;P.elementType="i16";return P}b._inherits(T,W);T.prototype.slice=
function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);J.ElementType="i16";let N=function(W){function T(P,Q=0,S,U){P=W.call(this,Int16Array,P,Q,S,U)||this;P.elementType="i16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);
N.ElementType="i16";let R=function(W){function T(P,Q=0,S,U){P=W.call(this,Int16Array,P,Q,S,U)||this;P.elementType="i16";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);R.ElementType="i16";p=function(W){function T(P,Q=0,S,U){P=W.call(this,Int32Array,P,Q,S,U)||this;P.elementType="i32";return P}b._inherits(T,W);T.prototype.slice=
function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(p.BufferViewScalarImpl);p.ElementType="i32";u=function(W){function T(P,Q=0,S,U){P=W.call(this,Int32Array,P,Q,S,U)||this;P.elementType="i32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(u.BufferViewVec2Impl);
u.ElementType="i32";q=function(W){function T(P,Q=0,S,U){P=W.call(this,Int32Array,P,Q,S,U)||this;P.elementType="i32";return P}b._inherits(T,W);T.prototype.slice=function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(q.BufferViewVec3Impl);q.ElementType="i32";k=function(W){function T(P,Q=0,S,U){P=W.call(this,Int32Array,P,Q,S,U)||this;P.elementType="i32";return P}b._inherits(T,W);T.prototype.slice=
function(P,Q){return this.sliceBuffer(T,P,Q)};T.fromTypedArray=function(P,Q){return new T(P.buffer,P.byteOffset,Q,P.byteOffset+P.byteLength)};return b._createClass(T)}(k.BufferViewVec4Impl);k.ElementType="i32";a.BufferViewFloat=d;a.BufferViewFloat64=n;a.BufferViewInt16=H;a.BufferViewInt32=p;a.BufferViewInt8=G;a.BufferViewMat3f=h;a.BufferViewMat3f64=c;a.BufferViewMat4f=z;a.BufferViewMat4f64=y;a.BufferViewUint16=A;a.BufferViewUint32=E;a.BufferViewUint8=w;a.BufferViewVec2f=f;a.BufferViewVec2f64=l;a.BufferViewVec2i16=
J;a.BufferViewVec2i32=u;a.BufferViewVec2i8=L;a.BufferViewVec2u16=v;a.BufferViewVec2u32=F;a.BufferViewVec2u8=r;a.BufferViewVec3f=g;a.BufferViewVec3f64=m;a.BufferViewVec3i16=N;a.BufferViewVec3i32=q;a.BufferViewVec3i8=O;a.BufferViewVec3u16=B;a.BufferViewVec3u32=M;a.BufferViewVec3u8=x;a.BufferViewVec4f=e;a.BufferViewVec4f64=t;a.BufferViewVec4i16=R;a.BufferViewVec4i32=k;a.BufferViewVec4i8=I;a.BufferViewVec4u16=C;a.BufferViewVec4u32=K;a.BufferViewVec4u8=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u,q,k=0,d,f){this.TypedArrayConstructor=u;this.elementCount=9;u=this.TypedArrayConstructor;void 0===d&&(d=9*u.BYTES_PER_ELEMENT);const g=0===q.byteLength?0:k;this.typedBuffer=null==f?new u(q,g):new u(q,g,(f-k)/u.BYTES_PER_ELEMENT);this.typedBufferStride=d/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var p=y.prototype;p.sliceBuffer=function(u,q,k=this.count-q){q=this.typedBuffer.byteOffset+q*this.stride;return new u(this.buffer,q,this.stride,q+k*this.stride)};p.getMat=function(u,q){u*=this.typedBufferStride;for(let k=0;9>k;k++)q[k]=this.typedBuffer[u++];return q};p.setMat=function(u,q){u*=this.typedBufferStride;for(let k=0;9>k;k++)this.typedBuffer[u++]=q[k]};p.get=function(u,q){return this.typedBuffer[u*this.typedBufferStride+
q]};p.set=function(u,q,k){this.typedBuffer[u*this.typedBufferStride+q]=k};p.copyFrom=function(u,q,k){const d=this.typedBuffer,f=q.typedBuffer;u*=this.typedBufferStride;q=k*q.typedBufferStride;for(k=0;9>k;++k)d[u++]=f[q++]};b._createClass(y,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return y}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function y(u,q,k=0,d,f){this.TypedArrayConstructor=u;this.elementCount=16;u=this.TypedArrayConstructor;void 0===d&&(d=16*u.BYTES_PER_ELEMENT);const g=0===q.byteLength?0:k;this.typedBuffer=null==f?new u(q,g):new u(q,g,(f-k)/u.BYTES_PER_ELEMENT);this.typedBufferStride=d/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var p=y.prototype;p.sliceBuffer=
function(u,q,k=this.count-q){q=this.typedBuffer.byteOffset+q*this.stride;return new u(this.buffer,q,this.stride,q+k*this.stride)};p.getMat=function(u,q){u*=this.typedBufferStride;for(let k=0;16>k;k++)q[k]=this.typedBuffer[u++];return q};p.setMat=function(u,q){u*=this.typedBufferStride;for(let k=0;16>k;k++)this.typedBuffer[u++]=q[k]};p.get=function(u,q){return this.typedBuffer[u*this.typedBufferStride+q]};p.set=function(u,q,k){this.typedBuffer[u*this.typedBufferStride+q]=k};p.copyFrom=function(u,q,
k){const d=this.typedBuffer,f=q.typedBuffer;u*=this.typedBufferStride;q=k*q.typedBufferStride;for(k=0;16>k;++k)d[u++]=f[q++]};b._createClass(y,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return y}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u,q,k=0,d,
f){this.TypedArrayConstructor=u;this.elementCount=1;u=this.TypedArrayConstructor;void 0===d&&(d=u.BYTES_PER_ELEMENT);const g=0===q.byteLength?0:k;this.typedBuffer=null==f?new u(q,g):new u(q,g,(f-k)/u.BYTES_PER_ELEMENT);this.stride=d;this.typedBufferStride=d/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}var p=y.prototype;p.sliceBuffer=function(u,q,k=this.count-q){q=this.typedBuffer.byteOffset+q*this.stride;return new u(this.buffer,q,this.stride,q+k*this.stride)};
p.get=function(u){return this.typedBuffer[u*this.typedBufferStride]};p.set=function(u,q){this.typedBuffer[u*this.typedBufferStride]=q};b._createClass(y,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return y}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let y=
function(){function p(q,k,d=0,f,g){this.TypedArrayConstructor=q;this.elementCount=2;q=this.TypedArrayConstructor;void 0===f&&(f=2*q.BYTES_PER_ELEMENT);const e=0===k.byteLength?0:d;this.typedBuffer=null==g?new q(k,e):new q(k,e,(g-d)/q.BYTES_PER_ELEMENT);this.typedBufferStride=f/q.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=p.prototype;u.sliceBuffer=function(q,k,d=this.count-
k){k=this.typedBuffer.byteOffset+k*this.stride;return new q(this.buffer,k,this.stride,k+d*this.stride)};u.getVec=function(q,k){q*=this.typedBufferStride;return c.set(k,this.typedBuffer[q],this.typedBuffer[q+1])};u.setVec=function(q,k){q*=this.typedBufferStride;this.typedBuffer[q++]=k[0];this.typedBuffer[q]=k[1]};u.get=function(q,k){return this.typedBuffer[q*this.typedBufferStride+k]};u.set=function(q,k,d){this.typedBuffer[q*this.typedBufferStride+k]=d};u.setValues=function(q,k,d){q*=this.typedBufferStride;
this.typedBuffer[q++]=k;this.typedBuffer[q]=d};u.copyFrom=function(q,k,d){const f=this.typedBuffer,g=k.typedBuffer;q*=this.typedBufferStride;k=d*k.typedBufferStride;f[q++]=g[k++];f[q]=g[k]};b._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();y.ElementCount=2;a.BufferViewVec2Impl=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/vec3"],function(a,b,c){let y=function(){function p(q,k,d=0,f,g){this.TypedArrayConstructor=q;this.elementCount=3;q=this.TypedArrayConstructor;void 0===f&&(f=3*q.BYTES_PER_ELEMENT);const e=0===k.byteLength?0:d;this.typedBuffer=null==g?new q(k,e):new q(k,e,(g-d)/q.BYTES_PER_ELEMENT);this.typedBufferStride=f/q.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=
p.prototype;u.sliceBuffer=function(q,k,d=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new q(this.buffer,k,this.stride,k+d*this.stride)};u.getVec=function(q,k){q*=this.typedBufferStride;return c.set(k,this.typedBuffer[q],this.typedBuffer[q+1],this.typedBuffer[q+2])};u.setVec=function(q,k){q*=this.typedBufferStride;this.typedBuffer[q++]=k[0];this.typedBuffer[q++]=k[1];this.typedBuffer[q]=k[2]};u.get=function(q,k){return this.typedBuffer[q*this.typedBufferStride+k]};u.set=function(q,
k,d){this.typedBuffer[q*this.typedBufferStride+k]=d};u.setValues=function(q,k,d,f){q*=this.typedBufferStride;this.typedBuffer[q++]=k;this.typedBuffer[q++]=d;this.typedBuffer[q]=f};u.copyFrom=function(q,k,d){const f=this.typedBuffer,g=k.typedBuffer;q*=this.typedBufferStride;k=d*k.typedBufferStride;f[q++]=g[k++];f[q++]=g[k++];f[q]=g[k]};b._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();y.ElementCount=3;a.BufferViewVec3Impl=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,b,c){let y=function(){function p(q,k,d=0,f,g){this.TypedArrayConstructor=q;this.start=d;this.elementCount=4;q=this.TypedArrayConstructor;void 0===f&&(f=4*q.BYTES_PER_ELEMENT);const e=0===k.byteLength?0:d;this.typedBuffer=null==g?new q(k,e):new q(k,e,(g-d)/q.BYTES_PER_ELEMENT);this.typedBufferStride=f/q.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=p.prototype;u.sliceBuffer=function(q,k,d=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new q(this.buffer,k,this.stride,k+d*this.stride)};u.getVec=function(q,k){q*=this.typedBufferStride;return c.set(k,this.typedBuffer[q++],this.typedBuffer[q++],this.typedBuffer[q++],this.typedBuffer[q])};u.setVec=function(q,k){q*=this.typedBufferStride;
this.typedBuffer[q++]=k[0];this.typedBuffer[q++]=k[1];this.typedBuffer[q++]=k[2];this.typedBuffer[q]=k[3]};u.get=function(q,k){return this.typedBuffer[q*this.typedBufferStride+k]};u.set=function(q,k,d){this.typedBuffer[q*this.typedBufferStride+k]=d};u.setValues=function(q,k,d,f,g){q*=this.typedBufferStride;this.typedBuffer[q++]=k;this.typedBuffer[q++]=d;this.typedBuffer[q++]=f;this.typedBuffer[q]=g};u.copyFrom=function(q,k,d){const f=this.typedBuffer,g=k.typedBuffer;q*=this.typedBufferStride;k=d*
k.typedBufferStride;f[q++]=g[k++];f[q++]=g[k++];f[q++]=g[k++];f[q]=g[k]};b._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();y.ElementCount=4;a.BufferViewVec4Impl=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;
case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;
case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(V,X,Y){function Z(ia,oa){ia>oa&&([ia,oa]=[oa,ia]);const ma=ia.toString()+"."+oa.toString();if(ha[ma])return ha[ma];let fa=ea.length;ea.length+=3;r.add(ea,3*ia,ea,3*oa,ea,fa);r.scale(ea,fa,V/r.length(ea,fa));fa/=3;return ha[ma]=fa}let ea;Y?(ea=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Y=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(Y=V*(1+Math.sqrt(5))/2,ea=[-V,Y,0,V,Y,0,-V,-Y,0,V,-Y,0,0,-V,Y,0,V,Y,0,-V,-Y,0,V,-Y,Y,0,-V,Y,0,V,-Y,0,-V,-Y,0,V],
Y=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var ja=0;ja<ea.length;ja+=3)r.scale(ea,ja,V/r.length(ea,ja));let ha={};for(ja=0;ja<X;ja++){const ia=Y.length,oa=Array(4*ia);for(let ma=0;ma<ia;ma+=3){const fa=Y[ma],ba=Y[ma+1],aa=Y[ma+2],da=Z(fa,ba),ca=Z(ba,aa),na=Z(aa,fa),qa=4*ma;oa[qa]=fa;oa[qa+1]=da;oa[qa+2]=na;oa[qa+3]=ba;oa[qa+4]=ca;oa[qa+5]=da;oa[qa+6]=aa;oa[qa+7]=na;oa[qa+8]=ca;oa[qa+9]=da;oa[qa+10]=ca;
oa[qa+11]=na}Y=oa;ha={}}X=u.floatArrayFrom(ea);for(ja=0;ja<X.length;ja+=3)r.normalize(X,ja);Y=[[n.VertexAttribute.POSITION,Y],[n.VertexAttribute.NORMAL,Y]];return{vertexAttributes:[[n.VertexAttribute.POSITION,new f.Attribute(u.floatArrayFrom(ea),3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(X,3,!0)]],indices:Y}}function m(V,X,Y,Z,ea,ja,ha=c.fromValues(0,0,0)){var ia=X.length,oa=u.newFloatArray(Y.length*ia*3+(6*Z.length||0));const ma=u.newFloatArray(Y.length*ia*3+(Z?6:0)),fa=[],ba=[];let aa=0;var da=
0;const ca=c.create(),na=c.create(),qa=c.create(),ua=c.create(),sa=c.create(),pa=c.create(),ka=c.create(),ra=y.create(),va=c.create(),Ca=c.create(),Ba=c.create(),Ha=c.create(),Ma=c.create(),Qa=k.create();b.set(va,0,1,0);b.subtract(na,Y[1],Y[0]);b.normalize(na,na);ja?(b.add(ra,Y[0],ha),b.normalize(qa,ra)):b.set(qa,0,0,1);w(na,qa,va,va,sa,qa,.99619469809);b.copy(ua,qa);b.copy(Ha,sa);for(var Sa=0;Sa<Z.length;Sa++)b.scale(pa,sa,Z[Sa][0]),b.scale(ra,qa,Z[Sa][2]),b.add(pa,pa,ra),b.add(pa,pa,Y[0]),oa[aa++]=
pa[0],oa[aa++]=pa[1],oa[aa++]=pa[2];ma[da++]=-na[0];ma[da++]=-na[1];ma[da++]=-na[2];for(Sa=0;Sa<ea.length;Sa++)fa.push(0<ea[Sa][0]?ea[Sa][0]:-ea[Sa][0]-1+Z.length),fa.push(0<ea[Sa][1]?ea[Sa][1]:-ea[Sa][1]-1+Z.length),fa.push(0<ea[Sa][2]?ea[Sa][2]:-ea[Sa][2]-1+Z.length),ba.push(0),ba.push(0),ba.push(0);Sa=Z.length;const La=Z.length-1;for(let Va=0;Va<Y.length;Va++){let cb=!1;0<Va&&(b.copy(ca,na),Va<Y.length-1?(b.subtract(na,Y[Va+1],Y[Va]),b.normalize(na,na)):cb=!0,b.add(Ca,ca,na),b.normalize(Ca,Ca),
b.add(Ba,Y[Va-1],ua),k.fromPositionAndNormal(Y[Va],Ca,Qa),k.intersectRay(Qa,d.wrap(Ba,ca),ra)?(b.subtract(ra,ra,Y[Va]),b.normalize(qa,ra),b.cross(sa,Ca,qa),b.normalize(sa,sa)):w(Ca,ua,Ha,va,sa,qa,.99619469809),b.copy(ua,qa),b.copy(Ha,sa));ja&&(b.add(ra,Y[Va],ha),b.normalize(Ma,ra));for(let la=0;la<ia;la++)if(b.scale(pa,sa,X[la][0]),b.scale(ra,qa,X[la][1]),b.add(pa,pa,ra),b.normalize(ka,pa),ma[da++]=ka[0],ma[da++]=ka[1],ma[da++]=ka[2],b.add(pa,pa,Y[Va]),oa[aa++]=pa[0],oa[aa++]=pa[1],oa[aa++]=pa[2],
!cb){var Ua=(la+1)%ia;fa.push(Sa+la);fa.push(Sa+ia+la);fa.push(Sa+Ua);fa.push(Sa+Ua);fa.push(Sa+ia+la);fa.push(Sa+ia+Ua);for(Ua=0;6>Ua;Ua++)ba.push(fa[fa.length-6+Ua]-La)}Sa+=ia}X=Y[Y.length-1];for(Y=0;Y<Z.length;Y++)b.scale(pa,sa,Z[Y][0]),b.scale(ra,qa,Z[Y][1]),b.add(pa,pa,ra),b.add(pa,pa,X),oa[aa++]=pa[0],oa[aa++]=pa[1],oa[aa++]=pa[2];Z=da/3;ma[da++]=na[0];ma[da++]=na[1];ma[da++]=na[2];ia=Sa-ia;for(da=0;da<ea.length;da++)fa.push(0<=ea[da][0]?Sa+ea[da][0]:-ea[da][0]-1+ia),fa.push(0<=ea[da][2]?Sa+
ea[da][2]:-ea[da][2]-1+ia),fa.push(0<=ea[da][1]?Sa+ea[da][1]:-ea[da][1]-1+ia),ba.push(Z),ba.push(Z),ba.push(Z);ea=[[n.VertexAttribute.POSITION,fa],[n.VertexAttribute.NORMAL,ba]];oa=[[n.VertexAttribute.POSITION,new f.Attribute(oa,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(ma,3,!0)]];return new h.Geometry(V,oa,ea)}function t(V,X,Y,Z,ea){if(Math.abs(b.dot(X,V))>ea)return!1;b.cross(Y,V,X);b.normalize(Y,Y);b.cross(Z,Y,V);b.normalize(Z,Z);return!0}function w(V,X,Y,Z,ea,ja,ha){return t(V,X,ea,ja,ha)||
t(V,Y,ea,ja,ha)||t(V,Z,ea,ja,ha)}const r=g.Vec3Compact,x=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],D=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],v=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],B=Array(36);for(g=0;6>g;g++)for(var C=0;6>C;C++)B[6*g+C]=g;const E=Array(36);for(g=0;6>g;g++)E[6*g]=0,E[6*g+1]=1,E[6*g+2]=2,E[6*g+3]=2,E[6*g+4]=3,E[6*g+5]=0;const F=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,
0,.5],[0,-.5,0],[0,.5,0]],M=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],K=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],G=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];g=c.fromValues(-.5,0,-.5);C=c.fromValues(.5,0,-.5);const L=c.fromValues(0,0,.5),O=c.fromValues(0,.5,0),I=c.create(),H=c.create(),J=c.create(),N=c.create(),R=c.create();b.subtract(I,g,O);b.subtract(H,g,C);b.cross(J,I,H);b.normalize(J,J);b.subtract(I,C,O);b.subtract(H,C,L);b.cross(N,I,H);b.normalize(N,N);b.subtract(I,
L,O);b.subtract(H,L,g);b.cross(R,I,H);b.normalize(R,R);const W=[g,C,L,O],T=[0,-1,0,J[0],J[1],J[2],N[0],N[1],N[2],R[0],R[1],R[2]],P=[0,1,2,3,1,0,3,2,1,3,0,2],Q=[0,0,0,1,1,1,2,2,2,3,3,3],S=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],U=c.create();a.cgToGIS=function(V,X=V){var Y=V.vertexAttributes;V=Y.get(n.VertexAttribute.POSITION).data;if(Y=Y.get(n.VertexAttribute.NORMAL).data){var Z=X.getMutableAttribute(n.VertexAttribute.NORMAL).data;for(let ea=0;ea<Y.length;ea+=3){const ja=Y[ea+1];Z[ea+1]=-Y[ea+2];Z[ea+
2]=ja}}if(V)for(X=X.getMutableAttribute(n.VertexAttribute.POSITION).data,Y=0;Y<V.length;Y+=3)Z=V[Y+1],X[Y+1]=-V[Y+2],X[Y+2]=Z};a.createBoxGeometry=function(V,X){Array.isArray(X)||(X=[X,X,X]);const Y=Array(24);for(let Z=0;8>Z;Z++)Y[3*Z]=x[Z][0]*X[0],Y[3*Z+1]=x[Z][1]*X[1],Y[3*Z+2]=x[Z][2]*X[2];return new h.Geometry(V,[[n.VertexAttribute.POSITION,new f.Attribute(Y,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(D,3)],[n.VertexAttribute.UV0,new f.Attribute(A,2)]],[[n.VertexAttribute.POSITION,v],[n.VertexAttribute.NORMAL,
B],[n.VertexAttribute.UV0,E]])};a.createConeGeometry=function(V,X,Y,Z,ea,ja=!0,ha=!0){let ia=0;var oa=c.fromValues(0,ia,0),ma=c.fromValues(0,ia+X,0),fa=c.fromValues(0,-1,0),ba=c.fromValues(0,1,0);ea&&(ia=X,ma=c.fromValues(0,0,0),oa=c.fromValues(0,ia,0),fa=c.fromValues(0,1,0),ba=c.fromValues(0,-1,0));oa=[ma,oa];fa=[fa,ba];ba=Z+2;ma=Math.sqrt(X*X+Y*Y);if(ea)for(ea=Z-1;0<=ea;ea--){var aa=2*Math.PI/Z*ea,da=c.fromValues(Math.cos(aa)*Y,ia,Math.sin(aa)*Y);oa.push(da);aa=c.fromValues(X*Math.cos(aa)/ma,-Y/
ma,X*Math.sin(aa)/ma);fa.push(aa)}else for(ea=0;ea<Z;ea++)aa=2*Math.PI/Z*ea,da=c.fromValues(Math.cos(aa)*Y,ia,Math.sin(aa)*Y),oa.push(da),aa=c.fromValues(X*Math.cos(aa)/ma,Y/ma,X*Math.sin(aa)/ma),fa.push(aa);X=[];Y=[];if(ja){for(ja=3;ja<oa.length;ja++)X.push(1),X.push(ja-1),X.push(ja),Y.push(0),Y.push(0),Y.push(0);X.push(oa.length-1);X.push(2);X.push(1);Y.push(0);Y.push(0);Y.push(0)}if(ha){for(ha=3;ha<oa.length;ha++)X.push(ha),X.push(ha-1),X.push(0),Y.push(ha),Y.push(ha-1),Y.push(1);X.push(0);X.push(2);
X.push(oa.length-1);Y.push(1);Y.push(2);Y.push(fa.length-1)}ha=u.newFloatArray(3*ba);for(ja=0;ja<ba;ja++)ha[3*ja]=oa[ja][0],ha[3*ja+1]=oa[ja][1],ha[3*ja+2]=oa[ja][2];oa=u.newFloatArray(3*ba);for(ja=0;ja<ba;ja++)oa[3*ja]=fa[ja][0],oa[3*ja+1]=fa[ja][1],oa[3*ja+2]=fa[ja][2];fa=[[n.VertexAttribute.POSITION,X],[n.VertexAttribute.NORMAL,Y]];oa=[[n.VertexAttribute.POSITION,new f.Attribute(ha,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(oa,3,!0)]];return new h.Geometry(V,oa,fa)};a.createCylinderGeometry=
function(V,X,Y,Z,ea,ja,ha){ea=ea?c.clone(ea):c.fromValues(1,0,0);ja=ja?c.clone(ja):c.fromValues(0,0,0);ha??(ha=!0);var ia=c.create();b.normalize(ia,ea);var oa=c.create();b.scale(oa,ia,Math.abs(X));var ma=c.create();b.scale(ma,oa,-.5);b.add(ma,ma,ja);const fa=c.fromValues(0,1,0);.2>Math.abs(1-b.dot(ia,fa))&&b.set(fa,0,0,1);const ba=c.create();b.cross(ba,ia,fa);b.normalize(ba,ba);b.cross(fa,ba,ia);const aa=2*Z+(ha?2:0),da=Z+(ha?2:0);X=u.newFloatArray(3*aa);ja=u.newFloatArray(3*da);ea=u.newFloatArray(2*
aa);const ca=Array(3*Z*(ha?4:2)),na=Array(3*Z*(ha?4:2));ha&&(X[3*(aa-2)]=ma[0],X[3*(aa-2)+1]=ma[1],X[3*(aa-2)+2]=ma[2],ea[2*(aa-2)]=0,ea[2*(aa-2)+1]=0,X[3*(aa-1)]=X[3*(aa-2)]+oa[0],X[3*(aa-1)+1]=X[3*(aa-2)+1]+oa[1],X[3*(aa-1)+2]=X[3*(aa-2)+2]+oa[2],ea[2*(aa-1)]=1,ea[2*(aa-1)+1]=1,ja[3*(da-2)]=-ia[0],ja[3*(da-2)+1]=-ia[1],ja[3*(da-2)+2]=-ia[2],ja[3*(da-1)]=ia[0],ja[3*(da-1)+1]=ia[1],ja[3*(da-1)+2]=ia[2]);ia=0;const qa=c.create(),ua=c.create();for(let ra=0;ra<Z;ra++){var sa=2*Math.PI/Z*ra;b.scale(qa,
fa,Math.sin(sa));b.scale(ua,ba,Math.cos(sa));b.add(qa,qa,ua);ja[3*ra]=qa[0];ja[3*ra+1]=qa[1];ja[3*ra+2]=qa[2];b.scale(qa,qa,Y);b.add(qa,qa,ma);X[3*ra]=qa[0];X[3*ra+1]=qa[1];X[3*ra+2]=qa[2];ea[2*ra]=ra/Z;ea[2*ra+1]=0;X[3*(ra+Z)]=X[3*ra]+oa[0];X[3*(ra+Z)+1]=X[3*ra+1]+oa[1];X[3*(ra+Z)+2]=X[3*ra+2]+oa[2];ea[2*(ra+Z)]=ra/Z;ea[2*ra+1]=1;sa=(ra+1)%Z;var pa=ia++,ka=ra;ca[pa]=ra;na[pa]=ka;pa=ia++;ka=ra;ca[pa]=ra+Z;na[pa]=ka;pa=ia++;ka=sa;ca[pa]=sa;na[pa]=ka;pa=ia++;ka=sa;ca[pa]=sa;na[pa]=ka;pa=ia++;ka=ra;
ca[pa]=ra+Z;na[pa]=ka;pa=ia++;ka=sa;ca[pa]=sa+Z;na[pa]=ka}if(ha){for(Y=0;Y<Z;Y++)ha=(Y+1)%Z,oa=ia++,ma=da-2,ca[oa]=aa-2,na[oa]=ma,oa=ia++,ma=da-2,ca[oa]=Y,na[oa]=ma,oa=ia++,ma=da-2,ca[oa]=ha,na[oa]=ma;for(Y=0;Y<Z;Y++)ha=(Y+1)%Z,oa=ia++,ma=da-1,ca[oa]=Y+Z,na[oa]=ma,oa=ia++,ma=da-1,ca[oa]=aa-1,na[oa]=ma,oa=ia++,ma=da-1,ca[oa]=ha+Z,na[oa]=ma}Z=[[n.VertexAttribute.POSITION,ca],[n.VertexAttribute.NORMAL,na],[n.VertexAttribute.UV0,ca]];X=[[n.VertexAttribute.POSITION,new f.Attribute(X,3,!0)],[n.VertexAttribute.NORMAL,
new f.Attribute(ja,3,!0)],[n.VertexAttribute.UV0,new f.Attribute(ea,2,!0)]];return new h.Geometry(V,X,Z)};a.createDiamondGeometry=function(V,X){Array.isArray(X)||(X=[X,X,X]);const Y=Array(18);for(let Z=0;6>Z;Z++)Y[3*Z]=F[Z][0]*X[0],Y[3*Z+1]=F[Z][1]*X[1],Y[3*Z+2]=F[Z][2]*X[2];return new h.Geometry(V,[[n.VertexAttribute.POSITION,new f.Attribute(Y,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(M,3)]],[[n.VertexAttribute.POSITION,K],[n.VertexAttribute.NORMAL,G]])};a.createExtrudedTriangle=function(V,
X,Y,Z,ea,ja=0){const ha=Array(18);X=[[-Y,ja,ea/2],[Z,ja,ea/2],[0,X+ja,ea/2],[-Y,ja,-ea/2],[Z,ja,-ea/2],[0,X+ja,-ea/2]];for(Y=0;6>Y;Y++)ha[3*Y]=X[Y][0],ha[3*Y+1]=X[Y][1],ha[3*Y+2]=X[Y][2];return new h.Geometry(V,[[n.VertexAttribute.POSITION,new f.Attribute(ha,3,!0)]],[[n.VertexAttribute.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])};a.createPathExtrusionGeometry=m;a.createPointGeometry=function(V,X,Y,Z,ea,ja,ha,ia,oa=null){Y=Y?[Y[0],Y[1],Y[2]]:[0,0,0];X=X?[X[0],X[1],X[2]]:[0,0,1];ha=
ha||[0,0];Z=Z?[255*Z[0],255*Z[1],255*Z[2],3<Z.length?255*Z[3]:255]:[255,255,255,255];ea=null!=ea&&2===ea.length?ea:[1,1];ha=[[n.VertexAttribute.POSITION,new f.Attribute(Y,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(X,3,!0)],[n.VertexAttribute.UV0,new f.Attribute(ha,ha.length)],[n.VertexAttribute.COLOR,new f.Attribute(Z,4,!0)],[n.VertexAttribute.SIZE,new f.Attribute(ea,2)]];null!=ja&&ha.push([n.VertexAttribute.AUXPOS1,new f.Attribute([ja[0],ja[1],ja[2],ja[3]],4)]);null!=ia&&ha.push([n.VertexAttribute.AUXPOS2,
new f.Attribute([ia[0],ia[1],ia[2],ia[3]],4)]);return new h.Geometry(V,ha,null,null,e.ContentObjectType.Point,oa)};a.createPolySphereData=l;a.createPolySphereGeometry=function(V,X,Y,Z){const {vertexAttributes:ea,indices:ja}=l(X,Y,Z);return new h.Geometry(V,ea,ja)};a.createPolylineGeometry=function(V,X,Y,Z){z.assert(1<X.length,"createPolylineGeometry(): polyline needs at least 2 points");z.assert(3===X[0].length,"createPolylineGeometry(): malformed vertex");z.assert(null==Y||Y.length===X.length,"createPolylineGeometry: need same number of points and normals");
z.assert(null==Y||3===Y[0].length,"createPolylineGeometry(): malformed normal");var ea=p.newDoubleArray(3*X.length);const ja=Array(2*(X.length-1));var ha=0,ia=0;for(var oa=0;oa<X.length;oa++){for(var ma=0;3>ma;ma++)ea[ha++]=X[oa][ma];0<oa&&(ja[ia++]=oa-1,ja[ia++]=oa)}ha=[];ia=[];ha.push([n.VertexAttribute.POSITION,ja]);ia.push([n.VertexAttribute.POSITION,new f.Attribute(ea,3,!0)]);if(Y){ea=u.newFloatArray(3*Y.length);oa=0;for(ma=0;ma<X.length;ma++)for(let fa=0;3>fa;fa++)ea[oa++]=Y[ma][fa];ha.push([n.VertexAttribute.NORMAL,
ja]);ia.push([n.VertexAttribute.NORMAL,new f.Attribute(ea,3,!0)])}Z&&(ia.push([n.VertexAttribute.COLOR,new f.Attribute(Z,4)]),ha.push([n.VertexAttribute.COLOR,q.getContinuousIndexArray(Z.length/4)]));return new h.Geometry(V,ia,ha,null,e.ContentObjectType.Line)};a.createSphereGeometry=function(V,X,Y,Z,ea={uv:!0}){var ja=-Math.PI,ha=2*Math.PI,ia=-Math.PI/2,oa=Math.PI;Y=Math.max(3,Math.floor(Y));const ma=Math.max(2,Math.floor(Z));var fa=(Y+1)*(ma+1);Z=u.newFloatArray(3*fa);const ba=u.newFloatArray(3*
fa);fa=u.newFloatArray(2*fa);const aa=[];var da=0;for(var ca=0;ca<=ma;ca++){const qa=[],ua=ca/ma,sa=ia+ua*oa,pa=Math.cos(sa);for(let ka=0;ka<=Y;ka++){const ra=ka/Y;var na=ja+ra*ha;const va=Math.cos(na)*pa,Ca=Math.sin(sa);na=-Math.sin(na)*pa;Z[3*da]=va*X;Z[3*da+1]=Ca*X;Z[3*da+2]=na*X;ba[3*da]=va;ba[3*da+1]=Ca;ba[3*da+2]=na;fa[2*da]=ra;fa[2*da+1]=ua;qa.push(da);++da}aa.push(qa)}X=[];for(ja=0;ja<ma;ja++)for(ha=0;ha<Y;ha++)ia=aa[ja][ha],oa=aa[ja][ha+1],da=aa[ja+1][ha+1],ca=aa[ja+1][ha],0===ja?(X.push(ia),
X.push(da),X.push(ca)):ja===ma-1?(X.push(ia),X.push(oa),X.push(da)):(X.push(ia),X.push(oa),X.push(da),X.push(da),X.push(ca),X.push(ia));Y=[[n.VertexAttribute.POSITION,X],[n.VertexAttribute.NORMAL,X]];Z=[[n.VertexAttribute.POSITION,new f.Attribute(Z,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(ba,3,!0)]];ea.uv&&(Z.push([n.VertexAttribute.UV0,new f.Attribute(fa,2,!0)]),Y.push([n.VertexAttribute.UV0,X]));ea.offset&&(Y[0][0]=n.VertexAttribute.OFFSET,Z[0][0]=n.VertexAttribute.OFFSET,Y.push([n.VertexAttribute.POSITION,
q.getZeroIndexArray(X.length)]),Z.push([n.VertexAttribute.POSITION,new f.Attribute(Float64Array.from(ea.offset),3,!0)]));return new h.Geometry(V,Z,Y)};a.createSquareGeometry=function(V,X=S){var Y=Array(12);for(var Z=0;4>Z;Z++)for(let ea=0;3>ea;ea++)Y[3*Z+ea]=X[Z][ea];X=[0,1,2,2,3,0];Z=[0,0,0,0,0,0];X=[[n.VertexAttribute.POSITION,X],[n.VertexAttribute.NORMAL,Z],[n.VertexAttribute.UV0,X],[n.VertexAttribute.COLOR,Z]];Y=[[n.VertexAttribute.POSITION,new f.Attribute(Y,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute([0,
0,1],3,!0)],[n.VertexAttribute.UV0,new f.Attribute([0,0,1,0,1,1,0,1],2,!0)],[n.VertexAttribute.COLOR,new f.Attribute([255,255,255,255],4,!0)]];return new h.Geometry(V,Y,X)};a.createTetrahedronGeometry=function(V,X){Array.isArray(X)||(X=[X,X,X]);const Y=Array(12);for(let Z=0;4>Z;Z++)Y[3*Z]=W[Z][0]*X[0],Y[3*Z+1]=W[Z][1]*X[1],Y[3*Z+2]=W[Z][2]*X[2];return new h.Geometry(V,[[n.VertexAttribute.POSITION,new f.Attribute(Y,3,!0)],[n.VertexAttribute.NORMAL,new f.Attribute(T,3)]],[[n.VertexAttribute.POSITION,
P],[n.VertexAttribute.NORMAL,Q]])};a.createTubeGeometry=function(V,X,Y,Z,ea,ja){Z=Z||10;ea=null!=ea?ea:!0;z.assert(1<X.length);const ha=[],ia=[];for(let oa=0;oa<Z;oa++){ha.push([0,-oa-1,-((oa+1)%Z)-1]);const ma=oa/Z*2*Math.PI;ia.push([Math.cos(ma)*Y,Math.sin(ma)*Y])}return m(V,ia,X,[[0,0,0]],ha,ea,ja)};a.makeOrthoBasisDirUpFallback=w;a.transformInPlace=function(V,X){V=V.getMutableAttribute(n.VertexAttribute.POSITION).data;for(let Y=0;Y<V.length;Y+=3)b.set(U,V[Y],V[Y+1],V[Y+2]),b.transformMat4(U,U,
X),V[Y]=U[0],V[Y+1]=U[1],V[Y+2]=U[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.copyInto=function(c,y){for(let p=0;p<y.length;++p)c[p]=y[p];return c};a.doubleArrayFrom=function(c){return(b.isArray(c)?c.length:c.byteLength/8)<=b.NATIVE_ARRAY_MAX_SIZE?Array.from(c):new Float64Array(c)};a.doubleSubArray=function(c,y,p){return Array.isArray(c)?c.slice(y,y+p):c.subarray(y,
y+p)};a.newDoubleArray=function(c,y=!1){return c<=b.NATIVE_ARRAY_MAX_SIZE?y?Array(c).fill(0):Array(c):new Float64Array(c)};a.toFloat64Array=function(c){return Array.isArray(c)?new Float64Array(c):c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.compactFloatArray=function(c){return b.isArray(c)?c.length<b.NATIVE_ARRAY_MAX_SIZE?c:new Float32Array(c):c.length<b.NATIVE_ARRAY_MAX_SIZE?
Array.from(c):c};a.floatArrayFrom=function(c){return(b.isArray(c)?c.length:c.byteLength/8)<=b.NATIVE_ARRAY_MAX_SIZE?Array.from(c):new Float32Array(c)};a.floatSubArray=function(c,y,p){return Array.isArray(c)?c.slice(y,y+p):c.subarray(y,y+p)};a.newFloatArray=function(c,y=!1){return c<=b.NATIVE_ARRAY_MAX_SIZE?y?Array(c).fill(0):Array(c):new Float32Array(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],
function(a,b){function c(k){let d=!0;for(const f of k){if(65536<=f)return b.isArray(k)?new Uint32Array(k):k;256<=f&&(d=!1)}return d?new Uint8Array(k):new Uint16Array(k)}let y=(()=>{const k=new Uint32Array(131072);for(let d=0;d<k.length;++d)k[d]=d;return k})();const p=[0],u=(()=>{const k=new Uint16Array(65536);for(let d=0;d<k.length;++d)k[d]=d;return k})();let q=new Uint8Array(65536);a.compactIndices=function(k){return b.isArray(k)?k.length<b.NATIVE_ARRAY_MAX_SIZE?k:c(k):k.length<b.NATIVE_ARRAY_MAX_SIZE?
Array.from(k):k.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?k:c(k)};a.getContinuousIndexArray=function(k){if(1===k)return p;if(k<b.NATIVE_ARRAY_MAX_SIZE)return Array.from(new Uint16Array(u.buffer,0,k));if(k<u.length)return new Uint16Array(u.buffer,0,k);if(k>y.length){y=new Uint32Array(Math.max(2*y.length,k));for(let d=0;d<y.length;d++)y[d]=d}return new Uint32Array(y.buffer,0,k)};a.getZeroIndexArray=function(k){if(1===k)return p;if(k<b.NATIVE_ARRAY_MAX_SIZE)return Array(k).fill(0);k>q.length&&
(q=new Uint8Array(Math.max(2*q.length,k)));return new Uint8Array(q.buffer,0,k)};a.newIndexArray=function(k){return k<=b.NATIVE_ARRAY_MAX_SIZE?Array(k):65536>=k?new Uint16Array(k):new Uint32Array(k)};a.newIntArray=function(k){return k<=b.NATIVE_ARRAY_MAX_SIZE?Array(k):new Uint32Array(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,
y,p=!1,u=y){this.data=c;this.size=y;this.exclusive=p;this.stride=u});a.Attribute=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(c,y){const p=c[y],u=c[y+1];c=c[y+2];return Math.sqrt(p*p+u*u+c*c)};b.normalize=function(c,y){var p=c[y];const u=c[y+1],q=c[y+2];p=1/Math.sqrt(p*p+u*u+q*q);c[y]*=p;c[y+1]*=p;c[y+2]*=p};b.scale=function(c,y,p){c[y]*=
p;c[y+1]*=p;c[y+2]*=p};b.add=function(c,y,p,u,q,k=y){q=q||c;q[k]=c[y]+p[u];q[k+1]=c[y+1]+p[u+1];q[k+2]=c[y+2]+p[u+2]};b.subtract=function(c,y,p,u,q,k=y){q=q||c;q[k]=c[y]-p[u];q[k+1]=c[y+1]-p[u+1];q[k+2]=c[y+2]-p[u+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=
0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){d=function(l){function m(w,r,x=[],D=null,A=f.ContentObjectType.Mesh,v=null,B=-1){var C=l.call(this)||this;C.material=w;C.mapPositions=D;C.type=A;C.objectAndLayerIdColor=v;C.edgeIndicesLength=B;C.visible=!0;C._vertexAttributes=new Map;C._indices=new Map;C._boundingInfo=null;for(const [E,F]of r)F&&C._vertexAttributes.set(E,{...F});if(null==x||0===x.length){w=C._vertexAttributes.values().next().value;w=null==w?0:w.data.length/w.size;r=p.getContinuousIndexArray(w);
C.edgeIndicesLength=0>C.edgeIndicesLength?w:C.edgeIndicesLength;for(const E of C._vertexAttributes.keys())C._indices.set(E,r)}else for(const [E,F]of x)F&&(C._indices.set(E,p.compactIndices(F)),E===z.VertexAttribute.POSITION&&(C.edgeIndicesLength=0>C.edgeIndicesLength?C._indices.get(E).length:C.edgeIndicesLength));return C}b._inherits(m,l);var t=m.prototype;t.instantiate=function(w={}){const r=new m(w.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);
this._vertexAttributes.forEach((x,D)=>{x.exclusive=!1;r._vertexAttributes.set(D,x)});this._indices.forEach((x,D)=>r._indices.set(D,x));r._boundingInfo=this._boundingInfo;r.transformation=w.transformation||this.transformation;return r};t.getMutableAttribute=function(w){let r=this._vertexAttributes.get(w);r&&!r.exclusive&&(r={...r,exclusive:!0,data:u.cloneAttributeData(r.data)},this._vertexAttributes.set(w,r));return r};t.setAttributeData=function(w,r){const x=this._vertexAttributes.get(w);x&&this._vertexAttributes.set(w,
{...x,exclusive:!0,data:r})};t.computeAttachmentOrigin=function(w){return(this.type===f.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(w):this.type===f.ContentObjectType.Line?this._computeAttachmentOriginLines(w):this._computeAttachmentOriginPoints(w))?(null!=this._transformation&&y.transformMat4(w,w,this._transformation),!0):!1};t._computeAttachmentOriginTriangles=function(w){const r=this.indices.get(z.VertexAttribute.POSITION),x=this.vertexAttributes.get(z.VertexAttribute.POSITION);
return g.computeAttachmentOriginTriangles(x,r,w)};t._computeAttachmentOriginLines=function(w){const r=this.vertexAttributes.get(z.VertexAttribute.POSITION),x=this.indices.get(z.VertexAttribute.POSITION);var D=g.computeAttachmentOriginLines,A;if(A=x)A=this.material.parameters,A="isClosed"in A&&A.isClosed?x?2<x.length:6<r.data.length:!1;return D.call(g,r,x,A,w)};t._computeAttachmentOriginPoints=function(w){const r=this.indices.get(z.VertexAttribute.POSITION),x=this.vertexAttributes.get(z.VertexAttribute.POSITION);
return g.computeAttachmentOriginPoints(x,r,w)};t.invalidateBoundingInfo=function(){this._boundingInfo=null};t._calculateBoundingInfo=function(){const w=this.indices.get(z.VertexAttribute.POSITION),r=this.vertexAttributes.get(z.VertexAttribute.POSITION);if(!w||0===w.length||!r)return null;const x=this.type===f.ContentObjectType.Mesh?3:1;h.assert(0===w.length%x,"Indexing error: "+w.length+" not divisible by "+x);const D=p.getContinuousIndexArray(w.length/x);return new k.BoundingInfo(D,x,w,r)};t.addHighlight=
function(){const w=new e.Object3DStateID(q.Object3DState.Highlight);this.highlights=n.addObject3DStateID(this.highlights,w);return w};t.removeHighlight=function(w){this.highlights=n.removeObject3DStateID(this.highlights,w)};b._createClass(m,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const w=this._indices.values().next().value;return w?w.length:0}},{key:"faceCount",get:function(){return this.indexCount/
3}},{key:"boundingInfo",get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}},{key:"transformation",get:function(){return this._transformation??c.IDENTITY},set:function(w){this._transformation=w&&w!==c.IDENTITY?c.clone(w):null}},{key:"shaderTransformation",get:function(){return null!=this._shaderTransformer?this._shaderTransformer(this.transformation):this.transformation}},{key:"shaderTransformer",get:function(){return this._shaderTransformer},
set:function(w){this._shaderTransformer=w}},{key:"hasVolatileTransformation",get:function(){return null!=this._shaderTransformer}}]);return m}(d.ContentObject);a.Geometry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(c){if(c.length<b.NATIVE_ARRAY_MAX_SIZE)return Array.from(c);if(b.isArray(c))return Float64Array.from(c);if(!("BYTES_PER_ELEMENT"in
c))return Array.from(c);switch(c.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(c);case 2:return b.isUint16Array(c)?Uint16Array.from(c):Int16Array.from(c);case 4:return Float32Array.from(c);default:case 8:return Float64Array.from(c)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Util".split(" "),
function(a,b,c,y,p,u){let q=function(){function d(f,g,e,h){this.primitiveIndices=f;this._numIndexPerPrimitive=g;this.indices=e;this.position=h;this._children=void 0;u.assert(1<=f.length);u.assert(0===e.length%this._numIndexPerPrimitive);u.assert(e.length>=f.length*this._numIndexPerPrimitive);u.assert(3===h.size||4===h.size);const {data:z,size:n}=h;var l=f.length;g=n*e[this._numIndexPerPrimitive*f[0]];k.clear();k.push(g);h=p.fromValues(z[g],z[g+1],z[g+2]);var m=p.clone(h);for(var t=0;t<l;++t){var w=
this._numIndexPerPrimitive*f[t];for(let r=0;r<this._numIndexPerPrimitive;++r){g=n*e[w+r];k.push(g);let x=z[g];h[0]=Math.min(x,h[0]);m[0]=Math.max(x,m[0]);x=z[g+1];h[1]=Math.min(x,h[1]);m[1]=Math.max(x,m[1]);x=z[g+2];h[2]=Math.min(x,h[2]);m[2]=Math.max(x,m[2])}}this.bbMin=h;this.bbMax=m;f=y.lerp(p.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(m[0]-h[0],m[1]-h[1]),m[2]-h[2]);e=this.radius*this.radius;for(h=0;h<k.length;++h)g=k.at(h),m=z[g]-f[0],l=z[g+1]-f[1],g=z[g+2]-f[2],t=m*
m+l*l+g*g,t<=e||(t=Math.sqrt(t),w=.5*(t-this.radius),this.radius+=w,e=this.radius*this.radius,t=w/t,f[0]+=m*t,f[1]+=l*t,f[2]+=g*t);this.center=f;k.clear()}d.prototype.getChildren=function(){if(this._children||1>=y.squaredDistance(this.bbMin,this.bbMax))return this._children;var f=y.lerp(p.create(),this.bbMin,this.bbMax,.5),g=this.primitiveIndices.length;const e=new Uint8Array(g),h=Array(8);for(var z=0;8>z;++z)h[z]=0;const {data:n,size:l}=this.position;for(z=0;z<g;++z){var m=0;const w=this._numIndexPerPrimitive*
this.primitiveIndices[z];var t=l*this.indices[w];let r=n[t],x=n[t+1],D=n[t+2];for(let A=1;A<this._numIndexPerPrimitive;++A){t=l*this.indices[w+A];const v=n[t],B=n[t+1];t=n[t+2];v<r&&(r=v);B<x&&(x=B);t<D&&(D=t)}r<f[0]&&(m|=1);x<f[1]&&(m|=2);D<f[2]&&(m|=4);e[z]=m;++h[m]}f=0;for(z=0;8>z;++z)0<h[z]&&++f;if(!(2>f)){f=Array(8);for(z=0;8>z;++z)f[z]=0<h[z]?new Uint32Array(h[z]):void 0;for(z=0;8>z;++z)h[z]=0;for(z=0;z<g;++z)m=e[z],f[m][h[m]++]=this.primitiveIndices[z];this._children=[];for(g=0;8>g;++g)void 0!==
f[g]&&this._children.push(new d(f[g],this._numIndexPerPrimitive,this.indices,this.position));return this._children}};d.prune=function(){k.prune()};return b._createClass(d)}();const k=new c({deallocator:null});a.BoundingInfo=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/uid"],function(a,b,c){let y=function(){function p(){this.id=c.generateUID()}
p.prototype.unload=function(){};return b._createClass(p)}();a.ContentObject=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,b,c,y){const p=c.create(),u=c.create(),q=c.create(),k=c.create();a.computeAttachmentOriginLines=function(d,f,g,e){if(!d)return!1;b.set(e,0,0,0);b.set(k,0,0,0);let h=0,z=0;const {size:n,
data:l}=d;d=f?f.length-1:l.length/n-1;g=d+(g?2:0);for(let w=0;w<g;w+=2){var m=w<d?w:d,t=w<d?w+1:0;m=(f?f[m]:m)*n;t=(f?f[t]:t)*n;p[0]=l[m];p[1]=l[m+1];p[2]=l[m+2];u[0]=l[t];u[1]=l[t+1];u[2]=l[t+2];b.scale(p,b.add(p,p,u),.5);t=b.dist(p,u);0<t?(b.add(e,e,b.scale(p,p,t)),h+=t):0===h&&(b.add(k,k,p),z++)}return 0!==h?(b.scale(e,e,1/h),!0):0!==z?(b.scale(e,k,1/z),!0):!1};a.computeAttachmentOriginPoints=function(d,f,g){if(!d||!f)return!1;const {size:e,data:h}=d;b.set(g,0,0,0);d=-1;let z=0;for(let n=0;n<f.length;n++){const l=
f[n]*e;d!==l&&(g[0]+=h[l],g[1]+=h[l+1],g[2]+=h[l+2],z++);d=l}1<z&&b.scale(g,g,1/z);return 0<z};a.computeAttachmentOriginTriangles=function(d,f,g){if(!d||!f)return!1;const {size:e,data:h}=d;b.set(g,0,0,0);b.set(k,0,0,0);let z=d=0;for(let l=0;l<f.length-2;l+=3){var n=f[l]*e;const m=f[l+1]*e,t=f[l+2]*e;b.set(p,h[n],h[n+1],h[n+2]);b.set(u,h[m],h[m+1],h[m+2]);b.set(q,h[t],h[t+1],h[t+2]);(n=y.areaPoints3d(p,u,q))?(b.add(p,p,u),b.add(p,p,q),b.scale(p,p,1/3*n),b.add(g,g,p),d+=n):(b.add(k,k,p),b.add(k,k,u),
b.add(k,k,q),z+=3)}return 0===z&&0===d?!1:0!==d?(b.scale(g,g,1/d),!0):0!==z?(b.scale(g,k,1/z),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,y,p,u){function q(z){return z?{p0:y.clone(z.p0),p1:y.clone(z.p1),p2:y.clone(z.p2)}:{p0:y.create(),p1:y.create(),p2:y.create()}}function k(z,n,l,m=q()){c.copy(m.p0,
z);c.copy(m.p1,n);c.copy(m.p2,l);return m}function d(z,n,l){return.5*Math.abs((n[0]-z[0])*(l[1]-z[1])-(n[1]-z[1])*(l[0]-z[0]))}const f=new b.ObjectStack(p.create),g=new b.ObjectStack(()=>q()),e=y.create(),h=y.create();a.area2d=function(z){return d(z.p0,z.p1,z.p2)};a.areaPoints2d=d;a.areaPoints3d=function(z,n,l){c.subtract(e,n,z);c.subtract(h,l,z);return c.length(c.cross(e,e,h))/2};a.copy=function(z,n=q()){return k(z.p0,z.p1,z.p2,n)};a.create=q;a.distance2=function(z,n){var l=z.p0,m=z.p1;z=z.p2;const t=
c.subtract(u.sv3d.get(),m,l),w=c.subtract(u.sv3d.get(),z,m),r=c.subtract(u.sv3d.get(),l,z),x=c.subtract(u.sv3d.get(),n,l);var D=c.subtract(u.sv3d.get(),n,m),A=c.subtract(u.sv3d.get(),n,z);const v=c.cross(t,t,r),B=c.dot(c.cross(u.sv3d.get(),t,v),x);D=c.dot(c.cross(u.sv3d.get(),w,v),D);A=c.dot(c.cross(u.sv3d.get(),r,v),A);if(0<B&&0<D&&0<A)return n=c.dot(v,x),n*n/c.dot(v,v);l=p.distance2(p.fromValues(l,t,f.get()),n);m=p.distance2(p.fromValues(m,w,f.get()),n);n=p.distance2(p.fromValues(z,r,f.get()),n);
return Math.min(l,m,n)};a.fromValues=k;a.intersectRay=function(z,n,l){const {direction:m,origin:t}=n,{p0:w,p1:r,p2:x}=z;var D=r[0]-w[0],A=r[1]-w[1],v=r[2]-w[2];z=x[0]-w[0];n=x[1]-w[1];const B=x[2]-w[2];var C=m[1]*B-n*m[2],E=m[2]*z-B*m[0];const F=m[0]*n-z*m[1];var M=D*C+A*E+v*F;if(-1E-5<M&&1E-5>M)return!1;M=1/M;const K=t[0]-w[0],G=t[1]-w[1],L=t[2]-w[2];C=M*(K*C+G*E+L*F);if(0>C||1<C)return!1;E=G*v-A*L;v=L*D-v*K;D=K*A-D*G;A=M*(m[0]*E+m[1]*v+m[2]*D);if(0>A||1<C+A)return!1;l&&(c.scale(l,m,M*(z*E+n*v+B*
D)),c.add(l,t,l));return!0};a.wrap=function(z,n,l){const m=g.get();m.p0=z;m.p1=n;m.p2=l;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/uid"],function(a,b,c){b=b._createClass(function(y){this.channel=y;this.id=c.generateUID()});a.Object3DStateID=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports",
"../../../../../chunks/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,b,c){const y=b.create(),p=new Float32Array(6);a.addObject3DStateID=function(u,q){null==u&&(u=[]);u.push(q);return u};a.encodeDoubleVec3=function(u,q,k,d,f){y[0]=u.get(q,0);y[1]=u.get(q,1);y[2]=u.get(q,2);c.encodeDoubleArray(y,p,3);k.set(f,0,p[0]);d.set(f,0,p[1]);k.set(f,1,p[2]);d.set(f,1,p[3]);k.set(f,2,p[4]);d.set(f,2,p[5])};a.removeObject3DStateID=function(u,q){if(null==u)return null;u=u.filter(k=>k!==q);return 0===
u.length?null:u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(c,y,p){for(let u=0;u<p;++u)y[u]=c[2*u]+c[2*u+1]};a.encodeDoubleArray=function(c,y,p){for(let u=0;u<p;++u)y[2*u]=c[u],y[2*u+1]=c[u]-y[2*u]};a.encodeDoubleHi=function(c,y){const p=c.length;for(let u=0;u<p;++u)b[0]=c[u],y[u]=b[0];return y};a.encodeDoubleLo=function(c,y){const p=c.length;
for(let u=0;u<p;++u)b[0]=c[u],b[1]=c[u]-b[0],y[u]=b[1];return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){function G(R,W,T,P,Q){const S=k.length(R),U=P*Math.sqrt(S*S-P*P)/S,V=Q.v1,X=Q.v2;k.scale(Q.center,R,Math.sqrt(P*P-U*U)/S);k.cross(V,R,W);1>k.squaredLength(V)&&k.cross(V,R,T);k.scale(V,V,U/k.length(V));k.cross(X,V,R);k.scale(X,X,U/k.length(X));return U}const L=-h.innerAtmosphereDepth,O=t.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);t=function(){function R(T,P){this.view=T;this.type=e.AtmosphereType.Mars;
this._passParameters=new z.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;T=f.getReferenceEllipsoid(T.spatialReference);this._planetRadius=T.radius;this._outerRimWidth=T.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+L)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=this._texV1-this._texV0;this._techniqueRepository=
P.techniqueRepository;T=P.renderContext.rctx;this._cameraChangeHandle=y.watch(()=>this.view.state?.camera,()=>P.requestRender(),y.syncAndInitial);this._vao=this._createRibbon(T);this._vaoCount=K.vertexCount(this._vao,"geometry");this._fadeVao=D.createQuadVAO(T);this._fadeVaoCount=K.vertexCount(this._fadeVao,"geometry");const Q=new M.TextureDescriptor;Q.wrapMode=E.TextureWrapMode.CLAMP_TO_EDGE;Q.flipped=!0;Q.width=1;Q.height=512;this._passParameters.texture=new F.Texture(T,Q,m.marsAtmosphereTextureSimple);
T=new l.SimpleAtmosphereTechniqueConfiguration;T.geometry=l.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(n.SimpleAtmosphereTechnique,T);T.geometry=l.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(n.SimpleAtmosphereTechnique,T)}var W=R.prototype;W.destroy=function(){this._coneTechnique.release();this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);
this._fadeVao.dispose();this._vao.dispose()};W.render=function(T){this._update(T.bindParameters.camera);const P=T.rctx;1>this._passParameters.undergroundFadeAlpha&&(P.bindTechnique(this._coneTechnique,this._passParameters,T.bindParameters),P.bindVAO(this._vao),P.drawArrays(E.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(P.bindTechnique(this._undergroundTechnique,this._passParameters,T.bindParameters),P.bindVAO(this._fadeVao),P.drawArrays(E.PrimitiveType.TRIANGLE_STRIP,
0,this._fadeVaoCount))};W.renderHaze=function(){};W._update=function(T){var P=d.create();const Q=this._planetRadius;var S=k.length(T.eye);const U=S-Q;this._passParameters.undergroundFadeAlpha=0>U?Math.min(-U/5E3,1):0;var V=Q+L,X=Q+Math.max(50,U);this._passParameters.innerScale=X*X/(Math.sqrt(X*X-Q*Q)*Math.sqrt(X*X-V*V)+Q*V)-1;this._passParameters.altitudeFade=h.computeInnerAltitudeFade(U);k.scale(P,T.eye,(Q+50)/S);G(P,T.center,T.up,Q,this._passParameters.silhouette);P=this._computeScreenRimWidth(T,
P,T.up,this._passParameters.silhouette);S=O(U);V=this._texV0+.001953125*this._texVScale;X=this._texV0+P*S*this._texVScale;50<U&&(G(T.eye,T.center,T.up,Q,this._passParameters.silhouette),T=this._computeScreenRimWidth(T,T.eye,T.up,this._passParameters.silhouette),T=b.clamp((T-1.5)/(P-1.5),0,1),V=this._texV0+.001953125*T*this._texVScale,X=this._texV0+b.lerp(this._texV1,P*S,T)*this._texVScale);q.set(this._passParameters.texV,V,X)};W._createRibbon=function(T){const P=g.newFloatArray(1155),Q=new Uint32Array(1920);
P[0]=0;P[1]=0;P[2]=-1;for(var S=0;128>S;S++){var U=9*S+3;P[U]=S;P[U+1]=this._innerRimFactor;P[U+2]=-1;P[U+3]=S;P[U+4]=this._middleRimFactor;P[U+5]=0;P[U+6]=S;P[U+7]=this._outerRimFactor;P[U+8]=1;U=3*S+1;var V=127===S?1:U+3,X=15*S;Q[X]=U;Q[X+1]=U+1;Q[X+2]=V+1;Q[X+3]=V+1;Q[X+4]=V;Q[X+5]=U;Q[X+6]=U+1;Q[X+7]=U+2;Q[X+8]=V+2;Q[X+9]=V+2;Q[X+10]=V+1;Q[X+11]=U+1;Q[X+12]=U;Q[X+13]=V;Q[X+14]=0}S=N.createBuffer(Q.length);U=S.position;for(V=0;V<Q.length;++V)X=3*Q[V],U.set(V,0,P[X]),U.set(V,1,P[X+1]),U.set(V,2,
P[X+2]);return new v.VertexArrayObject(T,x.Default3D,{geometry:w.glLayout(N)},{geometry:C.BufferObject.createVertex(T,E.Usage.STATIC_DRAW,S.buffer)})};W._computeScreenRimWidth=function(T,P,Q,S){k.add(H,S.center,S.v2);k.scale(J,H,this._outerRimFactor);p.lookAt(I,P,H,Q);A.project(H,I,T.projectionMatrix,T.viewport,H);A.project(J,I,T.projectionMatrix,T.viewport,J);return k.distance(H,J)/T.height};return a._createClass(R)}();const I=u.create(),H=d.create(),J=d.create(),N=r.newLayout().vec3f(B.VertexAttribute.POSITION);
return t})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,
0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,
37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,
4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,
8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,
11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,
45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,
152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,
38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,
128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,
170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,
214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,
227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){a.Precipitation=function(E){function F(K){var G=E.call(this,K)||this;G._numParticles=25E4;G._rainSpeed=.1;G._snowSpeed=.01;G._passParameters=new n.PrecipitationPassParameters;G._animation=new w.AnimationTimer;G._updatingTracking=new h.WatchUpdatingTracking;G._passParameters.time=0;G._passParameters.radius=z.getReferenceEllipsoid(K.view.spatialReference).radius;G._techniqueRepository=K.context.techniqueRepository;return G}b._inherits(F,E);var M=
F.prototype;M.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechniqueCached=u.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=u.releaseMaybe(this._rainTechniqueCached);this._vao=u.disposeMaybe(this._vao);this._instanceIdBuffer=u.disposeMaybe(this._instanceIdBuffer)};M.update=function(K){return this._animation.advance(K)};M.render=function(K,G,L){const O="rainy"===L?this._rainTechnique:this._snowTechnique;if(O.compiled){var I=K.rctx;this._ensureResources(I);
null!=O&&null!=this._vao&&null!=this._instanceIdBuffer&&(null!=K.bindParameters.cloudsFade.data&&(this._passParameters.opacity=1-K.bindParameters.cloudsFade.fadeInOutHeight.factor),0>=this._passParameters.opacity||(G=.5>G?p.lerp(0,.35,2*G):p.lerp(.35,1,2*(G-.5)),this._passParameters.time=("rainy"===L?this._rainSpeed:this._snowSpeed)*q.secondsFromMilliseconds(this._animation.time)%1E5,K=I.bindTechnique(O,this._passParameters,K.bindParameters),I.bindVAO(this._vao),K.assertCompatibleVertexAttributeLocations(this._vao),
v.bindVertexBufferLayout(I,n.attributeLocations,this._instanceIdBuffer,C,0),I.capabilities.instancing?.drawArraysInstanced(A.PrimitiveType.TRIANGLES,0,3,this._numParticles*G),v.unbindVertexBufferLayout(I,n.attributeLocations,this._instanceIdBuffer,C)))}else this.context.requestRender()};M._ensureResources=function(K){null==this._vao&&(this._vao=this._createVertexArrayObject(K));null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(K))};M._createInstanceIndices=function(K){const G=
[];for(let L=0;L<this._numParticles;L++)G.push(L);return D.BufferObject.createVertex(K,A.Usage.STATIC_DRAW,new Float32Array(G))};M._createVertexArrayObject=function(K){const G=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new r.VertexArrayObject(K,n.attributeLocations,{geometry:m.glLayout(B)},{geometry:D.BufferObject.createVertex(K,A.Usage.STATIC_DRAW,G)})};b._createClass(F,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"_rainTechnique",get:function(){if(null==this._rainTechniqueCached){const K=
new l.PrecipitationTechniqueConfiguration;K.type=l.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(n.PrecipitationTechnique,K)}return this._rainTechniqueCached}},{key:"_snowTechnique",get:function(){if(null==this._snowTechniqueCached){const K=new l.PrecipitationTechniqueConfiguration;K.type=l.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(n.PrecipitationTechnique,K)}return this._snowTechniqueCached}}]);return F}(y);c.__decorate([k.property({constructOnly:!0})],
a.Precipitation.prototype,"context",void 0);c.__decorate([k.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([k.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);c.__decorate([k.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([e.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const B=t.newLayout().vec3f(x.VertexAttribute.POSITION),C=m.glLayout(t.newLayout().f32(x.VertexAttribute.INSTANCEFEATUREATTRIBUTE),
1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){p=function(h){function z(){var n=h.apply(this,arguments)||this;n.time=0;n.radius=1;n.width=500;n.opacity=1;return n}c._inherits(z,h);return c._createClass(z)}(p.NoParameters);q=function(h){function z(){return h.apply(this,arguments)||this}c._inherits(z,h);var n=z.prototype;n.initializeProgram=function(l){return new k.Program(l.rctx,z.shader.get().build(this.configuration),e)};n.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};return c._createClass(z)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(y.Precipitation,()=>new Promise((h,z)=>a(["./Precipitation.glsl"],h,z)));const e=new Map([[d.VertexAttribute.POSITION,0],[d.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=p;b.PrecipitationTechnique=q;b.attributeLocations=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f){function g(l){const m=new d.ShaderBuilder;m.attributes.add(f.VertexAttribute.POSITION,"vec3");m.attributes.add(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");m.vertex.uniforms.add(new p.Float3PassUniform("cameraPosition",(t,w)=>w.camera.eye));m.vertex.uniforms.add(new p.Float3PassUniform("offset",(t,w)=>{w=w.camera.eye;var r=.5*t.width;const x=1/t.width;r=b.floor(e,b.set(e,(w[0]+r)*x,(w[1]+r)*x,(w[2]+r)*x));return b.sub(r,w,b.scale(r,r,t.width))}));m.vertex.uniforms.add(new u.FloatPassUniform("width",
t=>t.width));m.vertex.uniforms.add(new k.Matrix4PassUniform("proj",(t,w)=>w.camera.projectionMatrix));m.vertex.uniforms.add(new k.Matrix4PassUniform("view",(t,w)=>w.camera.viewMatrix));m.vertex.uniforms.add(new u.FloatPassUniform("time",t=>t.time));m.varyings.add("vUv","vec2");m.vertex.code.add(q.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${l.type===y.PrecipitationType.Rain?q.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:q.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);m.fragment.uniforms.add(new u.FloatPassUniform("opacity",t=>t.opacity),new p.Float3PassUniform("particleColor",(t,w)=>{t=l.type===y.PrecipitationType.Rain?n:z;const r=b.scale(e,t,.7);b.normalize(h,w.camera.eye);w=Math.max(0,b.dot(h,w.lighting.mainLight.direction));return b.lerp(r,r,t,w)}));m.fragment.code.add(q.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${l.type===y.PrecipitationType.Rain?q.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:q.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return m}const e=c.create(),h=c.create(),z=c.fromValues(1,1,1),n=c.fromValues(.85,.85,.85);c=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.Precipitation=c;a.build=g})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){a.PrecipitationType=void 0;
(function(u){u[u.Rain=0]="Rain";u[u.Snow=1]="Snow";u[u.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.type=a.PrecipitationType.Rain;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter({count:a.PrecipitationType.COUNT})],p.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/time"],function(a,b,c){let y=function(){function u(){this.enabled=!0;this._time=c.Milliseconds(0)}u.prototype.advance=function({deltaTime:q,fixedTime:k}){if(null!=k){if(this._time===k)return!1;this._time=k;return!0}this._time=c.Milliseconds(this._time+q);return 0!==q};b._createClass(u,[{key:"time",get:function(){return this._time}}]);return u}(),p=b._createClass(function(u,q){this.deltaTime=u;this.fixedTime=q});a.AnimationTimer=y;a.Parameters=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E){a.Stars=function(O){function I(J){J=O.call(this,J)||this;J._loadDataTask=null;J._numPoints=0;J._renderParameter=new r.StarPassParameters;J._updatingTracking=new w.WatchUpdatingTracking;return J}b._inherits(I,O);var H=I.prototype;H.initialize=function(){this._loadDataTask=this._createLoadDataTask()};H.destroy=function(){this._loadDataTask=d.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();this._numPoints=0;this._technique=
d.releaseMaybe(this._technique);this._vao=d.disposeMaybe(this._vao);L=null};H.render=function(J){const {rctx:N}=J;this._ensureResources(N);null!=this._technique&&null!=this._vao&&(this._technique.compiled?(J=N.bindTechnique(this._technique,this._renderParameter,J.bindParameters),N.bindVAO(this._vao),J.assertCompatibleVertexAttributeLocations(this._vao),N.drawArrays(E.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};H._ensureResources=function(J){if(null==this._technique&&null!=L){this._technique=
new r.StarsTechnique({rctx:J,viewingMode:this.view.state.viewingMode});this._numPoints=L.byteLength/9;var N=new Float32Array(L,0,2*this._numPoints),R=new Uint8Array(L,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(J,N,R,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,W=>this._update(W),g.initial)}};H._computeDayDuration=function(J){const N=new Date(J.getFullYear(),0,1,11,58,56),R=new Date(J.getFullYear()+
1,0,1,11,58,55);return(+J-+N)/(+R-+N)};H._update=function(J){if(J){var N=J.getHours()/12,R=J.getMinutes()/60*(2/24),W=J.getSeconds()/60*(2/1440);N=(N+R+W-.9972222)%2;J=2*this._computeDayDuration(J);R=m.copy(this._renderParameter.modelMatrix,K);m.rotateZ(R,R,-J*Math.PI);m.multiply(R,M,R);m.rotateZ(R,R,-N*Math.PI);this.requestRender()}};H._hexToRGB=function(J){return[parseInt(J.substring(0,2),16),parseInt(J.substring(2,4),16),parseInt(J.substring(4,6),16)]};H._unpackUint8Attributes=function(J){return 192<=
J?[2.9,J-192]:160<=J?[2.5,J-160]:128<=J?[2,J-128]:96<=J?[1.5,J-96]:64<=J?[1,J-64]:32<=J?[.7,J-32]:[.4,J]};H._createVertexArrayObject=function(J,N,R,W){const T=G.createBuffer(W),P=T.position,Q=T.color,S=T.size;for(let X=0;X<W;X++){var U=N[2*X],V=N[2*X+1];P.set(X,0,-Math.cos(U)*Math.sin(V));P.set(X,1,-Math.sin(U)*Math.sin(V));P.set(X,2,-Math.cos(V));U=this._unpackUint8Attributes(R[X]);V=this._hexToRGB(F[U[1]]);Q.set(X,0,255*V[0]);Q.set(X,1,255*V[1]);Q.set(X,2,255*V[2]);Q.set(X,3,255);S.set(X,U[0])}return new v.VertexArrayObject(J,
A.Default3D,{geometry:x.glLayout(G)},{geometry:C.BufferObject.createVertex(J,E.Usage.STATIC_DRAW,T.buffer)})};H._createLoadDataTask=function(){if(null!=L)return null;const J=u.createTask(async N=>{({data:N}=await y.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:N}));this._verifyStarData(N);L=N});J.promise.catch(N=>{f.isAbortError(N)||k.getLogger(this).error(N)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return J};
H._verifyStarData=function(J){if(!J)throw new q("stars:no-data-received","Failed to create stars because star catalogue is missing");J=J.byteLength/9;if(0!==J%1||5E4<J||5E3>J)throw new q("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(I,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return null!=this._loadDataTask&&!this._loadDataTask.finished}}]);return I}(p);c.__decorate([e.property({constructOnly:!0})],
a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=c.__decorate([l.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
M=t.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),K=t.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),G=D.newLayout().vec3f(B.VertexAttribute.POSITION).vec4u8(B.VertexAttribute.COLOR).f32(B.VertexAttribute.SIZE);let L=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){u=function(z){function n(){var l=z.apply(this,arguments)||this;l.modelMatrix=y.create();return l}c._inherits(n,z);return c._createClass(n)}(u.NoParameters);k=function(z){function n(m){var t;return t=z.call(this,m,new d.ShaderTechniqueConfiguration,()=>t.destroy())||this}c._inherits(n,z);var l=n.prototype;l.initializeProgram=function(m){return new g.Program(m.rctx,n.shader.get().build(),f.Default3D)};l.initializePipeline=function(){return h.makePipelineState({blending:h.separateBlendingParams(e.BlendFactor.SRC_ALPHA,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:h.defaultColorWriteParams})};return c._createClass(n)}(k.ShaderTechnique);k.shader=new q.ReloadableShaderModule(p.Stars,()=>new Promise((z,n)=>a(["./Stars.glsl"],z,n)));b.StarPassParameters=u;b.StarsTechnique=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(){const e=new k.ShaderBuilder;e.attributes.add(d.VertexAttribute.POSITION,"vec3");e.attributes.add(d.VertexAttribute.COLOR,"vec4");e.attributes.add(d.VertexAttribute.SIZE,"float");e.varyings.add("vcolor","vec4");e.varyings.add("vsize","float");e.vertex.uniforms.add(new q.Matrix4PassUniform("transform",(h,z)=>{b.copy(g,z.camera.projectionMatrix);g[10]=2.4E-7-1;g[11]=-1;g[14]=(2.4E-7-2)*z.camera.near;b.multiply(g,g,z.camera.viewMatrix);return b.multiply(g,g,h.modelMatrix)}),
new y.Float4PassUniform("viewport",(h,z)=>z.camera.fullViewport),new p.FloatPassUniform("pixelRatio",(h,z)=>z.camera.pixelRatio));e.vertex.code.add(u.glsl`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);e.fragment.code.add(u.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return e}const g=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.Stars=c;a.build=f})},"esri/views/3d/environment/weatherUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsCompositionParameters ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(t,w,r,x){const D=t.fadeInOutHeight,A=D.stage===d.FadeHeightStages.FINISHED?r:t.startTimeHeightFade;0!==x?(x=(r-A)/(1*x),D.factor+=w?-x:x):D.factor=w?0:1;t.startTimeHeightFade=r;D.factor=b.clamp(D.factor,0,1);D.stage=d.FadeHeightStages.HEIGHT_FADE}const z=p.fromValues(0,0,1),n=q.create(),l=p.create(),m=p.create();a.updateWeatherFading=function(t,w,r,x,D){t.renderingStage===f.CloudsRenderingStages.FINISHED_RENDERING&&(t.renderingStage=f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS);
const A=y.length(w.eye);0>t.fadeInOutHeight.factor&&(t.fadeInOutHeight.factor=A-k.earth.radius>g.weatherHeightLimit?1:0);t.isCameraPositionFinal=y.equals(t.cameraPositionLastFrame,w.eye);y.normalize(l,w.eye);y.scale(l,l,k.earth.radius);const v=t.parallax;0===v.anchorPointClouds[0]&&0===v.anchorPointClouds[1]&&0===v.anchorPointClouds[2]&&y.copy(v.anchorPointClouds,l);var B=y.length(y.subtract(m,v.anchorPointClouds,l));let C=!0;if(B>t.fadeIn.distanceThresholdFactor*v.cloudsHeight||t.fadeIn.stage!==
d.FadeInStages.FINISHED)r=t.parallax.anchorPointClouds,t.fadeIn.stage===d.FadeInStages.FINISHED&&(t.fadeIn.factor=0,y.copy(r,l),t.fadeIn.stage=d.FadeInStages.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=d.FadeInOutStages.FINISHED),t.fadeIn.stage===d.FadeInStages.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(f.ensureClouds(t.data)&&t.renderingStage!==f.CloudsRenderingStages.RENDERING||t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(y.copy(r,l),t.fadeIn.stage=d.FadeInStages.FADE_IN,
t.startTime=x,t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(t.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS)),1>t.fadeIn.factor&&t.fadeIn.stage===d.FadeInStages.FADE_IN?t.fadeIn.factor=D?b.clamp((x-t.startTime)/(1*D),0,1):1:1<=t.fadeIn.factor&&t.fadeIn.stage===d.FadeInStages.FADE_IN&&(t.fadeIn.stage=d.FadeInStages.FINISHED,t.fadeIn.factor=1);else if(B>t.fadeInOut.distanceThresholdFactor*v.cloudsHeight||t.fadeInOut.stage!==d.FadeInOutStages.FINISHED){{const {fadeInOut:E,
crossFade:F}=t;E.stage===d.FadeInOutStages.FINISHED&&(t.startTime=x,E.factor=1,E.stage=d.FadeInOutStages.FADE_OUT);0<E.factor&&E.stage===d.FadeInOutStages.FADE_OUT?E.factor=D?1-b.clamp((x-t.startTime)/(.5*D),0,1):0:(0>=E.factor&&E.stage===d.FadeInOutStages.FADE_OUT&&(E.factor=0,y.copy(t.parallax.anchorPointClouds,l)),0>=E.factor&&E.stage===d.FadeInOutStages.FADE_OUT&&t.isCameraPositionFinal&&(E.factor=0,E.stage=d.FadeInOutStages.SWITCH,t.crossFade.enabled=!1,F.factor=1),E.stage===d.FadeInOutStages.SWITCH&&
(f.ensureClouds(t.data)&&t.renderingStage!==f.CloudsRenderingStages.RENDERING||t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(t.startTime=x,E.factor=0,E.stage=d.FadeInOutStages.FADE_IN,y.copy(t.parallax.anchorPointClouds,l),t.crossFade.enabled=!1,F.factor=1,t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(t.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS)),1>E.factor&&E.stage===d.FadeInOutStages.FADE_IN?E.factor=D?b.clamp((x-t.startTime)/(1*D),0,1):
1:1<=E.factor&&E.stage===d.FadeInOutStages.FADE_IN&&(E.stage=d.FadeInOutStages.FINISHED,E.factor=1))}}else if(B>t.crossFade.distanceThresholdFactor*v.cloudsHeight||t.crossFade.enabled||t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS){r=(r!==e.RenderState.IDLE||!f.ensureClouds(t.data))&&t.renderingStage!==f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS;{({crossFade:B}=t);const E=t.parallax.anchorPointClouds;if(!t.crossFade.enabled||r)y.copy(t.parallaxNew.anchorPointClouds,l),t.startTime=
x,B.factor=0,t.crossFade.enabled=!0;1>B.factor&&t.crossFade.enabled?B.factor=D?b.clamp((x-t.startTime)/(1.3*D),0,1):1:1<=B.factor&&t.crossFade.enabled&&(t.crossFade.enabled=!1,B.factor=1,y.copy(E,t.parallaxNew.anchorPointClouds),t.renderingStage===f.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(t.renderingStage=f.CloudsRenderingStages.SWITCH_CHANNELS))}}else C=!1;r=A-k.earth.radius;(r>1.7*g.weatherHeightLimit||r<-g.weatherHeightLimit)&&1>t.fadeInOutHeight.factor?t.fadeInOutHeight.factor=1:(r>g.weatherHeightLimit||
r<-.35*g.weatherHeightLimit)&&1>t.fadeInOutHeight.factor?h(t,!1,x,D):r<g.weatherHeightLimit&&r>-.35*g.weatherHeightLimit&&0<t.fadeInOutHeight.factor?h(t,!0,x,D):t.fadeInOutHeight.stage=d.FadeHeightStages.FINISHED;t.renderingStage===f.CloudsRenderingStages.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=f.CloudsRenderingStages.FINISHED);v.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(A*A-k.earth.radius*k.earth.radius,0))/A;q.fromPoints(z,v.anchorPointClouds,n);c.rotate(v.transform,
u.IDENTITY,n[3],q.axis(n));C&&({parallaxNew:x}=t,q.fromPoints(z,x.anchorPointClouds,n),c.rotate(x.transform,u.IDENTITY,n[3],q.axis(n)));y.copy(t.cameraPositionLastFrame,w.eye)};a.weatherFadingNeedsRender=function(t){return t.crossFade.enabled||t.fadeInOut.stage!==d.FadeInOutStages.FINISHED||t.fadeIn.stage!==d.FadeInStages.FINISHED||t.fadeInOutHeight.stage!==d.FadeHeightStages.FINISHED||t.renderingStage!==f.CloudsRenderingStages.FINISHED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/axisAngleDegrees":function(){define("exports ../../core/mathUtils ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64".split(" "),function(a,b,c,y,p,u){function q(r=h){return[r[0],r[1],r[2],r[3]]}function k(r,x,D,A,v=q()){v[0]=r;v[1]=x;v[2]=D;v[3]=A;return v}function d(r,x,D=q()){p.copy(D,r);D[3]=x;return D}function f(r,x,D=q()){c.setAxisAngle(z,r,g(r));c.setAxisAngle(n,x,g(x));c.multiply(z,n,z);return e(D,b.rad2deg(c.getAxisAngle(D,z)))}function g(r){return b.deg2rad(r[3])}
function e(r,x){r[3]=x;return r}const h=[0,0,1,0],z=y.create(),n=y.create(),l=q(),m=q(),t=q(),w=q();a.UP=h;a.angle=function(r){return r[3]};a.angleRad=g;a.axis=function(r){return r};a.compose=f;a.composeAxes=function(r,x,D,A=q()){d(u.UNIT_X,r,m);d(u.UNIT_Y,x,t);d(u.UNIT_Z,D,w);f(m,t,m);f(m,w,A);return A};a.copy=function(r,x=q()){return k(r[0],r[1],r[2],r[3],x)};a.create=q;a.fromAxisAndAngle=d;a.fromPoints=function(r,x,D=q()){p.cross(D,r,x);p.normalize(D,D);D[3]=-p.angle(r,x);return D};a.fromValues=
k;a.setAngle=e;a.wrap=function(r,x,D,A){return k(r,x,D,A,l)};a.wrapAxisAngle=function(r,x){return k(r[0],r[1],r[2],x,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,b,c,y,p,u,q){function k(Q){Q[0]=0;Q[1]=0;Q[2]=0;Q[3]=1;return Q}function d(Q,S,U){U*=.5;const V=Math.sin(U);Q[0]=V*S[0];Q[1]=V*S[1];Q[2]=V*S[2];Q[3]=Math.cos(U);return Q}function f(Q,S){const U=
2*Math.acos(S[3]),V=Math.sin(U/2);V>p.getEpsilon()?(Q[0]=S[0]/V,Q[1]=S[1]/V,Q[2]=S[2]/V):(Q[0]=1,Q[1]=0,Q[2]=0);return U}function g(Q,S,U){const V=S[0],X=S[1],Y=S[2];S=S[3];const Z=U[0],ea=U[1],ja=U[2];U=U[3];Q[0]=V*U+S*Z+X*ja-Y*ea;Q[1]=X*U+S*ea+Y*Z-V*ja;Q[2]=Y*U+S*ja+V*ea-X*Z;Q[3]=S*U-V*Z-X*ea-Y*ja;return Q}function e(Q,S,U){U*=.5;const V=S[0],X=S[1],Y=S[2];S=S[3];const Z=Math.sin(U);U=Math.cos(U);Q[0]=V*U+S*Z;Q[1]=X*U+Y*Z;Q[2]=Y*U-X*Z;Q[3]=S*U-V*Z;return Q}function h(Q,S,U){U*=.5;const V=S[0],X=
S[1],Y=S[2];S=S[3];const Z=Math.sin(U);U=Math.cos(U);Q[0]=V*U-Y*Z;Q[1]=X*U+S*Z;Q[2]=Y*U+V*Z;Q[3]=S*U-X*Z;return Q}function z(Q,S,U){U*=.5;const V=S[0],X=S[1],Y=S[2];S=S[3];const Z=Math.sin(U);U=Math.cos(U);Q[0]=V*U+X*Z;Q[1]=X*U-V*Z;Q[2]=Y*U+S*Z;Q[3]=S*U-Y*Z;return Q}function n(Q,S){const U=S[0],V=S[1];S=S[2];Q[0]=U;Q[1]=V;Q[2]=S;Q[3]=Math.sqrt(Math.abs(1-U*U-V*V-S*S));return Q}function l(Q,S,U,V){const X=S[0],Y=S[1],Z=S[2];S=S[3];let ea=U[0],ja=U[1],ha=U[2];U=U[3];let ia;let oa;var ma=X*ea+Y*ja+Z*
ha+S*U;0>ma&&(ma=-ma,ea=-ea,ja=-ja,ha=-ha,U=-U);1-ma>p.getEpsilon()?(ia=Math.acos(ma),oa=Math.sin(ia),ma=Math.sin((1-V)*ia)/oa,V=Math.sin(V*ia)/oa):ma=1-V;Q[0]=ma*X+V*ea;Q[1]=ma*Y+V*ja;Q[2]=ma*Z+V*ha;Q[3]=ma*S+V*U;return Q}function m(Q){var S=p.RANDOM,U=S();const V=S();S=S();const X=Math.sqrt(1-U);U=Math.sqrt(U);Q[0]=X*Math.sin(2*Math.PI*V);Q[1]=X*Math.cos(2*Math.PI*V);Q[2]=U*Math.sin(2*Math.PI*S);Q[3]=U*Math.cos(2*Math.PI*S);return Q}function t(Q,S){const U=S[0],V=S[1],X=S[2];S=S[3];var Y=U*U+V*
V+X*X+S*S;Y=Y?1/Y:0;Q[0]=-U*Y;Q[1]=-V*Y;Q[2]=-X*Y;Q[3]=S*Y;return Q}function w(Q,S){Q[0]=-S[0];Q[1]=-S[1];Q[2]=-S[2];Q[3]=S[3];return Q}function r(Q,S){var U=S[0]+S[4]+S[8];if(0<U)U=Math.sqrt(U+1),Q[3]=.5*U,U=.5/U,Q[0]=(S[5]-S[7])*U,Q[1]=(S[6]-S[2])*U,Q[2]=(S[1]-S[3])*U;else{let V=0;S[4]>S[0]&&(V=1);S[8]>S[3*V+V]&&(V=2);const X=(V+1)%3,Y=(V+2)%3;U=Math.sqrt(S[3*V+V]-S[3*X+X]-S[3*Y+Y]+1);Q[V]=.5*U;U=.5/U;Q[3]=(S[3*X+Y]-S[3*Y+X])*U;Q[X]=(S[3*X+V]+S[3*V+X])*U;Q[Y]=(S[3*Y+V]+S[3*V+Y])*U}return Q}function x(Q,
S,U,V){var X=.5*Math.PI/180;S*=X;U*=X;V*=X;X=Math.sin(S);S=Math.cos(S);const Y=Math.sin(U);U=Math.cos(U);const Z=Math.sin(V);V=Math.cos(V);Q[0]=X*U*V-S*Y*Z;Q[1]=S*Y*V+X*U*Z;Q[2]=S*U*Z-X*Y*V;Q[3]=S*U*V+X*Y*Z;return Q}function D(Q){return"quat("+Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}function A(Q,S,U){const V=u.dot(S,U);if(-.999999>V)return u.cross(J,N,S),1E-6>u.len(J)&&u.cross(J,R,S),u.normalize(J,J),d(Q,J,Math.PI),Q;if(.999999<V)return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q;u.cross(J,S,U);Q[0]=J[0];Q[1]=J[1];
Q[2]=J[2];Q[3]=1+V;return I(Q,Q)}function v(Q,S,U,V,X,Y){l(W,S,X,Y);l(T,U,V,Y);l(Q,W,T,2*Y*(1-Y));return Q}function B(Q,S,U,V){const X=P;X[0]=U[0];X[3]=U[1];X[6]=U[2];X[1]=V[0];X[4]=V[1];X[7]=V[2];X[2]=-S[0];X[5]=-S[1];X[8]=-S[2];return I(Q,r(Q,X))}const C=q.copy,E=q.set,F=q.add,M=q.scale,K=q.dot,G=q.lerp,L=q.length,O=q.squaredLength,I=q.normalize,H=q.exactEquals;q=q.equals;const J=y.create(),N=y.fromValues(1,0,0),R=y.fromValues(0,1,0),W=c.create(),T=c.create(),P=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,
add:F,calculateW:n,conjugate:w,copy:C,dot:K,equals:q,exactEquals:H,fromEuler:x,fromMat3:r,getAxisAngle:f,identity:k,invert:t,len:L,length:L,lerp:G,mul:g,multiply:g,normalize:I,random:m,rotateX:e,rotateY:h,rotateZ:z,rotationTo:A,scale:M,set:E,setAxes:B,setAxisAngle:d,slerp:l,sqlerp:v,sqrLen:O,squaredLength:O,str:D},Symbol.toStringTag,{value:"Module"}));a.add=F;a.calculateW=n;a.conjugate=w;a.copy=C;a.dot=K;a.equals=q;a.exactEquals=H;a.fromEuler=x;a.fromMat3=r;a.getAxisAngle=f;a.identity=k;a.invert=
t;a.len=L;a.length=L;a.lerp=G;a.mul=g;a.multiply=g;a.normalize=I;a.quat=b;a.random=m;a.rotateX=e;a.rotateY=h;a.rotateZ=z;a.rotationTo=A;a.scale=M;a.set=E;a.setAxes=B;a.setAxisAngle=d;a.slerp=l;a.sqlerp=v;a.sqrLen=O;a.squaredLength=O;a.str=D})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],function(a,b,c,y){a.RenderFeature=void 0;(function(p){p[p.Antialiasing=0]="Antialiasing";p[p.HighQualityTransparency=
1]="HighQualityTransparency";p[p.HighResolutionVoxel=2]="HighResolutionVoxel";p[p.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";p[p.SSAO=4]="SSAO";p[p.WaterReflection=5]="WaterReflection";p[p.HighResolutionShadows=6]="HighResolutionShadows";p[p.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(a.RenderFeature||(a.RenderFeature={}));a.setupFeatureDefaults=function(p=!b("disable-feature:high-quality-idle"),u=null){const q=new c.NestedMap;p?(q.set(y.RenderState.IDLE,a.RenderFeature.Antialiasing,
"low"!==u),q.set(y.RenderState.IDLE,a.RenderFeature.HighResolutionAtmosphere,"low"!==u),q.set(y.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,!0),q.set(y.RenderState.IDLE,a.RenderFeature.SSAO,!0),q.set(y.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),q.set(y.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,!b("esri-mobile"))):(q.set(y.RenderState.ANIMATING,a.RenderFeature.HighResolutionShadows,!0),q.set(y.RenderState.INTERACTING,a.RenderFeature.HighResolutionShadows,!0));q.set(y.RenderState.IDLE,
a.RenderFeature.HighResolutionShadows,!0);q.set(y.RenderState.IDLE,a.RenderFeature.HighResolutionVoxel,!0);return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(){this._outer=new Map}var p=y.prototype;p.clear=function(){this._outer.clear()};p.get=function(u,q){return this._outer.get(u)?.get(q)};p.set=function(u,q,k){const d=this._outer.get(u);d?d.set(q,
k):this._outer.set(u,new Map([[q,k]]))};p.delete=function(u,q){const k=this._outer.get(u);k&&(k.delete(q),0===k.size&&this._outer.delete(u))};p.forEach=function(u){this._outer.forEach((q,k)=>u(q,k))};b._createClass(y,[{key:"empty",get:function(){return 0===this._outer.size}}]);return y}();a.NestedMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=
0]="Immediate";b[b.Faded=1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(a,b,c,y){function p(k,d,f){if(null==d.longitude||null==d.latitude||null==f.longitude||null==f.latitude)throw Error("Invalid points: no lon/lat");return u(k,d.longitude,d.latitude,f.longitude,f.latitude)}function u(k,d,f,g,e){f=b.deg2rad(f);
e=b.deg2rad(e);d=b.deg2rad(d);const h=b.deg2rad(g);g=Math.sin((f-e)/2);d=Math.sin((d-h)/2);f=2*b.asinClamped(Math.sqrt(g*g+Math.cos(f)*Math.cos(e)*d*d));return Math.round(f*k*1E4)/1E4}function q(k,d){k/=15;d||(k=Math.round(k));return k}a.getGreatCircleDistance=u;a.getGreatCircleDistanceFromPoints=p;a.getGreatCircleSpanAt=function(k,d,f){const g=d.spatialReference,e=c.getReferenceEllipsoid(g),h=new y(d.x,k.y,g),z=new y(f.x,k.y,g);d=new y(k.x,d.y,g);k=new y(k.x,f.y,g);return{lon:p(e.radius,h,z),lat:p(e.radius,
d,k)}};a.getLonDeltaForDistance=function(k,d,f){d/=f;k=b.deg2rad(k);d=Math.sin(d/2);k=Math.cos(k);k=2*b.asinClamped(Math.sqrt(d*d/(k*k)));return b.rad2deg(k)};a.longitudeToTimezone=q;a.positionToTimezoneInfo=function(k,d){k=k?.[0];if(null==k)return null;d||(d={hours:0,minutes:0,seconds:0});d.hours=q(k,!0);k=d.hours%1;d.hours-=k;d.minutes=60*k;k=d.minutes%1;d.minutes-=k;d.seconds=Math.round(60*k);return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(W,T,P){T===f.ViewingMode.Global?k.normalize(J,W.eye):k.set(J,0,0,1);k.scale(N,W.viewForward,-1);T=e.angle(N,J);const Q=Math.max(T-.5,0);y.fromRotation(H,-Math.max(.25,T-.25-.85*Q/(Q+1)),W.viewRight);k.transformMat4(P,N,H);k.add(P,P,k.scale(R,W.viewRight,.2));k.normalize(P,P)}function z(W,T,P,Q){const S=x,U=y.identity(r);if(P===f.ViewingMode.Global)g.SunCalc.getPosition(W,0,0,S),k.set(Q,0,0,-1),y.rotateX(U,U,-S.azimuth),y.rotateY(U,U,-S.altitude);else{var V=
m.planarDirection;P=V.globalAngles;V=(Math.abs(T[2])-V.localAltitude)/(V.globalAltitude-V.localAltitude);V=c.clamp(V,0,1);1>V?(g.SunCalc.getPosition(W,T[1],T[0],S),S.azimuth=(1-V)*S.azimuth+V*P.azimuth,S.altitude=(1-V)*S.altitude+V*P.altitude):(S.azimuth=P.azimuth,S.altitude=P.altitude);k.set(Q,0,-1,0);y.rotateZ(U,U,-S.azimuth);y.rotateX(U,U,-S.altitude)}k.transformMat4(Q,Q,U)}function n(W){switch(W){case "disabled":case "sunny":return new t(1,1);case "cloudy":return new t(1,1);case "rainy":return new t(.4,
1.2);case "snowy":return new t(.5,1.3);case "foggy":return new t(.2,1.6)}}function l(W,T){const P=(W[0]+W[1]+W[2])/3;W[0]+=(P-W[0])*T;W[1]+=(P-W[1])*T;W[2]+=(P-W[2])*T}const m={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let t=b._createClass(function(W,T){this.direct=W;this.ambient=
T});const w=d.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);b=b._createClass(function(){this.ambient={color:d.fromValues(1,1,1),intensity:.55};this.direct={color:d.fromValues(1,1,1),intensity:.55,directionToLightSource:d.clone(w)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1});const r=p.create(),x={azimuth:0,altitude:0},D=d.fromValues(.01,.01,.01),A=d.fromValues(1,.6,.5),v=d.fromValues(1,.98,.98),B=d.fromValues(1,1,1),C=d.fromValues(.8,
.8,1),E=d.fromValues(.8,.8,1),F=d.fromValues(.98,.98,1),M=d.fromValues(1,1,1),K=q.fromValues(.01,m.local.ambientAtNight),G=q.fromValues(m.local.directAtTwilight,m.local.ambientAtTwilight),L=q.fromValues(.9*m.local.directAtNoon,m.local.ambientAtNoon),O=q.fromValues(m.local.directAtNoon,m.local.ambientAtNoon),I=new Date(0),H=p.create(),J=d.create(),N=d.create(),R=d.create();a.ColorAndIntensity=b;a.computeColorAndIntensity=function(W,T,P,Q,S,U){k.set(U.ambient.color,1,1,1);U.ambient.intensity=m.global.ambient;
k.set(U.direct.color,1,1,1);U.direct.intensity=m.global.direct;var V=c.clamp((Math.abs(T[2])-m.local.altitude)/(m.global.altitude-m.local.altitude),0,1);U.globalFactor=V;var X;null!=W&&(X=g.SunCalc.getTimes(W,T[1],T[0]));if(1>V){if(null!=W){var Y=X;var Z=W.valueOf();if(Y.polarException===g.SunCalc.PolarException.MIDNIGHT_SUN){var ea=Z-36E5*(W.getHours()+48)-6E4*W.getMinutes();Y=ea+432E6}else Y.polarException===g.SunCalc.PolarException.POLAR_NIGHT?(ea=Z-2,Y=Z-1):(ea=Y.sunrise.valueOf(),Y=Y.sunset.valueOf());
var ja=Y-ea;var ha=ea+ja/2,ia=ja/4;const oa=ha-ia;ia=ha+ia;ja*=.06;const ma=ea-ja/2,fa=ea+ja/2,ba=Y-ja/2,aa=Y+ja/2;ea=q.create();ja=d.create();Y=d.create();Z<ma||Z>aa?(u.copy(ea,K),k.copy(ja,D),k.copy(Y,C)):Z<fa?(Z=(Z-ma)/(fa-ma),u.lerp(ea,K,G,Z),k.lerp(ja,D,A,Z),k.lerp(Y,C,E,Z)):Z<oa?(Z=(Z-fa)/(oa-fa),u.lerp(ea,G,L,Z),k.lerp(ja,A,v,Z),k.lerp(Y,E,F,Z)):Z<ha?(Z=(Z-oa)/(ha-oa),u.lerp(ea,L,O,Z),k.lerp(ja,v,B,Z),k.lerp(Y,F,M,Z)):Z<ia?(Z=(Z-ha)/(ia-ha),u.lerp(ea,O,L,Z),k.lerp(ja,B,v,Z),k.lerp(Y,M,F,Z)):
Z<ba?(Z=(Z-ia)/(ba-ia),u.lerp(ea,L,G,Z),k.lerp(ja,v,A,Z),k.lerp(Y,F,E,Z)):Z<aa&&(Z=(Z-ba)/(aa-ba),u.lerp(ea,G,K,Z),k.lerp(ja,A,D,Z),k.lerp(Y,E,C,Z));Z=0;switch(Q){case "rainy":case "foggy":Z=.8;break;case "snowy":Z=.5}0<Z&&(l(ja,Z),l(Y,Z));ha=n(Q);Z=ea[0]*ha.direct;ea=ea[1]*ha.ambient}else Y=n(Q),Z=m.local.directAtNoon*Y.direct,ja=d.fromValues(1,1,1),ea=m.local.ambientAtNoon*Y.ambient,Y=d.fromValues(1,1,1);k.lerp(U.ambient.color,Y,U.ambient.color,V);U.ambient.intensity=c.lerp(ea,U.ambient.intensity,
V);k.lerp(U.direct.color,ja,U.direct.color,V);U.direct.intensity=c.lerp(Z,U.direct.intensity,V);U.specularStrength="rainy"===Q||"snowy"===Q||"foggy"===Q?0:1;U.environmentStrength="rainy"===Q?.7:"snowy"===Q||"foggy"===Q?.75:1}null!=W?(Q=W.valueOf(),X.polarException===g.SunCalc.PolarException.MIDNIGHT_SUN?(V=Q-36E5*(W.getHours()+48)-6E4*W.getMinutes(),X=V+432E6):X.polarException===g.SunCalc.PolarException.POLAR_NIGHT?(V=Q-2,X=Q-1):(V=X.sunrise.valueOf(),X=X.sunset.valueOf()),Q=1-c.clamp(Math.abs(Q-
(V+(X-V)/2))/432E5,0,1)):Q=1;U.noonFactor=Q;null!=W?z(W,T,P,U.direct.directionToLightSource):h(S,P,U.direct.directionToLightSource)};a.computeDirectionsOverTime=function(W,T,P,Q,S){W=W.getTime();T=T.getTime()-W;T=Math.floor(T/P)+1;const U=Array(T);for(let V=0;V<T;++V)I.setTime(W+P*V),U[V]=d.create(),z(I,Q,S,U[V]);return U};a.computeShadowsEnabled=function(W,T){return T===f.ViewingMode.Global?!0:Math.abs(W)<m.planarDirection.localAltitude};a.computeVirtualLightDirection=h;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports","./_commonjsHelpers"],function(a,b){var c={exports:{}};c.exports;(function(y){(function(p){p=p();void 0!==p&&(y.exports=p)})(function(){function p(C){return new Date(864E5*(C+.5-2440588))}function u(C,E){return w(n(C)*l(A)-m(E)*n(A),l(C))}function q(C,E){return t(n(E)*l(A)+l(E)*n(A)*n(C))}function k(C,E,F){return w(n(C),l(C)*n(E)-m(F)*l(E))}function d(C,E,F){return t(n(E)*n(F)+l(E)*l(F)*l(C))}function f(C){return x*(1.9148*n(C)+
.02*n(2*C)+3E-4*n(3*C))}function g(C,E){C=x*(357.5291+.98560028*C);var F=f(C);C=C+F+102.9372*x+z;E||(E={dec:0,ra:0});E.dec=q(C,0);E.ra=u(C,0);return E}function e(C,E,F){return 2451545+C+.0053*n(E)-.0069*n(2*F)}function h(C){var E=x*(134.963+13.064993*C),F=x*(93.272+13.22935*C);C=x*(218.316+13.176396*C)+6.289*x*n(E);F=5.128*x*n(F);E=385001-20905*l(E);return{ra:u(C,F),dec:q(C,F),dist:E}}var z=Math.PI,n=Math.sin,l=Math.cos,m=Math.tan,t=Math.asin,w=Math.atan2,r=Math.acos,x=z/180,D={dec:0,ra:0},A=23.4397*
x,v={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(C,E,F,M){F=x*-F;E*=x;var K=C.valueOf()/864E5-.5+2440588-2451545;C=g(K,D);F=x*(280.16+360.9856235*K)-F-C.ra;M||(M={azimuth:0,altitude:0});M.azimuth=k(F,E,C.dec);M.altitude=d(F,E,C.dec);return M}},B=[[-.83,"sunrise","sunset"]];v.addTime=function(C,E,F){B.push([C,E,F])};v.getTimes=function(C,E,F){function M(T){var P=G,Q=H;T=r((n(T)-n(P)*n(Q))/(l(P)*l(Q)));return e(9E-4+(T+K)/(2*z)+L,O,I)}var K=x*-F,G=x*E,L=Math.round(C.valueOf()/
864E5-.5+2440588-2451545-9E-4-K/(2*z));C=9E-4+(0+K)/(2*z)+L;var O=x*(357.5291+.98560028*C);E=f(O);var I=O+E+102.9372*x+z,H=q(I,0);C=e(C,O,I);E={solarNoon:p(C),nadir:p(C-.5),polarException:v.PolarException.NORMAL};var J;F=0;for(J=B.length;F<J;F+=1){var N=B[F];var R=M(N[0]*x);var W=C-(R-C);E[N[1]]=p(W);E[N[2]]=p(R)}E.polarException=function(T){T=(n(T)-n(G)*n(H))/(l(G)*l(H));return-1>T?v.PolarException.MIDNIGHT_SUN:1<T?v.PolarException.POLAR_NIGHT:v.PolarException.NORMAL}(B[0][0]*x);return E};v.getMoonPosition=
function(C,E,F){F=x*-F;E*=x;var M=C.valueOf()/864E5-.5+2440588-2451545;C=h(M);F=x*(280.16+360.9856235*M)-F-C.ra;M=d(F,E,C.dec);M+=.017*x/m(M+10.26*x/(M+5.1*x));return{azimuth:k(F,E,C.dec),altitude:M,distance:C.dist}};v.getMoonFraction=function(C){var E=C.valueOf()/864E5-.5+2440588-2451545;C=g(E);E=h(E);C=r(n(C.dec)*n(E.dec)+l(C.dec)*l(E.dec)*l(C.ra-E.ra));C=w(149598E3*n(C),E.dist-149598E3*l(C));return(1+l(C))/2};return v})})(c);b=b.getDefaultExportFromCjs(c.exports);a.SunCalc=b})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G){c=function(O){function I(){var J=O.apply(this,arguments)||this;J._handles=new y;return J}a._inherits(I,O);var H=I.prototype;H.destroy=function(){this._handles=p.destroyMaybe(this._handles);this.disconnect()};H.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager=p.destroyMaybe(this._inputManager)};H.connect=function(){const J=this.view;this._source=new A.BrowserEventSource(this.view.surface,J.input);var N=
[new E.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new M.SingleAndDoubleClick,new C.Drag(this.view.navigation),new K.VerticalTwoFingerDrag];this._inputManager=N=new v.InputManager({eventSource:this._source,recognizers:N});N.installHandlers("prevent-context-menu",[new B.PreventContextMenu],v.ViewEventPriorities.INTERNAL);this._modeDragPan=new t.PinchAndPanNavigation(J,"primary");this._modeDragRotate=new h.DragRotate(J,"secondary",G.PivotPoint.CENTER);this._modeDragZoom=new z.DragZoom(J,"tertiary");
N.installHandlers("navigation",[new w.PointerDownCancelAnimation(J),new e.DoubleClickZoom(J),new n.GamepadNavigation(J),new l.KeyboardNavigation(J,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new m.MouseWheelZoom(J),new x.SingleKeyResetTilt(J,"p"),new r.SingleKeyResetHeading(J,"n"),new h.DragRotate(J,"primary",G.PivotPoint.EYE,["b"]),new h.DragRotate(J,"secondary",G.PivotPoint.CENTER,
["b"]),new t.PinchAndPanNavigation(J,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new D.TwoFingerTilt(J)],v.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(N);this._updateMode();this._handles.add(u.watch(()=>this.view.navigation?.browserTouchPanEnabled,R=>{this._source.browserTouchPanningEnabled=!R},u.initial))};H._updateMode=function(){var J=this.primaryDragAction;if(J=L.get(this.mode)?.get(J))this._modeDragPan&&(this._modeDragPan.pointerAction=J.pan),this._modeDragRotate&&
(this._modeDragRotate.pointerAction=J.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=J.zoom)};a._createClass(I,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(J){"pan"!==J&&"rotate"!==J||J===this._get("primaryDragAction")||(this._set("primaryDragAction",J),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(J){"default"!==J&&"pro"!==J||J===this._get("mode")||(this._set("mode",J),this._updateMode())}},{key:"updating",
get:function(){return!!this._inputManager?.updating}},{key:"latestPointerType",get:function(){return this._inputManager?.latestPointerType}},{key:"latestPointerLocation",get:function(){return this._inputManager?.latestPointerLocation}},{key:"multiTouchActive",get:function(){return this._inputManager?.multiTouchActive??!1}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return I}(c);
b.__decorate([q.property()],c.prototype,"view",void 0);b.__decorate([q.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([q.property({value:"default"})],c.prototype,"mode",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([q.property()],c.prototype,"latestPointerType",null);b.__decorate([q.property()],c.prototype,"latestPointerLocation",null);b.__decorate([q.property()],c.prototype,"multiTouchActive",null);b.__decorate([q.property()],
c.prototype,"_inputManager",void 0);c=b.__decorate([g.subclass("esri.views.3d.input.SceneInputManager")],c);const L=new Map;b=new Map;q=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});q.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});q.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});L.set("default",b);L.set("pro",q);return c})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,y,p,u,q){u=function(k){function d(f,g){var e=k.call(this,!0)||this;e._view=f;e.registerIncoming("double-click",g,h=>e._handleDoubleClick(h));return e}b._inherits(d,k);d.prototype._handleDoubleClick=function(f){const g=f.data;if(q.eventMatchesPointerAction(g,"primary")){const e=this._view.state.isGlobal?new y.ZoomStepController({view:this._view,mode:"animation"}):new p.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/
Math.log(.6),c.createScreenPointArray(g.x,g.y));f.stopPropagation()}};return b._createClass(d)}(u.InputHandler);a.DoubleClickZoom=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E){a.ZoomStepController=function(K){function G(){var O=K.apply(this,arguments)||this;O._zoomLocation=h.create();O._tmpCamera=new B.Camera;O._tmpViewDir=h.create();O._tmpRayDir={origin:h.create(),direction:h.create()};O._targetOnSphere=h.create();O._tmpCenter=h.create();O._constraintOptions={selection:m.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:t.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new B.Camera,interactionDirection:null,
tiltMode:r.TiltMode.TUMBLE};O._sphere=n.create();return O}b._inherits(G,K);var L=G.prototype;L.initialize=function(){this._intersector=C.newIntersector(this.view.state.viewingMode)};L.zoomStep=function(O,I){if(this.active){var H=this.view.state,{interactionStartCamera:J}=this._constraintOptions;J&&(this.animation.finished?J.copyFrom(H.camera):this.animation.cameraAt(1,J));var N=J=!1;this.intersectionHelper.intersectScreen(I,this._zoomLocation,0===this.view.map.ground.opacity?D.contentIntersectorOptions:
{})&&(J=0<O,N=!0);this._tmpCamera.copyFrom(H.camera);J?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,O,this._zoomLocation,I,N);this.begin(this._tmpCamera)}};L.animationSettings=function(){return{duration:p.Milliseconds(600),
easing:E.outExpo}};L._updateCamera=function(O,I,H,J,N){var R=z.getReferenceEllipsoid(this.view.spatialReference);R=D.decideNavigationMode(O,J,R);var W=Math.abs(this.view.camera.position.z);e.normalize(M,O.eye);e.scale(M,M,-1);A.fromScreenAtEye(O,J,this._tmpRayDir);e.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const T=y.clamp(Math.min(D.ZOOM_DISTANCE_MODIFIER,1/Math.abs(e.dot(M,this._tmpRayDir.direction)))*W,D.ZOOM_MIN_DISTANCE_MODIFIER,D.ZOOM_MAX_DISTANCE_MODIFIER);if(R===D.NavigationMode.Horizontal){I=
.6**I;this._sphere[3]=e.length(H);e.subtract(this._tmpViewDir,O.center,O.eye);N=Math.min(e.length(this._tmpViewDir),T);R=N*I;1>=I&&4>R&&(R=4,I=R/N);if(1E-6>Math.abs(N-R))return;N=e.length(O.center);this._sphere[3]!==N&&(O.center=e.scale(F,O.center,(this._sphere[3]+I*(N-this._sphere[3]))/N));e.scale(this._tmpViewDir,this._tmpViewDir,-I);O.eye=e.add(F,O.center,this._tmpViewDir);l.applyAll(this.view,O,this._constraintOptions);1E-12<e.squaredDistance(H,O.center)&&v.intersectScreen(this._sphere,O,J,this._targetOnSphere)&&
D.panToPosition(this._sphere,O,H,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{R=.6**Math.abs(I);W=0<I?1:-1;e.subtract(this._tmpViewDir,H,O.eye);const P=e.length(this._tmpViewDir);J=this.view._stage.renderView.getMinimalDepthForArea(null,J[0],J[1],this.view.state.camera,60);J=null!=J?J:T;J=N&&0<I?Math.min(J,P):J;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,J);e.add(H,this._tmpRayDir.origin,this._tmpRayDir.direction);H=J*R;N=Math.max(4,1.01*O.nearFar[0]);
0<I&&H<N&&(H=N,R=H/J);if(1E-6>Math.abs(J-H))return;e.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,W*(1-R));O.eye=e.add(F,O.eye,this._tmpRayDir.direction);O.center=e.add(F,O.center,this._tmpRayDir.direction)}w.applySurfaceCollisionConstraint(this.view,O)};return b._createClass(G)}(x.PointToPointAnimationController);a.ZoomStepController=c.__decorate([g.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const F=h.create(),M=h.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ./constraintUtils/TiltMode ../../animation/easing".split(" "),function(a,b,c,y,p,u,q,k,d,f){const g=[{type:y.ConstraintTypes.TILT,error:function(h,z,n){return k.getTiltConstraintError(h,z,n)*
z.distance},apply:k.applyTiltConstraint},{type:y.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:y.ConstraintTypes.DISTANCE,error:p.getDistanceConstraintError,apply:p.applyDistanceConstraint}],e={selection:y.ConstraintTypes.ALL,interactionType:u.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:d.TiltMode.TUMBLE};a.applyAll=function(h,z,n=e,l=z){l!==z&&l.copyFrom(z);l.computeUp(h.state.viewingMode);
z=!1;for(let t=0;5>t;t++){let w=0;for(var m of g)if(c.hasConstraintType(n.selection,m.type)){const r=Math.abs(m.error(h,l,n));m.apply(h,l,n)&&(z=!0,w+=r)}if(0===w)break}m=c.hasConstraintType(n.selection,y.ConstraintTypes.COLLISION);a:switch(n.interactionType){case u.InteractionType.PAN:n=q.Mode.EYE_AND_CENTER;break a;case u.InteractionType.ASCEND:n=h.state.isGlobal?q.Mode.EYE_AND_CENTER_SCALE:q.Mode.EYE_AND_CENTER;break a;default:n=q.Mode.EYE}m&&q.applySurfaceCollisionConstraint(h,l,n)&&(z=!0);z&&
l.computeUp(h.state.viewingMode);return z};a.pixelDistanceToInteractionFactor=function(h){return f.inOutCubic(Math.min(1,h/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),function(a,b,c,y,p,u,q,k,d){function f(l,
m,t=u.defaultConstraintOptions){var w=l.state.constraints.altitude;w=l.state.isGlobal&&w?t.interactionType===k.InteractionType.TUMBLE&&u.hasConstraintType(t.selection,q.ConstraintTypes.TILT)?!1:!0:!1;if(!w||!l.state.constraints.altitude)return 0;var r=l.state.constraints.altitude;w=g;w.min=r.min;w.max=r.max;r=t.interactionType;if(r!==k.InteractionType.NONE){var {min:x,max:D}=w,{interactionStartCamera:A,interactionFactor:v}=t;if(A){t=r===k.InteractionType.TUMBLE||r===k.InteractionType.ZOOM;r=f(l,A);
var B=0===r?0:l.renderCoordsHelper.getAltitude(A.eye);w.min=x;w.max=D;u.adjustRangeForInteraction(r,B,t,v,.05*B,w)}}l=l.renderCoordsHelper.getAltitude(m.eye);l=b.clamp(l,w.min,w.max)-l;return 1E-6>=Math.abs(l)?0:l}const g={min:0,max:0},e=y.create(),h=y.create(),z=y.create(),n=y.create();a.applyAltitudeConstraint=function(l,m,t=u.defaultConstraintOptions){var w=f(l,m,t);if(0===w)return!1;const r=l.renderCoordsHelper,x=r.getAltitude(m.eye)+w;var D=u.interactionDirectionTowardsConstraintMinimization;
t=t.interactionDirection;w=Math.sign(w);l.renderCoordsHelper.worldUpAtPosition(m.eye,h);c.scale(h,h,w);D=D.call(u,m,t,h,e);l=c.copy(z,m.viewForward);D=r.intersectInfiniteManifold(p.wrap(m.eye,D),x,n);m.eye=null!=D?D:r.setAltitude(n,x,m.eye);m.center=d.closestPointOnRay(n,m.eye,l,m.center);return!0};a.getAltitudeConstraintError=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3","./ConstraintTypes",
"./InteractionType","./TiltMode"],function(a,b,c,y,p){c={selection:c.ConstraintTypes.NONE,interactionType:y.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:p.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(u,q,k,d,f,g){0!==u&&(k?(g.min=Math.min(g.min,q),g.max=Math.max(g.max,q)):null!=d?(g.min-=Math.max(0,(q-g.min)*(1-d)),g.max+=Math.max(0,(q-g.max)*(1-d))):f&&(g.min-=Math.max(0,q-g.min-f),g.max+=Math.max(0,q-g.max-f)))};a.defaultConstraintOptions=
c;a.hasConstraintType=function(u,q){return 0!==(u&q)};a.interactionDirectionTowardsConstraintMinimization=function(u,q,k,d){q=q||u.viewForward;b.copy(d,q);b.scale(d,d,Math.sign(b.dot(q,k)));return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes={});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=
4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,b,c,y,p){function u(d,
f,g,e){const h=k;d?(g&&e&&(h.len=c.distance(f,g)),c.copy(h.dir,d)):e?(h.len=c.distance(f,g),c.subtract(h.dir,g,f),c.scale(h.dir,h.dir,1/h.len)):(c.subtract(h.dir,g,f),c.normalize(h.dir,h.dir));return h}function q(d,f,g,e){e.clip[0]=0;e.clip[1]=g?e.len:Number.MAX_VALUE;for(g=0;g<d.length;g++){{var h=d[g],z=f;var n=e;const l=c.dot(p.normal(h),n.dir);h=-p.signedDistance(h,z);0>h&&0<=l?n=!1:-1E-6<l&&1E-6>l?n=0<h:!(0>h||0>l)||0>h&&0>l?(h/=l,0<l?h<n.clip[1]&&(n.clip[1]=h):h>n.clip[0]&&(n.clip[0]=h),n=n.clip[0]<=
n.clip[1]):n=!0}if(!n)return!1}return!0}const k={dir:y.create(),len:0,clip:b.create()};a.closestPointOnRay=function(d,f,g,e){e=c.dot(g,c.subtract(d,e,f));return c.add(d,f,c.scale(d,g,e))};a.frustumLineSegment=function(d,f,g,e){e=u(e,f,g,!0);return q(d,f,g,e)};a.frustumPoint=function(d,f){for(let g=0;6>g;g++)if(0<p.signedDistance(d[g],f))return!1;return!0};a.frustumRay=function(d,f,g,e){g=u(e,f,g,!1);return q(d,f,null,g)};a.frustumSphere=function(d,f,g){const e=f[0],h=f[1];f=f[2];return d[0][0]*e+
d[0][1]*h+d[0][2]*f+d[0][3]>g||d[1][0]*e+d[1][1]*h+d[1][2]*f+d[1][3]>g||d[2][0]*e+d[2][1]*h+d[2][2]*f+d[2][3]>g||d[3][0]*e+d[3][1]*h+d[3][2]*f+d[3][3]>g||d[4][0]*e+d[4][1]*h+d[4][2]*f+d[4][3]>g||d[5][0]*e+d[5][1]*h+d[5][2]*f+d[5][3]>g?!1:!0};a.planeSphere=function(d,f,g){return d[0]*f[0]+d[1]*f[1]+d[2]*f[2]+d[3]<g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,b,c,y,p,u,q){function k(l,m,t=u.defaultConstraintOptions){if(!l.state.isLocal)return 0;var w=l.state.constraints.distance;if(!l.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===w)return 0;f.min=0;f.max=w;w=f;var r=t.interactionType;if(r!==q.InteractionType.NONE){var {min:x,max:D}=w,{interactionStartCamera:A,interactionFactor:v}=t;if(A){t=r===q.InteractionType.ZOOM||r===q.InteractionType.PAN;r=k(l,A);var B=0===r?0:d(l,A);w.min=x;w.max=D;u.adjustRangeForInteraction(r,B,t,v,.05*B,
w)}}l=d(l,m);l=f.max-l;return-1E-6<=l?0:l}function d(l,m){l=l.pointsOfInterest.surfaceOrigin;return l.renderLocation?b.distance(m.eye,l.renderLocation):0}const f={min:0,max:0},g=c.create(),e=c.create(),h=c.create(),z=c.create(),n=c.create();a.applyDistanceConstraint=function(l,m,t=u.defaultConstraintOptions){var w=k(l,m,t);if(0===w)return!1;var r=l.pointsOfInterest.surfaceOrigin;if(!r.renderLocation)return!1;w=d(l,m)+w;const x=b.copy(g,m.eye);t=u.interactionDirectionTowardsConstraintMinimization(m,
t.interactionDirection,b.direction(z,m.eye,r.renderLocation),h);if(!p.intersectRay(p.fromCenterAndRadius(r.renderLocation,w),y.wrap(m.eye,t),n))return!1;m.eye=n;r=b.subtract(e,m.eye,x);m.center=b.add(n,m.center,r);r=l.renderCoordsHelper.getAltitude(m.center);l=l.renderCoordsHelper.intersectInfiniteManifold(m.ray,r,n);null!=l&&(m.center=l);return!0};a.getDistanceConstraintError=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,y){a.Mode=void 0;(function(q){q[q.EYE=0]="EYE";q[q.EYE_AND_CENTER=1]="EYE_AND_CENTER";q[q.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const p=c.create(),u=c.create();a.applySurfaceCollisionConstraint=function(q,k,d=a.Mode.EYE){var f=q.state.constraints;if(!f.collision.enabled)return!1;var g=y.surfaceElevationBelowRenderLocation(q,k.eye);const e=q.renderCoordsHelper.getAltitude(k.eye);
f=g+f.collision.elevationMargin;if(e>=f)return!1;g=b.length(k.eye);b.subtract(p,k.center,k.eye);k.eye=q.renderCoordsHelper.setAltitude(u,f,k.eye);d===a.Mode.EYE_AND_CENTER?k.center=b.add(p,k.eye,p):d===a.Mode.EYE_AND_CENTER_SCALE&&(k.center=b.scale(p,k.center,(g-e+f)/g));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,b,c,y,p,u){function q(z,n){return z.elevationProvider?z.elevationProvider.getElevation(n[0],n[1],n[2],z.renderCoordsHelper.spatialReference,"ground")??0:0}function k(z,n,l){if(!z.state.isGlobal||!z.stateManager.constraintsManager)return!1;const m=q(z,n);({far:z}=z.stateManager.constraintsManager.nearFarHeuristic.compute(n,l,z.renderDataExtent,m,h));z*=z;return b.squaredDistance(n,l)>z}const d={},f=c.create(),g=c.create(),e=c.create(),h={near:0,far:0};a.cameraOnContentAlongViewDirection=
function(z,n,l,m){const t=z.state.camera.clone();n&&l&&m&&(t.eye=n,t.center=l,t.up=m);n=t.ray;l=d[z.viewingMode];l||(l=u.newIntersector(z.state.viewingMode),l.options.backfacesTerrain=!z.state.isGlobal,l.options.invisibleTerrain=!0,d[z.viewingMode]=l);({isGlobal:m}=z.state);z.sceneIntersectionHelper.intersectRay(n,l,g)&&!k(z,n.origin,g)?n=!0:!z.renderCoordsHelper.intersectManifold(n,0,g)||k(z,n.origin,g)?m?(l=y.getReferenceEllipsoid(z.spatialReference).radius,l=b.dot(n.origin,n.origin)-l*l,b.scale(g,
n.direction,(0<l?Math.sqrt(l)/3:1)/b.length(n.direction)),b.add(g,g,n.origin),n=!0):n=!1:n=!0;n||b.copy(g,t.center);l=z.state.constraints;m=l.minimumPoiDistance;b.squaredDistance(t.eye,g)<m&&(n=l.collision.enabled,b.copy(e,t.viewForward),b.scale(e,e,m),n?t.eye=b.subtract(f,g,e):b.add(g,t.eye,e),z=z.renderCoordsHelper,m=z.getAltitude(t.eye),l=l.collision.elevationMargin,n&&m<l&&(b.subtract(e,g,t.eye),t.eye=z.setAltitude(f,l,t.eye),b.add(g,t.eye,e)));t.center=g;return t};a.eyeWithinExtent=function(z,
n,l,m){return null!=z.renderCoordsHelper.fromRenderCoords(n.eye,f,m)&&p.containsPoint(l,f)};a.surfaceElevationBelowRenderLocation=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(){function x(A){this.options=new g.IntersectorOptions;this._results=new l;this.transform=new z.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=d.create();this._rayEnd=u.create();this._rayBeginTransformed=u.create();this._rayEndTransformed=u.create();this.viewingMode=null==A?f.ViewingMode.Global:A}var D=x.prototype;D.reset=function(A,v,B){this.resetWithRay(d.fromPoints(A,v,this._ray),B)};D.resetWithRay=function(A,v){this.camera=
v;A!==this._ray&&d.copy(A,this._ray);0!==this.options.verticalOffset?this.viewingMode===f.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;p.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};D.intersect=function(A=null,v,B,C,E){this.point=v;this.filterPredicate=C;this.tolerance=null==B?1E-5:B;v=z.getVerticalOffsetObject3D(this.verticalOffset);if(A&&0<A.length){const F=E?M=>
{E(M)&&this.intersectObject(M)}:M=>{this.intersectObject(M)};for(const M of A)A=M.getSpatialQueryAccelerator&&M.getSpatialQueryAccelerator(),null!=A?(null!=v?A.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,F,v):A.forEachAlongRay(this._ray.origin,this._ray.direction,F),this.options.selectionMode&&this.options.hud&&A.forEachDegenerateObject(F)):M.objects.forAll(K=>F(K))}this.sortResults()};D.intersectObject=function(A){const v=A.geometries;if(v){var B=A.shaderTransformation,
C=z.getVerticalOffsetObject3D(this.verticalOffset);for(const E of v){if(!E.visible)continue;const {material:F,id:M}=E;this.transform.setAndInvalidateLazyTransforms(B,E.shaderTransformation);p.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);p.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const K=this.transform.transform;null!=C&&(C.objectTransform=this.transform);F.intersect(E,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,
(G,L,O,I,H,J)=>{if(0<=G&&(null==this.filterPredicate||this.filterPredicate(this._ray.origin,this._rayEnd,G))){var N=I?this._results.hud:this._results,R=I?W=>{const T=new e.HudTarget(A,M,O,J);W.set(g.IntersectorType.HUD,T,G,L,y.IDENTITY,H)}:W=>W.set(g.IntersectorType.OBJECT,{object:A,geometryId:M,triangleNr:O},G,L,K,H);(null==N.min.drapedLayerOrder||H>=N.min.drapedLayerOrder)&&(null==N.min.dist||G<N.min.dist)&&R(N.min);this.options.store!==g.StoreResults.MIN&&(null==N.max.drapedLayerOrder||H<N.max.drapedLayerOrder)&&
(null==N.max.dist||G>N.max.dist)&&R(N.max);this.options.store===g.StoreResults.ALL&&(I?(I=new t(this._ray),R(I),this._results.hud.all.push(I)):(I=new m(this._ray),R(I),this._results.all.push(I)))}})}}};D.sortResults=function(A=this._results.all){A.sort((v,B)=>v.dist!==B.dist?(v.dist??0)-(B.dist??0):v.drapedLayerOrder!==B.drapedLayerOrder?(v.drapedLayerOrder??Number.MAX_VALUE)-(B.drapedLayerOrder??Number.MAX_VALUE):(B.drapedLayerGraphicOrder??Number.MIN_VALUE)-(v.drapedLayerGraphicOrder??Number.MIN_VALUE))};
b._createClass(x,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return x}(),l=function(){function x(){this.min=new m(d.create());this.max=new m(d.create());this.hud={min:new t(d.create()),max:new t(d.create()),all:[]};this.ground=new m(d.create());this.all=[]}x.prototype.init=function(D){this.min.init(D);this.max.init(D);this.ground.init(D);
this.all.length=0;this.hud.min.init(D);this.hud.max.init(D);this.hud.all.length=0};return b._createClass(x)}(),m=function(){function x(A){this.intersector=g.IntersectorType.OBJECT;this.normal=u.create();this.transformation=y.create();this._ray=d.create();this.init(A)}var D=x.prototype;D.getIntersectionPoint=function(A){if(!h.isValidIntersectorResult(this))return!1;p.scale(w,this.ray.direction,this.dist);p.add(A,this.ray.origin,w);return!0};D.getTransformedNormal=function(A){p.copy(r,this.normal);
r[3]=0;q.transformMat4(r,r,this.transformation);p.copy(A,r);return p.normalize(A,A)};D.init=function(A){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=g.IntersectorType.OBJECT;d.copy(A,this._ray)};D.set=function(A,v,B,C,E,F,M){this.intersector=A;this.dist=B;p.copy(this.normal,C??u.UNIT_Z);c.copy(this.transformation,E??y.IDENTITY);this.target=v;this.drapedLayerOrder=F;this.drapedLayerGraphicOrder=M};D.copy=function(A){d.copy(A.ray,this._ray);this.intersector=
A.intersector;this.dist=A.dist;this.target=A.target;this.drapedLayerOrder=A.drapedLayerOrder;this.drapedLayerGraphicOrder=A.drapedLayerGraphicOrder;p.copy(this.normal,A.normal);c.copy(this.transformation,A.transformation)};b._createClass(x,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return null!=this.dist?(p.scale(w,this.ray.direction,this.dist),p.length(w)):null}}]);return x}(),t=function(x){function D(){var A=x.apply(this,arguments)||this;A.intersector=
g.IntersectorType.HUD;return A}b._inherits(D,x);return b._createClass(D)}(m);const w=u.create(),r=k.create();a.DEFAULT_TOLERANCE=1E-5;a.newIntersector=function(x){return new n(x)};a.newIntersectorResult=function(x){return new m(x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){a.IntersectorType=void 0;(function(c){c[c.OBJECT=0]="OBJECT";
c[c.HUD=1]="HUD";c[c.TERRAIN=2]="TERRAIN";c[c.OVERLAY=3]="OVERLAY";c[c.I3S=4]="I3S";c[c.PCL=5]="PCL";c[c.LOD=6]="LOD";c[c.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));b=b._createClass(function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=a.StoreResults.ALL});a.StoreResults=void 0;(function(c){c[c.MIN=0]="MIN";c[c.MINMAX=1]="MINMAX";c[c.ALL=
2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64"],function(a,b,c){let y=b._createClass(function(d,f,g){this.object=d;this.geometryId=f;this.triangleNr=g}),p=function(d){function f(g,e,h,z){g=d.call(this,g,e,h)||this;g.center=null!=z?c.clone(z):null;return g}b._inherits(f,
d);return b._createClass(f)}(y),u=function(d){function f(){return d.apply(this,arguments)||this}b._inherits(f,d);return b._createClass(f)}(p),q=b._createClass(function(d){this.layerUid=d}),k=function(d){function f(g,e){g=d.call(this,g)||this;g.graphicUid=e;return g}b._inherits(f,d);return b._createClass(f)}(q);a.Graphic3DTarget=k;a.HudTarget=p;a.LayerTarget=q;a.ObjectTarget=y;a.ValidHudTarget=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(a,b,c,y,p){function u(k){return null!=k&&null!=k.dist}const q=c.create();a.isHudIntersectorResult=function(k){return u(k)&&k.intersector===p.IntersectorType.HUD&&!!k.target&&"center"in k.target&&null!=k.target.center};a.isObjectIntersectorResult=function(k){return u(k)&&k.intersector===p.IntersectorType.OBJECT&&!!k.target};a.isValidIntersectorResult=u;a.sliceFilterPredicate=
function(k){return(d,f,g)=>{b.lerp(q,d,f,g);return!y.extrusionContainsPoint(k,q)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/sphere".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(){function B(){this._transform=u.create();this._transformInverse=new z({value:this._transform},p.invert,u.create);this._transformInverseTranspose=new z(this._transformInverse,p.transpose,u.create);this._transformTranspose=new z({value:this._transform},p.transpose,u.create);this._transformInverseRotation=new z({value:this._transform},c.normalFromMat4Legacy,y.create)}var C=B.prototype;C._invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};C.setTransformMatrix=function(E){p.copy(this._transform,E)};C.multiplyTransform=function(E){p.multiply(this._transform,this._transform,E)};C.set=function(E){p.copy(this._transform,E);this._invalidateLazyTransforms()};C.setAndInvalidateLazyTransforms=function(E,F){this.setTransformMatrix(E);this.multiplyTransform(F);this._invalidateLazyTransforms()};b._createClass(B,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return B}(),z=function(){function B(C,E,F){this._original=C;this._update=E;this._dirty=!0;this._transform=F()}B.prototype.invalidate=function(){this._dirty=
!0};b._createClass(B,[{key:"value",get:function(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}]);return B}(),n=function(){function B(E=0){this.offset=E;this.tmpVertex=g.create()}var C=B.prototype;C.applyToVertex=function(E,F,M){const K=E+this.localOrigin[0],G=F+this.localOrigin[1],L=M+this.localOrigin[2],O=this.offset/Math.sqrt(K*K+G*G+L*L);this.tmpVertex[0]=E+K*O;this.tmpVertex[1]=F+G*O;this.tmpVertex[2]=M+L*O;return this.tmpVertex};C.applyToAabb=
function(E){for(var F=0;3>F;++F)l[F]=E[0+F]+this.localOrigin[F],m[F]=E[3+F]+this.localOrigin[F],t[F]=l[F];F=this.applyToVertex(l[0],l[1],l[2]);for(var M=0;3>M;++M)E[M]=F[M],E[M+3]=F[M];F=G=>{G=this.applyToVertex(G[0],G[1],G[2]);for(let L=0;3>L;++L)E[L]=Math.min(E[L],G[L]),E[L+3]=Math.max(E[L+3],G[L])};for(M=1;8>M;++M){for(var K=0;3>K;++K)t[K]=0===(M&1<<K)?l[K]:m[K];F(t)}M=0;for(K=0;3>K;++K)0>l[K]*m[K]&&(M|=1<<K);if(0!==M&&7!==M)for(K=0;8>K;++K)if(0===(M&K)){for(let G=0;3>G;++G)t[G]=0!==(M&1<<G)?0:
0!==(K&1<<G)?l[G]:m[G];F(t)}for(F=0;3>F;++F)E[F]-=this.localOrigin[F],E[F+3]-=this.localOrigin[F];return E};return b._createClass(B)}();const l=g.create(),m=g.create(),t=g.create();let w=function(){function B(E=0){this.componentLocalOriginLength=0;this._tmpVertex=g.create();this._mbs=e.create();this._obb={center:g.create(),halfSize:f.create(),quaternion:null};this._offset=this._totalOffset=0;this._resetOffset(E)}var C=B.prototype;C._resetOffset=function(E){this._totalOffset=this._offset=E};C.applyToVertex=
function(E,F,M){const K=M+this.componentLocalOriginLength,G=this._totalOffset/Math.sqrt(E*E+F*F+K*K);this._tmpVertex[0]=E+E*G;this._tmpVertex[1]=F+F*G;this._tmpVertex[2]=M+K*G;return this._tmpVertex};C.applyToAabb=function(E){const F=E[0],M=E[1],K=E[2]+this.componentLocalOriginLength,G=E[3],L=E[4],O=E[5]+this.componentLocalOriginLength;var I=0>F*G?0:Math.min(Math.abs(F),Math.abs(G)),H=0>M*L?0:Math.min(Math.abs(M),Math.abs(L)),J=0>K*O?0:Math.min(Math.abs(K),Math.abs(O));I=Math.sqrt(I*I+H*H+J*J);if(I<
this._totalOffset)return E[0]-=0>F?this._totalOffset:0,E[1]-=0>M?this._totalOffset:0,E[2]-=0>K?this._totalOffset:0,E[3]+=0<G?this._totalOffset:0,E[4]+=0<L?this._totalOffset:0,E[5]+=0<O?this._totalOffset:0,E;H=Math.max(Math.abs(F),Math.abs(G));J=Math.max(Math.abs(M),Math.abs(L));const N=Math.max(Math.abs(K),Math.abs(O));H=this._totalOffset/Math.sqrt(H*H+J*J+N*N);I=this._totalOffset/I;E[0]+=F*(0<F?H:I);E[1]+=M*(0<M?H:I);E[2]+=K*(0<K?H:I);E[3]+=G*(0>G?H:I);E[4]+=L*(0>L?H:I);E[5]+=O*(0>O?H:I);return E};
C.applyToMbs=function(E){const F=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),M=this._totalOffset/F;this._mbs[0]=E[0]+E[0]*M;this._mbs[1]=E[1]+E[1]*M;this._mbs[2]=E[2]+E[2]*M;this._mbs[3]=E[3]+E[3]*this._totalOffset/F;return this._mbs};C.applyToObb=function(E){var F=E.center;const M=this._totalOffset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);this._obb.center[0]=F[0]+F[0]*M;this._obb.center[1]=F[1]+F[1]*M;this._obb.center[2]=F[2]+F[2]*M;d.transformQuat(this._obb.halfSize,E.halfSize,E.quaternion);d.add(this._obb.halfSize,
this._obb.halfSize,E.center);F=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);this._obb.halfSize[0]+=this._obb.halfSize[0]*F;this._obb.halfSize[1]+=this._obb.halfSize[1]*F;this._obb.halfSize[2]+=this._obb.halfSize[2]*F;d.subtract(this._obb.halfSize,this._obb.halfSize,E.center);q.conjugate(v,E.quaternion);d.transformQuat(this._obb.halfSize,this._obb.halfSize,v);this._obb.halfSize[0]*=0>
this._obb.halfSize[0]?-1:1;this._obb.halfSize[1]*=0>this._obb.halfSize[1]?-1:1;this._obb.halfSize[2]*=0>this._obb.halfSize[2]?-1:1;this._obb.quaternion=E.quaternion;return this._obb};b._createClass(B,[{key:"offset",get:function(){return this._offset},set:function(E){this._resetOffset(E)}},{key:"componentOffset",set:function(E){this._totalOffset=this._offset+E}},{key:"localOrigin",set:function(E){this.componentLocalOriginLength=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])}}]);return B}(),r=function(){function B(E=
0){this.offset=E;this.sphere=e.create();this.tmpVertex=g.create()}var C=B.prototype;C.applyToVertex=function(E,F,M){const K=this.objectTransform.transform;let G=K[0]*E+K[4]*F+K[8]*M+K[12],L=K[1]*E+K[5]*F+K[9]*M+K[13];E=K[2]*E+K[6]*F+K[10]*M+K[14];F=this.offset/Math.sqrt(G*G+L*L+E*E);G+=G*F;L+=L*F;E+=E*F;F=this.objectTransform.inverse;this.tmpVertex[0]=F[0]*G+F[4]*L+F[8]*E+F[12];this.tmpVertex[1]=F[1]*G+F[5]*L+F[9]*E+F[13];this.tmpVertex[2]=F[2]*G+F[6]*L+F[10]*E+F[14];return this.tmpVertex};C.applyToMinMax=
function(E,F){const M=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=E[0]*M;E[1]+=E[1]*M;E[2]+=E[2]*M;E=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*E;F[1]+=F[1]*E;F[2]+=F[2]*E};C.applyToAabb=function(E){var F=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=E[0]*F;E[1]+=E[1]*F;E[2]+=E[2]*F;F=this.offset/Math.sqrt(E[3]*E[3]+E[4]*E[4]+E[5]*E[5]);E[3]+=E[3]*F;E[4]+=E[4]*F;E[5]+=E[5]*F;return E};C.applyToBoundingSphere=function(E){const F=Math.sqrt(E[0]*E[0]+
E[1]*E[1]+E[2]*E[2]),M=this.offset/F;this.sphere[0]=E[0]+E[0]*M;this.sphere[1]=E[1]+E[1]*M;this.sphere[2]=E[2]+E[2]*M;this.sphere[3]=E[3]+E[3]*this.offset/F;return this.sphere};return b._createClass(B)}();const x=new r,D=new w,A=new n,v=k.create();a.I3SVerticalOffsetGlobalViewingMode=w;a.IntersectorTransform=h;a.Object3DVerticalOffsetGlobalViewingMode=r;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=n;a.getVerticalOffsetI3S=function(B){return null!=B?(D.offset=B,D):null};a.getVerticalOffsetObject3D=
function(B){return null!=B?(x.offset=B,x):null};a.getVerticalOffsetTerrain=function(B){return null!=B?(A.offset=B,A):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(C,E,F=f.defaultConstraintOptions,M=!0){B.eyeCenterDistance=0;B.requiresTwoSteps=!1;const K=l(C,E,F,void 0,B);if(0===K)return!1;y.fromRotation(r,-K,E.viewRight);switch(F.tiltMode){case h.TiltMode.LOOK_AROUND:u.transformMat4(w,E.viewForward,r);u.scale(w,w,B.eyeCenterDistance);E.center=u.add(x,E.eye,w);break;case h.TiltMode.TUMBLE:u.subtract(w,E.center,E.eye);u.transformMat4(w,w,r);E.eye=u.subtract(x,E.center,w);break;default:b.neverReached(F.tiltMode)}E.up=
u.transformMat4(x,E.up,r);return B.requiresTwoSteps&&M?n(C,E,F,!1):!0}function l(C,E,F=f.defaultConstraintOptions,M=f.defaultConstraintOptions,K){if(!C.state.constraints.tilt)return 0;var G=C.state.constraints.tilt(E.distance,A);if(F.interactionType!==e.InteractionType.NONE){var {interactionStartCamera:L,interactionFactor:O}=F;if(L){var {min:I,max:H}=G,J=l(C,L,f.defaultConstraintOptions,F),N=0===J?0:z.viewAngle(C.renderCoordsHelper,L.center,L.eye);G.min=I;G.max=H;F.interactionType===e.InteractionType.TUMBLE?
(f.hasConstraintType(F.selection,g.ConstraintTypes.ALTITUDE)&&t(C,L,G),f.adjustRangeForInteraction(J,N,!0,O,D,G)):f.adjustRangeForInteraction(J,N,!1,O,D,G)}}M.interactionType===e.InteractionType.TUMBLE&&f.hasConstraintType(M.selection,g.ConstraintTypes.ALTITUDE)&&t(C,M.interactionStartCamera,G);if(F.tiltMode===h.TiltMode.LOOK_AROUND||M.tiltMode===h.TiltMode.LOOK_AROUND){a:{K&&(K.requiresTwoSteps=!1);switch(C.viewingMode){case "global":F=v;J=C.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
M=J+k.getReferenceEllipsoid(C.spatialReference).radius;J=C.renderCoordsHelper.intersectManifold(E.ray,J,x);F.eyeCenterDistance=E.distance;F.centerIsOnSurface=!1;null!=J?(F.eyeCenterDistance=u.distance(E.eye,J),F.tiltAtCenter=z.viewAngle(C.renderCoordsHelper,J,E.eye),F.centerIsOnSurface=!0):C.state.isLocal?F.tiltAtCenter=z.viewAngle(C.renderCoordsHelper,E.center,E.eye):(d.closestPointOnSilhouette(d.fromRadius(d.tmpSphere,M),E.ray,x),F.eyeCenterDistance=u.distance(E.eye,x),F.tiltAtCenter=c.acosClamped(-u.dot(E.viewForward,
u.normalize(x,x))));F.radius=M;F.eyeRadius=u.length(E.eye);F.constraints=C.state.constraints;E=c.clamp(F.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(F.tiltAtCenter-E)){if(F.centerIsOnSurface){{const {constraints:R,eyeCenterDistance:W,tiltAtCenter:T}=F;E=T;C=R.clampTilt(W,T);G=m(F,C);if(R.clampTilt(G,T)!==C)for(G=0;10>G&&1E-9<Math.abs(C-E);)M=(E+C)/2,J=m(F,M),J=R.clampTilt(J,M),1E-9<Math.abs(J-M)?E=M:C=M,G++;E=C}G=E;C=c.asinClamped(F.radius/F.eyeRadius*Math.sin(F.tiltAtCenter));G=c.asinClamped(F.radius/
F.eyeRadius*Math.sin(G));C=F.eyeRadius>F.radius?C-G:G-C}else E=F.constraints.clampTilt(F.eyeCenterDistance,F.tiltAtCenter),K&&E<Math.PI/2&&(K.requiresTwoSteps=!0,E=Math.PI/2-1E-5),C=F.tiltAtCenter-Math.PI/2-(E-Math.PI/2);K&&(K.eyeCenterDistance=m(F,E));K=C}else K=0;break a;case "local":M=z.viewAngle(C.renderCoordsHelper,E.center,E.eye);F=c.clamp(M,G.min,G.max);G=M-F;1E-9<Math.abs(G)?(K&&(M=C.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,C=C.renderCoordsHelper.getAltitude(E.eye)-
M,F=Math.cos(F),K.eyeCenterDistance=1E-4<Math.abs(F)?C/F:E.distance),K=G):K=0;break a}K=void 0}return K}K=z.viewAngle(C.renderCoordsHelper,E.center,E.eye);F=c.clamp(K,G.min,G.max);K-=F;K=1E-9<Math.abs(K)?K:0;return K}function m(C,E){if(!C.centerIsOnSurface)return C.eyeCenterDistance;E=Math.PI-c.clamp(E,0,Math.PI);const F=c.asinClamped(C.radius/C.eyeRadius*Math.sin(E)),M=Math.sin(Math.PI-E-F)/Math.sin(E);return C.eyeRadius<C.radius&&1<M?Math.sin(Math.PI-E-(Math.PI-F))/Math.sin(E)*C.eyeRadius:M*C.eyeRadius}
function t(C,E,F){var M=C.state.constraints;if(!C.state.isLocal&&M.altitude&&E){var K=u.squaredLength(E.center),G=Math.sqrt(K);E=E.distance;var L=k.getReferenceEllipsoid(C.spatialReference).radius;C=M.altitude.min+L;M=M.altitude.max+L;C=(C*C-E*E-K)/(-2*G*E);F.min=Math.max(F.min,Math.min(Math.PI-c.acosClamped((M*M-E*E-K)/(-2*G*E)),F.max));F.max=Math.min(F.max,Math.PI-c.acosClamped(C))}}const w=q.create(),r=p.create(),x=q.create(),D=c.deg2rad(5),A={min:0,max:0},v={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},B={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=n;a.getTiltConstraintError=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,y){const p=y.create(),u=y.create();a.viewAngle=function(q,k,d){q.worldUpAtPosition(k,p);c.subtract(u,d,k);q=c.length(u);
return 0===q?0:b.acosClamped(c.dot(u,p)/q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(R){return R}function c(R){const W=2*(R-Math.sqrt((R-1)*R)),T=W/2/R;return P=>P<T?R*P*P:W*P-W+1}function y(R,W){return(T,P)=>T<W?W*R(T/W,P):1-R((1-T)/(1-W),P)*(1-W)}const p=R=>R*R,u=R=>1-p(1-R),q=R=>.5>R?p(2*R)/2:(1-p(1-2*(R-.5))+1)/2,k=R=>R*R*R,d=R=>1-k(1-R),f=R=>.5>R?k(2*R)/2:(1-k(1-2*(R-.5))+1)/2,g=R=>R*R*R*
R,e=R=>1-g(1-R),h=R=>.5>R?g(2*R)/2:(1-g(1-2*(R-.5))+1)/2,z=R=>R*R*R*R*R,n=R=>1-z(1-R),l=R=>.5>R?z(2*R)/2:(1-z(1-2*(R-.5))+1)/2,m=R=>-Math.cos(R*Math.PI/2)+1,t=R=>1-m(1-R),w=R=>.5>R?m(2*R)/2:(1-m(1-2*(R-.5))+1)/2,r=R=>2**(10*(R-1)),x=R=>1-2**(10*(1-R-1)),D=R=>.5>R?2**(10*(2*R-1))/2:(1-2**(10*(1-2*(R-.5)-1))+1)/2,A=R=>-(Math.sqrt(1-R*R)-1),v=R=>1-A(1-R),B=R=>.5>R?A(2*R)/2:(1-A(1-2*(R-.5))+1)/2,C=y(c(1),1),E=y(c(1),0),F=y(c(1),.5),M=y(c(2),1),K=y(c(2),0),G=y(c(2),.5),L=y(c(3),1),O=y(c(3),0),I=y(c(3),
.5),H=y(c(4),1),J=y(c(4),0),N=y(c(4),.5);a.EasingFunctions={linear:b,"in-quad":p,"out-quad":u,"in-out-quad":q,"in-coast-quad":C,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":k,"out-cubic":d,"in-out-cubic":f,"in-coast-cubic":M,"out-coast-cubic":K,"in-out-coast-cubic":G,"in-quart":g,"out-quart":e,"in-out-quart":h,"in-coast-quart":L,"out-coast-quart":O,"in-out-coast-quart":I,"in-quint":z,"out-quint":n,"in-out-quint":l,"in-coast-quint":H,"out-coast-quint":J,"in-out-coast-quint":N,"in-sine":m,"out-sine":t,
"in-out-sine":w,"in-expo":r,"out-expo":x,"in-out-expo":D,"in-circ":A,"out-circ":v,"in-out-circ":B};a.inCirc=A;a.inCoastCubic=M;a.inCoastQuad=C;a.inCoastQuart=L;a.inCoastQuint=H;a.inCubic=k;a.inExpo=r;a.inOutCirc=B;a.inOutCoastCubic=G;a.inOutCoastQuad=F;a.inOutCoastQuart=I;a.inOutCoastQuint=N;a.inOutCubic=f;a.inOutExpo=D;a.inOutQuad=q;a.inOutQuart=h;a.inOutQuint=l;a.inOutSine=w;a.inQuad=p;a.inQuart=g;a.inQuint=z;a.inSine=m;a.linear=b;a.outCirc=v;a.outCoastCubic=K;a.outCoastQuad=E;a.outCoastQuart=O;
a.outCoastQuint=J;a.outCubic=d;a.outExpo=x;a.outQuad=u;a.outQuart=e;a.outQuint=n;a.outSine=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){a.PointToPointAnimationController=function(t){function w(x){x=t.call(this,x)||this;x.mode="interaction";x._hasTarget=!1;return x}b._inherits(w,t);var r=w.prototype;r.initialize=function(){this.animation=new g.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new f};r.begin=function(x,D){this._hasTarget=!0;D=this.animationSettings(D);l.copyFrom(this.view.state.camera);const A=z.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(l.ray,A,m)&&(l.center=m);this.animation.update(l,x,D);this.animation.finished&&this.finish()};r.finish=function(){this.animation.currentTime=this.animation.time;b._get(b._getPrototypeOf(w.prototype),"finish",this).call(this)};r.stepController=function(x,D){this._hasTarget&&this.animation.step(x,D)};r.onControllerEnd=function(x){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,x),this.animation.currentTime=this.animation.time);
b._get(b._getPrototypeOf(w.prototype),"onControllerEnd",this).call(this,x)};r.animationSettings=function(x={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...x,easing:"string"===typeof x.easing?n.EasingFunctions[x.easing]:x.easing}};b._createClass(w,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",
get:function(){return this._hasTarget&&this.animation.finished}}]);return w}(e.AnimationController);c.__decorate([y.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);c.__decorate([y.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=c.__decorate([k.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const l=new h.Camera,m=d.create();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,b,c,y,p,u,q,k){const d=p.create();p=function(){function f(e){this.currentTime=c.Milliseconds(0);this._animation=new k.Animation(()=>new u(e));
this._current=new u(e)}var g=f.prototype;g.update=function(e,h,z){const n=this._animation.definition.source,l=this._animation.definition.target,m=y.subtract(d,h.center,e.center),t=y.length(m);1E-5<=t?(m[0]/=t,m[1]/=t,m[2]/=t):(m[0]=0,m[1]=1,m[0]=0);y.copy(n.lookAtDirection,m);y.copy(l.lookAtDirection,m);n.copyFromRenderCamera(e);l.copyFromRenderCamera(h);this._current.copyFrom(n);this._animation.update(n,l,z);this.currentTime=c.Milliseconds(0);e.almostEquals(h)&&(this.currentTime=this._animation.time)};
g.cameraAt=function(e,h){this._animation.cameraAt(e,this._current);h=h||new q.Camera;this._current.copyToRenderCamera(h);return h};g.step=function(e,h){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,h)};b._createClass(f,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);
return f}();a.Animation=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,c,y,p,u,q,k){const d=u.create(),f=u.create(),g=u.create(),e=u.create(),h=u.create(),z=u.create();var n=
u.fromValues(0,0,1),l=u.fromValues(0,1,0),m=u.fromValues(1,0,0);const t=y.create();return function(){function w(x=q.ViewingMode.Global){this.viewingMode=x;this.center=u.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=u.clone(l)}var r=w.prototype;r.pixelsPerPanAtZoom=function(x){return this.size/2/(this._zoomToPanScale*x)};r.zoomAtPixelsPerPan=function(x){return this.size/2/(this._zoomToPanScale*x)};r.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),
.5)};r.compareTo=function(x,D){D||(D={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===q.ViewingMode.Global){var A=p.length(this.center);const v=p.length(x.center);A=(A+v)/2;D.pan=k.angle(this.center,x.center)*A}else D.pan=p.distance(this.center,x.center);A=Math.abs(x.yaw-this.yaw);A>=Math.PI&&(A=2*Math.PI-A);D.rotate=Math.max(A,Math.abs(x.pitch-this.pitch));D.sourceZoom=this.distance;D.targetZoom=x.distance;return D};r.interpolate=function(x,D,A){this.viewingMode===q.ViewingMode.Global?
k.slerp(x.center,D.center,A.pan,this.center):p.lerp(this.center,x.center,D.center,A.pan);this.distance=isFinite(D.distance)?b.lerp(x.distance,D.distance,A.zoom):x.distance;this.pitch=b.lerp(x.pitch,D.pitch,A.rotate);x=x.yaw;D=D.yaw;Math.abs(D-x)>=Math.PI&&(x+=2*(x<D?1:-1)*Math.PI);this.yaw=b.lerp(x,D,A.rotate)};r.copyFrom=function(x){p.copy(this.center,x.center);this.pitch=x.pitch;this.yaw=x.yaw;this.distance=x.distance;p.copy(this.lookAtDirection,x.lookAtDirection);this.size=x.size;this.copyFromCommon(x);
this.viewingMode=x.viewingMode};r.copyFromRenderCamera=function(x){const D=this._lookAtOrientation(x.center,t);p.copy(this.center,x.center);p.subtract(e,x.center,x.eye);p.transformMat3(e,e,D);p.transformMat3(h,x.up,D);this.distance=p.length(e);0!==this.distance&&(e[0]/=this.distance,e[1]/=this.distance,e[2]/=this.distance);this.pitch=this._eyeUpToPitch(e);this.yaw=this._eyeUpToYaw(e,h);this.size=Math.sqrt(x.width*x.width+x.height*x.height);this.copyFromCommon(x)};r.copyFromCommon=function(x){this.fov=
x.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};r.copyToRenderCamera=function(x){const D=this._lookAtOrientation(this.center,t);c.transpose(D,D);this._axisAngleVec3(m,this.pitch-Math.PI/2,l,e);this._axisAngleVec3(n,this.yaw,e);this._axisAngleVec3(m,this.pitch-Math.PI/2,n,h);this._axisAngleVec3(n,this.yaw,h);p.scale(e,e,this.distance);p.transformMat3(e,e,D);p.transformMat3(h,h,D);x.center=this.center;x.eye=p.subtract(e,this.center,e);x.up=h};r._axisAngleVec3=function(x,D,A,v=A){const B=Math.cos(D);
D=Math.sin(D);p.scale(d,A,B);p.cross(f,x,A);p.scale(f,f,D);p.scale(g,x,(1-B)*p.dot(x,A));return p.add(v,p.add(v,d,f),g)};r._lookAtOrientation=function(x,D=y.create()){this._upAtLookAt(x,g);p.cross(d,this.lookAtDirection,g);p.normalize(d,d);0===d[0]&&0===d[1]&&0===d[2]&&p.copy(d,m);p.cross(f,g,d);p.normalize(f,f);D[0]=d[0];D[1]=f[0];D[2]=g[0];D[3]=d[1];D[4]=f[1];D[5]=g[1];D[6]=d[2];D[7]=f[2];D[8]=g[2];return D};r._upAtLookAt=function(x,D){return this.viewingMode===q.ViewingMode.Local?p.copy(D,n):p.normalize(D,
x)};r._eyeUpToPitch=function(x){return Math.PI-k.angle(n,x)};r._eyeUpToYaw=function(x,D){.5>Math.abs(D[2])?(p.copy(z,D),0<x[2]&&p.scale(z,z,-1)):p.copy(z,x);p.cross(f,z,n);p.normalize(f,f);return k.angle(m,f,n)};return a._createClass(w)}()})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,b,c,y,p,u,q){const k={zoom:0,pan:0,rotate:0};let d=function(){function f(e){this._createCamera=
e;this._time=c.Milliseconds(0);this.definition=new p.Definition(e);this.path=new q.Path}var g=f.prototype;g.update=function(e,h,z){this.definition.update(e,h,z);this.path.update(this.definition,z);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:c.Seconds(0)),z);this._easing=z.easing??(1E3<=this._time?y.inOutCoastQuad:y.outExpo)};g.cameraAt=function(e,h){h=h||this._createCamera();e=Math.min(Math.max(0,e),1);e=this._normalizedEasing(e);e=this.path.interpolateComponentsAt(e,
k);h.interpolate(this.definition.source,this.definition.target,e);return h};g._normalizedEasing=function(e){const h=this._easing(0,this._time),z=this._easing(1,this._time);return(this._easing(e,this._time)-h)/(z-h)};g._applyTimeSettings=function(e,h){const z=null!=h.speedFactor?h.speedFactor:1;null!=h.duration?e=h.duration:null!=h.speedFactor&&(e=c.Milliseconds(e/z));return c.Milliseconds(Math.min(Math.max(null!=h.minDuration?h.minDuration:u.defaultSettings.minDuration/z,e),null!=h.maxDuration?h.maxDuration:
u.defaultSettings.maxDuration/z))};b._createClass(f,[{key:"time",get:function(){return this._time}}]);return f}();a.Animation=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,b,c){let y=function(){function p(q){this._createCamera=q;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};
this.source=q();this.target=q()}var u=p.prototype;u.clone=function(){const q=new p(this._createCamera);q.copyFrom(this);return q};u.copyFrom=function(q){this.update(q.source,q.target,q.settings)};u.update=function(q,k,d){this.source!==q&&this.source.copyFrom(q);this.target!==k&&this.target.copyFrom(k);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=d.desiredScreenFlow?d.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=
this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};u.halfWindowPanAtZoom=function(q){q=this.target.pixelsPerPanAtZoom(q);return this.halfWindowSize/q};b._createClass(p,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return p}();a.Definition=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),function(a,b,c,y,p,u){y=function(q){function k(f,
g){var e=q.call(this)||this;e._preallocSegments=[new p.Segment,new p.Segment,new p.Segment];e._ascensionSegment=null;e._descensionSegment=null;e.update(f,g);return e}b._inherits(k,q);var d=k.prototype;d.update=function(f,g){if(f){this.definition?this.definition.copyFrom(f):this.definition=f.clone();var e=null;g&&g.apex&&(e=u.optimalDistance(f,g.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==e?this._updateWithoutApex():this._updateWithApex(e,g?.apex)}};d.segmentInterpolateComponentsAt=
function(f,g,e){e=f.interpolateComponentsAt(g,e);f===this._ascensionSegment?e.zoom=c.outQuad(e.zoom):f===this._descensionSegment&&(e.zoom=c.inQuad(e.zoom));return e};d._updateWithApex=function(f,g){const [e,h,z]=this._preallocSegments,n=g?.ascensionFactor??.5;g=Math.min(1-n,null!=g?.ascensionFactor&&null!=g.descensionFactor?g.descensionFactor:.5);const l=1-n-g;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();e.definition.compared.targetZoom=f;e.definition.compared.pan=
this.definition.compared.pan*n;e.definition.compared.rotate=this.definition.compared.rotate*n;e.update();this._ascensionSegment=e;this.segments.push(e);0<l&&(h.definition?h.definition.copyFrom(this.definition):h.definition=this.definition.clone(),h.definition.copyFrom(this.definition),h.definition.compared.sourceZoom=f,h.definition.compared.targetZoom=f,h.definition.compared.pan=this.definition.compared.pan*l,h.definition.compared.rotate=this.definition.compared.rotate*l,h.update(),this.segments.push(h));
z.definition?z.definition.copyFrom(this.definition):z.definition=this.definition.clone();z.definition.compared.sourceZoom=f;z.definition.compared.pan=this.definition.compared.pan*g;z.definition.compared.rotate=this.definition.compared.rotate*g;z.update();this._descensionSegment=z;this.segments.push(z)};d._updateWithoutApex=function(){const [f]=this._preallocSegments;f.update(this.definition);this.segments.push(f)};return b._createClass(k)}(y.Path);a.Path=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let y=function(){function p(){this.segments=[]}var u=p.prototype;u.interpolateComponentsAt=function(q,k){q=Math.min(Math.max(q,0),1);q*=this.time;let d=0,f=0;const g=this.definition;for(let e=0;e<this.segments.length;e++){const h=this.segments[e],z=h.definition;if(q<=h.time||e===this.segments.length-1)return k=this.segmentInterpolateComponentsAt(h,
0===h.time?0:q/h.time,k),g.hasPan&&!isNaN(k.pan)&&isFinite(g.compared.pan)?k.pan=(d+z.compared.pan*k.pan)/g.compared.pan:k.pan=1,g.hasRotate&&!isNaN(k.rotate)&&isFinite(g.compared.rotate)?k.rotate=(f+z.compared.rotate*k.rotate)/g.compared.rotate:k.rotate=1,g.hasZoom&&!isNaN(k.zoom)&&isFinite(z.compared.targetZoom)?(q=this.segments[0].definition.compared.sourceZoom,k.zoom=(k.zoom*(z.compared.targetZoom-z.compared.sourceZoom)+z.compared.sourceZoom-q)/(this.segments[this.segments.length-1].definition.compared.targetZoom-
q)):k.zoom=1,k;q-=h.time;d+=z.compared.pan;f+=z.compared.rotate}};u.segmentInterpolateComponentsAt=function(q,k,d){return q.interpolateComponentsAt(k,d)};b._createClass(p,[{key:"time",get:function(){return this.segments.reduce((q,k)=>c.Seconds(q+k.time),c.Seconds(0))}}]);return p}();a.Path=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,
b,c){let y=function(){function p(q){q&&this.update(q)}var u=p.prototype;u.update=function(q){q&&(this.definition?this.definition.copyFrom(q):this.definition=q.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};u._updatePrecomputedVariables=function(){var q=this.definition;const k=q.compared,d=k.sourceZoom,f=k.targetZoom;this._zoomSign=d>f?1:-1;this._panPixelsAtSource=k.pan*q.source.pixelsPerPanAtZoom(d);q=(q.source.pixelsPerRotateAtZoom(d)+q.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=
k.rotate*q};u._updatePixelFlow=function(){var q=this.definition.compared.sourceZoom,k=this.definition.compared.targetZoom;const {hasZoom:d,hasPan:f,hasRotate:g}=this.definition;var e=0,h=0;d&&(f&&(e=(k/q-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),g&&(h=Math.log(q/k)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;q=this.definition.desiredPixelFlow;d&&f&&g?(k=e+
h+e*h,this._zoomPixelFlow=e*h/k*q,this._panPixelFlow=h/k*q,this._rotatePixelFlow=e/k*q):d&&f?(h=1+e,this._zoomPixelFlow=e/h*q,this._panPixelFlow=1/h*q):d&&g?(e=1+h,this._zoomPixelFlow=h/e*q,this._rotatePixelFlow=1/e*q):f&&g?(e=this._panPixelsAtSource/this._rotatePixels,h=1+e,this._panPixelFlow=e/h*q,this._rotatePixelFlow=1/h*q):f?this._panPixelFlow=q:d?this._zoomPixelFlow=q:g&&(this._rotatePixelFlow=q);this._time=g?this.rotateTime:d?this.zoomTime:f?this.panTime:c.Seconds(0)};u._interpolateComponentsZoom=
function(q){if(0===q||1===q)return q;if(this.definition.hasZoom){const k=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(k*(k/d)**-q-k)/(d-k)}return q};u._interpolateComponentsPan=function(q){if(0===q||1===q)return q;if(this.definition.hasPan&&this.definition.hasZoom){const k=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(k*q*this._time)-1)/(k*Math.LN2)}return q};u._interpolateComponentsRotate=
function(q){return q};u.interpolateComponentsAt=function(q,k){q=Math.min(Math.max(q,0),1);const d=this._interpolateComponentsZoom(q),f=this._interpolateComponentsPan(q);q=this._interpolateComponentsRotate(q);k?(k.zoom=d,k.pan=f,k.rotate=q):k={zoom:d,pan:f,rotate:q};return k};b._createClass(p,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?
c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):c.Seconds(0)}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const q=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*q+1)/(q*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);
return p}();a.Segment=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function c(y,p){const u=Math.max(y.compared.sourceZoom,y.compared.targetZoom);y=y.source.zoomAtPixelsPerPan(y.desiredPixelFlow/y.compared.pan)/2;return y<u?null!=p.maximumDistance?u+(p.maximumDistance-u)/2:1.5*u:p.maximumDistance?Math.min(p.maximumDistance,y):y}a.optimalDistance=function(y,p){let u=c(y,p);
const q={ascensionFactor:null!=p.ascensionFactor?p.ascensionFactor:.5,descensionFactor:null!=p.descensionFactor?p.descensionFactor:.5};var k=0===q.ascensionFactor,d=0===q.descensionFactor;const f=k?b.tAscensionZoomOnly:b.tAscensionZoomPan,g=k?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,e=k?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,h=d?b.tDescensionZoomOnly:b.tDescensionZoomPan,z=d?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,n=d?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;k=D=>f(y,D,q)+b.tPanion(y,
D,q)+h(y,D,q);d=D=>g(y,D,q)+b.dtPanion(y,D,q)+z(y,D,q);const l=D=>e(y,D,q)+b.ddtPanion(y,D,q)+n(y,D,q);let m=k(u);const t=b.tBaseLine(y),w=p.maximumIterations||20,r=null!=p.maximumDistance?p.maximumDistance:Infinity;for(p=0;p<w;p++){var x=(d(u)+1E-6)/l(u);if(isNaN(x)||u>=r&&0>x){if(!isFinite(r))return null;u=r;m=k(u);break}u-=x;if(u<y.compared.sourceZoom||u<y.compared.targetZoom)return null;x=k(u);if(.005>=Math.abs(x-m)/m)break;m=x}return m>.7*t||u<y.compared.sourceZoom||u<y.compared.targetZoom?null:
u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,c,y){const p=c-b.compared.sourceZoom,u=1/p,q=1/c,k=Math.log(b.compared.sourceZoom*q);y=(y.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(p))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*u*(-2*u*
q*y+2*u*k+2*q-2*k*y/(p*p)-y/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,c,y){const p=c-b.compared.targetZoom,u=1/p,q=1/c,k=Math.log(c/b.compared.targetZoom);y=(b.halfWindowPanAtZoom(c)+y.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*u*(-2*u*q*y-2*u*k+2*q+2*k*y/(p*p)-y/(c*c))/(b.desiredPixelFlow*
Math.LN2)};a.ddtPanion=function(b,c,y){return-2*b.compared.pan*b.halfWindowSize*(y.ascensionFactor+y.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c*c))};a.dtAscensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,c,y){const p=1/c,u=Math.log(b.compared.sourceZoom*p),q=1/b.desiredPixelFlow,k=1/Math.LN2;c-=b.compared.sourceZoom;const d=1/c;y=(y.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);
return b.halfWindowSize*p*q*k*d*y-b.halfWindowSize*u*q*k*d+b.halfWindowSize*u*q*k*y/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,c,y){const p=Math.log(c/b.compared.targetZoom),u=1/b.desiredPixelFlow,q=1/Math.LN2,k=-c+b.compared.targetZoom,d=1/k;y=(-b.halfWindowPanAtZoom(c)-y.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*
p*u*q*d+b.halfWindowSize*p*u*q*y/(k*k)+b.halfWindowSize*u*q*d*y/c};a.dtPanion=function(b,c,y){return b.compared.pan*b.halfWindowSize*(y.ascensionFactor+y.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,y){const p=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(y.ascensionFactor*Math.LN2*b.compared.pan+
p)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2*p)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,y=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),p=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*y);return b.compared.sourceZoom<=b.compared.targetZoom?p*(c-y):p*(c+y)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=
function(b,c,y){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-y.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=function(b,c,y){return-b.compared.pan*b.halfWindowSize*(y.ascensionFactor+y.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.AnimationController=function(z){function n(){var m=z.apply(this,arguments)||this;m._asyncResult=null;return m}b._inherits(n,z);var l=n.prototype;l.onControllerStart=function(){this.state=h.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};l.updateStateFromViewAnimation=function(){null==this.viewAnimation||this.state!==h.State.Ready&&this.state!==h.State.Running||(this.viewAnimation.state===
e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=h.State.Stopped))};l.onControllerEnd=function(){null==this.viewAnimation||this.viewAnimation.done||(this.state===h.State.Finished?this.viewAnimation.finish():this.state===h.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===h.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(p.createAbortError()))};l.finish=function(){this.finishController()};b._createClass(n,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(m){this._asyncResult&&(this._asyncResult.reject(p.createAbortError()),this._asyncResult=null);this.state===h.State.Finished||this.state===h.State.Stopped?(y.assertIsSome(m),this.state===h.State.Finished?m.resolve():m.reject(p.createAbortError())):this._asyncResult=m}}]);return n}(h.CameraController);a.AnimationController=c.__decorate([g.subclass("esri.views.3d.state.controllers.AnimationController")],
a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,
d){a.State=void 0;(function(f){f.Ready="ready";f.Rejected="rejected";f.Running="running";f.Stopped="stopped";f.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(f){function g(h){h=f.call(this,h)||this;h.state=a.State.Ready;return h}b._inherits(g,f);var e=g.prototype;e.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};e.finishController=function(){this.state=a.State.Finished};b._createClass(g,[{key:"active",get:function(){return this.state===a.State.Running}},
{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return g}(y);c.__decorate([p.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);c.__decorate([p.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([p.property()],a.CameraController.prototype,"state",void 0);c.__decorate([p.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=
c.__decorate([d.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){function x(sa,pa,ka){ka=p.fromRotation(l.sm4d.get(),ka[3],g.axis(ka));null==ka||p.exactEquals(ka,u.IDENTITY)||(d.subtract(ba,sa.eye,pa),d.transformMat4(ba,ba,ka),sa.eye=d.add(ba,ba,pa),d.subtract(ba,sa.center,pa),d.transformMat4(ba,ba,ka),sa.center=d.add(ba,ba,pa),sa.up=d.transformMat4(ba,sa.up,ka))}function D(sa,pa,ka,ra){return Math.sin(sa/d.length(pa))*(ka+ra.radius)}function A(sa,pa,ka,ra){ka=m.fromScreenAtEye(pa,ka,qa);if(null==ka)return!1;z.closestPointOnSilhouette(sa,
ka,R);return z.intersectRay(sa,ka,ra)?d.squaredDistance(R,ka.origin)<d.squaredDistance(ra,ka.origin)?(d.copy(ra,R),!1):!0:(d.subtract(W,pa.eye,pa.center),d.normalize(W,W),h.fromNormalAndOffset(W,-d.dot(d.normalize(W,W),R),T),h.intersectRay(T,ka,ra),!1)}function v(sa,pa,ka,ra,va,Ca){var Ba=0;d.cross(ca,sa,pa);d.subtract(aa,sa,pa);d.length(sa)<=va||!ra.aboveGround?(d.cross(ka,aa,ra.eye),Ba=d.dot(sa,pa)/(d.length(sa)*d.length(pa)),.9999>Ba?Ba=c.acosClamped(Ba):(sa=d.length(d.cross(f.create(),sa,pa))/
(d.length(sa)*d.length(pa)),Ba=c.asinClamped(sa)),Ca=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ca)),0,J)),Ba=-Ba-Math.max(0,d.length(pa)-va)/(Ca*va)):(d.subtract(P,ra.eye,ra.center),d.cross(ka,aa,P),Ba=-d.length(aa)/va);d.normalize(ka,ka);d.scale(ka,ka,d.length(ca));return Ba}function B(sa,pa,ka,ra){ra=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(ra)),0,J));pa=pa>ka?-(pa-ka)/(ra*ka):pa<-ka?Math.PI-(pa+ka)/(ra*ka):c.acosClamped(pa/ka);return((sa>ka?-(sa-ka)/(ra*ka):sa<-ka?Math.PI-(sa+
ka)/(ra*ka):c.acosClamped(sa/ka))-pa)*ka}function C(sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa){Ha=B(sa[2],pa[2],Ca[3],Ha);pa=Ma?B(sa[0],pa[0],Ca[3],180):pa[0]-sa[0];sa=Math.sin(Ba)*pa-Math.cos(Ba)*Ha;Ba=Math.cos(Ba)*pa+Math.sin(Ba)*Ha;d.normalize(ba,va);va=Ma?sa/Math.sqrt(Math.abs(Ca[3]**2-d.dot(ka,ba)**2)):sa/Ca[3];ka=Ba/Math.sqrt(Math.abs(Ca[3]**2-d.dot(ka,ra)**2));q.set(Qa,va,ka)}function E(sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa){d.cross(ca,sa,pa);e.coordinateSystemFromOneAxisAndNormalVector(Ca.up,Ca.eye,V,X,Y);e.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ca.eye,Q,S,U);d.copy(ka,S);d.copy(ra,Q);d.normalize(ka,ka);d.scale(ka,ka,d.length(ca));e.vectorCoordinates(sa,d.normalize(X,X),d.normalize(Y,Y),d.normalize(V,V),Z);e.vectorCoordinates(pa,X,Y,V,ea);C(Z,ea,sa,Q,S,Ba,Ha,Ma,Qa,va)}function F(sa,pa,ka,ra,va,Ca,Ba){p.fromRotation(ia,va,ra);p.fromRotation(oa,Ba,Ca);p.multiply(ma,ia,oa);d.subtract(pa,sa,ka);d.transformMat4(pa,pa,ma);d.add(pa,pa,ka)}function M(sa,pa,ka,ra,va,Ca){p.fromRotation(ia,ra,ka);p.fromRotation(oa,Ca,va);p.multiply(ma,ia,oa);d.subtract(ba,
sa.eye,pa);d.transformMat4(ba,ba,ma);sa.eye=d.add(ba,ba,pa);d.subtract(ba,sa.center,pa);d.transformMat4(ba,ba,ma);sa.center=d.add(ba,ba,pa);d.subtract(ba,sa.up,pa);d.transformMat4(ba,ba,ma);sa.up=d.add(ba,ba,pa)}function K(sa,pa,ka,ra,va,Ca){return(Math.abs(ra)>Math.PI-H.Angle||Math.abs(ra)<H.Angle)&&(Math.abs(sa[2])<ka*H.Pole||Math.abs(pa)>ka)&&Ca.aboveGround&&va<H.Tilt}function G(sa,pa,ka,ra,va,Ca){Ca?(g.fromPoints(ka,ra,ha),x(pa,sa,ha)):(ka=v(ka,ra,na,pa,sa[3],va),x(pa,sa,g.wrapAxisAngle(na,ka)))}
function L(sa,pa,ka,ra,va,Ca,Ba){const Ha=Ba?20:1;d.copy(fa,ra);da.copyFrom(pa);let Ma;for(let Qa=0;Qa<Ha&&1E-12<d.squaredDistance(ka,fa);Qa++)if(ra=d.squaredDistance(ka,fa),E(ka,fa,S,Q,ja,da,sa,va,Ca,Ba),M(da,sa,Q,ja[1],S,ja[0]),F(fa,fa,sa,Q,ja[1],S,ja[0]),Ma=d.squaredDistance(ka,fa),Ma<ra||0===Qa)pa.copyFrom(da);else break}a.SpherePickPointFallback=void 0;(function(sa){sa[sa.Ellipsoid=0]="Ellipsoid";sa[sa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||(a.SpherePickPointFallback={}));r=
{exclude:new Set([r.TERRAIN_ID])};const O=y.createScreenPointArray();a.NavigationMode=void 0;(function(sa){sa[sa.Vertical=0]="Vertical";sa[sa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const I={Elevation:3E4,Angle:c.deg2rad(16)},H={Pole:.95,Angle:c.deg2rad(18),Tilt:45},J=c.deg2rad(80),N=f.create(),R=f.create(),W=f.create(),T=h.create(),P=f.create(),Q=f.create(),S=f.create(),U=f.create(),V=f.create(),X=f.create(),Y=f.create(),Z=f.create(),ea=f.create(),ja=k.create(),ha=g.create(),
ia=u.create(),oa=u.create(),ma=u.create(),fa=f.create(),ba=f.create(),aa=f.create(),da=new w.Camera,ca=f.create(),na=f.create(),qa={origin:f.create(),direction:f.create()},ua={origin:f.create(),direction:f.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.MIN_HEIGHT_LIMIT=50;a.PAN_DISTANCE_MODIFIER=5;a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=H;a.ROTATE_PIVOT_DISTANCE_MODIFIER=5;a.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER=10;a.ROTATE_SCREEN_PIXEL_AREA=90;a.SCREEN_PIXEL_AREA=80;a.TiltThresholdPanningSpeed=
J;a.VerticalPanTresholds=I;a.ZOOM_DISTANCE_MODIFIER=8;a.ZOOM_MAX_DISTANCE_MODIFIER=1508E5;a.ZOOM_MIN_DISTANCE_MODIFIER=200;a.applyPanPlanar=function(sa,pa,ka){d.subtract(N,ka,pa);sa.eye=d.subtract(ba,sa.eye,N);sa.center=d.subtract(ba,sa.center,N)};a.applyPanSphericalDirectRotation=G;a.applyPanSphericalPreserveHeading=L;a.applyRotation=x;a.applyRotationWithTwoAxes=M;a.applyZoomOnSphere=function(sa,pa,ka){pa.getScreenCenter(O);t.intersectScreen(sa,pa,O,ba)&&(pa.center=ba);sa=pa.distance;ka*=sa;1E-6>
Math.abs(sa-ka)||(ka=d.scale(l.sv3d.get(),pa.viewForward,ka),pa.eye=d.subtract(ba,pa.center,ka))};a.applyZoomToPoint=function(sa,pa,ka,ra){const va=l.sv3d.get();ka=1-ka;d.subtract(va,pa,sa.eye);const Ca=d.length(va);let Ba=Ca*(1-ka);0<=ka&&Ba<ra&&(Ba=ra,ka=-(Ba-Ca)/Ca);1E-6>Math.abs(Ca-Ba)||(d.scale(va,va,ka),sa.eye=d.add(ba,sa.eye,va),sa.center=d.lerp(ba,sa.center,pa,ka))};a.centroid=function(sa,pa){d.set(pa,0,0,0);for(const ka of sa)d.add(pa,pa,ka);d.scale(pa,pa,1/sa.length)};a.contentIntersectorOptions=
r;a.decideNavigationMode=function(sa,pa,ka){if(d.length(sa.eye)-ka.radius>I.Elevation)return a.NavigationMode.Horizontal;m.fromScreenAtEye(sa,pa,ua);return-Math.sign(sa.relativeElevation)*(.5*Math.PI+n.angle(sa.eye,ua.direction))<I.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(sa,pa,ka,ra){return h.intersectRay(sa,m.fromScreen(pa,ka,qa),ra)};a.intersectPlaneFromScreenPointAtEye=function(sa,pa,ka,ra){return h.intersectRay(sa,m.fromScreenAtEye(pa,
ka,qa),ra)};a.lengthFromPoints=B;a.normalizeCoordinate=function(sa,pa,ka){ka[0]=pa[0]/(sa.fullWidth/sa.pixelRatio);ka[1]=pa[1]/(sa.fullHeight/sa.pixelRatio);return ka};a.normalizeRotationDelta=function(sa){for(;sa>Math.PI;)sa-=2*Math.PI;for(;sa<-Math.PI;)sa+=2*Math.PI;return sa};a.offSurfaceTiltToEyeTiltGlobal=function(sa,pa,ka,ra){return D(Math.PI/2,pa,ka,ra)+(sa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=D;a.panMotionToRotationMatrix=function(sa,pa,ka,ra,va,Ca,Ba,Ha,Ma){if(K(sa.center,d.dot(sa.up,
sa.center),d.length(sa.center),-b.cyclicalPI.normalize(c.deg2rad(Ca)),Ba,pa))switch(sa=-b.cyclicalPI.normalize(c.deg2rad(va)),{eye:va}=pa,e.coordinateSystemFromOneAxisAndNormalVector([0,0,1],va,Q,S,U),va=ka.translation[0]*ra.pan,Ca="zoom"===Ma.mode?0:ka.translation[1]*ra.pan,pa=Math.max(Math.sqrt(Math.abs(1-d.dot(pa.center,Q)**2/d.length(pa.center)**2)),.5),Ba=-Math.cos(sa)*Ca+Math.sin(sa)*va,p.rotate(Ha.pan.matrix,Ha.pan.matrix,(Math.sin(sa)*Ca+Math.cos(sa)*va)/pa,Q),Ha.pan.enabled=!0,Ma.mode){case "pan":p.rotate(Ha.pan.matrix,
Ha.pan.matrix,Ba,S);Ha.pan.enabled=!0;break;case "zoom":Ha.zoom=-ka.translation[1]*ra.zoom}else{const {eye:Qa,viewRight:Sa}=pa;pa=d.cross(l.sv3d.get(),Sa,Qa);sa=ka.translation[0]*ra.pan;0!==sa&&(p.rotate(Ha.pan.matrix,Ha.pan.matrix,-sa,pa),Ha.pan.enabled=!0);switch(Ma.mode){case "pan":ka=ka.translation[1]*ra.pan;0!==ka&&(p.rotate(Ha.pan.matrix,Ha.pan.matrix,ka,Sa),Ha.pan.enabled=!0);break;case "zoom":Ha.zoom=-ka.translation[1]*ra.zoom}}};a.panToPosition=function(sa,pa,ka,ra,va,Ca,Ba){K(ka,d.dot(pa.up,
ka),sa[3],-b.cyclicalPI.normalize(c.deg2rad(va)),Ca,pa)?L(sa,pa,ka,ra,-b.cyclicalPI.normalize(c.deg2rad(va)),Ca,Ba):G(sa,pa,ka,ra,Ca,Ba)};a.pickPointAndInitSphere=function(sa,pa,ka,ra,va,Ca){const Ba=f.create(),Ha=z.create();let Ma=!0,Qa=!0;sa.intersectScreen(ka,Ba,Ca)?Ha[3]=d.length(Ba):(Qa=!1,Ha[3]=pa.aboveGround&&va!==a.SpherePickPointFallback.Ellipsoid?Math.max(d.length(pa.center),.9*ra.radius):d.length(pa.eye)-pa.relativeElevation,va===a.SpherePickPointFallback.Silhouette?A(Ha,pa,ka,Ba):Ma=t.intersectScreen(Ha,
pa,ka,Ba));return{sphere:Ha,scenePickPoint:Ma?Ba:null,hasGeometryIntersection:Qa}};a.preserveHeadingThreshold=K;a.rotatePointAroundTwoAxes=F;a.rotationAngleAndAxisDirectRotation=v;a.rotationAnglesAndAxesHeadingPreserving=E;a.rotationAnglesHeadingPreserving=C;a.sphereOrPlanePointFromScreenPoint=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,y,p,u){function q(h=f){return[h[0],h[1],h[2],h[3]]}function k(h,z,n,l,m=q()){m[0]=h;m[1]=z;m[2]=n;m[3]=l;return m}function d(h,z){h[3]=z;return h}const f=[0,0,1,0],g=c.create(),e=c.create();a.UP=f;a.angle=function(h){return h[3]};a.axis=function(h){return h};a.compose=function(h,z,n){b.setAxisAngle(g,h,h[3]);b.setAxisAngle(e,z,z[3]);b.multiply(g,e,g);return d(n,b.getAxisAngle(n,g))};a.copy=function(h,z=q()){return k(h[0],h[1],h[2],h[3],z)};a.create=q;a.fromAxisAndAngle=function(h,z){const n=
q();y.copy(n,h);n[3]=z;return n};a.fromPoints=function(h,z,n){y.cross(n,h,z);y.normalize(n,n);n[3]=p.angle(h,z);return n};a.fromValues=k;a.setAngle=d;a.wrap=function(h,z,n,l){return k(h,z,n,l,u.sv4d.get())};a.wrapAxisAngle=function(h,z){return k(h[0],h[1],h[2],z,u.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define(["exports","../../../../core/screenUtils","../../../../chunks/vec2","../../../../chunks/vec3","../../../../geometry/support/vectorStacks"],
function(a,b,c,y,p){function u(k,d,f){const g=b.castRenderScreenPointArray3(c.copy(p.sv3d.get(),d));g[2]=0;if(!k.unprojectFromRenderScreen(g,f.origin))return null;d=b.castRenderScreenPointArray3(c.copy(p.sv3d.get(),d));d[2]=1;k=k.unprojectFromRenderScreen(d,p.sv3d.get());if(null==k)return null;y.subtract(f.direction,k,f.origin);return f}function q(k,d,f){y.copy(f.origin,k.eye);d=y.set(p.sv3d.get(),d[0],d[1],1);k=k.unprojectFromRenderScreen(d,p.sv3d.get());if(null==k)return null;y.subtract(f.direction,
k,f.origin);return f}a.fromRender=u;a.fromRenderAtEye=q;a.fromScreen=function(k,d,f){return u(k,k.screenToRender(d,b.castRenderScreenPointArray3(p.sv3d.get())),f)};a.fromScreenAtEye=function(k,d,f){return q(k,k.screenToRender(d,b.castRenderScreenPointArray3(p.sv3d.get())),f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,c,
y){const p=b.create();a.intersectScreen=function(u,q,k,d){q=y.fromScreenAtEye(q,k,p);return c.intersectRay(u,q,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){a.ZoomStepController=function(C){function E(){var M=C.apply(this,arguments)||this;M._zoomLocation=h.create();M._tmpCamera=new r.Camera;M._tmpRayDir=h.create();M._tmpCenter=h.create();M._constraintOptions={selection:n.ConstraintTypes.ALL,interactionType:l.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new r.Camera,interactionDirection:null,tiltMode:m.TiltMode.TUMBLE};return M}b._inherits(E,C);var F=E.prototype;F.zoomStep=function(M,
K){if(this.active){var G=this.view.state,{interactionStartCamera:L}=this._constraintOptions;L&&(this.animation.finished?L.copyFrom(G.camera):this.animation.cameraAt(1,L));this._tmpCamera.copyFrom(G.camera);L=x.newIntersector(this.view.state.viewingMode);G=!1;0<M?(G=this.intersectionHelper.intersectScreenFreePointFallback(K,this._zoomLocation,0===this.view.map.ground.opacity?w.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,L,this._tmpCenter)&&(this._tmpCamera.center=
this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,L,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:e.copy(this._zoomLocation,this._tmpCamera.center);M=.6**M;K=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,K[0],K[1],this.view.state.camera,60);e.subtract(B,this._tmpCamera.eye,this._zoomLocation);e.normalize(B,B);L=y.clamp(Math.min(w.ZOOM_DISTANCE_MODIFIER,1/Math.abs(e.dot(v,B)))*Math.abs(this.view.camera.position.z),w.ZOOM_MIN_DISTANCE_MODIFIER,
w.ZOOM_MAX_DISTANCE_MODIFIER);if(K=null!=K?K:L)if(L=h.create(),e.subtract(L,this._zoomLocation,this._tmpCamera.eye),K<e.length(L)||!G)e.normalize(L,L),e.add(this._zoomLocation,this._tmpCamera.eye,e.scale(L,L,K));this._updateCamera(this._tmpCamera,M,this._zoomLocation);this.begin(this._tmpCamera)}};F.animationSettings=function(){return{duration:p.Milliseconds(600),easing:D.outExpo}};F._updateCamera=function(M,K,G){e.subtract(this._tmpRayDir,G,M.eye);const L=e.length(this._tmpRayDir);let O=L*K;const I=
Math.max(4,1.01*M.nearFar[0]);0!==O&&(1>=K&&O<I&&(O=I,K=O/L),1E-6>Math.abs(L-O)||(e.scale(this._tmpRayDir,this._tmpRayDir,K),M.eye=e.subtract(A,G,this._tmpRayDir),M.center=e.lerp(A,M.center,G,1-K),z.applyAll(this.view,M,this._constraintOptions)))};return b._createClass(E)}(t.PointToPointAnimationController);a.ZoomStepController=c.__decorate([g.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const A=h.create(),v=h.fromValues(0,0,1),B=h.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,y,p,u){p=function(q){function k(d,f,g,e){var h=q.call(this,!0)||this;h._view=d;h.pointerAction=f;h._pivot=g;h.registerIncoming("drag",e,
z=>h._handleDrag(z));return h}b._inherits(k,q);k.prototype._handleDrag=function(d){const f=d.data;if(!(1<f.pointers.size)&&u.eventMatchesMousePointerAction(d.data,this.pointerAction)){var g=c.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new y.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(g);
break;case "update":this._cameraController&&this._cameraController.update(g);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}d.stopPropagation()}};return b._createClass(k)}(p.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>y.PivotPoint});a.DragRotate=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){a.PivotPoint=void 0;(function(E){E[E.CENTER=0]="CENTER";E[E.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(E){function F(K){K=E.call(this,K)||this;K.pivot=a.PivotPoint.CENTER;K._rotScale=0;K._lastPoint=z.create();K._tmpWorldUp=l.create();K._tmpViewDir=l.create();K._tmpRotCurPoint=z.create();K._tmpTransf=e.create();K._tmpAxis=l.create();K._tmpPivotPoint=l.create();K._pivotPos=l.create();K._constraintOptions={selection:w.ConstraintTypes.ALL,
interactionType:r.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};return K}b._inherits(F,E);var M=F.prototype;M.initialize=function(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};M.begin=function(K){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:n.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=r.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=x.TiltMode.LOOK_AROUND;
this._constraintOptions.selection=w.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const G=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?v.contentIntersectorOptions:{});G||n.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(K,G);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=r.InteractionType.TUMBLE;this._constraintOptions.tiltMode=x.TiltMode.TUMBLE;this._constraintOptions.selection=
w.ConstraintTypes.ALL&~w.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=this.startCamera;v.normalizeCoordinate(this.startCamera,K,this._lastPoint)}};M._constrainPivotPoint=function(K,G){const L=this.startCamera,O=l.create();n.subtract(O,this._pivotPos,L.eye);const I=n.length(O);var H=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(L.eye,C);H=Math.max(Math.min(v.ROTATE_PIVOT_DISTANCE_MODIFIER,1/Math.abs(n.dot(C,L.viewForward)))*H,v.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER);
G&&(H=Math.min(I,H));var J=m.getReferenceEllipsoid(this.view.spatialReference),N=p.createScreenPointArray(L.width/L.pixelRatio*.5,L.height/L.pixelRatio*.5);J=v.decideNavigationMode(this.startCamera,N,J);N=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,L.fullWidth/L.pixelRatio*.5,L.fullHeight/L.pixelRatio*.5,L,2.5*v.ROTATE_SCREEN_PIXEL_AREA,v.ROTATE_SCREEN_PIXEL_AREA);K=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,K[0],K[1],L,v.ROTATE_SCREEN_PIXEL_AREA);
if(null!=N||null!=K)N=N??K??0,K=null==K||J===v.NavigationMode.Horizontal?N:K,H=N>K?K:N,H=G?Math.min(H,I):H;n.normalize(O,O);n.copy(this._pivotPos,n.add(this._tmpPivotPoint,L.eye,n.scale(this._tmpPivotPoint,O,H)))};M.update=function(K){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,K,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,
K,this.currentCamera.eye,this._pivotPos)}t.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}};M.end=function(){this.active&&this.finishController()};M._applyRotation=function(K,G,L,O){this.view.renderCoordsHelper.worldUpAtPosition(O,this._tmpWorldUp);v.normalizeCoordinate(K,G,this._tmpRotCurPoint);G=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let I=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;n.subtract(this._tmpViewDir,L,O);L=n.length(this._tmpViewDir);
L=y.acosClamped(n.dot(this._tmpViewDir,this._tmpWorldUp)/L);if(this.pivot===a.PivotPoint.EYE){const H=.5*Math.PI-L,J=.495*Math.PI;G=H-Math.max(-J,Math.min(J,H+-.5*G))}G=y.clamp(G+L,D.TiltDefault.min,D.TiltDefault.max)-L;n.cross(this._tmpAxis,K.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(I=-I);g.fromRotation(this._tmpTransf,I,this._tmpWorldUp);g.rotate(this._tmpTransf,this._tmpTransf,G,this._tmpAxis);n.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);K.up=n.transformMat4(B,
K.up,this._tmpTransf);n.add(B,O,this._tmpViewDir);h.copy(this._lastPoint,this._tmpRotCurPoint);return B};b._createClass(F,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return F}(A.InteractiveController);c.__decorate([u.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=c.__decorate([f.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const B=l.create(),C=l.create();Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){a.InteractiveController=
function(e){function h(){var n=e.apply(this,arguments)||this;n.startCamera=new g.Camera;n.currentCamera=new g.Camera;n._lastInteraction=0;return n}b._inherits(h,e);var z=h.prototype;z.stepController=function(n,l){l.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(l)};z.onControllerStart=function(n){this.state=f.State.Running;this.startCamera.copyFrom(n);this.currentCamera.copyFrom(n)};z.onControllerEnd=function(n){n.copyViewFrom(this.currentCamera)};z.commitCamera=function(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),d.INTERACTING_TIMEOUT);this.view.state.updateCamera(n=>this.stepController(0,n));this.steppingFinished&&this.finishController()};b._createClass(h,[{key:"isInteractive",get:function(){return performance.now()-this._lastInteraction<d.INTERACTING_TIMEOUT}}]);return h}(f.CameraController);c.__decorate([y.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);c.__decorate([y.property()],a.InteractiveController.prototype,
"_lastInteraction",void 0);a.InteractiveController=c.__decorate([k.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState ../../webgl/FramebufferObject".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N){a.ViewStateManager=function(V){function X(Z){var ea=V.call(this,Z)||this;ea.constraintsManager=null;ea.ready=!1;ea._windowDevicePixelRatio=1;ea._devicePixelRatioOverride=null;ea._updatingIgnoreRenderState=!1;ea.test={viewStateManager:b._assertThisInitialized(ea),contentCameraResetState:new Map,setDevicePixelRatio:ja=>ea._devicePixelRatioOverride=ja,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},
set updatingIgnoreRenderState(ja){this.viewStateManager._updatingIgnoreRenderState=ja},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||null!=this.renderState}};ea._propertiesPool=new L.PropertiesPool({frustum:F.Frustum},b._assertThisInitialized(ea));ea._cameraSetByUser=!1;ea._gotoOperation=null;ea._cameraChangeTime=0;ea._tmpCanvasSize=new R;return ea}b._inherits(X,V);var Y=X.prototype;Y.installContentCameraReset=function(Z){this.removeHandles("content-camera-reset");
this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const ea=this.zoom,ja=this.view.state.camera.distance**2,ha=t.fromArray(this.view.state.camera.center),ia=Z.sticky?this.contentCamera.clone():null;this.addHandles([d.watch(()=>this.contentCamera,()=>{Z.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),d.watch(()=>this.zoom,oa=>{void 0!==oa&&void 0!==ea&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(oa-
ea)/2),2<Math.abs(oa-ea)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ia))}),d.watch(()=>this.view.state.camera,oa=>{oa=m.squaredDistance(ha,oa.center);this.test.contentCameraResetState.set("camera.center",oa/ja);oa>ja?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ia)})],"content-camera-reset");return!0};Y._paddingToArray=function(Z,ea,ja){Z?w.set(ja,Z.top||0,Z.right||0,Z.bottom||0,Z.left||0):w.set(ja,0,0,0,0);for(Z=0;4>Z;Z++)ja[Z]=
Math.round(ja[Z]*ea)};Y._computeCanvasSize=function(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var Z=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio);
Z=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Z;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*Z);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*Z);N.ensureAttachmentMaxSize(this._tmpCanvasSize,this.view._stage.renderView.renderingContext.parameters.maxTextureSize)?this._tmpCanvasSize.pixelRatio=Z:this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth:Z;this.view.state&&(this.view.state.contentPixelRatio=
Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize};Y.initialize=function(){this._cameraChangeTime=performance.now();this.addHandles([d.on(()=>this.view.state.events,"before-camera-change",Z=>Z&&this._updateElevation(Z)),d.watch(()=>this.view.state?.camera,(Z,ea)=>this._cameraChangedHandler(Z,ea),d.sync)]);d.when(()=>this.view.state?.camera,Z=>this._updateElevation(Z),{once:!0,sync:!0});this.addHandles([f.addFrameTask({prepare:()=>this._prepareFrame()}),
d.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),d.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])};Y.destroy=function(){this.exit();this._propertiesPool=k.destroyMaybe(this._propertiesPool)};Y.init=function(){this.constraintsManager=new E.ConstraintsManager({view:this.view});this._prepareFrame();var Z=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const ea of Z)this.set(ea.name,
ea.value);this._cameraSetByUser||((Z=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(Z)?this._setInitialView(Z):this.view.state.viewingMode===v.ViewingMode.Local&&this.addHandles(d.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))};Y.exit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),
this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this.constraintsManager=k.destroyMaybe(this.constraintsManager))};Y.goTo=async function(Z,ea){ea={animate:!0,...ea};null!=this._gotoOperation&&this._gotoOperation.abort(ea.animate);this._gotoOperation=new M.GoToOperation(Z,ea,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation};Y.debugSetCameraOnContent=function(){this.setStateCamera(C.cameraOnContentAlongViewDirection(this.view),
{applyConstraints:!1})};Y.step=function(Z){const ea=this.view.state,ja=ea?.cameraController;ja&&(ea.updateCamera(ha=>ja.stepController(Z,ha)),ja.steppingFinished&&ja.finishController())};Y._cancelGoToOperation=function(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)};Y._getInitialProperties=function(){const Z=new Set,ea=[];for(const {propertyName:ja,overrides:ha}of T){const ia=Z.has(ja),oa=this._isOverridden(ja);!ia&&oa&&ea.push({name:ja,value:this._get(ja)});this._clearOverride(ja);
(ia||oa)&&ha.forEach(ma=>Z.add(ma))}return ea};Y._setInitialView=function(Z){if(null!=Z&&!this._cameraSetByUser)if(Z instanceof y)this.setStateCamera(G.externalToInternal(this.view,Z),{applyConstraints:!1});else if(Z instanceof p)if(Z.targetGeometry instanceof x){var ea=G.fromExtent(this.view,Z.targetGeometry,0,.5,G.OrientationMode.LOCKED);null!=ea&&this.setStateCamera(G.externalToInternal(this.view,ea),{applyConstraints:!0})}else ea={applyConstraints:!Z.camera},Z=this._viewpointToCamera(Z),this.setStateCamera(Z,
ea);else ea=G.fromExtent(this.view,Z,0,.5,G.OrientationMode.LOCKED),null!=ea&&this.setStateCamera(G.externalToInternal(this.view,ea),{applyConstraints:!0})};Y._updatePropertyBeforeReady=function(Z,ea){if(this.ready)return!1;this._override(Z,ea);ea&&W.includes(Z)&&this._override("hasInitialView",!0);return!0};Y.isCompatible=function(Z){return null==Z?!1:Z instanceof p?Z.camera?this.isCompatible(Z.camera):this.isCompatible(Z.targetGeometry):Z instanceof y?this.isCompatible(Z.position):Z.spatialReference&&
A.canProject(Z.spatialReference,this.view.spatialReference)};Y._getPreservingHeadingTilt=function(Z=P){this._cameraSetByUser?(Z.heading=this.camera.heading,Z.tilt=this.camera.tilt):(Z.heading=0,Z.tilt=.5);return Z};Y._centerPointAtDistanceToCamera=function(Z,ea,ja=S){const {heading:ha,tilt:ia}=this._getPreservingHeadingTilt();Z=G.getObserverForPointAtDistance(this.view,ha,ia,Z,ea,G.OrientationMode.ADJUST);if(null==Z)return null;ja.copyFrom(this.view.state.camera);ja.eye=Z.eye;ja.center=Z.center;ja.up=
Z.up;return ja};Y._centerToCamera=function(Z){const ea=this.view.pointsOfInterest.centerOnContent;ea.runTask();return this._centerPointAtDistanceToCamera(Z,ea.distance)};Y._extentToCamera=function(Z){const {heading:ea,tilt:ja}=this._getPreservingHeadingTilt();return(Z=G.fromExtent(this.view,Z,ea,ja,G.OrientationMode.ADJUST,Q))?G.externalToInternal(this.view,Z):null};Y._scaleToCamera=function(Z){if(null==Z)return null;var ea=this.view.pointsOfInterest.centerOnContent;ea.runTask();const ja=ea.renderLocation;
ea=ea.location.latitude;if(null==ea)return null;Z=G.scaleToDistance(this.view,Z,ea);return this._centerPointAtDistanceToCamera(ja,Z)};Y._zoomToCamera=function(Z){return this._scaleToCamera(G.zoomToScale(this.view,Z))};Y._viewpointToCamera=function(Z){return G.externalToInternal(this.view,O.toCamera(this.view,Z))};Y.setStateCamera=function(Z,ea){if(null==Z||!this.view.state.stopActiveCameraController())return!1;this._cameraSetByUser=!0;ea.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(ja=>
{ea.positionAndOrientationOnly?(ja.eye=Z.eye,ja.center=Z.center,ja.up=Z.up):ja.copyFrom(Z);ea.applyConstraints&&B.applyAll(this.view,ja)});ea.applyConstraints||(this.view.state.cameraController=new K.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:Z}));return!0};Y._prepareFrame=function(){const {surface:Z,canvas:ea}=this.view;if(Z&&ea){this._windowDevicePixelRatio=window.devicePixelRatio;var ja=this._computeCanvasSize();if(0!==ja.width&&0!==ja.height){if(ea.width!==ja.width||ea.height!==
ja.height)ea.width=ja.width,ea.height=ja.height;if(this.view.state){const ha=this.view.state.camera;if(ha.fullWidth!==ja.width||ha.fullHeight!==ja.height||ha.pixelRatio!==ja.pixelRatio)S.copyFrom(ha),S.pixelRatio!==ja.pixelRatio&&(this._paddingToArray(this.padding,ja.pixelRatio,U),S.padding=U),S.fullWidth=ja.width,S.fullHeight=ja.height,S.pixelRatio=ja.pixelRatio,this.view.state.camera=S;this._updateViewState()}}}};Y._updateElevation=function(Z){var ea=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;
const ja=this.view.renderCoordsHelper?.getAltitude(Z.eye)??0;ea=ea?C.surfaceElevationBelowRenderLocation(this.view,Z.eye):0;Z.relativeElevation=ja-ea};Y._updateViewState=function(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=J.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=J.RenderState.INTERACTING:(this.view.state.mode===J.RenderState.ANIMATING&&(this._cameraChangeTime=0),300>=performance.now()-this._cameraChangeTime?
this.view.state.mode=J.RenderState.INTERACTING:this.view.state.mode=J.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio};Y._cameraChangedHandler=function(Z,ea){Z&&ea&&Z.almostEquals(ea)||(this._cameraChangeTime=performance.now(),this._updateViewState())};b._createClass(X,[{key:"camera",get:function(){const Z=this._get("camera");if(!this.ready)return Z;const ea=G.internalToExternal(this.view,this.view.state.camera,Q);return ea&&Z&&ea.equals(Z)?Z:ea.clone()},set:function(Z){this._updatePropertyBeforeReady("camera",
Z)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(G.externalToInternal(this.view,Z),{applyConstraints:!1})||q.getLogger(this).error("#camera\x3d","Invalid camera",Z),this.view.elevationProvider?.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const Z=this._get("contentCamera");if(!this.ready)return Z;const ea=G.internalToExternal(this.view,this.view.state.contentCamera,Q);return ea&&Z&&ea.equals(Z)?Z:ea.clone()},set:function(Z){this._updatePropertyBeforeReady("contentCamera",
Z)||(Z=G.externalToInternal(this.view,Z),null==Z?this.view.state.contentCamera=null:(this._updateElevation(Z),this.view.state.contentCamera=Z))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(Z){this._updatePropertyBeforeReady("center",Z)||(Z?this.isCompatible(Z)?this.setStateCamera(this._centerToCamera(Z),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():q.getLogger(this).error("#center\x3d",
"Invalid center",Z):q.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(Z.spatialReference?Z.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",Z):q.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var Z=this.view;Z=G.toExtent(Z,Z.state.camera,Z.pointsOfInterest.centerOnContent.renderLocation);return null!=Z?Z:this._get("extent")},
set:function(Z){this._updatePropertyBeforeReady("extent",Z)||(Z?this.isCompatible(Z)?this.setStateCamera(this._extentToCamera(Z),{applyConstraints:!0})||q.getLogger(this).error("#extent\x3d","Invalid extent",Z):q.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(Z.spatialReference?Z.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",Z):q.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",
get:function(){const Z=this._propertiesPool.get("frustum");Z.renderCoordsHelper=this.view.renderCoordsHelper;Z.update(this.view.state.camera);return Z}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const Z=this.view.pointsOfInterest.centerOnContent;return G.distanceToScale(this.view,Z.distance,Z.location.latitude)}return this._get("scale")},set:function(Z){this._updatePropertyBeforeReady("scale",Z)||
this.setStateCamera(this._scaleToCamera(Z),{applyConstraints:!0})||q.getLogger(this).error("#scale\x3d","Invalid scale",Z)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var Z=this.view.state.camera,ea=Z.padding;const ja=Z.pixelRatio;Z=this._get("padding");const ha=Math.round(ea[I.PaddingSide.TOP]/ja),ia=Math.round(ea[I.PaddingSide.RIGHT]/ja),oa=Math.round(ea[I.PaddingSide.BOTTOM]/ja);ea=Math.round(ea[I.PaddingSide.LEFT]/ja);return null!=Z&&Z.top===ha&&Z.right===ia&&Z.bottom===
oa&&Z.left===ea?Z:{top:ha,right:ia,bottom:oa,left:ea}},set:function(Z){this._updatePropertyBeforeReady("padding",Z)||(this._paddingToArray(Z,this.view.state.camera.pixelRatio,U),this.view.state.updateCamera(ea=>ea.padding=U))}},{key:"screenCenter",get:function(){const Z=this.padding;return g.createScreenPoint((this.view.width-(Z.left+Z.right))/2+Z.left,(this.view.height-(Z.top+Z.bottom))/2+Z.top)}},{key:"viewpoint",get:function(){return this.ready?O.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(Z){if(!this._updatePropertyBeforeReady("viewpoint",Z))if(Z)if(this.isCompatible(Z))this.setStateCamera(this._viewpointToCamera(Z),{applyConstraints:!Z.camera})||q.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",Z);else{var ea=null!=Z.camera?Z.camera.position:Z.targetGeometry;ea=null!=ea&&ea.spatialReference;q.getLogger(this).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(ea?ea.wkid:"none")+", view: "+this.view.spatialReference?.wkid+
")",Z)}else q.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?G.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(Z){this._updatePropertyBeforeReady("zoom",Z)||void 0===Z||this.setStateCamera(this._zoomToCamera(Z),{applyConstraints:!0})||q.getLogger(this).error("#zoom\x3d","Invalid zoom",Z)}},{key:"_rasterPixelRatio",get:function(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:
this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}},{key:"_usePhysicalPixelRendering",get:function(){return this.view?._stage?.renderer.isFeatureEnabled(H.RenderFeature.PhysicalPixelRendering)??!1}},{key:"_usePhysicalPixelRenderingAny",get:function(){const Z=this.view?._stage?.renderer;return Z&&(Z.isFeatureEnabled(H.RenderFeature.PhysicalPixelRendering,J.RenderState.IDLE)||Z.isFeatureEnabled(H.RenderFeature.PhysicalPixelRendering,
J.RenderState.INTERACTING)||Z.isFeatureEnabled(H.RenderFeature.PhysicalPixelRendering,J.RenderState.ANIMATING))}}]);return X}(u);c.__decorate([e.property({type:y,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);c.__decorate([e.property({type:y,dependsOn:["view.state.contentCamera","ready"]})],a.ViewStateManager.prototype,"contentCamera",null);c.__decorate([e.property({type:D})],a.ViewStateManager.prototype,"center",null);c.__decorate([e.property({type:x})],a.ViewStateManager.prototype,
"extent",null);c.__decorate([e.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);c.__decorate([e.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);c.__decorate([e.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);c.__decorate([e.property({type:Number})],a.ViewStateManager.prototype,"scale",null);c.__decorate([e.property()],a.ViewStateManager.prototype,"padding",null);c.__decorate([e.property({readOnly:!0})],a.ViewStateManager.prototype,
"screenCenter",null);c.__decorate([e.property({constructOnly:!0})],a.ViewStateManager.prototype,"view",void 0);c.__decorate([e.property({type:p})],a.ViewStateManager.prototype,"viewpoint",null);c.__decorate([e.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);c.__decorate([e.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);c.__decorate([e.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);c.__decorate([e.property({readOnly:!0})],
a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",null);c.__decorate([e.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);c.__decorate([e.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=c.__decorate([l.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);let R=b._createClass(function(){this.height=this.width=0;this.pixelRatio=1});const W="camera viewpoint extent scale center zoom".split(" "),T=[{propertyName:"camera",
overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],P={heading:0,tilt:0},Q=new y,S=new I.Camera,U=r.create();a.INTERACTING_TIMEOUT=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ../camera/constraintUtils/TiltMode ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){a.ConstraintsManager=function(r){function x(A){var v=r.call(this,A)||this;v.nearFarHeuristic=t.createNearFarHeuristic(A.view.state.viewingMode,A.view.basemapTerrain,A.view.renderCoordsHelper.spatialReference);return v}b._inherits(x,r);var D=x.prototype;D.initialize=function(){this.addHandles([u.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),u.watch(()=>this.view.constraints?.clipDistance?.mode,
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",A=>this._updateCameraNearFar(A)),u.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),u.sync),u.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),u.sync),u.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),u.sync),u.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),u.sync),u.watch(()=>this.view.state?.camera,()=>
this._updateTiltAutoMax(),u.sync),u.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),u.sync)]);this.view.state.isLocal&&this.addHandles(u.watch(()=>this.view.renderDataExtent,A=>this._updateLocalSurfaceDistance(A),u.initial));this._updateNearFar();this.view.state.viewingMode!==e.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new w.SurfaceCollisionConstraint({view:this.view}))};
D.destroy=function(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};D._clipDistanceNearFarChanged=function(){const A=this.view.constraints?.clipDistance;A&&"auto"!==A.mode&&this.view.state.updateCamera(v=>this._updateCameraNearFarManual(v,A))};D._updateNearFar=function(){this.view.state.updateCamera(A=>this._updateCameraNearFar(A))};D._updateCameraNearFar=function(A){const v=this.view.constraints&&this.view.constraints.clipDistance;
"manual"===(v?v.mode:"auto")?this._updateCameraNearFarManual(A,v):this._updateCameraNearFarAuto(A,v)};D._updateCameraNearFarAuto=function(A,v){this.nearFarHeuristic.compute(A.eye,A.center,this.view.renderDataExtent,z.surfaceElevationBelowRenderLocation(this.view,A.eye),A);v&&v.autoUpdate(A.near,A.far)};D._updateCameraNearFarManual=function(A,v){v&&(A.near=v.near,A.far=v.far)};D._updateCollision=function(){var A=this.view.map?.ground?.navigationConstraint?.type;A=A?"stay-above"===A:!0;const v=this.view.state.constraints.collision;
A!==v.enabled&&((v.enabled=A)&&this._reapplyConstraints(n.ConstraintTypes.COLLISION),(A=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==A.mode||this._updateTiltAuto())};D._updateAltitude=function(){const A=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=A&&this.view.state.viewingMode!==e.ViewingMode.Local?{min:A.min,max:A.max}:null;this._reapplyConstraints()};D._updateTiltMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;
A&&"auto"!==A.mode&&(this._updateTiltManual(A),this._reapplyConstraints())};D._updateTilt=function(){const A=this.view.constraints&&this.view.constraints.tilt;"manual"===(A?A.mode:"auto")?this._updateTiltManual(A):this._updateTiltAuto();this._reapplyConstraints()};D._updateTiltManual=function(A){const v=this.view.state.constraints;v.tilt=v.createConstantMaxTilt(p.deg2rad(A.max))};D._updateTiltAuto=function(){const A=this.view.state.constraints;A.tilt=A.createDefaultTilt();this._updateTiltAutoMax()};
D._updateTiltAutoMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;if(A&&"auto"===A.mode){var v=this.view.state.constraints;v.tilt&&(v=v.tilt(this.view.state.camera.distance).max,A.autoUpdate(p.rad2deg(v)))}};D._updateLocalSurfaceDistance=function(A){if(null!=A){var v=Math.max(A.width,A.height);0>=v||(null!=A.zmax&&null!=A.zmin&&(v=Math.max(v,A.zmax-A.zmin)),A=this.view.state,v=3*v/Math.atan(A.camera.fov/2),v!==A.constraints.distance&&(A.constraints.distance=v))}};D._reapplyConstraints=
function(A=n.ConstraintTypes.ALL){this.view.state.updateCamera(v=>h.applyAll(this.view,v,{selection:A,interactionType:l.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:m.TiltMode.TUMBLE}))};return b._createClass(x)}(y);c.__decorate([q.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);c.__decorate([q.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([g.subclass("esri.views.3d.state.ConstraintsManager")],
a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),function(a,b,c,y,p,u,q,k,d,f){function g(l,m,t,w){t=2/t;l/m>t?(w.far=l,w.near=w.far/m):(w.near=
t,w.far=w.near*m);return w}let e=function(){function l(m,t){this._elevationProvider=m;this._referenceEllipsoid=q.getReferenceEllipsoid(t);this._unitInMeters=y.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}l.prototype.compute=function(m,t,w,r,x){x||(x={near:0,far:0});var D=m[2]*this._unitInMeters,A=D;r=D-r;var v=this._elevationProvider?.visibleElevationBounds;v&&(D=0<=r?A-this._unitInMeters*v.min:this._unitInMeters*v.max-A);w=null!=w?w:new k({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,
zmax:0});A=Math.max(w.xmax-w.xmin,w.ymax-w.ymin,4*Math.max(w.xmax-w.xmin,w.ymax-w.ymin));p.subtract(n,t,m);z[0]=0<n[0]?w.xmax:w.xmin;z[1]=0<n[1]?w.ymax:w.ymin;z[2]=0<n[2]?A/2:-A/2;p.subtract(z,z,m);p.normalize(n,n);m=1.1*p.dot(z,n)*this._unitInMeters;t=Math.sqrt(D*(D+2*this._referenceEllipsoid.radius));w=Math.max(w.xmax-w.xmin,w.ymax-w.ymin);v=1E-4*w*this._unitInMeters;D=c.clamp((D-v)/(.001*w*this._unitInMeters-v),0,1);D=Math.min(c.lerp(t,m,D**3),t)*Math.max(Math.log(Math.abs(r)),1);return g(Math.min(D,
Math.max(34064E4,A))/this._unitInMeters,2E4,this._unitInMeters,x)};return b._createClass(l)}(),h=function(){function l(m){this._referenceEllipsoid=q.getReferenceEllipsoid(m)}l.prototype.compute=function(m,t,w,r,x){x||(x={near:0,far:0});m=p.length(m);t=m-this._referenceEllipsoid.radius;t=Math.max(Math.abs(t-r),Math.abs(t));r=1.2*c.lerp(Math.sqrt(t*(t+2*(this._referenceEllipsoid.radius+Math.min(0,r)))),m+this._referenceEllipsoid.radius,f.computeInnerAltitudeFade(t));m=c.clamp(2E4-(Math.log(t)-7.983)/
9.011*19E3,1E3,2E4);return g(r,m,1,x)};return b._createClass(l)}();const z=u.create(),n=u.create();a.createNearFarHeuristic=function(l,m,t){return l===d.ViewingMode.Global?new h(t):new e(m,t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.SurfaceCollisionConstraint=function(e){function h(n){return e.call(this,n)||this}b._inherits(h,e);var z=h.prototype;z.initialize=function(){this.addHandles(this.view.basemapTerrain.on("elevation-change",n=>this._handleElevationChangeEvent(n)))};z._handleElevationChangeEvent=function(n){if(!this.view.state.cameraController){var l=this.view.state.camera;null!=n.spatialReference&&f.eyeWithinExtent(this.view,l,n.extent,n.spatialReference)&&this._applyToCurrentCamera()}};
z._applyToCurrentCamera=function(){this.view.state.updateCamera(n=>g.applySurfaceCollisionConstraint(this.view,n,g.Mode.EYE_AND_CENTER))};return b._createClass(h)}(y);c.__decorate([p.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([d.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,y,p){function u(k,d,f){k.origin=d;k.endpoint=f;c.direction(k.direction,d,f)}let q=function(){function k(f){this.renderCoordsHelper=f;this.frustum=p.create();this._points=p.createPoints();this.lines=Array(12);this._origin=y.create();this._direction=y.create();this._altitude=null;for(f=0;12>f;f++)this.lines[f]={origin:null,direction:y.create(),endpoint:null}}
var d=k.prototype;d.update=function(f){p.fromMatrix(f.viewMatrix,f.projectionMatrix,this.frustum,this._points);c.copy(this._origin,f.eye);c.copy(this._direction,f.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};d.updatePoints=function(f){for(let g=0;g<this._points.length;g++)c.copy(this._points[g],f[g]);p.computePlanes(this.frustum,this._points);this._updateLines()};d.intersectsSphere=function(f){return p.intersectsSphere(this.frustum,f)};d.intersectsRay=
function(f){return p.intersectsRay(this.frustum,f)};d.intersectsLineSegment=function(f,g){return p.intersectsLineSegment(this.frustum,f,g)};d.intersectsPoint=function(f){return p.intersectsPoint(this.frustum,f)};d._updateLines=function(){const f=this._points;for(let g=0;4>g;g++){const e=g+4;u(this.lines[g],f[g],f[e]);u(this.lines[g+4],f[g],3===g?f[0]:f[g+1]);u(this.lines[g+8],f[e],3===g?f[4]:f[e+1])}};b._createClass(k,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},
{key:"mutablePoints",get:function(){return this._points}},{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return k}();q.planePointIndices=p.planePointIndices;q.nearFarLineIndices=[[p.PointIndex.NEAR_BOTTOM_LEFT,p.PointIndex.FAR_BOTTOM_LEFT],[p.PointIndex.NEAR_BOTTOM_RIGHT,p.PointIndex.FAR_BOTTOM_RIGHT],[p.PointIndex.NEAR_TOP_RIGHT,p.PointIndex.FAR_TOP_RIGHT],[p.PointIndex.NEAR_TOP_LEFT,p.PointIndex.FAR_TOP_LEFT]];a.Frustum=q;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(){function l(t,w,r){this.target=t;this.options=w;this.view=r;this.state="pending";this._animationController=null;this._promise=new Promise((x,D)=>{this._resolveCallback=x;this._rejectCallback=D;x=new AbortController;if(null!=this.options.signal)u.onAbort(this.options.signal,()=>{this.abort()});this._abortController=x;this.waitForReady()})}var m=l.prototype;m.then=function(t,w){return this._promise.then(t,w)};m.catch=function(t){return this._promise.catch(t)};
m.resolve=function(t){if("finished"!==this.state)return this.state="finished",this._resolveCallback(t)};m.reject=function(t){if("finished"!==this.state)return this.state="finished",this._rejectCallback(t)};m.abort=function(t=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!t&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(u.createAbortError())};
m.waitForReady=async function(){this.state="wait-for-ready";if(!this.view.ready)try{await q.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()};m.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,z.create(this.view,this.target,this._abortController.signal).then(t=>{"finished"!==this.state&&(t=t?this._getCameraFromViewpoint(t):
null,null!=t&&(this.options.animate?null!=this._animationController&&this.startAnimation(t,this._animationController):(this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},t=>{this.reject(t)}))};m._getCameraFromViewpoint=function(t){const w=!!(this.target instanceof y&&this.target.camera||this.target instanceof c);var r=t.camera;if(null==r)return null;if(!this.view.stateManager.isCompatible(r))return t=
(t=r.position)&&t.spatialReference,this.reject(new p("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${t?t.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,{camera:r})),null;r=h.externalToInternal(this.view,r);return null==r?(this.reject(new p("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:r,isFullySpecified:w}};m.startAnimation=function(t,w){this.state="wait-for-animation-finish";const r=
w.viewAnimation;if(null==r)this.reject(new p("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{r.update(t.viewpoint,"running");if(!w.active||null==w.viewAnimation||w.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==w)return this.abort();if(t.isFullySpecified){var x=new e.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:t.camera});d.applySurfaceCollisionConstraint(this.view,t.camera,d.Mode.EYE_AND_CENTER)}else k.applyAll(this.view,
t.camera);w.begin(t.camera,this.options);var D=A=>{if(null!=this.view.state)switch(w.state){case f.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case f.State.Ready:case f.State.Rejected:case f.State.Running:case f.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(A)}}};r.when(()=>{const A=this.view.state.cameraController;
x&&(A&&A.active?A instanceof g.PointToPointAnimationController&&null!=A.viewAnimation&&A.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=x):null!=w.viewAnimation&&w.viewAnimation.target===t.viewpoint&&"finished"===w.state&&(this.view.state.cameraController=x))},A=>D(A));w.asyncResult={resolve:()=>D(),reject:A=>D(A)}}};m._getAnimationController=function(){let t=null;var w=null;w=this.view.state.cameraController;w instanceof g.PointToPointAnimationController&&(w.updateStateFromViewAnimation(),
w.active&&(t=w,w=t.viewAnimation));return null!=t||(t=new g.PointToPointAnimationController({view:this.view,mode:"animation"}),w=t.viewAnimation,this.view.state.switchCameraController(t))?t:(null!=w&&w.stop(),this.reject(new p("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return b._createClass(l)}();a.GoToOperation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.SurfaceCollisionCorrectionController=function(e){function h(n){return e.call(this,n)||this}b._inherits(h,e);var z=h.prototype;z.onControllerStart=function(){this.state=g.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",n=>this._handleElevationChangeEvent(n)));this._applyCorrection()};z.onControllerEnd=function(){this.removeAllHandles()};z.stepController=function(){};z._handleElevationChangeEvent=function(n){(null==n.spatialReference||d.eyeWithinExtent(this.view,
this.desiredCamera,n.extent,n.spatialReference))&&this._applyCorrection()};z._applyCorrection=function(){this.view.state.updateCamera(n=>{n.copyViewFrom(this.desiredCamera);f.applySurfaceCollisionConstraint(this.view,n,f.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=g.State.Stopped)})};b._createClass(h,[{key:"desiredCamera",set:function(n){this._set("desiredCamera",n.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return h}(g.CameraController);c.__decorate([y.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([k.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){function x(S){return"global"===S.viewingMode?m.cameraUtilsSpherical:l.cameraUtilsPlanar}function D(S,U,V){const X=S.state.camera,Y=X.width/2/X.pixelRatio;S.renderCoordsHelper.viewingMode===z.ViewingMode.Global&&null!=V&&(U*=Math.cos(u.deg2rad(V)));U/=S.renderCoordsHelper.unitInMeters;return Y/(96*39.37/U)/Math.tan(X.fovX/2)}function A(S,U,V){const X=S.state.camera;U=96*39.37/(X.width/2/X.pixelRatio/(U*Math.tan(X.fovX/2)));S.renderCoordsHelper.viewingMode===
z.ViewingMode.Global&&null!=V&&(U/=Math.cos(u.deg2rad(V)));return U*S.renderCoordsHelper.unitInMeters}function v(S,U,V,X,Y,Z){if(I(Z)){const ea=new Q(Z.signal);K(S,X.heading,X.tilt,U,V,Y,ea);ea.resolver.promise.then(ja=>{ja=O(S,ja,X.fov);if(null==ja)Z.resolver.reject();else return Z.resolver.resolve(ja)},ja=>Z.resolver.reject(ja))}else return U=K(S,X.heading,X.tilt,U,V,Y),O(S,U,X.fov,Z)}function B(S,U,V,X,Y){return x(S).directionToHeadingTilt(U,V,X,Y)}function C(S,U){return!!(S.basemapTerrain&&S.renderCoordsHelper.fromRenderCoords(U,
R,S.spatialReference)&&S.elevationProvider&&(w.getElevationAtPoint(S.elevationProvider,R)??0)>(R.z??0)-1)}async function E(S,U,V){if(!S.renderCoordsHelper.fromRenderCoords(U,R,S.spatialReference)||!S.elevationProvider)return!1;U=R.z??0;return(await S.elevationProvider.queryElevation(R.x,R.y,U,R.spatialReference,"ground",V)??0)>U-1}async function F(S,U,V){const X=d.create();U?U instanceof g?(e.projectPointToVector(U,X,S.renderSpatialReference),null==U.z&&null!=S.basemapTerrain&&null!=S.elevationProvider&&
(U=await S.elevationProvider.queryElevation(U.x,U.y,U.z??0,U.spatialReference,"ground",V),null!=U&&S.renderCoordsHelper.setAltitude(X,U))):k.copy(X,U):k.copy(X,S.state.camera.center);return X}function M(S,U){const V=d.create();U&&U instanceof g?(e.projectPointToVector(U,V,S.renderSpatialReference),null==U.z&&null!=S.basemapTerrain&&null!=S.elevationProvider&&(U=w.getElevationAtPoint(S.elevationProvider,U),null!=U&&S.renderCoordsHelper.setAltitude(V,U))):U?k.copy(V,U):k.copy(V,S.state.camera.center);
return V}function K(S,U,V,X,Y,Z,ea){const ja=X&&X instanceof g?X:null;if(I(ea))return F(S,X,ea.signal).then(ha=>{G(S,U,V,ja,ha,Y,Z,ea)},ha=>ea.resolver.reject(ha)),null;X=M(S,X);return G(S,U,V,ja,X,Y,Z,ea)}function G(S,U,V,X,Y,Z,ea,ja){if(null==X&&(X=e.projectVectorToPoint(Y,S.renderSpatialReference,S.spatialReference||h.WGS84),null==X))return null;Z=Math.max(Z,S.state.constraints.minimumPoiDistance);var ha=L(S,U,V,Y,Z,ea);const ia=x(S).eyeForCenterWithHeadingTilt,oa=ia(Y,Z,ha.heading,ha.tilt);if(ea===
a.OrientationMode.ADJUST&&"global"===S.viewingMode&&0<V){const ma=()=>{var fa=Z;var ba=Z;var aa=x(S).eyeTiltToLookAtTilt(V,Y,ba);S.state.constraints.tilt&&(ba=S.state.constraints.tilt(ba),aa=Math.min(aa,.5*Math.PI),aa=ba.min*(1-.7)+.7*aa);fa=x(S).lookAtTiltToEyeTilt(aa,Y,fa);ea=1>V-fa?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return G(S,U,fa,X,Y,Z,ea,ja)};ha=S.map.ground.navigationConstraint;if(!ha||"stay-above"===ha.type){if(C(S,oa.eye))return ma();if(I(ja))return E(S,oa.eye,ja.signal).then(fa=>
{if(fa)return ma();ja.resolver.resolve({eye:oa.eye,up:oa.up,center:d.clone(Y),heading:oa.heading,tilt:oa.tilt});return null}),null}}ha=!ja||I(ja)?{center:d.create(),eye:d.create(),up:d.create(),tilt:0,heading:0}:ja;ha.eye=oa.eye;ha.up=oa.up;ha.center=d.clone(Y);ha.heading=oa.heading;ha.tilt=oa.tilt;I(ja)&&ja.resolver.resolve(ha);return ha}function L(S,U,V,X,Y,Z){var ea=0;if(Z=Z===a.OrientationMode.ADJUST)if(ea=S.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(Y/ea)/Math.LN2)Z=!0;else{var ja=
S.renderSpatialReference,ha=S.spatialReference||h.WGS84;Z=e.projectVectorToPoint(X,ja,ha);ja=e.projectVectorToPoint(S.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ja,ha);null==Z||null==ja?Z=!1:(ea*=Math.tan(.5*S.state.camera.fov),Z=5<ja.distance(Z)/ea)}Z?(U=0,V=x(S).eyeTiltToLookAtTilt(V,X,Y),S.state.constraints.tilt?(Z=S.state.constraints.tilt(Y),Z.max=Math.min(Z.max,.5*Math.PI),ea=Math.min(V,Z.min*(1-.7)+.7*Z.max)):ea=V):ea=x(S).eyeTiltToLookAtTilt(V,X,Y);V=ea=S.state.constraints.clampTilt(Y,
ea);V=x(S).lookAtTiltToEyeTilt(V,X,Y);return{heading:U,tilt:V}}function O(S,U,V,X){if(null==U)return null;S=e.projectVectorToPoint(U.eye,S.renderSpatialReference,S.spatialReference||h.WGS84);return null==S?null:null!=X?(X.position=S,X.heading=U.heading,X.tilt=U.tilt,X.fov=V,X):new c(S,U.heading,U.tilt,V)}function I(S){return S&&"resolver"in S}const H=p.getLogger("esri.views.3d.support.cameraUtils"),J=d.create(),N={heading:0,tilt:0},R=new g,W=new y.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),
T=new y.Cyclical(-180,180);a.OrientationMode=void 0;(function(S){S[S.LOCKED=0]="LOCKED";S[S.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const P=d.create();let Q=b._createClass(function(S){this.signal=S;this.resolver=q.createResolver()});a.AsyncContext=Q;a.computeScale=function(S,U){e.projectVectorToVector(U.center,S.renderSpatialReference,J,h.WGS84);return A(S,U.distance,J[1])};a.directionToHeadingTilt=B;a.distanceToScale=A;a.externalToInternal=function(S,U){if(null==U)return null;
var V=S.renderSpatialReference;const X=x(S).headingTiltToDirectionUp,Y=d.create();if(!e.projectPointToVector(U.position,Y,V))return null;V=X(Y,U.heading,U.tilt);k.scale(V.direction,V.direction,S.state.camera.distance);k.add(V.direction,V.direction,Y);S=n.cameraOnContentAlongViewDirection(S,Y,V.direction,V.up);S.fov=u.deg2rad(U.fov);return S};a.fromCenterDistance=v;a.fromCenterScale=function(S,U,V,X,Y,Z){V=D(S,V,U.latitude);return v(S,U,V,X,Y,Z)};a.fromExtent=function(S,U,V,X,Y,Z=null){if(S.state.isGlobal){if(!r.isSpatialReferenceSupported(U.spatialReference,
z.ViewingMode.Global))return I(Z)&&Z.resolver.reject(),null;var ea=new g(U.xmin,U.ymin,U.spatialReference);const oa=new g(U.xmax,U.ymax,U.spatialReference),ma=U.spatialReference.isGeographic?T:W;var ja=new g({x:ma.center(ea.x,oa.x),y:(oa.y+ea.y)/2,z:null!=U.zmax&&null!=U.zmin?(U.zmax+U.zmin)/2:void 0,spatialReference:U.spatialReference});const fa=f.getReferenceEllipsoid(U.spatialReference);var ha=t.getGreatCircleSpanAt(ja,ea,oa);var ia=ha.lon;ha=ha.lat;ma.diff(ea.x,oa.x)>ma.range/2&&(ia+=fa.halfCircumference);
ia=Math.min(ia,fa.halfCircumference);ha=Math.min(ha,fa.halfCircumference)}else ja=S.renderSpatialReference??U.spatialReference,ja.equals(U.spatialReference)||(U=e.project(U,ja)),ia=U.xmax-U.xmin,ha=U.ymax-U.ymin,ja=new g({x:U.xmin+.5*ia,y:U.ymin+.5*ha,z:null!=U.zmax&&null!=U.zmin?(U.zmax+U.zmin)/2:void 0,spatialReference:ja});ea=S.state.camera;U=Math.max(1/Math.tan(ea.fovX/2)*ia*.5,1/Math.tan(ea.fovY/2)*ha*.5,1/Math.tan(ea.fov/2)*(null!=U.zmax&&null!=U.zmin?U.zmax-U.zmin:0)*.5)/1;if(I(Z))ia=new Q(Z.signal),
K(S,V,X,ja,U,Y,ia),ia.resolver.promise.then(oa=>{oa=O(S,oa,S.camera.fov);if(null==oa)Z.resolver.reject();else return Z.resolver.resolve(oa)},oa=>Z.resolver.reject(oa));else return V=K(S,V,X,ja,U,Y),O(S,V,S.camera.fov,Z)};a.getObserverForPointAtDistance=K;a.headingTiltToDirectionUp=function(S,U,V,X,Y){return x(S).headingTiltToDirectionUp(U,V,X,Y)};a.internalToExternal=function(S,U,V){const X=S.renderSpatialReference,Y=B(S,U.eye,U.viewForward,U.up,N);S=S.spatialReference||h.WGS84;e.projectVectorToVector(U.eye,
X,P,S)||(S=h.WGS84,e.projectVectorToVector(U.eye,X,P,S));if(null==V)return new c(new g(P,S),Y.heading,Y.tilt,u.rad2deg(U.fov));V.position.x=P[0];V.position.y=P[1];V.position.z=P[2];V.position.spatialReference=S;V.heading=Y.heading;V.tilt=Y.tilt;V.fov=u.rad2deg(U.fov);return V};a.observerToCamera=O;a.scaleToDistance=D;a.scaleToZoom=function(S,U){if(S=S.basemapTerrain?.tilingScheme)return S.levelAtScale(U);H.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=
function(S,U,V){const X=e.projectVectorToPoint(V,S.renderSpatialReference,S.spatialReference||h.WGS84);if(null==X)return null;var Y=Math.tan(U.fovX/2),Z=Math.tan(U.fovY/2);U=k.dist(U.eye,V);Y*=2*U;Z*=2*U;return"global"===S.viewingMode?m.toExtent(S,X,Y,Z):l.toExtent(S,X,Y,Z)};a.zoomToScale=function(S,U){if(S=S.basemapTerrain?.tilingScheme)return S.scaleAtLevel(U);H.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,b,c,y,p,u,q,k,d){function f(x,D,A,v=d.createDirectionUp()){const {direction:B,up:C}=v;c.fromZRotation(t,-b.deg2rad(D));c.rotateX(t,t,b.deg2rad(A));p.transformMat4(B,m,t);p.scale(B,B,-1);p.transformMat4(C,l,t);return v}function g(x,D,A,v){return d.directionToHeadingTilt(D,A,v,m,l)}function e(x,
D,A,v){const B=f(x,A,v),C=u.create();p.scale(C,B.direction,-D);p.add(C,C,x);return{up:B.up,eye:C,heading:A,tilt:v}}function h(x){return b.rad2deg(x)}function z(x){return b.deg2rad(x)}function n(x,D,A,v,B){const C=x.renderSpatialReference;x=x.map&&x.spatialReference||D.spatialReference;k.projectPointToVector(D,w,C);k.projectPointToVector(D,r,C);w[0]-=A/2;r[0]+=A/2;w[1]-=v/2;r[1]+=v/2;k.projectVectorToVector(w,C,w,x);k.projectVectorToVector(r,C,r,x);B?(B.xmin=w[0],B.ymin=w[1],B.xmax=r[0],B.ymax=r[1],
B.spatialReference=x):B=new q(w[0],w[1],r[0],r[1],x);return B}const l=u.fromValues(0,1,0),m=u.fromValues(0,0,1),t=y.create(),w=u.create(),r=u.create();y=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:g,eyeForCenterWithHeadingTilt:e,eyeTiltToLookAtTilt:z,headingTiltToDirectionUp:f,lookAtTiltToEyeTilt:h,toExtent:n},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=y;a.directionToHeadingTilt=g;a.eyeForCenterWithHeadingTilt=e;a.eyeTiltToLookAtTilt=z;a.headingTiltToDirectionUp=
f;a.lookAtTiltToEyeTilt=h;a.toExtent=n})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,y){const p=y.create(),u=y.create();a.createDirectionUp=function(){return{direction:y.create(),up:y.create()}};a.directionToHeadingTilt=function(q,k,d,f,g){let e=c.normalize(p,q),h=c.dot(e,f);const z=0<h;h=Math.abs(h);.99<h&&(h=Math.abs(c.dot(k,f)),.99>h?(c.copy(e,k),z&&c.scale(e,e,-1)):e=null);
k=0;e&&(c.scale(u,f,c.dot(f,e)),c.subtract(e,e,u),k=c.dot(e,g)/(c.length(e)*c.length(g)),c.cross(u,e,g),k=(0<c.dot(u,f)?1:-1)*b.rad2deg(b.acosClamped(k)));q=b.rad2deg(b.acosClamped(-c.dot(f,q)/c.length(q)));if(!d)return{heading:k,tilt:q};d.heading=k;d.tilt=q;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(F,M,K,G=e.createDirectionUp()){u.cross(C,F,D);0===u.dot(C,C)&&u.cross(C,F,A);y.fromRotation(B,-c.deg2rad(M),F);y.rotate(B,B,-c.deg2rad(K),C);const {up:L,direction:O}=G;u.cross(L,C,F);u.normalize(L,L);u.transformMat4(L,L,B);u.normalize(O,F);u.negate(O,O);u.transformMat4(O,O,B);return G}function n(F,M,K,G){const L=C,O=E;u.normalize(L,F);u.cross(E,L,D);0===u.dot(E,E)&&u.cross(E,L,A);u.cross(O,E,L);return e.directionToHeadingTilt(M,K,G,L,O)}function l(F,
M,K,G){const L={eye:q.create(),up:null,tilt:G,heading:K},O=C;O[0]=F[0];O[1]=F[2];O[2]=-F[1];K=c.deg2rad(K);var I=c.deg2rad(G);G=Math.sin(K);K=Math.cos(K);var H=Math.sin(I),J=Math.cos(I);const N=u.length(O);if(1E-8>Math.abs(I))I=M+N;else{var R=N/H,W=c.asinClamped(M/R);I=R*Math.sin(Math.PI-I-W)}J*=M;R=M*M*H*H;W=K*K*R;const T=I-J,P=T*T;var Q=W*(W+P-O[1]*O[1]);if(0>Q)return u.scale(L.eye,O,I/N),L.tilt=0,t(L,F);var S=Math.sqrt(Q);const U=O[1]*T;Q=W+P;S=0<K?-S+U:S+U;if(1E-8>Math.abs(Q))return 1E-8>N?(L.eye[0]=
0,L.eye[1]=0,L.eye[2]=M):u.scale(L.eye,O,I/N),L.tilt=0,m(L.eye),t(L,F);L.eye[1]=S/Q;M*=H;S=L.eye[1]*L.eye[1];H=1-S;Q=Math.sqrt(H);R=W*S+G*G*R-2*K*M*L.eye[1]*Q*T+H*P;if(1E-8>Math.abs(R))return u.scale(L.eye,O,I/N),L.tilt=0,m(L.eye),t(L,F);L.eye[0]=(H*(I*O[0]-J*O[0])-M*Q*(O[0]*L.eye[1]*K+O[2]*G))/R;L.eye[2]=(H*(I*O[2]-J*O[2])-M*Q*(O[2]*L.eye[1]*K-O[0]*G))/R;u.scale(L.eye,L.eye,I);m(L.eye);return t(L,F)}function m(F){const M=F[1];F[1]=-F[2];F[2]=M}function t(F,M){M=z(M,F.heading,F.tilt);F.up=M.up;return F}
function w(F,M,K){M=u.length(M);K=c.asinClamped(K/(Math.sqrt(K*K+M*M-2*K*M*Math.cos(Math.PI-F))/Math.sin(F)));return c.rad2deg(F-K)}function r(F,M,K){F=c.deg2rad(F);M=u.length(M);return c.asinClamped(K/(M/Math.sin(F)))+F}function x(F,M,K,G,L){function O(N){const R=Math.PI/2;N=b.cyclical2PI.normalize(N,-R);N>R&&(N=Math.PI-N);return N}var I=M.latitude;var H=k.getReferenceEllipsoid(F.spatialReference).radius;M=M.longitude;var J=h.getLonDeltaForDistance(I,K,H)/2;K=M-J;M+=J;I=c.deg2rad(I);I=(1+Math.sin(I))/
(1-Math.sin(I));J=(I+1)*Math.tan(G/H/2);I=1.5*Math.PI-2*Math.atan(.5*(J+Math.sqrt(4*I+J*J)));G=I+G/H;I=O(I);G=O(G);G<I&&(H=G,G=I,I=H);I=Math.max(c.rad2deg(I),-90);G=Math.min(c.rad2deg(G),90);M=v.monotonic(K,M);180<M-K&&(H=(M-K-180)/2,K+=H,M-=H);H=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:f.WGS84;L?(L.xmin=K,L.ymin=I,L.xmax=M,L.ymax=G,L.spatialReference=H):L=new d(K,I,M,G,H);F.spatialReference&&F.spatialReference.isWebMercator&&g.geographicToWebMercator(L,!1,L);return L}
const D=q.fromValues(0,0,1),A=u.normalize(q.create(),q.fromValues(1,1,1)),v=new b.Cyclical(-180,180),B=p.create(),C=q.create(),E=q.create();p=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:n,eyeForCenterWithHeadingTilt:l,eyeTiltToLookAtTilt:r,headingTiltToDirectionUp:z,lookAtTiltToEyeTilt:w,toExtent:x},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=p;a.directionToHeadingTilt=n;a.eyeForCenterWithHeadingTilt=l;a.eyeTiltToLookAtTilt=r;a.headingTiltToDirectionUp=
z;a.lookAtTiltToEyeTilt=w;a.toExtent=x})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b,c){function y(p){return"array"in p}b=b._createClass(function(p,u=null,q=0){this.array=p;this.spatialReference=u;this.offset=q});a.SamplePosition=b;a.getElevationAtPoint=function(p,u,q="ground"){if(c.isDehydratedPoint(u))return p.getElevation(u.x,u.y,u.z||0,u.spatialReference,q);if(y(u)){let k=
u.offset;return p.getElevation(u.array[k++],u.array[k++],u.array[k]||0,u.spatialReference??p.spatialReference,q)}return p.getElevation(u[0],u[1],u[2]||0,p.spatialReference,q)};a.isSamplePosition=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports",
"../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,c){a.isSpatialReferenceSupported=function(y,p){return null==y?!1:null==p?!0:p===c.ViewingMode.Local?y.isGeographic?y.isWGS84||y.wkid===b.SupportedGCSWkids.CGCS2000:!0:y.isWebMercator||y.isWGS84||y.wkid===b.SupportedGCSWkids.CGCS2000||y.wkid===b.SupportedGCSWkids.GCSMARS2000||y.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||y.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F){function M(aa){return 360-k.cyclicalDegrees.normalize(aa)}function K(aa){return k.cyclicalDegrees.normalize(360-aa)}function G(aa){null!=aa&&aa.resolver&&aa.resolver.reject();return null}function L(aa,da,ca,na=null){if(!da)return G(na);var qa=aa.spatialReference||C.WGS84;if(null!=da.camera){aa=x.project(da.camera.position,qa);if(null==aa)return G(na);da=da.camera.clone();da.position=aa.clone();aa=da;null!=na&&na.resolver&&na.resolver.resolve(aa);
return aa}if(null==da.targetGeometry)return G(na);var ua=da.get("targetGeometry.spatialReference");if(ua&&!x.canProject(ua,qa))return G(na);qa=A.internalToExternal(aa,aa.state.camera);ua=A.OrientationMode.ADJUST;null!=da.rotation&&(qa.heading=M(da.rotation),ua=A.OrientationMode.LOCKED);null!=ca&&(qa.tilt=ca);if("point"===da.targetGeometry.type){const sa=da.targetGeometry;ca=da.targetGeometry.clone();da=null!=da.scale?A.scaleToDistance(aa,da.scale,sa.latitude):aa.state.camera.distance;return A.fromCenterDistance(aa,
ca,da,qa,ua,na)}return(da=da.targetGeometry.extent)?A.fromExtent(aa,da,qa.heading,qa.tilt,ua,na):G(na)}function O(aa,da){return null==da.scale&&null!=da.zoom?A.zoomToScale(aa,da.zoom):da.scale}function I(aa,da){let ca=!1;null!=da.heading?(aa.heading=da.heading,ca=!0):null!=da.rotation&&(aa.heading=M(da.rotation),ca=!0);null!=da.tilt&&(aa.tilt=da.tilt,ca=!0);null!=da.fov&&(aa.fov=da.fov);return ca}function H(aa,da,ca,na){const qa=aa.spatialReference||C.WGS84;da=null!=da?da:A.externalToInternal(aa,
ca);if(null==da)return na;na.targetGeometry=l.projectVectorToPoint(da.center,aa.renderSpatialReference,qa);na.scale=A.computeScale(aa,da);na.rotation=K(ca.heading);na.camera=ca;return na}function J(aa,da,ca){var na=()=>new d("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!da)throw na();if(!x.canProject(da.spatialReference,aa.spatialReference))throw new d("viewpointutils:incompatible-spatialreference",`Spatial reference (${da.spatialReference?da.spatialReference.wkid:
"unknown"}) is incompatible with the view (${aa.spatialReference?.wkid})`,{geometry:da});const qa=[];if(!da.hasZ&&aa.basemapTerrain){switch(da.type){case "point":var ua=da;break;case "multipoint":case "polyline":ua=da.extent?.center;break;case "mesh":ua=da.origin;break;case "extent":ua=da.center;break;case "polygon":ua=da.centroid}ua&&null!=aa.basemapTerrain.spatialReference&&x.canProject(ua,aa.basemapTerrain.spatialReference)&&aa.elevationProvider?X[2]=v.getElevationAtPoint(aa.elevationProvider,
ua)??0:X[2]=0}(0,ba[da.type])(da,sa=>{qa.push(sa[0],sa[1],sa[2])},X);ua=qa.length/3;if(0===ua)throw na();na=Array(qa.length);if(l.projectBuffer(qa,da.spatialReference,0,na,aa.spatialReference,0,ua))for(da.hasZ&&(ca.hasZ=!0),aa=0;aa<na.length;aa+=3)da.hasZ?(X[0]=na[aa],X[1]=na[aa+1],X[2]=na[aa+2]):(X[0]=na[aa],X[1]=na[aa+1]),m.expandWithVec3(ca.boundingBox,X)}async function N(aa,da,ca,na){const qa=await u.result(aa.whenViewForGraphic(da));if(!1!==qa.ok&&null!=qa.value&&"whenGraphicBounds"in qa.value)if(ca=
await u.result(qa.value.whenGraphicBounds(da,{minDemResolution:ca})),!1===ca.ok)J(aa,da.geometry,na);else{var {screenSpaceObjects:ua,boundingBox:sa}=ca.value;m.expandWithAABB(na.boundingBox,sa);ua&&ua.forEach(pa=>{na.screenSpaceObjects.push(pa)});isFinite(sa[2])&&(na.hasZ=!0)}else J(aa,da.geometry,na)}async function R(aa,da,ca,na){if(Array.isArray(da)&&2===da.length){const qa=da[0],ua=da[1];if("number"===typeof qa&&"number"===typeof ua){fa.x=qa;fa.y=ua;fa.z=void 0;fa.spatialReference=aa.spatialReference?.isGeographic?
aa.spatialReference:C.WGS84;J(aa,fa,na);return}}da&&"map"in da&&"function"===typeof da.map?await f.eachAlways(da.map(qa=>R(aa,qa,ca,na))):da instanceof F?J(aa,da,na):da instanceof y&&await N(aa,da,ca,na)}async function W(aa,da,ca,na,qa){if(null!=da.camera)return T(aa,da.camera,qa);qa.scale=da.scale;qa.rotation=da.rotation;qa.targetGeometry=null!=da.targetGeometry?da.targetGeometry.clone():null;qa.camera=null;null!=ca.heading?qa.rotation=K(ca.heading):null!=ca.rotation&&(qa.rotation=ca.rotation);da=
O(aa,ca);null!=da&&(qa.scale=da);na=new A.AsyncContext(na);L(aa,qa,ca.tilt,na);qa.camera=await na.resolver.promise;return qa}function T(aa,da,ca){const na=x.project(da.position,aa.spatialReference);if(null==na)return null;da=da.clone();da.fov=aa.camera.fov;da.position=na;return H(aa,null,da,ca)}async function P(aa,da,ca,na,qa,ua){if(null==ca)throw new d("createfromcenter","invalid point");ua.targetGeometry=ca.clone();var sa=D.cameraOnContentAlongViewDirection(aa);if(da.position)return ca=ua.targetGeometry,
da=da.position,qa=aa.renderSpatialReference,l.projectPointToVector(da,ia,qa),l.projectPointToVector(ca,oa,qa),ua.targetGeometry=new B(ca),na.position=new B(da),z.subtract(ha,oa,ia),A.directionToHeadingTilt(aa,ia,ha,sa.up,na),ua.scale=A.distanceToScale(aa,z.distance(ia,oa),ua.targetGeometry.latitude),ua.rotation=K(na.heading),ua.camera=na,ua;if(da.zoomFactor){var pa=sa.distance/da.zoomFactor;const ka=z.scale(X,sa.viewForward,-pa);sa.eye=z.add(X,sa.center,ka);ua.scale=A.distanceToScale(aa,pa,ca.latitude)}A.internalToExternal(aa,
sa,na);pa=I(na,da)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;da.zoomFactor||(da=O(aa,da),null==da?(l.projectPointToVector(ca,X,aa.renderSpatialReference),w.intersectsPoint(sa.frustum,X)?ua.scale=A.distanceToScale(aa,z.distance(sa.eye,X),ca.latitude):ua.scale=A.computeScale(aa,sa)):ua.scale=da,sa=new A.AsyncContext(qa),A.fromCenterScale(aa,ua.targetGeometry,ua.scale,na,pa,sa),ua.camera=await sa.resolver.promise);return ua}async function Q(aa,da,ca,na,qa){var ua=D.cameraOnContentAlongViewDirection(aa);
ua=l.projectVectorToPoint(ua.center,aa.renderSpatialReference,aa.spatialReference);return P(aa,da,ua,ca,na,qa)}async function S(aa,da,ca,na,qa,ua){ua.targetGeometry=ca.clone();const sa=D.cameraOnContentAlongViewDirection(aa);A.internalToExternal(aa,sa,na);da=I(na,da)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;qa=new A.AsyncContext(qa);A.fromExtent(aa,ca,na.heading,na.tilt,da,qa);ua.camera=await qa.resolver.promise;return ua}async function U(aa,da,ca,na,qa,ua,sa,pa){pa.targetGeometry=ca.clone();
const ka=D.cameraOnContentAlongViewDirection(aa);var ra=0;null!=ca.z?ra=ca.z:aa.basemapTerrain&&aa.elevationProvider&&(ra=v.getElevationAtPoint(aa.elevationProvider,ca));z.set(X,ca.x,ca.y,ra);l.computeTranslationToOriginAndRotation(aa.spatialReference,X,Y,aa.renderSpatialReference);g.fromMat4(Z,Y);g.transpose(Z,Z);m.empty(ea);ca=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var va=0;va<ca.length;va++){const Ca=ca[va];let Ba=na[Ca[2]];isFinite(Ba)||(Ba=ra);z.set(X,na[Ca[0]],
na[Ca[1]],Ba);l.projectVectorToVector(X,aa.spatialReference,X,aa.renderSpatialReference);m.expandWithVec3(ea,z.transformMat3(X,X,Z))}na=m.width(ea);ra=m.height(ea);ca=m.depth(ea);va=1/Math.tan(ka.fovY/2);qa=Math.max(.5*Math.sqrt(na*na+ca*ca)*Math.max(va,1/Math.tan(ka.fovX/2))+.5*ra,.5*ra*va+.5*Math.max(na,ca))/qa;A.internalToExternal(aa,ka,ua);da=I(ua,da)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;pa.scale=A.distanceToScale(aa,qa,pa.targetGeometry.latitude);sa=new A.AsyncContext(sa);A.fromCenterScale(aa,
pa.targetGeometry,pa.scale,ua,da,sa);pa.camera=await sa.resolver.promise;return pa}function V(aa){aa&&null!=aa.camera&&(aa.rotation=K(aa.camera.heading));return aa}const X=n.create(),Y=h.create(),Z=e.create(),ea=m.create(),ja=t.create(),ha=n.create(),ia=n.create(),oa=n.create(),ma={heading:0,tilt:0},fa=new B,ba={point(aa,da,ca){ca[0]=aa.x;ca[1]=aa.y;null!=aa.z&&(ca[2]=aa.z);da(ca)},polygon(aa,da,ca){const na=aa.hasZ;for(let qa=0;qa<aa.rings.length;qa++){const ua=aa.rings[qa];for(let sa=0;sa<ua.length;sa++)ca[0]=
ua[sa][0],ca[1]=ua[sa][1],na&&(ca[2]=ua[sa][2]),da(ca)}},polyline(aa,da,ca){const na=aa.hasZ;for(let qa=0;qa<aa.paths.length;qa++){const ua=aa.paths[qa];for(let sa=0;sa<ua.length;sa++)ca[0]=ua[sa][0],ca[1]=ua[sa][1],na&&(ca[2]=ua[sa][2]),da(ca)}},multipoint(aa,da,ca){const na=aa.points;aa=aa.hasZ;for(let qa=0;qa<na.length;qa++)ca[0]=na[qa][0],ca[1]=na[qa][1],aa&&(ca[2]=na[qa][2]),da(ca)},extent(aa,da,ca){null!=aa.zmin&&null!=aa.zmax?(da(z.set(ca,aa.xmin,aa.ymin,aa.zmin)),da(z.set(ca,aa.xmax,aa.ymin,
aa.zmin)),da(z.set(ca,aa.xmin,aa.ymax,aa.zmin)),da(z.set(ca,aa.xmax,aa.ymax,aa.zmin)),da(z.set(ca,aa.xmin,aa.ymin,aa.zmax)),da(z.set(ca,aa.xmax,aa.ymin,aa.zmax)),da(z.set(ca,aa.xmin,aa.ymax,aa.zmax)),da(z.set(ca,aa.xmax,aa.ymax,aa.zmax))):(da(z.set(ca,aa.xmin,aa.ymin,ca[2])),da(z.set(ca,aa.xmax,aa.ymin,ca[2])),da(z.set(ca,aa.xmin,aa.ymax,ca[2])),da(z.set(ca,aa.xmax,aa.ymax,ca[2])))},mesh(aa,da,ca){if(aa=aa.vertexAttributes&&aa.vertexAttributes.position)for(let na=0;na<aa.length;na+=3)da(z.set(ca,
aa[na],aa[na+1],aa[na+2]))}};a.create=async function(aa,da,ca){if(da&&aa.spatialReference){var na={target:void 0};"declaredClass"in da||Array.isArray(da)?na.target=da:(Object.assign(na,da),da.center&&!na.target&&(na.target=da.center));da=na}else da=null;if(!da)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");na=new b({fov:aa.camera.fov});const qa=new p({camera:na});if(da.target instanceof p)return aa=await W(aa,da.target,da,ca,qa),V(aa);if(da.target instanceof
b)return V(T(aa,da.target,qa));var ua=null!=da.scale||null!=da.zoom;if(da.target instanceof E){var sa=da.target.xmin===da.target.xmax||da.target.ymin===da.target.ymax;return ua||sa?V(await P(aa,da,da.target.center,na,ca,qa)):V(await S(aa,da,da.target,na,ca,qa))}sa={boundingBox:m.empty(),hasZ:!1,screenSpaceObjects:[]};var pa=ua?(pa=O(aa,da))?r.getResolutionInMetersForScale(pa):void 0:void 0;await R(aa,da.target,pa,sa);if(isFinite(sa.boundingBox[0])){m.center(sa.boundingBox,X);fa.x=X[0];fa.y=X[1];fa.z=
X[2];fa.spatialReference=aa.spatialReference;isFinite(fa.z)&&sa.hasZ?pa=m.isPoint(sa.boundingBox):(fa.z=void 0,pa=t.isPoint(m.toRect(sa.boundingBox,ja)));if(ua||pa)return V(await P(aa,da,fa,na,ca,qa));ua=sa.screenSpaceObjects;if(ua.length){pa=Number.NEGATIVE_INFINITY;for(let ka=0;ka<ua.length;ka++){const ra=ua[ka].screenSpaceBoundingRect;pa=Math.max(pa,Math.abs(ra[0]),Math.abs(ra[1]),Math.abs(ra[2]),Math.abs(ra[3]))}ua=.66-pa/Math.min(aa.width,aa.height)*2}else ua=.66;return V(await U(aa,da,fa,sa.boundingBox,
ua,na,ca,qa))}return da.position?(ca=D.cameraOnContentAlongViewDirection(aa),z.copy(ha,ca.viewForward),A.directionToHeadingTilt(aa,ca.eye,ha,ca.up,ma),na.position=new B(da.position),na.heading=null!=da.heading?da.heading:ma.heading,na.tilt=null!=da.tilt?da.tilt:ma.tilt,aa=H(aa,null,na,qa),V(aa)):V(await Q(aa,da,na,ca,qa))};a.fromCamera=function(aa,da,ca=null){null==ca&&(ca=new p);return H(aa,null,da.clone(),ca)};a.headingToRotation=K;a.rotationToHeading=M;a.toCamera=L;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,y,p,u,q){u=function(k){function d(f,g,e){var h=k.call(this,!0)||this;h._view=f;h.pointerAction=g;h.registerIncoming("drag",e,z=>h._handleDrag(z));return h}b._inherits(d,
k);d.prototype._handleDrag=function(f){const g=f.data;if(!(1<g.pointers.size)&&q.eventMatchesMousePointerAction(f.data,this.pointerAction)){var e=c.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?new y.ZoomController({view:this._view}):new p.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);
break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}f.stopPropagation()}};return b._createClass(d)}(u.InputHandler);a.DragZoom=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){a.ZoomController=function(M){function K(){var L=M.apply(this,arguments)||this;L._pickPoint=n.create();L._tmpP0=h.create();L._panAxisAngle=m.create();L._tmpRayDir=n.create();L._tmpRayDirPick=n.create();L._targetOnSphere=n.create();L._navMode=B.NavigationMode.Horizontal;L._tmpRay={origin:n.create(),direction:n.create()};L.dragBeginPoint=p.createScreenPointArray();L._normalizedAnchorPoint=h.create();L._constraintOptions={selection:r.ConstraintTypes.ALL_EXCEPT_COLLISION,
interactionType:x.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};L._sphere=t.create();L._hasPickPoint=!1;return L}b._inherits(K,M);var G=K.prototype;G.begin=function(L){if(this.active){e.copy(this.dragBeginPoint,L);B.normalizeCoordinate(this.startCamera,L,this._normalizedAnchorPoint);var O=l.getReferenceEllipsoid(this.view.spatialReference),I=B.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,L,O,B.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?B.contentIntersectorOptions:{});this._navMode=B.decideNavigationMode(this.startCamera,L,O);if(this._navMode===B.NavigationMode.Horizontal)this._hasPickPoint=!!I.scenePickPoint,this._pickPoint=I.scenePickPoint??this._pickPoint,this._sphere=I.sphere;else{C.fromScreenAtEye(this.startCamera,L,this._tmpRay);z.normalize(this._tmpRay.direction,this._tmpRay.direction);let H;null!=I.scenePickPoint&&(z.subtract(this._tmpRayDirPick,this.startCamera.eye,I.scenePickPoint),H=z.length(this._tmpRayDirPick));
O=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,F);O=y.clamp(Math.min(B.PIVOT_DISTANCE_MODIFIER,1/Math.abs(z.dot(F,this._tmpRay.direction)))*O,B.DISTANCE_CLAMP_VALUES[0],B.DISTANCE_CLAMP_VALUES[1]);L=this.view._stage.renderView.getMinimalDepthForArea(null,L[0],L[1],this.view.state.camera,B.SCREEN_PIXEL_AREA);O=null!=L?L:O;O=null!=H?Math.min(O,H):O;this._hasPickPoint=!0;z.scale(this._tmpRay.direction,this._tmpRay.direction,O);z.add(this._pickPoint,
this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}};G.update=function(L){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===B.NavigationMode.Horizontal){z.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var O=z.length(this._tmpRayDir);B.normalizeCoordinate(this.currentCamera,L,this._tmpP0);var I=
12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),H=O*2**I;const J=this.view.state.constraints.minimumPoiDistance;0>I&&H<J&&(H=J);if(1E-6>Math.abs(O-H))return;this._hasPickPoint&&H<O&&(I=1-(1-H/O)*(1-this._sphere[3]/z.length(this.currentCamera.center)),this.currentCamera.center=z.scale(E,this.currentCamera.center,I));z.scale(this._tmpRayDir,this._tmpRayDir,-H/O);this.currentCamera.eye=z.add(E,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(e.distance(this.dragBeginPoint,
L));w.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(B.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),m.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),B.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{O=z.length(this._tmpRay.direction);B.normalizeCoordinate(this.currentCamera,L,this._tmpP0);L=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);H=O*2**L;I=this.view.state.constraints.minimumPoiDistance;
0>L&&H<I&&(H=I);if(1E-6>Math.abs(O-H))return;z.scale(this._tmpRayDir,this._tmpRay.direction,1-H/O);this.currentCamera.eye=z.add(E,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=z.add(E,this.currentCamera.center,this._tmpRayDir)}D.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}};G.end=function(){this.active&&this.finishController()};b._createClass(K,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return K}(v.InteractiveController);
a.ZoomController=c.__decorate([g.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const E=n.create(),F=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){a.ZoomController=function(B){function C(){var F=B.apply(this,arguments)||this;F._tmpP=n.create();F._tmpDir=n.create();F._tmpN=n.create();F._tmpP0=h.create();F._tmpPoi=n.create();F._tmpRayDir=n.create();F.dragBeginPoint=p.createScreenPointArray();F._normalizedAnchorPoint=h.create();F._constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:w.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:n.create(),
tiltMode:r.TiltMode.TUMBLE};F._plane=l.create();return F}b._inherits(C,B);var E=C.prototype;E.begin=function(F){if(this.active){e.copy(this.dragBeginPoint,F);D.normalizeCoordinate(this.startCamera,F,this._normalizedAnchorPoint);var M=this._intersectionHelper.intersectScreenFreePointFallback(F,this._tmpP,0===this.view.map.ground.opacity?D.contentIntersectorOptions:{});z.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var K=z.length(this._tmpDir);z.normalize(this._tmpDir,this._tmpDir);var G=
Math.abs(this.view.camera.position.z);G=y.clamp(Math.min(D.PIVOT_DISTANCE_MODIFIER,1/Math.abs(z.dot(v,this._tmpDir)))*G,D.DISTANCE_CLAMP_VALUES[0],D.DISTANCE_CLAMP_VALUES[1]);F=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,F[0],F[1],this.view.state.camera,D.SCREEN_PIXEL_AREA);G=null!=F?F:G;G=M?Math.min(G,K):G;z.scale(this._tmpDir,this._tmpDir,G);z.add(this._tmpP,this.startCamera.eye,this._tmpDir);z.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);z.normalize(this._tmpN,
this._tmpN);0>this._tmpN[1]&&z.negate(this._tmpN,this._tmpN);l.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}};E.update=function(F){if(this.active){D.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||z.copy(this._tmpPoi,this.currentCamera.center);D.normalizeCoordinate(this.currentCamera,F,this._tmpP0);var M=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);e.copy(this._normalizedAnchorPoint,
this._tmpP0);z.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var K=z.length(this._tmpRayDir),G=K*(1-M);this._constraintOptions.interactionDirection&&(z.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),z.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(M)/K));var L=this.view.state.constraints.minimumPoiDistance;0<=M&&G<L&&(G=L,M=-(G-K)/K);1E-6>Math.abs(K-G)||(z.scale(this._tmpRayDir,this._tmpRayDir,M),this.currentCamera.eye=
z.add(A,this.currentCamera.eye,this._tmpRayDir),z.lerp(A,this.currentCamera.center,this._tmpPoi,M),A[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],A[2]):Math.min(this.startCamera.center[2],A[2]),this.currentCamera.center=A,this._constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(e.distance(this.dragBeginPoint,F)),m.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}};E.end=function(){this.active&&this.finishController()};
b._createClass(C,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return C}(x.InteractiveController);a.ZoomController=c.__decorate([g.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const A=n.create(),v=n.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,b,c,y,p,u){u=function(q){function k(f){var g=q.call(this,!0)||this;g._view=f;g._watchHandles=new c;g._handle=g.registerIncoming("gamepad",e=>g._handleEventGamepad(e));g._handle.pause();return g}b._inherits(k,q);var d=k.prototype;d.onInstall=function(f){b._get(b._getPrototypeOf(k.prototype),"onInstall",this).call(this,f);this._watchHandles.add([y.watch(()=>this._view.navigation.gamepad.enabled,g=>{g?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),
this._cameraControllerGamepad=null))},y.initial),y.watch(()=>this._view.navigation.gamepad.device,g=>{this._cameraControllerGamepad&&g&&this._cameraControllerGamepad.gamepadDevice!==g&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])};d.onUninstall=function(){this._watchHandles.removeAll();b._get(b._getPrototypeOf(k.prototype),"onUninstall",this).call(this)};d._handleEventGamepad=function(f){var g=this._view.navigation.gamepad.device;if(!g||f.data.device===
g)if((g=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||p.GamepadKeyboardController.activatesFor(this._view,f.data))g||(g=new p.GamepadKeyboardController({view:this._view,gamepadDevice:f.data.device}),this._view.state.switchCameraController(g)&&(this._cameraControllerGamepad=g)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===f.data.device&&this._cameraControllerGamepad.handleEventGamepad(f.data)};return b._createClass(k)}(u.InputHandler);
a.GamepadNavigation=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){a.GamepadKeyboardController=function(W){function T(Q){Q=W.call(this,Q)||this;Q._filteredSurfaceElevation=0;Q._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};Q._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];Q._tmpCamera=new M.Camera;Q._headingStart=0;Q._constraintOptions={selection:r.ConstraintTypes.ALL,interactionType:x.InteractionType.NONE,interactionStartCamera:new M.Camera,interactionFactor:0,interactionDirection:null,
tiltMode:D.TiltMode.LOOK_AROUND};return Q}b._inherits(T,W);var P=T.prototype;P.handleEventGamepad=function(Q){const S=K.extractTransformation(Q,this.view.navigation.gamepad,this._transformation);("end"===Q.action||K.isZeroTransformation(S))&&this.finishController()};P.activateDirection=function(Q){this._keysButtonState[Q]=1;K.extractTransformationKeyboard(this._keysButtonState,this._transformation)};P.deactivateDirection=function(Q){this._keysButtonState[Q]=0;Q=K.extractTransformationKeyboard(this._keysButtonState,
this._transformation);K.isZeroTransformation(Q)&&this.finishController()};P.onControllerStart=function(Q){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;b._get(b._getPrototypeOf(T.prototype),"onControllerStart",this).call(this,Q)};P._updateFilteredSurfaceElevation=function(Q){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*Q};P.stepController=function(Q,
S){this._updateStartHeading();this._updateFilteredSurfaceElevation(Q);this.currentCamera.copyViewFrom(S);this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(Q,this.currentCamera,H);this._applyDisabledMovementTypes(H);this._applyPan(H.pan);this._applyRotate(H.rotate);this._applyZoom(H.zoom);this._applyAscend(H.ascend);this._constraintOptions.interactionType=x.InteractionType.NONE;this._constraintOptions.selection=
r.ConstraintTypes.COLLISION;w.applyAll(this.view,this.currentCamera,this._constraintOptions);b._get(b._getPrototypeOf(T.prototype),"stepController",this).call(this,Q,S)};P._updateStartHeading=function(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)};P._applyRotate=function(Q){if(Q.enabled){var S=this.currentCamera;e.subtract(J,S.center,S.eye);e.transformMat4(J,J,Q.matrix);S.center=e.add(J,J,S.eye);S.up=e.transformMat4(J,S.up,Q.matrix);this._constraintOptions.interactionType=
x.InteractionType.LOOK_AROUND;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,S,this._constraintOptions)}};P._applyPan=function(Q,S=this.currentCamera){Q.enabled&&(S.eye=e.transformMat4(J,S.eye,Q.matrix),S.center=e.transformMat4(J,S.center,Q.matrix),this.view.state.isGlobal&&(S.up=e.transformMat4(J,S.up,Q.matrix)),this._constraintOptions.interactionType=x.InteractionType.PAN,this._constraintOptions.selection=r.ConstraintTypes.ALL,w.applyAll(this.view,
S,this._constraintOptions))};P._applyZoom=function(Q){if(Q){var S=this.currentCamera.viewForward;this.currentCamera.eye=e.add(J,this.currentCamera.eye,e.scale(t.sv3d.get(),S,Q));e.copy(N,S);e.negate(N,N);this._constraintOptions.interactionDirection=N;this._constraintOptions.interactionType=x.InteractionType.ZOOM;this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};
P._applyAscend=function(Q){if(Q){var S=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,t.sv3d.get());this._constraintOptions.interactionDirection=e.copy(N,S);this.view.state.isGlobal?(S=e.length(this.currentCamera.eye),Q=(S+Q)/S,this.currentCamera.eye=e.scale(J,this.currentCamera.eye,Q),this.currentCamera.center=e.scale(J,this.currentCamera.center,Q)):(Q=e.scale(t.sv3d.get(),S,Q),this.currentCamera.eye=e.add(J,this.currentCamera.eye,Q),this.currentCamera.center=e.add(J,this.currentCamera.center,
Q));this._updateCameraCenter();this._constraintOptions.interactionType=x.InteractionType.ASCEND;this._constraintOptions.selection=r.ConstraintTypes.COLLISION;w.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=r.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};P._calculateControlTransformation=function(Q,S,U){U.zoom=0;U.ascend=
0;U.pan.enabled=!1;f.identity(U.pan.matrix);U.rotate.enabled=!1;f.identity(U.rotate.matrix);Q=this._computeVelocities(Q);this.view.state.isLocal?this._calculateControlTransformationLocal(Q,S,U):this._calculateControlTransformationGlobal(Q,S,U)};P._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,J)};P._calculateControlTransformationLocal=
function(Q,S,U){const {viewRight:V,viewForward:X}=S,Y=this._transformation;var Z=this.view.navigation.gamepad,ea=e.set(t.sv3d.get(),X[0],X[1],0);e.normalize(ea,ea);var ja=Y.translation[0]*Q.pan;0!==ja&&(ja=e.scale(t.sv3d.get(),V,ja),f.translate(U.pan.matrix,U.pan.matrix,ja),U.pan.enabled=!0);switch(Z.mode){case "pan":Z=-Y.translation[1]*Q.pan;0!==Z&&(ea=e.scale(t.sv3d.get(),ea,Z),f.translate(U.pan.matrix,U.pan.matrix,ea),U.pan.enabled=!0);U.zoom=Y.zoom*Q.zoom;break;case "zoom":U.zoom=(-Y.translation[1]+
Y.zoom)*Q.zoom;break;default:y.neverReached(Z.mode)}U.ascend=Y.translation[2]*Q.ascend;ea=-Y.heading*Q.rotate;0!==ea&&(f.rotate(U.rotate.matrix,U.rotate.matrix,ea,this.view.renderCoordsHelper.worldUpAtPosition(S.eye,t.sv3d.get())),U.rotate.enabled=!0);Q=Y.tilt*Q.rotate;S=C.viewAngle(this.view.renderCoordsHelper,S.center,S.eye);if(S=p.clamp(S+Q,A.TiltDefault.min,A.TiltDefault.max)-S)f.rotate(U.rotate.matrix,U.rotate.matrix,S,V),U.rotate.enabled=!0};P._calculateControlTransformationGlobal=function(Q,
S,U){const {eye:V,viewRight:X}=S,Y=this._transformation;var Z=this.view.navigation.gamepad,ea=e.cross(t.sv3d.get(),X,V);e.normalize(ea,ea);e.negate(ea,ea);B.panMotionToRotationMatrix(this.startCamera,S,Y,Q,this.view.camera.heading,this._headingStart,this.view.camera.tilt,U,Z);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(H.pan,this._tmpCamera);Z=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;U.ascend=Y.translation[2]*Q.ascend;ea=-Y.heading*Q.rotate;0!==ea&&
(f.rotate(U.rotate.matrix,U.rotate.matrix,ea,this._tmpCamera.eye),U.rotate.enabled=!0);S=this._clampTiltDeltaGlobalToValidRange(Y.tilt*Q.rotate,S.ray,Z);0!==S&&(f.rotate(U.rotate.matrix,U.rotate.matrix,S,this._tmpCamera.viewRight),U.rotate.enabled=!0);U.zoom+=Y.zoom*Q.zoom};P._clampTiltDeltaGlobalToValidRange=function(Q,S,U){const V=z.getReferenceEllipsoid(this.view.spatialReference),X=B.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.min,S.origin,U,V);var Y=0;let Z=0;Y=t.sv3d.get();this.view.renderCoordsHelper.intersectManifold(S,
U,Y)?(Y=C.viewAngle(this.view.renderCoordsHelper,Y,S.origin),Y=B.onSurfaceTiltToEyeTiltGlobal(Y,S.origin,U,V),Z=B.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,S.origin,U,V)):(l.closestPointOnSilhouette(l.fromRadius(l.tmpSphere,U+V.radius),S,Y),Y=Math.PI+m.angle(S.direction,Y),Y=B.offSurfaceTiltToEyeTiltGlobal(Y,S.origin,U,V),Z=B.offSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,S.origin,U,V));return p.clamp(Y+Q,X,Z)-Y};P._getPointAbsoluteSurfaceElevation=function(Q,S,U){const {renderCoordsHelper:V}=
this.view,X=V.getAltitude(Q);S+=Math.abs(X-S);V.setAltitude(U,S,Q);return S};P._clampedDistanceToSurface=function(Q,S){const {renderCoordsHelper:U}=this.view,{camera:V}=this.view.state;var {direction:X}=E.headingTiltToDirectionUp(this.view,S,0,80,R);X=U.intersectManifoldClosestSilhouette(n.wrap(S,X),Q,t.sv3d.get());X=e.distance(S,X);Q=U.intersectManifoldClosestSilhouette(n.wrap(S,e.direction(t.sv3d.get(),S,V.center)),Q,t.sv3d.get());S=e.distance(S,Q);return Math.min(X,S)};P._computeHeadingRotateRadius=
function(Q){const {renderCoordsHelper:S,state:U}=this.view,{camera:V,isGlobal:X}=U;var Y=S.intersectManifoldClosestSilhouette(V.ray,this._filteredSurfaceElevation,t.sv3d.get());if(X){const Z=e.subtract(t.sv3d.get(),Q,Y);Y=e.length(Z);e.scale(Z,Z,1/Y);Q=e.normalize(t.sv3d.get(),Q);Q=p.acosClamped(e.dot(Q,Z));return Y*Math.sin(Math.min(L,Q))}Q=e.copy(t.sv3d.get(),Q);S.setAltitude(Q,this._filteredSurfaceElevation);return e.distance(Y,Q)};P._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?
0:5};P._computeVelocities=function(Q){var S=this._filteredSurfaceElevation,U=S+z.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:V,isGlobal:X}=this.view.state;var Y=t.sv3d.get();const Z=this._getPointAbsoluteSurfaceElevation(V.eye,S,Y);var ea=this._clampedDistanceToSurface(S,Y);const ja=V.width/2,ha=.75*V.width,ia=.75*V.width;var oa=ea*Math.tan(.5*V.fovX)/ja;U=oa/U;Y=oa/this._computeHeadingRotateRadius(Y);oa=(X?U:oa)*ha*Q;S=Z-S;S=Math.max(this._minimumAscendVelocity()*Q,2**
(ha*Q/ja)*S-S);ea=2**(ha*Q/ja)*ea-ea;Q*=p.clamp(Y*ia,O,I);return{pan:oa,ascend:S,zoom:ea,rotate:Q}};P._applyDisabledMovementTypes=function(Q){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(Q.zoom=this.disableMovements.zoom?0:Q.zoom,Q.ascend=this.disableMovements.ascend?0:Q.ascend,Q.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&f.identity(Q.pan.matrix),Q.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&
f.identity(Q.rotate.matrix))};T.activatesFor=function(Q,S){Q=K.extractTransformation(S,Q.navigation.gamepad,G);return!("end"===S.action||K.isZeroTransformation(Q))};return b._createClass(T)}(v.InteractiveController);c.__decorate([u.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([u.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([d.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
a.GamepadKeyboardController);const G={translation:[0,0,0],heading:0,tilt:0,zoom:0},L=p.deg2rad(80),O=p.deg2rad(30),I=p.deg2rad(80),H={zoom:0,ascend:0,pan:{enabled:!1,matrix:g.create()},rotate:{enabled:!1,matrix:g.create()}},J=h.create(),N=h.create(),R=F.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(y){let p=y*y;0>y&&(p*=-1);return p}a.extractTransformation=
function(y,p,u){const q=y.state;y=y.device;p="forward-down"===p.tiltDirection?1:-1;"standard"===y.deviceType?(u.translation[0]=c(q.axes[0]),u.translation[1]=c(q.axes[1]),u.translation[2]=c(q.buttons[7])-c(q.buttons[6]),u.heading=c(q.axes[2]),u.tilt=c(q.axes[3])):"spacemouse"===y.deviceType&&(u.translation[0]=1.2*c(q.axes[0]),u.translation[1]=1.2*c(q.axes[1]),u.translation[2]=2*-c(q.axes[2]),u.heading=1.2*c(q.axes[5]),u.tilt=1.2*c(q.axes[3]));u.tilt*=p;b.scale(u.translation,u.translation,1);return u};
a.extractTransformationKeyboard=function(y,p){p.translation[0]=y[1]-y[0];p.translation[1]=y[3]-y[2];p.translation[2]=y[4]-y[5];p.heading=y[7]-y[6];p.tilt=y[8]-y[9];p.zoom=y[10]-y[11];return p};a.isZeroTransformation=function(y){return 0===y.translation[0]&&0===y.translation[1]&&0===y.translation[2]&&0===y.heading&&0===y.tilt&&0===y.zoom};a.resetTransformation=function(y){y.translation[0]=0;y.translation[1]=0;y.translation[2]=0;y.heading=0;y.tilt=0;return y};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,y,p){var u;(function(q){q[q.LEFT=0]="LEFT";q[q.RIGHT=1]="RIGHT";q[q.FORWARD=2]="FORWARD";q[q.BACKWARD=3]="BACKWARD";q[q.UP=4]="UP";q[q.DOWN=5]="DOWN";q[q.HEADINGLEFT=6]="HEADINGLEFT";q[q.HEADINGRIGHT=7]="HEADINGRIGHT";q[q.TILTUP=8]="TILTUP";
q[q.TILTDOWN=9]="TILTDOWN";q[q.ZOOMIN=10]="ZOOMIN";q[q.ZOOMOUT=11]="ZOOMOUT"})(u||(u={}));p=function(q){function k(f,g){var e=q.call(this,!0)||this;e._view=f;e._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};e._keyToNumber={[g.left]:u.LEFT,[g.right]:u.RIGHT,[g.forward]:u.FORWARD,[g.backward]:u.BACKWARD,[g.up]:u.UP,[g.down]:u.DOWN,[g.headingLeft]:u.HEADINGLEFT,[g.headingRight]:u.HEADINGRIGHT,[g.tiltUp]:u.TILTUP,[g.tiltDown]:u.TILTDOWN,[g.zoomIn]:u.ZOOMIN,[g.zoomOut]:u.ZOOMOUT};
e.registerIncoming("key-down",null,h=>e._handleKeyDown(h));e.registerIncoming("key-up",null,h=>e._handleKeyUp(h));e.registerIncoming("blur",null,()=>e._handleBlur());return e}b._inherits(k,q);var d=k.prototype;d._handleKeyDown=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var g=this._keyToNumber[f.data.key];null!=g&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new y.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),
this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(g),f.stopPropagation()))}};d._handleBlur=function(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)};d._handleKeyUp=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var g=this._keyToNumber[f.data.key];null!=g&&this._cameraControllerKeyboard&&
this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(g),f.stopPropagation())}};return b._createClass(k)}(p.InputHandler);a.KeyboardNavigation=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,b,c,y,p,u){u=function(q){function k(d,f){var g=q.call(this,!0)||this;g._view=d;g.registerIncoming("mouse-wheel",f,e=>g._handleMouseWheel(e));return g}b._inherits(k,q);k.prototype._handleMouseWheel=function(d){if(this._view.navigation.mouseWheelZoomEnabled){var f=d.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new y.ZoomStepController({view:this._view,mode:"interaction"}):new p.ZoomStepController({view:this._view,mode:"interaction"}),
this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*f.deltaY,c.createScreenPointArray(f.x,f.y));d.preventDefault();d.stopPropagation()}};return b._createClass(k)}(u.InputHandler);a.MouseWheelZoom=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,y,p,u){p=function(q){function k(f,g,e){var h=q.call(this,!0)||this;h._view=f;h.pointerAction=g;h._lastEndTimestamp=0;h._lastTimestamp=0;h.registerIncoming("drag",e,z=>h._handleDrag(z));return h}b._inherits(k,q);var d=k.prototype;d._handleDrag=function(f){if("mouse"!==f.data.pointerType||u.eventMatchesMousePointerAction(f.data,this.pointerAction)){var g=f.timestamp-this._lastEndTimestamp;g=this._momentum&&this._momentum.active&&40>g;switch(f.data.action){case "start":case "update":if(g)break;
this._controller&&this._controller.active?2<f.data.timestamp-this._lastTimestamp&&(this._controller.update(f.data),this._lastTimestamp=f.timestamp):this._startController(f);break;case "end":case "removed":this._endController(f,!0);break;case "added":this._endController(f,!1),this._startController(f)}f.stopPropagation()}};d._endController=function(f,g){this._controller&&this._controller.active&&(this._lastEndTimestamp=f.timestamp,f=this._controller.end(f.data),g&&f&&(this._momentum=f,this._view.state.switchCameraController(this._momentum)));
this._controller=null};d._startController=function(f){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(f.data);this._lastTimestamp=f.timestamp};d._createController=function(){return this._view.state.isGlobal?new c.PinchAndPanController({view:this._view}):new y.PinchAndPanController({view:this._view})};return b._createClass(k)}(p.InputHandler);a.PinchAndPanNavigation=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J){a.PinchAndPanController=function(N){function R(){var T=N.apply(this,arguments)||this;T._smoothRotation=new v.ExponentialFalloff(.05);T._rotationAxis=n.create();T._beginAngle=0;T._beginHeading=0;T._panningPlane=t.create();T._beginRadius=0;T._smoothScaling=new v.ExponentialFalloff(.05);T._zoomCenterScreen=u.createScreenPointArray();T._zoomMomentumEstimator=new J.ZoomMomentumEstimator;T._rotationMomentumEstimator=new H.RotationMomentumEstimator;
T._panSphericalMomentumEstimator=new I.PanSphericalMomentumEstimator;T._panPlanarMomentumEstimator=new O.PanPlanarMomentumEstimator;T._adjustedSphere=w.create();T._tmp3d=n.create();T._tmpScreenPointArray=u.createScreenPointArray();T._beginScreenPoint=u.createScreenPointArray();T._beginScenePoint=n.create();T._screenPickPoint=u.createScreenPointArray();T._scenePickPoint=n.create();T._mode=G.NavigationMode.Horizontal;T._sphere=w.create();T._pointerCount=0;T._tmpInteractionDirection=n.create();T._constraintOptions=
{selection:x.ConstraintTypes.ALL,interactionType:D.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new L.Camera,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};return T}b._inherits(R,N);var W=R.prototype;W.begin=function(T){if(this.active){var P=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=P;this._rotationMomentumEstimator.enabled=P;this._panPlanarMomentumEstimator.enabled=P;this._panSphericalMomentumEstimator.enabled=P;this._beginHeading=-y.cyclicalPI.normalize(p.deg2rad(this.view.camera.heading));
this._beginRadius=T.radius;this._pointerCount=T.pointers.size;this._beginAngle=T.angle;this._smoothRotation.reset();u.screenPointObjectToArray(T.center,this._screenPickPoint);h.copy(this._beginScreenPoint,this._screenPickPoint);P=l.getReferenceEllipsoid(this.view.spatialReference);var Q=G.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,P,G.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?G.contentIntersectorOptions:{});null!=Q.scenePickPoint&&
(this._scenePickPoint=Q.scenePickPoint,this._sphere=Q.sphere,z.copy(this._beginScenePoint,this._scenePickPoint),this._mode=G.decideNavigationMode(this.startCamera,this._screenPickPoint,P),this._mode===G.NavigationMode.Vertical&&this._preparePlanarPanMode(T,Q.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}};W.update=function(T){if(this.active){this.currentCamera.copyFrom(this.startCamera);var P=1<T.pointers.size;this._mode===G.NavigationMode.Horizontal?
(P&&this._zoomSpherical(T),this._panningSpherical(T),P&&this._rotateSpherical(T)):(P&&this._zoomPlanar(T),this._panningPlanar(T),P&&this._rotatePlanar(T));this.commitCamera()}};W.end=function(T){T.pointers.size===this._pointerCount&&this.update(T);this.finishController();if(T=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===G.NavigationMode.Horizontal?new K.ZoomSphericalMomentumController({view:this.view,momentum:T,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,
radius:this._sphere[3]}):new M.ZoomPlanarMomentumController({view:this.view,momentum:T,zoomCenter:this._beginScenePoint});if(T=this._rotationMomentumEstimator.evaluateMomentum())return new F.RotationMomentumController({view:this.view,momentum:T,center:this._sphere,axis:this._rotationAxis});if(this._mode===G.NavigationMode.Horizontal){if(T=this._panSphericalMomentumEstimator.evaluateMomentum())return new E.PanSphericalMomentumController({view:this.view,momentum:T})}else if(T=this._panPlanarMomentumEstimator.evaluateMomentum())return new C.PanPlanarMomentumController({view:this.view,
momentum:T});return null};W._preparePlanarPanMode=function(T,P){var Q=z.negate(this._tmp3d,this.startCamera.viewForward);t.fromPositionAndNormal(this._scenePickPoint,Q,this._panningPlane);var S=u.createScreenPointArray(this._screenPickPoint[0],0);Q=n.create();var U=z.length(this.startCamera.eye);this._adjustedSphere[3]=U<this._sphere[3]?U-100:this._sphere[3];G.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,this.startCamera,S,Q);S=u.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(Q,
S);Q=n.create();S=n.create();U=n.create();z.subtract(Q,this._scenePickPoint,this.currentCamera.eye);const V=z.length(Q);z.normalize(Q,Q);var X=G.PAN_DISTANCE_MODIFIER*Math.max(Math.abs(this.view.camera.position.z),G.MIN_HEIGHT_LIMIT);const Y=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,G.SCREEN_PIXEL_AREA);X=null!=Y?Y:X;X=P?Math.min(X,V):X;z.copy(U,z.add(S,this.currentCamera.eye,z.scale(S,Q,X)));this._panningPlane[3]=
-z.dot(t.normal(this._panningPlane),U);this.startCamera.center=z.add(S,this.startCamera.eye,z.scale(S,this.startCamera.viewForward,X));T=u.screenPointObjectToArray(T.center,this._tmpScreenPointArray);G.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,T,this._beginScenePoint)};W._zoomSpherical=function(T){const P=this._beginRadius/T.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(T.radius,40),120);this._smoothScaling.update(P);G.applyZoomOnSphere(this._sphere,this.currentCamera,
this._smoothScaling.value);u.screenPointObjectToArray(T.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*T.timestamp);this._constraintOptions.interactionType=D.InteractionType.ZOOM;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(T.radius-this._beginRadius);r.applyAll(this.view,this.currentCamera,this._constraintOptions)};W._panningSpherical=function(T){const P=u.screenPointObjectToArray(T.center,this._tmpScreenPointArray);G.sphereOrPlanePointFromScreenPoint(this._sphere,
this.currentCamera,P,this._tmp3d);G.preserveHeadingThreshold(this._beginScenePoint,z.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(G.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(P,this._tmp3d,.001*T.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):
(G.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(P,this._tmp3d,.001*T.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=D.InteractionType.PAN;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(h.distance(this._screenPickPoint,P));r.applyAll(this.view,this.currentCamera,this._constraintOptions)};
W._rotateSpherical=function(T){z.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||z.negate(this._rotationAxis,this._rotationAxis);var P=this._smoothRotation.value,Q=G.normalizeRotationDelta(T.angle-P);P+=Q;this._smoothRotation.gain=.00125*Math.min(Math.max(T.radius,40),120);this._smoothRotation.update(P);Q=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(Q,.001*T.timestamp);G.applyRotation(this.currentCamera,this._sphere,m.wrapAxisAngle(this._rotationAxis,
Q));this._constraintOptions.interactionType=D.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(T.radius*P);r.applyAll(this.view,this.currentCamera,this._constraintOptions)};W._panningPlanar=function(T){const P=u.screenPointObjectToArray(T.center,this._tmpScreenPointArray);G.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,P,this._tmp3d)&&(G.applyPanPlanar(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(P,
this._tmp3d,.001*T.timestamp),this._constraintOptions.interactionType=D.InteractionType.PAN,this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(h.distance(this._beginScreenPoint,P)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),r.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)};W._zoomPlanar=function(T){const P=
this._beginRadius/T.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(T.radius,40),120);this._smoothScaling.update(P);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*T.timestamp);G.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=D.InteractionType.ZOOM;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(T.radius-this._beginRadius);
r.applyAll(this.view,this.currentCamera,this._constraintOptions)};W._rotatePlanar=function(T){z.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||z.negate(this._rotationAxis,this._rotationAxis);var P=this._smoothRotation.value;let Q=T.angle-P;Q=G.normalizeRotationDelta(Q);this._smoothRotation.gain=.00125*Math.min(Math.max(T.radius,40),120);this._smoothRotation.update(P+Q);P=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(P,.001*T.timestamp);
G.applyRotation(this.currentCamera,this._sphere,m.wrapAxisAngle(this._rotationAxis,P));this._constraintOptions.interactionType=D.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(T.radius*P);r.applyAll(this.view,this.currentCamera,this._constraintOptions)};b._createClass(R,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return R}(B.InteractiveController);a.PinchAndPanController=c.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._gain=u}var p=y.prototype;p.reset=function(u){this._value=u};p.update=function(u){this._value=void 0===this._value?u:this._gain*u+(1-this._gain)*this._value};b._createClass(y,[{key:"gain",set:function(u){this._gain=u}},{key:"value",get:function(){return void 0===
this._value?0:this._value}}]);return y}();a.ExponentialFalloff=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.PanPlanarMomentumController=function(z){function n(l){l=z.call(this,l)||this;l.interactionType=g.InteractionType.PAN;l._tmpPan=f.create();return l}b._inherits(n,z);n.prototype.momentumStep=function(l,m){l=this.momentum.value(l);d.scale(this._tmpPan,this.momentum.direction,l);m.eye=d.subtract(h,m.eye,this._tmpPan);m.center=d.subtract(h,m.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan};return b._createClass(n)}(e.MomentumController);
c.__decorate([y.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const h=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){a.MomentumController=function(m){function t(){var r=m.apply(this,arguments)||this;r._beginCamera=new l.Camera;r._elapsedTimeSec=0;r.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:h.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new l.Camera,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};return r}b._inherits(t,m);var w=t.prototype;w.initialize=function(){this.constraintOptions.interactionType=this.interactionType;
this.viewAnimation=new f};w.onControllerStart=function(r){this._beginCamera.copyFrom(r);this.constraintOptions.interactionStartCamera=this._beginCamera;b._get(b._getPrototypeOf(t.prototype),"onControllerStart",this).call(this,r)};w.stepController=function(r,x){x.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=r;this.momentumStep(this._elapsedTimeSec,x);g.applyAll(this.view,x,this.constraintOptions)};b._createClass(t,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this._elapsedTimeSec)}}]);
return t}(n.AnimationController);a.MomentumController=c.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){const z=f.create(),n=f.create();a.PanSphericalMomentumController=function(l){function m(t){t=l.call(this,t)||this;t.interactionType=g.InteractionType.PAN;return t}b._inherits(m,l);m.prototype.momentumStep=function(t,w){const r=this.momentum.value1(t);t=this.momentum.value2(t);d.copy(n,w.eye);d.normalize(n,n);d.cross(this.momentum.axis2,n,this.momentum.axis1);h.applyRotationWithTwoAxes(w,z,this.momentum.axis1,r,this.momentum.axis2,t)};return b._createClass(m)}(e.MomentumController);
c.__decorate([y.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.RotationMomentumController=function(z){function n(l){l=z.call(this,l)||this;l.interactionType=g.InteractionType.TUMBLE;return l}b._inherits(n,z);n.prototype.momentumStep=function(l,m){l=this.momentum.value(l);h.applyRotation(m,this.center,f.wrapAxisAngle(this.axis,l))};b._createClass(n,[{key:"center",set:function(l){this._set("center",d.clone(l))}},{key:"axis",set:function(l){this._set("axis",d.clone(l))}}]);return n}(e.MomentumController);c.__decorate([y.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([y.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([y.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.ZoomPlanarMomentumController=function(z){function n(l){l=z.call(this,l)||this;l.interactionType=g.InteractionType.ZOOM;l.constraintOptions.interactionDirection=f.create();return l}b._inherits(n,z);n.prototype.momentumStep=function(l,m){const {interactionDirection:t}=this.constraintOptions;t&&(d.copy(t,m.eye),l=this.momentum.valueDelta(0,l),h.applyZoomToPoint(m,this.zoomCenter,l,this.view.state.constraints.minimumPoiDistance),d.direction(t,m.eye,t))};b._createClass(n,
[{key:"zoomCenter",set:function(l){this._set("zoomCenter",f.clone(l))}}]);return n}(e.MomentumController);c.__decorate([y.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([y.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){a.ZoomSphericalMomentumController=function(m){function t(r){r=m.call(this,r)||this;r.interactionType=z.InteractionType.ZOOM;r.radius=0;r._tmpSceneCenter=f.create();r._tmpZoomAxisAngle=g.create();r._sphere=e.create();return r}b._inherits(t,m);var w=t.prototype;w.initialize=function(){this._sphere[3]=this.radius};w.momentumStep=function(r,x){r=this.momentum.valueDelta(0,r);l.applyZoomOnSphere(this._sphere,x,r);this.constraintOptions.interactionType=z.InteractionType.ZOOM;
h.applyAll(this.view,x,this.constraintOptions);l.sphereOrPlanePointFromScreenPoint(this._sphere,x,this.screenCenter,this._tmpSceneCenter);g.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);l.applyRotation(x,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=z.InteractionType.PAN};b._createClass(t,[{key:"screenCenter",set:function(r){this._set("screenCenter",y.createScreenPointArray(r[0],r[1]))}},{key:"sceneCenter",set:function(r){this._set("sceneCenter",
f.clone(r))}}]);return t}(n.MomentumController);c.__decorate([p.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([p.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([p.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([p.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,y,p,u){let q=function(k){function d(f,g,e,h,z){f=k.call(this,f,g,e)||this;f._sceneVelocity=
h;f.direction=z;return f}b._inherits(d,k);d.prototype.value=function(f){return b._get(b._getPrototypeOf(d.prototype),"valueFromInitialVelocity",this).call(this,this._sceneVelocity,f)};return b._createClass(d)}(u.Momentum);u=function(){function k(f=300,g=12,e=.84){this._minimumInitialVelocity=f;this._stopVelocity=g;this._friction=e;this.enabled=!0;this._time=new p.FilteredFiniteDifference(.6);this._screen=[new p.FilteredFiniteDifference(.4),new p.FilteredFiniteDifference(.4)];this._scene=[new p.FilteredFiniteDifference(.6),
new p.FilteredFiniteDifference(.6),new p.FilteredFiniteDifference(.6)];this._tmpDirection=y.create()}var d=k.prototype;d.add=function(f,g,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(f[0]),this._screen[1].update(f[1]),this._scene[0].update(g[0]),this._scene[1].update(g[1]),this._scene[2].update(g[2]),this._time.update(e))};d.reset=function(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();
this._time.reset()};d.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var f=this._screen[0].filteredDelta,g=this._screen[1].filteredDelta;f=null==f||null==g?0:Math.sqrt(f*f+g*g);g=this._time.filteredDelta;f=null==g||null==f?0:f/g;return Math.abs(f)<this._minimumInitialVelocity?null:this.createMomentum(f,this._stopVelocity,this._friction)};d.createMomentum=function(f,g,e){c.set(this._tmpDirection,this._scene[0].filteredDelta??
0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const h=c.length(this._tmpDirection);0<h&&c.scale(this._tmpDirection,this._tmpDirection,1/h);const z=this._time.filteredDelta;return new q(f,g,e,null==z?0:h/z,this._tmpDirection)};return b._createClass(k)}();a.PanPlanarMomentum=q;a.PanPlanarMomentumEstimator=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function y(u){this._gain=u;this.filteredDelta=this.lastValue=void 0}var p=y.prototype;p.update=function(u){if(this.hasLastValue()){const q=this.computeDelta(u);this._updateDelta(q)}this.lastValue=u};p.reset=function(){this.filteredDelta=this.lastValue=void 0};p.hasLastValue=function(){return void 0!==this.lastValue};p.hasFilteredDelta=function(){return void 0!==this.filteredDelta};p.computeDelta=function(u){return void 0===this.lastValue?NaN:u-this.lastValue};p._updateDelta=
function(u){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*u:u};return b._createClass(y)}();a.FilteredFiniteDifference=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u,q,k){this._initialVelocity=u;this._stopVelocity=q;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}var p=y.prototype;p.isFinished=function(u){return u>this.duration};p.value=function(u){return this.valueFromInitialVelocity(this._initialVelocity,u)};p.valueDelta=function(u,q){const k=this.value(u);return this.value(u+q)-k};p.valueFromInitialVelocity=function(u,q){q=Math.min(q,this.duration);const k=1-this.friction;return u*(k**q-1)/Math.log(k)};b._createClass(y,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);
return y}();a.Momentum=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,b,c,y,p,u,q,k,d){let f=function(g){function e(z,n,l,m,t,w=0,r){z=g.call(this,z,n,l)||this;z._angularVelocity1=m;z.axis1=t;
z.angularVelocity2=w;z.axis2=r;return z}b._inherits(e,g);var h=e.prototype;h.value1=function(z){return b._get(b._getPrototypeOf(e.prototype),"valueFromInitialVelocity",this).call(this,this._angularVelocity1,z)};h.value2=function(z){return b._get(b._getPrototypeOf(e.prototype),"valueFromInitialVelocity",this).call(this,this.angularVelocity2,z)};return b._createClass(e)}(d.Momentum);d=function(){function g(h=300,z=12,n=.84){this._minimumInitialVelocity=h;this._stopVelocity=z;this._friction=n;this.enabled=
!0;this._tmpAxis1=p.create();this._tmpAxis2=p.create();this._tmpAngles=c.create();this._time=new q.FilteredFiniteDifference(.3);this._screen=[new q.FilteredFiniteDifference(.4),new q.FilteredFiniteDifference(.4)];this._angle1=new k.FilteredValue(.6);this._angle2=new k.FilteredValue(.6);this._axis1=p.create();this._axis2=p.create();this._lastScene=p.create()}var e=g.prototype;e.addMomentumDirectRotation=function(h,z,n,l,m,t){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(n))return;
l=u.rotationAngleAndAxisDirectRotation(this._lastScene,z,this._tmpAxis2,l,m,t);this._angle2.update(0);1E-5>y.squaredLength(this._tmpAxis2)?l=0:y.normalize(this._axis1,this._tmpAxis2);this._angle1.update(l);y.copy(this._lastScene,z)}this._screen[0].update(h[0]);this._screen[1].update(h[1]);this._time.update(n)}};e.addMomentumPreserveHeading=function(h,z,n,l,m,t,w){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(n))return;u.rotationAnglesAndAxesHeadingPreserving(this._lastScene,
z,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,l,m,t,w,!1);1E-5>y.squaredLength(this._tmpAxis2)?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),y.normalize(this._axis1,this._tmpAxis1),y.normalize(this._axis2,this._tmpAxis2));y.copy(this._lastScene,z)}this._screen[0].update(h[0]);this._screen[1].update(h[1]);this._time.update(n)}};e.reset=function(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();
this._angle2.reset();this._time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var h=this._screen[0].filteredDelta,z=this._screen[1].filteredDelta;h=null==h||null==z?null:Math.sqrt(h*h+z*z);z=this._time.filteredDelta;h=null==h||null==z?0:h/z;return Math.abs(h)<this._minimumInitialVelocity?null:this.createMomentum(h,this._stopVelocity,this._friction)};e.createMomentum=function(h,z,n){const l=this._time.filteredDelta,m=this._angle1.filteredValue,
t=this._angle2.filteredValue;return new f(h,z,n,null==l||null==m?0:m/l,this._axis1,null==l||null==t?0:t/l,this._axis2)};return b._createClass(g)}();a.PanSphericalMomentum=f;a.PanSphericalMomentumEstimator=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._gain=u}var p=y.prototype;p.update=function(u){this.filteredValue=void 0!==
this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*u:u};p.reset=function(){this.filteredValue=void 0};b._createClass(y,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return y}();a.FilteredValue=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(y){function p(u=3,q=.01,k=
.95,d=12){return y.call(this,u,q,k,d)||this}b._inherits(p,y);p.prototype.add=function(u,q){const k=this.value.lastValue;if(null!=k){for(u-=k;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;u=k+u}b._get(b._getPrototypeOf(p.prototype),"add",this).call(this,u,q)};return b._createClass(p)}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,y,p){let u=function(){function q(d=2.5,f=.01,g=.95,e=12){this._minimumInitialVelocity=d;this._stopVelocity=f;this._friction=g;this._maxVelocity=e;this.enabled=!0;this.value=new y.FilteredFiniteDifference(.8);this.time=new y.FilteredFiniteDifference(.3)}var k=q.prototype;k.add=function(d,f){if(this.enabled&&null!=f){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta()){const g=
this.value.computeDelta(d);0>this.value.filteredDelta*g&&this.value.reset()}}this.time.update(f);this.value.update(d)}};k.reset=function(){this.value.reset();this.time.reset()};k.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let d=this.value.filteredDelta/this.time.filteredDelta;d=c.clamp(d,-this._maxVelocity,this._maxVelocity);return Math.abs(d)<this._minimumInitialVelocity?null:this.createMomentum(d,this._stopVelocity,this._friction)};
k.createMomentum=function(d,f,g){return new p.Momentum(d,f,g)};return b._createClass(q)}();a.MomentumEstimator=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,b,c,y){let p=function(u){function q(d,f,g){return u.call(this,d,f,g)||this}b._inherits(q,u);var k=q.prototype;k.value=function(d){d=b._get(b._getPrototypeOf(q.prototype),
"value",this).call(this,d);return Math.exp(d)};k.valueDelta=function(d,f){const g=b._get(b._getPrototypeOf(q.prototype),"value",this).call(this,d);d=b._get(b._getPrototypeOf(q.prototype),"value",this).call(this,d+f);return Math.exp(d-g)};return b._createClass(q)}(c.Momentum);c=function(u){function q(d=2.5,f=.01,g=.95,e=12){return u.call(this,d,f,g,e)||this}b._inherits(q,u);var k=q.prototype;k.add=function(d,f){b._get(b._getPrototypeOf(q.prototype),"add",this).call(this,Math.log(d),f)};k.createMomentum=
function(d,f,g){return new p(d,f,g)};return b._createClass(q)}(y.MomentumEstimator);a.ZoomMomentum=p;a.ZoomMomentumEstimator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){const G=z.fromValues(0,0,1);var L=16/180*Math.PI;a.PinchAndPanController=function(O){function I(){var J=O.apply(this,arguments)||this;J._rotationValueSmooth=new x.ExponentialFalloff(.05);J._scalingValueSmooth=new x.ExponentialFalloff(.05);J._planeHorizontal=l.create();J._planeVertical=l.create();J._rotationMomentumEstimator=new M.RotationMomentumEstimator;J._panMomentumEstimator=new F.PanPlanarMomentumEstimator(300,12,.9);J._zoomMomentumEstimator=
new K.ZoomMomentumEstimator;J._beginRadius=0;J._beginCenter=z.create();J._beginAngle=0;J._tmpPoints=[];J._panMode=C.NavigationMode.Horizontal;J._beginCenterScreen=p.createScreenPointArray();J._tmpCentroid3d=z.create();J._tmpCentroid2d=p.createScreenPointArray();J._tmp2d=p.createScreenPointArray();J._pointerCount=0;J._constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:w.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new E.Camera,interactionDirection:null,tiltMode:r.TiltMode.TUMBLE};
return J}b._inherits(I,O);var H=I.prototype;H.begin=function(J){if(this.active){var N=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=N;this._rotationMomentumEstimator.enabled=N;this._panMomentumEstimator.enabled=N;this._beginRadius=J.radius;this._pointerCount=J.pointers.size;this._beginAngle=J.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();p.screenPointObjectToArray(J.center,this._beginCenterScreen);l.fromNormalAndOffset(G,0,this._planeHorizontal);
var R=z.create();N=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,R,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});var W=z.create();h.negate(W,this.startCamera.viewForward);var T=z.create();h.copy(T,G);var P=h.dot(W,T);this._panMode=y.asinClamped(0>P?-P:P)>=L?C.NavigationMode.Horizontal:C.NavigationMode.Vertical;var Q=Math.min(C.PAN_DISTANCE_MODIFIER,1/Math.abs(h.dot(T,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),
C.MIN_HEIGHT_LIMIT);l.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,R);this.startCamera.aboveGround||l.negate(this._planeHorizontal,this._planeHorizontal);var S=z.create(),U=z.create(),V=z.create();h.subtract(S,R,this.currentCamera.eye);var X=h.length(S);h.normalize(S,S);this._panMode===C.NavigationMode.Vertical?(h.scale(T,T,P),h.subtract(this._planeVertical,W,T),h.normalize(this._planeVertical,this._planeVertical),l.setOffsetFromPoint(this._planeVertical,this._planeVertical,R),R=
this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,C.SCREEN_PIXEL_AREA),Q=null!=R?R:Q,Q=N?Math.min(Q,X):Q,h.copy(V,h.add(U,this.currentCamera.eye,h.scale(U,S,Q))),this._planeVertical[3]=-h.dot(this._planeVertical,V),this._computePlanePoints(J.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(h.copy(V,h.add(U,this.currentCamera.eye,h.scale(U,S,N?X:Q))),this._planeHorizontal[3]=-h.dot(l.normal(this._planeHorizontal),
V),this._computePlanePoints(J.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints));C.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}};H.update=function(J){if(this.active){this.currentCamera.copyFrom(this.startCamera);var N=1<J.pointers.size,R=this._panMode===C.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,W=this._beginCenter;if(N){var T=this._beginRadius/J.radius;this._scalingValueSmooth.gain=
.001875*Math.min(Math.max(J.radius,40),120);this._scalingValueSmooth.update(T);C.applyZoomToPoint(this.currentCamera,W,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*J.timestamp);this._constraintOptions.interactionType=w.InteractionType.ZOOM;this._constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(Math.abs(J.radius-this._beginRadius));m.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(J.pointers,
R,this.currentCamera,this._tmpPoints);C.centroid(this._tmpPoints,this._tmpCentroid3d);p.screenPointObjectToArray(J.center,this._tmpCentroid2d);C.applyPanPlanar(this.currentCamera,W,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*J.timestamp);this._constraintOptions.interactionType=w.InteractionType.PAN;this._constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(e.distance(this._beginCenterScreen,this._tmpCentroid2d));m.applyAll(this.view,
this.currentCamera,this._constraintOptions);N&&(N=this._planeHorizontal,R=this._rotationValueSmooth.value,T=C.normalizeRotationDelta(J.angle-R),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(J.radius,40),120),this._rotationValueSmooth.update(R+T),R=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(R,.001*J.timestamp),C.applyRotation(this.currentCamera,W,n.wrapAxisAngle(N,R)),this._constraintOptions.interactionType=w.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=
m.pixelDistanceToInteractionFactor(Math.abs(J.radius*R)),m.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}};H.end=function(J){J.pointers.size===this._pointerCount&&this.update(J);this.finishController();return(J=this._zoomMomentumEstimator.evaluateMomentum())?new B.ZoomPlanarMomentumController({view:this.view,momentum:J,zoomCenter:this._beginCenter}):(J=this._rotationMomentumEstimator.evaluateMomentum())?new v.RotationMomentumController({view:this.view,momentum:J,
center:this._beginCenter,axis:l.normal(this._planeHorizontal)}):(J=this._panMomentumEstimator.evaluateMomentum())?new A.PanPlanarMomentumController({view:this.view,momentum:J}):null};H._computePlanePoints=function(J,N,R,W){W.length=J.size;const T=this._tmp2d;let P=0;J.forEach(Q=>{T[0]=Q.x;T[1]=Q.y;void 0===W[P]&&(W[P]=z.create());C.intersectPlaneFromScreenPointAtEye(N,R,T,W[P]);P+=1});return W};b._createClass(I,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return I}(D.InteractiveController);a.PinchAndPanController=c.__decorate([g.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(y){function p(u,q){var k=y.call(this,!0)||this;k.view=u;k.registerIncoming("pointer-down",
q,()=>k.view.state.stopActiveCameraController());return k}b._inherits(p,y);return b._createClass(p)}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(y){function p(u,q,k){q=y.call(this,q,k)||this;q.view=u;return q}b._inherits(p,y);p.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>
{})};return b._createClass(p)}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(y){function p(u,q){var k=y.call(this,!0)||this;k.key=u;k.registerIncoming("key-down",q,d=>k._handleKeyDown(d));return k}b._inherits(p,y);p.prototype._handleKeyDown=function(u){u.data.key===this.key&&
(this.activate(),u.stopPropagation())};return b._createClass(p)}(c.InputHandler);a.SingleKey=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(y){function p(u,q,k){q=y.call(this,q,k)||this;q.view=u;return q}b._inherits(p,y);p.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return b._createClass(p)}(c.SingleKey);
a.SingleKeyResetTilt=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,c,y,p){p=function(u){function q(k,d=!1){var f=u.call(this,!0)||this;f._view=k;f._invert=d;f.registerIncoming("vertical-two-finger-drag",g=>f._handleTwoFinger(g));return f}b._inherits(q,
u);q.prototype._handleTwoFinger=function(k){const d=c.createScreenPointArray(0,k.data.delta*(this._invert?-1:1));switch(k.data.action){case "begin":this._cameraController?.end();this._cameraController=new y.RotateController({view:this._view,pivot:y.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(d);break;case "update":this._cameraController?.update(d);break;case "end":this._cameraController?.end(),this._cameraController=null}};return b._createClass(q)}(p.InputHandler);
a.TwoFingerTilt=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,b,c,y,p,u,q){const k=c("edge"),d=c("chrome"),f=c("ff"),g=c("safari");c=function(){function h(n,l){this._input=l;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;
this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=n;n.getAttribute("tabindex")||n.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};
this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new u.GamepadSource(n,this._input);this._gamepadSource.onEvent=m=>this._callback("gamepad",m)}var z=h.prototype;z.destroy=function(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(n=>{this._releasePointerCaptureSafe(n)});this._gamepadSource=y.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",
this._preventAltKeyDefault)};z.setPointerCapture=function(n,l){l?this._setPointerCatpureSafe(n.pointerId):(this._releasePointerCaptureSafe(n.pointerId),this._activePointerCaptures.delete(n.pointerId))};z._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};z._updateTouchEventHandling=
function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._setPointerCatpureSafe=function(n){try{this._element.setPointerCapture(n),
this._activePointerCaptures.add(n)}catch{}};z._releasePointerCaptureSafe=function(n){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(n)||this._element.releasePointerCapture(n)}catch(l){}};z._updateNormalizedPointerLikeEvent=function(n,l){n=q.createScreenPointFromNativeEvent(this._element,n);h.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y));l.x=n.x;l.y=n.y;return l};z._handleKey=function(n,l){const m=p.eventKey(l);m&&"key-up"===n&&this._keyDownState.delete(m);
l={native:l,key:m,repeat:!!m&&this._keyDownState.has(m)};m&&"key-down"===n&&this._keyDownState.add(l.key);this._callback(n,l)};z._handlePointer=function(n,l){l=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,pointerType:l.pointerType,button:l.button,buttons:l.buttons,eventId:this._eventId++});this._callback(n,l)};z._handlePointerPreventDefault=function(n,l){const m=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,pointerType:l.pointerType,button:l.button,buttons:l.buttons,eventId:this._eventId++});
l.preventDefault();this._callback(n,m)};z._handleMouseWheel=function(n,l){let m=l.deltaY;switch(l.deltaMode){case 0:k&&(m=m/document.documentElement.clientHeight*600);break;case 1:m*=30;break;case 2:m*=900}k?m*=.7:d||g?m*=.6:f&&(m*=1.375);const t=Math.abs(m);100<t&&(m=m/t*200/(1+Math.exp(-.02*(t-100))));l=this._updateNormalizedPointerLikeEvent(l,{native:l,x:0,y:0,deltaY:m});this._callback(n,l)};z._handlePointerCaptureLost=function(n,l){this._activePointerCaptures.delete(l.pointerId);this._handleDefault(n,
l)};z._handleDefault=function(n,l){const m={native:l};l.preventDefault();this._callback(n,m)};z._preventAltKeyDefault=function(n){"Alt"===n.key&&n.preventDefault()};z._preventMultiTouchPanning=function(n){1<n.touches.length&&n.preventDefault()};b._createClass(h,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(n){this._browserTouchPanningEnabled=n;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(n){this._callback=
n}},{key:"activeEvents",set:function(n){for(const l in this._active)n&&n.has(l)||(this._element.removeEventListener(e[l],this._active[l]),delete this._active[l]);n&&n.forEach(l=>{if(!this._active[l]&&e[l]){const m=(this._eventHandlers[l]||this._handleDefault).bind(this,l);this._element.addEventListener(e[l],m);this._active[l]=m}});this._gamepadSource.hasEventListeners=n?.has("gamepad")??!1}}]);return h}();c.test={disableSubpixelCoordinates:!1};const e={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown",
"pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,y,p){let u=function(){function q(d,f){this._element=d;this._input=f;this._hasEventListeners=!1;this._onConnectGamepad=g=>{this._connectGamepad(g.gamepad)};this._onDisconnectGamepad=g=>{g=g.gamepad;const e=g.index,h=this._inputDevices[e];h&&(this._emitGamepadEvent(g,p.extractState(h),!1),this._inputDevices.splice(e,1),this._latestUpdate.splice(e,1),this._input.gamepad.devices.remove(h),this.ensurePollingState())};this._frameTask=
null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;d=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&d)this._forEachGamepad(g=>this._connectGamepad(g)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}var k=q.prototype;k.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),
window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};k._connectGamepad=function(d){const f=new y(d);"unknown"!==f.deviceType&&(this._inputDevices[d.index]=f,this._input.gamepad.devices.add(f));this.ensurePollingState()};k.ensurePollingState=function(){this._eventsEnabled?this._startPolling():this._stopPolling()};k._startPolling=function(){null==this._frameTask&&(this._frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};k._stopPolling=function(){null!=this._frameTask&&
(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=[])};k._readGamepadState=function(){const d=document.hasFocus(),f=this._element.contains(document.activeElement),g="document"===this._input.gamepad.enabledFocusMode&&!d||"view"===this._input.gamepad.enabledFocusMode&&!f;this._forEachGamepad(e=>{var h=this._inputDevices[e.index];if(h){var z=this._latestUpdate[e.index];h=p.extractState(h);var n=g||p.stateIdle(h);z&&(z.timestamp===e.timestamp||!z.active&&n||p.stateEqual(z.state,h))||this._emitGamepadEvent(e,
h,!n)}})};k._forEachGamepad=function(d){const f=window.navigator.getGamepads();for(let g=0;g<f.length;g++){const e=f[g];this._validate(e)&&d(e)}};k._emitGamepadEvent=function(d,f,g){var e=this._latestUpdate[d.index];if((e=e&&e.active)||g)this._latestUpdate[d.index]={timestamp:d.timestamp,state:f,active:g},this._callback&&this._callback({device:this._inputDevices[d.index],state:f,action:!e&&g?"start":e&&g?"update":"end"})};k._validate=function(d){if(!d||!d.connected)return!1;for(let f=0;f<d.axes.length;f++)if(isNaN(d.axes[f]))return!1;
return!0};b._createClass(q,[{key:"hasEventListeners",set:function(d){this._hasEventListeners!==d&&(this._hasEventListeners=d,this.ensurePollingState())}},{key:"_eventsEnabled",get:function(){return this.supported&&0<this._inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(d){this._callback=d}}]);return q}();a.GamepadSource=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=
function(b){const c=b.native;return c?{buttons:c.buttons.map(y=>y.pressed?y.value||1:0),axes:c.axes.map(y=>{{var p=b.axisThreshold;const u=Math.abs(y);y=u<p?0:Math.sign(y)*(u-p)/(1-p)}return y})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;for(var y=0;y<b.axes.length;y++)if(b.axes[y]!==c.axes[y])return!1;for(y=0;y<b.buttons.length;y++)if(b.buttons[y]!==c.buttons[y])return!1;return!0};a.stateIdle=function(b){for(var c=
0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,b,c){c=function(y){function p(){var u=y.call(this,!0)||this;u.registerIncoming("context-menu",q=>{q.data.native.preventDefault()});return u}b._inherits(p,y);return b._createClass(p)}(c.InputHandler);
a.PreventContextMenu=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,b,c,y,p,u){function q(g){const e=[];g.forEach(h=>{e.push(c.createScreenPoint(h.event.x,h.event.y))});return u.fitCircleLSQ(e)}function k(g){const e=q(g);let h=0;g.forEach(z=>{var n=f(z,e);for(n-=z.lastAngle;n>Math.PI;)n-=
2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;n=z.lastAngle+n;z.lastAngle=n;h+=n-z.initialAngle});h/=g.size||1;return{angle:h,radius:e.radius,center:e.center}}function d(g){const e=new Map;g.forEach((h,z)=>e.set(z,h.event));return e}function f(g,e){g=g.event;return Math.atan2(g.y-e.center.y,g.x-e.center.x)}p=function(g){function e(z){var n=g.call(this,!1)||this;n._navigationTouch=z;n._startStateModifiers=new Set;n._activePointerMap=new Map;n._isDragging=!1;n._isCurrentDragSuppressed=!1;n._drag=n.registerOutgoing("drag");
n.registerIncoming("pointer-drag",n._handlePointerDrag.bind(b._assertThisInitialized(n)));n.registerIncoming("pointer-up",n._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(n)));n.registerIncoming("pointer-capture-lost",n._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(n)));n.registerIncoming("pointer-cancel",n._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(n)));return n}b._inherits(e,g);var h=e.prototype;h._createPayload=function(z,n,l,m){return{action:z,pointerType:this._pointerType,
button:this._mouseButton,buttons:n.buttons,timestamp:m,pointers:d(this._activePointerMap),pointer:n,angle:l.angle,radius:l.radius,center:l.center}};h._addPointer=function(z){var n=z.native.pointerId;const l=k(this._activePointerMap).angle;z={event:z,initialAngle:0,lastAngle:0};this._activePointerMap.set(n,z);n=f(z,q(this._activePointerMap));z.initialAngle=n;z.lastAngle=n;this._updatePointerAngles(l)};h._updatePointer=function(z){if(!z||null!=z.x||null!=z.y){var n=this._activePointerMap.get(z.native.pointerId);
n?n.event=z:this._addPointer(z)}};h._removePointer=function(z){const n=k(this._activePointerMap).angle;this._activePointerMap.delete(z);this._updatePointerAngles(n)};h._updatePointerAngles=function(z){const n=k(this._activePointerMap);this._activePointerMap.forEach(l=>{l.initialAngle=f(l,n)-z;l.lastAngle=f(l,n)-z})};h._emitEvent=function(z,n,l){const m=k(this._activePointerMap);this._drag.emit(this._createPayload(z,n,m,l),void 0,this._startStateModifiers)};h._handlePointerUpAndPointerLost=function(z){const n=
z.data.native.pointerId,l=y.Milliseconds(z.timestamp);this._activePointerMap.get(n)&&(1===this._activePointerMap.size?(this._updatePointer(z.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",z.data,l),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(n)):(this._removePointer(n),this._emitEvent("removed",z.data,y.Milliseconds(z.timestamp))))};h._handlePointerDrag=function(z){const n=z.data,l=n.currentEvent,m=y.Milliseconds(z.timestamp);switch(n.action){case "start":case "update":this._isDragging?
this._activePointerMap.has(l.native.pointerId)?(this._updatePointer(l),!this._isCurrentDragSuppressed&&this._emitEvent("update",l,m)):(this._addPointer(l),this._emitEvent("added",l,m),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(l),this._pointerType=z.data.startEvent.pointerType,this._mouseButton=z.data.startEvent.button,this._startStateModifiers=z.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",
l,m))}};b._createClass(e,[{key:"_isSuppressed",get:function(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}]);return e}(p.InputHandler);a.Button=void 0;(function(g){g[g.Left=0]="Left";g[g.Middle=1]="Middle";g[g.Right=2]="Right";g[g.Back=3]="Back";g[g.Forward=4]="Forward";g[g.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports",
"../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,y){const p=y.x-c.x;c=y.y-c.y;return Math.sqrt(p*p+c*c)};a.fitCircleLSQ=function(c,y){y?(y.radius=0,y.center.x=0,y.center.y=0):y={radius:0,center:b.createScreenPoint()};if(0===c.length)return y;if(1===c.length)return y.center.x=c[0].x,y.center.y=c[0].y,y;if(2===c.length){const [l,m]=c,[t,w]=[m.x-l.x,m.y-l.y];y.radius=Math.sqrt(t*t+w*w)/2;y.center.x=(l.x+m.x)/2;y.center.y=(l.y+m.y)/2;return y}let p=0,u=0;for(y=0;y<c.length;y++)p+=
c[y].x,u+=c[y].y;p/=c.length;u/=c.length;var q=c.map(l=>l.x-p),k=c.map(l=>l.y-u);let d=y=0;var f=0,g=0,e=0,h=0,z=0;for(var n=0;n<q.length;n++){const l=q[n],m=k[n],t=l*l,w=m*m;y+=t;d+=w;f+=l*m;g+=t*l;e+=w*m;h+=l*w;z+=m*t}q=y;k=f;n=d;g=.5*(g+h);e=.5*(e+z);z=q*n-f*k;h=(g*n-e*k)/z;e=(q*e-f*g)/z;z=b.createScreenPoint(h+p,e+u);return{radius:Math.sqrt(h*h+e*e+(y+d)/c.length),center:z}};a.getPointerId=function(c){({native:c}=c);const {pointerId:y,button:p,pointerType:u}=c;return"mouse"===u?`${y}:${p}`:`${u}`};
a.manhattanDistance=function(c,y){return Math.abs(y.x-c.x)+Math.abs(y.y-c.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,b,c,y,p,u){y=function(q){function k(f=p.DefaultParameters.maximumDoubleClickDelay,g=p.DefaultParameters.maximumDoubleClickDistance,e=p.DefaultParameters.maximumDoubleTouchDelay,
h=p.DefaultParameters.maximumDoubleTouchDistance,z=c.clock){var n=q.call(this,!1)||this;n._maximumDoubleClickDelay=f;n._maximumDoubleClickDistance=g;n._maximumDoubleTouchDelay=e;n._maximumDoubleTouchDistance=h;n._clock=z;n._pointerState=new Map;n._immediateDoubleClick=n.registerOutgoing("immediate-double-click");n.registerIncoming("pointer-down",n._handlePointerDown.bind(b._assertThisInitialized(n)));n.registerIncoming("pointer-up",n._handlePointerUp.bind(b._assertThisInitialized(n)));return n}b._inherits(k,
q);var d=k.prototype;d.onUninstall=function(){this._pointerState.forEach(f=>{f.immediateDoubleClick&&f.immediateDoubleClick.timeoutHandle.remove()});b._get(b._getPrototypeOf(k.prototype),"onUninstall",this).call(this)};d._handlePointerDown=function(f){f=f.data;const g=u.getPointerId(f);this._pointerState.has(g)||(this._pointerState.set(g,{downButton:f.native.button,immediateDoubleClick:null}),this.startCapturingPointer(f.native))};d._handlePointerUp=function(f){const g=f.data;var e=u.getPointerId(g);
if((e=this._pointerState.get(e))&&e.downButton===g.native.button){const h=e.immediateDoubleClick;if(h){h.timeoutHandle.remove();const z="touch"===f.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;u.manhattanDistance(h,f.data)>z?this._startImmediateDoubleClick(f,e):(this._immediateDoubleClick.emit(f.data,void 0,h.modifiers),this._removeState(g))}else this._startImmediateDoubleClick(f,e)}};d._startImmediateDoubleClick=function(f,g){g.immediateDoubleClick={x:f.data.x,
y:f.data.y,modifiers:f.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(f.data),"touch"===f.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}};d._removeState=function(f){const g=u.getPointerId(f);this._pointerState.delete(g);this.stopCapturingPointer(f.native);this.refreshHasPendingInputs()};return b._createClass(k)}(y.InputHandler);a.ImmediateDoubleClick=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,c,y,p,u,q){const k={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};u=function(d){function f(e=k.maximumDoubleClickDelay,h=k.maximumDoubleClickDistance,z=k.maximumDoubleTouchDelay,n=k.maximumDoubleTouchDistance,l=c.clock){var m=d.call(this,!1)||this;m._maximumDoubleClickDelay=e;m._maximumDoubleClickDistance=h;m._maximumDoubleTouchDelay=z;m._maximumDoubleTouchDistance=n;m._clock=l;m._pointerState=new Map;m._click=m.registerOutgoing("click");
m._doubleClick=m.registerOutgoing("double-click");m.registerIncoming("immediate-click",m._handleImmediateClick.bind(b._assertThisInitialized(m)));m.registerIncoming("pointer-down",m._handlePointerDown.bind(b._assertThisInitialized(m)));return m}b._inherits(f,d);var g=f.prototype;g.onUninstall=function(){this._pointerState.forEach(e=>e.doubleClickTimer=p.removeMaybe(e.doubleClickTimer))};g._clearDoubleClickTimer=function(e,h){const z=this._pointerState.get(e);z&&(z.doubleClickTimer=p.removeMaybe(z.doubleClickTimer),
h&&this._click.emit(z.event.data,void 0,z.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())};g._doubleClickTimeoutExceeded=function(e){const h=this._pointerState.get(e);1===h.pointerDownCount&&this._click.emit(h.event.data,void 0,h.event.modifiers);h.doubleClickTimer=null;this._pointerState.delete(e);this.refreshHasPendingInputs()};g._getPointerId=function(e){const {pointerId:h,pointerType:z,button:n}=e.native;return"mouse"===z?`${h}:${n}`:`${z}`};g._handleImmediateClick=
function(e){const h=e.data;var {pointerType:z}=h.native;const n=this._getPointerId(h);if(this._pointerState.has(n)){var l=this._pointerState.get(n),{data:m,modifiers:t}=l.event;z="touch"===z?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;q.manhattanDistance(m,h)>z?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),2===l.pointerDownCount&&this._doubleClick.emit(m,void 0,t))}else this._startClick(e)};g._handlePointerDown=function(e){e=q.getPointerId(e.data);
if(e=this._pointerState.get(e))e.pointerDownCount+=1};g._startClick=function(e){var {data:h}=e;const {native:{pointerType:z}}=h,n=q.getPointerId(h);h=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),"touch"===z?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(n,{event:e,doubleClickTimer:h,pointerDownCount:1});this.refreshHasPendingInputs()};b._createClass(f,[{key:"hasPendingInputs",get:function(){return y.someMap(this._pointerState,e=>null!=e.doubleClickTimer)}}]);
return f}(u.InputHandler);a.DefaultParameters=k;a.SingleAndDoubleClick=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,y,p,u){const q={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};p=function(k){function d(g=
q.maximumClickDelay,e=q.movementUntilMouseDrag,h=q.movementUntilPenDrag,z=q.movementUntilTouchDrag,n=q.holdDelay,l=c.clock){var m=k.call(this,!1)||this;m._maximumClickDelay=g;m._movementUntilMouseDrag=e;m._movementUntilPenDrag=h;m._movementUntilTouchDrag=z;m._holdDelay=n;m._clock=l;m._pointerState=new Map;m._pointerDrag=m.registerOutgoing("pointer-drag");m._immediateClick=m.registerOutgoing("immediate-click");m._pointerHold=m.registerOutgoing("hold");m.registerIncoming("pointer-down",m._handlePointerDown.bind(b._assertThisInitialized(m)));
m.registerIncoming("pointer-up",t=>{m._handlePointerLoss(t,"pointer-up")});m.registerIncoming("pointer-capture-lost",t=>{m._handlePointerLoss(t,"pointer-capture-lost")});m.registerIncoming("pointer-cancel",t=>{m._handlePointerLoss(t,"pointer-cancel")});m._moveHandle=m.registerIncoming("pointer-move",m._handlePointerMove.bind(b._assertThisInitialized(m)));m._moveHandle.pause();return m}b._inherits(d,k);var f=d.prototype;f.onUninstall=function(){this._pointerState.forEach(g=>{g.holdTimeout=y.removeMaybe(g.holdTimeout)});
b._get(b._getPrototypeOf(d.prototype),"onUninstall",this).call(this)};f._handlePointerDown=function(g){const e=g.data,h=e.native.pointerId;var z=null;0===this._pointerState.size&&(z=this._clock.setTimeout(()=>{const n=this._pointerState.get(h);n&&(n.isDragging||(this._pointerHold.emit(n.previousEvent,void 0,g.modifiers),n.holdEmitted=!0),n.holdTimeout=null)},this._holdDelay));z={startEvent:e,previousEvent:e,startTimestamp:g.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:z,modifiers:new Set};
this._pointerState.set(h,z);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(g)};f._createPointerDragData=function(g,e,h){return{action:g,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:h}};f._handlePointerMove=function(g){const e=g.data,h=this._pointerState.get(e.native.pointerId);if(h){if(h.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",h,e),void 0,h.modifiers);else{const z=u.euclideanDistance(e,
h.startEvent),n=this._getDragThreshold(e.native.pointerType);z>n&&this._startDragging(g)}h.previousEvent=e}};f._getDragThreshold=function(g){switch(g){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}};f._startDragging=function(g){const e=g.data,h=e.native.pointerId;this._pointerState.forEach(z=>{null!=z.holdTimeout&&(z.holdTimeout.remove(),z.holdTimeout=null);z.isDragging||(z.modifiers=g.modifiers,z.isDragging=
!0,h===z.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",z,e)):this._pointerDrag.emit(this._createPointerDragData("start",z,z.previousEvent),g.timestamp))})};f._handlePointerLoss=function(g,e){const h=g.data,z=h.native.pointerId,n=this._pointerState.get(z);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,"pointer-up"===e?h:n.previousEvent),void 0,n.modifiers):"pointer-up"===
e&&n.downButton===h.native.button&&g.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(h),this._pointerState.delete(z),this.stopCapturingPointer(h.native),0===this._pointerState.size&&this._moveHandle.pause())};return b._createClass(d)}(p.InputHandler);a.DefaultParameters=q;a.PointerClickHoldAndDrag=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../DragEventSeparator","../InputHandler"],function(a,b,c,y){y=function(p){function u(k=20,d=40){var f=p.call(this,!1)||this;f._threshold=k;f._maxDelta=d;f._state="ready";f._emittedArtificalEnd2=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f._dragEventSeparator=new c.DragEventSeparator({start:(g,e)=>f._observeStart(g,e),update:(g,e,h)=>f._observeUpdate(g,e,h),end:(g,e)=>f._observeEnd(e)});f.registerIncoming("drag",g=>f._dragEventSeparator.handle(g));
return f}b._inherits(u,p);var q=u.prototype;q._observeStart=function(k,d){1===k&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:d.data.button,buttons:d.data.buttons,pointerType:d.data.pointerType,timestamp:d.data.timestamp,pointers:d.data.pointers,pointer:d.data.pointer,angle:d.data.angle,radius:d.data.radius,center:d.data.center}),d.stopPropagation());this._state=2===k?"ready":"failed"};q._observeUpdate=function(k,d,f){"failed"!==this._state&&
2===k&&("active"===this._state?(this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"update"}),d.stopPropagation()):this._checkMovementWithinLimits(d.data,f.data)?this._checkVerticalThresholdReached(d.data,f.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=d.data.center,this._artificalDrag.emit({action:"end",button:d.data.button,buttons:d.data.buttons,pointerType:d.data.pointerType,timestamp:d.data.timestamp,pointers:d.data.pointers,
pointer:d.data.pointer,angle:d.data.angle,radius:d.data.radius,center:d.data.center}),this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),d.stopPropagation()):this._state="failed")};q._observeEnd=function(k){"active"===this._state&&(this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",k.stopPropagation())};q._checkMovementWithinLimits=function(k,d){let f=-Infinity,g=Infinity,e=-Infinity,h=Infinity;for(const {x:t,
y:w}of d.pointers.values())f=Math.max(f,t),g=Math.min(g,t),e=Math.max(e,w),h=Math.min(h,w);let z=-Infinity,n=Infinity,l=-Infinity,m=Infinity;for(const {x:t,y:w}of k.pointers.values())z=Math.max(z,t),n=Math.min(n,t),l=Math.max(l,w),m=Math.min(m,w);return Math.abs(k.center.x-d.center.x)<this._threshold&&Math.abs(z-n-(f-g))<=this._maxDelta&&Math.abs(l-m-(e-h))<=this._maxDelta};q._checkVerticalThresholdReached=function(k,d){let f=Math.abs(k.center.y-d.center.y);k.pointers.forEach((g,e)=>{e=d.pointers.get(e);
f=Math.min(f,Math.abs(g.y-e.y))});return f>=this._threshold};b._createClass(u,[{key:"failed",get:function(){return"failed"===this._state}}]);return u}(y.InputHandler);a.VerticalTwoFingerDrag=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._callbacks=u;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=
()=>!0)}var p=y.prototype;p.handle=function(u){const q=u.data,k=q.pointers.size;switch(q.action){case "start":this._currentCount=k;this._emitStart(u);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(u);break;case "update":this._emitUpdate(u);break;case "removed":this._startEvent&&this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(u);break;case "end":this._emitEnd(u),this._currentCount=0}this._previousEvent=u};p._emitStart=function(u){this._startEvent=
u;this._callbacks.condition?.(this._currentCount,u)&&this._callbacks.start(this._currentCount,u,this._startEvent)};p._emitUpdate=function(u){this._callbacks.condition?.(this._currentCount,u)&&this._callbacks.update(this._currentCount,u,this._startEvent)};p._emitEnd=function(u){this._callbacks.condition?.(this._currentCount,u)&&this._callbacks.end(this._currentCount,u,this._startEvent);this._startEvent=null};return b._createClass(y)}();a.DragEventSeparator=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){function t(r){r=r.layer;return!(!r||!r.featureReduction||"selection"!==r.featureReduction.type)}function w(r){(r=r.graphics3DGraphics)&&r.forEach(x=>x.setVisibilityFlag(n.VisibilityGroup.GRAPHIC,n.VisibilityFlag.DECONFLICTION,!0))}a.GraphicsDeconflictor=function(r){function x(){var A=r.apply(this,arguments)||this;A._handles=new y;A._contexts=new Map;A._viewState=new z.DeconflictorViewState;A.visibilityGroup=n.VisibilityGroup.GRAPHIC;A._iconMarginFactor=
-.1;return A}b._inherits(x,r);var D=x.prototype;D.initialize=function(){this._handles.add([u.watch(()=>this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),u.watch(()=>this.view?.map?.ground?.opacity,(A,v)=>{1!==A&&1!==v||this.setDirty()}),u.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},u.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(m.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new l.LabelDeconflictor({view:this.view,
parent:this})};D.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};D.setDirty=function(){0<this._contexts.size&&(b._get(b._getPrototypeOf(x.prototype),"setDirty",this).call(this),this._labels.setDirty())};D.runTask=function(A){b._get(b._getPrototypeOf(x.prototype),"runTask",this).call(this,A);this.running||this._labels.setDirty()};D.setInitialIconVisibilityFlag=function(A,v){A=!(this._graphicSupportsDeconfliction(v)&&
t(A));v.setVisibilityFlag(n.VisibilityGroup.GRAPHIC,n.VisibilityFlag.DECONFLICTION,A)};D._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};D._updateSlicePlane=function(){const A=this.view?this.view.slicePlane:null;null!=A&&h.transform(A,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=A};D._slicePlaneChanged=function(){p.someMap(this._contexts,(A,v)=>v.symbolCreationContext.slicePlaneEnabled)&&
this.setDirty()};D.addGraphicsOwner=function(A){const v=this._getGraphicsContext(A);return{addGraphic:B=>this._addGraphic(A,v,B),removeGraphic:B=>this._removeGraphic(v,B),labelingInfoChange:()=>this._labels.enabledChanged(A,v),featureReductionChange:()=>this.enabledChanged(A,v),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(A,v),clear:()=>v.forEach(B=>this._removeGraphic(v,B.graphics3DGraphic))}};D.removeGraphicsOwner=function(A){const v=this._contexts.get(A);v&&(v.forEach(B=>this._removeGraphic(v,
B.graphics3DGraphic)),this._contexts.delete(A),this.setDirty())};D._addGraphic=function(A,v,B){const C=B.graphic.uid;B=new z.DeconflictorGraphic(B,A.symbolCreationContext.slicePlaneEnabled);v.set(C,B);t(A)&&this.addToActiveGraphics(B);A.labelsEnabled&&this._labels.addToActiveGraphics(B)};D._removeGraphic=function(A,v){v=v.graphic.uid;const B=A.get(v);B&&(this.removeFromActiveGraphics(B),this._labels.removeFromActiveGraphics(B),A.delete(v),this.setDirty())};D.enabledChanged=function(A,v){const B=t(A);
B||w(A);this.modifyGraphics(v,B)};D._slicePlaneEnabledChanged=function(A,v){const B=A.symbolCreationContext.slicePlaneEnabled;v.forEach(C=>C.slicePlaneEnabled=B);this.setDirty()};D.getGraphicsLayers=function(A){return A.layers};D._graphicSupportsDeconfliction=function(A){if(A.isDraped)return!1;A=A.layers;if(!A||!A.length)return!1;for(const v of A)if(this.layerSupportsDeconfliction(v))return!0;return!1};D._getGraphicsContext=function(A){var v=this._contexts.get(A);if(v)return v;v=new Map;this._contexts.set(A,
v);this.setDirty();return v};b._createClass(x,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(A){this._iconMarginFactor=A;this.setDirty()}}]);return x}(z.Deconflictor);a.GraphicsDeconflictor=c.__decorate([e.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){function*G(Z){if(Map.prototype.entries){Z=Z.entries();for(let ea=Z.next();!ea.done;ea=Z.next())yield ea.value[1]}else yield*Z.values()}function*L(Z,ea,ja){ea.clear();Z.forEach((ia,oa)=>{const ma=ea.pushNew();ma.id=oa;ma.visible=ia.graphics3DGraphic.getVisibilityFlag(ja,B.VisibilityFlag.DECONFLICTION);oa=ia.info&&ia.info[ja];ma.prio=ia.graphics3DGraphic.deconflictionPriority;ma.distance=oa?oa.distance:Number.MAX_VALUE});yield;const ha=
ea.iterableSort((ia,oa)=>ia.prio!==oa.prio?oa.prio-ia.prio:ia.distance!==oa.distance?ia.distance-oa.distance:ia.visible!==oa.visible?ia.visible?-1:1:ia.id-oa.id);for(let ia=ha.next();!ia.done;ia=ha.next())yield;ea.forAll(ia=>{const oa=Z.get(ia.id);oa&&(Z.delete(ia.id),Z.set(ia.id,oa))});ea.clear()}const O=l.create(),I=t.create(),H=t.create(),J=l.create(),N=h.create(),R=A.create(),W=D.create(),T=l.create(),P=r.create();let Q=b._createClass(function(){this.aabr=r.create();this.distance=0;this.visible=
this.culled=!1});k=b._createClass(function(Z,ea){this.graphics3DGraphic=Z;this.slicePlaneEnabled=ea;this.info={}});a.State=void 0;(function(Z){Z[Z.Idle=0]="Idle";Z[Z.Process=1]="Process";Z[Z.Sort=2]="Sort";Z[Z.Deconflict=3]="Deconflict";Z[Z.NumStates=4]="NumStates"})(a.State||(a.State={}));let S=function(){function Z(){this.camera=new C.Camera;this.slicePlane=x.create();this.slicePlaneEnabled=!1}Z.prototype.copyFrom=function(ea){this.camera.copyFrom(ea.camera);x.copy(ea.slicePlane,this.slicePlane);
this.slicePlaneEnabled=ea.slicePlaneEnabled};return b._createClass(Z)}();a.Deconflictor=function(Z){function ea(ha){ha=Z.call(this,ha)||this;ha._dirty=!1;ha._runningViewState=new S;ha._state=a.State.Idle;ha._active=new Map;ha._visible=new Map;ha._iterators=new V;ha._accBinsNumX=15;ha._accBinsNumY=20;ha._accBinsSizeX=0;ha._accBinsSizeY=0;ha._accBins=null;ha.accNumTests=0;return ha}b._inherits(ea,Z);var ja=ea.prototype;ja.destroy=function(){this._active.clear();this._visible.clear();this._iterators=
null};ja.setDirty=function(){!this._dirty&&0<this._active.size&&(this._dirty=!0,this.notifyChange("updating"))};ja.runTask=function(ha){switch(this._state){case a.State.Idle:this._startUpdate(),ha.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ha))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ha))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ha))break;default:v.drawAccelerationStruct(this,
this._visible),this._state=a.State.Idle,this.notifyChange("updating")}};ja.modifyGraphics=function(ha,ia){ia?ha.forEach(oa=>this.addToActiveGraphics(oa)):ha.forEach(oa=>this.removeFromActiveGraphics(oa));this.setDirty()};ja.layerSupportsDeconfliction=function(ha){if(null==ha||"object3d"!==ha.type)return!1;ha=ha.stageObject;return 1===(ha?ha.geometries.length:0)&&ha?.geometries[0]?.material instanceof M.HUDMaterial?!0:!1};ja._startUpdate=function(){v.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);
const {fullWidth:ha,fullHeight:ia}=this._runningViewState.camera;this._initBins(ha,ia);this._resetIterators()};ja.addToActiveGraphics=function(ha){ha.info[this.visibilityGroup]=new Q;this._active.set(ha.graphics3DGraphic.graphic.uid,ha);this.setDirty()};ja.removeFromActiveGraphics=function(ha){this._visible.delete(ha.graphics3DGraphic.graphic.uid);const ia=ha.graphics3DGraphic;ia.destroyed||ia.setVisibilityFlag(this.visibilityGroup,B.VisibilityFlag.DECONFLICTION,!0);delete ha.info[this.visibilityGroup];
this._active.delete(ha.graphics3DGraphic.graphic.uid);this.setDirty()};ja._processActiveGraphics=function(ha){const ia=this._ensureActiveGraphicsIterator(),oa=e.invertOrIdentity(N,this._runningViewState.camera.projectionMatrix),ma="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?R:null;let fa=0;null!=ma&&(n.transformMat4(ma,l.ZEROS,this._runningViewState.camera.viewMatrix),ma[3]=w.getReferenceEllipsoid(this.view.spatialReference).radius,
fa=A.distanceToSilhouette(ma,l.ZEROS));for(;!ha.done;){ha.madeProgress();var ba=ia.next();if(!0===ba.done)return this._resetActiveGraphicsIterator(),!0;const aa=(ba=ba.value)&&ba.info[this.visibilityGroup];aa&&(this._collectGraphics3DGraphics(ba,oa,ma,fa),aa.culled?this._visible.delete(ba.graphics3DGraphic.graphic.uid):this._visible.set(ba.graphics3DGraphic.graphic.uid,ba))}return!1};ja._sortVisibleGraphics=function(ha){const ia=this._ensureSortGraphicsIterator();for(;!ha.done;){const oa=ia.next();
ha.madeProgress();if(!0===oa.done)return this._resetSortGraphicsIterator(),!0}return!1};ja._deconflictVisibleGraphics=function(ha){const ia=this._ensureVisibleGraphicsIterator(),oa=this.visibilityGroup===B.VisibilityGroup.LABEL;for(;!ha.done;){ha.madeProgress();var ma=ia.next();if(!0===ma.done)return this._resetVisibleGraphicsIterator(),!0;ma=ma.value;const ba=ma.info[this.visibilityGroup];if(ba&&!ba.culled){var fa=ma.graphics3DGraphic;fa=!oa||fa.isVisible();ba.visible=fa&&!this._isConflicted(ma);
ba.visible&&this._addToBins(ma);this._setGraphicVisibility(ma,ba.visible);v.drawPoly(ba,ba.visible)}}return!1};ja._resetIterators=function(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null};ja._ensureActiveGraphicsIterator=function(){this._iterators.active||(this._iterators.active=G(this._active));return this._iterators.active};ja._resetActiveGraphicsIterator=function(){this._iterators.active=null};ja._ensureVisibleGraphicsIterator=function(){this._iterators.visible||
(this._iterators.visible=G(this._visible));return this._iterators.visible};ja._resetVisibleGraphicsIterator=function(){this._iterators.visible=null};ja._ensureSortGraphicsIterator=function(){this._iterators.sort||(this._iterators.sort=L(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort};ja._resetSortGraphicsIterator=function(){this._iterators.sort=null};ja._collectGraphics3DGraphics=function(ha,ia,oa,ma){var fa=ha.graphics3DGraphic;if(!fa.destroyed){var ba=
ha.info[this.visibilityGroup];if(fa.isVisible(B.VisibilityGroup.GRAPHIC,B.VisibilityFlag.DECONFLICTION)){var aa=this.getGraphicsLayers(fa);r.empty(ba.aabr);fa=null;for(const da of aa)if(this.layerSupportsDeconfliction(da)){aa=da.stageObject.geometries[0].material;if(null==fa&&(fa=Y,this._getProjectionInfo(da,ia,fa),fa.isOutsideScreen||this._isCulledBySlice(ha,O)||null!=oa&&this._isCulledByHorizon(fa,oa,ma))){ba.culled=!0;return}this._expandBoundingRect(ba,da,aa,fa)}null==fa?ba.culled=!0:(ba.distance=
fa.distance,ba.culled=!1)}else ba.culled=!0}};ja._getProjectionInfo=function(ha,ia,oa){const ma=this._runningViewState.camera;ha=ha.stageObject;var fa=ha.geometries[0];const ba=fa.material;var aa=A.getCenter(ha.boundingVolumeWorldSpace.bounds);n.transformMat4(O,aa,ma.viewMatrix);aa=fa.vertexAttributes;fa=aa.get(F.VertexAttribute.NORMAL).data;aa=aa.get(F.VertexAttribute.AUXPOS1).data;ba.applyShaderOffsetsView(O,fa,ha.transformation,aa,ma,oa.scaleInfo,O);m.set(I,O[0],O[1],O[2],1);m.transformMat4(H,
I,ma.projectionMatrix);n.scale(oa.positionNDC,H,1/H[3]);ba.applyShaderOffsetsNDC(oa.positionNDC,aa,ma,oa.positionNDC,J);oa.distanceWithoutPolygonOffset=ma.depthNDCToWorld(J[2]);oa.distance=J[2]===oa.positionNDC[2]?oa.distanceWithoutPolygonOffset:ma.depthNDCToWorld(oa.positionNDC[2]);m.set(H,oa.positionNDC[0],oa.positionNDC[1],oa.positionNDC[2],1);m.transformMat4(I,H,ia);m.scale(I,I,1/I[3]);n.set(oa.positionView,O[0],O[1],O[2])};ja._isCulledByHorizon=function(ha,ia,oa){n.copy(W.direction,ha.positionView);
n.set(W.origin,0,0,0);return A.intersectRay(ia,W,T)?ha.distanceWithoutPolygonOffset>oa:!1};ja._isCulledBySlice=function(ha,ia){return ha.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&x.extrusionContainsPoint(this._runningViewState.slicePlane,ia)};ja._expandBoundingRect=function(ha,ia,oa,{positionNDC:ma,scaleInfo:fa}){const ba=this._runningViewState.camera;ia=ia.getScreenSize(X);E.applyPrecomputedScaleFactor(ia,fa.factor,ia);ia[0]*=ba.pixelRatio;ia[1]*=ba.pixelRatio;oa=r.offset(oa.calculateRelativeScreenBounds(ia,
fa.factorAlignment.scale,P),p.lerp(0,ba.fullWidth,.5+.5*ma[0]),p.lerp(0,ba.fullHeight,.5+.5*ma[1]));ma=this.iconMarginFactor;0!==ma&&(ma*=Math.min(r.width(oa),r.height(oa)),oa[0]-=ma,oa[1]-=ma,oa[2]+=ma,oa[3]+=ma);r.expand(ha.aabr,oa,ha.aabr)};ja._isConflicted=function(ha){const ia=ha.graphics3DGraphic.graphic.uid;ha=ha.info[this.visibilityGroup];for(let oa=Math.floor(ha.aabr[0]/this._accBinsSizeX);oa<=Math.floor(ha.aabr[2]/this._accBinsSizeX);oa++)if(!(0>oa||oa>=this._accBinsNumX))for(let ma=Math.floor(ha.aabr[1]/
this._accBinsSizeY);ma<=Math.floor(ha.aabr[3]/this._accBinsSizeY);ma++){if(0>ma||ma>=this._accBinsNumY)continue;const fa=this._accBins[oa][ma];for(let ba=0;ba<fa.length;ba++){const aa=fa.data[ba],da=aa.info[this.visibilityGroup];if(da&&da.visible&&aa.graphics3DGraphic.graphic.uid!==ia&&(this.accNumTests++,r.intersects(da.aabr,ha.aabr)))return!0}}return!1};ja._initBins=function(ha,ia){if(null==this._accBins){this._accBins=[];for(var oa=0;oa<this._accBinsNumX;oa++){this._accBins.push([]);var ma=this._accBins[this._accBins.length-
1];for(let fa=0;fa<this._accBinsNumY;fa++)ma.push(new u)}}else for(oa=0;oa<this._accBinsNumX;oa++)for(ma=0;ma<this._accBinsNumY;ma++)this._accBins[oa][ma].clear();this._accBinsSizeX=ha/this._accBinsNumX;this._accBinsSizeY=ia/this._accBinsNumY;this.accNumTests=0};ja._addToBins=function(ha){var ia=ha.info[this.visibilityGroup],oa=Math.floor(ia.aabr[0]/this._accBinsSizeX);const ma=Math.floor(ia.aabr[2]/this._accBinsSizeX),fa=Math.floor(ia.aabr[1]/this._accBinsSizeY);for(ia=Math.floor(ia.aabr[3]/this._accBinsSizeY);oa<=
ma;oa++)if(!(0>oa||oa>=this._accBinsNumX))for(let ba=fa;ba<=ia;ba++)0>ba||ba>=this._accBinsNumY||this._accBins[oa][ba].push(ha)};ja._setGraphicVisibility=function(ha,ia){ha=ha.graphics3DGraphic;ha.destroyed||(ha.setVisibilityFlag(this.visibilityGroup,B.VisibilityFlag.DECONFLICTION,ia),this.visibilityGroup===B.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ha,ia))};b._createClass(ea,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},
{key:"updating",get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ha=this._state/a.State.NumStates;return this._dirty?.5*ha:ha}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return ea}(y);c.__decorate([q.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([q.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);
a.Deconflictor=c.__decorate([g.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);let U=b._createClass(function(){this.id=0;this.visible=!1;this.distance=this.prio=0}),V=b._createClass(function(Z=null,ea=null,ja=null){this.active=Z;this.visible=ea;this.sort=ja;this.sortArray=new u({allocator:ha=>ha||new U})});const X=z.create(),Y=new (function(){function Z(){this.positionView=l.create();this.positionNDC=l.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=
new K.ScaleInfo}b._createClass(Z,[{key:"isOutsideScreen",get:function(){const ea=this.positionNDC;return-1>ea[0]||-1>ea[1]||-1>ea[2]||1<=ea[0]||1<=ea[1]}}]);return Z}());a.DeconflictorGraphic=k;a.DeconflictorViewState=S;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(g,e,h,z,n){k&&(k(),k=null);const l=d.height,m=f;m.beginPath();m.lineWidth=1;m.strokeStyle=
n;m.moveTo(g,l-h);m.lineTo(e,l-h);m.stroke();m.lineTo(e,l-z);m.stroke();m.lineTo(e,l-h);m.stroke();m.lineTo(g,l-h);m.stroke();m.lineTo(g,l-h);m.stroke();m.closePath()}let y=!1,p=!1,u=!1,q=!1,k=null,d,f;a.drawAccelerationStruct=function(g,e){if(p&&f){k&&(k(),k=null);var h=f,z=0;for(let n=0;n<g.accBinsNumX;n++)for(let l=0;l<g.accBinsNumY;l++){const m=g.accBins[n][g.accBinsNumY-1-l];z+=m.length;const t=n*g.accBinsSizeX,w=(n+1)*g.accBinsSizeX,r=l*g.accBinsSizeY,x=(l+1)*g.accBinsSizeY;h.fillText(m.length.toFixed(),
t+5,r+15);c(t,w,r,x,"blue")}h.fillText("total totalShownLabels: "+z,70,40);h.fillText("total visible labels: "+e.size,70,50);h.fillText("total numTests: "+g.accNumTests,70,30)}};a.drawPoly=function(g,e){y&&(e&&u||!e&&q)&&c(g.aabr[0],g.aabr[2],g.aabr[1],g.aabr[3],e?"green":"red")};a.prepare=function(g){u=b.DECONFLICTOR_SHOW_VISIBLE;q=b.DECONFLICTOR_SHOW_INVISIBLE;y=u||q;p=b.DECONFLICTOR_SHOW_GRID;k=null;y||p?k=()=>{null==d&&(d=document.createElement("canvas"),d.setAttribute("id","debugCanvas2d"),g.surface.parentElement.style.position=
"relative",g.surface.parentElement.appendChild(d));var {state:e}=g;const {camera:h,pixelRatio:z}=e,{width:n,height:l}=h;e=l*z;d.setAttribute("width",`${n*z}px`);d.setAttribute("height",`${e}px`);d.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${l}px`);f=d.getContext("2d");f.clearRect(0,0,n,l);f.font="12px Arial"}:d&&(d.parentElement.removeChild(d),d=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){c=function(d){function f(){var g=d.apply(this,arguments)||this;g.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;g.DECONFLICTOR_SHOW_VISIBLE=!1;g.DECONFLICTOR_SHOW_INVISIBLE=!1;g.DECONFLICTOR_SHOW_GRID=!1;g.LABELS_SHOW_BORDER=!1;g.TEXT_SHOW_BASELINE=!1;g.TEXT_SHOW_BORDER=!1;g.OVERLAY_DRAW_DEBUG_TEXTURE=!1;g.OVERLAY_SHOW_CENTER=!1;g.SHOW_POI=!1;g.TESTS_DISABLE_OPTIMIZATIONS=!1;g.TESTS_DISABLE_FAST_UPDATES=!1;g.DRAW_MESH_GEOMETRY_NORMALS=!1;g.FEATURE_TILE_FETCH_SHOW_TILES=!1;g.FEATURE_TILE_TREE_SHOW_TILES=
!1;g.TERRAIN_TILE_TREE_SHOW_TILES=!1;g.I3S_TREE_SHOW_TILES=!1;g.I3S_SHOW_MODIFICATIONS=!1;g.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;g.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;g.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;g.LINE_WIREFRAMES=!1;return g}a._inherits(f,d);return a._createClass(f)}(c);b.__decorate([y.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([y.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([y.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",
void 0);b.__decorate([y.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([y.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([y.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([y.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([y.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([y.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([y.property()],c.prototype,"SHOW_POI",void 0);b.__decorate([y.property()],
c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([y.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([y.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([y.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([y.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([y.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([y.property()],c.prototype,"I3S_TREE_SHOW_TILES",
void 0);b.__decorate([y.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([y.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([y.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([y.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([y.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([k.subclass("esri.views.3d.support.DebugFlags")],c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],
function(a){a.VisibilityFlag=void 0;(function(b){b[b.USER=1]="USER";b[b.SCALE_RANGE=2]="SCALE_RANGE";b[b.FILTER=4]="FILTER";b[b.DECONFLICTION=8]="DECONFLICTION";b[b.ALL_GRAPHIC=15]="ALL_GRAPHIC";b[b.ALL_LABEL=255]="ALL_LABEL"})(a.VisibilityFlag||(a.VisibilityFlag={}));a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=1]="GRAPHIC";b[b.LABEL=16]="LABEL"})(a.VisibilityGroup||(a.VisibilityGroup={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,y){function p(e,h,z){const n=z.parameters;z=z.paddingPixelsOverride;f.scale=Math.min(n.divisor/(h-n.offset),1);f.factor=Math.abs(e*e*e);f.minPixelSize=n.minPixelSize;f.paddingPixels=z;return f}function u(e,h){return 0===e?h.minPixelSize:h.minPixelSize*(1+2*h.paddingPixels/e)}function q(e,h){return Math.max(c.lerp(e*h.scale,e,h.factor),u(e,h))}let k=function(){function e(z,n,l,m={camera:{distance:0,
fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},t){this._viewingMode=z;this._description=n;this._ellipsoidRadius=l;this.parameters=m;this._paddingPixelsOverride=t;this._viewingMode===y.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}
var h=e.prototype;h.update=function(z){if(this.parameters&&this.parameters.camera.fovY===z.fovY&&this.parameters.camera.distance===z.distance)return!1;this._calculateParameters(z,this._ellipsoidRadius,this.parameters);return!0};h.overridePadding=function(z){return z!==this.paddingPixelsOverride?new e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,z):this};h._calculateParameters=function(z,n,l){const {scaleStart:m,scaleFallOffRange:t,minPixelSize:w}=this._description,{fovY:r,
distance:x}=z;var D=this._calculateCurvatureDependentParameters(z,n);n=this._coverageCompensation(z,n,D);const {tiltAngle:A,scaleFallOffFactor:v}=D,B=Math.sin(A)*x,C=.5*Math.PI-A-r*(.5-m*n);D=B/Math.cos(C);n=(D-B/Math.cos(C+r*t*n)*v)/(1-v);l.camera.fovY=z.fovY;l.camera.distance=z.distance;l.offset=n;l.divisor=D-n;l.minPixelSize=w;return l};h._calculateCurvatureDependentParametersLocal=function(z,n,l=g){l.tiltAngle=this._description.curvatureDependent.min.tiltAngle;l.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;
return l};h._calculateCurvatureDependentParametersGlobal=function(z,n,l=g){const m=this._description.curvatureDependent;z=1+z.distance/n;z=Math.sqrt(z*z-1);const [t,w]=[m.min.curvature,m.max.curvature];z=c.clamp((z-t)/(w-t),0,1);const [r,x]=[m.min,m.max];l.tiltAngle=c.lerp(r.tiltAngle,x.tiltAngle,z);l.scaleFallOffFactor=c.lerp(r.scaleFallOffFactor,x.scaleFallOffFactor,z);return l};h._surfaceCoverageCompensationLocal=function(z,n,l){return(z.fovY-l.tiltAngle)/z.fovY};h._surfaceCoverageCompensationGlobal=
function(z,n,l){const m=n*n;l=l.tiltAngle+.5*Math.PI;const {fovY:t,distance:w}=z;z=w*w+m-2*Math.cos(l)*w*n;const r=Math.sqrt(z);return(Math.acos(Math.sqrt(z-m)/r)-Math.asin(n/(r/Math.sin(l)))+.5*t)/t};b._createClass(e,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return e}();const d={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minPixelSize:0,paddingPixels:0},g={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,h,z=[0,0]){h=Math.min(Math.max(h.scale,u(e[1],h)/Math.max(1E-5,e[1])),1);z[0]=e[0]*h;z[1]=e[1]*h;return z};a.applyScaleFactor=q;a.getLabelSettings=function(e,h){const {curvatureDependent:z,scaleStart:n,scaleFallOffRange:l}=d;return new k(e,{curvatureDependent:{min:{curvature:z.min.curvature,tiltAngle:z.min.tiltAngle,
scaleFallOffFactor:.7},max:{curvature:z.max.curvature,tiltAngle:z.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:n,scaleFallOffRange:l,minPixelSize:14},h)};a.getSettings=function(e,h){return new k(e,d,h)};a.precomputeScaleFactor=function(e,h,z,n){e=p(e,h,z);e.minPixelSize=0;e.paddingPixels=0;e=q(1,e);n.scale=e;n.factor=0;n.minPixelSize=z.parameters.minPixelSize;n.paddingPixels=z.paddingPixelsOverride};a.scale=function(e,h,z,n){return q(e,p(h,z,n))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L){function O(ba,aa,da,ca=R){d.copy(ca,ba.anchorPosition);ca[0]*=-aa[0];ca[1]*=-aa[1];ca[0]+=ba.screenOffset[0]*da;ca[1]+=ba.screenOffset[1]*da;return ca}function I(ba,aa,da,ca,na,qa,ua,sa){aa=aa-na-(0<sa[0]?ca[0]*sa[0]:0);let pa=aa+ca[0]+2*na;da=da-na-(0<sa[1]?ca[1]*sa[1]:0);na=da+ca[1]+2*na;sa=ua.distanceFieldBoundingBox;ua.textureIsSignedDistanceField&&null!=sa&&(aa+=ca[0]*sa[0],da+=ca[1]*sa[1],pa-=ca[0]*(1-sa[2]),na-=ca[1]*
(1-sa[3]),aa-=qa,pa+=qa,da-=qa,na+=qa);return ba[0]>aa&&ba[0]<pa&&ba[1]>da&&ba[1]<na}let H=function(ba){function aa(ca){ca=ba.call(this,ca,new ia)||this;ca._configuration=new L.HUDMaterialTechniqueConfiguration;return ca}b._inherits(aa,ba);var da=aa.prototype;da.getConfiguration=function(ca,na){this._configuration.output=ca;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?r.HUDSpace.Screen:r.HUDSpace.World;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=na.slot===A.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(ca===w.ShaderOutput.Color||ca===w.ShaderOutput.Alpha);ca===w.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!m.LABELS_SHOW_BORDER);ca===w.ShaderOutput.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);this._configuration.depthEnabled=
this.parameters.depthEnabled;this._configuration.transparencyPassType=na.transparencyPassType;this._configuration.hasMultipassGeometry=na.multipassGeometry.enabled;this._configuration.hasMultipassTerrain=na.multipassTerrain.enabled;this._configuration.cullAboveGround=na.multipassTerrain.cullAboveGround;return this._configuration};da.intersect=function(ca,na,qa,ua,sa,pa){if(qa.options.selectionMode&&qa.options.hud&&ca.visible){ua=this.parameters;var ka=sa=1;p.fromMat4(U,na);if(null!=ca.shaderTransformer){ka=
ca.shaderTransformer(ea);sa=ka[0];ka=ka[5];var ra=U,va=ra[0],Ca=ra[1],Ba=ra[2],Ha=ra[3],Ma=ra[4],Qa=ra[5],Sa=ra[6],La=ra[7],Ua=ra[8],Va=1/Math.sqrt(va*va+Ca*Ca+Ba*Ba);const cb=1/Math.sqrt(Ha*Ha+Ma*Ma+Qa*Qa),la=1/Math.sqrt(Sa*Sa+La*La+Ua*Ua);ra[0]=va*Va;ra[1]=Ca*Va;ra[2]=Ba*Va;ra[3]=Ha*cb;ra[4]=Ma*cb;ra[5]=Qa*cb;ra[6]=Sa*la;ra[7]=La*la;ra[8]=Ua*la}ra=ca.vertexAttributes.get(C.VertexAttribute.POSITION);va=ca.vertexAttributes.get(C.VertexAttribute.SIZE);Ca=ca.vertexAttributes.get(C.VertexAttribute.NORMAL);
ca=ca.vertexAttributes.get(C.VertexAttribute.AUXPOS1);B.assert(3<=ra.size);Ba=qa.point;Ha=qa.camera;Ma=K.calculateAnchorPosForRendering(ua);sa*=Ha.pixelRatio;ka*=Ha.pixelRatio;Qa="screen"===this.parameters.centerOffsetUnits;for(Sa=0;Sa<ra.data.length/ra.size;Sa++)La=Sa*ra.size,g.set(W,ra.data[La],ra.data[La+1],ra.data[La+2]),g.transformMat4(W,W,na),La=Sa*va.size,ja[0]=va.data[La]*sa,ja[1]=va.data[La+1]*ka,g.transformMat4(W,W,Ha.viewMatrix),La=Sa*ca.size,g.set(Y,ca.data[La],ca.data[La+1],ca.data[La+
2]),Qa||(W[0]+=Y[0],W[1]+=Y[1],0!==Y[2]&&(La=Y[2],g.normalize(Y,W),g.subtract(W,W,g.scale(Y,Y,La)))),La=Sa*Ca.size,g.set(T,Ca.data[La],Ca.data[La+1],Ca.data[La+2]),this._normalAndViewAngle(T,U,Ha,Z),this._applyVerticalOffsetTransformationView(W,Z,Ha,N),Ha.applyProjection(W,P),-1<P[0]&&(P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),Qa&&(Y[0]||Y[1])&&(P[0]+=Y[0],0!==Y[1]&&(P[1]+=v.applyScaleFactor(Y[1],N.factorAlignment)),Ha.unapplyProjection(P,W)),P[0]+=this.parameters.screenOffset[0],P[1]+=this.parameters.screenOffset[1],
v.applyPrecomputedScaleFactor(ja,N.factor,ja),La=1*Ha.pixelRatio,Ua=0,ua.textureIsSignedDistanceField&&(Ua=ua.outlineSize*Ha.pixelRatio/2),Ba&&I(Ba,P[0],P[1],ja,La,Ua,ua,Ma)&&(Ua=qa.ray,g.transformMat4(S,W,q.invert(X,Ha.viewMatrix)),P[0]=Ba[0],P[1]=Ba[1],Ha.unprojectFromRenderScreen(P,W)&&(La=e.create(),g.copy(La,Ua.direction),Va=1/g.length(La),g.scale(La,La,Va),Ua=g.distance(Ua.origin,W)*Va,pa(Ua,La,-1,!0,1,S))))}};da.intersectDraped=function(ca,na,qa,ua,sa,pa){na=ca.vertexAttributes.get(C.VertexAttribute.POSITION);
qa=ca.vertexAttributes.get(C.VertexAttribute.SIZE);const ka=this.parameters,ra=K.calculateAnchorPosForRendering(ka);let va=1;var Ca=1;null!=ca.shaderTransformer&&(Ca=ca.shaderTransformer(ea),va=Ca[0],Ca=Ca[5]);va*=ca.screenToWorldRatio;Ca*=ca.screenToWorldRatio;const Ba=2*ca.screenToWorldRatio;for(let Qa=0;Qa<na.data.length/na.size;Qa++){var Ha=Qa*na.size;const Sa=na.data[Ha];Ha=na.data[Ha+1];var Ma=Qa*qa.size;ja[0]=qa.data[Ma]*va;ja[1]=qa.data[Ma+1]*Ca;Ma=0;ka.textureIsSignedDistanceField&&(Ma=ka.outlineSize*
ca.screenToWorldRatio/2);I(ua,Sa,Ha,ja,Ba,Ma,ka,ra)&&sa(pa.dist,pa.normal,-1,!1)}};da.createBufferWriter=function(){return new fa(this)};da._normalAndViewAngle=function(ca,na,qa,ua){z.isMat4(na)&&(na=p.fromMat4(V,na));g.transformMat3(ua.normal,ca,na);g.transformMat4(ua.normal,ua.normal,qa.viewInverseTransposeMatrix);ua.cosAngle=g.dot(Q,ha);return ua};da._updateScaleInfo=function(ca,na,qa){const ua=this.parameters;null!=ua.screenSizePerspective?v.precomputeScaleFactor(qa,na,ua.screenSizePerspective,
ca.factor):(ca.factor.scale=1,ca.factor.factor=0,ca.factor.minPixelSize=0,ca.factor.paddingPixels=0);null!=ua.screenSizePerspectiveAlignment?v.precomputeScaleFactor(qa,na,ua.screenSizePerspectiveAlignment,ca.factorAlignment):(ca.factorAlignment.factor=ca.factor.factor,ca.factorAlignment.scale=ca.factor.scale,ca.factorAlignment.minPixelSize=ca.factor.minPixelSize,ca.factorAlignment.paddingPixels=ca.factor.paddingPixels)};da.applyShaderOffsetsView=function(ca,na,qa,ua,sa,pa,ka){na=this._normalAndViewAngle(na,
qa,sa,Z);this._applyVerticalGroundOffsetView(ca,na,sa,ka);this._applyVerticalOffsetTransformationView(ka,na,sa,pa);this._applyPolygonOffsetView(ka,na,ua[3],sa,ka);this._applyCenterOffsetView(ka,ua,ka);return ka};da.applyShaderOffsetsNDC=function(ca,na,qa,ua,sa){this._applyCenterOffsetNDC(ca,na,qa,ua);null!=sa&&g.copy(sa,ua);this._applyPolygonOffsetNDC(ua,na,qa,ua);return ua};da._applyPolygonOffsetView=function(ca,na,qa,ua,sa){var pa=ua.aboveGround?1:-1;qa=Math.sign(qa);0===qa&&(qa=pa);pa*=qa;if(0>=
this.parameters.shaderPolygonOffset)return g.copy(sa,ca);na=y.clamp(Math.abs(na.cosAngle),.01,1);ua=1-Math.sqrt(1-na*na)/na/ua.viewport[2];0<pa?g.scale(sa,ca,ua):g.scale(sa,ca,1/ua);return sa};da._applyVerticalGroundOffsetView=function(ca,na,qa,ua){const sa=g.length(ca),pa=qa.aboveGround?1:-1;qa=.5*qa.computeRenderPixelSizeAtDist(sa);na=g.scale(W,na.normal,pa*qa);g.add(ua,ca,na);return ua};da._applyVerticalOffsetTransformationView=function(ca,na,qa,ua){const sa=this.parameters;if(!sa.verticalOffset||
!sa.verticalOffset.screenLength){if(sa.screenSizePerspective||sa.screenSizePerspectiveAlignment){var pa=g.length(ca);this._updateScaleInfo(ua,pa,na.cosAngle)}else ua.factor.scale=1,ua.factorAlignment.scale=1;return ca}pa=g.length(ca);qa=M.verticalOffsetAtDistance(qa,pa,sa.verticalOffset,na.cosAngle,sa.screenSizePerspectiveAlignment??sa.screenSizePerspective);this._updateScaleInfo(ua,pa,na.cosAngle);g.scale(na.normal,na.normal,qa);return g.add(ca,ca,na.normal)};da._applyCenterOffsetView=function(ca,
na,qa){const ua="screen"!==this.parameters.centerOffsetUnits;qa!==ca&&g.copy(qa,ca);ua&&(qa[0]+=na[0],qa[1]+=na[1],na[2]&&(g.normalize(T,qa),g.add(qa,qa,g.scale(T,T,na[2]))));return qa};da._applyCenterOffsetNDC=function(ca,na,qa,ua){const sa="screen"!==this.parameters.centerOffsetUnits;ua!==ca&&g.copy(ua,ca);sa||(ua[0]+=na[0]/qa.fullWidth*2,ua[1]+=na[1]/qa.fullHeight*2);return ua};da._applyPolygonOffsetNDC=function(ca,na,qa,ua){const sa=this.parameters.shaderPolygonOffset;ca!==ua&&g.copy(ua,ca);sa&&
(ca=qa.aboveGround?1:-1,ua[2]-=(ca*Math.sign(na[3])||ca)*sa);return ua};da.requiresSlot=function(ca,na){if(na===w.ShaderOutput.Color||na===w.ShaderOutput.Alpha||na===w.ShaderOutput.Highlight||na===w.ShaderOutput.ObjectAndLayerIdColor){if(ca===A.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:qa,occlusionTest:ua}=this.parameters;return ca===(qa?A.RenderSlot.LABEL_MATERIAL:A.RenderSlot.HUD_MATERIAL)||ua&&ca===A.RenderSlot.OCCLUSION_PIXELS}return!1};da.createGLMaterial=function(ca){return new J(ca)};
da.calculateRelativeScreenBounds=function(ca,na,qa=n.create()){O(this.parameters,ca,na,qa);qa[2]=qa[0]+ca[0];qa[3]=qa[1]+ca[1];return qa};return b._createClass(aa)}(D.Material),J=function(ba){function aa(ca){return ba.call(this,{...ca,...ca.material.parameters})||this}b._inherits(aa,ba);var da=aa.prototype;da.selectProgram=function(ca){return this.ensureTechnique(G.HUDMaterialTechnique,ca)};da.beginSlot=function(ca){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);
return this.selectProgram(ca)};return b._createClass(aa)}(x.GLTextureMaterial);const N=new E.ScaleInfo,R=f.create(),W=e.create(),T=e.create(),P=h.create(),Q=e.create(),S=e.create(),U=u.create(),V=u.create(),X=k.create(),Y=e.create(),Z={normal:Q,cosAngle:0},ea=k.create(),ja=[0,0],ha=e.fromValues(0,0,1);let ia=function(ba){function aa(){var da=ba.apply(this,arguments)||this;da.renderOccluded=D.RenderOccludedFlag.Occlude;da.color=h.fromValues(1,1,1,1);da.texCoordScale=[1,1];da.polygonOffset=!1;da.anchorPosition=
f.fromValues(.5,.5);da.screenOffset=[0,0];da.shaderPolygonOffset=1E-5;da.textureIsSignedDistanceField=!1;da.outlineColor=h.fromValues(1,1,1,1);da.outlineSize=0;da.vvSizeEnabled=!1;da.vvSize=null;da.vvColor=null;da.vvOpacity=null;da.vvSymbolAnchor=null;da.vvSymbolRotationMatrix=null;da.hasSlicePlane=!1;da.pixelSnappingEnabled=!0;da.occlusionTest=!0;da.binaryHighlightOcclusion=!0;da.centerOffsetUnits="world";da.drawInSecondSlot=!1;da.depthEnabled=!0;da.isDraped=!1;return da}b._inherits(aa,ba);return b._createClass(aa)}(x.GLTextureMaterialBindParameters);
const oa=t.newLayout().vec3f(C.VertexAttribute.POSITION).vec3f(C.VertexAttribute.NORMAL).vec2f(C.VertexAttribute.UV0).vec4u8(C.VertexAttribute.COLOR).vec2f(C.VertexAttribute.SIZE).vec4f(C.VertexAttribute.AUXPOS1).vec4f(C.VertexAttribute.AUXPOS2),ma=oa.clone().vec4u8(C.VertexAttribute.OBJECTANDLAYERIDCOLOR);let fa=function(){function ba(da){this._material=da;this.vertexBufferLayout=c("enable-feature:objectAndLayerId-rendering")?ma:oa}var aa=ba.prototype;aa.elementCount=function(da){return 6*da.indices.get(C.VertexAttribute.POSITION).length};
aa.write=function(da,ca,na,qa,ua){F.writePosition(na.indices.get(C.VertexAttribute.POSITION),na.vertexAttributes.get(C.VertexAttribute.POSITION).data,da,qa.position,ua,6);F.writeNormal(na.indices.get(C.VertexAttribute.NORMAL),na.vertexAttributes.get(C.VertexAttribute.NORMAL).data,ca,qa.normal,ua,6);da=na.vertexAttributes.get(C.VertexAttribute.UV0).data;var sa;if(null==da||4>da.length){da=this._material.parameters;var pa=sa=0;var ka=da.texCoordScale[0];var ra=da.texCoordScale[1]}else sa=da[0],pa=da[1],
ka=da[2],ra=da[3];ka=Math.min(1.99999,ka+1);ra=Math.min(1.99999,ra+1);da=na.indices.get(C.VertexAttribute.POSITION).length;ca=ua;var va=qa.uv0;for(var Ca=0;Ca<da;++Ca)va.set(ca,0,sa),va.set(ca,1,pa),ca+=1,va.set(ca,0,ka),va.set(ca,1,pa),ca+=1,va.set(ca,0,ka),va.set(ca,1,ra),ca+=1,va.set(ca,0,ka),va.set(ca,1,ra),ca+=1,va.set(ca,0,sa),va.set(ca,1,ra),ca+=1,va.set(ca,0,sa),va.set(ca,1,pa),ca+=1;F.writeColor(na.indices.get(C.VertexAttribute.COLOR),na.vertexAttributes.get(C.VertexAttribute.COLOR).data,
4,qa.color,ua,6);sa=na.indices.get(C.VertexAttribute.SIZE);pa=na.vertexAttributes.get(C.VertexAttribute.SIZE).data;da=sa.length;ka=qa.size;ca=ua;for(ra=0;ra<da;++ra){va=pa[2*sa[ra]];Ca=pa[2*sa[ra]+1];for(let Ba=0;6>Ba;++Ba)ka.set(ca,0,va),ka.set(ca,1,Ca),ca+=1}na.indices.get(C.VertexAttribute.AUXPOS1)&&na.vertexAttributes.get(C.VertexAttribute.AUXPOS1)?F.writeBufferVec4(na.indices.get(C.VertexAttribute.AUXPOS1),na.vertexAttributes.get(C.VertexAttribute.AUXPOS1).data,qa.auxpos1,ua,6):F.writeBufferVec4Zeros(qa.auxpos1,
ua,6*da);na.indices.get(C.VertexAttribute.AUXPOS2)&&na.vertexAttributes.get(C.VertexAttribute.AUXPOS2)?F.writeBufferVec4(na.indices.get(C.VertexAttribute.AUXPOS2),na.vertexAttributes.get(C.VertexAttribute.AUXPOS2).data,qa.auxpos2,ua,6):F.writeBufferVec4Zeros(qa.auxpos2,ua,6*da);null!=na.objectAndLayerIdColor&&na.indices.get(C.VertexAttribute.POSITION)&&(da=na.indices.get(C.VertexAttribute.POSITION).length,qa=qa.getField(C.VertexAttribute.OBJECTANDLAYERIDCOLOR,l.BufferViewVec4u8),F.writeObjectAndLayerIdColor(na.objectAndLayerIdColor,
qa,da,ua,6))};return b._createClass(ba)}();a.HUDMaterial=H;a.Parameters=ia;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(y){return y instanceof Float32Array&&16<=y.length}function c(y){return Array.isArray(y)&&16<=y.length}a.isMat4=function(y){return b(y)||c(y)};a.isMat4f32=b;a.isMat4f64=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./AlignPixel.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.HUDSpace=void 0;(function(e){e[e.World=0]="World";e[e.Screen=1]="Screen";e[e.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(e,h){e.include(p.ScreenSizePerspective);e.attributes.add(g.VertexAttribute.POSITION,"vec3");e.attributes.add(g.VertexAttribute.NORMAL,"vec3");e.attributes.add(g.VertexAttribute.AUXPOS1,"vec4");e=e.vertex;u.addProjViewLocalOrigin(e,h);u.addCameraPosition(e,h);e.uniforms.add(new q.Float4PassUniform("viewport",(z,n)=>n.camera.fullViewport),
new k.FloatPassUniform("polygonOffset",z=>z.shaderPolygonOffset),new k.FloatPassUniform("cameraGroundRelative",(z,n)=>n.camera.aboveGround?1:-1),new k.FloatPassUniform("renderTransparentlyOccludedHUD",(z,n)=>n.renderTransparentlyOccludedHUD===y.HUDTransparencyRenderStyle.Occluded?1:n.renderTransparentlyOccludedHUD===y.HUDTransparencyRenderStyle.NotOccluded?0:.75),new f.Texture2DPassUniform("hudVisibilityTexture",(z,n)=>n.hudVisibilityTexture));h.hasVerticalOffset&&b.addVerticalOffset(e);e.constants.add("smallOffsetAngle",
"float",.984807753012208);e.code.add(d.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);e.code.add(d.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);h.draped&&!h.hasVerticalOffset||u.addViewNormal(e);h.draped||(e.uniforms.add(new k.FloatPassUniform("perDistancePixelRatio",(z,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),e.code.add(d.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&u.addPixelRatio(e,h);h.hasScreenSizePerspective&&p.addScreenSizePerspectiveAlignment(e);e.code.add(d.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${h.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${h.hasScreenSizePerspective?h.hasVerticalOffset||h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${h.hasVerticalOffset?h.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${h.hasVerticalOffset?d.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${h.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?d.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?h.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);e.include(c.AlignPixel);e.code.add(d.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,y,p,u,q){function k(f){f.uniforms.add(new u.Float4PassUniform("verticalOffset",(g,e)=>{const {minWorldLength:h,maxWorldLength:z,
screenLength:n}=g.verticalOffset;return b.set(d,n*(e.camera.pixelRatio||1),Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),h,z)}))}const d=c.create();a.VerticalOffset=function(f,g){const e=f.vertex;g.hasVerticalOffset?(k(e),g.hasScreenSizePerspective&&(f.include(y.ScreenSizePerspective),y.addScreenSizePerspectiveAlignment(e),p.addCameraPosition(f.vertex,g)),e.code.add(q.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${g.spherical?q.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:q.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${g.hasScreenSizePerspective?q.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:q.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):e.code.add(q.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,b,c,y,p){function u(k){return b.set(q,k.parameters.divisor,
k.parameters.offset,k.parameters.minPixelSize,k.paddingPixelsOverride)}const q=c.create();a.ScreenSizePerspective=function(k){k.vertex.code.add(p.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);k.vertex.code.add(p.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);k.vertex.code.add(p.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);k.vertex.code.add(p.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);k.vertex.code.add(p.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);k.vertex.code.add(p.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);k.vertex.code.add(p.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(k){k.uniforms.add(new y.Float4PassUniform("screenSizePerspective",d=>u(d.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(k){k.uniforms.add(new y.Float4PassUniform("screenSizePerspectiveAlignment",d=>u(d.screenSizePerspectiveAlignment||d.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../terrain/Overlay ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){const e=c.create(),h=p.create();a.addCameraPosition=function(z,n){n.instancedDoublePrecision?z.constants.add("cameraPosition","vec3",p.ZEROS):z.uniforms.add(new q.Float3DrawUniform("cameraPosition",(l,m)=>y.set(h,m.camera.viewInverseTransposeMatrix[3]-l.origin[0],m.camera.viewInverseTransposeMatrix[7]-l.origin[1],m.camera.viewInverseTransposeMatrix[11]-l.origin[2])))};a.addPixelRatio=function(z,n){z.uniforms.add(new d.FloatPassUniform("pixelRatio",(l,m)=>m.camera.pixelRatio/
(n.draped?u.OverlayStretch:1)))};a.addProjViewLocalOrigin=function(z,n){n.instancedDoublePrecision?z.uniforms.add(new g.Matrix4PassUniform("proj",(l,m)=>m.camera.projectionMatrix),new g.Matrix4PassUniform("view",(l,m)=>b.translate(e,m.camera.viewMatrix,y.set(h,m.camera.viewInverseTransposeMatrix[3],m.camera.viewInverseTransposeMatrix[7],m.camera.viewInverseTransposeMatrix[11]))),new k.Float3PassUniform("localOrigin",(l,m)=>y.set(h,m.camera.viewInverseTransposeMatrix[3],m.camera.viewInverseTransposeMatrix[7],
m.camera.viewInverseTransposeMatrix[11]))):z.uniforms.add(new g.Matrix4PassUniform("proj",(l,m)=>m.camera.projectionMatrix),new f.Matrix4DrawUniform("view",(l,m)=>b.translate(e,m.camera.viewMatrix,l.origin)),new q.Float3DrawUniform("localOrigin",l=>l.origin))};a.addViewNormal=function(z){z.uniforms.add(new g.Matrix4PassUniform("viewNormal",(n,l)=>l.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,b,c,y,p,u){a.OverlaySource=void 0;(function(d){d[d.None=0]="None";d[d.ColorAndWater=1]="ColorAndWater";d[d.Highlight=2]="Highlight";d[d.Occluded=3]="Occluded";d[d.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(a.OverlaySource||(a.OverlaySource={}));let q=function(){function d(g,e){this.index=g;this.renderTargets=e;this._extent=c.create();this.resolution=0;this.renderLocalOrigin=u.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new k;this.hasTargetWithoutRasterImage=
this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=g;this.validTargets=Array(e.renderTargets.length).fill(!1)}var f=d.prototype;f.getValidTexture=function(g){return this.validTargets[g]?this.renderTargets.getTarget(g).getTexture():null};f.getColorTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(y.RenderTargetType.Color):g===a.OverlaySource.Highlight?this.renderTargets.getTarget(y.RenderTargetType.Highlight):g===a.OverlaySource.ObjectAndLayerIdColor?
this.renderTargets.getTarget(y.RenderTargetType.ObjectAndLayerIdColor):this.renderTargets.getTarget(y.RenderTargetType.Occluded))?g.getTexture():null};f.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?this.getValidTexture(y.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(y.RenderTargetType.Color):null};f.getNormalTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(y.RenderTargetType.Water):
null)?g.getTexture():null};f.draw=function(g,e){const h=this.computeRenderTargetValidityBitfield();for(const z of this.renderTargets.renderTargets)this.validTargets[z.type]=z.type!==y.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?g.drawTarget(this,z,e):!1;g=this.computeRenderTargetValidityBitfield();return h^g?p.ValidationState.CHANGED:p.ValidationState.UNCHANGED};f.computeRenderTargetValidityBitfield=function(){const g=this.validTargets;return+g[y.RenderTargetType.Color]|
+g[y.RenderTargetType.ColorNoRasterImage]<<1|+g[y.RenderTargetType.Highlight]<<2|+g[y.RenderTargetType.Water]<<3|+g[y.RenderTargetType.Occluded]<<4};f.setupGeometryViewsCyclical=function(g){this.setupGeometryViewsDirect();var e=.001*g.range;if(this._extent[0]-e<=g.min){const h=this.canvasGeometries.extents[this.canvasGeometries.numViews++];c.offset(this._extent,g.range,0,h)}this._extent[2]+e>=g.max&&(e=this.canvasGeometries.extents[this.canvasGeometries.numViews++],c.offset(this._extent,-g.range,
0,e))};f.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;c.copy(this.canvasGeometries.extents[0],this._extent)};f.hasSomeSizedView=function(){for(let g=0;g<this.canvasGeometries.numViews;g++){const e=this.canvasGeometries.extents[g];if(e[0]!==e[2]&&e[1]!==e[3])return!0}return!1};f.applyViewport=function(g){g.setViewport(this.index===y.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};b._createClass(d,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",
get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return d}(),k=b._createClass(function(){this.extents=[c.create(),c.create(),c.create()];this.numViews=0});a.Overlay=q;a.OverlayStretch=1.3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex=
{}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=
5]="ObjectAndLayerIdColor"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64"],function(a,b,c){let y=b._createClass(function(p,u){this.vec3=
p;this.id=u});a.LocalOrigin=y;a.fromValues=function(p,u,q,k){return new y(c.fromValues(p,u,q),k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"mat4",y.BindType.Draw,(d,f,g)=>d.setUniformMatrix4fv(q,k(f,g)))||this}b._inherits(u,
p);return b._createClass(u)}(c.Uniform);a.Matrix4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(a,b,c){a.AlignPixel=function(y){y.uniforms.add(new b.BooleanPassUniform("alignPixelEnabled",(p,u)=>u.alignPixelEnabled));y.code.add(c.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);y.code.add(c.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparencyRenderStyle=void 0;var b=a.HUDTransparencyRenderStyle||(a.HUDTransparencyRenderStyle={});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d){u=function(f){function g(h,z){var n=f.call(this)||this;n.type=q.ContentObjectType.Material;n.supportsEdges=!1;n._visible=!0;n._renderPriority=0;n._insertOrder=0;n._vertexAttributeLocations=k.Default3D;n._pp0=c.fromValues(0,0,1);n._pp1=c.fromValues(0,0,0);n._parameters=d.copyParameters(h,z);n.validateParameters(n._parameters);return n}b._inherits(g,f);var e=g.prototype;e.dispose=function(){};e.update=function(h){return!1};e.setParameters=function(h,z=!0){d.updateParameters(this._parameters,
h)&&(this.validateParameters(this._parameters),z&&this.parametersChanged())};e.validateParameters=function(h){};e.shouldRender=function(h){return this.isVisible()&&this.isVisibleForOutput(h.output)&&0!==(this.renderOccluded&h.renderOccludedMask)};e.isVisibleForOutput=function(h){return!0};e.isVisible=function(){return this._visible};e.parametersChanged=function(){null!=this.repository&&this.repository.materialChanged(this)};e.intersectDraped=function(h,z,n,l,m,t){this._pp0[0]=this._pp1[0]=l[0];this._pp0[1]=
this._pp1[1]=l[1];return this.intersect(h,z,n,this._pp0,this._pp1,m)};b._createClass(g,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(h){h!==this._visible&&(this._visible=h,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(h){h!==this._renderPriority&&(this._renderPriority=h,this.parametersChanged())}},
{key:"insertOrder",get:function(){return this._insertOrder},set:function(h){h!==this._insertOrder&&(this._insertOrder=h,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return g}(u.ContentObject);p=function(f){function g(e,h,z){h=f.call(this,h,z)||this;h.camera=e;return h}b._inherits(g,f);return b._createClass(g)}(p.Parameters);a.RenderOccludedFlag=void 0;(function(f){f[f.None=0]="None";f[f.Occlude=1]="Occlude";f[f.Transparent=2]=
"Transparent";f[f.OccludeAndTransparent=4]="OccludeAndTransparent";f[f.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";f[f.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));y=function(f){function g(){var e=f.apply(this,arguments)||this;e.renderOccluded=a.RenderOccludedFlag.Occlude;return e}b._inherits(g,f);return b._createClass(g)}(y.NoParameters);a.Material=u;a.MaterialParameters=y;a.UpdateParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),function(a,b,c,y,p,u,q,k,d,f){function g(v,B,C,E,F,M){if(null!=v){var K=z(B,C,r);u.setMin(w,v.bbMin);u.setMax(w,v.bbMax);null!=F&&F.applyToAabb(w);
if(n(w,B,K,E)){const {primitiveIndices:G,indices:L,position:O}=v;K=G?G.length:L.length/3;if(1E3<K&&(v=v.getChildren(),void 0!==v)){for(const I of v)g(I,B,C,E,F,M);return}e(B,C,0,K,L,O,G,F,M)}}}function e(v,B,C,E,F,M,K,G,L){if(K){const {data:ha,stride:ia}=M;M=v[0];var O=v[1];v=v[2];var I=B[0]-M,H=B[1]-O;for(B=B[2]-v;C<E;++C){var J=K[C],N=3*J,R=ia*F[N++],W=ha[R++],T=ha[R++],P=ha[R];R=ia*F[N++];var Q=ha[R++],S=ha[R++],U=ha[R];R=ia*F[N];N=ha[R++];var V=ha[R++];R=ha[R];null!=G&&([W,T,P]=G.applyToVertex(W,
T,P,C),[Q,S,U]=G.applyToVertex(Q,S,U,C),[N,V,R]=G.applyToVertex(N,V,R,C));Q-=W;S-=T;U-=P;N-=W;V-=T;R-=P;var X=H*R-V*B,Y=B*N-R*I;const oa=I*V-N*H;var Z=Q*X+S*Y+U*oa;if(!(Math.abs(Z)<=Number.EPSILON)){W=M-W;T=O-T;P=v-P;X=W*X+T*Y+P*oa;if(0<Z){if(0>X||X>Z)continue}else if(0<X||X<Z)continue;Y=T*U-S*P;P=P*Q-U*W;T=W*S-Q*T;W=I*Y+H*P+B*T;if(0<Z){if(0>W||X+W>Z)continue}else if(0<W||X+W<Z)continue;P=(N*Y+V*P+R*T)/Z;0<=P&&(Q=h(Q,S,U,N,V,R,x),L(P,Q,J,!1))}}}else{var {data:ea,stride:ja}=M;K=v[0];M=v[1];O=v[2];
v=B[0]-K;I=B[1]-M;H=B[2]-O;for(let ha=C,ia=3*C;ha<E;++ha)if(N=ja*F[ia++],T=ea[N++],P=ea[N++],U=ea[N],N=ja*F[ia++],B=ea[N++],C=ea[N++],J=ea[N],N=ja*F[ia++],Q=ea[N++],S=ea[N++],N=ea[N],null!=G&&([T,P,U]=G.applyToVertex(T,P,U,ha),[B,C,J]=G.applyToVertex(B,C,J,ha),[Q,S,N]=G.applyToVertex(Q,S,N,ha)),B-=T,C-=P,J-=U,Q-=T,S-=P,N-=U,R=I*N-S*H,W=H*Q-N*v,Z=v*S-Q*I,V=B*R+C*W+J*Z,!(Math.abs(V)<=Number.EPSILON)){T=K-T;P=M-P;U=O-U;R=T*R+P*W+U*Z;if(0<V){if(0>R||R>V)continue}else if(0<R||R<V)continue;W=P*J-C*U;U=
U*B-J*T;P=T*C-B*P;T=v*W+I*U+H*P;if(0<V){if(0>T||R+T>V)continue}else if(0<T||R+T<V)continue;U=(Q*W+S*U+N*P)/V;0<=U&&(B=h(B,C,J,Q,S,N,x),L(U,B,ha,!1))}}}function h(v,B,C,E,F,M,K){y.set(D,v,B,C);y.set(A,E,F,M);y.cross(K,D,A);y.normalize(K,K);return K}function z(v,B,C){return y.set(C,1/(B[0]-v[0]),1/(B[1]-v[1]),1/(B[2]-v[2]))}function n(v,B,C,E){return l(v,B,C,E,Infinity)}function l(v,B,C,E,F){var M=(v[0]-E-B[0])*C[0],K=(v[3]+E-B[0])*C[0];let G=Math.min(M,K);M=Math.max(M,K);K=(v[1]-E-B[1])*C[1];const L=
(v[4]+E-B[1])*C[1];M=Math.min(M,Math.max(K,L));if(0>M)return!1;G=Math.max(G,Math.min(K,L));if(G>M)return!1;K=(v[2]-E-B[2])*C[2];v=(v[5]+E-B[2])*C[2];M=Math.min(M,Math.max(K,v));if(0>M)return!1;G=Math.max(G,Math.min(K,v));return G>M?!1:G<F}function m(v,B){B=B?m(B):{};for(const C in v){let E=v[C];E&&E.forEach&&(E=t(E));null==E&&C in B||(B[C]=E)}return B}function t(v){const B=[];v.forEach(C=>B.push(C));return B}const w=u.create(),r=p.create(),x=p.create(),D=p.create(),A=p.create();a.colorMixModes={multiply:1,
ignore:2,replace:3,tint:4};a.computeInvDir=z;a.computeNormal=h;a.copyParameters=m;a.intersectAabbInvDir=n;a.intersectAabbInvDirBefore=l;a.intersectTriangleGeometry=function(v,B,C,E,F,M){v.visible&&(v.boundingInfo?(d.assert(v.type===q.ContentObjectType.Mesh),g(v.boundingInfo,C,E,B.tolerance,F,M)):(B=v.indices.get(f.VertexAttribute.POSITION),v=v.vertexAttributes.get(f.VertexAttribute.POSITION),e(C,E,0,B.length/3,B,v,void 0,F,M)))};a.intersectTriangles=e;a.updateParameters=function(v,B){let C=!1;for(const E in B){const F=
B[E];void 0!==F&&(Array.isArray(F)?null===v[E]?(v[E]=F.slice(),C=!0):b.update(v[E],F)&&(C=!0):v[E]!==F&&(C=!0,v[E]=F))}return C};a.verticalOffsetAtDistance=function(v,B,C,E,F){let M=(C.screenLength||0)*v.pixelRatio;null!=F&&(M=k.scale(M,E,B,F));return c.clamp(M*Math.tan(.5*v.fovY)/(.5*v.fullHeight)*B,C.minWorldLength||0,null!=C.maxWorldLength?C.maxWorldLength:Infinity)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.factor=new y;this.factorAlignment=new y}),y=b._createClass(function(){this.paddingPixels=this.minPixelSize=this.factor=this.scale=0});a.ScaleFactor=y;a.ScaleInfo=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView",
"../../lib/Util","../../lib/VertexAttribute"],function(a,b,c,y,p){function u(l,m,t,w){const r=t.typedBuffer;t=t.typedBufferStride;const x=l.length;w*=t;for(let D=0;D<x;++D){const A=2*l[D];r[w]=m[A];r[w+1]=m[A+1];w+=t}}function q(l,m,t,w,r){const x=t.typedBuffer;t=t.typedBufferStride;const D=l.length;w*=t;if(null==r||1===r)for(r=0;r<D;++r){var A=3*l[r];x[w]=m[A];x[w+1]=m[A+1];x[w+2]=m[A+2];w+=t}else for(A=0;A<D;++A){const v=3*l[A];for(let B=0;B<r;++B)x[w]=m[v],x[w+1]=m[v+1],x[w+2]=m[v+2],w+=t}}function k(l,
m,t,w,r=1){const x=t.typedBuffer;t=t.typedBufferStride;const D=l.length;w*=t;if(1===r)for(r=0;r<D;++r){var A=4*l[r];x[w]=m[A];x[w+1]=m[A+1];x[w+2]=m[A+2];x[w+3]=m[A+3];w+=t}else for(A=0;A<D;++A){const v=4*l[A];for(let B=0;B<r;++B)x[w]=m[v],x[w+1]=m[v+1],x[w+2]=m[v+2],x[w+3]=m[v+3],w+=t}}function d(l,m,t,w,r,x=1){if(t){var D=w.typedBuffer;w=w.typedBufferStride;var A=l.length,v=t[0],B=t[1],C=t[2],E=t[4],F=t[5],M=t[6],K=t[8],G=t[9],L=t[10],O=t[12],I=t[13],H=t[14];r*=w;var J=0,N=0,R=0;t=b.hasIdentityRotation(t)?
W=>{J=m[W]+O;N=m[W+1]+I;R=m[W+2]+H}:W=>{const T=m[W],P=m[W+1];W=m[W+2];J=v*T+E*P+K*W+O;N=B*T+F*P+G*W+I;R=C*T+M*P+L*W+H};if(1===x)for(x=0;x<A;++x)t(3*l[x]),D[r]=J,D[r+1]=N,D[r+2]=R,r+=w;else for(let W=0;W<A;++W){t(3*l[W]);for(let T=0;T<x;++T)D[r]=J,D[r+1]=N,D[r+2]=R,r+=w}}else q(l,m,w,r,x)}function f(l,m,t,w,r,x=1){if(t){var D=w.typedBuffer;w=w.typedBufferStride;var A=l.length,v=t[0],B=t[1],C=t[2],E=t[4],F=t[5],M=t[6],K=t[8],G=t[9],L=t[10],O=!b.isOrthoNormal(t);r*=w;var I=0,H=0,J=0;t=b.hasIdentityRotation(t)?
R=>{I=m[R];H=m[R+1];J=m[R+2]}:R=>{const W=m[R],T=m[R+1];R=m[R+2];I=v*W+E*T+K*R;H=B*W+F*T+G*R;J=C*W+M*T+L*R};if(1===x)if(O)for(x=0;x<A;++x)t(3*l[x]),O=I*I+H*H+J*J,.999999>O&&1E-6<O?(O=1/Math.sqrt(O),D[r]=I*O,D[r+1]=H*O,D[r+2]=J*O):(D[r]=I,D[r+1]=H,D[r+2]=J),r+=w;else for(x=0;x<A;++x)t(3*l[x]),D[r]=I,D[r+1]=H,D[r+2]=J,r+=w;else for(let R=0;R<A;++R){t(3*l[R]);if(O){var N=I*I+H*H+J*J;.999999>N&&1E-6<N&&(N=1/Math.sqrt(N),I*=N,H*=N,J*=N)}for(N=0;N<x;++N)D[r]=I,D[r+1]=H,D[r+2]=J,r+=w}}else q(l,m,w,r,x)}
function g(l,m,t,w,r,x=1){if(t){var D=w.typedBuffer;w=w.typedBufferStride;var A=l.length,v=t[0],B=t[1],C=t[2],E=t[4],F=t[5],M=t[6],K=t[8],G=t[9],L=t[10];t=!b.isOrthoNormal(t);r*=w;if(1===x)for(x=0;x<A;++x){var O=4*l[x],I=m[O],H=m[O+1],J=m[O+2];O=m[O+3];var N=v*I+E*H+K*J,R=B*I+F*H+G*J;I=C*I+M*H+L*J;t&&(H=N*N+R*R+I*I,.999999>H&&1E-6<H&&(H=1/Math.sqrt(H),N*=H,R*=H,I*=H));D[r]=N;D[r+1]=R;D[r+2]=I;D[r+3]=O;r+=w}else for(O=0;O<A;++O){N=4*l[O];H=m[N];J=m[N+1];const W=m[N+2];N=m[N+3];R=v*H+E*J+K*W;I=B*H+
F*J+G*W;H=C*H+M*J+L*W;t&&(J=R*R+I*I+H*H,.999999>J&&1E-6<J&&(J=1/Math.sqrt(J),R*=J,I*=J,H*=J));for(J=0;J<x;++J)D[r]=R,D[r+1]=I,D[r+2]=H,D[r+3]=N,r+=w}}else k(l,m,w,r,x)}function e(l,m,t,w,r,x=1){var D=w.typedBuffer,A=w.typedBufferStride,v=l.length;r*=A;if(t===m.length&&4===t)for(D[r]=m[0],D[r+1]=m[1],D[r+2]=m[2],D[r+3]=m[3],l=new Uint32Array(w.typedBuffer.buffer,w.start),A/=4,r/=4,m=l[r],r+=A,v*=x,D=1;D<v;++D)l[r]=m,r+=A;else if(1===x)if(4===t)for(x=0;x<v;++x)t=4*l[x],D[r]=m[t],D[r+1]=m[t+1],D[r+2]=
m[t+2],D[r+3]=m[t+3],r+=A;else for(x=0;x<v;++x)t=3*l[x],D[r]=m[t],D[r+1]=m[t+1],D[r+2]=m[t+2],D[r+3]=255,r+=A;else if(4===t)for(t=0;t<v;++t){w=4*l[t];for(var B=0;B<x;++B)D[r]=m[w],D[r+1]=m[w+1],D[r+2]=m[w+2],D[r+3]=m[w+3],r+=A}else for(t=0;t<v;++t)for(w=3*l[t],B=0;B<x;++B)D[r]=m[w],D[r+1]=m[w+1],D[r+2]=m[w+2],D[r+3]=255,r+=A}function h(l,m,t,w){const r=t.typedBuffer;t=t.typedBufferStride;l=l.length;m=m[0];w*=t;for(let x=0;x<l;++x)r[w]=m,w+=t}function z(l,m,t,w,r=1){const x=m.typedBuffer;m=m.typedBufferStride;
w*=m;if(1===r)for(r=0;r<t;++r)x[w]=l[0],x[w+1]=l[1],x[w+2]=l[2],x[w+3]=l[3],w+=m;else for(let D=0;D<t;++D)for(let A=0;A<r;++A)x[w]=l[0],x[w+1]=l[1],x[w+2]=l[2],x[w+3]=l[3],w+=m}function n(l,m,t,w,r,x,D){switch(l){case p.VertexAttribute.POSITION:y.assert(3===m.size);r=x.getField(l,c.BufferViewVec3f);y.assert(!!r,`No buffer view for ${l}`);r&&d(t,m.data,w,r,D);break;case p.VertexAttribute.NORMAL:y.assert(3===m.size);w=x.getField(l,c.BufferViewVec3f);y.assert(!!w,`No buffer view for ${l}`);w&&f(t,m.data,
r,w,D);break;case p.VertexAttribute.NORMALCOMPRESSED:y.assert(2===m.size);r=x.getField(l,c.BufferViewVec2i16);y.assert(!!r,`No buffer view for ${l}`);r&&u(t,m.data,r,D);break;case p.VertexAttribute.UV0:y.assert(2===m.size);r=x.getField(l,c.BufferViewVec2f);y.assert(!!r,`No buffer view for ${l}`);r&&u(t,m.data,r,D);break;case p.VertexAttribute.COLOR:case p.VertexAttribute.SYMBOLCOLOR:r=x.getField(l,c.BufferViewVec4u8);y.assert(!!r,`No buffer view for ${l}`);y.assert(3===m.size||4===m.size);!r||3!==
m.size&&4!==m.size||e(t,m.data,m.size,r,D);break;case p.VertexAttribute.COLORFEATUREATTRIBUTE:r=x.getField(l,c.BufferViewFloat);y.assert(!!r,`No buffer view for ${l}`);y.assert(1===m.size);r&&1===m.size&&h(t,m.data,r,D);break;case p.VertexAttribute.TANGENT:y.assert(4===m.size);w=x.getField(l,c.BufferViewVec4f);y.assert(!!w,`No buffer view for ${l}`);w&&g(t,m.data,r,w,D);break;case p.VertexAttribute.PROFILERIGHT:case p.VertexAttribute.PROFILEUP:case p.VertexAttribute.PROFILEVERTEXANDNORMAL:case p.VertexAttribute.FEATUREVALUE:y.assert(4===
m.size),r=x.getField(l,c.BufferViewVec4f),y.assert(!!r,`No buffer view for ${l}`),r&&k(t,m.data,r,D)}}a.writeBufferFloat=function(l,m,t,w,r=1){const x=t.typedBuffer;t=t.typedBufferStride;const D=l.length;w*=t;if(1===r)for(r=0;r<D;++r)x[w]=m[l[r]],w+=t;else for(let A=0;A<D;++A){const v=m[l[A]];for(let B=0;B<r;B++)x[w]=v,w+=t}};a.writeBufferMat3f=function(l,m,t,w){const r=t.typedBuffer;t=t.typedBufferStride;const x=l.length;w*=t;for(let D=0;D<x;++D){const A=9*l[D];for(let v=0;9>v;++v)r[w+v]=m[A+v];
w+=t}};a.writeBufferMat4f=function(l,m,t,w){const r=t.typedBuffer;t=t.typedBufferStride;const x=l.length;w*=t;for(let D=0;D<x;++D){const A=16*l[D];for(let v=0;16>v;++v)r[w+v]=m[A+v];w+=t}};a.writeBufferVec2=u;a.writeBufferVec3=q;a.writeBufferVec4=k;a.writeBufferVec4Zeros=function(l,m,t){const w=l.typedBuffer;l=l.typedBufferStride;m*=l;for(let r=0;r<t;++r)w[m]=0,w[m+1]=0,w[m+2]=0,w[m+3]=0,m+=l};a.writeColor=e;a.writeColorFeatureAttribute=h;a.writeDefaultAttribute=n;a.writeDefaultAttributes=function(l,
m,t,w,r,x){for(const A of m.fields.keys()){m=l.vertexAttributes.get(A);var D=l.indices.get(A);m&&D?n(A,m,D,t,w,r,x):A===p.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=l.objectAndLayerIdColor&&(m=l.indices.get(p.VertexAttribute.POSITION),y.assert(!!m,`No buffer view for ${A}`),m&&(m=m.length,D=r.getField(A,c.BufferViewVec4u8),z(l.objectAndLayerIdColor,D,m,x)))}};a.writeNormal=f;a.writeObjectAndLayerIdColor=z;a.writePosition=d;a.writeTangent=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/support/engineContent/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){function E(K){const G=new A.ShaderBuilder;var L=K.signedDistanceFieldEnabled;G.include(f.HUD,K);G.include(q.SliceDraw,K);if(K.occlusionPass)return G.include(g.HUDOcclusionPass,K),G;const {vertex:O,fragment:I}=G;G.include(m.ScreenSizePerspective);I.include(l.RgbaFloatEncoding);I.include(n.ColorConversion);G.include(h.VisualVariables,K);G.include(k.ObjectAndLayerIdColor,K);G.varyings.add("vcolor","vec4");G.varyings.add("vtc","vec2");G.varyings.add("vsize",
"vec2");K.binaryHighlightOcclusionEnabled&&G.varyings.add("voccluded","float");O.uniforms.add(new r.Float4PassUniform("viewport",(N,R)=>R.camera.fullViewport),new w.Float2PassUniform("screenOffset",(N,R)=>b.set(M,2*N.screenOffset[0]*R.camera.pixelRatio,2*N.screenOffset[1]*R.camera.pixelRatio)),new w.Float2PassUniform("anchorPosition",N=>F(N)),new r.Float4PassUniform("materialColor",N=>N.color));t.addPixelRatio(O,K);L&&(O.uniforms.add(new r.Float4PassUniform("outlineColor",N=>N.outlineColor)),I.uniforms.add(new r.Float4PassUniform("outlineColor",
N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineColor:y.ZEROS),new x.FloatPassUniform("outlineSize",N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineSize:0)));K.hasScreenSizePerspective&&(m.addScreenSizePerspective(O),m.addScreenSizePerspectiveAlignment(O));(K.debugDrawLabelBorder||K.binaryHighlightOcclusionEnabled)&&G.varyings.add("debugBorderCoords","vec4");G.attributes.add(C.VertexAttribute.UV0,"vec2");G.attributes.add(C.VertexAttribute.COLOR,"vec4");G.attributes.add(C.VertexAttribute.SIZE,"vec2");
G.attributes.add(C.VertexAttribute.AUXPOS2,"vec4");O.code.add(D.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${K.hasScreenSizePerspective?D.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:D.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${K.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${K.occlusionTestEnabled||K.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${K.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var H=D.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;K.pixelSnappingEnabled&&O.include(d.AlignPixel);const J=K.pixelSnappingEnabled?L?D.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:D.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:D.glsl`posProj += quadOffset;`;O.code.add(D.glsl`
    ${K.occlusionTestEnabled?"if (visible) {":""}
    ${H}
    ${K.vvColor?"vcolor \x3d interpolateVVColor(auxpos2.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${K.output===u.ShaderOutput.ObjectAndLayerIdColor?D.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${D.glsl.float(z.symbolAlphaCutoff)};
    ${L?`alphaDiscard = alphaDiscard && outlineColor.a < ${D.glsl.float(z.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${J}
      gl_Position = posProj;
    }

    vtc = uv;

    ${K.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${K.occlusionTestEnabled?D.glsl`} else { vtc = vec2(0.0);
      ${K.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);I.uniforms.add(new v.Texture2DPassUniform("tex",N=>N.texture));H=K.debugDrawLabelBorder?D.glsl`(isBorder > 0.0 ? 0.0 : ${D.glsl.float(z.defaultMaskAlphaCutoff)})`:D.glsl.float(z.defaultMaskAlphaCutoff);L=D.glsl`
    ${K.debugDrawLabelBorder?D.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${L?D.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${D.glsl.float(p.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${H} ||
          fillPixelColor.a + outlinePixelColor.a < ${D.glsl.float(z.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${H}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:D.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${H}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${K.debugDrawLabelBorder?D.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;K.output===u.ShaderOutput.Alpha&&I.code.add(D.glsl`
      void main() {
        ${L}
        fragColor = vec4(fragColor.a);
      }
      `);K.output===u.ShaderOutput.ObjectAndLayerIdColor&&I.code.add(D.glsl`
      void main() {
        ${L}
        outputObjectAndLayerIdColor();
      }
      `);K.output===u.ShaderOutput.Color&&I.code.add(D.glsl`
    void main() {
      ${L}
      ${K.transparencyPassType===B.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
    }
    `);K.output===u.ShaderOutput.Highlight&&(G.include(e.OutputHighlight,K),I.code.add(D.glsl`
    void main() {
      ${L}
      ${K.binaryHighlightOcclusionEnabled?D.glsl`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return G}function F(K,G=M){if(K.textureIsSignedDistanceField){var L=K.anchorPosition;K=K.distanceFieldBoundingBox;null!=K?b.set(G,L[0]*(K[2]-K[0])+K[0],L[1]*(K[3]-K[1])+K[1]):b.set(G,0,0)}else b.copy(G,K.anchorPosition);return G}const M=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:E,calculateAnchorPosForRendering:F},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=c;a.build=E;a.calculateAnchorPosForRendering=F})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,c,y,p){function u(w,r=128,x=.5*r,D=0){switch(w){case "circle":return q(r,x);case "square":return k(r,x);case "cross":return f(r,x,D);case "x":return g(r,x,D);case "kite":return d(r,x);case "triangle":return e(r,x);case "arrow":return h(r,x);default:return q(r,x)}}function q(w,r){const x=w/2-.5;return t(w,l(x,x,r/2))}function k(w,r){return z(w,r,!1)}function d(w,r){return z(w,r,
!0)}function f(w,r,x=0){return n(w,r,!1,x)}function g(w,r,x=0){return n(w,r,!0,x)}function e(w,r){return t(w,m(w/2,r,r/2))}function h(w,r){const x=r/2,D=w/2,A=.8*r,v=l(D,(w-r)/2-A,Math.sqrt(A*A+x*x)),B=m(D,r,x);return t(w,(C,E)=>Math.max(B(C,E),-v(C,E)))}function z(w,r,x){x&&(r/=Math.SQRT2);return t(w,(D,A)=>{D=D-.5*w+.25;A=-A+.5*w-.75;if(x){const v=(D+A)/Math.SQRT2;A=(A-D)/Math.SQRT2;D=v}return Math.max(Math.abs(D),Math.abs(A))-.5*r})}function n(w,r,x,D=0){r-=D;x&&(r*=Math.SQRT2);const A=.5*r;return t(w,
(v,B)=>{v-=.5*w;B=-B+.5*w-1;if(x){const C=(v+B)/Math.SQRT2;B=(B-v)/Math.SQRT2;v=C}v=Math.abs(v);B=Math.abs(B);v=v>B?v>A?Math.sqrt((v-A)*(v-A)+B*B):B:B>A?Math.sqrt(v*v+(B-A)*(B-A)):v;return v-=D/2})}function l(w,r,x){return(D,A)=>{D-=w;A-=r;return Math.sqrt(D*D+A*A)-x}}function m(w,r,x){const D=Math.sqrt(r*r+x*x);return(A,v)=>{v=v-w+r/2+.75;return Math.max((r*(Math.abs(A-w)-x)+x*v)/D,-v)}}function t(w,r){const x=new Uint8Array(4*w*w);for(let D=0;D<w;D++)for(let A=0;A<w;A++){const v=A+w*D;let B=r(A,
D);B=B/w+.5;c.packFloatRGBA(B,x,4*v)}return x}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=h;a.createCircle=q;a.createCross=f;a.createKite=d;a.createPrimitive=u;a.createSquare=k;a.createTexture=function(w,r=128,x=.5*r,D=0){w=u(w,r,x,D);return new y.Texture(w,{mipmap:!1,wrap:{s:p.TextureWrapMode.CLAMP_TO_EDGE,t:p.TextureWrapMode.CLAMP_TO_EDGE},width:r,height:r,components:4,noUnpackFlip:!0})};a.createTriangle=e;a.createX=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(q,k=0){let d=0;for(let f=0;4>f;f++)d+=q[k+f]*p[f];return d}const y=[1,256,65536,16777216],p=[1/256,1/65536,1/16777216,1/4294967296],u=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(q,k,d=0){q=b.clamp(q,0,u);for(let e=0;4>e;e++){var f=Math,g=q*y[e];k[d+e]=f.floor.call(f,256*(g-Math.floor(g)))}};a.unpackFloatRGBA=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){function x(A){return A instanceof HTMLVideoElement?{width:A.videoWidth,height:A.videoHeight}:A}c=function(A){function v(C,E){var F=A.call(this)||this;F._data=C;F.type=n.ContentObjectType.Texture;F._glTexture=null;F._loadingPromise=null;F._loadingController=null;F.events=new p;F.parameters=E||{};F.parameters.mipmap=!1!==F.parameters.mipmap;F.parameters.noUnpackFlip=F.parameters.noUnpackFlip||!1;F.parameters.preMultiplyAlpha=F.parameters.preMultiplyAlpha||
!1;F.parameters.wrap=F.parameters.wrap||{s:t.TextureWrapMode.REPEAT,t:t.TextureWrapMode.REPEAT};F._startPreload(C);return F}b._inherits(v,A);var B=v.prototype;B._startPreload=function(C){null!=C&&(C instanceof HTMLVideoElement?this._startPreloadVideoElement(C):C instanceof HTMLImageElement&&this._startPreloadImageElement(C))};B._startPreloadVideoElement=function(C){if(!(d.isBlobProtocol(C.src)||"auto"===C.preload&&C.crossOrigin)){C.preload="auto";C.crossOrigin="anonymous";const E=!C.paused;C.src=
C.src;if(E&&C.autoplay){const F=()=>{C.removeEventListener("canplay",F);C.play()};C.addEventListener("canplay",F)}}};B._startPreloadImageElement=function(C){d.isDataProtocol(C.src)||d.isBlobProtocol(C.src)||C.crossOrigin||(C.crossOrigin="anonymous",C.src=C.src)};B.dispose=function(){this._data=void 0};B._createDescriptor=function(C){const E=new r.TextureDescriptor;E.wrapMode=this.parameters.wrap??t.TextureWrapMode.REPEAT;E.flipped=!this.parameters.noUnpackFlip;E.samplingMode=this.parameters.mipmap?
t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:t.TextureSamplingMode.LINEAR;E.hasMipmap=!!this.parameters.mipmap;E.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha;E.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?C.parameters.maxMaxAnisotropy:1);return E};B.load=function(C){if(null!=this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const E=this._data;return null==E?this._glTexture=new w.Texture(C,this._createDescriptor(C),null):"string"===
typeof E?this._loadFromURL(C,E):E instanceof Image?this._loadFromImageElement(C,E):E instanceof HTMLVideoElement?this._loadFromVideoElement(C,E):E instanceof ImageData||E instanceof HTMLCanvasElement?this._loadFromImage(C,E):(k.isArrayBuffer(E)||k.isUint8Array(E))&&this.parameters.encoding===e.TextureEncodingMimeType.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(C,E)):(k.isArrayBuffer(E)||k.isUint8Array(E))&&this.parameters.encoding===e.TextureEncodingMimeType.KTX2_ENCODING?(this._data=void 0,
this._loadFromKTX2(C,E)):(k.isArrayBuffer(E)||k.isUint8Array(E))&&this.parameters.encoding===e.TextureEncodingMimeType.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(C,E)):k.isUint8Array(E)?this._loadFromPixelData(C,E):k.isArrayBuffer(E)?this._loadFromPixelData(C,new Uint8Array(E)):null};B.frameUpdate=function(C){if(!(this._data instanceof HTMLVideoElement)||null==this._glTexture||this._data.readyState<D.HAVE_CURRENT_DATA||C===this._data.currentTime)return C;this._glTexture.setData(this._data);
this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this.parameters.updateCallback&&this.parameters.updateCallback();return this._data.currentTime};B._loadFromDDSData=function(C,E){return this._glTexture=l.createDDSTexture(C,this._createDescriptor(C),E)};B._loadFromKTX2=function(C,E){return this._loadAsync(()=>h.createTextureKTX2(C,this._createDescriptor(C),E).then(F=>this._glTexture=F))};B._loadFromBasis=function(C,E){return this._loadAsync(()=>h.createTextureBasis(C,this._createDescriptor(C),
E).then(F=>this._glTexture=F))};B._loadFromPixelData=function(C,E){m.assert(0<this.parameters.width&&0<this.parameters.height);const F=this._createDescriptor(C);F.pixelFormat=1===this.parameters.components?t.PixelFormat.LUMINANCE:3===this.parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;F.width=this.parameters.width??0;F.height=this.parameters.height??0;return this._glTexture=new w.Texture(C,F,E)};B._loadFromURL=function(C,E){return this._loadAsync(async F=>{const M=await f.requestImage(E,
{signal:F});q.throwIfAborted(F);return this._loadFromImage(C,M)})};B._loadFromImageElement=function(C,E){return E.complete?this._loadFromImage(C,E):this._loadAsync(async F=>{const M=await g.loadImageAsync(E,E.src,!1,F);q.throwIfAborted(F);return this._loadFromImage(C,M)})};B._loadFromVideoElement=function(C,E){return E.readyState>=D.HAVE_CURRENT_DATA?this._loadFromImage(C,E):this._loadFromVideoElementAsync(C,E)};B._loadFromVideoElementAsync=function(C,E){return this._loadAsync(F=>new Promise((M,K)=>
{const G=()=>{E.removeEventListener("loadeddata",L);E.removeEventListener("error",O);u.removeMaybe(I)},L=()=>{E.readyState>=D.HAVE_CURRENT_DATA&&(G(),M(this._loadFromImage(C,E)))},O=H=>{G();K(H||new y("Failed to load video"))};E.addEventListener("loadeddata",L);E.addEventListener("error",O);const I=q.onAbort(F,()=>O(q.createAbortError()))}))};B._loadFromImage=function(C,E){const F=x(E);this.parameters.width=F.width;this.parameters.height=F.height;const M=this._createDescriptor(C);M.pixelFormat=3===
this.parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;M.width=F.width;M.height=F.height;return this._glTexture=new w.Texture(C,M,E)};B._loadAsync=function(C){const E=new AbortController;this._loadingController=E;const F=C(E.signal);this._loadingPromise=F;C=()=>{this._loadingController===E&&(this._loadingController=null);this._loadingPromise===F&&(this._loadingPromise=null)};F.then(C,C);return F};B.unload=function(){this._glTexture=u.disposeMaybe(this._glTexture);if(null!=this._loadingController){const C=
this._loadingController;this._loadingPromise=this._loadingController=null;C.abort()}this.events.emit("unloaded")};b._createClass(v,[{key:"glTexture",get:function(){return this._glTexture}},{key:"memoryEstimate",get:function(){var C;if(!(C=this._glTexture?.gpuMemoryUsage)){C=this._data;var E=this.parameters;if(null==C)C=0;else if(k.isArrayBuffer(C)||k.isUint8Array(C))C=E.encoding===e.TextureEncodingMimeType.KTX2_ENCODING?h.estimateMemoryKTX2(C,!!E.mipmap):E.encoding===e.TextureEncodingMimeType.BASIS_ENCODING?
h.estimateMemoryBasis(C,!!E.mipmap):C.byteLength;else{var {width:F,height:M}=C instanceof Image||C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof HTMLVideoElement?x(C):E;C=(E.mipmap?4/3:1)*F*M*(E.components||4)||0}}return C}},{key:"requiresFrameUpdates",get:function(){return this._data instanceof HTMLVideoElement}}]);return v}(z.ContentObject);var D;(function(A){A[A.HAVE_NOTHING=0]="HAVE_NOTHING";A[A.HAVE_METADATA=1]="HAVE_METADATA";A[A.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";
A[A.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";A[A.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(D||(D={}));a.Texture=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,b){a.requestImage=async function(c,y){({data:c}=await b(c,{responseType:"image",...y}));return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u){async function q(){null==h&&(h=b.getBasisTranscoder(),e=await h);return h}function k(z,n,l,m,t){n=u.getBytesPerElementFormat(n?y.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:y.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(l*m*n*(t&&1<z?(4**z-1)/(3*4**(z-1)):1))}function d(z){return 1<=z.getNumImages()&&!z.isUASTC()}function f(z){return 1<=z.getFaces()&&z.isETC1S()}function g(z,n,l,m,t,w,r,x){const {compressedTextureETC:D,compressedTextureS3TC:A}=z.capabilities,
[v,B]=D?m?[c.TextureFormat.ETC2_RGBA,y.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[c.TextureFormat.ETC1_RGB,y.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:A?m?[c.TextureFormat.BC3_RGBA,y.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[c.TextureFormat.BC1_RGB,y.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[c.TextureFormat.RGBA32,y.PixelFormat.RGBA];l=n.hasMipmap?l:Math.min(1,l);m=[];for(let C=0;C<l;C++)m.push(new Uint8Array(r(C,v))),x(C,v,m[C]);n.internalFormat=B;n.hasMipmap=
1<m.length;n.samplingMode=n.hasMipmap?y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:y.TextureSamplingMode.LINEAR;n.width=t;n.height=w;return new p.Texture(z,n,{type:"compressed",levels:m})}let e=null,h=null;a.createTextureBasis=async function(z,n,l){null==e&&(e=await q());const m=new e.BasisFile(new Uint8Array(l));if(!d(m))return null;m.startTranscoding();z=g(z,n,m.getNumLevels(0),m.getHasAlpha(),m.getImageWidth(0,0),m.getImageHeight(0,0),(t,w)=>m.getImageTranscodedSizeInBytes(0,t,w),(t,w,r)=>m.transcodeImage(r,
0,t,w,0,0));m.close();m.delete();return z};a.createTextureKTX2=async function(z,n,l){null==e&&(e=await q());const m=new e.KTX2File(new Uint8Array(l));if(!f(m))return null;m.startTranscoding();z=g(z,n,m.getLevels(),m.getHasAlpha(),m.getWidth(),m.getHeight(),(t,w)=>m.getImageTranscodedSizeInBytes(t,0,0,w),(t,w,r)=>m.transcodeImage(r,t,0,0,w,0,-1,-1));m.close();m.delete();return z};a.estimateMemoryBasis=function(z,n){if(null==e)return z.byteLength;z=new e.BasisFile(new Uint8Array(z));n=d(z)?k(z.getNumLevels(0),
z.getHasAlpha(),z.getImageWidth(0,0),z.getImageHeight(0,0),n):0;z.close();z.delete();return n};a.estimateMemoryKTX2=function(z,n){if(null==e)return z.byteLength;z=new e.KTX2File(new Uint8Array(z));n=f(z)?k(z.getLevels(),z.getHasAlpha(),z.getWidth(),z.getHeight(),n):0;z.close();z.delete();return n};a.loadBasis=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(a,b,c){let y;b.getBasisTranscoder=
function(){if(null==y){const p=u=>c.getAssetUrl(`esri/libs/basisu/${u}`);y=(new Promise((u,q)=>a(["../../chunks/basis_transcoder"],u,q))).then(u=>u.basis_transcoder).then(({default:u})=>u({locateFile:p}).then(q=>{q.initializeBasis();delete q.then;return q}))}return y};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";
b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=
21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,y){function p(g){return g.charCodeAt(0)+(g.charCodeAt(1)<<8)+(g.charCodeAt(2)<<16)+(g.charCodeAt(3)<<24)}function u(g,e){var h=new Int32Array(g,0,31);if(542327876!==
h[0])return q.error("Invalid magic number in DDS header"),null;if(!(h[20]&4))return q.error("Unsupported format, must contain a FourCC code"),null;var z=h[21];let n;switch(z){case k:z=8;n=c.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case d:z=16;n=c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:z=16;n=c.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return q.error("Unsupported FourCC code:",String.fromCharCode(z&255,z>>8&255,z>>16&255,z>>24&
255)),null}let l=1,m=h[4],t=h[3];if(0!==(m&3)||0!==(t&3))q.warn("Rounding up compressed texture size to nearest multiple of 4."),m=m+3&-4,t=t+3&-4;const w=m,r=t;h[2]&131072&&!1!==e&&(l=Math.max(1,h[7]));let x=h[1]+4;const D=[];for(let A=0;A<l;++A)h=(m+3>>2)*(t+3>>2)*z,e=new Uint8Array(g,x,h),D.push(e),x+=h,m=Math.max(1,m>>1),t=Math.max(1,t>>1);return{textureData:{type:"compressed",levels:D},internalFormat:n,width:w,height:r}}const q=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),k=p("DXT1"),
d=p("DXT3"),f=p("DXT5");a.createDDSTexture=function(g,e,h){h=u(h,e.hasMipmap??!1);if(null==h)throw Error("DDS texture data is null");const {textureData:z,internalFormat:n,width:l,height:m}=h;e.samplingMode=1<z.levels.length?c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:c.TextureSamplingMode.LINEAR;e.hasMipmap=1<z.levels.length;e.internalFormat=n;e.width=l;e.height=m;return new y.Texture(g,e,z)};a.createDDSTextureData=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(x,D,...A){if(D.hasSlicePlane){D.hasSliceInVertexProgram&&x.vertex.uniforms.add(...A);x.fragment.uniforms.add(...A);A=d.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var v=d.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;v=D.hasSliceHighlight?d.glsl`
        ${v}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:d.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;D.hasSliceInVertexProgram&&x.vertex.code.add(A);x.fragment.code.add(A);x.fragment.code.add(v)}else A=d.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,D.hasSliceInVertexProgram&&x.vertex.code.add(A),x.fragment.code.add(A)}function g(x,D,A){return x.instancedDoublePrecision?p.set(m,A.camera.viewInverseTransposeMatrix[3],A.camera.viewInverseTransposeMatrix[7],A.camera.viewInverseTransposeMatrix[11]):D.slicePlaneLocalOrigin}function e(x,D){return null!=x?p.subtract(t,D.origin,x):D.origin}function h(x,D,A){return x.hasSliceTranslatedView?null!=D?c.translate(r,A.camera.viewMatrix,D):A.camera.viewMatrix:
null}function z(x,D,A){if(null==A.slicePlane)return u.ZEROS;const v=g(x,D,A);D=e(v,A.slicePlane);x=h(x,v,A);return null!=x?p.transformMat4(t,D,x):D}function n(x,D,A,v){if(null==v||null==A.slicePlane)return u.ZEROS;const B=g(x,D,A);D=e(B,A.slicePlane);x=h(x,B,A);return null!=x?(p.add(w,v,D),p.transformMat4(t,D,x),p.transformMat4(w,w,x),p.subtract(w,w,t)):v}let l=function(x){function D(A){var v=x.call(this)||this;v.slicePlaneLocalOrigin=A;return v}b._inherits(D,x);return b._createClass(D)}(d.NoParameters);
const m=u.create(),t=u.create(),w=u.create(),r=y.create();a.SliceDraw=function(x,D){f(x,D,new q.Float3DrawUniform("slicePlaneOrigin",(A,v)=>z(D,A,v)),new q.Float3DrawUniform("slicePlaneBasis1",(A,v)=>n(D,A,v,v.slicePlane?.basis1)),new q.Float3DrawUniform("slicePlaneBasis2",(A,v)=>n(D,A,v,v.slicePlane?.basis2)))};a.SlicePass=function(x,D){f(x,D,new k.Float3PassUniform("slicePlaneOrigin",(A,v)=>z(D,A,v)),new k.Float3PassUniform("slicePlaneBasis1",(A,v)=>n(D,A,v,v.slicePlane?.basis1)),new k.Float3PassUniform("slicePlaneBasis2",
(A,v)=>n(D,A,v,v.slicePlane?.basis2)))};a.SlicePlaneParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,y){a.ObjectAndLayerIdColor=function(p,u){const q=u.output===b.ShaderOutput.ObjectAndLayerIdColor;u=u.objectAndLayerIdColorInstanced;q&&(p.varyings.add("objectAndLayerIdColorVarying",
"vec4"),u?p.attributes.add(y.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):p.attributes.add(y.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));p.vertex.code.add(c.glsl`
     void forwardObjectAndLayerIdColor() {
      ${q?u?c.glsl`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:c.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:c.glsl``} }`);p.fragment.code.add(c.glsl`
      void outputObjectAndLayerIdColor() {
        ${q?c.glsl`fragColor = objectAndLayerIdColorVarying;`:c.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ./AlignPixel.glsl ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,y,p,
u,q,k){a.HUDOcclusionPass=function(d,f){const {vertex:g,fragment:e}=d;g.include(b.AlignPixel);f.hasMultipassGeometry&&g.include(y.multipassGeometryTest);f.hasMultipassTerrain&&d.varyings.add("depth","float");g.code.add(q.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${f.hasMultipassGeometry?q.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${f.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);f.hasMultipassTerrain&&e.include(c.ReadLinearDepth);f.hasMultipassTerrain&&e.uniforms.add(new k.Texture2DPassUniform("terrainDepthTexture",(h,z)=>z.multipassTerrain.linearDepthTexture),new u.Float2PassUniform("nearFar",(h,z)=>z.camera.nearFar));e.include(p.RgbaFloatEncoding);e.code.add(q.glsl`
  void main() {
    fragColor = vec4(1);
    ${f.hasMultipassTerrain?q.glsl`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,y){const p=b.fromValues(1,1,0,1),u=b.fromValues(1,0,1,1);a.OutputHighlight=function(q){q.fragment.uniforms.add(new y.Texture2DPassUniform("depthTexture",(k,d)=>d.highlightDepthTexture));q.fragment.constants.add("occludedHighlightFlag",
"vec4",p).add("unoccludedHighlightFlag","vec4",u);q.fragment.code.add(c.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};a.occludedHighlightFlag=p;a.unoccludedHighlightFlag=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,y,p,u,q,k){a.VisualVariables=function(d,f){const {vertex:g,attributes:e}=d;f.hasVvInstancing&&(f.vvSize||f.vvColor)&&e.add(q.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");f.vvSize?(g.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",h=>h.vvSize.minSize)),g.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",h=>h.vvSize.maxSize)),g.uniforms.add(new b.Float3PassUniform("vvSizeOffset",h=>h.vvSize.offset)),g.uniforms.add(new b.Float3PassUniform("vvSizeFactor",h=>h.vvSize.factor)),
g.uniforms.add(new u.Matrix3PassUniform("vvSymbolRotationMatrix",h=>h.vvSymbolRotationMatrix)),g.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",h=>h.vvSymbolAnchor)),g.code.add(p.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),g.code.add(p.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${f.hasVvInstancing?p.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):g.code.add(p.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);f.vvColor?(g.constants.add("vvColorNumber","int",k.vvColorNumber),g.uniforms.add(new y.FloatsPassUniform("vvColorValues",h=>h.vvColor.values,k.vvColorNumber),new c.Float4sPassUniform("vvColorColors",h=>h.vvColor.colors,k.vvColorNumber)),g.code.add(p.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${f.hasVvInstancing?p.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):g.code.add(p.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k,d){return p.call(this,q,"vec4",y.BindType.Pass,(f,g,e)=>f.setUniform4fv(q,k(g,e)),d)||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);
a.Float4sPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k,d){return p.call(this,q,"float",y.BindType.Pass,(f,g,e)=>f.setUniform1fv(q,k(g,e)),d)||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.FloatsPassUniform=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,c,y){c=function(p){function u(){var q=p.apply(this,arguments)||this;q.renderOccluded=y.RenderOccludedFlag.Occlude;return q}b._inherits(u,p);return b._createClass(u)}(c.VisualVariablesParameters);a.VisualVariablePassParameters=c;a.vvColorNumber=
8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(P){return null!==P&&void 0!==P}function n(P){return"number"===typeof P}function l(P){return"string"===typeof P}function m(P,Q){P&&P.push(Q)}function t(P,Q,S,U=k.create()){P=P||0;Q=Q||0;S=S||0;0!==P&&q.rotateZ(U,U,-P/180*Math.PI);0!==Q&&q.rotateX(U,U,Q/180*Math.PI);0!==S&&q.rotateY(U,U,S/180*Math.PI);return U}function w(P,Q,S,U,V){const X=P.minSize,Y=P.maxSize;if(P.expression)return m(V,"Could not convert size info: expression not supported"),!1;if(P.useSymbolValue)return P=
U.symbolSize[S],Q.minSize[S]=P,Q.maxSize[S]=P,Q.offset[S]=Q.minSize[S],Q.factor[S]=0,Q.type[S]=a.FastSizeType.DefinedSize,!0;if(z(P.field)){if(z(P.stops)){if(2===P.stops.length&&n(P.stops[0].size)&&n(P.stops[1].size))return r(P.stops[0].size,P.stops[1].size,P.stops[0].value,P.stops[1].value,Q,S),Q.type[S]=a.FastSizeType.DefinedSize,!0;m(V,"Could not convert size info: stops only supported with 2 elements");return!1}if(n(X)&&n(Y)&&z(P.minDataValue)&&z(P.maxDataValue))return r(X,Y,P.minDataValue,P.maxDataValue,
Q,S),Q.type[S]=a.FastSizeType.DefinedSize,!0;if("unknown"===P.valueUnit)return m(V,"Could not convert size info: proportional size not supported"),!1;if(null!=g.meterIn[P.valueUnit])return Q.minSize[S]=-Infinity,Q.maxSize[S]=Infinity,Q.offset[S]=0,Q.factor[S]=1/g.meterIn[P.valueUnit],Q.type[S]=a.FastSizeType.DefinedSize,!0;m(V,"Could not convert size info: scale-dependent size not supported");return!1}if(!z(P.field)){if(P.stops&&P.stops[0]&&n(P.stops[0].size))return Q.minSize[S]=P.stops[0].size,Q.maxSize[S]=
P.stops[0].size,Q.offset[S]=Q.minSize[S],Q.factor[S]=0,Q.type[S]=a.FastSizeType.DefinedSize,!0;if(n(X))return Q.minSize[S]=X,Q.maxSize[S]=X,Q.offset[S]=X,Q.factor[S]=0,Q.type[S]=a.FastSizeType.DefinedSize,!0}m(V,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(P,Q,S,U,V,X){U=0<Math.abs(U-S)?(Q-P)/(U-S):0;V.minSize[X]=0<U?P:Q;V.maxSize[X]=0<U?Q:P;V.offset[X]=P-S*U;V.factor[X]=U}function x(P,Q,S,U){if(P.normalizationField||P.valueRepresentation)return m(U,"Could not convert size info: unsupported property"),
null;var V=P.field;if(null!=V&&!l(V))return m(U,"Could not convert size info: field is not a string"),null;if(!Q.size)Q.size=new G(P.field);else if(P.field)if(!Q.size.field)Q.size.field=P.field;else if(P.field!==Q.size.field)return m(U,"Could not convert size info: multiple fields in use"),null;switch(P.axis){case "width":return(V=w(P,Q.size,0,S,U))?Q:null;case "height":return(V=w(P,Q.size,2,S,U))?Q:null;case "depth":return(V=w(P,Q.size,1,S,U))?Q:null;case "width-and-depth":return(V=w(P,Q.size,0,
S,U))&&w(P,Q.size,1,S,U),V?Q:null;case null:case void 0:case "all":return(V=(V=(V=w(P,Q.size,0,S,U))&&w(P,Q.size,1,S,U))&&w(P,Q.size,2,S,U))?Q:null;default:return m(U,`Could not convert size info: unknown axis "${P.axis}""`),null}}function D(P,Q,S){for(let U=0;3>U;++U){let V=Q.unitInMeters;P.type[U]===a.FastSizeType.DefinedSize&&(V*=Q.modelSize[U],P.type[U]=a.FastSizeType.DefinedScale);P.minSize[U]/=V;P.maxSize[U]/=V;P.offset[U]/=V;P.factor[U]/=V}if(P.type[0]!==a.FastSizeType.Undefined)Q=0;else if(P.type[1]!==
a.FastSizeType.Undefined)Q=1;else if(P.type[2]!==a.FastSizeType.Undefined)Q=2;else return m(S,"No size axis contains a valid size or scale"),!1;for(S=0;3>S;++S)P.type[S]===a.FastSizeType.Undefined&&(P.minSize[S]=P.minSize[Q],P.maxSize[S]=P.maxSize[Q],P.offset[S]=P.offset[Q],P.factor[S]=P.factor[Q],P.type[S]=P.type[Q]);return!0}function A(P,Q,S){P[4*Q]=S.r/255;P[4*Q+1]=S.g/255;P[4*Q+2]=S.b/255;P[4*Q+3]=S.a}function v(P,Q,S){if(P.normalizationField)return m(S,"Could not convert color info: unsupported property"),
null;if(l(P.field))if(P.stops){if(8<P.stops.length)return m(S,"Could not convert color info: too many color stops"),null;Q.color=new L(P.field);P=P.stops;for(S=0;8>S;++S){const U=P[Math.min(S,P.length-1)];Q.color.values[S]=U.value;A(Q.color.colors,S,U.color)}}else return m(S,"Could not convert color info: missing stops or colors"),null;else if(P.stops&&0<=P.stops.length)for(P=P.stops&&0<=P.stops.length&&P.stops[0].color,Q.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},S=0;8>S;S++)Q.color.values[S]=Infinity,A(Q.color.colors,S,P);else return m(S,"Could not convert color info: no field and no colors/stops"),null;return Q}function B(P,Q,S){if(P.normalizationField)return m(S,"Could not convert opacity info: unsupported property"),null;if(l(P.field))if(P.stops){if(8<P.stops.length)return m(S,"Could not convert opacity info: too many opacity stops"),null;Q.opacity=new O(P.field);P=P.stops;for(S=0;8>S;++S){const U=P[Math.min(S,
P.length-1)];Q.opacity.values[S]=U.value;Q.opacity.opacityValues[S]=U.opacity}}else return m(S,"Could not convert opacity info: missing stops or opacities"),null;else if(P.stops&&0<=P.stops.length)for(P=P.stops&&0<=P.stops.length?P.stops[0].opacity:0,Q.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},S=0;8>S;S++)Q.opacity.values[S]=Infinity,Q.opacity.opacityValues[S]=P;else return m(S,"Could not convert opacity info: no field and no opacities/stops"),null;return Q}function C(P,
Q,S){P=2===S&&"arithmetic"===P.rotationType;Q.offset[S]=P?90:0;Q.factor[S]=P?-1:1;Q.type[S]=1}function E(P,Q,S){if(!l(P.field))return m(S,"Could not convert rotation info: field is not a string"),null;if(!Q.rotation)Q.rotation={field:P.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(P.field)if(!Q.rotation.field)Q.rotation.field=P.field;else if(P.field!==Q.rotation.field)return m(S,"Could not convert rotation info: multiple fields in use"),null;switch(P.axis){case "tilt":return C(P,Q.rotation,
0),Q;case "roll":return C(P,Q.rotation,1),Q;case null:case void 0:case "heading":return C(P,Q.rotation,2),Q;default:return m(S,`Could not convert rotation info: unknown axis "${P.axis}""`),null}}function F(P,Q,S){if(!P)return null;const U=P.reduce((V,X)=>{if(!V)return V;if(X.valueExpression)return m(S,"Could not convert visual variables: arcade expressions not supported"),null;switch(X.type){case "size":return Q.supports.size?x(X,V,Q,S):V;case "color":return Q.supports.color?v(X,V,S):V;case "opacity":return Q.supports.opacity?
B(X,V,S):null;case "rotation":return Q.supports.rotation?E(X,V,S):V;default:return null}},new I);return 0<P.length&&U&&!U.size&&!U.color&&!U.opacity&&!U.rotation||U&&U.size&&!D(U.size,Q,S)?null:U}function M(P,Q,S){if(!!P!==!!Q||P&&P.field!==Q?.field)return!1;if(P&&"rotation"===S)for(S=0;3>S;S++)if(P.type[S]!==Q.type[S]||P.offset[S]!==Q.offset[S]||P.factor[S]!==Q.factor[S])return!1;return!0}function K(P,Q){P=new N(P);P.vvSize&&(P.vvSymbolAnchor=Q.anchor,q.identity(T),t(Q.rotation[2],Q.rotation[0],
Q.rotation[1],T),P.vvSymbolRotationMatrix=P.vvSymbolRotationMatrix||u.create(),p.fromMat4(P.vvSymbolRotationMatrix,T));return P}a.FastSizeType=void 0;(function(P){P[P.Undefined=0]="Undefined";P[P.DefinedSize=1]="DefinedSize";P[P.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(P){P[P.Undefined=0]="Undefined";P[P.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));c=b._createClass(function(P){this.field=P});let G=function(P){function Q(S){S=
P.call(this,S)||this;S.minSize=[0,0,0];S.maxSize=[0,0,0];S.offset=[0,0,0];S.factor=[0,0,0];S.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined];return S}b._inherits(Q,P);return b._createClass(Q)}(c),L=function(P){function Q(S){S=P.call(this,S)||this;S.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];S.values=[0,0,0,0,0,0,0,0];return S}b._inherits(Q,P);return b._createClass(Q)}(c),O=function(P){function Q(S){S=P.call(this,S)||this;S.values=[0,
0,0,0,0,0,0,0];S.opacityValues=[0,0,0,0,0,0,0,0];return S}b._inherits(Q,P);return b._createClass(Q)}(c);c=function(P){function Q(S){S=P.call(this,S)||this;S.offset=[0,0,0];S.factor=[1,1,1];S.type=[0,0,0];return S}b._inherits(Q,P);return b._createClass(Q)}(c);let I=b._createClass(function(){}),H=b._createClass(function(P,Q=[1,1,1],S=[1,1,1],U=1,V=[0,0,0],X=[1,1,1],Y=[0,0,0]){this.supports=P;this.modelSize=Q;this.symbolSize=S;this.unitInMeters=U;this.anchor=V;this.scale=X;this.rotation=Y}),J=b._createClass(function(P,
Q,S){this.visualVariables=P;this.materialParameters=Q;this.requiresShaderTransformation=S}),N=function(P){function Q(S){var U=P.call(this)||this;U.vvSize=S?.size??null;U.vvColor=S?.color??null;U.vvOpacity=S?.opacity??null;return U}b._inherits(Q,P);return b._createClass(Q)}(h.NoParameters);const R=k.create(),W=f.create(),T=k.create();a.ConvertOptions=H;a.FastColorInfo=L;a.FastOpacityInfo=O;a.FastRotationInfo=c;a.FastSizeInfo=G;a.FastSymbolUpdatesState=J;a.FastVisualVariables=I;a.VisualVariablesParameters=
N;a.convertVisualVariables=F;a.evaluateModelTransform=function(P,Q,S){if(!P.vvSize)return S;q.copy(R,S);S=P.vvSymbolRotationMatrix;q.set(T,S[0],S[1],S[2],0,S[3],S[4],S[5],0,S[6],S[7],S[8],0,0,0,0,1);q.multiply(R,R,T);for(S=0;3>S;++S)W[S]=y.clamp(P.vvSize.offset[S]+Q[0]*P.vvSize.factor[S],P.vvSize.minSize[S],P.vvSize.maxSize[S]);q.scale(R,R,W);q.translate(R,R,P.vvSymbolAnchor);return R};a.evaluateModelTransformScale=function(P,Q,S){if(Q.vvSize)for(let U=0;3>U;++U)P[U]=y.clamp(Q.vvSize.offset[U]+S[0]*
Q.vvSize.factor[U],Q.vvSize.minSize[U],Q.vvSize.maxSize[U]);else d.set(P,1,1,1)};a.getAttributeValue=function(P,Q){P=null==P?0:Q.attributes[P];return"number"===typeof P&&isFinite(P)?P:0};a.getMaterialParameters=K;a.initFastSymbolUpdatesState=function(P,Q){return!P||e.TESTS_DISABLE_FAST_UPDATES?null:(P=F(P.visualVariables,Q))?new J(P,K(P,Q),!!P.size):null};a.updateFastSymbolUpdatesState=function(P,Q,S){if(!Q||!P)return!1;const U=P.visualVariables;Q=F(Q.visualVariables,S);if(!(Q&&M(U.size,Q.size,"size")&&
M(U.color,Q.color,"color")&&M(U.rotation,Q.rotation,"rotation")&&M(U.opacity,Q.opacity,"opacity")))return!1;P.visualVariables=Q;P.materialParameters=K(Q,S);P.requiresShaderTransformation=!!Q.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){q=function(m){function t(){return m.apply(this,arguments)||this}c._inherits(t,m);var w=t.prototype;w.initializeConfiguration=function(r,x){x.spherical=r.viewingMode===y.ViewingMode.Global};w.initializeProgram=function(r){return new f.Program(r.rctx,t.shader.get().build(this.configuration),k.Default3D)};w._setPipelineState=function(r){const x=this.configuration,D=r===g.TransparencyPassType.NONE;var A=r===g.TransparencyPassType.FrontFace;const v=this.configuration.hasPolygonOffset?
n:null;A=(D||A)&&x.output!==p.ShaderOutput.Highlight?x.depthEnabled||x.occlusionPass?z.defaultDepthWriteParams:null:null;return z.makePipelineState({blending:x.output===p.ShaderOutput.Color||x.output===p.ShaderOutput.Alpha||x.output===p.ShaderOutput.Highlight?D?l:d.oitBlending(r):null,depthTest:{func:h.CompareFunction.LEQUAL},depthWrite:A,colorWrite:z.defaultColorWriteParams,polygonOffset:v})};w.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
c._createClass(t,[{key:"primitiveType",get:function(){return this.configuration.occlusionPass?h.PrimitiveType.POINTS:h.PrimitiveType.TRIANGLES}}]);return t}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(e.HUDMaterial,()=>new Promise((m,t)=>a(["./HUDMaterial.glsl"],m,t)));const n={factor:0,units:-4},l=z.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports",
"./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,y){const p=y.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),u=y.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),q=y.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),k={factor:-1,units:-2};a.OITPolygonOffset=k;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=q;a.blendingColor=u;a.blendingDefault=
p;a.getOITPolygonOffset=function(d){return d?k:null};a.oitBlending=function(d){return d===b.TransparencyPassType.FrontFace?null:d===b.TransparencyPassType.Alpha?q:u};a.oitDepthTest=function(d,f=c.CompareFunction.LESS){return d===b.TransparencyPassType.NONE||d===b.TransparencyPassType.FrontFace?f:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(d){return d===b.TransparencyPassType.FrontFace?y.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k){k=function(d){function f(){var g=d.apply(this,arguments)||this;g.output=y.ShaderOutput.Color;g.screenCenterOffsetUnitsEnabled=p.HUDSpace.World;g.transparencyPassType=q.TransparencyPassType.NONE;g.spherical=!1;g.occlusionTestEnabled=!0;g.signedDistanceFieldEnabled=!1;g.vvSize=!1;g.vvColor=!1;g.hasVerticalOffset=!1;g.hasScreenSizePerspective=!1;g.debugDrawLabelBorder=!1;g.binaryHighlightOcclusionEnabled=!0;g.hasSlicePlane=!1;g.hasPolygonOffset=!1;g.depthEnabled=!0;g.pixelSnappingEnabled=
!0;g.draped=!1;g.hasMultipassGeometry=!1;g.hasMultipassTerrain=!1;g.cullAboveGround=!1;g.occlusionPass=!1;g.objectAndLayerIdColorInstanced=!1;return g}b._inherits(f,d);return b._createClass(f)}(k.DefaultTechniqueConfiguration);c.__decorate([u.parameter({count:y.ShaderOutput.COUNT})],k.prototype,"output",void 0);c.__decorate([u.parameter({count:p.HUDSpace.COUNT})],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);c.__decorate([u.parameter({count:q.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",
void 0);c.__decorate([u.parameter()],k.prototype,"spherical",void 0);c.__decorate([u.parameter()],k.prototype,"occlusionTestEnabled",void 0);c.__decorate([u.parameter()],k.prototype,"signedDistanceFieldEnabled",void 0);c.__decorate([u.parameter()],k.prototype,"vvSize",void 0);c.__decorate([u.parameter()],k.prototype,"vvColor",void 0);c.__decorate([u.parameter()],k.prototype,"hasVerticalOffset",void 0);c.__decorate([u.parameter()],k.prototype,"hasScreenSizePerspective",void 0);c.__decorate([u.parameter()],
k.prototype,"debugDrawLabelBorder",void 0);c.__decorate([u.parameter()],k.prototype,"binaryHighlightOcclusionEnabled",void 0);c.__decorate([u.parameter()],k.prototype,"hasSlicePlane",void 0);c.__decorate([u.parameter()],k.prototype,"hasPolygonOffset",void 0);c.__decorate([u.parameter()],k.prototype,"depthEnabled",void 0);c.__decorate([u.parameter()],k.prototype,"pixelSnappingEnabled",void 0);c.__decorate([u.parameter()],k.prototype,"draped",void 0);c.__decorate([u.parameter()],k.prototype,"hasMultipassGeometry",
void 0);c.__decorate([u.parameter()],k.prototype,"hasMultipassTerrain",void 0);c.__decorate([u.parameter()],k.prototype,"cullAboveGround",void 0);c.__decorate([u.parameter()],k.prototype,"occlusionPass",void 0);c.__decorate([u.parameter()],k.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([u.parameter({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([u.parameter({constValue:!1})],k.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.LabelDeconflictor=function(h){function z(l){l=h.call(this,l)||this;l.visibilityGroup=f.VisibilityGroup.LABEL;l.iconMarginFactor=0;l._lastDeconfliction=0;return l}b._inherits(z,h);var n=z.prototype;n.runTask=function(l){if(this.parent.running)return e.Task.YIELD;const m=performance.now();if(l.state!==g.RenderState.IDLE&&2E3>m-this._lastDeconfliction)return e.Task.YIELD;b._get(b._getPrototypeOf(z.prototype),"runTask",this).call(this,l);this.state===d.State.Idle&&
(this._lastDeconfliction=m)};n.enabledChanged=function(l,m){this.modifyGraphics(m,l.labelsEnabled)};n.getGraphicsLayers=function(l){return l.labelLayers};b._createClass(z,[{key:"viewState",get:function(){return this.parent.viewState}}]);return z}(d.Deconflictor);c.__decorate([y.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([k.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L){function O(R){return!0===R.labelsVisible&&!!R.labelingInfo?.some(W=>!!W.symbol)}let I=b._createClass(function(R,W){this.labelingContext=R;this.graphics3DGraphic=W;this.textInitialized=this.rendered=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}),H=b._createClass(function(R,W,T,P,Q){this.labelClass=R;this.graphics3DSymbol=W;this.graphics3DCalloutSymbolLayer=T;this.textRenderParameters=
P;this.labelFunction=Q;this.calloutSymbolLayerIndex=0}),J=function(){function R(W,T,P,Q,S,U,V,X){this.layer=T;this.graphics3DCore=P;this.scaleVisibility=Q;this.emptySymbolLabelSupported=S;this.elevationInfoOverride=U;this.disablePlacement=V;this.active=X;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new G.WebGLLayer(W,{pickable:!0,disableOctree:!0},T.uid)}R.prototype.destroy=function(){this.stageLayer.destroy()};
return b._createClass(R)}();a.Labeler=function(R){function W(P){P=R.call(this,P)||this;P._dirty=!1;P._labels=new Map;P._labelsToAdd=new Map;P._labelsToRemove=new Map;P._labelingContexts=[];return P}b._inherits(W,R);var T=W.prototype;T.setup=function(){this.dispose();this._handles=new u;this._handles.add([g.watch(()=>this.view.state?.camera,()=>this.setDirty()),g.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(L.TaskPriority.LABELER,
this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new E.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new E.MaterialCollection(this.view._stage)};T.dispose=function(){this._handles=d.destroyMaybe(this._handles);this._textTextureAtlas=d.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=d.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=d.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=
0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};T.destroy=function(){this.dispose();N.graphic=null;N.renderingInfo=null;N.layer=null};T._activateLabelingContext=function(P){P.graphics.forEach((Q,S)=>{const U=new I(P,Q);this._labels.set(S,U);P.labelsToInitialize.set(S,U);Q.setVisibilityFlag(x.VisibilityGroup.LABEL,x.VisibilityFlag.USER,!0)});P.active=!0};T._deactivateLabelingContext=function(P){P.graphics.forEach((Q,S)=>{Q.setVisibilityFlag(x.VisibilityGroup.LABEL,x.VisibilityFlag.USER,
!1);this.setLabelGraphicVisibility(Q,!1);this._labels.delete(S)});P.active=!1};T._addLabelTextureToAtlas=function(P){for(const Q of P.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const S=P.textRenderers[Q._labelIndex];S&&this._textTextureAtlas.addTextTexture(S,Q.stageObject)}P.rendered=!0};T._removeLabelTextureFromAtlas=function(P){for(const Q of P.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const S=P.textRenderers[Q._labelIndex];null!=S&&this._textTextureAtlas.removeTextTexture(S,
Q.stageObject)}P.rendered=!1};T.runTask=function(P){this._updateLabels(P);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(P);return L.Task.YIELD};T._updateLabels=function(P){if(this._dirty){this._dirty=!1;for(const Q of this._labelingContexts)if(Q.active){if(!Q.labelClassContexts||!Q.labelClassContexts.length){if(null===Q.labelClassContexts){this._deactivateLabelingContext(Q);continue}this._createLabelClassContext(Q);if(Q.labelClassPromise&&Q.labelClassAbortController){this._dirty=
!0;continue}if(!Q.labelClassContexts||!Q.labelClassContexts.length)continue}k.someMap(Q.labelsToInitialize,(S,U)=>{this._ensureGraphics3DResources(S)&&(this._labels.set(U,S),this.deconflictor.setDirty(),P.madeProgress());if(S.visible&&S.textInitialized||!S.visible&&S.hasGraphics3DResources)Q.labelsToInitialize.delete(U),P.madeProgress();return P.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(Q=>this._removeLabelTextureFromAtlas(Q));this._labelsToAdd.forEach(Q=>this._addLabelTextureToAtlas(Q));
this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};T._createLabelClassContextAsync=async function(P){const Q=P.labelClassAbortController?.signal;await P.layer.when?.();f.throwIfAborted(Q);P.scaleVisibility&&P.scaleVisibility.updateScaleRangeActive();const S=P.graphics3DCore;var U=S.layer;(U=U.labelingInfo&&U.labelingInfo.filter(V=>!!V.symbol))&&0!==U.length&&(await p.forEach(U,async(V,X)=>{var Y=V.symbol;const Z=v.getGraphics3DSymbol(S.getOrCreateGraphics3DSymbol(Y));
if(null==Z)q.getLogger(this).error("Failed to create Graphics3DSymbol for label");else{await Z.load();f.throwIfAborted(Q);var ea=null;w.hasCalloutSupport(Y)&&Y.hasVisibleCallout()&&(ea=D.make(Y,S.symbolCreationContext),await ea.load(),f.throwIfAborted(Q));Y=await p.result(t.createLabelFunction(V,P.layer.fieldsIndex,this.view.spatialReference));f.throwIfAborted(Q);if(!0===Y.ok){const ja=await this._createTextRenderParameters(Z.symbol);f.throwIfAborted(Q);P.labelClassContexts[X]=new H(V,Z,ea,ja,Y.value)}else q.getLogger(this).error(`Label expression failed to evaluate: ${Y.error}`)}}),
f.throwIfAborted(Q))};T._createLabelClassContext=async function(P){null==P.labelClassPromise&&(P.labelClassPromise=this._createLabelClassContextAsync(P).catch(Q=>{if(f.isAbortError(Q))throw Q;P.labelClassContexts.length=0}).then(()=>{P.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return P.labelClassPromise};T._createTextRenderParameters=async function(P){P=P.symbolLayers.at(0);return"text"!==P?.type?null:M.TextRenderParameters.fromSymbol(P,
this.view.state.rasterPixelRatio)};T._destroyLabelClassContext=function(P){for(var Q of P.labelClassContexts)--Q.graphics3DSymbol.referenced;Q=P.labelClassAbortController;P.labelClassAbortController=new AbortController;d.abortMaybe(Q);P.labelClassContexts.length=0;P.labelClassPromise=null;this.notifyChange("updating")};T._createTextSymbolGraphic=function(P,Q,S,U,V){P=new r.CreateLabelParameters(S.verticalOffset,C.horizontalPlacementFromAnchor(S.anchor),C.verticalPlacementFromAnchor(S.anchor),P.text,
S.translation,S.elevationOffset,S.centerOffset,S.screenOffset,S.centerOffsetUnits,P.displayWidth,P.displayHeight);N.graphic=Q;N.renderingInfo=null;N.layer=U;return V.createLabel(N,P,this._hudMaterialCollection,this._textTextureAtlas)};T._createLineCalloutGraphic=function(P,Q,S,U,V){N.graphic=P;N.layer=V;N.renderingInfo=new A.LineCalloutSymbolLayerRenderingInfo(null,Q,U.translation,U.centerOffset,U.screenOffset,U.centerOffsetUnits,U.elevationOffset,this._calloutMaterialCollection);return S.createGraphics3DGraphic(N)};
T._ensureGraphics3DResources=function(P){if(P.hasGraphics3DResources)return!1;const Q=P.graphics3DGraphic;if(Q.destroyed)return!1;this._ensureTextTextureResources(P);const S=P.labelingContext,U=S.labelClassContexts;if(!U||0===U.length||!S.emptySymbolLabelSupported&&0===Q.layers.length)return!1;var V=!1,X=Q.graphic;const Y=S.layer;var Z=O(S.layer);for(let ja=0;ja<U.length;ja++){const ha=P.textRenderers[ja],ia=P.textLabelPlacements[ja];if(null==ha||null==ia)continue;const oa=U[ja];var ea=oa.graphics3DSymbol;
const ma=ea.symbol&&"label-3d"===ea.symbol.type?ea.symbol:null;if(ea=ea.symbolLayers[0]){ea.setElevationInfoOverride(S.elevationInfoOverride);V=this._createTextSymbolGraphic(ha,X,ia,Y,ea);if(null==V)return!1;V._labelClass=oa.labelClass;V._labelIndex=ja;Q.addLabelGraphic(V,S.stageLayer);Q.deconflictionPriority=oa.textRenderParameters?.definition.size??0;Q.setVisibilityFlag(x.VisibilityGroup.LABEL,x.VisibilityFlag.USER,Z);Q.setVisibilityFlag(x.VisibilityGroup.LABEL,x.VisibilityFlag.SCALE_RANGE,!0);
Q.setVisibilityFlag(x.VisibilityGroup.LABEL,x.VisibilityFlag.DECONFLICTION,!1);V=!0;(Z=oa.graphics3DCalloutSymbolLayer)&&ia.hasLabelVerticalOffset&&(Z.setElevationInfoOverride(S.elevationInfoOverride),X=this._createLineCalloutGraphic(X,ma,Z,ia,Y),null!=X&&(oa.calloutSymbolLayerIndex=Q.labelLayers.length,Q.addLabelGraphic(X,S.stageLayer)));break}}S.scaleVisibility&&V&&S.scaleVisibility.updateGraphicLabelScaleVisibility(Q);return P.hasGraphics3DResources=!0};T._destroyGraphics3DResources=function(P){const Q=
P.labelingContext.labelClassContexts;for(const S of P.graphics3DGraphic.labelLayers){if(null==S._labelClass)continue;const U=Q[S._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=U)U.onRemoveGraphic(S)}P.graphics3DGraphic.deconflictionPriority=0;P.graphics3DGraphic.clearLabelGraphics();P.hasGraphics3DResources=!1};T._ensureTextTextureResources=function(P){if(!P.textInitialized){var Q=P.labelingContext,S=Q.labelClassContexts;if(S&&0!==S.length){var U=P.graphics3DGraphic.graphic;for(let Y=0;Y<
S.length;Y++){const Z=S[Y];P.textRenderers[Y]=null;P.textLabelPlacements[Y]=null;if(null==Z?.textRenderParameters)continue;var V=Z.labelFunction;let ea;if("arcade"===V.type)try{const ja=V.needsHydrationToEvaluate()?m.hydrateGraphic(U,Q.layer):U;ea=V.evaluate(ja)}catch(ja){ea=null}else ea=V.evaluate(U);if(null!=ea&&""!==ea&&!/^\s+$/.test(ea)&&(V=Z.graphics3DSymbol,V.symbolLayers[0]&&(V=B.get({graphics3DGraphic:P.graphics3DGraphic,labelSymbol:"label-3d"===V.symbol?.type?V.symbol:null,labelClass:Z.labelClass,
disablePlacement:Q.disablePlacement}),null!=V))){var X=C.horizontalPlacementFromAnchor(V.anchor);X=C.textRenderAlignmentFromHorizontalPlacement(X);P.textRenderers[Y]=new F.TextRenderer(ea,X,Z.textRenderParameters);P.textLabelPlacements[Y]=V}}P.textInitialized=!0}}};T._destroyTextTextureResources=function(P){P.textInitialized=!1;P.textRenderers.length=0;P.textLabelPlacements.length=0};T._addGraphic=function(P,Q){const S=Q.graphic.uid;P.graphics.set(S,Q);P.active&&(Q=new I(P,Q),this._labels.set(S,Q),
P.labelsToInitialize.set(S,Q));this.setDirty();this.deconflictor.setDirty()};T._removeGraphic=function(P,Q){Q=Q.graphic.uid;const S=this._labels.get(Q);P.graphics.delete(Q);S&&(this._destroyGraphic(S,Q),P.labelsToInitialize.delete(Q),this.setDirty(),this.deconflictor.setDirty())};T._destroyGraphic=function(P,Q){this._labels.has(Q)&&(this._labels.delete(Q),this._labelsToAdd.delete(Q),this._labelsToRemove.delete(Q));P.textInitialized&&(this._removeLabelTextureFromAtlas(P),this._destroyTextTextureResources(P));
P.hasGraphics3DResources&&this._destroyGraphics3DResources(P)};T._labelingInfoChange=async function(P,Q){if(Q)for(const S of Q){if(Q=P.graphics.get(S))this._removeGraphic(P,Q),this._addGraphic(P,Q)}else return this._visibilityInfoChange(P),this._resetLabels(P),this._createLabelClassContext(P)};T._globalPropertyChanged=function(P,Q){for(const S of Q.labelClassContexts){const U=new Map;Q.graphics.forEach(V=>U.set(V.graphic.uid,V));S.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(P,U,V=>V.labelLayers[0]);
S.graphics3DCalloutSymbolLayer&&S.graphics3DCalloutSymbolLayer.globalPropertyChanged(P,U,V=>V.labelLayers[S.calloutSymbolLayerIndex])}};T._visibilityInfoChange=function(P){const Q=O(P.layer);Q&&!P.active&&this._activateLabelingContext(P);!Q&&P.active&&this._deactivateLabelingContext(P);this.setDirty()};T._resetAllLabels=function(){for(const P of this._labelingContexts)this._resetLabels(P)};T._resetLabels=function(P){P.graphics.forEach((Q,S)=>{if(Q=this._labels.get(S))this._destroyGraphic(Q,S),Q.visible=
!1,Q.rendered=!1,P.labelsToInitialize.set(S,Q)});this._destroyLabelClassContext(P);this.setDirty();this.deconflictor.setDirty()};T._findLabelingContext=function(P){for(const Q of this._labelingContexts)if(Q.graphics3DCore===P)return Q;return null};T.addGraphicsOwner=function(P,Q,S){const U=S&&S.emptySymbolLabelSupported||!1,V=S&&S.elevationInfoOverride||null;S=S&&S.disablePlacement||null;if(!this._findLabelingContext(P)){var X=P.layer,Y=new J(this.view._stage,X,P,Q,U,V,S,O(X));this._labelingContexts.push(Y);
this.setDirty();return{addGraphic:Z=>this._addGraphic(Y,Z),removeGraphic:Z=>this._removeGraphic(Y,Z),featureReductionChange:()=>{},layerLabelsEnabled:()=>O(Y.layer),labelingInfoChange:Z=>this._labelingInfoChange(Y,Z),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Y),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Y),visibilityInfoChange:()=>this._visibilityInfoChange(Y),reset:()=>this._resetLabels(Y),clear:()=>{}}}};T.removeGraphicsOwner=function(P){const Q=
this._findLabelingContext(P);Q&&(P=this._labelingContexts.indexOf(Q),this._labelingContexts.splice(P,1),Q.graphics.forEach(S=>this._removeGraphic(Q,S)),Q.destroy(),this.setDirty())};T.setLabelGraphicVisibility=function(P,Q){P=P.graphic.uid;const S=this._labels.get(P);S&&S.visible!==Q&&(Q&&!S.rendered?(this._labelsToAdd.set(P,S),this._labelsToRemove.delete(P),S.textInitialized||S.labelingContext.labelsToInitialize.set(P,S)):!Q&&S.rendered&&(this._labelsToRemove.set(P,S),this._labelsToAdd.delete(P)),
S.visible=Q,this.setDirty())};T.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};b._createClass(W,[{key:"running",get:function(){return this.view.ready&&(this._dirty||this.deconflictor.running)}},{key:"updating",get:function(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(P=>!!P.labelClassPromise&&!!P.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||
!this._textTextureAtlas)return 1;const P=0<this._labelingContexts.length?this._labelingContexts.reduce((Q,S)=>Q+(S.labelClassPromise&&S.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*P+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return W}(y);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,
"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([l.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const N=new A.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=O;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures ../../geometry/SpatialReference".split(" "),function(a,b,c,y,p,u,q,k,d){function f(w){return"declaredClass"in w}function g(w){return"declaredClass"in w}function e(w){return"declaredClass"in w}function h(w){return null==w?null:f(w)?w:q.fromJSON(z(w))}function z(w){const {wkid:r,wkt:x,latestWkid:D}=
w.spatialReference,A={wkid:r,wkt:x,latestWkid:D};switch(w.type){case "point":const {x:v,y:B,z:C,m:E}=w;return{x:v,y:B,z:C,m:E,spatialReference:A};case "polygon":const {rings:F,hasZ:M,hasM:K}=w;return{rings:n(F),hasZ:M,hasM:K,spatialReference:A};case "polyline":const {paths:G,hasZ:L,hasM:O}=w;return{paths:n(G),hasZ:L,hasM:O,spatialReference:A};case "extent":const {xmin:I,xmax:H,ymin:J,ymax:N,zmin:R,zmax:W,mmin:T,mmax:P,hasZ:Q,hasM:S}=w;return{xmin:I,xmax:H,ymin:J,ymax:N,zmin:R,zmax:W,mmin:T,mmax:P,
hasZ:Q,hasM:S,spatialReference:A};case "multipoint":const {points:U,hasZ:V,hasM:X}=w;return{points:t(U)?l(U):U,hasZ:V,hasM:X,spatialReference:A}}}function n(w){return m(w)?w.map(r=>l(r)):w}function l(w){return w.map(r=>Array.from(r))}function m(w){for(const r of w)if(0!==r.length)return t(r);return!1}function t(w){return 0<w.length&&(u.isFloat32Array(w[0])||u.isFloat64Array(w[0]))}a.clonePoint=function(w,r){if(!w)return null;if(g(w)){if(null==r)return w.clone();if(g(r))return r.copy(w)}null!=r?(r.x=
w.x,r.y=w.y,r.spatialReference=w.spatialReference,w.hasZ?(r.z=w.z,r.hasZ=w.hasZ):(r.z=void 0,r.hasZ=!1),w.hasM?(r.m=w.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=k.makeDehydratedPoint(w.x,w.y,w.z,w.spatialReference),w.hasM&&(r.m=w.m,r.hasM=!0));return r};a.hydrateGeometry=h;a.hydrateGraphic=function(w,r){return w?e(w)?w:new c({layer:r,sourceLayer:r,visible:w.visible,symbol:p.clone(w.symbol),attributes:p.clone(w.attributes),geometry:h(w.geometry)}):null};a.hydratedSpatialReference=function(w){const {wkid:r,
wkt:x,latestWkid:D}=w;return d.fromJSON({wkid:r,wkt:x,latestWkid:D})};a.isHydratedGeometry=f;a.isHydratedGraphic=e;a.isHydratedPoint=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(l,m,t){if(null==l)return null;switch(m){case "point":return{x:l.x,y:l.y,z:l.z,m:l.m,hasZ:null!=l.z,hasM:null!=l.m,type:"point",spatialReference:t};case "polyline":return{paths:l.paths,hasZ:!!l.hasZ,hasM:!!l.hasM,type:"polyline",spatialReference:t};case "polygon":return{rings:l.rings,hasZ:!!l.hasZ,hasM:!!l.hasM,type:"polygon",spatialReference:t};case "multipoint":return{points:l.points,hasZ:!!l.hasZ,hasM:!!l.hasM,type:"multipoint",spatialReference:t}}}
function n(l){if(null==l)return 0;let m=32;switch(l.type){case "point":m+=42;break;case "polyline":case "polygon":var t=0;const w=2+(l.hasZ?1:0)+(l.hasM?1:0);l="polyline"===l.type?l.paths:l.rings;for(const r of l)t+=r.length;m+=8*t*w+64;m+=128*t;m=m+34+32*(l.length+1);break;case "multipoint":t=l.points.length;m+=8*t*(2+(l.hasZ?1:0)+(l.hasM?1:0))+64;m+=128*t;m=m+34+32;break;case "extent":m+=98;l.hasM&&(m+=32);l.hasZ&&(m+=32);break;case "mesh":m+=p.estimateSize(l.vertexAttributes.position),m+=p.estimateSize(l.vertexAttributes.normal),
m+=p.estimateSize(l.vertexAttributes.uv),m+=p.estimateSize(l.vertexAttributes.tangent)}return m}y=b._createClass(function(l,m,t){this.uid=l;this.geometry=m;this.attributes=t;this.visible=!0;this.centroid=this.objectId=null});b=b._createClass(function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null});a.equals=
h.equals;a.DehydratedFeatureClass=y;a.DehydratedFeatureSetClass=b;a.computeAABB=function(l,m){k.empty(m);"mesh"===l.type&&(l=l.extent);switch(l.type){case "point":m[0]=m[3]=l.x;m[1]=m[4]=l.y;l.hasZ&&(m[2]=m[5]=l.z);break;case "polyline":for(var t=0;t<l.paths.length;t++)k.expandWithNestedArray(m,l.paths[t],!!l.hasZ);break;case "polygon":for(t=0;t<l.rings.length;t++)k.expandWithNestedArray(m,l.rings[t],!!l.hasZ);break;case "multipoint":k.expandWithNestedArray(m,l.points,!!l.hasZ);break;case "extent":m[0]=
l.xmin,m[1]=l.ymin,m[3]=l.xmax,m[4]=l.ymax,null!=l.zmin&&(m[2]=l.zmin),null!=l.zmax&&(m[5]=l.zmax)}};a.computeAABR=function(l,m){d.empty(m);"mesh"===l.type&&(l=l.extent);switch(l.type){case "point":m[0]=m[2]=l.x;m[1]=m[3]=l.y;break;case "polyline":for(var t=0;t<l.paths.length;t++)d.expandWithNestedArray(m,l.paths[t]);break;case "polygon":for(t=0;t<l.rings.length;t++)d.expandWithNestedArray(m,l.rings[t]);break;case "multipoint":d.expandWithNestedArray(m,l.points);break;case "extent":m[0]=l.xmin,m[1]=
l.ymin,m[2]=l.xmax,m[3]=l.ymax}};a.estimateGeometryObjectSize=n;a.estimateSize=function(l){let m;m=32+c.estimateAttributesObjectSize(l.attributes);return m=m+3+(8+n(l.geometry))};a.fromFeatureSetJSON=function(l){const m=g.featureGeometryTypeKebabDictionary.fromJSON(l.geometryType),t=q.fromJSON(l.spatialReference),w=l.transform,r=l.features.map(x=>{var D=l.objectIdFieldName;x={uid:u.generateUID(),objectId:D&&x.attributes?x.attributes[D]:null,attributes:x.attributes,geometry:z(x.geometry,m,t),visible:!0};
D=x.geometry;if(null!=D&&w)switch(D.type){case "point":x.geometry=f.unquantizePoint(w,D,D,D.hasZ,D.hasM);break;case "multipoint":x.geometry=f.unquantizeMultipoint(w,D,D,!!D.hasZ,!!D.hasM);break;case "polygon":x.geometry=f.unquantizePolygon(w,D,D,!!D.hasZ,!!D.hasM);break;case "polyline":x.geometry=f.unquantizePolyline(w,D,D,!!D.hasZ,!!D.hasM);break;case "extent":x.geometry=D;break;case "mesh":x.geometry=D}return x});return{geometryType:m,features:r,spatialReference:t,fields:l.fields?.map(x=>e.fromJSON(x))??
[],objectIdFieldName:l.objectIdFieldName,globalIdFieldName:l.globalIdFieldName,geohashFieldName:l.geohashFieldName,geometryProperties:l.geometryProperties,hasZ:l.hasZ,hasM:l.hasM,exceededTransferLimit:l.exceededTransferLimit,transform:null}};a.fromJSONGeometry=z;a.getObjectId=function(l,m){return null!=l.objectId?l.objectId:l.attributes&&m?l.attributes[m]:null};a.hasGeometry=function(l){return null!=l.geometry};a.hasVertices=function(l){if(null==l)return!1;switch(l.type){case "extent":case "point":return!0;
case "polyline":for(const m of l.paths)if(0<m.length)return!0;return!1;case "polygon":for(const m of l.rings)if(0<m.length)return!0;return!1;case "multipoint":return 0<l.points.length;case "mesh":return!l.loaded||0<l.vertexAttributes.position.length}};a.makeDehydratedPoint=function(l,m,t,w){return{x:l,y:m,z:t,hasZ:null!=t,hasM:!1,spatialReference:w,type:"point"}};a.numVertices=function(l){if(null==l)return 0;switch(l.type){case "point":return 1;case "polyline":var m=0;for(var t of l.paths)m+=t.length;
return m;case "polygon":t=0;for(m of l.rings)t+=m.length;return t;case "multipoint":return l.points.length;case "extent":return 2;case "mesh":return(l=l.vertexAttributes&&l.vertexAttributes.position)?l.length/3:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function b(p){return 32+p.length}function c(p){if(!p)return 0;if(Array.isArray(p)){var u=p.length;if(0===u||"number"===typeof p[0])p=32+8*u;else{var q=
32;for(let k=0;k<u;k++)q+=y(p[k]);p=q}return p}q=32;for(u in p)p.hasOwnProperty(u)&&(q+=y(p[u]));return q}function y(p){switch(typeof p){case "object":return c(p);case "string":return b(p);case "number":return 16;case "boolean":return 4;default:return 8}}a.estimateAttributesObjectSize=function(p){if(!p)return 0;let u=32;for(const q in p)if(p.hasOwnProperty(q)){const k=p[q];switch(typeof k){case "string":u+=b(k);break;case "number":u+=16;break;case "boolean":u+=4}}return u};a.estimateFixedArraySize=
function(p,u){return 32+p.length*u};a.estimateNestedObjectSize=c;a.estimateNumberByteSize=function(p){return 16};a.estimateStringByteSize=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,b){function c({scale:C,translate:E},F){return Math.round((F-E[0])/C[0])}function y({scale:C,translate:E},F){return Math.round((E[1]-F)/C[1])}function p(C,E,F){const M=[];let K,G,L,O;for(let I=0;I<F.length;I++){const H=
F[I];if(0<I){if(L=c(C,H[0]),O=y(C,H[1]),L!==K||O!==G)M.push(E(H,L-K,O-G)),K=L,G=O}else K=c(C,H[0]),G=y(C,H[1]),M.push(E(H,K,G))}return 0<M.length?M:null}function u(C,E,F,M){return p(C,F?M?B:v:M?v:A,E)}function q(C,E,F,M){const K=[];F=F?M?B:v:M?v:A;for(M=0;M<E.length;M++){const G=p(C,F,E[M]);G&&3<=G.length&&K.push(G)}return K.length?K:null}function k(C,E,F,M){const K=[];F=F?M?B:v:M?v:A;for(M=0;M<E.length;M++){const G=p(C,F,E[M]);G&&2<=G.length&&K.push(G)}return K.length?K:null}function d({scale:C,
translate:E},F){return F*C[0]+E[0]}function f({scale:C,translate:E},F){return E[1]-F*C[1]}function g(C,E,F){const M=Array(F.length);if(!F.length)return M;const [K,G]=C.scale;let L=d(C,F[0][0]);C=f(C,F[0][1]);M[0]=E(F[0],L,C);for(let O=1;O<F.length;O++){const I=F[O];L+=I[0]*K;C-=I[1]*G;M[O]=E(I,L,C)}return M}function e(C,E,F){const M=Array(F.length);for(let K=0;K<F.length;K++)M[K]=g(C,E,F[K]);return M}function h(C,E,F,M){return g(C,F?M?B:v:M?v:A,E)}function z(C,E,F,M){return e(C,F?M?B:v:M?v:A,E)}function n(C,
E,F,M){return e(C,F?M?B:v:M?v:A,E)}function l(C,E,F){let [M,K]=F[0],G=Math.min(M,E[0]),L=Math.min(K,E[1]),O=Math.max(M,E[2]);E=Math.max(K,E[3]);for(let I=1;I<F.length;I++){const [H,J]=F[I];M+=H;K+=J;0>H&&(G=Math.min(G,M));0<H&&(O=Math.max(O,M));0>J?L=Math.min(L,K):0<J&&(E=Math.max(E,K))}C[0]=G;C[1]=L;C[2]=O;C[3]=E;return C}function m(C,E){if(!E.length)return null;C[0]=C[1]=Number.POSITIVE_INFINITY;C[2]=C[3]=Number.NEGATIVE_INFINITY;for(let F=0;F<E.length;F++)l(C,C,E[F]);return C}function t(C,E,F,
M,K){E.xmin=c(C,F.xmin);E.ymin=y(C,F.ymin);E.xmax=c(C,F.xmax);E.ymax=y(C,F.ymax);E!==F&&(M&&(E.zmin=F.zmin,E.zmax=F.zmax),K&&(E.mmin=F.mmin,E.mmax=F.mmax));return E}function w(C,E,F,M,K){E.points=u(C,F.points,M,K)??[];return E}function r(C,E,F,M,K){E.x=c(C,F.x);E.y=y(C,F.y);E!==F&&(M&&(E.z=F.z),K&&(E.m=F.m));return E}function x(C,E,F,M,K){C=q(C,F.rings,M,K);if(!C)return null;E.rings=C;return E}function D(C,E,F,M,K){C=k(C,F.paths,M,K);if(!C)return null;E.paths=C;return E}const A=(C,E,F)=>[E,F],v=(C,
E,F)=>[E,F,C[2]],B=(C,E,F)=>[E,F,C[2],C[3]];a.equals=function(C,E){if(C===E||null==C&&null==E)return!0;if(null==C||null==E)return!1;let F,M,K,G;C&&"upperLeft"===C.originPosition?(F=C.translate[0],M=C.translate[1],C=C.scale[0]):(F=null!=C.extent?C.extent.xmin:0,M=null!=C.extent?C.extent.ymax:0,C=C.tolerance);E&&"upperLeft"===E.originPosition?(K=E.translate[0],G=E.translate[1],E=E.scale[0]):(K=null!=E.extent?E.extent.xmin:0,G=null!=E.extent?E.extent.ymax:0,E=E.tolerance);return F===K&&M===G&&C===E};
a.getQuantizedBoundsCoordsArray=l;a.getQuantizedBoundsCoordsArrayArray=m;a.getQuantizedBoundsPaths=function(C){return m([0,0,0,0],C)};a.getQuantizedBoundsPoints=function(C){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return l(E,E,C)};a.getQuantizedBoundsRings=function(C){return m([0,0,0,0],C)};a.quantizeBounds=function(C,E,F){E[0]=c(C,F[0]);E[3]=y(C,F[1]);E[2]=c(C,F[2]);E[1]=y(C,F[3]);return E};a.quantizeExtent=t;a.quantizeGeometry=
function(C,E){return C&&E?b.isPoint(E)?r(C,{},E,!1,!1):b.isPolyline(E)?D(C,{},E,!1,!1):b.isPolygon(E)?x(C,{},E,!1,!1):b.isMultipoint(E)?w(C,{},E,!1,!1):b.isExtent(E)?t(C,{},E,!1,!1):null:null};a.quantizeMultipoint=w;a.quantizePaths=k;a.quantizePoint=r;a.quantizePoints=u;a.quantizePolygon=x;a.quantizePolyline=D;a.quantizeRings=q;a.quantizeX=c;a.quantizeY=y;a.toQuantizationTransform=function(C){return C?{originPosition:"upper-left"===C.originPosition?"upperLeft":"lower-left"===C.originPosition?"lowerLeft":
C.originPosition,scale:C.tolerance?[C.tolerance,C.tolerance]:[1,1],translate:null!=C.extent?[C.extent.xmin,C.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(C,E,F){return F?(E[0]=d(C,F[0]),E[1]=f(C,F[3]),E[2]=d(C,F[2]),E[3]=f(C,F[1]),E):[d(C,E[0]),f(C,E[3]),d(C,E[2]),f(C,E[1])]};a.unquantizeCoordsArray=g;a.unquantizeCoordsArrayArray=e;a.unquantizeExtent=function(C,E,F,M,K){E.xmin=d(C,F.xmin);E.ymin=f(C,F.ymin);E.xmax=d(C,F.xmax);E.ymax=f(C,F.ymax);E!==F&&(M&&(E.zmin=F.zmin,E.zmax=F.zmax),K&&
(E.mmin=F.mmin,E.mmax=F.mmax));return E};a.unquantizeMultipoint=function(C,E,F,M,K){null!=F&&(E.points=h(C,F.points,M,K));return E};a.unquantizePaths=z;a.unquantizePoint=function(C,E,F,M,K){if(null==F)return E;E.x=d(C,F.x);E.y=f(C,F.y);E!==F&&(M&&(E.z=F.z),K&&(E.m=F.m));return E};a.unquantizePoints=h;a.unquantizePolygon=function(C,E,F,M,K){null!=F&&(E.rings=n(C,F.rings,M,K));return E};a.unquantizePolyline=function(C,E,F,M,K){null!=F&&(E.paths=z(C,F.paths,M,K));return E};a.unquantizeRings=n;a.unquantizeX=
d;a.unquantizeY=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../geometry/support/spatialReferenceUtils"],function(a,b,c){function y(d,f){if(d===f)return!0;if(null==d||null==f||d.length!==f.length)return!1;for(let g=0;g<d.length;g++){const e=d[g],h=f[g];if(e.length!==h.length)return!1;for(let z=0;z<e.length;z++)if(e[z]!==h[z])return!1}return!0}function p(d,f){if(d===f)return!0;
if(null==d||null==f||d.length!==f.length)return!1;for(let g=0;g<d.length;g++)if(!y(d[g],f[g]))return!1;return!0}function u(d,f){return d===f||null!=d&&null!=f&&c.equals(d.spatialReference,f.spatialReference)&&d.x===f.x&&d.y===f.y&&d.z===f.z&&d.m===f.m}function q(d,f){if(d===f)return!0;if(null==d||null==f||d.type!==f.type)return!1;switch(d.type){case "point":return u(d,f);case "extent":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:c.equals(d.spatialReference,f.spatialReference)?d.xmin===f.xmin&&d.ymin===
f.ymin&&d.zmin===f.zmin&&d.xmax===f.xmax&&d.ymax===f.ymax&&d.zmax===f.zmax:!1,d;case "polyline":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:c.equals(d.spatialReference,f.spatialReference)?p(d.paths,f.paths):!1,d;case "polygon":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:c.equals(d.spatialReference,f.spatialReference)?p(d.rings,f.rings):!1,d;case "multipoint":return d=d.hasZ!==f.hasZ||d.hasM!==f.hasM?!1:c.equals(d.spatialReference,f.spatialReference)?y(d.points,f.points):!1,d;case "mesh":return!1}}
function k(d,f){if(d===f)return!0;if(!d||!f)return!1;const g=Object.keys(d),e=Object.keys(f);if(g.length!==e.length)return!1;for(const h of g)if(d[h]!==f[h])return!1;return!0}a.equals=function(d,f){return d===f?!0:null!=d&&null!=f&&d.objectId===f.objectId&&q(d.geometry,f.geometry)&&k(d.attributes,f.attributes)?!0:!1};a.pointEquals=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(z,n){if(null==z)return"";const l=n.domain;if(l)if("codedValue"===l.type||"coded-value"===l.type)for(var m of l.codedValues){if(m.code===z)return m.name}else if("range"===l.type){m=+z;const t="range"in l?l.range[1]:l.maxValue;if(("range"in l?l.range[0]:l.minValue)<=m&&m<=t)return l.name}"date"===n.type||"esriFieldTypeDate"===n.type?z=p.formatDate(z,p.convertDateFormatToIntlOptions("short-date")):q.isNumericField(n)&&(z=u.formatNumber(+z));return z||""}const g=
y.getLogger("esri.layers.support.labelFormatUtils"),e={type:"simple",evaluate(){return null}},h={getAttribute(z,n){return z.field(n)}};b.createLabelFunction=async function(z,n,l){if(!z||!z.symbol||!n)return e;const m=z.where,t=k.getLabelExpression(z);z=m?await new Promise((w,r)=>a(["../../core/sql/WhereClause"],w,r)):null;if("arcade"===t.type){const w=await d.createLabelExpression(t.expression,l,n);if(null==w)return e;l={type:"arcade",evaluate(r){try{const x=w.evaluate({$feature:"attributes"in r?
w.repurposeFeature(r):r},w.services);if(null!=x)return x.toString()}catch(x){g.error(new c("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:x,feature:r,expression:t}))}return null},needsHydrationToEvaluate(){return null==k.getSingleFieldArcadeExpression(t.expression)}}}else l={type:"simple",evaluate(w){return t.expression.replaceAll(/{[^}]*}/g,r=>{var x=r.slice(1,-1);x=n.get(x);if(!x)return r;r=null;"attributes"in w?w&&w.attributes&&(r=w.attributes[x.name]):
r=w.field(x.name);return null==r?"":f(r,x)})}};if(m){let w;try{w=z.WhereClause.create(m,n)}catch(x){return g.error(new c("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:m,error:x})),e}const r=l.evaluate;l.evaluate=x=>{const D="attributes"in x?void 0:h;try{if(w.testFeature(x,D))return r(x)}catch(A){g.error(new c("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:m,feature:x,error:A}))}return null}}return l};b.formatField=
f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/CreateLabelParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c=null,y="center",p="center",u=null,q=[0,0,0],k=0,d=[0,0,0,1],f=[0,0],g="world",e=0,h=0){this.verticalOffset=c;this.horizontalPlacement=y;this.verticalPlacement=p;this.text=u;this.translation=q;this.elevationOffset=k;this.centerOffset=d;this.screenOffset=f;this.centerOffsetUnits=
g;this.displayWidth=e;this.displayHeight=h});a.CreateLabelParameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,y){const p=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),u={line:y.Graphics3DLineCalloutSymbolLayer};a.make=function(q,
k){if(!c.hasCalloutSupport(q))return p.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${q.type}' does not support callouts`),null;if(!q.callout)return null;const d=u[q.callout.type];return d?new d(q,k):(p.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${q.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){n=function(F){function M(G,L){G=F.call(this,G,null,L,E)||this;G._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inherits(M,F);var K=M.prototype;K.doLoad=async function(){this._material=new A.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)};K.destroy=function(){b._get(b._getPrototypeOf(M.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);
this._material=null};K._perInstanceMaterialParameters=function(G){const L=this._materialParameters;L.screenOffset=G.screenOffset||p.ZEROS;L.centerOffsetUnits=G.centerOffsetUnits||"world";return L};K._defaultElevationInfoNoZ=function(){return C};K.createGraphics3DGraphic=function(G){const L=G.renderingInfo;G=G.graphic;const O=this.setGraphicElevationContext(G,new g.ElevationContext,L.elevationOffset||0);var I=L.symbol;const H="on-the-ground"===this._elevationContext.mode&&("cim"===I.type||!I.symbolLayers.some(J=>
"object"===J.type||"text"===J.type));if("label-3d"!==I.type&&H||"point-3d"===I.type&&I.symbolLayers.every(J=>"text"===J.type&&!k.textSymbolLayerSupportsVerticalOffset(J)))return null;I=l.computeCentroid(G.geometry);return null==I?null:this._createAs3DShape(I,O,L,G.uid)};K.layerOpacityChanged=function(){this._material?.setParameters(this._materialParameters)};K.layerElevationInfoChanged=function(G,L,O){O=f.elevationModeChangeUpdateType(M.elevationModeChangeTypes,O,this._elevationContext.mode);if(O!==
f.SymbolUpdateType.UPDATE)return O;G.forEach(I=>{const H=L(I);null!=H&&this.updateGraphicElevationContext(I.graphic,H)});return O};K.slicePlaneEnabledChanged=function(){this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};K.physicalBasedRenderingChanged=function(){return!0};K.setGraphicElevationContext=function(G,L,O=0){G=b._get(b._getPrototypeOf(M.prototype),"setGraphicElevationContext",this).call(this,G,L);G.addOffsetRenderUnits(O);return G};K.updateGraphicElevationContext=
function(G,L){this.setGraphicElevationContext(G,L.elevationContext,null!=L.metadata?L.metadata.elevationOffset:0);L.needsElevationUpdates=f.needsElevationUpdates2D(L.elevationContext.mode)};K.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:t.emptySymbolComplexity.memory}};K._createVertexData=function(G){const {translation:L,centerOffset:O}=G;G=L?new w.Attribute([L[0],L[1],L[2]],3,!0):new w.Attribute([0,0,0],3,!0);const I=
O?new w.Attribute([O[0],O[1],O[2],O[3]],4,!0):new w.Attribute([0,0,0,1],4,!0);return[[D.VertexAttribute.POSITION,G],[D.VertexAttribute.NORMAL,new w.Attribute([0,0,1],3,!0)],[D.VertexAttribute.AUXPOS1,I]]};K._getOrCreateMaterial=function(G){const L=this._perInstanceMaterialParameters(G),O=A.LineCalloutMaterial.uniqueMaterialIdentifier(L);if(this._material&&O===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(null!=G.materialCollection){let I=G.materialCollection.get(O);
null==I&&(I=new A.LineCalloutMaterial(L),G.materialCollection.add(O,I));return{material:I,isUnique:!1}}return{material:new A.LineCalloutMaterial(L),isUnique:!0}};K._createAs3DShape=function(G,L,O,I){var H=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:I,layerUid:this._context.layer.uid}),J=this._getOrCreateMaterial(O);H=new x.Geometry(J.material,this._createVertexData(O),B,null,r.ContentObjectType.Point,H);I=m.createStageObject(this._context,G,H,L,I);if(null==I)return null;J=
new h.Graphics3DObject3DGraphicLayer(this,I.object,[H],J.isUnique?[J.material]:null,null,d.perObjectElevationAligner,L);J.metadata=new z.Graphics3DObjectMetadata(O.elevationOffset);J.alignedSampledElevation=I.sampledElevation;J.needsElevationUpdates=f.needsElevationUpdates2D(L.mode);m.extendPointGraphicElevationContext(J,G,this._context.elevationProvider);return J};b._createClass(M,[{key:"_materialParameters",get:function(){const G=new A.Parameters;var L=this.symbol,O=L.callout;G.color=null!=O.color?
c.toUnitRGBA(O.color):[0,0,0,0];G.color[3]*=this._getLayerOpacity();G.size=y.pt2px(O.size||0);if(L.verticalOffset){const {screenLength:I,minWorldLength:H,maxWorldLength:J}=L.verticalOffset;G.verticalOffset={screenLength:y.pt2px(I),minWorldLength:H||0,maxWorldLength:null!=J?J:Infinity}}G.borderColor=null!=O.border&&null!=O.border.color?c.toUnitRGBA(O.border.color):null;O="object"===L.symbolLayers.at(0).type;L="label-3d"===L.type;G.occlusionTest=!O;G.shaderPolygonOffset=O?0:void 0;G.depthHUDAlignStart=
L;G.hasSlicePlane=this._context.slicePlaneEnabled;G.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return G}}]);return M}(n.Graphics3DSymbolLayer);n.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.UPDATE,staysOnTheGround:f.SymbolUpdateType.UPDATE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};var v=[0];const B=[[D.VertexAttribute.POSITION,v],[D.VertexAttribute.NORMAL,v],[D.VertexAttribute.AUXPOS1,v]],C=
{mode:"relative-to-ground",offset:0},E={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};v=b._createClass(function(F,M,K=u.create(),G=q.create(),L=p.create(),O="world",I=0,H=null){this.renderer=F;this.symbol=M;this.translation=K;this.centerOffset=G;this.screenOffset=L;this.centerOffsetUnits=O;this.elevationOffset=I;this.materialCollection=H});e=function(F){function M(){return F.apply(this,arguments)||this}b._inherits(M,F);return b._createClass(M)}(e);a.Graphics3DLineCalloutSymbolLayer=n;a.LineCalloutCreationContext=
e;a.LineCalloutSymbolLayerRenderingInfo=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(x,D,A,v,B){let C=!1;var E=x.shaderTransformation;D=D.requiresSampledElevationInfo;l[0]=E[12];l[1]=E[13];l[2]=E[14];x.invalidateBoundingInfo();var F=x.getMutableAttribute(e.VertexAttribute.POSITION);E=F.data;F=F.size;const M=E.length/F;x=new f.SamplePosition(x.mapPositions,A);let K=0,G=0;for(let L=0;L<M;L++){m[0]=E[K];m[1]=E[K+1];m[2]=E[K+2];v(x,r);D&&(G+=r.sampledElevation);if(d.TESTS_DISABLE_OPTIMIZATIONS)E[K]=x.array[x.offset],E[K+1]=x.array[x.offset+
1],E[K+2]=r.z,u.projectBuffer(E,A,K,E,B.spatialReference,K,1),E[K]-=l[0],E[K+1]-=l[1],E[K+2]-=l[2],C=!0;else{n[0]=E[K]+l[0];n[1]=E[K+1]+l[1];n[2]=E[K+2]+l[2];B.setAltitude(n,r.z);E[K]=n[0]-l[0];E[K+1]=n[1]-l[1];E[K+2]=n[2]-l[2];const O=.01/B.unitInMeters;if(Math.abs(m[0]-E[K])>=O||Math.abs(m[1]-E[K+1])>=O||Math.abs(m[2]-E[K+2])>=O)C=!0}K+=F;x.offset+=3}return{update:C,averageGeometrySampledElevation:G/M}}const z=c.create(),n=p.create(),l=p.create(),m=p.create(),t=c.create(),w=p.create(),r=new q.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(x,D,A,v,B){var C=x.graphics3DSymbolLayer.lodRenderer;if(null==C)return 0;A=D.centerPointInElevationSR;v(A,r);D="absolute-height"!==D.mode?r.sampledElevation:0;v=C.instanceData;x=x.instanceIndex;v.getGlobalTransform(x,t);C=y.set(w,t[12],t[13],t[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(n[0]=A.x,n[1]=A.y,n[2]=r.z,u.computeTranslationToOriginAndRotation(A.spatialReference,n,t,B.spatialReference)&&v.setGlobalTransform(x,t)):B.setAltitudeOfTransformation(r.z,t);B=.01/
B.unitInMeters;(d.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(t[12]-C[0])>=B||Math.abs(t[13]-C[1])>=B||Math.abs(t[14]-C[2])>=B)&&v.setGlobalTransform(x,t);return D};a.perObjectElevationAligner=function(x,D,A,v,B,C){x=x.stageObject;const E=D.centerPointInElevationSR;A=0;x.usesVerticalDistanceToGround?(v(E,r),k.updateVertexAttributeAuxpos1w(x,r.verticalDistanceToGround),A=r.sampledElevation):(v(E,r),"absolute-height"!==D.mode&&(A=r.sampledElevation));D=b.copy(z,C??x.transformation);v=y.set(w,D[12],D[13],
D[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(n[0]=E.x,n[1]=E.y,n[2]=r.z,u.computeTranslationToOriginAndRotation(E.spatialReference,n,D,B.spatialReference)&&(C?b.copy(C,D):x.transformation=D)):B.setAltitudeOfTransformation(r.z,D);B=.01/B.unitInMeters;if(Math.abs(D[12]-v[0])>=B||Math.abs(D[13]-v[1])>=B||Math.abs(D[14]-v[2])>=B)C?b.copy(C,D):x.transformation=D;return A};a.perVertexElevationAligner=function(x,D,A,v,B){x=x.stageObject;const C=x.geometries;let E=0;for(const F of C){if(!g.isGeometryWithMapPositions(F))continue;
const {update:M,averageGeometrySampledElevation:K}=h(F,D,A,v,B);E+=K;M&&x.geometryVertexAttrsUpdated(F)}return E/C.length};a.sharedGeometryElevationAligner=function(x,D,A,v,B){x=x.stageObject;const C=x.geometries;if(0===C.length)return 0;let E=0,F=null,M=0,K=!1;for(const G of C){if(!g.isGeometryWithMapPositions(G))continue;const L=G.vertexAttributes.get(e.VertexAttribute.POSITION);if(L!==F){const {update:O,averageGeometrySampledElevation:I}=h(G,D,A,v,B);M=I;F=L;K=O}K&&x.geometryVertexAttrsUpdated(G);
E+=M}return E/C.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),function(a,b,c,y,p,u,q,k,d){function f(n,l,m,t,w){const r=(q.isDehydratedPoint(n)?
n.z:d.isSamplePosition(n)?n.array[n.offset+2]:n[2])||0;switch(m.mode){case "on-the-ground":m=d.getElevationAtPoint(l,n,"ground")??0;w.verticalDistanceToGround=0;w.sampledElevation=m;w.z=m;break;case "relative-to-ground":n=d.getElevationAtPoint(l,n,"ground")??0;m=m.geometryZWithOffset(r,t);w.verticalDistanceToGround=m;w.sampledElevation=n;w.z=m+n;break;case "relative-to-scene":n=d.getElevationAtPoint(l,n,"scene")??0;m=m.geometryZWithOffset(r,t);w.verticalDistanceToGround=m;w.sampledElevation=n;w.z=
m+n;break;case "absolute-height":m=m.geometryZWithOffset(r,t);t=d.getElevationAtPoint(l,n,"ground")??0;w.verticalDistanceToGround=m-t;w.sampledElevation=t;w.z=m;break;default:w.z=0}}b=b._createClass(function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0});a.SymbolUpdateType=void 0;(function(n){n[n.NONE=0]="NONE";n[n.UPDATE=1]="UPDATE";n[n.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const g={"absolute-height":{applyElevationAlignmentBuffer:function(n,l,m,
t,w,r,x,D){r=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;l*=3;t*=3;for(x=0;x<w;++x){const A=n[l+1],v=n[l+2];m[t]=n[l];m[t+1]=A;m[t+2]=null==D?v+r:r;l+=3;t+=3}return 0},requiresAlignment:function(n){const l=n.featureExpressionInfoContext;return 0!==n.meterUnitOffset||null!=l}},"on-the-ground":{applyElevationAlignmentBuffer:function(n,l,m,t,w,r){let x=0;const D=r.spatialReference;l*=3;t*=3;for(let A=0;A<w;++A){const v=n[l],B=n[l+1],C=r.getElevation(v,B,n[l+2],D,"ground")??0;x+=
C;m[t]=v;m[t+1]=B;m[t+2]=C;l+=3;t+=3}return x/w},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(n,l,m,t,w,r,x,D){let A=0;x=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;const v=r.spatialReference;l*=3;t*=3;for(let B=0;B<w;++B){const C=n[l],E=n[l+1],F=n[l+2],M=r.getElevation(C,E,F,v,"ground")??0;A+=M;m[t]=C;m[t+1]=E;m[t+2]=null==D?F+M+x:M+x;l+=3;t+=3}return A/w},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(n,
l,m,t,w,r,x,D){let A=0;x=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;const v=r.spatialReference;l*=3;t*=3;for(let B=0;B<w;++B){const C=n[l],E=n[l+1],F=n[l+2],M=r.getElevation(C,E,F,v,"scene")??0;A+=M;m[t]=C;m[t+1]=E;m[t+2]=null==D?F+M+x:M+x;l+=3;t+=3}return A/w},requiresAlignment:()=>!0}},e=y.create(),h=new b,z=p.create();a.SampleElevationInfo=b;a.applyElevationAlignmentForHUD=function(n,l,m,t,w){f(l,m,w,t,h);k.updateVertexAttributeAuxpos1w(n,h.verticalDistanceToGround);m=h.sampledElevation;
w=c.copy(e,n.transformation);z[0]=l.x;z[1]=l.y;z[2]=h.z;u.computeTranslationToOriginAndRotation(l.spatialReference,z,w,t.spatialReference)?n.transformation=w:console.warn("Could not locate symbol object properly, it might be misplaced");return m};a.applyPerVertexElevationAlignment=function(n,l,m,t,w,r,x,D,A,v,B){const C=g[B.mode];let E=0;if(u.projectBuffer(n,l,m,t,A.spatialReference,w,D)&&(C.requiresAlignment(B)?(E=C.applyElevationAlignmentBuffer(t,w,r,x,D,A,v,B),n=r,w=x):n=t,u.projectBuffer(n,A.spatialReference,
w,r,v.spatialReference,x,D)))return E};a.elevationModeChangeUpdateType=function(n,l,m){return null==l||null==m?n.definedChanged:"on-the-ground"===l&&"on-the-ground"===m?n.staysOnTheGround:l===m||"on-the-ground"!==l&&"on-the-ground"!==m?a.SymbolUpdateType.UPDATE:n.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(n,l,m,t){f(n,l,m,t,h);return h.z};a.evaluateElevationInfoAtPoint=f;a.needsElevationUpdates2D=function(n){return"relative-to-ground"===n||"relative-to-scene"===n};a.needsElevationUpdates3D=
function(n){return"absolute-height"!==n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(w){var r=w.paths[0];if(!r||0===r.length)return null;r=e.getPointOnPath(r,e.getPathLength(r)/2);return h.makeDehydratedPoint(r[0],r[1],r[2],w.spatialReference)}function m(w,r,x){x=x?w:z.clonePoint(w);return r&&w?k.projectPoint(w,x,r)?x:null:x}function t(w){const r=x=>null==x||0<=x;return Array.isArray(w)?w.every(r):null==w||0<=w}a.computeCentroid=function(w,r){if("point"===w.type)return m(w,r,!1);if(z.isHydratedGeometry(w))switch(w.type){case "extent":return m(w.center,
r,!1);case "polygon":return m(w.centroid,r,!1);case "polyline":return m(l(w),r,!0);case "mesh":return m(w.origin,r,!1)}else switch(w.type){case "extent":return w=h.makeDehydratedPoint(.5*(w.xmax+w.xmin),.5*(w.ymax+w.ymin),null!=w.zmin&&null!=w.zmax&&isFinite(w.zmin)&&isFinite(w.zmax)?.5*(w.zmax+w.zmin):void 0,w.spatialReference),m(w,r,!0);case "polygon":var x=w.rings[0];x&&0!==x.length?(x=g.ringsCentroid(w.rings,!!w.hasZ),w=h.makeDehydratedPoint(x[0],x[1],x[2],w.spatialReference)):w=null;return m(w,
r,!0);case "polyline":return m(l(w),r,!0)}};a.computeObjectRotation=function(w,r,x,D=y.create()){w&&c.rotateZ(D,D,-w/180*Math.PI);r&&c.rotateX(D,D,r/180*Math.PI);x&&c.rotateY(D,D,x/180*Math.PI);return D};a.computeObjectScale=function(w=p.ONES,r,x,D=1){const A=Array(3);if(null==r||null==x)A[0]=1,A[1]=1,A[2]=1;else{let B=0;for(let C=2;0<=C;C--){const E=w[C];let F;const M=null!=E,K=0===C&&!v&&!M,G=x[C];"symbol-value"===E||K?F=0!==G?r[C]/G:1:M&&"proportional"!==E&&isFinite(E)&&(F=0!==G?E/G:1);if(null!=
F){var v=A[C]=F;B=Math.max(B,Math.abs(F))}}for(w=2;0<=w;w--)null==A[w]?A[w]=v:0===A[w]&&(A[w]=.001*B)}for(v=2;0<=v;v--)A[v]/=D;return p.fromArray(A)};a.demResolutionForBoundingBox=function(w,r,x){if(null!=x.minDemResolution)return x.minDemResolution;const D=b.getMetersPerUnitForSR(r),A=d.width(w)*D,v=d.depth(w)*D;w=d.height(w)*(r.isGeographic?1:D);return 0===A&&0===v&&0===w?x.minDemResolutionForPoints:.01*Math.max(A,v,w)};a.enlargeExtent=function(w,r,x,D=0){if(w){r||(r=f.create());let A=.5*w.width*
(x-1);x=.5*w.height*(x-1);w.width<1E-7*w.height?A+=x/20:w.height<1E-7*w.width&&(x+=A/20);u.set(r,w.xmin-A-D,w.ymin-x-D,w.xmax+A+D,w.ymax+x+D);return r}return null};a.isValidSize=t;a.mixinColorAndOpacity=function(w,r,x=null){const D=q.clone(q.ONES);null!=w&&(D[0]=w[0],D[1]=w[1],D[2]=w[2]);null!=r?D[3]=r:null!=w&&3<w.length&&(D[3]=w[3]);x&&(D[0]*=x,D[1]*=x,D[2]*=x,D[3]*=x);return D};a.overrideColor=function(w,r,x,D,A,v=[0,0,0,0]){for(let B=0;3>B;++B)v[B]=null!=w&&null!=w[B]?w[B]:null!=x&&null!=x[B]?
x[B]:A[B];v[3]=null!=r?r:null!=D?D:A[3];return v};a.updateVertexAttributeAuxpos1w=function(w,r){for(let x=0;x<w.geometries.length;++x){const D=w.geometries[x].getMutableAttribute(n.VertexAttribute.AUXPOS1);D&&D.data[3]!==r&&(D.data[3]=r,w.geometryVertexAttrsUpdated(w.geometries[x]))}};a.validateSymbolLayerSize=function(w){return t(null!=w.isPrimitive?[w.width,w.depth,w.height]:w)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,b,c){c=function(y){function p(){return y.apply(this,arguments)||this}b._inherits(p,y);return b._createClass(p)}(c.Geometry);a.GeometryWithMapPositions=c;a.isGeometryWithMapPositions=function(y){return null!=y.mapPositions};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../symbols/support/unitConversionUtils",
"./featureExpressionInfoUtils"],function(a,b,c,y){let p=function(){function u(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var q=u.prototype;q.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};q.addOffsetRenderUnits=function(k){this._renderUnitOffset+=k};q.geometryZWithOffset=
function(k,d){d=this.calculateOffsetRenderUnits(d);return null!=this.featureExpressionInfoContext?d:k+d};q.calculateOffsetRenderUnits=function(k){let d=this._meterUnitOffset;const f=this.featureExpressionInfoContext;null!=f&&(d+=y.execute(f)*this._metersPerElevationInfoUnit);return d/k.unitInMeters+this._renderUnitOffset};q.setFromElevationInfo=function(k){this.mode=k.mode;this.unit=c.supportsUnit(k.unit)?k.unit:"meters";this.offsetElevationInfoUnits=k.offset??0};q.updateFeatureExpressionInfoContext=
function(k,d,f){if(null==k)this._featureExpressionInfoContext=null;else{var g=k&&k.arcade;g&&null!=d&&null!=f?(this._featureExpressionInfoContext=y.clone(k),y.setContextFeature(this._featureExpressionInfoContext,y.createFeature(g.modules,d,f))):this._featureExpressionInfoContext=k}};u.fromElevationInfo=function(k){const d=new u;null!=k&&d.setFromElevationInfo(k);return d};b._createClass(u,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",
get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(k){this._unit=k;this._metersPerElevationInfoUnit=c.getMetersPerUnit(k)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(k){this._meterUnitOffset=k;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(k){this._meterUnitOffset=k*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return u}();a.ElevationContext=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,c,y,p){const u=b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(q){return{cachedResult:q.cachedResult,arcade:q.arcade?{func:q.arcade.func,context:q.arcade.modules.arcadeUtils.createExecContext(null,
{sr:q.arcade.context.spatialReference}),modules:q.arcade.modules}:null}};a.createContext=async function(q,k,d,f){q=q&&q.expression;if("string"!==typeof q)return null;var g="0"===q?0:null;if(null!=g)return{cachedResult:g};g=await p.loadArcade();c.throwIfAborted(d);d=g.arcadeUtils;q=d.createSyntaxTree(q);return d.dependsOnView(q)?(null!=f&&f.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(q),context:d.createExecContext(null,
{sr:k}),modules:g}}};a.createContextWithoutExpressionSupport=function(q){q=q&&q.expression;return"string"===typeof q&&(q="0"===q?0:null,null!=q)?{cachedResult:q}:null};a.createFeature=function(q,k,d){return q.arcadeUtils.createFeature(k.attributes,k.geometry,d)};a.execute=function(q){if(null!=q){if(null!=q.cachedResult)return q.cachedResult;var k=q.arcade;k=k?.modules.arcadeUtils.executeFunction(k.func,k.context);"number"!==typeof k&&(k=q.cachedResult=0);return k}return 0};a.extractExpressionInfo=
function(q,k=!1){const d=(q=q&&q.featureExpressionInfo)&&q.expression;k||"0"===d||(q=null);return q??null};a.setContextFeature=function(q,k){null!=q&&null==q.cachedResult&&(k&&q.arcade?(k._geometry&&(k._geometry=y.hydrateGeometry(k._geometry)),q.arcade.modules.arcadeUtils.updateExecContext(q.arcade.context,k)):u.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],
function(a){return a._createClass(function(b,c,y){this.graphic=b;this.renderingInfo=c;this.layer=y})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(w){return w.isVisible()?w.parameters.transparent?g.Transparency.TRANSPARENT:g.Transparency.OPAQUE:g.Transparency.INVISIBLE}let h=b._createClass(function(w,r,x){this.baseMaterial=w;this.edgeMaterials=r;this.properties=x}),z=function(){function w(x,D,A,v,B,C,E,F=null){this.graphics3DSymbolLayer=x;this.stageObject=D;this._uniqueGeometries=A;this._uniqueMaterials=v;this._sharedResource=B;this.elevationAligner=C;this.elevationContext=E;this._edgeState=F;this.type=
"object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}var r=w.prototype;r.initialize=function(x){this._stageLayer=x;x=x.stage;x.addMany(this._uniqueMaterials);x.addMany(this._uniqueGeometries);x.add(this.stageObject)};r.destroy=function(){if(this._stageLayer){var x=this._stageLayer.stage;x.removeMany(this._uniqueMaterials);x.removeMany(this._uniqueGeometries);x.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);x=x.renderer.ensureEdgeView();x.hasObject(this.stageObject)&&x.removeObject(this.stageObject);this.stageObject.dispose();null!=this._sharedResource&&this._sharedResource.release();this._visible=!1;this._stageLayer=null}};r.layerOpacityChanged=function(x,D){if(null!=this._edgeState){var A=e(this._edgeState.baseMaterial),v=!1;for(const B of this._edgeState.edgeMaterials)B.objectTransparency!==A&&(B.objectTransparency=
A,v=!0);v&&this.resetEdgeObject(D);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[x])}};r.slicePlaneEnabledChanged=function(x,D){null!=this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:x},!D),this._edgeState.properties.hasSlicePlane=x)};r.setVisibility=function(x){if(null!=this._stageLayer&&this._visible!==x&&(this._visible=x,this.stageObject.visible=
x,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const D=this._stageLayer.stage.renderer.ensureEdgeView();D.hasObject(this.stageObject)?D.updateObjectVisibility(this.stageObject,x):x&&this._addOrUpdateEdgeObject(D,!1)}};r.alignWithElevation=function(x,D,A,v){null!=this.elevationAligner&&(null!=A&&k.setContextFeature(this.elevationContext.featureExpressionInfoContext,A),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,
x.spatialReference,(B,C)=>q.evaluateElevationInfoAtPoint(B,x,this.elevationContext,D,C),D),this.resetEdgeObject(v))};r.alignWithAbsoluteElevation=function(x,D,A){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(v,B)=>{B.sampledElevation=x;B.verticalDistanceToGround=0;B.z=x},D);this.resetEdgeObject(A)};r.getCenterObjectSpace=function(x=y.create()){return c.copy(x,u.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};r.getBoundingBoxObjectSpace=function(x=
p.create()){const D=this.stageObject.boundingVolumeObjectSpace;p.setMin(x,D.min);p.setMax(x,D.max);return x};r.computeAttachmentOrigin=function(x){if(this.useObjectOriginAsAttachmentOrigin){var D=this.stageObject.shaderTransformation;x.render.origin[0]+=D[12];x.render.origin[1]+=D[13];x.render.origin[2]+=D[14];x.render.num++}else for(D of this.stageObject.geometries)D.computeAttachmentOrigin(m)&&(c.transformMat4(m,m,this.stageObject.shaderTransformation),c.add(x.render.origin,x.render.origin,m),x.render.num++)};
r.getProjectedBoundingBox=async function(x,D,A,v,B){B=this.getBoundingBoxObjectSpace(B);var C=t,E=p.isPoint(B)?1:C.length;for(var F=0;F<E;F++){const M=C[F];l[0]=B[M[0]];l[1]=B[M[1]];l[2]=B[M[2]];c.transformMat4(l,l,this.stageObject.transformation);n[3*F]=l[0];n[3*F+1]=l[1];n[3*F+2]=l[2]}if(!x(n,0,E))return null;p.empty(B);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(C=0;C<3*E;C+=3){for(F=0;3>F;F++)B[F]=Math.min(B[F],n[C+F]),B[F+3]=Math.max(B[F+3],n[C+F]);
x&&A.push({location:n.slice(C,C+3),screenSpaceBoundingRect:x})}if(D&&D.service&&"absolute-height"!==this.elevationContext.mode){p.center(B,m);A="relative-to-scene"===this.elevationContext.mode?"scene":"ground";E=0;if(D.useViewElevation)E=D.service.getElevation(m[0],m[1],A)??0;else try{const M=d.demResolutionForBoundingBox(B,D.service.spatialReference,D);E=await D.service.queryElevation(m[0],m[1],v,M,A)??0}catch(M){}p.offset(B,0,0,-this.alignedSampledElevation+E)}return B};r.addObjectState=function(x,
D){x===f.Object3DState.Highlight&&D.addObject(this.stageObject,this.stageObject.highlight());x===f.Object3DState.MaskOccludee&&D.addObject(this.stageObject,this.stageObject.maskOccludee())};r.removeObjectState=function(x){x.removeObject(this.stageObject)};r.resetEdgeObject=function(x){if(null!=this._edgeState){var D=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(D,x):D.removeObject(this.stageObject)}};r._addOrUpdateEdgeObject=function(x,D){const A=this._edgeState;
if(null!=A){var v=e(A.baseMaterial);for(const B of A.edgeMaterials)B.objectTransparency=v;x.addOrUpdateObject3D(this.stageObject,A.edgeMaterials,A.properties,!D).then(()=>this._stageLayer?.sync())}};b._createClass(w,[{key:"isElevationSource",get:function(){return!!this.stageObject.lastValidElevationBB}},{key:"visible",get:function(){return this._visible}}]);return w}();const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=y.create(),m=y.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,
1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=z;a.Object3DEdgeState=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,y=null){this.labelText=y;this.elevationOffset=c??0});a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity ../support/FastSymbolUpdates".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(x){const D={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};x&&"visualVariables"in x&&x.visualVariables&&x.visualVariables.forEach(A=>{switch(A.type){case "color":D.color=!0;if(A.stops)for(let v=0;v<A.stops.length;v++){const B=A.stops[v].color;B&&(D.opacity=!0,1>B.a&&(D.opacityAlwaysOpaque=!1))}break;case "opacity":D.opacity=!0;D.opacityAlwaysOpaque=!1;break;case "size":D.size=!0}});return D}const m=p.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
y=function(x){function D(v,B,C,E){var F=x.call(this,C.schedule)||this;F.symbol=v;F.symbolLayer=B;F._context=C;F._elevationInfoOverride=null;F.ignoreDrivers=!1;F._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};F.complexity=null;F.logger=m;F._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};F.skipHighSymbolLodsChanged=!0;F._renderPriority=E.renderPriority;F._renderPriorityStep=E.renderPriorityStep;F._elevationContext=new d.ElevationContext;F.complexity=F.computeComplexity();
F.ignoreDrivers=E.ignoreDrivers;F.ignoreDrivers||(F._drivenProperties=l(F._context.renderer));F._updateElevationContext();return F}b._inherits(D,x);var A=D.prototype;A.getCachedSize=function(){return null};A._drivenPropertiesChanged=function(v){if(this.ignoreDrivers)return!1;const B=this._drivenProperties;v=l(v);return v.color!==B.color||v.opacity!==B.opacity||v.opacityAlwaysOpaque!==B.opacityAlwaysOpaque||v.size!==B.size};A._logGeometryCreationWarnings=function(v,B,C,E){const F="polygons"in v?v.polygons:
null,M=`${E} geometry failed to be created`;let K=null;v.projectionSuccess?!this._logGeometryValidationWarnings(B,C,E)&&F&&0===F.length&&"rings"===C&&0<B.length&&2<B[0].length&&(K=`${M} (filled rings should use clockwise winding - try reversing the order of vertices)`):K=`${M} (failed to project geometry to view spatial reference)`;K&&m.warnOncePerTick(K)};A._logGeometryValidationWarnings=function(v,B,C){C=`${C} geometry failed to be created`;return!v.length||1===v.length&&!v[0].length?(m.warnOncePerTick(`${C} (no ${B} were defined)`),
!0):Array.isArray(v)&&Array.isArray(v[0])?!1:(m.warnOncePerTick(`${C} (${B} should be defined as a 2D array)`),!0)};A._validateGeometry=function(v,B=null,C=null){return null==B||B.includes(v.type)?"point"!==v.type||isFinite(v.x)&&isFinite(v.y)?!0:(m.warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+C+` symbol: ${v.type}`),!1)};A._defaultElevationInfoNoZ=function(){return t};A._defaultElevationInfoZ=function(){return w};A._updateElevationContext=
function(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};A.getDefaultElevationInfo=function(v){return v.hasZ?this._defaultElevationInfoZ():
this._defaultElevationInfoNoZ()};A.getGeometryElevationMode=function(v,B=this.getDefaultElevationInfo(v)){return this._elevationContext.mode||B.mode};A.setElevationInfoOverride=function(v){this._elevationInfoOverride=v;this._updateElevationContext()};A.setGraphicElevationContext=function(v,B){var C=v.geometry;const E=this.getDefaultElevationInfo(C);B.unit=null!=this._elevationContext.unit?this._elevationContext.unit:E.unit;B.mode=this.getGeometryElevationMode(C,E);B.offsetMeters=this._elevationContext.meterUnitOffset??
E.offset??0;if(C=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===B.mode)B.mode="relative-to-ground",B.offsetMeters=0;B.updateFeatureExpressionInfoContext(C?f.zeroContext:this._elevationContext.featureExpressionInfoContext,v,this._context.layer);return B};A.prepareSymbolLayerPatch=function(v){};A.updateGeometry=function(v,B){return!1};A.updateTransform=function(v,B,C,E){return!1};A.onRemoveGraphic=function(v){};A._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in
this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const v=this._context.layer.opacity;return null==v?1:v};A._getCombinedOpacity=function(v,B=r){let C=1;this.draped||(C*=this._getLayerOpacity());if(this._drivenProperties.opacity)return C;null!=v?C*=v.a:B.hasIntrinsicColor||(C=0);return C};A._getCombinedOpacityAndColor=function(v,B=r){B=this._getCombinedOpacity(v,B);if(this._drivenProperties.color)return g.mixinColorAndOpacity(null,B);v=null!=v?c.toUnitRGB(v):u.ONES;
return g.mixinColorAndOpacity(v,B)};A._getVertexOpacityAndColor=function(v,B=null){v=g.mixinColorAndOpacity(this._drivenProperties.color?v.color:null,this._drivenProperties.opacity?v.opacity:null);B&&(v[0]*=B,v[1]*=B,v[2]*=B,v[3]*=B);return v};A.isFastUpdatesEnabled=function(){return null!=this._fastUpdates};A.computeComplexity=function(){return z.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};A.globalPropertyChanged=function(v,B,C){switch(v){case "opacity":return this.layerOpacityChanged(B,
C),!0;case "elevationInfo":return v=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(B,C,v)===k.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(B,C);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}};A.updateGraphics3DGraphicElevationInfo=function(v,B,C){let E=
k.SymbolUpdateType.UPDATE;v.forEach(F=>{const M=B(F);null!=M?(this.setGraphicElevationContext(F.graphic,M.elevationContext),M.needsElevationUpdates=C(M.elevationContext.mode)):E=k.SymbolUpdateType.RECREATE});return E};A.applyRendererDiff=function(v,B){return e.ApplyRendererDiffResult.RecreateSymbol};A.getFastUpdateAttrValues=function(v){if(!this._fastUpdates)return null;const B=this._fastUpdates.visualVariables,C=B.size?n.getAttributeValue(B.size.field,v):0,E=B.color?n.getAttributeValue(B.color.field,
v):0;v=B.opacity?n.getAttributeValue(B.opacity.field,v):0;return q.fromValues(C,E,v,0)};A.ensureDrapedStatus=function(v){if(null==this._draped)return this._draped=v,!0;v!==this.draped&&m.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};A.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??
null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}};b._createClass(D,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"pixelRatioChanged",get:function(){return!0}},{key:"draped",get:function(){return this._draped}}]);
return D}(h.Loadable);const t={mode:"on-the-ground",offset:0,unit:"meters"},w={mode:"absolute-height",offset:0,unit:"meters"},r={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.RecreateSymbol=0]="RecreateSymbol";b[b.RecreateGraphics=1]="RecreateGraphics";
b[b.FastUpdate=2]="FastUpdate";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,c,y){let p=function(){function u(k){this.schedule=k;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}var q=u.prototype;q.destroy=function(){this.abortLoad()};
q.load=function(k,d){if(this._loadStatus===a.LoadStatus.LOADED)return k&&k(),this._loader??Promise.resolve();if(this._loadStatus===a.LoadStatus.FAILED)return d&&d(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},f=>{this._loadError=f;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!y.isAbortError(f)&&
this.logger&&f.message&&this.logger.warn(f.message);throw f;}));this._loader.then(k,d).catch(()=>{});return this._loader};q.abortLoad=function(){null!=this._abortController?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};b._createClass(u,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return u}();a.LoadStatus=void 0;(function(u){u[u.LOADING=0]="LOADING";u[u.LOADED=1]="LOADED";
u[u.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(a,b,c,y,
p,u,q,k){function d(l){let m=0,t=0,w=0,r=!1,x=0;const D={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const A of l)null!=A&&(m+=A.primitivesPerFeature,t+=A.primitivesPerCoordinate,w+=A.drawCallsPerFeature,D.bytesPerFeature+=A.memory.bytesPerFeature,D.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,D.bytesPerCoordinate+=A.memory.bytesPerCoordinate,D.resourceBytes+=A.memory.resourceBytes,
D.draped.bytesPerFeature+=A.memory.bytesPerFeature,D.draped.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,D.draped.bytesPerCoordinate+=A.memory.bytesPerCoordinate,r=r||A.estimated,++x);return{primitivesPerFeature:m,primitivesPerCoordinate:t,drawCallsPerFeature:w,estimated:r,memory:D,numComplexities:x}}function f(l,m){const t=g(l,m);var w=u.hasEdges(m)?2:0;switch(m.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:w,estimated:!1,memory:t};case "fill":return"mesh-3d"===
l.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:w,estimated:!1,memory:t}:null!=m.outline&&0<m.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:t}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:t};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:t};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,
drawCallsPerFeature:0,estimated:!1,memory:t};case "object":return m.resource?.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:t}:{...e(m.resource&&m.resource.primitive||c.defaultPrimitive),memory:t};case "path":var r=l=0;switch(m.profile){case "circle":l=y.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS;break;case "quad":l=4;break;default:b.neverReached(m.profile);return}switch(m.join??"simple"){case "round":r=y.PATH_NUM_ROUND_JOIN_SUBDIVISIONS;break;case "miter":case "bevel":r=
1;break;default:return}w=2*l;r=l*r*2;let x=-2*r-w;switch(m.cap){case "none":break;case "butt":case "square":x+=2*(l-1);break;case "round":x+=2*(l*(y.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS-1)*2+l);break;default:return}return{primitivesPerFeature:x,primitivesPerCoordinate:r+w,drawCallsPerFeature:0,estimated:!1,memory:t};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:t}}}function g(l,m){l="point-3d"===l.type;switch(m.type){case "extrude":return m.edges&&
0<m.edges.size?n.EXTRUDE_EDGES:n.EXTRUDE;case "fill":return null!=m.outline&&0<m.outline.size?n.FILL_OUTLINE:n.FILL;case "water":return n.FILL;case "line":return"round"===m.join?n.LINE_ROUND:n.LINE_MITER;case "path":switch(m.join){case "round":switch(m.profile){case "circle":return n.PATH_ROUND_CIRCLE;case "quad":return n.PATH_ROUND_QUAD;default:b.neverReached(m.profile);return}case "miter":case "bevel":switch(m.profile){case "circle":return n.PATH_MITER_CIRCLE;case "quad":return n.PATH_MITER_QUAD;
default:b.neverReached(m.profile);return}case "simple":return;default:return}case "object":return l?n.OBJECT_POINT:n.OBJECT_POLYGON;case "icon":case "text":return l?n.ICON_POINT:n.ICON_POLYGON}}function e(l){var m=z[l];if(m)return m;m=p.primitiveLodResources(l,null);m={primitivesPerFeature:k.geometriesFromLodLevelResources(m.levels[0]).reduce((t,w)=>t+w.indices.get(q.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return z[l]=m}const h={primitivesPerFeature:0,
primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},z={},n={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,
bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,
resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,
resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,
resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,
resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,
resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,
resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}};a.averageSymbolComplexities=function(l){l=d(l);0<l.numComplexities&&(l.primitivesPerFeature/=l.numComplexities,l.primitivesPerCoordinate/=l.numComplexities,l.drawCallsPerFeature/=l.numComplexities,l.memory.bytesPerFeature/=l.numComplexities,l.memory.bytesPerFeatureLabel/=l.numComplexities,l.memory.bytesPerCoordinate/=l.numComplexities,l.memory.resourceBytes/=
l.numComplexities,l.memory.draped.bytesPerFeature/=l.numComplexities,l.memory.draped.bytesPerFeatureLabel/=l.numComplexities,l.memory.draped.bytesPerCoordinate/=l.numComplexities);return l};a.defaultSymbolComplexity=function(l){if("web-style"===l.type)return h;const m=l.symbolLayers.toArray().map(t=>f(l,t));return d(m)};a.defaultSymbolLayerComplexity=f;a.defaultSymbolLayerMemoryComplexity=g;a.emptySymbolComplexity=h;a.memoryEstimators=n;a.totalSymbolComplexities=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],function(a){a.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.PATH_NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],
function(a,b,c,y){const p=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(u){switch(u){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(u,q){const k=(d,f,g=!1)=>({levels:d.map(e=>{const h=f(e.tesselation);g&&c.cgToGIS(h);return{components:[new y.LodComponentResources(h)],faceCount:h.indexCount/
3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(u){case "sphere":return k([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],d=>c.createPolySphereGeometry(q,.5,d,!0));case "cube":return k([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(q,1));case "cone":return k(p,d=>c.createConeGeometry(q,1,.5,d,!1),!0);case "inverted-cone":return k(p,
d=>c.createConeGeometry(q,1,.5,d,!0),!0);case "cylinder":return k(p,d=>c.createCylinderGeometry(q,1,.5,d,[0,0,1],[0,0,.5]));case "tetrahedron":return k([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(q,1),!0);case "diamond":return k([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(q,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/arrayUtils"],function(a,b,c){b=b._createClass(function(y,p=null){this.geometry=y;this.textures=p});a.LodComponentResources=b;a.geometriesFromLodLevelResources=function(y){y=y.components.map(p=>p.geometry);return c.unique(y)};a.geometriesFromLodResources=function(y){const p=[];y.levels.forEach(u=>{u.components.forEach(q=>{p.push(q.geometry)})});return c.unique(p)};a.materialsFromLodResources=function(y){const p=[];y.levels.forEach(u=>u.components.forEach(q=>p.push(q.geometry.material)));
return c.unique(p)};a.texturesFromLodResources=function(y){const p=[];y.levels.forEach(u=>{u.components.forEach(q=>{null!=q.textures&&p.push(...q.textures)})});return c.unique(p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,y,p,u,
q){function k(e,h){if(null==e)return null;const z=null!=e.color?p.fromArray(b.toUnitRGBA(e.color)):p.fromValues(0,0,0,0),n=y.pt2px(e.size),l=y.pt2px(e.extensionLength);switch(e.type){case "solid":return d({color:z,size:n,extensionLength:l,...h});case "sketch":return{...g,color:z,size:n,extensionLength:l,...h,type:"sketch"}}}function d(e){return{...f,...e,type:"solid"}}const f={color:p.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:q.Transparency.OPAQUE,hasSlicePlane:!1},
g={color:p.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:q.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(e,h){return k(e&&e.enabled&&e.edges||null,h)};a.createMaterialFromEdges=k;a.createSolidEdgeMaterial=d;a.hasEdges=function(e){return e&&e.enabled&&(u.isExtrudeSymbol3DLayer(e)||u.isFillSymbol3DLayer(e))&&null!=e.edges};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,c,y,p,u,q,k,d){const f=b.create();a.createStageObject=function(g,e,h,z,n,l){const m=g.clippingExtent;c.projectPointToVector(e,f,g.elevationProvider.spatialReference);if(null!=m&&!y.containsPoint(m,f))return null;c.projectPointToVector(e,f,g.renderCoordsHelper.spatialReference);h.shaderTransformer=l;h.localOrigin=g.localOriginFactory.getOrigin(f);h=new d.Object3D({geometries:[h],castShadow:!1,layerUid:g.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});g=q.applyElevationAlignmentForHUD(h,
e,g.elevationProvider,g.renderCoordsHelper,z);return{object:h,sampledElevation:g}};a.extendPointGraphicElevationContext=function(g,e,h){g=g.elevationContext;h=h.spatialReference;c.projectPointToVector(e,f,h);g.centerPointInElevationSR=u.makeDehydratedPoint(f[0],f[1],e.hasZ?f[2]:0,null!=h?h:null)};a.placePointOnGeometry=function(g){switch(g.type){case "point":return g;case "polygon":case "extent":return k.computeCentroid(g);case "polyline":var e=g.paths[0];if(!e||0===e.length)break;e=p.getPointOnPath(e,
p.getPathLength(e)/2);return u.makeDehydratedPoint(e[0],e[1],e[2],g.spatialReference);case "mesh":return g.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){f=function(D){function A(B={}){var C=D.call(this)||this;C.type=g.ContentObjectType.Object;C._hasVolatileTransformation=!1;C._parentLayer=null;C._visible=!0;C.castShadow=B.castShadow??!0;C.usesVerticalDistanceToGround=B.usesVerticalDistanceToGround??!1;C.graphicUid=B.graphicUid;C.layerUid=B.layerUid;B.isElevationSource&&(C.lastValidElevationBB=new n);C._geometries=B.geometries?Array.from(B.geometries):[];return C}b._inherits(A,D);var v=A.prototype;v.clearShaderTransformation=
function(){this._shaderTransformation=void 0;this._invalidateBoundingVolume();this._emit("objectShaderTransformation",this)};v.dispose=function(){this._geometries.length=0};v.addGeometry=function(B){B.visible=this._visible;this._geometries.push(B);this._hasVolatileTransformation=this._hasVolatileTransformation||B.hasVolatileTransformation;this._emit("objectGeometryAdded",{object:this,geometry:B});this._invalidateBoundingVolume()};v.removeGeometry=function(B){if(B=this._geometries.splice(B,1)[0])this._emit("objectGeometryRemoved",
{object:this,geometry:B}),this._invalidateBoundingVolume()};v.removeAllGeometries=function(){for(;0<this._geometries.length;)this.removeGeometry(0)};v.geometryVertexAttrsUpdated=function(B){this._emit("objectGeometryUpdated",{object:this,geometry:B});this._invalidateBoundingVolume()};v.maskOccludee=function(){const B=new e.Object3DStateID(d.Object3DState.MaskOccludee);for(const C of this._geometries)C.occludees=z.addObject3DStateID(C.occludees,B);this._emit("occlusionChanged",this);return B};v.removeOcclude=
function(B){for(const C of this._geometries)C.occludees=z.removeObject3DStateID(C.occludees,B);this._emit("occlusionChanged",this)};v.highlight=function(){const B=new e.Object3DStateID(d.Object3DState.Highlight);for(const C of this._geometries)C.highlights=z.addObject3DStateID(C.highlights,B);this._emit("highlightChanged",this);return B};v.removeHighlight=function(B){for(const C of this._geometries)C.highlights=z.removeObject3DStateID(C.highlights,B);this._emit("highlightChanged",this)};v.getCombinedStaticTransformation=
function(B,C){return c.multiply(C,this.transformation,B.transformation)};v.getCombinedShaderTransformation=function(B,C=y.create()){return c.multiply(C,this.shaderTransformation,B.shaderTransformation)};v.hasVolativeTransformation=function(){return this._hasVolatileTransformation};v._validateBoundingVolume=function(B,C){C=C===x.ObjectSpace;for(var E of this._geometries){var F=E.boundingInfo;if(F){var M=B,K=C?E.shaderTransformation:this.getCombinedShaderTransformation(E),G=F.bbMin;F=F.bbMax;if(c.hasIdentityRotation(K))for(K=
p.set(m,K[12],K[13],K[14]),p.add(t,G,K),p.add(w,F,K),G=0;3>G;++G)M.min[G]=Math.min(M.min[G],t[G]),M.max[G]=Math.max(M.max[G],w[G]);else if(p.transformMat4(t,G,K),p.exactEquals(G,F))for(G=0;3>G;++G)M.min[G]=Math.min(M.min[G],t[G]),M.max[G]=Math.max(M.max[G],t[G]);else{p.transformMat4(w,F,K);for(var L=0;3>L;++L)M.min[L]=Math.min(M.min[L],t[L],w[L]),M.max[L]=Math.max(M.max[L],t[L],w[L]);for(L=0;3>L;++L){p.copy(t,G);p.copy(w,F);t[L]=F[L];w[L]=G[L];p.transformMat4(t,t,K);p.transformMat4(w,w,K);for(let O=
0;3>O;++O)M.min[O]=Math.min(M.min[O],t[O],w[O]),M.max[O]=Math.max(M.max[O],t[O],w[O])}}}}p.lerp(B.bounds,B.min,B.max,.5);for(const O of this._geometries)E=O.boundingInfo,null!=E&&(G=C?O.shaderTransformation:this.getCombinedShaderTransformation(O),M=k.maxScale(G),p.transformMat4(r,E.center,G),G=p.distance(r,B.bounds),B.bounds[3]=Math.max(B.bounds[3],G+E.radius*M))};v._invalidateBoundingVolume=function(){const B=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&
B&&this._parentLayer.notifyObjectBBChanged(this,B)};v._emit=function(B,C){this._parentLayer&&this._parentLayer.events.emit(B,C)};b._createClass(A,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation??y.IDENTITY},set:function(B){this._transformation=c.copy(this._transformation??y.create(),B);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"shaderTransformation",get:function(){return this._shaderTransformation??
this.transformation},set:function(B){this._shaderTransformation=c.copy(this._shaderTransformation??y.create(),B);this._invalidateBoundingVolume();this._emit("objectShaderTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(B){h.assert(null==this._parentLayer||null==B,"Object3D can only be added to a single Layer");this._parentLayer=B}},{key:"visible",get:function(){return this._visible},set:function(B){if(this._visible!==B){this._visible=B;for(const C of this._geometries)C.visible=
this._visible;this._emit("visibilityChanged",this)}}},{key:"boundingVolumeWorldSpace",get:function(){if(!this._bvWorldSpace||this._hasVolatileTransformation)this._bvWorldSpace=this._bvWorldSpace||new l,this._validateBoundingVolume(this._bvWorldSpace,x.WorldSpace);return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){if(!this._bvObjectSpace||this._hasVolatileTransformation)this._bvObjectSpace=this._bvObjectSpace||new l,this._validateBoundingVolume(this._bvObjectSpace,x.ObjectSpace);
return this._bvObjectSpace}},{key:"test",get:function(){const B=this;return{hasGeometry:C=>B._geometries.includes(C),getGeometryIndex:C=>B._geometries.indexOf(C)}}}]);return A}(f.ContentObject);let n=function(){function D(){this.min=u.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=u.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}D.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return b._createClass(D)}(),
l=function(D){function A(){var v=D.apply(this,arguments)||this;v.bounds=q.create();return v}b._inherits(A,D);return b._createClass(A)}(n);const m=u.create(),t=u.create(),w=u.create(),r=u.create();var x;(function(D){D[D.WorldSpace=0]="WorldSpace";D[D.ObjectSpace=1]="ObjectSpace"})(x||(x={}));a.Object3D=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(x){function D(v){v=x.call(this,v,new m)||this;v._configuration=new z.LineCalloutTechniqueConfiguration;v._uniqueMaterialIdentifier=D.uniqueMaterialIdentifier(v.parameters);return v}b._inherits(D,x);var A=D.prototype;A.getPassParameters=function(){return this.parameters};A.getConfiguration=function(v,B){v=B?.slot!==f.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=
null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.depthHudEnabled=v;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?q.HUDSpace.Screen:q.HUDSpace.World;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasMultipassGeometry=B.multipassGeometry.enabled;
return this._configuration};A.intersect=function(){};A.requiresSlot=function(v,B){if(B===u.ShaderOutput.Color)switch(v){case f.RenderSlot.LINE_CALLOUTS:case f.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};A.createGLMaterial=function(v){return new l(v)};A.createBufferWriter=function(){return new r};A.validateParameters=function(v){v=D.uniqueMaterialIdentifier(v);v!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=v)};D.uniqueMaterialIdentifier=function(v){return JSON.stringify({screenOffset:v.screenOffset||
[0,0],centerOffsetUnits:v.centerOffsetUnits||"world"})};b._createClass(D,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return D}(d.Material),l=function(x){function D(){return x.apply(this,arguments)||this}b._inherits(D,x);D.prototype.beginSlot=function(A){return this.ensureTechnique(h.LineCalloutTechnique,A)};return b._createClass(D)}(k),m=function(x){function D(){var A=x.apply(this,arguments)||this;A.screenOffset=y.ZEROS;A.color=[0,0,0,1];A.size=1;A.occlusionTest=
!1;A.shaderPolygonOffset=1E-5;A.depthHUDAlignStart=!1;A.centerOffsetUnits="world";A.hasSlicePlane=!1;return A}b._inherits(D,x);return b._createClass(D)}(d.MaterialParameters);const t=p.newLayout().vec3f(g.VertexAttribute.POSITION).vec3f(g.VertexAttribute.NORMAL).vec2f(g.VertexAttribute.UV0).vec4f(g.VertexAttribute.AUXPOS1),w=[c.fromValues(0,0),c.fromValues(1,0),c.fromValues(0,1),c.fromValues(1,0),c.fromValues(1,1),c.fromValues(0,1)];let r=function(){function x(){this.vertexBufferLayout=t}var D=x.prototype;
D.elementCount=function(A){return 6*A.indices.get(g.VertexAttribute.POSITION).length};D.write=function(A,v,B,C,E){e.writePosition(B.indices.get(g.VertexAttribute.POSITION),B.vertexAttributes.get(g.VertexAttribute.POSITION).data,A,C.position,E,6);e.writeNormal(B.indices.get(g.VertexAttribute.NORMAL),B.vertexAttributes.get(g.VertexAttribute.NORMAL).data,v,C.normal,E,6);e.writeBufferVec4(B.indices.get(g.VertexAttribute.AUXPOS1),B.vertexAttributes.get(g.VertexAttribute.AUXPOS1).data,C.auxpos1,E,6);for(A=
0;A<w.length;++A)C.uv0.setVec(E+A,w[A])};return b._createClass(x)}();a.LineCalloutMaterial=n;a.Parameters=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(n){const l=new Float32Array(2);l[0]=n[0];l[1]=n[1];return l}function y(n,l){const m=new Float32Array(2);m[0]=n;m[1]=l;return m}function p(n,l){return new Float32Array(n,l,2)}function u(){return b()}function q(){return y(1,
1)}function k(){return y(1,0)}function d(){return y(0,1)}const f=b(),g=q(),e=k(),h=d(),z=Object.freeze(Object.defineProperty({__proto__:null,ONES:g,UNIT_X:e,UNIT_Y:h,ZEROS:f,clone:c,create:b,createView:p,fromValues:y,ones:q,unitX:k,unitY:d,zeros:u},Symbol.toStringTag,{value:"Module"}));a.ONES=g;a.UNIT_X=e;a.UNIT_Y=h;a.ZEROS=f;a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.ones=q;a.unitX=k;a.unitY=d;a.vec2f32=z;a.zeros=u})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){u=function(e){function h(){return e.apply(this,arguments)||this}c._inherits(h,e);var z=h.prototype;z.initializeConfiguration=function(n,l){l.spherical=n.viewingMode===y.ViewingMode.Global};z.initializeProgram=function(n){return new k.Program(n.rctx,h.shader.get().build(this.configuration),q.Default3D)};z.setPipelineState=function(n){n=n?f.CompareFunction.ALWAYS:f.CompareFunction.LESS;return this.configuration.depthHudEnabled?g.makePipelineState({depthTest:{func:n},
depthWrite:g.defaultDepthWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:n},colorWrite:g.defaultColorWriteParams})};z.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return c._createClass(h)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(d.LineCallout,()=>new Promise((e,h)=>a(["./LineCallout.glsl"],
e,h)));b.LineCalloutTechnique=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(w){const r=new z.ShaderBuilder,{vertex:x,fragment:D}=r;x.include(u.AlignPixel);r.include(q.HUD,w);r.include(p.SliceDraw,w);r.attributes.add(n.VertexAttribute.UV0,"vec2");x.uniforms.add(new g.Float4PassUniform("viewport",(A,v)=>v.camera.fullViewport),new e.FloatPassUniform("lineSize",(A,v)=>0<A.size?Math.max(1,A.size)*v.camera.pixelRatio:0),new f.Float2PassUniform("pixelToNDC",(A,v)=>b.set(t,2/v.camera.fullViewport[2],2/v.camera.fullViewport[3])),
new e.FloatPassUniform("borderSize",(A,v)=>null!=A.borderColor?v.camera.pixelRatio:0),new f.Float2PassUniform("screenOffset",(A,v)=>b.set(t,A.screenOffset[0]*v.camera.pixelRatio,A.screenOffset[1]*v.camera.pixelRatio)));r.varyings.add("coverageSampling","vec4");r.varyings.add("lineSizes","vec2");w.hasMultipassGeometry&&r.varyings.add("depth","float");w.hasScreenSizePerspective&&d.addScreenSizePerspectiveAlignment(x);x.code.add(h.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${w.occlusionTestEnabled?h.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${w.hasScreenSizePerspective?h.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:h.glsl`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${w.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${w.depthHudEnabled?w.depthHudAlignStartEnabled?h.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:h.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${w.hasScreenSizePerspective?h.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:h.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);D.uniforms.add(new g.Float4PassUniform("uColor",A=>m(A.color)),new g.Float4PassUniform("borderColor",A=>m(A.borderColor)));w.hasMultipassGeometry&&(D.include(k.multipassGeometryTest,w),D.uniforms.add(new f.Float2PassUniform("inverseViewport",(A,v)=>v.inverseViewport)));D.code.add(h.glsl`
    void main() {
      ${w.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${w.depthHudEnabled?h.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:h.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return r}function m(w){return null!=w?w:y.ZEROS}const t=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.LineCallout=c;a.build=l})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u){u=function(q){function k(){var d=q.apply(this,arguments)||this;d.screenCenterOffsetUnitsEnabled=y.HUDSpace.World;d.spherical=!1;d.occlusionTestEnabled=!0;d.hasVerticalOffset=!1;d.hasScreenSizePerspective=!1;d.depthHudEnabled=!1;d.depthHudAlignStartEnabled=!1;d.hasSlicePlane=!1;d.hasMultipassGeometry=!1;return d}b._inherits(k,q);return b._createClass(k)}(u.DefaultTechniqueConfiguration);c.__decorate([p.parameter({count:y.HUDSpace.COUNT})],u.prototype,"screenCenterOffsetUnitsEnabled",
void 0);c.__decorate([p.parameter()],u.prototype,"spherical",void 0);c.__decorate([p.parameter()],u.prototype,"occlusionTestEnabled",void 0);c.__decorate([p.parameter()],u.prototype,"hasVerticalOffset",void 0);c.__decorate([p.parameter()],u.prototype,"hasScreenSizePerspective",void 0);c.__decorate([p.parameter()],u.prototype,"depthHudEnabled",void 0);c.__decorate([p.parameter()],u.prototype,"depthHudAlignStartEnabled",void 0);c.__decorate([p.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],
u.prototype,"hasMultipassGeometry",void 0);c.__decorate([p.parameter({constValue:!0})],u.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"draped",void 0);a.LineCalloutTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(y){return y instanceof
c?y.graphics3DSymbol:y instanceof b?y:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),function(a,b,c,y,p,u,
q,k,d,f,g){let e=function(z){function n(m,t,w){var r=z.call(this,t.schedule)||this;r._symbol=m;r._context=t;r._backgroundLayers=w;r._destroyed=!1;r.symbolLayers=[];r.referenced=0;r._extentPadding=0;return r}a._inherits(n,z);var l=n.prototype;l.doLoad=async function(m){let t=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const w=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;
const r=[];for(let D=0;D<w;D++){var x=t.at(D);if(!1===x.enabled)continue;h.renderPriority=1-(1+D)/w;h.renderPriorityStep=1/w;h.ignoreDrivers=x.ignoreDrivers;const A=k.make(this.symbol,x,this._context,h);(x=y.onAbortOrThrow(m,()=>{this.symbolLayers[D]=null;A.destroy()}))&&r.push(x);this.symbolLayers[D]=A}await c.forEach(this.symbolLayers,async(D,A)=>{if(null!=D)try{await D.load(),this._extentPadding+=Math.max(this._extentPadding,D.extentPadding)}catch{this.symbolLayers[A]=null}});r.forEach(D=>D.remove());
y.throwIfAborted(m);if(this.symbolLayers.length&&!this.symbolLayers.some(D=>!!D))throw Error();};l.getSymbolLayerSize=function(m){m=this.symbolLayers[m];return null!=m?m.getCachedSize():null};l.createGraphics3DGraphic=function(m,t){const w=m.graphic,r=this.symbolLayers.map(x=>x?.createGraphics3DGraphic(m)??null);return new p(w,t||this,r,m.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||
null)};l.globalPropertyChanged=function(m,t){const w=this.symbolLayers.length;for(let r=0;r<w;r++){const x=this.symbolLayers[r],D=A=>{A=A.layers[r];return A instanceof u.Graphics3DObject3DGraphicLayer?A:null};if(null!=x&&!x.globalPropertyChanged(m,t,D))return!1}return!0};l.applyRendererDiff=function(m,t){return this.loadStatus!==f.LoadStatus.LOADED?d.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((w,r)=>w!==d.ApplyRendererDiffResult.RecreateSymbol&&null!=r?Math.min(w,r.applyRendererDiff(m,
t)):w,d.ApplyRendererDiffResult.FastUpdate)};l.prepareSymbolPatch=function(m){if(this.loadStatus!==f.LoadStatus.FAILED&&"partial"===m.diff.type){var t=m.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var w=t.symbolLayers.diff;this.symbolLayers.forEach((r,x)=>{if(null!=r){var D=w[x];if(D){const A={diff:D,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};r.prepareSymbolLayerPatch(A);m.symbolStatePatches.push(...A.symbolLayerStatePatches);A.graphics3DGraphicPatches.length&&m.graphics3DGraphicPatches.push((v,
B)=>{const C=v.layers[x];null!=C&&A.graphics3DGraphicPatches.forEach(E=>E(C,B))})}}})}}};l.updateGeometry=function(m,t){return this._updateGeometryOrTransform(m,(w,r)=>w.updateGeometry(r,t))};l.updateTransform=function(m,t,w,r){return this._updateGeometryOrTransform(m,(x,D)=>x.updateTransform(D,t,w,r))};l._updateGeometryOrTransform=function(m,t){for(let w=0;w<this.symbolLayers.length;w++){const r=this.symbolLayers[w];if(null==r)continue;const x=m.layers[w];if(!x||!t(r,x))return!1}return!0};l.onRemoveGraphic=
function(m){for(let t=0;t<this.symbolLayers.length;t++){const w=this.symbolLayers[t];if(null==w)continue;const r=m.layers[t];if(null!=r)w.onRemoveGraphic(r)}};l.getFastUpdateStatus=function(){let m=0,t=0,w=0;this.symbolLayers.forEach(r=>{null!=r&&(r.loadStatus===f.LoadStatus.LOADING?m++:r.isFastUpdatesEnabled()?w++:t++)});return{loading:m,slow:t,fast:w}};l.queryForSnapping=async function(m,t,w,r){var x=this.symbolLayers.filter(b.isSome).filter(D=>null!=D.queryForSnapping).map(D=>D.queryForSnapping(m,
t,w,r));x=await Promise.all(x);y.throwIfAborted(r);return x.flat()};l.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{a._get(a._getPrototypeOf(n.prototype),"destroy",this).call(this);for(const m of this.symbolLayers)null!=m&&m.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(n,[{key:"symbol",get:function(){return this._symbol},set:function(m){this._symbol=m;m.symbolLayers.forEach((t,w)=>{w=this.symbolLayers[w];
null!=w&&(w.symbol=m,w.symbolLayer=t)})}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(m=>null!=m&&m.queryForSnapping)}},{key:"complexity",get:function(){return g.totalSymbolComplexities(this.symbolLayers.map(m=>null!=m?m.complexity:null))}},{key:"destroyed",get:function(){return this._destroyed}}]);return n}(f.Loadable);const h=new q.Graphics3DSymbolLayerCreationContext;return e})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){const w=new p(Array,x=>e.set(x,e.ZERO),null,10,5),r=h.create();return function(){function x(A,v,B,C,E){this.graphic=A;this.graphics3DSymbol=v;this.layers=B;this._visibleFlags=m.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++v.referenced;this._featureExpressionFeature=E?t.createFeature(E,A,C):null}var D=x.prototype;D.initialize=function(A){this._layer=A;this._forEachSymbolLayerGraphic(v=>{v.initialize(A);v.setVisibility(this.isVisible())})};D.destroy=
function(){this._forEachSymbolLayerGraphic(A=>A.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};D.clearLabelGraphics=function(){this._forEachLabelGraphic(A=>A.destroy());this._labelLayers=null};D.addLabelGraphic=function(A,v){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(A);A.initialize(v);A.setVisibility(this.isVisible(m.VisibilityGroup.LABEL))};D.setCalloutGraphic=function(A){this._calloutLayer=A;this._layer&&(A.initialize(this._layer),
A.setVisibility(this.isVisible()))};D.isVisible=function(A=m.VisibilityGroup.GRAPHIC,v){v=v?this._visibleFlags|v|m.VisibilityGroup.LABEL*v:this._visibleFlags;return A===m.VisibilityGroup.GRAPHIC?(v&m.VisibilityFlag.ALL_GRAPHIC)===m.VisibilityFlag.ALL_GRAPHIC:(v&m.VisibilityFlag.ALL_LABEL)===m.VisibilityFlag.ALL_LABEL};D.setVisibilityFlag=function(A,v,B){const C=this.isVisible(A);this._visibleFlags=B?this._visibleFlags|A*v:this._visibleFlags&~(A*v);const E=this.isVisible(A);if(C===E)return!1;if(A===
m.VisibilityGroup.LABEL)this._forEachLabelGraphic(F=>F.setVisibility(E));else{this._forEachSymbolLayerGraphic(M=>M.setVisibility(E));const F=this.isVisible(m.VisibilityGroup.LABEL);this._forEachLabelGraphic(M=>M.setVisibility(F))}return!0};D.getVisibilityFlag=function(A,v){return 0!==(this._visibleFlags&A*v)};D.computeExtent=function(A){if(!this._extent){var v=this.graphic.geometry;if(null==v)return!1;this._extent=h.create();n.computeAABR(v,this._extent);v=v.spatialReference;if(!z.equals(v,A)&&!g.projectBoundingRect(this._extent,
v,this._extent,A))return this._extent=null,!1}return!0};D.getAsOptimizedGeometry=function(A,v){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,A,v));return this._optimizedGeometry};D._convertGraphicToOptimizedGeometry=function(A,v,B){A=A.geometry;if("mesh"===A.type||"extent"===A.type)A=f.fromExtent("mesh"===A.type?A.extent:A);return l.convertFromGeometry(A,v,B)};D.computeAttachmentOrigin=function(){const A={render:{origin:d.create(),num:0},draped:{origin:q.create(),
num:0}};for(const v of this.layers)null!=v&&v.computeAttachmentOrigin(A);1<A.render.num&&k.scale(A.render.origin,A.render.origin,1/A.render.num);1<A.draped.num&&u.scale(A.draped.origin,A.draped.origin,1/A.draped.num);return A};D.getProjectedBoundingBox=async function(A,v,B,C,E){E||(E={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});E.boundingBox?e.empty(E.boundingBox):E.boundingBox=e.empty();E.requiresDrapedElevation=!1;await c.forEach(this.layers,async F=>{if(null!=F){var M="draped"===
F.type?v:A,K=w.acquire();F=await F.getProjectedBoundingBox(M,B,E.screenSpaceObjects,C,K);isFinite(F[2])&&isFinite(F[5])||(E.requiresDrapedElevation=!0);F&&e.expandWithAABB(E.boundingBox,K);w.release(K)}});return e.allFinite(E.boundingBox)||h.allFinite(e.toRect(E.boundingBox,r))?E:null};D.needsElevationUpdates=function(){for(const A of this.layers)if(null!=A&&("object3d"===A.type||"lod-instance"===A.type)&&A.needsElevationUpdates)return!0;return this._labelLayers?.some(A=>A?.needsElevationUpdates??
!1)??!1};D.alignWithElevation=function(A,v,B){this._forEachRenderedGraphic(C=>{"object3d"!==C.type&&"lod-instance"!==C.type||C.alignWithElevation(A,v,this._featureExpressionFeature,B)})};D.alignWithAbsoluteElevation=function(A,v,B){this._forEachRenderedGraphic(C=>{"object3d"===C.type&&C.alignWithAbsoluteElevation(A,v,B)})};D.addObjectStateSet=function(A,v){this._forEachSymbolLayerGraphic(B=>B.addObjectState(A,v))};D.removeObjectState=function(A){this._forEachSymbolLayerGraphic(v=>v.removeObjectState(A))};
D._forEachGraphicList=function(A,v){A?.forEach(B=>B&&v(B))};D._forEachSymbolLayerGraphic=function(A){this._forEachGraphicList(this.layers,A);this._calloutLayer&&A(this._calloutLayer)};D._forEachLabelGraphic=function(A){this._forEachGraphicList(this._labelLayers,A)};D._forEachRenderedGraphic=function(A){this._forEachSymbolLayerGraphic(A);this._forEachLabelGraphic(A)};a._createClass(x,[{key:"labelLayers",get:function(){return this._labelLayers||b.EmptyArray}},{key:"extent",get:function(){return this._extent}},
{key:"isElevationSource",get:function(){return this.layers.some(A=>A?.isElevationSource)}},{key:"destroyed",get:function(){return null==this.layers}},{key:"calloutLayer",get:function(){return this._calloutLayer}},{key:"isDraped",get:function(){let A=!1;this._forEachSymbolLayerGraphic(v=>{"draped"===v.type&&(A=!0)});return A}},{key:"usedMemory",get:function(){let A=y.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(v=>{const B=v.graphics3DSymbolLayer.complexity;
null!=B&&(v="draped"===v.type?B.memory.draped:B.memory,A+=v.bytesPerFeature,v.bytesPerCoordinate&&(A+=n.numVertices(this.graphic.geometry)*v.bytesPerCoordinate))});return A}},{key:"test",get:function(){const A=this;return{addLabelLayer:v=>{A._labelLayers||(A._labelLayers=[]);A._labelLayers.push(v)}}}}]);return x}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(y,
p){this.scheduler=y;this.schedule=p;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1});b=b._createClass(function(){this.renderPriority=0;this.renderPriorityStep=
1;this.ignoreDrivers=!1});a.Graphics3DSymbolCreationContext=c;a.Graphics3DSymbolLayerCreationContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){const e={icon:y.Graphics3DIconSymbolLayer,object:q.Graphics3DObjectSymbolLayer,line:p.Graphics3DLineSymbolLayer,path:k.Graphics3DPathSymbolLayer,fill:d.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:f.Graphics3DTextSymbolLayer,water:g.Graphics3DWaterSymbolLayer},h={"mesh-3d":{fill:u.Graphics3DMeshFillSymbolLayer}};a.make=function(z,n,l,m){const t=h[z.type]?.[n.type]||e[n.type];return t?new t(z,n,l,m):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${n.type}`),null)};a.setSymbolClass=function(z,n){e[z]=n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Normals ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q){function S(qa,ua,sa,pa,ka,ra){const va=m.getZeroIndexArray(ua.length);ka=[[P.VertexAttribute.POSITION,new I.Attribute(pa.positions,3,!0)],[P.VertexAttribute.NORMALCOMPRESSED,new I.Attribute(pa.normals,2,!0)],[P.VertexAttribute.COLOR,new I.Attribute(ka,4,!0)]];return new N.Geometry(qa,ka,[[P.VertexAttribute.POSITION,ua],[P.VertexAttribute.NORMALCOMPRESSED,ua],[P.VertexAttribute.COLOR,va]],pa.elevation,J.ContentObjectType.Mesh,
ra,sa)}function U(qa,ua,sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa,Sa){let La=0;var Ua=2*pa.count,Va=pa.index,cb=pa.count,la=sa.length/3,eb=Ua;e.copy(ba,Qa);const ib=0<Ma?1:-1;Ua=3*Va;let Pa=0;Va=3*Pa;let za=cb;Qa=3*za;for(let Ga=0;Ga<cb;++Ga)Sa&&(ba[0]=qa[Ua],ba[1]=qa[Ua+1],ba[2]=qa[Ua+2],e.normalize(ba,ba)),ka[Va]=qa[Ua],ka[Va+1]=qa[Ua+1],ka[Va+2]=qa[Ua+2],ra[Va]=ua[Ua],ra[Va+1]=ua[Ua+1],ra[Va+2]=ua[Ua+2],va[Va]=-ib*ba[0],va[Va+1]=-ib*ba[1],va[Va+2]=-ib*ba[2],Ca[Pa]=0,ka[Qa]=qa[Ua]+Ma*ba[0],ka[Qa+1]=qa[Ua+1]+
Ma*ba[1],ka[Qa+2]=qa[Ua+2]+Ma*ba[2],ra[Qa]=ua[Ua],ra[Qa+1]=ua[Ua+1],ra[Qa+2]=ua[Ua+2],va[Qa]=ib*ba[0],va[Qa+1]=ib*ba[1],va[Qa+2]=ib*ba[2],Ca[za]=Ma,Va+=3,Qa+=3,Ua+=3,Pa+=1,za+=1;Va=Ua=0;Qa=3*eb;qa=0>Ma?ca:da;ua=0>Ma?da:ca;for(Sa=0;Sa<la;++Sa)Ha[Va]=sa[Ua+qa[0]],Ha[Va+1]=sa[Ua+qa[1]],Ha[Va+2]=sa[Ua+qa[2]],Ba[Qa]=sa[Ua+ua[0]]+cb,Ba[Qa+1]=sa[Ua+ua[1]]+cb,Ba[Qa+2]=sa[Ua+ua[2]]+cb,Va+=3,Qa+=3,Ua+=3;sa=2*pa.count;Ua=0;X(ka,ra,Ca,va,La,pa.pathLengths[0],pa.count,sa,Ba,Ua,Ma);sa+=4*pa.pathLengths[0];Ua+=
2*pa.pathLengths[0];La+=pa.pathLengths[0];for(Ha=1;Ha<pa.pathLengths.length;++Ha)X(ka,ra,Ca,va,La,pa.pathLengths[Ha],pa.count,sa,Ba,Ua,Ma),sa+=4*pa.pathLengths[Ha],Ua+=2*pa.pathLengths[Ha],La+=pa.pathLengths[Ha]}function V(qa,ua,sa,pa,ka,ra,va){pa[ra]=pa[va];va*=3;ra*=3;qa[ra]=qa[va];qa[ra+1]=qa[va+1];qa[ra+2]=qa[va+2];ua[ra]=ua[va];ua[ra+1]=ua[va+1];ua[ra+2]=ua[va+2];sa[ra]=ka[0];sa[ra+1]=ka[1];sa[ra+2]=ka[2]}function X(qa,ua,sa,pa,ka,ra,va,Ca,Ba,Ha,Ma){let Qa=ka,Sa=ka+1,La=ka+va,Ua=ka+va+1,Va=Ca,
cb=Ca+1,la=Ca+2*ra;Ca=Ca+2*ra+1;0>Ma&&(Qa=ka+va+1,Ua=ka);Ha*=3;for(let Fa=0;Fa<ra;++Fa){Fa===ra-1&&(0<Ma?(Sa=ka,Ua=ka+va):(Sa=ka,Qa=ka+va));var eb=qa,ib=Qa,Pa=Sa,za=La,Ga=Z;ib*=3;Pa*=3;za*=3;e.set(ea,eb[ib++],eb[ib++],eb[ib++]);e.set(ja,eb[Pa++],eb[Pa++],eb[Pa++]);e.set(ha,eb[za++],eb[za++],eb[za++]);e.subtract(ia,ja,ea);e.subtract(oa,ha,ea);e.cross(Ga,oa,ia);e.normalize(Ga,Ga);V(qa,ua,pa,sa,Z,Va,Qa);V(qa,ua,pa,sa,Z,cb,Sa);V(qa,ua,pa,sa,Z,la,La);V(qa,ua,pa,sa,Z,Ca,Ua);Ba[Ha++]=Va;Ba[Ha++]=la;Ba[Ha++]=
Ca;Ba[Ha++]=Va;Ba[Ha++]=Ca;Ba[Ha++]=cb;Qa++;Sa++;La++;Ua++;Va+=2;cb+=2;la+=2;Ca+=2}}const Y=["polygon","extent"];c=function(qa){function ua(pa,ka,ra,va){pa=qa.call(this,pa,ka,ra,va)||this;pa.ensureDrapedStatus(!1);return pa}b._inherits(ua,qa);var sa=ua.prototype;sa.doLoad=async function(){if(!this._drivenProperties.size){var pa=C.validateSymbolLayerSize(this._getSymbolSize());if(pa)throw new y("graphics3dextrudesymbollayer:invalid-size",pa);}var ka=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);
pa=h.fromArray(ka);ka=ka[3];const ra=1>ka||this.needsDrivenTransparentPass;pa={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:pa,ambient:pa,opacity:ka,transparent:ra,cullFace:ra?H.CullFaceOptions.None:H.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:O.NormalType.Compressed};this._material=new Q.DefaultMaterial(pa);this._bottomMaterial=new Q.DefaultMaterial({...pa,
cullFace:H.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)};sa.destroy=function(){b._get(b._getPrototypeOf(ua.prototype),"destroy",this).call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};sa.createGraphics3DGraphic=function(pa){const ka=pa.graphic;if(!this._validateGeometry(ka.geometry,Y,this.symbolLayer.type))return null;const ra=this._getVertexOpacityAndColor(pa.renderingInfo,
255),va=this.setGraphicElevationContext(ka,new A.ElevationContext);return this._createAs3DShape(ka,pa.renderingInfo,ra,va,ka.uid)};sa.layerOpacityChanged=function(pa,ka){const ra=this._getCombinedOpacity(this.symbolLayer?.material?.color),va=1>ra||this.needsDrivenTransparentPass;this._material.setParameters({opacity:ra,transparent:va});this._bottomMaterial.setParameters({opacity:ra,transparent:va});const Ca=this._getLayerOpacity();pa.forEach(Ba=>{Ba=ka(Ba);null!=Ba&&Ba.layerOpacityChanged(Ca,this._context.isAsync)})};
sa.layerElevationInfoChanged=function(pa,ka){return this.updateGraphics3DGraphicElevationInfo(pa,ka,D.needsElevationUpdates3D)};sa.slicePlaneEnabledChanged=function(pa,ka){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});pa.forEach(ra=>{ra=ka(ra);null!=ra&&ra.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};sa.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};sa._getExtrusionSize=function(pa){pa=pa.size&&this._drivenProperties.size?r.getDriverAxisSizeValue(pa.size,2)??0:this._getSymbolSize();return pa/=this._context.renderCoordsHelper.unitInMeters};sa.applyRendererDiff=function(pa,ka){return this._drivenPropertiesChanged(ka)?E.ApplyRendererDiffResult.RecreateSymbol:E.ApplyRendererDiffResult.RecreateGraphics};sa.queryForSnapping=
async function(pa,ka,ra,va){ka=this._getExtrusionSize(ra)*this._context.renderCoordsHelper.unitInMeters/u.getMetersPerVerticalUnitForSR(ka);const {objectId:Ca,target:Ba}=pa;ra=p.clone(Ba);ra.z=(ra.z??0)+ka;switch(pa.type){case "edge":const {start:Ha,end:Ma}=pa;pa=p.clone(Ha);va=p.clone(Ma);pa.z=(pa.z??0)+ka;va.z=(va.z??0)+ka;return[w.makeEdgeCandidate(Ca,ra,Infinity,pa,va)];case "vertex":return[w.makeVertexCandidate(Ca,ra,Infinity),w.makeEdgeCandidate(Ca,Ba,Infinity,Ba,ra)];default:return[]}};sa._getSymbolSize=
function(){return this.symbolLayer.size??1};sa._createAs3DShape=function(pa,ka,ra,va,Ca){var Ba=F.geometryAsPolygon(pa.geometry);if(null==Ba)return null;if(0===Ba.rings.length||!Ba.rings.some(Fa=>0<Fa.length))return this._logGeometryValidationWarnings(Ba.rings,"rings","ExtrudeSymbol3DLayer"),null;pa=L.geometryToRenderInfo(Ba,this._context.elevationProvider,this._context.renderCoordsHelper,va);this._logGeometryCreationWarnings(pa,Ba.rings,"rings","ExtrudeSymbol3DLayer");var Ha=C.computeCentroid(Ba);
if(null==Ha)return null;var Ma=[];const Qa=[],Sa=n.create(),La=g.create(),Ua=h.create(),Va=this._context.renderCoordsHelper.viewingMode===x.ViewingMode.Global;Va||this._context.renderCoordsHelper.worldUpAtPosition(null,Ua);z.computeTranslationToOriginAndRotation(Ba.spatialReference,[Ha.x,Ha.y,0],La,this._context.renderCoordsHelper.spatialReference);Ba=g.create();f.invert(Ba,La);Ha=d.create();k.normalFromMat4(Ha,Ba);const {polygons:cb,mapPositions:la,position:eb}=pa;for(const Fa of cb){Ha=Fa.count;
if(this._context.clippingExtent&&(n.empty(Sa),n.expandWithBuffer(Sa,Fa.mapPositions),!n.intersectsClippingArea(Sa,this._context.clippingExtent)))continue;var ib=q.earcut(Fa.mapPositions,Fa.holeIndices,3);if(0===ib.length)continue;var Pa=ib.length,za=6*Ha;Ha=m.newIndexArray(za+Pa);Pa=m.newIndexArray(Pa);var Ga=l.newDoubleArray(3*za);const xa=l.newDoubleArray(3*za),ya=l.newDoubleArray(3*za);za=l.newDoubleArray(za);const Ea=this._getExtrusionSize(ka);U(eb,la,ib,Fa,Ga,ya,xa,za,Ha,Pa,Ea,Ua,Va);t.transformMat4(Ga,
Ga,Ba);ib=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Ca,layerUid:this._context.layer.uid});Ga=new na(Ga,ya,W.compressNormals(xa),za);Ma.push(S(this._material,Ha,Ha.length-Pa.length,Ga,ra,ib),S(this._bottomMaterial,Pa,0,Ga,ra,ib));Qa.push(Ga.heights)}if(0===Ma.length)return null;ka=new T.Object3D({geometries:Ma,layerUid:this._context.layer.uid,graphicUid:Ca,isElevationSource:!0});ka.transformation=La;ra=M.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});Ma=
new v.Graphics3DObject3DGraphicLayer(this,ka,Ma,null,null,(Fa,xa,ya,Ea,Oa)=>{Fa=Fa.stageObject;const bb=Fa.geometries,db=bb.length;xa="absolute-height"!==xa.mode;let nb=0;const kb=Fa.transformation,wb=f.invertOrIdentity(g.create(),kb);for(let vb=0;vb<db;vb+=2){const sb=bb[vb];if(!R.isGeometryWithMapPositions(sb))continue;const Ab=sb.getMutableAttribute(P.VertexAttribute.POSITION).data,Ib=Qa[vb/2],rb=new G.SamplePosition(sb.mapPositions),Fb=Ab.length/3;let hb=0,Ja=!1,Na=0;for(let Xa=0;Xa<Fb;Xa++){ma[0]=
Ab[hb];ma[1]=Ab[hb+1];ma[2]=Ab[hb+2];Ea(rb,aa);xa&&(Na+=aa.sampledElevation);K.TESTS_DISABLE_OPTIMIZATIONS?(e.set(fa,rb.array[rb.offset],rb.array[rb.offset+1],aa.z+Ib[hb/3]),null!=ya&&Oa.toRenderCoords(fa,ya,fa)):(e.set(fa,Ab[hb],Ab[hb+1],Ab[hb+2]),e.transformMat4(fa,fa,kb),Oa.setAltitude(fa,aa.z+Ib[hb/3]));e.transformMat4(fa,fa,wb);Ab[hb]=fa[0];Ab[hb+1]=fa[1];Ab[hb+2]=fa[2];const fb=.01/Oa.unitInMeters;if(Math.abs(ma[0]-Ab[hb])>=fb||Math.abs(ma[1]-Ab[hb+1])>=fb||Math.abs(ma[2]-Ab[hb+2])>=fb)Ja=!0;
rb.offset+=3;hb+=3}Ja&&(sb.invalidateBoundingInfo(),Fa.geometryVertexAttrsUpdated(bb[vb]),bb[vb+1].invalidateBoundingInfo(),Fa.geometryVertexAttrsUpdated(bb[vb+1]));nb+=Na/Fb}return nb/db},va,null!=ra?{baseMaterial:this._material,edgeMaterials:[ra],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null);Ma.alignedSampledElevation=pa.sampledElevation;Ma.needsElevationUpdates=D.needsElevationUpdates3D(va.mode);return Ma};return b._createClass(ua)}(B.Graphics3DSymbolLayer);
const Z=h.create(),ea=h.create(),ja=h.create(),ha=h.create(),ia=h.create(),oa=h.create(),ma=h.create(),fa=h.create(),ba=h.create(),aa=new D.SampleElevationInfo,da=[0,2,1],ca=[0,1,2];let na=b._createClass(function(qa,ua,sa,pa){this.positions=qa;this.elevation=ua;this.normals=sa;this.heights=pa});a.Graphics3DExtrudeSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(a,b){var c={exports:{}};c.exports;
(function(y){(function(p){p=p();void 0!==p&&(y.exports=p)})(function(){function p(C,E,F){F=F||2;var M=E&&E.length,K=M?E[0]*F:C.length,G=u(C,0,K,F,!0),L=[];if(!G||G.next===G.prev)return L;var O;if(M){var I=G;var H=F;G=[];var J;M=0;for(J=E.length;M<J;M++){var N=E[M]*H;var R=M<J-1?E[M+1]*H:C.length;N=u(C,N,R,H,!1);N===N.next&&(N.steiner=!0);R=G;var W=R.push,T=N,P=N;do{if(T.x<P.x||T.x===P.x&&T.y<P.y)P=T;T=T.next}while(T!==N);W.call(R,P)}G.sort(f);for(M=0;M<G.length;M++)H=G[M],E=I,(I=e(H,E))?(J=x(I,H),
H=q(I,I.next),J=g(J),q(J,J.next),H=g(H),I=g(E===I?H:E)):I=E,I=q(I,I.next);G=I}if(C.length>80*F){var Q=O=C[0];var S=M=C[1];for(H=F;H<K;H+=F)E=C[H],I=C[H+1],E<Q&&(Q=E),I<S&&(S=I),E>O&&(O=E),I>M&&(M=I);O=Math.max(O-Q,M-S);O=0!==O?1/O:0}k(G,L,F,Q,S,O);return L}function u(C,E,F,M,K){if(K===0<B(C,E,F,M))for(K=E;K<F;K+=M)var G=D(K,C[K],C[K+1],G);else for(K=F-M;K>=E;K-=M)G=D(K,C[K],C[K+1],G);G&&l(G,G.next)&&(C=G.next,A(G),G=C);return G}function q(C,E){if(!C)return C;E||(E=C);do{var F=!1;if(C.steiner||!l(C,
C.next)&&0!==n(C.prev,C,C.next))C=C.next;else{E=C.prev;A(C);C=E;if(C===C.next)break;F=!0}}while(F||C!==E);return E}function k(C,E,F,M,K,G,L){if(C){if(!L&&G){var O=C,I=O;do null===I.z&&(I.z=h(I.x,I.y,M,K,G)),I.prevZ=I.prev,I=I.nextZ=I.next;while(I!==O);I.prevZ.nextZ=null;I.prevZ=null;O=I;var H,J,N,R,W=1;do{I=O;var T=O=null;for(J=0;I;){J++;var P=I;for(H=N=0;H<W&&(N++,P=P.nextZ,P);H++);for(R=W;0<N||0<R&&P;)0!==N&&(0===R||!P||I.z<=P.z)?(H=I,I=I.nextZ,N--):(H=P,P=P.nextZ,R--),T?T.nextZ=H:O=H,H.prevZ=T,
T=H;I=P}T.nextZ=null;W*=2}while(1<J)}for(O=C;C.prev!==C.next;){I=C.prev;P=C.next;if(G)T=d(C,M,K,G);else a:if(T=C,J=T.prev,N=T,W=T.next,0<=n(J,N,W))T=!1;else{for(H=T.next.next;H!==T.prev;){if(z(J.x,J.y,N.x,N.y,W.x,W.y,H.x,H.y)&&0<=n(H.prev,H,H.next)){T=!1;break a}H=H.next}T=!0}if(T)E.push(I.i/F),E.push(C.i/F),E.push(P.i/F),A(C),O=C=P.next;else if(C=P,C===O){if(!L)k(q(C),E,F,M,K,G,1);else if(1===L){C=q(C);L=E;O=F;I=C;do P=I.prev,T=I.next.next,!l(P,T)&&m(P,I,I.next,T)&&r(P,T)&&r(T,P)&&(L.push(P.i/O),
L.push(I.i/O),L.push(T.i/O),A(I),A(I.next),I=C=T),I=I.next;while(I!==C);C=q(I);k(C,E,F,M,K,G,2)}else if(2===L)a:{L=C;do{for(O=L.next.next;O!==L.prev;){if(I=L.i!==O.i){T=T=T=T=void 0;I=L;P=O;if(T=I.next.i!==P.i&&I.prev.i!==P.i){b:{T=I;do{if(T.i!==I.i&&T.next.i!==I.i&&T.i!==P.i&&T.next.i!==P.i&&m(T,T.next,I,P)){T=!0;break b}T=T.next}while(T!==I);T=!1}T=!T}if(T){if(T=r(I,P)&&r(P,I)){T=I;J=!1;N=(I.x+P.x)/2;W=(I.y+P.y)/2;do T.y>W!==T.next.y>W&&T.next.y!==T.y&&N<(T.next.x-T.x)*(W-T.y)/(T.next.y-T.y)+T.x&&
(J=!J),T=T.next;while(T!==I);T=J}T=T&&(n(I.prev,I,P.prev)||n(I,P.prev,P))||l(I,P)&&0<n(I.prev,I,I.next)&&0<n(P.prev,P,P.next)}I=T}if(I){C=x(L,O);L=q(L,L.next);C=q(C,C.next);k(L,E,F,M,K,G);k(C,E,F,M,K,G);break a}O=O.next}L=L.next}while(L!==C)}break}}}}function d(C,E,F,M){var K=C.prev,G=C.next;if(0<=n(K,C,G))return!1;var L=K.x>C.x?K.x>G.x?K.x:G.x:C.x>G.x?C.x:G.x,O=K.y>C.y?K.y>G.y?K.y:G.y:C.y>G.y?C.y:G.y,I=h(K.x<C.x?K.x<G.x?K.x:G.x:C.x<G.x?C.x:G.x,K.y<C.y?K.y<G.y?K.y:G.y:C.y<G.y?C.y:G.y,E,F,M);E=h(L,
O,E,F,M);F=C.prevZ;for(M=C.nextZ;F&&F.z>=I&&M&&M.z<=E;){if(F!==C.prev&&F!==C.next&&z(K.x,K.y,C.x,C.y,G.x,G.y,F.x,F.y)&&0<=n(F.prev,F,F.next))return!1;F=F.prevZ;if(M!==C.prev&&M!==C.next&&z(K.x,K.y,C.x,C.y,G.x,G.y,M.x,M.y)&&0<=n(M.prev,M,M.next))return!1;M=M.nextZ}for(;F&&F.z>=I;){if(F!==C.prev&&F!==C.next&&z(K.x,K.y,C.x,C.y,G.x,G.y,F.x,F.y)&&0<=n(F.prev,F,F.next))return!1;F=F.prevZ}for(;M&&M.z<=E;){if(M!==C.prev&&M!==C.next&&z(K.x,K.y,C.x,C.y,G.x,G.y,M.x,M.y)&&0<=n(M.prev,M,M.next))return!1;M=M.nextZ}return!0}
function f(C,E){return C.x-E.x}function g(C){if(C.next.prev===C)return C;let E=C;do{const F=E.next;if(F.prev===E||F===E||F===C)break;E=F}while(1);return E}function e(C,E){var F=E,M=C.x,K=C.y,G=-Infinity;do{if(K<=F.y&&K>=F.next.y&&F.next.y!==F.y){var L=F.x+(K-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(L<=M&&L>G){G=L;if(L===M){if(K===F.y)return F;if(K===F.next.y)return F.next}var O=F.x<F.next.x?F:F.next}}F=F.next}while(F!==E);if(!O)return null;if(M===G)return O;E=O;L=O.x;var I=O.y,H=Infinity;F=O;do{if(M>=
F.x&&F.x>=L&&M!==F.x&&z(K<I?M:G,K,L,I,K<I?G:M,K,F.x,F.y)){var J=Math.abs(K-F.y)/(M-F.x);var N;if((N=r(F,C))&&!(N=J<H)&&(N=J===H)&&!(N=F.x>O.x)&&(N=F.x===O.x)){N=O;var R=F;N=0>n(N.prev,N,R.prev)&&0>n(R.next,N,N.next)}N&&(O=F,H=J)}F=F.next}while(F!==E);return O}function h(C,E,F,M,K){C=32767*(C-F)*K;E=32767*(E-M)*K;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;return(C|C<<1)&1431655765|((E|E<<1)&1431655765)<<1}function z(C,
E,F,M,K,G,L,O){return 0<=(K-L)*(E-O)-(C-L)*(G-O)&&0<=(C-L)*(M-O)-(F-L)*(E-O)&&0<=(F-L)*(G-O)-(K-L)*(M-O)}function n(C,E,F){return(E.y-C.y)*(F.x-E.x)-(E.x-C.x)*(F.y-E.y)}function l(C,E){return C.x===E.x&&C.y===E.y}function m(C,E,F,M){var K=w(n(C,E,F)),G=w(n(C,E,M)),L=w(n(F,M,C)),O=w(n(F,M,E));return K!==G&&L!==O||0===K&&t(C,F,E)||0===G&&t(C,M,E)||0===L&&t(F,C,M)||0===O&&t(F,E,M)?!0:!1}function t(C,E,F){return E.x<=Math.max(C.x,F.x)&&E.x>=Math.min(C.x,F.x)&&E.y<=Math.max(C.y,F.y)&&E.y>=Math.min(C.y,
F.y)}function w(C){return 0<C?1:0>C?-1:0}function r(C,E){return 0>n(C.prev,C,C.next)?0<=n(C,E,C.next)&&0<=n(C,C.prev,E):0>n(C,E,C.prev)||0>n(C,C.next,E)}function x(C,E){var F=new v(C.i,C.x,C.y),M=new v(E.i,E.x,E.y),K=C.next,G=E.prev;C.next=E;E.prev=C;F.next=K;K.prev=F;M.next=F;F.prev=M;G.next=M;M.prev=G;return M}function D(C,E,F,M){C=new v(C,E,F);M?(C.next=M.next,C.prev=M,M.next.prev=C,M.next=C):(C.prev=C,C.next=C);return C}function A(C){C.next.prev=C.prev;C.prev.next=C.next;C.prevZ&&(C.prevZ.nextZ=
C.nextZ);C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function v(C,E,F){this.i=C;this.x=E;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(C,E,F,M){for(var K=0,G=F-M;E<F;E+=M)K+=(C[G]-C[E])*(C[E+1]+C[G+1]),G=E;return K}p.deviation=function(C,E,F,M){var K=E&&E.length,G=Math.abs(B(C,0,K?E[0]*F:C.length,F));if(K){K=0;for(var L=E.length;K<L;K++)G-=Math.abs(B(C,E[K]*F,K<L-1?E[K+1]*F:C.length,F))}for(K=E=0;K<M.length;K+=3){L=M[K]*F;var O=M[K+1]*F,I=M[K+2]*F;E+=Math.abs((C[L]-
C[I])*(C[O+1]-C[L+1])-(C[L]-C[O])*(C[I+1]-C[L+1]))}return 0===G&&0===E?0:Math.abs((E-G)/G)};p.flatten=function(C){for(var E=C[0][0].length,F={vertices:[],holes:[],dimensions:E},M=0,K=0;K<C.length;K++){for(var G=0;G<C[K].length;G++)for(var L=0;L<E;L++)F.vertices.push(C[K][G][L]);0<K&&(M+=C[K-1].length,F.holes.push(M))}return F};return p})})(c);b=b.getDefaultExportFromCjs(c.exports);a.earcut=b})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=
function(b,c,y,p,u,q=!1){return{objectId:b,target:c,distance:y,type:"edge",start:p,end:u,draped:q}};a.makeVertexCandidate=function(b,c,y){return{objectId:b,target:c,distance:y,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../Color","../visualVariables/support/visualVariableUtils"],function(a,b,c){function y(u,q){if(!u||u.symbol)return null;q=q&&q.renderer;return u&&null!=q&&q.getObservationRenderer?
q.getObservationRenderer(u):q}async function p(u,q){if(null!=u.symbol)return u.symbol;const k=y(u,q);return null!=k?k.getSymbolAsync(u,q):null}a.getDriverAxisSizeValue=function(u,q=0){u=u[q];return"number"===typeof u&&isFinite(u)?u:null};a.getDriverAxisSizeValueAny=function(u){for(let q=0;3>q;q++){const k=u[q];if("number"===typeof k)return isFinite(k)?k:0}return 0};a.getRenderer=y;a.getRenderingInfo=function(u,q){const k=y(u,q);if(null!=u.symbol)var d=u.symbol;else d=y(u,q),d=null!=d&&"dot-density"!==
d.type?d.getSymbol(u,q):null;if(null==d)return null;d={renderer:k,symbol:d};if(!(null!=k&&"visualVariables"in k&&k.visualVariables))return d;q=c.getVisualVariableValues(k,u,q)??[];u=["proportional","proportional","proportional"];for(const {variable:f,value:g}of q)switch(f.type){case "color":d.color=g.toRgba();break;case "size":if("outline"===f.target)d.outlineSize=g;else switch(q=f.useSymbolValue?"symbol-value":g,f.axis){case "width":u[0]=q;break;case "depth":u[1]=q;break;case "height":u[2]=q;break;
case "width-and-depth":u[0]=u[1]=q;break;default:u[0]=u[1]=u[2]=q}break;case "opacity":d.opacity=g;break;case "rotation":switch(f.axis){case "tilt":d.tilt=g;break;case "roll":d.roll=g;break;default:d.heading=g}}if("proportional"!==u[0]||"proportional"!==u[1]||"proportional"!==u[2])d.size=u;return d};a.getRenderingInfoAsync=async function(u,q){var k=y(u,q),d=await p(u,q);if(!d)return null;d={renderer:k,symbol:d};if(!(k&&"visualVariables"in k&&k.visualVariables))return d;q=c.getVisualVariableValues(k,
u,q)??[];u=["proportional","proportional","proportional"];for(const {variable:f,value:g}of q)"color"===f.type?d.color=b.toUnitRGBA(g):"size"===f.type?"outline"===f.target?d.outlineSize=g:(q=f.axis,k=f.useSymbolValue?"symbol-value":g,"width"===q?u[0]=k:"depth"===q?u[1]=k:"height"===q?u[2]=k:u[0]="width-and-depth"===q?u[1]=k:u[1]=u[2]=k):"opacity"===f.type?d.opacity=g:"rotation"===f.type&&"tilt"===f.axis?d.tilt=g:"rotation"===f.type&&"roll"===f.axis?d.roll=g:"rotation"===f.type&&(d.heading=g);if(isFinite(u[0])||
isFinite(u[1])||isFinite(u[2]))d.size=u;return d};a.getSymbolAsync=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../geometry/support/Indices ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,y,p,u,q,k,d,f){b=b._createClass(function(g,e,h){this.renderData=g;this.layerUid=e;this.graphicUid=h;this.outGeometries=[]});a.PolygonCreationDataBase=b;a.createColorGeometry=function(g){const e=[[k.VertexAttribute.POSITION,g.indices]],h=[[k.VertexAttribute.POSITION,new p.Attribute(g.attributeData.position,3,!0)]];null!=g.attributeData.colorFeature?(h.push([k.VertexAttribute.COLORFEATUREATTRIBUTE,new p.Attribute([g.attributeData.colorFeature],1,!0)]),e.push([k.VertexAttribute.COLORFEATUREATTRIBUTE,
Array(g.indices.length).fill(0)])):g.attributeData.color&&(h.push([k.VertexAttribute.COLOR,new p.Attribute(g.attributeData.color,4,!0)]),e.push([k.VertexAttribute.COLOR,y.getZeroIndexArray(g.indices.length)]));g.attributeData.uvMapSpace&&(h.push([k.VertexAttribute.UVMAPSPACE,new p.Attribute(g.attributeData.uvMapSpace,4,!0)]),e.push([k.VertexAttribute.UVMAPSPACE,g.indices]));g.attributeData.boundingRect&&(h.push([k.VertexAttribute.BOUNDINGRECT,new p.Attribute(g.attributeData.boundingRect,9,!0)]),e.push([k.VertexAttribute.BOUNDINGRECT,
g.indices]));return new q.Geometry(g.material,h,e,g.mapPositions,u.ContentObjectType.Mesh,g.attributeData.objectAndLayerIdColor)};a.createWaterGeometry=function(g,e=null){const h=[[k.VertexAttribute.POSITION,g.indices],[k.VertexAttribute.UV0,g.indices]],z=[[k.VertexAttribute.POSITION,new p.Attribute(g.attributeData.position,3,!0)],[k.VertexAttribute.UV0,new p.Attribute(g.attributeData.uv0,2,!0)]];return new q.Geometry(g.material,z,h,g.mapPositions,u.ContentObjectType.Mesh,e)};a.geometryAsPolygon=
function(g){switch(g.type){case "extent":if(g instanceof d)return f.fromExtent(g);break;case "polygon":return g}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(a,b,c,y,p,u,q){function k(n,l,m=null){return n.filter(({count:t})=>1<t).map(({index:t,count:w})=>{const r=3*t,x=3*w;return null!=m?new g(t,w,y.doubleSubArray(l,r,x),y.doubleSubArray(m,r,x)):new f(t,w,y.doubleSubArray(l,r,x))})}function d(n,l,m=null){const t=[];for(const {index:w,count:r,holeIndices:x,pathLengths:D}of n){if(1>=r)continue;n=3*w;const A=3*r,v=x.map(B=>B-w);n=null!=m?new e(w,r,y.doubleSubArray(l,3*w,3*r),y.doubleSubArray(m,n,A),v,D):new h(w,r,y.doubleSubArray(l,3*w,3*r),v,D);
t.push(n)}return t}let f=b._createClass(function(n,l,m){this.index=n;this.count=l;this.position=m}),g=function(n){function l(m,t,w,r){m=n.call(this,m,t,w)||this;m.mapPositions=r;return m}b._inherits(l,n);return b._createClass(l)}(f),e=function(n){function l(m,t,w,r,x,D){m=n.call(this,m,t,w,r)||this;m.holeIndices=x;m.pathLengths=D;return m}b._inherits(l,n);return b._createClass(l)}(g),h=function(n){function l(m,t,w,r,x){m=n.call(this,m,t,w)||this;m.holeIndices=r;m.pathLengths=x;return m}b._inherits(l,
n);return b._createClass(l)}(f),z=b._createClass(function(n,l,m,t,w,r){this.position=n;this.mapPositions=l;this.polygons=m;this.outlines=t;this.projectionSuccess=w;this.sampledElevation=r});a.PolygonRenderInfo=z;a.PolygonVertexData=e;a.PolygonVertexDataDraped=h;a.geometryToRenderInfo=function(n,l,m,t){const w=p.pathsToTriangulationInfo(n.rings,!!n.hasZ,p.CounterClockwiseMode.CCW_IS_HOLE),r=y.newDoubleArray(w.position.length);n=u.applyPerVertexElevationAlignment(w.position,n.spatialReference,0,r,0,
w.position,0,w.position.length/3,l,m,t);l=null!=n;return new z(w.position,r,d(w.polygons,w.position,r),k(w.outlines,w.position,r),l,n)};a.geometryToRenderInfoDraped=function(n,l){const m=p.pathsToTriangulationInfo(n.rings,!1,p.CounterClockwiseMode.CCW_IS_HOLE);n=c.projectBuffer(m.position,n.spatialReference,0,m.position,l,0,m.position.length/3);for(l=2;l<m.position.length;l+=3)m.position[l]=q.DRAPED_Z;return{position:m.position,polygons:d(m.polygons,m.position),outlines:k(m.outlines,m.position),projectionSuccess:n}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate".split(" "),function(a,b,c,y,p,u){function q(f,g,e){if(1===f.length)return f[0];g=y.newDoubleArray(g);e=Array(e);let h=0,z=0,n=0;for(const l of f){for(f=0;f<l.position.length;f++)g[h++]=l.position[f];for(const m of l.faces)e[z++]=m+n;n=h/3}return{position:g,faces:p.compactIndices(e)}}
function k(f,g,e){const h=f.length,z=Array(h),n=Array(h),l=Array(h);let m=0,t=0,w=0;var r=0;for(var x=0;x<h;++x)r+=f[x].length;r=y.newDoubleArray(3*r);x=0;for(let B=h-1;0<=B;B--){var D=f[B],A=e===a.CounterClockwiseMode.CCW_IS_HOLE?!c.isClockwise(D,!1,!1):!1;if(A&&1!==h)z[m++]=D;else{var v=D.length;for(let C=0;C<m;++C)v+=z[C].length;v={index:x,pathLengths:Array(m+1),count:v,holeIndices:Array(m)};v.pathLengths[0]=D.length;0<D.length&&(l[w++]={index:x,count:D.length});x=A?d(D,D.length-1,-1,r,x,D.length,
g):d(D,0,1,r,x,D.length,g);for(D=0;D<m;++D)A=z[D],v.holeIndices[D]=x,v.pathLengths[D+1]=A.length,0<A.length&&(l[w++]={index:x,count:A.length}),x=d(A,0,1,r,x,A.length,g);m=0;0<v.count&&(n[t++]=v)}}for(f=0;f<m;++f)e=z[f],0<e.length&&(l[w++]={index:x,count:e.length}),x=d(e,0,1,r,x,e.length,g);n.length=t;l.length=w;return{position:r,polygons:n,outlines:l}}function d(f,g,e,h,z,n,l){z*=3;for(let m=0;m<n;++m){const t=f[g];h[z++]=t[0];h[z++]=t[1];h[z++]=l?t[2]:0;g+=e}return z/3}a.CounterClockwiseMode=void 0;
(function(f){f[f.NONE=0]="NONE";f[f.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=k;a.triangulate=function(f){f=k(f.rings,f.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);const g=[];let e=0,h=0;for(var z of f.polygons){const l=z.index,m=y.doubleSubArray(f.position,3*l,3*z.count);var n=z.holeIndices.map(t=>t-l);n=p.compactIndices(b.earcut(m,n,3));g.push({position:m,faces:n});e+=m.length;h+=n.length}z=q(g,e,h);f=Array.isArray(z.position)?u.deduplicate(z.position,
3,{originalIndices:z.faces}):u.deduplicate(z.position.buffer,6,{originalIndices:z.faces});z.position=y.doubleArrayFrom(new Float64Array(f.buffer));z.faces=f.indices;return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,c){let y=null;a.deduplicate=function(p,u,q){var k=Array.isArray(p),d=k?p.length/u:p.byteLength/(4*u),f=k?p:new Uint32Array(p,0,d*u),g=
q?.minReduction??0;const e=(p=q?.originalIndices||null)?p.length:0;var h=q?.componentOffsets||null;q=0;if(h)for(var z=0;z<h.length-1;z++){var n=h[z+1]-h[z];n>q&&(q=n)}else q=d;var l=Math.floor(1.1*q)+1;if(null==y||y.length<2*l)y=new Uint32Array(b.nextHighestPowerOfTwo(2*l));for(q=0;q<2*l;q++)y[q]=0;q=0;const m=(n=!!h&&!!p)?e:d;z=c.newIndexArray(d);var t=new Uint32Array(e),w=0!==g?Math.ceil(7.84*1.96/(g*g)*g*(1-g)):m,r=1,x=h?h[1]:m;for(let C=0;C<m;C++){if(C===w){var D=1-q/C;if(D+1.96*Math.sqrt(D*(1-
D)/C)<g)return null;w*=2}if(C===x){for(x=0;x<2*l;x++)y[x]=0;if(p)for(x=h[r-1];x<h[r];x++)t[x]=z[p[x]];x=h[++r]}D=n?p[C]:C;const E=D*u;var A=0;for(var v=0;v<u;v++)A=f[E+v]+A|0,A=A+(A<<11)+(A>>>2)|0;A>>>=0;v=A%l;let F=q;for(;0!==y[2*v+1];){if(y[2*v]===A){const M=y[2*v+1]-1;var B=M*u;a:{for(let K=0;K<u;K++)if(f[E+K]!==f[B+K]){B=!1;break a}B=!0}if(B){F=z[M];break}}v++;v>=l&&(v-=l)}F===q&&(y[2*v]=A,y[2*v+1]=D+1,q++);z[D]=F}if(0!==g&&1-q/d<g)return null;if(n){for(d=h[r-1];d<t.length;d++)t[d]=z[p[d]];z=
c.compactIndices(t)}k=k?Array(q):new Uint32Array(q*u);q=0;for(w=0;w<m;w++)if(z[w]===q){d=f;g=(n?p[w]:w)*u;h=k;l=q*u;t=u;for(r=0;r<t;r++)h[l+r]=d[g+r];q++}if(p&&!n){u=new Uint32Array(e);for(f=0;f<u.length;f++)u[f]=z[p[f]];z=c.compactIndices(u)}return{buffer:Array.isArray(k)?k:k.buffer,indices:z,uniqueCount:q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja){a.OverlayRenderer=function(ma){function fa(aa){aa=ma.call(this,aa)||this;aa._overlays=null;aa._overlayRenderTarget=null;aa._hasHighlights=!1;aa._rendersOccluded=!1;aa._hasWater=!1;aa._handles=new u;aa._renderers=new Map;aa._sortedDrapeSourceRenderersDirty=!1;aa._sortedRenderers=new d;aa._passParameters=new M.TextureOnlyPassParameters;aa._materialRepository=null;aa._screenToWorldRatio=1;
aa._localOriginFactory=null;aa._camera=new G.Camera;aa.worldToPCSRatio=1;aa.events=new p;aa.longitudeCyclical=null;return aa}b._inherits(fa,ma);var ba=fa.prototype;ba.initialize=function(){const aa=this.view._stage.renderView,{waterTextureRepository:da,stippleTextureRepository:ca,markerTextureRepository:na}=aa;this._shaderTechniqueRepository=new K.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:x.ViewingMode.Local,stippleTextureRepository:ca,markerTextureRepository:na,waterTextureRepository:da});
this._renderContext=new J.OverlayRenderContext(this._rctx,new R.ShadowMap(this._rctx,this.view.state.viewingMode),new T.SSAOHelper(this.view,this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([f.watch(()=>da.updating,()=>this.events.emit("content-changed"),f.syncAndInitial),f.watch(()=>this.spatialReference,qa=>this._localOriginFactory=new I.GridLocalOriginFactory(qa),f.syncAndInitial),f.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]);
this._materialRepository=new L.GLMaterialRepository(aa.textureRepository,this._shaderTechniqueRepository,qa=>{0<(qa.renderOccluded&oa)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=N.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=O.createEmptyDepthTexture(this._rctx);this._camera.near=1;this._camera.far=1E4;
this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=S.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new V.AmbientLight(r.fromValues(1,1,1))]);this._handles.add(this.view.resourceController.scheduler.registerTask(X.TaskPriority.STAGE,this))};ba.destroy=function(){this._handles.destroy();this._renderers.forEach(aa=>aa.destroy());
this._renderers.clear();this._debugTextureTechnique=k.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=k.disposeMaybe(this._passParameters.texture);this._bindParameters.highlightDepthTexture=k.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=k.destroyMaybe(this._shaderTechniqueRepository);this._temporaryFBO=k.disposeMaybe(this._temporaryFBO);this._quadVAO=k.disposeMaybe(this._quadVAO);this.disposeOverlays()};ba.createGeometryDrapeSourceRenderer=
function(aa){return this.createDrapeSourceRenderer(aa,W.SortedRenderGeometryRenderer)};ba.createDrapeSourceRenderer=function(aa,da,ca){const na=this._renderers.get(aa);null!=na&&na.destroy();da=new da({...ca,rendererContext:this,drapeSource:aa});this._renderers.set(aa,da);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in aa&&this._handles.add(f.watch(()=>aa.fullOpacity,()=>this.events.emit("content-changed")),aa);return da};ba.removeDrapeSourceRenderer=function(aa){if(null!=aa){var da=this._renderers.get(aa);
null!=da&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(aa),this._handles.remove(aa),da.destroy())}};ba.collectUnusedRenderTargetMemory=function(){let aa=!1;const da=e.now();if(null!=this._overlayRenderTarget)for(const ca of this._overlayRenderTarget.renderTargets)aa=this._overlayRenderTarget.validateUsageForTarget(this.overlays[v.OverlayIndex.INNER].validTargets[ca.type],ca,da)||aa;return aa};ba.ensureDrapeTargets=function(aa){null!=this._overlays&&this._overlays.forEach(da=>da.hasTargetWithoutRasterImage=
g.someSet(aa,ca=>ca.drapeTargetType===D.DrapeTargetType.WithoutRasterImage))};ba.ensureDrapeSources=function(aa){null!=this._overlays&&this._overlays.forEach(da=>{da.hasDrapedFeatureSource=g.someSet(aa,ca=>ca.drapeSourceType===D.DrapeSourceType.Features);da.hasDrapedRasterSource=g.someSet(aa,ca=>ca.drapeSourceType===D.DrapeSourceType.RasterImage)})};ba.ensureOverlays=function(aa,da){null==this._overlays&&(this._overlayRenderTarget=new E.OverlayRenderTarget(this._rctx),this._overlays=[new B.Overlay(v.OverlayIndex.INNER,
this._overlayRenderTarget),new B.Overlay(v.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(aa);this.ensureDrapeSources(da)};ba.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=k.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};ba.runTask=function(aa){this._processDrapeSources(aa,()=>!0)};ba._processDrapeSources=function(aa,da){let ca=!1;for(const [na,qa]of this._renderers){if(aa.done)break;(na.destroyed||da(na))&&qa.commitChanges()&&
(ca=!0,aa.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ca=!0,this._updateSortedDrapeSourceRenderers());ca&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};ba.processSyncDrapeSources=function(){this._processDrapeSources(X.noBudget,aa=>aa.updatePolicy===
U.UpdatePolicy.SYNC)};ba.updateAnimation=function(aa){let da=!1;this._renderers.forEach(ca=>da=ca.updateAnimation(aa)||da);return da};ba.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};ba.drawTarget=function(aa,da,ca){const na=aa.canvasGeometries;if(0===na.numViews)return!1;const {alignPixelEnabled:qa,contentPixelRatio:ua}=ca;this._screenToWorldRatio=ua*aa.mapUnitsPerPixel/B.OverlayStretch;const sa=da.output;if(this.isEmpty||sa===F.ShaderOutput.Highlight&&!this.hasHighlights||
sa===F.ShaderOutput.Normal&&!this.hasWater||!aa.hasSomeSizedView())return!1;const pa=da.fbo;if(!pa.isValid())return!1;const ka=2*aa.resolution,ra=aa.resolution;pa.resize(ka,ra);const va=this._rctx;this._camera.pixelRatio=aa.pixelRatio*ua;this._renderContext.output=sa;this._bindParameters.alignPixelEnabled=qa;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=sa===F.ShaderOutput.Normal?
N.RenderSlot.DRAPED_WATER:N.RenderSlot.DRAPED_MATERIAL;aa.applyViewport(this._rctx);pa.bind(va);aa.index===v.OverlayIndex.INNER&&(va.setClearColor(0,0,0,0),va.clearSafe(Y.ClearBufferBit.COLOR_BUFFER_BIT));da.type===v.RenderTargetType.Occluded&&(this._renderContext.renderOccludedMask=oa);if(A.OVERLAY_DRAW_DEBUG_TEXTURE&&da.type!==v.RenderTargetType.Occluded)for(ca=0;ca<na.numViews;ca++)this._setViewParameters(na.extents[ca],aa),this._drawDebugTexture(aa.resolution,ia[aa.index]);0<this._renderers.size&&
this._sortedRenderers.forAll(({drapeSource:Ca,renderer:Ba})=>{if(da.type!==v.RenderTargetType.ColorNoRasterImage||Ca.drapeSourceType!==D.DrapeSourceType.RasterImage){({fullOpacity:Ca}=Ca);var Ha=null!=Ca&&1>Ca&&sa===F.ShaderOutput.Color;Ha&&(this.bindTemporaryFramebuffer(this._rctx,ka,ra),va.clearSafe(Y.ClearBufferBit.COLOR_BUFFER_BIT));for(let Ma=0;Ma<na.numViews;Ma++)this._setViewParameters(na.extents[Ma],aa),Ba.render(this._renderContext);Ha&&null!=this._temporaryFBO&&(pa.bind(va),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,
this._temporaryFBO.getTexture(),Ca,aa.index))}});va.bindFramebuffer(null);pa.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};ba.bindTemporaryFramebuffer=function(aa,da,ca){null==this._temporaryFBO&&(this._temporaryFBO=new C.OverlayFramebufferObject(aa,!1));this._temporaryFBO.resize(da,ca);this._temporaryFBO.bind(aa)};ba.reloadShaders=async function(){await this._shaderTechniqueRepository.reloadAll()};ba.notifyContentChanged=function(){this.events.emit("content-changed")};
ba.intersect=function(aa,da,ca,na){let qa=0;for(const ua of this._renderers.values())qa=ua.intersect?.(aa,da,ca,na,qa)??qa};ba._updateSortedDrapeSourceRenderers=function(){this._sortedRenderers.clear();if(0!==this._renderers.size){var aa=this.view.map.allLayers;this._renderers.forEach((da,ca)=>{const na=aa.indexOf(ca.layer),qa=0<=na;this._sortedRenderers.push(new ha(ca,da,this._renderers.size*(ca.renderGroup??(qa?D.DrapedRenderGroup.MapLayer:D.DrapedRenderGroup.ViewLayer))+(qa?na:0)))});this._sortedRenderers.sort((da,
ca)=>da.index-ca.index)}};ba._setViewParameters=function(aa,da){const ca=this._camera;ca.viewport=[0,0,da.resolution,da.resolution];t.ortho(ca.projectionMatrix,0,aa[2]-aa[0],0,aa[3]-aa[1],ca.near,ca.far);t.fromTranslation(ca.viewMatrix,[-aa[0],-aa[1],0])};ba._updateHasWater=function(){const aa=q.someMap(this._renderers,da=>da.hasWater);aa!==this._hasWater&&(this._hasWater=aa,this.events.emit("has-water",aa))};ba._updateHasHighlights=function(){const aa=q.someMap(this._renderers,da=>da.hasHighlights);
aa!==this._hasHighlights&&(this._hasHighlights=aa,this.events.emit("has-highlights",aa))};ba._updateRendersOccluded=function(){const aa=q.someMap(this._renderers,da=>da.rendersOccluded);aa!==this._rendersOccluded&&(this._rendersOccluded=aa,this.events.emit("renders-occluded",aa))};ba._drawDebugTexture=function(aa,da){this._ensureDebugPatternResources(aa,da);aa=this._rctx;aa.bindTechnique(this._debugTextureTechnique,this._passParameters,null);aa.bindVAO(this._quadVAO);aa.drawArrays(Y.PrimitiveType.TRIANGLE_STRIP,
0,ja.vertexCount(this._quadVAO,"geometry"))};ba._ensureDebugPatternResources=function(aa,da){w.set(this._passParameters.color,da[0],da[1],da[2]);if(!this._passParameters.texture){da=new Uint8Array(aa*aa*4);var ca=0;for(let na=0;na<aa;na++)for(let qa=0;qa<aa;qa++){const ua=Math.floor(qa/10),sa=Math.floor(na/10);2>ua||2>sa||10*ua>aa-20||10*sa>aa-20?(da[ca++]=255,da[ca++]=255,da[ca++]=255,da[ca++]=255):(da[ca++]=255,da[ca++]=255,da[ca++]=255,ua&1&&sa&1?da[ca++]=qa&1^na&1?0:255:da[ca++]=ua&1^sa&1?0:128)}aa=
new ea.TextureDescriptor(aa);aa.samplingMode=Y.TextureSamplingMode.NEAREST;this._passParameters.texture=new Z.Texture(this._rctx,aa,da);aa=new Q.TextureTechniqueConfiguration;aa.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(P.TextureTechnique,aa);this._quadVAO=O.createQuadVAO(this._rctx)}};b._createClass(fa,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"_rctx",get:function(){return this.view._stage.renderView.renderingContext}},
{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||q.someMap(this._renderers,aa=>aa.updating)}},{key:"hasOverlays",get:function(){return null!=this._overlays&&null!=this._overlayRenderTarget}},{key:"gpuMemoryUsage",
get:function(){return null!=this._overlayRenderTarget?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return this._overlays??[]}},{key:"running",get:function(){return this.updating}},{key:"isEmpty",get:function(){return A.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!q.someMap(this._renderers,aa=>!aa.isEmpty)}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},
{key:"test",get:function(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:aa=>this._renderers.get(aa)}}}]);return fa}(y);c.__decorate([h.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);c.__decorate([h.property({autoDestroy:!0})],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([h.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);c.__decorate([h.property()],a.OverlayRenderer.prototype,
"worldToPCSRatio",void 0);c.__decorate([h.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([h.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);c.__decorate([h.property()],a.OverlayRenderer.prototype,"isEmpty",null);a.OverlayRenderer=c.__decorate([m.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);let ha=b._createClass(function(ma,fa,ba){this.drapeSource=ma;this.renderer=fa;this.index=ba});const ia=[[1,.5,.5],[.5,
.5,1]],oa=H.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=oa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";b[b.Outline=2]="Outline";
b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u){let q=function(){function k(f,g){this._fbo=null;const e=new u.TextureDescriptor;e.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;e.samplingMode=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;e.hasMipmap=g;e.maxAnisotropy=8;this._fbo=new p.FramebufferObject(f,e)}var d=k.prototype;d.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};d.getTexture=function(){return this._fbo?.colorTexture};d.isValid=function(){return null!=this._fbo};d.resize=function(f,g){this._fbo?.resize(f,g)};d.bind=
function(f){f.bindFramebuffer(this._fbo)};d.generateMipMap=function(){const f=this._fbo?.colorTexture;f?.descriptor.hasMipmap&&f.generateMipmap()};d.disposeRenderTargetMemory=function(){this._fbo?.resize(0,0)};b._createClass(k,[{key:"gpuMemoryUsage",get:function(){return this._fbo?.gpuMemoryUsage??0}}]);return k}();a.OverlayFramebufferObject=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/time ./interfaces ./OverlayFramebufferObject ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),
function(a,b,c,y,p,u,q){let k=b._createClass(function(g,e,h,z=!0){this.output=e;this.type=h;this.valid=!1;this.lastUsed=y.Milliseconds(Infinity);this.fbo=new u.OverlayFramebufferObject(g,z)}),d=function(){function g(h){this.renderTargets=[new k(h,q.ShaderOutput.Color,p.RenderTargetType.Color),new k(h,q.ShaderOutput.Color,p.RenderTargetType.ColorNoRasterImage),new k(h,q.ShaderOutput.Highlight,p.RenderTargetType.Highlight,!1),new k(h,q.ShaderOutput.Normal,p.RenderTargetType.Water),new k(h,q.ShaderOutput.Color,
p.RenderTargetType.Occluded)];c("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new k(h,q.ShaderOutput.ObjectAndLayerIdColor,p.RenderTargetType.ObjectAndLayerIdColor))}var e=g.prototype;e.getTarget=function(h){return this.renderTargets[h].fbo};e.dispose=function(){for(const h of this.renderTargets)h.fbo.dispose()};e.disposeRenderTargetMemory=function(){for(const h of this.renderTargets)h.fbo.disposeRenderTargetMemory()};e.validateUsageForTarget=function(h,z,n){return h?(z.lastUsed=
n,!1):n-z.lastUsed>f?(z.fbo.disposeRenderTargetMemory(),z.lastUsed=y.Milliseconds(Infinity),!1):Infinity>z.lastUsed};b._createClass(g,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((h,z)=>h+z.fbo.gpuMemoryUsage,0)}}]);return g}();const f=y.Milliseconds(1E3);a.OverlayRenderTarget=d;a.RenderTargetDescriptor=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k){function d(){const e=new q.ShaderBuilder;e.include(y.ScreenSpacePass);e.fragment.uniforms.add(new k.Texture2DPassUniform("tex",h=>h.texture),new p.Float4PassUniform("uColor",h=>h.color));e.fragment.code.add(u.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`);return e}let f=function(e){function h(){var z=e.apply(this,arguments)||this;z.color=c.fromValues(1,1,1,1);return z}b._inherits(h,e);return b._createClass(h)}(u.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=g;a.TextureOnlyPassParameters=f;a.build=d})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,c,y){let p=function(){function k(f){this._context=f;this._perConstructorInstances=new c.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var d=k.prototype;d.destroy=function(){this._perConstructorInstances.forEach(f=>f.forEach(g=>g.technique.destroy()));this._perConstructorInstances.clear()};d.acquire=function(f,g=q){const e=g.key;let h=this._perConstructorInstances.get(f,e);if(null==h){const z=new f(this._context,
g,()=>this.release(z));h=new u(z);this._perConstructorInstances.set(f,e,h)}++h.refCount;return h.technique};d.releaseAndAcquire=function(f,g,e){if(null!=e){if(g.key===e.key)return e;this.release(e)}return this.acquire(f,g)};d.release=function(f){null==f||this._perConstructorInstances.empty||(f=this._perConstructorInstances.get(f.constructor,f.key),null!=f&&(--f.refCount,0===f.refCount&&(f.refZeroFrame=this._frameCounter)))};d.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&
this._perConstructorInstances.forEach((f,g)=>{f.forEach((e,h)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(g,h))})})};d.reloadAll=async function(){const f=[];this._perConstructorInstances.forEach((g,e)=>{f.push((async(h,z)=>{if(z=z.shader)await z.reload(),h.forEach(n=>n.technique.reload(this._context))})(g,e))});await Promise.all(f)};b._createClass(k,[{key:"viewingMode",get:function(){return this._context.viewingMode}},
{key:"constructionContext",get:function(){return this._context}}]);return k}(),u=b._createClass(function(k){this.technique=k;this.refZeroFrame=this.refCount=0});const q=new y.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),
function(a,b,c,y,p,u){let q=function(){function d(g,e,h,z){this._textureRepository=g;this._techniqueRepository=e;this.materialChanged=h;this.requestRender=z;this._id2glMaterialRef=new p.NestedMap}var f=d.prototype;f.dispose=function(){this._textureRepository.destroy()};f.acquire=function(g,e,h){this._ownMaterial(g);if(!g.requiresSlot(e,h))return null;e=this._id2glMaterialRef.get(h,g.id);null==e&&(e=g.createGLMaterial({material:g,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,
output:h}),e=new k(e),this._id2glMaterialRef.set(h,g.id,e));e.ref();return e.glMaterial};f.release=function(g,e){const h=this._id2glMaterialRef.get(e,g.id);null!=h&&(h.unref(),h.referenced||(y.disposeMaybe(h.glMaterial),this._id2glMaterialRef.delete(e,g.id)))};f._ownMaterial=function(g){null!=g.repository&&g.repository!==this&&c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");g.repository=this};return b._createClass(d)}(),
k=function(){function d(g){this.glMaterial=g;this._refCnt=0}var f=d.prototype;f.ref=function(){++this._refCnt};f.unref=function(){--this._refCnt;u.assert(0<=this._refCnt)};b._createClass(d,[{key:"referenced",get:function(){return 0<this._refCnt}}]);return d}();a.GLMaterialRepository=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/uid ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){let m=function(){function w(x){this._originSR=x;this._origins=new Map;this._objects=new Map;this._gridSize=5E5;this._rootOriginId="root/"+c.generateUID()}var r=w.prototype;r.getOrigin=function(x){var D=this._origins.get(this._rootOriginId);if(null==D){D=h.gridLocalOriginFactory.rootOrigin;if(null!=D)return this._origins.set(this._rootOriginId,g.fromValues(D[0],D[1],D[2],this._rootOriginId)),this.getOrigin(x);x=g.fromValues(x[0]+Math.random()-.5,x[1]+Math.random()-
.5,x[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,x);return x}var A=this._gridSize;const v=Math.round(x[0]/A),B=Math.round(x[1]/A),C=Math.round(x[2]/A),E=`${v}/${B}/${C}`;let F=this._origins.get(E);const M=.5*A;y.subtract(t,x,D.vec3);t[0]=Math.abs(t[0]);t[1]=Math.abs(t[1]);t[2]=Math.abs(t[2]);if(t[0]<M&&t[1]<M&&t[2]<M)return F&&(A=Math.max(...t),y.subtract(t,x,F.vec3),t[0]=Math.abs(t[0]),t[1]=Math.abs(t[1]),t[2]=Math.abs(t[2]),Math.max(...t)<A)?F:D;F||(F=g.fromValues(v*
A,B*A,C*A,E),this._origins.set(E,F));return F};r._drawOriginBox=function(x,D=u.fromValues(1,1,0,1)){const A=window.view,v=A._stage;var B=D.toString();if(!this._objects.has(B)){this._material=new l.RibbonLineMaterial({width:2,color:D});v.add(this._material);D=new n.WebGLLayer(v,{pickable:!1});var C=new e.Object3D({castShadow:!1});v.add(C);D.add(C);this._objects.set(B,C)}B=this._objects.get(B);D=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];C=D.length;const E=Array(3*C),F=[],M=.5*this._gridSize;for(let K=
0;K<C;K++)E[3*K]=x[0]+(D[K]&1?M:-M),E[3*K+1]=x[1]+(D[K]&2?M:-M),E[3*K+2]=x[2]+(D[K]&4?M:-M),0<K&&F.push(K-1,K);q.projectBuffer(E,this._originSR,0,E,A.renderSpatialReference,0,C);x=new f.Geometry(this._material,[[z.VertexAttribute.POSITION,new k.Attribute(E,3,!0)]],[[z.VertexAttribute.POSITION,F]],null,d.ContentObjectType.Line);v.add(x);B.addGeometry(x)};b._createClass(w,[{key:"test",get:function(){const x=this;return{set gridSize(D){x._gridSize=D}}}}]);return w}();const t=p.create();a.GridLocalOriginFactory=
m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){q=function(e){function h(n,l,m=""){var t=e.call(this)||this;t.stage=n;t.apiLayerUid=m;t.type=k.ContentObjectType.Layer;t.events=new c;t.sliceable=!1;t._objects=new u;t._objectsAdded=new u;t._handles=new y;t.apiLayerUid=m;t.visible=l?.visible??!0;t.pickable=l?.pickable??!0;t.updatePolicy=l?.updatePolicy??g.UpdatePolicy.ASYNC;t._disableOctree=l?.disableOctree??!1;n.add(b._assertThisInitialized(t));for(const w of d.DirtyEventNames)t._handles.add(t.events.on(w,r=>n.handleEvent(w,
r)));return t}b._inherits(h,e);var z=h.prototype;z.destroy=function(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())};z.add=function(n){this._objects.push(n);n.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:n});null!=this._octree&&this._objectsAdded.push(n)};z.remove=function(n){this._objects.removeUnordered(n)&&(n.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:n}),null!=this._octree&&
(this._objectsAdded.removeUnordered(n)||this._octree.remove([n])))};z.addMany=function(n){this._objects.pushArray(n);for(const l of n)l.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:n});null!=this._octree&&this._objectsAdded.pushArray(n)};z.removeMany=function(n){const l=[];this._objects.removeUnorderedMany(n,n.length,l);if(0!==l.length){for(const m of l)m.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:l});if(null!=this._octree){for(n=0;n<l.length;)this._objectsAdded.removeUnordered(l[n])?
(l[n]=l[l.length-1],--l.length):++n;this._octree.remove(l)}}};z.sync=function(){this.updatePolicy!==g.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)};z.notifyObjectBBChanged=function(n,l){null==this._octree||this._objectsAdded.includes(n)||this._octree.update(n,l)};z.getSpatialQueryAccelerator=function(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new f(n=>n.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&
0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree};z.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};z.invalidateSpatialQueryAccelerator=function(){this._octree=p.destroyMaybe(this._octree);this._objectsAdded.clear()};b._createClass(h,[{key:"objects",get:function(){return this._objects}}]);return h}(q.ContentObject);a.WebGLLayer=
q;a.isWebGLLayer=function(e){return null!=e&&e.type===k.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved objectGeometryUpdated".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,c,y,p,u,q,k,d){function f(I,H,J){J[0]=I[0]+H;J[1]=I[1]+H;J[2]=I[2]+H}function g(I,H,J,N){if(1===H)I=
J(I[0]),k.copy(I,N);else{v[0]=Infinity;v[1]=Infinity;v[2]=Infinity;B[0]=-Infinity;B[1]=-Infinity;B[2]=-Infinity;for(let P=0;P<H;P++){var R=J(I[P]);if(n(R[3])){var W=v,T=R;W[0]=Math.min(W[0],T[0]-T[3]);W[1]=Math.min(W[1],T[1]-T[3]);W[2]=Math.min(W[2],T[2]-T[3]);W=B;W[0]=Math.max(W[0],R[0]+R[3]);W[1]=Math.max(W[1],R[1]+R[3]);W[2]=Math.max(W[2],R[2]+R[3])}}y.lerp(N,v,B,.5);N[3]=Math.max(B[0]-v[0],B[1]-v[1],B[2]-v[2])/2}}function e(I,H,J){if(!L.length)for(var N=0;8>N;++N)L.push({index:0,distance:0});
for(N=0;8>N;++N){const R=t[N];L.data[N].index=N;L.data[N].distance=z(I,H,R)}L.sort((R,W)=>R.distance-W.distance);for(I=0;8>I;++I)J[I]=L.data[I].index}function h(I,H){let J=Infinity,N;for(let R=0;8>R;++R){const W=z(I,H,w[R]);W<J&&(J=W,N=w[R])}return N}function z(I,H,J){return H*(I[0]*J[0]+I[1]*J[1]+I[2]*J[2])}function n(I){return!isNaN(I)&&-Infinity!==I&&Infinity!==I&&0<I}let l=function(){function I(J,N){this.objectToBoundingSphere=J;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=
new Set;this._root=new m;this._objectCount=0;N&&(void 0!==N.maximumObjectsPerNode&&(this._maximumObjectsPerNode=N.maximumObjectsPerNode),void 0!==N.maximumDepth&&(this._maximumDepth=N.maximumDepth))}var H=I.prototype;H.destroy=function(){this._degenerateObjects.clear();m.clearPool();x[0]=null;C.prune();L.prune()};H.add=function(J,N=J.length){this._objectCount+=N;this._grow(J,N);const R=m.acquire();for(let W=0;W<N;W++){const T=J[W];this._isDegenerate(T)?this._degenerateObjects.add(T):(R.init(this._root),
this._add(T,R))}m.release(R)};H.remove=function(J,N=null){this._objectCount-=J.length;const R=m.acquire();for(const W of J)J=null!=N?N:k.copy(this.objectToBoundingSphere(W),E),n(J[3])?(R.init(this._root),this._remove(W,J,R)):this._degenerateObjects.delete(W);m.release(R);this._shrink()};H.update=function(J,N){if(n(N[3])||!this._isDegenerate(J))x[0]=J,J=x,this.remove(J,N),this.add(J)};H.forEachAlongRay=function(J,N,R){const W=q.wrap(J,N);this._forEachNode(this._root,T=>{if(!this._intersectsNode(W,
T))return!1;T=T.node;T.terminals.forAll(P=>{this._intersectsObject(W,P)&&R(P)});null!==T.residents&&T.residents.forAll(P=>{this._intersectsObject(W,P)&&R(P)});return!0})};H.forEachAlongRayWithVerticalOffset=function(J,N,R,W){const T=q.wrap(J,N);this._forEachNode(this._root,P=>{if(!this._intersectsNodeWithOffset(T,P,W))return!1;P=P.node;P.terminals.forAll(Q=>{this._intersectsObjectWithOffset(T,Q,W)&&R(Q)});null!==P.residents&&P.residents.forAll(Q=>{this._intersectsObjectWithOffset(T,Q,W)&&R(Q)});return!0})};
H.forEach=function(J){this._forEachNode(this._root,N=>{N=N.node;N.terminals.forAll(J);null!==N.residents&&N.residents.forAll(J);return!0});this._degenerateObjects.forEach(J)};H.forEachDegenerateObject=function(J){this._degenerateObjects.forEach(J)};H.findClosest=function(J,N,R,W=()=>!0,T=Infinity){let P=Infinity,Q=Infinity,S=null;const U=h(J,N),V=X=>{--T;if(W(X)){var Y=this.objectToBoundingSphere(X);if(u.intersectsSphere(R,Y)){var Z=z(J,N,k.getCenter(Y)),ea=Z-Y[3];Y=Z+Y[3];ea<P&&(P=ea,Q=Y,S=X)}}};
this._forEachNodeDepthOrdered(this._root,X=>{if(0>=T||!u.intersectsSphere(R,X.bounds))return!1;y.scale(A,U,X.halfSize);y.add(A,A,X.bounds);if(z(J,N,A)>Q)return!1;X=X.node;X.terminals.forAll(Y=>V(Y));null!==X.residents&&X.residents.forAll(Y=>V(Y));return!0},J,N);return S};H.forEachInDepthRange=function(J,N,R,W,T,P,Q){let S=-Infinity,U=Infinity;const V={setRange:ja=>{R===I.DepthOrder.FRONT_TO_BACK?(S=Math.max(S,ja.near),U=Math.min(U,ja.far)):(S=Math.max(S,-ja.far),U=Math.min(U,-ja.near))}};V.setRange(W);
const X=z(N,R,J),Y=h(N,R),Z=h(N,-R),ea=ja=>{if(Q(ja)){var ha=this.objectToBoundingSphere(ja),ia=k.getCenter(ha);ia=z(N,R,ia)-X;var oa=ia+ha[3];ia-ha[3]>U||oa<S||!u.intersectsSphere(P,ha)||T(ja,V)}};this._forEachNodeDepthOrdered(this._root,ja=>{if(!u.intersectsSphere(P,ja.bounds))return!1;y.scale(A,Y,ja.halfSize);y.add(A,A,ja.bounds);if(z(N,R,A)-X>U)return!1;y.scale(A,Z,ja.halfSize);y.add(A,A,ja.bounds);if(z(N,R,A)-X<S)return!1;ja=ja.node;ja.terminals.forAll(ha=>ea(ha));null!==ja.residents&&ja.residents.forAll(ha=>
ea(ha));return!0},N,R)};H.forEachNode=function(J){this._forEachNode(this._root,N=>J(N.node,N.bounds,N.halfSize,N.depth))};H.forEachNeighbor=function(J,N){const R=k.getRadius(N),W=k.getCenter(N),T=S=>{const U=this.objectToBoundingSphere(S);var V=k.getRadius(U);V=R+V;return 0>=y.squaredDistance(k.getCenter(U),W)-V*V?J(S):!0};let P=!0;const Q=S=>{P&&(P=T(S))};this._forEachNode(this._root,S=>{var U=k.getRadius(S.bounds);U=R+U;if(0<y.squaredDistance(k.getCenter(S.bounds),W)-U*U)return!1;S=S.node;S.terminals.forAll(Q);
P&&null!==S.residents&&S.residents.forAll(Q);return P});P&&this.forEachDegenerateObject(Q)};H._intersectsNode=function(J,N){f(N.bounds,2*-N.halfSize,v);f(N.bounds,2*N.halfSize,B);return d.rayBoxTest(J.origin,J.direction,v,B)};H._intersectsNodeWithOffset=function(J,N,R){f(N.bounds,2*-N.halfSize,v);f(N.bounds,2*N.halfSize,B);R.applyToMinMax(v,B);return d.rayBoxTest(J.origin,J.direction,v,B)};H._intersectsObject=function(J,N){N=this.objectToBoundingSphere(N);return 0<N[3]?k.intersectsRay(N,J):!0};H._intersectsObjectWithOffset=
function(J,N,R){N=this.objectToBoundingSphere(N);return 0<N[3]?k.intersectsRay(R.applyToBoundingSphere(N),J):!0};H._forEachNode=function(J,N){J=m.acquire().init(J);const R=[J];for(;0!==R.length;){J=R.pop();if(N(J)&&!J.isLeaf())for(let W=0;W<J.node.children.length;W++)J.node.children[W]&&R.push(m.acquire().init(J).advance(W));m.release(J)}};H._forEachNodeDepthOrdered=function(J,N,R,W=I.DepthOrder.FRONT_TO_BACK){J=m.acquire().init(J);const T=[J];for(e(R,W,O);0!==T.length;){J=T.pop();if(N(J)&&!J.isLeaf())for(R=
7;0<=R;--R)W=O[R],J.node.children[W]&&T.push(m.acquire().init(J).advance(W));m.release(J)}};H._remove=function(J,N,R){C.clear();N=R.advanceTo(N,(W,T)=>{C.push(W.node);C.push(T)})?R.node.terminals:R.node.residents;N.removeUnordered(J);if(0===N.length)for(J=C.length-2;0<=J&&this._purge(C.data[J],C.data[J+1]);J-=2);};H._nodeIsEmpty=function(J){if(0!==J.terminals.length)return!1;if(null!==J.residents)return 0===J.residents.length;for(let N=0;N<J.children.length;N++)if(J.children[N])return!1;return!0};
H._purge=function(J,N){0<=N&&(J.children[N]=null);return this._nodeIsEmpty(J)?(null===J.residents&&(J.residents=new c({shrink:!0})),!0):!1};H._add=function(J,N){N.advanceTo(this.objectToBoundingSphere(J))?N.node.terminals.push(J):(N.node.residents.push(J),N.node.residents.length>this._maximumObjectsPerNode&&N.depth<this._maximumDepth&&this._split(N))};H._split=function(J){const N=J.node.residents;J.node.residents=null;for(let R=0;R<N.length;R++){const W=m.acquire().init(J);this._add(N.at(R),W);m.release(W)}};
H._grow=function(J,N){0!==N&&(g(J,N,R=>this.objectToBoundingSphere(R),F),n(F[3])&&!this._fitsInsideTree(F)&&(this._nodeIsEmpty(this._root.node)?(k.copy(F,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(J=this._rootBoundsForRootAsSubNode(F),this._placingRootViolatesMaxDepth(J)?this._rebuildTree(F,J):this._growRootAsSubNode(J),m.release(J))))};H._rebuildTree=function(J,N){y.copy(M,N.bounds);M[3]=N.halfSize;g([J,M],2,R=>R,K);J=m.acquire().init(this._root);
this._root.initFrom(null,K,K[3]);this._root.increaseHalfSize(1.25);this._forEachNode(J,R=>{this.add(R.node.terminals.data,R.node.terminals.length);null!==R.node.residents&&this.add(R.node.residents.data,R.node.residents.length);return!0});m.release(J)};H._placingRootViolatesMaxDepth=function(J){const N=Math.log(J.halfSize/this._root.halfSize)*Math.LOG2E;let R=0;this._forEachNode(this._root,W=>{R=Math.max(R,W.depth);return R+N<=this._maximumDepth});return R+N>this._maximumDepth};H._rootBoundsForRootAsSubNode=
function(J){var N=J[3],R=-Infinity;const W=this._root.bounds,T=this._root.halfSize;for(var P=0;3>P;P++){var Q=Math.max(0,Math.ceil((W[P]-T-(J[P]-N))/(2*T)));const S=Math.max(0,Math.ceil((J[P]+N-(W[P]+T))/(2*T)))+1;R=Math.max(R,2**Math.ceil(Math.log(Q+S)*Math.LOG2E));G[P].min=Q;G[P].max=S}for(J=0;3>J;J++)N=G[J].min,P=G[J].max,Q=(R-(N+P))/2,N+=Math.ceil(Q),P+=Math.floor(Q),D[J]=W[J]-T-N*T*2+(P+N)*T;R*=T;D[3]=R*r;return m.acquire().initFrom(null,D,R,0)};H._growRootAsSubNode=function(J){const N=this._root.node;
y.copy(F,this._root.bounds);F[3]=this._root.halfSize;this._root.init(J);J.advanceTo(F,null,!0);J.node.children=N.children;J.node.residents=N.residents;J.node.terminals=N.terminals};H._shrink=function(){for(;;){const J=this._findShrinkIndex();if(-1===J)break;this._root.advance(J);this._root.depth=0}};H._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let J=null;const N=this._root.node.children;let R=0,W=0;for(;W<N.length&&null==J;)R=W++,J=N[R];for(;W<
N.length;)if(N[W++])return-1;return R};H._isDegenerate=function(J){J=this.objectToBoundingSphere(J)[3];return!n(J)};H._fitsInsideTree=function(J){const N=this._root.bounds,R=this._root.halfSize;return J[3]<=R&&J[0]>=N[0]-R&&J[0]<=N[0]+R&&J[1]>=N[1]-R&&J[1]<=N[1]+R&&J[2]>=N[2]-R&&J[2]<=N[2]+R};H.toJSON=function(){const {maximumDepth:J,maximumObjectsPerNode:N,_objectCount:R}=this,W=this._nodeToJSON(this._root.node);return{maximumDepth:J,maximumObjectsPerNode:N,objectCount:R,root:{bounds:this._root.bounds,
halfSize:this._root.halfSize,depth:this._root.depth,node:W}}};H._nodeToJSON=function(J){const N=J.children.map(W=>W?this._nodeToJSON(W):null),R=J.residents?.map(W=>this.objectToBoundingSphere(W));J=J.terminals?.map(W=>this.objectToBoundingSphere(W));return{children:N,residents:R,terminals:J}};I.fromJSON=function(J){const N=new I(R=>R,{maximumDepth:J.maximumDepth,maximumObjectsPerNode:J.maximumObjectsPerNode});N._objectCount=J.objectCount;N._root.initFrom(J.root.node,J.root.bounds,J.root.halfSize,
J.root.depth);return N};a._createClass(I,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return I}(),m=function(){function I(){this.bounds=k.create();this.halfSize=0;this.initFrom(null,
null,0,0)}var H=I.prototype;H.init=function(J){return this.initFrom(J.node,J.bounds,J.halfSize,J.depth)};H.initFrom=function(J,N,R,W=this.depth){this.node=null!=J?J:I.createEmptyNode();null!=N&&k.copy(N,this.bounds);this.halfSize=R;this.depth=W;return this};H.increaseHalfSize=function(J){this.halfSize*=J;this.updateBoundsRadiusFromHalfSize()};H.updateBoundsRadiusFromHalfSize=function(){this.bounds[3]=this.halfSize*r};H.advance=function(J){let N=this.node.children[J];N||(N=I.createEmptyNode(),this.node.children[J]=
N);this.node=N;this.halfSize/=2;this.depth++;J=t[J];this.bounds[0]+=J[0]*this.halfSize;this.bounds[1]+=J[1]*this.halfSize;this.bounds[2]+=J[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this};H.advanceTo=function(J,N,R=!1){for(;;){if(this.isTerminalFor(J))return N&&N(this,-1),!0;if(this.isLeaf()){if(!R)return N&&N(this,-1),!1;this.node.residents=null}const W=this._childIndex(J);N&&N(this,W);this.advance(W)}};H.isLeaf=function(){return null!=this.node.residents};H.isTerminalFor=function(J){return J[3]>
this.halfSize/2};H._childIndex=function(J){const N=this.bounds;return(N[0]<J[0]?1:0)+(N[1]<J[1]?2:0)+(N[2]<J[2]?4:0)};I.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new c({shrink:!0}),residents:new c({shrink:!0})}};I.acquire=function(){return I._pool.acquire()};I.release=function(J){I._pool.release(J)};I.clearPool=function(){I._pool.prune()};return a._createClass(I)}();m._pool=new b(m);(function(I){I=I.DepthOrder||(I.DepthOrder={});I[I.FRONT_TO_BACK=
1]="FRONT_TO_BACK";I[I.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(l||(l={}));const t=[p.fromValues(-1,-1,-1),p.fromValues(1,-1,-1),p.fromValues(-1,1,-1),p.fromValues(1,1,-1),p.fromValues(-1,-1,1),p.fromValues(1,-1,1),p.fromValues(-1,1,1),p.fromValues(1,1,1)],w=[p.fromValues(-1,-1,-1),p.fromValues(-1,-1,1),p.fromValues(-1,1,-1),p.fromValues(-1,1,1),p.fromValues(1,-1,-1),p.fromValues(1,-1,1),p.fromValues(1,1,-1),p.fromValues(1,1,1)],r=Math.sqrt(3),x=[null],D=k.create(),A=p.create(),v=p.create(),B=p.create(),
C=new c,E=k.create(),F=k.create(),M=k.create(),K=k.create(),G=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],L=new c,O=[0,0,0,0,0,0,0,0];return l})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B){function C(oa,ma,fa,ba,aa){for(let da=0;da<aa;da++)fa[ba++]=oa[ma++];return ba}function E(oa,ma,fa){ma=ma.get(r.VertexAttribute.POSITION).data;fa=fa?fa.get(r.VertexAttribute.POSITION):null;return oa.isClosed?fa?2<fa.length:6<ma.length:!1}var F;(function(oa){oa[oa.LEFT_JOIN_START=-2]="LEFT_JOIN_START";oa[oa.LEFT_JOIN_END=-1]="LEFT_JOIN_END";oa[oa.LEFT_CAP_START=-4]="LEFT_CAP_START";oa[oa.LEFT_CAP_END=-5]="LEFT_CAP_END";oa[oa.RIGHT_JOIN_START=
2]="RIGHT_JOIN_START";oa[oa.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";oa[oa.RIGHT_CAP_START=4]="RIGHT_CAP_START";oa[oa.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(F||(F={}));let M=function(oa){function ma(ba){ba=oa.call(this,ba,new G)||this;ba._configuration=new B.RibbonLineTechniqueConfiguration;ba._vertexAttributeLocations=v.vertexAttributeLocations;return ba}b._inherits(ma,oa);var fa=ma.prototype;fa.isClosed=function(ba,aa){return this.parameters.isClosed?aa?2<aa.length:6<ba.length:!1};fa.getConfiguration=function(ba,
aa){this._configuration.output=ba;this._configuration.draped=aa.slot===t.RenderSlot.DRAPED_MATERIAL;ba=null!=this.parameters.stipplePattern&&ba!==n.ShaderOutput.Highlight;this._configuration.stippleEnabled=ba;this._configuration.stippleOffColorEnabled=ba&&null!=this.parameters.stippleOffColor;this._configuration.stippleScaleWithLineWidth=ba&&this.parameters.stippleScaleWithLineWidth;this._configuration.stipplePreferContinuous=ba&&this.parameters.stipplePreferContinuous;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;ba=this._configuration;if(null!=this.parameters.markerParameters){var da=this.parameters.markerParameters;da=da.anchor===D.LineMarkerAnchor.Tip&&da.hideOnShortSegments&&"begin-end"===da.placement&&da.worldSpace}else da=!1;ba.applyMarkerOffset=da;this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset;
this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=
aa.transparencyPassType;this._configuration.hasMultipassTerrain=aa.multipassTerrain.enabled;this._configuration.cullAboveGround=aa.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration};fa.intersectDraped=function(ba,aa,da,ca,na,qa){if(da.options.selectionMode){aa=ba.vertexAttributes.get(r.VertexAttribute.POSITION).data;da=ba.vertexAttributes.get(r.VertexAttribute.SIZE);var ua=this.parameters.width;this.parameters.vvSize?(da=ba.vertexAttributes.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],
ua*=p.clamp(this.parameters.vvSize.offset[0]+da*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):da&&(ua*=da.data[0]);da=ca[0];ca=ca[1];ba=(ua/2+4)*ba.screenToWorldRatio;ua=Number.MAX_VALUE;var sa=0;for(let Ca=0;Ca<aa.length-5;Ca+=3){var pa=aa[Ca],ka=aa[Ca+1],ra=da-pa,va=ca-ka;pa=aa[Ca+3]-pa;ka=aa[Ca+4]-ka;const Ba=p.clamp((pa*ra+ka*va)/(pa*pa+ka*ka),0,1);ra=pa*Ba-ra;va=ka*Ba-va;va=ra*ra+va*va;va<ua&&(ua=va,sa=Ca/3)}ua<ba*ba&&na(qa.dist,qa.normal,
sa,!1)}};fa.intersect=function(ba,aa,da,ca,na,qa){if(da.options.selectionMode&&ba.visible)if(w.isTranslationMatrix(aa)){var ua=ba.vertexAttributes;na=ua.get(r.VertexAttribute.POSITION).data;ca=this.parameters.width;if(this.parameters.vvSize){var sa=ua.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];ca*=p.clamp(this.parameters.vvSize.offset[0]+sa*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else ua.has(r.VertexAttribute.SIZE)&&(ca*=ua.get(r.VertexAttribute.SIZE).data[0]);
var pa=da.camera,ka=N;q.copy(ka,da.point);sa=ca*pa.pixelRatio/2+4*pa.pixelRatio;k.set(Y[0],ka[0]-sa,ka[1]+sa,0);k.set(Y[1],ka[0]+sa,ka[1]+sa,0);k.set(Y[2],ka[0]+sa,ka[1]-sa,0);k.set(Y[3],ka[0]-sa,ka[1]-sa,0);for(ca=0;4>ca;ca++)if(!pa.unprojectFromRenderScreen(Y[ca],Z[ca]))return;h.fromPoints(pa.eye,Z[0],Z[1],ea);h.fromPoints(pa.eye,Z[1],Z[2],ja);h.fromPoints(pa.eye,Z[2],Z[3],ha);h.fromPoints(pa.eye,Z[3],Z[0],ia);var ra=Number.MAX_VALUE;ca=0;ba=E(this.parameters,ua,ba.indices)?na.length-2:na.length-
5;for(ua=0;ua<ba;ua+=3){O[0]=na[ua]+aa[12];O[1]=na[ua+1]+aa[13];O[2]=na[ua+2]+aa[14];var va=(ua+3)%na.length;I[0]=na[va]+aa[12];I[1]=na[va+1]+aa[13];I[2]=na[va+2]+aa[14];if(!(0>h.signedDistance(ea,O)&&0>h.signedDistance(ea,I)||0>h.signedDistance(ja,O)&&0>h.signedDistance(ja,I)||0>h.signedDistance(ha,O)&&0>h.signedDistance(ha,I)||0>h.signedDistance(ia,O)&&0>h.signedDistance(ia,I))){pa.projectToRenderScreen(O,R);pa.projectToRenderScreen(I,W);if(0>R[2]&&0<W[2])k.subtract(H,O,I),va=pa.frustum,va=-h.signedDistance(va[g.PlaneIndex.NEAR],
O)/k.dot(H,h.normal(va[g.PlaneIndex.NEAR])),k.scale(H,H,va),k.add(O,O,H),pa.projectToRenderScreen(O,R);else if(0<R[2]&&0>W[2])k.subtract(H,I,O),va=pa.frustum,va=-h.signedDistance(va[g.PlaneIndex.NEAR],I)/k.dot(H,h.normal(va[g.PlaneIndex.NEAR])),k.scale(H,H,va),k.add(I,I,H),pa.projectToRenderScreen(I,W);else if(0>R[2]&&0>W[2])continue;R[2]=0;W[2]=0;va=e.distance2(e.fromPoints(R,W,Q),ka);va<ra&&(ra=va,k.copy(T,O),k.copy(P,I),ca=ua/3)}}aa=da.rayBegin;da=da.rayEnd;ra<sa*sa&&(na=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(T,
P,Q),e.fromPoints(aa,da,S),J)&&(k.subtract(J,J,aa),na=k.length(J),k.scale(J,J,1/na),na/=k.distance(aa,da)),qa(na,J,ca,!1))}else y.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")};fa.createBufferWriter=function(){return new L(this._layout,this.parameters)};fa.requiresSlot=function(ba,aa){return aa===n.ShaderOutput.Color||aa===n.ShaderOutput.Alpha||aa===n.ShaderOutput.Highlight||aa===n.ShaderOutput.Depth||aa===n.ShaderOutput.ObjectAndLayerIdColor?
ba===t.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil?ba===t.RenderSlot.OPAQUE_MATERIAL||ba===t.RenderSlot.OCCLUDER_MATERIAL||ba===t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:aa===n.ShaderOutput.Color||aa===n.ShaderOutput.Alpha?ba===(this.parameters.writeDepth?t.RenderSlot.TRANSPARENT_MATERIAL:t.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):ba===t.RenderSlot.OPAQUE_MATERIAL:!1};fa.createGLMaterial=function(ba){return new K(ba)};
fa.validateParameters=function(ba){"miter"!==ba.join&&(ba.miterLimit=0);null!=ba.markerParameters&&(ba.markerScale=ba.markerParameters.width/ba.width)};b._createClass(ma,[{key:"_layout",get:function(){const ba=z.newLayout().vec3f(r.VertexAttribute.POSITION).f32(r.VertexAttribute.SUBDIVISIONFACTOR).vec2f(r.VertexAttribute.UV0).vec3f(r.VertexAttribute.AUXPOS1).vec3f(r.VertexAttribute.AUXPOS2);this.parameters.vvSize?ba.f32(r.VertexAttribute.SIZEFEATUREATTRIBUTE):ba.f32(r.VertexAttribute.SIZE);this.parameters.vvColor?
ba.f32(r.VertexAttribute.COLORFEATUREATTRIBUTE):ba.vec4f(r.VertexAttribute.COLOR);this.parameters.vvOpacity&&ba.f32(r.VertexAttribute.OPACITYFEATUREATTRIBUTE);c("enable-feature:objectAndLayerId-rendering")&&ba.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR);return ba}}]);return ma}(m.Material),K=function(oa){function ma(){var ba=oa.apply(this,arguments)||this;ba._stipplePattern=null;return ba}b._inherits(ma,oa);var fa=ma.prototype;fa.dispose=function(){b._get(b._getPrototypeOf(ma.prototype),"dispose",
this).call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};fa._updateOccludeeState=function(ba){ba.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ba.hasOccludees})};fa.beginSlot=function(ba){this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(ba);const aa=this._material.parameters.stipplePattern;this._stipplePattern!==aa&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(aa,
this._stipplePattern)}),this._stipplePattern=aa);return this.ensureTechnique(v.RibbonLineTechnique,ba)};return b._createClass(ma)}(l),G=function(oa){function ma(){var fa=oa.apply(this,arguments)||this;fa.width=0;fa.color=f.ONES;fa.join="miter";fa.cap=B.CapType.BUTT;fa.miterLimit=5;fa.writeDepth=!0;fa.hasPolygonOffset=!1;fa.stippleTexture=null;fa.stippleScaleWithLineWidth=!1;fa.stipplePreferContinuous=!0;fa.markerParameters=null;fa.markerScale=1;fa.hasSlicePlane=!1;fa.vvFastUpdate=!1;fa.isClosed=!1;
fa.falloff=0;fa.innerWidth=0;fa.hasOccludees=!1;fa.wireframe=!1;return fa}b._inherits(ma,oa);return b._createClass(ma)}(x.VisualVariablePassParameters),L=function(){function oa(fa,ba){this._parameters=ba;this.numJoinSubdivisions=0;this.vertexBufferLayout=fa;fa=ba.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=fa;break;case "round":this.numJoinSubdivisions=A.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS+fa}}var ma=oa.prototype;ma._isClosed=function(fa){return E(this._parameters,
fa.vertexAttributes,fa.indices)};ma.allocate=function(fa){return this.vertexBufferLayout.createBuffer(fa)};ma.elementCount=function(fa){var ba=fa.indices.get(r.VertexAttribute.POSITION).length/2+1;fa=this._isClosed(fa);ba=(fa?2:4)+((fa?ba:ba-1)-(fa?0:1))*(2*this.numJoinSubdivisions+4);ba+=2;this._parameters.wireframe&&(ba=2+4*(ba-2));return ba};ma.write=function(fa,ba,aa,da,ca){ba=U;const na=V,qa=X,ua=aa.vertexAttributes.get(r.VertexAttribute.POSITION).data;var sa=aa.indices&&aa.indices.get(r.VertexAttribute.POSITION);
const pa=aa.vertexAttributes.get(r.VertexAttribute.DISTANCETOSTART)?.data;sa&&sa.length!==2*(ua.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let ka=1,ra=0;this._parameters.vvSize?ra=aa.vertexAttributes.get(r.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:aa.vertexAttributes.has(r.VertexAttribute.SIZE)&&(ka=aa.vertexAttributes.get(r.VertexAttribute.SIZE).data[0]);let va=[1,1,1,1],Ca=0;this._parameters.vvColor?Ca=aa.vertexAttributes.get(r.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:
aa.vertexAttributes.has(r.VertexAttribute.COLOR)&&(va=aa.vertexAttributes.get(r.VertexAttribute.COLOR).data);const Ba=c("enable-feature:objectAndLayerId-rendering")?aa.objectAndLayerIdColor:null;let Ha=0;this._parameters.vvOpacity&&(Ha=aa.vertexAttributes.get(r.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);sa=ua.length/3;const Ma=new Float32Array(da.buffer),Qa=c("enable-feature:objectAndLayerId-rendering")?new Uint8Array(da.buffer):null,Sa=this.vertexBufferLayout.stride/4;let La=ca*Sa;ca=La;let Ua=
0;const Va=pa?(za,Ga,Fa)=>Ua=pa[Fa]:(za,Ga,Fa)=>Ua+=k.distance(za,Ga),cb=c("enable-feature:objectAndLayerId-rendering"),la=(za,Ga,Fa,xa,ya,Ea,Oa)=>{Ma[La++]=Ga[0];Ma[La++]=Ga[1];Ma[La++]=Ga[2];Ma[La++]=xa;Ma[La++]=Oa;Ma[La++]=ya;Ma[La++]=za[0];Ma[La++]=za[1];Ma[La++]=za[2];Ma[La++]=Fa[0];Ma[La++]=Fa[1];Ma[La++]=Fa[2];Ma[La++]=this._parameters.vvSize?ra:ka;this._parameters.vvColor?Ma[La++]=Ca:(za=Math.min(4*Ea,va.length-4),Ma[La++]=va[za],Ma[La++]=va[za+1],Ma[La++]=va[za+2],Ma[La++]=va[za+3]);this._parameters.vvOpacity&&
(Ma[La++]=Ha);cb&&(null!=Ba&&(Qa[4*La]=Ba[0],Qa[4*La+1]=Ba[1],Qa[4*La+2]=Ba[2],Qa[4*La+3]=Ba[3]),La++)};La+=Sa;k.set(na,ua[0],ua[1],ua[2]);fa&&k.transformMat4(na,na,fa);if(aa=this._isClosed(aa)){var eb=ua.length-3;k.set(ba,ua[eb],ua[eb+1],ua[eb+2]);fa&&k.transformMat4(ba,ba,fa)}else k.set(qa,ua[3],ua[4],ua[5]),fa&&k.transformMat4(qa,qa,fa),la(na,na,qa,1,F.LEFT_CAP_START,0,0),la(na,na,qa,1,F.RIGHT_CAP_START,0,0),k.copy(ba,na),k.copy(na,qa);eb=aa?0:1;const ib=aa?sa:sa-1;for(let za=eb;za<ib;za++){var Pa=
(za+1)%sa*3;k.set(qa,ua[Pa],ua[Pa+1],ua[Pa+2]);fa&&k.transformMat4(qa,qa,fa);Va(ba,na,za);la(ba,na,qa,0,F.LEFT_JOIN_END,za,Ua);la(ba,na,qa,0,F.RIGHT_JOIN_END,za,Ua);Pa=this.numJoinSubdivisions;for(let Ga=0;Ga<Pa;++Ga){const Fa=(Ga+1)/(Pa+1);la(ba,na,qa,Fa,F.LEFT_JOIN_END,za,Ua);la(ba,na,qa,Fa,F.RIGHT_JOIN_END,za,Ua)}la(ba,na,qa,1,F.LEFT_JOIN_START,za,Ua);la(ba,na,qa,1,F.RIGHT_JOIN_START,za,Ua);k.copy(ba,na);k.copy(na,qa)}aa?(k.set(qa,ua[3],ua[4],ua[5]),fa&&k.transformMat4(qa,qa,fa),Ua=Va(ba,na,ib),
la(ba,na,qa,0,F.LEFT_JOIN_END,eb,Ua),la(ba,na,qa,0,F.RIGHT_JOIN_END,eb,Ua)):(Ua=Va(ba,na,ib),la(ba,na,na,0,F.LEFT_CAP_END,ib,Ua),la(ba,na,na,0,F.RIGHT_CAP_END,ib,Ua));C(Ma,ca+Sa,Ma,ca,Sa);La=C(Ma,La-Sa,Ma,La,Sa);this._parameters.wireframe&&this._addWireframeVertices(da,ca,La,Sa)};ma._addWireframeVertices=function(fa,ba,aa,da){const ca=new Float32Array(fa.buffer,aa*Float32Array.BYTES_PER_ELEMENT);fa=new Float32Array(fa.buffer,ba*Float32Array.BYTES_PER_ELEMENT,aa-ba);ba=0;for(aa=0;aa<fa.length-1;aa+=
2*da)ba=C(fa,aa,ca,ba,da),ba=C(fa,aa+2*da,ca,ba,da),ba=C(fa,aa+1*da,ca,ba,da),ba=C(fa,aa+2*da,ca,ba,da),ba=C(fa,aa+1*da,ca,ba,da),ba=C(fa,aa+3*da,ca,ba,da)};return b._createClass(oa)}();const O=d.create(),I=d.create(),H=d.create(),J=d.create(),N=d.create(),R=u.createRenderScreenPointArray3(),W=u.createRenderScreenPointArray3(),T=d.create(),P=d.create(),Q=e.create(),S=e.create(),U=d.create(),V=d.create(),X=d.create(),Y=[u.createRenderScreenPointArray3(),u.createRenderScreenPointArray3(),u.createRenderScreenPointArray3(),
u.createRenderScreenPointArray3()],Z=[d.create(),d.create(),d.create(),d.create()],ea=h.create(),ja=h.create(),ha=h.create(),ia=h.create();a.Parameters=G;a.RibbonLineMaterial=M;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q){a.LineMarkerSpace=void 0;(function(k){k[k.Draped=0]="Draped";k[k.Screen=1]="Screen";k[k.World=2]="World";k[k.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(k){k[k.Center=0]="Center";k[k.Tip=1]="Tip";k[k.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));q=function(k){function d(){var f=k.apply(this,arguments)||this;f.output=y.ShaderOutput.Color;f.transparencyPassType=u.TransparencyPassType.NONE;f.occluder=!1;f.hasSlicePlane=
!1;f.writeDepth=!1;f.space=a.LineMarkerSpace.Screen;f.hideOnShortSegments=!1;f.hasCap=!1;f.anchor=a.LineMarkerAnchor.Center;f.hasTip=!1;f.vvSize=!1;f.vvColor=!1;f.vvOpacity=!1;f.hasOccludees=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;return f}b._inherits(d,k);b._createClass(d,[{key:"draped",get:function(){return this.space===a.LineMarkerSpace.Draped}}]);return d}(q.DefaultTechniqueConfiguration);c.__decorate([p.parameter({count:y.ShaderOutput.COUNT})],q.prototype,"output",void 0);c.__decorate([p.parameter({count:u.TransparencyPassType.COUNT})],
q.prototype,"transparencyPassType",void 0);c.__decorate([p.parameter()],q.prototype,"occluder",void 0);c.__decorate([p.parameter()],q.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],q.prototype,"writeDepth",void 0);c.__decorate([p.parameter({count:a.LineMarkerSpace.COUNT})],q.prototype,"space",void 0);c.__decorate([p.parameter()],q.prototype,"hideOnShortSegments",void 0);c.__decorate([p.parameter()],q.prototype,"hasCap",void 0);c.__decorate([p.parameter({count:a.LineMarkerAnchor.COUNT})],
q.prototype,"anchor",void 0);c.__decorate([p.parameter()],q.prototype,"hasTip",void 0);c.__decorate([p.parameter()],q.prototype,"vvSize",void 0);c.__decorate([p.parameter()],q.prototype,"vvColor",void 0);c.__decorate([p.parameter()],q.prototype,"vvOpacity",void 0);c.__decorate([p.parameter()],q.prototype,"hasOccludees",void 0);c.__decorate([p.parameter()],q.prototype,"hasMultipassTerrain",void 0);c.__decorate([p.parameter()],q.prototype,"cullAboveGround",void 0);c.__decorate([p.parameter({constValue:!0})],
q.prototype,"hasVvInstancing",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){function B(E){const F=new r.ShaderBuilder,{vertex:M,fragment:K}=F,G=E.hasMultipassTerrain&&(E.output===c.ShaderOutput.Color||E.output===c.ShaderOutput.Alpha);F.include(g.PiUtils);F.include(u.RibbonVertexPosition,E);F.include(k.LineStipple,E);const L=E.applyMarkerOffset&&!E.draped;L&&(M.uniforms.add(new m.FloatPassUniform("markerScale",W=>W.markerScale)),F.include(d.MarkerSizing,{space:A.LineMarkerSpace.World,draped:!1}));E.output===c.ShaderOutput.Depth&&
F.include(q.OutputDepth,E);F.include(p.ObjectAndLayerIdColor,E);z.addProjViewLocalOrigin(M,E);M.uniforms.add(new w.Matrix4PassUniform("inverseProjectionMatrix",(W,T)=>T.camera.inverseProjectionMatrix),new n.Float2PassUniform("nearFar",(W,T)=>T.camera.nearFar),new m.FloatPassUniform("miterLimit",W=>"miter"!==W.join?0:W.miterLimit),new l.Float4PassUniform("viewport",(W,T)=>T.camera.fullViewport));M.constants.add("LARGE_HALF_FLOAT","float",65500);F.attributes.add(D.VertexAttribute.POSITION,"vec3");F.attributes.add(D.VertexAttribute.SUBDIVISIONFACTOR,
"float");F.attributes.add(D.VertexAttribute.UV0,"vec2");F.attributes.add(D.VertexAttribute.AUXPOS1,"vec3");F.attributes.add(D.VertexAttribute.AUXPOS2,"vec3");F.varyings.add("vColor","vec4");F.varyings.add("vpos","vec3");b.addLinearDepth(F);G&&F.varyings.add("depth","float");const O=E.stippleEnabled&&E.stippleScaleWithLineWidth;O&&F.varyings.add("vLineSizeInv","float");const I=E.capType===v.CapType.ROUND,H=O||I;H&&F.varyings.add("vLineWidth","float");const J=E.innerColorEnabled||I;J&&F.varyings.add("vLineDistance",
"float");const N=E.stippleEnabled&&I,R=E.falloffEnabled||N;R&&F.varyings.add("vLineDistanceNorm","float");I&&(F.varyings.add("vSegmentSDF","float"),F.varyings.add("vReverseSegmentSDF","float"));M.code.add(t.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);M.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);b.addCalculateLinearDepth(F);M.code.add(t.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${G?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);z.addPixelRatio(M,E);M.code.add(t.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${H?t.glsl`vLineWidth = lineWidth;`:""}
      ${O?t.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);L&&M.code.add(t.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);M.code.add(t.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(E.stippleEnabled||I)&&M.code.add(t.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${I?t.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);M.code.add(t.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);E.roundJoins?M.code.add(t.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${E.stippleEnabled?t.glsl`min(1.0, subdivisionFactor * ${t.glsl.float(1.5)})`:t.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):M.code.add(t.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);M.code.add(t.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${E.capType!==v.CapType.BUTT?t.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);M.code.add(t.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${R||J?t.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${J?t.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${R?t.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);I&&M.code.add(t.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);E.stippleEnabled&&(E.draped?M.uniforms.add(new m.FloatPassUniform("worldToScreenRatio",(W,T)=>1/T.screenToPCSRatio)):M.code.add(t.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),M.code.add(t.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),E.draped?M.code.add(t.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):M.code.add(t.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),M.uniforms.add(new m.FloatPassUniform("stipplePatternPixelSize",W=>k.computePixelSize(W))),M.code.add(t.glsl`
      float patternLength = ${E.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));M.code.add(t.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${E.wireframe&&!E.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);G&&F.include(f.multipassTerrainTest,E);F.include(y.SliceDraw,E);K.include(h.ColorConversion);K.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${G?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);E.wireframe?K.code.add(t.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(I&&K.code.add(t.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${t.glsl.float(e.symbolAlphaCutoff)}) {
        discard;
      }
    `),N?K.code.add(t.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${t.glsl.float(e.symbolAlphaCutoff)}, stippleCoverage);
      `):K.code.add(t.glsl`float stippleAlpha = getStippleAlpha();`),K.uniforms.add(new l.Float4PassUniform("intrinsicColor",W=>W.color)),E.output!==c.ShaderOutput.ObjectAndLayerIdColor&&K.code.add(t.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),K.code.add(t.glsl`vec4 color = intrinsicColor * vColor;`),E.innerColorEnabled&&(K.uniforms.add(new l.Float4PassUniform("innerColor",W=>W.innerColor??W.color),new m.FloatPassUniform("innerWidth",(W,T)=>W.innerWidth*T.camera.pixelRatio)),
K.code.add(t.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),K.code.add(t.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),E.falloffEnabled&&(K.uniforms.add(new m.FloatPassUniform("falloff",W=>W.falloff)),K.code.add(t.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));K.code.add(t.glsl`
    ${E.output===c.ShaderOutput.ObjectAndLayerIdColor?t.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${t.glsl.float(e.symbolAlphaCutoff)}) {
      discard;
    }

    ${E.output===c.ShaderOutput.Alpha?t.glsl`fragColor = vec4(finalColor.a);`:""}
    ${E.output===c.ShaderOutput.Color?t.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${E.output===c.ShaderOutput.Color&&E.transparencyPassType===x.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${E.output===c.ShaderOutput.Highlight?t.glsl`fragColor = vec4(1.0);`:""}
    ${E.output===c.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""}
    ${E.output===c.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return F}const C=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:1,build:B},Symbol.toStringTag,{value:"Module"}));a.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=C;a.build=B})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q){a.RibbonVertexPosition=function(k,d){const f=k.vertex;f.uniforms.add(new y.FloatPassUniform("intrinsicWidth",g=>g.width));d.vvSize?(k.attributes.add(q.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),f.uniforms.add(new c.Float3PassUniform("vvSizeMinSize",g=>g.vvSize.minSize),new c.Float3PassUniform("vvSizeMaxSize",g=>g.vvSize.maxSize),new c.Float3PassUniform("vvSizeOffset",g=>g.vvSize.offset),new c.Float3PassUniform("vvSizeFactor",g=>g.vvSize.factor)),f.code.add(u.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(k.attributes.add(q.VertexAttribute.SIZE,"float"),f.code.add(u.glsl`float getSize(){
return intrinsicWidth * size;
}`));d.vvOpacity?(k.attributes.add(q.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),f.constants.add("vvOpacityNumber","int",8),f.uniforms.add(new p.FloatsPassUniform("vvOpacityValues",g=>g.vvOpacity.values,8),new p.FloatsPassUniform("vvOpacityOpacities",g=>g.vvOpacity.opacityValues,8)),f.code.add(u.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):f.code.add(u.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);d.vvColor?(k.include(b.VisualVariables,d),k.attributes.add(q.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),f.code.add(u.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(k.attributes.add(q.VertexAttribute.COLOR,"vec4"),f.code.add(u.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,y){a.OutputDepth=function(p,u){p.fragment.include(c.RgbaFloatEncoding);switch(u.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:p.fragment.code.add(y.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.Depth:p.fragment.code.add(y.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,c,y,p,u,q,k,d){function f(h,z){const n=
!(z.draped&&z.stipplePreferContinuous),{vertex:l,fragment:m}=h;m.include(b.RgbaFloatEncoding);z.draped||(c.addCameraPosition(l,z),l.uniforms.add(new p.FloatPassUniform("worldToScreenPerDistanceRatio",(t,w)=>1/w.camera.perScreenPixelRatio)),l.code.add(u.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));h.varyings.add("vStippleDistance","float");z.stippleRequiresClamp&&h.varyings.add("vStippleDistanceLimits","vec2");z.stippleRequiresStretchMeasure&&h.varyings.add("vStipplePatternStretch","float");l.code.add(u.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${e};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);l.code.add(u.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);l.code.add(u.glsl`
    if (segmentLengthPseudoScreen >= ${n?"patternLength":"1e4"}) {
  `);c.addPixelRatio(l,z);l.code.add(u.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${z.stippleRequiresStretchMeasure?u.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);m.constants.add("stippleTexturePadding","float",k.STIPPLE_TEXTURE_PADDING);m.uniforms.add(new q.Texture2DPassUniform("stipplePatternTexture",t=>t.stippleTexture),new p.FloatPassUniform("stipplePatternSDFNormalizer",t=>(t=t.stipplePattern)?(Math.floor(.5*(k.computeLongestPattern(t)-1))+.5)/t.pixelRatio:1),new p.FloatPassUniform("stipplePatternPixelSizeInv",t=>1/g(t)));m.code.add(u.glsl`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`);m.code.add(u.glsl`
    float getStippleSDF(out bool isClamped) {
      ${z.stippleRequiresClamp?u.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:u.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${z.stippleScaleWithLineWidth?u.glsl`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${z.stippleRequiresStretchMeasure?u.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:u.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${z.stippleScaleWithLineWidth?u.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:u.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);z.stippleOffColorEnabled?(m.uniforms.add(new y.Float4PassUniform("stippleOffColor",t=>d.ensureColor4(t.stippleOffColor))),m.code.add(u.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):m.code.add(u.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function g(h){const z=h.stipplePattern;return z?k.computeTextureSize(h.stipplePattern)/z.pixelRatio:1}const e=u.glsl.float(.4);a.LineStipple=function(h,z){h.constants.add("stippleAlphaColorDiscard","float",.001);h.constants.add("stippleAlphaHighlightDiscard","float",.5);z.stippleEnabled?f(h,z):h.fragment.code.add(u.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,c,y,p,u){function q(f){return f.pattern.map(g=>Math.round(g*f.pixelRatio))}function k(f){if(null==f)return 1;f=q(f);
return Math.floor(f.reduce((g,e)=>g+e))}function d(f){return q(f).reduce((g,e)=>Math.max(g,e))}a.STIPPLE_TEXTURE_PADDING=2;a.computeLongestPattern=d;a.computeTextureSize=k;a.createStippleTextureRepository=function(f,g){return new c.ProceduralTextureRepository(e=>{var h=q(e),z=1/e.pixelRatio,n=k(e);e=d(e);const l=(Math.floor(.5*(e-1))+.5)*z;e=[];let m=1;for(var t of h){for(let D=0;D<t;D++)e.push(m*(Math.min(D,t-1-D)+.5)*z/l*.5+.5);m=-m}h=Math.round(h[0]/2);h=[...e.slice(h),...e.slice(0,h)];n+=2;z=
new Uint8Array(4*n);t=4;for(var w of h)b.packFloatRGBA(w,z,t),t+=4;z.copyWithin(0,t-4,t);z.copyWithin(t,4,8);const {encodedData:r,paddedPixels:x}={encodedData:z,paddedPixels:n};w=new u.TextureDescriptor;w.internalFormat=y.PixelFormat.RGBA;w.width=x;w.height=1;w.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;return new p.Texture(f,w,r)},e=>`${e.pattern.join(",")}-r${e.pixelRatio}`,g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/uid"],function(a,b,c){let y=function(){function u(k,d,f){this._createTexture=k;this._parametersKey=d;this._repository=new Map;this._orphanCache=f.newCache(`procedural-texture-repository:${c.generateUID()}`,g=>g.dispose())}var q=u.prototype;q.destroy=function(){for(const [,{texture:k}]of this._repository)k.dispose();this._repository.clear();this._orphanCache.destroy()};q.swap=function(k,d=null){k=this._acquire(k);this.release(d);return k};
q.release=function(k){if(null!=k){k=this._parametersKey(k);var d=this._repository.get(k);d&&(d.refCount--,0===d.refCount&&(this._repository.delete(k),{texture:d}=d,this._orphanCache.put(k,d,d.gpuMemoryUsage)))}};q._acquire=function(k){if(null==k)return null;const d=this._parametersKey(k);var f=this._repository.get(d);if(f)return f.refCount++,f.texture;k=this._orphanCache.pop(d)??this._createTexture(k);f=new p(k);this._repository.set(d,f);return k};return b._createClass(u)}(),p=b._createClass(function(u){this.texture=
u;this.refCount=1});a.ProceduralTextureRepository=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c){const y=c.create();a.ensureColor4=function(p){return null==p?c.ZEROS:4===p.length?p:b.set(y,p[0],p[1],p[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u){a.MarkerSizing=function(q,k){const {vertex:d,constants:f}=q;f.add("markerSizePerLineWidth","float",b.MARKER_SIZE_PER_LINE_WIDTH);c.addPixelRatio(d,k);null==d.uniforms.get("markerScale")&&d.constants.add("markerScale","float",1);d.code.add(p.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);k.space===u.LineMarkerSpace.World&&(d.constants.add("maxSegmentLengthFraction","float",.45),d.uniforms.add(new y.FloatPassUniform("perRenderPixelRatio",(g,e)=>e.camera.perRenderPixelRatio)),d.code.add(p.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(a,b,c,y,p){a.MARKER_SIZE_PER_LINE_WIDTH=10;a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.MARKER_TIP_THICKNESS_FACTOR=.25;a.createMarkerTexture=function(u,q){u=b.createPrimitive(u,64,32,6.4);const k=new p.TextureDescriptor;
k.internalFormat=c.PixelFormat.RGBA;k.width=64;k.height=64;k.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;return new y.Texture(q,k,u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q){a.CapType=void 0;(function(k){k[k.BUTT=0]="BUTT";k[k.SQUARE=1]="SQUARE";k[k.ROUND=2]="ROUND";k[k.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));q=function(k){function d(){var f=k.apply(this,arguments)||this;f.output=y.ShaderOutput.Color;f.capType=a.CapType.BUTT;f.transparencyPassType=u.TransparencyPassType.NONE;f.occluder=!1;f.hasSlicePlane=!1;f.hasPolygonOffset=!1;f.writeDepth=!1;f.draped=!1;f.stippleEnabled=!1;f.stippleOffColorEnabled=!1;f.stippleScaleWithLineWidth=!1;f.stipplePreferContinuous=
!0;f.roundJoins=!1;f.applyMarkerOffset=!1;f.vvSize=!1;f.vvColor=!1;f.vvOpacity=!1;f.falloffEnabled=!1;f.innerColorEnabled=!1;f.hasOccludees=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;f.wireframe=!1;f.objectAndLayerIdColorInstanced=!1;return f}b._inherits(d,k);return b._createClass(d)}(q.DefaultTechniqueConfiguration);c.__decorate([p.parameter({count:y.ShaderOutput.COUNT})],q.prototype,"output",void 0);c.__decorate([p.parameter({count:a.CapType.COUNT})],q.prototype,"capType",void 0);c.__decorate([p.parameter({count:u.TransparencyPassType.COUNT})],
q.prototype,"transparencyPassType",void 0);c.__decorate([p.parameter()],q.prototype,"occluder",void 0);c.__decorate([p.parameter()],q.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],q.prototype,"hasPolygonOffset",void 0);c.__decorate([p.parameter()],q.prototype,"writeDepth",void 0);c.__decorate([p.parameter()],q.prototype,"draped",void 0);c.__decorate([p.parameter()],q.prototype,"stippleEnabled",void 0);c.__decorate([p.parameter()],q.prototype,"stippleOffColorEnabled",void 0);c.__decorate([p.parameter()],
q.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([p.parameter()],q.prototype,"stipplePreferContinuous",void 0);c.__decorate([p.parameter()],q.prototype,"roundJoins",void 0);c.__decorate([p.parameter()],q.prototype,"applyMarkerOffset",void 0);c.__decorate([p.parameter()],q.prototype,"vvSize",void 0);c.__decorate([p.parameter()],q.prototype,"vvColor",void 0);c.__decorate([p.parameter()],q.prototype,"vvOpacity",void 0);c.__decorate([p.parameter()],q.prototype,"falloffEnabled",void 0);c.__decorate([p.parameter()],
q.prototype,"innerColorEnabled",void 0);c.__decorate([p.parameter()],q.prototype,"hasOccludees",void 0);c.__decorate([p.parameter()],q.prototype,"hasMultipassTerrain",void 0);c.__decorate([p.parameter()],q.prototype,"cullAboveGround",void 0);c.__decorate([p.parameter()],q.prototype,"wireframe",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"stippleRequiresClamp",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"stippleRequiresStretchMeasure",void 0);c.__decorate([p.parameter({constValue:!0})],
q.prototype,"hasVvInstancing",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"hasSliceTranslatedView",void 0);c.__decorate([p.parameter()],q.prototype,"objectAndLayerIdColorInstanced",void 0);a.RibbonLineTechniqueConfiguration=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.SUBDIVISIONFACTOR,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.AUXPOS2,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);u=function(t){function w(){return t.apply(this,arguments)||
this}c._inherits(w,t);var r=w.prototype;r.initializeProgram=function(x){return new k.Program(x.rctx,w.shader.get().build(this.configuration),l)};r._makePipelineState=function(x,D){const A=this.configuration,v=x===g.TransparencyPassType.NONE,B=x===g.TransparencyPassType.FrontFace;return n.makePipelineState({blending:A.output===y.ShaderOutput.Color||A.output===y.ShaderOutput.Alpha?v?q.blendingDefault:q.oitBlending(x):null,depthTest:{func:q.oitDepthTest(x)},depthWrite:v?A.writeDepth?n.defaultDepthWriteParams:
null:q.oitDepthWrite(x),colorWrite:n.defaultColorWriteParams,stencilWrite:A.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:A.hasOccludees?D?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:v||B?A.hasPolygonOffset?m:null:q.OITPolygonOffset})};r.initializePipeline=function(){var x=this.configuration;x.occluder&&(x=x.hasPolygonOffset?m:null,this._occluderPipelineTransparent=n.makePipelineState({blending:q.blendingDefault,polygonOffset:x,depthTest:f.depthCompareAlways,depthWrite:null,
colorWrite:n.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=n.makePipelineState({blending:q.blendingDefault,polygonOffset:x,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:n.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=n.makePipelineState({blending:null,polygonOffset:x,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,
stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};r.getPipelineState=function(x,D){return D?this._occludeePipelineState:this.configuration.occluder?x===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:x===d.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:
c._get(c._getPrototypeOf(w.prototype),"getPipelineState",this).call(this,x,D)};c._createClass(w,[{key:"primitiveType",get:function(){return this.configuration.wireframe?z.PrimitiveType.LINES:z.PrimitiveType.TRIANGLE_STRIP}}]);return w}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(h.RibbonLine,()=>new Promise((t,w)=>a(["./RibbonLine.glsl"],t,w)));const m={factor:0,units:-4};b.RibbonLineTechnique=u;b.vertexAttributeLocations=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const y={func:c.CompareFunction.LESS},p={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},u={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},
operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},q={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=y;a.renderWhenBitIsNotSet=k=>({function:{func:c.CompareFunction.NOTEQUAL,ref:k,mask:k},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=k=>({function:{func:c.CompareFunction.ALWAYS,ref:k,mask:k},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});
a.stencilBaseAllZerosParams=p;a.stencilToolMaskBaseParams=u;a.stencilToolMaskOccluderParams=q;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,b,c,
y,p,u,q){let k=function(){function g(e,h,z,n=null){this.rctx=e;this.sliceHelper=n;this.lastFrameCamera=new u.Camera;this.output=y.ShaderOutput.Color;this.renderOccludedMask=f;this.bindParameters=new p.BindParameters(h,z,null!=n?n.plane:null);this.bindParameters.alignPixelEnabled=!0}g.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=f};return b._createClass(g)}(),d=function(g){function e(h,z,n,l,m){h=g.call(this,h,n,l,m)||this;h.offscreenRenderingHelper=z;h.sliceHelper=m;h.time=
c.Milliseconds(0);return h}b._inherits(e,g);return b._createClass(e)}(k);const f=q.RenderOccludedFlag.Occlude|q.RenderOccludedFlag.OccludeAndTransparent|q.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=k;a.RenderContext=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){function v(oa,ma){d.set(ja,oa[ma],oa[ma+3]);return ja}a.SnapshotSlot=void 0;(function(oa){oa[oa.Highlight=0]="Highlight";oa[oa.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let B=b._createClass(function(){this.camera=new l.CascadeCamera;this.lightMat=k.create()}),C=b._createClass(function(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=
0}),E=function(){function oa(fa,ba){this._rctx=fa;this._viewingMode=ba;this._enabled=!1;this._snapshots=[];this._textureSize=0;this._numCascades=1;this.settings=new C;this._projectionView=k.create();this._projectionViewInverse=k.create();this._modelViewLight=k.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=z.create();this._cascades=[new B,new B,new B,new B];this._lastOrigin=null;this._maxTextureSize=Math.min(c("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}
var ma=oa.prototype;ma.dispose=function(){this.enabled=!1;this.disposeOffscreenBuffers()};ma.disposeOffscreenBuffers=function(){this._fbo=p.disposeMaybe(this._fbo);this._discardAllSnapshots()};ma.getSnapshot=function(fa){return this.enabled?this._snapshots[fa]:null};ma.start=function(fa,ba,aa,da,ca){t.assert(this.enabled);this._textureSize=this._computeTextureSize(fa,ca,da);this._ensureDepthTexture();const {near:na,far:qa}=this._clampNearFar(aa);this._computeCascadeDistances(qa,na,da);this._setupMatrices(fa,
ba);const {viewMatrix:ua,projectionMatrix:sa}=fa;for(fa=0;fa<this._numCascades;++fa)this._constructCascade(fa,sa,ua,ba);this._lastOrigin=null;this.clear()};ma.finish=function(fa){t.assert(this.enabled);this._rctx.bindFramebuffer(fa)};ma.getShadowMapMatrices=function(fa){if(!this._lastOrigin||!g.exactEquals(fa,this._lastOrigin)){this._lastOrigin=this._lastOrigin||e.create();g.copy(this._lastOrigin,fa);for(let ba=0;ba<this._numCascades;++ba){q.translate(R,this._cascades[ba].lightMat,fa);for(let aa=
0;16>aa;++aa)W[16*ba+aa]=R[aa]}}return W};ma.takeCascadeSnapshotTo=function(fa,ba){t.assert(this.enabled);var aa=this._ensureSnapshot(ba);this._bindFbo();ba=this._rctx;aa=ba.bindTexture(aa,D.Texture.TEXTURE_UNIT_FOR_UPDATES);ba.gl.copyTexSubImage2D(w.TextureType.TEXTURE_2D,0,fa.camera.viewport[0],fa.camera.viewport[1],fa.camera.viewport[0],fa.camera.viewport[1],fa.camera.viewport[2],fa.camera.viewport[3]);ba.bindTexture(aa,D.Texture.TEXTURE_UNIT_FOR_UPDATES)};ma.clear=function(){const fa=this._rctx;
this._bindFbo();fa.setClearColor(1,1,1,1);fa.clearSafe(w.ClearBufferBit.COLOR_BUFFER_BIT|w.ClearBufferBit.DEPTH_BUFFER_BIT)};ma._computeTextureSize=function(fa,ba,aa){return Math.floor(Math.min(this._maxTextureSize,m.applyTextureResizeModulo(Math.min(window.devicePixelRatio,ba)/fa.pixelRatio*(1===this.numCascades?1:2)*Math.max(fa.fullWidth,fa.fullHeight)*(aa?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality))))};ma._ensureDepthTexture=function(){if(this._fbo?.width!==
this._textureSize){var fa=new A.TextureDescriptor(this._textureSize);fa.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE;fa.samplingMode=w.TextureSamplingMode.NEAREST;this._fbo?.dispose();this._fbo=new r.FramebufferObject(this._rctx,fa,new x.RenderbufferDescriptor(w.RenderbufferFormat.DEPTH_COMPONENT16,this._textureSize))}};ma._ensureSnapshot=function(fa){var ba=this._snapshots[fa];if(null!=ba&&ba.descriptor.width===this._textureSize)return ba;this._discardSnapshot(fa);ba=new A.TextureDescriptor;ba.wrapMode=
w.TextureWrapMode.CLAMP_TO_EDGE;ba.samplingMode=w.TextureSamplingMode.NEAREST;ba.width=this._textureSize;ba.height=this._textureSize;ba=new D.Texture(this._rctx,ba);return this._snapshots[fa]=ba};ma._discardSnapshot=function(fa){this._snapshots[fa]=p.disposeMaybe(this._snapshots[fa])};ma._discardAllSnapshots=function(){for(let fa=0;fa<this._snapshots.length;++fa)this._discardSnapshot(fa);this._snapshots.length=0};ma._bindFbo=function(){const fa=this._rctx;fa.unbindTexture(this.depthTexture);fa.bindFramebuffer(this._fbo)};
ma._constructCascade=function(fa,ba,aa,da){const ca=this._cascades[fa];var na=-this._cascadeDistances[fa],qa=-this._cascadeDistances[fa+1];na=(ba[10]*na+ba[14])/Math.abs(ba[11]*na+ba[15]);ba=(ba[10]*qa+ba[14])/Math.abs(ba[11]*qa+ba[15]);t.assert(na<ba);for(qa=0;8>qa;++qa){h.set(M,0===qa%4||3===qa%4?-1:1,0===qa%4||1===qa%4?-1:1,4>qa?na:ba,1);var ua=K[qa];h.transformMat4(ua,M,this._projectionViewInverse);ua[0]/=ua[3];ua[1]/=ua[3];ua[2]/=ua[3]}g.negate(J,K[0]);ca.camera.viewMatrix=q.translate(F,this._modelViewLight,
J);for(na=0;8>na;++na)g.transformMat4(K[na],K[na],ca.camera.viewMatrix);na=K[0][2];ba=K[0][2];for(qa=1;8>qa;++qa)na=Math.min(na,K[qa][2]),ba=Math.max(ba,K[qa][2]);na-=200;ba+=200;ca.camera.near=-ba;ca.camera.far=-na;qa=ca.camera;ua=1/K[0][3];var sa=1/K[4][3];t.assert(ua<sa);ua+=Math.sqrt(ua*sa);var pa=Math.sin(y.acosClamped(aa[2]*da[0]+aa[6]*da[1]+aa[10]*da[2]));aa=K;var ka=ua/pa;da=G;var ra=L,va=O;sa=I;ua=H;d.set(T,0,0);for(var Ca=0;4>Ca;++Ca)d.add(T,T,aa[Ca]);d.scale(T,T,.25);d.set(P,0,0);for(Ca=
4;8>Ca;++Ca)d.add(P,P,aa[Ca]);d.scale(P,P,.25);d.lerp(Q[0],aa[4],aa[5],.5);d.lerp(Q[1],aa[5],aa[6],.5);d.lerp(Q[2],aa[6],aa[7],.5);d.lerp(Q[3],aa[7],aa[4],.5);Ca=0;var Ba=d.squaredDistance(Q[0],T);for(var Ha=1;4>Ha;++Ha){var Ma=d.squaredDistance(Q[Ha],T);Ma<Ba&&(Ba=Ma,Ca=Ha)}d.subtract(S,Q[Ca],aa[Ca+4]);Ca=S[0];S[0]=-S[1];S[1]=Ca;d.subtract(U,P,T);0>d.dot(U,S)&&d.negate(S,S);d.lerp(S,S,U,pa);d.normalize(S,S);pa=Ca=d.dot(d.subtract(V,aa[0],T),S);for(Ba=1;8>Ba;++Ba)Ha=d.dot(d.subtract(V,aa[Ba],T),S),
Ha<pa?pa=Ha:Ha>Ca&&(Ca=Ha);d.copy(da,T);d.scale(V,S,pa-ka);d.add(da,da,V);Ha=-1;Ma=1;ka=Ba=0;for(let Qa=0;8>Qa;++Qa){d.subtract(X,aa[Qa],da);d.normalize(X,X);const Sa=S[0]*X[1]-S[1]*X[0];0<Sa?Sa>Ha&&(Ha=Sa,Ba=Qa):Sa<Ma&&(Ma=Sa,ka=Qa)}t.verify(0<Ha,"leftArea");t.verify(0>Ma,"rightArea");d.scale(Y,S,pa);d.add(Y,Y,T);d.scale(Z,S,Ca);d.add(Z,Z,T);ea[0]=-S[1];ea[1]=S[0];ra=t.rayRay2D(da,aa[ka],Z,d.add(V,Z,ea),1,ra);va=t.rayRay2D(da,aa[Ba],Z,V,1,va);sa=t.rayRay2D(da,aa[Ba],Y,d.add(V,Y,ea),1,sa);aa=t.rayRay2D(da,
aa[ka],Y,V,1,ua);t.verify(ra,"rayRay");t.verify(va,"rayRay");t.verify(sa,"rayRay");t.verify(aa,"rayRay");va=G;aa=L;da=I;sa=H;ua=qa.projectionMatrix;d.subtract(ha,da,sa);d.scale(ha,ha,.5);ia[0]=ha[0];ia[1]=ha[1];ia[2]=0;ia[3]=ha[1];ia[4]=-ha[0];ia[5]=0;ia[6]=ha[0]*ha[0]+ha[1]*ha[1];ia[7]=ha[0]*ha[1]-ha[1]*ha[0];ia[8]=1;ia[6]=-d.dot(v(ia,0),va);ia[7]=-d.dot(v(ia,1),va);va=d.dot(v(ia,0),da)+ia[6];ra=d.dot(v(ia,1),da)+ia[7];ka=d.dot(v(ia,0),sa)+ia[6];sa=d.dot(v(ia,1),sa)+ia[7];va=-(va+ka)/(ra+sa);ia[0]+=
ia[1]*va;ia[3]+=ia[4]*va;ia[6]+=ia[7]*va;va=1/(d.dot(v(ia,0),da)+ia[6]);ra=1/(d.dot(v(ia,1),da)+ia[7]);ia[0]*=va;ia[3]*=va;ia[6]*=va;ia[1]*=ra;ia[4]*=ra;ia[7]*=ra;ia[2]=ia[1];ia[5]=ia[4];ia[8]=ia[7];ia[7]+=1;va=d.dot(v(ia,1),aa)+ia[7];ra=d.dot(v(ia,2),aa)+ia[8];ka=d.dot(v(ia,1),da)+ia[7];sa=d.dot(v(ia,2),da)+ia[8];va=-.5*(va/ra+ka/sa);ia[1]+=ia[2]*va;ia[4]+=ia[5]*va;ia[7]+=ia[8]*va;va=d.dot(v(ia,1),aa)+ia[7];ra=d.dot(v(ia,2),aa)+ia[8];ka=-ra/va;ia[1]*=ka;ia[4]*=ka;ia[7]*=ka;ua[0]=ia[0];ua[1]=ia[1];
ua[2]=0;ua[3]=ia[2];ua[4]=ia[3];ua[5]=ia[4];ua[6]=0;ua[7]=ia[5];ua[8]=0;ua[9]=0;ua[10]=1;ua[11]=0;ua[12]=ia[6];ua[13]=ia[7];ua[14]=0;ua[15]=ia[8];qa.projectionMatrix[10]=2/(na-ba);qa.projectionMatrix[14]=-(na+ba)/(na-ba);q.multiply(ca.lightMat,ca.camera.projectionMatrix,ca.camera.viewMatrix);na=this._textureSize/(1===this.numCascades?1:2);ca.camera.viewport=[0===fa%2?0:na,0===Math.floor(fa/2)?0:na,na,na]};ma._setupMatrices=function(fa,ba){q.multiply(this._projectionView,fa.projectionMatrix,fa.viewMatrix);
q.invert(this._projectionViewInverse,this._projectionView);fa=this._viewingMode===n.ViewingMode.Global?fa.eye:g.set(J,0,0,1);q.lookAt(this._modelViewLight,[0,0,0],[-ba[0],-ba[1],-ba[2]],fa)};ma._clampNearFar=function(fa){let {near:ba,far:aa}=fa;2>ba&&(ba=2);2>aa&&(aa=2);ba>=aa&&(ba=2,aa=4);return{near:ba,far:aa}};ma._computeCascadeDistances=function(fa,ba,aa){aa=aa?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(t.logWithBase(fa/
ba,4)),aa);aa=(fa-ba)/this._numCascades;fa=(fa/ba)**(1/this._numCascades);let da=ba;for(let ca=0;ca<this._numCascades+1;++ca)this._cascadeDistances[ca]=y.lerp(da,ba,this.settings.splitSchemeLambda),da*=fa,ba+=aa};b._createClass(oa,[{key:"depthTexture",get:function(){return this._fbo?.colorTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return h.set(this._usedCascadeDistances,
this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this.settings.maxNumCascadesHighQuality},set:function(fa){this.settings.maxNumCascadesHighQuality=y.clamp(Math.floor(fa),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(fa){(this._enabled=fa)||this.disposeOffscreenBuffers()}},{key:"ready",get:function(){return this._enabled&&
null!=this.depthTexture}},{key:"cascades",get:function(){for(let fa=0;fa<this._numCascades;++fa)N[fa]=this._cascades[fa];N.length=this._numCascades;return N}},{key:"gpuMemoryUsage",get:function(){return this._snapshots.reduce((fa,ba)=>fa+(ba?.gpuMemoryUsage??0),this._fbo?.gpuMemoryUsage??0)}},{key:"test",get:function(){return{cascades:this._cascades,textureSize:this._textureSize}}}]);return oa}();const F=k.create(),M=z.create(),K=[];for(let oa=0;8>oa;++oa)K.push(z.create());const G=f.create(),L=f.create(),
O=f.create(),I=f.create(),H=f.create(),J=e.create(),N=[],R=k.create(),W=Array(64),T=f.create(),P=f.create(),Q=[f.create(),f.create(),f.create(),f.create()],S=f.create(),U=f.create(),V=f.create(),X=f.create(),Y=f.create(),Z=f.create(),ea=f.create(),ja=f.create(),ha=f.create(),ia=u.create();a.ShadowMap=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ./Camera".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.CascadeCamera=function(g){function e(){var h=g.apply(this,arguments)||this;h._projectionMatrix=d.create();return h}b._inherits(e,g);b._createClass(e,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]);return e}(f.Camera);c.__decorate([y.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);c.__decorate([y.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],
a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports"],function(a){a.applyTextureResizeModulo=function(b){return 16*Math.ceil(b/16)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../terrain/Intersector ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){function r(A,v,B,C,E,F,M){const K=new h.OverlayTarget(F,M,v);v=G=>{G.set(l.IntersectorType.OVERLAY,K,A.dist,A.normal,A.transformation,B,C)};(null==E.results.min.drapedLayerOrder||B>=E.results.min.drapedLayerOrder)&&(null==E.results.min.dist||E.results.ground.dist<=E.results.min.dist)&&v(E.results.min);E.options.store!==l.StoreResults.MIN&&(null==E.results.max.drapedLayerOrder||B<E.results.max.drapedLayerOrder)&&(null==E.results.max.dist||E.results.ground.dist>
E.results.max.dist)&&v(E.results.max);E.options.store===l.StoreResults.ALL&&(F=n.newIntersectorResult(E.ray),v(F),E.results.all.push(F))}a.SortedRenderGeometryRenderer=function(A){function v(C){C=A.call(this,C)||this;C._pending=new x;C._changes=new z.ChangeSet;C._materialRenderers=new Map;C._sortedMaterialRenderers=new u;C._geometries=new Map;C._hasHighlights=!1;C._hasWater=!1;return C}b._inherits(v,A);var B=v.prototype;B.destroy=function(){this._changes.prune();this._materialRenderers.forEach(C=>
C.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear();this._pending.clear()};B.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let C=!1,E=!1,F=!1;t.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((M,K)=>{let G=this._materialRenderers.get(K);!G&&0<M.adds.length&&(G=new w.MergedRenderer(this.rctx,this._materialRepository,K),this._materialRenderers.set(K,G),F=E=C=!0);if(G){var L=E||G.hasHighlights,O=F||
G.hasWater;G.modify(M);E=E||L!==G.hasHighlights;F=F||O!==G.hasWater;G.isEmpty&&(this._materialRenderers.delete(K),G.dispose(),C=!0)}});this._changes.clear();C&&this._updateSortedMaterialRenderers();E&&(this._hasHighlights=p.someMap(this._materialRenderers,M=>M.hasHighlights));F&&(this._hasWater=p.someMap(this._materialRenderers,M=>M.hasWater));this.notifyChange("updating");return!0};B.addGeometries=function(C,E){if(0!==C.length){var F=this._validateRenderGeometries(C);for(var M of F)this._geometries.set(M.id,
M);M=this._pending.empty;for(const K of F)this._pending.adds.add(K);M&&this.notifyChange("updating");E===m.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(C)}};B.removeGeometries=function(C,E){const F=this._pending.empty,M=this._pending.adds;for(const K of C)M.has(K)?(this._pending.removed.add(K),M.delete(K)):this._pending.removed.has(K)||this._pending.removes.add(K),this._geometries.delete(K.id);F&&!this._pending.empty&&this.notifyChange("updating");E===m.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(C)};
B.modifyGeometries=function(C,E){const F=0===this._changes.updates.length;for(const M of C){const K=this._changes.updates.pushNew();K.renderGeometry=this._validateRenderGeometry(M);K.updateType=E}F&&0<this._changes.updates.length&&this.notifyChange("updating");switch(E){case m.DirtyState.TRANSFORMATION:case m.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(C);case m.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(C)}};B.updateAnimation=function(C){let E=!1;this._sortedMaterialRenderers.forAll(F=>
E=F.updateAnimation(C)||E);return E};B.render=function(C){this._sortedMaterialRenderers.forAll(E=>{if(E.material.shouldRender(C)){const F=E.prepareTechnique(C);null!=F&&E.render(C,F)}})};B.intersect=function(C,E,F,M,K){this._geometries.forEach(G=>{if(!M||M(G)){this._intersectRenderGeometry(G,F,E,0,C,K);var L=this.rendererContext.longitudeCyclical;L&&(G.boundingSphere[0]-G.boundingSphere[3]<L.min&&this._intersectRenderGeometry(G,F,E,L.range,C,K),G.boundingSphere[0]+G.boundingSphere[3]>L.max&&this._intersectRenderGeometry(G,
F,E,-L.range,C,K));K++}});return K};B._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let C=0;this._materialRenderers.forEach((E,F)=>{F.insertOrder=C++;this._sortedMaterialRenderers.push(E)});this._sortedMaterialRenderers.sort((E,F)=>{const M=F.material.renderPriority-E.material.renderPriority;return 0!==M?M:E.material.insertOrder-F.material.insertOrder})};B._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));
this._changes.removes.pushArray(Array.from(this._pending.removes));for(let C=0;C<this._changes.updates.length;)this._pending.has(this._changes.updates.data[C].renderGeometry)?this._changes.updates.removeUnorderedIndex(C):C++;this._pending.clear()};B._intersectRenderGeometry=function(C,E,F,M,K,G){if(C.visible){var L=0;M+=C.transformation[12];L=C.transformation[13];D[0]=F[0]-M;D[1]=F[1]-L;C.screenToWorldRatio=this.rendererContext.screenToWorldRatio;C.material.intersectDraped(C,null,K,D,(O,I,H)=>{r(E,
H,C.material.renderPriority,G,K,C.layerUid,C.graphicUid)},E)}};B._notifyGraphicGeometryChanged=function(C){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const F of C)if(C=F.graphicUid,null!=C&&C!==E){this.drapeSource.notifyGraphicGeometryChanged(C);var E=C}};B._notifyGraphicVisibilityChanged=function(C){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const F of C)if(C=F.graphicUid,null!=C&&C!==E){this.drapeSource.notifyGraphicVisibilityChanged(C);var E=C}};B._validateRenderGeometries=
function(C){for(const E of C)this._validateRenderGeometry(E);return C};B._validateRenderGeometry=function(C){null==C.localOrigin&&(C.localOrigin=this._localOriginFactory.getOrigin(C.boundingSphere));return C};b._createClass(v,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},
{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return p.someMap(this._materialRenderers,C=>C.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return v}(y);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,
"drapeSource",void 0);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);c.__decorate([q.property({readOnly:!0})],
a.SortedRenderGeometryRenderer.prototype,"isEmpty",null);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRenderers",void 0);c.__decorate([q.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=c.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let x=function(){function A(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var v=A.prototype;
v.has=function(B){return this.adds.has(B)||this.removes.has(B)||this.removed.has(B)};v.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(A,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return A}();const D=e.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/IntersectorInterfaces",
"../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,c,y,p){y=function(u){function q(k,d,f){k=u.call(this,k,d)||this;k.triangleNr=f;return k}b._inherits(q,u);return b._createClass(q)}(y.Graphic3DTarget);a.OverlayTarget=y;a.isOverlayIntersectorResult=function(u){return p.isValidIntersectorResult(u)&&u.intersector===c.IntersectorType.OVERLAY&&!!u.target};a.isTerrainIntersectorResult=function(u){return p.isValidIntersectorResult(u)&&u.intersector===c.IntersectorType.TERRAIN&&
!!u.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray"],function(a,b,c){let y=function(){function q(){this.adds=new c;this.removes=new c;this.updates=new c({allocator:d=>d||new p,deallocator:d=>{d.renderGeometry=null;return d}})}var k=q.prototype;k.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};k.prune=
function(){this.adds.prune();this.removes.prune();this.updates.prune()};b._createClass(q,[{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]);return q}(),p=b._createClass(function(){}),u=b._createClass(function(){this.adds=[];this.removes=[];this.updates=[]});a.ChangeSet=y;a.MaterialChangeSet=u;a.RenderGeometryUpdate=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],
function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports",
"./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(c){const y=new Map,p=u=>{let q=y.get(u);q||(q=new b.MaterialChangeSet,y.set(u,q));return q};c.removes.forAll(u=>{1<=u.geometry.indexCount&&p(u.material).removes.push(u)});c.adds.forAll(u=>{1<=u.geometry.indexCount&&p(u.material).adds.push(u)});c.updates.forAll(u=>{1<=u.renderGeometry.geometry.indexCount&&p(u.renderGeometry.material).updates.push(u)});return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/Util ../DrawParameters ../WaterMaterial ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){function D(O,I){let H;if(!O.some(N=>{if(N.numElements<I)return!1;H=N;return!0}))return null;const J=H.from;H.from+=I;H.from>=H.to&&O.removeUnordered(H);return J}function A(O){L.length<O&&(L=new Float32Array(O));return L}function v(O){O*=4;return 1024>=O?1024:262144>O?262144:Math.max(Math.min(262144*Math.ceil(1.5*O/262144),16777216),O)}function B(){L=new Float32Array(2)}let C=function(){function O(H,J,N){this._rctx=H;this._materialRepository=J;this.material=
N;this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new g.GLMaterials(this.material,this._materialRepository);this._bufferWriter=N.createBufferWriter();this._vaoCache=new x.VaoCache(H,N.vertexAttributeLocations,d.glLayout(this._bufferWriter.vertexBufferLayout))}var I=O.prototype;I.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(H=>H.dispose());this._dataByOrigin.clear();this._vaoCache.dispose()};I.forEachGeometry=function(H){this._dataByOrigin.forEach(J=>
J.buffers.forEach(N=>N.instances.forEach(R=>H(R.geometry))))};I.modify=function(H){this._updateGeometries(H.updates);this._addAndRemoveGeometries(H.adds,H.removes);this._updateDrawCommands()};I._updateGeometries=function(H){const J=this._bufferWriter,N=J.vertexBufferLayout.stride/4;for(const W of H){H=W.renderGeometry;const T=this._dataByOrigin.get(H.localOrigin.id)?.findBuffer(H.id);if(null==T)break;const P=T.instances.get(H.id);if(W.updateType&(h.DirtyState.GEOMETRY|h.DirtyState.TRANSFORMATION)){var R=
J.elementCount(P.geometry.geometry)*N;R=A(R);const Q=J.vertexBufferLayout.createView(R.buffer);this._writeGeometry(H,Q,0);T.vao.vertexBuffers.geometry.setSubData(R,P.from*N,0,P.numElements*N);B()}W.updateType&(h.DirtyState.HIGHLIGHT|h.DirtyState.OCCLUDEE|h.DirtyState.VISIBILITY)&&(T.drawCommandsDirty=!0)}};I._computeDeltas=function(H,J){const N=new p.NestedMap;for(var R of H){H=R.localOrigin;if(null==H)continue;let W=N.get(H.id,null);null==W&&(W=new E(H.vec3),N.set(H.id,null,W));W.changes.push(R)}for(const W of J)J=
W.localOrigin,null!=J&&(R=this._dataByOrigin.get(J.id)?.findBuffer(W.id),null!=R&&(H=N.get(J.id,R),null==H&&(H=new E(J.vec3),N.set(J.id,R,H)),H.changes.push(W)));return N};I._addAndRemoveGeometries=function(H,J){const {_bufferWriter:N,_dataByOrigin:R}=this,W=N.vertexBufferLayout.stride/4,T=this._computeDeltas(H,J);T.forEach((P,Q)=>{const S=P.get(null),U=null!=S?S.changes:[];T.delete(Q,null);let V=R.get(Q);P.forEach((X,Y)=>{T.delete(Q,Y);if(null==Y)z.assert(!1,"No VAO for removed geometries");else if(Y.instances.size===
X.changes.length)this._vaoCache.deleteVao(Y.vao),c.removeUnordered(V.buffers,Y),0===V.buffers.length&&0===U.length&&R.delete(Q);else{var Z=Y.numElements,ea=Y.vao.byteSize/4,ja=U.reduce((ia,oa)=>ia+N.elementCount(oa.geometry),0),ha=X.changes.reduce((ia,oa)=>ia+N.elementCount(oa.geometry),0);Z=Math.min((Z+ja-ha)*W,4194304);ja=Z>ea;65536<Z&&Z<ea/2?(X.changes.forEach(({id:ia})=>Y.deleteInstance(ia)),Y.instances.forEach(({geometry:ia})=>U.push(ia)),this._vaoCache.deleteVao(Y.vao),c.removeUnordered(V.buffers,
Y)):ja?this._applyAndRebuild(Y,U,X):this._applyRemoves(Y,X)}});if(0<U.length)for(null==V&&(V=new r.PerOriginData(S.origin),R.set(Q,V)),V.buffers.forEach(X=>this._applyAdds(X,U));0<U.length;)V.buffers.push(this._applyAndRebuild(new w.PerBufferData,U,null))})};I._updateDrawCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(H=>{H.buffers.forEach(J=>{J.drawCommandsDirty&&(J.hasHiddenInstances=!1,J.hasHighlights=!1,J.hasOccludees=!1,y.someMap(J.instances,N=>{J.updateDrawState(N);
return J.hasHiddenInstances&&J.hasHighlights&&J.hasOccludees}),J.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));this._hasHighlights=this._hasHighlights||J.hasHighlights;this._hasOccludees=this._hasOccludees||J.hasOccludees})})};I._applyAndRebuild=function(H,J,N){if(null!=N)for(var R of N.changes)H.deleteInstance(R.id);const W=this._bufferWriter;N=W.vertexBufferLayout.stride;R=N/4;var T=Math.floor(4194304/R);let P=H.numElements;for(;0<J.length;){const V=J.pop();var Q=W.elementCount(V.geometry);
if(P+Q>T&&0<P){J.push(V);break}P+=Q;Q=new t.Instance(V,0,0);z.assert(null==H.instances.get(V.id));H.addInstance(V.id,Q)}J=P*R;T=A(J);const S=W.vertexBufferLayout.createView(T.buffer);let U=0;H.hasHiddenInstances=!1;H.hasHighlights=!1;H.hasOccludees=!1;H.instances.forEach((V,X)=>{this._writeGeometry(V.geometry,S,U);const Y=U;U+=W.elementCount(V.geometry.geometry);H.updateInstance(X,Y,U);H.updateDrawState(V)});this._vaoCache.deleteVao(H.vao);H.vao=this._vaoCache.newVao(v(J));H.vao.vertexBuffers.geometry.setSubData(T,
0,0,U*R);B();H.holes.clear();J=H.holes.pushNew();J.from=U;J.to=Math.floor(H.vao.byteSize/N);H.updateDrawCommands(N);return H};I._applyRemoves=function(H,J){if(0!==J.changes.length){for(var N of J.changes){var R=N.id;if(J=H.instances.get(R)){H.deleteInstance(R);if(R=G.back()){if(R.to===J.from){R.to=J.to;continue}if(R.from===J.to){R.from=J.from;continue}}R=G.pushNew();R.from=J.from;R.to=J.to}}m.mergeAdjacentRanges(G);var W=this._bufferWriter.vertexBufferLayout.stride/4;N=G.reduce((Q,S)=>Math.max(Q,
S.numElements),0)*W;var T=A(N);T.fill(0,0,N);var P=H.vao.vertexBuffers.geometry;G.forAll(Q=>P.setSubData(T,Q.from*W,0,Q.numElements*W));B();H.holes.pushArray(G.data,G.length);G.forAll((Q,S)=>G.data[S]=null);G.clear();H.drawCommandsDirty=!0}};I._applyAdds=function(H,J){if(0!==J.length)if(w.hasVao(H)){var N=this._bufferWriter,R=N.vertexBufferLayout.stride/4,W=H.numElements,T=J.reduce((ea,ja)=>ea+N.elementCount(ja.geometry),0);W=Math.min((W+T)*R,4194304);T=4*W;if(H.vao.byteSize<v(4128768)&&T>H.vao.byteSize)this._applyAndRebuild(H,
J,null);else{m.mergeAdjacentRanges(H.holes);var P=[];for(var Q of J)T=N.elementCount(Q.geometry),T=D(H.holes,T),P.push(T);var S=H.vao.vertexBuffers.geometry,U=0,V=0,X=0,Y=A(W),Z=N.vertexBufferLayout.createView(Y.buffer);J.forEach((ea,ja)=>{ja=P[ja];if(null!=ja){if(X!==ja){var ha=X-V;0<ha&&S.setSubData(Y,V*R,0,ha*R);V=ja;U=0}ha=N.elementCount(ea.geometry);this._writeGeometry(ea,Z,U);U+=ha;X=ja+ha;ja=new t.Instance(ea,ja,ja+ha);z.assert(null==H.instances.get(ea.id));H.addInstance(ea.id,ja);H.drawCommandsDirty=
!0}});Q=X-V;0<Q&&S.setSubData(Y,V*R,0,Q*R);c.filterInPlace(J,(ea,ja)=>null==P[ja]);B()}}else this._applyAndRebuild(H,J,null)};I._writeGeometry=function(H,J,N){var R=H.localOrigin.vec3;z.setMatrixTranslation3(F,-R[0],-R[1],-R[2]);R=q.multiply(M,F,H.transformation);q.invert(K,R);q.transpose(K,K);this._bufferWriter.write(R,K,H.geometry,J,N)};I.updateAnimation=function(H){return this.material.update(H)};I.requiresSlot=function(H,J){return this.material.requiresSlot(H,J)};I.prepareTechnique=function(H){const {output:J,
bindParameters:N}=H;if(!this.requiresSlot(N.slot,J))return null;const R=J===f.ShaderOutput.Highlight||J===f.ShaderOutput.ShadowHighlight;if(R&&!this._hasHighlights)return null;const W=J===f.ShaderOutput.ShadowExcludeHighlight,T=!(R||W);for(const Q of this._dataByOrigin.values())for(const S of Q.buffers){if(R&&!S.hasHighlights)continue;var P=(R?S.drawCommandsHighlight:W&&S.needsMultipleCommands()?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null;const U=T&&S.drawCommandsOccludees||null;
if(P?.length||U?.length)if(P=this._glMaterials.load(H.rctx,N.slot,J),P=null!=P?P.beginSlot(N):null,null!=P)return P}return null};I.render=function(H,J){const {output:N,bindParameters:R}=H;H=N===f.ShaderOutput.Highlight||N===f.ShaderOutput.ShadowHighlight;const W=N===f.ShaderOutput.ShadowExcludeHighlight,T=!(H||W),P=this._rctx;P.appleAmdDriverHelper?.resetIndicesType();P.bindTechnique(J,this.material.parameters,R);for(const Q of this._dataByOrigin.values())for(const S of Q.buffers){if(H&&!S.hasHighlights)continue;
const U=(H?S.drawCommandsHighlight:W&&S.needsMultipleCommands()?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null,V=T&&S.drawCommandsOccludees||null;if(U?.length||V?.length)J.program.bindDraw(new n.DrawParameters(Q.origin),R,this.material.parameters),J.ensureAttributeLocations(S.vao),P.bindVAO(S.vao),U?.length&&(J.bindPipelineState(P,R.slot,!1),U.forAll(X=>P.drawArrays(J.primitiveType,X.first,X.count))),V?.length&&(J.bindPipelineState(P,R.slot,!0),V.forAll(X=>P.drawArrays(J.primitiveType,
X.first,X.count)))}};b._createClass(O,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this.material instanceof l.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this.material.renderOccluded!==e.RenderOccludedFlag.Occlude}},{key:"numGeometries",get:function(){let H=0;this._dataByOrigin.forEach(J=>
H+=J.buffers.reduce((N,R)=>N+=R.instances.size,0));return H}},{key:"test",get:function(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return O}(),E=b._createClass(function(O){this.origin=O;this.changes=[]});const F=k.create(),M=k.create(),K=k.create(),G=new u({allocator:O=>O||new m.BufferRange,deallocator:null});let L=new Float32Array(65536);a.MergedRenderer=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b,c){let y=function(){function p(q,k){this._material=q;this._repository=k;this._map=new Map}var u=p.prototype;u.destroy=function(){this._map.forEach((q,k)=>{null!=q&&this._repository.release(this._material,k)})};u.load=function(q,k,d){if(!this._material.requiresSlot(k,d))return null;this._map.has(d)||this._map.set(d,this._repository.acquire(this._material,k,d));k=this._map.get(d);if(null!=k){if(k.ensureResources(q)===c.ResourceState.LOADED)return k;
this._repository.requestRender()}return null};return b._createClass(p)}();a.GLMaterials=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,y){y=function(p){function u(q=c.create()){var k=p.call(this)||this;k.origin=q;k.slicePlaneLocalOrigin=k.origin;return k}
b._inherits(u,p);return b._createClass(u)}(y.VertexNormalDrawParameters);a.DrawParameters=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/compilerUtils ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f){let g=function(h){function z(){var n=h.apply(this,arguments)||this;n.transformNormalViewFromGlobal=y.create();return n}b._inherits(z,h);return b._createClass(z)}(q.VertexPositionPassParameters),e=function(h){function z(){var n=h.apply(this,arguments)||this;n.transformNormalGlobalFromModel=y.create();n.toMapSpace=p.create();return n}b._inherits(z,h);return b._createClass(z)}(q.VertexPositionDrawParameters);a.VertexNormal=function(h,z){switch(z.normalType){case u.NormalType.Attribute:case u.NormalType.Compressed:h.include(u.NormalAttribute,
z);h.varyings.add("vNormalWorld","vec3");h.varyings.add("vNormalView","vec3");h.vertex.uniforms.add(new d.Matrix3DrawUniform("transformNormalGlobalFromModel",n=>n.transformNormalGlobalFromModel),new f.Matrix3PassUniform("transformNormalViewFromGlobal",n=>n.transformNormalViewFromGlobal));h.vertex.code.add(k.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case u.NormalType.Ground:h.include(q.VertexPosition,z);h.varyings.add("vNormalWorld","vec3");h.vertex.code.add(k.glsl`
        void forwardNormal() {
          vNormalWorld = ${z.spherical?k.glsl`normalize(vPositionWorldCameraRelative);`:k.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case u.NormalType.ScreenDerivative:h.vertex.code.add(k.glsl`void forwardNormal() {}`);break;default:c.neverReached(z.normalType);case u.NormalType.COUNT:}};a.VertexNormalDrawParameters=e;a.VertexNormalPassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],
function(a,b,c,y){a.NormalType=void 0;(function(p){p[p.Attribute=0]="Attribute";p[p.Compressed=1]="Compressed";p[p.Ground=2]="Ground";p[p.ScreenDerivative=3]="ScreenDerivative";p[p.COUNT=4]="COUNT"})(a.NormalType||(a.NormalType={}));a.NormalAttribute=function(p,u){switch(u.normalType){case a.NormalType.Compressed:p.attributes.add(y.VertexAttribute.NORMALCOMPRESSED,"vec2");p.vertex.code.add(c.glsl`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case a.NormalType.Attribute:p.attributes.add(y.VertexAttribute.NORMAL,"vec3");p.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalType.ScreenDerivative:p.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(u.normalType);case a.NormalType.COUNT:case a.NormalType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){n=function(w){function r(D){D=w.call(this,D,new t)||this;D._configuration=new m.WaterTechniqueConfiguration;D.animation=new d.AnimationTimer;return D}b._inherits(r,w);var x=r.prototype;x.getConfiguration=function(D,A){this._configuration.output=D;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<g.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=A.multipassTerrain.enabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;
return this._configuration};x.update=function(D){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(D.camera.relativeElevation,D.camera.distance);D=this.animation.advance(D);this.setParameters({timeElapsed:y.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&D};x.requiresSlot=function(D,A){switch(A){case k.ShaderOutput.Normal:return D===e.RenderSlot.DRAPED_WATER;case k.ShaderOutput.Color:if(this.parameters.isDraped)return D===
e.RenderSlot.DRAPED_MATERIAL;break;case k.ShaderOutput.Alpha:break;case k.ShaderOutput.Highlight:case k.ShaderOutput.ObjectAndLayerIdColor:return D===e.RenderSlot.OPAQUE_MATERIAL||D===e.RenderSlot.DRAPED_MATERIAL;default:return!1}A=e.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(A=this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return D===A};x.createGLMaterial=function(D){return new l.WaterGLMaterial(D)};x.createBufferWriter=
function(){return new h.DefaultBufferWriter(c("enable-feature:objectAndLayerId-rendering")?z.PositionUVLayoutObjectAndLayerId:z.PositionUVLayout)};return b._createClass(r)}(n.TriangleMaterial);let t=function(w){function r(){var x=w.apply(this,arguments)||this;x.waveStrength=.06;x.waveTextureRepeat=32;x.waveDirection=p.fromValues(1,0);x.waveVelocity=.05;x.flowStrength=.015;x.flowOffset=-.5;x.animationSpeed=.35;x.timeElapsed=0;x.color=q.fromValues(0,0,0,0);x.transparent=!0;x.writeDepth=!0;x.hasSlicePlane=
!1;x.isDraped=!1;x.receiveShadows=!0;x.hasScreenSpaceReflections=!1;x.hasCloudsReflections=!1;x.origin=u.create();x.modelTransformation=null;return x}b._inherits(r,w);return b._createClass(r)}(f.MaterialParameters);a.WaterMaterial=n;a.WaterMaterialParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/VertexAttribute","./internal/bufferWriterUtils"],
function(a,b,c,y){let p=function(){function u(k){this.vertexBufferLayout=k}var q=u.prototype;q.elementCount=function(k){return k.indices.get(c.VertexAttribute.POSITION).length};q.write=function(k,d,f,g,e){y.writeDefaultAttributes(f,this.vertexBufferLayout,k,d,g,e)};return b._createClass(u)}();a.DefaultBufferWriter=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout",
"../lib/VertexAttribute"],function(a,b,c){const y=b.newLayout().vec3f(c.VertexAttribute.POSITION),p=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0),u=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR),q=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR),k=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR).vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);
a.PositionColorLayout=u;a.PositionColorLayoutObjectAndLayerId=b;a.PositionLayout=y;a.PositionLayoutObjectAndLayerId=q;a.PositionUVLayout=p;a.PositionUVLayoutObjectAndLayerId=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/Material","./internal/MaterialUtil"],function(a,b,c,y){c=function(p){function u(){return p.apply(this,arguments)||this}b._inherits(u,
p);u.prototype.intersect=function(q,k,d,f,g,e){return y.intersectTriangleGeometry(q,d,f,g,void 0,e)};return b._createClass(u)}(c.Material);a.TriangleMaterial=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","./WaterTechnique"],function(a,b,c,y,p){y=function(u){function q(){return u.apply(this,arguments)||
this}b._inherits(q,u);var k=q.prototype;k._updateShadowState=function(d){d.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:d.shadowMap.enabled})};k._updateSSRState=function(d){d.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:d.ssr.enabled})};k._updateCloudsReflectionState=function(d){d=null!=d.cloudsFade.data;d!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:d})};
k.ensureResources=function(d){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(d)};k.beginSlot=function(d){this._output===c.ShaderOutput.Color&&(this._updateShadowState(d),this._updateSSRState(d),this._updateCloudsReflectionState(d));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(p.WaterTechnique,d)};return b._createClass(q)}(y);a.WaterGLMaterial=y;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){k=function(w){function r(){return w.apply(this,arguments)||this}c._inherits(r,w);return c._createClass(r)}(k.WaterDistortionPassParameters);f=function(w){function r(){return w.apply(this,arguments)||this}c._inherits(r,w);var x=r.prototype;x.initializeConfiguration=function(D,A){A.spherical=D.viewingMode===p.ViewingMode.Global;A.doublePrecisionRequiresObfuscation=D.rctx.driverTest.doublePrecisionRequiresObfuscation.result};x.initializeProgram=function(D){return new z.Program(D.rctx,
r.shader.get().build(this.configuration),e.Default3D)};x._setPipelineState=function(D){const A=this.configuration,v=D===n.TransparencyPassType.NONE,B=D===n.TransparencyPassType.FrontFace;return t.makePipelineState({blending:A.output!==u.ShaderOutput.Normal&&A.output!==u.ShaderOutput.Highlight&&A.output!==u.ShaderOutput.ObjectAndLayerIdColor&&A.transparent?v?h.blendingDefault:h.oitBlending(D):null,depthTest:{func:h.oitDepthTest(D)},depthWrite:v?A.writeDepth?t.defaultDepthWriteParams:null:h.oitDepthWrite(D),
colorWrite:t.defaultColorWriteParams,polygonOffset:v||B?null:h.getOITPolygonOffset(A.enableOffset)})};x.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return c._createClass(r)}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(m.WaterSurface,()=>new Promise((w,r)=>a(["../shaders/WaterSurface.glsl"],w,r)));d=function(w){function r(){var x=w.apply(this,arguments)||this;x.output=u.ShaderOutput.Color;x.transparencyPassType=n.TransparencyPassType.NONE;
x.spherical=!1;x.receiveShadows=!1;x.hasSlicePlane=!1;x.transparent=!1;x.enableOffset=!0;x.writeDepth=!1;x.hasScreenSpaceReflections=!1;x.doublePrecisionRequiresObfuscation=!1;x.hasCloudsReflections=!1;x.objectAndLayerIdColorInstanced=!1;x.isDraped=!1;x.hasMultipassTerrain=!1;x.cullAboveGround=!1;return x}c._inherits(r,w);return c._createClass(r)}(l.DefaultTechniqueConfiguration);y.__decorate([g.parameter({count:u.ShaderOutput.COUNT})],d.prototype,"output",void 0);y.__decorate([g.parameter({count:n.TransparencyPassType.COUNT})],
d.prototype,"transparencyPassType",void 0);y.__decorate([g.parameter()],d.prototype,"spherical",void 0);y.__decorate([g.parameter()],d.prototype,"receiveShadows",void 0);y.__decorate([g.parameter()],d.prototype,"hasSlicePlane",void 0);y.__decorate([g.parameter()],d.prototype,"transparent",void 0);y.__decorate([g.parameter()],d.prototype,"enableOffset",void 0);y.__decorate([g.parameter()],d.prototype,"writeDepth",void 0);y.__decorate([g.parameter()],d.prototype,"hasScreenSpaceReflections",void 0);
y.__decorate([g.parameter()],d.prototype,"doublePrecisionRequiresObfuscation",void 0);y.__decorate([g.parameter()],d.prototype,"hasCloudsReflections",void 0);y.__decorate([g.parameter()],d.prototype,"objectAndLayerIdColorInstanced",void 0);y.__decorate([g.parameter()],d.prototype,"isDraped",void 0);y.__decorate([g.parameter()],d.prototype,"hasMultipassTerrain",void 0);y.__decorate([g.parameter()],d.prototype,"cullAboveGround",void 0);y.__decorate([g.parameter({constValue:q.PBRMode.Water})],d.prototype,
"pbrMode",void 0);y.__decorate([g.parameter({constValue:!0})],d.prototype,"useCustomDTRExponentForWater",void 0);y.__decorate([g.parameter({constValue:!0})],d.prototype,"highStepCount",void 0);y.__decorate([g.parameter({constValue:!1})],d.prototype,"useFillLights",void 0);b.WaterMaterialPassParameters=k;b.WaterTechnique=f;b.WaterTechniqueConfiguration=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ./ReadShadowMap.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){k=function(n){function l(){return n.apply(this,arguments)||this}b._inherits(l,n);return b._createClass(l)}(k.ReadShadowMapPassParameters);const h=u.create(),z=y.create();a.WaterDistortion=function(n){n.fragment.uniforms.add(new e.Texture2DPassUniform("texWaveNormal",l=>l.waveNormal),new e.Texture2DPassUniform("texWavePerturbation",l=>l.wavePertubation),new f.Float4PassUniform("waveParams",l=>p.set(h,l.waveStrength,l.waveTextureRepeat,l.flowStrength,l.flowOffset)),
new d.Float2PassUniform("waveDirection",l=>c.set(z,l.waveDirection[0]*l.waveVelocity,l.waveDirection[1]*l.waveVelocity)));n.include(q.FoamIntensity);n.fragment.code.add(g.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(l){l=l.fragment;l.include(p.RgbaFloatEncoding);l.uniforms.add(new g.Texture2DPassUniform("shadowMapTex",(m,t)=>t.shadowMap.depthTexture),new q.IntegerPassUniform("numCascades",(m,t)=>t.shadowMap.numCascades),new u.Float4PassUniform("cascadeDistances",(m,t)=>t.shadowMap.cascadeDistances));l.code.add(k.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}let h=function(l){function m(){return l.apply(this,arguments)||this}b._inherits(m,l);return b._createClass(m)}(function(l){function m(){var t=l.apply(this,arguments)||this;t.origin=y.create();return t}b._inherits(m,l);return b._createClass(m)}(k.NoParameters)),z=function(l){function m(){var t=l.apply(this,arguments)||this;t.modelTransformation=c.IDENTITY;return t}b._inherits(m,l);return b._createClass(m)}(k.NoParameters),n=function(l){function m(){var t=l.apply(this,arguments)||this;t.origin=
y.create();return t}b._inherits(m,l);return b._createClass(m)}(z);a.ReadShadowMapDraw=function(l,m){m.receiveShadows&&(l.fragment.uniforms.add(new d.Matrix4sDrawUniform("shadowMapMatrix",(t,w)=>w.shadowMap.getShadowMapMatrices(t.origin),4)),e(l))};a.ReadShadowMapDrawParameters=h;a.ReadShadowMapParameters=z;a.ReadShadowMapPass=function(l,m){m.receiveShadows&&(l.fragment.uniforms.add(new f.Matrix4sPassUniform("shadowMapMatrix",(t,w)=>w.shadowMap.getShadowMapMatrices(t.origin),4)),e(l))};a.ReadShadowMapPassParameters=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"int",y.BindType.Pass,(d,f,g)=>d.setUniform1i(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.IntegerPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k,d){return p.call(this,q,"mat4",y.BindType.Draw,(f,g,e,h)=>f.setUniformMatrix4fv(q,k(g,e,h)),d)||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Matrix4sDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k,d){return p.call(this,q,"mat4",y.BindType.Pass,(f,g,e)=>f.setUniformMatrix4fv(q,k(g,e)),d)||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Matrix4sPassUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){function B(E){const F=new D.ShaderBuilder,{vertex:M,fragment:K}=F;t.addProjViewLocalOrigin(M,E);F.include(p.Transform,E);F.attributes.add(v.VertexAttribute.POSITION,"vec3");F.attributes.add(v.VertexAttribute.UV0,"vec2");const G=new w.Float4PassUniform("waterColor",L=>L.color);if(E.output===c.ShaderOutput.Color&&E.isDraped)return F.varyings.add("vpos","vec3"),M.uniforms.add(G),M.code.add(x.glsl`
        void main(void) {
          if (waterColor.a < ${x.glsl.float(l.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),K.uniforms.add(G),K.code.add(x.glsl`void main() {
fragColor = waterColor;
}`),F;if(E.output===c.ShaderOutput.Color||E.output===c.ShaderOutput.Alpha)F.include(g.NormalUtils,E),F.include(b.ForwardLinearDepth,E),F.varyings.add("vuv","vec2"),F.varyings.add("vpos","vec3"),F.varyings.add("vnormal","vec3"),F.varyings.add("vtbnMatrix","mat3"),E.hasMultipassTerrain&&F.varyings.add("depth","float"),M.uniforms.add(G),M.code.add(x.glsl`
      void main(void) {
        if (waterColor.a < ${x.glsl.float(l.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${E.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${E.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);F.include(f.multipassTerrainTest,E);switch(E.output){case c.ShaderOutput.Alpha:F.include(y.SliceDraw,E);K.uniforms.add(G);K.code.add(x.glsl`
        void main() {
          discardBySlice(vpos);
          ${E.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case c.ShaderOutput.Color:F.include(d.MainLighting);F.include(k.EvaluateAmbientLighting,{pbrMode:e.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});F.include(n.WaterDistortion);F.include(y.SliceDraw,E);F.include(h.ReadShadowMapDraw,E);F.include(z.Water,E);K.uniforms.add(G,new r.FloatPassUniform("timeElapsed",L=>L.timeElapsed),M.uniforms.get("view"),M.uniforms.get("localOrigin"));t.addCameraPosition(K,E);K.include(m.ColorConversion);d.addMainLightDirection(K);d.addMainLightIntensity(K);
K.code.add(x.glsl`
      void main() {
        discardBySlice(vpos);
        ${E.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${E.receiveShadows?x.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${E.transparencyPassType===A.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case c.ShaderOutput.Normal:F.include(g.NormalUtils,E);F.include(n.WaterDistortion,E);F.include(y.SliceDraw,E);F.varyings.add("vpos","vec3");F.varyings.add("vuv","vec2");M.uniforms.add(G);M.code.add(x.glsl`
        void main(void) {
          if (waterColor.a < ${x.glsl.float(l.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);K.uniforms.add(new r.FloatPassUniform("timeElapsed",L=>L.timeElapsed));K.code.add(x.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case c.ShaderOutput.Highlight:F.include(q.OutputHighlight,E);F.varyings.add("vpos","vec3");M.uniforms.add(G);M.code.add(x.glsl`
      void main(void) {
        if (waterColor.a < ${x.glsl.float(l.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `);F.include(y.SliceDraw,E);K.code.add(x.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case c.ShaderOutput.ObjectAndLayerIdColor:F.include(u.ObjectAndLayerIdColor,E),F.varyings.add("vpos","vec3"),M.uniforms.add(G),M.code.add(x.glsl`
      void main(void) {
        if (waterColor.a < ${x.glsl.float(l.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),F.include(y.SliceDraw,E),K.code.add(x.glsl`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return F}const C=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=C;a.build=B})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(c,y){y.spherical?c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);y.spherical?c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,y,p,u,q,k,d,f){a.Water=function(g,
e){g.include(y.PhysicallyBasedRenderingWater,e);g.include(c.Gamma);g.include(b.FoamColor);e.hasCloudsReflections&&g.include(u.CloudsParallaxShading,e);e.hasScreenSpaceReflections&&g.include(p.ScreenSpaceReflections,e);g=g.fragment;g.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion",
"float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);g.code.add(k.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);g.uniforms.add(new q.FloatPassUniform("lightingSpecularStrength",(h,z)=>z.lighting.mainLight.specularStrength),new q.FloatPassUniform("lightingEnvironmentStrength",(h,z)=>z.lighting.mainLight.environmentStrength));g.code.add(k.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);e.hasCloudsReflections&&g.code.add(k.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);e.hasScreenSpaceReflections?(g.uniforms.add(new d.Matrix4PassUniform("view",(h,z)=>z.ssr.camera.viewMatrix),new f.Texture2DPassUniform("lastFrameColorTexture",(h,z)=>z.ssr.lastFrameColorTexture),new q.FloatPassUniform("fadeFactorSSR",(h,z)=>z.ssr.fadeFactor)),g.code.add(k.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):g.code.add(k.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);e.hasCloudsReflections?e.hasScreenSpaceReflections?g.code.add(k.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):g.code.add(k.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):g.code.add(k.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,y,p){a.PhysicallyBasedRendering=function(u,q){const k=u.fragment.code;u.include(y.PiUtils);if(q.pbrMode===c.PBRMode.Normal||q.pbrMode===c.PBRMode.Schematic||q.pbrMode===c.PBRMode.Terrain||
q.pbrMode===c.PBRMode.TerrainWithWater)k.add(p.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),k.add(p.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(q.pbrMode===c.PBRMode.Normal||q.pbrMode===c.PBRMode.Schematic)u.include(b.AnalyticalSkyModel),k.add(p.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),k.add(p.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),k.add(p.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),k.add(p.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(u,q){const k=u.fragment.code;u.include(y.PiUtils);k.add(p.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${q.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);k.add(p.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);k.add(p.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);k.add(p.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);k.add(p.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(p=0,u=0){this.from=p;this.to=u}b._createClass(y,[{key:"numElements",get:function(){return this.to-this.from}}]);return y}();a.BufferRange=c;a.mergeAdjacentRanges=function(y){const p=new Map;y.forAll(q=>p.set(q.from,q));let u=!0;for(;u;)u=!1,y.forEach(q=>
{const k=p.get(q.to);k&&(q.to=k.to,p.delete(k.from),y.removeUnordered(k),u=!0)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./BufferRange"],function(a,b,c){c=function(y){function p(u,q,k){q=y.call(this,q,k)||this;q.geometry=u;return q}b._inherits(p,y);b._createClass(p,[{key:"isVisible",get:function(){return this.geometry.visible}},{key:"hasHighlights",
get:function(){return null!=this.geometry.highlights&&this.isVisible}},{key:"hasOccludees",get:function(){return null!=this.geometry.occludees}}]);return p}(c.BufferRange);a.Instance=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(a,b,c,y,p){function u(){return new c({allocator:f=>
f||new p.DrawCommand,deallocator:f=>f})}function q(f,g){const e=f.back();null==e?(f=f.pushNew(),f.first=g.from,f.count=g.numElements):e.first+e.count>=g.from?e.count=g.from-e.first+g.numElements:(f=f.pushNew(),f.first=g.from,f.count=g.numElements)}let k=function(){function f(){this._numElements=0;this._instances=new Map;this.holes=new c({allocator:e=>e||new y.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=
u();this.drawCommandsHighlight=u();this.drawCommandsOccludees=u();this.drawCommandsShadowHighlightRest=u()}var g=f.prototype;g.addInstance=function(e,h){this.deleteInstance(e);this._instances.set(e,h);this._numElements+=h.numElements};g.deleteInstance=function(e){const h=this._instances.get(e);h&&(this._numElements-=h.numElements,this._instances.delete(e))};g.updateInstance=function(e,h,z){if(e=this._instances.get(e))this._numElements-=e.numElements,e.from=h,e.to=z,this._numElements+=e.numElements};
g.updateDrawState=function(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0};g.updateDrawCommands=function(e){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){e=Array.from(this._instances.values()).sort((z,n)=>z.from===n.from?z.to-n.to:z.from-
n.from);for(var h of e)h.isVisible&&(q(h.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,h),q(h.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,h))}else{const z=this.drawCommandsDefault.pushNew();h=this.holes.front();null!=this.vao&&1===this.holes.length&&h.to===Math.floor(this.vao.byteSize/e)?(z.first=0,z.count=h.from):(z.first=Infinity,z.count=0,this._instances.forEach(n=>{z.first=Math.min(z.first,n.from);z.count=Math.max(z.count,n.to)}),z.count-=z.first)}};
g.needsMultipleCommands=function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances};b._createClass(f,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}}]);return f}(),d=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,f);return b._createClass(g)}(k);a.PerBufferData=k;a.PerVaoData=d;a.hasVao=function(f){return null!=f.vao};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(){this.count=this.first=0});a.DrawCommand=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this.origin=u;this.buffers=
[]}var p=y.prototype;p.dispose=function(){this.buffers.forEach(u=>u.vao.dispose());this.buffers.length=0};p.findBuffer=function(u){return this.buffers.find(q=>q.instances.has(u))};return b._createClass(y)}();a.PerOriginData=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MemCache ../../lib/VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,y,p,u){function q(f,g){if(g===c.RemoveMode.ALL)f.forEach(e=>e.dispose());else return g=f.pop(),f=f.length*g.byteSize,g.dispose(),f}const k=c.MIN_PRIORITY+1;let d=function(){function f(e,h,z){this._rctx=e;this._locations=h;this._layout=z;this._cache=e.newCache("VaoCache",q)}var g=f.prototype;g.dispose=function(){this._cache.destroy()};g.newVao=function(e){var h=e.toString();const z=this._cache.pop(h);if(null!=z){const n=z.pop();0<z.length&&this._cache.put(h,z,e*z.length,k);return n}h=
new y.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},{geometry:p.BufferObject.createVertex(this._rctx,u.Usage.STATIC_DRAW)});h.vertexBuffers.geometry.setSize(e);return h};g.deleteVao=function(e){if(null==e)return null;const h=e.byteSize,z=h.toString(),n=this._cache.pop(z);null!=n?(n.push(e),this._cache.put(z,n,h*n.length,-1)):this._cache.put(z,[e],h,-1);return null};return b._createClass(f)}();a.VaoCache=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../../../../chunks/vec2 ./glUtil3D ./SSAOBlurTechnique ./SSAONoiseData ./SSAOTechnique ../../../../chunks/SSAO.glsl ../shaders/SSAOParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){let m=function(){function t(r,x,D,A){this._view=r;this._techniqueRepository=x;this._rctx=D;this._requestRender=A;this._quadVAO=null;this._passParameters=new g.SSAOPassParameters;this._drawParameters=new g.BlurDrawParameters}var w=t.prototype;w.dispose=function(){this.enabled=!1;this._quadVAO=c.disposeMaybe(this._quadVAO)};w.destroy=function(){this.dispose()};w.disposeOffscreenBuffers=function(){this._ssaoFBO?.resize(0,0);this._blurFBO?.resize(0,0)};w.render=
function(r,x,D,A){if(null!=this._enableTime&&null!=D&&null!=A&&null!=this._ssaoFBO&&null!=this._blurFBO)if(this.active){0===this._enableTime&&(this._enableTime=x);var v=this._rctx,B=r.camera,C=this._view.qualitySettings.fadeDuration;x=0<C?Math.min(C,x-this._enableTime)/C:1;this._passParameters.normalTexture=A;this._passParameters.depthTexture=D;this._passParameters.projScale=1/B.computeRenderPixelSizeAtDist(1);this._passParameters.intensity=2/f.getRadius(B)**6*x;D=B.fullViewport;A=D[2];B=D[3];C=A/
2;var E=B/2;this._ssaoFBO.resize(A,B);this._blurFBO.resize(C,E);null==this._quadVAO&&(this._quadVAO=u.createQuadVAO(this._rctx));v.bindFramebuffer(this._ssaoFBO);v.setViewport(0,0,A,B);v.bindTechnique(this._ssaoTechnique,this._passParameters,r).bindDraw(this._drawParameters,r,this._passParameters);v.bindVAO(this._quadVAO);var F=l.vertexCount(this._quadVAO,"geometry");v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,F);var M=v.bindTechnique(this._blurTechnique,this._passParameters,r);v.setViewport(0,
0,C,E);v.bindFramebuffer(this._blurFBO);this._drawParameters.colorTexture=this._ssaoFBO.colorTexture;p.set(this._drawParameters.blurSize,0,2/B);M.bindDraw(this._drawParameters,r,this._passParameters);v.setViewport(0,0,C,E);v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,F);v.bindFramebuffer(this._ssaoFBO);v.setViewport(0,0,A,B);v.setClearColor(1,1,1,0);v.clear(e.ClearBufferBit.COLOR_BUFFER_BIT);v.setViewport(0,0,C,E);this._drawParameters.colorTexture=this._blurFBO.colorTexture;p.set(this._drawParameters.blurSize,
2/A,0);M.bindDraw(this._drawParameters,r,this._passParameters);v.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,F);v.setViewport(D[0],D[1],D[2],D[3]);1>x&&this._requestRender()}else this._enableTime=x,this._requestRender()};w._enable=function(){if(null==this._enableTime){var r=new n.TextureDescriptor;r.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;this._ssaoFBO=new h.FramebufferObject(this._rctx,r);this._blurFBO=new h.FramebufferObject(this._rctx,r);var x=Uint8Array.from(atob(k.noiseData),D=>D.charCodeAt(0));
r.pixelFormat=e.PixelFormat.RGB;r.wrapMode=e.TextureWrapMode.REPEAT;r.hasMipmap=!0;r.width=32;r.height=32;this._passParameters.noiseTexture=new z.Texture(this._rctx,r,x);null==this._ssaoTechnique&&(this._ssaoTechnique=this._techniqueRepository.acquire(d.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._techniqueRepository.acquire(q.SSAOBlurTechnique));this._enableTime=y.Milliseconds(0);this._requestRender()}};w._disable=function(){this._enableTime=null;this._passParameters.noiseTexture=
c.disposeMaybe(this._passParameters.noiseTexture);this._blurFBO=c.disposeMaybe(this._blurFBO);this._ssaoFBO=c.disposeMaybe(this._ssaoFBO)};b._createClass(t,[{key:"enabled",get:function(){return null!=this._enableTime},set:function(r){r?this._enable():this._disable()}},{key:"active",get:function(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}},{key:"colorTexture",get:function(){return this._ssaoFBO?.colorTexture}},{key:"gpuMemoryUsage",get:function(){return(this._blurFBO?.gpuMemoryUsage??
0)+(this._ssaoFBO?.gpuMemoryUsage??0)}}]);return t}();a.SSAOHelper=m;a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAOBlur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,
y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.SSAOBlur,()=>new Promise((f,g)=>a(["../shaders/SSAOBlur.glsl"],f,g)));b.SSAOBlurTechnique=p;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(){const z=new d.ShaderBuilder,n=z.fragment;z.include(c.ScreenSpacePass);n.include(y.ReadLinearDepth);n.uniforms.add(new g.Texture2DPassUniform("depthMap",l=>l.depthTexture),new f.Texture2DDrawUniform("tex",l=>l.colorTexture),new p.Float2DrawUniform("blurSize",l=>l.blurSize),new q.FloatPassUniform("projScale",(l,m)=>{m=b.distance(m.camera.eye,m.camera.center);return 5E4<m?Math.max(0,l.projScale-(m-5E4)):l.projScale}),new u.Float2PassUniform("nearFar",(l,m)=>
m.camera.nearFar));n.code.add(k.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${k.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);n.code.add(k.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${k.glsl.int(4)}; r <= ${k.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `);return z}const h=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=h;a.build=e})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec2",y.BindType.Draw,(d,f,g,e)=>d.setUniform2fv(q,k(f,g,e)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);
a.Float2DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=
g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.SSAO,()=>new Promise((f,g)=>a(["../shaders/SSAO.glsl"],f,g)));b.SSAOTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(){const n=new f.ShaderBuilder,l=n.fragment;n.include(y.ScreenSpacePass);l.include(p.ReadLinearDepth);n.include(u.CameraSpace);l.uniforms.add(new k.FloatPassUniform("radius",(m,t)=>h(t.camera)));l.code.add(d.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);l.code.add(d.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);l.uniforms.add(new q.Float2PassUniform("nearFar",(m,t)=>t.camera.nearFar),new g.Texture2DPassUniform("normalMap",m=>m.normalTexture),new g.Texture2DPassUniform("depthMap",m=>m.depthTexture),new q.Float2PassUniform("zScale",(m,t)=>u.getZScale(t)),new k.FloatPassUniform("projScale",m=>m.projScale),new g.Texture2DPassUniform("rnm",m=>m.noiseTexture),new q.Float2PassUniform("rnmScale",(m,t)=>b.set(z,t.camera.fullWidth/m.noiseTexture.descriptor.width,t.camera.fullHeight/m.noiseTexture.descriptor.height)),
new k.FloatPassUniform("intensity",m=>m.intensity),new q.Float2PassUniform("screenSize",(m,t)=>b.set(z,t.camera.fullWidth,t.camera.fullHeight)));l.code.add(d.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${d.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${d.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `);return n}function h(n){return Math.max(10,20*n.computeScreenPixelSizeAtDist(Math.abs(4*n.relativeElevation)))}const z=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:e,getRadius:h},Symbol.toStringTag,{value:"Module"}));a.SSAO=c;a.build=e;a.getRadius=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,y,p,u,q,k){function d(e){return 0===e.camera.projectionMatrix[11]?b.set(g,0,1):b.set(g,1,0)}const f=p.create(),g=c.create();a.CameraSpace=function(e){e.fragment.uniforms.add(new q.Float4PassUniform("projInfo",(h,z)=>{h=z.camera.projectionMatrix;z=0===h[11]?y.set(f,2/(z.camera.fullWidth*h[0]),2/(z.camera.fullHeight*h[5]),(1+h[12])/h[0],(1+h[13])/h[5]):y.set(f,-2/(z.camera.fullWidth*h[0]),-2/(z.camera.fullHeight*h[5]),(1-h[8])/h[0],(1-h[9])/h[5]);return z}));e.fragment.uniforms.add(new u.Float2PassUniform("zScale",
(h,z)=>d(z)));e.fragment.code.add(k.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/SSAOParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../core/shaderModules/interfaces"],function(a,b,c,y){let p=function(k){function d(){var f=k.apply(this,arguments)||this;f.projScale=1;return f}b._inherits(d,k);return b._createClass(d)}(y.NoParameters),u=function(k){function d(){var f=k.apply(this,arguments)||
this;f.intensity=1;return f}b._inherits(d,k);return b._createClass(d)}(p);y=function(k){function d(){return k.apply(this,arguments)||this}b._inherits(d,k);return b._createClass(d)}(y.NoParameters);let q=function(k){function d(){var f=k.apply(this,arguments)||this;f.blurSize=c.create();return f}b._inherits(d,k);return b._createClass(d)}(y);a.BlurDrawParameters=q;a.BlurPassParameters=p;a.SSAODrawParameters=y;a.SSAOPassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){u=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new k.Program(z.rctx,e.shader.get().build(),q.Default3D)};h.initializePipeline=function(){return this.configuration.hasAlpha?f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({colorWrite:f.defaultColorWriteParams})};
return c._createClass(e)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(y.TextureOnly,()=>new Promise((g,e)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],g,e)));b.TextureTechnique=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,
c,y){let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.hasAlpha=!1;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter()],p.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],function(a,b,c){function y(q,k,d,f,g,e=2){var h=
1/(Math.abs(d)+Math.abs(f)+Math.abs(g));d*=h;f*=h;h=0>=g?(0<=f?1:-1)*(1-Math.abs(d)):f;k*=e;q[k]=p(0>=g?(0<=d?1:-1)*(1-Math.abs(f)):d);q[k+1]=p(h)}function p(q){return b.clamp(Math.round(32767*q),-32767,32767)}function u(q){return b.clamp(q/32767,-1,1)}a.compressNormal=y;a.compressNormals=function(q){const k=q.length/3,d=new Int16Array(2*k);let f=0;for(let g=0;g<k;++g)y(d,g,q[f++],q[f++],q[f++]);return d};a.decodeInt16=u;a.decompressNormal=function(q,k,d,f=2){f*=d;d=u(k[f]);k=u(k[f+1]);f=1-Math.abs(d)-
Math.abs(k);q[2]=f;0>f?(q[0]=(0<=d?1:-1)*(1-Math.abs(k)),q[1]=(0<=k?1:-1)*(1-Math.abs(d))):(q[0]=d,q[1]=k);c.normalize(q,q)};a.encodeInt16=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){z=function(O){function I(J){J=O.call(this,J,B)||this;J.supportsEdges=!0;J._configuration=new D.DefaultMaterialTechniqueConfiguration;var N=J.parameters;const R=q.newLayout().vec3f(m.VertexAttribute.POSITION);N.normalType===d.NormalType.Compressed?R.vec2i16(m.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):R.vec3f(m.VertexAttribute.NORMAL);N.hasVertexTangents&&R.vec4f(m.VertexAttribute.TANGENT);(N.textureId||N.normalTextureId||N.metallicRoughnessTextureId||
N.emissiveTextureId||N.occlusionTextureId)&&R.vec2f(m.VertexAttribute.UV0);N.hasVertexColors&&R.vec4u8(m.VertexAttribute.COLOR);N.hasSymbolColors&&R.vec4u8(m.VertexAttribute.SYMBOLCOLOR);c("enable-feature:objectAndLayerId-rendering")&&R.vec4u8(m.VertexAttribute.OBJECTANDLAYERIDCOLOR);J._vertexBufferLayout=R;return J}b._inherits(I,O);var H=I.prototype;H.isVisibleForOutput=function(J){return J===k.ShaderOutput.Shadow||J===k.ShaderOutput.ShadowExcludeHighlight||J===k.ShaderOutput.ShadowHighlight?this.parameters.castShadows:
!0};H.isVisible=function(){var J=this.parameters;if(!b._get(b._getPrototypeOf(I.prototype),"isVisible",this).call(this)||0===J.layerOpacity)return!1;const {hasInstancedColor:N,hasVertexColors:R,hasSymbolColors:W,vvColor:T}=J,P="replace"===J.colorMixMode,Q=0<J.opacity;J=J.externalColor&&0<J.externalColor[3];const S=N||T||W;return R&&S?P||Q:R?P?J:Q:S?P||Q:P?J:Q};H.getConfiguration=function(J,N){this._configuration.output=J;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=
!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=
this.parameters.hasSlicePlane?e.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=N.multipassTerrain.enabled;this._configuration.cullAboveGround=N.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(J===k.ShaderOutput.Color||J===k.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?f.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.WindingOrder:f.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=
N.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?g.PBRMode.Schematic:g.PBRMode.Normal:g.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=N.transparencyPassType,this._configuration.enableOffset=N.camera.relativeElevation<n.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(N),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,
this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};H.hasSnowCover=function(J){return null!=J.weather&&J.weatherVisible&&"snowy"===J.weather.type&&"enabled"===J.weather.snowCover};H.intersect=function(J,N,R,W,T,P){if(null!=
this.parameters.verticalOffset){const S=R.camera;y.set(G,N[12],N[13],N[14]);N=null;switch(R.viewingMode){case u.ViewingMode.Global:N=y.normalize(M,G);break;case u.ViewingMode.Local:N=y.copy(M,F)}let U=0;var Q=y.subtract(L,G,S.eye);const V=y.length(Q);Q=y.scale(Q,Q,1/V);let X=null;this.parameters.screenSizePerspective&&(X=y.dot(N,Q));U+=r.verticalOffsetAtDistance(S,V,this.parameters.verticalOffset,X??0,this.parameters.screenSizePerspective);y.scale(N,N,U);y.transformMat3(K,N,R.transform.inverseRotation);
W=y.subtract(C,W,K);T=y.subtract(E,T,K)}r.intersectTriangleGeometry(J,R,W,T,t.getVerticalOffsetObject3D(R.verticalOffset),P)};H.requiresSlot=function(J,N){return N===k.ShaderOutput.Color||N===k.ShaderOutput.Alpha||N===k.ShaderOutput.Depth||N===k.ShaderOutput.Normal||N===k.ShaderOutput.Shadow||N===k.ShaderOutput.ShadowHighlight||N===k.ShaderOutput.ShadowExcludeHighlight||N===k.ShaderOutput.Highlight||N===k.ShaderOutput.ObjectAndLayerIdColor?J===(this.parameters.transparent?this.parameters.writeDepth?
l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:l.RenderSlot.OPAQUE_MATERIAL)||J===l.RenderSlot.DRAPED_MATERIAL:!1};H.createGLMaterial=function(J){return new v(J)};H.createBufferWriter=function(){return new w.DefaultBufferWriter(this._vertexBufferLayout)};return b._createClass(I)}(z.Material);let v=function(O){function I(J){return O.call(this,{...J,...J.material.parameters})||this}b._inherits(I,O);var H=I.prototype;H._updateShadowState=function(J){J.shadowMap.enabled!==
this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:J.shadowMap.enabled})};H._updateOccludeeState=function(J){J.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:J.hasOccludees})};H.beginSlot=function(J){if(this._output===k.ShaderOutput.Color||this._output===k.ShaderOutput.Alpha)this._updateShadowState(J),this._updateOccludeeState(J);const N=this._material.parameters;this.updateTexture(N.textureId);const R=
J.camera.viewInverseTransposeMatrix;y.set(N.origin,R[3],R[7],R[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(N.treeRendering?A.RealisticTreeTechnique:x.DefaultMaterialTechnique,J)};return b._createClass(I)}(h.GLTextureMaterial);h=function(O){function I(){var H=O.apply(this,arguments)||this;H.initTextureTransparent=!1;H.treeRendering=!1;H.hasVertexTangents=!1;return H}b._inherits(I,O);return b._createClass(I)}(x.DefaultMaterialPassParameters);const B=new h,
C=p.create(),E=p.create(),F=p.fromValues(0,0,1),M=p.create(),K=p.create(),G=p.create(),L=p.create();a.DefaultGLMaterial=v;a.DefaultMaterial=z;a.DefaultMaterialParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(y){y[y.None=0]="None";y[y.View=1]="View";
y[y.WindingOrder=2]="WindingOrder";y[y.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(y,p){y=y.fragment;y.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(p.doubleSidedMode){case a.NormalsDoubleSidedMode.None:y.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:y.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:y.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(p.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){let B=function(C){function E(){var F=C.apply(this,arguments)||this;F.isSchematic=!1;F.usePBR=!1;F.mrrFactors=y.fromArray(x.defaultAdvancedMRRFactors);F.hasVertexColors=!1;F.hasSymbolColors=!1;F.doubleSided=!1;F.doubleSidedType="normal";F.cullFace=z.CullFaceOptions.Back;F.isInstanced=!1;F.hasInstancedColor=!1;F.emissiveFactor=y.fromValues(0,0,0);F.instancedDoublePrecision=!1;F.normalType=k.NormalType.Attribute;F.receiveSSAO=!0;F.receiveShadows=
!0;F.castShadows=!0;F.shadowMappingEnabled=!1;F.ambient=y.fromValues(.2,.2,.2);F.diffuse=y.fromValues(.8,.8,.8);F.externalColor=p.fromValues(1,1,1,1);F.colorMixMode="multiply";F.opacity=1;F.layerOpacity=1;F.origin=y.create();F.hasSlicePlane=!1;F.hasSliceHighlight=!0;F.offsetTransparentBackfaces=!1;F.vvSize=null;F.vvColor=null;F.vvOpacity=null;F.vvSymbolAnchor=null;F.vvSymbolRotationMatrix=null;F.modelTransformation=null;F.transparent=!1;F.writeDepth=!0;F.customDepthTest=z.DepthTestFunction.Less;F.textureAlphaMode=
z.AlphaDiscardMode.Blend;F.textureAlphaCutoff=g.defaultMaskAlphaCutoff;F.textureAlphaPremultiplied=!1;F.hasOccludees=!1;F.renderOccluded=l.RenderOccludedFlag.Occlude;return F}c._inherits(E,C);return c._createClass(E)}(f.VertexNormalPassParameters);f=function(C){function E(){var F=C.apply(this,arguments)||this;F.origin=y.create();F.slicePlaneLocalOrigin=F.origin;return F}c._inherits(E,C);return c._createClass(E)}(f.VertexNormalDrawParameters);h=function(C){function E(){return C.apply(this,arguments)||
this}c._inherits(E,C);var F=E.prototype;F.initializeConfiguration=function(M,K){K.spherical=M.viewingMode===u.ViewingMode.Global;K.doublePrecisionRequiresObfuscation=M.rctx.driverTest.doublePrecisionRequiresObfuscation.result;K.textureCoordinateType=K.hasColorTexture||K.hasMetallicRoughnessTexture||K.hasEmissionTexture||K.hasOcclusionTexture||K.hasNormalTexture?d.TextureCoordinateAttributeType.Default:d.TextureCoordinateAttributeType.None;K.objectAndLayerIdColorInstanced=K.instanced};F.initializeProgram=
function(M){return this._initializeProgram(M,E.shader)};F._initializeProgram=function(M,K){return new t.Program(M.rctx,K.get().build(this.configuration),n.Default3D)};F._convertDepthTestFunction=function(M){return M===z.DepthTestFunction.Lequal?A.CompareFunction.LEQUAL:A.CompareFunction.LESS};F._makePipeline=function(M,K){const G=this.configuration,L=M===r.TransparencyPassType.NONE,O=M===r.TransparencyPassType.FrontFace;var I=v.makePipelineState,H=G.output!==q.ShaderOutput.Color&&G.output!==q.ShaderOutput.Alpha||
!G.transparent?null:L?m.blendingDefault:m.oitBlending(M);var J=G.cullFace!==z.CullFaceOptions.None?!0:G.hasSlicePlane?!1:!G.transparent&&!G.doubleSidedMode;return I.call(v,{blending:H,culling:J?v.cullingParams(G.cullFace):null,depthTest:{func:m.oitDepthTest(M,this._convertDepthTestFunction(G.customDepthTest))},depthWrite:L||O?G.writeDepth?v.defaultDepthWriteParams:null:null,colorWrite:v.defaultColorWriteParams,stencilWrite:G.hasOccludees?w.stencilWriteMaskOn:null,stencilTest:G.hasOccludees?K?w.stencilToolMaskBaseParams:
w.stencilBaseAllZerosParams:null,polygonOffset:L||O?null:m.getOITPolygonOffset(G.enableOffset)})};F.initializePipeline=function(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0);return this._makePipeline(this.configuration.transparencyPassType,!1)};F.getPipelineState=function(M,K){return K?this._occludeePipelineState:c._get(c._getPrototypeOf(E.prototype),"getPipelineState",this).call(this,M,K)};return c._createClass(E)}(h.ShaderTechnique);h.shader=new e.ReloadableShaderModule(D.DefaultMaterial,
()=>new Promise((C,E)=>a(["./DefaultMaterial.glsl"],C,E)));b.DefaultMaterialDrawParameters=f;b.DefaultMaterialPassParameters=B;b.DefaultMaterialTechnique=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c){a.defaultAdvancedMRRFactors=[1,1,.5];a.defaultEsriSymbologyMRRFactors=[0,1,.2];a.defaultSchematicMRRFactors=[0,.6,.2];a.useSchematicPBR=
function({normalTexture:y,metallicRoughnessTexture:p,metallicFactor:u,roughnessFactor:q,emissiveTexture:k,emissiveFactor:d,occlusionTexture:f}){return null==y&&null==p&&null==k&&(null==d||b.exactEquals(d,c.ZEROS))&&null==f&&(null==q||1===q)&&(null==u||1===u||0===u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ./mat3 ./mat3f64 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S){function U(X){const Y=new T.ShaderBuilder,{vertex:Z,fragment:ea,varyings:ja}=Y;O.addProjViewLocalOrigin(Z,X);Y.include(e.PositionAttribute);ja.add("vpos","vec3");Y.include(M.VisualVariables,X);Y.include(f.InstancedDoublePrecision,X);Y.include(m.VerticalOffset,X);X.hasColorTextureTransform&&Y.include(F.colorTextureUV);if(X.output===q.ShaderOutput.Color||X.output===q.ShaderOutput.Alpha){X.hasNormalTextureTransform&&
Y.include(F.normalTextureUV);X.hasEmissionTextureTransform&&Y.include(F.emissiveTextureUV);X.hasOcclusionTextureTransform&&Y.include(F.occlusionTextureUV);X.hasMetallicRoughnessTextureTransform&&Y.include(F.metallicRoughnessTextureUV);O.addCameraPosition(Z,X);Y.include(g.NormalAttribute,X);Y.include(d.Transform,X);const ha=X.normalType===g.NormalType.Attribute||X.normalType===g.NormalType.Compressed;ha&&X.offsetBackfaces&&Y.include(u.Offset);Y.include(w.ComputeNormalTexture,X);Y.include(l.VertexNormal,
X);X.instancedColor&&Y.attributes.add(S.VertexAttribute.INSTANCECOLOR,"vec4");ja.add("vPositionLocal","vec3");Y.include(z.TextureCoordinateAttribute,X);Y.include(p.ForwardLinearDepth,X);Y.include(h.SymbolColor,X);Y.include(n.VertexColor,X);Z.uniforms.add(new H.Float4PassUniform("externalColor",oa=>oa.externalColor));ja.add("vcolorExt","vec4");X.hasMultipassTerrain&&ja.add("depth","float");const ia=X.hasModelTransformation;if(ia){const oa=c.create();Z.uniforms.add(new W.Matrix4PassUniform("model",
ma=>ma.modelTransformation??y.IDENTITY));Z.uniforms.add(new R.Matrix3PassUniform("normalTransform",ma=>{b.normalFromMat4(oa,ma.modelTransformation??y.IDENTITY);return oa}))}Z.code.add(N.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${X.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${N.glsl.float(K.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${ia?"vpos \x3d (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${ha?N.glsl`vNormalWorld = ${ia?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${X.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${ha&&X.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${X.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${X.hasColorTextureTransform?N.glsl`forwardColorUV();`:""}
        ${X.hasNormalTextureTransform?N.glsl`forwardNormalUV();`:""}
        ${X.hasEmissionTextureTransform?N.glsl`forwardEmissiveUV();`:""}
        ${X.hasOcclusionTextureTransform?N.glsl`forwardOcclusionUV();`:""}
        ${X.hasMetallicRoughnessTextureTransform?N.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(X.output){case q.ShaderOutput.Alpha:Y.include(k.SliceDraw,X);Y.include(G.DiscardOrAdjustAlphaPass,X);Y.include(A.multipassTerrainTest,X);ea.uniforms.add(new J.FloatPassUniform("opacity",ha=>ha.opacity),new J.FloatPassUniform("layerOpacity",ha=>ha.layerOpacity));X.hasColorTexture&&ea.uniforms.add(new P.Texture2DPassUniform("tex",ha=>ha.texture));ea.include(L.MixExternalColor);ea.code.add(N.glsl`
      void main() {
        discardBySlice(vpos);
        ${X.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${X.hasColorTexture?N.glsl`
                vec4 texColor = texture(tex, ${X.hasColorTextureTransform?N.glsl`colorUV`:N.glsl`vuv0`});
                ${X.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:N.glsl`vec4 texColor = vec4(1.0);`}
        ${X.hasVertexColors?N.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:N.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case q.ShaderOutput.Color:Y.include(k.SliceDraw,X),Y.include(x.EvaluateSceneLighting,X),Y.include(r.EvaluateAmbientOcclusion,X),Y.include(G.DiscardOrAdjustAlphaPass,X),Y.include(X.instancedDoublePrecision?E.ReadShadowMapPass:E.ReadShadowMapDraw,X),Y.include(A.multipassTerrainTest,X),O.addCameraPosition(ea,X),ea.uniforms.add(Z.uniforms.get("localOrigin"),new I.Float3PassUniform("ambient",ha=>ha.ambient),new I.Float3PassUniform("diffuse",ha=>ha.diffuse),new J.FloatPassUniform("opacity",
ha=>ha.opacity),new J.FloatPassUniform("layerOpacity",ha=>ha.layerOpacity)),X.hasColorTexture&&ea.uniforms.add(new P.Texture2DPassUniform("tex",ha=>ha.texture)),Y.include(C.PhysicallyBasedRenderingParameters,X),Y.include(B.PhysicallyBasedRendering,X),ea.include(L.MixExternalColor),Y.include(v.Normals,X),x.addAmbientBoostFactor(ea),x.addLightingGlobalFactor(ea),D.addMainLightIntensity(ea),ea.code.add(N.glsl`
      void main() {
        discardBySlice(vpos);
        ${X.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${X.hasColorTexture?N.glsl`
                vec4 texColor = texture(tex, ${X.hasColorTextureTransform?N.glsl`colorUV`:N.glsl`vuv0`});
                ${X.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:N.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${X.normalType===g.NormalType.ScreenDerivative?N.glsl`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:N.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${X.pbrMode===C.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${X.receiveShadows?"readShadowMap(vpos, linearDepth)":X.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${X.hasVertexColors?N.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:N.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${X.hasNormalTexture?N.glsl`
                mat3 tangentSpace = ${X.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${X.hasNormalTextureTransform?N.glsl`normalUV`:"vuv0"});`:N.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${X.spherical?N.glsl`normalize(posWorld);`:N.glsl`vec3(0.0, 0.0, 1.0);`}

        ${X.snowCover?N.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${X.pbrMode===C.PBRMode.Normal||X.pbrMode===C.PBRMode.Schematic?N.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${X.snowCover?N.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:N.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${X.transparencyPassType===Q.TransparencyPassType.Color?N.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}Y.include(t.DefaultMaterialAuxiliaryPasses,X);return Y}const V=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=V;a.build=U})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=function(l){function m(){var t=l.apply(this,arguments)||this;t.instancedDoublePrecision=!1;return t}b._inherits(m,l);return b._createClass(m)}(g.ShaderTechniqueConfiguration);c.__decorate([g.parameter()],z.prototype,"instancedDoublePrecision",void 0);const n=p.create();a.InstancedDoubleConfiguration=z;a.InstancedDoublePrecision=function(l,m){m.instanced&&m.instancedDoublePrecision&&(l.attributes.add(e.VertexAttribute.MODELORIGINHI,"vec3"),l.attributes.add(e.VertexAttribute.MODELORIGINLO,
"vec3"),l.attributes.add(e.VertexAttribute.MODEL,"mat3"),l.attributes.add(e.VertexAttribute.MODELNORMAL,"mat3"));l=l.vertex;m.instancedDoublePrecision&&(l.include(q.DoublePrecision,m),l.uniforms.add(new d.Float3DrawUniform("viewOriginHi",(t,w)=>h.encodeDoubleHi(y.set(n,w.camera.viewInverseTransposeMatrix[3],w.camera.viewInverseTransposeMatrix[7],w.camera.viewInverseTransposeMatrix[11]),n)),new d.Float3DrawUniform("viewOriginLo",(t,w)=>h.encodeDoubleLo(y.set(n,w.camera.viewInverseTransposeMatrix[3],
w.camera.viewInverseTransposeMatrix[7],w.camera.viewInverseTransposeMatrix[11]),n))));l.code.add(f.glsl`
    vec3 calculateVPos() {
      ${m.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);l.code.add(f.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${m.instancedDoublePrecision?f.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);l.code.add(f.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${m.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);m.output===u.ShaderOutput.Normal&&(k.addViewNormal(l),l.code.add(f.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${m.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));m.hasVertexTangents&&l.code.add(f.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${m.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,c,y,p,u){a.SymbolColor=function(q,k){k.hasSymbolColors?(q.include(b.DecodeSymbolColor),q.attributes.add(p.VertexAttribute.SYMBOLCOLOR,
"vec4"),q.varyings.add("colorMixMode","mediump float"),q.vertex.code.add(y.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(q.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",d=>u.colorMixModes[d.colorMixMode])),q.vertex.code.add(y.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(y){y.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(a,b){a.ColorMixModeEnum=void 0;(function(c){c[c.Multiply=1]="Multiply";c[c.Ignore=2]="Ignore";c[c.Replace=3]="Replace";c[c.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(c,y,p){if(null==c||y===a.ColorMixModeEnum.Ignore)p[0]=255,p[1]=255,p[2]=255,p[3]=255;else{var u=b.clamp(Math.round(85*
c[3]),0,85);y=0===u||y===a.ColorMixModeEnum.Tint?0:y===a.ColorMixModeEnum.Replace?85:170;p[0]=b.clamp(Math.round(255*c[0]),0,255);p[1]=b.clamp(Math.round(255*c[1]),0,255);p[2]=b.clamp(Math.round(255*c[2]),0,255);p[3]=u+y}};a.parseColorMixMode=function(c){switch(c){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(y,p){p.hasVertexColors?(y.attributes.add(c.VertexAttribute.COLOR,"vec4"),y.varyings.add("vColor","vec4"),y.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),y.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
y.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){a.DefaultMaterialAuxiliaryPasses=function(A,v){const {vertex:B,fragment:C}=A,E=v.hasModelTransformation;if(E){const M=c.create();B.uniforms.add(new r.Matrix4PassUniform("model",K=>K.modelTransformation??y.IDENTITY));B.uniforms.add(new w.Matrix3PassUniform("normalTransform",K=>{b.normalFromMat4(M,K.modelTransformation??y.IDENTITY);return M}))}const F=v.hasColorTexture&&v.alphaDiscardMode!==D.AlphaDiscardMode.Opaque;switch(v.output){case u.ShaderOutput.Depth:case u.ShaderOutput.Shadow:case u.ShaderOutput.ShadowHighlight:case u.ShaderOutput.ShadowExcludeHighlight:case u.ShaderOutput.ObjectAndLayerIdColor:m.addProjViewLocalOrigin(B,
v);A.include(k.Transform,v);A.include(g.TextureCoordinateAttribute,v);A.include(n.VisualVariables,v);A.include(h.OutputDepth,v);A.include(q.SliceDraw,v);A.include(f.ObjectAndLayerIdColor,v);p.addNearFar(A);A.varyings.add("depth","float");F&&C.uniforms.add(new x.Texture2DPassUniform("tex",M=>M.texture));B.code.add(t.glsl`
          void main(void) {
            vpos = calculateVPos();
            ${E?"vpos \x3d (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `);A.include(l.DiscardOrAdjustAlphaPass,v);C.code.add(t.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${F?t.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?t.glsl`colorUV`:t.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${v.output===u.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:t.glsl`outputDepth(depth);`}
          }
        `);break;case u.ShaderOutput.Normal:m.addProjViewLocalOrigin(B,v);A.include(k.Transform,v);A.include(d.NormalAttribute,v);A.include(e.VertexNormal,v);A.include(g.TextureCoordinateAttribute,v);A.include(n.VisualVariables,v);F&&C.uniforms.add(new x.Texture2DPassUniform("tex",M=>M.texture));v.normalType===d.NormalType.ScreenDerivative&&A.varyings.add("vPositionView","vec3");B.code.add(t.glsl`
          void main(void) {
            vpos = calculateVPos();
            ${E?"vpos \x3d (model * vec4(vpos, 1.0)).xyz;":""}

            ${v.normalType===d.NormalType.Attribute||v.normalType===d.NormalType.Compressed?t.glsl`vNormalWorld = ${E?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:t.glsl`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `);A.include(q.SliceDraw,v);A.include(l.DiscardOrAdjustAlphaPass,v);C.code.add(t.glsl`
          void main() {
            discardBySlice(vpos);
            ${F?t.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?t.glsl`colorUV`:t.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${v.normalType===d.NormalType.ScreenDerivative?t.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:t.glsl`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break;case u.ShaderOutput.Highlight:m.addProjViewLocalOrigin(B,v),A.include(k.Transform,v),A.include(g.TextureCoordinateAttribute,v),A.include(n.VisualVariables,v),F&&C.uniforms.add(new x.Texture2DPassUniform("tex",M=>M.texture)),B.code.add(t.glsl`
          void main(void) {
            vpos = calculateVPos();
            ${E?"vpos \x3d (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),A.include(q.SliceDraw,v),A.include(l.DiscardOrAdjustAlphaPass,v),A.include(z.OutputHighlight,v),C.code.add(t.glsl`
          void main() {
            discardBySlice(vpos);
            ${F?t.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?t.glsl`colorUV`:t.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,c,y,p,u){function q(k,d,f){const g=k.fragment;d.alphaDiscardMode!==u.AlphaDiscardMode.Mask&&d.alphaDiscardMode!==u.AlphaDiscardMode.MaskBlend||
g.uniforms.add(f);switch(d.alphaDiscardMode){case u.AlphaDiscardMode.Blend:return k.include(b.DiscardOrAdjustAlphaBlend);case u.AlphaDiscardMode.Opaque:g.code.add(p.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case u.AlphaDiscardMode.Mask:g.code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case u.AlphaDiscardMode.MaskBlend:k.fragment.code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(k,d){q(k,d,new c.FloatDrawUniform("textureAlphaCutoff",f=>f.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(k,d){q(k,d,new y.FloatPassUniform("textureAlphaCutoff",
f=>f.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,c){a.DiscardOrAdjustAlphaBlend=function(y){y.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"float",y.BindType.Draw,(d,f,g)=>d.setUniform1f(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.FloatDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),function(a,b,c,y,p,u,q,k,d){a.ComputeNormalTexture=function(f,g){const e=f.fragment;
g.hasVertexTangents?(f.attributes.add(d.VertexAttribute.TANGENT,"vec4"),f.varyings.add("vTangent","vec4"),g.doubleSidedMode===y.NormalsDoubleSidedMode.WindingOrder?e.code.add(p.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):e.code.add(p.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):e.code.add(p.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);g.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(f.include(c.VertexTextureCoordinates,g),e.uniforms.add(g.pbrTextureBindType===k.BindType.Pass?new q.Texture2DPassUniform("normalTexture",h=>h.textureNormal):new u.Texture2DDrawUniform("normalTexture",h=>h.textureNormal)),e.code.add(p.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../lib/SSAOHelper"],function(a,b,c,y){a.EvaluateAmbientOcclusion=function(p,u){p=p.fragment;u.receiveAmbientOcclusion?(p.uniforms.add(new c.Texture2DPassUniform("ssaoTex",(q,k)=>k.ssaoHelper.colorTexture)),p.constants.add("blurSizePixelsInverse",
"float",1/y.blurSizePixels),p.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):p.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(n){n.constants.add("ambientBoostFactor","float",e.ambientBoost)}function z(n){n.uniforms.add(new f.FloatPassUniform("lightingGlobalFactor",(l,m)=>m.lighting.globalFactor))}a.EvaluateSceneLighting=function(n,l){const m=n.fragment;n.include(y.EvaluateAmbientOcclusion,l);l.pbrMode!==q.PBRMode.Disabled&&n.include(u.PhysicallyBasedRendering,l);n.include(c.EvaluateAmbientLighting,l);n.include(k.PiUtils);m.code.add(g.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${l.pbrMode===q.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);h(m);z(m);p.addMainLightDirection(m);m.code.add(g.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${l.spherical?g.glsl`normalize(vPosWorld)`:g.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);p.addMainLightIntensity(m);m.code.add(g.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(l.pbrMode){case q.PBRMode.Disabled:case q.PBRMode.WaterOnIntegratedMesh:case q.PBRMode.Water:n.include(p.MainLighting);m.code.add(g.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case q.PBRMode.Normal:case q.PBRMode.Schematic:m.code.add(g.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);m.code.add(g.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);l.useFillLights?m.uniforms.add(new d.BooleanPassUniform("hasFillLights",(t,w)=>w.enableFillLights)):m.constants.add("hasFillLights","bool",!1);m.code.add(g.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);m.uniforms.add(new f.FloatPassUniform("lightingSpecularStrength",(t,w)=>w.lighting.mainLight.specularStrength),new f.FloatPassUniform("lightingEnvironmentStrength",(t,w)=>w.lighting.mainLight.environmentStrength));m.code.add(g.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);m.code.add(g.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${l.pbrMode===q.PBRMode.Schematic?g.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:g.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case q.PBRMode.Terrain:case q.PBRMode.TerrainWithWater:n.include(p.MainLighting);m.code.add(g.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(l.pbrMode);case q.PBRMode.COUNT:}};a.addAmbientBoostFactor=h;a.addLightingGlobalFactor=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,c,y){a.colorTextureUV=function(p){p.vertex.uniforms.add(new y.Matrix3PassUniform("colorTextureTransformMatrix",
u=>null!=u.colorTextureTransformMatrix?u.colorTextureTransformMatrix:b.create()));p.varyings.add("colorUV","vec2");p.vertex.code.add(c.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.emissiveTextureUV=function(p){p.vertex.uniforms.add(new y.Matrix3PassUniform("emissiveTextureTransformMatrix",u=>null!=u.emissiveTextureTransformMatrix?u.emissiveTextureTransformMatrix:b.create()));p.varyings.add("emissiveUV","vec2");p.vertex.code.add(c.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.metallicRoughnessTextureUV=function(p){p.vertex.uniforms.add(new y.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",u=>null!=u.metallicRoughnessTextureTransformMatrix?u.metallicRoughnessTextureTransformMatrix:b.create()));p.varyings.add("metallicRoughnessUV","vec2");p.vertex.code.add(c.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.normalTextureUV=function(p){p.vertex.uniforms.add(new y.Matrix3PassUniform("normalTextureTransformMatrix",u=>null!=u.normalTextureTransformMatrix?u.normalTextureTransformMatrix:b.create()));p.varyings.add("normalUV","vec2");p.vertex.code.add(c.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.occlusionTextureUV=function(p){p.vertex.uniforms.add(new y.Matrix3PassUniform("occlusionTextureTransformMatrix",u=>null!=u.occlusionTextureTransformMatrix?u.occlusionTextureTransformMatrix:b.create()));p.varyings.add("occlusionUV","vec2");p.vertex.code.add(c.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const q=new Float32Array(9);q[0]=1;q[4]=1;q[8]=1;return q}function c(q){const k=new Float32Array(9);k[0]=q[0];k[1]=q[1];k[2]=q[2];k[3]=q[3];k[4]=q[4];k[5]=q[5];k[6]=q[6];k[7]=q[7];k[8]=q[8];return k}function y(q,k,d,f,g,e,h,z,n){const l=new Float32Array(9);l[0]=q;l[1]=k;l[2]=d;l[3]=f;l[4]=g;l[5]=e;l[6]=h;l[7]=z;l[8]=n;return l}function p(q,k){return new Float32Array(q,
k,9)}const u=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.mat3f32=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,y){a.MixExternalColor=function(p){p.include(c.ColorConversion);p.code.add(y.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${y.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${y.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${y.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${y.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${y.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){e=function(h){function z(){var n=h.apply(this,arguments)||this;n.output=y.ShaderOutput.Color;n.alphaDiscardMode=f.AlphaDiscardMode.Opaque;n.doubleSidedMode=q.NormalsDoubleSidedMode.None;n.pbrMode=k.PBRMode.Disabled;n.cullFace=f.CullFaceOptions.None;n.transparencyPassType=g.TransparencyPassType.NONE;n.normalType=p.NormalType.Attribute;n.textureCoordinateType=u.TextureCoordinateAttributeType.None;n.customDepthTest=f.DepthTestFunction.Less;n.spherical=!1;n.hasVertexColors=
!1;n.hasSymbolColors=!1;n.hasVerticalOffset=!1;n.hasSlicePlane=!1;n.hasSliceHighlight=!0;n.hasColorTexture=!1;n.hasMetallicRoughnessTexture=!1;n.hasEmissionTexture=!1;n.hasOcclusionTexture=!1;n.hasNormalTexture=!1;n.hasScreenSizePerspective=!1;n.hasVertexTangents=!1;n.hasOccludees=!1;n.hasMultipassTerrain=!1;n.hasModelTransformation=!1;n.offsetBackfaces=!1;n.vvSize=!1;n.vvColor=!1;n.receiveShadows=!1;n.receiveAmbientOcclusion=!1;n.textureAlphaPremultiplied=!1;n.instanced=!1;n.instancedColor=!1;n.objectAndLayerIdColorInstanced=
!1;n.instancedDoublePrecision=!1;n.doublePrecisionRequiresObfuscation=!1;n.writeDepth=!0;n.transparent=!1;n.enableOffset=!0;n.cullAboveGround=!1;n.snowCover=!1;n.hasColorTextureTransform=!1;n.hasEmissionTextureTransform=!1;n.hasNormalTextureTransform=!1;n.hasOcclusionTextureTransform=!1;n.hasMetallicRoughnessTextureTransform=!1;return n}b._inherits(z,h);return b._createClass(z)}(e.DefaultTechniqueConfiguration);c.__decorate([d.parameter({count:y.ShaderOutput.COUNT})],e.prototype,"output",void 0);
c.__decorate([d.parameter({count:f.AlphaDiscardMode.COUNT})],e.prototype,"alphaDiscardMode",void 0);c.__decorate([d.parameter({count:q.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",void 0);c.__decorate([d.parameter({count:k.PBRMode.COUNT})],e.prototype,"pbrMode",void 0);c.__decorate([d.parameter({count:f.CullFaceOptions.COUNT})],e.prototype,"cullFace",void 0);c.__decorate([d.parameter({count:g.TransparencyPassType.COUNT})],e.prototype,"transparencyPassType",void 0);c.__decorate([d.parameter({count:p.NormalType.COUNT})],
e.prototype,"normalType",void 0);c.__decorate([d.parameter({count:u.TextureCoordinateAttributeType.COUNT})],e.prototype,"textureCoordinateType",void 0);c.__decorate([d.parameter({count:f.DepthTestFunction.COUNT})],e.prototype,"customDepthTest",void 0);c.__decorate([d.parameter()],e.prototype,"spherical",void 0);c.__decorate([d.parameter()],e.prototype,"hasVertexColors",void 0);c.__decorate([d.parameter()],e.prototype,"hasSymbolColors",void 0);c.__decorate([d.parameter()],e.prototype,"hasVerticalOffset",
void 0);c.__decorate([d.parameter()],e.prototype,"hasSlicePlane",void 0);c.__decorate([d.parameter()],e.prototype,"hasSliceHighlight",void 0);c.__decorate([d.parameter()],e.prototype,"hasColorTexture",void 0);c.__decorate([d.parameter()],e.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([d.parameter()],e.prototype,"hasEmissionTexture",void 0);c.__decorate([d.parameter()],e.prototype,"hasOcclusionTexture",void 0);c.__decorate([d.parameter()],e.prototype,"hasNormalTexture",void 0);c.__decorate([d.parameter()],
e.prototype,"hasScreenSizePerspective",void 0);c.__decorate([d.parameter()],e.prototype,"hasVertexTangents",void 0);c.__decorate([d.parameter()],e.prototype,"hasOccludees",void 0);c.__decorate([d.parameter()],e.prototype,"hasMultipassTerrain",void 0);c.__decorate([d.parameter()],e.prototype,"hasModelTransformation",void 0);c.__decorate([d.parameter()],e.prototype,"offsetBackfaces",void 0);c.__decorate([d.parameter()],e.prototype,"vvSize",void 0);c.__decorate([d.parameter()],e.prototype,"vvColor",
void 0);c.__decorate([d.parameter()],e.prototype,"receiveShadows",void 0);c.__decorate([d.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([d.parameter()],e.prototype,"textureAlphaPremultiplied",void 0);c.__decorate([d.parameter()],e.prototype,"instanced",void 0);c.__decorate([d.parameter()],e.prototype,"instancedColor",void 0);c.__decorate([d.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([d.parameter()],e.prototype,"instancedDoublePrecision",
void 0);c.__decorate([d.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([d.parameter()],e.prototype,"writeDepth",void 0);c.__decorate([d.parameter()],e.prototype,"transparent",void 0);c.__decorate([d.parameter()],e.prototype,"enableOffset",void 0);c.__decorate([d.parameter()],e.prototype,"cullAboveGround",void 0);c.__decorate([d.parameter()],e.prototype,"snowCover",void 0);c.__decorate([d.parameter()],e.prototype,"hasColorTextureTransform",void 0);c.__decorate([d.parameter()],
e.prototype,"hasEmissionTextureTransform",void 0);c.__decorate([d.parameter()],e.prototype,"hasNormalTextureTransform",void 0);c.__decorate([d.parameter()],e.prototype,"hasOcclusionTextureTransform",void 0);c.__decorate([d.parameter()],e.prototype,"hasMetallicRoughnessTextureTransform",void 0);c.__decorate([d.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);c.__decorate([d.parameter({constValue:!1})],e.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([d.parameter({constValue:!1})],
e.prototype,"supportsTextureAtlas",void 0);c.__decorate([d.parameter({constValue:!0})],e.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,c,y,p,u,q,k){q=function(d){function f(){return d.apply(this,arguments)||this}c._inherits(f,d);var g=f.prototype;g.initializeConfiguration=function(e,h){c._get(c._getPrototypeOf(f.prototype),"initializeConfiguration",this).call(this,e,h);h.hasMetallicRoughnessTexture=!1;h.hasEmissionTexture=!1;h.hasOcclusionTexture=!1;h.hasNormalTexture=!1;h.hasModelTransformation=!1;h.normalType=y.NormalType.Attribute;h.doubleSidedMode=p.NormalsDoubleSidedMode.WindingOrder;h.hasVertexTangents=!1};g.initializeProgram=
function(e){return this._initializeProgram(e,f.shader)};return c._createClass(f)}(q.DefaultMaterialTechnique);q.shader=new u.ReloadableShaderModule(k.RealisticTree,()=>new Promise((d,f)=>a(["./RealisticTree.glsl"],d,f)));b.RealisticTreeTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I){function H(N){const R=new G.ShaderBuilder,{vertex:W,fragment:T,varyings:P}=R;C.addProjViewLocalOrigin(W,N);R.include(d.PositionAttribute);P.add("vpos","vec3");R.include(D.VisualVariables,N);R.include(q.InstancedDoublePrecision,N);R.include(h.VerticalOffset,N);if(N.output===y.ShaderOutput.Color||N.output===y.ShaderOutput.Alpha)C.addCameraPosition(R.vertex,N),R.include(k.NormalAttribute,N),R.include(u.Transform,N),N.offsetBackfaces&&
R.include(c.Offset),N.instancedColor&&R.attributes.add(I.VertexAttribute.INSTANCECOLOR,"vec4"),P.add("vNormalWorld","vec3"),P.add("localvpos","vec3"),N.hasMultipassTerrain&&P.add("depth","float"),R.include(g.TextureCoordinateAttribute,N),R.include(b.ForwardLinearDepth,N),R.include(f.SymbolColor,N),R.include(e.VertexColor,N),W.uniforms.add(new F.Float4PassUniform("externalColor",Q=>Q.externalColor)),P.add("vcolorExt","vec4"),W.code.add(K.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${N.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${K.glsl.float(A.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${N.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${N.hasMultipassTerrain?K.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);N.output===y.ShaderOutput.Alpha&&(R.include(p.SliceDraw,N),R.include(v.DiscardOrAdjustAlphaPass,N),R.include(t.multipassTerrainTest,N),T.uniforms.add(new M.FloatPassUniform("opacity",Q=>Q.opacity),new M.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)),N.hasColorTexture&&T.uniforms.add(new L.Texture2DPassUniform("tex",Q=>Q.texture)),T.include(B.MixExternalColor),T.code.add(K.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${N.hasColorTexture?K.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?K.glsl`colorUV`:K.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:K.glsl`vec4 texColor = vec4(1.0);`}
        ${N.hasVertexColors?K.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:K.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));N.output===y.ShaderOutput.Color&&(R.include(p.SliceDraw,N),R.include(l.EvaluateSceneLighting,N),R.include(n.EvaluateAmbientOcclusion,N),R.include(v.DiscardOrAdjustAlphaPass,N),R.include(N.instancedDoublePrecision?x.ReadShadowMapPass:x.ReadShadowMapDraw,N),R.include(t.multipassTerrainTest,N),C.addCameraPosition(R.fragment,N),m.addMainLightDirection(T),l.addAmbientBoostFactor(T),l.addLightingGlobalFactor(T),T.uniforms.add(W.uniforms.get("localOrigin"),W.uniforms.get("view"),new E.Float3PassUniform("ambient",
Q=>Q.ambient),new E.Float3PassUniform("diffuse",Q=>Q.diffuse),new M.FloatPassUniform("opacity",Q=>Q.opacity),new M.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)),N.hasColorTexture&&T.uniforms.add(new L.Texture2DPassUniform("tex",Q=>Q.texture)),R.include(r.PhysicallyBasedRenderingParameters,N),R.include(w.PhysicallyBasedRendering,N),T.include(B.MixExternalColor),m.addMainLightIntensity(T),T.code.add(K.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.hasMultipassTerrain?K.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${N.hasColorTexture?K.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?K.glsl`colorUV`:K.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:K.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${N.pbrMode===r.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${N.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":N.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${N.hasVertexColors?K.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:K.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${N.snowCover?K.glsl`albedo = mix(albedo, vec3(1), 0.9);`:K.glsl``}
        ${K.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${N.pbrMode===r.PBRMode.Normal||N.pbrMode===r.PBRMode.Schematic?N.spherical?K.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:K.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:K.glsl``}
        ${N.pbrMode===r.PBRMode.Normal||N.pbrMode===r.PBRMode.Schematic?K.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${N.snowCover?K.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:K.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${N.transparencyPassType===O.TransparencyPassType.Color?K.glsl`fragColor = premultiplyAlpha(fragColor);`:K.glsl``}
      }
    `));R.include(z.DefaultMaterialAuxiliaryPasses,N);return R}const J=Object.freeze(Object.defineProperty({__proto__:null,build:H},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=J;a.build=H})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T){function P(Z){return null==Z?!1:"cross"===Z||"x"===Z}const Q=e.create(),S=z.fromValues(0,0,1);p=I.DEFAULT_TEX_SIZE;const U=I.DEFAULT_SYMBOL_SIZE_RATIO,V=[U/2,U/2,1-U/2,1-U/2];p=[p*U,p*U];F=function(Z){function ea(ha,ia,oa,ma){ha=Z.call(this,ha,ia,oa,ma)||this;ha._cimLayers=null;ha._cimSymbolMaterials=new Map;ha._cimSymbolTextures=new Map;ha._cimMaterialParametersInfo=null;ha._cimRequiredFields=null;ha._cimScaleFactorOrFunction=
null;ha._size=null;ha._symbolTextureRatio=1;ha._outlineSize=0;ha._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ha}c._inherits(ea,Z);var ja=ea.prototype;ja.getCachedSize=function(){return{size:this._getIconSize()}};ja.doLoad=async function(ha){this._validateOrThrow();const ia=this._prepareMaterialParameters();var oa=this._getPrimitive();if(null!=oa)this._prepareResourcesPrimitive(ia,oa);else{oa=r.getIconHref(this.symbolLayer);const ma=g.dataComponents(oa);ma&&"application/json"===
ma.mediaType?await this._prepareResourcesCIM(ia,JSON.parse(ma.data),ha):await this._prepareResourcesHref(ia,oa,ha)}};ja._validateOrThrow=function(){if(!this._drivenProperties.size){var ha=M.validateSymbolLayerSize(this._getIconSize());if(ha)throw new q("graphics3diconsymbollayer:invalid-size",ha);}};ja._getIconSize=function(){var ha=this.symbolLayer;ha=Math.round(null!=ha.size?f.pt2px(ha.size):16);return this._drivenProperties.size?Math.max(ha,64):ha};ja._generateTextureCIM=function(ha){const ia=
this._getGraphicHash(ha);let oa=""===ia?null:this._cimSymbolTextures.get(ia);oa||(ha=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,ha,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},void 0,void 0),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ha.anchorPosition),oa=new R.Texture(ha.imageData,{width:ha.imageData.width,height:ha.imageData.height}),this._cimSymbolTextures.set(ia,oa),this._context.stage.add(oa));return oa};
ja._prepareMaterialParameters=function(){const ha={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ia=this.symbol;if(ia&&"point-3d"===ia.type&&ia.hasVisibleVerticalOffset()){const {screenLength:oa,minWorldLength:ma,maxWorldLength:fa}=ia.verticalOffset;ha.verticalOffset={screenLength:f.pt2px(oa),minWorldLength:ma||0,maxWorldLength:null!=fa?fa:Infinity}}this._context.screenSizePerspectiveEnabled&&(ha.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
ha.occlusionTest=!0;ha.hasSlicePlane=this._context.slicePlaneEnabled;return ha};ja._prepareResourcesPrimitive=function(ha,ia){var oa=this._getOutlineSize();if(P(ia)&&0===oa)throw Error("Nothing to render");this._outlineSize=oa;ha.color=this._getFillColor();ha.outlineColor=this._getOutlineColor();ha.outlineSize=this._outlineSize;null!=this._context.sharedResources.textures&&(oa=this._context.sharedResources.textures.fromData(`${ia}-icon`,()=>I.createTexture(ia)),this._texture=oa.texture,this._releaseTexture=
oa,ha.textureId=this._texture.id);ha.textureIsSignedDistanceField=!0;ha.distanceFieldBoundingBox=V;oa=this._getIconSize();this._size=[oa,oa];this._symbolTextureRatio=1/U;this._createMaterialAndAddToStage(ha,this._context.stage)};ja._prepareResourcesHref=async function(ha,ia,oa){this._outlineSize=this._getOutlineSize();ha.color=this._getFillColor();ha.outlineColor=this._getOutlineColor();ha.outlineSize=this._outlineSize;ha.textureIsSignedDistanceField=!1;const ma=this._getIconSize(),fa=ma*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;
if(null!=this._context.sharedResources.textures){oa=await u.result(this._context.sharedResources.textures.fromUrl(ia,fa,{signal:oa}));if(!1===oa.ok)throw d.throwIfAbortError(oa.error),new q("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ia})`);this._releaseTexture=oa.value;ia=oa.value.texture;oa=ia.parameters.width/ia.parameters.height;this._size=1<oa?[ma,Math.round(ma/oa)]:[Math.round(ma*oa),ma];ha.textureId=ia.id}this._createMaterialAndAddToStage(ha,
this._context.stage)};ja._prepareResourcesCIM=async function(ha,ia,oa){ia=new T({data:ia});if(!this._context.sharedResources.cimSymbolRasterizer){var ma=(await new Promise((da,ca)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],da,ca))).CIMSymbolRasterizer;d.throwIfAborted(oa);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new ma(this._context.renderCoordsHelper.spatialReference,!0))}ma=this._context.layer.fields?this._context.layer.fields.map(da=>
da.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(ia,ma,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:oa});let fa;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(ia=this._context.renderer,isNaN(ia.scaleExpression)){const da=await t.createRendererExpression(ia.scaleExpression,this._context.layer.spatialReference,
ma);fa=(ca,na,qa)=>{ca=x(da,ca,{$view:qa},"esriGeometryPoint",na);return null!==ca?ca:1}}else var ba=Number(ia.scaleExpression);this._cimScaleFactorOrFunction=ba||fa||1;ba=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];d.throwIfAborted(oa);const aa=this._context.layer.fieldsIndex;this._cimRequiredFields=ba.map(da=>aa.get(da).name);this._cimMaterialParametersInfo=ha;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=
[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1};ja._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||w.defaultPrimitive};ja._getOutlineSize=function(){var ha=0;ha=this.symbolLayer;if(null!=ha.outline&&null!=ha.outline.size)return Math.max(f.pt2px(ha.outline.size),0);ha=this._getPrimitive();ha=P(ha)?1.5:0;return Math.max(ha,
0)};ja._getOutlineColor=function(){const ha=this._getLayerOpacity(),ia=this.symbolLayer?.outline?.color;if(null!=ia){const oa=y.toUnitRGB(ia);return[oa[0],oa[1],oa[2],ia.a*ha]}return[0,0,0,0]};ja._getFillColor=function(){if(P(this._getPrimitive()))return D.TRANSPARENT_UNIT;const ha=null==this._getPrimitive();return this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color,{hasIntrinsicColor:ha})};ja._getAnchorPos=function(ha,ia){return"relative"===ha?h.fromValues((ia.x||0)+.5,-(ia.y||0)+
.5):ha in G.namedAnchorToHUDMaterialAnchorPos?G.namedAnchorToHUDMaterialAnchorPos[ha]:G.namedAnchorToHUDMaterialAnchorPos.center};ja._createMaterialAndAddToStage=function(ha,ia){if(this._cimLayers){this._fastUpdates=null;let oa=ha.textureId?this._cimSymbolMaterials.get(ha.textureId):null;oa||(oa=new W.HUDMaterial(ha),this._cimSymbolMaterials.set(ha.textureId??0,oa),ia.add(oa));return oa}(this._fastUpdates=O.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&
(ha={...ha,...this._fastUpdates.materialParameters});this._material=new W.HUDMaterial(ha);ia.add(this._material);return this._material};ja._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ha=>{ha.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};ja.destroy=function(){c._get(c._getPrototypeOf(ea.prototype),"destroy",this).call(this);this._forEachMaterial(ha=>
this._context.stage.remove(ha));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(ha=>this._context.stage.remove(ha));this._cimSymbolTextures.clear();this._releaseTexture=k.releaseMaybe(this._releaseTexture)};ja._getScaleFactor=function(ha,ia){if(this._drivenProperties.size&&ha.size){for(let oa=0;3>oa;oa++){const ma=ha.size[oa];ma&&"symbol-value"!==ma&&"proportional"!==ma&&(ha.size[oa]=f.pt2px(ma))}if("symbol-value"===ha.size[0])return 1;if(isFinite(+ha.size[0]))return+ha.size[0]/
ia;if(isFinite(+ha.size[2]))return+ha.size[2]/ia}return 1};ja.createGraphics3DGraphic=function(ha){const ia=ha.graphic;if(!this._validateGeometry(ia.geometry))return null;var oa=[0,0];let ma;if(this._cimLayers){if(!this._cimLayers.length)return null;var fa=this._generateTextureCIM(ia);ma=this._createMaterialAndAddToStage({textureId:fa.id,...this._cimMaterialParametersInfo},this._context.stage);oa=[fa.parameters.width,fa.parameters.height]}else oa=this._size,ma=this._material;fa=L.placePointOnGeometry(ia.geometry);
if(null==fa)return this.logger.warn(`unsupported geometry type for icon symbol: ${ia.geometry.type}`),null;var ba=ha.renderingInfo;const aa=this._getVertexOpacityAndColor(ba);let da=1;this._fastUpdates?.visualVariables.size||(da=this._getScaleFactor(ba,oa[0]>oa[1]?oa[0]:oa[1]));da*=this._symbolTextureRatio;oa=h.fromValues(oa[0]*da,oa[1]*da);ba=this.setGraphicElevationContext(ia,new B.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ba.mode)&&this._setDrapingDependentMaterialParameters();
return this.draped?this._createAsOverlay(ia,fa,ma,aa,oa,ha.layer.uid):this._createAs3DShape(ia,fa,ma,aa,oa,ba,ia.uid)};ja.layerOpacityChanged=function(){const ha=this._getFillColor(),ia=this._getOutlineColor();this._forEachMaterial(oa=>{oa.setParameters({color:ha});oa.setParameters({outlineColor:ia})})};ja.layerElevationInfoChanged=function(ha,ia,oa){const ma=this._elevationContext.mode;oa=v.elevationModeChangeUpdateType(ea.elevationModeChangeTypes,oa,ma);if(oa!==v.SymbolUpdateType.UPDATE)return oa;
const fa=v.needsElevationUpdates2D(ma)||"absolute-height"===ma;return this.updateGraphics3DGraphicElevationInfo(ha,ia,()=>fa)};ja.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ha=>{ha.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};ja.physicalBasedRenderingChanged=function(){return!0};ja.applyRendererDiff=function(ha,ia){for(const oa in ha.diff)switch(oa){case "visualVariables":if(O.updateFastSymbolUpdatesState(this._fastUpdates,ia,this._fastVisualVariableConvertOptions()))null!=
this._material&&this._material.setParameters(this._fastUpdates.materialParameters);else return K.ApplyRendererDiffResult.RecreateSymbol;break;default:return K.ApplyRendererDiffResult.RecreateSymbol}return K.ApplyRendererDiffResult.FastUpdate};ja._defaultElevationInfoNoZ=function(){return X};ja._createAs3DShape=function(ha,ia,oa,ma,fa,ba,aa){const da=this.getFastUpdateAttrValues(ha);ha=da&&this._fastUpdates?qa=>O.evaluateModelTransform(this._fastUpdates.materialParameters,da,qa):void 0;const ca=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:aa,
layerUid:this._context.layer.uid});ma=J.createPointGeometry(oa,S,null,ma,fa,Y,null,da,ca);aa=L.createStageObject(this._context,ia,ma,ba,aa,ha);if(null==aa)return null;const na=new E.Graphics3DObject3DGraphicLayer(this,aa.object,[ma],null,null,A.perObjectElevationAligner,ba);na.alignedSampledElevation=aa.sampledElevation;na.needsElevationUpdates=v.needsElevationUpdates2D(ba.mode)||"absolute-height"===ba.mode;na.getScreenSize=this._createScreenSizeGetter(fa,ha);na.calculateRelativeScreenBounds=qa=>
oa.calculateRelativeScreenBounds(na.getScreenSize(),1,qa);L.extendPointGraphicElevationContext(na,ia,this._context.elevationProvider);return na};ja._createAsOverlay=function(ha,ia,oa,ma,fa,ba){oa.renderPriority=this._renderPriority;const aa=n.create();l.projectPointToVector(ia,aa,this._context.overlaySR);aa[2]=H.DRAPED_Z;ia=this._context.clippingExtent;if(null!=ia&&!m.containsPoint(ia,aa))return null;const da=this.getFastUpdateAttrValues(ha);ia=da&&this._fastUpdates?qa=>O.evaluateModelTransform(this._fastUpdates.materialParameters,
da,qa):void 0;const ca=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ha.uid,layerUid:this._context.layer.uid});ma=J.createPointGeometry(oa,S,aa,ma,fa,null,null,da,ca);ha=new N.RenderGeometry(ma,{layerUid:ba,graphicUid:ha.uid,shaderTransformer:ia});const na=new C(this,[ha],null,this._context.drapeSourceRenderer);na.getScreenSize=this._createScreenSizeGetter(fa,ia);na.calculateRelativeScreenBounds=qa=>oa.calculateRelativeScreenBounds(na.getScreenSize(),1,qa);return na};ja._createScreenSizeGetter=
function(ha,ia){const oa=this._outlineSize+2;if(this._fastUpdates&&ia){const ba=ha[0]/this._symbolTextureRatio,aa=ha[1]/this._symbolTextureRatio;return(da=h.create())=>{const ca=ia(Q);da[0]=ca[0]*ba+oa;da[1]=ca[5]*aa+oa;return da}}const ma=ha[0]/this._symbolTextureRatio+oa,fa=ha[1]/this._symbolTextureRatio+oa;return(ba=h.create())=>{ba[0]=ma;ba[1]=fa;return ba}};ja._fastVisualVariableConvertOptions=function(){var ha=Math.max(this._size[0],this._size[1]);const ia=z.fromValues(ha,ha,ha),oa=f.px2pt(1);
ha*=oa;ha=z.fromValues(ha,ha,ha);return new O.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ia,ha,oa)};ja._getGraphicHash=function(ha){let ia="";for(const oa of this._cimRequiredFields)ia+=oa+ha.attributes[oa];return ia};ja._forEachMaterial=function(ha){null!=this._material&&ha(this._material);this._cimSymbolMaterials.forEach(ha)};ja.test=function(){return{...c._get(c._getPrototypeOf(ea.prototype),"test",this).call(this),material:this._material}};c._createClass(ea,[{key:"pixelRatioChanged",
get:function(){return null!=this._getPrimitive()}}]);return ea}(F.Graphics3DSymbolLayer);F.PRIMITIVE_SIZE=p;F.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.UPDATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};const X={mode:"relative-to-ground",offset:0},Y=n.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(B){B=B.symbolLayers;if(!B)return null;let C=null;B.forEach(E=>{"object"===E.type&&E.resource?.href||(C="water"===E.type?E.color:E.material?E.material.color:null)});return C?new c(C):null}function n(B,C){if(null==C||null==B)return B;B=B.toRgba();B[3]*=C;return new c(B)}function l(B,C,E){if(B=B.symbolLayers){var F=M=>{C=C??M??(null!=E?v:null);return n(C,E)};B.forEach(M=>{if("object"!==M.type||!M.resource?.href||C)if("water"===M.type)M.color=F(M.color);
else{const K=F(null!=M.material?M.material.color:null);null==M.material?M.material=new h.Symbol3DMaterial({color:K}):M.material.color=K;null!=E&&"outline"in M&&null!=M.outline&&null!=M.outline.color&&(M.outline.color=n(M.outline.color,E))}})}}async function m(B,C){(B=B.symbolLayers)&&await p.forEach(B,async E=>t(E,C))}async function t(B,C){switch(B.type){case "extrude":B.size="number"===typeof C[2]?C[2]:0;break;case "icon":case "line":case "text":C=w(C);null!=C&&(B.size=C);break;case "path":const E=
x(C,d.ONES,[B.width,void 0,B.height]);B.width=A(C[0],B.width,1,E);B.height=A(C[2],B.height,1,E);break;case "object":await r(B,C)}}function w(B){for(const C of B)if("number"===typeof C)return C;return null}async function r(B,C){const {resourceSize:E,symbolSize:F}=await D(B),M=x(C,E,F);B.width=A(C[0],F[0],E[0],M);B.depth=A(C[1],F[1],E[1],M);B.height=A(C[2],F[2],E[2],M)}function x(B,C,E){for(let F=0;3>F;F++){const M=B[F];switch(M){case "symbol-value":return B=E[F],null!=B?B/C[F]:1;case "proportional":break;
default:if(M&&C[F])return M/C[F]}}return 1}async function D(B){var {computeObjectLayerResourceSize:C}=await new Promise((L,O)=>a(["./symbolLayerUtils"],L,O));C=await C(B,10);const {width:E,height:F,depth:M}=B;B=[E,M,F];let K=1;for(var G=0;3>G;G++){const L=B[G];if(null!=L){K=L/C[G];break}}for(G=0;3>G;G++)null==B[G]&&(B[G]=C[G]*K);return{resourceSize:C,symbolSize:B}}function A(B,C,E,F){switch(B){case "proportional":return E*F;case "symbol-value":return null!=C?C:E;default:return B}}const v=new c("white");
b.applyColorToSymbol=function(B,C,E){if(B&&(C||null!=E))if(C&&(C=new c(C)),y.isSymbol3D(B))l(B,C,E);else if(y.isSymbol2D(B)){if(C=C??B.color)B.color=n(C,E);null!=E&&"outline"in B&&B.outline&&B.outline.color&&(B.outline.color=n(B.outline.color,E))}};b.applyOpacityToColor=n;b.applyRotationToSymbol=function(B,C,E){B&&null!=C&&(y.isSymbol3D(B)?(B=B.symbolLayers)&&B.forEach(F=>{if(F&&"object"===F.type)switch(E){case "tilt":F.tilt=C;break;case "roll":F.roll=C;break;default:F.heading=C}}):!y.isSymbol2D(B)||
"simple-marker"!==B.type&&"picture-marker"!==B.type&&"text"!==B.type||(B.angle=C))};b.applySizesToSymbol=async function(B,C){if(B&&C){if(y.isSymbol3D(B))return m(B,C);if(y.isSymbol2D(B)&&(C=w(C),null!=C))switch(B.type){case "simple-marker":B.size=C;break;case "picture-marker":const E=B.width/B.height;1<E?(B.width=C,B.height=C*E):(B.width=C*E,B.height=C);break;case "simple-line":B.width=C;break;case "text":B.font.size=C}}};b.fetchWebStyleSymbol=async function(B,C){const E=await B.fetchSymbol(C);return E?
E:B.fetchCIMSymbol(C)};b.getCSSFilterFromEffectList=function(B){if(!B)return null;B=B.effects.filter(C=>"bloom"!==C.type).map(C=>C.toJSON());return f.effectFunctionsFromJSON(B)};b.getColorFromSymbol=function(B,C){if(!B)return null;let E=null;y.isSymbol3D(B)?E=z(B):y.isSymbol2D(B)&&(E="cim"===B.type?g.getCIMSymbolColor(B):B.color?new c(B.color):null);return E?n(E,C):null};b.getIconHref=function(B){return q.unwrapOrThrow(B.resource).href};b.getSymbolOutlineSize=function(B){return B?y.isSymbol3D(B)?
(B=(B=B.symbolLayers?.at(-1))&&"outline"in B?B?.outline?.size:void 0,null!=B?B:0):k.px2pt(e.getStroke(B)?.width):0};b.isVolumetricSymbol=function(B){if(null==B||!("symbolLayers"in B)||null==B.symbolLayers)return!1;switch(B.type){case "point-3d":return B.symbolLayers.some(C=>"object"===C.type);case "line-3d":return B.symbolLayers.some(C=>"path"===C.type);case "polygon-3d":return B.symbolLayers.some(C=>"object"===C.type||"extrude"===C.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(B){return null!=
B&&"polygon-3d"===B.type&&B.symbolLayers.some(C=>"extrude"===C.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function y(e){e=c.toCIMSymbolJSON(e);if("CIMTextSymbol"===e?.type)return e.height??0;let h=0;if(e?.symbolLayers)for(const z of e.symbolLayers)c.isCIMMarker(z)&&null!=z.size&&z.size>h?h=z.size:c.isCIMStroke(z)&&null!=z.width&&z.width>h?h=z.width:c.isCIMFill(z);
return h}function p(e,h,z,n){if(e)if("CIMTextSymbol"===e.type)null!=e.height&&(e.height*=h);else{if(z&&e.effects)for(const l of e.effects)k(l,h);if(e.symbolLayers)for(const l of e.symbolLayers)switch(l.type){case "CIMPictureMarker":case "CIMVectorMarker":u(l,h,n);break;case "CIMPictureStroke":case "CIMSolidStroke":!n?.preserveOutlineWidth&&l.width&&(l.width*=h);break;case "CIMPictureFill":l.height&&(l.height*=h);l.offsetX&&(l.offsetX*=h);l.offsetY&&(l.offsetY*=h);break;case "CIMHatchFill":p(l.lineSymbol,
h,!0,{...n,preserveOutlineWidth:!1}),l.offsetX&&(l.offsetX*=h),l.offsetY&&(l.offsetY*=h),l.separation&&(l.separation*=h)}}}function u(e,h,z){if(e&&(e.markerPlacement&&q(e.markerPlacement,h),e.offsetX&&(e.offsetX*=h),e.offsetY&&(e.offsetY*=h),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*h,y:e.anchorPoint.y*h}),e.size=null!=e.size?e.size*h:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const n of e.markerGraphics)e.scaleSymbolsProportionally||p(n.symbol,h,!0,
z)}function q(e,h){c.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=h);switch(e.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":e.customEndingOffset&&(e.customEndingOffset*=h);e.offsetAlongLine&&(e.offsetAlongLine*=h);if(e.placementTemplate&&e.placementTemplate.length){var z=e.placementTemplate.map(n=>n*h);e.placementTemplate=z}break;case "CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset&&(e.maxRandomOffset*=h);e.placementTemplate&&e.placementTemplate.length&&
(z=e.placementTemplate.map(n=>n*h),e.placementTemplate=z);break;case "CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=h);break;case "CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=h);break;case "CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=h);e.endPosition&&(e.endPosition*=h);break;case "CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=h);e.offsetY&&(e.offsetY*=h);break;case "CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=
h),e.offsetY&&(e.offsetY*=h),e.stepX&&(e.stepX*=h),e.stepY&&(e.stepY*=h)}}function k(e,h){switch(e.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":e.width&&(e.width*=h);break;case "CIMGeometricEffectBuffer":e.size&&(e.size*=h);break;case "CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=h);e.endCut&&(e.endCut*=h);e.middleCut&&(e.middleCut*=h);break;case "CIMGeometricEffectDashes":e.customEndingOffset&&(e.customEndingOffset*=h);e.offsetAlongLine&&(e.offsetAlongLine*=h);if(e.dashTemplate&&
e.dashTemplate.length){const z=e.dashTemplate.map(n=>n*h);e.dashTemplate=z}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":e.length&&(e.length*=h);break;case "CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=h);e.offsetY&&(e.offsetY*=h);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=h);break;case "CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=h);break;case "CIMGeometricEffectTaperedPolygon":e.fromWidth&&
(e.fromWidth*=h);e.length&&(e.length*=h);e.toWidth&&(e.toWidth*=h);break;case "CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=h),e.period&&(e.period*=h)}}function d(e,h){if(e){var z="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===e.type;if(z?.symbolLayers)for(const n of z.symbolLayers)if(!(n.colorLocked||e&&(c.isCIMStroke(n)||c.isCIMMarker(n)&&n.markerPlacement&&c.isCIMMarkerStrokePlacement(n.markerPlacement))))switch(n.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":n.tintColor&&
f(h,n.tintColor);break;case "CIMVectorMarker":n.markerGraphics?.forEach(l=>{d(l.symbol,h)});break;case "CIMSolidStroke":case "CIMSolidFill":f(h,n.color);break;case "CIMHatchFill":d(n.lineSymbol,h)}}}function f(e,h){for(const z of e)if(z.join(".")===h.join("."))return;e.push(h)}function g(e,h,z){if(e){var n="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===n?.type;if(n?.symbolLayers)for(const l of n.symbolLayers)if(!l.colorLocked){if(e)if(z){if({layersToColor:n}=z,(c.isCIMStroke(l)||c.isCIMMarker(l)&&
l.markerPlacement&&c.isCIMMarkerStrokePlacement(l.markerPlacement))&&"fill"===n||c.isCIMFill(l)&&"outline"===n)continue}else if(c.isCIMStroke(l)||c.isCIMMarker(l)&&l.markerPlacement&&c.isCIMMarkerStrokePlacement(l.markerPlacement))continue;n=h.toArray();switch(l.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":l.tintColor=n;break;case "CIMVectorMarker":l.markerGraphics?.forEach(m=>{g(m.symbol,h,z)});break;case "CIMSolidStroke":case "CIMSolidFill":l.color=n;break;case "CIMHatchFill":g(l.lineSymbol,
h,z)}}}}a.applyCIMSymbolColor=function(e,h,z){h instanceof b||(h=new b(h));(e=c.toCIMSymbolJSON(e))&&g(e,h,z)};a.applyCIMSymbolRotation=function(e,h,z=!1){e=c.toCIMSymbolJSON(e);z&&0!==h&&(h=360-h);if("CIMTextSymbol"===e?.type)e.angle=h;else if("CIMPointSymbol"===e?.type&&e.symbolLayers){z=h-(e.angle||0);for(const n of e.symbolLayers)if(c.isCIMMarker(n)){let l=n.rotation||0;l=n.rotateClockwise?l-z:l+z;n.rotation=l}e.angle=h}};a.getCIMSymbolColor=function(e){e=c.toCIMSymbolJSON(e);const h=[];d(e,h);
return h.length?new b(c.fromCIMColor(h[0])):null};a.getCIMSymbolRotation=function(e,h=!1){e=c.toCIMSymbolJSON(e);return"CIMTextSymbol"===e?.type||"CIMPointSymbol"===e?.type?(e=e.angle,null!=e&&0!==e&&h?360-e:e??0):0};a.getCIMSymbolSize=y;a.getCIMSymbolType=function(e){e=c.toCIMSymbolJSON(e);if(!e)return null;switch(e.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=u;a.scaleCIMSymbol=p;a.scaleCIMSymbolTo=function(e,h,z){if(e){var n=c.toCIMSymbolJSON(e);e=y(e);if(0===e){if(n)if("CIMTextSymbol"===n.type)n.height=h;else if(n.symbolLayers)for(const l of n.symbolLayers)switch(l.type){case "CIMPictureMarker":case "CIMVectorMarker":l.size=h;break;case "CIMPictureStroke":case "CIMSolidStroke":l.width=h}}else p(n,h/e,!1,z)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(e){return"function"===typeof e}function y(e){let h=e.length;for(;h--;)if(!" /-,\n".includes(e.charAt(h)))return!1;return!0}function p(e,h){const z=[];var n=0;let l=-1;do l=e.indexOf("[",n),l>=n&&(l>n&&(n=e.substr(n,l-n),z.push([n,null,y(n)])),n=l+1,l=e.indexOf("]",n),l>=n&&(l>n&&(n=e.substr(n,l-n),(n=h[n])&&z.push([null,n,!1])),n=l+1));while(-1!==l);n<e.length-1&&(e=e.substr(n),z.push([e,null,y(e)]));return z}
function u(e,h,z){let n="",l=null;for(const m of h){const [t,w,r]=m;if(t)r?l=t:(l&&(n+=l,l=null),n+=t);else if(h=e.attributes[w])l&&(n+=l,l=null),n+=h}return q(n,z)}function q(e,h){"string"!==typeof e&&(e=String(e));switch(h){case "LowerCase":return e.toLowerCase();case "Allcaps":return e.toUpperCase();default:return e}}function k(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function d(e){if(!e)return null;switch(e.type){case "CIMPolygonSymbol":if(e.symbolLayers)for(const h of e.symbolLayers)if(e=
d(h),null!=e)return e;break;case "CIMTextSymbol":return d(e.symbol);case "CIMSolidFill":return e.color}}function f(e){if(e)switch(e.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(e=e.symbolLayers)for(const h of e)if(e=f(h),null!=e)return e;break;case "CIMTextSymbol":return f(e.symbol);case "CIMSolidStroke":return e.color}}function g(e){if(e)switch(e.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(e.symbolLayers)for(const h of e.symbolLayers)if(e=g(h),void 0!==e)return e;break;case "CIMTextSymbol":return g(e.symbol);
case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return e.width}}b.adjustTextCase=q;b.analyzeTextParts=p;b.assignTextValuesFromFeature=u;b.attributesToFields=function(e){return(e?Object.keys(e):[]).map(h=>({name:h,alias:h,type:"string"===typeof e[h]?"esriFieldTypeString":"esriFieldTypeDouble"}))};b.colorToArray=function(e){return[e.r,e.g,e.b,e.a]};b.createLabelOverrideFunction=function(e,h,z){const n=p(h,e);return l=>u(l,n,z)};b.evaluateValueOrFunction=function(e,h,z,n){return c(e)?
e(h,z,n):e};b.fromCIMColor=k;b.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"};b.fromCIMFontStyle=function(e){let h="normal",z="normal";e&&(e=e.toLowerCase(),e.includes("italic")?h="italic":e.includes("oblique")&&(h="oblique"),e.includes("bold")?z="bold":e.includes("light")&&(z="lighter"));return{style:h,weight:z}};b.fromCIMHorizontalAlignment=function(e){switch(e){default:return"left";case "Right":return"right";case "Center":return"center";
case "Justify":return"center"}};b.fromCIMVerticalAlignment=function(e){switch(e){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};b.getFillColor=d;b.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};b.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";
default:return"normal"}};b.getStrokeColor=f;b.getStrokeWidth=g;b.getTintColor=e=>e.tintColor?k(e.tintColor):{r:255,g:255,b:255,a:1};b.getValue=(e,h=0)=>null==e||isNaN(e)?h:e;b.importGeometryEngine=function(){return new Promise((e,h)=>a(["../../geometry/geometryEngineJSON"],e,h))};b.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)};b.isCIMMarker=function(e){return"CIMVectorMarker"===
e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type};b.isCIMMarkerStrokePlacement=function(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===
e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)};b.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type};b.isFeatureValueFn=c;b.isGeometryEngineRequired=e=>{if(!e)return!1;for(const h of e)switch(h.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};b.isSVGImage=e=>e.includes("data:image/svg+xml");b.mapCIMSymbolToGeometryType=function(e){if(!e)return null;
switch(e.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};b.resampleHermite=function(e,h,z,n,l,m,t=!0){const w=h/l;z/=m;const r=Math.ceil(w/2),x=Math.ceil(z/2);for(let v=0;v<m;v++)for(let B=0;B<l;B++){const C=4*(B+(t?m-v-1:v)*l);var D=0;let E=0,F=0,M=0,K=0,G=0,L=0;const O=(v+.5)*z;for(let I=Math.floor(v*z);I<(v+1)*z;I++){var A=Math.abs(O-(I+.5))/x;const H=
(B+.5)*w;A*=A;for(let J=Math.floor(B*w);J<(B+1)*w;J++){let N=Math.abs(H-(J+.5))/r;D=Math.sqrt(A+N*N);-1<=D&&1>=D&&(D=2*D*D*D-3*D*D+1,0<D&&(N=4*(J+I*h),L+=D*e[N+3],F+=D,255>e[N+3]&&(D=D*e[N+3]/250),M+=D*e[N],K+=D*e[N+1],G+=D*e[N+2],E+=D))}}n[C]=M/E;n[C+1]=K/E;n[C+2]=G/E;n[C+3]=L/F}};b.toCIMSymbolJSON=function(e){return e.data?.symbol??null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,b,c,y,p,u,q){function k(g){if(!g)return null;let e=null;switch(g.type){case "simple-fill":case "picture-fill":case "simple-marker":e=k(g.outline);break;case "simple-line":const h=u.pt2px(g.width);null!=g.style&&"none"!==g.style&&0!==h&&(e={color:g.color,style:f(g.style),width:h,cap:g.cap,join:"miter"===g.join?u.pt2px(g.miterLimit):g.join});break;default:e=null}return e}const d=new p.LRUCache(1E3),f=(()=>{const g={};return e=>{if(g[e])return g[e];const h=e.replaceAll("-","");return g[e]=
h}})();c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=f;a.getFill=function(g){const e=g.style;let h=null;if(g)switch(g.type){case "simple-marker":"cross"!==e&&"x"!==e&&(h=g.color);break;case "simple-fill":"solid"===e?h=g.color:"none"!==e&&(h={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case "picture-fill":h={type:"pattern",src:g.url,width:u.pt2px(g.width)*g.xscale,height:u.pt2px(g.height)*g.yscale,x:u.pt2px(g.xoffset),
y:u.pt2px(g.yoffset)};break;case "text":h=g.color;break;case "cim":h=q.getCIMSymbolColor(g)}return h};a.getPatternUrlWithColor=function(g,e){const h=g+"-"+e;return void 0!==d.get(h)?Promise.resolve(d.get(h)):y(g,{responseType:"image"}).then(z=>{z=z.data;const n=z.naturalWidth,l=z.naturalHeight,m=document.createElement("canvas");m.width=n;m.height=l;const t=m.getContext("2d");t.fillStyle=e;t.fillRect(0,0,n,l);t.globalCompositeOperation="destination-in";t.drawImage(z,0,0);z=m.toDataURL();d.put(h,z);
return z})};a.getStroke=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,c){function y(u){const q={};switch(u){case "esriGeometryPoint":return(k,d,f,g)=>c.unquantizePoint(d,q,k,f,g);case "esriGeometryPolygon":return(k,d,f,g)=>c.unquantizePolygon(d,q,k,f,g);case "esriGeometryPolyline":return(k,d,f,g)=>c.unquantizePolyline(d,
q,k,f,g);case "esriGeometryMultipoint":return(k,d,f,g)=>c.unquantizeMultipoint(d,q,k,f,g);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${u}`)),k=>k}}const p=new Map;return function(u,q,k,d,f){if(null==u)return null;if(u.referencesGeometry()&&f){const {transform:g,hasZ:e,hasM:h}=f;p.has(d)||p.set(d,y(d));d=p.get(d)(q.geometry,g,e,h);q={...q,geometry:d}}q=u.repurposeFeature(q);try{return u.evaluate({...k,$feature:q},
u.services)}catch(g){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",g),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){b=b.ZEROS;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,c,y,p,u,q,k){let d=function(){function h(n,l,m,t){this.graphics3DSymbolLayer=n;this.renderGeometries=l;this.boundingBox=m;this._drapeSourceRenderer=t;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var z=h.prototype;z.initialize=function(n){this.stage=n.stage};z.setVisibility=function(n){if(null!=this.stage&&this._visible!==n)if((this._visible=n)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,
k.DirtyOperation.ADD);else if(n||this._addedToStage){for(const l of this.renderGeometries)l.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.DirtyState.VISIBILITY)}};z.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,k.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};z.getCenterObjectSpace=function(n=c.create()){return b.set(n,0,0,0)};z.getBoundingBoxObjectSpace=function(n=
y.create()){return y.empty(n)};z.addObjectState=function(n,l){n===q.Object3DState.Highlight&&(this.renderGeometries.forEach(m=>{const t=m.geometry.addHighlight();l.addRenderGeometry(m,t,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.DirtyState.HIGHLIGHT))};z.removeObjectState=function(n){this.renderGeometries.forEach(l=>{n.removeRenderGeometry(l)})};z.removeRenderGeometryObjectState=function(n,l){n.geometry.removeHighlight(l);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,
k.DirtyState.HIGHLIGHT)};z.computeAttachmentOrigin=function(n){for(const l of this.renderGeometries)l.geometry.computeAttachmentOrigin(e)&&(n.draped.origin[0]+=e[0],n.draped.origin[1]+=e[1],n.draped.num++)};z.getProjectedBoundingBox=async function(n,l,m,t,w){y.empty(w);for(let r=0;r<this.renderGeometries.length;r++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[r],n,f,m),y.expandWithRect(w,f);if(l){y.center(w,e);let r;n=u.demResolutionForBoundingBox(w,l.service.spatialReference,
l);try{r=await l.service.queryElevation(e[0],e[1],t,n,"ground")}catch(x){}null!=r&&(w[2]=Math.min(w[2],r),w[5]=Math.max(w[5],r))}return w};z._getRenderGeometryProjectedBoundingRect=function(n,l,m,t){if(this.boundingBox)y.set(g,this.boundingBox);else{n=n.boundingSphere;const w=n[3];g[0]=n[0]-w;g[1]=n[1]-w;g[2]=n[2]-w;g[3]=n[0]+w;g[4]=n[1]+w;g[5]=n[2]+w}l(g,0,2);this.calculateRelativeScreenBounds&&t.push({location:y.center(g),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return y.toRect(g,
m)};return a._createClass(h)}();const f=p.create(),g=y.create(),e=c.create();return d})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,c){const y=Object.freeze({left:0,center:.5,right:1});b=Object.freeze({"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,
1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)});a.anchorFromPlacements=function(p,u){switch(u){case "bottom":return"left"===p?"bottom-left":"right"===p?"bottom-right":"bottom";case "center":return p;case "top":return"left"===p?"top-left":"right"===p?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(p){switch(p){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};
a.horizontalPlacementToAnchorX=y;a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(p){switch(p){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(p){return"middle"===p?"center":p};a.verticalPlacementFromAnchor=function(p){switch(p){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../support/debugFlags"],function(a,b,c,y){function p(h,z,n){h.canvas||(h.canvas=document.createElement("canvas"));h.canvas.width=z;h.canvas.height=n;return h.canvas}let u=function(){function h(n,l,m,t=2048){this.text=n;this._alignment=
l;this._parameters=m;this._maxSize=t;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${n}`;this._lines=n.split(/\r?\n/)}var z=h.prototype;z._getLineXOffset=function(n){switch(this._alignment){case a.TextRenderAlignment.Left:return this._backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[n])/2;case a.TextRenderAlignment.Right:return this.displayWidth-
this._backgroundHorizontalPadding-this._lineWidths[n]}};z.render=function(n,l=0,m=0){n.save();l/=this.renderPixelRatio;m/=this.renderPixelRatio;const t=l,w=m;var r=this._haloSize,x=this._firstLineYOffset;l+=r;m+=x+this._baselinePosition;const D=0<this._haloSize;D&&this._renderHalo(n,t,w,r,x);this._setFontProperties(n,this._renderedFontSize);for(r=0;r<this._lines.length;++r){const A=this._lines[r],v=this._getLineXOffset(r);D&&(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",
this._fillText(n,A,l+v,m),this._renderLineDecoration(n,l+v,m,this._textWidths[r]));n.globalCompositeOperation="source-over";n.fillStyle=this._parameters.textStyle;this._fillText(n,A,l+this._getLineXOffset(r),m);this._renderLineDecoration(n,l+v,m,this._textWidths[r]);m+=this._lineSpacing}if(y.TEXT_SHOW_BASELINE)for(n.strokeStyle="rgb(255, 0, 255, 0.5)",n.setLineDash([2,2]),n.lineWidth=1,l=w+x,m=0;m<this._lines.length;++m)x=l+this._baselinePosition,this._drawLine(n,[t,x],[t+this.displayWidth,x]),l+=
this._lineSpacing;y.TEXT_SHOW_BORDER&&(n.strokeStyle="rgb(255, 0, 255, 0.5)",n.setLineDash([]),n.lineWidth=1,this._drawBox(n,[t,w],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(n,t,w,this._parameters.definition.background.borderRadius*this.renderPixelRatio),n.globalCompositeOperation="destination-over",n.fillStyle=this._parameters.backgroundStyle,n.fill());n.restore()};z._renderLineDecoration=function(n,l,m,t,w=!1){if("none"!==this._parameters.definition.font.decoration&&
0!==t){var r=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":m+=2*r;break;case "line-through":m-=.33*this._baselinePosition}var x=w?this._haloSize:0;n.strokeStyle=w?this._parameters.haloStyle:this._parameters.textStyle;n.lineWidth=this._toRenderUnit(r+2*x);n.beginPath();n.moveTo(this._toRenderUnit(l-x),this._toRenderUnit(m));n.lineTo(this._toRenderUnit(l+t+x),this._toRenderUnit(m));n.stroke()}};z._roundedRect=function(n,l,m,t){l=
this._toRenderUnit(l);m=this._toRenderUnit(m);const w=this.renderedWidth,r=this.renderedHeight;0===t?n.rect(l,m,w,r):(t=c.clamp(t,0,Math.floor(r/2)),n.beginPath(),n.moveTo(l,m+t),n.arcTo(l,m,l+t,m,t),n.lineTo(l+w-t,m),n.arcTo(l+w,m,l+w,m+t,t),n.lineTo(l+w,m+r-t),n.arcTo(l+w,m+r,l+w-t,m+r,t),n.lineTo(l+t,m+r),n.arcTo(l,m+r,l,m+r-t,t),n.closePath())};z._renderHalo=function(n,l,m,t,w){const r=this.renderedWidth,x=this.renderedHeight,D=p(k,Math.max(r,512),Math.max(x,512)),A=D.getContext("2d");A.clearRect(0,
0,r,x);this._setFontProperties(A,this._renderedFontSize);A.fillStyle=this._parameters.haloStyle;A.strokeStyle=this._parameters.haloStyle;var v=3>this._renderedHaloSize;A.lineJoin=v?"miter":"round";v?this._renderHaloEmulated(A,t,w):this._renderHaloNative(A,t,w);w+=this._baselinePosition;for(v=0;v<this._lines.length;++v){const B=this._getLineXOffset(v);this._renderLineDecoration(A,t+B,w,this._textWidths[v],!0);w+=this._lineSpacing}n.globalAlpha=this._parameters.definition.halo.color[3];n.drawImage(D,
0,0,r,x,this._toRenderUnit(l),this._toRenderUnit(m),r,x);n.globalAlpha=1};z._renderHaloEmulated=function(n,l,m){m+=this._baselinePosition;for(let t=0;t<this._lines.length;++t){const w=this._lines[t],r=this._getLineXOffset(t);for(const [x,D]of q)this._fillText(n,w,l+r+this._haloSize*x,m+this._haloSize*D);m+=this._lineSpacing}};z._renderHaloNative=function(n,l,m){const t=2*this._haloSize;m+=this._baselinePosition;for(let w=0;w<this._lines.length;++w){const r=this._lines[w],x=this._getLineXOffset(w);
for(let D=0;5>D;D++)n.lineWidth=this._toRenderUnit((.6+.1*D)*t),this._strokeText(n,r,l+x,m);m+=this._lineSpacing}};z._setFontProperties=function(n,l){n.font=this._parameters.fontString(l);n.textAlign="left";n.textBaseline="alphabetic"};z._toRenderUnit=function(n){return n*this.renderPixelRatio};z._toRoundedRenderUnit=function(n){return Math.round(n*this.renderPixelRatio)};z._fillText=function(n,l,m,t){n.fillText(l,this._toRenderUnit(m),this._toRenderUnit(t))};z._strokeText=function(n,l,m,t){n.strokeText(l,
this._toRenderUnit(m),this._toRenderUnit(t))};z._drawLine=function(n,l,m){n.beginPath();n.moveTo(this._toRoundedRenderUnit(l[0])+.5,this._toRoundedRenderUnit(l[1])+.5);n.lineTo(this._toRoundedRenderUnit(m[0])+.5,this._toRoundedRenderUnit(m[1])+.5);n.stroke()};z._drawBox=function(n,l,m){var t=this._toRenderUnit(l[0]);l=this._toRenderUnit(l[1]);var w=this._toRenderUnit(m[0]);const r=this._toRenderUnit(m[1]);m=Math.floor(t)+.5;t=Math.ceil(t+w)-.5;w=Math.floor(l)+.5;l=Math.ceil(l+r)-.5;n.beginPath();
n.moveTo(m,w);n.lineTo(t,w);n.lineTo(t,l);n.lineTo(m,l);n.lineTo(m,w);n.stroke()};b._createClass(h,[{key:"displayWidth",get:function(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this._lineSpacing*(this._lines.length-1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",
get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},{key:"_metrics",get:function(){if(null==this._metricsCached){const m=p(k,512,512).getContext("2d");this._setFontProperties(m,this._fontSize);let t=2*this._haloSize;var n=this._parameters.definition.font;if("italic"===
n.style||"oblique"===n.style||"bold"===n.weight||"bolder"===n.weight)t+=.3*m.measureText("A").width;this._textWidths.length=0;let w=this._lineWidths.length=0,r,x,D=0,A=0;this._lines.forEach((v,B)=>{v=m.measureText(v);const C=v.width,E=C+t;this._textWidths.push(C);this._lineWidths.push(E);w=Math.max(w,E);D=Math.max(D,v.actualBoundingBoxAscent);A=Math.max(A,v.actualBoundingBoxDescent);0===B&&(r=v);B===this._lines.length-1&&(x=v)});n=m.font;var l=e.get(n);l||(l=m.measureText(d),l=new g(l.actualBoundingBoxAscent,
l.actualBoundingBoxDescent),e.set(n,l));D=Math.max(D,l.actualBoundingBoxAscent);A=Math.max(A,l.actualBoundingBoxDescent);this._metricsCached=new f(D-(this._hasBackground?r.actualBoundingBoxAscent:D),A-(this._hasBackground?x.actualBoundingBoxDescent:A),D+A,w,D)}return this._metricsCached}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",get:function(){return this._metrics.lineHeight}},{key:"_linePadding",
get:function(){return.2*this._lineHeight}},{key:"_baselinePosition",get:function(){return this._metrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},
{key:"renderPixelRatio",get:function(){if(null==this._renderPixelRatio){const n=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this._maxSize?Math.min(n,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):n}return this._renderPixelRatio}},{key:"_displayWidth",get:function(){return this._metrics.displayWidth}}]);return h}();const q=[];for(let h=0;360>h;h+=22.5)q.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);a.TextRenderAlignment=void 0;(function(h){h[h.Left=
0]="Left";h[h.Center=1]="Center";h[h.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const k={canvas:null},d=(()=>{let h="";for(let z=32;127>z;z++)h+=String.fromCharCode(z);return h})();let f=b._createClass(function(h,z,n,l,m){this.paddingTop=h;this.paddingBottom=z;this.lineHeight=n;this.displayWidth=l;this.baselinePosition=m}),g=b._createClass(function(h,z){this.actualBoundingBoxAscent=h;this.actualBoundingBoxDescent=z});const e=new Map;a.TextRenderer=u;a.getTextHelperCanvas=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,c,y,p,u,q,k){let d=function(){function g(h,z={}){this.geometry=h;this.screenToWorldRatio=1;this._transformation=p.create();this._boundingSphere=
this._shaderTransformation=null;this.id=c.generateUID();this.layerUid=z.layerUid;this.graphicUid=z.graphicUid;this.shaderTransformer=z.shaderTransformer;this.castShadow=z.castShadow??!1}var e=g.prototype;e.updateTransformation=function(h){h(this._transformation);this._shaderTransformation=this._boundingSphere=null};e.shaderTransformationChanged=function(){this._shaderTransformation=null};b._createClass(g,[{key:"transformation",get:function(){return this._transformation}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},
{key:"boundingSphere",get:function(){if(this._boundingSphere)return this._boundingSphere;if(!this.boundingInfo)return q.NullSphere;this._boundingSphere=u.transformMat4(q.create(),this.boundingInfo.center,this.shaderTransformation);this._boundingSphere[3]=this.boundingInfo.radius*k.maxScale(this.shaderTransformation);return this._boundingSphere}},{key:"hasShaderTransformation",get:function(){return null!=this.shaderTransformer}},{key:"material",get:function(){return this.geometry.material}},{key:"type",
get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){if(null==this.shaderTransformer)return this.transformation;this._shaderTransformation||(this._shaderTransformation=y.copy(p.create(),this.shaderTransformer(this.transformation)));return this._shaderTransformation}},{key:"indices",get:function(){return this.geometry.indices}},{key:"vertexAttributes",get:function(){return this.geometry.vertexAttributes}},{key:"highlights",get:function(){return this.geometry.highlights}},
{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(h){this.geometry.visible=h}}]);return g}(),f=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(d);a.RenderGeometry=d;a.ValidatedRenderGeometry=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/screenUtils ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E){const F=["polyline","polygon","extent"],M=new m.ConvertOptions({size:!0,color:!0,rotation:!1,opacity:!0});c=function(G){function L(I,H,J,N){return G.call(this,I,H,J,N)||this}b._inherits(L,G);var O=L.prototype;O.doLoad=async function(){this._fastUpdates=m.initFastSymbolUpdatesState(this._context.renderer,M);if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:p.px2pt(1)))throw new y("graphics3dlinesymbollayer:invalid-size",
"Symbol sizes may not be negative values");};O._getMaterialParameters=function(I,H=!1){const J=this._getCombinedOpacityAndColor(H&&this._markerColor||this._materialColor);this._patternHidesLine&&!H&&(J[3]=0);I={width:this._computeMaterialWidth(this.symbolLayer?.size),color:J,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:l.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:I,stipplePattern:v.getStipplePatternForLinePattern(this.symbolLayer.pattern),
stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...I,...this._fastUpdates.materialParameters}:I};O.destroy=function(){b._get(b._getPrototypeOf(L.prototype),"destroy",this).call(this);this._forEachMaterial(I=>this._context.stage.remove(I));this._markerMaterialCached=this._wireframeRingMaterialCached=this._wireframeLineMaterialCached=this._ringMaterialCached=this._lineMaterialCached=null};O._getDrivenSize=function(I){return this._drivenProperties.size&&I.size?p.pt2px(k.getDriverAxisSizeValueAny(I.size)):
1};O._getDrivenColor=function(I){const H=u.fromValues(1,1,1,1);this._drivenProperties.color&&I.color&&(H[0]=I.color[0],H[1]=I.color[1],H[2]=I.color[2],0<I.color.length&&(H[3]=I.color[3]));this._drivenProperties.opacity&&I.opacity&&(H[3]=I.opacity);return H};O.createGraphics3DGraphic=function(I){const H=I.graphic;if(!this._validateGeometry(H.geometry,F,this.symbolLayer.type))return null;const J=this.setGraphicElevationContext(H,new g.ElevationContext);this.ensureDrapedStatus("on-the-ground"===J.mode);
return this.draped?this._createAsOverlay(I,this._context.layer.uid):this._createAs3DShape(I,J,H.uid)};O.applyRendererDiff=function(I,H){for(const J in I.diff)switch(J){case "visualVariables":const N=this._fastUpdates;if(m.updateFastSymbolUpdatesState(N,H,M))this._forEachMaterial(R=>R.setParameters(N.materialParameters));else return n.ApplyRendererDiffResult.RecreateSymbol;break;default:return n.ApplyRendererDiffResult.RecreateSymbol}return n.ApplyRendererDiffResult.FastUpdate};O.prepareSymbolLayerPatch=
function(I){if("partial"===I.diff.type){var H=I.diff.diff,J={};"complete"===H.size?.type&&(J.width=this._computeMaterialWidth(H.size.newValue),delete H.size);"complete"===H.cap?.type&&(J.cap=l.parseCapType(H.cap.newValue??"butt"),delete H.cap);var N=this._prepareMarkerPatch(I,H);this._prepareMaterialPatch(I,H,N);I.symbolLayerStatePatches.push(()=>this._forEachMaterial(R=>R.setParameters(J)))}};O.layerOpacityChanged=function(){this._forEachMaterial((I,H)=>this._updateMaterialLayerOpacity(I,H))};O._forEachMaterial=
function(I){null!=this._lineMaterialCached&&I(this._lineMaterialCached);null!=this._ringMaterialCached&&I(this._ringMaterialCached);null!=this._wireframeLineMaterialCached&&I(this._wireframeLineMaterialCached);null!=this._wireframeRingMaterialCached&&I(this._wireframeRingMaterialCached);null!=this._markerMaterialCached&&I(this._markerMaterialCached,!0)};O._updateMaterialLayerOpacity=function(I,H=!1){var J=I.parameters.color;const N=this.symbolLayer?.material?.color;H=this._patternHidesLine&&!H?0:
this._getCombinedOpacity(N);J=u.fromValues(J[0],J[1],J[2],H);I.setParameters({color:J})};O.layerElevationInfoChanged=function(I,H,J){const N=this._elevationContext.mode;J=f.elevationModeChangeUpdateType(L.elevationModeChangeTypes,J,N);if(J!==f.SymbolUpdateType.UPDATE)return J;const R=f.needsElevationUpdates2D(N);return this.updateGraphics3DGraphicElevationInfo(I,H,()=>R)};O.slicePlaneEnabledChanged=function(){const I={hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(H=>H.setParameters(I));
return!0};O.physicalBasedRenderingChanged=function(){return!0};O._getGeometryAsPolygonOrPolyline=function(I){switch(I.type){case "extent":if(I instanceof C)return E.fromExtent(I);break;case "polygon":case "polyline":return I}return null};O._createAs3DShape=function(I,H,J){const N=this._getGeometryAsPolygonOrPolyline(I.graphic.geometry);var R="polygon"===N.type?N.rings:N.paths,W=[];const T=q.create(),P=r.geometryToRenderInfo(N,this._context.elevationProvider,this._context.renderCoordsHelper,H);this._logGeometryCreationWarnings(P,
R,"polygon"===N.type?"rings":"paths","LineSymbol3DLayer");for(R=0;R<P.lines.length;R++){var Q=P.lines[R],S=Q.position;Q=Q.mapPositions;if(null!=this._context.clippingExtent&&(q.empty(T),q.expandWithBuffer(T,Q),!q.intersectsClippingArea(T,this._context.clippingExtent)))continue;S=this._createGeometry("polygon"===N.type?this._ringMaterial:this._lineMaterial,I,S,Q,N.type,K.ELEVATED,J);W.push(S);t.LINE_WIREFRAMES&&W.push(S.instantiate({material:"polygon"===N.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));
null!=this._markerMaterial&&W.push(S.instantiate({material:this._markerMaterial}))}if(0===W.length)return null;I=new x.Object3D({geometries:W,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:J});W=new h.Graphics3DObject3DGraphicLayer(this,I,W,null,null,d.sharedGeometryElevationAligner,H);W.alignedSampledElevation=P.sampledElevation;W.needsElevationUpdates=f.needsElevationUpdates2D(H.mode);return W};O._createGeometry=function(I,H,J,N,R,W,T){W=W===K.DRAPED?{spatialReference:this._context.overlaySR,
renderCoordsHelper:this._context.renderCoordsHelper}:null;R="polygon"===R;const P=this._fastUpdates?.visualVariables.color,Q=this._fastUpdates?.visualVariables.size,S=this._fastUpdates?.visualVariables.opacity;T=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:T,layerUid:this._context.layer.uid});H={position:J,size:Q?null:this._getDrivenSize(H.renderingInfo),color:P?null:this._getDrivenColor(H.renderingInfo),sizeFeature:Q?m.getAttributeValue(Q.field,H.graphic):null,colorFeature:P?
m.getAttributeValue(P.field,H.graphic):null,opacityFeature:S?m.getAttributeValue(S.field,H.graphic):null};return w.createGeometry(I,{overlayInfo:W,removeDuplicateStartEnd:R,mapPositions:N,attributeData:H},T)};O._createAsOverlay=function(I,H){const J=I.graphic,N=this._getGeometryAsPolygonOrPolyline(J.geometry);var R="polygon"===N.type?N.rings:N.paths;const W="polygon"===N.type?this._ringMaterial:this._lineMaterial;W.renderPriority=this._renderPriority;const T=t.LINE_WIREFRAMES?"polygon"===N.type?this._wireframeRingMaterial:
this._wireframeLineMaterial:null,P=this._markerMaterial;null!=T&&(T.renderPriority=this._renderPriority-.001);null!=P&&(P.renderPriority=this._renderPriority-.002);const Q=[],S=q.create(),U=q.empty();var V=r.geometryToRenderInfoDraped(N,this._context.overlaySR);this._logGeometryCreationWarnings(V,R,"polygon"===N.type?"rings":"paths","LineSymbol3DLayer");for(const X of V.lines)q.empty(S),q.expandWithBuffer(S,X.position),q.intersectsClippingArea(S,this._context.clippingExtent)&&(q.expandWithAABB(U,
S),R=Y=>{Y=this._createGeometry(Y,I,X.position,void 0,N.type,K.DRAPED,J.uid);Y=new D.RenderGeometry(Y,{layerUid:H,graphicUid:J.uid});Q.push(Y)},null!=P&&(R(P),V=this.symbolLayer.marker.placement,"begin"!==V&&"begin-end"!==V||q.expandWithBuffer(S,X.position,0,1),"end"!==V&&"begin-end"!==V||q.expandWithBuffer(S,X.position,X.position.length-3,1)),R(W),t.LINE_WIREFRAMES&&R(T));return new e(this,Q,U,this._context.drapeSourceRenderer)};O._computeMaterialWidth=function(I){I=I??p.px2pt(1);return this._drivenProperties.size?
this._fastUpdates?.visualVariables.size?p.pt2px(1):1:p.pt2px(I)};O._prepareMaterialPatch=function(I,H,J){var N=H.material;null==N?J.changed&&J.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,I):"collection"!==N.type&&(N=this._getCombinedOpacityAndColor("complete"===N.type?N.newValue?.color:"complete"===N.diff.color?.type?N.diff.color.newValue:null),J.useMaterialColor&&this._patchMaterialColor(u.clone(N),this._markerMaterialCached,
I),this._patternHidesLine&&(N[3]=0),this._patchMaterialColor(N,this._lineMaterialCached,I),delete H.material)};O._prepareMarkerPatch=function(I,H){const J=H.marker,N=this._markerMaterial;if(null==J||"partial"!==J.type||null==J.diff||null!=J.diff.placement||null!=J.diff.style&&"complete"!==J.diff.style.type||null!=J.diff.color&&"complete"!==J.diff.color.type||null==N)return{changed:!1,useMaterialColor:null==this._markerColor};var R=J.diff.color;const W=null!=R;R=W?R.newValue:null;const T=null==R&&
null==this._markerColor;R&&this._patchMaterialColor(this._getCombinedOpacityAndColor(R),N,I);const P=J.diff.style?.newValue;P&&I.symbolLayerStatePatches.push(()=>N.setParameters({markerPrimitive:l.parseLineMarkerStyle(P)}));delete H.marker;return{changed:W,useMaterialColor:T}};O._patchMaterialColor=function(I,H,J){null!=H&&J.symbolLayerStatePatches.push(()=>H.setParameters({color:I}))};b._createClass(L,[{key:"_materialColor",get:function(){return this.symbolLayer.material?.color}},{key:"_markerColor",
get:function(){return this.symbolLayer.marker?.color}},{key:"_lineMaterial",get:function(){null==this._lineMaterialCached&&(this._lineMaterialCached=new B.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached));return this._lineMaterialCached}},{key:"_ringMaterial",get:function(){null==this._ringMaterialCached&&(this._ringMaterialCached=new B.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached));return this._ringMaterialCached}},
{key:"_wireframeLineMaterial",get:function(){null==this._wireframeLineMaterialCached&&(this._wireframeLineMaterialCached=new B.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached));return this._wireframeLineMaterialCached}},{key:"_wireframeRingMaterial",get:function(){null==this._wireframeRingMaterialCached&&(this._wireframeRingMaterialCached=new B.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached));
return this._wireframeRingMaterialCached}},{key:"_markerMaterial",get:function(){null==this._markerMaterialCached&&null!=this.symbolLayer.marker&&(this._markerMaterialCached=new A.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:l.parseLineMarkerStyle(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached));return this._markerMaterialCached}},{key:"_patternHidesLine",get:function(){const I=this.symbolLayer.pattern;
return null!=I&&"style"===I.type&&"none"===I.style}}]);return L}(z.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.RECREATE,staysOnTheGround:f.SymbolUpdateType.NONE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};var K;(function(G){G[G.DRAPED=0]="DRAPED";G[G.ELEVATED=1]="ELEVATED"})(K||(K={}));a.Graphics3DLineSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has",
"../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,c){a.parseCapType=function(y){switch(y){case "butt":return c.CapType.BUTT;case "square":return c.CapType.SQUARE;case "round":return c.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(y){return"diamond"===y?"kite":y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l=y.create(),m=y.create();a.createGeometry=function(t,w,r=null){const x=[],D=[],A=w.mapPositions,{attributeData:{position:v},removeDuplicateStartEnd:B}=w;var C=v.length;C=v[0]===v[C-3]&&v[1]===v[C-2]&&v[2]===v[C-1]&&B;var E=v.length/3-(C?1:0),F=Array(2*(E-1)),M=C?v.slice(0,v.length-3):v,K=0;for(var G=0;G<E-1;G++)F[K++]=G,F[K++]=G+1;D.push([n.VertexAttribute.POSITION,new e.Attribute(M,3,C)]);x.push([n.VertexAttribute.POSITION,F]);E=D[0][1].data;C=f.getZeroIndexArray(x[0][1].length);
null==w.attributeData.colorFeature&&(D.push([n.VertexAttribute.COLOR,new e.Attribute(w.attributeData.color??p.ONES,4)]),x.push([n.VertexAttribute.COLOR,C]));null==w.attributeData.sizeFeature&&(D.push([n.VertexAttribute.SIZE,new e.Attribute([w.attributeData.size??1],1,!0)]),x.push([n.VertexAttribute.SIZE,C]));null!=w.attributeData.normal&&(D.push([n.VertexAttribute.NORMAL,new e.Attribute(w.attributeData.normal,3)]),x.push([n.VertexAttribute.NORMAL,C]));null!=w.attributeData.colorFeature&&(D.push([n.VertexAttribute.COLORFEATUREATTRIBUTE,
new e.Attribute([w.attributeData.colorFeature],1,!0)]),x.push([n.VertexAttribute.COLOR,C]));null!=w.attributeData.sizeFeature&&(D.push([n.VertexAttribute.SIZEFEATUREATTRIBUTE,new e.Attribute([w.attributeData.sizeFeature],1,!0)]),x.push([n.VertexAttribute.SIZEFEATUREATTRIBUTE,C]));F=w.attributeData.opacityFeature;null!=F&&(D.push([n.VertexAttribute.OPACITYFEATUREATTRIBUTE,new e.Attribute([F],1,!0)]),x.push([n.VertexAttribute.OPACITYFEATUREATTRIBUTE,C]));if(null!=w.overlayInfo&&w.overlayInfo.renderCoordsHelper.viewingMode===
g.ViewingMode.Global&&w.overlayInfo.spatialReference.isGeographic){C=k.newDoubleArray(E.length);w=u.getReferenceEllipsoid(w.overlayInfo.spatialReference);for(F=0;F<C.length;F+=3)q.lonLatToWebMercatorComparable(E,F,C,F,w);w=E.length/3;E=d.newFloatArray(w+1);F=l;M=m;G=K=0;c.set(F,C[G++],C[G++],C[G++]);E[0]=0;for(let L=1;L<w+1;++L)L===w&&(G=0),c.set(M,C[G++],C[G++],C[G++]),K+=b.dist(F,M),E[L]=K,[F,M]=[M,F];D.push([n.VertexAttribute.DISTANCETOSTART,new e.Attribute(E,1,!0)]);x.push([n.VertexAttribute.DISTANCETOSTART,
x[0][1]])}return new z.Geometry(t,D,x,A,h.ContentObjectType.Line,r)};a.lineStripsToParameters=function(t,w){if(null==t||0===t.length)return[];const r=[];t.forEach(x=>{const D=k.newDoubleArray(3*x.length);x.forEach((A,v)=>{D[3*v]=A[0];D[3*v+1]=A[1];D[3*v+2]=A[2]});r.push({attributeData:{position:D,normal:w},removeDuplicateStartEnd:!1})});return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(a,b,c,y,p,u){function q(k,d,f=null){const g=[];for(const {index:e,count:h}of k){if(1>=h)continue;k=3*e;const z=3*h;g.push({position:c.doubleSubArray(d,3*e,3*h),mapPositions:null!=f?c.doubleSubArray(f,k,z):void 0})}return g}a.geometryToRenderInfo=function(k,d,f,g){const {position:e,outlines:h}=y.pathsToTriangulationInfo("polygon"===k.type?k.rings:k.paths,!!k.hasZ,"polygon"===k.type?y.CounterClockwiseMode.CCW_IS_HOLE:y.CounterClockwiseMode.NONE),z=c.newDoubleArray(e.length);k=p.applyPerVertexElevationAlignment(e,
k.spatialReference,0,z,0,e,0,e.length/3,d,f,g);d=null!=k;return{lines:d?q(h,e,z):[],projectionSuccess:d,sampledElevation:k}};a.geometryToRenderInfoDraped=function(k,d){const {position:f,outlines:g}=y.pathsToTriangulationInfo("polygon"===k.type?k.rings:k.paths,!1,"polygon"===k.type?y.CounterClockwiseMode.CCW_IS_HOLE:y.CounterClockwiseMode.NONE);k=b.projectBuffer(f,k.spatialReference,0,f,d,0,f.length/3);for(d=2;d<f.length;d+=3)f[d]=u.DRAPED_Z;return{lines:k?q(g,f):[],projectionSuccess:k}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(x){function D(v){v=x.call(this,v,new m)||this;v._vertexAttributeLocations=e.vertexAttributeLocations;v._configuration=new h.LineMarkerTechniqueConfiguration;v._layout=v.createLayout();return v}b._inherits(D,x);var A=D.prototype;A.dispose=function(){};A.getConfiguration=function(v,B){this._configuration.output=v;this._configuration.space=B.slot===d.RenderSlot.DRAPED_MATERIAL?h.LineMarkerSpace.Draped:this.parameters.worldSpace?h.LineMarkerSpace.World:
h.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==z.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;
this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=B.transparencyPassType;this._configuration.hasMultipassTerrain=B.multipassTerrain.enabled;this._configuration.cullAboveGround=B.multipassTerrain.cullAboveGround;return this._configuration};A.intersect=function(){};A.createLayout=function(){const v=
p.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0).vec3f(f.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&v.vec3f(f.VertexAttribute.NORMAL);this.parameters.vvSize?v.f32(f.VertexAttribute.SIZEFEATUREATTRIBUTE):v.f32(f.VertexAttribute.SIZE);this.parameters.vvColor?v.f32(f.VertexAttribute.COLORFEATUREATTRIBUTE):v.vec4f(f.VertexAttribute.COLOR);this.parameters.vvOpacity&&v.f32(f.VertexAttribute.OPACITYFEATUREATTRIBUTE);return v};A.createBufferWriter=function(){return new t(this._layout,
this.parameters)};A.requiresSlot=function(v,B){return B===u.ShaderOutput.Color||B===u.ShaderOutput.Alpha||B===u.ShaderOutput.Highlight||B===u.ShaderOutput.Depth?v===d.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil?v===d.RenderSlot.OPAQUE_MATERIAL||v===d.RenderSlot.OCCLUDER_MATERIAL||v===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:B===u.ShaderOutput.Color||B===u.ShaderOutput.Alpha?v===(this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:
d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):v===d.RenderSlot.OPAQUE_MATERIAL:!1};A.createGLMaterial=function(v){return new l(v)};return b._createClass(D)}(k.Material),l=function(x){function D(){var v=x.apply(this,arguments)||this;v._markerPrimitive=null;return v}b._inherits(D,x);var A=D.prototype;A.dispose=function(){b._get(b._getPrototypeOf(D.prototype),"dispose",this).call(this);this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null};A._updateParameters=
function(v){const B=this._material.parameters.markerPrimitive;B!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(B,this._markerPrimitive)}),this._markerPrimitive=B);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(e.LineMarkerTechnique,v)};A._updateOccludeeState=function(v){v.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:v.hasOccludees})};A.beginSlot=function(v){this._output!==
u.ShaderOutput.Color&&this._output!==u.ShaderOutput.Alpha||this._updateOccludeeState(v);return this._updateParameters(v)};return b._createClass(D)}(q.GLTextureMaterial),m=function(x){function D(){var A=x.apply(this,arguments)||this;A.width=0;A.color=[1,1,1,1];A.markerPrimitive="arrow";A.placement="end";A.cap=z.CapType.BUTT;A.anchor=h.LineMarkerAnchor.Center;A.hasTip=!1;A.worldSpace=!1;A.hideOnShortSegments=!1;A.writeDepth=!0;A.hasSlicePlane=!1;A.vvFastUpdate=!1;A.hasOccludees=!1;A.markerTexture=null;
return A}b._inherits(D,x);return b._createClass(D)}(g.VisualVariablePassParameters),t=function(){function x(A,v){this.vertexBufferLayout=A;this._parameters=v}var D=x.prototype;D.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};D.write=function(A,v,B,C,E){const F=B.vertexAttributes.get(f.VertexAttribute.POSITION).data,M=F.length/3;let K=[1,0,0];v=B.vertexAttributes.get(f.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=v&&(K=v.data);let G=1,L=0;this._parameters.vvSize?
L=B.vertexAttributes.get(f.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:B.vertexAttributes.has(f.VertexAttribute.SIZE)&&(G=B.vertexAttributes.get(f.VertexAttribute.SIZE).data[0]);let O=[1,1,1,1],I=0;this._parameters.vvColor?I=B.vertexAttributes.get(f.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:B.vertexAttributes.has(f.VertexAttribute.COLOR)&&(O=B.vertexAttributes.get(f.VertexAttribute.COLOR).data);let H=0;this._parameters.vvOpacity&&(H=B.vertexAttributes.get(f.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);
const J=new Float32Array(C.buffer);let N=this.vertexBufferLayout.stride/4*E;const R=(T,P,Q,S)=>{J[N++]=T[0];J[N++]=T[1];J[N++]=T[2];J[N++]=Q[0];J[N++]=Q[1];J[N++]=P[0];J[N++]=P[1];J[N++]=P[2];this._parameters.worldSpace&&(J[N++]=K[0],J[N++]=K[1],J[N++]=K[2]);this._parameters.vvSize?J[N++]=L:J[N++]=G;this._parameters.vvColor?J[N++]=I:(T=Math.min(4*S,O.length-4),J[N++]=O[T],J[N++]=O[T+1],J[N++]=O[T+2],J[N++]=O[T+3]);this._parameters.vvOpacity&&(J[N++]=H)};let W;(function(T){T[T.ASCENDING=1]="ASCENDING";
T[T.DESCENDING=-1]="DESCENDING"})(W||(W={}));B=(T,P)=>{const Q=c.set(w,F[3*T],F[3*T+1],F[3*T+2]),S=r;let U=T+P;do c.set(S,F[3*U],F[3*U+1],F[3*U+2]),U+=P;while(c.equals(Q,S)&&0<=U&&U<M);A&&(c.transformMat4(Q,Q,A),c.transformMat4(S,S,A));R(Q,S,[-1,-1],T);R(Q,S,[1,-1],T);R(Q,S,[1,1],T);R(Q,S,[-1,-1],T);R(Q,S,[1,1],T);R(Q,S,[-1,1],T)};C=this._parameters.placement;"begin"!==C&&"begin-end"!==C||B(0,W.ASCENDING);"end"!==C&&"begin-end"!==C||B(M-1,W.DESCENDING)};return b._createClass(x)}();const w=y.create(),
r=y.create();a.LineMarkerMaterial=n;a.Parameters=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){const n=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.NORMAL,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);u=function(l){function m(){return l.apply(this,arguments)||this}c._inherits(m,l);var t=m.prototype;t.initializeProgram=function(w){return new k.Program(w.rctx,
m.shader.get().build(this.configuration),n)};t._makePipelineState=function(w,r){const x=this.configuration,D=w===g.TransparencyPassType.NONE;return z.makePipelineState({blending:x.output===y.ShaderOutput.Color||x.output===y.ShaderOutput.Alpha?D?q.blendingDefault:q.oitBlending(w):null,depthTest:{func:q.oitDepthTest(w)},depthWrite:D?x.writeDepth?z.defaultDepthWriteParams:null:q.oitDepthWrite(w),colorWrite:z.defaultColorWriteParams,stencilWrite:x.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:x.hasOccludees?
r?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};t.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=z.makePipelineState({blending:q.blendingDefault,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:z.defaultColorWriteParams,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=z.makePipelineState({blending:q.blendingDefault,depthTest:f.depthCompareAlways,
depthWrite:null,colorWrite:z.defaultColorWriteParams,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=z.makePipelineState({blending:null,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};t.getPipelineState=function(w,r){return r?this._occludeePipelineState:this.configuration.occluder?w===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:w===d.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:c._get(c._getPrototypeOf(m.prototype),"getPipelineState",this).call(this,w,r)};return c._createClass(m)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(h.LineMarker,()=>new Promise((l,m)=>a(["./LineMarker.glsl"],
l,m)));b.LineMarkerTechnique=u;b.vertexAttributeLocations=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){function v(C){const E=new w.ShaderBuilder,F=C.hasMultipassTerrain&&(C.output===y.ShaderOutput.Color||C.output===y.ShaderOutput.Alpha),M=C.space===A.LineMarkerSpace.World;E.include(u.RibbonVertexPosition,C);E.include(k.MarkerSizing,C);C.output===y.ShaderOutput.Depth&&E.include(q.OutputDepth,C);const {vertex:K,fragment:G}=E;G.include(e.RgbaFloatEncoding);h.addProjViewLocalOrigin(K,C);E.attributes.add(D.VertexAttribute.POSITION,"vec3");E.attributes.add(D.VertexAttribute.UV0,
"vec2");E.attributes.add(D.VertexAttribute.AUXPOS1,"vec3");E.varyings.add("vColor","vec4");E.varyings.add("vpos","vec3");E.varyings.add("vUV","vec2");E.varyings.add("vSize","float");c.addLinearDepth(E);F&&E.varyings.add("depth","float");C.hasTip&&E.varyings.add("vLineWidth","float");K.uniforms.add(new z.Float2PassUniform("nearFar",(L,O)=>O.camera.nearFar),new n.Float4PassUniform("viewport",(L,O)=>O.camera.fullViewport));K.code.add(m.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);K.code.add(m.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);M?(E.attributes.add(D.VertexAttribute.NORMAL,"vec3"),h.addViewNormal(K),K.constants.add("tiltThreshold","float",.7),K.code.add(m.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):K.code.add(m.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);K.code.add(m.glsl`
      #define vecN ${M?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${M?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${C.anchor===A.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);C.space===A.LineMarkerSpace.Screen&&(K.uniforms.add(new t.Matrix4PassUniform("inverseProjectionMatrix",(L,O)=>O.camera.inverseProjectionMatrix)),K.code.add(m.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),K.code.add(m.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),K.uniforms.add(new l.FloatPassUniform("perScreenPixelRatio",(L,O)=>O.camera.perScreenPixelRatio)),K.code.add(m.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${C.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));h.addPixelRatio(K,C);c.addCalculateLinearDepth(E);K.code.add(m.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);M?(C.hideOnShortSegments&&K.code.add(m.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),K.code.add(m.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(K.code.add(m.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),C.space===A.LineMarkerSpace.Screen&&K.code.add(m.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));K.code.add(m.glsl`
        ${F?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${M?"":"vUV *\x3d displacedPosScreen.w;"}

        ${C.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);F&&E.include(d.multipassTerrainTest,C);E.include(p.SliceDraw,C);G.uniforms.add(new n.Float4PassUniform("intrinsicColor",L=>L.color),new r.Texture2DPassUniform("tex",L=>L.markerTexture));G.include(g.ColorConversion);E.constants.add("texelSize","float",1/b.MARKER_TEXTURE_SIZE);G.code.add(m.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);C.hasTip&&(E.constants.add("relativeMarkerSize","float",b.MARKER_SYMBOL_SIZE/b.MARKER_TEXTURE_SIZE),E.constants.add("relativeTipLineWidth","float",b.MARKER_TIP_THICKNESS_FACTOR),G.code.add(m.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${M?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));E.constants.add("symbolAlphaCutoff","float",f.symbolAlphaCutoff);G.code.add(m.glsl`
  void main() {
    discardBySlice(vpos);
    ${F?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${M?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${C.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${C.output===y.ShaderOutput.ObjectAndLayerIdColor?m.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${C.output===y.ShaderOutput.Alpha?m.glsl`fragColor = vec4(finalColor.a);`:""}
    ${C.output===y.ShaderOutput.Color?m.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${C.output===y.ShaderOutput.Color&&C.transparencyPassType===x.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${C.output===y.ShaderOutput.Highlight?m.glsl`fragColor = vec4(1.0);`:""}
    ${C.output===y.ShaderOutput.Depth?m.glsl`outputDepth(linearDepth);`:""}
  }
  `);return E}const B=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.LineMarker=B;a.build=v})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],function(a){function b(p){null!=p?(p=y[p],p=null==p?p:{pattern:p.slice(),pixelRatio:8}):p=null;return p}const c={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},y={dash:c.dash,"dash-dot":[...c.dash,...c.dot],dot:c.dot,"long-dash":c["long-dash"],
"long-dash-dot":[...c["long-dash"],...c.dot],"long-dash-dot-dot":[...c["long-dash"],...c.dot,...c.dot],none:null,"short-dash":c["short-dash"],"short-dash-dot":[...c["short-dash"],...c["short-dot"]],"short-dash-dot-dot":[...c["short-dash"],...c["short-dot"],...c["short-dot"]],"short-dot":c["short-dot"],solid:null};a.createStipplePatternSimple=function(p){return{pattern:[p,p],pixelRatio:2}};a.getStipplePatternForLinePattern=function(p){return null!=p&&"style"===p.type?b(p.style):null};a.getStipplePatternForPatternStyle=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshTextureTransform ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/sources/interfaces ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DMeshObject3DGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./MeshFastUpdateProcessor ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y){const Z=["mesh"];y=function(ua){function sa(ka,ra,va,Ca){ka=ua.call(this,ka,ra,va,Ca)||this;ka._materialInfoCache=new O.MaterialInfoCache;ka._fastUpdateProcessor=new O.MeshFastUpdateProcessor;ka._textures=new Map;ka.ensureDrapedStatus(!1);return ka}b._inherits(sa,ua);var pa=sa.prototype;pa.doLoad=async function(){J.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new V.NativeLineMaterial({color:[1,
0,1,1]}),this._debugFaceNormalMaterial=new V.NativeLineMaterial({color:[0,1,1,1]}))};pa.destroy=function(){b._get(b._getPrototypeOf(sa.prototype),"destroy",this).call(this);this._context.stage.removeMany(this._materialInfoCache.materials);this._context.stage.removeMany(Array.from(this._textures.values()));this._materialInfoCache.clear();this._textures.clear();this._fastUpdateProcessor.destroy(this._context.stage)};pa.createGraphics3DGraphic=function(ka){const ra=ka.graphic;if(!this._validateGeometry(ra.geometry,
Z,"fill on mesh-3d"))return null;const va=this.setGraphicElevationContext(ra,new M.ElevationContext);return this._createAs3DShape(ra,ka.renderingInfo,va,ra.uid)};pa.onRemoveGraphic=function(ka){this._fastUpdateProcessor.onRemoveGraphic(ka,this._materialInfoCache,this._context)};pa.layerOpacityChanged=function(ka,ra){const va=this._getLayerOpacity();this._updateMaterialParameters(Ca=>{Ca.material.setParameters({layerOpacity:va});const Ba=Ca.material.parameters;this._setMaterialTransparentParameter(Ba,
Ca);Ca.material.setParameters({transparent:Ba.transparent})});ka.forEach(Ca=>{Ca=ra(Ca);null!=Ca&&Ca.layerOpacityChanged(va,this._context.isAsync)})};pa.layerElevationInfoChanged=function(ka,ra){return this.updateGraphics3DGraphicElevationInfo(ka,ra,F.needsElevationUpdates3D)};pa.slicePlaneEnabledChanged=function(ka,ra){this._updateMaterialParameters(({material:va})=>{va.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});ka.forEach(va=>{va=ra(va);null!=va&&va.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,
this._context.isAsync)});return!0};pa.physicalBasedRenderingChanged=function(){const ka=this._usePBR();this._updateMaterialParameters(({material:ra})=>ra.setParameters({usePBR:ka}));return!0};pa.updateTransform=function(ka,ra,va,Ca){const Ba=this._context.renderCoordsHelper.spatialReference,Ha=aa,{origin:Ma,transform:Qa}=va;h.computeTranslationToOriginAndRotation(ra,f.set(ha,Ma.x,Ma.y,Ma.z??0),Ha,Ba);switch(Ca){case A.MeshTransformUpdateAction.EnableFastUpdates:this._fastUpdateProcessor.enable(ka,
this._materialInfoCache,this._context);break;case A.MeshTransformUpdateAction.DisableFastUpdates:this._fastUpdateProcessor.disable(ka,this._materialInfoCache,this._context);break;case A.MeshTransformUpdateAction.UpdateFastLocalOrigin:ka.updateFastLocalOrigin(Ha,Qa,this._context.localOriginFactory)}const {elevationContext:Sa}=ka;Sa.centerPointInElevationSR=this._getCenterPointInElevationSR(Ha);const {elevationProvider:La,renderCoordsHelper:Ua}=this._context;ka.alignedSampledElevation=E.perObjectElevationAligner(ka,
Sa,La.spatialReference,(Va,cb)=>F.evaluateElevationInfoAtPoint(Va,La,Sa,Ua,cb),Ua,Ha);ka.updateTransform(Ha,Qa,this._context.isAsync);return!0};pa._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};pa._colorOrTextureUid=function(ka){return null==ka?"-":ka instanceof c?ka.toHex():ka.contentHash};pa._materialPropertiesDefault=function(ka,ra){const va=this._requiresSymbolVertexColors(),Ca=!!ka.vertexAttributes.color;ka=!!ka.vertexAttributes.tangent;
return{hasSymbolVertexColors:va,hasVertexColors:Ca,hasVertexTangents:ka,uid:`vc:${Ca},vt:${ka},vct${ra},svc:${va}`}};pa._textureTransformUid=function(ka){const {offset:ra,scale:va,rotation:Ca}=ka??na;return`${ra[0]},${ra[1]},${Ca},${va[0]},${va[1]}`};pa._materialProperties=function(ka,ra,va){ka=this._materialPropertiesDefault(ka,va);if(!ra.material)return ka;const {color:Ca,colorTexture:Ba,colorTextureTransform:Ha,normalTexture:Ma,normalTextureTransform:Qa,doubleSided:Sa,alphaCutoff:La,alphaMode:Ua}=
ra.material;va=this._colorOrTextureUid(Ca);var Va=this._colorOrTextureUid(Ba),cb=this._textureTransformUid(Ha),la=this._colorOrTextureUid(Ma),eb=this._textureTransformUid(Qa);ka.color=Ca;ka.colorTexture=Ba;ka.normalTexture=Ma;ka.uid=`${ka.uid},cmuid:${va},ctmuid:${Va},cttuid:${cb},ntmuid:${la},nttuid:${eb},ds:${Sa},ac:${La},am:${Ua}`;if(ra.material instanceof t){const {metallic:ib,roughness:Pa,metallicRoughnessTexture:za,metallicRoughnessTextureTransform:Ga,emissiveColor:Fa,emissiveTexture:xa,emissiveTextureTransform:ya,
occlusionTexture:Ea,occlusionTextureTransform:Oa}=ra.material;ra=this._colorOrTextureUid(za);va=this._textureTransformUid(Ga);Va=this._colorOrTextureUid(Fa);cb=this._colorOrTextureUid(xa);la=this._textureTransformUid(ya);eb=this._colorOrTextureUid(Ea);const bb=this._textureTransformUid(Oa);ka.metallic=ib;ka.roughness=Pa;ka.metallicRoughnessTexture=za;ka.emissiveColor=Fa;ka.emissiveTexture=xa;ka.occlusionTexture=Ea;ka.colorTextureTransform=this._convertTextureTransform(Ha);ka.normalTextureTransform=
this._convertTextureTransform(Qa);ka.emissiveTextureTransform=this._convertTextureTransform(ya);ka.occlusionTextureTransform=this._convertTextureTransform(Oa);ka.metallicRoughnessTextureTransform=this._convertTextureTransform(Ga);ka.uid=`${ka.uid},mrm:${ib},mrr:${Pa},mrt:${ra},mrtt:${va},emuid:${Va},etmuid:${cb},ett:${la},otmuid:${eb},ott:${bb}`}return ka};pa._convertTextureTransform=function(ka){if(!ka)return null;const {scale:ra,offset:va,rotation:Ca}=ka;return{scale:ra,offset:va,rotation:p.deg2rad(Ca)}};
pa._setInternalColorValueParameters=function(ka,ra){ra.diffuse=c.toUnitRGB(ka);ra.opacity=ka.a};pa._getLoadableTextureResource=function(ka){return ka.data?ka.data:ka.url};pa._getInternalTextureId=function(ka){ka=this._getInternalTexture(ka,R.AlphaDiscardMode.Opaque);return null!=ka?ka.id:null};pa._getInternalTexture=function(ka,ra){const va=this._getLoadableTextureResource(ka);if(!va)return null;const Ca=`${ka.contentHash}/${ra}`;let Ba=this._textures.get(Ca);Ba||(Ba=new Q.Texture(B.isEncodedMeshTexture(va)?
va.data:va,{mipmap:!0,wrap:this._castTextureWrap(ka.wrap),noUnpackFlip:!0,preMultiplyAlpha:B.isEncodedMeshTexture(va)?!1:ra!==R.AlphaDiscardMode.Opaque,encoding:B.isEncodedMeshTexture(va)&&null!=va.encoding?va.encoding:void 0}),this._textures.set(Ca,Ba),this._context.stage.add(Ba),this._context.stage.loadImmediate(Ba));return Ba};pa._castTextureWrap=function(ka="repeat"){return"string"===typeof ka?(ka=this._castTextureWrapIndividual(ka),{s:ka,t:ka}):{s:this._castTextureWrapIndividual(ka.horizontal),
t:this._castTextureWrapIndividual(ka.vertical)}};pa._castTextureWrapIndividual=function(ka){switch(ka){case "clamp":return Y.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return Y.TextureWrapMode.MIRRORED_REPEAT;default:return Y.TextureWrapMode.REPEAT}};pa._setInternalMaterialParameters=function(ka,ra){null!=ka.color&&this._setInternalColorValueParameters(ka.color,ra);if(null!=ka.colorTexture){const va=this._getInternalTexture(ka.colorTexture,ra.textureAlphaMode);null!=va?(ra.textureId=va.id,ra.textureAlphaPremultiplied=
!!va.parameters.preMultiplyAlpha):ra.textureId=void 0}null!=ka.normalTexture&&(ra.normalTextureId=this._getInternalTextureId(ka.normalTexture));null!=ka.emissiveColor&&(ra.emissiveFactor=c.toUnitRGB(ka.emissiveColor));null!=ka.emissiveTexture&&(ra.emissiveTextureId=this._getInternalTextureId(ka.emissiveTexture));null!=ka.occlusionTexture&&(ra.occlusionTextureId=this._getInternalTextureId(ka.occlusionTexture));null!=ka.metallicRoughnessTexture&&(ra.metallicRoughnessTextureId=this._getInternalTextureId(ka.metallicRoughnessTexture));
ra.colorTextureTransformMatrix=C.getTransformMatrix(ka.colorTextureTransform);ra.normalTextureTransformMatrix=C.getTransformMatrix(ka.normalTextureTransform);ra.occlusionTextureTransformMatrix=C.getTransformMatrix(ka.occlusionTextureTransform);ra.emissiveTextureTransformMatrix=C.getTransformMatrix(ka.emissiveTextureTransform);ra.metallicRoughnessTextureTransformMatrix=C.getTransformMatrix(ka.metallicRoughnessTextureTransform)};pa._setExternalMaterialParameters=function(ka){let ra=null!=this.symbolLayer.material?
this.symbolLayer.material.colorMixMode:null;if(this._drivenProperties.color)ka.externalColor=e.ONES;else{const va=null!=this.symbolLayer.material?this.symbolLayer.material.color:null;null!=va?ka.externalColor=c.toUnitRGBA(va):(ra=null,ka.externalColor=e.ONES)}ra&&(ka.colorMixMode=ra);ka.castShadows=!!this.symbolLayer.castShadows};pa._hasTransparentVertexColors=function(ka){ka=ka.vertexAttributes.color;if(null==ka)return!1;for(let ra=3;ra<ka.length;ra+=4)if(255!==ka[ra])return!0;return!1};pa._getOrCreateMaterial=
function(ka,ra){var va=ra.material?.color,Ca=ra.material?.colorTexture,Ba=ra.material?.alphaMode;const Ha="blend"===Ba;va="opaque"!==Ba&&(this._hasTransparentVertexColors(ka)||null!=va&&1>va.a||null!=Ca&&Ca.transparent||Ha);ka=this._materialProperties(ka,ra,va);if(Ca=this._materialInfoCache.byUid(ka.uid))return Ca.material;va={uid:ka.uid,material:null,isComponentTransparent:va,alphaMode:ra.material?ra.material.alphaMode:"opaque"};Ca=X.useSchematicPBR({normalTexture:ka.normalTexture,metallicRoughnessTexture:ka.metallicRoughnessTexture,
metallicFactor:ka.metallic,roughnessFactor:ka.roughness,emissiveTexture:ka.emissiveTexture,emissiveFactor:c.toUnitRGB(ka.emissiveColor),occlusionTexture:ka.occlusionTexture});Ba={usePBR:this._usePBR(),isSchematic:Ca,hasVertexColors:ka.hasVertexColors,hasSymbolColors:ka.hasSymbolVertexColors,hasVertexTangents:ka.hasVertexTangents,ambient:g.ZEROS,diffuse:g.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:R.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,
initTextureTransparent:!0};Ba.mrrFactors=Ca?[...X.defaultSchematicMRRFactors]:[ka.metallic,ka.roughness,X.defaultAdvancedMRRFactors[2]];ra.material&&(Ba.doubleSided=ra.material.doubleSided,Ba.cullFace=ra.material.doubleSided?R.CullFaceOptions.None:R.CullFaceOptions.Back,Ba.textureAlphaCutoff=ra.material.alphaCutoff);this._setExternalMaterialParameters(Ba);this._setMaterialTransparentParameter(Ba,va);this._setInternalMaterialParameters(ka,Ba);ra=new U.DefaultMaterial(Ba);va.material=ra;this._materialInfoCache.set(ka.uid,
va);this._context.stage.add(ra);return ra};pa._usePBR=function(){return this._context.physicalBasedRenderingEnabled};pa._setMaterialTransparentParameter=function(ka,ra){ka.transparent=this.needsDrivenTransparentPass||ra.isComponentTransparent||1>ka.layerOpacity||1>ka.opacity||ka.externalColor&&1>ka.externalColor[3];ka.textureAlphaMode="auto"===ra.alphaMode?ka.transparent?R.AlphaDiscardMode.MaskBlend:R.AlphaDiscardMode.Opaque:"opaque"===ra.alphaMode?R.AlphaDiscardMode.Opaque:"mask"===ra.alphaMode?
R.AlphaDiscardMode.Mask:R.AlphaDiscardMode.Blend};pa._addDebugNormals=function(ka,ra){var va=ra.length,Ca=ka.spatialReference.isGeographic?20015077/180:1;const Ba=.1*Math.max(ka.extent.width*Ca,ka.extent.height*Ca,ka.extent.zmax-ka.extent.zmin);var Ha=[];const Ma=[];ka=[];Ca=[];for(let cb=0;cb<va;cb++){var Qa=ra[cb],Sa=Qa.vertexAttributes.get(S.VertexAttribute.POSITION),La=Qa.vertexAttributes.get(S.VertexAttribute.NORMAL);const la=Qa.indices.get(S.VertexAttribute.POSITION);Qa=Qa.indices.get(S.VertexAttribute.NORMAL);
Sa=Sa.data;La=La.data;for(let eb=0;eb<la.length;eb++){var Ua=3*la[eb];const ib=3*Qa[eb];for(var Va=0;3>Va;Va++)Ha.push(Sa[Ua+Va]);for(Va=0;3>Va;Va++)Ha.push(Sa[Ua+Va]+La[ib+Va]*Ba);Ma.push(Ma.length);Ma.push(Ma.length);if(0===eb%3){this._calculateFaceNormal(Sa,la,eb,ma);this._getFaceVertices(Sa,la,eb,ha,ia,oa);f.add(ha,ha,ia);f.add(ha,ha,oa);f.scale(ha,ha,1/3);for(Ua=0;3>Ua;Ua++)ka.push(ha[Ua]);for(Ua=0;3>Ua;Ua++)ka.push(ha[Ua]+ma[Ua]*Ba);Ca.push(Ca.length);Ca.push(Ca.length)}}}va=ra[0].transformation;
Ha=new T.Geometry(this._debugVertexNormalMaterial,[[S.VertexAttribute.POSITION,new N.Attribute(Ha,3,!0)]],[[S.VertexAttribute.POSITION,Ma]],null,W.ContentObjectType.Line);ra.push(Ha);Ha.transformation=va;ka=new T.Geometry(this._debugFaceNormalMaterial,[[S.VertexAttribute.POSITION,new N.Attribute(ka,3,!0)]],[[S.VertexAttribute.POSITION,Ca]],null,W.ContentObjectType.Line);ka.transformation=va;ra.push(ka)};pa._createAs3DShape=function(ka,ra,va,Ca){ka=ka.geometry;if("mesh"!==ka.type)return null;ra=this._createGeometryInfo(ka,
ra,Ca);if(null==ra)return null;const {geometries:Ba,objectTransformation:Ha}=ra;J.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ka,Ba);Ca=new P.Object3D({geometries:Ba,layerUid:this._context.layer.uid,graphicUid:Ca});Ca.transformation=Ha;ra=I.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});ra=null!=ra?new G.Object3DEdgeState(Ba[0].material,[ra],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;ra=new K.Graphics3DMeshObject3DGraphicLayer(this,Ca,Ba,null,
null,E.perObjectElevationAligner,va,ra);this._fastUpdateProcessor.onAddGraphic();ra.needsElevationUpdates=F.needsElevationUpdates3D(va.mode);ra.useObjectOriginAsAttachmentOrigin=!0;va.centerPointInElevationSR=this._getCenterPointInElevationSR(Ca.transformation);const {elevationProvider:Ma,renderCoordsHelper:Qa}=this._context;ra.alignedSampledElevation=E.perObjectElevationAligner(ra,va,Ma.spatialReference,(Sa,La)=>F.evaluateElevationInfoAtPoint(Sa,Ma,va,Qa,La),Qa);return ra};pa._getCenterPointInElevationSR=
function(ka){const ra=D.makeDehydratedPoint(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);h.projectVectorToDehydratedPoint([ka[12],ka[13],ka[14]],this._context.renderCoordsHelper.spatialReference,ra);return ra};pa._createComponentNormals=function(ka,ra,va,Ca){switch(va.shading||"flat"){default:case "source":return this._createComponentNormalsSource(ka,ra,va,Ca);case "flat":return this._createComponentNormalsFlat(ka,Ca);case "smooth":return this._createComponentNormalsSmooth(ka,
Ca)}};pa._createComponentNormalsSource=function(ka,ra,va,Ca){if(null==ra)return this._createComponentNormalsFlat(ka,Ca);let Ba=!1;if(!va.trustSourceNormals)for(va=0;va<Ca.length;va+=3){this._calculateFaceNormal(ka,Ca,va,ma);for(let Ha=0;3>Ha;Ha++){const Ma=3*Ca[va+Ha];ha[0]=ra[Ma];ha[1]=ra[Ma+1];ha[2]=ra[Ma+2];0>f.dot(ma,ha)&&(ra[Ma]=-ra[Ma],ra[Ma+1]=-ra[Ma+1],ra[Ma+2]=-ra[Ma+2],Ba=!0)}}return new ea(ra,Ca,Ba)};pa._createComponentNormalsFlat=function(ka,ra){const va=n.newFloatArray(ra.length),Ca=
Array(3*ra.length);for(let Ba=0;Ba<ra.length;Ba+=3){const Ha=this._calculateFaceNormal(ka,ra,Ba,ma);for(let Ma=0;3>Ma;Ma++)va[Ba+Ma]=Ha[Ma],Ca[Ba+Ma]=Ba/3}return new ea(va,Ca,!1)};pa._createComponentNormalsSmooth=function(ka,ra){const va={};for(var Ca=0;Ca<ra.length;Ca+=3){var Ba=this._calculateFaceNormal(ka,ra,Ca,ma);for(var Ha=0;3>Ha;Ha++){var Ma=ra[Ca+Ha];let Qa=va[Ma];Qa||(Qa={normal:g.create(),count:0},va[Ma]=Qa);f.add(Qa.normal,Qa.normal,Ba);Qa.count++}}ka=n.newFloatArray(3*ra.length);Ca=Array(3*
ra.length);for(Ba=0;Ba<ra.length;Ba++){Ha=va[ra[Ba]];1!==Ha.count&&(f.normalize(Ha.normal,Ha.normal),Ha.count=1);for(Ma=0;3>Ma;Ma++)ka[3*Ba+Ma]=Ha.normal[Ma];Ca[Ba]=Ba}return new ea(ka,Ca,!1)};pa._getFaceVertices=function(ka,ra,va,Ca,Ba,Ha){const Ma=3*ra[va],Qa=3*ra[va+1];ra=3*ra[va+2];Ca[0]=ka[Ma];Ca[1]=ka[Ma+1];Ca[2]=ka[Ma+2];Ba[0]=ka[Qa];Ba[1]=ka[Qa+1];Ba[2]=ka[Qa+2];Ha[0]=ka[ra];Ha[1]=ka[ra+1];Ha[2]=ka[ra+2]};pa._calculateFaceNormal=function(ka,ra,va,Ca){this._getFaceVertices(ka,ra,va,ha,ia,oa);
f.subtract(ia,ia,ha);f.subtract(oa,oa,ha);f.cross(ha,ia,oa);f.normalize(Ca,ha);return Ca};pa._getOrCreateComponents=function(ka){return ka.components??ca};pa._createPositionBuffer=function(ka,ra){let va=ka.vertexAttributes.position;const Ca=ra.reprojection===qa.ECEF?ra.transformBeforeProject:null;null!=Ca&&(va=r.transformMat4(new Float64Array(va.length),va,Ca));if(ra.reprojection===qa.NONE)return ra.needsBufferCopy?new Float64Array(va):va;ra=null!=Ca?va:new Float64Array(va.length);h.projectBuffer(va,
ka.spatialReference,0,ra,this._context.renderCoordsHelper.spatialReference,0,va.length/3);return ra};pa._createNormalBuffer=function(ka,ra,va){let Ca=ka.vertexAttributes.normal;if(null==Ca)return null;var Ba=va.reprojection===qa.ECEF?va.transformBeforeProject:null;null!=Ba&&(Ca=x.transformNormal(Ca,new Float32Array(Ca.length),Ba));if("local"===this._context.graphicsCoreOwner.view.viewingMode||va.reprojection===qa.NONE)return va.needsBufferCopy&&ka.vertexAttributes.normal===Ca?new Float32Array(Ca):
Ca;va=ka.vertexAttributes.position;Ba=null!=Ba?Ca:new Float32Array(Ca.length);return x.projectNormalToPCPF(Ca,va,ra,ka.spatialReference,Ba)};pa._createTangentBuffer=function(ka,ra,va){let Ca=ka.vertexAttributes.tangent;if(null==Ca)return null;var Ba=va.reprojection===qa.ECEF?va.transformBeforeProject:null;null!=Ba&&(Ca=x.transformTangent(Ca,new Float32Array(Ca.length),Ba));if("local"===this._context.graphicsCoreOwner.view.viewingMode||va.reprojection===qa.NONE)return va.needsBufferCopy&&ka.vertexAttributes.normal===
Ca?new Float32Array(Ca):Ca;va=ka.vertexAttributes.position;Ba=null!=Ba?Ca:new Float32Array(Ca.length);return x.projectTangentToPCPF(Ca,va,ra,ka.spatialReference,Ba)};pa._createColorBuffer=function(ka){return ka.vertexAttributes.color};pa._createSymbolColorBuffer=function(ka){if(this._requiresSymbolVertexColors()){ka=this._getVertexOpacityAndColor(ka);const ra=H.parseColorMixMode(this.symbolLayer?.material?.colorMixMode),va=new Uint8Array(4);H.encodeSymbolColor(ka,ra,va);return va}return null};pa._createBuffers=
function(ka,ra){var va=ka.vertexAttributes&&ka.vertexAttributes.position;if(!va)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var Ca=ka.vertexAttributes.normal;const Ba=ka.vertexAttributes.uv;var Ha=ka.vertexAttributes.tangent;if(null!=Ca&&Ca.length!==va.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(null!=Ha&&Ha.length/4!==va.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),
null;if(null!=Ba&&Ba.length/2!==va.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;Ha=this._computeReprojectionInfo(ka);va=this._createPositionBuffer(ka,Ha);Ca=this._createColorBuffer(ka);ra=this._createSymbolColorBuffer(ra);const Ma=this._createNormalBuffer(ka,va,Ha),Qa=this._createTangentBuffer(ka,va,Ha);ka=Ha.reprojection===qa.NONE&&null!=Ha.objectTransformation?Ha.objectTransformation:this._transformOriginLocal(ka,
va,Ma,Qa);Ha=Ha.reprojection===qa.NONE&&null!=Ha.geometryTransformation?Ha.geometryTransformation:d.create();return{positionBuffer:va,normalBuffer:Ma,tangentBuffer:Qa,uvBuffer:Ba,colorBuffer:Ca,symbolColorBuffer:ra,objectTransformation:ka,geometryTransformation:Ha}};pa._computeReprojectionInfo=function(ka){var {vertexSpace:ra}=ka;const va=ra.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===v.ViewingMode.Local?qa.NONE:qa.ECEF:qa.NONE;if(ra.isRelative){const {origin:Ca}=ra;ra=d.create();
const Ba=ka.transform?.localMatrix??d.IDENTITY;if(va===qa.NONE)return h.computeTranslationToOriginAndRotation(ka.spatialReference,Ca,ra,this._context.renderCoordsHelper.spatialReference),ka=d.clone(Ba),{reprojection:va,objectTransformation:ra,geometryTransformation:ka,needsBufferCopy:!1};ka=k.fromTranslation(d.create(),Ca);k.multiply(ka,ka,Ba);return{reprojection:va,transformBeforeProject:ka,needsBufferCopy:!0}}return{reprojection:va,needsBufferCopy:!0}};pa._transformOriginLocal=function(ka,ra,va,
Ca){const Ba=this._context.renderCoordsHelper.spatialReference;var Ha=ka.anchor;ja[0]=Ha.x;ja[1]=Ha.y;ja[2]=Ha.z??0;Ha=d.create();h.computeTranslationToOriginAndRotation(ka.spatialReference,ja,Ha,Ba);k.invert(fa,Ha);r.transformMat4(ra,ra,fa);if(null!=va||null!=Ca)u.fromMat4(ba,Ha),u.transpose(ba,ba),null!=va&&r.transformMat3(va,va,ba),null!=Ca&&r.transformMat3(Ca,Ca,ba,4);return Ha};pa._validateFaces=function(ka,ra){ka=ka.vertexAttributes.position.length/3;if(ra=ra.faces){let va=-1;for(let Ca=0;Ca<
ra.length;Ca++){const Ba=ra[Ca];Ba>va&&(va=Ba)}if(ka<=va)return this.logger.warn(`Vertex index ${va} is out of bounds of the mesh position buffer`),!1}else if(0!==ka%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};pa._getOrCreateFaces=function(ka,ra){return ra.faces??l.getContinuousIndexArray(ka.vertexAttributes.position.length/3)};pa._isOutsideClippingArea=function(ka){if(!this._context.clippingExtent)return!1;
var ra=ka.vertexAttributes&&ka.vertexAttributes.position;if(!ra)return!1;const va=this._context.elevationProvider.spatialReference,Ca=ra.length/3;null==va||ka.spatialReference.equals(va)||(ra=new Float64Array(ra.length),h.projectBuffer(ka.vertexAttributes.position,ka.spatialReference,0,ra,va,0,Ca));z.empty(da);z.expandWithBuffer(da,ra,0,Ca);return!z.intersectsClippingArea(da,this._context.clippingExtent)};pa._createGeometryInfo=function(ka,ra,va){if(!h.canProjectWithoutEngine(ka.spatialReference,
this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(ka))return null;ra=this._createBuffers(ka,ra);if(null==ra)return null;const {positionBuffer:Ca,uvBuffer:Ba,colorBuffer:Ha,symbolColorBuffer:Ma,normalBuffer:Qa,tangentBuffer:Sa,objectTransformation:La,geometryTransformation:Ua}=ra;var Va=this._getOrCreateComponents(ka);ra=[];let cb=!1;for(const ib of Va){if(!this._validateFaces(ka,
ib))return null;var la=this._getOrCreateFaces(ka,ib);if(0===la.length)continue;var eb=this._createComponentNormals(Ca,Qa,ib,la);eb.didFlipNormals&&(cb=!0);Va=[[S.VertexAttribute.POSITION,new N.Attribute(Ca,3,!0)],[S.VertexAttribute.NORMAL,new N.Attribute(eb.normals,3,!0)]];eb=[[S.VertexAttribute.POSITION,la],[S.VertexAttribute.NORMAL,eb.indices]];null!=Ha&&(Va.push([S.VertexAttribute.COLOR,new N.Attribute(Ha,4,!0)]),eb.push([S.VertexAttribute.COLOR,la]));null!=Ma&&(Va.push([S.VertexAttribute.SYMBOLCOLOR,
new N.Attribute(Ma,4,!0)]),eb.push([S.VertexAttribute.SYMBOLCOLOR,l.getZeroIndexArray(la.length)]));null!=Ba&&(Va.push([S.VertexAttribute.UV0,new N.Attribute(Ba,2,!0)]),eb.push([S.VertexAttribute.UV0,la]));null!=Sa&&(Va.push([S.VertexAttribute.TANGENT,new N.Attribute(Sa,4,!0)]),eb.push([S.VertexAttribute.TANGENT,la]));la=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:va,layerUid:this._context.layer.uid});const Pa=this._getOrCreateMaterial(ka,ib);Va=new T.Geometry(Pa,Va,eb,null,
W.ContentObjectType.Mesh,la);Va.transformation=Ua;ra.push(Va)}cb&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:ra,objectTransformation:La}};pa._updateMaterialParameters=function(ka){this._materialInfoCache.forEachMaterialInfo(ka);this._fastUpdateProcessor.forEachMaterialInfo(ka);this._fastUpdateProcessor.forEachClonedMaterial((ra,
va)=>{va.setParameters(ra.parameters)})};pa.test=function(){return{...b._get(b._getPrototypeOf(sa.prototype),"test",this).call(this),materials:this._materialInfoCache.materials}};return b._createClass(sa)}(L.Graphics3DSymbolLayer);let ea=b._createClass(function(ua,sa,pa){this.normals=ua;this.indices=sa;this.didFlipNormals=pa});const ja=g.create(),ha=g.create(),ia=g.create(),oa=g.create(),ma=g.create(),fa=d.create(),ba=q.create(),aa=d.create(),da=z.create(),ca=[new m],na=new w;var qa;(function(ua){ua[ua.NONE=
0]="NONE";ua[ua.ECEF=1]="ECEF"})(qa||(qa={}));a.Graphics3DMeshFillSymbolLayer=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){var h;const z=p.getLogger("esri.geometry.support.MeshComponent");c=h=function(n){function l(t){t=n.call(this,t)||this;t.faces=null;t.material=null;t.shading="source";t.trustSourceNormals=!1;return t}a._inherits(l,n);l.from=function(t){return d.ensureClass(h,t)};var m=l.prototype;m.castFaces=function(t){return e.castArray(t,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},z)};m.castMaterial=function(t){return t&&"object"===typeof t&&("metallic"in t||"roughness"in
t||"metallicRoughnessTexture"in t)?d.ensureClass(g,t):d.ensureClass(f,t)};m.clone=function(){return new h({faces:y.clone(this.faces),shading:this.shading,material:y.clone(this.material),trustSourceNormals:this.trustSourceNormals})};m.cloneWithDeduplication=function(t,w){t={faces:y.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,w):null,trustSourceNormals:this.trustSourceNormals};return new h(t)};a._createClass(l,[{key:"memoryUsage",get:function(){let t=
0;null!=this.faces&&(t+=this.faces.byteLength);null!=this.material&&(t+=this.material.memoryUsage);return t}}]);return l}(c.JSONSupport);b.__decorate([u.property({json:{write:!0}})],c.prototype,"faces",void 0);b.__decorate([q.cast("faces")],c.prototype,"castFaces",null);b.__decorate([u.property({type:f,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([q.cast("material")],c.prototype,"castMaterial",null);b.__decorate([u.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);
b.__decorate([u.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=h=b.__decorate([k.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){var e;y=e=function(h){function z(l){l=h.call(this,l)||this;l.color=null;l.colorTexture=null;l.colorTextureTransform=null;l.normalTexture=void 0;l.normalTextureTransform=void 0;l.alphaMode="auto";l.alphaCutoff=.5;l.doubleSided=!0;return l}a._inherits(z,h);var n=z.prototype;n.clone=function(){return this.cloneWithDeduplication(null,new Map)};n.cloneWithDeduplication=function(l,m){const t=null!=l?l.get(this):null;if(t)return t;m=new e(this.clonePropertiesWithDeduplication(m));
null!=l&&l.set(this,m);return m};n.clonePropertiesWithDeduplication=function(l){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(l),normalTexture:this.normalTexture?.cloneWithDeduplication(l),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}};n.getMemoryUsage=function(){let l;l=null!=this.color?
16:0;null!=this.colorTexture&&(l+=this.colorTexture.memoryUsage);l+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(l+=this.normalTexture.memoryUsage);return l+=null!=this.normalTextureTransform?20:0};a._createClass(z,[{key:"memoryUsage",get:function(){return this.getMemoryUsage()}}]);return z}(y.JSONSupport);b.__decorate([p.property({type:c,json:{write:!0}})],y.prototype,"color",void 0);b.__decorate([p.property({type:f,json:{write:!0}})],y.prototype,"colorTexture",void 0);b.__decorate([p.property({type:g,
json:{write:!0}})],y.prototype,"colorTextureTransform",void 0);b.__decorate([p.property({type:f,json:{write:!0}})],y.prototype,"normalTexture",void 0);b.__decorate([p.property({type:g,json:{write:!0}})],y.prototype,"normalTextureTransform",void 0);b.__decorate([p.property({nonNullable:!0,json:{write:!0}})],y.prototype,"alphaMode",void 0);b.__decorate([p.property({nonNullable:!0,json:{write:!0}})],y.prototype,"alphaCutoff",void 0);b.__decorate([p.property({nonNullable:!0,json:{write:!0}})],y.prototype,
"doubleSided",void 0);return y=e=b.__decorate([d.subclass("esri.geometry.support.MeshMaterial")],y)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){var h;const z=new WeakMap;let n=0;c=h=function(l){function m(w){w=l.call(this,w)||this;w.wrap="repeat";return w}a._inherits(m,l);var t=m.prototype;t.writeData=function(w,r,x,D){w instanceof HTMLImageElement?(w={type:"image-element",src:e.toJSON(w.src,D),crossOrigin:w.crossOrigin},r[x]=w):w instanceof HTMLCanvasElement?(w=w.getContext("2d").getImageData(0,0,w.width,w.height),w={type:"canvas-element",imageData:this._encodeImageData(w)},r[x]=w):w instanceof HTMLVideoElement?
(w={type:"video-element",src:e.toJSON(w.src,D),autoplay:w.autoplay,loop:w.loop,muted:w.muted,crossOrigin:w.crossOrigin,preload:w.preload},r[x]=w):w instanceof ImageData&&(w={type:"image-data",imageData:this._encodeImageData(w)},r[x]=w)};t.readData=function(w){switch(w.type){case "image-element":var r=new Image;r.src=w.src;r.crossOrigin=w.crossOrigin;return r;case "canvas-element":return w=this._decodeImageData(w.imageData),r=document.createElement("canvas"),r.width=w.width,r.height=w.height,r.getContext("2d").putImageData(w,
0,0),r;case "image-data":return this._decodeImageData(w.imageData);case "video-element":return r=document.createElement("video"),r.src=w.src,r.crossOrigin=w.crossOrigin,r.autoplay=w.autoplay,r.loop=w.loop,r.muted=w.muted,r.preload=w.preload,r}};t.clone=function(){const w={url:this.url,data:this.data,wrap:this._cloneWrap()};return new h(w)};t.cloneWithDeduplication=function(w){var r=w.get(this);if(r)return r;r=this.clone();w.set(this,r);return r};t._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};t._encodeImageData=function(w){let r="";for(let x=0;x<w.data.length;x++)r+=String.fromCharCode(w.data[x]);return{data:btoa(r),width:w.width,height:w.height}};t._decodeImageData=function(w){const r=atob(w.data),x=new Uint8ClampedArray(r.length);for(let D=0;D<r.length;D++)x[D]=r.charCodeAt(D);return y.wrapImageData(x,w.width,w.height)};t._imageDataContainsTransparent=function(w){for(let r=3;r<w.data.length;r+=4)if(255!==w.data[r])return!0;
return!1};m.from=function(w){return"string"===typeof w?new h({url:w}):w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof ImageData||w instanceof HTMLVideoElement?new h({data:w}):q.ensureClass(h,w)};a._createClass(m,[{key:"url",get:function(){return this._get("url")||null},set:function(w){this._set("url",w);w&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(w){this._set("data",w);w&&this._set("url",null)}},{key:"transparent",
get:function(){var w=this.data,r=this.url;return w instanceof HTMLCanvasElement?this._imageDataContainsTransparent(w.getContext("2d").getImageData(0,0,w.width,w.height)):w instanceof ImageData?this._imageDataContainsTransparent(w):r&&(w=r.substr(r.length-4,4).toLowerCase(),r=r.substr(0,15).toLocaleLowerCase(),".png"===w||"data:image/png;"===r)?!0:!1},set:function(w){this._overrideIfSome("transparent",w)}},{key:"contentHash",get:function(){const w="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?
`${this.wrap.horizontal}/${this.wrap.vertical}`:"",r=(x="")=>`d:${x},t:${this.transparent},w:${w}`;if(null!=this.url)return r(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return r(this.data.src);z.has(this.data)||z.set(this.data,++n);return r(z.get(this.data))}return r()}},{key:"memoryUsage",get:function(){let w;w=0+(null!=this.url?this.url.length:0);if(null!=this.data){const r=this.data;"data"in r?w+=r.data.byteLength:r instanceof HTMLImageElement?
w+=r.naturalWidth*r.naturalHeight*3:r instanceof HTMLCanvasElement&&(w+=r.width*r.height*3)}return w}}]);return m}(p.JSONSupport);b.__decorate([u.property({type:String,json:{write:e.write}})],c.prototype,"url",null);b.__decorate([u.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),u.property()],c.prototype,"data",null);b.__decorate([g.writer("data")],c.prototype,"writeData",null);b.__decorate([d.reader("data")],c.prototype,"readData",null);b.__decorate([u.property({type:Boolean,
json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([u.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"contentHash",null);return c=h=b.__decorate([f.subclass("esri.geometry.support.MeshTexture")],c)})},"esri/core/imageUtils":function(){define(["exports"],function(a){function b(p,u,q){q||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),q=c);return q.getContext("2d").createImageData(p,
u)}let c=null,y=!0;a.createEmptyImageData=function(p,u,q){if(!p||!u)throw Error("Cannot construct image data without dimensions");if(y)try{return new ImageData(p,u)}catch(k){y=!1}return b(p,u,q)};a.wrapImageData=function(p,u,q,k){if(!u||!q)throw Error("Cannot construct image data without dimensions");if(y)try{return new ImageData(p,u,q)}catch(d){y=!1}u=b(u,q,k);u.data.set(p,0);return u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){c=function(f){function g(e){e=f.call(this,e)||this;e.offset=[0,0];e.rotation=0;e.scale=[1,1];return e}a._inherits(g,f);return a._createClass(g)}(c.ClonableMixin(y.JSONSupport));b.__decorate([p.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"offset",void 0);b.__decorate([p.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"rotation",void 0);b.__decorate([p.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"scale",
void 0);return c=b.__decorate([d.subclass("esri.geometry.support.MeshTextureTransform")],c)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,c,y,p,u,q,k,d,
f,g){var e;p=e=function(h){function z(l){l=h.call(this,l)||this;l.emissiveColor=null;l.emissiveTexture=null;l.emissiveTextureTransform=void 0;l.occlusionTexture=null;l.occlusionTextureTransform=void 0;l.metallic=1;l.roughness=1;l.metallicRoughnessTexture=null;l.metallicRoughnessTextureTransform=void 0;return l}a._inherits(z,h);var n=z.prototype;n.clone=function(){return this.cloneWithDeduplication(null,new Map)};n.cloneWithDeduplication=function(l,m){const t=null!=l?l.get(this):null;if(t)return t;
m=new e(this.clonePropertiesWithDeduplication(m));null!=l&&l.set(this,m);return m};n.getMemoryUsage=function(){let l=a._get(a._getPrototypeOf(z.prototype),"getMemoryUsage",this).call(this);l+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&(l+=this.emissiveTexture.memoryUsage);l+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(l+=this.occlusionTexture.memoryUsage);l+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(l+=this.metallicRoughnessTexture.memoryUsage);
return l+=null!=this.metallicRoughnessTextureTransform?20:0};n.clonePropertiesWithDeduplication=function(l){return{...a._get(a._getPrototypeOf(z.prototype),"clonePropertiesWithDeduplication",this).call(this,l),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(l),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(l),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),
metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(l),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}};return a._createClass(z)}(d);b.__decorate([y.property({type:c,json:{write:!0}})],p.prototype,"emissiveColor",void 0);b.__decorate([y.property({type:f,json:{write:!0}})],p.prototype,"emissiveTexture",void 0);b.__decorate([y.property({type:g,json:{write:!0}})],p.prototype,"emissiveTextureTransform",
void 0);b.__decorate([y.property({type:f,json:{write:!0}})],p.prototype,"occlusionTexture",void 0);b.__decorate([y.property({type:g,json:{write:!0}})],p.prototype,"occlusionTextureTransform",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],p.prototype,"metallic",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],p.prototype,"roughness",void 0);b.__decorate([y.property({type:f,json:{write:!0}})],p.prototype,
"metallicRoughnessTexture",void 0);b.__decorate([y.property({type:g,json:{write:!0}})],p.prototype,"metallicRoughnessTextureTransform",void 0);return p=e=b.__decorate([k.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],p)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(n,l,m,t){const {loggerTag:w,stride:r}=l;return 0!==n.length%r?(t.error(w,`Invalid array length, expected a multiple of ${r}`),new m([])):n}function g(n,l,m,t,w){if(!n)return n;if(n instanceof l)return f(n,t,l,w);for(const r of m)if(n instanceof r)return f(new l(n),t,l,w);if(Array.isArray(n))return f(new l(n),t,l,w);m=m.map(r=>`'${r.name}'`);w.error(`Failed to set property, expected one of ${m}, but got ${n.constructor.name}`);return new l([])}function e(n,l,
m){const t=Array(n.length);for(let w=0;w<n.length;w++)t[w]=n[w];l[m]=t}var h;const z=u.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=h=function(n){function l(t){t=n.call(this,t)||this;t.color=null;t.position=new Float64Array(0);t.uv=null;t.normal=null;t.tangent=null;return t}b._inherits(l,n);var m=l.prototype;m.castColor=function(t){return g(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},z)};m.castPosition=function(t){t&&t instanceof Float32Array&&
z.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return g(t,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},z)};m.castUv=function(t){return g(t,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},z)};m.castNormal=function(t){return g(t,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},z)};m.castTangent=function(t){return g(t,Float32Array,[Float64Array],
{loggerTag:".tangent\x3d",stride:4},z)};m.clone=function(){const t={position:p.clone(this.position),uv:p.clone(this.uv),normal:p.clone(this.normal),tangent:p.clone(this.tangent),color:p.clone(this.color)};return new h(t)};m.clonePositional=function(){const t={position:p.clone(this.position),normal:p.clone(this.normal),tangent:p.clone(this.tangent),uv:this.uv,color:this.color};return new h(t)};b._createClass(l,[{key:"memoryUsage",get:function(){let t;t=0+this.position.byteLength;null!=this.uv&&(t+=
this.uv.byteLength);null!=this.normal&&(t+=this.normal.byteLength);null!=this.tangent&&(t+=this.tangent.byteLength);null!=this.color&&(t+=this.color.byteLength);return t}}]);return l}(y.JSONSupport);c.__decorate([q.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"color",void 0);c.__decorate([k.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([q.property({nonNullable:!0,json:{write:e}})],a.MeshVertexAttributes.prototype,"position",void 0);c.__decorate([k.cast("position")],
a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([q.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([k.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([q.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"normal",void 0);c.__decorate([k.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([q.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"tangent",void 0);c.__decorate([k.cast("tangent")],
a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=h=c.__decorate([d.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(A,v,B,C,E,F){if(v){var M=B.count,K=d.getSphericalPCPF(E);if(l(E))for(B=0;B<M;B++)C.getVec(B,w),v.getVec(B,r),k.computeTranslationToOriginAndRotation(K,w,x,K),c.fromMat4(D,x),A===t.FROM_PCPF&&c.transpose(D,D),u.transformMat3(r,r,D),F.setVec(B,r);else for(E=0;E<M;E++){C.getVec(E,w);v.getVec(E,r);k.computeTranslationToOriginAndRotation(K,w,x,K);c.fromMat4(D,x);var G=g.y2lat(B.get(E,1));G=Math.cos(G);A===t.TO_PCPF&&(G=1/G);D[0]*=G;D[1]*=G;D[2]*=G;D[3]*=G;
D[4]*=G;D[5]*=G;A===t.FROM_PCPF&&c.transpose(D,D);u.transformMat3(r,r,D);u.normalize(r,r);F.setVec(E,r)}return F}}function n(A){return l(A)||A.isWebMercator}function l(A){return A.isWGS84||f.isCGCS2000(A)||f.isMars(A)||f.isMoon(A)}const m=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var t;(function(A){A[A.TO_PCPF=0]="TO_PCPF";A[A.FROM_PCPF=1]="FROM_PCPF"})(t||(t={}));const w=q.create(),r=q.create(),x=p.create(),D=y.create();a.projectFromPCPF=function(A,v,B){k.projectBuffer(A,d.getSphericalPCPF(B),
0,v,B,0,A.length/3);return v};a.projectNormalFromPCPF=function(A,v,B,C,E){if(!n(C))return m.error("Cannot convert to spatial reference from PCPF"),E;z(t.FROM_PCPF,e.BufferViewVec3f.fromTypedArray(A),e.BufferViewVec3f64.fromTypedArray(v),e.BufferViewVec3f64.fromTypedArray(B),C,e.BufferViewVec3f.fromTypedArray(E));return E};a.projectNormalToPCPF=function(A,v,B,C,E){if(!n(C))return m.error("Cannot convert spatial reference to PCPF"),E;z(t.TO_PCPF,e.BufferViewVec3f.fromTypedArray(A),e.BufferViewVec3f64.fromTypedArray(v),
e.BufferViewVec3f64.fromTypedArray(B),C,e.BufferViewVec3f.fromTypedArray(E));return E};a.projectTangentFromPCPF=function(A,v,B,C,E){if(!n(C))return m.error("Cannot convert to spatial reference from PCPF"),E;z(t.FROM_PCPF,e.BufferViewVec3f.fromTypedArray(A,16),e.BufferViewVec3f64.fromTypedArray(v),e.BufferViewVec3f64.fromTypedArray(B),C,e.BufferViewVec3f.fromTypedArray(E,16));for(v=3;v<A.length;v+=4)E[v]=A[v];return E};a.projectTangentToPCPF=function(A,v,B,C,E){if(!n(C))return m.error("Cannot convert spatial reference to PCPF"),
E;z(t.TO_PCPF,e.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT),e.BufferViewVec3f64.fromTypedArray(v),e.BufferViewVec3f64.fromTypedArray(B),C,e.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT));for(v=3;v<A.length;v+=4)E[v]=A[v];return E};a.projectToPCPF=function(A,v,B){k.projectBuffer(A,v,0,B,d.getSphericalPCPF(v),0,A.length/3);return B};a.transformNormal=function(A,v,B){c.normalFromMat4(D,B);h.transformMat3(v,A,D);c.isOrthoNormal(D)||h.normalize(v,v);return v};
a.transformTangent=function(A,v,B){c.normalFromMat4(D,B);h.transformMat3(v,A,D,4);c.isOrthoNormal(D)||h.normalize(v,v,4);if(A!==v)for(B=3;B<A.length;B+=4)v[B]=A[B];return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],function(a){a.MeshTransformUpdateAction=void 0;var b=a.MeshTransformUpdateAction||(a.MeshTransformUpdateAction={});b[b.EnableFastUpdates=0]="EnableFastUpdates";b[b.DisableFastUpdates=1]="DisableFastUpdates";
b[b.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/basicInterfaces"],function(a,b,c){let y=b._createClass(function(p){this.data=p;this.type="encoded-mesh-texture";this.encoding=c.TextureEncodingMimeType.KTX2_ENCODING});a.EncodedMeshTexture=y;a.imageFromBinaryData=async function(p,u){return u===
c.TextureEncodingMimeType.KTX2_ENCODING?new y(p):new Promise((q,k)=>{const d=new Blob([p],{type:u}),f=URL.createObjectURL(d),g=new Image,e=()=>{URL.revokeObjectURL(f);"decode"in g?g.decode().then(()=>q(g),()=>q(g)).then(z):(q(g),z())},h=n=>{URL.revokeObjectURL(f);k(n);z()},z=()=>{g.removeEventListener("load",e);g.removeEventListener("error",h)};g.addEventListener("load",e);g.addEventListener("error",h);g.src=f})};a.isEncodedMeshTexture=function(p){return"encoded-mesh-texture"===p?.type};a.jsonFromBinaryData=
async function(p){return new Promise((u,q)=>{const k=new Blob([p]),d=new FileReader;d.onload=()=>{u(JSON.parse(d.result))};d.onerror=f=>{q(f)};d.readAsText(k)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(a,b,c,y){a.getTransformMatrix=function(p){if(null==p)return null;var u=null!=p.offset?p.offset:c.ZEROS,
q=null!=p.rotation?p.rotation:0;p=null!=p.scale?p.scale:c.ONES;u=b.fromValues(1,0,0,0,1,0,u[0],u[1],1);q=b.fromValues(Math.cos(q),-Math.sin(q),0,Math.sin(q),Math.cos(q),0,0,0,1);p=b.fromValues(p[0],0,0,0,p[1],0,0,0,1);const k=b.create();y.multiply(k,q,p);y.multiply(k,u,k);return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){y.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");c=function(r){function x(){var A=r.apply(this,arguments)||this;A._originalGeometries=[];A._fastTransformUpdatesEnabled=!1;return A}b._inherits(x,r);var D=x.prototype;D.enableFastTransformUpdates=function(A,v){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:B}=this,C=B.geometries.slice();B.removeAllGeometries();var E=p.getTranslation(h,B.transformation);
v=v.getOrigin(E);for(const F of C)E=A(F.material),E=F.instantiate({material:E}),E.localOrigin=v,B.addGeometry(E);this._originalGeometries=C}};D.disableFastTransformUpdates=function(A){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:v}=this,B=v.geometries.map(C=>A(C.material));v.removeAllGeometries();for(let C=0;C<this._originalGeometries.length;C++){const E=this._originalGeometries[C],F=B[C];F.setParameters({modelTransformation:null});F===E.material?v.addGeometry(E):
v.addGeometry(E.instantiate({material:F}))}this._originalGeometries.length=0}};D.updateFastLocalOrigin=function(A,v,B){if(this._fastTransformUpdatesEnabled){var {stageObject:C}=this;if(0!==C.geometries.length){var E=C.geometries[0].localOrigin,F=p.getTranslation(h,A),M=B.getOrigin(F);if(M!==E){var K=v?.localMatrix??u.IDENTITY;C.clearShaderTransformation();C.transformation=A;C.geometries.forEach(G=>{G.transformation=K;G.localOrigin=M})}}}};D.updateTransform=function(A,v,B){const {stageObject:C}=this,
E=v?.localMatrix??u.IDENTITY;if(this._fastTransformUpdatesEnabled){v=p.multiply(z,C.transformation,C.geometries[0].transformation);var F=p.multiply(n,A,E);C.shaderTransformation=A;this._setFastMaterialTransformation({matA:v,matB:F});A=()=>E;for(const M of C.geometries)M.shaderTransformer=A}else C.clearShaderTransformation(),C.transformation=A,C.geometries.forEach(M=>{M.transformation=E});this.resetEdgeObject(B)};D.alignWithElevation=function(A,v,B,C){if(this._fastTransformUpdatesEnabled){null!=B&&
g.setContextFeature(this.elevationContext.featureExpressionInfoContext,B);var {stageObject:E}=this;if(E.geometries[0].material.parameters.modelTransformation){B=p.multiply(z,E.transformation,E.geometries[0].transformation);var F=p.copy(l,E.shaderTransformation);this.alignedSampledElevation=d.perObjectElevationAligner(this,this.elevationContext,A.spatialReference,(M,K)=>f.evaluateElevationInfoAtPoint(M,A,this.elevationContext,v,K),v,F);E.shaderTransformation=F;E=p.multiply(n,F,E.geometries[0].shaderTransformation);
this._setFastMaterialTransformation({matA:B,matB:E});this.resetEdgeObject(C)}}else b._get(b._getPrototypeOf(x.prototype),"alignWithElevation",this).call(this,A,v,B,C)};D._setFastMaterialTransformation=function({matA:A,matB:v}){const {stageObject:B}=this;if(0!==B.geometries.length){var C=p.fromTranslation(w,q.scale(h,B.geometries[0].localOrigin.vec3,-1));A=p.multiply(m,C,A);v=p.multiply(t,C,v);C=p.invert(m,A);v=p.multiply(t,v,C);for(const E of B.geometries)E.material.setParameters({modelTransformation:v})}};
b._createClass(x,[{key:"fastTransformUpdatesEnabled",get:function(){return this._fastTransformUpdatesEnabled}}]);return x}(e.Graphics3DObject3DGraphicLayer);const h=k.create(),z=u.create(),n=u.create(),l=u.create(),m=u.create(),t=u.create(),w=u.create();a.Graphics3DMeshObject3DGraphicLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/MeshFastUpdateProcessor":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/materials/DefaultMaterial"],
function(a,b,c){let y=function(){function u(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}var q=u.prototype;q.enable=function(k,d,f){k.enableFastTransformUpdates(g=>{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(g))return g;var e=d.byMaterial(g);this._fastTransformOriginalMaterials.set(g,e);d.delete(g);return g}e=new c.DefaultMaterial(g.parameters);f.stage.add(e);this._fastTransformClonedMaterials.set(e,
g);return e},f.localOriginFactory)};q.disable=function(k,d,f){const g=new Set,e=new Set;k.disableFastTransformUpdates(h=>{if(!this._fastTransformClonedMaterials.has(h)){var z=this._fastTransformOriginalMaterials.get(h);if(d.has(z.uid))return g.add(h),d.byUid(z.uid).material;e.add(h);return z.material}z=this._fastTransformClonedMaterials.get(h);this._fastTransformClonedMaterials.delete(h);f.stage.remove(h);h.dispose();return z});for(const h of g)this._fastTransformOriginalMaterials.delete(h),f.stage.remove(h),
h.dispose();for(const h of e)k=this._fastTransformOriginalMaterials.get(h),this._fastTransformOriginalMaterials.delete(h),d.set(k.uid,k)};q.onAddGraphic=function(){this._graphicReferenceCount++};q.onRemoveGraphic=function(k,d,f){this._graphicReferenceCount--;this.disable(k,d,f)};q.forEachMaterialInfo=function(k){this._fastTransformOriginalMaterials.forEach(k)};q.forEachClonedMaterial=function(k){this._fastTransformClonedMaterials.forEach(k)};q.destroy=function(k){k.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));
k.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:d})=>d));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()};return b._createClass(u)}(),p=function(){function u(){this._byUid=new Map;this._byMaterial=new Map}var q=u.prototype;q.byUid=function(k){return this._byUid.get(k)};q.byMaterial=function(k){return this._byMaterial.get(k)};q.set=function(k,d){this._byUid.set(k,d);this._byMaterial.set(d.material,d)};q.delete=function(k){const d=
this._byMaterial.get(k)?.uid;d&&(this._byUid.delete(d),this._byMaterial.delete(k))};q.has=function(k){return this._byUid.has(k)};q.forEachMaterialInfo=function(k){this._byUid.forEach(k)};q.clear=function(){this._byUid.clear();this._byMaterial.clear()};b._createClass(u,[{key:"materials",get:function(){return Array.from(this._byUid.values(),k=>k.material)}}]);return u}();a.MaterialInfoCache=p;a.MeshFastUpdateProcessor=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ./internal/bufferWriterUtils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){var B;(function(Y){Y[Y.START=0]="START";Y[Y.END=1]="END"})(B||(B={}));let C=function(Y){function Z(ja){ja=Y.call(this,ja,new M)||this;ja._configuration=new v.NativeLineTechniqueConfiguration;return ja}b._inherits(Z,Y);var ea=Z.prototype;ea.getConfiguration=function(ja,ha){this._configuration.output=ja;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.transparent=
1>this.parameters.color[3]||1>this.parameters.width;this._configuration.draped=ha.slot===m.RenderSlot.DRAPED_MATERIAL;ja=null!=this.parameters.stipplePattern;this._configuration.stippleEnabled=ja;this._configuration.stippleOffColorEnabled=ja&&null!=this.parameters.stippleOffColor;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous;return this._configuration};ea.intersect=function(ja,ha,ia,oa,ma,fa){if(ia.options.selectionMode&&
ja.visible)if(t.isTranslationMatrix(ha)){ma=ja.vertexAttributes.get(w.VertexAttribute.POSITION).data;var ba=ia.camera,aa=T;u.copy(aa,ia.point);q.set(P[0],aa[0]-2,aa[1]+2,0);q.set(P[1],aa[0]+2,aa[1]+2,0);q.set(P[2],aa[0]+2,aa[1]-2,0);q.set(P[3],aa[0]-2,aa[1]-2,0);for(ja=0;4>ja;ja++)if(!ba.unprojectFromRenderScreen(P[ja],Q[ja]))return;e.fromPoints(ba.eye,Q[0],Q[1],S);e.fromPoints(ba.eye,Q[1],Q[2],U);e.fromPoints(ba.eye,Q[2],Q[3],V);e.fromPoints(ba.eye,Q[3],Q[0],X);oa=Number.MAX_VALUE;ja=0;for(let ca=
0;ca<ma.length-5;ca+=3)if(K[0]=ma[ca]+ha[12],K[1]=ma[ca+1]+ha[13],K[2]=ma[ca+2]+ha[14],G[0]=ma[ca+3]+ha[12],G[1]=ma[ca+4]+ha[13],G[2]=ma[ca+5]+ha[14],!(0>e.signedDistance(S,K)&&0>e.signedDistance(S,G)||0>e.signedDistance(U,K)&&0>e.signedDistance(U,G)||0>e.signedDistance(V,K)&&0>e.signedDistance(V,G)||0>e.signedDistance(X,K)&&0>e.signedDistance(X,G))){ba.projectToRenderScreen(K,I);ba.projectToRenderScreen(G,H);if(0>I[2]&&0<H[2]){q.subtract(L,K,G);var da=ba.frustum;da=-e.signedDistance(da[f.PlaneIndex.NEAR],
K)/q.dot(L,e.normal(da[f.PlaneIndex.NEAR]));q.scale(L,L,da);q.add(K,K,L);ba.projectToRenderScreen(K,I)}else if(0<I[2]&&0>H[2])q.subtract(L,G,K),da=ba.frustum,da=-e.signedDistance(da[f.PlaneIndex.NEAR],G)/q.dot(L,e.normal(da[f.PlaneIndex.NEAR])),q.scale(L,L,da),q.add(G,G,L),ba.projectToRenderScreen(G,H);else if(0>I[2]&&0>H[2])continue;I[2]=0;H[2]=0;da=g.distance2(g.fromPoints(I,H,R),aa);da<oa&&(oa=da,q.copy(J,K),q.copy(N,G),ja=ca/3)}ha=ia.rayBegin;ia=ia.rayEnd;4>oa&&(oa=Number.MAX_VALUE,g.closestLineSegmentPoint(g.fromPoints(J,
N,R),g.fromPoints(ha,ia,W),O)&&(q.subtract(O,O,ha),oa=q.length(O),q.scale(O,O,1/oa),oa/=q.distance(ha,ia)),fa(oa,O,ja,!1))}else c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")};ea.intersectDraped=function(ja,ha,ia,oa,ma,fa){if(ia.options.selectionMode){ha=ja.vertexAttributes.get(w.VertexAttribute.POSITION).data;var ba=ja.vertexAttributes.get(w.VertexAttribute.SIZE);ia=oa[0];oa=oa[1];ja=(((ba?ba.data[0]:0)+1)/2+4)*ja.screenToWorldRatio;
ba=Number.MAX_VALUE;var aa=0;for(let ua=0;ua<ha.length-5;ua+=3){var da=ha[ua],ca=ha[ua+1],na=ia-da,qa=oa-ca;da=ha[ua+3]-da;ca=ha[ua+4]-ca;const sa=y.clamp((da*na+ca*qa)/(da*da+ca*ca),0,1);na=da*sa-na;qa=ca*sa-qa;qa=na*na+qa*qa;qa<ba&&(ba=qa,aa=ua/3)}ba<ja*ja&&ma(fa.dist,fa.normal,aa,!1)}};ea.requiresSlot=function(ja,ha){return(ha===z.ShaderOutput.Color||ha===z.ShaderOutput.Highlight||ha===z.ShaderOutput.ObjectAndLayerIdColor)&&(ja===m.RenderSlot.OPAQUE_MATERIAL||ja===m.RenderSlot.DRAPED_MATERIAL)};
ea.createGLMaterial=function(ja){return new E(ja)};ea.createBufferWriter=function(){const ja=this.parameters.hasVertexColors?x.PositionColorLayout:x.PositionLayout;return null==this.parameters.stipplePattern?new r.DefaultBufferWriter(ja):new F(ja.clone().vec3f(w.VertexAttribute.AUXPOS1).vec2f(w.VertexAttribute.UV0))};return b._createClass(Z)}(l.Material),E=function(Y){function Z(){var ja=Y.apply(this,arguments)||this;ja._stipplePattern=null;return ja}b._inherits(Z,Y);var ea=Z.prototype;ea.dispose=
function(){b._get(b._getPrototypeOf(Z.prototype),"dispose",this).call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};ea._updateOccludeeState=function(ja){ja.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ja.hasOccludees})};ea.beginSlot=function(ja){this._output===z.ShaderOutput.Color&&this._updateOccludeeState(ja);const ha=this._material.parameters.stipplePattern;this._stipplePattern!==ha&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(ha,
this._stipplePattern)}),this._stipplePattern=ha);return this.ensureTechnique(A.NativeLineTechnique,ja)};return b._createClass(Z)}(n),F=function(){function Y(ea){this.vertexBufferLayout=ea}var Z=Y.prototype;Z.elementCount=function(ea){return ea.indices.get(w.VertexAttribute.POSITION).length};Z.write=function(ea,ja,ha,ia,oa){D.writeDefaultAttributes(ha,this.vertexBufferLayout,ea,ja,ia,oa);this._writeAuxpos1(ea,ha,ia,oa);this._writeUV0(ea,ha,ia,oa)};Z._writeAuxpos1=function(ea,ja,ha,ia){var oa=ha.getField(w.VertexAttribute.AUXPOS1,
h.BufferViewVec3f);ha=ja.indices.get(w.VertexAttribute.POSITION);ja=ja.vertexAttributes.get(w.VertexAttribute.POSITION).data;const ma=oa.typedBufferStride;oa=oa.typedBuffer;ia*=ma;for(let ba=0;ba<ha.length-1;ba+=2)for(const aa of[1,0]){var fa=3*ha[ba+aa];const da=ja[fa],ca=ja[fa+1];fa=ja[fa+2];const na=ea[1]*da+ea[5]*ca+ea[9]*fa+ea[13],qa=ea[2]*da+ea[6]*ca+ea[10]*fa+ea[14];oa[ia]=ea[0]*da+ea[4]*ca+ea[8]*fa+ea[12];oa[ia+1]=na;oa[ia+2]=qa;ia+=ma}};Z._writeUV0=function(ea,ja,ha,ia){var oa=ha.getField(w.VertexAttribute.UV0,
h.BufferViewVec2f),ma=ja.indices.get(w.VertexAttribute.POSITION);ha=ja.vertexAttributes.get(w.VertexAttribute.POSITION).data;const fa=ja.vertexAttributes.get(w.VertexAttribute.DISTANCETOSTART)?.data;ja=oa.typedBufferStride;oa=oa.typedBuffer;ia*=ja;let ba=0;oa[ia]=B.START;oa[ia+1]=ba;ia+=ja;var aa=3*ma[0];aa=q.set(K,ha[aa],ha[aa+1],ha[aa+2]);ea&&q.transformMat4(aa,aa,ea);const da=G,ca=ma.length-1;let na=1;const qa=fa?(sa,pa,ka)=>ba=fa[ka]:(sa,pa,ka)=>ba+=q.distance(sa,pa);for(let sa=1;sa<ca;sa+=2){var ua=
3*ma[sa];q.set(da,ha[ua],ha[ua+1],ha[ua+2]);ea&&q.transformMat4(da,da,ea);qa(aa,da,na++);for(ua=0;2>ua;++ua)oa[ia]=1-ua,oa[ia+1]=ba,ia+=ja;q.copy(aa,da)}ma=3*ma[ca];q.set(da,ha[ma],ha[ma+1],ha[ma+2]);ea&&q.transformMat4(da,da,ea);qa(aa,da,na);oa[ia]=B.END;oa[ia+1]=ba};return b._createClass(Y)}(),M=function(Y){function Z(){var ea=Y.apply(this,arguments)||this;ea.color=d.ONES;ea.hasVertexColors=!1;ea.hasSlicePlane=!1;ea.width=1;ea.stipplePreferContinuous=!0;ea.hasOccludees=!1;ea.stippleTexture=null;
return ea}b._inherits(Z,Y);return b._createClass(Z)}(l.MaterialParameters);const K=k.create(),G=k.create(),L=k.create(),O=k.create(),I=p.createRenderScreenPointArray3(),H=p.createRenderScreenPointArray3(),J=k.create(),N=k.create(),R=g.create(),W=g.create(),T=k.create(),P=[p.createRenderScreenPointArray3(),p.createRenderScreenPointArray3(),p.createRenderScreenPointArray3(),p.createRenderScreenPointArray3()],Q=[k.create(),k.create(),k.create(),k.create()],S=e.create(),U=e.create(),V=e.create(),X=e.create();
a.NativeLineMaterial=C;a.Parameters=M;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){u=function(h){function z(){return h.apply(this,arguments)||this}c._inherits(z,h);var n=z.prototype;n.initializeProgram=function(l){return new k.Program(l.rctx,z.shader.get().build(this.configuration),q.Default3D)};n.initializePipeline=function(){const l=this.configuration,m=e.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),t=(w,r=null,x=null)=>e.makePipelineState({blending:r,depthTest:d.depthCompareLess,
depthWrite:x,colorWrite:e.defaultColorWriteParams,stencilWrite:l.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:l.hasOccludees?w?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null});return l.output===y.ShaderOutput.Color?(this._occludeePipelineState=t(!0,l.transparent||this._stippleEnabled?m:null,e.defaultDepthWriteParams),t(!1,l.transparent||this._stippleEnabled?m:null,e.defaultDepthWriteParams)):t(!1)};n.getPipelineState=function(l,m){return m?this._occludeePipelineState:c._get(c._getPrototypeOf(z.prototype),
"getPipelineState",this).call(this,l,m)};c._createClass(z,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==y.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return g.PrimitiveType.LINES}}]);return z}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(f.NativeLine,()=>new Promise((h,z)=>a(["./NativeLine.glsl"],h,z)));b.NativeLineTechnique=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(m){const t=new h.ShaderBuilder,{vertex:w,fragment:r}=t;t.include(y.Transform,m);t.include(p.VertexColor,m);t.include(q.LineStipple,m);d.addProjViewLocalOrigin(w,m);m.stippleEnabled&&(t.attributes.add(z.VertexAttribute.UV0,"vec2"),t.attributes.add(z.VertexAttribute.AUXPOS1,"vec3"),w.uniforms.add(new f.Float4PassUniform("viewport",(x,D)=>D.camera.fullViewport)));t.attributes.add(z.VertexAttribute.POSITION,"vec3");t.varyings.add("vpos","vec3");w.code.add(e.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);m.stippleEnabled&&(w.code.add(e.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),m.draped?w.uniforms.add(new g.FloatPassUniform("worldToScreenRatio",(x,D)=>1/D.screenToPCSRatio)):w.code.add(e.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),w.code.add(e.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),m.draped?w.code.add(e.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):w.code.add(e.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),w.uniforms.add(new g.FloatPassUniform("stipplePatternPixelSize",x=>q.computePixelSize(x))),w.code.add(e.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));w.code.add(e.glsl`}`);m.output===b.ShaderOutput.Highlight&&t.include(u.OutputHighlight,m);t.include(c.SliceDraw,m);r.uniforms.add(new g.FloatPassUniform("alphaCoverage",(x,D)=>Math.min(1,x.width*D.camera.pixelRatio)));m.hasVertexColors||r.uniforms.add(new f.Float4PassUniform("constantColor",x=>x.color));r.code.add(e.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${m.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${m.output===b.ShaderOutput.ObjectAndLayerIdColor?e.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${e.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${m.output===b.ShaderOutput.Color?e.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${m.output===b.ShaderOutput.Highlight?e.glsl`outputHighlight();`:""}
  }
  `);return t}const l=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));a.NativeLine=l;a.build=n})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,y,p,u){u=function(q){function k(){var d=
q.apply(this,arguments)||this;d.output=y.ShaderOutput.Color;d.hasSlicePlane=!1;d.hasVertexColors=!1;d.transparent=!1;d.draped=!1;d.stippleEnabled=!1;d.stippleOffColorEnabled=!1;d.stipplePreferContinuous=!0;d.hasOccludees=!1;return d}b._inherits(k,q);return b._createClass(k)}(u.DefaultTechniqueConfiguration);c.__decorate([p.parameter({count:y.ShaderOutput.COUNT})],u.prototype,"output",void 0);c.__decorate([p.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],u.prototype,
"hasVertexColors",void 0);c.__decorate([p.parameter()],u.prototype,"transparent",void 0);c.__decorate([p.parameter()],u.prototype,"draped",void 0);c.__decorate([p.parameter()],u.prototype,"stippleEnabled",void 0);c.__decorate([p.parameter()],u.prototype,"stippleOffColorEnabled",void 0);c.__decorate([p.parameter()],u.prototype,"stipplePreferContinuous",void 0);c.__decorate([p.parameter()],u.prototype,"hasOccludees",void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"stippleRequiresClamp",
void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([p.parameter({constValue:!1})],u.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ./webStyleUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N){let R=b._createClass(function(U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa){this.lodResources=U;this.lodRenderer=V;this.stageResources=X;this.originalMaterialParameters=Y;this.resourceSize=Z;this.isEsriSymbolResource=ea;this.isWosr=ja;this.resourceBoundingBox=ha;this.symbolSize=ia;this.extentPadding=oa;this.physicalBasedRenderingEnabled=ma;this.pivotOffset=fa});x=function(U){function V(Y,Z,ea,ja){Y=U.call(this,Y,Z,ea,ja)||this;
Y._resources=null;Y._optionalFields=[];Y._instanceIndexToGraphicUid=new Map;Y._hasLoadedPBRTextures=!1;Y._disposeResourceHandles=[];Y.skipHighSymbolLodsChanged=!1;Y.ensureDrapedStatus(!1);Y._hasLoadedPBRTextures=ea.physicalBasedRenderingEnabled;return Y}b._inherits(V,U);var X=V.prototype;X.getCachedSize=function(){const [Y,Z,ea]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:Y,depth:Z,height:ea}};X.doLoad=async function(Y){if(!this._drivenProperties.size&&D.validateSymbolLayerSize(this.symbolLayer))throw Error();
if(this._isPrimitive){var Z=this.symbolLayer.resource;Z=Z&&F.isValidPrimitive(Z.primitive)?Z.primitive:n.defaultPrimitive;this._resources=await this._createResourcesForPrimitive(Z,Y)}else Z=(await K.getResourceUrlFromSymbolStyle(this.symbol.styleOrigin))?.href??this.symbolLayer.resource.href,this._resources=await this._createResourcesForUrl(Z,Y);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()};X._setMaterialTransparencyParams=
function(Y,Z=this.symbolLayer?.material?.color){Z=this._getCombinedOpacity(Z);const ea=1>Z||this.needsDrivenTransparentPass;Y.transparent=ea;Y.opacity=Z;Y.cullFace=ea?L.CullFaceOptions.None:L.CullFaceOptions.Back;return Y};X._createResourcesForPrimitive=async function(Y,Z){var ea=this.symbolLayer;const ja=z.create(l.objectSymbolLayerPrimitiveBoundingBox(Y)),ha=g.fromArray(z.size(ja)),ia=g.fromArray(l.objectSymbolLayerSizeWithResourceSize(ha,ea)),oa=f.length(ia);var ma={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,mrrFactors:[...N.defaultSchematicMRRFactors],ambient:g.ONES,diffuse:g.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const fa=!!ma.usePBR;this._setMaterialTransparencyParams(ma);const ba=this.symbol;if("point-3d"===ba.type&&ba.verticalOffset){const {screenLength:aa,minWorldLength:da,maxWorldLength:ca}=ba.verticalOffset;ma.verticalOffset={screenLength:u.pt2px(aa),
minWorldLength:da||0,maxWorldLength:null!=ca?ca:Infinity};ma.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ma.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ma.externalColor=e.ONES:(ea=null!=ea.material?ea.material.color:null,ea=null!=ea?c.toUnitRGBA(ea):e.ONES,ma.externalColor=ea);this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(ja,ia,ha,null));ma.isInstanced=
!0;this._fastUpdates?(Object.assign(ma,this._fastUpdates.materialParameters),this._optionalFields.push(O.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(ma.hasInstancedColor=!0,this._optionalFields.push(O.VertexAttribute.COLOR));y("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.VertexAttribute.OBJECTANDLAYERIDCOLOR);ma=new J.DefaultMaterial(ma);ma=F.primitiveLodResources(Y,ma);if(!ma)throw Error(`Unknown object symbol primitive: ${Y}`);Y=H.materialsFromLodResources(ma).map(aa=>
({opacity:1,transparent:aa.parameters.transparent}));ea=await this._createStageResources(ma,fa,Z);Z=await this._createLodRenderer(ma,Z);return new R(ma,Z,ea,Y,ha,!1,!1,ja,ia,oa,fa,null)};X._createResourcesForUrl=async function(Y,Z){var ea={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions(null,null,null,null)))?(Object.assign(ea.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(O.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(ea.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(O.VertexAttribute.COLOR));y("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.VertexAttribute.OBJECTANDLAYERIDCOLOR);var ja=this.symbol;if("point-3d"===ja.type&&ja.verticalOffset){const {screenLength:pa,
minWorldLength:ka,maxWorldLength:ra}=ja.verticalOffset;ea.materialParamsMixin.verticalOffset={screenLength:u.pt2px(pa),minWorldLength:ka||0,maxWorldLength:null!=ra?ra:Infinity};ea.materialParamsMixin.castShadows=!1}ea.signal=Z;ea.usePBR=this._context.physicalBasedRenderingEnabled;ea.skipHighLods=this._context.skipHighSymbolLods;ja=ea.usePBR;var ha=await C.fetch(Y,ea);Y=ha.isEsriSymbolResource;ea=ha.isWosr;const ia=B.makeLodResources(ha.lods);ia.levels.sort((pa,ka)=>pa.minScreenSpaceRadius-ka.minScreenSpaceRadius);
const oa=this._context,ma=this._getExternalColorParameters(this.symbolLayer.material),fa=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:!0}),ba=this.needsDrivenTransparentPass;var aa=H.materialsFromLodResources(ia);const da=H.materialsFromLodResources(ia).map(pa=>({opacity:pa.parameters.opacity||1,transparent:pa.parameters.transparent}));aa.forEach(pa=>{const ka=pa.parameters;pa.setParameters(ma);const ra=ka.opacity*fa;pa.setParameters({opacity:ra,transparent:1>ra||
ba||ka.transparent});oa.screenSizePerspectiveEnabled&&pa.setParameters({screenSizePerspective:oa.sharedResources.screenSizePerspectiveSettings})});ha=ha.referenceBoundingBox;const ca=g.fromArray(z.size(ha)),na=g.fromArray(ia.levels[0].pivotOffset),qa=g.fromArray(l.objectSymbolLayerSizeWithResourceSize(ca,this.symbolLayer)),ua=f.length(qa),sa=this._fastUpdates;G.updateFastSymbolUpdatesState(sa,this._context.renderer,this._fastVisualVariableConvertOptions(ha,qa,ca,na))&&aa.forEach(pa=>pa.setParameters(sa.materialParameters));
aa=await this._createStageResources(ia,ja,Z);Z=await this._createLodRenderer(ia,Z);return new R(ia,Z,aa,da,ca,Y,ea,ha,qa,ua,ja,na)};X._addDisposeResource=function(Y){this._disposeResourceHandles.push(Y)};X._createStageResources=async function(Y,Z,ea){const ja=this._context.stage,ha=H.materialsFromLodResources(Y);Z!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();ja.addMany(ha);this._addDisposeResource(()=>ja.removeMany(ha));const ia=H.texturesFromLodResources(Y);
ja.addMany(ia);this._addDisposeResource(()=>ja.removeMany(ia));await ja.load(ia,ea);p.throwIfAborted(ea);const oa=H.geometriesFromLodResources(Y);ja.addMany(oa);this._addDisposeResource(()=>ja.removeMany(oa));return{materials:ha,textures:ia,geometries:oa}};X._createLodRenderer=async function(Y,Z){const ea=this._context.stage,ja=this._fastUpdates,ha=new I.LodRenderer({symbol:Y,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:ia=>this._instanceIndexToGraphicUid.get(ia),
notifyGraphicGeometryChanged:ia=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(ia)),notifyGraphicVisibilityChanged:ia=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(ia))},shaderTransformation:ja?{applyTransform:(ia,oa,ma)=>{ia.getFeatureAttribute(oa,Q);k.copy(ma,G.evaluateModelTransform(ja.materialParameters,Q,ma))},scaleFactor:(ia,oa,ma)=>{oa.getFeatureAttribute(ma,Q);G.evaluateModelTransformScale(ia,ja.materialParameters,Q)}}:null},
this._context.scheduler);ha.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{ea.removeRenderPlugin(ha);ha.destroy()});await ea.addRenderPlugin(ha.slots,ha,Z);return ha};X._getExternalColorParameters=function(Y){const Z={};this._drivenProperties.color?Z.externalColor=e.ONES:null!=Y&&null!=Y.color?Z.externalColor=c.toUnitRGBA(Y.color):(Z.externalColor=e.ONES,Z.colorMixMode="ignore");return Z};X.destroy=function(){b._get(b._getPrototypeOf(V.prototype),"destroy",this).call(this);
this._cleanupResources()};X._cleanupResources=function(){this._disposeResourceHandles.forEach(Y=>Y());this._disposeResourceHandles.length=0;this._resources=null};X.createGraphics3DGraphic=function(Y){const Z=Y.graphic;if(!this._validateGeometry(Z.geometry))return null;const ea=E.placePointOnGeometry(Z.geometry);if(null==ea)return this.logger.warn(`unsupported geometry type for icon symbol: ${Z.geometry.type}`),null;const ja=this.setGraphicElevationContext(Z,new w.ElevationContext);return this._createAs3DShape(Z,
ea,Y.renderingInfo,ja,Z.uid,Y.layer.uid)};X.notifyDestroyGraphicLayer=function(Y){this._instanceIndexToGraphicUid.delete(Y.instanceIndex)};X.graphicLayerToGraphicId=function(){return 0};X.layerOpacityChanged=function(){if(null!=this._resources){var Y=this._drivenProperties.opacity,Z=!this._isPrimitive,ea=this._resources.stageResources.materials,ja=this._resources.originalMaterialParameters;for(let ia=0;ia<ea.length;ia++){const oa=ea[ia];var ha=ja[ia];const ma=this._getCombinedOpacity(this.symbolLayer?.material?.color,
{hasIntrinsicColor:Z})*ha.opacity;ha=1>ma||Y||ha.transparent;oa.setParameters({opacity:ma,transparent:ha});this._isPrimitive&&oa.setParameters({cullFace:ha?L.CullFaceOptions.None:L.CullFaceOptions.Back})}}};X.layerElevationInfoChanged=function(Y,Z){return this.updateGraphics3DGraphicElevationInfo(Y,Z,t.needsElevationUpdates3D)};X.slicePlaneEnabledChanged=function(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Y of this._resources.stageResources.materials)Y.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0};X.physicalBasedRenderingChanged=function(){if(null==this._resources)return!0;const {stageResources:Y,isWosr:Z}=this._resources;for(const ea of Y.materials)this._isPrimitive?ea.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):Z||ea.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0};X.applyRendererDiff=
function(Y,Z){if(null==this._resources)return A.ApplyRendererDiffResult.RecreateSymbol;const {stageResources:{materials:ea},lodRenderer:ja,resourceBoundingBox:ha,symbolSize:ia,resourceSize:oa,pivotOffset:ma}=this._resources;for(const fa in Y.diff)switch(fa){case "visualVariables":if(G.updateFastSymbolUpdatesState(this._fastUpdates,Z,this._fastVisualVariableConvertOptions(ha,ia,oa,ma))){for(const ba of ea)ba.setParameters(this._fastUpdates.materialParameters);ja.notifyShaderTransformationChanged()}else return A.ApplyRendererDiffResult.RecreateSymbol;
break;default:return A.ApplyRendererDiffResult.RecreateSymbol}return A.ApplyRendererDiffResult.FastUpdate};X.computeComplexity=function(){if(null==this._resources)return b._get(b._getPrototypeOf(V.prototype),"computeComplexity",this).call(this);var Y=this._resources.lodResources;const Z=H.geometriesFromLodLevelResources(Y.levels[0]).reduce((ha,ia)=>ha+ia.indices.get(O.VertexAttribute.POSITION).length,0)/3,ea=ha=>Array.from(ha.vertexAttributes.values()).reduce((ia,oa)=>ia+q.estimateSize(oa.data),0)+
Array.from(ha.indices.values()).reduce((ia,oa)=>ia+q.estimateSize(oa),0);var ja=H.texturesFromLodResources(Y).reduce((ha,ia)=>ha+(ia.parameters.encoding&&"image/ktx2"===ia.parameters.encoding?ia.memoryEstimate:ia.memoryEstimate/4),0);Y=H.geometriesFromLodResources(Y).reduce((ha,ia)=>ha+ea(ia),0);ja+=Y;ja={...M.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:ja};return{primitivesPerFeature:Z,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:ja}};X._hasLodRenderer=
function(){return null!=this._resources};X._createAs3DShape=function(Y,Z,ea,ja,ha,ia){if(!this._hasLodRenderer()||null==this._resources)return null;Y=this.getFastUpdateAttrValues(Y);var oa=this._context.clippingExtent;h.projectPointToVector(Z,W,this._context.elevationProvider.spatialReference);if(null!=oa&&!z.containsPoint(oa,W))return null;oa=this._requiresTerrainElevation(ja);const ma=this._computeGlobalTransform(Z,ja,P,S),fa=this._computeLocalTransform(this._resources,this.symbolLayer,ea,T),ba=
this._resources.lodRenderer.instanceData,aa=ba.addInstance();this._instanceIndexToGraphicUid.set(aa,ha);ba.setLocalTransform(aa,fa,!1);ba.setGlobalTransform(aa,ma);Y&&ba.setFeatureAttribute(aa,Y);null==this._fastUpdates&&this._hasPerInstanceColor()&&ba.setColor(aa,D.mixinColorAndOpacity(ea.color,ea.opacity,255));null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&ba.setObjectAndLayerIdColor(aa,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ha,
layerUid:ia}));ea=new r(this,aa,m.perLodInstanceElevationAligner,ja);oa&&(ea.alignedSampledElevation=S.sampledElevation);ea.needsElevationUpdates=t.needsElevationUpdates3D(ja.mode);E.extendPointGraphicElevationContext(ea,Z,this._context.elevationProvider);return ea};X._computeGlobalTransform=function(Y,Z,ea,ja){t.evaluateElevationInfoAtPoint(Y,this._context.elevationProvider,Z,this._context.renderCoordsHelper,ja);W[0]=Y.x;W[1]=Y.y;W[2]=ja.z;h.computeTranslationToOriginAndRotation(Y.spatialReference,
W,ea,this._context.renderCoordsHelper.spatialReference);return ea};X._computeLocalTransform=function(Y,Z,ea,ja){k.identity(ja);this._applyObjectRotation(ea,!1,ja);this._applyObjectRotation(Z,!0,ja);this._applyObjectScale(Y,ea,ja);this._applyAnchor(Y,Z,ja);return ja};X._applyObjectScale=function(Y,Z,ea){this._fastUpdates?.requiresShaderTransformation||(Y=D.computeObjectScale(this._drivenProperties.size&&Z.size?Z.size:Y.symbolSize,Y.symbolSize,Y.resourceSize,this._context.renderCoordsHelper.unitInMeters),
1===Y[0]&&1===Y[1]&&1===Y[2]||k.scale(ea,ea,Y))};X.prepareSymbolLayerPatch=function(Y){if("partial"===Y.diff.type){var Z=Y.diff.diff;this._preparePatchTransform(Y,Z);this._preparePatchColor(Y,Z)}};X.updateGeometry=function(Y,Z){if(null==this._resources)return!0;const ea=Z&&E.placePointOnGeometry(Z);if(null==ea)return!1;Z=this.getGeometryElevationMode(Z);if(Y.elevationContext.mode!==Z)return!1;this._computeGlobalTransform(ea,Y.elevationContext,P,S);this._requiresTerrainElevation(Y.elevationContext)&&
(Y.alignedSampledElevation=S.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(Y.instanceIndex,P,!0);E.extendPointGraphicElevationContext(Y,ea,this._context.elevationProvider);return!0};X._preparePatchTransform=function(Y,Z){if((Z.heading||Z.tilt||Z.roll||Z.width||Z.height||Z.depth||Z.anchor||Z.anchorPosition)&&null!=this._resources){var ea=(ca,na,qa)=>(null!=ca&&"complete"===ca.type?ca.newValue:na)??qa,ja=ea(Z.heading,this.symbolLayer.heading,0),ha=ea(Z.tilt,this.symbolLayer.tilt,
0),ia=ea(Z.roll,this.symbolLayer.roll,0),oa=ea(Z.width,this.symbolLayer.width,void 0),ma=ea(Z.height,this.symbolLayer.height,void 0),fa=ea(Z.depth,this.symbolLayer.depth,void 0),ba=ea(Z.anchor,this.symbolLayer.anchor,void 0);ea=ea(Z.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete Z.heading;delete Z.tilt;delete Z.roll;delete Z.width;delete Z.height;delete Z.depth;delete Z.anchor;delete Z.anchorPosition;var aa={heading:ja,tilt:ha,roll:ia,anchor:ba,anchorPosition:ea},da=this._resources;
this.loadStatus===v.LoadStatus.LOADED&&Y.symbolLayerStatePatches.push(()=>{da.symbolSize=g.fromArray(l.objectSymbolLayerSizeWithResourceSize(da.resourceSize,{width:oa,height:ma,depth:fa,isPrimitive:this.symbolLayer.isPrimitive}))});Y.graphics3DGraphicPatches.push((ca,na)=>{na=this._computeLocalTransform(da,aa,na,T);da.lodRenderer.instanceData.setLocalTransform(ca.instanceIndex,na,!0)})}};X._preparePatchColor=function(Y,Z){if(Z.material&&"partial"===Z.material.type&&(Z=Z.material.diff,Z.color&&"complete"===
Z.color.type&&null!=Z.color.newValue&&null!=Z.color.oldValue)){var ea=Z.color.newValue,ja=null!=ea?c.toUnitRGBA(ea):e.ONES;delete Z.color;var ha=this._resources;null!=ha&&Y.graphics3DGraphicPatches.push(ia=>{this._hasPerInstanceColor()?(ha.lodRenderer.instanceData.setColor(ia.instanceIndex,ja),ia=this._setMaterialTransparencyParams({},ea)):ia=this._setMaterialTransparencyParams({externalColor:ja},ea);for(const oa of ha.stageResources.materials)oa.setParameters(ia)})}};X._requiresTerrainElevation=
function(Y){return"absolute-height"!==Y.mode};X._applyObjectRotation=function(Y,Z,ea){if(!this._fastUpdates?.requiresShaderTransformation||!Z)return D.computeObjectRotation(Y.heading,Y.tilt,Y.roll,ea)};X._computeAnchor=function(Y,Z,ea){const ja=g.create();switch(ea.anchor){case "center":f.copy(ja,z.center(Y));f.negate(ja,ja);break;case "top":Z=z.center(Y);f.set(ja,-Z[0],-Z[1],-Y[5]);break;case "bottom":Z=z.center(Y);f.set(ja,-Z[0],-Z[1],-Y[2]);break;case "relative":Z=z.center(Y);Y=z.size(Y);ea=(ea=
ea.anchorPosition)?g.fromValues(ea.x,ea.y,ea.z):g.ZEROS;f.multiply(ja,Y,ea);f.add(ja,ja,Z);f.negate(ja,ja);break;default:null!=Z?f.negate(ja,Z):f.copy(ja,g.ZEROS)}return ja};X._applyAnchor=function(Y,Z,ea){this._fastUpdates?.requiresShaderTransformation||(Y=this._computeAnchor(Y.resourceBoundingBox,Y.pivotOffset,Z))&&k.translate(ea,ea,Y)};X._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};X._fastVisualVariableConvertOptions=function(Y,Z,ea,ja){const ha=
null!=Y?g.fromArray(z.size(Y)):g.ONES;Y=null!=Y?this._computeAnchor(Y,ja,this.symbolLayer):g.ZEROS;ja=this._context.renderCoordsHelper.unitInMeters;ea=D.computeObjectScale(null!=Z?Z:void 0,Z,ea,ja);const ia=g.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new G.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ha,Z??g.ONES,ja,Y,ea,ia)};b._createClass(V,[{key:"extentPadding",get:function(){return null!=this._resources?this._resources.extentPadding:
0}},{key:"_isPrimitive",get:function(){return!this.symbolLayer.resource?.href}},{key:"lodRenderer",get:function(){return this._resources?.lodRenderer}}]);return V}(x.Graphics3DSymbolLayer);const W=g.create(),T=d.create(),P=d.create(),Q=e.create(),S=new t.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,y,p,u,q,k,d,f){let g=function(){function m(w,r,x,D){this.graphics3DSymbolLayer=w;this.instanceIndex=r;this.elevationAligner=x;this.elevationContext=D;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var t=m.prototype;t.initialize=function(){};t.setVisibility=function(w){const r=this._lodRenderer.instanceData;w!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,w)};t.destroy=function(){null!=
this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};t.alignWithElevation=function(w,r,x){this.elevationAligner&&(q.setContextFeature(this.elevationContext.featureExpressionInfoContext,x),x=this.elevationAligner(this,this.elevationContext,w.spatialReference,(D,A)=>u.evaluateElevationInfoAtPoint(D,w,this.elevationContext,r,A),r),null!=x&&(this.alignedSampledElevation=x))};t.getCenterObjectSpace=function(w=
y.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,l);return c.transformMat4(w,this._lodRenderer.baseBoundingSphere.center,l)};t.getBoundingBoxObjectSpace=function(w=p.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,l);const r=this._lodRenderer.baseBoundingBox;p.empty(w);for(let x=0;8>x;++x)c.set(h,0===(x&1)?r[0]:r[3],0===(x&2)?r[1]:r[4],0===(x&4)?r[2]:r[5]),c.transformMat4(h,h,l),p.expandWithVec3(w,h);return w};t.computeAttachmentOrigin=
function(w){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,l);w.render.origin[0]+=l[12];w.render.origin[1]+=l[13];w.render.origin[2]+=l[14];w.render.num++};t.getProjectedBoundingBox=async function(w,r,x,D,A){A=this.getBoundingBoxObjectSpace(A);var v=n;const B=p.isPoint(A)?1:v.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,l);for(var C=0;C<B;C++){const E=v[C];h[0]=A[E[0]];h[1]=A[E[1]];h[2]=A[E[2]];c.transformMat4(h,h,l);e[3*C]=h[0];e[3*C+1]=h[1];e[3*
C+2]=h[2]}if(!w(e,0,B))return null;p.empty(A);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(v=0;v<3*B;v+=3){for(C=0;3>C;C++)A[C]=Math.min(A[C],e[v+C]),A[C+3]=Math.max(A[C+3],e[v+C]);w&&x.push({location:e.slice(v,v+3),screenSpaceBoundingRect:w})}if(r&&(p.center(A,z),"absolute-height"!==this.elevationContext.mode)){let E;x=k.demResolutionForBoundingBox(A,r.service.spatialReference,r);try{E=await r.service.queryElevation(z[0],z[1],D,x,"ground")}catch(F){}null!=
E&&p.offset(A,0,0,-this.alignedSampledElevation+E)}return A};t.addObjectState=function(w,r){w===d.Object3DState.Highlight&&(w=new f.Object3DStateID(w),this._addHighlightId(w),r.addExternal(x=>{this._removeHighlightId(x)},w))};t.removeObjectState=function(w){this._highlights.forEach(r=>w.remove(r))};t._addHighlightId=function(w){this._highlights.add(w);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};t._removeHighlightId=function(w){this._highlights.delete(w);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(m,[{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return m}();const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=y.create(),z=y.create(),n=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],l=b.create();return g})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function c(y){const p=[];y.stageResources.geometries.forEach(u=>
{p.push(new b.LodComponentResources(u,y.stageResources.textures))});return{components:p,minScreenSpaceRadius:y.lodThreshold??0,pivotOffset:y.pivotOffset}}a.makeLodResources=function(y){return{levels:y.map(p=>c(p))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L){function O(N){const R=N.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return R?{fileType:"gltf",url:R[1],specifiedLodIndex:null!=R[4]?Number(R[4]):null}:N.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:N,specifiedLodIndex:null}:{fileType:"unknown",url:N,specifiedLodIndex:null}}function I(N,R,W,T){const P=N.model,Q=[],S=new Map,U=new Map,V=P.lods.length,X=d.empty();P.lods.forEach((Y,Z)=>{const ea=!0===T.skipHighLods&&(1<
V&&0===Z||3<V&&1===Z)||!1===T.skipHighLods&&null!=T.singleLodIndex&&Z!==T.singleLodIndex;if(!ea||0===Z){var ja=new D.ProcessedObjectResource(Y.name,Y.lodThreshold,[0,0,0]);Y.parts.forEach(ha=>{const ia=ea?new K.DefaultMaterial({}):H(P,ha,ja,R,W,S,U);var oa=null!=ia?ia:new K.DefaultMaterial({});const ma=ha.attributes.position.count,fa=w.convertPrimitiveToTriangles(ha.indices||ma,ha.primitiveType);var ba=f.newFloatArray(3*ma);const {typedBuffer:aa,typedBufferStride:da}=ha.attributes.position;e.transformMat4(ba,
aa,ha.transform,3,da);ba=[[M.VertexAttribute.POSITION,new B.Attribute(ba,3,!0)]];const ca=[[M.VertexAttribute.POSITION,fa]];if(null!=ha.attributes.normal){var na=f.newFloatArray(3*ma);const {typedBuffer:sa,typedBufferStride:pa}=ha.attributes.normal;c.normalFromMat4(J,ha.transform);e.transformMat3(na,sa,J,3,pa);ba.push([M.VertexAttribute.NORMAL,new B.Attribute(na,3,!0)]);ca.push([M.VertexAttribute.NORMAL,fa])}if(null!=ha.attributes.tangent){na=f.newFloatArray(4*ma);const {typedBuffer:sa,typedBufferStride:pa}=
ha.attributes.tangent;c.normalFromMat4(J,ha.transform);h.transformMat3(na,sa,J,4,pa);ba.push([M.VertexAttribute.TANGENT,new B.Attribute(na,4,!0)]);ca.push([M.VertexAttribute.TANGENT,fa])}if(null!=ha.attributes.texCoord0){na=f.newFloatArray(2*ma);const {typedBuffer:sa,typedBufferStride:pa}=ha.attributes.texCoord0;z.normalizeIntegerBuffer(na,sa,2,pa);ba.push([M.VertexAttribute.UV0,new B.Attribute(na,2,!0)]);ca.push([M.VertexAttribute.UV0,fa])}null!=ha.attributes.color&&(na=new Uint8Array(4*ma),4===
ha.attributes.color.elementCount?ha.attributes.color instanceof g.BufferViewVec4f?h.scale(na,ha.attributes.color,255):ha.attributes.color instanceof g.BufferViewVec4u8?l.copy(na,ha.attributes.color):ha.attributes.color instanceof g.BufferViewVec4u16&&h.scale(na,ha.attributes.color,1/256):(na.fill(255),ha.attributes.color instanceof g.BufferViewVec3f?e.scale(na,ha.attributes.color,255,4):ha.attributes.color instanceof g.BufferViewVec3u8?n.copy(na,ha.attributes.color.typedBuffer,4,ha.attributes.color.typedBufferStride):
ha.attributes.color instanceof g.BufferViewVec3u16&&e.scale(na,ha.attributes.color,1/256,4)),ba.push([M.VertexAttribute.COLOR,new B.Attribute(na,4,!0)]),ca.push([M.VertexAttribute.COLOR,fa]));ha={geometry:new E.Geometry(oa,ba,ca),vertexCount:ma};const {geometry:qa,vertexCount:ua}=ha;ha=qa.boundingInfo;null!=ha&&0===Z&&(d.expandWithVec3(X,ha.bbMin),d.expandWithVec3(X,ha.bbMax));null!=ia&&(ja.stageResources.geometries.push(qa),ja.numberOfVertices+=ua)});ea||Q.push(ja)}});return{engineResources:Q,referenceBoundingBox:X}}
function H(N,R,W,T,P,Q,S){const U=R.material+(R.attributes.normal?"_normal":"")+(R.attributes.color?"_color":"")+(R.attributes.texCoord0?"_texCoord0":"")+(R.attributes.tangent?"_tangent":""),V=N.materials.get(R.material);var X=null!=R.attributes.texCoord0;const Y=null!=R.attributes.normal;if(null==V)return null;a:{switch(V.alphaMode){case "BLEND":var Z=C.AlphaDiscardMode.Blend;break a;case "MASK":Z=C.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:Z=C.AlphaDiscardMode.Opaque;break a}Z=
void 0}if(!Q.has(U)){if(X){var ea=(aa,da=!1)=>{if(null!=aa&&!S.has(aa)){const ca=N.textures.get(aa);if(null!=ca){const na=ca.data;S.set(aa,new F.Texture(r.isEncodedMeshTexture(na)?na.data:na,{...ca.parameters,preMultiplyAlpha:r.isEncodedMeshTexture(na)?!1:da,encoding:r.isEncodedMeshTexture(na)&&null!=na.encoding?na.encoding:void 0}))}}};ea(V.textureColor,Z!==C.AlphaDiscardMode.Opaque);ea(V.textureNormal);ea(V.textureOcclusion);ea(V.textureEmissive);ea(V.textureMetallicRoughness)}ea=V.color[0]**(1/
G.COLOR_GAMMA);const ja=V.color[1]**(1/G.COLOR_GAMMA),ha=V.color[2]**(1/G.COLOR_GAMMA),ia=V.emissiveFactor[0]**(1/G.COLOR_GAMMA),oa=V.emissiveFactor[1]**(1/G.COLOR_GAMMA),ma=V.emissiveFactor[2]**(1/G.COLOR_GAMMA),fa=null!=V.textureColor&&X?S.get(V.textureColor):null,ba=L.useSchematicPBR({normalTexture:V.textureNormal,metallicRoughnessTexture:V.textureMetallicRoughness,metallicFactor:V.metallicFactor,roughnessFactor:V.roughnessFactor,emissiveTexture:V.textureEmissive,emissiveFactor:V.emissiveFactor,
occlusionTexture:V.textureOcclusion});Q.set(U,new K.DefaultMaterial({...T,transparent:Z===C.AlphaDiscardMode.Blend,customDepthTest:C.DepthTestFunction.Lequal,textureAlphaMode:Z,textureAlphaCutoff:V.alphaCutoff,diffuse:[ea,ja,ha],ambient:[ea,ja,ha],opacity:V.opacity,doubleSided:V.doubleSided,doubleSidedType:"winding-order",cullFace:V.doubleSided?C.CullFaceOptions.None:C.CullFaceOptions.Back,hasVertexColors:!!R.attributes.color,hasVertexTangents:!!R.attributes.tangent,normalType:Y?v.NormalType.Attribute:
v.NormalType.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:null!=fa?fa.id:void 0,colorMixMode:V.colorMixMode,normalTextureId:null!=V.textureNormal&&X?S.get(V.textureNormal).id:void 0,textureAlphaPremultiplied:null!=fa&&!!fa.parameters.preMultiplyAlpha,occlusionTextureId:null!=V.textureOcclusion&&X?S.get(V.textureOcclusion).id:void 0,emissiveTextureId:null!=V.textureEmissive&&X?S.get(V.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=V.textureMetallicRoughness&&X?S.get(V.textureMetallicRoughness).id:
void 0,emissiveFactor:[ia,oa,ma],mrrFactors:ba?[...L.defaultSchematicMRRFactors]:[V.metallicFactor,V.roughnessFactor,T.mrrFactors[2]],isSchematic:ba,colorTextureTransformMatrix:x.getTransformMatrix(V.colorTextureTransform),normalTextureTransformMatrix:x.getTransformMatrix(V.normalTextureTransform),occlusionTextureTransformMatrix:x.getTransformMatrix(V.occlusionTextureTransform),emissiveTextureTransformMatrix:x.getTransformMatrix(V.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:x.getTransformMatrix(V.metallicRoughnessTextureTransform),
...P}))}R=Q.get(U);W.stageResources.materials.push(R);X&&(X=ja=>{null!=ja&&W.stageResources.textures.push(S.get(ja))},X(V.textureColor),X(V.textureNormal),X(V.textureOcclusion),X(V.textureEmissive),X(V.textureMetallicRoughness));return R}const J=y.create();a.fetch=async function(N,R){N=O(b.adjustStaticAGOUrl(N));if("wosr"===N.fileType){N=await (R.cache?R.cache.loadWOSR(N.url,R):A.load(N.url,R));const {engineResources:Y,referenceBoundingBox:Z}=A.processLoadResult(N,R);return{lods:Y,referenceBoundingBox:Z,
isEsriSymbolResource:!1,isWosr:!0}}const W=await (R.cache?R.cache.loadGLTF(N.url,R,!!R.usePBR):t.loadGLTF(new m.DefaultLoadingContext(R.streamDataRequester),N.url,R,R.usePBR)),T=W.model.meta?.ESRI_proxyEllipsoid,P=W.meta.isEsriSymbolResource&&null!=T&&W.meta.uri.includes("/RealisticTrees/");if(P&&!W.customMeta.esriTreeRendering){W.customMeta.esriTreeRendering=!0;a:for(let Y=0;Y<W.model.lods.length;++Y){var Q=W.model.lods[Y];for(var S of Q.parts){Q=S.attributes.normal;if(null==Q)break a;const Z=S.attributes.position,
ea=Z.count,ja=k.create(),ha=k.create(),ia=k.create(),oa=new Uint8Array(4*ea),ma=new Float64Array(3*ea),fa=p.invert(u.create(),S.transform);let ba=0,aa=0;for(let da=0;da<ea;da++){Z.getVec(da,ha);Q.getVec(da,ja);q.transformMat4(ha,ha,S.transform);q.subtract(ia,ha,T.center);q.divide(ia,ia,T.radius);const ca=ia[2];var U=q.length(ia);U=Math.min(.45+.55*U*U,1);q.divide(ia,ia,T.radius);null!==fa&&q.transformMat4(ia,ia,fa);q.normalize(ia,ia);Y+1!==W.model.lods.length&&1<W.model.lods.length&&(-1<ca?q.lerp(ia,
ia,ja,.2):q.lerp(ia,ia,ja,Math.min(-4*ca-3.8,1)));ma[ba]=ia[0];ma[ba+1]=ia[1];ma[ba+2]=ia[2];ba+=3;oa[aa]=255*U;oa[aa+1]=255*U;oa[aa+2]=255*U;oa[aa+3]=255;aa+=4}S.attributes.normal=new g.BufferViewVec3f(ma);S.attributes.color=new g.BufferViewVec4u8(oa)}}}S=!!R.usePBR;S=W.meta.isEsriSymbolResource?{usePBR:S,isSchematic:!1,treeRendering:P,mrrFactors:[...L.defaultEsriSymbologyMRRFactors]}:{usePBR:S,isSchematic:!1,treeRendering:!1,mrrFactors:[...L.defaultAdvancedMRRFactors]};const {engineResources:V,
referenceBoundingBox:X}=I(W,S,{...R.materialParamsMixin,treeRendering:P},R.skipHighLods&&null==N.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:N.specifiedLodIndex});return{lods:V,referenceBoundingBox:X,isEsriSymbolResource:W.meta.isEsriSymbolResource,isWosr:!1}};a.gltfToEngineResources=I;a.parseUrl=O;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,
y=/^[\w-]*\.mapsdevext.arcgis.com$/,p=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,y,p];a.adjustStaticAGOUrl=function(q,k){return q?(k=k||globalThis.location.hostname)?null!=k.match(b)||null!=k.match(y)?q.replace("static.arcgis.com","staticdev.arcgis.com"):null!=k.match(c)||null!=k.match(p)?q.replace("static.arcgis.com","staticqa.arcgis.com"):q:q:q};a.isDevEnvironment=function(q){q=q||globalThis.location.hostname;return u.some(k=>null!=q?.match(k))};
a.isTelemetryDevEnvironment=function(q){q=q||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(u).some(k=>null!=q?.match(k))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(f,g,e){if(f.count!==g.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var h=f.count,z=e[0],n=e[1],l=e[2],m=e[3],t=e[4],w=
e[5],r=e[6],x=e[7],D=e[8],A=e[9],v=e[10],B=e[11],C=e[12],E=e[13],F=e[14];e=e[15];var M=f.typedBuffer;f=f.typedBufferStride;var K=g.typedBuffer;g=g.typedBufferStride;for(let L=0;L<h;L++){const O=L*f;var G=L*g;const I=K[G],H=K[G+1],J=K[G+2];G=K[G+3];M[O]=z*I+t*H+D*J+C*G;M[O+1]=n*I+w*H+A*J+E*G;M[O+2]=l*I+r*H+v*J+F*G;M[O+3]=m*I+x*H+B*J+e*G}}}function y(f,g,e){p(f.typedBuffer,g.typedBuffer,e,f.typedBufferStride,g.typedBufferStride)}function p(f,g,e,h=4,z=h){if(f.length/h!==g.length/z)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var n=f.length/h,l=e[0],m=e[1],t=e[2],w=e[3],r=e[4],x=e[5],D=e[6],A=e[7];e=e[8];var v=0,B=0;for(let C=0;C<n;C++){const E=g[v],F=g[v+1],M=g[v+2],K=g[v+3];f[B]=l*E+w*F+D*M;f[B+1]=m*E+r*F+A*M;f[B+2]=t*E+x*F+e*M;f[B+3]=K;v+=z;B+=h}}}function u(f,g){const e=Math.min(f.count,g.count),h=f.typedBuffer;f=f.typedBufferStride;const z=g.typedBuffer;g=g.typedBufferStride;for(let m=0;m<e;m++){const t=m*f;var n=m*g;const w=z[n],r=z[n+1];n=z[n+2];var l=w*w+r*r+n*n;0<l&&(l=1/Math.sqrt(l),h[t]=l*w,h[t+1]=l*r,
h[t+2]=l*n)}}function q(f,g,e){k(f.typedBuffer,g,e,f.typedBufferStride)}function k(f,g,e,h=4){const z=Math.min(f.length/h,g.count),n=g.typedBuffer;g=g.typedBufferStride;let l=0,m=0;for(let t=0;t<z;t++)f[m]=e*n[l],f[m+1]=e*n[l+1],f[m+2]=e*n[l+2],f[m+3]=e*n[l+3],l+=g,m+=h}const d=Object.freeze(Object.defineProperty({__proto__:null,normalize:u,scale:k,scaleView:q,transformMat3:p,transformMat3View:y,transformMat4:c},Symbol.toStringTag,{value:"Module"}));a.normalize=u;a.scale=k;a.scaleView=q;a.transformMat3=
p;a.transformMat3View=y;a.transformMat4=c;a.vec4=d})},"esri/chunks/vec22":function(){define(["exports","../core/typedArrayUtil"],function(a,b){function c(q,k){y(q.typedBuffer,k.typedBuffer,q.typedBufferStride,k.typedBufferStride)}function y(q,k,d=2,f=d){const g=k.length/2;let e=0,h=0;if(b.isArray(k)||b.isFloat(k))for(var z=0;z<g;++z)q[e]=k[h],q[e+1]=k[h+1],e+=d,h+=f;else if(z=b.maximumValue(k),b.isSigned(k))for(var n=0;n<g;++n)q[e]=Math.max(k[h]/z,-1),q[e+1]=Math.max(k[h+1]/z,-1),e+=d,h+=f;else for(n=
0;n<g;++n)q[e]=k[h]/z,q[e+1]=k[h+1]/z,e+=d,h+=f}function p(q,k,d,f){const g=q.typedBuffer,e=q.typedBufferStride;q=f?.count??q.count;f=(f?.dstIndex??0)*e;for(let h=0;h<q;++h)g[f]=k,g[f+1]=d,f+=e}const u=Object.freeze(Object.defineProperty({__proto__:null,fill:p,normalizeIntegerBuffer:y,normalizeIntegerBufferView:c},Symbol.toStringTag,{value:"Module"}));a.fill=p;a.normalizeIntegerBuffer=y;a.normalizeIntegerBufferView=c;a.vec2=u})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(u,
q){c(u.typedBuffer,q.typedBuffer,u.typedBufferStride,q.typedBufferStride)}function c(u,q,k=3,d=k){const f=q.length/d;let g=0,e=0;for(let h=0;h<f;++h)u[g]=q[e],u[g+1]=q[e+1],u[g+2]=q[e+2],g+=k,e+=d}function y(u,q,k,d,f){const g=u.typedBuffer,e=u.typedBufferStride;u=f?.count??u.count;f=(f?.dstIndex??0)*e;for(let h=0;h<u;++h)g[f]=q,g[f+1]=k,g[f+2]=d,f+=e}const p=Object.freeze(Object.defineProperty({__proto__:null,copy:c,copyView:b,fill:y},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.copyView=b;a.fill=
y;a.vec3=p})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(u,q){c(u.typedBuffer,q,u.typedBufferStride)}function c(u,q,k=4){const d=q.typedBuffer,f=q.typedBufferStride;q=q.count;let g=0,e=0;for(let h=0;h<q;++h)u[g]=d[e],u[g+1]=d[e+1],u[g+2]=d[e+2],u[g+3]=d[e+3],g+=k,e+=f}function y(u,q,k,d,f,g){const e=u.typedBuffer,h=u.typedBufferStride;u=g?.count??u.count;g=(g?.dstIndex??0)*h;for(let z=0;z<u;++z)e[g]=q,e[g+1]=k,e[g+2]=d,e[g+3]=f,g+=h}const p=Object.freeze(Object.defineProperty({__proto__:null,
copy:c,copyView:b,fill:y},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.copyView=b;a.fill=y;a.vec4=p})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,b,c,y,p,u,q){let k=function(){function f(e){this._streamDataRequester=e}var g=f.prototype;g.loadJSON=async function(e,h){return this._load("json",e,
h)};g.loadBinary=async function(e,h){return q.isDataProtocol(e)?(u.throwIfAborted(h),q.dataToArrayBuffer(e)):this._load("binary",e,h)};g.loadImage=async function(e,h){return this._load("image",e,h)};g._load=async function(e,h,z){if(null==this._streamDataRequester)return(await c(h,{responseType:d[e]})).data;e=await y.result(this._streamDataRequester.request(h,e,z));if(!0===e.ok)return e.value;u.throwIfAbortError(e.error);throw new p("",`Request for resource failed: ${e.error}`);};return b._createClass(f)}();
const d={image:"image",binary:"array-buffer",json:"json","image+type":void 0};a.DefaultLoadingContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../chunks/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,y,p,u){function q(e){let h=null;e.json.nodes.forEach(z=>{z=z.extras;null!=z&&(z.ESRI_proxyEllipsoid||z.ESRI_lod)&&(h=z)});return h}async function k(e,h){async function z(w,
r){const x=n.nodes[w];w=e.getNodeTransform(w);null!=x.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=x.mesh){const D=n.meshes[x.mesh];for(const A of D.primitives)t.push(h(A,w,r,D.name))}for(const D of x.children||[])t.push(z(D,r))}const n=e.json;var l=n.scenes[n.scene||0].nodes;const m=1<l.length,t=[];for(const w of l)l=n.nodes[w],t.push(z(w,0)),l.extensions&&l.extensions.MSFT_lod&&Array.isArray(l.extensions.MSFT_lod.ids)&&!m&&l.extensions.MSFT_lod.ids.forEach((r,
x)=>z(r,x+1));await Promise.all(t)}function d(e,h,z){const n=m=>{const t=`${z}_tex_${m&&m.id}${m&&m.name?"_"+m.name:""}`;m&&!e.textures.has(t)&&(m=y.makeTextureSource(m.data,{wrap:{s:m.wrapS,t:m.wrapT},mipmap:g.includes(m.minFilter),noUnpackFlip:!0}),e.textures.set(t,m));return t},l=`${z}_mat_${h.id}_${h.name}`;e.materials.has(l)||(h=y.makeMaterialParameters({color:[h.color[0],h.color[1],h.color[2]],opacity:h.color[3],alphaMode:h.alphaMode,alphaCutoff:h.alphaCutoff,doubleSided:h.doubleSided,colorMixMode:h.ESRI_externalColorMixMode,
textureColor:h.colorTexture?n(h.colorTexture):void 0,textureNormal:h.normalTexture?n(h.normalTexture):void 0,textureOcclusion:h.occlusionTexture?n(h.occlusionTexture):void 0,textureEmissive:h.emissiveTexture?n(h.emissiveTexture):void 0,textureMetallicRoughness:h.metallicRoughnessTexture?n(h.metallicRoughnessTexture):void 0,emissiveFactor:[h.emissiveFactor[0],h.emissiveFactor[1],h.emissiveFactor[2]],colorTextureTransform:h.colorTextureTransform,normalTextureTransform:h.normalTextureTransform,occlusionTextureTransform:h.occlusionTextureTransform,
emissiveTextureTransform:h.emissiveTextureTransform,metallicRoughnessTextureTransform:h.metallicRoughnessTextureTransform,metallicFactor:h.metallicFactor,roughnessFactor:h.roughnessFactor}),e.materials.set(l,h));return l}let f=0;const g=[u.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,u.TextureSamplingMode.LINEAR_MIPMAP_NEAREST];a.loadGLTF=async function(e,h,z={},n=!0){const l=await p.GLTFResource.load(e,h,z),m=`gltf_${f++}`,t={lods:[],materials:new Map,textures:new Map,meta:q(l)};e=!(!l.json.asset.extras||
"symbolResource"!==l.json.asset.extras.ESRI_type);const w=new Map;await k(l,async(x,D,A,v)=>{const B=w.get(A)??0;w.set(A,B+1);var C=void 0!==x.mode?x.mode:u.PrimitiveType.TRIANGLES,E=C===u.PrimitiveType.TRIANGLES||C===u.PrimitiveType.TRIANGLE_STRIP||C===u.PrimitiveType.TRIANGLE_FAN?C:null;if(null==E)b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+u.PrimitiveType[C]+"). Skipping primitive.");else if(l.hasPositions(x)){C=l.getPositionData(x,z);var F=l.getMaterial(x,
z,n),M=l.hasNormals(x)?l.getNormalData(x,z):null,K=l.hasTangents(x)?l.getTangentData(x,z):null,G=l.hasTextureCoordinates(x)?l.getTextureCoordinates(x,z):null,L=l.hasVertexColors(x)?l.getVertexColors(x,z):null;x=l.getIndexData(x,z);D={transform:c.clone(D),attributes:{position:await C,normal:M?await M:null,texCoord0:G?await G:null,color:L?await L:null,tangent:K?await K:null},indices:await x,primitiveType:E,material:d(t,await F,m)};E=null;null!=t.meta&&null!=t.meta.ESRI_lod&&"screenSpaceRadius"===t.meta.ESRI_lod.metric&&
(E=t.meta.ESRI_lod.thresholds[A]);t.lods[A]=t.lods[A]||{parts:[],name:v,lodThreshold:E};t.lods[A].parts[B]=D}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});for(var r of t.lods)r.parts=r.parts.filter(x=>!!x);r=await l.getLoadedBuffersSize();return{model:t,meta:{isEsriSymbolResource:e,uri:l.uri},customMeta:{},size:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports",
"../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,
0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,y={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...y.wrap},noUnpackFlip:!0,mipmap:!1,...y}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){function D(F){switch(F.componentType){case x.DataType.BYTE:return new h.BufferViewVec2i8(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case x.DataType.UNSIGNED_BYTE:return new h.BufferViewVec2u8(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case x.DataType.SHORT:return new h.BufferViewVec2i16(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case x.DataType.UNSIGNED_SHORT:return new h.BufferViewVec2u16(F.raw,
F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case x.DataType.UNSIGNED_INT:return new h.BufferViewVec2u32(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount);case x.DataType.FLOAT:return new h.BufferViewVec2f(F.raw,F.byteOffset,F.byteStride,F.byteOffset+F.byteStride*F.entryCount)}}n=function(){function F(K,G,L,O){this._context=K;this.uri=G;this.json=L;this._glbBuffer=O;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu"];this._baseUri=w.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==L.scenes)throw new c("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==L.meshes)throw new c("gltf-loader-unsupported-feature","Meshes must be defined");if(null==L.nodes)throw new c("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}F.load=async function(K,G,L){if(q.isDataProtocol(G)){var O=q.dataComponents(G);if(O&&"model/gltf-binary"!==O.mediaType)try{const I=JSON.parse(O.isBase64?atob(O.data):O.data);return new F(K,G,I)}catch{}O=q.dataToArrayBuffer(G);if(F._isGLBData(O))return this._fromGLBData(K,G,O)}if(G.endsWith(".gltf"))return L=await K.loadJSON(G,L),new F(K,G,L);O=await K.loadBinary(G,L);if(F._isGLBData(O))return this._fromGLBData(K,G,O);L=await K.loadJSON(G,L);return new F(K,G,L)};F._isGLBData=
function(K){if(null==K)return!1;K=new l.BinaryStreamReader(K);return 4<=K.remainingBytes()&&1179937895===K.readUint32()};F._fromGLBData=async function(K,G,L){L=await F._parseGLBData(L);return new F(K,G,L.json,L.binaryData)};F._parseGLBData=async function(K){const G=new l.BinaryStreamReader(K);if(12>G.remainingBytes())throw new c("gltf-loader-error","GLB binary data is insufficiently large.");var L=G.readUint32(),O=G.readUint32();const I=G.readUint32();if(1179937895!==L)throw new c("gltf-loader-error",
"Magic first 4 bytes do not fit to expected GLB value.");if(K.byteLength<I)throw new c("gltf-loader-error","GLB binary data is smaller than header specifies.");if(2!==O)throw new c("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");K=0;let H,J;for(;8<=G.remainingBytes();){L=G.readUint32();O=G.readUint32();if(0===K){if(1313821514!==O)throw new c("gltf-loader-error","First GLB chunk must be JSON.");if(0>L)throw new c("gltf-loader-error",
"No JSON data found.");H=await r.jsonFromBinaryData(G.readUint8Array(L))}else if(1===K){if(5130562!==O)throw new c("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");J=G.readUint8Array(L)}else y.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");K+=1}if(!H)throw new c("gltf-loader-error","No GLB JSON chunk detected.");return{json:H,binaryData:J}};var M=F.prototype;M.getBuffer=async function(K,G){const L=this.json.buffers[K];
if(null==L.uri){if(null==this._glbBuffer)throw new c("gltf-loader-error","GLB buffer not present");return this._glbBuffer}K=await this._getBufferLoader(K,G);if(K.byteLength!==L.byteLength)throw new c("gltf-loader-error","Buffer byte lengths should match.");return K};M._getBufferLoader=async function(K,G){const L=this._bufferLoaders.get(K);if(L)return L;G=this._context.loadBinary(this._resolveUri(this.json.buffers[K].uri),G).then(O=>new Uint8Array(O));this._bufferLoaders.set(K,G);return G};M.getAccessor=
async function(K,G){if(!this.json.accessors)throw new c("gltf-loader-unsupported-feature","Accessors missing.");K=this.json.accessors[K];if(null==K?.bufferView)throw new c("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(K.type in[m.AttributeType.MAT2,m.AttributeType.MAT3,m.AttributeType.MAT4])throw new c("gltf-loader-unsupported-feature",`AttributeType ${K.type} is not supported`);const L=this.json.bufferViews[K.bufferView];G=await this.getBuffer(L.buffer,G);const O=
C[K.type],I=E[K.componentType],H=O*I,J=L.byteStride||H;return{raw:G.buffer,byteStride:J,byteOffset:G.byteOffset+(L.byteOffset||0)+(K.byteOffset||0),entryCount:K.count,isDenselyPacked:J===H,componentCount:O,componentByteSize:I,componentType:K.componentType,min:K.min,max:K.max,normalized:!!K.normalized}};M.getIndexData=async function(K,G){if(null!=K.indices)if(K=await this.getAccessor(K.indices,G),K.isDenselyPacked)switch(K.componentType){case x.DataType.UNSIGNED_BYTE:return new Uint8Array(K.raw,K.byteOffset,
K.entryCount);case x.DataType.UNSIGNED_SHORT:return new Uint16Array(K.raw,K.byteOffset,K.entryCount);case x.DataType.UNSIGNED_INT:return new Uint32Array(K.raw,K.byteOffset,K.entryCount)}else switch(K.componentType){case x.DataType.UNSIGNED_BYTE:return z.makeDense(this._wrapAccessor(h.BufferViewUint8,K));case x.DataType.UNSIGNED_SHORT:return z.makeDense(this._wrapAccessor(h.BufferViewUint16,K));case x.DataType.UNSIGNED_INT:return z.makeDense(this._wrapAccessor(h.BufferViewUint32,K))}};M.getPositionData=
async function(K,G){if(null==K.attributes.POSITION)throw new c("gltf-loader-unsupported-feature","No POSITION vertex data found.");K=await this.getAccessor(K.attributes.POSITION,G);if(K.componentType!==x.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+x.DataType[K.componentType]);if(3!==K.componentCount)throw new c("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+K.componentCount.toFixed());
return this._wrapAccessor(h.BufferViewVec3f,K)};M.getNormalData=async function(K,G){if(null==K.attributes.NORMAL)throw new c("gltf-loader-error","No NORMAL vertex data found.");K=await this.getAccessor(K.attributes.NORMAL,G);if(K.componentType!==x.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+x.DataType[K.componentType]);if(3!==K.componentCount)throw new c("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
K.componentCount.toFixed());return this._wrapAccessor(h.BufferViewVec3f,K)};M.getTangentData=async function(K,G){if(null==K.attributes.TANGENT)throw new c("gltf-loader-error","No TANGENT vertex data found.");K=await this.getAccessor(K.attributes.TANGENT,G);if(K.componentType!==x.DataType.FLOAT)throw new c("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+x.DataType[K.componentType]);if(4!==K.componentCount)throw new c("gltf-loader-unsupported-feature",
"TANGENT vertex attribute must have 4 components, but found "+K.componentCount.toFixed());return new h.BufferViewVec4f(K.raw,K.byteOffset,K.byteStride,K.byteOffset+K.byteStride*K.entryCount)};M.getTextureCoordinates=async function(K,G){if(null==K.attributes.TEXCOORD_0)throw new c("gltf-loader-error","No TEXCOORD_0 vertex data found.");K=await this.getAccessor(K.attributes.TEXCOORD_0,G);if(2!==K.componentCount)throw new c("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+
K.componentCount.toFixed());if(K.componentType===x.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec2f,K);if(!K.normalized)throw new c("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return D(K)};M.getVertexColors=async function(K,G){if(null==K.attributes.COLOR_0)throw new c("gltf-loader-error","No COLOR_0 vertex data found.");K=await this.getAccessor(K.attributes.COLOR_0,G);if(4!==K.componentCount&&3!==K.componentCount)throw new c("gltf-loader-unsupported-feature",
"COLOR_0 attribute must have 3 or 4 components, but found "+K.componentCount.toFixed());if(4===K.componentCount){if(K.componentType===x.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec4f,K);if(K.componentType===x.DataType.UNSIGNED_BYTE)return this._wrapAccessor(h.BufferViewVec4u8,K);if(K.componentType===x.DataType.UNSIGNED_SHORT)return this._wrapAccessor(h.BufferViewVec4u16,K)}else if(3===K.componentCount){if(K.componentType===x.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec3f,K);
if(K.componentType===x.DataType.UNSIGNED_BYTE)return this._wrapAccessor(h.BufferViewVec3u8,K);if(K.componentType===x.DataType.UNSIGNED_SHORT)return this._wrapAccessor(h.BufferViewVec3u16,K)}throw new c("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+x.DataType[K.componentType]);};M.hasPositions=function(K){return void 0!==K.attributes.POSITION};M.hasNormals=function(K){return void 0!==K.attributes.NORMAL};M.hasVertexColors=function(K){return void 0!==K.attributes.COLOR_0};
M.hasTextureCoordinates=function(K){return void 0!==K.attributes.TEXCOORD_0};M.hasTangents=function(K){return void 0!==K.attributes.TANGENT};M.getMaterial=async function(K,G,L){var O=K.material?this._materialCache.get(K.material):void 0;if(!O){O=null!=K.material?t.material(this.json.materials[K.material]):t.material();const I=O.pbrMetallicRoughness,H=this.hasVertexColors(K),J=this.getTexture(I.baseColorTexture,G),N=this.getTexture(O.normalTexture,G),R=L?this.getTexture(O.occlusionTexture,G):void 0,
W=L?this.getTexture(O.emissiveTexture,G):void 0;G=L?this.getTexture(I.metallicRoughnessTexture,G):void 0;K=null!=K.material?K.material:-1;O={alphaMode:O.alphaMode,alphaCutoff:O.alphaCutoff,color:I.baseColorFactor,doubleSided:!!O.doubleSided,colorTexture:await J,normalTexture:await N,name:O.name,id:K,occlusionTexture:await R,emissiveTexture:await W,emissiveFactor:O.emissiveFactor,metallicFactor:I.metallicFactor,roughnessFactor:I.roughnessFactor,metallicRoughnessTexture:await G,hasVertexColors:H,ESRI_externalColorMixMode:O.extras.ESRI_externalColorMixMode,
colorTextureTransform:I?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:O.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:O.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:O.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:I?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return O};M.getTexture=async function(K,G){if(K){if(0!==(K.texCoord||0))throw new c("gltf-loader-unsupported-feature",
"Only TEXCOORD with index 0 is supported.");var L=K.index;K=this.json.textures[L];var O=t.textureSampler(null!=K.sampler?this.json.samplers[K.sampler]:{}),I=this._getTextureSourceId(K),H=this.json.images[I],J=await this._loadTextureImageData(L,K,G);return p.getOrCreateMapValue(this._textureCache,L,()=>{const N=W=>33071===W||33648===W||10497===W,R=W=>{throw new c("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${W}`);};return{data:J,wrapS:N(O.wrapS)?O.wrapS:R(O.wrapS),wrapT:N(O.wrapT)?O.wrapT:
R(O.wrapT),minFilter:O.minFilter,name:H.name,id:L}})}};M.getNodeTransform=function(K){if(void 0===K)return A;var G=this._nodeTransformCache.get(K);if(!G){G=this.getNodeTransform(this._getNodeParent(K));const L=this.json.nodes[K];L.matrix?G=d.multiply(f.create(),G,L.matrix):L.translation||L.rotation||L.scale?(G=f.clone(G),L.translation&&d.translate(G,G,L.translation),L.rotation&&(B[3]=g.getAxisAngle(B,L.rotation),d.rotate(G,G,B[3],B)),L.scale&&d.scale(G,G,L.scale)):G=f.clone(G);this._nodeTransformCache.set(K,
G)}return G};M._wrapAccessor=function(K,G){return new K(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*(G.entryCount-1)+G.componentByteSize*G.componentCount)};M._resolveUri=function(K){return q.makeAbsolute(K,this._baseUri)};M._getNodeParent=function(K){return this._nodeParentMap.get(K)};M._checkVersionSupported=function(){const K=k.Version.parse(this.json.asset.version,"glTF");v.validate(K)};M._checkRequiredExtensionsSupported=function(){const K=this.json;if(K.extensionsRequired&&!K.extensionsRequired.every(G=>
this._supportedExtensions.includes(G)))throw new c("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+K.extensionsRequired.join(", "));};M._computeNodeParents=function(){this.json.nodes.forEach((K,G)=>{K.children&&K.children.forEach(L=>{this._nodeParentMap.set(L,G)})})};M._loadTextureImageData=async function(K,G,L){const O=this._textureLoaders.get(K);if(O)return O;G=this._createTextureLoader(G,L);this._textureLoaders.set(K,G);return G};
M._getTextureSourceId=function(K){if(void 0!==K.extensions&&null!==K.extensions.KHR_texture_basisu)return K.extensions.KHR_texture_basisu.source;if(null!==K.source)return K.source;throw new c("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");};M._createTextureLoader=async function(K,G){K=this._getTextureSourceId(K);K=this.json.images[K];if(K.uri)return K.uri.endsWith(".ktx2")?(G=await this._context.loadBinary(this._resolveUri(K.uri),
G),new r.EncodedMeshTexture(new Uint8Array(G))):this._context.loadImage(this._resolveUri(K.uri),G);if(null==K.bufferView)throw new c("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==K.mimeType)throw new c("gltf-loader-unsupported-feature","Image mimeType must be defined.");const L=this.json.bufferViews[K.bufferView];G=await this.getBuffer(L.buffer,G);if(null!=L.byteStride)throw new c("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return r.imageFromBinaryData(new Uint8Array(G.buffer,
G.byteOffset+(L.byteOffset||0),L.byteLength),K.mimeType)};M.getLoadedBuffersSize=async function(){if(this._glbBuffer)return this._glbBuffer.byteLength;const K=await u.eachAlwaysValues(Array.from(this._bufferLoaders.values())),G=await u.eachAlwaysValues(Array.from(this._textureLoaders.values()));return K.reduce((L,O)=>L+(O?.byteLength??0),0)+G.reduce((L,O)=>L+(O?r.isEncodedMeshTexture(O)?O.data.byteLength:O.width*O.height*4:0),0)};return b._createClass(F)}();const A=d.fromXRotation(f.create(),Math.PI/
2),v=new k.Version(2,0,"glTF"),B=e.create(),C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={[x.DataType.BYTE]:1,[x.DataType.UNSIGNED_BYTE]:1,[x.DataType.SHORT]:2,[x.DataType.UNSIGNED_SHORT]:2,[x.DataType.FLOAT]:4,[x.DataType.INT]:4,[x.DataType.UNSIGNED_INT]:4};a.GLTFResource=n;a.TRANSFORM_GLTF_TO_ENGINE=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(y,p){const u=y.count;p||(p=new y.TypedArrayConstructor(u));
for(let q=0;q<u;q++)p[q]=y.get(q);return p}const c=Object.freeze(Object.defineProperty({__proto__:null,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.makeDense=b;a.scalar=c})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._data=u;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}var p=y.prototype;p.readUint32=function(){const u=
this._offset4;this._offset4+=1;return this._dataUint32[u]};p.readUint8Array=function(u){const q=4*this._offset4;this._offset4+=u/4;return new Uint8Array(this._data,q,u)};p.remainingBytes=function(){return this._data.byteLength-4*this._offset4};return b._createClass(y)}();a.BinaryStreamReader=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";
b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const y=
{baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},p={pbrMetallicRoughness:y,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},u={ESRI_externalColorMixMode:"tint"},q={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(k={})=>{const d={...y,...k.pbrMetallicRoughness};var f={...u,...k.extras};switch(f.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:b.neverReached(f.ESRI_externalColorMixMode),f.ESRI_externalColorMixMode="tint"}return{...p,...k,pbrMetallicRoughness:d,extras:f}};a.textureSampler=k=>({...q,...k});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let c,y;b.replace(/^(.*\/)?([^/]*)$/,(p,u,q)=>{c=u||"";y=q||"";return""});return{dirPart:c,filePart:y}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(a,b,c,y){a.convertPrimitiveToTriangles=function(p,u){switch(u){case y.PrimitiveType.TRIANGLES:return p="number"===typeof p?c.getContinuousIndexArray(p):b.isUint8Array(p)?new Uint16Array(p):p,p;case y.PrimitiveType.TRIANGLE_STRIP:u="number"===typeof p?p:p.length;if(3>u)p=[];else{u-=2;var q=c.newIndexArray(3*u);if("number"===
typeof p){p=0;for(var k=0;k<u;k+=1)0===k%2?(q[p++]=k,q[p++]=k+1):(q[p++]=k+1,q[p++]=k),q[p++]=k+2}else{k=0;for(var d=0;d<u;d+=1)0===d%2?(q[k++]=p[d],q[k++]=p[d+1]):(q[k++]=p[d+1],q[k++]=p[d]),q[k++]=p[d+2]}p=q}return p;case y.PrimitiveType.TRIANGLE_FAN:u="number"===typeof p?p:p.length;if(3>u)p=new Uint16Array(0);else{u-=2;q=65536>=u?new Uint16Array(3*u):new Uint32Array(3*u);if("number"===typeof p)for(p=0,k=0;k<u;++k)q[p++]=0,q[p++]=k+1,q[p++]=k+2;else{k=p[0];d=p[1];var f=0;for(let g=0;g<u;++g){const e=
p[g+2];q[f++]=k;q[f++]=d;d=q[f++]=e}}p=q}return p}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.geometries=[];this.materials=[];this.textures=[]});b=b._createClass(function(y,p,u){this.name=y;this.lodThreshold=p;this.pivotOffset=u;this.stageResources=new c;this.numberOfVertices=0});a.ProcessedObjectResource=
b;a.ProcessedObjectStageResources=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){async function r(K,G){const L=null!=G&&G.streamDataRequester;if(L)return x(K,L,G);K=await c.result(b(K,G));if(!0===K.ok)return K.value.data;k.throwIfAbortError(K.error);D(K.error)}async function x(K,G,L){K=await c.result(G.request(K,"json",L));if(!0===K.ok)return K.value;k.throwIfAbortError(K.error);D(K.error.details.url)}function D(K){throw new p("",`Request for object resource failed: ${K}`);}function A(K){var G=K.params,L=G.topology;let O=!0;G.vertexAttributes||
(F.warn("Geometry must specify vertex attributes"),O=!1);switch(G.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:L=G.faces;if(!L)F.warn("Indexed geometries must specify faces"),O=!1;else if(G.vertexAttributes)for(const I in G.vertexAttributes)(G=L[I])&&G.values?(null!=G.valueType&&"UInt32"!==G.valueType&&(F.warn(`Unsupported indexed geometry indices type '${G.valueType}', only UInt32 is currently supported`),O=!1),null!=G.valuesPerElement&&1!==G.valuesPerElement&&(F.warn(`Unsupported indexed geometry values per element '${G.valuesPerElement}', only 1 is currently supported`),
O=!1)):(F.warn(`Indexed geometry does not specify face indices for '${I}' attribute`),O=!1);break;default:F.warn(`Unsupported topology '${L}'`),O=!1}K.params.material||(F.warn("Geometry requires material"),O=!1);K=K.params.vertexAttributes;for(const I in K)K[I].values||(F.warn("Geometries with externally defined attributes are not yet supported"),O=!1);return O}function v(K){const G=g.empty();K.forEach(L=>{L=L.boundingInfo;null!=L&&(g.expandWithVec3(G,L.bbMin),g.expandWithVec3(G,L.bbMax))});return G}
async function B(K,G){const L=[];for(const H in K){var O=K[H],I=O.images[0].data;if(!I){F.warn("Externally referenced texture data is not yet supported");continue}I=O.encoding+";base64,"+I;const J="/textureDefinitions/"+H,N="rgba"===O.channels?O.alphaChannelUsage||"transparency":"none",R={noUnpackFlip:!0,wrap:{s:w.TextureWrapMode.REPEAT,t:w.TextureWrapMode.REPEAT},preMultiplyAlpha:C(N)!==z.AlphaDiscardMode.Opaque};O=null!=G&&G.disableTextures?Promise.resolve(null):e.requestImage(I,G);L.push(O.then(W=>
({refId:J,image:W,parameters:R,alphaChannelUsage:N})))}K=await Promise.all(L);G={};for(const H of K)G[H.refId]=H;return G}function C(K){switch(K){case "mask":return z.AlphaDiscardMode.Mask;case "maskAndTransparency":return z.AlphaDiscardMode.MaskBlend;case "none":return z.AlphaDiscardMode.Opaque;case "transparency":return z.AlphaDiscardMode.Blend;default:return z.AlphaDiscardMode.Blend}}function E(K){K=K.params;return{id:1,material:K.material,texture:K.texture,region:K.texture}}const F=u.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
M=new d.Version(1,2,"wosr");a.createTextureResources=B;a.load=async function(K,G){K=await r(K,G);G=await B(K.textureDefinitions??{},G);let L=0;for(const O in G)if(G.hasOwnProperty(O)){const I=G[O];L+=I?.image?I.image.width*I.image.height*4:0}return{resource:K,textures:G,size:L+y.estimateNestedObjectSize(K)}};a.processLoadResult=function(K,G){const L=[],O=[],I=[],H=new q.NestedMap,J=K.resource;var N=d.Version.parse(J.version||"1.0","wosr");M.validate(N);N=J.model.name;const R=J.model.geometries,W=
J.materialDefinitions??{};K=K.textures;let T=0;const P=new Map;for(let ja=0;ja<R.length;ja++){var Q=R[ja];if(A(Q)){var S=E(Q),U=Q.params.vertexAttributes,V=[];for(const ha in U){var X=U[ha];V.push([ha,new h.Attribute(X.values,X.valuesPerElement,!0)])}U=[];if("PerAttributeArray"!==Q.params.topology){Q=Q.params.faces;for(const ha in Q)U.push([ha,Q[ha].values])}Q=S.texture;if((X=K&&K[Q])&&!P.has(Q)){const {image:ha,parameters:ia}=X;var Y=new l.Texture(ha,ia);O.push(Y);P.set(Q,Y)}Y=(Y=P.get(Q))?Y.id:
void 0;S=S.material;var Z=H.get(S,Q);if(null==Z){Z=S.substring(S.lastIndexOf("/")+1);Z=W[Z].params;1===Z.transparency&&(Z.transparency=0);var ea=X&&X.alphaChannelUsage;ea=0<Z.transparency||"transparency"===ea||"maskAndTransparency"===ea;const ha=X?C(X.alphaChannelUsage):void 0;X={ambient:f.fromArray(Z.diffuse),diffuse:f.fromArray(Z.diffuse),opacity:1-(Z.transparency||0),transparent:ea,textureAlphaMode:ha,textureAlphaCutoff:.33,textureId:Y,initTextureTransparent:!0,doubleSided:!0,cullFace:z.CullFaceOptions.None,
colorMixMode:Z.externalColorMixMode||"tint",textureAlphaPremultiplied:X?.parameters.preMultiplyAlpha??!1};null!=G&&G.materialParamsMixin&&Object.assign(X,G.materialParamsMixin);Z=new t.DefaultMaterial(X);H.set(S,Q,Z)}I.push(Z);V=new n.Geometry(Z,V,U);T+=U.find(ha=>ha[0]===m.VertexAttribute.POSITION)?.[1].length??0;L.push(V)}}return{engineResources:[{name:N,stageResources:{textures:O,materials:I,geometries:L},pivotOffset:J.model.pivotOffset,numberOfVertices:T,lodThreshold:null}],referenceBoundingBox:v(L)}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/webStyleUtils":function(){define(["exports","../../../../core/Error","../../../../symbols/support/styleUtils","../../../../symbols/support/webStyleSymbolUtils"],function(a,b,c,y){a.getResourceUrlFromSymbolStyle=async function(p){if(null===
p||null==p.styleName&&null==p.styleUrl)return null;var u=p.name;if(null==u)throw new b("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const q={portal:p.portal};p=await c.fetchStyle(p,q).catch(()=>null);if(null===p)return null;const k=y.getStyleItemFromStyle(u,p.data);if(k&&!k.formatInfos?.some(d=>"gltf_basisu"===d.type))return null;u=await y.fetchSymbolFromStyle(p,u,q,"webRef",(d,f)=>c.symbolUrlFromStyleItem(d,f,["gltf_basisu","gltf"])).catch(()=>
null);if(null===u||"point-3d"!==u.type)return null;u=u.symbolLayers.items[0];return"object"===u.type?u.resource:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/maybe ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e){function h(l,
m){return m.items.find(t=>t.name===l)}function z(l,m,t,w,r,x){const D=t&&null!=t.portal?t.portal:q.getDefault(),A={portal:D,url:u.urlToObject(l.baseUrl),origin:"portal-item"},v=h(m,l.data);if(!v)return Promise.reject(new y("symbolstyleutils:symbol-name-not-found",`The symbol name '${m}' could not be found`,{symbolName:m}));r=k.fromJSON(r(v,w),A);let B=v.thumbnail?.href??null;const C=v.thumbnail&&v.thumbnail.imageData;c.isDevEnvironment()&&(r=c.adjustStaticAGOUrl(r)??"",B=c.adjustStaticAGOUrl(B));
const E={portal:D,url:u.urlToObject(u.removeFile(r)),origin:"portal-item"};return g.requestJSON(r,x).then(F=>{F="cimRef"===w?g.makeCIMSymbolRef(F.data):F.data;if((F=d.fromJSON(F,E))&&b.isSymbol3D(F)){if(B){const M=k.fromJSON(B,A);F.thumbnail=new e.Thumbnail({url:M})}else C&&(F.thumbnail=new e.Thumbnail({url:`data:image/png;base64,${C}`}));l.styleUrl?F.styleOrigin=new f({portal:t.portal,styleUrl:l.styleUrl,name:m}):l.styleName&&(F.styleOrigin=new f({portal:t.portal,styleName:l.styleName,name:m}))}return F})}
function n(l,m,t){const w=g.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,l),r=null!=m.portal?m.portal:q.getDefault();return g.requestJSON(w,t).then(x=>{x=g.makeCIMSymbolRef(x.data);return d.fromJSON(x,{portal:r,url:u.urlToObject(u.removeFile(w)),origin:"portal-item"})})}a.fetchSymbolFromStyle=z;a.getStyleItemFromStyle=h;a.resolveWebStyleSymbol=function(l,m,t,w){const r=l.name;return null==r?Promise.reject(new y("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
l.styleName&&"Esri2DPointSymbolsStyle"===l.styleName?n(r,m,w):g.fetchStyle(l,m,w).then(x=>z(p.unwrapOrThrow(x),r,m,t,g.symbolUrlFromStyleItem,w))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N){function R(Z,ea,ja){const ha=Z.allocateHead();Z=Z.view;I.encodeDoubleVec3(ea.modelOrigin,ja,Z.modelOriginHi,Z.modelOriginLo,ha);Z.model.copyFrom(ha,ea.model,ja);Z.modelNormal.copyFrom(ha,ea.modelNormal,ja);ea.color&&Z.color&&Z.color.copyFrom(ha,ea.color,ja);ea.objectAndLayerIdColor&&Z.objectAndLayerIdColor&&Z.objectAndLayerIdColor.copyFrom(ha,ea.objectAndLayerIdColor,ja);ea.featureAttribute&&Z.featureAttribute&&Z.featureAttribute.copyFrom(ha,
ea.featureAttribute,ja)}function W(Z){let ea=w.newLayout().vec3f(E.VertexAttribute.MODELORIGINHI).vec3f(E.VertexAttribute.MODELORIGINLO).mat3f(E.VertexAttribute.MODEL).mat3f(E.VertexAttribute.MODELNORMAL);null!=Z&&Z.includes("featureAttribute")&&(ea=ea.vec4f(E.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=Z&&Z.includes("color")&&(ea=ea.vec4u8(E.VertexAttribute.INSTANCECOLOR));null!=Z&&Z.includes("objectAndLayerIdColor")&&(ea=ea.vec4u8(E.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));return ea}
const T=Z=>{const ea=Z.baseBoundingSphere.radius;Z=Z.levels.map(ja=>ja.minScreenSpaceRadius);return new K.LevelSelector(ea,Z)};a.LodRenderer=function(Z){function ea(ha,ia){var oa=Z.call(this,ha)||this;oa.type=A.IntersectorType.LOD;oa.isGround=!1;oa._handles=new u;oa._levels=[];oa._defaultRenderInstanceData=[[]];oa._highlightRenderInstanceData=[[]];oa._allRenderInstanceData=[oa._defaultRenderInstanceData[0],oa._highlightRenderInstanceData[0]];oa._instanceIndex=0;oa._cycleStartIndex=0;oa._slicePlane=
!1;oa._camera=new x.Camera;oa._updateCyclesWithStaticCamera=-1;oa._needFullCycle=!1;oa.slots=[B.RenderSlot.OPAQUE_MATERIAL,B.RenderSlot.TRANSPARENT_MATERIAL];oa.canRender=!0;oa._instanceData=new F.InstanceData({shaderTransformation:ha.shaderTransformation},ha.optionalFields);oa._handles.add(ia.registerTask(J.TaskPriority.LOD_RENDERER,b._assertThisInitialized(oa)));return oa}b._inherits(ea,Z);var ja=ea.prototype;ja.initialize=function(){this._instanceBufferLayout=W(this.optionalFields);this._glInstanceBufferLayout=
t.glLayout(this._instanceBufferLayout,1);this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:ha})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(ha)}),this._instanceData.events.on("instance-visibility-changed",({index:ha})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(ha)}),this._instanceData.events.on("instance-highlight-changed",
()=>this._requestUpdateCycle(!0))])};ja.destroy=function(){this._handles.destroy()};ja.initializeRenderContext=async function(ha,ia){this._context=ha;const oa=ha.renderContext.rctx,ma=await Promise.allSettled(this.symbol.levels.map(ba=>{this._defaultRenderInstanceData[0].push(new L.RenderInstanceData(oa,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new L.RenderInstanceData(oa,this._instanceBufferLayout));return G.LodLevel.create(ha,ba,ia)})),fa=ma.map(ba=>"fulfilled"===ba.status?
ba.value:null).filter(p.isSome);if(k.isAborted(ia)||fa.length!==ma.length){fa.forEach(ba=>ba.destroy());k.throwIfAborted(ia);for(const ba of ma)if("rejected"===ba.status)throw ba.reason;}this._levels=fa;this._levelSelector=T(this)};ja.uninitializeRenderContext=function(){this._invalidateOctree();this._levels.forEach(ha=>ha.destroy());this._defaultRenderInstanceData[0].forEach(ha=>ha.destroy());this._highlightRenderInstanceData[0].forEach(ha=>ha.destroy())};ja.prepareRender=function(ha){if(!m.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const ia=
ha.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(ha.bindParameters.contentCamera);ia||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(J.noBudget),this._needFullCycle=!1)}};ja.prepareTechniques=function(ha){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(ha.output))return null;const ia=this._getInstanceDatas(ha.output);if(!ia)return null;const oa=[];ia.forEach(ma=>this.levels.forEach((fa,ba)=>{fa.components.forEach(aa=>oa.push(this._beginComponent(ha,
ma[ba],aa)))}));return oa};ja.render=function(ha,ia){const oa=this._getInstanceDatas(ha.output);if(oa){var ma=0;ha.rctx.bindVAO();oa.forEach(fa=>this.levels.forEach((ba,aa)=>{ba.components.forEach(da=>this._renderComponent(ha,ia[ma++],fa[aa],da,aa))}))}};ja._getInstanceDatas=function(ha){const ia=ha!==r.ShaderOutput.Highlight&&ha!==r.ShaderOutput.ShadowHighlight;ha=ha!==r.ShaderOutput.ShadowExcludeHighlight;return ia&&ha?this._allRenderInstanceData:ia?this._defaultRenderInstanceData:ha?this._highlightRenderInstanceData:
null};ja.intersect=function(ha,ia,oa,ma){if(this.baseMaterial.isVisible()&&null!=this._octree){var fa=n.create();z.subtract(fa,ma,oa);var ba=aa=>{this._instanceData.getCombinedModelTransform(aa,S);ha.transform.set(S);z.transformMat4(U,oa,ha.transform.inverse);z.transformMat4(V,ma,ha.transform.inverse);const da=this._instanceData.getState(aa),ca=this._instanceData.getLodLevel(aa),na=this._levels.length;C.assert(0!==(da&F.StateFlags.ACTIVE),"invalid instance state");C.assert(0<=ca&&ca<na,"invaid lod level");
this._levels[ca].intersect(ha,ia,U,V,aa,this.metadata,na)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(ba):this._octree.forEachAlongRay(oa,fa,ba)}};ja.queryDepthRange=function(ha){return this._queryDepthRangeOctree(ha)};ja.notifyShaderTransformationChanged=function(){this._invalidateOctree();this._requestUpdateCycle()};ja._invalidateOctree=function(){this._octreeCached=q.destroyMaybe(this._octreeCached)};ja._queryDepthRangeOctree=function(ha){if(null==this._octree)return{near:Infinity,
far:-Infinity};var ia=ha.viewForward,oa=this._octree.findClosest(ia,v.DepthOrder.FRONT_TO_BACK,ha.frustum);const ma=this._octree.findClosest(ia,v.DepthOrder.BACK_TO_FRONT,ha.frustum);if(null==oa||null==ma)return{near:Infinity,far:-Infinity};const fa=ha.eye,ba=this._instanceData.view;ba.boundingSphere.getVec(oa,Q);z.subtract(Q,Q,fa);oa=z.dot(Q,ia)-Q[3];ba.boundingSphere.getVec(ma,Q);z.subtract(Q,Q,fa);ia=z.dot(Q,ia)+Q[3];return{near:Math.max(ha.near,oa),far:Math.min(ha.far,ia)}};ja._requestUpdateCycle=
function(ha=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;ha&&(this._needFullCycle=!0,this._context.requestRender())};ja._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._allRenderInstanceData.forEach(ha=>ha.forEach(ia=>ia.startUpdateCycle()))};ja.runTask=function(ha){const {_enableLevelSelection:ia,_camera:oa,_levelSelector:ma}=this;this._allRenderInstanceData.forEach(ua=>ua.forEach(sa=>sa.beginUpdate()));const fa=this._instanceData,ba=
fa.view;let aa=fa.size;const da=fa.capacity;let ca=this._instanceIndex;for(let ua=0;ua<aa&&!ha.done;++ua){ca===this._cycleStartIndex&&this._startUpdateCycle();const sa=ba.state.get(ca);var na=0;if(sa&F.StateFlags.ALLOCATED){var qa=ba.lodLevel.get(ca);sa&F.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][qa].freeTail();sa&F.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][qa].freeTail();sa&F.StateFlags.REMOVE?fa.freeInstance(ca):sa&F.StateFlags.VISIBLE?(qa=0,ia&&(ba.modelOrigin.getVec(ca,
P),qa=ma.selectLevel(P,fa.getCombinedMedianScaleFactor(ca),oa)),na=sa&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED),0<=qa&&(sa&F.StateFlags.HIGHLIGHT?(R(this._highlightRenderInstanceData[0][qa],ba,ca),na|=F.StateFlags.HIGHLIGHT_ACTIVE):(R(this._defaultRenderInstanceData[0][qa],ba,ca),na|=F.StateFlags.DEFAULT_ACTIVE)),ba.state.set(ca,na),ba.lodLevel.set(ca,qa)):(na=sa&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED),ba.state.set(ca,na));null!=this._octreeCached&&(qa=!!(sa&F.StateFlags.ACTIVE),
na=!!(na&F.StateFlags.ACTIVE),!qa&&na?this._octreeCached.addInstance(ca):qa&&!na?this._octreeCached.removeInstance(ca):qa&&na&&sa&F.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ca),this._octreeCached.addInstance(ca)));ca=ca+1===da?0:ca+1;ha.madeProgress()}else ca=ca+1===da?0:ca+1,aa++}this._instanceIndex=ca;this._allRenderInstanceData.forEach(ua=>ua.forEach(sa=>sa.endUpdate()));this._context.requestRender()};ja._beginComponent=function(ha,ia,oa){const {bindParameters:ma,rctx:fa,
output:ba}=ha;if(0===ia.size||!oa.material.requiresSlot(ma.slot,ha.output))return null;ha=oa.glMaterials.load(fa,ma.slot,ba);return null!=ha?ha.beginSlot(ma):null};ja._renderComponent=function(ha,ia,oa,ma,fa){if(ia){var {bindParameters:ba,rctx:aa}=ha;aa.appleAmdDriverHelper?.resetIndicesType();var da=aa.bindTechnique(ia,ma.material.parameters,ba);aa.bindVAO(ma.vao);ia.ensureAttributeLocations(ma.vao);da.bindDraw(Y,ba,ma.material.parameters);m.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&ha.output===r.ShaderOutput.Color&&
(da.setUniform4fv("externalColor",X[Math.min(fa,X.length-1)]),da.setUniform1i("colorMixMode",O.colorMixModes.replace));var ca=aa.capabilities.instancing;ha=oa.capacity;fa=oa.headIndex;da=oa.tailIndex;var na=oa.firstIndex,qa=this._glInstanceBufferLayout,ua=(sa,pa)=>{N.bindVertexBufferLayout(aa,D.Default3D,oa.buffer,qa,sa);ca.drawArraysInstanced(ia.primitiveType,0,ma.vertexCount,pa-sa);N.unbindVertexBufferLayout(aa,D.Default3D,oa.buffer,qa)};ma.material.parameters.transparent&&null!=na?fa>da?(C.assert(na>=
da&&na<=fa,"invalid firstIndex"),ua(na,fa),ua(da,na)):fa<da&&(na<=fa?(C.assert(0<=na&&na<=fa,"invalid firstIndex"),ua(na,fa),ua(da,ha),ua(0,na)):(C.assert(na>=da&&na<=ha,"invalid firstIndex"),ua(na,ha),ua(0,fa),ua(da,na))):fa>da?ua(da,fa):fa<da&&(ua(0,fa),ua(da,ha));aa.bindVAO(null)}};b._createClass(ea,[{key:"_enableLevelSelection",get:function(){return 1<this.symbol.levels.length}},{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-
1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(ha){this._slicePlane=ha}},{key:"layerUid",get:function(){return this.metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const ha={cpu:0,
gpu:0};this._allRenderInstanceData.forEach(ia=>ia.forEach(oa=>{ha.cpu+=oa.memoryUsage.cpu;ha.gpu+=oa.memoryUsage.gpu}));return ha}},{key:"renderStats",get:function(){const ha=this._instanceData.size,ia=[];this._levels.forEach((oa,ma)=>{ma=this._allRenderInstanceData[0][ma].size+this._allRenderInstanceData[1][ma].size;oa=oa.triangleCount;ia.push({renderedInstances:ma,renderedTriangles:ma*oa,trianglesPerInstance:oa})});return{totalInstances:ha,renderedInstances:ia.reduce((oa,ma)=>oa+ma.renderedInstances,
0),renderedTriangles:ia.reduce((oa,ma)=>oa+ma.renderedTriangles,0),levels:ia}}},{key:"needsTransparentPass",get:function(){return this._levels.some(ha=>ha.components.some(ia=>ia.material.requiresSlot(B.RenderSlot.TRANSPARENT_MATERIAL,r.ShaderOutput.Color)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData[0].some(ha=>0<ha.size)}},{key:"_octree",get:function(){if(null==this._octreeCached){const ha=this._instanceData,ia=ha.view?.state;if(!ia)return null;this._octreeCached=
new M.InstanceOctree(ha,this.baseBoundingSphere);for(let oa=0;oa<ha.capacity;++oa)ia.get(oa)&F.StateFlags.ACTIVE&&this._octreeCached.addInstance(oa)}return this._octreeCached}},{key:"running",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}}]);return ea}(y);c.__decorate([d.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);c.__decorate([d.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);c.__decorate([d.property({constructOnly:!0})],
a.LodRenderer.prototype,"metadata",void 0);c.__decorate([d.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);c.__decorate([d.property()],a.LodRenderer.prototype,"_instanceData",void 0);c.__decorate([d.property()],a.LodRenderer.prototype,"_cycleStartIndex",void 0);c.__decorate([d.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);c.__decorate([d.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);c.__decorate([d.property({readOnly:!0})],
a.LodRenderer.prototype,"running",null);a.LodRenderer=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const P=n.create(),Q=l.create(),S=h.create(),U=n.create(),V=n.create(),X=[l.fromValues(1,0,1,1),l.fromValues(0,0,1,1),l.fromValues(0,1,0,1),l.fromValues(1,1,0,1),l.fromValues(1,0,0,1)],Y=new H.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){a.StateFlags=void 0;(function(F){F[F.ALLOCATED=1]="ALLOCATED";F[F.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";F[F.VISIBLE=4]="VISIBLE";F[F.HIGHLIGHT=8]="HIGHLIGHT";F[F.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";F[F.REMOVE=32]="REMOVE";F[F.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";F[F.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let A=b._createClass(function(F){this.localTransform=F.getField(x.VertexAttribute.LOCALTRANSFORM,m.BufferViewMat4f64);this.globalTransform=
F.getField(x.VertexAttribute.GLOBALTRANSFORM,m.BufferViewMat4f64);this.modelOrigin=F.getField(x.VertexAttribute.MODELORIGIN,m.BufferViewVec3f64);this.model=F.getField(x.VertexAttribute.MODEL,m.BufferViewMat3f);this.modelNormal=F.getField(x.VertexAttribute.MODELNORMAL,m.BufferViewMat3f);this.modelScaleFactors=F.getField(x.VertexAttribute.MODELSCALEFACTORS,m.BufferViewVec2f);this.boundingSphere=F.getField(x.VertexAttribute.BOUNDINGSPHERE,m.BufferViewVec4f64);this.featureAttribute=F.getField(x.VertexAttribute.FEATUREATTRIBUTE,
m.BufferViewVec4f);this.color=F.getField(x.VertexAttribute.COLOR,m.BufferViewVec4u8);this.objectAndLayerIdColor=F.getField(x.VertexAttribute.OBJECTANDLAYERIDCOLOR,m.BufferViewVec4u8);this.state=F.getField(x.VertexAttribute.STATE,m.BufferViewUint8);this.lodLevel=F.getField(x.VertexAttribute.LODLEVEL,m.BufferViewUint8)});a.InstanceData=function(F){function M(G,L){G=F.call(this,G)||this;G.events=new u;G._capacity=0;G._size=0;G._next=0;let O=w.newLayout().mat4f64(x.VertexAttribute.LOCALTRANSFORM).mat4f64(x.VertexAttribute.GLOBALTRANSFORM).vec4f64(x.VertexAttribute.BOUNDINGSPHERE).vec3f64(x.VertexAttribute.MODELORIGIN).mat3f(x.VertexAttribute.MODEL).mat3f(x.VertexAttribute.MODELNORMAL).vec2f(x.VertexAttribute.MODELSCALEFACTORS);
L.includes(x.VertexAttribute.FEATUREATTRIBUTE)&&(O=O.vec4f(x.VertexAttribute.FEATUREATTRIBUTE));L.includes(x.VertexAttribute.COLOR)&&(O=O.vec4u8(x.VertexAttribute.COLOR));L.includes(x.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(O=O.vec4u8(x.VertexAttribute.OBJECTANDLAYERIDCOLOR));O=O.u8(x.VertexAttribute.STATE).u8(x.VertexAttribute.LODLEVEL);G._layout=O;G._capacity=D.INITIAL_CAPACITY;G._buffer=G._layout.createBuffer(G._capacity);G._view=new A(G._buffer);return G}b._inherits(M,F);var K=M.prototype;K.addInstance=
function(){this._size+1>this._capacity&&this._grow();const G=this._findSlot();this._view.state.set(G,a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return G};K.removeInstance=function(G){const L=this._view.state;r.assert(0<=G&&G<this._capacity&&0!==(L.get(G)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(G,a.StateFlags.ACTIVE)?this._setStateFlags(G,a.StateFlags.REMOVE):this.freeInstance(G);this.events.emit("instances-changed")};K.freeInstance=function(G){const L=
this._view.state;r.assert(0<=G&&G<this._capacity&&0!==(L.get(G)&a.StateFlags.ALLOCATED),"invalid instance handle");L.set(G,0);this._size--};K.setLocalTransform=function(G,L,O=!0){this._view.localTransform.setMat(G,L);O&&this.updateModelTransform(G)};K.getLocalTransform=function(G,L){this._view.localTransform.getMat(G,L)};K.setGlobalTransform=function(G,L,O=!0){this._view.globalTransform.setMat(G,L);O&&this.updateModelTransform(G)};K.getGlobalTransform=function(G,L){this._view.globalTransform.getMat(G,
L)};K.updateModelTransform=function(G){const L=this._view;var O=v;const I=B;L.localTransform.getMat(G,C);L.globalTransform.getMat(G,E);const H=h.multiply(E,E,C);n.set(O,H[12],H[13],H[14]);L.modelOrigin.setVec(G,O);g.fromMat4(I,H);L.model.setMat(G,I);O=t.scaleFromMatrix(v,H);O.sort();L.modelScaleFactors.set(G,0,O[1]);L.modelScaleFactors.set(G,1,O[2]);g.invert(I,I);g.transpose(I,I);L.modelNormal.setMat(G,I);this._setStateFlags(G,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",
{index:G})};K.getModelTransform=function(G,L){const O=this._view;O.model.getMat(G,B);O.modelOrigin.getVec(G,v);L[0]=B[0];L[1]=B[1];L[2]=B[2];L[3]=0;L[4]=B[3];L[5]=B[4];L[6]=B[5];L[7]=0;L[8]=B[6];L[9]=B[7];L[10]=B[8];L[11]=0;L[12]=v[0];L[13]=v[1];L[14]=v[2];L[15]=1};K.applyShaderTransformation=function(G,L){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,G,L)};K.getCombinedModelTransform=function(G,L){this.getModelTransform(G,L);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,
G,L);return L};K.getCombinedLocalTransform=function(G,L){this._view.localTransform.getMat(G,L);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,G,L)};K.getCombinedMaxScaleFactor=function(G){let L=this._view.modelScaleFactors.get(G,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(v,this,G),L*=Math.max(v[0],v[1],v[2]));return L};K.getCombinedMedianScaleFactor=function(G){let L=this._view.modelScaleFactors.get(G,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(v,
this,G);G=v[0];var O=v[1];L*=Math.max(Math.min(G,O),Math.min(Math.max(G,O),v[2]))}return L};K.getModel=function(G,L){this._view.model.getMat(G,L)};K.setFeatureAttribute=function(G,L){this._view.featureAttribute.setVec(G,L)};K.getFeatureAttribute=function(G,L){this._view.featureAttribute.getVec(G,L)};K.setColor=function(G,L){this._view.color.setVec(G,L)};K.setObjectAndLayerIdColor=function(G,L){this._view.objectAndLayerIdColor.setVec(G,L)};K.setVisible=function(G,L){L!==this.getVisible(G)&&(this._setStateFlag(G,
a.StateFlags.VISIBLE,L),this.events.emit("instance-visibility-changed",{index:G}))};K.getVisible=function(G){return this._getStateFlag(G,a.StateFlags.VISIBLE)};K.setHighlight=function(G,L){L!==this.getHighlight(G)&&(this._setStateFlag(G,a.StateFlags.HIGHLIGHT,L),this.events.emit("instance-highlight-changed"))};K.getHighlight=function(G){return this._getStateFlag(G,a.StateFlags.HIGHLIGHT)};K.getState=function(G){return this._view.state.get(G)};K.getLodLevel=function(G){return this._view.lodLevel.get(G)};
K.countFlags=function(G){let L=0;for(let O=0;O<this._capacity;++O)this.getState(O)&G&&++L;return L};K._setStateFlags=function(G,L){const O=this._view.state;L|=O.get(G);O.set(G,L)};K._clearStateFlags=function(G,L){const O=this._view.state;L=O.get(G)&~L;O.set(G,L)};K._setStateFlag=function(G,L,O){O?this._setStateFlags(G,L):this._clearStateFlags(G,L)};K._getStateFlag=function(G,L){return!!(this._view.state.get(G)&L)};K._grow=function(){this._capacity=Math.max(D.INITIAL_CAPACITY,Math.floor(this._capacity*
p.ReallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);this._view=new A(this._buffer)};K._findSlot=function(){const G=this._view.state;let L=this._next;for(;G.get(L)&a.StateFlags.ALLOCATED;)L=L+1===this._capacity?0:L+1;this._next=L+1===this._capacity?0:L+1;return L};b._createClass(M,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"view",get:function(){return this._view}}]);return M}(y);c.__decorate([q.property({constructOnly:!0})],
a.InstanceData.prototype,"shaderTransformation",void 0);c.__decorate([q.property()],a.InstanceData.prototype,"_size",void 0);c.__decorate([q.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const v=l.create(),B=e.create(),C=z.create(),E=z.create();a.InstanceDataView=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,y,p,u,q){let k=b._createClass(function(f){this.modelOriginHi=f.getField(u.VertexAttribute.MODELORIGINHI,y.BufferViewVec3f);this.modelOriginLo=f.getField(u.VertexAttribute.MODELORIGINLO,y.BufferViewVec3f);this.model=f.getField(u.VertexAttribute.MODEL,y.BufferViewMat3f);this.modelNormal=f.getField(u.VertexAttribute.MODELNORMAL,y.BufferViewMat3f);this.featureAttribute=f.getField(u.VertexAttribute.INSTANCEFEATUREATTRIBUTE,y.BufferViewVec4f);this.color=f.getField(u.VertexAttribute.INSTANCECOLOR,
y.BufferViewVec4u8);this.objectAndLayerIdColor=f.getField(u.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,y.BufferViewVec4u8)}),d=function(){function f(e,h){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=e;this._instanceBufferLayout=h;this._elementSize=h.stride;this._capacity=1}var g=f.prototype;g.destroy=function(){this._buffer&&this._buffer.destroy()};g.reset=function(){this._tailIndex=this._headIndex=
0;this._firstIndex=null};g.startUpdateCycle=function(){this._captureFirstIndex=!0};g.beginUpdate=function(){p.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};g.endUpdate=function(){p.assert(this._updating,"not updating");this.size<c.ReallocShrinkTreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};g.allocateHead=function(){p.assert(this._updating,
"not updating");this.isFull&&this._grow();const e=this.headIndex;this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1);this._incrementHead();p.assert(this._headIndex!==this._tailIndex,"invalid pointers");return e};g.freeTail=function(){p.assert(this._updating,"not updating");p.assert(0<this.size,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail();e&&(this._firstIndex=this._tailIndex)};g._grow=function(){this._resize(Math.max(64,Math.floor(this._capacity*
c.ReallocGrowthFactor)))};g._shrink=function(){this._resize(Math.max(64,Math.floor(this._capacity*c.ReallocShrinkFactor)))};g._resize=function(e){p.assert(this._updating,"not updating");if(e!==this._capacity){var h=new q(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const z=this.size,n=this._compactInstances(h);p.assert(n===z,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=
n;this._prevHeadIndex=0}this._resized=!0;this._capacity=e;this._buffer=h;this._view=new k(this._instanceBufferLayout.createView(this._buffer.array))}};g._compactInstances=function(e){const h=this._headIndex,z=this._tailIndex;return z<h?(this._buffer.copyRange(z,h,e),h-z):z>h?(this._buffer.copyRange(z,this._capacity,e),0<h&&this._buffer.copyRange(0,h,e,this._capacity-z),h+(this._capacity-z)):0};g._incrementHead=function(e=1){this._headIndex=(this._headIndex+e)%this._capacity};g._incrementTail=function(e=
1){this._tailIndex=(this._tailIndex+e)%this._capacity};g._transferRange=function(e,h){e<h?this._buffer.transferRange(e,h):e>h&&(0<h&&this._buffer.transferRange(0,h),this._buffer.transferRange(e,this._capacity))};b._createClass(f,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const e=this._headIndex,h=this._tailIndex;return e>=h?e-h:e+this._capacity-h}},{key:"isEmpty",
get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return f}();a.INITIAL_CAPACITY=64;a.RenderInstanceData=d;a.RenderInstanceDataView=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,c){return function(){function y(u,q,k){this._elementSize=q;this._buffer=b.BufferObject.createVertex(u,c.Usage.STATIC_DRAW);this.resize(k)}var p=y.prototype;p.destroy=function(){this._buffer.dispose()};p.copyRange=function(u,q,k,
d=0){u=new Uint8Array(this.array,u*this.elementSize,(q-u)*this.elementSize);(new Uint8Array(k.array,d*this.elementSize)).set(u)};p.transferAll=function(){this._buffer.setData(this._array)};p.transferRange=function(u,q){u*=this._elementSize;q*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),u,u,q)};p.resize=function(u){const q=u*this._elementSize,k=new ArrayBuffer(q);this._array&&(u>=this._capacity?(new Uint8Array(k)).set(new Uint8Array(this._array)):(new Uint8Array(k)).set((new Uint8Array(this._array)).subarray(0,
u*this._elementSize)));this._array=k;this._buffer.setSize(q);this._capacity=u};a._createClass(y,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return y}()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),
function(a,b,c,y,p,u,q){q=function(k){function d(g,e){var h=k.call(this,z=>p.wrap(h._instanceData.view.boundingSphere.getVec(z,h._tmpSphere)),{maximumDepth:25})||this;h._instanceData=g;h._boundingSphere=e;h._tmpSphere=p.create();h._tmpMat4=c.create();return h}b._inherits(d,k);var f=d.prototype;f.addInstance=function(g){const e=this._instanceData.view.boundingSphere,h=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);y.transformMat4(this._tmpSphere,this._boundingSphere.center,h);this._tmpSphere[3]=
this._boundingSphere.radius*u.maxScale(h);e.setVec(g,this._tmpSphere);this.add([g])};f.removeInstance=function(g){this.remove([g])};return b._createClass(d)}(q);a.InstanceOctree=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(p,u){this._worldSpaceRadius=p;this._minScreenSpaceRadii=u}y.prototype.selectLevel=
function(p,u,q){p=q.computeScreenPixelSizeAt(p);u=this._worldSpaceRadius*u/p;p=0;for(q=1;q<this._minScreenSpaceRadii.length;++q)u>=this._minScreenSpaceRadii[q]&&(p=q);return p};return b._createClass(y)}();a.LevelSelector=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,c,y,p,u,q){let k=function(){function d(g,e){this.minScreenSpaceRadius=g;this.components=e}d.create=async function(g,e,h){const z=await Promise.allSettled(e.components.map(l=>g.controller.schedule(()=>new q.LodComponentData(g,l),h))),n=z.map(l=>"fulfilled"===l.status?l.value:null).filter(c.isSome);if(y.isAborted(h)||n.length!==z.length){n.forEach(l=>l.destroy());y.throwIfAborted(h);for(const l of z)if("rejected"===l.status)throw l.reason;}return new d(e.minScreenSpaceRadius,n)};var f=
d.prototype;f.destroy=function(){this.components.forEach(g=>g.destroy())};f.intersect=function(g,e,h,z,n,l,m){this.components.forEach(t=>t.intersect(g,e,h,z,n,l,this.boundingSphere,m))};b._createClass(d,[{key:"boundingBox",get:function(){if(null==this._boundingBox){const g=u.empty();this.components.forEach(e=>{null!=e.boundingInfo&&(u.expandWithVec3(g,e.boundingInfo.bbMin),u.expandWithVec3(g,e.boundingInfo.bbMax))});this._boundingBox=g}return this._boundingBox}},{key:"boundingSphere",get:function(){if(null==
this._boundingSphere){const g=this.boundingBox,e=p.create();u.center(g,e);this._boundingSphere={center:e,radius:.5*u.diameter(g)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((g,e)=>g+e.triangleCount,0)}}]);return d}();a.LodLevel=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=function(){function h(n,l){const m=n.renderContext.rctx;l=l.geometry;this._materialRepository=n.materialRepository;l.material.setParameters({instancedDoublePrecision:!0});n=l.material.createBufferWriter();const t=n.vertexBufferLayout,w=n.elementCount(l),r=t.createBuffer(w);n.write(null,null,l,r,0);this.geometry=l;this.material=l.material;this.glMaterials=new p.GLMaterials(l.material,this._materialRepository);this.vertexBufferLayout=t;this.vbo=f.BufferObject.createVertex(m,
g.Usage.STATIC_DRAW,r.buffer);this.vao=new k.VertexArrayObject(m,y.Default3D,{geometry:c.glLayout(t)},{geometry:this.vbo});this.vertexCount=w}var z=h.prototype;z.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};z.intersect=function(n,l,m,t,w,r,x,D){const A=this.geometry.id;this.material.intersect(this.geometry,n.transform.transform,n,m,t,(v,B,C,E,F)=>{0<=v&&(null==l||l(n.rayBegin,n.rayEnd,v))&&(C=new d.LodTarget(r.layerUid,r.graphicUid(w),A,C,x,D),(null==n.results.min.drapedLayerOrder||
F>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||v<n.results.min.dist)&&n.results.min.set(q.IntersectorType.LOD,C,v,B,n.transform.transform,F),n.options.store!==q.StoreResults.MIN&&(null==n.results.max.drapedLayerOrder||F>=n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||v>n.results.max.dist)&&n.results.max.set(q.IntersectorType.LOD,C,v,B,n.transform.transform,F),n.options.store===q.StoreResults.ALL&&(E=u.newIntersectorResult(n.results.min.ray),E.set(q.IntersectorType.LOD,
C,v,B,n.transform.transform,F),n.results.all.push(E)))})};b._createClass(h,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return h}();a.LodComponentData=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],
function(a,b,c,y,p){y=function(u){function q(k,d,f,g,e,h){var z=u.call(this,k,d)||this;z.layerUid=k;z.graphicUid=d;z.geometryId=f;z.triangleNr=g;z.baseBoundingSphere=e;z.numLodLevels=h;return z}b._inherits(q,u);return b._createClass(q)}(y.Graphic3DTarget);a.LodTarget=y;a.isLodIntersectorResult=function(u){return p.isValidIntersectorResult(u)&&u.intersector===c.IntersectorType.LOD&&!!u.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J){function N(Q,S,U){const {origin:V,positions:X}=Q;let Y=Q.offset;switch(S){default:case K.UpVectorAlignment.World:for(const Z of Q.vertices)T[0]=X[Y++]+V[0],T[1]=X[Y++]+V[1],T[2]=X[Y++]+V[2],U.worldUpAtPosition(T,T),Z.setFrameFromUpVector(T);break;case K.UpVectorAlignment.Path:T[0]=X[Y]+V[0],T[1]=X[Y+1]+V[1],T[2]=X[Y+2]+V[2],U.worldUpAtPosition(T,T),L.computeMinimumRotationTangentFrame(Q,T)}}function R(Q,S,U){switch(Q){case "symbol-value":return U;
case "proportional":return S;default:return Q}}const W=["polyline"];c=function(Q){function S(V,X,Y,Z){V=Q.call(this,V,X,Y,Z)||this;V._intrinsicSize=k.fromValues(1,1);V._upVectorAlignment=K.UpVectorAlignment.Path;V._stencilWidth=.1;V.ensureDrapedStatus(!1);return V}b._inherits(S,Q);var U=S.prototype;U.doLoad=async function(){var V=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height;const X=null!=this.symbolLayer.height?this.symbolLayer.height:V;this._vvConvertOptions=new x.ConvertOptions({size:!0,
color:!0,rotation:!1,opacity:!0},[1,1,1],[V,1,X],this._context.renderCoordsHelper.unitInMeters);this._fastUpdates=0<this._context.renderer?.visualVariables?.length?x.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var Y=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?K.UpVectorAlignment.World:K.UpVectorAlignment.Path;var Z=this.symbolLayer.profile||"circle";switch(Z){default:case "circle":this._profile=O.circleProfiles[Y];
break;case "quad":this._profile=O.quadProfiles[Y]}switch(this.symbolLayer.join){case "round":this._extruder=new M.MiterExtruder(0,m.PATH_NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new M.MiterExtruder(0,1);break;case "miter":this._extruder=new M.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new M.SimpleExtruder}Y=this.symbolLayer.cap||"butt";switch(Y){case "none":this._startCap=new F.NoCapBuilder;this._endCap=new F.NoCapBuilder;break;default:this._startCap=new F.TriangulationCapBuilder(this._profile,
0);this._endCap=new F.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new F.TriangulationCapBuilder(this._profile,-.5);this._endCap=new F.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":Z="quad"===Z,this._startCap=new F.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:Z,subdivisions:m.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new F.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:Z,subdivisions:m.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}var ea=
this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);Z=f.fromArray(ea);ea=ea[3];const ja=1>ea||this.needsDrivenTransparentPass;Y={diffuse:Z,ambient:Z,opacity:ea,transparent:ja,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:ja||"none"===Y?v.CullFaceOptions.None:v.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(q.set(this._intrinsicSize,V,X),!w.isValidSize(this._intrinsicSize[0])||
!w.isValidSize(this._intrinsicSize[1])))throw new y("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates&&this._fastUpdates.visualVariables.size||q.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(V={...Y,...this._fastUpdates.materialParameters,size:k.fromArray(this._intrinsicSize)},this._material=new J.PathMaterial(V)):(Y.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,
Y.normalType=A.NormalType.Compressed,this._material=new H.DefaultMaterial(Y));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)};U.destroy=function(){b._get(b._getPrototypeOf(S.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null};U.createGraphics3DGraphic=function(V){const X=V.graphic;if(!this._validateGeometry(X.geometry,W,this.symbolLayer.type))return null;const Y=
this.setGraphicElevationContext(X,new n.ElevationContext);return this._createAs3DShape(X,V.renderingInfo,Y,X.uid)};U.layerOpacityChanged=function(){const V=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._material.setParameters({opacity:V,transparent:1>V||this.needsDrivenTransparentPass})};U.layerElevationInfoChanged=function(V,X){return this.updateGraphics3DGraphicElevationInfo(V,X,z.needsElevationUpdates3D)};U.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0};U.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};U.applyRendererDiff=function(V,X){for(const Y in V.diff)switch(Y){case "visualVariables":if(x.updateFastSymbolUpdatesState(this._fastUpdates,X,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return r.ApplyRendererDiffResult.RecreateSymbol;break;default:return r.ApplyRendererDiffResult.RecreateSymbol}return r.ApplyRendererDiffResult.FastUpdate};
U._getVertexData=function(V){let X=0;const Y=V.paths,Z=[],ea=V.spatialReference,ja=this._context.elevationProvider.spatialReference,ha=this._context.renderCoordsHelper.spatialReference;for(var ia of Y)X+=ia.length;ia=h.newDoubleArray(3*X);let oa=0;for(const ma of Y){Z.push({offset:oa,numVertices:ma.length});for(const fa of ma)ia[oa++]=fa[0],ia[oa++]=fa[1],ia[oa++]=V.hasZ?fa[2]:0}if(null!=ja&&!ea.equals(ja)&&!g.projectBuffer(ia,ea,0,ia,ja,0,X))return null;null==ja||ja.equals(ha)?V=h.doubleArrayFrom(ia):
(V=h.newDoubleArray(3*X),g.projectBuffer(ia,ja,0,V,ha,0,X));return{pathVertexDataInfos:Z,vertexDataES:ia,vertexDataRS:V}};U._createAs3DShape=function(V,X,Y,Z){var ea=V.geometry;const ja=this._getVertexData(ea);if(null==ja)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===ja.pathVertexDataInfos.length)return 0!==ea.paths.length&&ea.paths.some(ca=>0<ca.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),
null;var ha=[];ea=ea.spatialReference;const ia=e.create(),oa=this._context.renderCoordsHelper,ma=new D.SamplePosition(ja.vertexDataES);for(const ca of ja.pathVertexDataInfos){var fa=ca.numVertices;if(2>fa)continue;var ba=ca.offset;if(null!=this._context.clippingExtent&&(e.empty(ia),e.expandWithBuffer(ia,ja.vertexDataES,ba,fa),!e.intersectsClippingArea(ia,this._context.clippingExtent)))continue;var aa=[];fa=ba+3*fa;for(var da=ba;da<fa;da+=3){ma.offset=da;const ua=z.evaluateElevationAlignmentAtPoint(ma,
this._context.elevationProvider,Y,oa);d.set(T,ja.vertexDataRS[da],ja.vertexDataRS[da+1],ja.vertexDataRS[da+2]);oa.setAltitude(T,ua);ja.vertexDataRS[da]=T[0];ja.vertexDataRS[da+1]=T[1];ja.vertexDataRS[da+2]=T[2];aa.push(I.newPathVertex(this._upVectorAlignment))}ba=new C.Path(aa,ja.vertexDataES,ja.vertexDataRS,ba);N(ba,this._upVectorAlignment,this._context.renderCoordsHelper);ba=new E.PathBuilder(ba,this._profile,this._extruder,this._startCap,this._endCap);aa=null;this._fastUpdates?(da=this._fastUpdates.visualVariables,
aa=x.getAttributeValue(da.size?.field,V)??0,fa=x.getAttributeValue(da.color?.field,V)??0,da=x.getAttributeValue(da.opacity?.field,V)??0,aa=new G.FastUpdatePathGeometry(ba,aa,fa,da)):(aa=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(fa=X.size,aa[0]*=R(fa[0],"symbol-value"===fa[2]?this.symbolLayer.height||0:fa[2],this.symbolLayer.width||0),aa[1]*=R(fa[2],"symbol-value"===fa[0]?this.symbolLayer.width||0:fa[0],this.symbolLayer.height||0)),fa=void 0,this._drivenProperties.color&&
(fa=X.color),this._drivenProperties.opacity&&null!=X.opacity&&(fa=fa?[fa[0],fa[1],fa[2],X.opacity]:[1,1,1,X.opacity]),da=new G.StaticPathGeometry(ba),da.bake(aa),fa&&da.bakeVertexColors(fa),aa=da);const {vertexAttributes:na,indices:qa}=aa.createGeometryData();fa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Z,layerUid:this._context.layer.uid});aa=new K.PathGeometry(this._material,na,qa,aa,ea,this._stencilWidth,fa);aa.transformation=p.translate(u.create(),u.IDENTITY,ba.path.origin);
ha.push(aa)}if(0===ha.length)return null;V=new B.Object3D({geometries:ha,layerUid:this._context.layer.uid,graphicUid:Z});ha=new l.Graphics3DObject3DGraphicLayer(this,V,ha,null,null,(ca,na,qa,ua,sa)=>{na=this._upVectorAlignment;ca=ca.stageObject;qa=ca.geometries;var pa=0;for(const Ca of qa){if(!K.isPathGeometry(Ca))continue;const Ba=Ca.path,Ha=Ba.builder.path;var ka=Ha,ra=ua,va=sa;let Ma=0;const {origin:Qa,vertices:Sa,positions:La,positionsES:Ua}=ka,Va=ka.offset+3*Sa.length;for(let cb=ka.offset;cb<
Va;cb+=3)d.set(T,Ua[cb],Ua[cb+1],Ua[cb+2]),ra(T,P),Ma+=P.sampledElevation,T[0]=La[cb]+Qa[0],T[1]=La[cb+1]+Qa[1],T[2]=La[cb+2]+Qa[2],va.setAltitude(T,P.z),La[cb]=T[0]-Qa[0],La[cb+1]=T[1]-Qa[1],La[cb+2]=T[2]-Qa[2];ka.updatePathVertexInformation();pa+=Ma/Sa.length;na!==K.UpVectorAlignment.World&&N(Ha,na,sa);Ba.onPathChanged(Ca);Ca.invalidateBoundingInfo();ca.geometryVertexAttrsUpdated(Ca)}return pa/qa.length},Y);ha.alignedSampledElevation=0;ha.needsElevationUpdates=z.needsElevationUpdates3D(Y.mode);
return ha};return b._createClass(S)}(t.Graphics3DSymbolLayer);const T=f.create(),P=new z.SampleElevationInfo;a.Graphics3DPathSymbolLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/FloatArray"],function(a,b,c,y,p){let u=function(){function q(k,d,f,g){this.vertices=k;this.positionsES=
d;this.offset=g;var e=k.length;g=this.offset+3*Math.floor(e/2);k=f[g];d=f[g+1];g=f[g+2];this.origin=y.fromValues(k,d,g);this.positions=p.newFloatArray(3*e);e=this.offset+3*e;for(let h=this.offset;h<e;h+=3)this.positions[h]=f[h]-k,this.positions[h+1]=f[h+1]-d,this.positions[h+2]=f[h+2]-g;this.updatePathVertexInformation()}q.prototype.updatePathVertexInformation=function(){const k=this.vertices.length;var d=this.vertices[0];let f=this.offset;const g=this.positions;d.vRight[0]=g[f+3]-g[f];d.vRight[1]=
g[f+4]-g[f+1];d.vRight[2]=g[f+5]-g[f+2];f+=3;let e=c.length(d.vRight);d.vMinSiblingLength=e;c.normalize(d.vRight,d.vRight);var h=d;for(d=1;d<k;++d){const z=this.vertices[d];z.vLeft=h.vRight;d<k-1?(z.vRight[0]=g[f+3]-g[f],z.vRight[1]=g[f+4]-g[f+1],z.vRight[2]=g[f+5]-g[f+2],h=c.length(z.vRight),z.vMinSiblingLength=Math.min(e,h),e=h,c.normalize(z.vRight,z.vRight)):(c.copy(z.vRight,z.vLeft),z.vMinSiblingLength=e);h=z;f+=3}};return b._createClass(q)}();a.Path=u;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(a,b,c,y){let p=function(){function u(k,d,f,g,e,h={}){this.path=k;this.profile=d;this.extruder=f;this.startCap=g;this.endCap=e;this.options=h;this._extrusionVertexCount=0;g=this.path.vertices.length-2;this.numExtrusionProfiles=f.numProfilesPerJoin()*g+2;this.numVerticesTotal=
d.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.startCap.numVertices;this.endCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.endCap.numVertices;this.pathVertexData=y.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=c.newFloatArray(4*this.numVerticesTotal);this.profileVertexAndNormals=c.newFloatArray(4*this.numVerticesTotal);this.positions=
c.floatSubArray(k.positions,k.offset,3*k.vertices.length);this._rebuildGeometry();this.buildTopology()}var q=u.prototype;q.emitVertex=function(k,d,f,g,e){const h=4*this._extrusionVertexCount;this.profileRightAxes[h]=d.right[0];this.profileRightAxes[h+1]=d.right[1];this.profileRightAxes[h+2]=d.right[2];this.profileUpAxes[h]=d.up[0];this.profileUpAxes[h+1]=d.up[1];this.profileUpAxes[h+2]=d.up[2];this.profileVertexAndNormals[h]=f[0];this.profileVertexAndNormals[h+1]=f[1];this.profileVertexAndNormals[h+
2]=g[0];this.profileVertexAndNormals[h+3]=g[1];this.pathVertexData[this._extrusionVertexCount]=k;e?(k=this.path.vertices[k],d=k.maxStretchDistance,this.profileRightAxes[h+3]=k.rotationRight[0]*d,this.profileUpAxes[h+3]=k.rotationRight[1]*d):(this.profileRightAxes[h+3]=0,this.profileUpAxes[h+3]=0);++this._extrusionVertexCount};q.emitCapVertex=function(k,d,f,g,e,h){const z=4*this._extrusionVertexCount;this.profileRightAxes[z]=d.right[0];this.profileRightAxes[z+1]=d.right[1];this.profileRightAxes[z+
2]=d.right[2];this.profileRightAxes[z+3]=e;this.profileUpAxes[z]=d.up[0];this.profileUpAxes[z+1]=d.up[1];this.profileUpAxes[z+2]=d.up[2];this.profileUpAxes[z+3]=h;this.profileVertexAndNormals[z]=f[0];this.profileVertexAndNormals[z+1]=f[1];this.profileVertexAndNormals[z+2]=g[0];this.profileVertexAndNormals[z+3]=g[1];this.pathVertexData[this._extrusionVertexCount]=k;++this._extrusionVertexCount};q._rebuildGeometry=function(){this._extrusionVertexCount=0;const {positions:k,offset:d,vertices:f}=this.path;
this.positions=c.floatSubArray(k,d,3*f.length);let g=0;const e=(z,n,l,m,t)=>this.emitCapVertex(g,z,n,l,m,t),h=(z,n,l,m)=>this.emitVertex(g,z,n,l,m);this.startCap.rebuildConnectingProfileGeometry(f[g],this.profile,e);for(g=1;g<f.length-1;++g)this.extruder.extrude(f[g],this.profile,h);this.endCap.rebuildConnectingProfileGeometry(f[g],this.profile,e);g=0;this.startCap.rebuildCapGeometry(f[g],e);g=f.length-1;this.endCap.rebuildCapGeometry(f[g],e)};q.buildTopology=function(){const k=this.profile.vertices.length,
d=this.profile.numSegments,f=this.numExtrusionProfiles-1;var g=d*f*6;this.startCap.indexBufferStart=g;this.startCap.firstProfileVertexIndex=0;g+=this.startCap.numIndices;this.endCap.indexBufferStart=g;this.endCap.firstProfileVertexIndex=k*(this.numExtrusionProfiles-1);const e=[],h=[],z=[];g=(n,l,m)=>{e.push(n);e.push(l);e.push(m);h.push(n);h.push(l);h.push(m);z.push(this.pathVertexData[n]);z.push(this.pathVertexData[l]);z.push(this.pathVertexData[m])};for(let n=0;n<d;++n){const l=this.profile.indices[2*
n],m=this.profile.indices[2*n+1];for(let t=0;t<f;++t){const w=t*k+l,r=(t+1)*k+m,x=t*k+m;g(w,(t+1)*k+l,r);g(w,r,x)}}this.startCap.buildTopology(this.path.vertices[0],g);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],g);this.vertexIndices=y.compactIndices(e);this.normalIndices=y.compactIndices(h);this.pathVertexIndices=y.compactIndices(z)};q.onPathChanged=function(){this._rebuildGeometry()};return b._createClass(u)}();a.PathBuilder=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2","../../../../chunks/vec2f64"],function(a,b,c,y){let p=function(){function g(){}g.prototype.rebuildConnectingProfileGeometry=function(e,h,z){for(let n=0;n<h.vertices.length;++n)z(e.frame,h.vertices[n],h.normals[n],0,0)};return b._createClass(g)}(),u=function(g){function e(){var z=g.call(this)||this;z.numVertices=0;z.numIndices=0;
return z}b._inherits(e,g);var h=e.prototype;h.rebuildCapGeometry=function(){};h.buildTopology=function(){};return b._createClass(e)}(p),q=function(g){function e(z,n=0,l=!1){var m=g.call(this)||this;m.profile=z;m.profilePlaneOffset=n;m.flip=l;return m}b._inherits(e,g);var h=e.prototype;h.rebuildConnectingProfileGeometry=function(z,n,l){const m=this.profilePlaneOffset;for(let t=0;t<n.vertices.length;++t)l(z.frame,n.vertices[t],n.normals[t],m,0)};h.rebuildCapGeometry=function(z,n){const l=this.profile,
m=this.flip?1:-1,t=this.profilePlaneOffset,w=f;c.set(w,0,0);for(let r=0;r<l.vertices.length;++r)n(z.frame,l.vertices[r],w,t,m)};h.buildTopology=function(z,n){z=this.profile;const l=this.vertexBufferStart+z.indices[0];for(let m=1;m<z.numSegments;++m){const t=this.vertexBufferStart+z.indices[2*m],w=this.vertexBufferStart+z.indices[2*m+1];this.flip?n(w,t,l):n(l,t,w)}};b._createClass(e,[{key:"numVertices",get:function(){return this.profile.vertices.length}},{key:"numIndices",get:function(){return 3*this.profile.numSegments}}]);
return e}(p),k=function(g){function e(z){var n=g.call(this)||this;n.flip=!1;n.sign=0;n.breakNormals=!1;n.numSegments=3;n.profile=z.profile;n.flip=z.flip;n.sign=n.flip?1:-1;n.breakNormals=z.breakNormals;n.numSegments=z.subdivisions;return n}b._inherits(e,g);var h=e.prototype;h.rebuildCapGeometry=function(z,n){const l=this.profile;z=z.frame;const m=.5*this.sign,t=d,w=f;c.set(w,0,0);for(var r of l.poles)r.normal?n(z,r.position,r.normal,m,0):n(z,r.position,w,m,this.sign);if(this.breakNormals)for(r=0;r<
l.vertices.length;++r)n(z,l.vertices[r],l.normals[r],0,0);for(r=0;r<this.numSegments-1;++r){var x=(1-(r+1)/this.numSegments)*Math.PI*.5;const D=Math.sin(x);x=Math.cos(x);for(let A=0;A<l.vertices.length;++A){const v=l.poles[l.poleIndices[A]];c.subtract(t,l.vertices[A],v.position);c.scale(t,t,D);v.normal?(c.add(t,t,v.position),n(z,t,v.normal,m*x,0)):(c.normalize(w,t),c.scale(w,w,D),c.add(t,t,v.position),n(z,t,w,m*x,this.sign*x))}}};h.buildTopology=function(z,n){z=this.profile;const l=this.breakNormals?
this.vertexBufferStart+z.poles.length:this.firstProfileVertexIndex,m=this.breakNormals?this.vertexBufferStart+z.poles.length+z.vertices.length:this.vertexBufferStart+z.poles.length;for(let t=0;t<z.numSegments;++t){const w=z.indices[2*t],r=z.indices[2*t+1],x=this.vertexBufferStart+z.poleIndices[w],D=this.vertexBufferStart+z.poleIndices[r];let A=l+w,v=l+r;for(let B=0;B<this.numSegments-1;++B){const C=m+B*z.vertices.length+w,E=m+B*z.vertices.length+r;this.flip?(n(C,v,A),n(v,C,E)):(n(A,v,C),n(E,C,v));
A=C;v=E}this.flip?(n(x,v,A),x!==D&&n(x,D,v)):(n(A,v,x),x!==D&&n(v,D,x))}};b._createClass(e,[{key:"numVertices",get:function(){let z=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;this.breakNormals&&(z+=this.profile.vertices.length);return z}},{key:"numIndices",get:function(){let z;const n=this.profile;z=2*n.numSegments*(this.numSegments-1);for(let l=0;l<n.numSegments;++l)z=n.poleIndices[n.indices[2*l]]===n.poleIndices[n.indices[2*l+1]]?z+1:z+2;return 3*z}}]);return e}(p);
const d=y.create(),f=y.create();a.NoCapBuilder=u;a.PathCapBuilder=p;a.RoundCapBuilder=k;a.TriangulationCapBuilder=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64".split(" "),function(a,b,c,y,p,u,q,k){let d=b._createClass(function(){}),
f=function(){function l(){}var m=l.prototype;m.numProfilesPerJoin=function(){return 1};m.extrude=function(t,w,r){for(let x=0;x<w.vertices.length;++x)r(t.frame,w.vertices[x],w.normals[x],!1)};return b._createClass(l)}(),g=function(){function l(t,w){this.cutoffAngle=t;this.numBendSubdivisions=w}var m=l.prototype;m.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};m.extrude=function(t,w,r){var x=n;const {rotationAngle:D,rotationRight:A,frame:v}=t;if(Math.abs(D)>=this.cutoffAngle){var B=
t.rotationFrameUp;for(var C=0;C<this.numBendSubdivisions+1;++C){c.fromRotation(z,.5*-D+C*D/this.numBendSubdivisions,B);var E=x,F=v,M=z;q.transformMat4(E.up,F.up,M);q.transformMat4(E.right,F.right,M);for(E=0;E<w.vertices.length;++E)0<=p.dot(w.vertices[E],A)*D?r(x,w.vertices[E],w.normals[E],!1):(F=t.applyMiterStretch(h,w.vertices[E]),r(v,F,w.normals[E],!0))}}else for(x=0;x<this.numBendSubdivisions+1;++x)for(B=0;B<w.vertices.length;++B)C=0<=p.dot(w.vertices[B],A)*D,E=t.applyMiterStretch(h,w.vertices[B]),
r(v,E,w.normals[B],!C)};return b._createClass(l)}(),e=b._createClass(function(){this.up=k.create();this.right=k.create()});const h=u.create(),z=y.create(),n=new e;a.Frame2D=e;a.MiterExtruder=g;a.PathExtruder=d;a.SimpleExtruder=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./ContentObjectType","./Geometry"],function(a,b,c,y){y=function(p){function u(q,k,d,f,
g,e,h){q=p.call(this,q,k,d,null,c.ContentObjectType.Mesh,h)||this;q.path=f;q.geometrySR=g;q.stencilWidth=e;return q}b._inherits(u,p);return b._createClass(u)}(y.Geometry);a.UpVectorAlignment=void 0;(function(p){p[p.World=0]="World";p[p.Path=1]="Path"})(a.UpVectorAlignment||(a.UpVectorAlignment={}));a.PathGeometry=y;a.isPathGeometry=function(p){return"path"in p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./Normals ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=function(){function B(C){this.builder=C}B.prototype.onPathChanged=function(C){this.builder.onPathChanged()};return b._createClass(B)}(),n=function(B){function C(F){F=B.call(this,F)||this;F.vertexAttributeColor=q.fromValues(255,255,255,255);F.size=[];F.vertexAttributePosition=k.newFloatArray(3*F.builder.numVerticesTotal);F.vertexAttributeNormal=new Int16Array(2*F.builder.numVerticesTotal);return F}b._inherits(C,B);var E=C.prototype;E.bakeVertexColors=function(F){this.vertexAttributeColor[0]=
255*F[0];this.vertexAttributeColor[1]=255*F[1];this.vertexAttributeColor[2]=255*F[2];this.vertexAttributeColor[3]=255*(3<F.length?F[3]:1)};E.bake=function(F){this.size=F;const {numVerticesTotal:M,pathVertexData:K,path:G,positions:L,profileRightAxes:O,profileUpAxes:I,profileVertexAndNormals:H}=this.builder;for(let W=0;W<M;++W){var J=K[W],N=0===J||J===G.vertices.length-1;J*=3;const T=D;let P=0,Q=0;const S=4*W,U=p.set(A,O[S],O[S+1],O[S+2]),V=p.set(v,I[S],I[S+1],I[S+2]);var R=c.set(t,H[S]*F[0],H[S+1]*
F[1]);if(N)p.cross(T,V,U),P=O[S+3]*F[0],Q=I[S+3];else{N=w;const X=r;c.set(N,O[S+3],I[S+3]);const Y=c.length(N);c.normalize(N,N);const Z=c.dot(R,N);if(Math.abs(Z)>Y){c.set(X,-N[1],N[0]);const ea=c.dot(R,X);c.scale(N,N,Y*Math.sign(Z));c.scale(X,X,ea);c.add(R,N,X)}p.set(T,0,0,0)}R=p.set(x,U[0]*R[0]+V[0]*R[1],U[1]*R[0]+V[1]*R[1],U[2]*R[0]+V[2]*R[1]);N=3*W;this.vertexAttributePosition[N]=L[J]+R[0]+T[0]*P;this.vertexAttributePosition[N+1]=L[J+1]+R[1]+T[1]*P;this.vertexAttributePosition[N+2]=L[J+2]+R[2]+
T[2]*P;J=c.set(t,H[S+2],H[S+3]);g.compressNormal(this.vertexAttributeNormal,W,U[0]*J[0]+V[0]*J[1]+T[0]*Q,U[1]*J[0]+V[1]*J[1]+T[1]*Q,U[2]*J[0]+V[2]*J[1]+T[2]*Q)}};E.createGeometryData=function(){const F=this.builder.vertexIndices.length;return new m([[e.VertexAttribute.POSITION,new f.Attribute(this.vertexAttributePosition,3,!0)],[e.VertexAttribute.NORMALCOMPRESSED,new f.Attribute(this.vertexAttributeNormal,2,!0)],[e.VertexAttribute.COLOR,new f.Attribute(this.vertexAttributeColor,4)]],[[e.VertexAttribute.POSITION,
this.builder.vertexIndices],[e.VertexAttribute.NORMALCOMPRESSED,this.builder.normalIndices],[e.VertexAttribute.COLOR,d.getZeroIndexArray(F)]])};E.onPathChanged=function(F){b._get(b._getPrototypeOf(C.prototype),"onPathChanged",this).call(this,F);this.bake(this.size)};E.intersect=function(F,M,K){const G=this.builder.vertexIndices,L=new f.Attribute(this.vertexAttributePosition,3);h.intersectTriangles(F,M,0,G.length/3,G,L,void 0,void 0,K)};return b._createClass(C)}(z),l=function(B){function C(F,M,K,G){var L=
B.call(this,F)||this;L.sizeAttributeValue=M;L.colorAttributeValue=K;L.opacityAttributeValue=G;L.vvData=null;L.baked=new n(F);L.vvData=k.newFloatArray(4*L.builder.path.vertices.length);for(F=0;F<L.builder.path.vertices.length;++F)L.vvData[4*F]=M,L.vvData[4*F+1]=K,L.vvData[4*F+2]=G,L.vvData[4*F+3]=0===F||F===L.builder.path.vertices.length-1?1:0;return L}b._inherits(C,B);var E=C.prototype;E.createGeometryData=function(){return new m([[e.VertexAttribute.POSITION,new f.Attribute(this.builder.positions,
3,!0)],[e.VertexAttribute.PROFILERIGHT,new f.Attribute(this.builder.profileRightAxes,4,!0)],[e.VertexAttribute.PROFILEUP,new f.Attribute(this.builder.profileUpAxes,4,!0)],[e.VertexAttribute.PROFILEVERTEXANDNORMAL,new f.Attribute(this.builder.profileVertexAndNormals,4,!0)],[e.VertexAttribute.FEATUREVALUE,new f.Attribute(this.vvData,4,!0)]],[[e.VertexAttribute.POSITION,this.builder.pathVertexIndices],[e.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[e.VertexAttribute.PROFILEUP,this.builder.vertexIndices],
[e.VertexAttribute.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[e.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]])};E.onPathChanged=function(F){b._get(b._getPrototypeOf(C.prototype),"onPathChanged",this).call(this,F);if(F=F.getMutableAttribute(e.VertexAttribute.POSITION))F.data=this.builder.positions};return b._createClass(C)}(z),m=b._createClass(function(B,C){this.vertexAttributes=B;this.indices=C});const t=y.create(),w=y.create(),r=y.create(),x=u.create(),D=u.create(),A=u.create(),
v=u.create();a.FastUpdatePathGeometry=l;a.PathGeometryData=z;a.StaticPathGeometry=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),function(a,b,c,y,p,u,q){const k=y.create();a.computeMinimumRotationTangentFrame=function(d,f){let g=null;
const e=d.vertices.length,h=y.create(),z=y.create(),n=y.create(),l=y.create(),m=y.create(),t=y.create(),w=p.create();let r=d.vertices[0];c.copy(z,f);c.set(h,0,1,0);q.makeOrthoBasisDirUpFallback(r.vRight,z,h,h,n,z,.99619469809);c.copy(r.frame.up,z);c.copy(r.frame.right,n);f=d.positions;let x=d.offset;g=r;for(let A=1;A<e;++A){r=d.vertices[A];c.add(m,r.vLeft,r.vRight);var D=c.length(m);0<D?(D=1/Math.sqrt(D),m[0]*=D,m[1]*=D,m[2]*=D):(m[0]=r.vRight[0],m[1]=r.vRight[1],m[2]=r.vRight[2]);t[0]=f[x]+g.frame.up[0];
t[1]=f[x+1]+g.frame.up[1];t[2]=f[x+2]+g.frame.up[2];x+=3;D=c.set(k,f[x],f[x+1],f[x+2]);p.fromPositionAndNormal(D,m,w);p.intersectRay(w,u.wrap(t,r.vLeft),l)?(l[0]-=f[x],l[1]-=f[x+1],l[2]-=f[x+2],c.normalize(z,l),c.cross(n,m,z),c.normalize(n,n)):q.makeOrthoBasisDirUpFallback(m,g.frame.up,g.frame.right,h,n,z,.99619469809);c.copy(r.frame.up,z);c.copy(r.frame.right,n);g=r}};a.profileSpaceToVertexSpace=function(d,f,g){d[0]=g[0]*f.right[0]+g[1]*f.up[0];d[1]=g[0]*f.right[1]+g[1]*f.up[1];d[2]=g[0]*f.right[2]+
g[1]*f.up[2]};a.vertexSpaceToProfileSpace=function(d,f,g){b.set(d,c.dot(g,f.right),c.dot(g,f.up))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../../layers/graphics/Graphics3DPathSymbolLayerConstants"],function(a,b,c,y){function p(g){const e=y.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS,h=new q,z={v0:0,v1:0};h.addPole(c.fromValues(0,0));
for(var n=0;n<e;++n){var l=2*n*Math.PI/e,m=Math.cos(l);const t=Math.sin(l);l=c.fromValues(.5*m,.5*t);m=c.fromValues(m,t);h.addVertex(l,m)}for(n=0;n<e-1;++n)h.addSegment({v0:n,v1:n+1},z);h.addSegment({v0:e-1,v1:0},z);"center"!==g&&(g=k[g],h.translate(g[0],g[1]));return h}function u(g){const e=new q,h=c.fromValues(-.5,-.5),z=c.fromValues(.5,-.5),n=c.fromValues(.5,.5),l=c.fromValues(-.5,.5),m=c.fromValues(0,-1),t=c.fromValues(1,0),w=c.fromValues(0,1),r=c.fromValues(-1,0);e.addPole(c.fromValues(0,.5),
w);e.addPole(c.fromValues(0,.5));e.addPole(c.fromValues(0,-.5));e.addPole(c.fromValues(0,-.5),m);e.addVertex(h,m);e.addVertex(z,m);e.addSegment({v0:0,v1:1},{v0:3,v1:3});e.addVertex(z,t);e.addVertex(n,t);e.addSegment({v0:2,v1:3},{v0:2,v1:1});e.addVertex(n,w);e.addVertex(l,w);e.addSegment({v0:4,v1:5},{v0:0,v1:0});e.addVertex(l,r);e.addVertex(h,r);e.addSegment({v0:6,v1:7},{v0:1,v1:2});"center"!==g&&(g=k[g],e.translate(g[0],g[1]));return e}let q=function(){function g(){this.vertices=[];this.normals=[];
this.indices=[];this.poles=[];this.poleIndices=[]}var e=g.prototype;e.addVertex=function(h,z){this.vertices.push(c.clone(h));this.normals.push(c.clone(z));return this.vertices.length-1};e.addPole=function(h,z=null){this.poles.push({position:c.clone(h),normal:z?c.clone(z):null});return this.poles.length-1};e.addSegment=function(h,z=null){this.indices.push(h.v0);this.indices.push(h.v1);z&&(this.poleIndices.push(z.v0),this.poleIndices.push(z.v1))};e.translate=function(h,z){for(const n of this.vertices)n[0]+=
h,n[1]+=z;for(const n of this.poles)n.position[0]+=h,n.position[1]+=z};b._createClass(g,[{key:"numSegments",get:function(){return this.indices.length/2}}]);return g}();const k={top:[0,-.5],bottom:[0,.5]},d={center:p("center"),top:p("top"),bottom:p("bottom")},f={center:u("center"),top:u("top"),bottom:u("bottom")};a.PathProfile=q;a.circleProfiles=d;a.quadProfiles=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./PathExtruder ./PathGeometry".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=function(){function C(){this.vLeft=d.create();this.vRight=d.create();this.vMinSiblingLength=0;this.frame=new f.Frame2D}C.prototype.setFrameFromUpVector=function(E){k.copy(this.frame.up,E);k.add(A,this.vLeft,this.vRight);k.normalize(A,A);k.scale(D,this.frame.up,k.dot(A,this.frame.up));k.subtract(v,A,D);k.normalize(v,v);k.cross(this.frame.right,v,this.frame.up)};b._createClass(C,[{key:"foldingAngle",get:function(){return Math.PI-this.rotationAngle}}]);return C}(),
h=function(C){function E(){return C.apply(this,arguments)||this}b._inherits(E,C);E.prototype.applyMiterStretch=function(F,M){var K=this.rotationAngle;if(0>=Math.abs(K))return M;K=c.reciprocalClamped(Math.cos(.5*K));return u.set(F,(1+(K-1))*M[0],M[1])};b._createClass(E,[{key:"rotationFrameUp",get:function(){return this.frame.up}},{key:"rotationRight",get:function(){return q.UNIT_X}},{key:"rotationAngle",get:function(){k.scale(r,this.frame.up,k.dot(this.frame.up,this.vLeft));k.subtract(r,this.vLeft,
r);k.negate(r,r);k.normalize(r,r);k.scale(x,this.frame.up,k.dot(this.frame.up,this.vRight));k.subtract(x,this.vRight,x);k.normalize(x,x);k.cross(w,this.rotationFrameUp,this.vLeft);return Math.sign(k.dot(w,this.vRight))*(Math.PI-c.acosClamped(k.dot(r,x)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}}]);return E}(e),z=function(C){function E(){return C.apply(this,arguments)||this}b._inherits(E,C);E.prototype.applyMiterStretch=function(F,
M){var K=this.rotationAngle;if(0===Math.abs(K))return M;K=c.reciprocalClamped(Math.cos(.5*K));const G=this.rotationRight;K=y.set(B,1+(K-1)*G[0]*G[0],(K-1)*G[0]*G[1],(K-1)*G[0]*G[1],1+(K-1)*G[1]*G[1]);return u.transformMat2(F,M,K)};b._createClass(E,[{key:"rotationFrameUp",get:function(){const F=Math.sign(k.dot(this.frame.right,this.vRight));k.cross(n,this.vRight,this.vLeft);k.scale(n,n,F);return k.normalize(n,n)}},{key:"rotationRight",get:function(){var F=this.rotationFrameUp,M=k.dot(F,this.frame.up);
F=k.dot(F,this.frame.right);k.scale(m,this.frame.up,-F);k.scale(t,this.frame.right,M);k.add(m,m,t);k.normalize(m,m);M=this.frame;F=m;u.set(l,k.dot(F,M.right),k.dot(F,M.up));return l}},{key:"rotationAngle",get:function(){const F=Math.sign(k.dot(this.frame.right,this.vRight));k.negate(w,this.vLeft);return-F*(Math.PI-c.acosClamped(k.dot(w,this.vRight)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength*c.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}}]);return E}(e);
const n=d.create(),l=q.create(),m=d.create(),t=d.create(),w=d.create(),r=d.create(),x=d.create(),D=d.create(),A=d.create(),v=d.create(),B=p.create();a.PathVertex=e;a.newPathVertex=function(C){switch(C){case g.UpVectorAlignment.World:return new h;case g.UpVectorAlignment.Path:return new z}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(B,C){B[0]=C[0];B[1]=C[1];B[2]=C[2];B[3]=C[3];return B}function y(B){B[0]=
1;B[1]=0;B[2]=0;B[3]=1;return B}function p(B,C,E,F,M){B[0]=C;B[1]=E;B[2]=F;B[3]=M;return B}function u(B,C){if(B===C){const E=C[1];B[1]=C[2];B[2]=E}else B[0]=C[0],B[1]=C[2],B[2]=C[1],B[3]=C[3];return B}function q(B,C){const E=C[0],F=C[1],M=C[2];C=C[3];let K=E*C-M*F;if(!K)return null;K=1/K;B[0]=C*K;B[1]=-F*K;B[2]=-M*K;B[3]=E*K;return B}function k(B,C){const E=C[0];B[0]=C[3];B[1]=-C[1];B[2]=-C[2];B[3]=E;return B}function d(B){return B[0]*B[3]-B[2]*B[1]}function f(B,C,E){const F=C[0],M=C[1],K=C[2];C=
C[3];const G=E[0],L=E[1],O=E[2];E=E[3];B[0]=F*G+K*L;B[1]=M*G+C*L;B[2]=F*O+K*E;B[3]=M*O+C*E;return B}function g(B,C,E){const F=C[0],M=C[1],K=C[2];C=C[3];const G=Math.sin(E);E=Math.cos(E);B[0]=F*E+K*G;B[1]=M*E+C*G;B[2]=F*-G+K*E;B[3]=M*-G+C*E;return B}function e(B,C,E){const F=C[1],M=C[2],K=C[3],G=E[0];E=E[1];B[0]=C[0]*G;B[1]=F*G;B[2]=M*E;B[3]=K*E;return B}function h(B,C){const E=Math.sin(C);C=Math.cos(C);B[0]=C;B[1]=E;B[2]=-E;B[3]=C;return B}function z(B,C){B[0]=C[0];B[1]=0;B[2]=0;B[3]=C[1];return B}
function n(B){return"mat2("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+")"}function l(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2)}function m(B,C,E,F){B[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];E[3]=F[3]-B[2]*E[1];return[B,C,E]}function t(B,C,E){B[0]=C[0]+E[0];B[1]=C[1]+E[1];B[2]=C[2]+E[2];B[3]=C[3]+E[3];return B}function w(B,C,E){B[0]=C[0]-E[0];B[1]=C[1]-E[1];B[2]=C[2]-E[2];B[3]=C[3]-E[3];return B}function r(B,C){return B[0]===C[0]&&B[1]===C[1]&&B[2]===C[2]&&B[3]===C[3]}function x(B,C){const E=B[0],F=B[1],
M=B[2];B=B[3];const K=C[0],G=C[1],L=C[2];C=C[3];const O=b.getEpsilon();return Math.abs(E-K)<=O*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(F-G)<=O*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(M-L)<=O*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(B-C)<=O*Math.max(1,Math.abs(B),Math.abs(C))}function D(B,C,E){B[0]=C[0]*E;B[1]=C[1]*E;B[2]=C[2]*E;B[3]=C[3]*E;return B}function A(B,C,E,F){B[0]=C[0]+E[0]*F;B[1]=C[1]+E[1]*F;B[2]=C[2]+E[2]*F;B[3]=C[3]+E[3]*F;return B}const v=Object.freeze(Object.defineProperty({__proto__:null,
LDU:m,add:t,adjoint:k,copy:c,determinant:d,equals:x,exactEquals:r,frob:l,fromRotation:h,fromScaling:z,identity:y,invert:q,mul:f,multiply:f,multiplyScalar:D,multiplyScalarAndAdd:A,rotate:g,scale:e,set:p,str:n,sub:w,subtract:w,transpose:u},Symbol.toStringTag,{value:"Module"}));a.LDU=m;a.add=t;a.adjoint=k;a.copy=c;a.determinant=d;a.equals=x;a.exactEquals=r;a.frob=l;a.fromRotation=h;a.fromScaling=z;a.identity=y;a.invert=q;a.mat2=v;a.mul=f;a.multiply=f;a.multiplyScalar=D;a.multiplyScalarAndAdd=A;a.rotate=
g;a.scale=e;a.set=p;a.str=n;a.sub=w;a.subtract=w;a.transpose=u})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function c(q){return[q[0],q[1],q[2],q[3]]}function y(q,k,d,f){return[q,k,d,f]}function p(q,k){return new Float64Array(q,k,4)}const u=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.mat2f64=u})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){d=function(t){function w(x){x=t.call(this,x,new m)||this;x.supportsEdges=!0;x._vertexAttributeLocations=z.vertexAttributeLocations;x._configuration=new z.PathTechniqueConfiguration;x._vertexBufferLayout=w.getVertexBufferLayout();return x}b._inherits(w,t);var r=w.prototype;r.getConfiguration=function(x,D){this._configuration.output=x;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=
!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(x===u.ShaderOutput.Color||x===u.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.WindingOrder:
q.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=D.ssaoHelper.active?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.hasMultipassTerrain=D.multipassTerrain.enabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;return this._configuration};r.isVisibleForOutput=function(x){return x===u.ShaderOutput.Shadow||x===u.ShaderOutput.ShadowExcludeHighlight||
x===u.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};r.isVisible=function(){return b._get(b._getPrototypeOf(w.prototype),"isVisible",this).call(this)&&0<this.parameters.opacity};r.intersect=function(x,D,A,v,B,C){if(f.isPathGeometry(x)){D=x.path;var E=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:K,factor:G,minSize:L,maxSize:O}=this.parameters.vvSize;var F=D.sizeAttributeValue;E[0]*=c.clamp(K[0]+F*G[0],L[0],O[0]);E[1]*=c.clamp(K[2]+F*G[2],
L[2],O[2])}F=Math.max(E[0],E[1]);x=x.boundingInfo;if(null==x)this._intersectTriangles(D,E,v,B,C);else{x=y.fromValues(x.bbMin[0]-F,x.bbMin[1]-F,x.bbMin[2]-F,x.bbMax[0]+F,x.bbMax[1]+F,x.bbMax[2]+F);F=[B[0]-v[0],B[1]-v[1],B[2]-v[2]];var M=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);n.intersectAabbInvDir(x,v,[M/F[0],M/F[1],M/F[2]],A.tolerance)&&this._intersectTriangles(D,E,v,B,C)}}};r._intersectTriangles=function(x,D,A,v,B){x.baked.size&&x.baked.size[0]===D[0]&&x.baked.size[1]===D[1]||x.baked.bake(D);x.baked.intersect(A,
v,B)};r.createBufferWriter=function(){return new h.DefaultBufferWriter(this._vertexBufferLayout)};r.requiresSlot=function(x,D){switch(D){case u.ShaderOutput.Shadow:case u.ShaderOutput.ShadowHighlight:case u.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case u.ShaderOutput.Color:case u.ShaderOutput.Alpha:case u.ShaderOutput.Depth:case u.ShaderOutput.Normal:case u.ShaderOutput.Highlight:case u.ShaderOutput.ObjectAndLayerIdColor:return x===(this.parameters.transparent?
g.RenderSlot.TRANSPARENT_MATERIAL:g.RenderSlot.OPAQUE_MATERIAL)||x===g.RenderSlot.DRAPED_MATERIAL;default:return!1}};r.createGLMaterial=function(x){return new l(x)};w.getVertexBufferLayout=function(){return p.newLayout().vec3f(e.VertexAttribute.POSITION).vec4f(e.VertexAttribute.PROFILERIGHT).vec4f(e.VertexAttribute.PROFILEUP).vec4f(e.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(e.VertexAttribute.FEATUREVALUE)};return b._createClass(w)}(d.Material);let l=function(t){function w(){return t.apply(this,
arguments)||this}b._inherits(w,t);var r=w.prototype;r._updateOccludeeState=function(x){x.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:x.hasOccludees})};r._updateShadowState=function(x){null!=this.technique&&x.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:x.shadowMap.enabled})};r.beginSlot=function(x){if(this._output===u.ShaderOutput.Color||this._output===u.ShaderOutput.Alpha)this._updateShadowState(x),
this._updateOccludeeState(x);return this.ensureTechnique(z.PathTechnique,x)};return b._createClass(w)}(k),m=function(t){function w(){var r=t.apply(this,arguments)||this;r.doubleSided=!1;r.doubleSidedType="normal";r.receiveSSAO=!0;r.receiveShadows=!1;r.castShadows=!0;r.hasSlicePlane=!1;r.transparent=!1;r.hasOccludees=!1;return r}b._inherits(w,t);return b._createClass(w)}(z.PathPassParameters);a.PathMaterial=d;a.PathMaterialParameters=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){const D=new Map([[t.VertexAttribute.POSITION,0],[t.VertexAttribute.PROFILERIGHT,1],[t.VertexAttribute.PROFILEUP,2],[t.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[t.VertexAttribute.FEATUREVALUE,4]]);k=function(A){function v(){var B=A.apply(this,arguments)||this;B.ambient=p.fromValues(.2,.2,.2);B.diffuse=p.fromValues(.8,.8,.8);B.specular=p.fromValues(0,0,0);B.opacity=1;B.origin=p.create();B.modelTransformation=null;return B}c._inherits(v,A);return c._createClass(v)}(k.PathVertexPositionPassParameters);
e=function(A){function v(){return A.apply(this,arguments)||this}c._inherits(v,A);var B=v.prototype;B.initializeConfiguration=function(C,E){E.spherical=C.viewingMode===u.ViewingMode.Global;E.doublePrecisionRequiresObfuscation=C.rctx.driverTest.doublePrecisionRequiresObfuscation.result};B.initializeProgram=function(C){return new n.Program(C.rctx,v.shader.get().build(this.configuration),D)};B.initializePipeline=function(){const C=this.configuration.transparencyPassType,E=this.configuration,F=C===m.TransparencyPassType.NONE,
M=C===m.TransparencyPassType.FrontFace;return x.makePipelineState({blending:E.output!==q.ShaderOutput.Color&&E.output!==q.ShaderOutput.Alpha||!E.transparent?null:F?z.blendingDefault:z.oitBlending(C),culling:E.hasSlicePlane&&!E.transparent&&E.doubleSidedMode!==d.NormalsDoubleSidedMode.None?x.frontFaceCullingParams:null,depthTest:{func:z.oitDepthTest(C)},depthWrite:F||M?x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:E.hasOccludees?l.stencilWriteMaskOn:null,stencilTest:E.hasOccludees?
l.stencilBaseAllZerosParams:null,polygonOffset:F||M?null:z.OITPolygonOffset})};return c._createClass(v)}(e.ShaderTechnique);e.shader=new g.ReloadableShaderModule(r.Path,()=>new Promise((A,v)=>a(["../shaders/Path.glsl"],A,v)));g=function(A){function v(){var B=A.apply(this,arguments)||this;B.output=q.ShaderOutput.Color;B.doubleSidedMode=d.NormalsDoubleSidedMode.None;B.transparencyPassType=m.TransparencyPassType.NONE;B.spherical=!1;B.receiveShadows=!1;B.receiveAmbientOcclusion=!1;B.vvSize=!1;B.vvColor=
!1;B.vvOpacity=!1;B.hasSlicePlane=!1;B.transparent=!1;B.hasOccludees=!1;B.hasMultipassTerrain=!1;B.cullAboveGround=!1;B.doublePrecisionRequiresObfuscation=!1;return B}c._inherits(v,A);return c._createClass(v)}(w.DefaultTechniqueConfiguration);y.__decorate([h.parameter({count:q.ShaderOutput.COUNT})],g.prototype,"output",void 0);y.__decorate([h.parameter({count:d.NormalsDoubleSidedMode.COUNT})],g.prototype,"doubleSidedMode",void 0);y.__decorate([h.parameter({count:m.TransparencyPassType.COUNT})],g.prototype,
"transparencyPassType",void 0);y.__decorate([h.parameter()],g.prototype,"spherical",void 0);y.__decorate([h.parameter()],g.prototype,"receiveShadows",void 0);y.__decorate([h.parameter()],g.prototype,"receiveAmbientOcclusion",void 0);y.__decorate([h.parameter()],g.prototype,"vvSize",void 0);y.__decorate([h.parameter()],g.prototype,"vvColor",void 0);y.__decorate([h.parameter()],g.prototype,"vvOpacity",void 0);y.__decorate([h.parameter()],g.prototype,"hasSlicePlane",void 0);y.__decorate([h.parameter()],
g.prototype,"transparent",void 0);y.__decorate([h.parameter()],g.prototype,"hasOccludees",void 0);y.__decorate([h.parameter()],g.prototype,"hasMultipassTerrain",void 0);y.__decorate([h.parameter()],g.prototype,"cullAboveGround",void 0);y.__decorate([h.parameter()],g.prototype,"doublePrecisionRequiresObfuscation",void 0);y.__decorate([h.parameter({constValue:f.PBRMode.Disabled})],g.prototype,"pbrMode",void 0);y.__decorate([h.parameter({constValue:!0})],g.prototype,"hasVvInstancing",void 0);y.__decorate([h.parameter({constValue:!1})],
g.prototype,"useCustomDTRExponentForWater",void 0);y.__decorate([h.parameter({constValue:!1})],g.prototype,"useFillLights",void 0);b.PathPassParameters=k;b.PathTechnique=e;b.PathTechniqueConfiguration=g;b.vertexAttributeLocations=D;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=function(h){function z(){var n=h.apply(this,arguments)||this;n.size=c.fromValues(1,1);return n}b._inherits(z,h);return b._createClass(z)}(g.VisualVariablePassParameters);a.PathVertexPosition=function(h,z){const n=f.VertexAttribute.FEATUREVALUE;h.attributes.add(n,"vec4");const l=h.vertex;l.code.add(d.glsl`
  bool isCapVertex() {
    return ${n}.w == 1.0;
  }
  `);l.uniforms.add(new p.Float2PassUniform("size",m=>m.size));z.vvSize?(l.uniforms.add(new u.Float3PassUniform("vvSizeMinSize",m=>m.vvSize.minSize),new u.Float3PassUniform("vvSizeMaxSize",m=>m.vvSize.maxSize),new u.Float3PassUniform("vvSizeOffset",m=>m.vvSize.offset),new u.Float3PassUniform("vvSizeFactor",m=>m.vvSize.factor)),l.code.add(d.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${n}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):l.code.add(d.glsl`vec2 getSize(){
return size;
}`);z.vvOpacity?(l.constants.add("vvOpacityNumber","int",8),l.uniforms.add(new k.FloatsPassUniform("vvOpacityValues",m=>m.vvOpacity.values,8),new k.FloatsPassUniform("vvOpacityOpacities",m=>m.vvOpacity.opacityValues,8)),l.code.add(d.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${n}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):l.code.add(d.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);z.vvColor?(l.constants.add("vvColorNumber","int",g.vvColorNumber),l.uniforms.add(new k.FloatsPassUniform("vvColorValues",m=>m.vvColor.values,g.vvColorNumber),new q.Float4sPassUniform("vvColorColors",m=>m.vvColor.colors,g.vvColorNumber)),l.code.add(d.glsl`
    vec4 getColor() {
      float value = ${n}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):l.code.add(d.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);h.include(y.PositionAttribute);h.attributes.add(f.VertexAttribute.PROFILERIGHT,"vec4");h.attributes.add(f.VertexAttribute.PROFILEUP,"vec4");h.attributes.add(f.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");l.code.add(d.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);l.code.add(d.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);l.code.add(d.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);l.code.add(d.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){function A(B){const C=new x.ShaderBuilder,{vertex:E,fragment:F}=C;m.addProjViewLocalOrigin(E,B);C.varyings.add("vpos","vec3");C.include(u.PathVertexPosition,B);if(B.output===c.ShaderOutput.Color||B.output===c.ShaderOutput.Alpha)C.include(p.Transform,B),C.include(n.ReadShadowMapDraw,B),C.include(b.ForwardLinearDepth,B),C.varyings.add("vnormal","vec3"),C.varyings.add("vcolor","vec4"),B.hasMultipassTerrain&&C.varyings.add("depth","float"),E.code.add(r.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${B.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${B.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);C.include(e.multipassTerrainTest,B);switch(B.output){case c.ShaderOutput.Alpha:C.include(y.SliceDraw,B);F.uniforms.add(new w.FloatPassUniform("opacity",M=>M.opacity));F.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${B.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case c.ShaderOutput.Color:C.include(y.SliceDraw,B);C.include(f.EvaluateSceneLighting,B);C.include(d.EvaluateAmbientOcclusion,B);C.include(n.ReadShadowMapDraw,B);C.include(h.Normals,B);m.addCameraPosition(F,B);f.addAmbientBoostFactor(F);f.addLightingGlobalFactor(F);F.uniforms.add(E.uniforms.get("localOrigin"),new t.Float3PassUniform("ambient",M=>M.ambient),new t.Float3PassUniform("diffuse",M=>M.diffuse),new t.Float3PassUniform("specular",M=>M.specular),new w.FloatPassUniform("opacity",
M=>M.opacity));F.include(l.ColorConversion);g.addMainLightIntensity(F);F.code.add(r.glsl`
        void main() {
          discardBySlice(vpos);
          ${B.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${B.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":B.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${B.transparencyPassType===D.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:C.include(p.Transform,B);b.addNearFar(C);C.varyings.add("depth","float");E.code.add(r.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);C.include(y.SliceDraw,B);C.include(q.OutputDepth,B);F.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case c.ShaderOutput.Normal:C.include(p.Transform,B);C.include(z.NormalUtils,B);m.addViewNormal(E);C.varyings.add("vnormal","vec3");E.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);C.include(y.SliceDraw,B);F.code.add(r.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case c.ShaderOutput.Highlight:C.include(p.Transform,B),C.include(z.NormalUtils,B),C.varyings.add("vnormal","vec3"),E.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),C.include(y.SliceDraw,B),C.include(k.OutputHighlight,B),F.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return C}const v=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.Path=v;a.build=A})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E){const F=["polyline","polygon","extent"],M=new t.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});h=function(O){function I(J,N,R,W){J=O.call(this,J,N,R,W)||this;J._needsUV=!1;J._hasOutline=!1;return J}b._inherits(I,O);var H=I.prototype;H.doLoad=async function(){this._fastUpdates=t.initFastSymbolUpdatesState(this._context.renderer,M)};H._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};H._ensureFillMaterial=
function(){if(null==this._material){var J=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._material=w.createMaterial(this.symbolLayer,{color:J,transparent:1>J[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._material instanceof C.PatternMaterial;this._context.stage.add(this._material)}};H._ensureOutlineMaterial=
function(){const J=this.symbolLayer.outline;!this._outlineMaterial&&this._isValidOutline(J)&&(this._hasOutline=!0,this._outlineMaterial=(N=>{const R=B.getStipplePatternForLinePattern(J.pattern);return new E.RibbonLineMaterial({width:N,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:R,stippleScaleWithLineWidth:!0,cap:l.parseCapType(J.patternCap||"butt")})})(y.pt2px(J.size)),this._context.stage.add(this._outlineMaterial))};H._isValidOutline=
function(J){return null!=J&&null!=J.size&&0<J.size&&null!=J.color&&(null==J.pattern||"style"!==J.pattern.type||"none"!==J.pattern.style)};H.destroy=function(){b._get(b._getPrototypeOf(I.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};H.createGraphics3DGraphic=function(J){const N=J.graphic;if(!this._validateGeometry(N.geometry,F,this.symbolLayer.type))return null;J=this._getVertexOpacityAndColor(J.renderingInfo,
255);const R=this.setGraphicElevationContext(N,new f.ElevationContext);this.ensureDrapedStatus("on-the-ground"===R.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(N,J):this._createAs3DShape(N,J,R)};H.applyRendererDiff=function(J,N){for(const R in J.diff)switch(R){case "visualVariables":if(t.updateFastSymbolUpdatesState(this._fastUpdates,N,M))this._material&&this._material.setParameters(this._fastUpdates.materialParameters);else return n.ApplyRendererDiffResult.RecreateSymbol;
break;default:return n.ApplyRendererDiffResult.RecreateSymbol}return n.ApplyRendererDiffResult.FastUpdate};H.layerOpacityChanged=function(){if(null!=this._material){var J=this._material.parameters.color;const N=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._material.setParameters({color:[J[0],J[1],J[2],N],transparent:1>N||this.needsDrivenTransparentPass})}null!=this._outlineMaterial&&(J=this._outlineMaterial.parameters.color,this._outlineMaterial.setParameters({color:[J[0],J[1],
J[2],this._getOutlineOpacity()]}))};H.layerElevationInfoChanged=function(J,N,R){const W=this._elevationContext.mode;R=d.elevationModeChangeUpdateType(I.elevationModeChangeTypes,R,W);if(R!==d.SymbolUpdateType.UPDATE)return R;const T=d.needsElevationUpdates2D(W);return this.updateGraphics3DGraphicElevationInfo(J,N,()=>T)};H.slicePlaneEnabledChanged=function(){this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0};H.physicalBasedRenderingChanged=function(){return!0};H._createAs3DShape=function(J,N,R){const W=m.geometryAsPolygon(J.geometry);if(!W)return null;var T=D.geometryToRenderInfo(W,this._context.elevationProvider,this._context.renderCoordsHelper,R);N=new G(T,N,this._context.layer.uid,J.uid);T=N.renderData.position.length/3;this._needsUV&&(N.uvMapSpace=k.newFloatArray(4*T,!0),N.boundingRect=q.newDoubleArray(9*T,!0),r.createMapSpaceUVCoords(N.uvMapSpace,N.boundingRect,N.renderData.position,this._context.renderCoordsHelper));
N.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(N);this._createAs3DShapeFill(J,N);this._hasOutline&&this._createAs3DShapeOutline(N);this._logGeometryCreationWarnings(N.renderData,W.rings,"rings","FillSymbol3DLayer");if(0===N.outGeometries.length)return null;J=new A.Object3D({geometries:N.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:J.uid});J=new e.Graphics3DObject3DGraphicLayer(this,J,N.outGeometries,null,null,w.uvElevationAligner,R);J.alignedSampledElevation=
N.renderData.sampledElevation;J.needsElevationUpdates=d.needsElevationUpdates2D(R.mode);return J};H._createAs3DShapeFill=function(J,N){var R=N.renderData.polygons;for(const {position:W,mapPositions:T,holeIndices:P,index:Q,count:S}of R){if(null!=this._context.clippingExtent&&(u.empty(K),u.expandWithBuffer(K,T),!u.intersectsClippingArea(K,this._context.clippingExtent)))continue;R=p.earcut(T,P,3);if(0===R.length)continue;const U=this._fastUpdates?.visualVariables.color;R=m.createColorGeometry({material:this._material,
indices:R,mapPositions:T,attributeData:{position:W,color:U?null:N.color,colorFeature:U?t.getAttributeValue(U.field,J):null,uvMapSpace:this._needsUV?k.floatSubArray(N.uvMapSpace,4*Q,4*S):null,boundingRect:this._needsUV?q.doubleSubArray(N.boundingRect,9*Q,9*S):null,objectAndLayerIdColor:N.objectAndLayerIdColor}});N.outGeometries.push(R)}};H._createAs3DShapeOutline=function(J){if(this._hasOutline){var N=J.renderData.outlines;for(let R=0;R<N.length;++R){const {mapPositions:W,position:T}=N[R];if(null!=
this._context.clippingExtent&&(u.empty(K),u.expandWithBuffer(K,W),!u.intersectsClippingArea(K,this._context.clippingExtent)))continue;const P=x.createGeometry(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:W,attributeData:{position:T}},J.objectAndLayerIdColor);J.outGeometries.push(P)}}};H._createAsOverlay=function(J,N){const R=m.geometryAsPolygon(J.geometry);if(null==R)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2;null!=
this._outlineMaterial&&(this._outlineMaterial.renderPriority=this._renderPriority);var W=D.geometryToRenderInfoDraped(R,this._context.overlaySR);N=new L(W,N,this._context.layer.uid,J.uid);W=N.renderData.position.length/3;this._needsUV&&(N.uvMapSpace=k.newFloatArray(4*W,!0),r.createMapSpaceUVCoordsDraped(N.uvMapSpace,N.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));N.outBoundingBox=u.empty();N.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(N);
this._createAsOverlayFill(J,N);this._hasOutline&&this._createAsOverlayOutline(N);this._logGeometryCreationWarnings(N.renderData,R.rings,"rings","FillSymbol3DLayer");return 0===N.outGeometries.length?null:new g(this,N.outGeometries,N.outBoundingBox,this._context.drapeSourceRenderer)};H._createAsOverlayFill=function(J,N){var R=N.renderData.polygons;for(const {position:T,holeIndices:P,index:Q,count:S}of R){var W=u.empty(K);u.expandWithBuffer(W,T);u.intersectsClippingArea(W,this._context.clippingExtent)&&
(R=p.earcut(T,P,3),0!==R.length&&(u.expandWithAABB(N.outBoundingBox,W),W=this._fastUpdates?.visualVariables.color,R=m.createColorGeometry({material:this._material,indices:R,attributeData:{position:T,color:W?null:N.color,colorFeature:W?t.getAttributeValue(W.field,J):null,uvMapSpace:this._needsUV?k.floatSubArray(N.uvMapSpace,4*Q,4*S):null,objectAndLayerIdColor:N.objectAndLayerIdColor}}),N.outGeometries.push(new v.RenderGeometry(R,N))))}};H._createAsOverlayOutline=function(J){if(this._hasOutline){var N=
J.renderData.outlines;for(let W=0;W<N.length;++W){var {position:R}=N[W];u.empty(K);u.expandWithBuffer(K,R);u.intersectsClippingArea(K,this._context.clippingExtent)&&(u.expandWithAABB(J.outBoundingBox,K),R=x.createGeometry(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:R}},J.objectAndLayerIdColor),J.outGeometries.push(new v.RenderGeometry(R,J)))}}};H._getOutlineOpacity=
function(){const J=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=J?J.a:0)};H._getOutlineColor=function(){const J=this.symbolLayer?.outline?.color,N=this._getOutlineOpacity();return z.mixinColorAndOpacity(null!=J?c.toUnitRGB(J):null,N)};H.test=function(){return{...b._get(b._getPrototypeOf(I.prototype),"test",this).call(this),createAsOverlay:(J,N)=>this._createAsOverlay(J,N),createAs3DShape:(J,N,R)=>this._createAs3DShape(J,N,R)}};return b._createClass(I)}(h.Graphics3DSymbolLayer);
h.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.RECREATE,staysOnTheGround:d.SymbolUpdateType.NONE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};const K=u.create();let G=function(O){function I(H,J,N,R){H=O.call(this,H,N,R)||this;H.color=J;return H}b._inherits(I,O);return b._createClass(I)}(m.PolygonCreationDataBase),L=function(O){function I(H,J,N,R){H=O.call(this,H,N,R)||this;H.color=J;return H}b._inherits(I,O);return b._createClass(I)}(m.PolygonCreationDataBase);a.Graphics3DPolygonFillSymbolLayer=
h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../chunks/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,c,y,p,u,q,k,d){function f(h){switch(h){case "horizontal":return d.Style.Horizontal;
case "vertical":return d.Style.Vertical;case "cross":return d.Style.Cross;case "forward-diagonal":return d.Style.ForwardDiagonal;case "backward-diagonal":return d.Style.BackwardDiagonal;case "diagonal-cross":return d.Style.DiagonalCross}}function g(h){return h.material instanceof k.PatternMaterial&&!h.material.parameters.draped}function e(h,z){if(g(h)){const n=h.vertexAttributes.get(u.VertexAttribute.POSITION).data,l=h.getMutableAttribute(u.VertexAttribute.UVMAPSPACE).data;h=h.getMutableAttribute(u.VertexAttribute.BOUNDINGRECT).data;
p.createMapSpaceUVCoords(l,h,n,z)}}a.createMaterial=function(h,z){h=h?.pattern??null;if(null==h)return new q.ColorMaterial(z);if("none"===h.style||"solid"===h.style)return"none"===h.style&&(z.color=c.fromValues(0,0,0,0),z.transparent=!0),new q.ColorMaterial(z);z.style=f(h.style);return new k.PatternMaterial(z)};a.parsePatternStyle=f;a.requiresUVUpdates=g;a.updateMapSpaceUVCoords=e;a.uvElevationAligner=function(h,z,n,l,m){z=y.perVertexElevationAligner(h,z,n,l,m);h=h.stageObject.geometries;for(const t of h)e(t,
m);return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){function e(M,K,G,L,O,
I,H){p.set(M,K*O[0]+G*I[0]+L*H[0],K*O[1]+G*I[1]+L*H[1],K*O[2]+G*I[2]+L*H[2])}const h=u.create(),z=u.create(),n=f.create(),l=u.create(),m=u.create(),t=u.create(),w=y.create(),r=y.create(),x=u.create(),D=u.create(),A=u.create(),v=b.create(),B=u.create(),C=u.create(),E=u.create(),F=u.create();a.createMapSpaceUVCoords=function(M,K,G,L,O=1){p.set(l,1,0,0);p.set(m,0,1,0);p.set(t,0,0,1);p.set(F,0,0,0);for(var I=0;I<G.length-3;I+=3)F[0]+=G[I],F[1]+=G[I+1],F[2]+=G[I+2];p.scale(h,F,1/(G.length/3-1));I=G.length/
3-1;if(f.fromManyPointsSampleAt(G,n,0,Math.floor(I/3),Math.floor(2/3*I))){null!=L?(L.basisMatrixAtPosition(h,v),p.set(B,v[0],v[1],v[2]),p.set(C,v[4],v[5],v[6]),p.set(E,v[8],v[9],v[10])):(p.set(B,1,0,0),p.set(C,0,1,0),p.set(E,0,0,1));L=f.normal(n);0>p.dot(L,E)&&p.scale(L,L,-1);p.copy(t,L);I=p.dot(L,C);var H=p.dot(L,B);Math.abs(I)<Math.abs(H)?(p.scaleAndAdd(l,B,L,-H),p.normalize(l,l),p.cross(m,l,L),p.normalize(m,m),p.scale(m,m,-1)):(p.scaleAndAdd(m,C,L,-I),p.normalize(m,m),p.cross(l,m,L),p.normalize(l,
l))}c.set(w,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);c.set(r,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(L=0;L<G.length;L+=3)p.set(z,G[L],G[L+1],G[L+2]),I=p.dot(l,z),H=p.dot(m,z),w[0]=Math.min(w[0],I),w[1]=Math.min(w[1],H),r[0]=Math.max(r[0],I),r[1]=Math.max(r[1],H);L=p.dot(t,h);e(x,w[0],w[1],L,l,m,t);e(D,r[0],w[1],L,l,m,t);e(A,w[0],r[1],L,l,m,t);p.subtract(D,D,x);p.scale(D,D,.5);p.subtract(A,A,x);p.scale(A,A,.5);p.add(x,x,D);p.add(x,x,A);L=w[0]-w[0]%O;I=w[1]-w[1]%O;for(H=0;H<
G.length;H+=3){p.set(z,G[H],G[H+1],G[H+2]);var J=H/3,N=4*J;M[N]=(p.dot(l,z)-L)/O;M[N+1]=(p.dot(m,z)-I)/O;M[N+2]=L/O;M[N+3]=I/O;J*=9;for(N=0;3>N;N++)K[J+N]=x[N],K[J+N+3]=D[N],K[J+N+6]=A[N]}};a.createMapSpaceUVCoordsDraped=function(M,K,G,L,O=1){if(G.isGeographic&&L===g.ViewingMode.Global){L=d.newDoubleArray(K.length);var I=K.length;G=q.getReferenceEllipsoid(G);for(var H=0;H<I;H+=3)k.lonLatToWebMercatorComparable(K,H,L,H,G);K=L}c.set(w,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(L=0;L<K.length;L+=
3)w[0]=Math.min(w[0],K[L]),w[1]=Math.min(w[1],K[L+1]);L=w[0]-w[0]%O;I=w[1]-w[1]%O;for(G=0;G<K.length;G+=3)H=G/3*4,M[H]=(K[G]-L)/O,M[H+1]=(K[G+1]-I)/O,M[H+2]=L/O,M[H+3]=I/O};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./TriangleMaterial ./VisualVariablePassParameters ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){h=function(w){function r(D){D=w.call(this,D,new t)||this;D.supportsEdges=!0;D._configuration=new l.ColorMaterialTechniqueConfiguration;return D}b._inherits(r,w);var x=r.prototype;x.getConfiguration=function(D,A){this._configuration.output=D;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<d.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=A.multipassTerrain.enabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;this._configuration.vvColor=
!!this.parameters.vvColor;return this._configuration};x.requiresSlot=function(D,A){return A===u.ShaderOutput.Color||A===u.ShaderOutput.Alpha||A===u.ShaderOutput.Highlight||A===u.ShaderOutput.Depth&&this.parameters.writeLinearDepth||A===u.ShaderOutput.ObjectAndLayerIdColor?D===f.RenderSlot.DRAPED_MATERIAL?!0:A===u.ShaderOutput.Highlight?D===f.RenderSlot.OPAQUE_MATERIAL:D===(this.parameters.transparent?this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:
f.RenderSlot.OPAQUE_MATERIAL):!1};x.createGLMaterial=function(D){return new m(D)};x.createBufferWriter=function(){const D=p.newLayout().vec3f(g.VertexAttribute.POSITION);c("enable-feature:objectAndLayerId-rendering")&&D.vec4u8(g.VertexAttribute.OBJECTANDLAYERIDCOLOR);this.parameters.vvColor?D.f32(g.VertexAttribute.COLORFEATUREATTRIBUTE):D.vec4u8(g.VertexAttribute.COLOR);return new e.DefaultBufferWriter(D)};return b._createClass(r)}(h.TriangleMaterial);let m=function(w){function r(){return w.apply(this,
arguments)||this}b._inherits(r,w);var x=r.prototype;x._updateOccludeeState=function(D){D.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:D.hasOccludees})};x.beginSlot=function(D){this._output!==u.ShaderOutput.Color&&this._output!==u.ShaderOutput.Alpha||this._updateOccludeeState(D);return this.ensureTechnique(n.ColorMaterialTechnique,D)};return b._createClass(r)}(k),t=function(w){function r(){var x=w.apply(this,arguments)||this;x.color=y.ZEROS;x.transparent=
!1;x.writeDepth=!0;x.writeLinearDepth=!1;x.hasVertexColors=!1;x.polygonOffset=!1;x.hasSlicePlane=!1;x.cullFace=q.CullFaceOptions.None;x.hasOccludees=!1;return x}b._inherits(r,w);return b._createClass(r)}(z.VisualVariablePassParameters);a.ColorMaterial=h;a.Parameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/VisualVariablePassParameters ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){h=function(m){function t(){var w=m.apply(this,arguments)||this;w.color=y.ZEROS;return w}c._inherits(t,m);return c._createClass(t)}(h.VisualVariablePassParameters);q=function(m){function t(){return m.apply(this,arguments)||this}c._inherits(t,m);var w=t.prototype;w.initializeProgram=function(r){return new f.Program(r.rctx,t.shader.get().build(this.configuration),k.Default3D)};w._createPipeline=function(r,x){const D=this.configuration,A=r===e.TransparencyPassType.NONE,
v=r===e.TransparencyPassType.FrontFace;return n.makePipelineState({blending:D.output!==p.ShaderOutput.Color&&D.output!==p.ShaderOutput.Alpha||!D.transparent?null:A?d.blendingDefault:d.oitBlending(r),culling:n.cullingParams(D.cullFace),depthTest:{func:d.oitDepthTest(r)},depthWrite:A||v?D.writeDepth?n.defaultDepthWriteParams:null:null,colorWrite:n.defaultColorWriteParams,stencilWrite:D.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:D.hasOccludees?x?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:
null,polygonOffset:A||v?D.polygonOffset?l:null:d.getOITPolygonOffset(D.enableOffset)})};w.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};w.getPipelineState=function(r,x){return x?this._occludeePipelineState:c._get(c._getPrototypeOf(t.prototype),"getPipelineState",this).call(this,r,x)};return c._createClass(t)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(z.ColorMaterial,
()=>new Promise((m,t)=>a(["./ColorMaterial.glsl"],m,t)));const l={factor:1,units:1};b.ColorMaterialPassParameters=h;b.ColorMaterialTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){function r(D){const A=new m.ShaderBuilder,{vertex:v,fragment:B,attributes:C,varyings:E}=A;z.addProjViewLocalOrigin(v,D);A.include(p.Transform,D);A.include(q.VertexColor,D);A.include(g.VisualVariables,D);A.include(u.ObjectAndLayerIdColor,D);C.add(w.VertexAttribute.POSITION,"vec3");D.vvColor&&C.add(w.VertexAttribute.COLORFEATUREATTRIBUTE,"float");E.add("vColor","vec4");E.add("vpos","vec3");const F=D.hasMultipassTerrain&&(D.output===c.ShaderOutput.Color||
D.output===c.ShaderOutput.Alpha);F&&E.add("depth","float");v.uniforms.add(new n.Float4PassUniform("eColor",K=>K.color));var M=D.output===c.ShaderOutput.Depth;M&&(A.include(k.OutputDepth,D),b.addNearFar(A),b.addLinearDepth(A));v.code.add(l.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${D.hasVertexColors?"vColor *\x3d eColor;":D.vvColor?"vColor \x3d eColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d eColor;"}
      ${F?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${M?l.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:l.glsl`transformPosition(proj, view, vpos);`}
    }
  `);A.include(y.SliceDraw,D);F&&A.include(f.multipassTerrainTest,D);B.include(h.ColorConversion);(M=D.output===c.ShaderOutput.Highlight)&&A.include(d.OutputHighlight,D);B.code.add(l.glsl`
  void main() {
    discardBySlice(vpos);
    ${F?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?l.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${l.glsl.float(e.symbolAlphaCutoff)}) {
      discard;
    }

    ${D.output===c.ShaderOutput.Alpha?l.glsl`fragColor = vec4(fColor.a);`:""}

    ${D.output===c.ShaderOutput.Color?l.glsl`fragColor = highlightSlice(fColor, vpos); ${D.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${M?l.glsl`outputHighlight();`:""};
    ${D.output===c.ShaderOutput.Depth?l.glsl`outputDepth(linearDepth);`:""};
    ${D.output===c.ShaderOutput.ObjectAndLayerIdColor?l.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return A}const x=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=x;a.build=r})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k){k=function(d){function f(){var g=d.apply(this,arguments)||this;g.output=y.ShaderOutput.Color;g.cullFace=u.CullFaceOptions.None;g.transparencyPassType=q.TransparencyPassType.NONE;g.hasSlicePlane=!1;g.hasVertexColors=!1;g.transparent=!1;g.polygonOffset=!1;g.enableOffset=!0;g.writeDepth=!0;g.hasOccludees=!1;g.hasMultipassTerrain=!1;g.cullAboveGround=!1;g.objectAndLayerIdColorInstanced=!1;g.vvColor=!1;return g}b._inherits(f,d);return b._createClass(f)}(k.DefaultTechniqueConfiguration);
c.__decorate([p.parameter({count:y.ShaderOutput.COUNT})],k.prototype,"output",void 0);c.__decorate([p.parameter({count:u.CullFaceOptions.COUNT})],k.prototype,"cullFace",void 0);c.__decorate([p.parameter({count:q.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",void 0);c.__decorate([p.parameter()],k.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],k.prototype,"hasVertexColors",void 0);c.__decorate([p.parameter()],k.prototype,"transparent",void 0);c.__decorate([p.parameter()],
k.prototype,"polygonOffset",void 0);c.__decorate([p.parameter()],k.prototype,"enableOffset",void 0);c.__decorate([p.parameter()],k.prototype,"writeDepth",void 0);c.__decorate([p.parameter()],k.prototype,"hasOccludees",void 0);c.__decorate([p.parameter()],k.prototype,"hasMultipassTerrain",void 0);c.__decorate([p.parameter()],k.prototype,"cullAboveGround",void 0);c.__decorate([p.parameter()],k.prototype,"objectAndLayerIdColorInstanced",void 0);c.__decorate([p.parameter()],k.prototype,"vvColor",void 0);
c.__decorate([p.parameter({constValue:!0})],k.prototype,"hasVvInstancing",void 0);c.__decorate([p.parameter({constValue:!1})],k.prototype,"vvSize",void 0);c.__decorate([p.parameter({constValue:!1})],k.prototype,"vvOpacity",void 0);a.ColorMaterialTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){n=function(D){function A(B){B=D.call(this,B,new x)||this;B.supportsEdges=!0;B._vertexAttributeLocations=t.vertexAttributeLocations;B._configuration=new t.PatternTechniqueConfiguration;return B}b._inherits(A,D);var v=A.prototype;v.getConfiguration=function(B,C){this._configuration.output=B;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=C.transparencyPassType;this._configuration.enableOffset=C.camera.relativeElevation<d.OITPolygonOffsetLimit;
this._configuration.hasMultipassTerrain=C.multipassTerrain.enabled;this._configuration.cullAboveGround=C.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration};v.requiresSlot=function(B,C){return C===u.ShaderOutput.Color||C===u.ShaderOutput.Alpha||C===u.ShaderOutput.Highlight||C===u.ShaderOutput.Depth&&this.parameters.writeLinearDepth?B===f.RenderSlot.DRAPED_MATERIAL?!0:C===u.ShaderOutput.Highlight?B===f.RenderSlot.OPAQUE_MATERIAL:B===(this.parameters.writeDepth?
f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1};v.createGLMaterial=function(B){return new w(B)};v.createBufferWriter=function(){const B=p.newLayout().vec3f(e.VertexAttribute.POSITION).vec4f(e.VertexAttribute.UVMAPSPACE);this.parameters.draped||B.mat3f(e.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?B.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):B.vec4u8(e.VertexAttribute.COLOR);return new r(B)};return b._createClass(A)}(n.TriangleMaterial);let w=
function(D){function A(){return D.apply(this,arguments)||this}b._inherits(A,D);var v=A.prototype;v._updateParameters=function(B){return this.ensureTechnique(t.PatternTechnique,B)};v._updateOccludeeState=function(B){B.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:B.hasOccludees})};v.beginSlot=function(B){this._output!==u.ShaderOutput.Color&&this._output!==u.ShaderOutput.Alpha||this._updateOccludeeState(B);return this._updateParameters(B)};return b._createClass(A)}(k),
r=function(D){function A(){return D.apply(this,arguments)||this}b._inherits(A,D);var v=A.prototype;v.write=function(B,C,E,F,M){for(const G of this.vertexBufferLayout.fields.keys()){const L=E.vertexAttributes.get(G),O=E.indices.get(G);if(L&&O)switch(G){case e.VertexAttribute.UVMAPSPACE:g.assert(4===L.size);var K=F.getField(G,y.BufferViewVec4f);K&&m.writeBufferVec4(O,L.data,K,M);break;case e.VertexAttribute.BOUNDINGRECT:g.assert(9===L.size);(K=F.getField(G,y.BufferViewMat3f))&&this.writeBoundingRect(O,
L.data,B,K,M);break;default:m.writeDefaultAttribute(G,L,O,B,C,F,M)}}};v.writeBoundingRect=function(B,C,E,F,M){const K=F.typedBuffer;F=F.typedBufferStride;const G=B.length;M*=F;for(let O=0;O<G;++O){const I=9*B[O];var L=C[I];const H=C[I+1],J=C[I+2];K[M]=E[0]*L+E[4]*H+E[8]*J+E[12];K[M+1]=E[1]*L+E[5]*H+E[9]*J+E[13];K[M+2]=E[2]*L+E[6]*H+E[10]*J+E[14];for(L=3;9>L;++L)K[M+L]=C[I+L];M+=F}};return b._createClass(A)}(h.DefaultBufferWriter),x=function(D){function A(){var v=D.apply(this,arguments)||this;v.color=
c.fromValues(1,1,1,1);v.writeDepth=!0;v.writeLinearDepth=!1;v.hasVertexColors=!1;v.polygonOffset=!1;v.hasSlicePlane=!1;v.cullFace=q.CullFaceOptions.None;v.hasOccludees=!1;v.style=z.Style.Cross;v.patternSpacing=10;v.lineWidth=1;v.draped=!0;return v}b._inherits(A,D);return b._createClass(A)}(l.VisualVariablePassParameters);a.Parameters=x;a.PatternMaterial=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],
function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){q=function(x){function D(){return x.apply(this,arguments)||this}c._inherits(D,x);var A=D.prototype;A.initializeProgram=function(v){return new g.Program(v.rctx,D.shader.get().build(this.configuration),r)};A._setPipelineState=function(v,B){const C=this.configuration,E=v===h.TransparencyPassType.NONE,F=v===h.TransparencyPassType.FrontFace;return t.makePipelineState({blending:C.output===p.ShaderOutput.Color||C.output===p.ShaderOutput.Alpha?E?f.blendingDefault:
f.oitBlending(v):null,culling:t.cullingParams(C.cullFace),depthTest:{func:f.oitDepthTest(v)},depthWrite:E?C.writeDepth?t.defaultDepthWriteParams:null:f.oitDepthWrite(v),colorWrite:t.defaultColorWriteParams,stencilWrite:C.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?B?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:E||F?C.polygonOffset?w:null:f.getOITPolygonOffset(C.enableOffset)})};A.initializePipeline=function(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,
!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};A.getPipelineState=function(v,B){return B?this._occludeePipelineState:c._get(c._getPrototypeOf(D.prototype),"getPipelineState",this).call(this,v,B)};return c._createClass(D)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(m.Pattern,()=>new Promise((x,D)=>a(["./Pattern.glsl"],x,D)));const w={factor:1,units:1};u=function(x){function D(){var A=x.apply(this,arguments)||this;A.output=p.ShaderOutput.Color;A.cullFace=
d.CullFaceOptions.None;A.transparencyPassType=h.TransparencyPassType.NONE;A.hasSlicePlane=!1;A.hasVertexColors=!1;A.polygonOffset=!1;A.writeDepth=!0;A.hasOccludees=!1;A.enableOffset=!0;A.hasMultipassTerrain=!1;A.cullAboveGround=!1;A.vvColor=!1;return A}c._inherits(D,x);return c._createClass(D)}(n.DefaultTechniqueConfiguration);y.__decorate([k.parameter({count:p.ShaderOutput.COUNT})],u.prototype,"output",void 0);y.__decorate([k.parameter({count:d.CullFaceOptions.COUNT})],u.prototype,"cullFace",void 0);
y.__decorate([k.parameter({count:l.Style.COUNT})],u.prototype,"style",void 0);y.__decorate([k.parameter({count:h.TransparencyPassType.COUNT})],u.prototype,"transparencyPassType",void 0);y.__decorate([k.parameter()],u.prototype,"hasSlicePlane",void 0);y.__decorate([k.parameter()],u.prototype,"hasVertexColors",void 0);y.__decorate([k.parameter()],u.prototype,"polygonOffset",void 0);y.__decorate([k.parameter()],u.prototype,"writeDepth",void 0);y.__decorate([k.parameter()],u.prototype,"hasOccludees",
void 0);y.__decorate([k.parameter()],u.prototype,"patternSpacing",void 0);y.__decorate([k.parameter()],u.prototype,"lineWidth",void 0);y.__decorate([k.parameter()],u.prototype,"enableOffset",void 0);y.__decorate([k.parameter()],u.prototype,"draped",void 0);y.__decorate([k.parameter()],u.prototype,"hasMultipassTerrain",void 0);y.__decorate([k.parameter()],u.prototype,"cullAboveGround",void 0);y.__decorate([k.parameter()],u.prototype,"vvColor",void 0);y.__decorate([k.parameter({constValue:!1})],u.prototype,
"hasVvInstancing",void 0);y.__decorate([k.parameter({constValue:!1})],u.prototype,"vvSize",void 0);y.__decorate([k.parameter({constValue:!1})],u.prototype,"vvOpacity",void 0);const r=new Map([[z.VertexAttribute.POSITION,0],[z.VertexAttribute.COLOR,3],[z.VertexAttribute.UVMAPSPACE,4],[z.VertexAttribute.COLORFEATUREATTRIBUTE,5],[z.VertexAttribute.BOUNDINGRECT,6]]);b.PatternTechnique=q;b.PatternTechniqueConfiguration=u;b.vertexAttributeLocations=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){function x(v){const B=new m.ShaderBuilder,C=v.hasMultipassTerrain&&(v.output===c.ShaderOutput.Color||v.output===c.ShaderOutput.Alpha),{vertex:E,fragment:F,attributes:M,varyings:K}=B;h.addProjViewLocalOrigin(E,v);B.include(p.Transform,v);B.include(u.VertexColor,v);B.include(f.VisualVariables,v);v.draped?E.uniforms.add(new n.FloatPassUniform("worldToScreenRatio",(L,O)=>1/O.screenToPCSRatio)):M.add(w.VertexAttribute.BOUNDINGRECT,"mat3");M.add(w.VertexAttribute.POSITION,
"vec3");M.add(w.VertexAttribute.UVMAPSPACE,"vec4");v.vvColor&&M.add(w.VertexAttribute.COLORFEATUREATTRIBUTE,"float");K.add("vColor","vec4");K.add("vpos","vec3");K.add("vuv","vec2");C&&K.add("depth","float");E.uniforms.add(new z.Float4PassUniform("uColor",L=>L.color));var G=v.style===r.Style.ForwardDiagonal||v.style===r.Style.BackwardDiagonal||v.style===r.Style.DiagonalCross;G&&E.code.add(l.glsl`
      const mat2 rotate45 = mat2(${l.glsl.float(.70710678118)}, ${l.glsl.float(-.70710678118)},
                                 ${l.glsl.float(.70710678118)}, ${l.glsl.float(.70710678118)});
    `);v.draped||(h.addCameraPosition(E,v),E.uniforms.add(new n.FloatPassUniform("worldToScreenPerDistanceRatio",(L,O)=>1/O.camera.perScreenPixelRatio)),E.code.add(l.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),E.code.add(l.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),E.code.add(l.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${l.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));E.code.add(l.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${G?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${G?" * rotate45":""};

      ${v.draped?"":l.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${l.glsl.float(v.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(G=v.output===c.ShaderOutput.Depth)B.include(q.OutputDepth,v),b.addNearFar(B),b.addLinearDepth(B);E.code.add(l.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${C?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${v.hasVertexColors?"vColor *\x3d uColor;":v.vvColor?"vColor \x3d uColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d uColor;"}
      gl_Position = ${G?l.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:l.glsl`transformPosition(proj, view, vpos);`}
    }
  `);B.include(y.SliceDraw,v);F.include(e.ColorConversion);v.draped&&F.uniforms.add(new n.FloatPassUniform("texelSize",(L,O)=>1/O.camera.pixelRatio));v.output===c.ShaderOutput.Highlight&&B.include(k.OutputHighlight,v);C&&B.include(d.multipassTerrainTest,v);v.output!==c.ShaderOutput.Highlight&&(F.code.add(l.glsl`
      const float lineWidth = ${l.glsl.float(v.lineWidth)};
      const float spacing = ${l.glsl.float(v.patternSpacing)};
      const float spacingINV = ${l.glsl.float(1/v.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),v.draped||F.code.add(l.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.code.add(l.glsl`
    void main() {
      discardBySlice(vpos);
      ${C?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${v.output!==c.ShaderOutput.Highlight?l.glsl`color.a *= ${D(v)};`:""}

      ${v.output===c.ShaderOutput.ObjectAndLayerIdColor?l.glsl`color.a = 1.0;`:""}

      if (color.a < ${l.glsl.float(g.symbolAlphaCutoff)}) {
        discard;
      }

      ${v.output===c.ShaderOutput.Alpha?l.glsl`fragColor = vec4(color.a);`:""}

      ${v.output===c.ShaderOutput.Color?l.glsl`fragColor = color; ${v.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${v.output===c.ShaderOutput.Highlight?l.glsl`outputHighlight();`:""}
      ${v.output===c.ShaderOutput.Depth?l.glsl`outputDepth(linearDepth);`:""};
    }
  `);return B}function D(v){function B(C){return v.draped?l.glsl`coverage(vuv.${C}, texelSize)`:l.glsl`sampleAA(vuv.${C})`}switch(v.style){case r.Style.ForwardDiagonal:case r.Style.Horizontal:return B("y");case r.Style.BackwardDiagonal:case r.Style.Vertical:return B("x");case r.Style.DiagonalCross:case r.Style.Cross:return l.glsl`
        1.0 - (1.0 - ${B("x")}) * (1.0 - ${B("y")})
      `;default:return"0.0"}}const A=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.Pattern=A;a.build=x})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){function D(C,E,F){C&&C.forEach(M=>{const K=E(M);null!=K&&F(K,M.graphic)})}function A(C,E){if("baseline"===E.verticalPlacement)return u.fromValues(l.horizontalPlacementToAnchorX[E.horizontalPlacement],null!=C?C.baselineAnchorY:0);C=l.anchorFromPlacements(E.horizontalPlacement,E.verticalPlacement);return l.namedAnchorToHUDMaterialAnchorPos[C]}const v=[0,0,1];z=function(C){function E(M,K,G,L){M=C.call(this,M,K,G,L)||this;M._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!1};M.ensureDrapedStatus(!1);return M}b._inherits(E,C);var F=E.prototype;F.doLoad=async function(){if(!this._drivenProperties.size){const M=n.validateSymbolLayerSize(this.symbolLayer.size);if(M)throw new c("graphics3dtextsymbollayer:invalid-size",M);}await this._createTextRenderParameters()};F._createTextRenderParameters=async function(){this._textRenderParameters=await w.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)};
F.destroy=function(){b._get(b._getPrototypeOf(E.prototype),"destroy",this).call(this)};F.createGraphics3DGraphic=function(M){M=M.graphic;const K=m.placePointOnGeometry(M.geometry);if(null==K)return this.logger.warn(`unsupported geometry type for text symbol: ${M.geometry.type}`),null;const G=this.symbolLayer.text;if(null==G||""===G)return null;var L=q.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=L&&!q.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+
`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;L=new k.CreateLabelParameters(L,this.symbolLayer.horizontalAlignment,l.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment));return this._createAs3DShape(M,K,G,L)};F.createLabel=function(M,K,G,L){M=M.graphic;const O=m.placePointOnGeometry(M.geometry);if(null==O)return this.logger.warn(`unsupported geometry type for label: ${M.geometry.type}`),null;const I=K.text;return!I||/^\s+$/.test(I)?null:
this._createAs3DShape(M,O,I,K,G,L)};F.setGraphicElevationContext=function(M,K,G=0){M=b._get(b._getPrototypeOf(E.prototype),"setGraphicElevationContext",this).call(this,M,K);M.addOffsetRenderUnits(G);return M};F.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};F.layerElevationInfoChanged=function(M,K){D(M,K,(G,L)=>{this.updateGraphicElevationContext(L,G)});return f.SymbolUpdateType.UPDATE};F.slicePlaneEnabledChanged=
function(M,K){D(M,K,G=>{for(const L of G.stageObject.geometries)L.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.updateGraphicElevationContext=function(M,K){const G=K.elevationContext;this.setGraphicElevationContext(M,G,null!=K.metadata?K.metadata.elevationOffset:0);K.needsElevationUpdates=f.needsElevationUpdates2D(G.mode)||"absolute-height"===G.mode};F._defaultElevationInfoNoZ=function(){return B};F._createAs3DShape=
function(M,K,G,L,O,I){const H=this.setGraphicElevationContext(M,new g.ElevationContext,L.elevationOffset);var J="polyline"===M.geometry?.type,N=M.uid;let R=null;M=null;if(null==I){var W=l.textRenderAlignmentFromHorizontalPlacement(L.horizontalPlacement);R=new r(G,W,this._textRenderParameters);let Q=null;if(null!=this._context.sharedResources.textures){M=this._context.sharedResources.textures.fromData(R.key,()=>R.create(),()=>{null!=Q&&Q.release()});W=this._context.stage.renderView.textureRepository.acquire(M.texture.id);
if(null==W||y.isPromiseLike(W))return M.release(),null;Q=W}}W=A(R,L);W={occlusionTest:!0,screenOffset:L.screenOffset,anchorPosition:W,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:L.centerOffsetUnits,drawInSecondSlot:!0};null!=I?W.textureId=I.id:null!=M&&(W.textureId=M.texture.id);if(null!=L.verticalOffset){const {screenLength:Q,minWorldLength:S,maxWorldLength:U}=L.verticalOffset;W.verticalOffset={screenLength:p.pt2px(Q),minWorldLength:S||0,maxWorldLength:null!=U?U:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:Q,
screenSizePerspectiveSettingsLabels:S}=this._context.sharedResources;W.screenSizePerspective=S.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]);W.screenSizePerspectiveAlignment=Q}J&&(W.shaderPolygonOffset=1E-4);W.hasSlicePlane=this._context.slicePlaneEnabled;null!=O?(J=JSON.stringify(W),I=O.get(J),null==I&&(I=new x.HUDMaterial(W),O.add(J,I))):I=new x.HUDMaterial(W);J=L.translation;W=R?u.fromValues(R.displayWidth,R.displayHeight):u.ZEROS;
J=t.createPointGeometry(I,v,J,null,W,L.centerOffset,[0,0],null);N=m.createStageObject(this._context,K,J,H,N);if(null==N)return null;O=new e.Graphics3DObject3DGraphicLayer(this,N.object,[J],null==O?[I]:null,M,d.perObjectElevationAligner,H);O.alignedSampledElevation=N.sampledElevation;O.needsElevationUpdates=f.needsElevationUpdates2D(H.mode)||"absolute-height"===H.mode;const {displayWidth:T,displayHeight:P}=null!=R?R:L;O.getScreenSize=(Q=u.create())=>{Q[0]=T;Q[1]=P;return Q};G=new h.Graphics3DObjectMetadata(L.elevationOffset,
G);O.metadata=G;m.extendPointGraphicElevationContext(O,K,this._context.elevationProvider);return O};b._createClass(E,[{key:"pixelRatioChanged",get:function(){return!1}}]);return E}(z.Graphics3DSymbolLayer);const B={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,y,p,u,q){let k=function(){function f(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.textStyle=this._colorToRGBA(e.color);this.haloStyle=this._colorToRGB(e.halo.color);this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}var g=f.prototype;g.fontString=function(e){const h=this.definition.font;return`${h.style} ${h.weight} ${e}px ${h.family}, sans-serif`};g._colorToRGB=function(e){return`rgb(${e.slice(0,3).map(h=>
Math.floor(255*h)).toString()})`};g._colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(h=>Math.floor(255*h)).toString()},${e[3]})`};f.fromSymbol=async function(e,h){var z=c.toUnitRGBA(e?.material?.color)??q.ZEROS,n=null!=e.size?u.pt2px(e.size):12;const l=e.lineHeight,m=null!=e.background?c.toUnitRGBA(e.background.color):q.ZEROS,t={family:e.font?.family??"sans-serif",decoration:e.font?.decoration??"none",weight:e.font?.weight??"normal",style:e.font?.style??"normal"};var w=e.halo;w=null!=w&&null!=
w.color&&0<w.size?{size:u.pt2px(w.size),color:c.toUnitRGBA(w.color)}:{size:0,color:q.ZEROS};h=new f({color:z,size:n,background:{color:m,padding:null!=e.background?[.65*n,.5*n]:[0,0],borderRadius:null!=e.background?.375*n:0},lineSpacingFactor:l,font:t,halo:w,pixelRatio:h});if(e.font){z=!1;n=h.fontString(n);try{z=(await document.fonts.load(n)).some(r=>!y.isCachedFontFace(r))}catch(r){p.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${n}'. Some text symbology may be rendered using the default browser font.`)}if(!z&&
!d.has(e.font.family))try{await y.loadFont(e.font)}catch(r){}}return h};return b._createClass(f)}();const d=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));a.TextRenderParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../config"],function(a,b,c){function y(d){if(!d)return"arial-unicode-ms";
d=d.toLowerCase().split(" ").join("-");switch(d){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return d}}function p(d){a:{if(d.weight)switch(d.weight.toLowerCase()){case "bold":case "bolder":var f="-bold";break a}f=""}a:{if(d.style)switch(d.style.toLowerCase()){case "italic":case "oblique":var g="-italic";break a}g=""}f+=g;return y(d.family)+(0<f.length?f:
"-regular")}const u=new Map,q=new Set;let k=b._createClass(function(d,f){this.fontFace=d;this.promise=f});a.DEFAULT_FONT_FAMILY="arial-unicode-ms";a.clearFonts=function(){const d=document.fonts;u.forEach(f=>{d.delete(f.fontFace)});u.clear();q.clear()};a.getFontFamily=y;a.getFullyQualifiedFontName=p;a.isCachedFontFace=function(d){return q.has(d)};a.loadFont=async function(d){const f=p(d),g=u.get(f);if(g)return g.promise;const e=new FontFace(d.family,`url('${c.fontsUrl}/woff2/${f}.${"woff2"}') format('${"woff2"}')`,
{style:d.style,weight:d.weight}),h=document.fonts;if(h.has(e)&&"loading"===e.status)return e.loaded;d=e.load().then(()=>{h.add(e);return e});u.set(f,new k(e,d));q.add(e);return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,y){const p={canvas:null};return function(){function u(q,k,d){this._renderer=
new b.TextRenderer(q,k,d)}u.prototype.create=function(){const q=b.getTextHelperCanvas(p,this._renderer.renderedWidth,this._renderer.renderedHeight),k=q.getContext("2d");k.save();this._renderer.render(k,0,0);k.restore();return new c.Texture(q,{wrap:{s:y.TextureWrapMode.CLAMP_TO_EDGE,t:y.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})};a._createClass(u,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return u}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){const B=["polyline","polygon","extent"];t=function(L){function O(H,J,N,R){return L.call(this,H,J,N,R)||this}b._inherits(O,L);var I=O.prototype;I.doLoad=async function(){};I.destroy=function(){b._get(b._getPrototypeOf(O.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null};I.createGraphics3DGraphic=function(H){H=H.graphic;if(!this._validateGeometry(H.geometry,B,this.symbolLayer.type))return null;
const J=this.setGraphicElevationContext(H,new n.ElevationContext);this.ensureDrapedStatus("on-the-ground"===J.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(H):this._createAs3DShape(H,J,H.uid)};I.ensureMaterial=function(){if(null==this._material){var H=new A.WaterMaterialParameters,J=this.symbolLayer.color;null!=J&&(H.color=c.toUnitRGBA(J));J=this._getCombinedOpacity(J,{hasIntrinsicColor:!0});H.color=[H.color[0],H.color[1],H.color[2],J];H.transparent=1>J||this.needsDrivenTransparentPass;
H.waveDirection=null!=this.symbolLayer.waveDirection?O.headingVectorFromAngle(this.symbolLayer.waveDirection):q.fromValues(0,0);J=v.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];H.waveStrength=J.waveStrength;H.waveTextureRepeat=J.textureRepeat;H.waveVelocity=J.waveVelocity;H.flowStrength=J.perturbationStrength;H.hasSlicePlane=this._context.slicePlaneEnabled;H.isDraped=this.draped;this._material=new A.WaterMaterial(H);this._context.stage.add(this._material)}};I.layerOpacityChanged=
function(){if(null!=this._material){var H=this._material.parameters.color,J=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[H[0],H[1],H[2],J],transparent:1>J||this.needsDrivenTransparentPass})}};I.layerElevationInfoChanged=function(H,J,N){const R=this._elevationContext.mode;N=z.elevationModeChangeUpdateType(O.elevationModeChangeTypes,N,R);if(N!==z.SymbolUpdateType.UPDATE)return N;const W=z.needsElevationUpdates2D(R);return this.updateGraphics3DGraphicElevationInfo(H,
J,()=>W)};I.slicePlaneEnabledChanged=function(){null!=this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};I.physicalBasedRenderingChanged=function(){return!0};I._createAs3DShape=function(H,J,N){const R=w.geometryAsPolygon(H.geometry);if(null==R)return null;const W=r.geometryToRenderInfo(R,this._context.elevationProvider,this._context.renderCoordsHelper,J),T=W.position.length/3,P=e.newDoubleArray(2*T);this._createUVCoordsFromVertices(P,W.mapPositions,
T,this._context.elevationProvider.spatialReference);H=new K(W,P,this._context.layer.uid,H.uid);H.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(H);this._create3DShapeGeometries(H);this._logGeometryCreationWarnings(H.renderData,R.rings,"rings","WaterSymbol3DLayer");if(0===H.outGeometries.length)return null;N=new x.Object3D({geometries:H.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:N});N=new m.Graphics3DObject3DGraphicLayer(this,N,H.outGeometries,
null,null,h.perVertexElevationAligner,J);N.alignedSampledElevation=H.renderData.sampledElevation;N.needsElevationUpdates=z.needsElevationUpdates2D(J.mode);return N};I._createUVCoordsFromVertices=function(H,J,N,R){R=y.getMetersPerUnitForSR(R);g.empty(E);for(var W=0;W<N;W++)u.set(F,J[3*W],J[3*W+1]),g.expandPointInPlace(E,F);k.scale(E,E,R);W=E[1]%O.unitSizeOfTexture;C[0]=E[0]-E[0]%O.unitSizeOfTexture;C[1]=E[1]-W;for(W=0;W<N;W++)H[2*W]=(J[3*W]*R-C[0])/O.unitSizeOfTexture,H[2*W+1]=(J[3*W+1]*R-C[1])/O.unitSizeOfTexture};
I._create3DShapeGeometries=function(H){var J=H.renderData.polygons;const N=H.uvCoords;for(const {count:R,index:W,position:T,mapPositions:P,holeIndices:Q}of J){if(null!=this._context.clippingExtent&&(f.empty(M),f.expandWithBuffer(M,P),!f.intersectsClippingArea(M,this._context.clippingExtent)))continue;J=p.earcut(P,Q,3);if(0===J.length)continue;const S=e.doubleSubArray(N,2*W,2*R);J=w.createWaterGeometry({material:this._material,indices:J,mapPositions:P,attributeData:{position:T,uv0:S}},H.objectAndLayerIdColor);
H.outGeometries.push(J)}};I._createAsOverlay=function(H){const J=w.geometryAsPolygon(H.geometry);if(null==J)return null;this._material.renderPriority=this._renderPriority;const N=r.geometryToRenderInfoDraped(J,this._context.overlaySR),R=N.position.length/3,W=e.newDoubleArray(2*R);this._createUVCoordsFromVertices(W,N.position,R,this._context.overlaySR);H=new G(N,W,this._context.layer.uid,H.uid);H.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(H);H.outBoundingBox=f.empty();
this._createAsOverlayWater(H);this._logGeometryCreationWarnings(H.renderData,J.rings,"rings","WaterSymbol3DLayer");return 0===H.outGeometries.length?null:new l(this,H.outGeometries,H.outBoundingBox,this._context.drapeSourceRenderer)};I._createAsOverlayWater=function(H){const J=H.uvCoords;var N=H.renderData.polygons;for(const {position:R,holeIndices:W,index:T,count:P}of N){f.empty(M);f.expandWithBuffer(M,R);if(!f.intersectsClippingArea(M,this._context.clippingExtent))continue;f.expandWithAABB(H.outBoundingBox,
M);N=p.earcut(R,W,3);if(0===N.length)continue;const Q=e.doubleSubArray(J,2*T,2*P);N=w.createWaterGeometry({material:this._material,indices:N,attributeData:{position:R,uv0:Q}},H.objectAndLayerIdColor);H.outGeometries.push(new D.RenderGeometry(N,H))}};O.headingVectorFromAngle=function(H){const J=q.create();H=d.toRadian(H);J[0]=Math.sin(H);J[1]=Math.cos(H);return J};I.test=function(){return{...b._get(b._getPrototypeOf(O.prototype),"test",this).call(this),create3DShape:H=>this._createAs3DShape(H.graphic,
H.elevationContext,H.graphicUid),ensureMaterial:()=>this.ensureMaterial()}};return b._createClass(O)}(t.Graphics3DSymbolLayer);t.unitSizeOfTexture=100;t.elevationModeChangeTypes={definedChanged:z.SymbolUpdateType.RECREATE,staysOnTheGround:z.SymbolUpdateType.NONE,onTheGroundChanged:z.SymbolUpdateType.RECREATE};const C=q.create(),E=g.create(),F=q.create(),M=f.create();let K=function(L){function O(I,H,J,N){I=L.call(this,I,J,N)||this;I.uvCoords=H;return I}b._inherits(O,L);return b._createClass(O)}(w.PolygonCreationDataBase),
G=function(L){function O(I,H,J,N){I=L.call(this,I,J,N)||this;I.uvCoords=H;return I}b._inherits(O,L);return b._createClass(O)}(w.PolygonCreationDataBase);a.Graphics3DWaterSymbolLayer=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,
textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},
"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,y){return function(p){function u(k,d,f){d=p.call(this,d)||this;d.symbol=k;d._convert=f;d.symbologySnappingSupported=!1;d.graphics3DSymbol=null;d.referenced=0;return d}a._inherits(u,p);var q=u.prototype;q.getSymbolLayerSize=function(k){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(k):
null};q.doLoad=async function(k){k=await this.symbol.fetchSymbol({signal:k});k.id=this.symbol.id;this.graphics3DSymbol=this._convert(k);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()};q.createGraphics3DGraphic=function(k){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(k,this):null};q.globalPropertyChanged=function(k,d){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(k,d):!1};q.applyRendererDiff=function(k,d){return null!=
this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(k,d):b.ApplyRendererDiffResult.RecreateSymbol};q.prepareSymbolPatch=function(k){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(k)};q.updateGeometry=function(k,d){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(k,d):!1};q.updateTransform=function(k,d,f,g){return this.graphics3DSymbol?.updateTransform(k,d,f,g)??!1};q.onRemoveGraphic=function(){};q.getFastUpdateStatus=function(){return null!=
this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};q.destroy=function(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;a._get(a._getPrototypeOf(u.prototype),"destroy",this).call(this)};a._createClass(u,[{key:"symbolLayers",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}},{key:"complexity",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:y.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return u}(c.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(v){v=f.getGraphics3DSymbol(v.graphics3DGraphic.graphics3DSymbol);return null!=v?v.symbol.symbolLayers.at(0):null}function h(v,B){var C=B.graphics3DGraphic.graphic.geometry;if(null==C)return null;if(null!=B.disablePlacement)return B.labelClass.labelPlacement?(r.warnOncePerTick(z(v?.placement,B.disablePlacement.logEntityDescription)),n(B)):v;C=C.type;switch(C){case "polyline":case "polygon":case "extent":case "multipoint":if(B.labelClass.labelPlacement)return r.warnOncePerTick(z(v?.placement,
`'${C}' geometries`)),n(B)}return v}function z(v,B){return`the requested label placement '${v}' is currently unsupported for ${B} in SceneView.`}function n(v){const B=v.graphics3DGraphic.graphic.geometry;if(null==B)return null;switch(B.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return v=e(v),null!=v&&"extrude"===v.type?x["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return x["above-center"];case "mesh":return x["above-center"]}}function l(v,B=D){({graphics3DGraphic:v}=v);v=v.layers[0];(v=null!=v?v.stageObject.geometries[0].material:null)&&v instanceof g.HUDMaterial?(v=v.parameters.anchorPosition,B[0]=2*(v[0]-.5),B[1]=2*(v[1]-.5)):(B[0]=0,B[1]=0);return B}function m(v,B,C){C=null!=C?C.getBoundingBoxObjectSpace(A):A;C=q.fromValues(C[3]-C[0],C[4]-C[1],C[5]-C[2]);v.centerOffset[0]=Math.sqrt(C[0]*C[0]+C[1]*C[1])/2*B.normalizedOffset[0];const E=v.translation[2],
F=C[2]/2*B.normalizedOffset[1];v.translation[2]=0;v.elevationOffset=E+F;C=u.length(C);v.centerOffset[2]=C/2*B.normalizedOffset[2]}function t(v){const B=v.labelClass.labelPlacement,{labelSymbol:C,graphics3DGraphic:E}=v;var F=f.getGraphics3DSymbol(E.graphics3DSymbol);F=y.applySome(F,M=>"point-3d"===M.symbol.type?M.symbol:null);v=x[B]||n(v);if(null!=F&&F.supportsCallout()&&F.hasVisibleVerticalOffset()&&!E.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:w(F.verticalOffset),anchor:null,
normalizedOffset:null};if(C&&C.hasVisibleVerticalOffset()&&(null==F||!F.supportsCallout()||!F.verticalOffset||E.isDraped)){if(!(F=!v)){a:switch(v.placement){case "above-center":F=!0;break a;default:F=!1}F=!F}return F?(r.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+B+" placement)"),null):{placement:"above-center",verticalOffset:w(C.verticalOffset),anchor:"bottom",normalizedOffset:[0,v.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function w(v){const {screenLength:B,minWorldLength:C,maxWorldLength:E}=v;return{screenLength:B,minWorldLength:C,maxWorldLength:E}}const r=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),x={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,
1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,
0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const v in b){const B=x[v];b[v].forEach(C=>{x[C]=B})}Object.freeze&&(Object.freeze(x),Object.keys(x).forEach(v=>{Object.freeze(x[v]);Object.freeze(x[v]?.normalizedOffset)}));const D=[0,0],A=d.create();a.get=function(v){var B=t(v);if(null==B)return null;if(B.anchor)var C=B;else{C=v.labelClass.labelPlacement;var E=x[C],F=E||n(v);C&&!E&&r.warnOncePerTick(`the requested label placement '${C}' is currently unsupported in SceneView.`);C=h(F,
v)}if(null==C)return null;E=!!B.hasLabelVerticalOffset;B={anchor:C.anchor,verticalOffset:B.verticalOffset,screenOffset:p.create(),centerOffset:k.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:q.create(),elevationOffset:0,hasLabelVerticalOffset:E};E=v.graphics3DGraphic.graphic.geometry;if(null==E)v=null;else{switch(E.type){case "point":F=e(v);if(null!=F)switch(E=v.graphics3DGraphic.layers[0],null!=E?E.getCenterObjectSpace(B.translation):u.set(B.translation,0,0,0),F.type){case "icon":case "text":({graphics3DGraphic:F}=
v);E=null!=E?E.getScreenSize():null;F.isDraped||null==E?B.hasLabelVerticalOffset||"center"===B.anchor||(x[v.labelClass.labelPlacement]&&r.warnOncePerTick(`the requested placement '${C.placement}' is currently unsupported for draped graphics`),B.anchor="center"):(v=l(v),B.screenOffset[0]=E[0]/2*(C.normalizedOffset[0]-v[0]),v=E[1]/2*(C.normalizedOffset[1]-v[1]),B.hasLabelVerticalOffset?(B.centerOffset[1]=v,B.centerOffsetUnits="screen"):B.screenOffset[1]=v);break;case "object":m(B,C,E)}break;case "polygon":E=
e(v);if(null!=E)switch(E.type){case "extrude":v=v.graphics3DGraphic.layers[0],null!=v?(v.getBoundingBoxObjectSpace(A),d.center(A,B.translation),B.translation[2]=d.height(A)/2):u.set(B.translation,0,0,0),m(B,C,v)}break;case "mesh":m(B,C,v.graphics3DGraphic.layers[0])}v=B}return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._stage=
u;this._materials=new Map}var p=y.prototype;p.get=function(u){return this._materials.get(u)};p.add=function(u,q){this._materials.set(u,q);this._stage.add(q)};p.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return b._createClass(y)}();a.MaterialCollection=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){let v=b._createClass(function(){this.offset={x:0,y:0};this.uvMinMax=n.create()}),B=b._createClass(function(F,M){this.textId=F;this.textRenderer=M;this.placement=new v;this.rendered=!1}),C=function(){function F(K,G,L){this.size=K;this.cursor=G;this.lineHeight=L}var M=F.prototype;M.resize=function(K){this.size.height=K};M.resetCursor=function(){this.cursor.x=2;this.cursor.y=4;this.lineHeight=0};M.getUsage=function(){return(this.cursor.x+this.cursor.y*
this.size.width)/(this.size.width*this.size.height)};return b._createClass(F)}();a.TextTextureAtlas=function(F){function M(G){G=F.call(this,G)||this;G.type=l.ContentObjectType.Texture;G.id=k.generateUID();G.events=new p;G._glTexture=null;G._needsClear=!1;G._elementsToAddOrUpdate=new Map;G._elementsToRemove=new Map;G._elementsToRender=new Map;G._elements=new Map;G._stageObjects=new Map;G.updating=!1;return G}b._inherits(M,F);var K=M.prototype;K.initialize=function(){this._canvas=document.createElement("canvas");
this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style","display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._atlas=new C({width:4096,height:256},{x:0,y:0},0);this._updateCanvasElementSize(this._atlas);this._resetAtlasCursor()};K.unload=function(){this._glTexture=q.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};K._createDescriptor=function(G){const L=new A.TextureDescriptor;L.wrapMode=
x.TextureWrapMode.CLAMP_TO_EDGE;L.flipped=!0;L.samplingMode=x.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;L.hasMipmap=!0;L.preMultiplyAlpha=!0;L.maxAnisotropy=G.parameters.maxMaxAnisotropy;return L};K.load=function(G){if(null!=this._glTexture)return this._glTexture;this._glTexture=new D.Texture(G,this._createDescriptor(G),this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(r.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};K.dispose=function(){this._elementsToRender=
this._elementsToRemove=this._elementsToAddOrUpdate=this._elements=null;this._frameWorker=q.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=q.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null};K._updateCanvasElementSize=function(G){this._canvas.setAttribute("width",G.size.width.toString());this._canvas.setAttribute("height",G.size.height.toString())};K._resizeAtlas=function(G){this._atlas.resize(G);null!=
this._glTexture&&this._glTexture.resize(this._atlas.size.width,G);this._updateCanvasElementSize(this._atlas)};K._resetAtlasCursor=function(){this._atlas.resetCursor();this._needsClear=!0};K._addAtlasElement=function(G,L,O,I){const H=this._atlas,{renderedWidth:J,renderedHeight:N}=G.textRenderer;G.placement.offset.x=H.cursor.x;G.placement.offset.y=H.cursor.y;z.set(G.placement.uvMinMax,G.placement.offset.x/H.size.width,1-(G.placement.offset.y+N)/H.size.height,(G.placement.offset.x+J)/H.size.width,1-
G.placement.offset.y/H.size.height);H.cursor.x+=O;H.lineHeight=Math.max(H.lineHeight,I);this._elements.set(L,G)};K._removeAtlasElement=function(G){if(G&&this._elements.has(G.textId)){const L=G.placement.offset;this._ctx.clearRect(L.x,L.y,G.textRenderer.renderedWidth,G.textRenderer.renderedHeight);this._elements.delete(G.textId)}};K._ensureStageObjects=function(G){var L=this._stageObjects.get(G);if(L)return L;L=new Set;this._stageObjects.set(G,L);return L};K._addStageObject=function(G,L){this._ensureStageObjects(G).add(L)};
K._removeStageObject=function(G,L){(G=this._stageObjects.get(G))&&G.delete(L)&&(L.geometries[0].setAttributeData(w.VertexAttribute.SIZE,[0,0]),L.geometryVertexAttrsUpdated(L.geometries[0]))};K._processAddition=function(G,L){const O=this._atlas;var I=G.textId;const H=G.textRenderer.renderedWidth+2,J=G.textRenderer.renderedHeight+2+2;if(O.cursor.x+H<O.size.width&&O.cursor.y+J<O.size.height)this._addAtlasElement(G,I,H,J),this._elementsToRender.set(I,G),this._elementsToAddOrUpdate.delete(I);else if(O.cursor.y+
J+O.lineHeight<O.size.height)O.cursor.x=2,O.cursor.y+=O.lineHeight,O.lineHeight=0,this._addAtlasElement(G,I,H,J),this._elementsToRender.set(I,G),this._elementsToAddOrUpdate.delete(I);else{G=O.cursor.y+J+O.lineHeight-O.size.height;(I=4096>O.size.height+G)&&this._resizeAtlas(Math.min(t.applyTextureResizeModulo(Math.ceil(O.size.height*Math.max(1.3,(G+O.size.height)/O.size.height))),4096));if(!L||!I&&4096===O.size.height)return this._processRemovals(),E.OK;this._repack();return E.REPACK}return E.OK};
K._processRemovals=function(){this._elementsToRemove.forEach((G,L)=>{const O=this._stageObjects.get(L);O&&0!==O.size||this._removeAtlasElement(G);O&&0===O.size&&this._stageObjects.delete(L)});this._elementsToRemove.clear()};K._repack=function(){this._processRemovals();this._elements.forEach((G,L)=>{G.rendered=!1;this._elementsToAddOrUpdate.set(L,G)});this._elements.clear();this._resetAtlasCursor();this._elementsToRender.clear()};K._processRenderingRequest=function(G){this._ctx.clearRect(G.placement.offset.x,
G.placement.offset.y,G.textRenderer.renderedWidth,G.textRenderer.renderedHeight);G.textRenderer.render(this._ctx,G.placement.offset.x,G.placement.offset.y);const L=this._stageObjects.get(G.textId);L&&L.forEach(O=>{O.geometries[0].setAttributeData(w.VertexAttribute.UV0,G.placement.uvMinMax);O.geometries[0].setAttributeData(w.VertexAttribute.SIZE,[G.textRenderer.displayWidth,G.textRenderer.displayHeight]);O.geometryVertexAttrsUpdated(O.geometries[0])});G.rendered=!0};K.runTask=function(G,L=!0){if(null==
this._glTexture)return r.Task.YIELD;let O=!1;u.someMap(this._elementsToAddOrUpdate,(H,J)=>this._elements.get(J)?.rendered?((H=this._stageObjects.get(J))&&H.forEach(N=>{const R=N.geometries[0],W=this._elements.get(J);R.setAttributeData(w.VertexAttribute.UV0,W.placement.uvMinMax);R.setAttributeData(w.VertexAttribute.SIZE,[W.textRenderer.displayWidth,W.textRenderer.displayHeight]);N.geometryVertexAttrsUpdated(N.geometries[0])}),this._elementsToAddOrUpdate.delete(J),G.madeProgress(),!1):this._processAddition(this._elementsToAddOrUpdate.get(J),
L)===E.REPACK?O=!0:!1);if(O)this.runTask(r.noBudget,!1),G.madeProgress();else{var I=!1;0<this._elementsToRender.size&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1);u.someMap(this._elementsToRender,(H,J)=>{this._processRenderingRequest(H);this._elementsToRender.delete(J);I=!0;G.madeProgress();return G.done});I&&this._glTexture.setData(this._canvas);this.updating=0<this._elementsToRender.size;!this.updating&&m.textTextureAtlas.orderedRepackingEnabled&&
(this.repackOrdered(),G.madeProgress())}};K.addTextTexture=function(G,L){const O=G.key;this._elementsToAddOrUpdate.has(O)||this._elementsToAddOrUpdate.set(O,new B(O,G));this._addStageObject(O,L);this._elementsToRemove.delete(O);this.setDirty()};K.removeTextTexture=function(G,L){G=G.key;this._elementsToRemove.set(G,this._elements.get(G));this._removeStageObject(G,L)};K.setDirty=function(){this._glTexture&&(this.updating=!0)};K.repackOrdered=function(){if(0!==this._elements.size){var G=[];this._elements.forEach((O,
I)=>G.push({element:O,key:I}));var L=!0;for(let O=0;O<G.length-1;O++)if(0<G[O].key.localeCompare(G[O+1].key)){L=!1;break}if(!L||this._elementsToRemove.size){G.sort((O,I)=>O.key.localeCompare(I.key));this._elements.clear();for(const {element:O,key:I}of G)this._elements.set(I,O);this._repack();this.setDirty()}}};b._createClass(M,[{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},{key:"test",
get:function(){const {_elements:G,_stageObjects:L,_elementsToRemove:O,_atlas:I}=this,H=this;return{elements:G,stageObjects:L,elementsToRemove:O,atlas:I,resizeAtlas:J=>H._resizeAtlas(J),run:(J,N)=>H.runTask(J,N)}}}]);return M}(y);c.__decorate([d.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([d.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var E;(function(F){F[F.OK=0]="OK";F[F.REPACK=1]="REPACK"})(E||(E={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){a.FeatureTileTree3D=function(v){function B(E){E=v.call(this,E)||this;E.tiles=new p;E.tileSize=512;E._idToTile=new Map;E._handles=new u;E._clients=new Set;E._dirty=!1;E._pendingTiles=null;E._newTiles=new f;return E}b._inherits(B,v);var C=B.prototype;C.initialize=function(){this._handles.add([g.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),g.sync),g.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,
this.focus?.location],()=>this._setDirty(),g.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(x.TaskPriority.FEATURE_TILE_TREE,this))};C.destroy=function(){this._frameWorker=d.removeMaybe(this._frameWorker);this._handles=d.destroyMaybe(this._handles)};C.addClient=function(){const E=D++;this._clients.add(E);1===this._clients.size&&this._setDirty();return q.makeHandle(()=>this._removeClient(E))};C._removeClient=function(E){this._clients.delete(E);this._hasClients||this._clear()};
C._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(x.noBudget))};C._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};C.runTask=function(E){this._dirty=!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=x.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(E);this._pendingTiles||
null==this._frameWorker||(this._frameWorker.priority=x.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};C._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new w.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):
this._clear())};C._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};C._getRootTiles=function(){const {tilingScheme:E}=this;return this._rootTileIds.map(F=>new t.FeatureTileDescriptor3D(F[0],F[1],F[2],E))};C._purgeHorizonTiles=function(E){E.sort((F,M)=>{F=F.measures.screenRect;M=M.measures.screenRect;return F[1]+F[3]-(M[1]+M[3])});m.empty(A);for(let F=0;F<E.length;F++)if(m.expand(A,E.data[F].measures.screenRect,A),10<m.height(A))return E.data.slice(F,
E.length);return[]};C._subdivideTilesForView=function(E){if(this._pendingTiles){for(var {tilingScheme:F}=this;0<this._pendingTiles.length&&!E.done;){const M=this._pendingTiles.pop();E.madeProgress();if(!this._filterExtentRect||m.intersects(this._filterExtentRect,M.extent))this._tileMeasurements.updateTile(M),M.measures.visibility!==t.Visibility.INVISIBLE&&(M.measures.shouldSplit?(F.ensureMaxLod(M.lij[0]+1),this._pendingTiles.push(...M.getChildren())):this._newTiles.push(M))}0===this._pendingTiles.length&&
(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};C._updateTiles=function(E){for(var F of this.tiles.items)F.used=!1;E=E.filter(M=>{const K=this._idToTile.get(M.id);K?(K.copyMeasurementsFrom(M),K.used=!0):this._idToTile.set(M.id,M);return!K});F=this.tiles.items.filter(M=>M.used?!1:(this._idToTile.delete(M.id),!0));this.tiles.removeMany(F);this.tiles.addMany(E);this._sortTiles()};C._sortTiles=function(){this.viewState.fixedContentCamera||
this.tiles.sort((E,F)=>E.measures.visibility!==F.measures.visibility?E.measures.visibility===t.Visibility.VISIBLE_ON_SURFACE?-1:1:E.measures.distance-F.measures.distance);this.tiles.forEach((E,F)=>E.loadPriority=F)};b._createClass(B,[{key:"tilingScheme",get:function(){const E=this.tilingSchemeOwner.tilingScheme;return E?E.clone():null}},{key:"filterExtent",set:function(E){if(null==E||E.spatialReference.equals(this.viewState.spatialReference)){var F=this._get("filterExtent");F===E||null!=F&&E&&F.equals(E)||
(E=null!=E?E.clone():null,this._set("filterExtent",E),this._setDirty())}else k.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}},{key:"_filterExtentRect",get:function(){if(null==this.filterExtent)return null;const E=m.create();r.toBoundingRect(this.filterExtent,E,this.tilingScheme.spatialReference);return E}},{key:"_rootTileIds",get:function(){const {tilingScheme:E}=this;return this._filterExtentRect&&E?E.rootTilesInExtent(this._filterExtentRect):
[[0,0,0]]}},{key:"suspended",set:function(E){E!==this._get("suspended")&&(this._set("suspended",E),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return B}(y);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",
void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);c.__decorate([e.property()],
a.FeatureTileTree3D.prototype,"tiles",void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",null);c.__decorate([e.property({value:!1})],
a.FeatureTileTree3D.prototype,"suspended",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([l.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let D=0;const A=m.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/aaBoundingRect"],
function(a,b,c){let y=function(){function p(q,k,d,f=null){this.lij=[0,0,0];this.extent=c.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:c.create(),distance:0,shouldSplit:!1};this.used=!1;f&&this.acquire(q,k,d,f)}var u=p.prototype;u.acquire=function(q,k,d,f){this.tilingScheme=f;this.id=p.id(q,k,d);this.lij[0]=q;this.lij[1]=k;this.lij[2]=d;f.getExtent(q,k,d,this.extent);this.resolution=f.resolutionAtLevel(q)};u.release=function(){this.tilingScheme=
null};u.getChildren=function(q){const k=this.lij[0]+1,d=2*this.lij[1],f=2*this.lij[2];if(!q)return[new p(k,d,f,this.tilingScheme),new p(k,d+1,f,this.tilingScheme),new p(k,d,f+1,this.tilingScheme),new p(k,d+1,f+1,this.tilingScheme)];q[0].acquire(k,d,f,this.tilingScheme);q[1].acquire(k,d+1,f,this.tilingScheme);q[2].acquire(k,d,f+1,this.tilingScheme);q[3].acquire(k,d+1,f+1,this.tilingScheme);return q};u.copyMeasurementsFrom=function(q){this.measures.visibility=q.measures.visibility;this.measures.shouldSplit=
q.measures.shouldSplit;this.measures.distance=q.measures.distance;c.copy(q.measures.screenRect,this.measures.screenRect)};p.id=function(q,k,d){return`${q}/${k}/${d}`};return b._createClass(p)}();a.Visibility=void 0;(function(p){p[p.INVISIBLE=0]="INVISIBLE";p[p.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";p[p.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(){function x(A){this._camera=new e.Camera;this._focusOnMap=[0,0];this._screenRect=u.create();this._tileSize=A.tileSize;this._renderCoordsHelper=A.renderCoordsHelper;this._tilingScheme=A.tilingScheme;this._visibility=new g.FeatureTileVisibility3D(A.renderCoordsHelper)}var D=x.prototype;D.begin=function(A,v,B){this._camera.copyFrom(A);this._surfaceElevation=B;this._focusOnMap[0]=v.x;this._focusOnMap[1]=v.y;u.fromValues(0,0,A.fullWidth,A.fullHeight,this._screenRect);
this._visibility.begin(this._camera,B)};D.end=function(){this._visibility.end()};D.updateTile=function(A){A.measures.visibility=this._visibility.calculate(A);A.measures.distance=u.distance(A.extent,this._focusOnMap);A.measures.visibility!==f.Visibility.INVISIBLE&&this._updateScreenMeasure(A)};D._updateScreenMeasure=function(A){const v=A.measures.screenRect;u.empty(v);let B=0;const C=A.lij[0]+2,E=A.lij[1]<<2,F=A.lij[2]<<2;var M=this._tileSizeWithBias(A);M*=M;for(let K=0;4>K;K++)for(let G=0;4>G;G++)if(B+=
this._computeScreenArea(A,C,E+K,F+G,v),B>M){A.measures.shouldSplit=!0;return}A.measures.shouldSplit=!1};D._tileSizeWithBias=function(A){return A.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize};D._computeScreenArea=function(A,v,B,C,E){this._projectToScreen(v,B,C,A.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED,n);u.empty(z);for(A=0;4>A;A++)u.expandPointInPlace(z,n[A]);u.expand(E,z,E);return d.areaPoints2d(n[0],n[1],n[2])+d.areaPoints2d(n[0],n[2],
n[3])};D._projectToScreen=function(A,v,B,C,E){this._tilingScheme.ensureMaxLod(A);this._tilingScheme.getExtent(A,v,B,l);this._toRenderCoords(l,0,3,t[0]);this._toRenderCoords(l,2,3,t[1]);this._toRenderCoords(l,2,1,t[2]);this._toRenderCoords(l,0,1,t[3]);C&&(this._projectToPlane(t,this._camera.frustum[q.PlaneIndex.NEAR]),this._projectToPlane(t,this._camera.frustum[q.PlaneIndex.TOP]),this._projectToPlane(t,this._camera.frustum[q.PlaneIndex.BOTTOM]));for(A=0;4>A;A++)this._camera.projectToRenderScreen(t[A],
r),this._camera.renderToScreen(r,E[A])};D._projectToPlane=function(A,v){for(var B=0;4>B;B++)w[B]=k.signedDistance(v,A[B]);B=Math.max(w[0],w[1],w[2],w[3]);if(0<B)for(v=y.scale(m,k.normal(v),-B),B=0;4>B;B++)y.add(A[B],A[B],v)};D._toRenderCoords=function(A,v,B,C){m[0]=A[v];m[1]=A[B];m[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(m,this._tilingScheme.spatialReference,C);return C};return b._createClass(x)}();const z=u.create(),n=[c.createScreenPointArray(),c.createScreenPointArray(),
c.createScreenPointArray(),c.createScreenPointArray()],l=u.create(),m=p.create(),t=[p.create(),p.create(),p.create(),p.create()],w=[0,0,0,0],r=c.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(){function r(D){this._renderCoordsHelper=D;this._surfaceElevation=0;this._cache=new Map;this._frustum=new h.Frustum(D);this._extendedFrustum=new h.Frustum(D);this._intersector=new z.FrustumExtentIntersection({renderCoordsHelper:D});this._renderCoordsHelper=D}var x=r.prototype;x.begin=function(D,A){this._surfaceElevation=A;this._aboveGround=this._renderCoordsHelper.getAltitude(D.eye)>A;this._frustum.update(D);this._shortenFrustumFarPlane(this._frustum);
this._updateExtendedFrustum(D)};x.end=function(){this._cache.clear()};x.calculate=function(D){if(this._allTilesInvisible)return e.Visibility.INVISIBLE;const A=this._renderCoordsHelper.viewingMode===g.ViewingMode.Global&&2<=D.lij[0]&&6>D.lij[0],v=this._getOrCalculateSingleTileVisibility(D,!A);return v!==e.Visibility.INVISIBLE&&A?this._calculateAggregatedChildrenVisibility(D):v};x._shortenFrustumFarPlane=function(D){var A=h.Frustum.nearFarLineIndices;const v=D.mutablePoints;for(const B of A){const [C,
E]=B;A=v[C];p.subtract(l,v[E],A);p.scale(l,l,.95);p.add(v[E],A,l)}D.updatePoints(v)};x._calculateAggregatedChildrenVisibility=function(D){let A=e.Visibility.INVISIBLE;var v=this._cache.get(D.id);if(null!=v)return v;v=w.acquire();D.getChildren(v);for(const B of v){const C=this.calculate(B);if(C!==e.Visibility.INVISIBLE&&(A=C,C===e.Visibility.VISIBLE_ON_SURFACE))break}w.release(v);this._cache.set(D.id,A);return A};x._getOrCalculateSingleTileVisibility=function(D,A){var v=this._cache.get(D.id);if(null!=
v)return v;v=this._calculateSingleTileVisibility(D);A&&this._cache.set(D.id,v);return v};x._calculateSingleTileVisibility=function(D){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===g.ViewingMode.Global&&12>D.lij[0]){if(this._calculateSingleTileVisibilitySided(D,!1)===e.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(D,!0)}else return this._calculateSingleTileVisibilitySided(D,this._aboveGround)};x._calculateSingleTileVisibilitySided=function(D,A){this._intersector.update(D.extent,
D.tilingScheme.spatialReference,this._surfaceElevation,A);D=q.getReferenceEllipsoid(D.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,D)?this._intersector.isVisibleInFrustum(this._frustum,D,!0)?e.Visibility.VISIBLE_ON_SURFACE:e.Visibility.VISIBLE_WHEN_EXTENDED:e.Visibility.INVISIBLE};x._updateExtendedFrustum=function(D){this._extendedFrustum.update(D);this._shortenFrustumFarPlane(this._extendedFrustum);var A=this._renderCoordsHelper.worldUpAtPosition(D.eye,
l);this._aboveGround||p.negate(A,A);A=c.acosClamped(-p.dot(A,D.viewForward));this._allTilesInvisible=A>(Math.PI+D.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=A>D.fovY/2)){D=this._extendedFrustumParameters();A=this._extendedFrustum.mutablePoints;for(let v=0;4>v;v++){const B=D.pointIndices[v],C=A[B],E=this._renderCoordsHelper.getAltitude(C);if(D.needsAltitudeAdjustment(E)){this._renderCoordsHelper.worldUpAtPosition(C,l);switch(B){case k.PointIndex.FAR_BOTTOM_LEFT:case k.PointIndex.FAR_TOP_LEFT:case k.PointIndex.NEAR_BOTTOM_LEFT:case k.PointIndex.NEAR_TOP_LEFT:d.projectVector(this._extendedFrustum.planes[k.PlaneIndex.LEFT],
l,l);break;case k.PointIndex.FAR_BOTTOM_RIGHT:case k.PointIndex.FAR_TOP_RIGHT:case k.PointIndex.NEAR_BOTTOM_RIGHT:case k.PointIndex.NEAR_TOP_RIGHT:d.projectVector(this._extendedFrustum.planes[k.PlaneIndex.RIGHT],l,l)}p.scale(l,l,D.direction);this._renderCoordsHelper.intersectInfiniteManifold(f.wrap(C,l),D.zWithMargin,C)}}this._extendedFrustum.updatePoints(A);d.fromPoints(A[k.PointIndex.NEAR_BOTTOM_LEFT],A[k.PointIndex.NEAR_BOTTOM_RIGHT],A[k.PointIndex.NEAR_TOP_RIGHT],m);d.fromPoints(A[k.PointIndex.NEAR_BOTTOM_RIGHT],
A[k.PointIndex.NEAR_TOP_RIGHT],A[k.PointIndex.NEAR_TOP_LEFT],t);0>p.dot(d.normal(m),d.normal(t))&&(D=this._extendedFrustum.mutablePoints,this._aboveGround?[D[k.PointIndex.NEAR_BOTTOM_LEFT],D[k.PointIndex.NEAR_BOTTOM_RIGHT]]=[D[k.PointIndex.NEAR_BOTTOM_RIGHT],D[k.PointIndex.NEAR_BOTTOM_LEFT]]:[D[k.PointIndex.NEAR_TOP_LEFT],D[k.PointIndex.NEAR_TOP_RIGHT]]=[D[k.PointIndex.NEAR_TOP_RIGHT],D[k.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(D))}};x._extendedFrustumParameters=function(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};x._extendedFrustumParametersAboveSurface=function(){const D=this._surfaceElevation-1;return{zWithMargin:D,pointIndices:h.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(A){return A>D}}};x._extendedFrustumParametersBelowSurface=function(){const D=this._surfaceElevation+1;return{zWithMargin:D,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(A){return A<D}}};
return b._createClass(r)}();const l=u.create(),m=d.create(),t=d.create(),w=new y(Array,r=>{4!==r.length&&(r[0]=new e.FeatureTileDescriptor3D,r[1]=new e.FeatureTileDescriptor3D,r[2]=new e.FeatureTileDescriptor3D,r[3]=new e.FeatureTileDescriptor3D)},r=>{r[0].release();r[1].release();r[2].release();r[3].release()});a.FeatureTileVisibility3D=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){const w=.5*Math.PI,r=w/Math.PI*180;let x=function(){function M(G){this._renderCoordsHelper=G.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:k.create(),direction:k.create()};for(G=0;4>G;G++)this._extent[G]={origin:k.create(),direction:k.create(),cap:{next:null,direction:k.create()}},this._planes[G]=n.create();this._planes[h.PlaneIndex.NEAR]=n.create();this._planes[h.PlaneIndex.FAR]=n.create();this._planesWithoutFar=
this._planes.slice(0,5)}var K=M.prototype;K.update=function(G,L,O,I=!0){const H=this._extent;this._toRenderBoundingExtent(G,L,O);q.add(this._center.origin,H[0].origin,H[2].origin);q.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);I||q.scale(this._center.direction,this._center.direction,-1);for(O=0;4>O;O++){const J=H[O];this._renderCoordsHelper.worldUpAtPosition(J.origin,J.direction);const N=H[3===O?0:O+1];J.cap.next=
N.origin;q.direction(J.cap.direction,J.origin,N.origin);n.fromVectorsAndPoint(J.direction,J.cap.direction,J.origin,this._planes[O]);I||q.scale(J.direction,J.direction,-1)}n.fromVectorsAndPoint(H[0].cap.direction,H[1].cap.direction,H[0].origin,this._planes[h.PlaneIndex.NEAR]);I?n.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.FAR]):(n.copy(this._planes[h.PlaneIndex.FAR],this._planes[h.PlaneIndex.NEAR]),n.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.NEAR]));this._maxSpan=
Math.max(Math.abs(G[0]-G[2]),Math.abs(G[1]-G[3]));this._maxSpanSpatialReference=L;this._minGlobalAltitude=.9*d.getReferenceEllipsoid(this._maxSpanSpatialReference).radius};K.isVisibleInFrustum=function(G,L,O=!1){if(null==G)return!1;if(this._renderCoordsHelper.viewingMode===m.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?r:w*L))return!0;if(null!=G.altitude&&G.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(G)}if(0===this._maxSpan)return L=
this._extent[0],!O&&G.intersectsRay(l.wrap(L.origin,L.direction))?!0:!1;for(L=0;L<this._extent.length;L++){var I=this._extent[L];if(!O&&G.intersectsRay(l.wrap(I.origin,I.direction))||G.intersectsLineSegment(z.fromPoints(I.origin,I.cap.next,F),I.cap.direction))return!0}O=O?this._planes:this._planesWithoutFar;for(L=0;L<G.lines.length;L++)if(I=G.lines[L],t.frustumLineSegment(O,I.origin,I.endpoint,I.direction))return!0;return!1};K._toRenderBoundingExtentGlobal=function(G,L,O){e.center(G,A);A[2]=O;f.computeTranslationToOriginAndRotation(L,
A,v,this._renderCoordsHelper.spatialReference);p.invert(B,v);g.empty(C);for(const {x0:I,x1:H,y0:J,y1:N}of D)for(let R=0;5>R;R++){const W=R/4;A[0]=y.lerp(G[I],G[H],W);A[1]=y.lerp(G[J],G[N],W);A[2]=O;f.projectVectorToVector(A,L,A,this._renderCoordsHelper.spatialReference);q.transformMat4(A,A,B);g.expandWithVec3(C,A)}q.set(this._extent[0].origin,C[0],C[1],C[2]);q.set(this._extent[1].origin,C[3],C[1],C[2]);q.set(this._extent[2].origin,C[3],C[4],C[2]);q.set(this._extent[3].origin,C[0],C[4],C[2]);for(G=
0;4>G;++G)q.transformMat4(this._extent[G].origin,this._extent[G].origin,v)};K._toRenderBoundingExtentLocal=function(G,L,O){f.projectBoundingRect(G,L,E,this._renderCoordsHelper.spatialReference);q.set(this._extent[0].origin,E[0],E[1],O);q.set(this._extent[1].origin,E[2],E[1],O);q.set(this._extent[2].origin,E[2],E[3],O);q.set(this._extent[3].origin,E[0],E[3],O)};K._toRenderBoundingExtent=function(G,L,O){switch(this._renderCoordsHelper.viewingMode){case m.ViewingMode.Global:this._toRenderBoundingExtentGlobal(G,
L,O);break;case m.ViewingMode.Local:this._toRenderBoundingExtentLocal(G,L,O);break;default:c.neverReached(this._renderCoordsHelper.viewingMode)}};K._isVisibleInFrustumGlobal=function(G){if(0>n.signedDistance(G.planes[h.PlaneIndex.NEAR],this._center.origin)&&0>q.dot(this._center.direction,G.direction))return!0;for(let L=0;4>L;L++){const O=this._extent[L];if(0>n.signedDistance(G.planes[h.PlaneIndex.NEAR],O.origin)&&0>q.dot(O.direction,G.direction))return!0}return!1};return b._createClass(M)}();const D=
[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],A=k.create(),v=u.create(),B=u.create(),C=g.create(),E=e.create(),F=z.create();a.FrustumExtentIntersection=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c){const y=b.create();a.projectToBoundingBox=function(p,u,q){if(null==p||null==q)return!1;let k;y[0]=null!=
p.xmin?p.xmin:0;y[1]=null!=p.ymin?p.ymin:0;y[2]=null!=p.zmin?p.zmin:0;k=c.projectBuffer(y,p.spatialReference,0,u,q,0,1);y[0]=null!=p.xmax?p.xmax:0;y[1]=null!=p.ymax?p.ymax:0;y[2]=null!=p.zmax?p.zmax:0;k=k&&c.projectBuffer(y,p.spatialReference,0,u,q,3,1);null==p.xmin&&(u[0]=-Infinity);null==p.ymin&&(u[1]=-Infinity);null==p.zmin&&(u[2]=-Infinity);null==p.xmax&&(u[3]=Infinity);null==p.ymax&&(u[4]=Infinity);null==p.zmax&&(u[5]=Infinity);return k};a.toBoundingRect=function(p,u,q){if(null==p||null==q)return!1;
let k;y[0]=null!=p.xmin?p.xmin:0;y[1]=null!=p.ymin?p.ymin:0;y[2]=null!=p.zmin?p.zmin:0;k=c.projectBuffer(y,p.spatialReference,0,y,q,0,1);u[0]=y[0];u[1]=y[1];y[0]=null!=p.xmax?p.xmax:0;y[1]=null!=p.ymax?p.ymax:0;y[2]=null!=p.zmax?p.zmax:0;k=k&&c.projectBuffer(y,p.spatialReference,0,y,q,0,1);u[2]=y[0];u[3]=y[1];null==p.xmin&&(u[0]=-Infinity);null==p.ymin&&(u[1]=-Infinity);null==p.xmax&&(u[2]=Infinity);null==p.ymax&&(u[3]=Infinity);return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){c=function(A){function v(){var C=A.apply(this,arguments)||this;C._propertiesPool=new w.PropertiesPool({camera:r.Camera},a._assertThisInitialized(C));C._lastSeenCameraProjectionValues=new r.Camera;C.mode=x.RenderState.ANIMATING;C._cssCamera=new r.Camera;C._camera=new r.Camera;C.rasterPixelRatio=1;C.contentPixelRatio=1;C.events=new y;C.viewingMode=n.ViewingMode.Global;C._cameraChanged=!1;C._updateQueue=[];C._processingUpdates=!1;return C}a._inherits(v,
A);var B=v.prototype;B.init=function(C,E){this._set("viewingMode",C);this._set("spatialReference",E);this._set("constraints",new l.Constraints({mode:this.viewingMode}))};B.exit=function(){this.cameraController?.destroy();this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new w.PropertiesPool({camera:r.Camera},this)};B.destroy=function(){this.cameraController?.destroy();this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null};B.createInitialCamera=
function(){if(this.viewingMode===n.ViewingMode.Global){const C=h.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new r.Camera({eye:e.fromValues(4*C,0,0),center:e.fromValues(C,0,0),up:e.fromValues(0,0,1)})}else this.camera=new r.Camera({eye:e.fromValues(0,0,100),center:e.fromValues(0,0,0),up:e.fromValues(0,1,0)})};B.switchCameraController=function(C){this.cameraController=C;return C.state!==t.State.Rejected};B.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?
!1:!0};B.updateCamera=function(C){this._updateQueue.push(C);this._processUpdateQueue()};B._processUpdateQueue=function(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var C=this._updateQueue.shift();D.copyFrom(this._get("camera"));C(D);this.camera=D;this._processingUpdates=!1;this._processUpdateQueue()}};B._cameraProjectionChanged=function(C,E){return C.fov!==E.fov||C.fullViewport[0]!==E.fullViewport[0]||C.fullViewport[1]!==E.fullViewport[1]||C.fullViewport[2]!==
E.fullViewport[2]||C.fullViewport[3]!==E.fullViewport[3]||C.padding[r.PaddingSide.TOP]!==E.padding[r.PaddingSide.TOP]||C.padding[r.PaddingSide.RIGHT]!==E.padding[r.PaddingSide.RIGHT]||C.padding[r.PaddingSide.BOTTOM]!==E.padding[r.PaddingSide.BOTTOM]||C.padding[r.PaddingSide.LEFT]!==E.padding[r.PaddingSide.LEFT]?!0:!1};a._createClass(v,[{key:"animation",get:function(){return this.cameraController instanceof m.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:
null}},{key:"camera",get:function(){return this._camera},set:function(C){C!==D&&D.copyFrom(C);D.computeUp(this.viewingMode);this.events.emit("before-camera-change",D);C=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,D)&&(this._lastSeenCameraProjectionValues.copyFrom(D),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!C.equals(D)&&(this._camera=this._propertiesPool.get("camera").copyFrom(D),this._cameraChanged=!C.almostEquals(D))){const E=
g.afterDispatch(()=>{this._cameraChanged=!1;E.remove()})}}},{key:"cssCamera",get:function(){const C=this._cssCamera.copyFrom(this.camera),{height:E,width:F,pixelRatio:M}=this.camera;C.pixelRatio=1;C.height=Math.round(E/M);C.width=Math.round(F/M);return C}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"alignPixelEnabled",get:function(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===x.RenderState.IDLE}},{key:"updating",get:function(){return!this.alignPixelEnabled}},
{key:"contentCamera",get:function(){return this._contentCamera??this.camera},set:function(C){this._contentCamera=null!=C?C.clone():null}},{key:"fixedContentCamera",get:function(){return null!=this._contentCamera}},{key:"isGlobal",get:function(){return this.viewingMode===n.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===n.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&
!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(C){this.stopActiveCameraController()?(this.cameraController?.destroy(),C&&(this.removeHandles("ViewStateHandles"),this.addHandles(p.when(()=>C.state===t.State.Finished||C.state===t.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(E=>C.onControllerEnd(E))},{sync:!0,once:!0}),"ViewStateHandles"),C.onControllerStart(this.camera)),this._set("cameraController",C)):C&&(C.state=
t.State.Rejected)}}]);return v}(c);b.__decorate([u.property()],c.prototype,"mode",void 0);b.__decorate([u.property({readOnly:!0,type:z})],c.prototype,"animation",null);b.__decorate([u.property({type:r.Camera})],c.prototype,"camera",null);b.__decorate([u.property({type:r.Camera})],c.prototype,"cssCamera",null);b.__decorate([u.property()],c.prototype,"_cssCamera",void 0);b.__decorate([u.property()],c.prototype,"_camera",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"pixelRatio",null);
b.__decorate([u.property()],c.prototype,"rasterPixelRatio",void 0);b.__decorate([u.property()],c.prototype,"contentPixelRatio",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"alignPixelEnabled",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([u.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([u.property({type:r.Camera})],c.prototype,"contentCamera",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"fixedContentCamera",
null);b.__decorate([u.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"isLocal",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"spatialReference",void 0);b.__decorate([u.property()],c.prototype,"navigating",null);
b.__decorate([u.property()],c.prototype,"stationary",null);b.__decorate([u.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([u.property()],c.prototype,"cameraController",null);b=c=b.__decorate([f.subclass("esri.views.3d.state.ViewState")],c);const D=new r.Camera;return b})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(A){w&&w.viewingMode===A||(w=e.newIntersector(A));return w}let l=function(){function A(B,C,E){this.viewingMode=B;this._forEachLayer=C;this._view=E;this._externalIntersectionHandlers=new c;this._tolerance=e.DEFAULT_TOLERANCE;this._tmpRay=k.create();this._tmpRegion=q.create();this._validateHUDIntersector=e.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}var v=A.prototype;v.intersectScreen=function(B,C,E){return this.intersectRay(this._getPickRay(B,
this._tmpRay),n(this.viewingMode),C,E)};v.intersectScreenFreePointFallback=function(B,C,E){return this.intersectRayFreePointFallback(this._getPickRay(B,this._tmpRay),C,E)};v.intersectRayFreePointFallback=function(B,C,E){return this.intersectRay(B,n(this.viewingMode),C,E)||this._intersectRayFreePointLocal(B,C)};v.intersectRay=function(B,C,E,F){C.options.selectionMode=!1;C.options.store=h.StoreResults.MIN;this.computeIntersection(B,C,F);return C.results.min?C.results.min.getIntersectionPoint(E):!1};
v.getCenterRayWithSubpixelOffset=function(B,C,E=.5,F=.5){B.getRenderCenter(D,E,F);D[0]+=.0466;D[1]-=.0123;return g.fromRenderAtEye(B,D,C)};v.intersectIntersectorScreen=function(B,C,E){this.computeIntersection(this._getPickRay(B,this._tmpRay),C,E)};v.intersectToolIntersectorScreen=function(B,C,E){B=this._getPickRay(B,this._tmpRay);this.intersectToolIntersectorRay(B,C,E)};v.intersectToolIntersectorRay=function(B,C,E){C.options.selectionMode=!0;this.computeIntersection(B,C,E);const F=C.results.min;this._view.basemapTerrain&&
this._view.basemapTerrain.opaque||z.isValidIntersectorResult(F)&&F.intersector!==h.IntersectorType.TERRAIN||(C.options.selectionMode=!1,this.computeIntersection(B,C,E))};v.setTolerance=function(B=e.DEFAULT_TOLERANCE){this._tolerance=B};v.addIntersectionHandler=function(B){this._externalIntersectionHandlers.push(B);this._externalIntersectionHandlers.sort((C,E)=>C.type===h.IntersectorType.TERRAIN?1:E.type===h.IntersectorType.TERRAIN?-1:0)};v.removeIntersectionHandler=function(B){null!=this._externalIntersectionHandlers.removeUnordered(B)&&
this._externalIntersectionHandlers.sort((C,E)=>C.type===h.IntersectorType.TERRAIN?1:E.type===h.IntersectorType.TERRAIN?-1:0)};v._getPickRay=function(B,C){return g.fromScreen(this._view.state.camera,B,C)};v._intersectRayFreePointLocal=function(B,C){if(this.viewingMode!==f.ViewingMode.Local||null==B)return!1;p.add(C,B.origin,p.normalize(d.sv3d.get(),B.direction));return!1};v.intersectElevationFromScreen=function(B,C,E=0,F=null){return this._intersectElevation(this._getPickRay(B,this._tmpRay),C,E,F)};
v._intersectElevation=function(B,C,E=0,F=null){if(null==B)return null;var M=null!=C?C.mode:"absolute-height",K=C?.offset??0,G="on-the-ground"!==M?K+E:0;C=G/this._view.renderCoordsHelper.unitInMeters;if("absolute-height"===M)return this._view.renderCoordsHelper.intersectInfiniteManifold(B,G,x)?(E=this._view.computeMapPointFromVec3d(x),E.z??(E.z=0),E.z-=K,E):null;K=this._view.state.camera;const L=y.castRenderScreenPointArray3(d.sv3d.get());K.projectToRenderScreen(B.origin,L);G=new r(null,this._forEachLayer);
const O=this._view.slicePlane,I=null!=O?z.sliceFilterPredicate(O):null,H=e.newIntersector(this.viewingMode);H.options.store=h.StoreResults.MIN;H.options.verticalOffset=C;C=B.origin;B=p.add(d.sv3d.get(),C,B.direction);H.reset(C,B,K);H.point=L;const J=F?"type"in F&&"graphics"===F.type?N=>N.layerUid!==F.uid:N=>N.graphicUid!==F.uid:null;switch(M){case "relative-to-scene":H.intersect(G.layers,L,this._tolerance,null,N=>(!J||J(N))&&!!N.lastValidElevationBB);this._externalIntersectionHandlers.forAll(N=>{N.type!==
h.IntersectorType.I3S&&N.type!==h.IntersectorType.TERRAIN||N.intersect(H,N.slicePlaneEnabled?I:null,H.rayBegin,H.rayEnd,L)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(N=>{N.isGround&&N.intersect(H,N.slicePlaneEnabled?I:null,H.rayBegin,H.rayEnd,L)})}return H.results.min.getIntersectionPoint(x)?(M=this._view.computeMapPointFromVec3d(x),M.z=E,M):null};v.computeIntersection=function(B,C,E){if(null!=B){var F=this._view.state.camera,M=y.castRenderScreenPointArray3(d.sv3d.get());
F.projectToRenderScreen(B.origin,M);var K=new r(E,this._forEachLayer);C.options.selectOpaqueTerrainOnly=!E||!("include"in E||"exclude"in E);var G=B.origin,L=p.add(d.sv3d.get(),B.origin,B.direction);C.reset(G,L,F);C.intersect(K.layers,M,this._tolerance);B=this._view.slicePlane;var O=null!=B?z.sliceFilterPredicate(B):null;C.intersect(K.sliceableLayers,M,this._tolerance,O);var I=E&&(E.requiresGroundFeedback||E.enableDraped);this._externalIntersectionHandlers.forAll(H=>{var J=H.layerUid;const N=Array.isArray(J);
J=N?J:[J];N&&(C.options.filteredLayerUids=[]);let R=!1;for(const W of J)K.filterLayerUid(W)?R=!0:N&&C.options.filteredLayerUids.push(W);C.options.isFiltered=!R;(H.isGround&&I||!C.options.isFiltered)&&H.intersect(C,H.slicePlaneEnabled?O:null,G,L,M)});B=d.sv3d.get();F=this._view.basemapTerrain;if(E&&E.enableDraped&&null!=F.spatialReference&&C.results.ground.getIntersectionPoint(B)){E=F.overlayManager.renderer;const H=this._view.renderCoordsHelper.spatialReference,J=d.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(B,
J,F.spatialReference);J[2]=this._view.elevationProvider?.getElevation(B[0],B[1],B[2],H,"ground")??0;E.intersect(C,J,C.results.ground,N=>K.filterRenderGeometry(N))}C.sortResults();this._processHUDResults(C)}};v._processHUDResults=function(B){var C=B.results.hud;q.copy(this._tmpRegion,q.NEGATIVE_INFINITY);const E=this._view.state.camera,F=[],M=this._tmpRegion;var K=J=>{const N=new t(J);E.projectToRenderScreen(J.target.center,N.screenPoint);N.screenPoint[0]=Math.floor(N.screenPoint[0]);N.screenPoint[1]=
Math.floor(N.screenPoint[1]);F.push(N);q.expandPointInPlace(M,N.screenPoint)};B.sortResults(C.all);null!=C.min.dist&&K(C.min);for(var G of C.all)C.min.target.object!==G.target.object&&C.max.target.object!==G.target.object&&K(G);null!=C.max.dist&&C.max.target.object!==C.min.target.object&&K(C.max);if(F.length){M[0]===M[2]&&(M[2]+=1);M[1]===M[3]&&(M[3]+=1);C=E.fullWidth;K=E.fullHeight;var L=Math.max(0,M[0]-1),O=Math.max(0,M[1]-1);G=Math.min(q.width(M)+2,C-L);var I=Math.min(q.height(M)+2,K-O),H=new Uint8Array(G*
I*4);this._view._stage.renderer.readHUDVisibility(L,O,G,I,H);L=!0;O=null==B.results.max.dist;I=0;for(const J of F)for(const N of m)if(H[4*(Math.min(J.screenPoint[0]+N[0],C)-M[0]+(Math.min(J.screenPoint[1]+N[1],K)-M[1])*G)]){L&&(B.results.min.copy(J.result),L=!1);O&&B.results.max.copy(J.result);B.options.store===h.StoreResults.ALL&&B.results.all.splice(I++,0,J.result);break}}};return b._createClass(A)}();const m=(()=>{const A=[];for(let v=-1;1>=v;v++)for(let B=-1;1>=B;B++)A.push([B+1,v+1]);return A})();
let t=b._createClass(function(A){this.result=A;this.screenPoint=y.createRenderScreenPointArray3()}),w,r=function(){function A(B,C){this.layers=[];this.sliceableLayers=[];this.include=B?.include;this.exclude=B?.exclude;C(E=>{E.pickable&&this.filterLayerUid(E.apiLayerUid)&&(E.sliceable?this.sliceableLayers:this.layers).push(E)})}var v=A.prototype;v.filterLayerUid=function(B){const {include:C,exclude:E}=this;return null==B?null==C&&null==E:(null==C||C.has(B))&&(null==E||!E.has(B))};v.filterRenderGeometry=
function(B){return this.filterLayerUid(B.layerUid)};return b._createClass(A)}();const x=u.create(),D=y.createRenderScreenPointArray3();a.SceneIntersectionHelper=l;a.isIntersectionHandler=function(A){return"object"===typeof A&&"intersect"in A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(l,m,t,w,r,x,D){for(const A of m)m=A.getElevation(t,w,r,x,D),null!=m&&(l=null!=l?Math.max(m,l):m);return l}a.CombinedElevationProvider=function(l){function m(w){w=l.call(this,w)||this;w._im=[];w._ground=[];w._scene=[];w._handles=new Map;w.lastElevationQuery=null;w.elevationCacheEnabled=!1;return w}b._inherits(m,l);var t=m.prototype;t.destroy=function(){this._elevationQueryCached=u.destroyMaybe(this._elevationQueryCached)};t.enableElevationCache=function(w){w||
(this.lastElevationQuery=null);this.elevationCacheEnabled=w};t.getElevation=function(w,r,x,D,A){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var v=this.lastElevationQuery;if(w===v.x&&r===v.y&&x===v.z&&h.equals(D,v.spatialReference)&&A===v.queryContext)return v.result}v=n(null,this._im,w,r,x,D,A);null==v&&(v=n(v,this._ground,w,r,x,D,A));"scene"===A&&(v=n(v,this._scene,w,r,x,D,A));this.elevationCacheEnabled&&(this.lastElevationQuery={x:w,y:r,z:x,spatialReference:D,queryContext:A,result:v});
return v};t.getSphereElevationBounds=function(w,r){let x=Infinity,D=-Infinity;for(const A of[this._im,this._ground,this._scene])A.forEach(v=>{v.getSphereElevationBounds&&(v=v.getSphereElevationBounds(w,r),null!=v&&(x=Math.min(x,v.min),D=Math.max(D,v.max)))});return{min:x,max:D}};t.queryElevation=function(w,r,x,D,A,v=null,B=0){const C=q.createResolver();this._elevationQuery.queryElevation(w,r,v,B).then(E=>{"scene"===A&&(E=n(E,this._scene,w,r,x,D,A));C.resolve(E)}).catch(E=>{q.isAbortError(E)?C.reject(E):
C.resolve(this.getElevation(w,r,x,D,A))});return C.promise};t.register=function(w,r){this._handles.set(r,r.on("elevation-change",x=>this.emit("elevation-change",x)));this._providersFromContext(w).push(r)};t.unregister=function(w){this._handles.has(w)&&(this._handles.get(w)?.remove(),this._handles.delete(w));for(const r of[this._im,this._ground,this._scene]){const x=r.indexOf(w);-1<x&&r.splice(x,1)}};t._providersFromContext=function(w){switch(w){case "ground":return this._ground;case "im":return this._im;
case "scene":return this._scene}};b._createClass(m,[{key:"spatialReference",get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){null==this._elevationQueryCached&&(this._elevationQueryCached=new z.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return m}(p.EventedMixin(y));c.__decorate([k.property({constructOnly:!0})],
a.CombinedElevationProvider.prototype,"view",void 0);c.__decorate([k.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=c.__decorate([e.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,y,p,u,q){c=function(){function d(g,e){this.spatialReference=g;this._view=e}var f=d.prototype;f.getElevation=function(g,e,h){return this._view.elevationProvider.getElevation(g,e,0,this.spatialReference,h)};f.queryElevation=async function(g,e,h,z,n){return this._view.elevationProvider.queryElevation(g,e,0,this.spatialReference,n,h,z)};return b._createClass(d)}();let k=function(){function d(g,e,h,z){this.spatialReference=e;this._getElevationQueryProvider=h;this._queries=[];this._queryOptions=
{...z,ignoreInvisibleLayers:!0};this._frameTask=g.registerTask(u.TaskPriority.ELEVATION_QUERY,this)}var f=d.prototype;f.destroy=function(){this._frameTask.remove()};f.queryElevation=function(g,e,h,z=0){const n=p.createResolver(),l={x:g,y:e,minDemResolution:z,result:n,signal:h};this._queries.push(l);p.onAbort(h,()=>{y.remove(this._queries,l);n.reject(p.createAbortError())});return n.promise};f.runTask=function(g){const e=this._queries;this._queries=[];const h=this._getElevationQueryProvider();if(h){var z=
e.map(t=>[t.x,t.y]),n=e.reduce((t,w)=>Math.min(t,w.minDemResolution),Infinity);z=new q({points:z,spatialReference:this.spatialReference});var l=1<e.length&&e.some(t=>!!t.signal)?new AbortController:null,m=null!=l?l.signal:e[0].signal;if(null!=l){let t=0;e.forEach(w=>p.onAbort(w.signal,()=>{t++;w.result.reject(p.createAbortError());t===e.length&&l.abort()}))}h.queryElevation(z,{...this._queryOptions,minDemResolution:n,signal:m}).then(t=>{e.forEach((w,r)=>{null!=w.signal&&w.signal.aborted?w.result.reject(p.createAbortError()):
w.result.resolve(t.geometry.points[r][2])})}).catch(t=>{e.forEach(w=>w.result.reject(t))})}else e.forEach(t=>t.result.reject());g.madeProgress()};b._createClass(d,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const g=this;return{update:()=>0<g._queries.length&&g.runTask(u.noBudget)}}}]);return d}();a.ElevationQuery=k;a.ViewElevationProvider=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../core/has","../../../core/time"],function(a,b,c){function y(){const u=!!b("esri-mobile"),q=!!b("ios"),k=c.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:c.Milliseconds(0)},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:c.Milliseconds(0)},fadeDuration:c.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:u?.8:1,polylineLodFactor:u?1.2:1.5,snapshotAvailable:!q,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:k},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:u},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),
textureFadeDuration:k},fadeDuration:k,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:u?600:750,additionalCacheMemory:u?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:u?1.2:2,polylineLodFactor:u?1.2:2,snapshotAvailable:!q,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,
lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:k},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:k},fadeDuration:k,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,
ambientOcclusion:!0,memoryLimit:u?900:1500,additionalCacheMemory:u?-150:0,frameRate:0,maximumPixelRatio:u?1:Infinity}}}let p=function(){function u(){}u.isValidProfile=function(q){return q in u.profiles};u.getDefaultProfile=function(){return b("esri-iPhone")?"low":"medium"};u.apply=function(q,k){q=u.profiles[q];k.graphics3D.maxTotalNumberOfFeatures=q.graphics3D.maxTotalNumberOfFeatures;k.graphics3D.maxTotalNumberOfPrimitives=q.graphics3D.maxTotalNumberOfPrimitives;k.graphics3D.polygonLodFactor=q.graphics3D.polygonLodFactor;
k.graphics3D.polylineLodFactor=q.graphics3D.polylineLodFactor;k.graphics3D.snapshotAvailable=q.graphics3D.snapshotAvailable;k.graphics3D.skipHighSymbolLods=q.graphics3D.skipHighSymbolLods;const d=k.sceneService.object,f=q.sceneService.object;d.lodFactor=f.lodFactor;d.lodCrossfadeinDuration=f.lodCrossfadeinDuration;d.lodCrossfadeoutDuration=f.lodCrossfadeoutDuration;d.lodCrossfadeUncoveredDuration=f.lodCrossfadeUncoveredDuration;k.sceneService.point.lodFactor=q.sceneService.point.lodFactor;k.sceneService.integratedMesh.lodFactor=
q.sceneService.integratedMesh.lodFactor;k.sceneService.pointCloud.lodFactor=q.sceneService.pointCloud.lodFactor;k.sceneService.uncompressedTextureDownsamplingEnabled=q.sceneService.uncompressedTextureDownsamplingEnabled;k.tiledSurface.lodBias=q.tiledSurface.lodBias;k.tiledSurface.angledSplitBias=q.tiledSurface.angledSplitBias;k.tiledSurface.reduceTileLevelDifferences=q.tiledSurface.reduceTileLevelDifferences;k.tiledSurface.textureFadeDuration=q.tiledSurface.textureFadeDuration;k.heatmap.pixelRatio=
q.heatmap.pixelRatio;k.heatmap.maxTotalNumberOfFeatures=q.heatmap.maxTotalNumberOfFeatures;k.fadeDuration=q.fadeDuration;k.antialiasingEnabled=q.antialiasingEnabled;k.physicallyBasedRenderingEnabled=q.physicalBasedRenderingEnabled;k.highQualityTransparency=q.highQualityTransparency;k.highResolutionAtmosphere=q.highResolutionAtmosphere;k.reflections=q.reflections;k.ambientOcclusion=q.ambientOcclusion;k.memoryLimit=q.memoryLimit;k.additionalCacheMemory=q.additionalCacheMemory;k.frameRate=q.frameRate;
k.maximumPixelRatio=q.maximumPixelRatio};return a._createClass(u)}();p.test={reset(){const u=y();for(const q of Object.keys(u))p.profiles[q]=u[q]}};(p||(p={})).profiles=y();return p})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){const e=new c([0,255,255]),h=new c([0,0,0]);y=function(z){function n(){var l=z.apply(this,arguments)||this;l.color=e.clone();l.haloColor=null;l.haloOpacity=1;l.fillOpacity=.25;l.shadowOpacity=.4;l.shadowColor=h.clone();l.shadowDifference=.2;return l}a._inherits(n,z);n.toEngineOptions=function(l){const m=c.toUnitRGBA(l.color??e),t=null!=l.haloColor?c.toUnitRGBA(l.haloColor):m,w=c.toUnitRGBA(l.shadowColor??h),r=l.haloOpacity??1,x=l.fillOpacity??.25,D=l.shadowOpacity??
.4;l=l.shadowDifference??.2;return{color:f.fromValues(m[0],m[1],m[2],m[3]),haloColor:f.fromValues(t[0],t[1],t[2],t[3]),haloOpacity:r,haloOpacityOccluded:.25*r,fillOpacity:x,fillOpacityOccluded:.25*x,shadowOpacity:D,shadowColor:g.fromValues(w[0],w[1],w[2],w[3]),occludedShadowOpacity:D*(1-l)}};return a._createClass(n)}(y);b.__decorate([p.property({type:c})],y.prototype,"color",void 0);b.__decorate([p.property({type:c})],y.prototype,"haloColor",void 0);b.__decorate([p.property()],y.prototype,"haloOpacity",
void 0);b.__decorate([p.property()],y.prototype,"fillOpacity",void 0);b.__decorate([p.property()],y.prototype,"shadowOpacity",void 0);b.__decorate([p.property({type:c})],y.prototype,"shadowColor",void 0);b.__decorate([p.property()],y.prototype,"shadowDifference",void 0);return y=b.__decorate([d.subclass("esri.views.3d.support.HighlightOptions")],y)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(w){const r=new Float32Array(4);r[0]=
w[0];r[1]=w[1];r[2]=w[2];r[3]=w[3];return r}function y(w,r,x,D){const A=new Float32Array(4);A[0]=w;A[1]=r;A[2]=x;A[3]=D;return A}function p(w,r){return new Float32Array(w,r,4)}function u(){return b()}function q(){return y(1,1,1,1)}function k(){return y(1,0,0,0)}function d(){return y(0,1,0,0)}function f(){return y(0,0,1,0)}function g(){return y(0,0,0,1)}const e=b(),h=q(),z=k(),n=d(),l=f(),m=g(),t=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_W:m,UNIT_X:z,UNIT_Y:n,UNIT_Z:l,ZEROS:e,
clone:c,create:b,createView:p,fromValues:y,ones:q,unitW:g,unitX:k,unitY:d,unitZ:f,zeros:u},Symbol.toStringTag,{value:"Module"}));a.ONES=h;a.UNIT_W=m;a.UNIT_X=z;a.UNIT_Y=n;a.UNIT_Z=l;a.ZEROS=e;a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.ones=q;a.unitW=g;a.unitX=k;a.unitY=d;a.unitZ=f;a.vec4f32=t;a.zeros=u})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){c=function(){function e(h,z){this.spatialReference=z;this.unitInMeters=p.getMetersPerUnitForSR(this.spatialReference,u.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=q.getGeometryServiceURL(h&&h.get("portalItem")).catch(()=>{throw new y("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}e.prototype.toGeographic=async function(h){var z=await this._geometryServiceURLPromise;let n=
!0;Array.isArray(h[0])&&"number"!==typeof h[0]||(h=[h],n=!1);h=h.map(l=>l instanceof f?l:new f(l,this.spatialReference));h=new d({geometries:h,outSpatialReference:g.WGS84});z=(await k.project(z,h)).map(l=>"point"===l.type?[l.x,l.y]:void 0).filter(l=>!!l);return n?z:z[0]};return b._createClass(e)}();a.MapCoordsHelper=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,y,p,u){async function q(k=null,d){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!k)throw new c("internal:geometry-service-url-not-configured");k="portal"in k?k.portal||y.getDefault():k;await k.load({signal:d});d=k.helperServices?.geometry?.url;if(!d)throw new c("internal:geometry-service-url-not-configured");return d}a.getGeometryServiceURL=q;a.projectGeometry=async function(k,d,f=null,g){f=await q(f,g);const e=new u;e.geometries=[k];e.outSpatialReference=d;if((k=await p.project(f,
e,{signal:g}))&&Array.isArray(k)&&1===k.length)return k[0];throw new c("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,c,y,p,u,q){const k=c.ensureType(q);a.project=async function(d,f,g){f=k(f);d=p.parseUrl(d);const e=
{...d.query,f:"json",...f.toJSON()},h=f.outSpatialReference,z=y.getJsonType(f.geometries[0]);f=p.asValidOptions(e,g);return b(d.path+"/project",f).then(({data:{geometries:n}})=>u.decodeGeometries(n,z,h))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,y,p,u,q,k,d){c=function(f){function g(e){e=f.call(this,e)||this;e.geometries=[];e.outSpatialReference=null;e.transformation=null;e.transformForward=null;return e}a._inherits(g,f);g.prototype.toJSON=function(){const e=this.geometries.map(n=>n.toJSON()),h=this.geometries[0],z={};z.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());z.inSR=h.spatialReference.wkid||JSON.stringify(h.spatialReference.toJSON());z.geometries=JSON.stringify({geometryType:d.getJsonType(h),
geometries:e});this.transformation&&(z.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(z.transformForward=this.transformForward);return z};return a._createClass(g)}(c.JSONSupport);b.__decorate([y.property()],c.prototype,"geometries",void 0);b.__decorate([y.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([y.property()],c.prototype,"transformation",void 0);b.__decorate([y.property()],c.prototype,
"transformForward",void 0);return c=b.__decorate([k.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){let f=
function(l){function m(){var t=l.apply(this,arguments)||this;t.minTotalNumberOfFeatures=2E3;t.maxTotalNumberOfFeatures=5E4;t.maxTotalNumberOfPrimitives=17E5;t.snapshotAvailable=!0;t.polygonLodFactor=1;t.polylineLodFactor=1;t.skipHighSymbolLods=!1;return t}a._inherits(m,l);return a._createClass(m)}(c);b.__decorate([p.property()],f.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([p.property()],f.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([p.property()],f.prototype,"maxTotalNumberOfPrimitives",
void 0);b.__decorate([p.property()],f.prototype,"snapshotAvailable",void 0);b.__decorate([p.property()],f.prototype,"polygonLodFactor",void 0);b.__decorate([p.property()],f.prototype,"polylineLodFactor",void 0);b.__decorate([p.property()],f.prototype,"skipHighSymbolLods",void 0);f=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],f);let g=function(l){function m(){var t=l.apply(this,arguments)||this;t.lodFactor=1;return t}a._inherits(m,l);return a._createClass(m)}(c);
b.__decorate([p.property()],g.prototype,"lodFactor",void 0);g=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],g);let e=function(l){function m(){var t=l.apply(this,arguments)||this;t.lodCrossfadeinDuration=y.Milliseconds(0);t.lodCrossfadeoutDuration=y.Milliseconds(0);t.lodCrossfadeUncoveredDuration=y.Milliseconds(0);return t}a._inherits(m,l);return a._createClass(m)}(g);e=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],
e);let h=function(l){function m(){var t=l.apply(this,arguments)||this;t.object=new e;t.point=new g;t.integratedMesh=new g;t.pointCloud=new g;t.uncompressedTextureDownsamplingEnabled=!1;return t}a._inherits(m,l);return a._createClass(m)}(c);b.__decorate([p.property({type:e})],h.prototype,"object",void 0);b.__decorate([p.property({type:g})],h.prototype,"point",void 0);b.__decorate([p.property({type:g})],h.prototype,"integratedMesh",void 0);b.__decorate([p.property({type:g})],h.prototype,"pointCloud",
void 0);b.__decorate([p.property()],h.prototype,"uncompressedTextureDownsamplingEnabled",void 0);h=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],h);let z=function(l){function m(){var t=l.apply(this,arguments)||this;t.lodBias=0;t.angledSplitBias=1;t.reduceTileLevelDifferences=!0;t.textureFadeDuration=y.Milliseconds(400);return t}a._inherits(m,l);return a._createClass(m)}(c);b.__decorate([p.property()],z.prototype,"lodBias",void 0);b.__decorate([p.property()],
z.prototype,"angledSplitBias",void 0);b.__decorate([p.property()],z.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([p.property()],z.prototype,"textureFadeDuration",void 0);z=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],z);let n=function(l){function m(){var t=l.apply(this,arguments)||this;t.pixelRatio=1;t.maxTotalNumberOfFeatures=5E4;return t}a._inherits(m,l);return a._createClass(m)}(c);b.__decorate([p.property()],n.prototype,"pixelRatio",void 0);
b.__decorate([p.property()],n.prototype,"maxTotalNumberOfFeatures",void 0);n=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],n);c=function(l){function m(){var t=l.apply(this,arguments)||this;t.graphics3D=new f;t.sceneService=new h;t.tiledSurface=new z;t.heatmap=new n;t.fadeDuration=y.Milliseconds(400);t.antialiasingEnabled=!0;t.physicallyBasedRenderingEnabled=!1;t.highQualityTransparency=!0;t.highResolutionAtmosphere=!1;t.reflections=!1;t.ambientOcclusion=!1;t.memoryLimit=
750;t.additionalCacheMemory=0;t.frameRate=void 0;t.maximumPixelRatio=Infinity;return t}a._inherits(m,l);return a._createClass(m)}(c);b.__decorate([p.property({type:f})],c.prototype,"graphics3D",void 0);b.__decorate([p.property({type:h})],c.prototype,"sceneService",void 0);b.__decorate([p.property({type:z})],c.prototype,"tiledSurface",void 0);b.__decorate([p.property({type:n})],c.prototype,"heatmap",void 0);b.__decorate([p.property()],c.prototype,"fadeDuration",void 0);b.__decorate([p.property()],
c.prototype,"antialiasingEnabled",void 0);b.__decorate([p.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([p.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([p.property()],c.prototype,"highResolutionAtmosphere",void 0);b.__decorate([p.property()],c.prototype,"reflections",void 0);b.__decorate([p.property()],c.prototype,"ambientOcclusion",void 0);b.__decorate([p.property()],c.prototype,"memoryLimit",void 0);b.__decorate([p.property()],c.prototype,
"additionalCacheMemory",void 0);b.__decorate([p.property()],c.prototype,"frameRate",void 0);b.__decorate([p.property()],c.prototype,"maximumPixelRatio",void 0);return c=b.__decorate([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){let l=function(){function m(w,r,x,D){this.viewingMode=w;this.spatialReference=r;this.unitInMeters=x;this._coordinateSystem=D;this._tmpCoordinateSystem=f.create(D)}var t=m.prototype;t.getAltitude=function(w){return f.altitudeAt(this._coordinateSystem,w)};t.setAltitude=function(w,r,x=w){return f.setAltitudeAt(this._coordinateSystem,x,r,w)};t.setAltitudeOfTransformation=function(w,r){f.setAltitudeOfTransformation(this._coordinateSystem,r,w,r)};t.worldUpAtPosition=
function(w,r){return f.normalAt(this._coordinateSystem,w,r)};t.worldBasisAtPosition=function(w,r,x){return f.axisAt(this._coordinateSystem,w,r,x)};t.basisMatrixAtPosition=function(w,r){const x=this.worldBasisAtPosition(w,d.Axis.X,h.sv3d.get()),D=this.worldBasisAtPosition(w,d.Axis.Y,h.sv3d.get());w=this.worldBasisAtPosition(w,d.Axis.Z,h.sv3d.get());p.set(r,x[0],x[1],x[2],0,D[0],D[1],D[2],0,w[0],w[1],w[2],0,0,0,0,1);return r};t.headingAtPosition=function(w,r){const x=this.worldUpAtPosition(w,h.sv3d.get());
w=this.worldBasisAtPosition(w,d.Axis.Y,h.sv3d.get());r=e.angleAroundAxis(r,w,x);return c.rad2deg(r)};t.intersectManifoldClosestSilhouette=function(w,r,x){f.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);f.intersectRayClosestSilhouette(this._tmpCoordinateSystem,w,x);return x};t.intersectManifold=function(w,r,x){f.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=h.sv3d.get();return f.intersectRay(this._tmpCoordinateSystem,w,r)?u.copy(x,r):null};t.intersectInfiniteManifold=
function(w,r,x){if(this.viewingMode===n.ViewingMode.Global)return this.intersectManifold(w,r,x);f.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=this._tmpCoordinateSystem.value;const D=h.sv3d.get();return g.intersectRay(r.plane,w,D)?u.copy(x,D):null};t.toRenderCoords=function(w,r,x){return z.isDehydratedPoint(w)?k.projectPointToVector(w,r,this.spatialReference):k.projectVectorToVector(w,r,x,this.spatialReference)};t.fromRenderCoords=function(w,r,x=null){return z.isDehydratedPoint(r)?
(null!=x&&(r.spatialReference=x),k.projectVectorToDehydratedPoint(w,this.spatialReference,r)):q.isVec3(r)?k.projectVectorToVector(w,this.spatialReference,r,x)?r:null:k.projectVectorToPoint(w,this.spatialReference,r)};m.create=function(w,r){switch(w){case n.ViewingMode.Local:return new m(n.ViewingMode.Local,r,y.getMetersPerUnitForSR(r),f.createLocal());case n.ViewingMode.Global:return new m(n.ViewingMode.Global,r,1,f.createGlobal(r))}};m.renderUnitScaleFactor=function(w,r){return y.getMetersPerCartesianUnitForSR(w)/
y.getMetersPerCartesianUnitForSR(r)};b._createClass(m,[{key:"extent",set:function(w){w&&f.setExtent(this._coordinateSystem,w,this._coordinateSystem)}}]);return m}();a.RenderCoordsHelper=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(a,b){function c(p){return b.isFloat32Array(p)&&3<=p.length}function y(p){return(b.isFloat64Array(p)||Array.isArray(p))&&3<=p.length}a.isVec3=function(p){return c(p)||
y(p)};a.isVec3f32=c;a.isVec3f64=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){y=function(x){function D(){var A=x.apply(this,arguments)||this;A.updating=!1;return A}b._inherits(D,x);return b._createClass(D)}(y);c.__decorate([g.property({readOnly:!0})],y.prototype,"updating",void 0);y=c.__decorate([n.subclass("esri.views.3d.support.ResourceControllerMain")],y);let r=function(x){function D(){var v=x.apply(this,arguments)||this;v._immediateTask=w.ImmediateTask;v._normalTask=w.ImmediateTask;v._updatingObjects=d.signal([]);v._frameTask=
null;return v}b._inherits(D,x);var A=D.prototype;A.initialize=function(){this._scheduler=w.newScheduler();this._memoryController=m.newMemoryController(this.view);this._streamDataLoader=new t.StreamDataLoader;this._streamDataLoader.setup(l.maxDownloadSlots,l.downloadSlotsPerClient,this._scheduler);this.addHandles([q.watch(()=>this.view.state?.mode,v=>{null!=v&&(this._scheduler.state=v)},q.sync),q.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=k.addFrameTask({update:v=>
this._frame(v)});this._immediateTask=this._scheduler.registerTask(w.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);this._normalTask=this._scheduler.registerTask(w.TaskPriority.RESOURCE_CONTROLLER)};A.destroy=function(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=u.removeMaybe(this._frameTask);this._streamDataLoader=u.destroyMaybe(this._streamDataLoader);this._memoryController=u.destroyMaybe(this._memoryController);this._scheduler=u.destroyMaybe(this._scheduler);this.view=null};
A.createStreamDataRequester=function(v){const B=this._streamDataLoader;return{request(C,E,F){return B.request(C,E,v,F)},get busy(){return!B.hasDownloadSlots(v)}}};A.addUpdatingObject=function(v){const B=this._updatingObjects;B.value=[...B.value,v];return p.makeHandle(()=>{B.value=B.value.filter(C=>C!==v)})};A._frame=function(v){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(f.secondsFromMilliseconds(v.deltaTime)),!this._scheduler))return;this._scheduler.updateBudget(v)?
(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};A._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};b._createClass(D,[{key:"immediate",get:function(){return this._immediateTask}},{key:"normal",get:function(){return this._normalTask}},{key:"updating",get:function(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(v=>
v.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:v=>this._streamDataLoader.test.loadQueue.getStatsForType(v)}}}]);return D}(y);c.__decorate([g.property()],r.prototype,"view",void 0);c.__decorate([g.property()],r.prototype,"_scheduler",void 0);c.__decorate([g.property()],r.prototype,"_memoryController",void 0);c.__decorate([g.property()],r.prototype,"_streamDataLoader",
void 0);c.__decorate([g.property()],r.prototype,"_immediateTask",void 0);c.__decorate([g.property()],r.prototype,"_normalTask",void 0);c.__decorate([g.property()],r.prototype,"_updatingObjects",void 0);c.__decorate([g.property({readOnly:!0})],r.prototype,"updating",null);r=c.__decorate([n.subclass("esri.views.3d.support.ResourceControllerImpl")],r);a.newResourceController=function(x){return new r({view:x})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],
function(a){a.ClientType=void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(z){function n(m){m=z.call(this,m)||
this;m._quality=1;m._usedMemory=0;m._updating=!1;m.minQuality=.1;m._stableQuality=0;m._downscaleMemoryUsed=0;m._canFastRecover=!1;m._memoryPredicted=0;m._cacheStorage=new u.MemCacheStorage;m._warnMemoryUsage=null;m._numQualityChanges=0;m._maxMemory=750;m._additionalCacheMemory=0;return m}b._inherits(n,z);var l=n.prototype;l.destroy=function(){this._cacheStorage.destroy()};l.newCache=function(m,t){return new u.MemCache(m,this._cacheStorage,t)};l.resetStableQuality=function(){this._stableQuality=0};
l.disableMemCache=function(){this.additionalCacheMemory=-4096};l.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var m=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(m){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&
this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,m=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,m=this._updateQuality(this._quality+.05)):1>this._quality&&
(this._canFastRecover=!0));this._updating=m}};l._updateQuality=function(m){m=Math.min(Math.max(m,this.minQuality),1);if(m===this._quality)return!1;this._quality=m;++this._numQualityChanges;return!0};l._layersUpdating=function(){return this.view.allLayerViews.some(m=>!!m.updating)};l._updateMemory=function(){if(this.view){var m=0;this.view.basemapTerrain&&(m+=this.view.basemapTerrain.usedMemory);var t=this.view?._stage&&this.view._stage.renderView&&this.view._stage.renderer?.edgeView;null!=t&&(m+=
t.usedMemory);var w=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(x=>{if(e.isMemoryManagedView(x)){const D=x.ignoresMemoryFactor?this._quality:1;m+=x.usedMemory*D;w+=x.unloadedMemory*D}});var r=null==this._warnMemoryUsage||Math.round(10*m)!==Math.round(10*this._warnMemoryUsage);t=1048576*this.maxMemory;if(m>t&&r){this._warnMemoryUsage=m;r=D=>(D/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const x=Math.round(100*this._quality);p.getLogger(this).warn(`Memory Limit exceeded! Limit: ${r(t)} Current: ${r(m)} Projected: ${r(m+
w)} Quality: ${x}%`)}this._usedMemory=m/t;this._memoryPredicted=(m+w)/t;this._cacheStorage.maxSize=Math.max(0,t-m+1048576*this.additionalCacheMemory)}};b._createClass(n,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(m){null==m||0>=m||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<m&&this._updateQuality(1),this._maxMemory=m)}},{key:"additionalCacheMemory",get:function(){return this._additionalCacheMemory},set:function(m){null!=m&&(this._additionalCacheMemory=
m)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._usedMemory}},{key:"test",get:function(){const m=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=m._numQualityChanges;m._numQualityChanges=0;return t}}}}]);return n}(y);c.__decorate([q.property({constructOnly:!0})],h.prototype,"view",void 0);c.__decorate([q.property()],h.prototype,"maxMemory",null);c.__decorate([q.property()],
h.prototype,"additionalCacheMemory",null);c.__decorate([q.property()],h.prototype,"memoryFactor",null);c.__decorate([q.property()],h.prototype,"updating",null);c.__decorate([q.property()],h.prototype,"usedMemory",null);c.__decorate([q.property()],h.prototype,"_quality",void 0);c.__decorate([q.property()],h.prototype,"_usedMemory",void 0);c.__decorate([q.property()],h.prototype,"_updating",void 0);c.__decorate([q.property()],h.prototype,"_stableQuality",void 0);c.__decorate([q.property()],h.prototype,
"_maxMemory",void 0);c.__decorate([q.property()],h.prototype,"_additionalCacheMemory",void 0);h=c.__decorate([g.subclass("esri.views.3d.support.MemoryController")],h);a.newMemoryController=function(z){return new h({view:z})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(x){if(2>x.byteLength)return"unknown";x=new Uint8Array(x,0,x.byteLength);return 137===x[0]&&80===x[1]?"image/png":71===x[0]&&73===x[1]?"image/gif":66===x[0]&&77===x[1]?"image/bmp":255===x[0]&&216===x[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(x){function D(){var v=x.apply(this,arguments)||this;v._tasks=new Map;v._onLoadQueue=[];v._doneQueue=[];v.updating=!1;return v}b._inherits(D,x);var A=D.prototype;A.setup=function(v,B,C){this._loadQueue=
new z.AsyncWorkerQueue((E,F)=>this._startLoading(E,F),(E,F)=>this._doneLoadingCB(E,F),v,B);C&&(this._frameTask=C.registerTask(l.TaskPriority.STREAM_DATA_LOADER,this))};A.destroy=function(){this._frameTask=d.removeMaybe(this._frameTask);this._tasks.forEach(v=>d.abortMaybe(v.abortController));this._loadQueue=d.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};A.hasDownloadSlots=function(v){return this._loadQueue.hasQuota(v)};A.request=function(v,B,C,E={}){const F=f.createResolver();
F.__signal=null!=E?E.signal:null;const M=this._createOrUpdateTask(v,B,C,E,F);f.onAbort(E,()=>this._cancelRequest(M,F));return F.promise};A._createTask=function(v,B,C,E,F,M){v=new r(v,B,C,E,F);this._updateTask(v,M);this._tasks.set(F,v);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(v);return v};A._cancelRequest=function(v,B){u.removeUnordered(v.resolvers,B);B.reject(f.createAbortError());0===v.resolvers.length&&(v.status===a.TaskStatus.DOWNLOADING&&(v.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(v),v.abortController?.abort(),v.request=null,v.abortController=null),v.status=a.TaskStatus.CANCELLED,this._tasks.delete(v.key),0===this._tasks.size&&this._set("updating",!1))};A._updateTask=function(v,B){v.resolvers.push(B)};A._createOrUpdateTask=function(v,B,C,E,F){const M=`${null!=E&&E.uid||v}:${B}:${C}`,K=this._tasks.get(M);return K?(this._updateTask(K,F),K):this._createTask(v,E,B,C,M,F)};A._doneLoadingCB=function(v,B){this._loadQueue&&(n.assert(v.status===a.TaskStatus.DOWNLOADING),
v.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:v,err:B}):this._doneLoading(v,B))};A.runTask=function(v){for(;!v.done&&0<this._onLoadQueue.length;){var B=this._onLoadQueue.shift();f.throwIfAborted(B.task.abortController);B.task.abortController=null;B.callback(B.task);v.madeProgress()}for(;!v.done&&0<this._doneQueue.length;)B=this._doneQueue.shift(),B.task.status!==a.TaskStatus.DOWNLOADED&&(B.err=B.err||f.createAbortError()),this._doneLoading(B.task,B.err),v.madeProgress()};
A._doneLoading=function(v,B){if(B&&!f.isAbortError(B)&&0<v.numRetries)--v.numRetries,this._loadQueue.push(v);else{var C=v.result instanceof HTMLImageElement?0:v.resolvers.length;for(const E of v.resolvers)if(B)f.isAbortError(B)?E.reject(B):E.reject(new q("stream-data-loader:request-error",`Failed to request resource at '${v.url}'. ${B}`,{url:v.url,error:B}));else{--C;const F=0>=C?v.result:k.clone(v.result);E.resolve(F)}this._tasks.delete(v.key);0===this._tasks.size&&this._set("updating",!1)}};A._startLoading=
function(v,B){if(v.status===a.TaskStatus.CANCELLED)return!1;v.startTime=performance.now();v.status=a.TaskStatus.DOWNLOADING;let C,E;switch(v.docType){case "binary":E="array-buffer";C=0;break;case "image":E="image";break;case "image+type":E="array-buffer";break;default:E="json"}v.abortController=new AbortController;const F=v.abortController.signal;v.request=y(v.url,{...v.options,responseType:E,timeout:C,signal:F});let M=()=>{};const K=L=>{v.duration=performance.now()-v.startTime;v.size=L instanceof
ArrayBuffer?L.byteLength:v.size||0;v.result=L;this._frameTask?this._onLoadQueue.push({callback:B,task:v}):(v.abortController=null,B(v))},G=L=>{v.status===a.TaskStatus.DOWNLOADING&&B(v,L);M()};if("image+type"!==v.docType)return v.request.then(L=>K(L.data),G),!0;v.request.then(L=>{L=L.data;const O=m(L);E="image";v.size=L.byteLength;if("unknown"===O)v.request=y(v.url,{responseType:E,timeout:C,signal:F}),v.request.then(H=>K(H.data),G);else{L=new Blob([L],{type:O});var I=window.URL.createObjectURL(L);
M=()=>window.URL.revokeObjectURL(I);v.request=y(I,{responseType:E,timeout:C,signal:F});v.request.then(H=>K(new w(H.data,O,M)),G)}},G);return!0};b._createClass(D,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return D}(p);c.__decorate([g.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([h.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const t={numRetries:0};let w=function(){function x(D,A,v){this.image=D;this.type=A;this.release=v}b._createClass(x,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return x}(),r=function(x){function D(A,v,B,C,E){C=x.call(this,C)||this;C.url=A;C.options=v;C.docType=B;C.key=E;C.result=null;C.status=a.TaskStatus.QUEUED;C.request=null;C.abortController=null;C.resolvers=[];C.startTime=0;C.numRetries=t.numRetries;return C}b._inherits(D,x);return b._createClass(D)}(z.BaseTask);
a.TaskStatus=void 0;(function(x){x[x.QUEUED=1]="QUEUED";x[x.DOWNLOADING=2]="DOWNLOADING";x[x.DOWNLOADED=3]="DOWNLOADED";x[x.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=w;a.test=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let y=b._createClass(function(k){this.client=k;this._cancelled=!1;this.duration=
this.size=0}),p=b._createClass(function(k){this.typeWorkerQuota=k;this.tasks=[];this.numWorkers=0;this.statistics=new u}),u=b._createClass(function(){this.speed=this.duration=this.size=this.requests=0}),q=function(){function k(f,g,e,h){this._workerFunc=f;this._callbackFunc=g;this._maxTotalNumWorkers=e;this._totalNumWorkers=0;this._clients=h.map(z=>new p(z))}var d=k.prototype;d.destroy=function(){this._clients.length=0};d.hasQuota=function(f){return(f=this._clients[f])?this._totalNumWorkers<this._maxTotalNumWorkers||
f.numWorkers+f.tasks.length<f.typeWorkerQuota:!1};d.push=function(f){const g=this._clients[f.client];g&&(this._totalNumWorkers<this._maxTotalNumWorkers?(g.numWorkers++,this._totalNumWorkers++,this._workerFunc(f,(e,h)=>this._taskCallback(e,h))):g.tasks.push(f))};d.cancel=function(f){this._taskFinished(f);f._cancelled=!0};d._taskFinished=function(f){const g=this._clients[f.client];this._totalNumWorkers--;g&&(g.numWorkers--,g.statistics.requests++,g.statistics.size+=f.size||0,g.statistics.duration+=
f.duration||0,g.statistics.speed=0<g.statistics.duration?g.statistics.size/g.statistics.duration:0,c.assert(0<=g.numWorkers));this._next()};d._next=function(){for(const f of this._clients)if(f&&f.numWorkers<f.typeWorkerQuota&&this._processQueue(f))return;for(const f of this._clients)if(f&&this._processQueue(f))break};d._processQueue=function(f){for(;0<f.tasks.length;)if(this._workerFunc(f.tasks.shift(),(g,e)=>this._taskCallback(g,e)))return f.numWorkers++,this._totalNumWorkers++,!0;return!1};d._taskCallback=
function(f,g){f._cancelled||(this._callbackFunc(f,g),this._taskFinished(f))};d.getStatsForType=function(f){return(f=this._clients[f])?{quota:f.typeWorkerQuota,workers:f.numWorkers,queueSize:f.tasks.length,requestStats:f.statistics}:null};b._createClass(k,[{key:"test",get:function(){const f=this;return{set workerFunc(g){f._workerFunc=g}}}}]);return k}();a.AsyncWorkerQueue=q;a.BaseTask=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../core/ByteSizeUnit","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,y,p){return a._createClass(function(u){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];if(null!=u.resourceController){var q=u.resourceController.memoryController;this.totalMemory=(q.maxMemory??0)*b.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(q.usedMemory*this.totalMemory);this.quality=
q.memoryFactor;this.load=u.resourceController.scheduler.load}this.terrainMemory=u.basemapTerrain?.usedMemory??0;q=u._stage&&u._stage.renderView&&u._stage.renderer.edgeView;this.edgesMemory=null!=q?q.usedMemory:0;u.allLayerViews.items.forEach(k=>{(c.isMemoryManagedLayerView(k)||p.isSurfaceLayerView(k))&&this.layerPerformanceInfos.push(new y(k,u))});this.layerPerformanceInfos.sort((k,d)=>d.memory-k.memory)})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports","../../support/MemoryManagedView"],
function(a,b){a.isMemoryManagedLayerView=function(c){return b.isMemoryManagedView(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,b,c){return a._createClass(function(y,p){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;
this.layer=y.layer;this.memory=c.isSurfaceLayerView(y)?p.basemapTerrain.getUsedMemoryForLayerView(y):y.usedMemory;b.isPerformanceInfoLayerView(y)&&(y=y.performanceInfo,this.displayedNumberOfFeatures=y.displayedNumberOfFeatures,this.maximumNumberOfFeatures=y.maximumNumberOfFeatures,this.totalNumberOfFeatures=y.totalNumberOfFeatures)})})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in
b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./ITile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,c,y,p,u,q,k,d){function f(A){return"imagery-tile"===A?.type||"wcs"===A?.type}function g(A){return"imagery-tile-3d"===
A?.type}function e(A){return"tile-3d"===A?.type}function h(A){return"vector-tile-3d"===A?.type}function z(A){return"wmts-3d"===A?.type}function n(A){return"elevation-3d"===A?.type}function l(A){return A&&(e(A)||g(A)||h(A)||z(A))}function m(A){return null!=A?.data&&"type"in A.data&&"vector-tile"===A.data.type}function t(A,v,B,C){return x[C].checkIfTileInfoSupportedForViewSR(A,B,v)}function w(A,v,B){A=y.getTileMaxtrixSetFromActiveLayer(A);if(null!=A)if(b.isCollection(A)){if(A=A.find(C=>null==t(C.tileInfo,
C.fullExtent,v,B)))return{tileInfo:A.tileInfo,fullExtent:A.fullExtent}}else return{tileInfo:A.tileInfo,fullExtent:A.fullExtent};return{tileInfo:null,fullExtent:null}}function r(A){return A.isWGS84||A.isWebMercator||c.isCGCS2000(A)||!c.isEarth(A)}const x={[p.ViewingMode.Global]:d.terrainUtilsSpherical,[p.ViewingMode.Local]:k.terrainUtilsPlanar};a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.ENABLE_WATERPROOFNESS_TESTS=!1;const D={force512VTL:!1};k=[q.NeighborIndex.NORTH,q.NeighborIndex.EAST,q.NeighborIndex.SOUTH,
q.NeighborIndex.WEST];d=[q.NeighborIndex.NORTH_EAST,q.NeighborIndex.SOUTH_EAST,q.NeighborIndex.SOUTH_WEST,q.NeighborIndex.NORTH_WEST];a.almostEquals=function(A,v,B=1E-5){return Math.abs(A-v)<B};a.checkIfTileInfoSupportedForView=t;a.enableTerrainInternalChecks=function(A){a.ENABLE_TERRAIN_INTERNAL_CHECKS=A};a.enableTerrainWaterproofnessChecks=function(A){a.ENABLE_WATERPROOFNESS_TESTS=A;a.ENABLE_TERRAIN_INTERNAL_CHECKS=a.ENABLE_TERRAIN_INTERNAL_CHECKS||A};a.eps=1E-5;a.getLayerWithExtentRange=function(A){return g(A)?
{fullExtent:A.fullExtent,minScale:A.layer.minScale,maxScale:A.layer.maxScale,tilemapCache:null}:A.layer};a.getTileInfoAndExtentFromWMTSLayer=w;a.getTiledLayerInfo=function(A,v,B){var C=null;let E=null;if("wmts"===A?.type)A=w(A,v,B),C=A.tileInfo,E=A.fullExtent;else if(E=f(A)?A.getCompatibleFullExtent(v):A.fullExtent,C=B===p.ViewingMode.Local,f(A))C=A.getCompatibleTileInfo(v,E,C);else if("vector-tile"===A?.type){C=C&&!r(v)||D.force512VTL;const F=A.tileInfo.spatialReference.isGeographic;C=C?A.tileInfo:
A.tileInfo.getOrCreateCompatible(256,F?1:2)}else C=A.tileInfo;return null!=C&&null!=E&&null==t(C,E,v,B)?{tileInfo:C,fullExtent:E}:null};a.internalAssert=function(A,v){if(a.ENABLE_TERRAIN_INTERNAL_CHECKS&&!A)throw A=Error().stack?.slice(5),console.warn("Terrain internal: "+(v??"")+" at "+A),Error("Assertion failed"+(v?": "+v:""));};a.isBlendableLayerView=function(A){return A&&(e(A)||z(A)||g(A)||h(A))};a.isEast=function(A){return A===q.NeighborIndex.NORTH_EAST||A===q.NeighborIndex.EAST||A===q.NeighborIndex.SOUTH_EAST};
a.isElevationLayerView=n;a.isGroupLayerView=function(A){return"group"===A?.type};a.isImageryTileLayerView=g;a.isImageryTileRenderInfo=function(A){A=A?.sourceLayerInfo?.data;return null!=A&&"type"in A&&"raster-tile"===A.type};a.isMapTileLayerView=l;a.isNorth=function(A){return A===q.NeighborIndex.NORTH_EAST||A===q.NeighborIndex.NORTH||A===q.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(A){return A===q.NeighborIndex.NORTH_WEST||A===q.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=f;a.isRasterTileRenderInfo=
function(A){A=A?.sourceLayerInfo?.data;return A instanceof HTMLImageElement||A instanceof u.ImageWithType||A instanceof HTMLCanvasElement||A instanceof ImageData};a.isSouth=function(A){return A===q.NeighborIndex.SOUTH_EAST||A===q.NeighborIndex.SOUTH||A===q.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(A){return l(A)||n(A)};a.isTextureTileRenderInfo=function(A){A=A?.sourceLayerInfo?.data;return null!=A&&"type"in A&&"tile-texture"===A.type};a.isTileLayerView=e;a.isVectorTileLayerView=h;a.isVectorTilePerLayerInfo=
m;a.isVectorTileRenderInfo=function(A){return m(A?.sourceLayerInfo)};a.isWMTSLayerView=z;a.isWest=function(A){return A===q.NeighborIndex.NORTH_WEST||A===q.NeighborIndex.WEST||A===q.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(A){return A===q.NeighborIndex.NORTH_WEST||A===q.NeighborIndex.SOUTH_WEST};a.lij2s=function(A){return"["+A[0]+","+A[1]+","+A[2]+"]"};a.neighborCornerIndices=d;a.neighborEdgeIndices=k;a.oppositeCorner=function(A){return A===q.NeighborIndex.NORTH_EAST?q.NeighborIndex.SOUTH_WEST:
A===q.NeighborIndex.NORTH_WEST?q.NeighborIndex.SOUTH_EAST:A===q.NeighborIndex.SOUTH_WEST?q.NeighborIndex.NORTH_EAST:q.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(A){return A===q.NeighborIndex.NORTH?q.NeighborIndex.SOUTH:A===q.NeighborIndex.EAST?q.NeighborIndex.WEST:A===q.NeighborIndex.SOUTH?q.NeighborIndex.NORTH:q.NeighborIndex.EAST};a.releaseTileData=function(A){null!=A&&"release"in A&&A.release();return null};a.test=D;a.useFetchTileForLayer=function(A){return A.fetchTile&&!1!==A.hasOverriddenFetchTile};
a.v32s=function(A){return"("+A[0]+","+A[1]+","+A[2]+")"};a.vtlAssumes256PixelSizeAsDefault=r;a.weakAssert=function(A,v){A||console.warn("Terrain: "+v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ITile":function(){define(["exports"],function(a){a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=
0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,y,p,u,q,k){function d(m,t,w=0){m=m.extent;return null==m?!1:0===w?u.containsPoint(m,t):u.containsPointWithMargin(m,t,w*Math.min(m[2]-m[0],m[3]-m[1]))}function f(m,t,w,r){c.copy(h,w);h[r]=t[r];r=c.subtract(h,h,t);var x=c.subtract(z,m,t);x=c.dot(x,r);const D=c.dot(r,r);t=0>=x?t:D<=x?w:c.add(h,t,c.scale(r,r,x/D));m=c.subtract(h,m,t);return Math.PI/2-Math.atan(m[2]/Math.sqrt(m[0]*m[0]+m[1]*m[1]))}function g(m,t,w){m=m.extent;if(null==m)return 0;n[0]=m[0];n[1]=m[1];n[2]=w;l[0]=m[2];l[1]=
m[3];l[2]=w;m=w=Infinity;t[0]<n[0]?w=f(t,n,l,0):t[0]>l[0]&&(w=f(t,l,n,0));t[1]<n[1]?m=f(t,n,l,1):t[1]>l[1]&&(m=f(t,l,n,1));return Math.min(w,m)}function e(m,t,w){if(null==m)return k.getMissingTileInfoError();if(m.spatialReference.isGeographic&&!p.canProjectToWGS84ComparableLonLat(m.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var r=k.TilingScheme.checkUnsupported(m);if(null!=r)return r;if(null==
w)return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var x=m.lods;r=x[0].resolution*2**x[0].level;var D=[r*m.size[0],r*m.size[1]];const A=[m.origin.x,m.origin.y];w=u.fromExtent(w);const v=u.create();k.TilingScheme.computeRowColExtent(w,D,A,v);D=(v[2]-v[0])*(v[3]-v[1]);D>q.MAX_ROOT_TILES?(x=x[0].scale*2**x[0].level,r=Math.max((w[3]-w[1])/m.size[1],(w[2]-w[0])/m.size[0])*x/r,w=Math.floor(Math.log(r)/Math.log(10)),r=Math.ceil(r/10**w)*10**w,r=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(x).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:x,suggestedLevel0Scale:r,requiredNumRootTiles:D,allowedNumRootTiles:q.MAX_ROOT_TILES})):r=null}if(r)return r;m=m.spatialReference;return null==t||m.equals(t)||t.isWGS84&&m.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const h=y.create(),
z=y.create(),n=y.create(),l=y.create();y=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:e,isInsideExtent:d,tiltToExtentEdge:g},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=e;a.isInsideExtent=d;a.terrainUtilsPlanar=y;a.tiltToExtentEdge=g})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,
b,c,y,p){function u(){return!0}function q(){return 0}function k(f,g){if(null==f)return p.getMissingTileInfoError();const e=f.lods.length-1,h=f.spatialReference,z=c.canProjectToWGS84ComparableLonLat(h)||y.isMars(h)||y.isMoon(h);if(h.isWebMercator){if(!p.TilingScheme.makeWebMercatorAuxiliarySphere(e).compatibleWith(f))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(z){if(!p.TilingScheme.makeGCSWithTileSize(f.spatialReference,
f.size[0],e).compatibleWith(f))return f.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(null!=g&&!f.spatialReference.equals(g))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const d=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:k,isInsideExtent:u,tiltToExtentEdge:q},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=k;a.isInsideExtent=u;a.terrainUtilsSpherical=d;a.tiltToExtentEdge=q})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(){function n(m){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=m.viewState;this._view=m.view;this._pointsOfInterest=m.pointsOfInterest;this.streamDataRequester=m.resourceController.createStreamDataRequester(f.ClientType.SYMBOLOGY);this.objectResourceCache=new d.ObjectResourceCache((w,r)=>m.resourceController.memoryController.newCache(w,r));this.textures=new g.StreamTextureCollection(this.streamDataRequester,
m.view._stage,m.resourceController.scheduler);const t=k.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=e.getSettings(m.viewingMode,t);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(m.viewingMode,t)}var l=n.prototype;l.destroy=function(){this.textures.destroy();this.streamDataRequester=null};l.addGraphicsOwner=function(m){if(!m)return p.makeHandle();this._graphicsOwners.push(m);const t=q.watch(()=>m.layer?.screenSizePerspectiveEnabled,()=>
this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return p.makeHandle(()=>{t.remove();c.removeUnordered(this._graphicsOwners,m);this._updateScreenSizePerspectiveEnabled()})};l._updateScreenSizePerspectiveEnabled=function(){var m=this._graphicsOwners.some(t=>!0===t.layer?.screenSizePerspectiveEnabled);m&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new y,m=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([q.watch(()=>
this._pointsOfInterest.centerOnSurfaceInfrequent.distance,m,q.sync),this._viewState.events.on("camera-projection-changed",m)]),this._updateScreenSizePerspectiveSettings()):m||(this._screenSizePerspectiveHandles=u.destroyMaybe(this._screenSizePerspectiveHandles))};l._updateScreenSizePerspectiveSettings=function(){z.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance;z.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(z);this.screenSizePerspectiveSettingsLabels.update(z);
this._view._stage.renderView.requestRender()};b._createClass(n,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}]);return n}();const z={distance:0,fovY:0};a.SharedSymbolResources=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(a,b,c,y,p,u,q){let k=function(){function d(g){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=g("gltf-resources",()=>{});this._wosrMemCache=g("wosr-resources",()=>{})}var f=d.prototype;f.destroy=function(){this._gltfLoading.forEach(g=>g.abortController.abort());this._wosrLoading.forEach(g=>g.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()};f.loadGLTF=function(g,e,h){const z=h?`gltfPBR:${g}`:`gltf:${g}`,n=this._gltfMemCache.get(z);
return null!=n?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,z,l=>u.loadGLTF(new p.DefaultLoadingContext(l.streamDataRequester),g,l,h),e)};f.loadWOSR=function(g,e){const h=`wosr:${g}:${e.disableTextures}`,z=this._wosrMemCache.get(h);return null!=z?Promise.resolve(z):this._loadOnce(this._wosrLoading,this._wosrMemCache,h,n=>q.load(g,n),e)};f._loadOnce=async function(g,e,h,z,n){y.throwIfAborted(n);const l=y.onAbort(n,()=>this._abortLoad(g,h));var m=g.get(h);m?m.refCount++:(m=
new AbortController,z=z({...n,signal:m.signal}),m={refCount:1,abortController:m,promise:z},g.set(h,m));try{const t=await m.promise;e.put(h,t,t.size);g.delete(h);y.throwIfAborted(n);return t}finally{c.removeMaybe(l)}};f._abortLoad=function(g,e){const h=g.get(e);null!=h&&0<--h.refCount||(g.delete(e),null!=h&&h.abortController.abort())};return b._createClass(d)}();a.ObjectResourceCache=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q){let k=function(d){function f(e,h,z){h=d.call(this,h,z)||this;h._streamDataRequester=e;return h}b._inherits(f,d);var g=f.prototype;g.fromUrl=async function(e,h,z){c.throwIfAborted(z);z=null!=z?z.signal:null;const n=this.makeUid(e,h);let l=this._textureRequests.get(n);if(!l){const m=new AbortController,t=this._streamDataRequester.request(e,"image",{uid:n,signal:m.signal});l=new p.TextureRequest;l.abortController=m;const w=l;this._textureRequests.set(n,l);l.textureAsync=t.then(async r=>
{r=this._createTexture(e,r,h);w.texture=r;w.abortController=null;this._stage.add(r);await this._stage.load(r);return{uid:n,texture:r,release:()=>this._release(n)}},r=>{w.abortController=null;throw r;})}l.referenceCount++;try{return await c.whenOrAbort(l.textureAsync,z)}catch(m){throw this._release(n),m;}};g._createTexture=function(e,h,z){const n={width:h.width,height:h.height,wrap:{s:q.TextureWrapMode.CLAMP_TO_EDGE,t:q.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(y.isSVG(e)){if(z||0===h.width&&
0===h.height)e=h.width?h.height/h.width:1,z=z||64,1<e?(h.width=Math.round(z/e),h.height=z):(h.width=z,h.height=Math.round(z*e));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new u.Texture(h,n)};return b._createClass(f)}(p.TextureCollection);a.StreamTextureCollection=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F){a.PointsOfInterest=function(O){function I(J){J=O.call(this,J)||this;J._handles=new p;J._tmpRay=z.create();J._centerRayDirty=!0;J._surfaceAltitudeAtCenter=0;J._surfaceAltitudeAtCenterDirty=!0;J._contentAltitudeAtCenter=0;J._contentAltitudeAtCenterDirty=!0;J._propertiesPool=new m.PropertiesPool({renderPointOfView:M},b._assertThisInitialized(J));J.renderPointOfView=h.create();J._pois=[];J._debugCenters=new Map;return J}b._inherits(I,O);
var H=I.prototype;H.initialize=function(){const {state:J,basemapTerrain:N,renderCoordsHelper:R,map:W}=this.view;this._surfaceIntersector=B.newIntersector(J.viewingMode);this._surfaceIntersector.options.backfacesTerrain=J.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=C.StoreResults.MIN;this._contentIntersector=B.newIntersector(J.viewingMode);var T=()=>this._estimateSurfaceAltitudeAtCenter();const P=this.view.resourceController.scheduler,
Q=this.view.basemapTerrain?.elevationQueryCache,S={state:J,scheduler:P,surface:N,renderCoordsHelper:R};this._set("centerOnSurfaceInfrequent",new r.CenterOnSurface({...S,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnSurfaceFrequent",new r.CenterOnSurface({...S,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnContent",new r.CenterOnSurface({...S,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,
estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new w.CameraOnSurface({...S,cache:Q,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:W}));this._set("surfaceGeometryUpdates",new v.SurfaceGeometryUpdates({...S,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new x.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:R}));
this._set("surfaceOrigin",new A.StableSurfaceCenter({cache:Q,view:this.view}));this._set("focus",new D.Focus({state:J,scheduler:P,surface:N,renderCoordsHelper:R,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(U,V)=>this._estimateSurfaceIntersectionAtRenderPoint(U,this.view.state.contentCamera,V)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);T=this.view.graphics;this._debugCenters.set(this.centerOnContent,
new l.PointGraphics(T,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new l.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new l.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new l.PointGraphics(T,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new l.PointGraphics(T,"green","Focus"));this._handles.add([u.watch(()=>J.contentCamera,U=>this._cameraChanged(U),u.sync),u.watch(()=>
N.extent,()=>this._updateCenterPointsOfInterest()),u.when(()=>!N.updating,()=>this._updateCenterPointsOfInterest(),u.sync),u.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),u.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),u.when(()=>n.SHOW_POI,U=>this._setDebug(U),u.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const U of this._pois)U.runTask()};H.destroy=function(){this._setDebug(!1);
this._handles.destroy();this._propertiesPool.destroy();for(const J of this._pois)J.destroy();this.surfaceOrigin.destroy()};H._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const J=this._centerRay;if(null==J)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(J,this._contentIntersector,K,L)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K):
this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};H._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const J=this._centerRay;if(null==J)return this._surfaceAltitudeAtCenter;const N=J.origin,R=e.add(K,J.origin,J.direction);this._surfaceIntersector.resetWithRay(J,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,
null,N,R);this._surfaceIntersector.results.min.getIntersectionPoint(K)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K));return this._surfaceAltitudeAtCenter};H._estimateSurfaceIntersectionAtRenderPoint=function(J,N,R){J=t.fromRenderAtEye(N,J,G);if(null==J)return null;const W=J.origin,T=e.add(K,J.origin,J.direction);this._surfaceIntersector.resetWithRay(J,N);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,W,T);return this._surfaceIntersector.results.min.getIntersectionPoint(R)?
R:null};H._cameraChanged=function(J){this._updateCenterPointsOfInterest();J=J.eye;e.exactEquals(this.renderPointOfView,J)||this._set("renderPointOfView",e.copy(this._propertiesPool.get("renderPointOfView"),J))};H._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const J of this._pois)J.updateRenderLocation()};H._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};
H._setDebug=function(J){if(J)for(const N of this._pois)this._handles.add(u.watch(()=>N.renderLocation,R=>this._debugCenters.get(N)?.show(R,N.renderCoordsHelper.spatialReference),u.initial),"debug");else this._debugCenters.forEach(N=>N.hide()),this._handles.remove("debug")};b._createClass(I,[{key:"updating",get:function(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(J=>J.updating))}},{key:"_centerRay",get:function(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,
this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const J of this._pois)J.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return I}(y);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([q.property({readOnly:!0})],
a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,
"contentGeometryUpdates",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);c.__decorate([q.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([q.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([g.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const M=Array,K=h.create(),G=z.create(),L={exclude:new Set([E.TERRAIN_ID])};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../Graphic ../../../symbols ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),function(a,b,c,y,p,u,q,k,d){c=function(){function f(e,h,z=""){this.graphics=e;this._symbol=new u({symbolLayers:[new q({material:{color:h},outline:{color:[255,255,255],size:1},
resource:{primitive:"circle"}}),new k({text:z,halo:{color:"white",size:1/.75},material:{color:h},size:12})]})}var g=f.prototype;g.show=function(e,h){null!=h&&(this.hide(),e=new d({x:e[0],y:e[1],z:e[2],spatialReference:h}),this._graphic=new y({geometry:e,symbol:this._symbol}),this.graphics.add(this._graphic))};g.hide=function(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)};return b._createClass(f)}();a.PointGraphics=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){const r=Array;a.CameraOnSurface=function(D){function A(B){B=D.call(this,B)||this;B._dirty=!1;B._propertiesPool=new m.PropertiesPool({location:z,renderLocation:r},b._assertThisInitialized(B));B._estimatedSurfaceAltitude=0;B._pendingElevationQueryController=null;B.renderLocation=h.create();B._tmpPoint=new z;return B}b._inherits(A,D);var v=A.prototype;v.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this));
this.runTask();if(this.map){const B=()=>this._setDirty();this.handles.add(u.on(()=>this.map?.ground?.layers,"change",B,{onListenerAdd:B,onListenerRemove:B}))}this._updateRenderLocation()};v.destroy=function(){this._cancelPendingRequest();this._propertiesPool=y.destroyMaybe(this._propertiesPool)};v.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};v._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};v._cancelPendingRequest=function(){const B=
this._pendingElevationQueryController;B&&(this._pendingElevationQueryController=null,B.abort(),this.notifyChange("updating"))};v.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),w.Task.YIELD;var B=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,B);B=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===n.ViewingMode.Global&&
(B.isWGS84||B.isWebMercator);let C=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:C.signal,cache:this.cache,minDemResolution:B?1E6:0}).then(E=>this._updateSurfaceAltitude(E.geometry.z??0)).catch(E=>{p.isAbortError(E)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===C&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));C=null});this._pendingElevationQueryController=C;return w.Task.YIELD};v._updateSurfaceAltitude=
function(B){this._estimatedSurfaceAltitude!==B&&(this._estimatedSurfaceAltitude=B,this._updateRenderLocation())};v._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(x,this._estimatedSurfaceAltitude,this._camera.eye);e.exactEquals(this._get("renderLocation"),x)||(this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),x)),this.notifyChange("renderLocation"))};b._createClass(A,[{key:"_camera",get:function(){return this.state.contentCamera}},{key:"location",get:function(){const B=
this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,B,this.state.spatialReference);return B}},{key:"scale",get:function(){const B=this._camera,C=e.distance(B.eye,this.renderLocation);return l.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:B}},C,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);
return A}(t.PointOfInterest);c.__decorate([q.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([q.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);c.__decorate([q.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);c.__decorate([q.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([q.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([q.property({readOnly:!0})],
a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([q.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);c.__decorate([q.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([g.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const x=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.PointOfInterest=function(g){function e(h){h=g.call(this,h)||this;h.handles=new p;return h}b._inherits(e,g);e.prototype.destroy=function(){this.handles.destroy()};return b._createClass(e)}(y);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);
a.PointOfInterest=c.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){const x=Array;a.CenterOnSurface=function(B){function C(F){F=B.call(this,F)||this;F._propertiesPool=new t.PropertiesPool({location:z,renderLocation:x},b._assertThisInitialized(F));F._currentSurfaceAltitude=0;F._latestSurfaceAltitude=0;F.distance=0;F.renderLocation=e.create();F.updating=!1;return F}b._inherits(C,B);var E=C.prototype;E.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};E.destroy=function(){this._frameWorker=
p.removeMaybe(this._frameWorker);this._propertiesPool=p.destroyMaybe(this._propertiesPool)};E.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};E.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1;return r.Task.YIELD};E._updateRenderLocation=function(){const F=D;let M=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,F);var K=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;
!M&&K&&(M=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);K=A;M&&this._latestSurfaceAltitudeChangesDistanceSignificantly(F,K)&&(g.copy(F,K),this._currentSurfaceAltitude=this._latestSurfaceAltitude);M?this.distance=g.distance(this._camera.eye,F):(g.scale(F,this._camera.viewForward,this._get("distance")),g.add(F,F,this._camera.eye));g.exactEquals(this._get("renderLocation"),F)||this._set("renderLocation",g.copy(this._propertiesPool.get("renderLocation"),
F))};E._calculateSurfaceIntersection=function(F,M){var K=this._camera;if(!this.renderCoordsHelper.intersectManifold(K.ray,F,M))return!1;if(this.state.isGlobal){const G=h.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;F=G+F;const L=g.squaredLength(K.eye),O=L<F*F,I=g.distance(K.eye,M);O&&I>G/4&&(g.scale(M,K.viewForward,F-Math.sqrt(L)),g.add(M,M,K.eye))}else K=this.surface?.ready?this.surface.extent:null,null!=K&&n.projectBoundingRect(K,this.surface?.spatialReference,v,this.renderCoordsHelper.spatialReference)&&
(M[0]=y.clamp(M[0],v[0],v[2]),M[1]=y.clamp(M[1],v[1],v[3]));return!0};E._latestSurfaceAltitudeChangesDistanceSignificantly=function(F,M){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==F)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,M)){if(m.TESTS_DISABLE_OPTIMIZATIONS)return!0;const K=this._camera.eye;F=g.distance(K,F);M=g.distance(K,M);if(.05<Math.abs(M-F)/F)return!0}return!1};b._createClass(C,[{key:"_camera",get:function(){return this.state.contentCamera}},
{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return C}(w.PointOfInterest);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"task",void 0);c.__decorate([u.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([u.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([u.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([u.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],
a.CenterOnSurface);const D=e.create(),A=e.create(),v=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,c,y,p){let u=function(){function k(f){this._handles=new y;this.events=new c;this._contentLayerViews=f.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",
g=>this._layerViewsChanged(g)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}var d=k.prototype;d.destroy=function(){this._handles=p.destroyMaybe(this._handles);this._contentLayerViews.destroy()};d._layerViewsChanged=function(f){f.added.forEach(g=>{"esri.views.3d.layers.SceneLayerView3D"===g.declaredClass&&this._handles.add(g.on("visible-geometry-changed",()=>this._contentChanged()),g.uid)});f.removed.forEach(g=>this._handles.remove(g.uid))};
d._contentChanged=function(){this.events.emit("request-update",q)};return b._createClass(k)}();const q={};a.ContentGeometryUpdates=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){const x=Array;a.Focus=function(B){function C(F){F=B.call(this,F)||this;F._propertiesPool=new m.PropertiesPool({location:n,renderLocation:x},b._assertThisInitialized(F));F._dirty=!0;F.renderLocation=F._propertiesPool.get("renderLocation");return F}b._inherits(C,B);var E=C.prototype;E.initialize=function(){this.handles.add([u.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),u.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(r.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};E.destroy=function(){this._propertiesPool=p.destroyMaybe(this._propertiesPool)};E.runTask=function(){var F=this._get("renderLocation");const M=this.centerOnSurface.renderLocation;var K=this.renderCoordsHelper,G=this.state.contentCamera;this._dirty=!1;K.worldUpAtPosition(M,D);K=Math.max(0,(Math.acos(h.dot(D,G.viewForward))-.5*Math.PI)*(G.aboveGround?1:-1));if(Number.isNaN(K))return F&&h.equals(F,
M)||(F=this._propertiesPool.get("renderLocation"),h.copy(F,M),this._set("renderLocation",F)),r.Task.YIELD;K=1-y.clamp(K/(.5*Math.PI),0,1);K*=K*K;this._calculateScreenHorizontalEdgeOnSurface(v);G=this._propertiesPool.get("renderLocation");h.lerp(G,M,v,K);F&&h.equals(F,G)||this._set("renderLocation",G);return r.Task.YIELD};E._calculateScreenHorizontalEdgeOnSurface=function(F){const M=this.state.contentCamera;var K=M.getRenderCenter(q.createRenderScreenPointArray3());K[1]=M.aboveGround?M.padding[w.PaddingSide.BOTTOM]:
M.fullHeight-M.padding[w.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(K,F))return F;const G=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return M.unprojectFromRenderScreen(K,A)&&(h.subtract(A,A,M.eye),K=h.normalize(A,A),this.renderCoordsHelper.intersectManifold(l.wrap(M.eye,K),G,F))?F:this.renderCoordsHelper.setAltitude(F,G,M.eye)};E.updateRenderLocation=function(){this._dirty=!0};b._createClass(C,[{key:"updating",get:function(){return this._dirty||
this.centerOnSurface.updating}},{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"running",get:function(){return this._dirty}}]);return C}(t.PointOfInterest);c.__decorate([k.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([k.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([k.property({constructOnly:!0})],a.Focus.prototype,
"centerOnSurface",void 0);c.__decorate([k.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([k.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([k.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([k.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([e.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const D=z.create(),A=z.create(),v=
z.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){a.StableSurfaceCenter=function(l){function m(w){w=l.call(this,w)||this;w.location=null;w._updateController=null;w._handles=new p;return w}b._inherits(m,l);var t=m.prototype;t.initialize=function(){this.view.state.isLocal&&(this._handles.add([q.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),q.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())};t.destroy=function(){this._handles.destroy()};t._update=
function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&null!=this.surfaceView.extent&&null!=this.surfaceView.spatialReference){var w=n.center(this.surfaceView.extent);w=new z({x:w[0],y:w[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(w,{noDataValue:0,signal:this._updateController.signal,
cache:this.cache}).then(r=>{this._updateController=null;this._set("location",r.geometry)}).catch(r=>{u.isAbortError(r)||r&&"elevation-query:invalid-layer"===r.name||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",w)}else this._set("location",null)};b._createClass(m,[{key:"surface",get:function(){return this.view.map?.ground}},{key:"surfaceView",get:function(){return this.view.basemapTerrain}},{key:"renderLocation",get:function(){if(!this.location)return null;const w=
h.create();this.view.renderCoordsHelper.toRenderCoords(this.location,w);return w}}]);return m}(y);c.__decorate([k.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([k.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([k.property()],a.StableSurfaceCenter.prototype,"surface",null);c.__decorate([k.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);c.__decorate([k.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);c.__decorate([k.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.SurfaceGeometryUpdates=function(t){function w(x){x=t.call(this,x)||this;x._tileGeometryUpdateExtent=e.empty();x._tileGeometryUpdateSpatialReference=null;x.events=new p;x.updating=!1;return x}b._inherits(w,t);var r=w.prototype;r.initialize=function(){this.addHandles([this.surface.on("elevation-change",x=>this._tileGeometryChanged(x)),this.scheduler.registerTask(h.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};r.runTask=function(){if(!this.updating)return h.Task.YIELD;
this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",z);e.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return h.Task.YIELD};r._tileGeometryChanged=function(x){this._tileGeometryUpdateSpatialReference=x.spatialReference;e.expand(this._tileGeometryUpdateExtent,x.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};r._furthestCenterOnSurface=function(){let x=
this.centerOnSurfaces[0];for(let D=1;D<this.centerOnSurfaces.length;D++){const A=this.centerOnSurfaces[D];A.distance>x.distance&&(x=A)}return x};r._centerIntersectsExtent=function(x,D){const A=this.state.contentCamera.eye,v=m,B=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(A,n,D);this.renderCoordsHelper.fromRenderCoords(B.renderLocation,l,D);n[0]<l[0]?(v[0]=n[0],v[2]=l[0]):(v[0]=l[0],v[2]=n[0]);n[1]<l[1]?(v[1]=n[1],v[3]=l[1]):(v[1]=l[1],v[3]=n[1]);return e.intersects(v,
x)};b._createClass(w,[{key:"running",get:function(){return this.updating}}]);return w}(y);c.__decorate([u.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([u.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([u.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([u.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([u.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([u.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([f.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const z={},n=g.create(),l=g.create(),m=e.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa,ba,aa,da,ca,na,qa,ua,sa,pa,ka,ra,va,Ca,Ba){function Ha(eb,ib){return eb[0]===ib[0]&&eb[1]===ib[1]&&eb[2]===ib[2]}function Ma(eb){eb=eb.children;if(!eb[0])return!1;for(const ib of eb)if(ib.shouldLoad)return!0;for(const ib of eb)if(Ma(ib))return!0;return!1}function Qa(eb,ib,Pa){for(const za of eb)if(za.containsPointXY(ib,Pa)){for(eb=za;eb&&!eb.renderData;)eb=eb.children[(ib>
eb.extentMidX?1:0)+(Pa<eb.extentMidY?2:0)];return V.sampleElevation(ib,Pa,eb?.renderData?.geometryState.samplerData??null)}return null}p=function(eb){function ib(za){var Ga=eb.call(this,za)||this;Ga._scaleRangeQueries=new ia.ScaleRangeQueries;Ga._iteratorPool=new h(ua.IteratorPreorder,Fa=>Fa.remove=()=>Ga._iteratorPool.release(Fa));Ga._postorderIterator=new ua.IteratorPostorder;Ga._hasPendingUpdates=!1;Ga._pendingUpdates=0;Ga._asyncWorkItems=0;Ga._allTilesDirty=!0;Ga._allTilesSorted=!0;Ga._visibleCached=
!1;Ga._usedMemory=null;Ga._performanceInfo=new aa;Ga._viewChanged=!1;Ga._inFrameTask=!1;Ga._viewChangeUpdateDirty=!1;Ga._eyePosRenderSR=v.create();Ga._eyePosSurfaceSR=v.create();Ga._splitLimits=new ma.SplitLimits;Ga._frustum=G.create();Ga._viewProjectionMatrix=D.create();Ga._layerViews=[[],[]];Ga._layerIndexByUid=[new Map,new Map];Ga._basemapLayerViewHandles=new Map;Ga._handles=new d;Ga._watchUpdatingTracking=new C.WatchUpdatingTracking;Ga._frameTask=Ba.ImmediateTask;Ga._allTiles=new z;Ga._upsampleInfoPool=
new h(pa.UpsampleInfo);Ga._rootTilesExtent=K.create();Ga.updatingProgress=.5;Ga._maxNumUpdating=1;Ga.maxTextureScale=1.2;Ga._spatialReference=M.WebMercator;Ga.visibleElevationBounds=new U.ElevationBounds(Infinity,-Infinity);Ga.rootTileElevationBounds=new U.ElevationBounds(Infinity,-Infinity);Ga._updatingRootTiles=!1;Ga._pendingTilesForElevationUpdateEvent=new Set;Ga._pendingTilesToUpdate=new Set;Ga.totalGeometryUpdates=0;Ga.totalTileUpdates=0;Ga.oneBatchPerFrameTask=!0;Ga._layerViewsDirty=!1;Ga.unloadedMemory=
0;Ga.ignoresMemoryFactor=!1;Ga._isWebMercator=!1;Ga._isWebMercatorOnPlateeCarree=!1;Ga.overlayManager=new ea.OverlayManager({...za,surface:b._assertThisInitialized(Ga)});Ga._isGlobal=!za.view?.state?.isLocal;return Ga}b._inherits(ib,eb);var Pa=ib.prototype;Pa.initialize=function(){this._lercDecoder=N.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new h(ja.PlanarPatch):new h(oa.SphericalPatch);var za=this.view.resourceController.memoryController;this._upsampleMapCache=
za.newCache("terrain-upsample",Fa=>Fa.unloadMapData());this._elevationQueryCache=new I.ElevationQueryTileCache(za.newCache("elevation-query"));this._handles.add([l.watch(()=>this.overlayManager.hasHighlights,Fa=>this._renderer.setNeedsHighlight(Fa)),l.watch(()=>this.overlayManager.rendersOccluded,Fa=>this._renderer.setRenderOccludedOverlay(Fa)),l.watch(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager");this._renderer=new ba.TerrainRenderer({_overlayRenderer:this.overlayManager.renderer,
_ellipsoidRadius:E.getReferenceEllipsoid(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles});this._handles.add([l.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?Y.TextureUpdate.UNFADED:Y.TextureUpdate.IMMEDIATE)},l.syncAndInitial),l.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Y.TextureUpdate.UNFADED:Y.TextureUpdate.IMMEDIATE),l.syncAndInitial),
l.watch(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),l.sync),l.watch(()=>this.backgroundColor,Fa=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(Fa)},l.syncAndInitial),l.watch(()=>this.snapLevel,()=>this._viewChanged=!0,l.sync),l.watch(()=>this.view.pointsOfInterest,Fa=>{this._renderer.pointsOfInterest=Fa;this._watchUpdatingTracking.removeAll();Fa&&this._watchUpdatingTracking.add(()=>Fa.focus.renderLocation,
()=>this._allTilesSorted=!1)}),l.watch(()=>T.TERRAIN_TILE_TREE_SHOW_TILES,Fa=>{Fa&&!this._treeDebugger?(new Promise((xa,ya)=>a(["../layers/support/TerrainTileTree3DDebugger"],xa,ya))).then(({TerrainTileTree3DDebugger:xa})=>{!this._treeDebugger&&T.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new xa({view:this.view}))}):Fa||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},l.initial)]);({spatialReference:za}=this.view);this._extentHelper=X.create(this.viewingMode,{layers:this.view.map.allLayers,
layerViews:this.view.allLayerViews,viewSpatialReference:za});const Ga=new q({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:Fa})=>Fa),getChildrenFunction:Fa=>Fa&&"layers"in Fa?Fa.layers:null});za=new sa.TilingSchemeLogic({layers:Ga,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:za});this._set("tilingSchemeLogic",za);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.ELEVATION);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(Ba.TaskPriority.TERRAIN_SURFACE,this);this._handles.add([l.watch(()=>this._extentHelper.stencilEnabledExtents,Fa=>this._renderer.setStencilEnabledLayerExtents(Fa),l.initial),l.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),l.sync),l.watch(()=>this.extent,()=>this._updateRootTiles(),l.initial),this.view.on("resize",
()=>this._viewChangeUpdate()),l.watch(()=>{const Fa=this.view,xa=Fa.state;return[this._lodBias,this.lodSnapping,Fa.resourceController?.memoryController?.memoryFactor,xa.camera,xa.contentCamera,xa.fixedContentCamera]},()=>this._viewChangeUpdate(),l.syncAndInitial),l.watch(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,Fa=>this._renderer.textureFadingEnabled=0<Fa,l.initial),l.watch(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,Fa=>this._renderer.pbrMode=Fa?ra.PBRMode.Terrain:
ra.PBRMode.Disabled,l.initial),l.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),l.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};Pa.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);
this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((za,Ga)=>this._unregisterTiledLayerView(Ga));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tilePool=e.destroyMaybe(this._tilePool);ca.Tile.prune();this._treeDebugger=e.destroyMaybe(this._treeDebugger);this._renderer=e.destroyMaybe(this._renderer);
this._iteratorPool=e.destroyMaybe(this._iteratorPool);this._set("view",null);this._extentHelper=e.destroyMaybe(this._extentHelper);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);R.printAllocations();na.printAllocations()};Pa.intersect=function(za,Ga,Fa,xa){this._renderer.intersect(za,Ga,Fa,xa)};Pa.getElevation=function(za,Ga,Fa,xa){const ya=this._rootTiles;if(null==ya||!ya.length||0===ya[0].layerInfo[Z.LayerClass.ELEVATION].length)return null;const Ea=Sa;Ea[0]=za;Ea[1]=Ga;Ea[2]=Fa;
return F.projectVectorToVector(Ea,xa,Ea,this._spatialReference)?Qa(ya,Ea[0],Ea[1]):(f.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)};Pa.getElevations=function(za,Ga,Fa){const xa=this._rootTiles;var ya=xa?xa[0].layerInfo[Z.LayerClass.ELEVATION].length:0;if(null!=xa&&xa.length&&0!==ya)for(ya=0;ya<Ga;++ya){var Ea=3*ya;Ea=Qa(xa,za[Ea],za[Ea+1]);Fa(ya,Ea)}else for(za=0;za<Ga;++za)Fa(za,null)};Pa.getScale=function(za){if(!this.tilingScheme)return null;
if(!F.projectPointToVector(za,Sa,this.spatialReference))return f.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;za=this._rootTiles;if(null!=za)for(var Ga of za)if(Ga?.containsPoint(Sa)){for(;Ga.children[0]&&!Ga.rendered;){za=Ga.children[0].extent;let Fa=0;Sa[0]>za[2]&&(Fa+=1);Sa[1]<za[1]&&(Fa+=2);Ga=Ga.children[Fa]}return this._getLodBiasCorrectedScale(Ga.level)}return Infinity};Pa.getSphereElevationBounds=function(za,Ga){Sa[0]=
za[0];Sa[1]=za[1];Sa[2]=za[2];Sa[3]=za[3];if(!F.projectVectorToVector(Sa,Ga,Sa,this.tilingScheme?.spatialReference))return f.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let Fa=Infinity,xa=-Infinity;const ya=Ea=>{if(Ea&&K.intersectsSphere(Ea.extent,Sa))if(Ea.isLeaf||Ea.rendered)Fa=Math.min(Fa,Ea.elevationBounds[0]),xa=Math.max(xa,Ea.elevationBounds[1]);else for(const Oa of Ea.children)ya(Oa)};za=this._rootTiles;
if(null!=za)for(const Ea of za)ya(Ea);return{min:Fa,max:xa}};Pa.getSphereScale=function(za,Ga){if(!this.tilingScheme)return null;if(!F.projectPointToVector(za,Sa,this.spatialReference))return f.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Sa[3]=Ga;let Fa=null;const xa=ya=>{if(ya&&K.intersectsSphere(ya.extent,Sa)){const Ea=ya.children;if(Ea[0]&&!ya.rendered)for(const Oa of Ea)xa(Oa);else ya=this._getLodBiasCorrectedScale(ya.level),
Fa=null==Fa?ya:Math.min(Fa,ya)}};za=this._rootTiles;if(null!=za)for(const ya of za)xa(ya);return Fa};Pa.queryVisibleScaleRange=function(za,Ga,Fa,xa){Ga=Ga?this.tilingScheme.levelAtScale(Ga):0;Fa=Fa?this.tilingScheme.levelAtScale(Fa):Infinity;const ya=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(za,Ga+ya,Fa+ya,xa)};Pa._evaluateTransparency=function(){var za=this.baseOpacity;const Ga=this.overlayManager.renderer.isEmpty;var Fa=this._renderer.transparency;za=this._allSurfaceLayersTransparent()?
Ga?ba.TransparencyMode.Empty:ba.TransparencyMode.TransparentWithDraped:1<=za&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ba.TransparencyMode.Opaque:ba.TransparencyMode.Semitransparent;if(Fa=Fa!==za)this._renderer.transparency=za,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});return Fa};Pa._updateTilingScheme=function(){const za=this.tilingSchemeLogic.tilingScheme;if(za!==this.tilingScheme){da.weakAssert(!!za,"tiling scheme cannot be reset to undefined");
this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var Ga=za?.spatialReference??M.WebMercator;this._spatialReference=Ga;this._isWebMercatorOnPlateeCarree=(this._isWebMercator=!!Ga?.isWebMercator)&&L.isPlateCarree(this.view?.renderSpatialReference);this._set("tilingScheme",za);this._updateClippingExtent();za&&(this._updateTiledLayers(),this._renderer.setTileSize(za.pixelSize),this.overlayManager.setSpatialReference(za.spatialReference),this._updateRootTiles())}};Pa._acquireTile=
function(za,Ga,Fa,xa){const ya=this._tilePool.acquire();Ua[0]=za;Ua[1]=Ga;Ua[2]=Fa;ya.init(Ua,xa,this);return ya};Pa._updateRootTiles=function(){const {extent:za,tilingScheme:Ga}=this;if(Ga){var Fa=La,xa=Ga.rootTilesInExtent(za,Fa,5*fa.MAX_ROOT_TILES);if(null!=this._rootTiles){if(xa.length>fa.MAX_ROOT_TILES){f.getLogger(this).warn(fa.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const ya=this._rootTiles.map(Oa=>Oa.lij),Ea=u.difference(ya,xa,Ha);this._updatingRootTiles=!0;if(0<Ea.removed.length||
0<Ea.added.length){const Oa=this._rootTiles.filter(bb=>-1<Ea.removed.findIndex(db=>Ha(db,bb.lij))?(this._purgeTile(bb),!1):!0);Ea.added.forEach(bb=>Oa.push(this._newRootTile(bb)));this._setRootTiles(Oa)}}else this._updatingRootTiles=!0,xa.length>fa.MAX_ROOT_TILES&&(f.getLogger(this).warn(fa.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),xa=Ga.rootTilesInExtent(za,Fa,fa.MAX_ROOT_TILES)),this._setRootTiles(xa.map(ya=>this._newRootTile(ya)));K.equals(Fa,this._rootTilesExtent)||(this._rootTilesExtent=K.create(Fa));
this._visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}};Pa._updateAllTileGeometries=function(){const za=this._allTiles.filter(Ga=>Ga.isLoaded&&Ga.intersectsClippingArea);za.forEach(Ga=>this._renderer.updateTileGeometryState(Ga));za.forEach(Ga=>Ga.renderData.updateNeighborData());this._updateTilesGeometries(za);this._pendingTilesToUpdate.clear()};Pa._updateTilesGeometries=
function(za){if(0!==za.length){za.sort(ua.compareTilesByLij);var Ga=this.renderer;za.forEach(Fa=>Ga.updateGeometryIfNeeded(Fa));za.forEach(Fa=>this._pendingTilesForElevationUpdateEvent.add(Fa))}};Pa._shouldSplit=function(za){return za.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===qa.TileUpdate.SPLIT};Pa._newRootTile=function(za){za=this._acquireTile(0,za[1],za[2],null);this._shouldSplit(za)&&za.setPendingUpdate(qa.TileUpdate.SPLIT);this._loadTile(za);this._markTileToUpdate(za);
this._updateRootTileElevationBounds();return za};Pa._setRootTiles=function(za){this._rootTiles=za;this._allTiles.clear();if(null!=za){const Ga=this._iteratorPool.acquire();for(Ga.reset(za);!Ga.done;)this._allTiles.push(Ga.next());Ga.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(za)};Pa._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Pa._viewChangeUpdate=function(){this.view&&!this.suspended&&
this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))};Pa._updateClippingStatus=function(za){za.updateClippingStatus(this.extent)&&za.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(za)};Pa._updateTilesVisibility=function(za){if(null!=za){var Ga=ua.hasLoadableSiblings(za),Fa=this.visibleElevationBounds,xa=Ga?Fa.min:Infinity;
Ga=Ga?Fa.max:-Infinity;var ya=this.extent,Ea=this._viewProjectionMatrix;this.setTileTreeDirty();var Oa=this._iteratorPool.acquire();for(Oa.reset(za);!Oa.done;)za=Oa.next(),za.updateClippingStatus(ya)&&za.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(za),za.setPendingUpdate(qa.TileUpdate.RENDERDATA),za.computeVisibility(),za.updateScreenDepth(Ea),za.renderData&&(xa=Math.min(za.elevationBounds[0],xa),Ga=Math.max(za.elevationBounds[1],Ga));Oa.remove();this._allTilesDirty=
this._viewChanged=!0;this._batchUpdatePendingTileGeometries();isFinite(xa)&&isFinite(Ga)&&(Fa.min!==xa||Fa.max!==Ga)&&(this.visibleElevationBounds=new U.ElevationBounds(xa,Ga))}};Pa._updateRootTileElevationBounds=function(){let za=Infinity,Ga=-Infinity;var Fa=this._rootTiles;null!=Fa&&Fa.forEach(({elevationBounds:xa})=>{za=Math.min(za,xa[0]);Ga=Math.max(Ga,xa[1])});Fa=this.rootTileElevationBounds;if(Fa.min!==za||Fa.max!==Ga)this.rootTileElevationBounds=new U.ElevationBounds(za,Ga)};Pa._updateViewDependentParameters=
function(){const {camera:za,contentCamera:Ga}=this.view.state,Fa=Math.tan(.5*Ga.fovX),xa=Math.tan(.5*Ga.fovY),ya=this.tilingScheme.pixelSize,Ea=2**-this._lodBias*za.pixelRatio;this._splitLimits.aboveGround=za.aboveGround;this._splitLimits.fovX=Fa;this._splitLimits.fovY=xa;this._splitLimits.relativeWidthLimit=ya/za.width*this.maxTextureScale*Ea;this._splitLimits.relativeHeightLimit=ya/za.height*this.maxTextureScale*Ea;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=
this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(null==this._splitLimits.frustum&&(this._splitLimits.frustum=G.create()),G.copy(this._splitLimits.frustum,Ga.frustum)):this._splitLimits.frustum=null;G.copy(this._frustum,za.frustum);x.multiply(this._viewProjectionMatrix,Ga.projectionMatrix,Ga.viewMatrix);A.copy(this._eyePosRenderSR,Ga.eye);F.projectVectorToVector(za.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Pa._updateRenderData=
function(za){za.rendered&&!za.shouldLoad&&(Ma(za)?this._loadChildren(za):za.isLeaf&&(za.parent?.shouldLoad??!1)&&this._loadParent(za))};Pa._updateTileGeometryState=function(za){za.updateVisibility();this._renderer.updateTileGeometryState(za)&&this._markTileToUpdate(za);this._usedMemory=null};Pa._markAllTileNeighborsForGeometryUpdate=function(za){const Ga=this._pendingTilesToUpdate;za.forEachLoadedNeighbor(Fa=>{Ga.add(Fa)})};Pa._updateTileTexture=function(za,Ga){const Fa=za.resetPendingUpdate(qa.TileUpdate.TEXTURE_FADING)?
qa.TileUpdate.TEXTURE_FADING:za.resetPendingUpdate(qa.TileUpdate.TEXTURE_NOFADING)?qa.TileUpdate.TEXTURE_NOFADING:!1;Fa&&(this._renderer.updateTileTexture(za,Fa),this._usedMemory=null,Ga.madeProgress())};Pa._emitElevationUpdateEventForTiles=function(){const za=cb.extent;K.empty(za);this._pendingTilesForElevationUpdateEvent.forEach(Ga=>K.expand(za,Ga.extent,za));this._pendingTilesForElevationUpdateEvent.clear();cb.spatialReference=this.spatialReference;this.emit("elevation-change",cb)};Pa.runTask=
function(za){this._handleLayerViewChanges(za);this._frameTask.processQueue(za);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,za);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(za);this._sortTiles(za);const Ga=!this.view.state.fixedContentCamera;this._mergeAndSplit(za,Ga);this._updateElevation(za);this._updateTextures(za);Ga||this._mergeAndSplit(za,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._batchUpdatePendingTileGeometries();
this._emitElevationUpdateEventForTiles();za.done&&za.hasProgressed&&this.requestUpdate();this.notifyChange("updatingProgressValue")};Pa._updateAllTilesStatus=function(za){if(this._viewChanged&&this._rootTiles&&!za.done){this._viewChanged=!1;var Ga=this._iteratorPool.acquire();Ga.reset(this._rootTiles);for(var Fa=this.snapLevel,xa=this._splitLimits,ya=this._eyePosRenderSR;!Ga.done;){var Ea=Ga.next(),Oa=Ea.shouldSplit(xa,ya,Fa);if(Oa===qa.TileUpdate.SPLIT)Ea.resetPendingUpdate(qa.TileUpdate.MERGE),
Ea.isLeaf&&(Ea.setPendingUpdate(qa.TileUpdate.SPLIT),Ga.skipSubtree()),Ea.rendered&&Ea.setPendingUpdate(qa.TileUpdate.RENDERDATA);else if(Ea.resetPendingUpdate(qa.TileUpdate.SPLIT)&&Ea.updateAgentSuspension(),Oa===qa.TileUpdate.ELEVATION&&Ea.updateAgents(Z.LayerClass.ELEVATION),Ga.skipSubtree(),!Ea.isLeaf){Ea.setPendingUpdate(qa.TileUpdate.MERGE);Ea.resetPendingUpdate(qa.TileUpdate.SPLIT);Oa=this._iteratorPool.acquire();Oa.resetOne(Ea);Ea=this._viewProjectionMatrix;for(let bb=Oa.next();!Oa.done;bb=
Oa.next())this._updateClippingStatus(bb),bb.updateVisibility(),bb.updateScreenDepth(Ea);Oa.remove()}}Ga.remove();this.requestUpdate();!this.shortBatches&&this.oneBatchPerFrameTask||this._batchUpdatePendingTileGeometries();za.madeProgress()}};Pa._sortTiles=function(za){za.done||this._allTilesSorted||(ua.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),za.madeProgress())};Pa._markTileToUpdate=function(za){da.internalAssert(za.isLoaded);
za.intersectsClippingArea&&(this._pendingTilesToUpdate.add(za),this._markAllTileNeighborsForGeometryUpdate(za))};Pa._batchUpdatePendingTileGeometries=function(){const za=this._pendingTilesToUpdate;if(0!==za.size){var Ga=Array.from(this._pendingTilesToUpdate.keys()).filter(ya=>ya.isLoaded&&ya.intersectsClippingArea),Fa=(ya,Ea)=>{!Ea?.isLoaded||!Ea.intersectsClippingArea||Ea.level<ya.level||za.has(Ea)||(za.add(Ea),Ga.push(Ea),Ea.renderData.updateNeighborData())};Ga.sort(ua.compareTilesByLij);var xa=
Ga.length;for(let ya=0;ya<xa;++ya){const Ea=Ga[ya];da.internalAssert(Ea.isLoaded);da.internalAssert(Ea.intersectsClippingArea);const Oa=Ea.renderData;Oa.updateNeighborData();const bb=Oa._dirtyEdgeResolutions,db=Oa.geometryState.neighborData.cornerPeerNeighbors,nb=kb=>{const wb=da.neighborCornerIndices[kb];Fa(Ea,db[kb]?.findCorner(da.oppositeCorner(wb),vb=>vb.isLoaded))};for(let kb=0;4>kb;++kb)if(bb&1<<kb){const wb=Oa.geometryState.neighborData.edgePeerNeighbors[kb];wb&&wb?.level>=Ea.level&&wb.forAllSubtreeOnSide(da.oppositeEdge(da.neighborEdgeIndices[kb]),
vb=>vb.isLoaded&&vb.intersectsClippingArea?(da.internalAssert(za.has(vb)||0>ua.compareTilesByLij(Ea,vb)),Fa(Ea,vb),!0):!1);nb((kb+1)%4);nb(kb)}}za.clear();this._updateTilesGeometries(Ga);da.ENABLE_TERRAIN_INTERNAL_CHECKS&&da.ENABLE_WATERPROOFNESS_TESTS&&this.checkAllTilesWaterproofness()}};Pa._mergeAndSplit=function(za,Ga){if(!this.suspended&&!za.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Fa=!1,xa=this.view.state.fixedContentCamera,ya=!1;!za.done;){ya=!0;let Ea=
!1;const Oa=!this._allTiles.some(bb=>{if(!Fa&&!xa&&!bb.visible)return za.done;let db=bb;if(bb.resetPendingUpdate(qa.TileUpdate.MERGE)){if(!Ga)return bb.setPendingUpdate(qa.TileUpdate.MERGE),za.done;for(;db.parent?.resetPendingUpdate(qa.TileUpdate.MERGE);)db=db.parent;this._mergeTile(db);Ea=!0;za.madeProgress()}else bb.resetPendingUpdate(qa.TileUpdate.SPLIT)&&(this._splitTile(bb),Ea=!0,za.madeProgress());!za.done&&db===bb&&bb.resetPendingUpdate(qa.TileUpdate.RENDERDATA)&&(this._updateRenderData(bb),
za.madeProgress());return za.done});Ea&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Oa)if(!Fa)Fa=!0;else{if(!Ea)break}else this._allTilesDirty=!0}ya?za.madeProgress():this._allTilesDirty=!0;!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries();this._sortTiles(za)}};Pa._updateElevation=function(za){za.done||(this._allTiles.some(Ga=>{Ga.resetPendingUpdate(qa.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Ga),this._updateTileTexture(Ga,za),this.shortBatches&&this._batchUpdatePendingTileGeometries(),
za.madeProgress());return za.done}),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())};Pa._updateTextures=function(za){za.done||this._allTiles.some(Ga=>{this._updateTileTexture(Ga,za);return za.done})};Pa._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(va.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Pa._getLodBiasCorrectedScale=function(za){const Ga=this.tilingScheme.levels;za=g.clamp(za-this._lodBias,
0,Ga.length-1);const Fa=za-Math.floor(za);return Ga[Math.floor(za)].scale*(1-Fa)+Ga[Math.ceil(za)].scale*Fa};Pa._removeAllTiles=function(){null!=this._rootTiles&&(this._rootTiles.forEach(za=>this._purgeTile(za)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this._visible=!1};Pa._purgeDescendantTiles=function(za){if(!za.children[0])return!1;let Ga=!1;for(let Fa=0;4>Fa;++Fa)Ga=this._purgeTile(za.children[Fa])||Ga;za.unsetChildren();return Ga};Pa._purgeTile=function(za){const Ga=
this._purgeDescendantTiles(za)||za.rendered;this._allTiles.removeUnordered(za);this._unloadTile(za);this._tilePool.release(za);return Ga};Pa._unloadTile=function(za){this._pendingTilesToUpdate.delete(za);this._pendingTilesForElevationUpdateEvent.delete(za);za.unload(this._renderer)};Pa._splitTile=function(za){da.weakAssert(za.isLeaf,"tile that is already split should not be split again!");const Ga=za.level+1,Fa=2*za.lij[1],xa=2*za.lij[2];za.setChildren(this._createTile(Ga,Fa,xa,za),this._createTile(Ga,
Fa,xa+1,za),this._createTile(Ga,Fa+1,xa,za),this._createTile(Ga,Fa+1,xa+1,za));za.setPendingUpdate(qa.TileUpdate.RENDERDATA);za.updateAgentSuspension();this._allTiles.pushArray(za.children);this._allTilesDirty=!0;++this._performanceInfo.numSplit};Pa._emitTileScaleChange=function(za,Ga=za.level){la.spatialReference=this.spatialReference;la.extent=za.extent;la.scale=this._getLodBiasCorrectedScale(Ga);this.emit("scale-change",la)};Pa._createTile=function(za,Ga,Fa,xa){da.weakAssert(!!xa,"_createTile sanity check");
za=this._acquireTile(za,Ga,Fa,xa);za.updateClippingStatus(this.extent);za.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(za)&&za.setPendingUpdate(qa.TileUpdate.SPLIT);return za};Pa._mergeTile=function(za){da.weakAssert(!za.hasPendingUpdate(qa.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(za)&&(da.weakAssert(!za.renderData,"_mergeTile sanity check"),this._loadTile(za),this._markTileToUpdate(za),this._emitTileScaleChange(za),this.shortBatches&&this._batchUpdatePendingTileGeometries());
this._allTilesDirty=!0;++this._performanceInfo.numMerged};Pa._loadChildren=function(za){da.weakAssert(za.rendered,"parent should be rendered");this._unloadTile(za);const Ga=za.children;Ga.forEach(Fa=>this._loadTile(Fa));Ga.forEach(Fa=>this._pendingTilesToUpdate.add(Fa));this._markAllTileNeighborsForGeometryUpdate(za);this._emitTileScaleChange(za,za.level+1);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Pa._loadParent=function(za){za=za.parent;this._unloadChildren(za);this._loadTile(za);
this._markTileToUpdate(za);this._emitTileScaleChange(za,za.level);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Pa._unloadChildren=function(za){za=za.children;if(za[0])for(let Ga=0;4>Ga;++Ga){const Fa=za[Ga];this._unloadChildren(Fa);this._unloadTile(Fa)}};Pa._loadTile=function(za){za.load();za.setPendingUpdate(qa.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(za)};Pa._elevationDataArrived=
function(za,Ga,Fa){Fa=new V.ElevationData(za.lij,za.extent,Fa);za.dataArrived(Ga,Z.LayerClass.ELEVATION,Fa);Fa=[za];za=za.level;const xa=this._iteratorPool.acquire();for(xa.reset(Fa);!xa.done;){const ya=xa.next();ya.findElevationBoundsForLayer(Ga,za);ya.computeElevationBounds()}0===za&&this._updateRootTileElevationBounds();xa.remove();this._updateTilesVisibility(Fa)};Pa._handleLayerViewChanges=function(za=Ba.noBudget){if(this._layerViewsDirty){var Ga=this._layerViewsDirty=!1,Fa=new Set,xa=-1;for(const Ea of this.view.allLayerViews.items)if(Fa.add(Ea.uid),
da.isSurfaceLayerView(Ea)||da.isGroupLayerView(Ea))if(this._basemapLayerViewHandles.has(Ea.uid)&&!da.isGroupLayerView(Ea)){var ya=this._layerClassFromLayerView(Ea);ya=this._getLayerIdxByUID(ya,Ea.uid);if(null!=ya){if(ya<xa||null==xa)Ga=!0;xa=ya}}else this._registerTiledLayerView(Ea),Ea.layer.loaded&&(Ga=!0);this._basemapLayerViewHandles.forEach((Ea,Oa)=>{Fa.has(Oa)||(this._unregisterTiledLayerView(Oa),Ga=!0)});Ga&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();
this._evaluateTransparency();za.madeProgress()}};Pa._allSurfaceLayersTransparent=function(){let za=0===this.view.map?.ground?.opacity;for(const Ga of this.view.allLayerViews.items)if(da.isMapTileLayerView(Ga)&&!J.isBaseLayer(Ga.layer)&&0!==Ga.fullOpacity){za=!1;break}return za};Pa._hasCompositeBlendMode=function(){for(const za of this.view.allLayerViews.items)if((da.isBlendableLayerView(za)||da.isGroupLayerView(za))&&ka.isCompositeBlendMode(ka.blendModeFromString[za.layer.blendMode]))return!0;return!1};
Pa._layerClassFromLayerView=function(za){return da.isElevationLayerView(za)?Z.LayerClass.ELEVATION:Z.LayerClass.MAP};Pa._registerTiledLayerView=function(za){const Ga=[];(da.isBlendableLayerView(za)||da.isGroupLayerView(za))&&Ga.push(l.watch(()=>za.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(Y.TextureUpdate.UNFADED)}));if(!da.isGroupLayerView(za)){const Fa=this._layerClassFromLayerView(za);Ga.push(l.watch(()=>za.suspended,()=>this._updateTiledLayers()));
Ga.push(l.watch(()=>za.fullOpacity,()=>this._updateTileTextures(Y.TextureUpdate.UNFADED)));Ga.push(l.watch(()=>"effectiveScaleRange"in za.layer?za.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Fa)));Ga.push(za.on("data-changed",()=>{const xa=this._getLayerIdxByUID(Fa,za.uid);null!=xa&&this._invalidateLayerData(xa,Fa)}))}this._unregisterTiledLayerView(za.uid);this._basemapLayerViewHandles.set(za.uid,Ga)};Pa._unregisterTiledLayerView=function(za){const Ga=this._basemapLayerViewHandles.get(za);
if(Ga){for(const Fa of Ga)Fa.remove();this._basemapLayerViewHandles.delete(za)}};Pa._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var za=[[],[]],Ga=null;this.view.allLayerViews.forEach(xa=>{if(xa.layer&&!xa.suspended&&da.isSurfaceLayerView(xa)&&xa.fullExtent){var ya=this._layerClassFromLayerView(xa);if(ya===Z.LayerClass.MAP){const Ea=xa.displayLevelRange.maxLevel;Infinity!==Ea&&(null===Ga||Ea>Ga)&&(Ga=Ea)}za[ya].push(xa)}});for(const xa of Z.LayerClasses){var Fa=this._layerViews[xa];
const ya=za[xa];ya.reverse();const Ea=ya.length;let Oa=Fa.length!==Ea;const bb=Array(Ea),db=Array(Fa.length);this._layerIndexByUid[xa].clear();for(let nb=0;nb<Ea;nb++){this._layerIndexByUid[xa].set(ya[nb].uid,nb);const kb=Fa.indexOf(ya[nb]);bb[nb]=kb;nb!==kb&&(Oa=!0);-1<kb&&(db[kb]=nb)}if(Oa){Fa=this._postorderIterator;for(Fa.reset(this._rootTiles);!Fa.done;)Fa.next().modifyLayers(db,bb,xa);this._layerViews[xa]=ya;this._restartAllAgents(xa);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(Ga)&&
this._viewChangeUpdate()}};Pa._restartAllAgents=function(za){const Ga=this._postorderIterator;for(Ga.reset(this._rootTiles);!Ga.done;){const Fa=Ga.next();Fa.restartAgents(za);za===Z.LayerClass.ELEVATION&&Fa.computeElevationBounds()}this._updateRootTileElevationBounds()};Pa.layerViewByIndex=function(za,Ga){return this._layerViews[Ga][za]};Pa.numLayers=function(za){return this._layerViews[za].length};Pa._updateTileTextures=function(za){this._allTiles.forAll(Ga=>{Ga.updateAgents(Z.LayerClass.MAP);za===
Y.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ga,qa.TileUpdate.TEXTURE_NOFADING):Ga.updateRenderData(Z.LayerClass.MAP,za)});this._evaluateTransparency()};Pa._invalidateLayerData=function(za,Ga){this._allTiles.forAll(Fa=>Fa.removeLayerAgent(za,Ga));this._allTiles.forAll(Fa=>Fa.invalidateLayerData(za,Ga))};Pa.setTileTreeDirty=function(){this._allTilesDirty=!0};Pa.requestRender=function(za=va.RenderRequestType.UPDATE){this.renderer.setNeedsRender(za)};Pa.requestUpdate=function(){1===++this._pendingUpdates&&
(this._hasPendingUpdates=!0)};Pa.requestTileData=function(za,Ga,Fa,xa){const ya=this.layerViewByIndex(Ga,Fa);Ga=ya.layer;if(!Ga.tilemapCache||da.isVectorTileLayerView(ya))return this._requestTileData(za,Fa,ya,xa);++this._asyncWorkItems;return Ga.tilemapCache.fetchAvailability(za.lij[0],za.lij[1],za.lij[2],{...xa,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ea=>{--this._asyncWorkItems;n.throwIfAborted(xa);n.isAbortError(Ea)||this._dataMissing(za,Fa,ya,{notInTilemap:!0});throw Ea;}).then(()=>
this._frameTask.schedule(()=>this._requestTileData(za,Fa,ya,xa),xa.signal))};Pa._requestTileData=function(za,Ga,Fa,xa){return Ga===Z.LayerClass.ELEVATION?da.isElevationLayerView(Fa)?this._requestElevationTileData(za,Fa,xa):Promise.reject():da.isMapTileLayerView(Fa)?this._requestMapTileData(za,Fa,xa):Promise.reject()};Pa._requestElevationTileData=function(za,Ga,Fa){++this._asyncWorkItems;const xa=Oa=>{if(!n.isAborted(Fa)){var bb=this._layerIndexByUid[Z.LayerClass.ELEVATION].get(Ga.uid);null==bb?f.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",
Z.LayerClass.ELEVATION,za.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(za,bb,Oa))}},ya=Oa=>{n.isAbortError(Oa)||(this._dataMissing(za,Z.LayerClass.ELEVATION,Ga,Oa),this.requestUpdate())};if(da.useFetchTileForLayer(Ga.layer))return Ga.layer.fetchTile(za.lij[0],za.lij[1],za.lij[2],{noDataValue:fa.ELEVATION_NODATA_VALUE,signal:Fa.signal}).then(Oa=>{if(n.isAborted(Fa))f.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");
else return this._frameTask.schedule(()=>xa(Oa),Fa.signal,ya)},ya).finally(()=>{--this._asyncWorkItems});const Ea=Ga.getTileUrl(za.lij[0],za.lij[1],za.lij[2]);return this._elevationDataRequester.request(Ea,"binary",Fa).then(Oa=>this._lercDecoder.decode(Oa,{noDataValue:fa.ELEVATION_NODATA_VALUE},Fa.signal)).then(Oa=>{Oa?xa(new H.ElevationTileData(Oa)):ya(Error("LERC decoding failed"))},ya).finally(()=>{--this._asyncWorkItems})};Pa._requestMapTileData=function(za,Ga,Fa){++this._asyncWorkItems;const xa=
(db,nb)=>{--this._asyncWorkItems;da.releaseTileData(nb);n.isAborted(Fa)||(this._dataMissing(za,Z.LayerClass.MAP,Ga,db),this.requestUpdate())},ya=db=>nb=>xa(nb,db),Ea=db=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();n.isAborted(Fa)?da.releaseTileData(db):this._mapTileDataArrived(za,Ga,db)},Fa.signal,ya(db)).catch(ya(db)),Oa=(db,nb=null)=>this._frameTask.schedule(()=>xa(db,nb));if(da.isVectorTileLayerView(Ga)){var bb=Ga.schemaHelper.getLevelRowColumn(za.lij);return Ga.fetchTile(bb[0],
bb[1],bb[2],Fa).then(Ea,Oa)}if(da.isImageryTileLayerView(Ga))return Ga.fetchTile(za.lij[0],za.lij[1],za.lij[2],Fa).then(Ea,Oa);if(da.isTileLayerView(Ga)&&da.useFetchTileForLayer(Ga.layer))return Ga.layer.fetchTile(za.lij[0],za.lij[1],za.lij[2],Fa).then(db=>{n.isAborted(Fa)?(f.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Oa(n.createAbortError())):Ea(db)},Oa);bb=Ga.getTileUrl(za.lij[0],za.lij[1],
za.lij[2]);O.isRefreshableLayer(Ga.layer)&&Ga.layer.refreshTimestamp&&(bb+=`${bb.includes("?")?"\x26":"?"}_ts=${Ga.layer.refreshTimestamp}`);return this._mapDataRequester.request(bb,Ga.hasMixedImageFormats?"image+type":"image",Fa).then(Ea,Oa)};Pa._mapTileDataArrived=function(za,Ga,Fa){Ga=this._getLayerIdxByUID(Z.LayerClass.MAP,Ga.uid);null!=Ga?za.dataArrived(Ga,Z.LayerClass.MAP,Fa):(da.releaseTileData(Fa),f.getLogger(this).warn("TerrainSurface: received data from unknown layer"))};Pa._getLayerIdxByUID=
function(za,Ga){return this._layerIndexByUid[za].get(Ga)};Pa._dataMissing=function(za,Ga,Fa,xa){Fa=this._getLayerIdxByUID(Ga,Fa.uid);null!=Fa?za.dataMissing(Fa,Ga,xa):f.getLogger(this).warn("TerrainSurface: received data from unknown layer")};Pa.updateTileOverlayParams=function(za){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ga=>{Ga.renderData&&this.overlayManager.setTileParameters(Ga)}),this._renderer.setNeedsRender(za))};Pa._recalculateUsedMemory=function(){return this.tilingScheme?
this._allTiles.reduce((za,Ga)=>za+Ga.usedMemory,0):null};Pa.getUsedMemoryForLayerView=function(za){let Ga=this.overlayManager.gpuMemoryUsage;const Fa=this._layerClassFromLayerView(za),xa=this._getLayerIdxByUID(Fa,za.uid);null!=xa&&this._allTiles.forAll(ya=>Ga+=ya.getUsedMemoryForLayer(Fa,xa));return Ga};Pa.getTile=function(za){if(null==za||null==this._rootTiles)return null;const Ga=za.split("/").map(Ea=>+Ea);if(0===Ga[0])return this._rootTiles.find(Ea=>Ea.lij[1]===Ga[1]&&Ea.lij[2]===Ga[2]);za=2**
Ga[0];const Fa=Math.floor(Ga[1]/za),xa=Math.floor(Ga[2]/za);let ya;this._rootTiles.some(Ea=>Ea.lij[1]===Fa&&Ea.lij[2]===xa?(ya=Ea,!0):!1);if(ya){for(za=1<<Ga[0]-1;ya.lij[0]<Ga[0];){let Ea=Ga[1]&za?2:0;0<(Ga[2]&za)&&Ea++;if(!ya.children[Ea])return null;ya=ya.children[Ea];za>>=1}da.weakAssert(ya.lij[0]===Ga[0]&&ya.lij[1]===Ga[1]&&ya.lij[2]===Ga[2],"not the right tile?");return ya}return null};Pa.checkAllTilesWaterproofness=function(){if(da.ENABLE_WATERPROOFNESS_TESTS){var za=this._rootTiles;if(null!=
za){var Ga=ya=>0<ya?.renderData?.geometry?.indices?.length,Fa=ya=>{if(ya.intersectsClippingArea)if(ya.renderData&&!ya.renderData.geometryState&&console.error("Tile[",ya.lij,"] has renderData but not geometryState"),ya.renderData&&!ya.renderData.geometry&&console.error("Tile[",ya.lij,"] has renderData but not geometryInfo"),!ya.renderData?.geometry||0<(ya.renderData.geometry.indices?.length??0)||console.error("Tile[",ya.lij,"] has renderData but no indices - geometryInfo: ",ya.renderData.geometry),
Ga(ya)){ya.checkGeometryWaterproofness();for(const bb of ya.children){var Ea=bb,Oa=ya;Ga(Ea)&&console.error("Tile[",Ea.lij,"] has geometry although parent[",Oa.lij,"] has geom")}}else if(ya.isLeaf)console.error("Tile[",ya.lij,"] has no geometry and no children, from root to leaf");else for(Ea of ya.children)Fa(Ea)},xa=ya=>{const Ea=ya.parent?.visible??!0,Oa=ya.visible;ya.computeVisibility();const bb=ya.visible;Oa!==bb&&Ea&&console.error(" Tile[",ya.lij,"] has out of date visibility: ",Oa," instead of ",
bb);if(!ya.isLeaf)for(const db of ya.children)xa(db)};for(const ya of za)Fa(ya),xa(ya)}}};Pa.isEastEndWrap=function(za){return this.isGlobal&&za[2]===this.lijEastEnd(za[0])-1};Pa.isWestEndWrap=function(za){return this.isGlobal&&0===za[2]};Pa.lijEastEnd=function(za){return 2**(za+(null!=this.spatialReference&&this.spatialReference.isGeographic?1:0))};Pa.wrapEastWest=function(za){const Ga=this.lijEastEnd(za[0]),Fa=za[2];return 0<=Fa&&Fa<Ga?za:this.isGlobal?[za[0],za[1],(Fa+(0>Fa?Ga:0))%Ga]:null};Pa.enableInternalChecks=
function(za){da.enableTerrainInternalChecks(za)};Pa.enableWaterproofnessChecks=function(za){da.enableTerrainWaterproofnessChecks(za)};b._createClass(ib,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){if(this.lodSnapping===Y.LODSnapping.ON){var za=this.view,Ga=this.tilingScheme;const Fa=za.pointsOfInterest?.cameraOnSurface?.scale;if(Ga&&Fa){const xa=za.state.contentCamera;za=W.directionToHeadingTilt(za,xa.eye,
xa.viewForward,xa.up).tilt;90<za&&(za=180-za);za=2*(za/90)**2;Ga=Ga.levelAtScale(Fa);Ga=Math.min(Ga-za,this._splitLimits.maxLod||Infinity);return 0>=Ga?null:Ga}}return null}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Y.LODSnapping.ON:Y.LODSnapping.OFF}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},
{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:za}=this,{clippingArea:Ga}=this.view;if(null==Ga||null==za)return null;const Fa=K.create();za=P.toBoundingRect(Ga,Fa,za)?Fa:null;Ga=this._get("extent");return K.equals(za,Ga)?Ga:za}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},{key:"extent",get:function(){const za=K.intersection(this.groundExtent,this._userClippingExtent,K.create()),Ga=this._get("extent");
return K.equals(za,Ga)?Ga:za}},{key:"groundExtent",get:function(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){return this.tilingSchemeLogic?.extent}},{key:"updating",get:function(){this._hasPendingUpdates||(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}},{key:"running",get:function(){return(this._hasPendingUpdates||
this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"baseOpacity",get:function(){return this.view?.map?.ground?.opacity??1},set:function(za){this.view.map.ground.opacity=za}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},
{key:"ready",get:function(){return null!=this._rootTiles}},{key:"renderOrder",set:function(za){this._renderer.renderOrder=za;this._set("renderOrder",za)}},{key:"rootTiles",get:function(){return this._rootTiles}},{key:"spatialReference",get:function(){return this.tilingScheme?.spatialReference??null}},{key:"backgroundColor",get:function(){return this.view.map.ground.surfaceColor},set:function(za){this.view.map.ground.surfaceColor=za}},{key:"slicePlaneEnabled",set:function(za){this._renderer.slicePlaneEnabled=
za;this._set("slicePlaneEnabled",za);this._evaluateTransparency()}},{key:"tilingSchemeLocked",get:function(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}},{key:"wireframe",get:function(){return this._renderer?.wireframe},set:function(za){za!==this._renderer.wireframe&&(this._renderer.wireframe=za,this._updateAllTileGeometries())}},{key:"_visible",set:function(za){za!==this._visibleCached&&(this._visibleCached=za,this._renderer.setVisibility(za),this.suspended=!za)}},{key:"opaque",get:function(){return this._renderer.transparency===
ba.TransparencyMode.Opaque}},{key:"suspended",set:function(za){this._set("suspended",za);this._viewChangeUpdate()}},{key:"textureFadeDuration",get:function(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"_lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*fa.MAX_MEMORY_LOD_BIAS}},{key:"shortBatches",get:function(){return this.view.state.mode!==
Ca.RenderState.IDLE}},{key:"performanceInfo",get:function(){const za=this._performanceInfo;za.numNodes=this._allTiles.length;za.numLeaves=za.numVisible=za.numRendered=za.numLoadedPerLevel.length=za.numRenderedPerLevel.length=0;this._allTiles.forAll(Ga=>{Ga.isLeaf&&za.numLeaves++;const Fa=Ga.level;Ga.renderData&&(za.numLoadedPerLevel[Fa]=(za.numLoadedPerLevel[Fa]||0)+1);Ga.visible&&(za.numVisible++,Ga.rendered&&(za.numRenderedPerLevel[Fa]=(za.numRenderedPerLevel[Fa]||0)+1,za.numRendered++))});return za}},
{key:"usedMemory",get:function(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return null!=this._usedMemory?this._usedMemory:0}},{key:"renderPatchBorders",get:function(){return this._renderer.renderPatchBorders},set:function(za){this._renderer.renderPatchBorders=za}},{key:"visualizeNormals",get:function(){return this._renderer.visualizeNormals},set:function(za){this._renderer.visualizeNormals=za}},{key:"renderingDisabled",get:function(){return this._renderer.renderingDisabled},
set:function(za){this._renderer.renderingDisabled=za}},{key:"test",get:function(){const za=this;return{renderer:za._renderer,lercDecoder:za._lercDecoder,forceReload:()=>{null!=za._rootTiles&&0<za._rootTiles.length&&(za._mergeTile(za._rootTiles[0]),za._viewChangeUpdate())},getTiles:()=>za._allTiles.toArray(),getRenderedTiles(){Va.clear();za._allTiles.forAll(Fa=>{Fa.visible&&Fa.rendered&&Va.push(Fa)});const Ga=Va.toArray();ua.sortTiles(za.renderOrder,Ga);return Ga},lockTilingScheme(Ga,Fa){za._extentHelper.defaultTiledLayersExtent=
Fa;za.tilingSchemeLogic.test.lockTilingScheme(Ga)}}}},{key:"isGlobal",get:function(){return this._isGlobal}},{key:"isWebMercator",get:function(){return this._isWebMercator}},{key:"isWebMercatorOnPlateeCarree",get:function(){return this._isWebMercatorOnPlateeCarree}}]);return ib}(k.EventedMixin(p));c.__decorate([m.property()],p.prototype,"_renderer",void 0);c.__decorate([m.property({constructOnly:!0})],p.prototype,"_scaleRangeQueries",void 0);c.__decorate([m.property({constructOnly:!0})],p.prototype,
"view",void 0);c.__decorate([m.property({constructOnly:!0})],p.prototype,"overlayManager",void 0);c.__decorate([m.property()],p.prototype,"_hasPendingUpdates",void 0);c.__decorate([m.property()],p.prototype,"_asyncWorkItems",void 0);c.__decorate([m.property()],p.prototype,"_allTilesDirty",void 0);c.__decorate([m.property()],p.prototype,"_allTilesSorted",void 0);c.__decorate([m.property()],p.prototype,"_viewChanged",void 0);c.__decorate([m.property()],p.prototype,"_splitLimits",void 0);c.__decorate([m.property({readOnly:!0})],
p.prototype,"_watchUpdatingTracking",void 0);c.__decorate([m.property()],p.prototype,"_frameTask",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"snapLevel",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"lodSnapping",null);c.__decorate([m.property()],p.prototype,"_userClippingExtent",null);c.__decorate([m.property()],p.prototype,"_rootTilesExtent",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"extent",null);c.__decorate([m.property({readOnly:!0})],p.prototype,
"groundExtent",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"_tilingSchemeExtent",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"updating",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"running",null);c.__decorate([m.property(S.updatingProgress)],p.prototype,"updatingProgress",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"updatingProgressValue",null);c.__decorate([m.property()],p.prototype,"_maxNumUpdating",void 0);c.__decorate([m.property()],
p.prototype,"baseOpacity",null);c.__decorate([m.property()],p.prototype,"hasCompositeBlendMode",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"viewingMode",null);c.__decorate([m.property()],p.prototype,"maxTextureScale",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"ready",null);c.__decorate([m.property({value:ha.RenderOrder.FRONT_TO_BACK})],p.prototype,"renderOrder",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"rootTiles",null);c.__decorate([m.property()],
p.prototype,"_rootTiles",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"spatialReference",null);c.__decorate([m.property({type:y})],p.prototype,"backgroundColor",null);c.__decorate([m.property({value:!1})],p.prototype,"slicePlaneEnabled",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"tilingScheme",void 0);c.__decorate([m.property({readOnly:!0})],p.prototype,"tilingSchemeLocked",null);c.__decorate([m.property({readOnly:!0})],p.prototype,"tilingSchemeLogic",void 0);c.__decorate([m.property()],
p.prototype,"wireframe",null);c.__decorate([m.property({value:!1})],p.prototype,"suspended",null);c.__decorate([m.property()],p.prototype,"textureFadeDuration",null);c.__decorate([m.property()],p.prototype,"visibleElevationBounds",void 0);c.__decorate([m.property()],p.prototype,"rootTileElevationBounds",void 0);c.__decorate([m.property()],p.prototype,"_layerViewsDirty",void 0);c.__decorate([m.property()],p.prototype,"renderPatchBorders",null);c.__decorate([m.property()],p.prototype,"visualizeNormals",
null);c.__decorate([m.property()],p.prototype,"renderingDisabled",null);c=p=c.__decorate([r.subclass("esri.views.3d.terrain.TerrainSurface")],p);const Sa=B.create(),La=K.create(),Ua=[0,0,0],Va=new z,cb={spatialReference:null,extent:K.create(),context:"ground"},la={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._store=u}var p=
y.prototype;p.destroy=function(){this._store.destroy()};p.get=function(u){return this._store.get(u)};p.put=function(u,q){this._store.put(u,q,q.values.byteLength+256)};return b._createClass(y)}();a.ElevationQueryTileCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(p,u,q,k){this._maxValue=this._minValue=this._hasNoDataValues=
null;"pixelData"in p?(this.values=p.pixelData,this.width=p.width,this.height=p.height,this.noDataValue=p.noDataValue):(this.values=p,this.width=u,this.height=q,this.noDataValue=k)}y.prototype._ensureBounds=function(){if(null==this._minValue){var {noDataValue:p,values:u}=this,q=Infinity,k=-Infinity,d=!0;for(const f of u)f===p?this._hasNoDataValues=!0:(q=f<q?f:q,k=f>k?f:k,d=!1);d?this._maxValue=this._minValue=0:(this._minValue=q,this._maxValue=-3E38<k?k:0)}};b._createClass(y,[{key:"hasNoDataValues",
get:function(){null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}},{key:"minValue",get:function(){this._ensureBounds();return this._minValue}},{key:"maxValue",get:function(){this._ensureBounds();return this._maxValue}}]);return y}();a.ElevationTileData=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/workers/WorkerHandle"],
function(a,b,c){let y=function(u){function q(d=null){var f=u.call(this,"LercWorker","_decode",{_decode:g=>[g.buffer]},d,{strategy:"dedicated"})||this;f.schedule=d;f.ref=0;return f}b._inherits(q,u);var k=q.prototype;k.decode=function(d,f,g){return d&&0!==d.byteLength?this.invoke({buffer:d,options:f},g):Promise.resolve(null)};k.release=function(){0>=--this.ref&&(p.forEach((d,f)=>{d===this&&p.delete(f)}),this.destroy())};return b._createClass(q)}(c.WorkerHandle);const p=new Map;a.acquireDecoder=function(u=
null){let q=p.get(u);q||(null!=u?(q=new y(k=>u.immediate.schedule(k)),p.set(u,q)):(q=new y,p.set(null,q)));++q.ref;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),function(a,b,c,y,p,u,q){let k=function(){function d(g,e,h,z,n={}){this._mainMethod=e;this._transferLists=h;this._listeners=[];this._promise=
q.open(g,{...n,schedule:z}).then(l=>{if(void 0===this._thread){this._thread=l;this._promise=null;n.hasInitialize&&this.broadcast({},"initialize");for(const m of this._listeners)this._connectListener(m)}else l.close()});this._promise.catch(l=>p.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${g} worker: ${l}`))}var f=d.prototype;f.on=function(g,e){const h={removed:!1,eventName:g,callback:e,threadHandle:null};this._listeners.push(h);this._connectListener(h);return y.makeHandle(()=>
{h.removed=!0;c.remove(this._listeners,h);this._thread&&null!=h.threadHandle&&h.threadHandle.remove()})};f.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}};f.invoke=function(g,e){return this.invokeMethod(this._mainMethod,g,e)};f.invokeMethod=function(g,e,h){if(this._thread){var z=this._transferLists[g];z=z?z(e):[];return this._thread.invoke(g,e,{transferList:z,signal:h})}return this._promise?this._promise.then(()=>
{u.throwIfAborted(h);return this.invokeMethod(g,e,h)}):Promise.reject(null)};f.broadcast=function(g,e){return this._thread?Promise.all(this._thread.broadcast(e,g)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(g,e)):Promise.reject()};f._connectListener=function(g){this._thread&&this._thread.on(g.eventName,g.callback).then(e=>{g.removed||(g.threadHandle=e)})};b._createClass(d,[{key:"promise",get:function(){return this._promise}}]);return d}();a.WorkerHandle=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,c,y,p,u,q,k,d){c=function(g){function e(z,n,l,m,t,w,r,x=null){n=g.call(this,z,n,l,m,t,w,4096,4096)||this;n.styleRepository=r;n._memCache=x;n.type="vector-tile";n._referenced=
0;n._hasSymbolBuckets=!1;n._memoryUsedByLayerData=0;n.layerData=new Map;n.layerCount=0;n.status="loading";n.allSymbolsFadingOut=!1;n.lastOpacityUpdate=0;n.symbols=new Map;n.isCoverage=!1;n.neededForCoverage=!1;n.decluttered=!1;n.invalidating=!1;n.parentTile=null;n.childrenTiles=new Set;n._processed=!1;n._referenced=1;n.id=z.id;return n}b._inherits(e,g);var h=e.prototype;h.setData=function(z){this.changeDataImpl(z);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};h.deleteLayerData=
function(z){let n=!1;for(const l of z)this.layerData.has(l)&&(z=this.layerData.get(l),this._memoryUsedByLayerData-=z.memoryUsed,z.type===u.BucketType.SYMBOL&&this.symbols.has(l)&&(this.symbols.delete(l),n=!0),z.destroy(),this.layerData.delete(l),this.layerCount--);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);n&&this.emit("symbols-changed");this.requestRender()};h.processed=function(){return this._processed};h.hasData=function(){return 0<this.layerCount};h.dispose=function(){"unloaded"!==
this.status&&(f.delete(this),e._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};h.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};h.retain=function(){++this._referenced};h.changeDataImpl=function(z){let n=!1;if(z){const {bucketsWithData:l,emptyBuckets:m}=z;z=this._createRenderBuckets(l);if(m&&0<m.byteLength){const t=new Uint32Array(m);for(const w of t)this._deleteLayerData(w)}for(const [t,
w]of z)this._deleteLayerData(t),w.type===u.BucketType.SYMBOL&&(this.symbols.set(t,w.symbols),n=!0),this._memoryUsedByLayerData+=w.memoryUsed,this.layerData.set(t,w),this.layerCount++;this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const [,l]of this.layerData)l.type===u.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);n&&this.emit("symbols-changed")};h.attachWithContext=function(z){this.stage={context:z,trashDisplayObject(n){n.processDetach()},untrashDisplayObject(){return!1}}};
h.setTransform=function(z){b._get(b._getPrototypeOf(e.prototype),"setTransform",this).call(this,z);var n=this.resolution/(z.resolution*z.pixelRatio);const l=this.width/this.rangeX*n;n*=this.height/this.rangeY;const m=[0,0];z.toScreen(m,[this.x,this.y]);const t=this.transforms.tileUnitsToPixels;y.identity(t);y.translate(t,t,m);y.rotate(t,t,Math.PI*z.rotation/180);y.scale(t,t,[l,n,1])};h._createTransforms=function(){return{dvs:p.create(),tileMat3:p.create(),tileUnitsToPixels:p.create()}};e._destroyRenderBuckets=
function(z){if(z){var n=new Set;z.forEach(l=>{n.has(l)||(l.destroy(),n.add(l))});z.clear()}};h._createRenderBuckets=function(z){const n=new Map,l=new Map;for(const m of z){z=this._deserializeBucket(m,l);for(const t of z.layerUIDs)n.set(t,z)}return n};h._deserializeBucket=function(z,n){let l=n.get(z);if(l)return l;switch((new Uint32Array(z))[0]){case u.BucketType.FILL:l=new q.FillRenderBucket(z,this.styleRepository);break;case u.BucketType.LINE:l=new q.LineRenderBucket(z,this.styleRepository);break;
case u.BucketType.SYMBOL:l=new q.SymbolRenderBucket(z,this.styleRepository,this);break;case u.BucketType.CIRCLE:l=new q.CircleRenderBucket(z,this.styleRepository)}n.set(z,l);return l};h._deleteLayerData=function(z){if(this.layerData.has(z)){var n=this.layerData.get(z);this._memoryUsedByLayerData-=n.memoryUsed;n.destroy();this.layerData.delete(z);this.layerCount--}};b._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&
performance.now()-this.lastOpacityUpdate<k.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<k.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsed",get:function(){return this._memoryUsedByLayerData+256}}]);return e}(d.TiledDisplayObject);
const f=new Map;a.VectorTile=c;a.printAllocations=function(){f.forEach((g,e)=>{console.log(`\n${e.key}:`);g[0].forEach(h=>console.log(h));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");g[1].forEach(h=>console.log(h))})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||
(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=
4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/typedArrayUtil ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(a,b,c,y,p,u,q,k,d){let f=function(){function n(m,t){this.layerUIDs=
[];this.isDestroyed=!1;this._data=m;let w=1;m=new Uint32Array(m);this.layerUIDs=[];const r=m[w++];for(let x=0;x<r;x++)this.layerUIDs[x]=m[w++];this.bufferDataOffset=w;t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}var l=n.prototype;l.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};l.prepareForRendering=function(m){null!=this._data&&(this.doPrepareForRendering(m,this._data,this.bufferDataOffset),this._data=null)};b._createClass(n,[{key:"isPreparedForRendering",
get:function(){return null==this._data}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"data",get:function(){return this._data}}]);return n}(),g=function(n){function l(t,w){w=n.call(this,t,w)||this;w.type=p.BucketType.LINE;w.lineIndexStart=0;w.lineIndexCount=0;t=new Uint32Array(t);let r=w.bufferDataOffset;w.lineIndexStart=t[r++];w.lineIndexCount=t[r++];const x=t[r++];if(0<x){w.patternMap=new Map;for(let D=0;D<x;D++){const A=t[r++],v=t[r++],B=t[r++];w.patternMap.set(A,[v,B])}}w.bufferDataOffset=
r;return w}b._inherits(l,n);var m=l.prototype;m.hasData=function(){return 0<this.lineIndexCount};m.triangleCount=function(){return this.lineIndexCount/3};m.doDestroy=function(){this.vao=c.disposeMaybe(this.vao)};m.doPrepareForRendering=function(t,w,r){var x=new Uint32Array(w);w=new Int32Array(x.buffer);var D=x[r++];w=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*r,D));r+=D;D=x[r++];x=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,D));r+=
D;r=this.layer.lineMaterial;this.vao=new d.VertexArrayObject(t,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:w},x)};b._createClass(l,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}}]);return l}(f),e=function(n){function l(t,w){w=n.call(this,t,w)||this;w.type=p.BucketType.FILL;w.fillIndexStart=0;w.fillIndexCount=0;w.outlineIndexStart=0;w.outlineIndexCount=0;t=new Uint32Array(t);let r=w.bufferDataOffset;w.fillIndexStart=t[r++];w.fillIndexCount=
t[r++];w.outlineIndexStart=t[r++];w.outlineIndexCount=t[r++];const x=t[r++];if(0<x){w.patternMap=new Map;for(let D=0;D<x;D++){const A=t[r++],v=t[r++],B=t[r++];w.patternMap.set(A,[v,B])}}w.bufferDataOffset=r;return w}b._inherits(l,n);var m=l.prototype;m.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};m.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};m.doDestroy=function(){this.fillVAO=c.disposeMaybe(this.fillVAO);this.outlineVAO=c.disposeMaybe(this.outlineVAO)};
m.doPrepareForRendering=function(t,w,r){var x=new Uint32Array(w),D=new Int32Array(x.buffer),A=x[r++];w=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,A));r+=A;var v=x[r++];A=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,v));r+=v;v=x[r++];D=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,v));r+=v;v=x[r++];x=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,v));r+=v;v=this.layer;
r=v.fillMaterial;v=v.outlineMaterial;this.fillVAO=new d.VertexArrayObject(t,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:w},A);this.outlineVAO=new d.VertexArrayObject(t,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:D},x)};b._createClass(l,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}}]);return l}(f),h=function(n){function l(t,w,r){w=n.call(this,t,w)||this;w.type=p.BucketType.SYMBOL;w.iconPerPageElementsMap=
new Map;w.glyphPerPageElementsMap=new Map;w.symbolInstances=[];w.isIconSDF=!1;w.opacityChanged=!1;w.lastOpacityUpdate=0;w.symbols=[];const x=new Uint32Array(t),D=new Int32Array(t);t=new Float32Array(t);let A=w.bufferDataOffset;w.isIconSDF=!!x[A++];var v=x[A++];for(var B=0;B<v;B++){var C=x[A++],E=x[A++],F=x[A++];w.iconPerPageElementsMap.set(C,[E,F])}v=x[A++];for(B=0;B<v;B++)C=x[A++],E=x[A++],F=x[A++],w.glyphPerPageElementsMap.set(C,[E,F]);v=x[A++];B=x[A++];w.iconOpacity=new Int32Array(v);w.textOpacity=
new Int32Array(B);A=u.deserializeSymbols(x,D,t,A,w.symbols,r);w.bufferDataOffset=A;return w}b._inherits(l,n);var m=l.prototype;m.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};m.triangleCount=function(){let t=0;for(const [,w]of this.iconPerPageElementsMap)t+=w[1];for(const [,w]of this.glyphPerPageElementsMap)t+=w[1];return t/3};m.doDestroy=function(){this.iconVAO=c.disposeMaybe(this.iconVAO);this.textVAO=c.disposeMaybe(this.textVAO)};m.updateOpacityInfo=
function(){if(this.opacityChanged){this.opacityChanged=!1;var t=this.iconOpacity,w=this.iconVAO.vertexBuffers.opacity;0<t.length&&t.byteLength===w.byteLength&&w.setSubData(t,0,0,t.length);t=this.textOpacity;w=this.textVAO.vertexBuffers.opacity;0<t.length&&t.byteLength===w.byteLength&&w.setSubData(t,0,0,t.length)}};m.doPrepareForRendering=function(t,w,r){var x=new Uint32Array(w),D=new Int32Array(x.buffer),A=x[r++];w=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,A));
r+=A;var v=x[r++];A=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,v));r+=v;v=x[r++];D=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*r,v));r+=v;v=x[r++];x=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,v));r+=v;r=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,this.iconOpacity.buffer);v=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,this.textOpacity.buffer);var B=this.layer;const C=B.iconMaterial;B=B.textMaterial;
this.iconVAO=new d.VertexArrayObject(t,C.getAttributeLocations(),C.getLayoutInfo(),{geometry:w,opacity:r},A);this.textVAO=new d.VertexArrayObject(t,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:D,opacity:v},x)};b._createClass(l,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+y.estimateSize(this.iconOpacity)+y.estimateSize(this.textOpacity)}}]);return l}(f),z=function(n){function l(t,w){w=n.call(this,t,w)||
this;w.type=p.BucketType.CIRCLE;w.circleIndexStart=0;w.circleIndexCount=0;t=new Uint32Array(t);let r=w.bufferDataOffset;w.circleIndexStart=t[r++];w.circleIndexCount=t[r++];w.bufferDataOffset=r;return w}b._inherits(l,n);var m=l.prototype;m.hasData=function(){return 0<this.circleIndexCount};m.triangleCount=function(){return this.circleIndexCount/3};m.doDestroy=function(){this.vao=c.disposeMaybe(this.vao)};m.doPrepareForRendering=function(t,w,r){var x=new Uint32Array(w);w=new Int32Array(x.buffer);var D=
x[r++];w=q.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*r,D));r+=D;D=x[r++];x=q.BufferObject.createIndex(t,k.Usage.STATIC_DRAW,new Uint32Array(x.buffer,4*r,D));r+=D;r=this.layer.circleMaterial;this.vao=new d.VertexArrayObject(t,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:w},x)};b._createClass(l,[{key:"memoryUsed",get:function(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}}]);return l}(f);a.CircleRenderBucket=z;a.FillRenderBucket=e;a.LineRenderBucket=
g;a.RenderBucketBase=f;a.SymbolRenderBucket=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../enums","./core"],function(a,b,c,y){let p=function(){function u(k,d,f){this._rows=Math.ceil(d/f);this._columns=Math.ceil(k/f);this._cellSize=f;this.cells=Array(this._rows);for(k=0;k<this._rows;k++)for(this.cells[k]=Array(this._columns),d=0;d<this._columns;d++)this.cells[k][d]=
[]}var q=u.prototype;q.getCell=function(k,d){d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._rows-1);k=Math.min(Math.max(Math.floor(k/this._cellSize),0),this._columns-1);return this.cells[d]&&this.cells[d][k]||null};q.getCellSpan=function(k,d,f,g){return[Math.min(Math.max(Math.floor(k/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),
0),this.rows-1)]};b._createClass(u,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return u}();a.GridIndex=p;a.deserializeSymbols=function(u,q,k,d,f,g){const e=q[d++];for(let n=0;n<e;n++){const l=new y.VTLSymbol(g);l.xTile=q[d++];l.yTile=q[d++];l.hash=q[d++];l.priority=q[d++];var h=q[d++];for(var z=0;z<h;z++){const m=q[d++],t=q[d++],w=q[d++],r=q[d++],x=!!q[d++],D=q[d++],A=k[d++],v=k[d++],
B=q[d++],C=q[d++];l.colliders.push({xTile:m,yTile:t,dxPixels:w,dyPixels:r,hard:x,partIndex:D,width:B,height:C,minLod:A,maxLod:v})}h=u[d++];for(z=0;z<h;z++)l.textVertexRanges.push([u[d++],u[d++]]);h=u[d++];for(z=0;z<h;z++)l.iconVertexRanges.push([u[d++],u[d++]]);f.push(l)}return d};a.tileCoordChange=function(u,q,k,d,f,g){k-=f;if(0<=k)return(q>>k)+(d-(g<<k))*(u>>k);k=-k;return q-(g-(d<<k))*(u>>k)<<k};a.writeOpacityToBuffers=function(u,q,k){for(const [n,l]of u.symbols){{var d=u,f=q,g=k,e=l;const m=d.layerData.get(n);
if(m.type===c.BucketType.SYMBOL){for(const t of e){e=t.unique;var h=void 0;if(t.selectedForRendering){var z=e.parts[0];h=z.startOpacity;z=z.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===z;h=g?Math.floor(127*h)|z<<7:z?255:0;h|=h<<24|h<<16|h<<8}else h=0;for(const [w,r]of t.iconVertexRanges)for(z=w;z<w+r;z+=4)m.iconOpacity[z/4]=h;t.selectedForRendering?(h=e.parts[1],e=h.startOpacity,h=h.targetOpacity,d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===h,e=g?Math.floor(127*e)|h<<7:h?255:
0,h=e<<24|e<<16|e<<8|e):h=0;for(const [w,r]of t.textVertexRanges)for(e=w;e<w+r;e+=4)m.textOpacity[e/4]=h}m.lastOpacityUpdate=f;m.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(y){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=
[];this.tile=y});b=b._createClass(function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1});a.VTLSymbol=c;a.VTLUniqueSymbol=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,y,p){y=function(u){function q(d,f,g,e,h,z,n=h,l=z){var m=u.call(this)||this;m.triangleCountReportedInDebug=0;m.triangleCount=0;m.texture=null;m.key=new p(d);m.resolution=f;m.x=g;m.y=e;m.width=h;m.height=z;m.rangeX=n;m.rangeY=l;return m}b._inherits(q,u);
var k=q.prototype;k.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};k.setTransform=function(d){const f=this.resolution/(d.resolution*d.pixelRatio),g=this.transforms.tileMat3,[e,h]=d.toScreenNoRotation([0,0],[this.x,this.y]);c.set(g,this.width/this.rangeX*f,0,0,0,this.height/this.rangeY*f,0,e,h,1);c.multiply(this.transforms.dvs,d.displayViewMat3,g)};return b._createClass(q)}(y.DisplayObject);a.TiledDisplayObject=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(a,b,c,y,p){const u=1/y("mapview-transitions-duration");c=function(q){function k(){var f=q.apply(this,arguments)||this;f._fadeOutResolver=null;f._fadeInResolver=null;f._clips=null;f.computedVisible=!0;f.computedOpacity=1;f.fadeTransitionEnabled=!1;f.inFadeTransition=!1;f._isReady=!1;f._opacity=1;f.parent=null;
f._stage=null;f._visible=!0;return f}b._inherits(k,q);var d=k.prototype;d._getTransforms=function(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms};d.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=p.createResolver();this.requestRender();return this._fadeInResolver.promise};
d.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=p.createResolver();this.requestRender();return this._fadeOutResolver.promise};d.endTransitions=function(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()};
d.beforeRender=function(f){this.updateTransitionProperties(f.deltaTime,f.state.scale)};d.afterRender=function(f){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};d.remove=function(){this.parent?.removeChild(this)};d.setTransform=function(f){};d.processRender=function(f){this.stage&&this.computedVisible&&this.doRender(f)};d.requestRender=
function(){this.stage&&this.stage.requestRender()};d.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};d.updateTransitionProperties=function(f,g){if(this.fadeTransitionEnabled){g=this._fadeOutResolver||!this.visible?0:this.opacity;const e=this.computedOpacity;e===g?this.computedVisible=this.visible:(f*=u,this.computedOpacity=e>g?Math.max(g,
e-f):Math.min(g,e+f),this.computedVisible=0<this.computedOpacity,f=g===this.computedOpacity,this.inFadeTransition=!f,f||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};d.onAttach=function(){};d.onDetach=function(){};d.doRender=function(f){};d.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(k,[{key:"clips",get:function(){return this._clips},set:function(f){this._clips=f;this.requestRender()}},
{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(f){this._opacity!==f&&(this._opacity=Math.min(1,Math.max(f,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(f){if(this._stage!==f){var g=this._stage;(this._stage=f)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):g?.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",
get:function(){return this._visible},set:function(f){this._visible!==f&&(this._visible=f,this.requestRender())}}]);return k}(c);a.DisplayObject=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function y(u,q,k,d){this.set(u,q,k,d)}y.getId=function(u,q,k,d){return"object"===typeof u?`${u.level}/${u.row}/${u.col}/${u.world}`:`${u}/${q}/${k}/${d}`};
var p=y.prototype;p.acquire=function(u,q,k,d){this.set(u,q,k,d)};p.contains=function(u){const q=u.level-this.level;return 0<=q&&this.row===u.row>>q&&this.col===u.col>>q&&this.world===u.world};p.equals=function(u){return this.level===u.level&&this.row===u.row&&this.col===u.col&&this.world===u.world};p.clone=function(){return new y(this)};p.release=function(){this.world=this.col=this.row=this.level=0};p.set=function(u,q,k,d){if(null==u)this.world=this.col=this.row=this.level=0;else if("object"===typeof u)this.level=
u.level||0,this.row=u.row||0,this.col=u.col||0,this.world=u.world||0;else if("string"===typeof u){const [f,g,e,h]=u.split("/");this.level=parseFloat(f);this.row=parseFloat(g);this.col=parseFloat(e);this.world=parseFloat(h)}else this.level=+u,this.row=+q,this.col=+k,this.world=+d||0;return this};p.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};p.getParentKey=function(){return 0>=this.level?null:new y(this.level-1,this.row>>1,this.col>>1,this.world)};p.getChildKeys=
function(){const u=this.level+1,q=this.row<<1,k=this.col<<1,d=this.world;return[new y(u,q,k,d),new y(u,q,k+1,d),new y(u,q+1,k,d),new y(u,q+1,k+1,d)]};p.compareRowMajor=function(u){return this.row<u.row?-1:this.row>u.row?1:this.col<u.col?-1:this.col>u.col?1:0};a._createClass(y,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(u){this.set(u)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);
return y}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(p=
0,u=0){this.min=p;this.max=u;this.level=0;this.hasNoDataValues=!1}y.prototype.copyFrom=function(p){this.min=p.min;this.max=p.max;this.level=p.level;this.hasNoDataValues=p.hasNoDataValues};return b._createClass(y)}();a.ElevationBounds=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../layers/support/ElevationSamplerData ../support/mathUtils ./TerrainConst".split(" "),
function(a,b,c,y,p,u){let q=function(){function d(f,g,e){this.type="elevation";this.level=f[0];this.i=f[1];this.j=f[2];this.extent=g;this.samplerData=new y.ElevationSamplerData(e,g)}d.prototype.computeMinMaxValue=function(f,g,e,h){h.min=Infinity;h.max=-Infinity;h.hasNoDataValues=!1;f-=this.level;if(0>=f)return h;var z=2**f;if(Math.floor(g/z)!==this.i||Math.floor(e/z)!==this.j)return h;var n=Infinity,l=-Infinity,m=this.samplerData.data.width,t=this.samplerData.data.values,w=.5*u.ELEVATION_NODATA_VALUE;
f=(m-1)/z;e=(e-this.j*z)*f;let r=(g-this.i*z)*f;if(1>f){const A=Math.floor(e),v=Math.floor(r);var x=A+v*m;g=t[x];z=t[x+1];var D=t[x+m];x=t[x+m+1];if(g+z+D+x<w)return n=e-A,w=r-v,l=p.bilerp(g,z,D,x,n,w),m=p.bilerp(g,z,D,x,n+f,w),t=p.bilerp(g,z,D,x,n,w+f),f=p.bilerp(g,z,D,x,n+f,w+f),h.min=Math.min(l,m,t,f),h.max=Math.max(l,m,t,f),h;e=A;r=v;f=1}else e=Math.floor(e),r=Math.floor(r),f=Math.ceil(f);for(g=e;g<=e+f;g++)for(z=r;z<=r+f;z++)D=t[g+z*m],D<w?(n=Math.min(n,D),l=Math.max(l,D)):h.hasNoDataValues=
!0;h.min=n;h.max=l;return h};return b._createClass(d)}();const k=.5*u.ELEVATION_NODATA_VALUE;a.ElevationData=q;a.sampleElevation=function(d,f,g){if(null==g)return null;for(const l of g){if(!l)continue;var e=l.safeWidth;g=c.clamp(l.dy*(l.y1-f),0,e);e=c.clamp(l.dx*(d-l.x0),0,e);const m=Math.floor(g),t=Math.floor(e);var h=l.data.width,z=m*h+t,n=l.data.values;const w=n[z],r=n[z+1];z+=h;h=n[z];n=n[z+1];if(w+h+r+n<k)return g-=m,e-=t,d=w+(r-w)*e,d+(h+(n-h)*e-d)*g}return null};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){b=b._createClass(function(c,y){this.data=c;this.safeWidth=.99999999*(c.width-1);this.dx=(c.width-1)/(y[2]-y[0]);this.dy=(c.width-1)/(y[3]-y[1]);this.x0=y[0];this.y1=y[3]});a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(w,r){return null==w||w.spatialReference.equals(r)?w:f.projectWithoutEngine(w,w.spatialReference,r)}a.ExtentHelper=function(w){function r(D){return w.call(this,D)||this}b._inherits(r,w);var x=r.prototype;x.initialize=function(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};x.destroy=function(){};x._computeStencilEnabledExtents=function(){const D=[];this.layerViews.forEach(A=>{A=A.layer;"IntegratedMeshLayer"===
A.operationalLayerType&&null!=this.viewSpatialReference&&(A=l(A.fullExtent,this.viewSpatialReference),null!=A&&D.push(g.fromExtent(A)))});return D};b._createClass(r,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);return r}(y);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",
null);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([p.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([p.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([p.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([p.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);c.__decorate([p.property({constructOnly:!0})],a.ExtentHelper.prototype,
"layers",void 0);c.__decorate([p.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let m=function(w){function r(){return w.apply(this,arguments)||this}b._inherits(r,w);var x=r.prototype;x._computeLayerViewsExtent=function(){return this._globalExtent};x._computeTiledLayersExtent=function(){return this._globalExtent};b._createClass(r,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?
z.WEBMERCATOR_WORLD_EXTENT:z.GEOGRAPHIC_WORLD_EXTENT}}]);return r}(a.ExtentHelper);m=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],m);let t=function(w){function r(){return w.apply(this,arguments)||this}b._inherits(r,w);var x=r.prototype;x._computeLayerViewsExtent=function(){const D=g.empty(),A=this.viewSpatialReference;this.layerViews.forEach(C=>{const E=C.layer;!C.isResolved()||"graphics"===E.type&&E.internal||(C=l("fullExtentInLocalViewSpatialReference"in C&&C.fullExtentInLocalViewSpatialReference||
C.layer.fullExtent,A),g.expand(D,C,D))});const v=g.allFinite(D)?D:null,B=this._get("layerViewsExtent");return g.equals(v,B)?B:v};x._computeTiledLayersExtent=function(){const D=this.tilingScheme;if(!D)return null;const A=this.viewSpatialReference,v=g.empty();this.layers.forEach(E=>{if(E.loaded&&e.isTiledLayer(E)){const K=n.getTiledLayerInfo(E,A,h.ViewingMode.Local);if(null!=K){var {tileInfo:F,fullExtent:M}=K;null!=F&&null!=M&&(n.isProjectableRasterLayer(E)||D.compatibleWith(F)&&M.spatialReference.equals(D.spatialReference))&&
g.expand(v,M,v)}}});g.expand(v,this.defaultTiledLayersExtent,v);const B=g.allFinite(v)?v:null,C=this._get("tiledLayersExtent");return g.equals(B,C)?C:B};return b._createClass(r)}(a.ExtentHelper);t=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperLocal")],t);a.create=function(w,r){return w===h.ViewingMode.Global?new m(r):new t(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;
var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P){const Q=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(ha){function ia(ma){ma=ha.call(this,ma)||this;ma._handles=new u;ma._spatialReference=null;ma._renderSR=null;ma._overlaySREqualsRenderSR=!0;ma._drapeSources=new Set;ma._drapeTargets=new Set;ma._placementDirty=!1;ma._contentUpdated=!1;ma._drawTexturesDirty=
!1;ma._drawTexturesAnimateDirty=!1;ma._hasUnusedRenderTargets=!1;ma._longitudeCyclical=null;ma._latestOriginId=0;ma._maxResolution=q("esri-mobile")?2048:4096;ma._animationTimeLast=0;ma._removeRenderOverlayCallback=()=>{};return ma}b._inherits(ia,ha);var oa=ia.prototype;oa.initialize=function(){const ma=this.view;this.renderer=new O.OverlayRenderer({view:ma,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const fa=()=>this.setDrawTexturesDirty();this._groundIntersector=
H.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{fa();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",aa=>ma._stage?.renderer.setParameters({hasOverlayWater:aa})),this.renderer.events.on("renders-occluded",()=>{fa();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
fa),f.watch(()=>ma.state.camera.pixelRatio,fa),f.watch(()=>ma.state.alignPixelEnabled,fa),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),f.watch(()=>[ma.pointsOfInterest?.renderPointOfView,ma.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),f.watch(()=>[ma.state?.pixelRatio,ma.state?.contentPixelRatio],()=>this.setPlacementDirty(),f.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ma.on("resize",()=>this.setPlacementDirty()),
ma.resourceController.scheduler.registerTask(P.TaskPriority.OVERLAY,this),ma._stage.renderView.events.on("force-camera-for-screenshot",aa=>{this._updateOverlays(P.noBudget,aa.camera,I.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,I.RenderRequestType.BACKGROUND,aa)})]);let ba=aa=>this._renderOverlayCallback(aa);this._removeRenderOverlayCallback=()=>{ba=()=>{}};ma._stage?.renderer.setParameters({renderOverlay:aa=>ba(aa)})};oa._renderOverlayCallback=
function(ma){this._contentUpdated=!1;const fa=this.renderer;fa.processSyncDrapeSources();fa.hasOverlays&&(this._dispatchAnimationUpdate(ma),this._drawOverlayTextures(fa.overlays,I.RenderRequestType.UPDATE,this.view.state));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()};oa.destroy=function(){this._handles=d.destroyMaybe(this._handles);this._removeRenderOverlayCallback();this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}});null!=S&&(S.hide(),S=null)};oa.setSpatialReference=
function(ma){this._spatialReference=ma;this.renderer.spatialReference=ma;this._longitudeCyclical=null;const fa=this.view.renderSpatialReference;null!=ma&&null!=fa?(this._renderSR=fa,this._overlaySREqualsRenderSR=ma.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ma.isWebMercator?new p.Cyclical(-2.0037508342787E7,2.0037508342787E7):new p.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):
this.renderer.disposeOverlays()};oa.registerDrapeSource=function(ma,fa,ba){this._drapeSources.add(ma);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);fa=this.renderer.createDrapeSourceRenderer(ma,fa,ba);this._updateDrapeSourceExtent(ma);this._setContentDirty();this.notifyChange("running");return fa};oa.registerGeometryDrapeSource=function(ma){return this.registerDrapeSource(ma,R.SortedRenderGeometryRenderer)};oa._updateDrapeSourceExtent=function(ma){2===this.renderer.overlays.length&&
null!=ma.setDrapingExtent&&null!=this._spatialReference&&ma.setDrapingExtent(this.renderer.overlays,this._spatialReference)};oa.unregisterDrapeSource=function(ma){this._drapeSources.has(ma)&&(this._drapeSources.delete(ma),this.renderer.removeDrapeSourceRenderer(ma),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};oa.registerDrapeTarget=function(ma){this._drapeTargets.add(ma);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};
oa.updateOverlayResult=function(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})};oa.unregisterDrapeTarget=function(ma){this._drapeTargets.delete(ma);this.renderer.ensureDrapeTargets(this._drapeTargets)};oa._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};oa.setPlacementDirty=function(){this._placementDirty=!0};oa.runTask=function(ma){return this._updateOverlays(ma,this.view.state.contentCamera,I.RenderRequestType.UPDATE)};oa._updateOverlays=
function(ma,fa,ba){if(!this._spatialReference)return P.Task.YIELD;var aa=this._computeOverlayResolution(fa);this._computeOverlayExtents(fa,aa,X);const da=A.width(X.inner)/A.width(X.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);fa=this._updateOverlay(G.OverlayIndex.INNER,X.inner,aa,1*X.pixelRatioAdjustment,X.mapUnitsPerPixel);aa=this._updateOverlay(G.OverlayIndex.OUTER,X.outer,aa,da*X.pixelRatioAdjustment,X.mapUnitsPerPixel);if(fa===ja.EXTENT||aa===ja.EXTENT)this._drapeSources.forEach(ca=>
this._updateDrapeSourceExtent(ca)),this.surface.updateTileOverlayParams(ba);fa===ja.NONE&&aa===ja.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;ma.madeProgress()};oa._computeOverlayResolution=function(ma){const fa=this.view.state.contentPixelRatio;return Math.min(W.applyTextureResizeModulo(Math.ceil(1.5*Math.max(ma.fullWidth/ma.pixelRatio*fa,ma.fullHeight/ma.pixelRatio*fa))),this._maxResolution)};oa._updateOverlay=function(ma,fa,ba,aa,da){if(0===this.renderer.overlays.length)return ja.NONE;
ma=this.renderer.overlays[ma];const ca=ma.mapUnitsPerPixel;ma.mapUnitsPerPixel=da;ma.pixelRatio=aa;aa=ma.extent;const na=M.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(fa[2]-fa[0],fa[3]-fa[1],aa[2]-aa[0],aa[3]-aa[1]);if(Math.abs(aa[0]-fa[0])<=na&&Math.abs(aa[1]-fa[1])<=na&&Math.abs(aa[2]-fa[2])<=na&&Math.abs(aa[3]-fa[3])<=na&&ba===ma.resolution)return ca===da?ja.NONE:ja.RERENDER_ONLY;A.copy(ma.extent,fa);ma.resolution=ba;fa=A.center(ma.extent);ma.renderLocalOrigin=J.fromValues(fa[0],fa[1],0,`OV_${this._latestOriginId++}`);
return ja.EXTENT};oa.setTileParameters=function(ma){const fa=ma.renderData.overlay;if(0<this.renderer.overlays.length){const ba=this.renderer.overlays[G.OverlayIndex.INNER],aa=this.renderer.overlays[G.OverlayIndex.OUTER];ma=ma.extent;this._rectInsideRect(ba.extent,ma)||this._rectanglesOverlap(ma,ba.extent)||this._rectanglesOverlap(ma,aa.extent)?(this._setTileOverlayData(ma,G.OverlayIndex.INNER,fa),this._setTileOverlayData(ma,G.OverlayIndex.OUTER,fa)):(this._clearTileOverlayData(G.OverlayIndex.INNER,
fa),this._clearTileOverlayData(G.OverlayIndex.OUTER,fa))}else this._clearTileOverlayData(G.OverlayIndex.INNER,fa),this._clearTileOverlayData(G.OverlayIndex.OUTER,fa)};oa.overlayPixelSizeInMapUnits=function(ma){if(0===this.renderer.overlays.length)return 0;const fa=this.renderer.overlays[G.OverlayIndex.INNER],ba=this.renderer.overlays[G.OverlayIndex.OUTER];ma=this._pointIsInExtent(ma,fa.extent)?fa:ba;return(ma.extent[2]-ma.extent[0])/ma.resolution};oa._setTileOverlayData=function(ma,fa,ba){if(0!==
this.renderer.overlays.length){var aa=this.renderer.overlays[fa].extent,da=A.width(aa),ca=A.height(aa),na=ma[0];if(this._longitudeCyclical){na=this._longitudeCyclical.minimalMonotonic(aa[0],na);const qa=this._longitudeCyclical.minimalMonotonic(aa[0],ma[2]);na>qa&&(na=qa-(ma[2]-ma[0]))}ba.setScale(fa,A.width(ma)/da,A.height(ma)/ca);ba.setOffset(fa,(na-aa[0])/da,(ma[1]-aa[1])/ca)}};oa._clearTileOverlayData=function(ma,fa){fa.setScale(ma,-1,-1);fa.setOffset(ma,-1,-1)};oa.reloadShaders=async function(){T.removeLoadedShaderModules();
await this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(P.noBudget)};oa._dispatchAnimationUpdate=function(ma){var fa=g.Milliseconds(ma-this._animationTimeLast);if(fa>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty)fa=g.Milliseconds(fa/this.surface.view._stage.renderer.animationTimeDilation),fa=new N.UpdateParameters(this.view.state.camera,fa,this.view.state.forcedAnimationTime),
this.renderer.updateAnimation(fa)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=ma};oa.setDrawTexturesDirty=function(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()};oa._intersectGroundFromView=function(ma,fa,ba,aa){ba=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ma,ea,fa,ba);if(null==ba)return!1;fa=ba.origin;ba=m.add(V,ba.origin,ba.direction);this._groundIntersector.reset(fa,
ba,ma);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,null,fa,ba);return this._groundIntersector.results.min.getIntersectionPoint(aa)};oa._findHorizonBasedPointOfInterest=function(ma,fa){var ba=.5;ba=this.view.renderCoordsHelper.getAltitude(ma.eye);const aa=this.view.pointsOfInterest.centerOnSurfaceFrequent;var da=k.clamp(aa.estimatedSurfaceAltitude,ma.aboveGround?-Infinity:ba+1E-5,ma.aboveGround?ba-1E-5:Infinity);ba=ma.aboveGround;if("global"===this.view.viewingMode){var ca=
V;B.closestPointOnSilhouette(B.fromRadius(B.tmpSphere,x.getReferenceEllipsoid(this.view.spatialReference).radius+da),v.wrap(ma.eye,ma.viewForward),ca);m.subtract(ca,ca,ma.eye);da=p.cyclicalPI.normalize(C.angleAroundAxis(ma.viewForward,ca,ma.viewRight))/ma.fovY+.5;ca=0>=da||1<=da?.5:.55;ba=ba?ca*da:da+ca*(1-da)}else da=r.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ma.viewForward[2])),1,0),da=w.transformMat4(da,da,ma.projectionMatrix)[1],da=k.clamp(.5+.5*da,0,1),ba=1===da||0===da?.5:ba?.55*da:1-.55*
(1-da);return this._intersectGroundFromView(ma,.5,ba,fa)?m.sqrDist(fa,ma.eye)<aa.distance*aa.distance:!1};oa._computeOverlayExtents=function(ma,fa,ba){var aa=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const da=t.create();this._findHorizonBasedPointOfInterest(ma,da)||m.copy(da,aa);M.OVERLAY_SHOW_CENTER?(null==S&&(S=new K.PointGraphics(this.view.graphics,"red")),S.show(da,this._renderSR)):null!=S&&S.hide();var ca=Math.max(.1,m.distance(ma.eye,da));const na=F.viewAngle(this.view.renderCoordsHelper,
aa,ma.eye);this._overlaySREqualsRenderSR||D.projectVectorToVector(da,this._renderSR,da,this._spatialReference);aa=this.surface.extent;var qa=!this._isSpherical&&null!=this._spatialReference&&this._spatialReference.isGeographic,ua=qa&&null!=this._spatialReference?1/x.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ca=ma.perScreenPixelRatio/this.view.state.contentPixelRatio*ca*ua;ba.mapUnitsPerPixel=ca/this._worldToPCSRatio;ca=fa*ca/2*L.OverlayStretch;var sa=!1;qa=qa?90:Infinity;this._isSpherical&&
null!=aa&&null!=this._spatialReference&&(this._spatialReference.isWebMercator?(ca/=Math.cos(E.y2lat(da[1])),qa=aa[3]):(sa=!0,ca/=x.getReferenceEllipsoid(this._spatialReference).metersPerDegree,qa=90),ca>=qa&&(ca=qa,da[1]=0,this._spatialReference.isWebMercator&&(da[0]=0)));ua=1;sa&&(ua=1/Math.max(.2,Math.cos(Math.abs(k.deg2rad(da[1])))),180<ca*ua&&(ua=180/ca),ba.mapUnitsPerPixel*=ua);sa=Math.log(2)/12;ca=Math.exp(Math.round(Math.log(ca)/sa)*sa);const pa=ca*ua;sa=.5*fa/(32*pa);var ka=.5*fa/(32*ca);
da[0]=Math.round(da[0]*sa)/sa;da[1]=Math.round(da[1]*ka)/ka;sa=ba.inner;sa[0]=da[0]-pa;sa[1]=da[1]-ca;sa[2]=da[0]+pa;sa[3]=da[1]+ca;this._isSpherical&&this._shiftExtentToFitBounds(sa,Infinity,qa);ka=ba.outer;6*pa>A.width(aa)?A.copy(ka,aa):Math.PI/2-Math.abs(na-Math.PI/2)<=.25*Math.PI?(ka[0]=sa[0]-pa,ka[1]=sa[1]-ca,ka[2]=sa[2]+pa,ka[3]=sa[3]+ca):(D.projectVectorToVector(ma.eye,this._renderSR,V,this._spatialReference),l.subtract(U,da,V),ma=-Math.atan2(U[1],U[0])+.125*Math.PI,0>ma&&(ma+=2*Math.PI),w.scale(U,
Q[Math.floor(ma/(.25*Math.PI))],2*ca),U[0]*=ua,U[2]*=ua,w.add(ka,sa,U));this._isSpherical?(ka[0]=this._longitudeCyclical.clamp(ka[0]),ka[2]=this._longitudeCyclical.clamp(ka[2]),ka[1]=Math.max(ka[1],-qa),ka[3]=Math.min(ka[3],qa)):(ma=A.intersection(sa,aa,Y),aa=A.intersection(ka,aa,Z),A.contains(ma,aa)&&(ka[2]=ka[0],ka[3]=ka[1]));fa=Math.abs(sa[2]-sa[0])/fa;ba.mapUnitsPerPixel=Math.max(ba.mapUnitsPerPixel,fa);ba.pixelRatioAdjustment=ba.mapUnitsPerPixel/fa};oa._drawOverlayTextures=function(ma,fa,ba){if(0!==
ma.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var aa=this._drawTexturesDirty;this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1;var da=this._drawOverlay(ma[G.OverlayIndex.INNER],ba);ma=this._drawOverlay(ma[G.OverlayIndex.OUTER],ba);da!==I.ValidationState.CHANGED&&ma!==I.ValidationState.CHANGED||this.surface.updateTileOverlayParams(I.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateOverlayResult();aa?(this.surface.requestRender(fa),fa===I.RenderRequestType.UPDATE&&
this.surface.requestUpdate()):this.surface.requestRender(I.RenderRequestType.BACKGROUND)}};oa._drawOverlay=function(ma,fa){this._longitudeCyclical?ma.setupGeometryViewsCyclical(this._longitudeCyclical):ma.setupGeometryViewsDirect();return ma.draw(this.renderer,fa)};oa._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())};oa._rectanglesOverlap=function(ma,fa){return null==
ma?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(fa[0],fa[2],ma[0])||this._longitudeCyclical.contains(fa[0],fa[2],ma[2])||this._longitudeCyclical.contains(ma[0],ma[2],fa[0]))&&!(ma[1]>fa[3]||ma[3]<fa[1]):A.intersects(ma,fa)};oa._rectInsideRect=function(ma,fa){return null==fa?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ma[0],ma[2],fa[0])&&this._longitudeCyclical.contains(ma[0],ma[2],fa[2])&&fa[1]>ma[1]&&fa[3]<ma[3]:A.contains(ma,fa)};oa._pointIsInExtent=function(ma,fa){if(this._longitudeCyclical)return this._longitudeCyclical.contains(fa[0],
fa[2],ma.x)&&ma.y>=fa[1]&&ma.y<=fa[3];const ba=ma.x;ma=ma.y;return ba>fa[0]&&ba<fa[2]&&ma>fa[1]&&ma<fa[3]};oa._shiftExtentToFitBounds=function(ma,fa,ba){let aa=0,da=0;ma[0]<-fa?aa=ma[0]+fa:ma[2]>fa&&(aa=fa-ma[2]);ma[1]<-ba?da=ma[1]+ba:ma[3]>ba&&(da=ba-ma[3]);A.offset(ma,aa,da)};b._createClass(ia,[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||M.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},
{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?x.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"suspended",get:function(){return this.surface.suspended}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},
{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask(P.noBudget)}}}]);return ia}(y);c.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([e.property()],
a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([e.property({autoDestroy:!0})],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],
a.OverlayManager.prototype,"surface",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"suspended",null);c.__decorate([e.property()],a.OverlayManager.prototype,"updating",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([n.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const U=r.create(),V=t.create(),
X={inner:A.create(),outer:A.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Y=A.create(),Z=A.create(),ea=v.create();var ja;(function(ha){ha[ha.NONE=0]="NONE";ha[ha.EXTENT=1]="EXTENT";ha[ha.RERENDER_ONLY=2]="RERENDER_ONLY"})(ja||(ja={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const c=Object.keys(b);for(const y of c)-1!==
y.search(".glsl")&&delete b[y]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./ITile ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(n){function l(t,w,r){var x=n.call(this)||this;x._horizontalScaleFactor=1;x._extentInRenderSR=q.create();void 0!==t&&x.init(t,w,r);return x}b._inherits(l,n);var m=l.prototype;m.init=function(t,w,r){b._get(b._getPrototypeOf(l.prototype),"init",this).call(this,t,w,r);t=r.view.renderSpatialReference;r=r.spatialReference;this._horizontalScaleFactor=w=null!=t&&k.isPlateCarree(t)&&null!=r&&r.isGeographic?this.ellipsoid.radius*Math.PI/180:1;r=this._extentInRenderSR;
t=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)w=c.fromValues(t[0],t[1],0),y.projectVectorToVector(w,p.WebMercator,w,p.PlateCarree),t=c.fromValues(t[2],t[3],0),y.projectVectorToVector(t,p.WebMercator,t,p.PlateCarree),r[0]=w[0],r[1]=w[1],r[2]=t[0],r[3]=t[1];else for(let x=0;4>x;++x)r[x]=t[x]*w;this.centerAtSeaLevel[0]=.5*(r[0]+r[2]);this.centerAtSeaLevel[1]=.5*(r[1]+r[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(r[2]-r[0],r[3]-r[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};
m.updateRadiusAndCenter=function(){this._updateCenter();var t=this._extentInRenderSR;const w=.5*(t[2]-t[0]);t=.5*(t[3]-t[1]);this._center[g.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(w*w+t*t),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};m._calculateFrustumVisibilityStatus=function(t){var w=this._aabb();const r=w[0],x=w[1],D=w[2],A=w[3],v=w[4];w=w[5];let B=!0;for(let E=0;6>E;E++){var C=t[E];const F=C[0],M=C[1],K=C[2];C=C[3];if(0<=F*(0<F?r:A)+M*(0<M?x:v)+K*(0<K?D:w)+C)return d.TileFrustumVisibility.OUTSIDE;
B=B&&0>=F*(0>F?r:A)+M*(0>M?x:v)+K*(0>K?D:w)+C}return B?d.TileFrustumVisibility.INSIDE:d.TileFrustumVisibility.INTERSECTS};m._aabb=function(){const t=this._extentInRenderSR;return u.wrap(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])};m.intersectsRay=function(t,w,r,x){z[0]=1/w[0];z[1]=1/w[1];z[2]=1/w[2];return e.intersectAabbInvDirBefore(this._aabb(),t,z,r,x)};m.createGeometry=function(){f.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()};
m.getDefaultVerticesPerSide=function(){return 9>this.level?3:2};m.updateCornerElevations=function(){f.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)};m.updateEdgeElevations=function(){f.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)};b._createClass(l,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]);return l}(g.Tile);const z=c.create();a.PlanarPatch=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./ITile ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(H){var J=H.tile;if(J.intersectsClippingArea){var N=H.geometryState,R=N.numVerticesPerSide,W=R-2;--R;var T=H.geometry,P=T.vertexAttributes,Q=P.position,S=P.uv0,{typedBuffer:U,typedBufferStride:V}=P.normalCompressed,X=J.extent;P=X[0];var Y=X[2],Z=X[1];X=X[3];J=J.ellipsoid.radius;N=N.samplerData;var ea=H.localOrigin;H=ea[0];var ja=ea[1];ea=ea[2];var ha=Q.typedBuffer;Q=Q.typedBufferStride;var ia=1/R;T=T.boundingBox;var oa=0;if(1<=W){var ma=Z*(1-ia)+X*
ia,fa=L.sinLatLUT[1],ba=L.cosLatLUT[1];for(var aa=1;aa<=W;aa++){var da=aa*ia,ca=L.sinLonLUT[aa],na=L.cosLonLUT[aa],qa=J+u.sampleElevation(P*(1-da)+Y*da,ma,N);na=-H+qa*na*ba;ca=-ja+qa*ca*ba;qa=-ea+qa*fa;d.minMaxBoundingBox(na,ca,qa,T);var ua=(aa-1)*Q;ha[ua]=na;ha[ua+1]=ca;ha[ua+2]=qa;d.encodeUVInBuffer(S,aa-1,da,ia)}}for(ma=1;ma<=W;ma++){fa=ma*ia;fa=Z*(1-fa)+X*fa;ba=L.sinLatLUT[ma];aa=L.cosLatLUT[ma];ca=ma+1;da=ca*ia;na=Z*(1-da)+X*da;qa=L.sinLatLUT[ca];ca=L.cosLatLUT[ca];var sa=L.sinLonLUT[0];ua=L.cosLonLUT[0];
var pa=J+u.sampleElevation(P,fa,N);ua=ua*aa*pa-H;sa=sa*aa*pa-ja;pa=ba*pa-ea;var ka=oa*Q;let cb=ha[ka],la=ha[ka+1];ka=ha[ka+2];for(let eb=1;eb<=W;eb++){var ra=eb*ia,va=P*(1-ra)+Y*ra,Ca=L.sinLonLUT[eb],Ba=L.cosLonLUT[eb],Ha=0,Ma=0,Qa=0;eb<W?(Qa=(oa+1)*Q,Ha=ha[Qa],Ma=ha[Qa+1],Qa=ha[Qa+2]):(Ma=L.sinLonLUT[R],Ha=L.cosLonLUT[R],Qa=J+u.sampleElevation(Y,fa,N),Ha=Ha*aa*Qa-H,Ma=Ma*aa*Qa-ja,Qa=ba*Qa-ea);var Sa=ua,La=sa,Ua=pa;ua=cb;sa=la;pa=ka;cb=Ha;la=Ma;ka=Qa;Ha-=Sa;Ma-=La;Qa-=Ua;Sa=La=Ua=0;if(1<ma)Sa=(oa-
W)*Q,Ua=ha[Sa],La=ha[Sa+1],Sa=ha[Sa+2];else{Sa=L.sinLatLUT[0];La=L.cosLatLUT[0];var Va=J+u.sampleElevation(va,Z,N);Ua=Ba*La*Va-H;La=Ca*La*Va-ja;Sa=Sa*Va-ea}Va=J+u.sampleElevation(va,na,N);const ib=Ba*ca*Va-H;va=Ca*ca*Va-ja;Va=qa*Va-ea;if(ma<W){const Pa=oa+W,za=Pa*Q;ha[za]=ib;ha[za+1]=va;ha[za+2]=Va;d.minMaxBoundingBox(ib,va,Va,T);d.encodeUVInBuffer(S,Pa,ra,da)}ra=Ua-ib;va=La-va;Ua=Sa-Va;Ba*=aa;Ca*=aa;La=ba;.999>La*La&&(Ba=Qa*va-Ma*Ua,Ca=Ha*Ua-Qa*ra,La=Ma*ra-Ha*va);ra=1/Math.sqrt(Ba*Ba+Ca*Ca+La*La);
n.compressNormal(U,oa,Ba*ra,Ca*ra,La*ra,V);++oa}}}}function m(H){H.tile.intersectsClippingArea&&(E(H),t(H))}function t(H,J=!1){var N=H.geometryState;const R=H.geometry,W=N.neighborData,T=H.tile,P=T.level,Q=T.extent,S=T.ellipsoid.radius;var U=T.extentInRadians;const V=U[0],X=U[2],Y=U[1];U=U[3];const Z=N.samplerData,ea=Q[0],ja=Q[2],ha=Q[1],ia=Q[3],oa=w(H),ma=R.boundingBox;N=H.localOrigin;const fa=N[0],ba=N[1],aa=N[2];N=R.vertexAttributes;var da=N.position;const ca=da.typedBuffer,na=da.typedBufferStride,
qa=N.uv0;for(let pa=0;4>pa;++pa){const ka=1===pa||3===pa;N=W.edgeResolutions[pa];e.internalAssert(b.isPowerOfTwo(N));const ra=N+1;var ua=g.neighborTileIfLoadedOrSelf(T,W.edgePeerNeighbors[pa]);if(K(T,ua,pa)){C(H,pa,ua);continue}const va=null!=ua;e.internalAssert(!va||ua.level===T.level);e.internalAssert(!va||0>=z.compareTilesByLij(T,ua));da=ua?.renderData?.geometryState;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS){var sa=T.surface;if(!ua&&sa&&!sa.updatingRootTiles){const ya=e.neighborEdgeIndices[pa],Ea=T.findNeighborTile(ya,
Oa=>Oa.isLoaded||Oa.isLeaf||Oa.level===T.level);Ea?Ea.intersectsClippingArea&&(e.internalAssert(!Ea.isLoaded),e.internalAssert(!Ea.isLeaf),e.internalAssert(Ea.level===P)):e.internalAssert(null==sa?.rootTiles||!T.shouldHaveNeighbor(ya))}}const Ca=1===pa?Q[2]:Q[0],Ba=(ua=ua?.extent)&&ka?1===pa?ua[0]:ua[2]:Ca,Ha=0===pa?Q[3]:Q[1],Ma=1===pa?1:0,Qa=0===pa?1:0,Sa=1===pa?X:V,La=0===pa?U:Y,Ua=Math.sin(Sa),Va=Math.cos(Sa),cb=Math.sin(La),la=Math.cos(La),eb=da?.samplerData;da=(ya,Ea,Oa)=>u.sampleElevation(ya,
Ea,Z);sa=(ya,Ea,Oa)=>.5*(u.sampleElevation(ya,Ea,Z)+u.sampleElevation(Oa,Ea,eb));const ib=va?sa:da,Pa=R.outerEdges[pa],za=J&&3<ra?ra-3:1;da=null!=Z&&Z.some(ya=>null!=ya);sa=null!=eb&&eb.some(ya=>null!=ya);const Ga=da||sa,Fa=1/N,xa=Pa.index0;e.internalAssert(!ua||e.almostEquals(ua[2]-ua[0],Q[2]-Q[0]));(()=>{const ya=1===pa?-1:3===pa?1:0,Ea=0===pa?-1:2===pa?1:0,Oa=(Q[2]-Q[0])*Fa,bb=ya*Oa,db=Ea*Oa,nb=X-V,kb=ka?ya*nb*Fa:0,wb=ka?0:Ea*Fa,vb=Qa,sb=ka?Sa+kb:Sa,Ab=ka?Math.sin(sb):Ua,Ib=ka?Math.cos(sb):Va,
rb=ka?Sa-kb:Sa,Fb=ka?Math.sin(rb):Ua,hb=ka?Math.cos(rb):Va,Ja=ka?La:oa(vb+wb),Na=ka?cb:Math.sin(Ja),Xa=ka?la:Math.cos(Ja),fb=ka?La:oa(vb-wb),jb=ka?cb:Math.sin(fb),ab=ka?la:Math.cos(fb);let pb=0,tb=0,Ya=0;const wa=0*Fa,Ia=ka?Ca:ea*(1-wa)+ja*wa,Ra=ka?Ba:Ia,Ta=ka?ha*(1-wa)+ia*wa:Ha,Za=ka?Sa:V*(1-wa)+X*wa,gb=ka?Ua:Math.sin(Za),lb=ka?Va:Math.cos(Za),ob=ka?oa(wa):La,ub=ka?Math.sin(ob):cb,yb=ka?Math.cos(ob):la,Bb=S+ib(Ia,Ta,Ra);pb=lb*yb*Bb;tb=gb*yb*Bb;Ya=ub*Bb;let Gb=0,Kb=0,Ob=0;const qb=1*Fa,xb=ka?Ca:ea*
(1-qb)+ja*qb,zb=ka?Ba:xb,Hb=ka?ha*(1-qb)+ia*qb:Ha,Jb=ka?Sa:V*(1-qb)+X*qb,Yb=ka?Ua:Math.sin(Jb),Cb=ka?Va:Math.cos(Jb),Sb=ka?oa(qb):La,Tb=ka?Math.sin(Sb):cb,hc=ka?Math.cos(Sb):la,cc=S+ib(xb,Hb,zb);Gb=Cb*hc*cc;Kb=Yb*hc*cc;Ob=Tb*cc;for(let Vb=1;Vb<ra-1;Vb+=za){let ic=0,Zb=0,$b=0;const ac=(Vb+1)*Fa,Lb=ka?Ca:ea*(1-ac)+ja*ac,lc=ka?Ba:Lb,Pb=ka?ha*(1-ac)+ia*ac:Ha,Ub=ka?Sa:V*(1-ac)+X*ac,vc=ka?Ua:Math.sin(Ub),Dc=ka?Va:Math.cos(Ub),Ec=ka?oa(ac):La,$c=ka?Math.sin(Ec):cb,zd=ka?Math.cos(Ec):la,Fc=S+ib(Lb,Pb,lc);
ic=Dc*zd*Fc;Zb=vc*zd*Fc;$b=$c*Fc;const Ad=ic,Bd=Zb,Cd=$b,ad=Gb,Gc=Kb,bd=Ob;Gb=Ad;Kb=Bd;Ob=Cd;const cd=xa+Vb,dd=cd*na,Dd=ad-fa,Ed=Gc-ba,Fd=bd-aa;ca[dd]=Dd;ca[dd+1]=Ed;ca[dd+2]=Fd;d.minMaxBoundingBox(Dd,Ed,Fd,ma);const Gd=Vb*Fa;d.encodeUVInBuffer(qa,cd,ka?Ma:Gd,ka?Gd:Qa);const ve=pb,ed=tb,fd=Ya;pb=ad;tb=Gc;Ya=bd;const Ac=ad,Bc=Gc,wc=bd,Hc=1/Math.sqrt(Ac*Ac+Bc*Bc+wc*wc),Hd=wc*Hc;let xc=0,yc=0,pc=0;if(Ga&&.999>Hd*Hd){let gd=0,Ic=0,Jc=0;const hd=0===pa?-1:1;gd=hd*(Ad-ve);Ic=hd*(Bd-ed);Jc=hd*(Cd-fd);const qc=
Vb*Fa,Id=ka?Ca:ea*(1-qc)+ja*qc,we=ka?Ba:Id,Jd=ka?ha*(1-qc)+ia*qc:Ha,Kd=ka?Sa:V*(1-qc)+X*qc,Ld=ka?Ua:Math.sin(Kd),Md=ka?Va:Math.cos(Kd),Nd=ka?oa(qc):La,Od=ka?Math.sin(Nd):cb,Pd=ka?Math.cos(Nd):la;let id=Ac,jd=Bc,kd=wc;if(va){const ld=S+u.sampleElevation(we-bb,Jd-db,eb),xe=ka?Fb:Ld,ye=ka?Od:jb,Qd=ka?Pd:ab;id=(ka?hb:Md)*Qd*ld;jd=xe*Qd*ld;kd=ye*ld}const md=S+u.sampleElevation(Id+bb,Jd+db,Z),Rd=ka?Pd:Xa,Sd=(ka?Ib:Md)*Rd*md,Td=(ka?Ab:Ld)*Rd*md,Ud=(ka?Od:Na)*md;va||(id=2*Ac-Sd,jd=2*Bc-Td,kd=2*wc-Ud);const nd=
3===pa?-1:1,Vd=nd*(id-Sd),Wd=nd*(jd-Td),Xd=nd*(kd-Ud);xc=Jc*Wd-Ic*Xd;yc=gd*Xd-Jc*Vd;pc=Ic*Vd-gd*Wd;const od=1/Math.sqrt(xc*xc+yc*yc+pc*pc);xc*=od;yc*=od;pc*=od}else xc=Ac*Hc,yc=Bc*Hc,pc=wc*Hc;Pa.setNormalFromValues(Vb,xc,yc,pc)}})()}}function w(H){H=H.tile;if(H.surface.isWebMercator){const N=H.extent,R=H.ellipsoid.radius;return W=>Math.PI/2-2*Math.atan(Math.exp(-(N[1]*(1-W)+N[3]*W)/R))}const J=H.extentInRadians;return N=>J[1]*(1-N)+J[3]*N}function r(H){const J=H.tile;if(J.intersectsClippingArea){var N=
H.geometryState,R=N.samplerData,W=H.localOrigin,T=J.surface.isWebMercatorOnPlateeCarree,P=N.clippingArea,Q=null!=P?P:O,S=J.extent,U=S[0],V=S[1],X=S[2],Y=S[3],Z=Math.max(U,Q[0]),ea=Math.min(X,Q[2]),ja=Math.max(V,Q[1]),ha=Math.min(Y,Q[3]),ia=J.ellipsoid.radius,oa=J.horizontalScale,ma=N.numVerticesPerSide,fa=ma-1,ba=ma-2,aa=H.geometry,da=aa.vertexAttributes,ca=da.position,na=da.uv0,{typedBuffer:qa,typedBufferStride:ua}=da.normalCompressed,sa=aa.uvRange,pa=sa[0],ka=sa[1],ra=sa[2],va=sa[3],Ca=aa.boundingBox,
Ba=W[0],Ha=W[1],Ma=W[2],Qa=ca.typedBuffer,Sa=ca.typedBufferStride,La=0,Ua=b.clamp(V,ja,ha),Va=T?(Math.PI/2-2*Math.atan(Math.exp(-Ua/ia)))*ia:Ua*oa,cb=1/fa,la=b.clamp(V*(1-cb)+Y*cb,ja,ha),eb=Va,ib=T?(Math.PI/2-2*Math.atan(Math.exp(-la/ia)))*ia:la*oa;for(let Pa=1;Pa<=ba;Pa++){const za=Pa/fa,Ga=b.clamp(V*(1-za)+Y*za,ja,ha),Fa=b.clamp(za,ka,va),xa=ib,ya=(Pa-1)/fa,Ea=b.clamp(V*(1-ya)+Y*ya,ja,ha),Oa=eb,bb=(Pa+1)/fa,db=b.clamp(V*(1-bb)+Y*bb,ja,ha),nb=T?(Math.PI/2-2*Math.atan(Math.exp(-db/ia)))*ia:db*oa,
kb=b.clamp(bb,ka,va);eb=ib;ib=nb;const wb=b.clamp(U,Z,ea);let vb=wb*oa,sb=u.sampleElevation(wb,Ga,R);const Ab=1/fa,Ib=b.clamp(Ab,pa,ra),rb=b.clamp(U*(1-Ib)+X*Ib,Z,ea);let Fb=Ib,hb=rb,Ja=rb*oa,Na=u.sampleElevation(rb,Ga,R);if(1===Pa){const Xa=Ja-Ba,fb=eb-Ha,jb=Na-Ma,ab=0*Sa;Qa[ab]=Xa;Qa[ab+1]=fb;Qa[ab+2]=jb;d.minMaxBoundingBox(Xa,fb,jb,Ca);const pb=b.clamp(Ab,pa,ra);d.encodeUVInBuffer(na,La,pb,Fa)}for(let Xa=1;Xa<=ba;Xa++){const fb=Ja,jb=Na,ab=(Xa+1)/fa,pb=b.clamp(ab,pa,ra),tb=b.clamp(U*(1-ab)+X*ab,
Z,ea),Ya=hb;hb=tb;const wa=La+1,Ia=wa*Sa;if(1===Pa||Xa===ba){const xb=u.sampleElevation(tb,Ga,R),zb=tb*oa,Hb=xa,Jb=xb;if(1===Pa&&Xa<ba){const Yb=zb-Ba,Cb=Hb-Ha,Sb=Jb-Ma;Qa[Ia]=Yb;Qa[Ia+1]=Cb;Qa[Ia+2]=Sb;d.minMaxBoundingBox(Yb,Cb,Sb,Ca);d.encodeUVInBuffer(na,wa,pb,Fa)}Ja=zb;Na=Jb}else Ja=Qa[Ia]+Ba,Na=Qa[Ia+2]+Ma;const Ra=Ja,Ta=Na,Za=vb,gb=sb;vb=fb;sb=jb;const lb=(La-ba)*Sa,ob=1===Pa?u.sampleElevation(Ya,Ea,R):Qa[lb+2]+Ma,ub=u.sampleElevation(Ya,db,R);if(Pa<ba){const xb=La+ba,zb=xb*Sa,Hb=fb-Ba,Jb=nb-
Ha,Yb=ub-Ma;Qa[zb]=Hb;Qa[zb+1]=Jb;Qa[zb+2]=Yb;d.minMaxBoundingBox(Hb,Jb,Yb,Ca);const Cb=Fb;Fb=pb;d.encodeUVInBuffer(na,xb,Cb,kb)}const yb=Ra-Za,Bb=Oa-nb,Gb=Bb*(Ta-gb),Kb=yb*(ob-ub),Ob=-Bb*yb,qb=Gb*Gb+Kb*Kb+Ob*Ob;if(0===qb)n.compressNormal(qa,La,0,0,1,ua);else{const xb=1/Math.sqrt(qb);n.compressNormal(qa,La,Gb*xb,Kb*xb,Ob*xb,ua)}++La}}}}function x(H,J){H.tile.intersectsClippingArea&&(E(H),D(H,!1))}function D(H,J){const N=H.geometryState,R=N.neighborData,W=H.tile,T=W.surface,P=W.extent,Q=N.clippingArea,
S=null!=Q?Q:O,U=P[0],V=P[2],X=P[1],Y=P[3],Z=[Y>S[3],V>S[2],X<S[1],U<S[0]],ea=H.geometry,ja=W.horizontalScale,ha=A(T.isWebMercatorOnPlateeCarree,W.ellipsoid.radius,ja),ia=ea.boundingBox,oa=ea.uvRange[0],ma=ea.uvRange[1],fa=ea.uvRange[2],ba=ea.uvRange[3],aa=Math.max(U,S[0]),da=Math.min(V,S[2]),ca=Math.max(X,S[1]),na=Math.min(Y,S[3]),qa=H.localOrigin,ua=qa[0],sa=qa[1],pa=qa[2],ka=N.samplerData;for(let ra=0;4>ra;++ra){const va=1===ra||3===ra,Ca=R.edgeResolutions[ra];e.internalAssert(b.isPowerOfTwo(Ca));
const Ba=Ca+1,Ha=Z[ra],Ma=g.neighborTileIfLoadedOrSelf(W,R.edgePeerNeighbors[ra]);if(!Ha&&K(W,Ma,ra)){C(H,ra,Ma);continue}const Qa=null!=Ma&&!Ha,Sa=Ma?.renderData?.geometryState;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!Qa||Ma.level===W.level),e.internalAssert(!Qa||0>=z.compareTilesByLij(W,Ma)),W&&!Ma&&!T.updatingRootTiles)){const ab=e.neighborEdgeIndices[ra],pb=W.findNeighborTile(ab,tb=>tb.isLoaded||tb.isLeaf||tb.level===W.level);T.updatingRootTiles||(pb?pb.intersectsClippingArea&&
(e.internalAssert(!pb.isLoaded),e.internalAssert(!pb.isLeaf),e.internalAssert(pb.level===W.level)):e.internalAssert(null==T?.rootTiles||!W.shouldHaveNeighbor(ab)))}const La=b.clamp(1===ra?V:U,aa,da),Ua=b.clamp(0===ra?Y:X,ca,na),Va=Sa?.samplerData,cb=ea.outerEdges[ra],la=J&&3<Ba?Ba-3:1,eb=b.clamp(1===ra?1:0,oa,fa),ib=b.clamp(0===ra?1:0,ma,ba),Pa=(ab,pb)=>u.sampleElevation(ab,pb,ka),za=(ab,pb)=>.5*(u.sampleElevation(ab,pb,Va)+u.sampleElevation(ab,pb,ka)),Ga=Qa?za:Pa,Fa=(V-U)/Ca,xa=va?1===ra?Fa:-Fa:
0,ya=va?0:0===ra?Fa:-Fa,Ea=-xa,Oa=-ya;let bb=0,db=0,nb=0;const kb=0/Ca,wb=va?La:b.clamp(U*(1-kb)+V*kb,aa,da),vb=va?b.clamp(X*(1-kb)+Y*kb,ca,na):Ua,sb=Ga(wb,vb);bb=wb*ja;db=ha(vb);nb=sb;let Ab=0,Ib=0,rb=0;const Fb=1/Ca,hb=va?La:b.clamp(U*(1-Fb)+V*Fb,aa,da),Ja=va?b.clamp(X*(1-Fb)+Y*Fb,ca,na):Ua,Na=Ga(hb,Ja),Xa=hb*ja,fb=ha(Ja),jb=Na;Ab=Xa;Ib=fb;rb=jb;for(let ab=1;ab<Ba-1;ab+=la){const pb=ab/Ca,tb=Ab,Ya=Ib,wa=rb,Ia=va?eb:b.clamp(pb,oa,fa),Ra=va?b.clamp(pb,ma,ba):ib,Ta=tb-ua,Za=Ya-sa,gb=wa-pa;d.minMaxBoundingBox(tb,
Za,gb,ia);cb.setVertexFromValuesRawPositionUV(ab,Ta,Za,gb,Ia,Ra);const lb=(ab+1)/Ca,ob=va?La:b.clamp(U*(1-lb)+V*lb,aa,da),ub=va?b.clamp(X*(1-lb)+Y*lb,ca,na):Ua,yb=Ga(ob,ub);Ab=ob*ja;Ib=ha(ub);rb=yb;const Bb=Ab,Gb=Ib,Kb=rb,Ob=bb,qb=db,xb=nb;bb=tb;db=Ya;nb=wa;let zb=0,Hb=0,Jb=0;if(va){const Cb=Gb-Ya,Sb=Kb-wa,Tb=qb-Ya,hc=xb-wa,cc=b.clamp(X*(1-pb)+Y*pb,ca,na),Vb=La+Ea,ic=Vb*ja,Zb=u.sampleElevation(Vb,cc,ka),$b=ic-tb,ac=Zb-wa,Lb=3===ra?-1:1;zb=Lb*(-Tb+Cb)*ac;Hb=Lb*$b*(-hc+Sb);Jb=-Lb*$b*(-Tb+Cb);if(Qa){const lc=
La+xa,Pb=lc*ja,Ub=u.sampleElevation(lc,cc,Va),vc=Pb-tb;zb=(-Tb+Cb)*(ac-(Ub-wa));Hb=($b-vc)*(-hc+Sb);Jb=-($b-vc)*(-Tb+Cb)}}else{const Cb=Bb-tb,Sb=Kb-wa,Tb=Ob-tb,hc=xb-wa,cc=b.clamp(U*(1-pb)+V*pb,aa,da),Vb=Ua+Oa,ic=u.sampleElevation(cc,Vb,ka)-wa,Zb=ha(Vb)-Ya,$b=2===ra?-1:1;zb=$b*Zb*(-hc+Sb);Hb=$b*(-Tb+Cb)*ic;Jb=-$b*Zb*(-Tb+Cb);if(Qa){const ac=cc,Lb=Ua+ya,lc=ha(Lb),Pb=u.sampleElevation(ac,Lb,Va)-wa,Ub=lc-Ya;zb=(-Zb+Ub)*(-hc+Sb);Hb=(-Tb+Cb)*(-ic+Pb);Jb=-(-Zb+Ub)*(-Tb+Cb)}}const Yb=1/Math.sqrt(zb*zb+Hb*
Hb+Jb*Jb);cb.setNormalFromValues(ab,zb*Yb,Hb*Yb,Jb*Yb)}}}function A(H,J,N){return H?R=>(Math.PI/2-2*Math.atan(Math.exp(-R/J)))*J:R=>R*N}function v(H,J,N,R,W,T){const P=J-1,Q=H.vertexAttributes.count,S=2*(Math.min(J-2,R[1])-Math.max(1,R[0]))*(Math.min(J-2,W[1])-Math.max(1,W[0])),U=e.neighborEdgeIndices.map((ma,fa)=>0===fa&&W[1]<J-2||1===fa&&R[1]<J-2||2===fa&&1<W[0]||3===fa&&1<R[0]),V=H.outerEdges.reduce((ma,fa,ba)=>ma+(U[ba]?0:P-2+fa.count-1),0),X=N.reduce((ma,fa)=>ma+P*(2*(fa.latitudeResolution-1)+
1),0),Y=T?2:1,Z=3*(S+V+X)*Y,ea=65536<=Q?new Uint32Array(Z):new Uint16Array(Z);let ja=0;const ha=J-2,ia=P-2;e.internalAssert(0<=ia);const oa=(ma,fa,ba,aa,da,ca)=>{var na=ma*da;ma=ca[na];const qa=ca[na+1];na=ca[na+2];var ua=fa*da;fa=ca[ua];const sa=ca[ua+1];ua=ca[ua+2];var pa=ba*da;ba=ca[pa];const ka=ca[pa+1];pa=ca[pa+2];const ra=aa*da;aa=ca[ra];da=ca[ra+1];ca=ca[ra+2];return(fa-aa)*(fa-aa)+(sa-da)*(sa-da)+(ua-ca)*(ua-ca)>(ma-ba)*(ma-ba)+(qa-ka)*(qa-ka)+(na-pa)*(na-pa)};if(T){const ma=(fa,ba,aa)=>{ea[ja++]=
fa;ea[ja++]=ba;ea[ja++]=ba;ea[ja++]=aa;ea[ja++]=aa;ea[ja++]=fa;e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(fa<Q),e.internalAssert(ba<Q),e.internalAssert(aa<Q),e.internalAssert(ja<=Z))};(()=>{for(let fa=Math.max(W[0],1)-1;fa<Math.min(W[1],J-2)-1;++fa){const ba=fa*ha;for(let aa=Math.max(R[0],1)-1;aa<Math.min(R[1],J-2)-1;++aa){const da=fa*ha+aa,ca=da+1,na=ca+ha,qa=na-1,ua=ba+aa,sa=ua+1,pa=sa+ha;oa(ua,sa,pa,pa-1,H.vertexAttributes.position.typedBufferStride,H.vertexAttributes.position.typedBuffer)?
(ma(da,ca,na),ma(na,qa,da)):(ma(da,ca,qa),ma(qa,na,ca))}}})();e.internalAssert(ja===3*S*Y);(()=>{for(let ba=0;4>ba;++ba){const aa=ja;if(U[ba])continue;const da=H.outerEdges[ba],ca=H.innerEdges[ba];let na=0,qa=0;const ua=da.count,sa=ca.count;e.internalAssert(sa===P-1);let pa=0;const ka=1===ba||2===ba?(ra,va,Ca)=>ma(ra,va,Ca):(ra,va,Ca)=>ma(ra,Ca,va);for(;na<ua-1||qa<sa-1;){const ra=ca.getVertexIndex(qa),va=da.getVertexIndex(na);var fa=na<ua-1;const Ca=qa<sa-1,Ba=fa?P*(na+.5)/(ua-1):0,Ha=Ca?1+ia*(qa+
.5)/(sa-1):0;fa&&(!Ca||Ba<=Ha)?(++na,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(na<ua),fa=da.getVertexIndex(na),ka(ra,va,fa)):(++qa,e.ENABLE_TERRAIN_INTERNAL_CHECKS&&e.internalAssert(qa<sa),fa=ca.getVertexIndex(qa),ka(ra,va,fa));pa++}e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(na===ua-1),e.internalAssert(qa===sa-1),e.internalAssert(pa===ua+sa-2),e.internalAssert(pa===P-2+da.count-1),e.internalAssert(ja===aa+3*pa*Y))}})();e.internalAssert(ja===3*(S+V)*Y);N.forEach(fa=>{var ba=H.outerEdges[fa.connectedOuterEdgeOffset];
let aa=ba.getVertexIndex(0);ba=ba.stride;for(let da=0;da<fa.latitudeResolution;++da){const ca=0===da?fa.rowOffset:aa+J;for(let na=0;na<P;na++)ma(aa,aa+1,ca+na),da<fa.latitudeResolution-1&&ma(aa+1,ca+na+1,ca+na),aa+=ba;aa=ca;ba=1}})}else(()=>{var ma=Math.max(W[0],1)-1;const fa=Math.min(W[1],J-2)-1,ba=Math.max(R[0],1)-1,aa=Math.min(R[1],J-2)-1;for(;ma<fa;++ma){const da=ma*ha;for(let ca=ba;ca<aa;++ca){const na=da+ca,qa=na+1,ua=qa+ha,sa=ua-1;oa(na,qa,ua,sa,H.vertexAttributes.position.typedBufferStride,
H.vertexAttributes.position.typedBuffer)?(ea[ja]=na,ea[ja+1]=qa,ea[ja+2]=ua,ea[ja+3]=ua,ea[ja+4]=sa,ea[ja+5]=na):(ea[ja]=na,ea[ja+1]=qa,ea[ja+2]=sa,ea[ja+3]=sa,ea[ja+4]=qa,ea[ja+5]=ua);ja+=6}}})(),e.internalAssert(ja===3*S*Y),(()=>{for(let da=0;4>da;++da){if(U[da])continue;var ma=H.outerEdges[da],fa=H.innerEdges[da];let ca=0,na=0;const qa=ma.count,ua=fa.count;e.internalAssert(ua===P-1);var ba=1===da||2===da;const sa=ba?1:2;ba=ba?2:1;const pa=ma.index0;ma=ma.stride;const ka=fa.index0;for(fa=fa.stride;ca<
qa-1||na<ua-1;){const ra=ka+na*fa,va=pa+ca*ma;var aa=ca<qa-1;const Ca=na<ua-1,Ba=aa?P*(ca+.5)/(qa-1):0,Ha=Ca?1+ia*(na+.5)/(ua-1):0;(aa=aa&&(!Ca||Ba<=Ha))?++ca:++na;aa=aa?va+ma:ra+fa;ea[ja]=ra;ea[ja+sa]=va;ea[ja+ba]=aa;ja+=3}}})(),e.internalAssert(ja===3*(S+V)*Y),N.forEach(ma=>{var fa=H.outerEdges[ma.connectedOuterEdgeOffset];let ba=fa.getVertexIndex(0);fa=fa.stride;for(let aa=0;aa<ma.latitudeResolution;++aa){const da=0===aa?ma.rowOffset:ba+J;for(let ca=0;ca<P;ca++){const na=da+ca;ea[ja]=ba;ea[ja+
1]=ba+1;ea[ja+2]=na;aa<ma.latitudeResolution-1?(ea[ja+3]=ba+1,ea[ja+4]=na+1,ea[ja+5]=na,ja+=6):ja+=3;ba+=fa}ba=da;fa=1}});e.internalAssert(ja===Z);H.indices=ea;H.indexCount=Z}function B(H,J){const N=H.localOrigin,R=H.geometry;H=H.geometryState.neighborData.edgeResolutions;const W=R.numVerticesPerSide-2,T=R.vertexAttributes;for(let Q=0;4>Q;++Q){var P=0===Q||2===Q;R.innerEdges[Q]=new d.EdgeDescriptor(T,N,(0===Q?W-1:0)*W+(1===Q?W-1:0),(P?0:1)*W+(P?1:0),W);P=H[Q]+1;R.outerEdges[Q]=new d.EdgeDescriptor(T,
N,J,1,P);J+=P}}function C(H,J,N){var R=(J+2)%4,W=H.tile,T=W.level-N.level;const P=1===J||3===J,Q=H.geometryState.neighborData.edgeResolutions[J];e.internalAssert(b.isPowerOfTwo(Q));const S=Q+1;var U=H.geometry;const V=U.boundingBox;var X=U.outerEdges[J];const Y=U.uvRange[0],Z=U.uvRange[1],ea=U.uvRange[2];U=U.uvRange[3];const ja=b.clamp(1===J?1:0,Y,ea),ha=b.clamp(0===J?1:0,Z,U);var ia=N.renderData,oa=ia.geometryState,ma=ia.geometry.outerEdges[R];J=W.getNeighborEdgeStartVertexIndex(J,N)*Q;T=Q*2**T;
e.internalAssert(oa.neighborData.edgeResolutions[R]===T);e.internalAssert(ma.count-1===T);R=ia.localOrigin[0]-H.localOrigin[0];T=ia.localOrigin[1]-H.localOrigin[1];H=ia.localOrigin[2]-H.localOrigin[2];var fa=X.attributes;ia=X.index0;X=X.stride;oa=fa.position.typedBuffer;N=fa.position.typedBufferStride;W=fa.normalCompressed.typedBuffer;const ba=fa.normalCompressed.typedBufferStride;fa=fa.uv0;var aa=ma.attributes;const da=ma.index0;ma=ma.stride;const ca=aa.position.typedBuffer,na=aa.position.typedBufferStride,
qa=aa.normalCompressed.typedBuffer;aa=aa.normalCompressed.typedBufferStride;for(let ka=1;ka<S-1;++ka){const ra=ia+X*ka;var ua=da+ma*(J+ka),sa=ra*N,pa=ua*na;const va=ca[pa]+R,Ca=ca[pa+1]+T;pa=ca[pa+2]+H;oa[sa]=va;oa[sa+1]=Ca;oa[sa+2]=pa;d.minMaxBoundingBox(va,Ca,pa,V);sa=ra*ba;ua*=aa;W[sa]=qa[ua];W[sa+1]=qa[ua+1];sa=ka/Q;ua=P?ja:b.clamp(sa,Y,ea);sa=P?b.clamp(sa,Z,U):ha;d.encodeUVInBuffer(fa,ra,ua,sa)}}function E(H){const J=H.geometryState,N=H.localOrigin,R=J.neighborData.cornerNeighborData,W=H.geometry,
T=W.outerEdges,P=W.boundingBox,Q=H.tile,S="local"===H.tile.surface.view?.viewingMode,U=Q.ellipsoid.radius,V=Q.extentInRadians,X=Q.horizontalScale;let Y=0,Z=0,ea=0;const ja=()=>{const Pa=H.geometryState.clippingArea,za=Q.extent,Ga=null!=Pa&&(za[3]>Pa[3]||za[2]>Pa[2]||za[1]<Pa[1]||za[0]<Pa[0]),Fa=A(Q.surface.isWebMercatorOnPlateeCarree,Q.ellipsoid.radius,X);return(xa,ya,Ea)=>{xa=0===xa?pa[0]:pa[2];ya=0===ya?pa[1]:pa[3];xa=Ga?b.clamp(xa,Pa[0],Pa[2]):xa;ya=Ga?b.clamp(ya,Pa[1],Pa[3]):ya;Y=xa*X;Z=Fa(ya);
ea=Ea}},ha=(Pa,za,Ga)=>{var Fa=V[0===za?1:3];Pa=V[0===Pa?0:2];za=Math.cos(Fa);Fa=Math.sin(Fa);const xa=Math.sin(Pa);Ga=U+Ga;Y=Math.cos(Pa)*za*Ga;Z=xa*za*Ga;ea=Fa*Ga},ia=S?ja():ha;let oa=0,ma=0,fa=0,ba=0,aa=0,da=0,ca=0,na=0,qa=0;const ua=S&&H.tile.surface.isWebMercatorOnPlateeCarree,sa=(Pa,za,Ga,Fa,xa)=>{var ya=0,Ea=0;let Oa=0;S?(Ga=ua?(Math.PI/2-2*Math.atan(Math.exp(-Ga/U)))*U:Ga*X,ya=za*X-Y,Ea=Ga-Z,Oa=Fa-ea):(ya=w(Pa),Pa=Pa.tile,Ea=Pa.extent,Pa=Pa.extentInRadians,za=(za-Ea[0])/(Ea[2]-Ea[0]),za=Pa[0]*
(1-za)+Pa[2]*za,ya=ya((Ga-Ea[1])/(Ea[3]-Ea[1])),Ga=Math.cos(ya),Pa=Math.sin(ya),Ea=Math.sin(za),Fa=U+Fa,ya=Math.cos(za)*Ga*Fa-Y,Ea=Ea*Ga*Fa-Z,Oa=Pa*Fa-ea);switch(xa){case 0:ca+=ya;na+=Ea;qa+=Oa;break;case 1:ba-=ya;aa-=Ea;da-=Oa;break;case 2:ca-=ya;na-=Ea;qa-=Oa;break;case 3:ba+=ya,aa+=Ea,da+=Oa}},pa=Q.extent,ka=J.clippingArea,ra=null!=ka?ka:O,va=pa[0],Ca=pa[2],Ba=pa[1],Ha=pa[3],Ma=[Ha>ra[3],Ca>ra[2],Ba<ra[1],va<ra[0]],Qa=Math.max(va,ra[0]),Sa=Math.min(Ca,ra[2]),La=Math.max(Ba,ra[1]),Ua=Math.min(Ha,
ra[3]),Va=W.uvRange[0],cb=W.uvRange[1],la=W.uvRange[2],eb=W.uvRange[3],ib=Pa=>{Pa=R[Pa].cornerTiles;ma=oa=0;fa=1;qa=na=ca=da=aa=ba=0;var za=Infinity;for(var Ga=0;4>Ga;++Ga)za=Math.min(za,Pa[Ga]?.level??Infinity);for(Ga=0;4>Ga;++Ga){var Fa=Pa[Ga];I[Ga]=Fa?.level===za?Fa:null}Pa=1;za=0;for(Ga=0;4>Ga;++Ga)if(Fa=I[Ga])Pa=Math.max(Pa,Fa?.renderData.geometryState.numVerticesPerSide),za=Fa.extent[2]-Fa.extent[0];e.internalAssert(1<Pa);Pa=za/Pa;for(za=0;4>za;++za){var xa=I[(za+3)%4],ya=I[za%4];if(xa||ya){Fa=
0===za?1:1===za?2:2===za?3:0;var Ea=0===za?2:1===za?3:2===za?0:1;if(xa&&ya){var Oa=G[za][0]*Pa,bb=G[za][1]*Pa,db=xa.extent;Ga=db[0===Fa||1===Fa?2:0]+Oa;Fa=db[0===Fa||3===Fa?3:1]+bb;db=ya.extent;Oa=db[0===Ea||1===Ea?2:0]+Oa;Ea=db[0===Ea||3===Ea?3:1]+bb;xa=xa.renderData;bb=ya.renderData;ya=u.sampleElevation(Ga,Fa,xa.geometryState.samplerData);Ea=u.sampleElevation(Oa,Ea,bb.geometryState.samplerData);sa(xa,Ga,Fa,.5*(ya+Ea),za)}else Ga=xa??ya,xa=xa?Fa:Ea,ya=Ga.extent,Ea=G[za],Fa=ya[0===xa||1===xa?2:0]+
Ea[0]*Pa,xa=ya[0===xa||3===xa?3:1]+Ea[1]*Pa,Ga=Ga.renderData,ya=u.sampleElevation(Fa,xa,Ga.geometryState.samplerData),sa(Ga,Fa,xa,ya,za)}}S||(Pa=Math.sqrt(Y*Y+Z*Z+ea*ea),oa=Y/Pa,ma=Z/Pa,fa=ea/Pa);if(S||.999>fa*fa)Pa=Math.sqrt(ba*ba+aa*aa+da*da),ba/=Pa,aa/=Pa,da/=Pa,Pa=Math.sqrt(ca*ca+na*na+qa*qa),ca/=Pa,na/=Pa,qa/=Pa,oa=da*na-aa*qa,ma=ba*qa-da*ca,fa=aa*ca-ba*na,Pa=1/Math.sqrt(oa*oa+ma*ma+fa*fa),oa*=Pa,ma*=Pa,fa*=Pa};for(let Pa=0;4>Pa;++Pa){const za=Pa,Ga=(Pa+1)%4,Fa=0===Pa||1===Pa?1:0,xa=0===Pa||
3===Pa?1:0,ya=b.clamp(Fa,Va,la),Ea=b.clamp(xa,cb,eb),Oa=T[za],bb=0===Pa||3===Pa?Oa.count-1:0,db=T[Ga],nb=0===Pa||1===Pa?db.count-1:0,kb=R[Pa].cornerTiles;let wb=-1;for(let Ab=0;4>Ab;++Ab){const Ib=kb[Ab];Ib&&(-1===wb||0<z.compareTilesByLij(kb[wb],Ib))&&(wb=Ab)}const vb=wb,sb=kb[vb];if(sb!==Q){const Ab=Q.level-sb.level,Ib=2**Ab,rb=[sb.lij[0]+Ab,sb.lij[1]*Ib,sb.lij[2]*Ib],Fb=[rb[1]+Ib===Q.lij[1],0===Pa&&(1===vb||0===vb&&sb!==kb[3])||1===Pa&&(0===vb||1===vb&&sb!==kb[2]),rb[1]===Q.lij[1]+1,2===Pa&&(3===
vb||2===vb&&sb!==kb[1])||3===Pa&&(2===vb||3===vb&&sb!==kb[0])],hb=Fb.reduce((Cb,Sb)=>Cb+(Sb?1:0),0);e.internalAssert(1===hb||2===hb);let Ja=-1,Na=-1;const Xa=sb.renderData;if(1===hb){const Cb=Fb.findIndex(Tb=>Tb);e.internalAssert(0<=Cb&&3>=Cb);Ja=(Cb+2)%4;const Sb=H.geometryState.neighborData.edgeResolutions[Cb];Na=Q.getNeighborEdgeStartVertexIndex(Cb,sb)*Sb+Sb*(0===Cb&&0===Pa||1===Cb&&0===Pa||2===Cb&&1===Pa||3===Cb&&3===Pa?1:0)}else{e.internalAssert(Fb[1]||Fb[3]);Ja=Fb[1]?3:1;const Cb=Xa.geometryState.neighborData.edgeResolutions[Ja];
Na=0===Pa||3===Pa?0:Cb}const fb=Xa.geometry.outerEdges[Ja],jb=Oa.index0+bb*Oa.stride,ab=db.index0+nb*db.stride,pb=fb.index0+Na*fb.stride,tb=fb.attributes.position,Ya=tb.typedBuffer,wa=pb*tb.typedBufferStride,Ia=H.localOrigin,Ra=fb.localOrigin,Ta=Ya[wa]+Ra[0]-Ia[0],Za=Ya[wa+1]+Ra[1]-Ia[1],gb=Ya[wa+2]+Ra[2]-Ia[2];d.minMaxBoundingBox(Ta,Za,gb,P);const lb=Oa.attributes.position,ob=lb.typedBuffer,ub=jb*lb.typedBufferStride;ob[ub]=Ta;ob[ub+1]=Za;ob[ub+2]=gb;const yb=db.attributes.position,Bb=yb.typedBuffer,
Gb=ab*yb.typedBufferStride;Bb[Gb]=Ta;Bb[Gb+1]=Za;Bb[Gb+2]=gb;d.encodeUVInBuffer(Oa.attributes.uv0,jb,ya,Ea);d.encodeUVInBuffer(db.attributes.uv0,ab,ya,Ea);const Kb=fb.attributes.normalCompressed.typedBuffer,Ob=pb*fb.attributes.normalCompressed.typedBufferStride,qb=Oa.attributes.normalCompressed,xb=qb.typedBuffer,zb=jb*qb.typedBufferStride;xb[zb]=Kb[Ob];xb[zb+1]=Kb[Ob+1];const Hb=db.attributes.normalCompressed,Jb=Hb.typedBuffer,Yb=ab*Hb.typedBufferStride;Jb[Yb]=Kb[Ob];Jb[Yb+1]=Kb[Ob+1]}else{const Ab=
Ma[Ga];let Ib=void 0;if(Ma[za]||Ab){const Ja=b.clamp(va*(1-Fa)+Ca*Fa,Qa,Sa),Na=b.clamp(Ba*(1-xa)+Ha*xa,La,Ua);Ib=u.sampleElevation(Ja,Na,J.samplerData)}else Ib=F(kb);ia(Fa,xa,Ib);ib(Pa);const rb=Y-N[0],Fb=Z-N[1],hb=ea-N[2];d.minMaxBoundingBox(rb,Fb,hb,P);Oa.setVertexFromValuesRawPositionUVNormal(bb,rb,Fb,hb,ya,Ea,oa,ma,fa);db.setVertexFromValuesRawPositionUVNormal(nb,rb,Fb,hb,ya,Ea,oa,ma,fa)}}for(let Pa=0;4>Pa;++Pa)I[Pa]=null}function F(H){const J=H.reduce((T,P)=>Math.min(T,P?.level??Infinity),Infinity);
e.ENABLE_TERRAIN_INTERNAL_CHECKS&&(e.internalAssert(!H[0]||!H[2]||h.isCornerNeighbor(H[0],H[2],k.NeighborIndex.SOUTH_WEST)),e.internalAssert(!H[1]||!H[3]||h.isCornerNeighbor(H[1],H[3],k.NeighborIndex.NORTH_WEST)));let N=0,R=0;for(let T=0;4>T;++T){var W=H[T];if(W&&W.level===J){const P=W.extent;W=u.sampleElevation(P[0===T||1===T?0:2],P[0===T||3===T?1:3],W.renderData?.geometryState?.samplerData);R+=W;N++}}H=N?R/N:0;e.internalAssert(null!=H);return H}function M(H){const J=H.geometry.vertexAttributes.position.typedBuffer;
H.vao.vertexBuffers.geometry.setSubData(J,0,0,J.length)}function K(H,J,N){if(!J)return!1;H=z.compareTilesByLij(H,J);return 0<H||0===H&&2<=N}const G=[[0,1],[1,0],[0,-1],[-1,0]],L=new f.PatchGeometryLUT,O=p.fromValues(-Infinity,-Infinity,Infinity,Infinity),I=[null,null,null,null];a.createPlanarGlobePatch=function(H,J){var N=H.tile.extent;J=H.geometryState;var R=N[0],W=N[1],T=N[2]-R,P=N[3]-W,Q=J.clippingArea;N=null!=Q?Math.max(0,(Q[0]-R)/T):0;const S=null!=Q?Math.max(0,(Q[1]-W)/P):0;R=null!=Q?Math.min(1,
(Q[2]-R)/T):1;W=null!=Q?Math.min(1,(Q[3]-W)/P):1;T=J.numVerticesPerSide;P=(T-2)**2;Q=J.neighborData.edgeResolutions.reduce((V,X)=>V+X+1,0);Q=d.acquireTerrainAttributes(P+Q);const U=H.geometry;y.empty(U.boundingBox);U.numVerticesPerSide=J.numVerticesPerSide;U.vertexAttributes=Q;c.set(U.uvRange,N,S,R,W);r(H);B(H,P);x(H);v(U,J.numVerticesPerSide,[],[0,T-1],[0,T-1],J.wireframe);H.intersectionData=null};a.createSphericalGlobePatch=function(H,J){const N=H.tile,{extent:R,extentInRadians:W,surface:T}=N,P=
H.localOrigin,Q=H.geometryState;var S=T.isWebMercator;const U=Q.numVerticesPerSide,V=U-1,X=(U-2)**2,Y=S&&(J===q.PatchType.HAS_SOUTH_POLE||J===q.PatchType.HAS_BOTH_POLES),Z=S&&(J===q.PatchType.HAS_NORTH_POLE||J===q.PatchType.HAS_BOTH_POLES);S=6*((Y?1:0)+(Z?1:0))*(V+1);J=Q.neighborData;const ea=J.edgeResolutions.reduce((ma,fa)=>ma+fa+1,0),ja=d.acquireTerrainAttributes(X+S+ea);S=H.geometry;S.numVerticesPerSide=Q.numVerticesPerSide;S.vertexAttributes=ja;const ha=S.boundingBox;y.empty(ha);const ia=w(H);
L.update(V,W,ia);l(H);B(H,X);m(H);const oa=[];(()=>{let ma=X+ea;const fa=P[0],ba=P[1],aa=P[2],da=N.ellipsoid.radius,ca=R[1],na=R[3],qa=(ua,sa)=>{sa*=U;d.minMaxBoundingBox(-fa,-ba,-aa+ua*da,ha);oa.push({connectedRowOffset:sa,connectedOuterEdgeOffset:1===ua?0:2,rowOffset:ma,latitudeResolution:6});sa=Math.PI/2-2*Math.atan(Math.exp(-(-1===ua?ca:na)/da));const pa=ua*Math.PI/2-sa;ua=.99*(1===ua?1:-1);const ka=da+0,ra=ja.position,va=ja.uv0,{typedBuffer:Ca,typedBufferStride:Ba}=ja.normalCompressed;for(let Ma=
1;6>=Ma;++Ma){var Ha=sa+Ma/6*pa;const Qa=Math.cos(Ha);Ha=Math.sin(Ha);for(let Sa=0;Sa<=V;Sa++){const La=Sa/V,Ua=L.cosLonLUT[Sa]*Qa,Va=L.sinLonLUT[Sa]*Qa,cb=Ha,la=Ua*ka-fa,eb=Va*ka-ba,ib=cb*ka-aa;d.minMaxBoundingBox(la,eb,ib,ha);ra.setValues(ma,la,eb,ib);d.encodeUVInBuffer(va,ma,La,ua);n.compressNormal(Ca,ma,Ua,Va,cb,Ba);++ma}}};Y&&qa(-1,0);Z&&qa(1,V)})();v(S,Q.numVerticesPerSide,oa,[0,U-1],[0,U-1],Q.wireframe);H.intersectionData=null;if(e.ENABLE_TERRAIN_INTERNAL_CHECKS)for(H=0;4>H;++H)e.internalAssert(S.outerEdges[H].count===
J.edgeResolutions[H]+1)};a.updateCornerSpherical=function(H){H.tile.intersectsClippingArea&&(E(H),t(H,!0),M(H))};a.updateCornersPlanar=function(H,J){H.tile.intersectsClippingArea&&(E(H),D(H,!0),M(H))};a.updateEdgesAndCornersPlanar=function(H,J){H.tile.intersectsClippingArea&&(x(H),M(H))};a.updateEdgesAndCornersSpherical=function(H){H.tile.intersectsClippingArea&&(m(H),M(H))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./terrainUtils ../webgl-engine/lib/Normals ../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(n,l,m,t){n.setValues(l,16384*m,16384*t)}let g=b._createClass(function(){this.vertexAttributes=this.indices=null;this.boundingBox=y.empty();this.numVerticesPerSide=this.indexCount=0;this.uvRange=[0,0,1,1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]}),e=function(){function n(m,t,w,r,x){this.attributes=m;this.localOrigin=t;this.index0=w;this.stride=r;this.count=x}var l=n.prototype;l.getVertexIndex=function(m){return this.getAttributeIndex(m)};
l.getAttributeIndex=function(m){q.internalAssert(0<=m&&m<this.count);return this.index0+this.stride*m};l._getVertexRaw=function(m,t){this.attributes.position.getVec(m,t)};l.getVertexPos=function(m,t){this._getVertexRaw(this.getAttributeIndex(t),m);c.add(m,m,this.localOrigin)};l.getNormal=function(m,t){const {typedBuffer:w,typedBufferStride:r}=this.attributes.normalCompressed;k.decompressNormal(m,w,this.getAttributeIndex(t),r)};l._setNormal=function(m,t,w,r){const {typedBuffer:x,typedBufferStride:D}=
this.attributes.normalCompressed;k.compressNormal(x,m,t,w,r,D)};l._setUV=function(m,t,w){f(this.attributes.uv0,m,t,w)};l.setNormalFromValues=function(m,t,w,r){this._setNormal(this.getAttributeIndex(m),t,w,r)};l.setVertexFromValuesRawPositionUV=function(m,t,w,r,x,D){m=this.getAttributeIndex(m);this.attributes.position.setValues(m,t,w,r);this._setUV(m,x,D)};l.setVertexFromValuesRawPositionUVNormal=function(m,t,w,r,x,D,A,v,B){m=this.getAttributeIndex(m);this.attributes.position.setValues(m,t,w,r);this._setUV(m,
x,D);this._setNormal(m,A,v,B)};return b._createClass(n)}();const h=u.newLayout().vec3f(d.VertexAttribute.POSITION).vec2i16(d.VertexAttribute.UV0).vec2i16(d.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}),z=new p.BufferPool(n=>h.createBuffer(n),n=>n.count);a.EdgeDescriptor=e;a.PatchGeometry=g;a.acquireTerrainAttributes=function(n){return z.acquire(n)};a.clearCaches=function(){z.clear()};a.encodeUVInBuffer=f;a.minMaxBoundingBox=function(n,l,m,t){n<t[0]?t[0]=n:n>t[3]&&(t[3]=n);l<t[1]?t[1]=l:l>t[4]&&
(t[4]=l);m<t[2]?t[2]=m:m>t[5]&&(t[5]=m)};a.releaseGeometry=function(n){z.release(n.vertexAttributes);n.vertexAttributes=null;n.indices=null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let y=function(){function p(q,k){this._factoryCallback=q;this._lengthCallback=k;this._pool=new Map}var u=p.prototype;u.acquire=function(q){if(!p.test.disabled){var k=
this._pool.get(q);if(k&&0!==k.length)return k.pop()}try{return this._factoryCallback(q)}catch(d){k=window.performance&&window.performance.memory;let f="";k&&(f=`\n  totalJSHeapSize: ${k.totalJSHeapSize}, usedJSHeapSize: ${k.usedJSHeapSize}, jsHeapSizeLimit: ${k.jsHeapSizeLimit}`);console.log("Array allocation of size "+q+" failed: "+d+f);throw d;}};u.release=function(q){if(!p.test.disabled){var k=this._lengthCallback(q),d=this._pool.get(k);d||(d=new c({shrink:!0}),this._pool.set(k,d));d.push(q)}};
u.clear=function(){this._pool.clear()};b._createClass(p,[{key:"test",get:function(){return{size:this._pool.size}}}]);return p}();y.test={disabled:!1};a.BufferPool=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst"],function(a,b,c){let y=function(){function p(){this.sinLonLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(c.MAX_PATCH_TESSELATION+1);
this.sinLatLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLatLUT=Array(c.MAX_PATCH_TESSELATION+1)}p.prototype.update=function(u,q,k){const d=q[0];q=q[2];for(let g=0;g<=u;g++){var f=g/u;const e=d*(1-f)+q*f;this.sinLonLUT[g]=Math.sin(e);this.cosLonLUT[g]=Math.cos(e);f=k(f);this.sinLatLUT[g]=Math.sin(f);this.cosLatLUT[g]=Math.cos(f)}};return b._createClass(p)}();a.PatchGeometryLUT=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./ITile ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){function A(L,O){return O?.isLoaded||O===L?O:null}let v=function(){function L(){this.geometry=new z.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new l.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new t;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=!1;this._dirtyCorners=
this._dirtyEdges=this._dirtyEdgeResolutions=15}var O=L.prototype;O.init=function(I){this.clear();this._tile=I;I=this.geometry;I.indices=null;I.vertexAttributes=null;q.empty(I.boundingBox);I.indexCount=0;I.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new g.GeometryState;this.localOrigin=null;this.overlay.clear()};O.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null};O.updateGeometryIfNeeded=
function(I){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(I),this._geometryStateChangedSinceLastUpdate=!1;if(n.ENABLE_TERRAIN_INTERNAL_CHECKS&&this.tile.intersectsClippingArea)for(I=0;4>I;++I)n.internalAssert(this.geometry.outerEdges[I].count===this.geometryState.neighborData.edgeResolutions[I]+
1)};O._calculateEdgeResolution=function(I,H){const J=this.tile,N=this.geometryState.numVerticesPerSide-1;if(!J.surface.isGlobal){var R=J.surface.extent;if(null!=R&&(0===I&&J.extent[3]>R[3]||1===I&&J.extent[2]>R[2]||2===I&&J.extent[1]<R[1]||3===I&&J.extent[0]<R[0]))return N}const W=J.level;R=n.neighborEdgeIndices[I];if(!H)return n.internalAssert(null==J.surface?.rootTiles||J.surface.updatingRootTiles||!J.shouldHaveNeighbor(R)),N;if(H.isLoaded)return R=H.renderData.geometryState,H=W-H.level,n.internalAssert(0<=
H),0===H?Math.max(R.numVerticesPerSide-1,N):Math.max(1,R.neighborData.edgeResolutions[(I+2)%4]/2**H);n.internalAssert(!H.isLeaf);let T=N;H.forAllSubtreeOnSide(n.oppositeEdge(R),P=>{if(P===J)return!0;if(P.isLoaded)return T=Math.max(T,2**(P.level-W)),!0;n.internalAssert(!P.isLeaf);return!1});return T};O.updateNeighborData=function(){const I=this.tile;if(I.intersectsClippingArea){var H=I.renderData.geometryState.neighborData,J=U=>(U.isLoaded||U.level===I.level)&&U?.intersectsClippingArea,N=H.edgePeerNeighbors,
R=H.edgePeerNeighborSamplerVersions;for(var W=0;4>W;++W){var T=I.findNeighborTile(n.neighborEdgeIndices[W],J),P=A(I,T),Q=P?.renderData?.geometryState.samplerDataVersion??-1,S=A(I,N[W]);P=P!==S;S=R[W]!==Q;N[W]=T;if(P||S)R[W]=Q,this._markEdgeDirty(W);Q=H.edgeResolutions[W];T=this._calculateEdgeResolution(W,T);n.internalAssert(y.isPowerOfTwo(T));n.internalAssert(1<=T);H.edgeResolutions[W]=T;Q!==T&&this._markEdgeResolutionDirty(W)}R=H.cornerPeerNeighbors;for(W=0;4>W;++W){P=I.findNeighborTile(n.neighborCornerIndices[W],
J);R[W]=P;T=A(I,N[W]);Q=A(I,N[(W+1)%4]);P=A(I,P);G[W]=P;G[(W+1)%4]=Q;G[(W+2)%4]=I;G[(W+3)%4]=T;n.internalAssert(G.some(V=>V?.isLoaded||V===I));const U=G.reduce((V,X)=>Math.min(V,X?.level??Infinity),Infinity);G.forEach((V,X)=>{V&&V?.level>U&&(G[X]=null)});n.internalAssert(G.some(V=>V?.isLoaded||V===I));T=H.cornerNeighborData[W].cornerTiles;Q=H.cornerNeighborData[W].cornerTileSamplerVersions;for(P=0;4>P;++P){S=G[P];const V=S?.renderData.geometryState.samplerDataVersion??-1,X=T[P]!==S,Y=!X&&Q[P]!==V;
if(X||Y)T[P]=S,Q[P]=V,this._markCornerDirty(W)}n.internalAssert(T.some(V=>V?.isLoaded||V===I))}n.ENABLE_TERRAIN_INTERNAL_CHECKS&&n.internalAssert(this.geometryState.neighborData.edgeResolutions.every(U=>0<U));for(H=0;4>H;++H)G[H]=null}};O._updateGeometry=function(I){if(this.tile.intersectsClippingArea){n.ENABLE_TERRAIN_INTERNAL_CHECKS&&n.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(W=>0<W));this.intersectionData=null;var H=this.tile,J=this.geometry.vertexAttributes;
J=!this._vao||!J||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions;var N=!J&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),R=!N&&0!==this._dirtyCorners;J?(this.releaseGeometry(),this._createGeometry(I)):N||R?H.updateEdgeElevations():R?H.updateCornerElevations():console.warn("Update for no reason?");this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=
0;this._wireframeChanged=this._clippingAreaChanged=!1}};O.releaseGeometry=function(){this._hasGeometry=!1;this.intersectionData=null;if(!this._vao)return!1;this._vao.dispose();this._vao=null;z.releaseGeometry(this.geometry);return!0};O.ensureTexture=function(I,H){null!=this._texture&&this._texture.descriptor.width!==I&&this.releaseTexture();null==this._texture&&(this._texture=H(),this.tile.setMemoryDirty());return this._texture};O.releaseTexture=function(){null!=this._texture&&(this._texture.release(),
this._texture=null,this.tile.setMemoryDirty())};O._markCornerDirty=function(I){this._dirtyCorners|=1<<I};O._markEdgeDirty=function(I){this._dirtyEdges|=1<<I;this._markCornerDirty((I+0)%4);this._markCornerDirty((I+3)%4)};O._markEdgeResolutionDirty=function(I){this._dirtyEdgeResolutions|=1<<I;this._markEdgeDirty(I)};O._markAllEdgesAndCornersDirty=function(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=15};O.updateGeometryState=function(){var I=this._getElevationInfo();const H=this.tile;
var J=I.samplerData?H.getElevationVerticesPerSide(I.maxTileLevel):H.getDefaultVerticesPerSide();const N=Math.max(J,5);let R=H.clippingArea;if(!H.intersectsClippingArea||H.isWithinClippingArea)R=null;J=this.geometryState;let W=!1;J.numVerticesPerSide!==N&&(this._numVerticesPerSideChanged=!0,J.numVerticesPerSide=N,J.samplerDataVersion++,W=!0);I.changed&&(this._samplerDataChanged=!0,J.samplerData=I.samplerData,J.samplerDataVersion++,W=!0);c.equals(J.clippingArea,R)||(this._clippingAreaChanged=!0,J.clippingArea=
R,W=!0);I=H.surface.wireframe;J.wireframe!==I&&(this._wireframeChanged=!0,J.wireframe=I,W=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=W);W&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate};O._createGeometry=function(I){this.tile.createGeometry();const H=this.geometry.vertexAttributes,J=this.geometry.indices,N=I.gl;this._vao=new r.VertexArrayObject(I,x.terrainVertexAttributeLocations,{geometry:f.glLayout(H.layout)},
{geometry:D.BufferObject.createVertex(I,N.STATIC_DRAW,H.buffer)},D.BufferObject.createIndex(I,N.STATIC_DRAW,J));this._hasGeometry=!0};O.setTextureReference=function(I,H=l.ActivationTime.Immediate){null!=I&&I.texture!==this._texture&&this.releaseTexture();this._textureRef.push(I,H)};O._getElevationInfo=function(){var I=this.geometryState.samplerData;const H=this.tile.layerInfo[h.LayerClass.ELEVATION],J=H.length,N=Array(J);let R=0;var W=0;let T=!1;for(let S=0;S<J;S++){var P=H[S];if(null!=P.upsampleInfo){P=
P.upsampleInfo.tile;var Q=P.layerInfo[h.LayerClass.ELEVATION][S].data;Q=Q&&Q.samplerData;I&&I[R]===Q||(T=!0);N[R++]=Q;W=Math.max(W,P.lij[0])}else P.data&&(Q=this.tile.surface.layerViewByIndex(S,h.LayerClass.ELEVATION),w.fallsWithinLayer(this.tile,Q.layer,!1)&&(W=P.data,I&&I[R]===W.samplerData||(T=!0),N[R++]=W.samplerData,W=this.tile.level))}null!=I&&I.length!==R&&(T=!0);if(I=0<R)N.length=R;return{changed:T,samplerData:I?N:null,maxTileLevel:W}};O.checkGeometryWaterproofness=function(){if(n.ENABLE_TERRAIN_INTERNAL_CHECKS){var I=
this.tile;if(I.isLoaded&&I.intersectsClippingArea&&0!==I.level){var H=I.surface.extent;if(null==H||I.intersectsExtent(H)){var J=n.neighborEdgeIndices.map((T,P)=>null!=H?0>(2>P?-1:1)*(I.extent[3-P]-H[3-P]):!1),N=I.level;n.internalAssert(0===this._dirtyCorners);n.internalAssert(0===this._dirtyEdges);n.internalAssert(0===this._dirtyEdgeResolutions);n.internalAssert(!this._numVerticesPerSideChanged);n.internalAssert(!this._samplerDataChanged);n.internalAssert(!this._clippingAreaChanged);n.internalAssert(!this._wireframeChanged);
var R=n.neighborCornerIndices.map(T=>I.findNeighborCornerTileExact(T,P=>!P.intersectsClippingArea||P.isLoaded||P.level===I.level)??null).map(T=>T?.intersectsClippingArea?T:null),W=this.geometryState.neighborData;for(let T=0;4>T;++T){const P=W.cornerPeerNeighbors[T],Q=R[T];n.internalAssert(Q===P,`Tile[${I.lij}].corner[${T}] out of date: cur=[${P?.lij}] exp=[${Q?.lij}]`)}n.neighborEdgeIndices.forEach((T,P)=>{if(!J[P]){var Q=I.findNeighborTile(T,ca=>(ca.level===N||ca?.isLoaded)&&ca?.intersectsClippingArea);
if(Q){n.internalAssert(Q.isLoaded||Q.level===I.level);n.internalAssert(Q===this.geometryState.neighborData.edgePeerNeighbors[P]);var S=N-Q.level;if(Q.isLoaded){var U=Q.renderData;n.internalAssert(m.isEdgeNeighbor(I,Q,T));n.internalAssert(0<=S);var V=2**S;if(0>S)n.internalAssert(!1);else{var X=I.renderData,Y=X.geometry,Z=Y.outerEdges[P],ea=Y.numVerticesPerSide-1,ja=U.geometry;if(ja){Y=this.geometryState.neighborData.edgePeerNeighbors[P];if(Y?.isLoaded){var ha=Y.renderData;n.internalAssert(Y===Y);n.internalAssert(X.geometryState.neighborData.edgePeerNeighborSamplerVersions[P]===
ha.geometryState.samplerDataVersion);n.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[P]===ha.geometryState.samplerDataVersion)}var ia=(P+2)%4,oa=ja.outerEdges[ia];Y=Z.count-1;ha=oa.count-1;n.internalAssert(Y*V===ha,`Tile[${I.lij}]:e${P},res=${Y} edgeRes mismatch with`+` Neighbor[${Q.lij}]:e${ia},res=${ha} (expected:${Y*V})`);Y=I.extent;ha=T===e.NeighborIndex.NORTH||T===e.NeighborIndex.SOUTH;var ma=oa.count-1,fa=ma/2**S,ba=Z.count-1;if(1>fa)n.internalAssert(1===ba);
else{n.internalAssert(fa===ba);n.internalAssert(y.isPowerOfTwo(fa));ja=ja.numVerticesPerSide-1;n.internalAssert(0<S||fa===Math.max(ja,ea));S=I.getNeighborEdgeStartVertexIndex(P,Q);n.internalAssert(0<=S&&S<V);V=S*fa;n.internalAssert(0<=V&&V<=ma-fa);var aa=0,da=V;Z.getVertexPos(B,0);Z.getVertexPos(C,Z.count-1);V=p.distance(B,C);V=Math.max(1,1E-4*V);for(S=0;S<=fa;++S){Z.getVertexPos(B,aa);oa.getVertexPos(C,da);ja=S/fa;ea=ha?Y[0]+ja*(Y[2]-Y[0]):T===e.NeighborIndex.WEST?Y[0]:Y[2];const ca=ha?T===e.NeighborIndex.SOUTH?
Y[1]:Y[3]:Y[1]+ja*(Y[3]-Y[1]),na=I.surface.extent;if(null==na||k.containsXY(na,ea,ca)){ja=p.dist(B,C);ma=p.len(B)-d.earth.radius;ba=p.len(C)-d.earth.radius;const qa=ja<V;qa||(console.warn("Tile edge vertex position mismatch: between"+` [${I.lij}].edge${P}[${aa}/${Z.count}] and`+` [${Q.lij}].edge${ia}[${da}/${oa.count}]`),null!=na&&console.warn("  surface extent\x3d ",na," x,y\x3d",ea,",",ca),ea=u.create(),p.subtract(ea,X.localOrigin,U.localOrigin),0<p.len(ea)&&console.warn(`   localOrigins: ${X.localOrigin} vs ${U.localOrigin}`+
` d=${p.len(ea)} [${ea}]`),(()=>{const sa=u.clone(B),pa=u.clone(C);I.updateEdgeElevations();Q.updateEdgeElevations();Z.getVertexPos(B,aa);oa.getVertexPos(C,da);const ka=u.create();p.sub(ka,B,sa);0<p.len(ka)&&console.warn(`  XXX Tile[${I.lij}] edge out of date: ${sa} vs ${B} d=${p.len(ka)} [${ka}]`);p.sub(ka,C,pa);0<p.len(ka)&&console.warn(`  XXX Neighbor[${Q.lij}] edge out of date: ${pa} vs ${C} d=${p.len(ka)} [${ka}]`)})(),n.internalAssert(qa,"Mismatch in tile"+` [${I.lij}].edge[${P}][${aa}/${Z.count}] vs neighbor`+
` [${Q.lij}].edge[${ia}][${da}/${oa.count}]`+` ${n.v32s(B)} vs ${n.v32s(C)}  dist=${ja} h(t|n|d)=${ma}|${ba}|${ba-ma}`));Z.getNormal(E,aa);oa.getNormal(F,da);p.normalize(M,E);p.normalize(K,F);const ua=p.dot(M,K);ea=.01>1-ua||I===Q;if(!ea){const sa=u.create();p.sub(sa,E,F);ja=()=>`Mismatch in tile edge normal ${n.lij2s(I.lij)} (${aa}/${Z.count-1}) edge ${P} vs neighbor ${n.lij2s(Q.lij)}  (${da}/${oa.count-1}) nedge ${ia} :`+`${n.v32s(E)} vs ${n.v32s(F)}  dot = ${ua} : ${n.v32s(sa)}`;console.warn("Mismatch in tile edge normal: ",
ja());I.updateEdgeElevations();Q.updateEdgeElevations();ma=u.create();ba=u.create();Z.getNormal(ma,aa);oa.getNormal(ba,da);p.equals(E,ma)||console.warn("Missing update in tile normal: ",n.v32s(E)," \x3d\x3e ",n.v32s(ma));p.equals(F,ba)||console.warn("Missing update in neighbor normal: ",n.v32s(F)," \x3d\x3e ",n.v32s(ba));n.internalAssert(ea,ja())}}aa+=1;da+=1}}}else n.internalAssert(!1)}}else n.internalAssert(!Q.isLeaf),n.internalAssert(0===S)}else T=!I.surface.updatingRootTiles&&null!=I.surface.rootTiles&&
0<I.surface.rootTiles.length&&I.shouldHaveNeighbor(T),n.internalAssert(!T)}})}}else n.internalAssert(I?.isLoaded)}};b._createClass(L,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},
{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}},{key:"texture",get:function(){return this._texture}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return L}();const B=u.create(),C=u.create(),E=u.create(),F=u.create(),M=u.create(),K=u.create(),G=[null,null,null,
null];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>l.ActivationTime});a.PatchRenderData=v;a.neighborTileIfLoadedOrSelf=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(){this.cornerTiles=[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]}),y=b._createClass(function(){this.cornerNeighborData=[new c,
new c,new c,new c];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]});b=b._createClass(function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new y});a.CornerNeighborData=c;a.GeometryState=b;a.NeighborhoodData=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,y){let p=function(){function u(k){this._getFadeDuration=k;this._delayedTime=this._fadeStart=0}var q=u.prototype;q.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};q.push=function(k,d=a.ActivationTime.Immediate){this._delayed=c.destroyMaybe(this._delayed);this._push(k,
d)};q._push=function(k,d){this._isFadingEnabled||this.clear();if(null==this._current)this._current=k;else{var f=u.test.fadeMoment||performance.now();d!==a.ActivationTime.Immediate?(this._delayed=k,this._delayedTime=f+d):null==this._next?(this._next=k,this._fadeStart=this._alignFadeStart(f)):null!=k&&(c.destroyMaybe(this._waiting),this._waiting=k)}};q._alignFadeStart=function(k){const d=this._getFadeDuration();return k+d-k%d};b._createClass(u,[{key:"current",get:function(){if(null==this._current)return null;
if(!this._isFadingEnabled){var k=this._delayed||this._waiting||this._next||this._current;k!==this._current&&(this._current=null,this.clear(),this._current=k)}k=u.test.fadeMoment;null!=this._delayed&&(k=k||performance.now(),k>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){k=k||performance.now();const d=this._next.type!==y.TextureUpdate.FADING,f=k-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||
d||f)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(k)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(null==this._next)return 1;var k=u.test.fadeMoment||performance.now();k=Math.max(0,k-this._fadeStart);const d=this._fadeDuration;return k>d?0:1-k/d}},{key:"isFading",get:function(){return null!=this._next||null!=this._delayed}},{key:"_fadeDuration",get:function(){return null==
this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return u}();p.test={fadeMoment:0};a.ActivationTime=void 0;(function(u){u[u.Immediate=0]="Immediate";u[u.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./ITile ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){function G(Q){Q.dispose();Q instanceof t.ElevationTileAgent?J.release(Q):Q instanceof D.MapTileAgent&&H.release(Q)}function L(Q,S,U){return null==Q||null==S||S===Q?!1:Q.level>=S.level?O(Q,S,U):O(S,Q,B.oppositeCorner(U))}function O(Q,S,U){B.internalAssert(Q.level>=S.level);var V=B.isWestCorner(U),X=B.isNorthCorner(U),Y=Q.extent;U=S.extent;var Z=[V?Y[0]:Y[2],X?Y[3]:Y[1]];const ea=[V?U[2]:U[0],X?U[1]:U[3]];V=1E-5*(Y[2]-Y[0]);X=B.almostEquals(Z[0],
ea[0],V)||Q.surface.isGlobal&&B.almostEquals(Z[0],-ea[0],V);Z=B.almostEquals(Z[1],ea[1],V);if(X&&Z)return!0;if(Q.level===S.level||!X&&!Z)return B.internalAssert(!1),!1;X?(Q=Y[1],Y=Y[3],U=U[1]-V<=Q&&Q<=Y&&Y<=U[3]+V):(Q=Y[0],Y=Y[2],U=U[0]-V<=Q&&Q<=Y&&Y<=U[2]+V);B.internalAssert(U);return U}let I=function(){function Q(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();this._elevationBounds=
q.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=d.create();this._center=[d.create(),h.create(),d.create()];this.up=d.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=0;this.distanceToPOI=-1;this._lastPOI=d.create()}Q.prune=function(){H.prune(0);
J.prune(0);E.TilePerLayerInfo.prune()};var S=Q.prototype;S.computeVisibility=function(){this._dirty=!1;var U=this.parent?.frustumVisibility??r.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=U===r.TileFrustumVisibility.INSIDE?r.TileFrustumVisibility.INSIDE:U===r.TileFrustumVisibility.OUTSIDE?r.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);U=this._frustumVisibility!==r.TileFrustumVisibility.OUTSIDE&&this._intersectsClippingArea;U!==this._visible&&
(this._visible=U,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())};S.init=function(U,V,X){this.lij[0]=U[0];this.lij[1]=U[1];this.lij[2]=U[2];this.ellipsoid=g.getReferenceEllipsoid(X.tilingScheme.spatialReference);X.tilingScheme.getExtent(U[0],U[1],U[2],this.extent);X.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);
this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;X.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.elevationLevel=U?U[0]:0;V&&V.elevationBounds?u.copy(this._elevationBounds,V.elevationBounds):u.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=V;this.unsetChildren();this._surface=X;
this.updateVisibility();for(const Y of x.LayerClasses){U=X.numLayers(Y);V=this.layerInfo[Y];for(const Z of V)Z.release();V.length=U;for(let Z=0;Z<U;Z++)V[Z]=E.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),Y===x.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(Z,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(X.tilingScheme.pixelSize,v.MAX_PATCH_TESSELATION)};S.release=function(){B.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);
for(var U of x.LayerClasses){for(const V of this.layerInfo[U])V.release();this.layerInfo[U].length=0}this._parent=null;for(U=0;4>U;++U)this._children[U]=null;this._surface=null;this.setMemoryDirty()};S.refMapData=function(){++this._mapDataRefCount;this._isCached||this._surface.upsampleMapCache.pop(this.key)};S.unrefMapData=function(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const U=this._cachedMemory;0<U&&this._surface.upsampleMapCache.put(this.key,this,U)}};S.setMemoryDirty=
function(){this._usedMemory=null};S._ensureUsedMemory=function(){if(null!=this._usedMemory)return this._usedMemory;let U=this._mapTileMemoryInternal=this._usedMemory=0;for(var {data:V}of this.layerInfo[x.LayerClass.MAP])V instanceof n.VectorTile?U+=this._getTerrainDataMemory(V):this._mapTileMemoryInternal+=this._getTerrainDataMemory(V);V=this._cpuImageMemorySize;for(const X of this.layerInfo[x.LayerClass.ELEVATION])this._usedMemory+=X.data?V:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
this._mapTileMemoryInternal+=this.renderData.texture?.gpuMemoryUsage??0);this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+U);return this._usedMemory};S.getUsedMemoryForLayer=function(U,V){V=this.layerInfo[U][V];return V?.data?U===x.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(V.data):U===x.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0};S._getTerrainDataMemory=function(U){return U instanceof F?U.texture.gpuMemoryUsage:U instanceof
HTMLImageElement||U instanceof l.ImageWithType?this._cpuImageMemorySize:U instanceof A.RasterTile?U.memoryUsage:U instanceof n.VectorTile?U.memoryUsed/U.referenced:0};S.updateScreenDepth=function(U){var V=this._center[a.CenterPosition.MIDDLE];const X=V[0],Y=V[1];V=V[2];const Z=U[2]*X+U[6]*Y+U[10]*V+U[14];this.screenDepth=0>Z?0:Z/(U[3]*X+U[7]*Y+U[11]*V+U[15])};S.shouldSplit=function(U,V,X){if(!this.visible||null!=U.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(U.frustum)===
r.TileFrustumVisibility.OUTSIDE))return M.TileUpdate.NONE;const Y=this.level;k.subtract(R,this._center[a.CenterPosition.MIDDLE],V);var Z=k.squaredLength(R),ea=R;let ja=a.CenterPosition.MIDDLE;k.subtract(W,this._center[a.CenterPosition.TOP],V);var ha=k.squaredLength(W);ha<Z&&(Z=ha,ea=W,ja=a.CenterPosition.TOP);k.subtract(T,this._center[a.CenterPosition.BOTTOM],V);ha=k.squaredLength(T);ha<Z&&(Z=ha,ea=T,ja=a.CenterPosition.BOTTOM);if(this._edgeLen2>Z&&Y<U.maxLod)return M.TileUpdate.SPLIT;const ia=null!=
X?X-Y:Infinity;Z=Math.sqrt(Z);const oa=this._edgeLen/(U.fovX*Z*2),ma=()=>{if(Y<U.maxLod)return this.elevationLevel=Y,M.TileUpdate.NONE;const aa=Y+Math.ceil(-Math.log2(U.relativeWidthLimit/oa));return aa!==this.elevationLevel?(this.elevationLevel=aa,M.TileUpdate.ELEVATION):M.TileUpdate.NONE};if(.5>=ia)return ma();const fa=k.dot(this.up,R);ha=this._elevationBounds[1]-this._elevationBounds[0];const ba=ha/this.edgeLen;if(U.aboveGround&&0<fa&&.001>ba&&0<fa/Z-Math.sin(this._curvatureHeight/(this.edgeLen*
Math.SQRT1_2)*Math.PI)-ba)return M.TileUpdate.NONE;X=null!=X?3-Math.min(ia,2):1;if(oa*X<U.relativeWidthLimit||Y>=U.maxLod)return ma();if(7>Y)return M.TileUpdate.SPLIT;k.scale(P,this.up,fa);k.subtract(P,P,ea);ea=k.squaredLength(P);if(ea<=this.radius*this.radius)return M.TileUpdate.SPLIT;k.scale(P,P,this.radius/Math.sqrt(ea));k.add(P,P,this._center[ja]);k.subtract(P,V,P);return Math.min(1,(Math.abs(k.dot(P,this.up))+.5*ha+this._curvatureHeight)/k.length(P))*(this._edgeLen/(U.fovY*Z*2))*X<.1/U.angledSplitBias*
U.relativeHeightLimit?M.TileUpdate.NONE:M.TileUpdate.SPLIT};S.setChildren=function(U,V,X,Y){B.weakAssert(!!(U&&V&&X&&Y),"Null child passed");this._children[0]=U;this._children[1]=V;this._children[2]=X;this._children[3]=Y};S.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};S.load=function(){this.refMapData();for(const U of x.LayerClasses)this._createOrUpdateAgents(0,U);this.surface.renderer.loadTile(this)};S.unload=function(U){U.unloadTile(this);
for(const V of x.LayerClasses){U=this.layerInfo[V];for(const X of U)X.loadingAgent&&X.loadingAgent!==C.TILE_AGENT_DONE&&(G(X.loadingAgent),X.loadingAgent=null),X.pendingUpdates=0}this.resetPendingUpdate(M.TileUpdate.GEOMETRY);this.resetPendingUpdate(M.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(M.TileUpdate.TEXTURE_FADING);this.unrefMapData()};S.unloadMapData=function(){const U=this.layerInfo[x.LayerClass.MAP];for(const V of U)V.loadingAgent&&V.loadingAgent!==C.TILE_AGENT_DONE&&(G(V.loadingAgent),
V.loadingAgent=null),V.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};S.updateClippingStatus=function(U){if(e.equals(U,this._clippingArea))return!1;var V=this._intersectsClippingArea;const X=this._isWithinClippingArea;null!=U?(this._intersectsClippingArea=this.intersectsExtent(U),this._isWithinClippingArea=this._isWithinExtent(U)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=U;this.updateVisibility();U=X&&this._isWithinClippingArea;
V=!X&&!V&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||U||V||this.setPendingUpdate(M.TileUpdate.GEOMETRY);return!0};S.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};S.getLayerInfo=function(U,V){return this.layerInfo[V][U]};S.hasLayerData=function(U,V){U=this.layerInfo[V][U];return!(!U||!U.data||U.dataInvalidated)};S._isSuspended=function(U){return this.hasPendingUpdate(M.TileUpdate.SPLIT)?!0:U===x.LayerClass.ELEVATION?!1:!this.loadable};
S.hasPendingUpdate=function(U){return(this._pendingUpdates&U)===U};S.setPendingUpdate=function(U){this._pendingUpdates|=U;U===M.TileUpdate.SPLIT||U===M.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};S.resetPendingUpdate=function(U){return this.hasPendingUpdate(U)?(this._pendingUpdates&=~U,!0):!1};S.requestLayerData=function(U,V,X){const Y=this.layerInfo[V][U];if(Y.waitingAgents.has(X))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),X.tile.lij.toString(),V,U),!0;Y.waitingAgents.push(X);if(Y.data&&!Y.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),X.tile.lij.toString(),V,U),X.dataArrived(this,Y.data&&"type"in Y.data&&"vector-tile"===Y.data.type),!0;if(Y.requestPromise)return!0;y.abortMaybe(Y.requestAbort);Y.requestAbort=new AbortController;const Z=this._surface.requestTileData(this,U,V,Y.requestAbort);if(!Z)return Y.requestAbort=
null,!1;U=()=>{Y.requestPromise===Z&&(Y.requestPromise=null,Y.requestAbort=null)};Y.requestPromise=Z;Z.then(U,U);return!0};S.hasLij=function(U){return this.lij[0]===U[0]&&this.lij[1]===U[1]&&this.lij[2]===U[2]};S.findByLij=function(U){if(this.hasLij(U))return this;const V=this._children;return V[0]?V[0].findByLij(U)||V[1].findByLij(U)||V[2].findByLij(U)||V[3].findByLij(U):null};S.distanceToSquared=function(U){return k.squaredLength(k.subtract(P,this._center[a.CenterPosition.MIDDLE],U))};S.containsPoint=
function(U){const V=this.extent;return U[0]>=V[0]&&U[1]>=V[1]&&U[0]<=V[2]&&U[1]<=V[3]};S.containsPointXY=function(U,V){const X=this.extent;return U>=X[0]&&V>=X[1]&&U<=X[2]&&V<=X[3]};S.unrequestLayerData=function(U,V,X){U=this.layerInfo[V][U];V=U.waitingAgents;X=null!=V.removeUnordered(X);B.weakAssert(X,"agent has not requested this piece of map data");1>V.length&&(U.abortRequest(),this.setMemoryDirty())};S.dataArrived=function(U,V,X){const Y=null!=X&&"type"in X&&"vector-tile"===X.type;U=this.layerInfo[V][U];
U.data=X;U.dataInvalidated=!1;U.waitingAgents.forAll(Z=>Z.dataArrived(this,Y));U.waitingAgents.clear();this.setMemoryDirty()};S.dataMissing=function(U,V,X){X.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${V}/${U} error ${X}`);U=this.layerInfo[V][U];U.dataMissing=!0;U.waitingAgents.forAll(Y=>Y.dataMissing());U.waitingAgents.clear();this.setMemoryDirty()};S.updateRenderData=function(U,V,X){X&&this.forEachLoadedNeighbor(Y=>Y.updateRenderData(U,V));switch(U){case x.LayerClass.MAP:return this._updateTexture(V);
case x.LayerClass.ELEVATION:return this._updateGeometry()}};S._updateTexture=function(U){this.renderData&&(this.resetPendingUpdate(U===w.TextureUpdate.FADING?M.TileUpdate.TEXTURE_NOFADING:M.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(U===w.TextureUpdate.FADING?M.TileUpdate.TEXTURE_FADING:M.TileUpdate.TEXTURE_NOFADING))};S._updateGeometry=function(){this.setPendingUpdate(M.TileUpdate.GEOMETRY);for(const U of this.layerInfo[x.LayerClass.ELEVATION])U.pendingUpdates|=M.TileUpdate.GEOMETRY};S.invalidateLayerData=
function(U,V){this.layerInfo[V][U].invalidateSourceData();this.restartAgents(V)};S.computeElevationBounds=function(){const U=this._elevationBounds,V=U[0],X=U[1];u.set(U,Infinity,-Infinity);const Y=this.layerInfo[x.LayerClass.ELEVATION];let Z=!0;for(const ea of Y)null!=ea.elevationBounds&&(U[0]=Math.min(U[0],ea.elevationBounds.min),U[1]=Math.max(U[1],ea.elevationBounds.max),ea.elevationBounds.hasNoDataValues||(Z=!1));Z&&(U[0]=Math.min(U[0],0),U[1]=Math.max(U[1],0));if(V!==U[0]||X!==U[1])this.updateRadiusAndCenter(),
this._surface.setTileTreeDirty()};S._updateCenter=function(){const U=this._elevationBounds,V=this._center;k.scale(P,this.up,.5*(U[0]+U[1]));k.add(V[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,P);k.scale(P,this.up,U[0]);k.add(V[a.CenterPosition.TOP],this.centerAtSeaLevel,P);k.scale(P,this.up,U[1]);k.add(V[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,P)};S.findElevationBoundsForLayer=function(U,V){const X=this.layerInfo[x.LayerClass.ELEVATION][U],Y=v.getElevationDesiredResolutionLevel(this.level),
Z=Math.max(this.elevationLevel-Y,0);var ea=X.elevationBounds;if(!(null!=ea&&ea.level>=V&&ea.level<=Z)&&(V=this._surface.layerViewByIndex(U,x.LayerClass.ELEVATION),V=B.getLayerWithExtentRange(V),K.fallsWithinLayer(this,V,!1))){V=N;ea=!1;var ja=X.data;if(ja&&ja.level<=Z)U=X.data,V.min=U.samplerData.data.minValue,V.max=U.samplerData.data.maxValue,V.hasNoDataValues=U.samplerData.data.hasNoDataValues,V.level=this.level,ea=!0;else{ja=0;let ha,ia;for(let oa=this._parent;oa&&(!ia||ja<Y)&&!(ja=this.elevationLevel-
oa.level,ha=ia||ha,ia=oa.layerInfo[x.LayerClass.ELEVATION][U].data,!ia&&ha&&oa.level<=Z);oa=oa.parent);if(ia=ia||ha)ia.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],V),Infinity!==V.min&&(V.level=ia.level,ea=!0)}ea&&(null==X.elevationBounds&&(X.elevationBounds=new m.ElevationBounds),X.elevationBounds.copyFrom(V))}};S.modifyLayers=function(U,V,X){X=this.layerInfo[X];for(var Y of X)Y.loadingAgent&&Y.loadingAgent!==C.TILE_AGENT_DONE&&(G(Y.loadingAgent),Y.loadingAgent=null),Y.waitingAgents.clear();
for(Y=0;Y<X.length;++Y)void 0===U[Y]&&X[Y].release();U=Array(...X);Y=V.length;X.length=Y;for(let Z=0;Z<Y;Z++){const ea=V[Z];X[Z]=-1<ea?U[ea]:E.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};S.restartAgents=function(U){this.renderData&&(this._createOrUpdateAgents(0,U),this.updateRenderData(U,w.TextureUpdate.FADING))};S.updateAgents=function(U){if(this.renderData){const V=this.layerInfo[U];for(const X of V)X.loadingAgent===C.TILE_AGENT_DONE&&(X.loadingAgent=null);this._createOrUpdateAgents(0,
U)}};S.updateAgentSuspension=function(){for(const U of x.LayerClasses){const V=this._isSuspended(U);for(const X of this.layerInfo[U])X.loadingAgent&&X.loadingAgent!==C.TILE_AGENT_DONE&&(X.loadingAgent.setSuspension(V),X.loadingAgent===C.TILE_AGENT_DONE&&this.updateRenderData(U,w.TextureUpdate.FADING))}};S.removeLayerAgent=function(U,V){U=this.layerInfo[V][U];U.loadingAgent&&U.loadingAgent!==C.TILE_AGENT_DONE&&U.loadingAgent.dispose();U.loadingAgent=null};S.agentDone=function(U,V){const X=this.layerInfo[V][U];
X.loadingAgent=C.TILE_AGENT_DONE;X.data||null!=X.upsampleInfo||this._createOrUpdateAgents(U+1,V)};S._hasBlendableAncestor=function(U){return"normal"!==U.blendMode||z.isGroupLayer(U.parent)&&this._hasBlendableAncestor(U.parent)};S._hasBlendModes=function(U,V,X){for(;U<V;++U){const Y=this._surface.layerViewByIndex(U,X);if(B.isBlendableLayerView(Y)&&"normal"!==Y?.layer?.blendMode||z.isGroupLayer(Y?.layer?.parent)&&this._hasBlendableAncestor(Y?.layer?.parent))return!0}return!1};S._createOrUpdateAgents=
function(U,V){const X=this.layerInfo[V];if(0!==X.length){var Y=this._isSuspended(V);for(let ha=U;ha<X.length;++ha){const ia=X[ha];var Z=!1;const oa=this._surface.layerViewByIndex(ha,V);var ea=B.getLayerWithExtentRange(oa);if(ia.loadingAgent)K.fallsWithinLayer(this,ea,!1)?(ia.loadingAgent!==C.TILE_AGENT_DONE&&ia.loadingAgent.setSuspension(Y),ia.loadingAgent!==C.TILE_AGENT_DONE&&(Z=ia.loadingAgent.update())):ia.dispose();else if(K.fallsWithinLayer(this,ea,!1)){Z=ha;ea=V;var ja=Y;const ma=ea===x.LayerClass.ELEVATION?
J.acquire():H.acquire();ma.init(this,Z,ea,ja);ia.loadingAgent=ma;(Z=ia.loadingAgent.startLoading())?ia.loadingAgent===C.TILE_AGENT_DONE&&this.setPendingUpdate(M.TileUpdate.GEOMETRY):(G(ia.loadingAgent),ia.loadingAgent=C.TILE_AGENT_DONE)}ia.loadingAgent===C.TILE_AGENT_DONE&&this.updateRenderData(V,w.TextureUpdate.FADING);if(!this._hasBlendModes(U,X.length,V)&&Z&&oa.isOpaque)break}}};S._isWithinExtent=function(U){const V=this.extent;return V[0]>=U[0]&&U[2]>=V[2]&&V[1]>=U[1]&&U[3]>=V[3]};S.intersectsExtent=
function(U){const V=this.extent;return V[2]>=U[0]&&U[2]>=V[0]&&V[3]>=U[1]&&U[3]>=V[1]};S.getElevationVerticesPerSide=function(U){var V=this.elevationLevel-this.level;U=Math.max(this.level-U,v.getElevationDesiredResolutionLevel(this.level)-V);U=c.clamp((this.maxTesselation>>U)+1,2,this.maxTesselation+1);V=this.getDefaultVerticesPerSide();return Math.max(U,V)};S._findLIJ=function(U,V){if(!U)return null;var X=this.surface.rootTiles;if(null!=X)for(var Y of X){X=Y.level;var Z=U[0];X>Z?X=!1:(X=Z-X,Z=Math.floor(U[2]/
2**X),X=Math.floor(U[1]/2**X)===Y.lij[1]&&Z===Y.lij[2]);if(X){for(X=U[0]-Y.level-1;0<=X&&!Y.isLeaf&&!V(Y);)Y=Y.children[2*(U[1]>>X&1)+(U[2]>>X&1)],X--;return V(Y)?Y:null}}return null};S.findNeighborTile=function(U,V){const X=this.lij;return(U=this.getNeighborLIJ(X,U))?X[0]===U[0]&&X[1]===U[1]&&X[2]===U[2]?V(this)?this:null:this._findLIJ(U,V):null};S.findCorner=function(U,V){U=U===r.NeighborIndex.NORTH_EAST?1:U===r.NeighborIndex.NORTH_WEST?0:U===r.NeighborIndex.SOUTH_WEST?2:3;let X=this;for(;X.children[0]&&
(!V||!V(X));)X=X.children[U];return X};S.findNeighborCornerTileExact=function(U,V){return this.findNeighborTile(U,X=>V(X)||X.level===this.level)?.findCorner(B.oppositeCorner(U),V)||null};S.forAllSubtreeOnSide=function(U,V){const X=U===r.NeighborIndex.NORTH?[0,1]:U===r.NeighborIndex.NORTH_EAST?[1]:U===r.NeighborIndex.EAST?[1,3]:U===r.NeighborIndex.SOUTH_EAST?[3]:U===r.NeighborIndex.SOUTH?[2,3]:U===r.NeighborIndex.SOUTH_WEST?[2]:U===r.NeighborIndex.WEST?[0,2]:[0],Y=Z=>{const ea=Z.children;!V(Z)&&ea[0]&&
X.forEach(ja=>Y(ea[ja]))};Y(this)};S.forallNeighbors=function(U){B.neighborCornerIndices.forEach(V=>this.findNeighborCornerTileExact(V,U));B.neighborEdgeIndices.forEach(V=>this.findNeighborTile(V,X=>X.level===this.level||U(X))?.forAllSubtreeOnSide(B.oppositeEdge(V),U))};S.getNeighborEdgeStartVertexIndex=function(U,V){if(!V)return 0;var X=this.level-V.level;B.internalAssert(!B.ENABLE_TERRAIN_INTERNAL_CHECKS||0<=X);if(0===X)return 0;X=2**X;var Y=(U=1===(U&1))?0:1;V=V.lij[Y+1]*X;Y=this.lij[Y+1];const Z=
Y-V;U=U?X-1-Z:Z;B.ENABLE_TERRAIN_INTERNAL_CHECKS&&(B.internalAssert(V<=Y&&Y<V+X),B.internalAssert(0<=U&&U<X));return U};S.forEachLoadedNeighbor=function(U){const V=this.level,X=Y=>Y.level===V||Y.isLoaded;B.neighborEdgeIndices.forEach(Y=>{const Z=this.findNeighborTile(Y,X);null!=Z&&Z!==this&&Z.forAllSubtreeOnSide(B.oppositeEdge(Y),ea=>ea.isLoaded?(U(ea,Y),!0):!1)});B.neighborCornerIndices.forEach(Y=>{const Z=this.findNeighborTile(Y,X)?.findCorner(B.oppositeCorner(Y),ea=>ea.isLoaded);B.internalAssert(!Z||
L(this,Z,Y));Z?.isLoaded&&U(Z,Y)})};S.getNeighborLIJ=function(U,V){const X=B.isNorth(V)?-1:B.isSouth(V)?1:0;V=B.isWest(V)?-1:B.isEast(V)?1:0;U=[U[0],U[1]+X,U[2]+V];return 0>U[1]?null:this.surface.isGlobal?this.wrapLIJ(U):0>U[2]?null:U};S.wrapLIJ=function(U){return!U||0>U[1]||U[1]>=2**U[0]?null:this.surface.wrapEastWest(U)};S.checkGeometryWaterproofness=function(){B.ENABLE_WATERPROOFNESS_TESTS&&(B.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())};S.shouldHaveNeighbor=function(U){const V=
this.extent,X=this.surface.rootTilesExtent,Y=.25*(V[2]-V[0]);if(B.isNorth(U)&&V[3]+Y>=X[3]||B.isSouth(U)&&V[1]-Y<=X[1])return!1;const Z=this.surface.isGlobal;return!Z&&B.isWest(U)&&V[0]-Y<=X[0]||!Z&&B.isEast(U)&&V[2]+Y>=X[2]?!1:!0};S.updateDistanceToPOI=function(U){var V=this._lastPOI;if(!(0<=this.distanceToPOI&&V[0]===U[0]&&V[1]===U[1]&&V[2]===U[2])){k.copy(this._lastPOI,U);var X=this._center[a.CenterPosition.MIDDLE];V=U[0]-X[0];var Y=U[1]-X[1];U=U[2]-X[2];this.distanceToPOI=V*V+Y*Y+U*U}};b._createClass(Q,
[{key:"_isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},
{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"frustumVisibility",get:function(){this._dirty&&this.computeVisibility();return this._frustumVisibility}},
{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const U=!!this.renderData;U!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=U,this._surface.renderer.setDirty());return U}},{key:"shouldLoad",get:function(){return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}},{key:"_cachedMemory",get:function(){return this._isCached?
this._mapTileMemory:0}},{key:"_mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[x.LayerClass.MAP].reduce((U,V)=>U+(V instanceof n.VectorTile?V.memoryUsed/V.referenced:0),this._mapTileMemoryInternal)}},{key:"_cpuImageMemorySize",get:function(){const U=this._surface.tilingScheme.pixelSize;return U*U*4}},{key:"isLoaded",get:function(){return this.renderData?.hasGeometry??!1}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const U of x.LayerClasses){const V=
this.layerInfo[U];for(const X of V)if(X.loadingAgent&&X.loadingAgent!==C.TILE_AGENT_DONE&&X.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this._cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*(this.isWestEnd?-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?
-1:1)}},{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===this.lij[1]}},{key:"isSouthEnd",get:function(){const U=this.surface.extent?.[1]??null;return null!=U&&this.extent[1]+f.getEpsilon()>=U}}]);return Q}();const H=new p(D.MapTileAgent),J=new p(t.ElevationTileAgent),N=new m.ElevationBounds;a.CenterPosition=void 0;(function(Q){Q[Q.TOP=0]="TOP";Q[Q.MIDDLE=
1]="MIDDLE";Q[Q.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));const R=d.create(),W=d.create(),T=d.create(),P=d.create();a.Tile=I;a.isCornerNeighbor=L;a.isEdgeNeighbor=function(Q,S,U){if(null==Q||null==S)return!1;if(0===Q.level&&0===S.level&&(Q.isEastEnd&&S.isWestEnd&&U===r.NeighborIndex.EAST||Q.isWestEnd&&S.isEastEnd&&U===r.NeighborIndex.WEST))return!0;const V=Math.max(1E-6*(Q.extent[2]-Q.extent[0]),1);switch(U){case r.NeighborIndex.NORTH:return B.almostEquals(Q.extent[3],S.extent[1],
V);case r.NeighborIndex.SOUTH:return B.almostEquals(Q.extent[1],S.extent[3],V);case r.NeighborIndex.EAST:return B.almostEquals(Q.extent[2],S.extent[0],V)||B.almostEquals(Q.extent[2],-S.extent[0],V);case r.NeighborIndex.WEST:return B.almostEquals(Q.extent[0],S.extent[2],V)||B.almostEquals(Q.extent[0],-S.extent[2],V)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst",
"./TileAgent"],function(a,b,c,y){y=function(p){function u(){var q=p.apply(this,arguments)||this;q._scaleRangeEnabled=!1;return q}b._inherits(u,p);b._createClass(u,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return u}(y.TileAgent);a.ElevationTileAgent=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,y,p,u){let q=function(){function f(){}var g=f.prototype;g.init=function(e,h,z,n){this.tile=e;this._layerIdx=h;this._layerClass=z;this._suspended=n;this._tileLayerInfo=e.getLayerInfo(h,z);this._tileRequested=null;e=this._findAncestorWithData();this._setUpsampleTile(e)};g.startLoading=function(){return this._requestNext()};g.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};g.setSuspension=function(e){e!==this._suspended&&((this._suspended=e)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};g.update=function(){const e=this._findAncestorWithData();this._setUpsampleTile(e);return this._requestNext()};g.dataArrived=function(e,h){this._setUpsampleTile(e,h);this._tileRequested=null;e===this.tile?this.tile.updateRenderData(this._layerClass,
c.TextureUpdate.FADING,h):this._requestNext()};g.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};g._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};g._requestNext=function(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}null!=e?e.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=e):this._agentDone();return!!this._tileRequested};g._findNextDownload=function(){const e=this._layerIdx,h=this._layerClass;var z=this.tile.surface.layerViewByIndex(e,h),n=p.getLayerWithExtentRange(z);const {minLevel:l,maxLevel:m}=z.dataLevelRange,t=this._desiredMinLevelDelta,w=this._progressiveLevelModulo+t,r=this._scaleRangeEnabled?u.fallsWithinLayer:()=>!0;let x=this.tile;const D=x.level;let A;const v=this._tileLayerInfo.upsampleInfo,B=null!=v?v.tile.level:
-1,C=null!=v?B-D>=t:!1,E=n?.tilemapCache;for(z="vector-tile-3d"===z.type?z.schemaHelper:null;x&&r(x,n,!1)&&x.level>=l;){const F=x.level,M=D-F,K=x.layerInfo[h][e];if(K.data&&M>=t){(!C||F>B)&&this._setUpsampleTile(x);K.dataInvalidated&&(A=x);break}const G=z?.getLevelRowColumn(x.lij)??x.lij;if("unavailable"!==E?.getAvailability(G[0],G[1],x.lij[2])&&F<=m&&!K.data&&!K.dataMissing){if(!A||x.level===l||0===F%y.PROGRESSIVE_LOADING_MODULO||D-A.level<t)A=x;if(M>=w)break}x=x.parent}null!=A&&D-A.level<t&&(v?
A=null:(n=this._findAncestorWithData(),null!=n&&(this._setUpsampleTile(n),A=n.layerInfo[h][e].dataInvalidated?n:null)));return A};g._findAncestorWithData=function(){const e=this.tile.elevationLevel,h=this._desiredMinLevelDelta;let z;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=h)return n;z=n}return z};g._setUpsampleTile=function(e,h){this._tileLayerInfo.setUpsampleInfo(this.tile,e);this.tile.updateRenderData(this._layerClass,c.TextureUpdate.FADING,
h)};b._createClass(f,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return f}();var k=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,f);g.prototype.dispose=function(){};b._createClass(g,[{key:"_desiredMinLevelDelta",get:function(){throw d;}},{key:"_progressiveLevelModulo",get:function(){throw d;}}]);return g}(q);const d=Error("Abstract method called on TileAgent");
k=new k;a.TILE_AGENT_DONE=k;a.TileAgent=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray","./RenderOrder"],function(a,b,c,y){function p(n,l){l(n);if(!n.isLeaf)for(const m of n.children)p(m,l)}function u(n,l){n=n.lij;l=l.lij;return n[0]-l[0]||n[1]-l[1]||n[2]-l[2]}function q(n,l){const m=l.screenDepth-n.screenDepth;if(0!==m)return m;n=n.lij;l=l.lij;return n[0]-
l[0]||n[1]-l[1]||n[2]-l[2]}function k(n,l){const m=n.screenDepth-l.screenDepth;if(0!==m)return m;n=n.lij;l=l.lij;return n[0]-l[0]||n[1]-l[1]||n[2]-l[2]}function d(n,l,m){const t=n.screenDepth,w=l.screenDepth;return t<w?-m:t>w?m:u(n,l)}function f(n,l,m,t){const w=g(n,t);t=g(l,t);return w===t?d(n,l,m):n?m:-m}function g(n,l){for(const m of l)if(n.intersectsExtent(m))return!0;return!1}function e(n,l){const m=n.distanceToPOI-l.distanceToPOI;if(0!==m)return m;n=n.lij;l=l.lij;return n[0]-l[0]||n[1]-l[1]||
n[2]-l[2]}let h=function(){function n(){this._queue=new c;this.remove=()=>{}}var l=n.prototype;l.resetOne=function(m){this._queue.clear();this._queue.push(m);this._last=void 0};l.reset=function(m=null){this._queue.clear();null!=m&&this._queue.pushArray(m);this._last=void 0};l.skipSubtree=function(){this._last=void 0};l.next=function(){const m=this._last?.children;m&&m[0]&&this._queue.pushArray(m);return this._last=this._queue.pop()};b._createClass(n,[{key:"done",get:function(){return 0===this._queue.length&&
(!this._last||this._last.isLeaf)}}]);return n}(),z=function(){function n(){this._q=new c}var l=n.prototype;l.reset=function(m){this._q.clear();if(null!=m)for(this._q.pushArray(m),m=0;m<this._q.length;++m){const t=this._q.data[m];t.isLeaf||this._q.pushArray(t.children)}};l.next=function(){return this._q.pop()};b._createClass(n,[{key:"done",get:function(){return 0===this._q.length}}]);return n}();a.IteratorPostorder=z;a.IteratorPreorder=h;a.compareTiles=d;a.compareTilesByLij=u;a.compareTilesWithStencil=
f;a.computeUpsampleInfo=function(n,l,m){let t=1,w=0,r=0;for(;n!==l;)if(t*=.5,w*=.5,r*=.5,n.lij[2]&1&&(w+=.5),0===(n.lij[1]&1)&&(r+=.5),n=n.parent,null==n)throw Error("tile was not a descendant of upsampleTile");m.init(l,w,r,t)};a.fallsWithinLayer=function(n,l,m){if(null==l||null==l.fullExtent)return!1;const t=l.fullExtent,w=n.extent;if(m){if(w[0]<t.xmin||w[1]<t.ymin||w[2]>t.xmax||w[3]>t.ymax)return!1}else if(t.xmin>w[2]||t.ymin>w[3]||t.xmax<w[0]||t.ymax<w[1])return!1;n=n.surface.tilingScheme.levels[n.level].scale;
m=l.minScale;if(0<m&&n>1.00000001*m)return!1;l=l.maxScale;return 0<l&&n<.99999999*l?!1:!0};a.hasLoadableSiblings=function(n){for(let l=0;l<n.length;l++){const m=n[l],t=m.parent;if(t)for(let w=0;4>w;w++){const r=t.children[w];if(r&&r!==m)return!0}}return!1};a.sortTiles=function(n,l,m=null){null==m||0===m.length?n===y.RenderOrder.BACK_TO_FRONT?l.sort(q):l.sort(k):l.sort((t,w)=>f(t,w,n,m))};a.sortTilesByPOI=function(n,l){const m=n.length;for(let t=0;t<m;++t)n.at(t).updateDistanceToPOI(l);n.sort(e)};
a.tilesAreRelated=function(n,l){if(!n||!l||n[0]===l[0])return!1;const m=n[0]<l[0],t=m?n:l;n=m?l:n;l=1<<n[0]-t[0];return Math.floor(n[1]/l)===t[1]&&Math.floor(n[2]/l)===t[2]};a.traverseTilesPreorder=function(n,l){if(Array.isArray(n))for(let m=0;m<n.length;m++)p(n[m],l);else p(n,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=
-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,y){y=function(p){function u(){var q=p.call(this)||this;q._scaleRangeEnabled=!0;return q}b._inherits(u,p);b._createClass(u,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",
get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return u}(y.TileAgent);a.MapTileAgent=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(a,b,c,y,p,u){const q={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],
useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let k=function(){function d(g,e,h=null,z=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=g;this.source=e;this.width=h||e.width;this.height=z||e.height}var f=
d.prototype;f.bind=function(g){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(g,this.bandIds);null!=this._rasterTexture&&(this._updateColormapTexture(g),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=u.createTransformTexture(g,this.transformGrid)));return!0};f.getUniforms=function(){const {symbolizerParameters:g,transformGrid:e,width:h,height:z,opacity:n}=this,l=u.getCommonUniforms(e,
[h,z],[this.source.width,this.source.height],n),m=u.getColormapUniforms(g.colormap,g.colormapOffset),t="stretch"===this.symbolizerParameters.type?u.getStretchUniforms(this.symbolizerParameters):null,w="hillshade"===this.symbolizerParameters.type?u.getShadedReliefUniforms(this.symbolizerParameters):null;return new y.ColorizerUniforms(l,m,t||w,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};f.release=function(){this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._transformGridTexture=
c.disposeMaybe(this._transformGridTexture);this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};f._updateRasterTexture=function(g,e){const h=this.source?this.source.extractBands(e):null;h&&h.pixels&&0<h.pixels.length?(e=null==e&&null==this.bandIds||null!=e&&null!=this.bandIds&&e.join("")===this.bandIds.join(""),null!=this._rasterTexture&&e||(this._rasterTexture=c.disposeMaybe(this._rasterTexture),e=this._getRasterTextureInterpolation(this.interpolation),
this._rasterTexture=u.createRasterTexture(g,h,e,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=c.disposeMaybe(this._rasterTexture)};f.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};f._getRasterTextureInterpolation=function(g){return"lut"===this.symbolizerParameters.type||"nearest"===g||"majority"===g||this.isBilinearWithStretchColorRamp?
"nearest":"bilinear"};f._updateColormapTexture=function(g){const e=this._colormap,h=this.symbolizerParameters.colormap;if(!h)this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!e)this._colormapTexture=u.createColormapTexture(g,h),this._colormap=h;else if(h.length!==e.length||h.some((z,n)=>z!==e[n]))this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormapTexture=u.createColormapTexture(g,h),this._colormap=h};b._createClass(d,[{key:"source",get:function(){return this._source},
set:function(g){this._source=g;this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...q,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||q},set:function(g){this._symbolizerParameters=g}},{key:"bandIds",get:function(){return this._bandIds},set:function(g){null!=g&&0<g.length?this._bandIds&&g.every((e,h)=>this._bandIds?.[h]?e===this._bandIds[h]:!1)||(this._bandIds=g,this._dirty=!0):this._bandIds=
null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(g){this._interpolation=g;null!=this._rasterTexture&&(g=this._getRasterTextureInterpolation(g),this._rasterTexture.setSamplingMode("bilinear"===g?p.TextureSamplingMode.LINEAR:p.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(g){this._transformGrid=g;this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"isBilinearWithStretchColorRamp",
get:function(){const {symbolizerParameters:g}=this;return"bilinear"===this.interpolation&&null!=g.colormap&&"stretch"===g.type}},{key:"memoryUsage",get:function(){null==this._memoryUsed&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(g=>null!=g?g.descriptor.width*g.descriptor.height*4:0).reduce((g,e)=>g+e,0));return this._memoryUsed}}]);return d}();a.RasterTile=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){function t(B){const C=new l.ShaderBuilder;C.include(k.TileComposite);C.include(u.Common,B);C.include(p.Colormap,B);C.include(q.TileBackground,B);C.fragment.code.add(n.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);B.colorizerType===y.RasterColorizerType.Stretch?w(C,B):B.colorizerType===y.RasterColorizerType.Lut?C.fragment.code.add(n.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):B.colorizerType===y.RasterColorizerType.Hillshade&&r(C,B);return C}function w(B,C){B.fragment.uniforms.add(new z.IntegerPassUniform("u_bandCount",F=>F.symbolizer.u_bandCount),new h.FloatsPassUniform("u_minCutOff",F=>F.symbolizer.u_minCutOff,3),new h.FloatsPassUniform("u_maxCutOff",F=>F.symbolizer.u_maxCutOff,3),new h.FloatsPassUniform("u_factor",F=>F.symbolizer.u_factor,3),new e.FloatPassUniform("u_minOutput",F=>F.symbolizer.u_minOutput),new e.FloatPassUniform("u_maxOutput",F=>F.symbolizer.u_maxOutput),
new f.BooleanPassUniform("u_useGamma",F=>F.symbolizer.u_useGamma),new h.FloatsPassUniform("u_gamma",F=>F.symbolizer.u_gamma,3),new h.FloatsPassUniform("u_gammaCorrection",F=>F.symbolizer.u_gammaCorrection,3),new e.FloatPassUniform("u_opacity",F=>F.common.u_opacity));B.fragment.code.add(n.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const E=C.applyColormap?n.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:n.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;B.fragment.code.add(n.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${C.stretchType===y.RasterColorizerStretchType.Noop?n.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:n.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${E}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function r(B,C){B=B.fragment;B.uniforms.add(new m.Texture2DPassUniform("u_image",E=>E.u_image),new z.IntegerPassUniform("u_hillshadeType",E=>E.symbolizer.u_hillshadeType),new h.FloatsPassUniform("u_sinZcosAs",E=>E.symbolizer.u_sinZcosAs,6),new h.FloatsPassUniform("u_sinZsinAs",E=>E.symbolizer.u_sinZsinAs,6),new h.FloatsPassUniform("u_cosZs",E=>E.symbolizer.u_cosZs,6),new h.FloatsPassUniform("u_weights",E=>E.symbolizer.u_weights,6),new g.Float2PassUniform("u_factor",E=>E.symbolizer.u_factor),
new e.FloatPassUniform("u_minValue",E=>E.symbolizer.u_minValue),new e.FloatPassUniform("u_maxValue",E=>E.symbolizer.u_maxValue),new g.Float2PassUniform("u_srcImageSize",E=>E.common.u_srcImageSize));B.include(d.ColorConversion);B.code.add(n.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);B.code.add(n.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);C=C.applyColormap?n.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:n.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;B.code.add(n.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${C}
    }
  `)}let x=function(B){function C(E,F,M,K,G,L){E=B.call(this,E,K,G)||this;E.colormap=F;E.symbolizer=M;E.u_colormap=L;E.backgroundColor=c.ZEROS;E.fboTexture=null;E.baseOpacity=1;return E}b._inherits(C,B);return b._createClass(C)}(u.CommonPassParameters),D=function(B){function C(){return B.apply(this,arguments)||this}b._inherits(C,B);return b._createClass(C)}(x),A=function(B){function C(){return B.apply(this,arguments)||this}b._inherits(C,B);return b._createClass(C)}(x);const v=Object.freeze(Object.defineProperty({__proto__:null,
ColorizerHillshadeUniforms:A,ColorizerStretchUniforms:D,ColorizerUniforms:x,build:t},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=A;a.ColorizerStretchUniforms=D;a.ColorizerUniforms=x;a.RasterColorizer=v;a.build=t})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));
a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,y){a.Colormap=function(p){p.fragment.uniforms.add(new y.Texture2DPassUniform("u_colormap",
u=>u.u_colormap),new b.FloatPassUniform("u_colormapOffset",u=>u.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",u=>u.colormap.u_colormapMaxIndex),new b.FloatPassUniform("u_opacity",u=>u.common.u_opacity));p.fragment.code.add(c.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,y,p,u,q,k){y=function(d){function f(g,e,h){var z=d.call(this)||
this;z.common=g;z.u_image=e;z.u_transformGrid=h;return z}b._inherits(f,d);return b._createClass(f)}(y.TileCompositePassParameters);a.Common=function(d,f){d.include(c.Projection);d.fragment.uniforms.add(new k.Texture2DPassUniform("u_image",g=>g.u_image),new p.BooleanPassUniform("u_flipY",g=>g.common.u_flipY),new p.BooleanPassUniform("u_applyTransform",g=>g.common.u_applyTransform));({requireBilinearWithNN:f}=f);f&&d.fragment.uniforms.add(new u.Float2PassUniform("u_srcImageSize",g=>g.common.u_srcImageSize));
d.fragment.code.add(q.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);f?d.fragment.code.add(q.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):d.fragment.code.add(q.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,y){a.Projection=function(p){p.fragment.uniforms.add(new y.Texture2DPassUniform("u_transformGrid",u=>u.u_transformGrid),new b.Float2PassUniform("u_transformSpacing",u=>u.common.u_transformSpacing),
new b.Float2PassUniform("u_targetImageSize",u=>u.common.u_targetImageSize));p.fragment.code.add(c.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,y,p,u,q){let k=function(d){function f(){var g=d.apply(this,arguments)||this;g.scale=
1;g.offset=c.ZEROS;return g}b._inherits(f,d);return b._createClass(f)}(u.NoParameters);a.TileComposite=function(d){d.attributes.add(q.VertexAttribute.POSITION,"vec2");d.attributes.add(q.VertexAttribute.UV0,"vec2");d.vertex.uniforms.add(new p.FloatPassUniform("scale",f=>f.scale));d.vertex.uniforms.add(new y.Float2PassUniform("offset",f=>f.offset));d.varyings.add("uv","vec2");d.varyings.add("vuv","vec2");d.vertex.code.add(u.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.BlendLayersOutput=void 0;(function(e){e[e.Composite=0]="Composite";e[e.ColorComposite=1]="ColorComposite";e[e.GridComposite=2]="GridComposite";e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite";e[e.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(e){e[e.NotRequired=0]="NotRequired";e[e.Required=1]="Required";e[e.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;
(function(e){e[e.Off=0]="Off";e[e.On=1]="On";e[e.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));let g=function(e){function h(){var z=e.apply(this,arguments)||this;z.baseOpacity=1;z.backgroundColor=c.ZEROS;z.fboTexture=null;return z}b._inherits(h,e);return b._createClass(h)}(d.NoParameters);a.TileBackground=function(e,h){const z=h.output===a.BlendLayersOutput.GridComposite,n=h.output===a.BlendLayersOutput.ColorComposite,l=h.output===a.BlendLayersOutput.GroupBackgroundComposite,
m=h.output===a.BlendLayersOutput.Composite;z&&e.fragment.include(p.BackgroundGrid);n&&e.fragment.uniforms.add(new q.Float3PassUniform("backgroundColor",x=>x.backgroundColor));const t=h.baseOpacityMode===a.BaseOpacityMode.Required;t&&e.fragment.uniforms.add(new k.FloatPassUniform("baseOpacity",x=>x.baseOpacity));m&&e.fragment.uniforms.add(new f.Texture2DPassUniform("fboColor",x=>x.fboTexture));const w=h.blendMode!==y.LayerBlendMode.Normal,r=h.premultipliedSource===a.PremultipliedAlphaSource.On;e.fragment.include(u.BlendModes,
h);e.fragment.code.add(d.glsl`
    vec4 getBackground(vec2 uv) {
      return ${t?d.glsl`baseOpacity *`:""} ${l?d.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:n?d.glsl`vec4(backgroundColor, 1.0)`:z?d.glsl`vec4(gridColor(uv), 1.0)`:d.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${w?d.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:d.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!r&&(m&&!t||l)?d.glsl`colorLayer * opacity;`:d.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(c){c.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,c){a.BlendModes=function(y,p){p=p.blendMode;if(p!==b.LayerBlendMode.Normal){p===b.LayerBlendMode.Reflect&&y.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);p!==b.LayerBlendMode.ColorDodge&&p!==b.LayerBlendMode.VividLight||y.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);p!==b.LayerBlendMode.ColorBurn&&p!==b.LayerBlendMode.VividLight||y.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);p===b.LayerBlendMode.Overlay&&y.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);p===b.LayerBlendMode.HardLight&&y.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);p===b.LayerBlendMode.SoftLight&&y.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);p===b.LayerBlendMode.VividLight&&y.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(p===b.LayerBlendMode.Hue||p===b.LayerBlendMode.Saturation||p===b.LayerBlendMode.Color||p===b.LayerBlendMode.Luminosity)y.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),p!==b.LayerBlendMode.Hue&&p!==b.LayerBlendMode.Saturation||y.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);y.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${p===b.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
p===b.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:p===b.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:p===b.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:p===b.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
p===b.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:p===b.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:p===b.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:p===b.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:p===b.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:p===b.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:p===b.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:p===b.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:p===b.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:p===b.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./contextUtils ./enums ./Texture ./TextureDescriptor".split(" "),function(a,b,c,y,p,u){a.createColormapTexture=function(q,k){const d=new u.TextureDescriptor;d.internalFormat=y.PixelFormat.RGBA;d.width=k.length/4;d.height=1;d.samplingMode=y.TextureSamplingMode.NEAREST;d.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;return new p.Texture(q,d,k)};a.createRasterTexture=
function(q,k,d="nearest",f=!1){const g=(f=!(f&&"u8"===k.pixelType))?y.PixelType.FLOAT:y.PixelType.UNSIGNED_BYTE,e=null==k.pixels||0===k.pixels.length?null:f?k.getAsRGBAFloat():k.getAsRGBA(),h=q.capabilities.textureFloat?.textureFloatLinear,z=new u.TextureDescriptor;z.width=k.width;z.height=k.height;z.internalFormat=q.type===c.ContextType.WEBGL2&&f?y.SizedPixelFormat.RGBA32F:y.PixelFormat.RGBA;z.samplingMode=!h||"bilinear"!==d&&"cubic"!==d?y.TextureSamplingMode.NEAREST:y.TextureSamplingMode.LINEAR;
z.dataType=g;z.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;return new p.Texture(q,z,e)};a.createTransformTexture=function(q,k){const {spacing:d,offsets:f,coefficients:g,size:[e,h]}=k;var z=1<d[0];k=new u.TextureDescriptor;k.width=z?4*e:e;k.height=h;k.internalFormat=q.type===c.ContextType.WEBGL2?y.SizedPixelFormat.RGBA32F:y.PixelFormat.RGBA;k.dataType=y.PixelType.FLOAT;k.samplingMode=y.TextureSamplingMode.NEAREST;k.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;const n=new Float32Array(z?e*h*16:2*f.length);
if(z&&null!=g)for(let l=0,m=0;l<g.length;l++)n[m++]=g[l],2===l%3&&(n[m++]=1);else for(z=0;z<h;z++)for(let l=0;l<e;l++){const m=4*(z*e+l),t=2*(l*h+z);n[m]=f[t];n[m+1]=f[t+1];n[m+3]=-1===f[t]?0:1}return new p.Texture(q,k,n)};a.getBasicGridUniforms=function(q,k){return{u_scale:q,u_offset:k}};a.getColormapUniforms=function(q,k){return{u_colormapOffset:k||0,u_colormapMaxIndex:q?q.length/4-1:0}};a.getCommonUniforms=function(q,k,d,f=1,g=!0){return{u_flipY:g,u_applyTransform:!!q,u_opacity:f,u_transformSpacing:q?
q.spacing:b.ZEROS,u_transformGridSize:q?q.size:b.ZEROS,u_targetImageSize:k,u_srcImageSize:d}};a.getShadedReliefUniforms=function(q){return{u_hillshadeType:q.hillshadeType,u_sinZcosAs:q.sinZcosAs,u_sinZsinAs:q.sinZsinAs,u_cosZs:q.cosZs,u_weights:q.weights,u_factor:q.factor,u_minValue:q.minValue,u_maxValue:q.maxValue}};a.getStretchUniforms=function(q){return{u_bandCount:q.bandCount,u_minOutput:q.outMin,u_maxOutput:q.outMax,u_minCutOff:q.minCutOff,u_maxCutOff:q.maxCutOff,u_factor:q.factor,u_useGamma:q.useGamma,
u_gamma:q.gamma,u_gammaCorrection:q.gammaCorrection}};a.getUniformLocationInfos=function(q,k){q=q.gl;k=k.glName;const d=new Map;if(null==k)return d;const f=q.getProgramParameter(k,q.ACTIVE_UNIFORMS);let g;for(let e=0;e<f;e++)(g=q.getActiveUniform(k,e))&&d.set(g.name,{location:q.getUniformLocation(k,g.name),info:g});return d};a.setTextures=function(q,k,d,f){d.length===f.length&&(f.some(g=>null==g)||d.some(g=>null==g)||d.forEach((g,e)=>{k.setUniform1i(g,e);q.bindTexture(f[e],e)}))};a.setUniforms=function(q,
k,d){Object.keys(d).forEach(f=>{var g=k.get(f)||k.get(f+"[0]");if(g){var e=d[f];if(null!==g&&null!=e)switch({info:g}=g,g.type){case y.UniformType.FLOAT:1<g.size?q.setUniform1fv(f,e):q.setUniform1f(f,e);break;case y.UniformType.FLOAT_VEC2:q.setUniform2fv(f,e);break;case y.UniformType.FLOAT_VEC3:q.setUniform3fv(f,e);break;case y.UniformType.FLOAT_VEC4:q.setUniform4fv(f,e);break;case y.UniformType.FLOAT_MAT3:q.setUniformMatrix3fv(f,e);break;case y.UniformType.FLOAT_MAT4:q.setUniformMatrix4fv(f,e);break;
case y.UniformType.INT:1<g.size?q.setUniform1iv(f,e):q.setUniform1i(f,e);break;case y.UniformType.BOOL:q.setUniform1i(f,e?1:0);break;case y.UniformType.INT_VEC2:case y.UniformType.BOOL_VEC2:q.setUniform2iv(f,e);break;case y.UniformType.INT_VEC3:case y.UniformType.BOOL_VEC3:q.setUniform3iv(f,e);break;case y.UniformType.INT_VEC4:case y.UniformType.BOOL_VEC4:q.setUniform4iv(f,e)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,y,p,u,q){let k=function(){function g(){this.waitingAgents=new p;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}g.acquire=function(h){const z=d.acquire();z._init(h);return z};var e=g.prototype;e.release=function(){this.dispose();f.delete(this);d.release(this)};e.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=u.releaseTileData(this._data)};
g.prune=function(){d.prune(0)};e._init=function(h){this.waitingAgents.clear();this._data=u.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=h;this.elevationBounds=null};e.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};e.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};e._unsetUpsampleInfo=
function(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};e.setUpsampleInfo=function(h,z){if(h===z||null==z)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===z)return;this._upsampleInfo.tile.unrefMapData()}z.refMapData();q.computeUpsampleInfo(h,z,this._upsampleInfo)}};b._createClass(g,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},
{key:"data",get:function(){return this._data},set:function(h){u.releaseTileData(this._data);this._data=h}}]);return g}();const d=new y(k,null,()=>{}),f=new Map;a.TilePerLayerInfo=k;a.printAllocations=function(){0<f.size&&(console.log(`${f.size} live TilePerLayerInfo allocations:`),f.forEach(g=>console.log(g,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(y){this._texture=
y;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}},{key:"gpuMemoryUsage",get:function(){return this._texture.gpuMemoryUsage}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],
function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.RENDERDATA=8]="RENDERDATA";b[b.GEOMETRY=16]="GEOMETRY";b[b.TEXTURE_NOFADING=32]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=64]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec4f64"],function(a,
b){return function(){function c(){this._scales=b.fromValues(-1,-1,-1,-1);this._offsets=b.fromValues(-1,-1,-1,-1)}var y=c.prototype;y.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};y.setScale=function(p,u,q){this._scales[2*p]=u;this._scales[2*p+1]=q};y.setOffset=function(p,u,q){this._offsets[2*p]=u;this._offsets[2*p+1]=q};a._createClass(c,[{key:"scales",get:function(){return this._scales}},
{key:"offsets",get:function(){return this._offsets}}]);return c}()})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,c,y,
p,u,q,k,d,f,g,e,h){q=function(n){function l(){var t=n.apply(this,arguments)||this;t.useStencil=!1;return t}c._inherits(l,n);var m=l.prototype;m.initializeConfiguration=function(t,w){w.spherical=t.viewingMode===y.ViewingMode.Global};m.initializeProgram=function(t){return new d.Program(t.rctx,l.shader.get().build(this.configuration),z)};m.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};m._createPipeline=function(t){const w=this.configuration,
r=w.backfaceCullingEnabled&&!w.renderOccluded;return h.makePipelineState({blending:w.renderOccluded?h.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:r?h.backFaceCullingParams:null,depthTest:w.renderOccluded?null:{func:e.CompareFunction.LESS},depthWrite:w.renderOccluded?null:h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilTest:t?f.renderWhenBitIsNotSet(k.StencilBits.IntegratedMeshMaskExcluded):null})};m.getPipelineState=function(t,w){return this.useStencil?
this._stencilPipelineState:c._get(c._getPrototypeOf(l.prototype),"getPipelineState",this).call(this,t,w)};return c._createClass(l)}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(p.Terrain,()=>new Promise((n,l)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],n,l)));const z=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.UV0,1],[g.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=q;b.terrainVertexAttributeLocations=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G){function L(J){const N=new K.ShaderBuilder,{vertex:R,fragment:W,varyings:T}=N;N.include(h.PositionAttribute);N.include(e.NormalAttribute,J);N.include(z.TextureCoordinateAttribute,J);var P=()=>{N.include(x.NormalUtils,J);R.code.add(F.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};C.addProjViewLocalOrigin(R,J);N.include(g.Transform,J);const Q=J.overlayMode!==v.OverlayMode.Disabled;var S=Q&&J.invisible;switch(J.output){case d.ShaderOutput.Color:N.include(B.TerrainTexture,J);N.include(w.EvaluateSceneLighting,J);Q&&N.include(B.OverlayTerrain,{...J,pbrMode:J.pbrMode===D.PBRMode.Terrain?D.PBRMode.TerrainWithWater:D.PBRMode.Water});(S=J.overlayMode===v.OverlayMode.EnabledWithWater)&&N.include(n.VertexTangent,J);T.add("vnormal","vec3");T.add("vpos","vec3");T.add("vup","vec3");
P();J.screenSizePerspective&&C.addViewNormal(R);(P=J.receiveShadows&&!J.renderOccluded)&&N.include(k.ForwardLinearDepth,J);J.screenSizePerspective&&(T.add("screenSizeDistanceToCamera","float"),T.add("screenSizeCosAngle","float"));R.code.add(F.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${S?F.glsl`forwardVertexTangent(vnormal);`:F.glsl``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${Q?F.glsl`setOverlayVTC(uv);`:""}
          ${J.tileBorders?F.glsl`forwardTextureCoordinates();`:""}

          ${J.screenSizePerspective?F.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${P?F.glsl`forwardLinearDepth();`:""}

        }
      `);N.include(f.SliceDraw,J);N.include(w.EvaluateSceneLighting,J);N.include(t.EvaluateAmbientOcclusion,J);N.include(A.ReadShadowMapDraw,J);C.addCameraPosition(W,J);w.addAmbientBoostFactor(W);w.addLightingGlobalFactor(W);W.uniforms.add(R.uniforms.get("localOrigin"),new E.Float3PassUniform("viewDirection",(U,V)=>p.normalize(H,p.set(H,V.camera.viewMatrix[12],V.camera.viewMatrix[13],V.camera.viewMatrix[14]))));S&&W.uniforms.add(new G.Texture2DPassUniform("ovWaterTex",(U,V)=>0===V.overlays.length?
null:V.overlays[q.OverlayIndex.INNER].getNormalTexture(U.overlaySource)),new M.Matrix4DrawUniform("view",(U,V)=>c.translate(I,V.camera.viewMatrix,U.origin)));W.code.add(F.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);r.addMainLightDirection(W);r.addMainLightIntensity(W);W.code.add(F.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${J.receiveShadows&&!J.renderOccluded?"readShadowMap(vpos, linearDepth)":J.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${Q?F.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${J.invisible?F.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${J.pbrMode===D.PBRMode.Terrain||J.pbrMode===D.PBRMode.TerrainWithWater?F.glsl`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:F.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${S?F.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${J.screenSizePerspective?F.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${J.visualizeNormals?J.spherical?F.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:F.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${J.tileBorders?F.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case d.ShaderOutput.Depth:S&&N.include(B.OverlayTerrain,J);N.include(l.OutputDepth,J);k.addLinearDepth(N);k.addNearFar(N);R.code.add(F.glsl`
              void main(void) {
                ${S?F.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);W.code.add(F.glsl`
              void main() {
                ${S?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case d.ShaderOutput.Shadow:case d.ShaderOutput.ShadowHighlight:case d.ShaderOutput.ShadowExcludeHighlight:N.include(l.OutputDepth,J);k.addLinearDepth(N);k.addNearFar(N);R.code.add(F.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);W.code.add(F.glsl`void main() {
outputDepth(linearDepth);
}`);break;case d.ShaderOutput.Normal:S&&N.include(B.OverlayTerrain,J);T.add("vnormal","vec3");C.addViewNormal(R);P();R.code.add(F.glsl`
            void main(void) {
              ${S?F.glsl`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `);W.code.add(F.glsl`
            void main() {
              ${S?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case d.ShaderOutput.Highlight:Q&&N.include(B.OverlayTerrain,J),R.code.add(F.glsl`
          void main() {
            ${Q?F.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),N.include(m.OutputHighlight,J),W.code.add(F.glsl`
          void main() {
            ${Q?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}J.output===d.ShaderOutput.ObjectAndLayerIdColor&&(N.include(B.OverlayTerrain,{...J,pbrMode:D.PBRMode.Disabled}),R.code.add(F.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),W.code.add(F.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`));return N}let O=function(J){function N(){return J.apply(this,arguments)||this}b._inherits(N,J);return b._createClass(N)}(B.OverlayTerrainPassParameters);const I=y.create(),H=u.create();y=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:O,build:L},Symbol.toStringTag,{value:"Module"}));a.Terrain=y;a.TerrainPassParameters=O;a.build=L})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],
function(a,b){a.VertexTangent=function(c,y){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent","vec3");y.spherical?c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/Overlay ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(m,t){t.pbrMode!==d.PBRMode.Water&&t.pbrMode!==d.PBRMode.WaterOnIntegratedMesh&&t.pbrMode!==d.PBRMode.TerrainWithWater||m.include(f.Water,t);const {vertex:w,fragment:r}=m;m.varyings.add("vtcOverlay","vec4");w.code.add(e.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);r.code.add(e.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);r.code.add(e.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);r.code.add(e.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(t.pbrMode===d.PBRMode.Water||t.pbrMode===d.PBRMode.WaterOnIntegratedMesh||t.pbrMode===d.PBRMode.TerrainWithWater)k.addMainLightDirection(r),k.addMainLightIntensity(r),r.code.add(e.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function n(m,t){return 0===t.overlays.length?null:m.identifier===u.RenderPassIdentifier.Material&&m.output===q.ShaderOutput.Color?t.overlays[y.OverlayIndex.INNER].getColorTextureNoRasterImage():m.identifier===u.RenderPassIdentifier.Material&&m.output===q.ShaderOutput.ObjectAndLayerIdColor?t.overlays[y.OverlayIndex.INNER].getColorTexture(p.OverlaySource.ObjectAndLayerIdColor):m.identifier===u.RenderPassIdentifier.Highlight?t.overlays[y.OverlayIndex.INNER].getValidTexture(y.RenderTargetType.Highlight):
null}a.OverlayMode=void 0;(function(m){m[m.Disabled=0]="Disabled";m[m.Enabled=1]="Enabled";m[m.EnabledWithWater=2]="EnabledWithWater";m[m.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));const l=b.create();a.OverlayIM=function(m,t){const {vertex:w,fragment:r}=m;w.uniforms.add(new g.Float4DrawUniform("overlayTexOffset",(x,D)=>{for(const A of D.overlays){const {index:v,extent:B}=A;0<c.area(B)&&(l[2*v]=x.toMapSpace[0]/c.width(B)-B[0]/c.width(B),l[2*v+1]=x.toMapSpace[1]/c.height(B)-B[1]/c.height(B))}return l}),
new g.Float4DrawUniform("overlayTexScale",(x,D)=>{for(const A of D.overlays){const {index:v,extent:B}=A;0<c.area(B)&&(l[2*v]=x.toMapSpace[2]/c.width(B),l[2*v+1]=x.toMapSpace[3]/c.height(B))}return l}));r.constants.add("overlayOpacity","float",1);r.uniforms.add(new h.Texture2DPassUniform("ovColorTex",(x,D)=>n(x,D)));z(m,t)};a.getColorTexture=n;a.overlay=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,y,p){let u=function(f){function g(){var e=f.apply(this,arguments)||this;e.slicePlaneLocalOrigin=c.create();e.origin=e.slicePlaneLocalOrigin;e.modelTransformation=null;return e}b._inherits(g,f);return b._createClass(g)}(p.VertexNormalPassParameters);p=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,
f);return b._createClass(g)}(p.VertexNormalDrawParameters);a.RenderPassIdentifier=void 0;(function(f){f[f.Material=0]="Material";f[f.ShadowMap=1]="ShadowMap";f[f.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));let q=function(f){function g(){var e=f.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.Material;e.output=y.ShaderOutput.Color;e.transparent=!1;e.integratedMesh=!1;return e}b._inherits(g,f);return b._createClass(g)}(u),k=function(f){function g(){var e=
f.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.ShadowMap;return e}b._inherits(g,f);return b._createClass(g)}(u),d=function(f){function g(){var e=f.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.Highlight;return e}b._inherits(g,f);return b._createClass(g)}(u);a.DrawParameters=p;a.HighlightPassParameters=d;a.MaterialPassParameters=q;a.PassParameters=u;a.ShadowMapPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"vec4",y.BindType.Draw,(d,f,g)=>d.setUniform4fv(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.Float4DrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../terrain/interfaces ../../../../terrain/Overlay ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./Overlay.glsl ./TileBlendInput ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){p=function(m){function t(){var w=m.apply(this,arguments)||this;w.overlayOpacity=1;w.overlaySource=y.OverlaySource.None;return w}b._inherits(t,m);return b._createClass(t)}(p.ReadShadowMapPassParameters);let h=function(m){function t(w){return m.call(this,w,"float")||this}b._inherits(t,m);return b._createClass(t)}(e.Uniform),z=function(m){function t(w){return m.call(this,w,"vec3")||this}b._inherits(t,m);return b._createClass(t)}(e.Uniform),n=function(m){function t(w){return m.call(this,
w,"vec4")||this}b._inherits(t,m);return b._createClass(t)}(e.Uniform),l=function(m){function t(w){return m.call(this,w,"sampler2D")||this}b._inherits(t,m);return b._createClass(t)}(e.Uniform);a.Float3Uniform=z;a.OverlayTerrain=function(m,t){m.vertex.uniforms.add(new n("overlayTexOffset"),new n("overlayTexScale"));m.fragment.uniforms.add(new d.FloatPassUniform("overlayOpacity",w=>w.overlayOpacity),new g.Texture2DPassUniform("ovColorTex",(w,r)=>0===r.overlays.length?null:r.overlays[c.OverlayIndex.INNER].getColorTexture(w.overlaySource)));
q.overlay(m,t)};a.OverlayTerrainPassParameters=p;a.TerrainTexture=function(m,t){const {vertex:w,fragment:r,varyings:x}=m;x.add("vtc","vec2");w.uniforms.add(new n("texOffsetAndScale"));r.uniforms.add(new l("tex"));r.uniforms.add(new z("textureOpacities"));if(m=t.textureFadingEnabled&&!t.renderOccluded)w.uniforms.add(new n("nextTexOffsetAndScale")),x.add("nvtc","vec2"),r.uniforms.add(new l("texNext")),r.uniforms.add(new z("nextTexOpacities")),r.uniforms.add(new h("fadeFactor"));const D=t.tileBlendInput===
k.TileBlendInput.ColorComposite;(t=t.tileBlendInput===k.TileBlendInput.GridComposite)&&r.include(u.BackgroundGrid);D&&r.uniforms.add(new z("backgroundColor"));w.code.add(f.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${m?f.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:f.glsl``}
  }`);r.code.add(f.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${t||D?f.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${D?f.glsl`backgroundColor`:f.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:f.glsl`return color;`}
    }`);m?r.code.add(f.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(f.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4 ../../../chunks/vec4f64".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=b._createClass(function(){this.extent=h.create();this.maxLevel=this.minLevel=0;this.callback=null});a.ScaleRangeQueries=function(n){function l(){var t=n.apply(this,arguments)||this;t._queries=new u({initialSize:10});t._queriesInvPtr=0;t._queryQueue=new u({initialSize:30});t._queryPool=new p(z);return t}b._inherits(l,n);var m=l.prototype;m.queryVisibleLevelRange=function(t,w,r,x){const D=this._queryPool.acquire();e.copy(D.extent,t);D.minLevel=null==w?-Number.MAX_VALUE:
w;D.maxLevel=null==r?Number.MAX_VALUE:r;D.callback=x;this._queryQueue.push(D);this.notifyChange("updating")};m.prepare=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length};m.process=function(){for(let t=0;t<this._queries.length;t++){const w=this._queries.data[t];this._queryPool.release(w);w.callback(t>=this._queriesInvPtr);w.callback=null}this._queries.clear();this.notifyChange("updating")};
m.queriesForTile=function(t){const w=t.level;let r=0;for(;r<this._queriesInvPtr;){const x=this._queries.data[r],D=x.extent;w>=x.minLevel&&w<=x.maxLevel&&D[0]<=t.extent[2]&&D[2]>=t.extent[0]&&D[1]<=t.extent[3]&&D[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}};b._createClass(l,[{key:"updating",get:function(){return 0!==this._queryQueue.length}}]);return l}(y);c.__decorate([q.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=
c.__decorate([g.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./ITile ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(A,v,B,C,E,F){A=C-A;v=E-v;B=F-B;return A*A+v*v+B*B}let m=function(A){function v(C,E,F){var M=A.call(this)||this;M._convexHull=Array(24);M._boundingSphere=d.create();void 0!==C&&M.init(C,E,F);return M}b._inherits(v,A);var B=v.prototype;B.init=function(C,E,F){b._get(b._getPrototypeOf(v.prototype),"init",this).call(this,C,E,F);E=this.ellipsoid.radius;F=this.extentInRadians[0];const M=this.extentInRadians[1],K=this.extentInRadians[2],G=this.extentInRadians[3];
C=C[0];const L=c.lerp(M,G,.5),O=c.lerp(F,K,.5);this._edgeLen=(K-F)*Math.cos(0===C?0:Math.min(Math.abs(M),Math.abs(G)))*E;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=E-Math.sqrt(E*E-this._edgeLen2/4);u.lonLatToSphericalPCPF(this.centerAtSeaLevel,O,L,this.ellipsoid.radius);y.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()};B.updateRadiusAndCenter=function(){this._updateBoundingVolumes();const C=this._center;if(0===this.lij[0])y.set(C[z.CenterPosition.MIDDLE],
0,0,0),y.set(C[z.CenterPosition.TOP],0,0,0),y.set(C[z.CenterPosition.BOTTOM],0,0,0),C[z.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const G=C[z.CenterPosition.MIDDLE],L=this.convexHull;var E=0;for(let O=0;8>O;++O){var F=Math,M=F.max;var K=3*O;K=l(G[0],G[1],G[2],L[K],L[K+1],L[K+2]);E=M.call(F,E,K)}C[z.CenterPosition.MIDDLE][3]=Math.sqrt(E)}};B._calculateFrustumVisibilityStatus=function(C){if(!k.intersectsSphere(C,this._boundingSphere))return g.TileFrustumVisibility.OUTSIDE;
if(10>this.lij[0])return g.TileFrustumVisibility.INTERSECTS;const E=this.convexHull,F=this.surface.view.state.camera.near;let M=!0;for(let G=0;G<k.NumPlanes;G++){var K=C[G];const L=K[0],O=K[1],I=K[2];K=K[3]-(G===k.PlaneIndex.NEAR?F:0);let H=!1;for(let J=0;8>J;++J){const N=3*J;if(0>L*E[N]+O*E[N+1]+I*E[N+2]+K){if(H=!0,!M)break}else M=!1}if(!H)return g.TileFrustumVisibility.OUTSIDE}return M?g.TileFrustumVisibility.INSIDE:g.TileFrustumVisibility.INTERSECTS};B.computeElevationBounds=function(){b._get(b._getPrototypeOf(v.prototype),
"computeElevationBounds",this).call(this);this._updateBoundingVolumes()};B.createGeometry=function(){e.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()};B._updateBoundingVolumes=function(){this._updateConvexHull();this._updateBoundingSphere();h.ENABLE_TERRAIN_INTERNAL_CHECKS&&this._checkBVs()};B._updateBoundingSphere=function(){const C=this._boundingSphere;var E=this.elevationBounds,F=this.ellipsoid.radius,M=E[1];if(0===this.level)y.set(C,
0,0,0),C[3]=F+M;else{M=this.extentInRadians;var K=.5*(M[0]+M[2]),G=M[3];w(x,K,M[1],F);w(D,K,G,F);y.add(C,x,D);y.scale(C,C,(F+.5*(E[0]+E[1]))/y.len(C));E=this.convexHull;F=0;for(M=0;8>M;++M){K=C[0]-E[3*M];G=C[1]-E[3*M+1];const L=C[2]-E[3*M+2];F=Math.max(F,Math.sqrt(K*K+G*G+L*L))}C[3]=F+2}};B._updateConvexHull=function(){var C=this.extentInRadians,E=this.ellipsoid.radius;if(0!==this.level){var F=this.elevationBounds,M=this._getPatchType(),K=this.surface.isWebMercator,G=K&&M===f.PatchType.HAS_NORTH_POLE,
L=(M=K&&M===f.PatchType.HAS_SOUTH_POLE)||G;K=Math.PI/2;var O=C[0],I=C[2];M=M?-K:C[1];var H=G?K:C[3],J=.5*(O+I);C=F[0];var N=E+(L?Math.min(0,C-1):C);C=p.create();G=p.create();K=p.create();var R=p.create();w(C,O,M,N);w(G,O,H,N);w(K,I,H,N);w(R,I,M,N);O=(S,U)=>{for(let V=0;3>V;++V)this._convexHull[3*U+V]=S[V]};O(C,0);O(G,1);O(K,2);O(R,3);F=F[1];var W=E+(L?Math.max(0,F+1):F),T=p.create();E=p.create();F=p.create();w(E,J,H,N);w(F,J,M,N);y.add(T,E,F);y.normalize(T,T);var P=p.create(),Q=p.create();M=(S,U)=>
{y.sub(Q,S,U);y.normalize(Q,Q);U=-y.dot(S,P)/y.dot(Q,P);h.internalAssert(0<=U);y.scale(Q,Q,U);y.add(S,S,Q)};2**this.lij[0]>2*this.lij[1]?(E=p.create(),y.cross(E,r,F),y.normalize(E,E),y.cross(P,F,E),y.normalize(P,P),h.internalAssert(h.almostEquals(y.dot(P,F)/y.len(F),0)),M(C,G),M(R,K),O(C,0),O(R,3)):2**this.lij[0]!==2*this.lij[1]&&(F=p.create(),y.cross(F,r,E),y.normalize(F,F),y.cross(P,F,E),y.normalize(P,P),M(G,C),M(K,R),O(G,1),O(K,2));E=(S,U)=>{const V=W/y.dot(U,T);for(let X=0;3>X;++X)this._convexHull[3*
S+X]=U[X]*V};E(4,C);E(5,G);E(6,K);E(7,R)}};B._getPatchType=function(){const C=this.lij[1],E=C===(1<<this.level)-1;return 0===C?E?f.PatchType.HAS_BOTH_POLES:f.PatchType.HAS_NORTH_POLE:E?f.PatchType.HAS_SOUTH_POLE:f.PatchType.REGULAR};B.intersectsRay=function(C,E,F,M){var K=this._boundingSphere;F=K[3]+F;var G=K[0]-C[0];M=K[1]-C[1];C=K[2]-C[2];K=(G*E[0]+M*E[1]+C*E[2])/(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);G=E[0]*K-G;M=E[1]*K-M;E=E[2]*K-C;return G*G+M*M+E*E<F*F};B.getDefaultVerticesPerSide=function(){return this.level<
t.length?t[this.level]+1:2};B.updateCornerElevations=function(){e.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()};B.updateEdgeElevations=function(){e.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()};B._checkBVs=function(){if(h.ENABLE_TERRAIN_INTERNAL_CHECKS&&!(2>=this.level)){var C=this._boundingSphere,E=C[3],F=p.create(),M=this.ellipsoid.radius,K=this.elevationBounds;K[1]-K[0];var G=M+K[0],L=this._center[z.CenterPosition.MIDDLE][3],O=this.convexHull,
I=(qa,ua)=>{for(let sa=0;3>sa;++sa)qa[sa]=O[3*ua+sa]},H=p.create(),J=p.create(),N=p.create(),R=p.create(),W=p.create(),T=(qa,ua,sa,pa)=>{I(J,qa);I(N,ua);I(R,sa);y.sub(J,J,N);y.sub(R,R,N);y.cross(H,J,R);y.normalize(H,H);var ka=y.dot(H,N);I(W,pa);const ra=y.dot(H,W);ka=Math.abs(ra-ka);h.internalAssert(h.almostEquals(ka,0),`Non coplanar ${qa},${ua},${sa},${pa} diff = ${ka}`)};T(0,1,2,3);T(4,5,6,7);T(0,1,4,5);T(1,2,5,6);T(2,3,6,7);T(3,0,7,4);var P=q.newDoubleArray(24),Q=p.create(),S=p.create(),U=p.create(),
V=p.create();T=(qa,ua,sa,pa)=>{I(Q,ua);I(S,sa);I(U,pa);y.sub(Q,Q,S);y.normalize(Q,Q);y.sub(U,U,S);y.normalize(U,U);y.cross(V,Q,U);y.normalize(V,V);ua=y.dot(V,S);qa*=4;for(sa=0;3>sa;++sa)P[qa+sa]=V[sa];P[qa+3]=ua};T(0,0,1,2);T(1,1,0,4);T(2,1,5,2);T(3,3,2,6);T(4,4,0,3);T(5,4,6,5);var X=(qa,ua,sa,pa)=>{qa*=4;return P[qa]*ua+P[qa+1]*sa+P[qa+2]*pa-P[qa+3]},Y=(qa,ua,sa,pa)=>-1<=X(qa,ua,sa,pa),Z=2**this.lij[0]>2*this.lij[1];T=(qa,ua,sa)=>Math.sqrt(l(qa,ua,sa,C[0],C[1],C[2]))<E;var ea=this.extentInRadians,
ja=.5*(ea[0]+ea[2]),ha=ea[1],ia=ea[3];ea=p.create();var oa=p.create();w(ea,ja,ia,G);w(oa,ja,ha,G);G=Z?"Upper":"Lower";Z=!0;for(ja=0;6>ja;++ja){for(ha=0;8>ha;++ha)ia=3*ha,ia=-1<=X(ja,O[ia],O[ia+1],O[ia+2]),Z&&(Z=ia),h.internalAssert(ia,`Tile[${this.lij}] Convex hull point ${ha} outside of plane ${ja}`);h.internalAssert(Y(ja,oa[0],oa[1],oa[2]),`Tile[${this.lij}] (${G}) bottom mid outside of plane ${ja}`);h.internalAssert(Y(ja,ea[0],ea[1],ea[2]),`Tile[${this.lij}] (${G}) top mid outside of plane ${ja}`)}h.internalAssert(Z,
"Not all convex hull points are inside  convex hull polyhedron");h.internalAssert(T(oa[0],oa[1],oa[2]),`Tile[${this.lij}] (${G}) bottom mid outside of bounding sphere`);h.internalAssert(T(ea[0],ea[1],ea[2]),`Tile[${this.lij}] (${G}) top mid outside of bounding sphere`);for(Y=0;8>Y;++Y)ea=3*Y,ea=T(O[ea],O[ea+1],O[ea+2]),h.internalAssert(ea,`Tile[${this.lij}] Convex hull point ${Y} outside of bounding sphere`);for(T=0;6>T;++T)for(Y=0;8>Y;++Y)ea=3*Y,-1<=X(T,O[ea],O[ea+1],O[ea+2])||console.error(`Tile[${this.lij}] Convex hull point ${Y} outside of plane ${T}`);
T=this.extentInRadians;T=Math.round(Math.max(T[2]-T[0],T[3]-T[1])*M);if(ja=this.renderData){var {geometry:ma,localOrigin:fa}=ja;if(Y=ma.vertexAttributes?.position){ea=Y.count;oa=p.create();G=ma.numVerticesPerSide-2;Z=G*G;ja=ja.geometryState.neighborData;ha=ja.edgeResolutions.reduce((qa,ua)=>qa+ua+1,0);for(let qa=0;qa<ea;++qa){const ua=qa<Z,sa=!ua&&qa<Z+ha;let pa=!1;ia=-1;if(sa){var ba=Z;for(var aa=0;4>aa;++aa){var da=ja.edgeResolutions[aa];if(qa===ba||qa===ba+da-1){pa=!0;break}ba+=da;if(qa<ba){ia=
aa;break}}}ia=sa?ja.edgePeerNeighbors[ia]:null;const ka=sa&&ia&&0<n.compareTilesByLij(this,ia);Y.getVec(qa,F);y.add(oa,F,fa);ia=y.len(oa)-M;ba=0;aa=!1;da=K[0]-ia;const ra=ia-K[1],va=1<da,Ca=1<ra;var ca=va||Ca;const Ba=()=>{const Ha=sa&&!pa;return`Tile[${this.lij}].vertex[${qa}]:${ua?"internal":Ha?"edge":pa?"corner":"pole"}`+(va?"(below)":Ca?"(above)":"")+(ka?"(Neighbor)":"")};var na=y.dist(oa,C);na>=E+0&&(na-=E,ca||(console.error(`${Ba()} is out of the bounding sphere by ${na.toFixed(0)} / ${E.toFixed(0)}`+
"[tol\x3d0]"+` h=${ia.toFixed(0)} / [${K[0].toFixed(0)}..${K[1].toFixed(0)}] (${(na/E).toFixed(0)})`),aa=!0));for(ca=0;6>ca;++ca)if(!(-1<=X(ca,oa[0],oa[1],oa[2]))){na=X(ca,oa[0],oa[1],oa[2]);const Ha=qa%G,Ma=(qa-Ha)/G;0===ca&&da||5===ca&&ra||(console.error(`${Ba()} (${Ha},${Ma})|${G}] is out of the bounding trapezoid plane ${ca}`+` h=${Math.round(ia)} / [${Math.round(K[0])}..${Math.round(K[1])}] dist=${Math.round(na)}`+` radii = ${Math.round(E)}/${Math.round(L)}} : maxL = ${T}`),++ba)}if(aa||0<ba)break}}}}};
b._createClass(v,[{key:"convexHull",get:function(){return this._convexHull}}]);return v}(z.Tile);const t=[128,64,64,32,16,8,8,4],w=(A,v,B,C)=>{const E=Math.sin(v),F=Math.cos(B);B=Math.sin(B);A[0]=C*F*Math.cos(v);A[1]=C*F*E;A[2]=C*B},r=[0,0,1],x=p.create(),D=p.create();a.SphericalPatch=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){a.SplitLimits=function(f){function g(){var e=f.apply(this,arguments)||this;e.fovX=0;e.fovY=0;e.relativeWidthLimit=0;e.relativeHeightLimit=0;e.maxLod=0;e.angledSplitBias=0;e.aboveGround=!0;return e}b._inherits(g,f);return b._createClass(g)}(y);c.__decorate([p.property()],a.SplitLimits.prototype,"fovX",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"fovY",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);c.__decorate([p.property()],
a.SplitLimits.prototype,"relativeHeightLimit",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"maxLod",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"aboveGround",void 0);c.__decorate([p.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=c.__decorate([d.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja){const ha=m.create();a.TransparencyMode=void 0;(function(ba){ba[ba.Opaque=0]="Opaque";ba[ba.Semitransparent=1]="Semitransparent";ba[ba.TransparentWithDraped=2]="TransparentWithDraped";ba[ba.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=function(ba){function aa(ca){ca=ba.call(this,ca)||this;ca.type=T.IntersectorType.TERRAIN;ca.isGround=!0;ca._tileSize=256;
ca._techniqueConfiguration=new ea.TerrainTechniqueConfiguration;ca._passParameters=new I.TerrainPassParameters;ca._rctx=null;ca._renderDataPool=new q(B.PatchRenderData);ca._patchGroups=new Map;ca._patchGroupsDirty=!0;ca._patchSortingDirty=!0;ca._tileIterator=new K.IteratorPreorder;ca._highestVisibleLODTile=null;ca._visible=!0;ca._transparencyState=a.TransparencyMode.Opaque;ca._castShadows=!0;ca._emptyTex=null;ca._tileRenderer=null;ca._stencilEnabledLayerExtents=[];ca._numTilesRendered=0;ca._numTilesCulled=
0;ca._numOriginsRendered=0;ca.needsHighlight=!1;ca.renderOccludedFlags=P.RenderOccludedFlag.Occlude;return ca}b._inherits(aa,ba);var da=aa.prototype;da.initialize=function(){this._stage.addRenderPlugin([Q.RenderSlot.OPAQUE_TERRAIN,Q.RenderSlot.TRANSPARENT_TERRAIN,Q.RenderSlot.OCCLUDED_TERRAIN],this)};da.destroy=function(){this._stage.removeRenderPlugin(this);v.clearCaches()};da.setDebugScreenSizePerspective=function(ca){this._techniqueConfiguration.screenSizePerspective!==ca&&(this._techniqueConfiguration.screenSizePerspective=
ca,this.setNeedsRender())};da.setRootTiles=function(ca){this._rootTiles=ca;this.setDirty()};da.setNeedsHighlight=function(ca){this.needsHighlight=ca;this.setNeedsRender()};da.setRenderOccludedOverlay=function(ca){this.renderOccludedFlags=ca?A.overlayRenderOccludedFlag:P.RenderOccludedFlag.Occlude;this.setNeedsRender()};da.setStencilEnabledLayerExtents=function(ca){this._stencilEnabledLayerExtents=ca;this._setSortingDirty()};da.setTileSize=function(ca){this._tileSize=ca;null!=this._tileRenderer&&(this._tileRenderer.tileSize=
ca);this.setDirty()};da._prepareTileForLoading=function(ca){ca.renderData||(ca.renderData=this._renderDataPool.acquire(),ca.renderData.init(ca),ca.renderData.localOrigin=this._getLocalOriginOfTile(ca))};da.loadTile=function(ca){this._prepareTileForLoading(ca);this.updateTileGeometryState(ca);this.updateTileTexture(ca,M.TileUpdate.TEXTURE_FADING)};da.updateTileTexture=function(ca,na){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(ca,na===M.TileUpdate.TEXTURE_FADING?r.TextureUpdate.FADING:
r.TextureUpdate.UNFADED),this.setNeedsRender(),ca.resetPendingUpdate(na))};da.updateTileGeometryState=function(ca){for(const na of ca.layerInfo[x.LayerClass.ELEVATION])na.pendingUpdates&=~M.TileUpdate.GEOMETRY;ca.resetPendingUpdate(M.TileUpdate.GEOMETRY);(ca=ca.renderData.updateGeometryState())&&this.setDirty();return ca};da.updateGeometryIfNeeded=function(ca){ca.isLoaded&&ca.renderData.updateGeometryIfNeeded(this._rctx)};da.unloadTile=function(ca){const na=ca.renderData;na&&(na.releaseGeometry(),
this._renderDataPool.release(na),na.clear(),ca.renderData=null,ca.setMemoryDirty(),this.setDirty())};da._getLocalOriginOfTile=function(ca){const na=Math.max(0,7*Math.floor((ca.level-3)/7));if(this._isGlobal&&0===na)return n.ZEROS;for(;ca.parent&&ca.level>na;)ca=ca.parent;return ca.centerAtSeaLevel};da.setVisibility=function(ca){this._visible=ca;this.setDirty()};da.getStats=function(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}};
da.setDirty=function(ca=N.RenderRequestType.UPDATE){this._patchGroupsDirty=!0;this._context.requestRender(ca)};da._setSortingDirty=function(ca=N.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(ca)};da.setNeedsRender=function(ca=N.RenderRequestType.UPDATE){this._context.requestRender(ca)};da.initializeRenderContext=function(ca){this._context=ca;this._rctx=ca.renderContext.rctx;this._techniqueRepository=ca.techniqueRepository;this._tileRenderer=new F.TileRenderer(this._rctx,
this._tileSize,this._techniqueRepository);this.updateTileBackground();this._emptyTex=R.createEmptyTexture(this._rctx)};da.uninitializeRenderContext=function(){this._emptyTex=u.disposeMaybe(this._emptyTex);this._tileRenderer=u.disposeMaybe(this._tileRenderer)};da.intersect=function(ca,na,qa,ua){if(!(!this._rootTiles||ca.options.selectOpaqueTerrainOnly&&ca.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var sa=ia,pa=oa;z.subtract(sa,ua,qa);z.set(pa,1/sa[0],1/sa[1],1/sa[2]);var ka=
ca.results.min,ra=ca.results.max,va=ca.results.ground,Ca=ca.options.store===T.StoreResults.MIN,Ba=!!ca.results.ground.target,Ha=V.getVerticalOffsetTerrain(ca.verticalOffset),Ma=ca.tolerance,Qa,Sa=Ca&&null!=ka.dist?ka.dist:Infinity,La=Va=>{var cb=Va.renderData;if(cb?.vao){var la=cb.geometry;m.set(ha,la.boundingBox);var eb=cb.localOrigin;null!=Ha&&(Ha.localOrigin=eb,Ha.applyToAabb(ha));ma[0]=qa[0]-eb[0];ma[1]=qa[1]-eb[1];ma[2]=qa[2]-eb[2];if(Y.intersectAabbInvDirBefore(ha,ma,pa,Ma,Sa)){var ib=(Fa,xa,
ya)=>{Fa.set(this.type,Va,xa,ya,h.IDENTITY);Sa=Ca&&null!=ka.dist?ka.dist:Infinity};cb=(Fa,xa)=>{null!=xa&&0<=Fa&&(ca.options.backfacesTerrain||0>z.dot(xa,sa))&&(ca.options.invisibleTerrain||!ca.options.selectionMode||null==na||na(qa,ua,Fa))&&((null==va.dist||Fa<va.dist)&&ib(va,Fa,xa),ca.options.isFiltered||(ca.options.store===T.StoreResults.ALL&&(null==Qa?(Qa=W.newIntersectorResult(ca.ray),ib(Qa,Fa,xa),ca.results.all.push(Qa)):Fa<Qa.dist&&ib(Qa,Fa,xa)),(null==ka.dist||Fa<ka.dist)&&ib(ka,Fa,xa),ca.options.store!==
T.StoreResults.MIN&&(null==ra.dist||Fa>ra.dist)&&ib(ra,Fa,xa)))};var Pa=fa;z.subtract(Pa,ua,eb);eb=la.indices;var za=la.vertexAttributes,Ga=za.getField(U.VertexAttribute.POSITION,t.BufferViewVec3f);za=new J.Attribute(Ga.typedBuffer,3,!1,za.stride/4);la=la.indexCount/3;!Ha&&la>G.componentMinimalSizeForIntersectionData?(Ga=Va.renderData,null==Ga.intersectionData&&(Ga.intersectionData=new G.ComponentIntersectionData(eb,0,la,za)),Ga.intersectionData.intersectRay({r0:ma,r1:Pa},cb)):Y.intersectTriangles(ma,
Pa,0,la,eb,za,null,Ha,cb)}}},Ua=this._rootTiles;null!=Ua&&(()=>{const Va=this._tileIterator;Va.reset(Ua);const cb=ca.options.invisibleTerrain;for(let la=Va.next();la;la=Va.next())!(la.visible||cb&&la.intersectsClippingArea)||null==Ha&&!la.intersectsRay(qa,sa,Ma,Sa)||Ba&&this._useStencilForTile(la)?Va.skipSubtree():La(la)})()}};da.processScaleRangeQueries=function(ca,na){if(!na.done)for(this._updatePatchGroups();ca.updating&&!na.done;){ca.prepare();for(const qa of this._patchGroups.values())for(const ua of qa)null!=
ua.renderData?.textureReference&&ca.queriesForTile(ua);ca.process();na.madeProgress()}};da.prepareTechnique=function(ca){if(ca.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN){if(0===(ca.renderOccludedMask&A.overlayRenderOccludedFlag))return null}else if(ca.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?Q.RenderSlot.OPAQUE_TERRAIN:Q.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(ca.output){case L.ShaderOutput.Color:if(this.transparency===a.TransparencyMode.Empty)break;
this._techniqueConfiguration.hasScreenSpaceReflections=ca.bindParameters.ssr.enabled;this._techniqueConfiguration.hasCloudsReflections=null!=ca.bindParameters.cloudsFade.data;this._techniqueConfiguration.receiveShadows=ca.bindParameters.shadowMap.ready;this._techniqueConfiguration.receiveAmbientOcclusion=ca.bindParameters.ssaoHelper.active;this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?O.OverlayMode.Disabled:this._overlayRenderer.hasWater?O.OverlayMode.EnabledWithWater:O.OverlayMode.Enabled;
return this._updateTechnique(L.ShaderOutput.Color,ca.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN);case L.ShaderOutput.Shadow:case L.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows&&1===ca.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Shadow,!1);break;case L.ShaderOutput.Depth:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1;return this._updateTechnique(L.ShaderOutput.Depth,!1);case L.ShaderOutput.Normal:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1;return this._updateTechnique(L.ShaderOutput.Normal,!1);case L.ShaderOutput.ObjectAndLayerIdColor:return this.transparency===a.TransparencyMode.Empty?null:this._updateTechnique(L.ShaderOutput.ObjectAndLayerIdColor,
!1);case L.ShaderOutput.Highlight:if(this.transparency!==a.TransparencyMode.Empty&&this.needsHighlight)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Highlight,!1)}return null};da.render=function(ca,na){const qa=1===ca.bindParameters.lighting.globalFactor;this._updatePatchGroups();na.useStencil=!1;switch(ca.output){case L.ShaderOutput.Color:const ua=ca.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN?
D.OverlaySource.Occluded:D.OverlaySource.ColorAndWater;this.transparency===a.TransparencyMode.Opaque?this._renderMaterialPass(ca,na,ua):ca.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(ca,na,ua),ca.offscreenRenderingHelper.tmpColor,ca.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break;case L.ShaderOutput.Depth:case L.ShaderOutput.Normal:this._renderAuxiliaryPass(ca,na,D.OverlaySource.ColorAndWater);break;case L.ShaderOutput.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(ca,
na,D.OverlaySource.Highlight);break;case L.ShaderOutput.Shadow:case L.ShaderOutput.ShadowExcludeHighlight:this._castShadows&&qa&&this._renderAuxiliaryPass(ca,na,D.OverlaySource.None);break;case L.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(ca,na,D.OverlaySource.ObjectAndLayerIdColor)}};da._renderMaterialPass=function(ca,na,qa){const {rctx:ua}=ca;this._passParameters.overlaySource=qa;ua.bindTechnique(na,this._passParameters,ca.bindParameters);this._numOriginsRendered=this._numTilesCulled=
this._numTilesRendered=0;this._renderPatchGroups(ca,na,qa)};da._renderAuxiliaryPass=function(ca,na,qa){const ua=ca.rctx;this._passParameters.overlaySource=qa;ua.bindTechnique(na,this._passParameters,ca.bindParameters);this._renderPatchGroupsAuxiliary(ca,na,qa)};da.updateTileBackground=function(ca=null){if(null!=this._tileRenderer){var na=this._tileRenderer,qa=null;null!=ca&&(ca=y.toUnitRGBA(ca),qa=n.fromValues(ca[0]||0,ca[1]||0,ca[2]||0));na.setBackground(qa);this._allTiles.forAll(ua=>na.updateTileTexture(ua,
r.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=na.backgroundIsGrid?H.TileBlendInput.GridComposite:null!=na.backgroundColor?H.TileBlendInput.ColorComposite:H.TileBlendInput.LayerOnly;this.setNeedsRender()}};da._updatePatchGroups=function(){this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==C.RenderOrder.NONE){const ca=Array.from(this._patchGroups.values()),
na=this._stencilEnabledLayerExtents;for(const qa of ca)K.sortTiles(this.renderOrder,qa,na);ca.sort((qa,ua)=>K.compareTiles(qa[0],ua[0],this.renderOrder));this._patchGroups=new Map(ca.map(qa=>[qa[0].renderData.localOrigin,qa]));this._patchSortingDirty=!1}};da._rebuildPatchGroups=function(){const ca=this._rootTiles;if(null!=ca){ca[0]?.surface.checkAllTilesWaterproofness();this._patchGroups.clear();for(const na of ca)this._rebuildPatchGroupsForRootTile(na)}};da._rebuildPatchGroupsForRootTile=function(ca){const na=
this._tileIterator;for(na.resetOne(ca);!na.done;){ca=na.next();var qa=ca.renderData;if(!qa){this._numTilesCulled++;continue}if(!ca.visible){this._numTilesCulled++;na.skipSubtree();continue}qa=qa.localOrigin;let ua=this._patchGroups.get(qa);ua||(ua=[],this._patchGroups.set(qa,ua));ua.push(ca);if(!this._highestVisibleLODTile||ca.elevationLevel>this._highestVisibleLODTile.elevationLevel)this._highestVisibleLODTile=ca;na.skipSubtree()}};da._useStencilForTile=function(ca){for(const na of this._stencilEnabledLayerExtents)if(ca.intersectsExtent(na))return!0;
return!1};da._renderPatchGroupsAuxiliary=function(ca,na,qa){const ua=0<this._stencilEnabledLayerExtents.length;this._patchGroups.forEach(sa=>{na.program.bindDraw(new X.DrawParameters(sa[0].renderData.localOrigin),ca.bindParameters,this._passParameters);for(let pa=0;pa<sa.length;pa++)this._renderPatch(ca,na,sa[pa],ja.PrimitiveType.TRIANGLES,ua,qa)});ca.rctx.bindVAO(null)};da._renderPatchGroups=function(ca,na,qa){var ua=ca.bindParameters.camera;const sa=na.program;this._techniqueConfiguration.screenSizePerspective&&
this.pointsOfInterest&&S.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ua.fovY});ua=0<this._stencilEnabledLayerExtents.length;const pa=qa===D.OverlaySource.Occluded;pa&&(sa.bindTexture("tex",this._emptyTex),sa.setUniform3fv("textureOpacities",n.ZEROS),sa.setUniform4fv("texOffsetAndScale",l.ZEROS));var ka=null!=this._tileRenderer&&null!=this._tileRenderer.backgroundColor?this._tileRenderer.backgroundColor:n.ZEROS;
this._techniqueConfiguration.tileBlendInput===H.TileBlendInput.ColorComposite&&sa.setUniform3fv("backgroundColor",ka);ka=this.wireframe?ja.PrimitiveType.LINES:ja.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&sa.bindTexture("texNext",this._emptyTex);var ra=this._patchGroups;for(const va of ra.values()){na.program.bindDraw(new X.DrawParameters(va[0].renderData.localOrigin),ca.bindParameters,this._passParameters);this._numOriginsRendered++;for(const Ca of va){ra=Ca.renderData;
const Ba=ra.textureReference;if(null!=Ba){if(!pa){sa.setUniform4fv("texOffsetAndScale",Ba.offsetAndScale);sa.bindTexture("tex",Ba.texture.texture);const Ha=ra.textureFadeFactor,Ma=1>Ha?ra.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&null!=Ma&&1>Ha?(sa.setUniform1f("fadeFactor",Ha),sa.setUniform4fv("nextTexOffsetAndScale",Ma.offsetAndScale),sa.setUniform3fv("nextTexOpacities",Ma.opacities),sa.bindTexture("texNext",Ma.texture.texture)):sa.setUniform1f("fadeFactor",1);
ra.textureIsFading&&this.setNeedsRender();sa.setUniform3fv("textureOpacities",Ba.opacities)}this._renderPatch(ca,na,Ca,ka,ua,qa);Ca.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}ca.rctx.bindVAO(null)};da._renderPatch=function(ca,na,qa,ua,sa,pa){const ka=qa.renderData,ra=ka.vao,va=ra.indexBuffer;if(null==va)E.ENABLE_TERRAIN_INTERNAL_CHECKS&&console.error("Rendered tile with no indices: ",qa.lij," : ",ka);else{var Ca=na.program;pa===D.OverlaySource.None||this._overlayRenderer.isEmpty||
this._bindOverlayPatchData(Ca,ka.overlay);sa&&(na.useStencil=this._useStencilForTile(qa),na.bindPipelineState(ca.rctx,ca.bindParameters.slot));na=ka.geometry.indexCount;ca.rctx.bindVAO(ra);Ca.assertCompatibleVertexAttributeLocations(ra);ca.rctx.drawElements(ua,na,va.indexType,0)}};da._bindOverlayPatchData=function(ca,na){ca.setUniform4fv("overlayTexOffset",na.offsets);ca.setUniform4fv("overlayTexScale",na.scales)};da._updateTechnique=function(ca,na){this._techniqueConfiguration.output=ca;this._techniqueConfiguration.renderOccluded=
na;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(Z.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};b._createClass(aa,[{key:"_isGlobal",get:function(){return this._stage.viewingMode===w.ViewingMode.Global}},{key:"canRender",get:function(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(ca){this._set("renderingDisabled",!!ca);this.setDirty()}},{key:"transparency",get:function(){return this._transparencyState},
set:function(ca){this._transparencyState!==ca&&(this._techniqueConfiguration.invisible=ca===a.TransparencyMode.TransparentWithDraped||ca===a.TransparencyMode.Empty,this._transparencyState=ca,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this._overlayRenderer.hasWater}},{key:"renderPatchBorders",get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(ca){this._techniqueConfiguration.tileBorders!==ca&&(this._techniqueConfiguration.tileBorders=ca,this.setNeedsRender(),
this.notifyChange("renderPatchBorders"))}},{key:"visualizeNormals",get:function(){return!!this._techniqueConfiguration.visualizeNormals},set:function(ca){this._techniqueConfiguration.visualizeNormals!==ca&&(this._techniqueConfiguration.visualizeNormals=ca,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}},{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(ca){this._techniqueConfiguration.backfaceCullingEnabled!==ca&&(this._techniqueConfiguration.backfaceCullingEnabled=
ca,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(ca){this._set("renderOrder",ca);this._setSortingDirty()}},{key:"layerUid",get:function(){return V.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(ca){this._techniqueConfiguration.hasSlicePlane!==ca&&(this._techniqueConfiguration.hasSlicePlane=ca,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(ca){this._techniqueConfiguration.textureFadingEnabled!==
ca&&(this._techniqueConfiguration.textureFadingEnabled=ca,this.setNeedsRender())}},{key:"pbrMode",set:function(ca){this._techniqueConfiguration.pbrMode!==ca&&(this._techniqueConfiguration.pbrMode=ca,this.setNeedsRender())}},{key:"wireframe",set:function(ca){this._get("wireframe")!==ca&&(this._set("wireframe",ca),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this._tileRenderer}}}]);return aa}(p);c.__decorate([k.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_overlayRenderer",
void 0);c.__decorate([k.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_stage",void 0);c.__decorate([k.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);c.__decorate([k.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_allTiles",void 0);c.__decorate([k.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_ellipsoidRadius",void 0);c.__decorate([k.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);c.__decorate([k.property()],
a.TerrainRenderer.prototype,"renderPatchBorders",null);c.__decorate([k.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);c.__decorate([k.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);c.__decorate([k.property({value:C.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);c.__decorate([k.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=c.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);
const ia=n.create(),oa=n.create(),ma=n.create(),fa=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./ITile ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){function B(R,W){H.layerIndex=W;H.vtlNeighborInfos.clear();const T=R.layerInfo[g.LayerClass.MAP][W];if(T.data)return y.set(H.offset,0,0),H.tile=R,H.scale=1,H.sourceLod=R.lij,H.sourceLayerInfo=T,e.isVectorTileRenderInfo(H)&&R.forEachLoadedNeighbor((Q,S)=>{if(Q.level===R.level){var U=Q.layerInfo[g.LayerClass.MAP][W];if(e.isVectorTilePerLayerInfo(U)&&T.data!==U.data){var V=H.vtlNeighborInfos.pushNew();V.offset=N[S];V.sourceLod=Q.lij;V.sourceLayerInfo=
U}}}),H;const P=T.upsampleInfo;if(P){const Q=P.tile.layerInfo[g.LayerClass.MAP][W];H.tile=P.tile;y.copy(H.offset,P.offset);H.scale=P.scale;H.sourceLod=P.tile.lij;H.sourceLayerInfo=Q;return H}return null}function C(R){let W="normal"!==R.blendMode;u.isGroupLayer(R.parent)&&(W=C(R.parent)||W);return W}function E(R,W){u.isGroupLayer(R.parent)&&E(R.parent,W);const T=R.get("uid");if(null!=T&&""!==T){const P=O.get(T);P?P.start=W:O.set(T,new F(W,W,R.blendMode,R.opacity))}}let F=b._createClass(function(R,
W,T,P){this.start=R;this.end=W;this.blendMode=T;this.opacity=P}),M=function(){function R(T,P,Q){this._rctx=T;this.tileSize=P;this._techniqueRepository=Q;this._passParameters=new k.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=null;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new n.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new m(x.createColorTexture(this._rctx,[0,0,0,1]));
this._ensureBackgroundTexture(this.tileSize)}var W=R.prototype;W.dispose=function(){this._composition=c.disposeMaybe(this._composition);this._backgroundTexture=c.releaseMaybe(this._backgroundTexture);this._blackTex=c.releaseMaybe(this._blackTex)};W.updateTileTexture=function(T,P){if(T.renderData){var Q=T.surface,S=Q.baseOpacity,U=0,V=0,X=this.tileSize,Y=!1,Z=Q.view.state.contentPixelRatio,ea=!1;O.clear();I.length=0;for(var ja=T.layerInfo[g.LayerClass.MAP],ha=ja.length,ia=0,oa=null;ia<ja.length;ia++){const ba=
Q.layerViewByIndex(ia,g.LayerClass.MAP);var ma=ba.layer.opacity;K[ia]=ma;const aa=ba.fullOpacity;G[ia]=aa;u.isBaseLayer(ba.layer)&&ha>=ja.length&&(ha=ia);if(e.isBlendableLayerView(ba)){L[ia]=ba.layer.blendMode;var fa="normal"!==ba.layer.blendMode;if(u.isGroupLayer(ba.layer.parent)){const da=ba.layer.parent.get("uid");null!=da&&""!==da&&(fa=C(ba.layer.parent)||fa)}fa&&(ea=fa,Y=!1)}if(0!==ma||ea){if(++V,ma=B(T,ia))ja[ia].pendingUpdates&=~(t.TileUpdate.TEXTURE_NOFADING&t.TileUpdate.TEXTURE_FADING),u.isGroupLayer(ba.layer.parent)&&
(fa=ba.layer.parent.get("uid"),null!=fa&&""!==fa&&E(ba.layer.parent,ia)),e.isVectorTileLayerView(ba)?X=Math.max(X,this.tileSize*Z):1===S&&1===aa&&(ba.isOpaque||this._dataToTexture(ma)&&ma.sourceLayerInfo.data.descriptor.isOpaque)&&(Y=!0),++U,null===oa&&(oa=ia)}else ja[ia].pendingUpdates&=~(t.TileUpdate.TEXTURE_NOFADING&t.TileUpdate.TEXTURE_FADING)}Q=X/this.tileSize;this._ensureBackgroundTexture(this.tileSize);0===U||null===oa?this._useBackgroundTexture(T,V):(1!==U||ea||!this._useLayerTexture(T,oa,
ha,G[oa]))&&this._composeMapLayers(T,P,ia-1,ha,K,L,X,Q,!Y||ea,O,ea)}};W._ensureBackgroundTexture=function(T){null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(T),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bind(T),this._passParameters.offset=p.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,null!=this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,
null!=this.backgroundColor),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)};W._useBackgroundTexture=function(T,P){let Q=h.ActivationTime.Immediate;if(T.surface.view.layerViewManager.updating||0<P)Q=h.ActivationTime.Delayed;P=T.renderData;this._backgroundTexture&&null==P.textureReference&&(Q=h.ActivationTime.Immediate);P.setTextureReference(null!=this._backgroundTexture?new z.TextureReference(this._backgroundTexture,d.TextureUpdate.FADING,
J,T.surface.baseOpacity,0,1):null,Q)};W._useLayerTexture=function(T,P,Q,S){var U=P<Q;Q=U?1:T.surface.baseOpacity;U=U?T.surface.baseOpacity:1;P=B(T,P);return this._dataToTexture(P)?(T.renderData.setTextureReference(new z.TextureReference(P.sourceLayerInfo.data,d.TextureUpdate.FADING,P,Q,U,S)),!0):!1};W._composeMapLayers=function(T,P,Q,S,U,V,X,Y,Z,ea,ja){this._composition.ensureBuffer(X);const ha=T.surface.baseOpacity;let ia=!1,oa=D.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ma=!1,fa=0;for(let da=Q;0<=
da;da--){var ba=B(T,da);if(!ba)continue;if(0===U[da]&&!ja)continue;var aa=da<S&&1>ha&&!ia;this._passParameters.baseOpacity=aa?ha:1;Q=1>this._passParameters.baseOpacity?r.BaseOpacityMode.Required:r.BaseOpacityMode.NotRequired;aa&&(ia=!0);let ca=!1;ea.forEach(ua=>{ua.start===da&&(I.push(ua),this._composition.openGroup(X),ca=!0)});aa=0===fa;const na=ca?r.BlendLayersOutput.GroupBackgroundComposite:Z&&aa?this.backgroundIsGrid?r.BlendLayersOutput.GridComposite:r.BlendLayersOutput.ColorComposite:r.BlendLayersOutput.Composite,
qa=w.blendModeFromString[V[da]];e.isVectorTileRenderInfo(ba)?(this._passParameters.opacity=U[da],ma=this._composition.drawVectorData(this._passParameters,na,X,qa,Q,ba,Y,this.tileSize,ma)):e.isImageryTileRenderInfo(ba)?(this._passParameters.opacity=U[da],this._composition.drawImageryTileData(this._passParameters,na,X,qa,Q,ba),this._hasNearestInterpolation(ba)&&(oa=D.TextureSamplingMode.NEAREST)):this._dataToTexture(ba)&&(this._passParameters.texture=ba.sourceLayerInfo.data.texture,this._passParameters.offset=
ba.offset,this._passParameters.scale=ba.scale,this._passParameters.opacity=U[da],this._composition.drawRasterData(this._passParameters,na,X,qa,Q));for(;0<I.length&&I[I.length-1].end===da;)ba=I.pop(),this._passParameters.opacity=ba.opacity,this._passParameters.offset=p.ZEROS,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,Z&&aa?this.backgroundIsGrid?r.BlendLayersOutput.GridComposite:r.BlendLayersOutput.ColorComposite:r.BlendLayersOutput.Composite,X,w.blendModeFromString[ba.blendMode],
Q);fa++}T=T.renderData;S=T.ensureTexture(X,()=>this._buildTexture(X,oa));this._composition.copyFBOToTexture(S);this._composition.unbind();T.setTextureReference(new z.TextureReference(S,P,J,ia?1:ha,0,1))};W._hasNearestInterpolation=function(T){T=T.sourceLayerInfo.data;return T.source?"nearest"===T.interpolation:!1};W._dataToTexture=function(T){if(e.isRasterTileRenderInfo(T)){const P=T.sourceLayerInfo;P.data=this._buildTexture(P.data);T.tile.setMemoryDirty()}return e.isTextureTileRenderInfo(T)};W.setBackground=
function(T){this._backgroundColor!==T&&(this._backgroundColor=T,this._backgroundDirty=!0)};W._buildTexture=function(T,P=D.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==T)return null;const Q=new v.TextureDescriptor;Q.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE;Q.samplingMode=P;Q.maxAnisotropy=this._maxAnisotropy;Q.preMultiplyAlpha=!0;Q.flipped=!0;Q.hasMipmap=!0;P=this._rctx;let S;if("number"===typeof T)Q.width=Q.height=T,S=new m(new A.Texture(P,Q));else if(T instanceof q.ImageWithType)Q.isOpaque=
T.isOpaque,S=new m(new A.Texture(P,Q,T.image)),T.release();else try{Q.width=T.width,Q.height=T.height,S=new m(new A.Texture(P,Q,T))}catch(U){S=new m(x.createEmptyTexture(P)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}T=P.bindTexture(S.texture,A.Texture.TEXTURE_UNIT_FOR_UPDATES);S.generateMipmap();P.bindTexture(T,A.Texture.TEXTURE_UNIT_FOR_UPDATES);return S};b._createClass(R,[{key:"backgroundIsGrid",get:function(){return null==this._backgroundColor}},
{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return R}();const K=[],G=[],L=[],O=new Map,I=[],H=new l.TileRenderInfo,J={offset:[0,0],scale:1},N=[];N[f.NeighborIndex.NORTH]=[0,-1];N[f.NeighborIndex.NORTH_EAST]=[-1,-1];N[f.NeighborIndex.EAST]=[-1,0];N[f.NeighborIndex.SOUTH_EAST]=[-1,1];N[f.NeighborIndex.SOUTH]=[0,1];N[f.NeighborIndex.SOUTH_WEST]=[1,1];N[f.NeighborIndex.WEST]=[1,0];N[f.NeighborIndex.NORTH_WEST]=
[1,-1];a.GroupInfo=F;a.TileRenderer=M;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){q=function(l){function m(){var t=l.apply(this,arguments)||this;t.opacity=1;t.baseOpacity=1;t.texture=null;t.fboTexture=null;t.backgroundColor=p.ZEROS;return t}c._inherits(m,l);return c._createClass(m)}(q.TileCompositePassParameters);f=function(l){function m(){return l.apply(this,arguments)||this}c._inherits(m,l);var t=m.prototype;t.initializeProgram=function(w){return new h.Program(w.rctx,m.shader.get().build(this.configuration),e.Default3D)};t.initializePipeline=
function(){return n.makePipelineState({blending:n.simpleBlendingParams(z.BlendFactor.ONE,z.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:n.defaultColorWriteParams})};return c._createClass(m)}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(k.BlendLayers,()=>new Promise((l,m)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],l,m)));u=function(l){function m(){var t=l.apply(this,arguments)||this;t.background=k.BackgroundMode.BelowLayer;return t}c._inherits(m,l);return c._createClass(m)}(u.TileBlendTechniqueConfiguration);
y.__decorate([g.parameter()],u.prototype,"background",void 0);b.BlendLayersPassParameters=q;b.BlendLayersTechnique=f;b.BlendLayersTechniqueConfiguration=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u){y=function(q){function k(){var d=q.apply(this,arguments)||this;d.output=p.BlendLayersOutput.Composite;d.baseOpacityMode=p.BaseOpacityMode.NotRequired;d.premultipliedSource=p.PremultipliedAlphaSource.Off;return d}b._inherits(k,q);return b._createClass(k)}(y.BlendModeTechniqueConfiguration);c.__decorate([u.parameter({count:p.BlendLayersOutput.COUNT})],y.prototype,"output",void 0);c.__decorate([u.parameter({count:p.BaseOpacityMode.COUNT})],y.prototype,"baseOpacityMode",void 0);
c.__decorate([u.parameter()],y.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y,p){let u=function(q){function k(){var d=
q.apply(this,arguments)||this;d.blendMode=y.LayerBlendMode.Normal;return d}b._inherits(k,q);return b._createClass(k)}(p.ShaderTechniqueConfiguration);c.__decorate([p.parameter({count:y.LayerBlendMode.COUNT})],u.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(e){const h=new k.ShaderBuilder;h.include(y.TileComposite);if(e.background===a.BackgroundMode.Only)return(e=e.output===c.BlendLayersOutput.ColorComposite)?h.fragment.uniforms.add(new p.Float3PassUniform("backgroundColor",z=>z.backgroundColor)):h.fragment.include(b.BackgroundGrid),h.fragment.code.add(q.glsl`
    void main() {
      fragColor = vec4(${e?q.glsl`backgroundColor`:q.glsl`gridColor(uv)`}, 1.0);
    }
  `),h;h.include(c.TileBackground,e);h.fragment.uniforms.add(new d.Texture2DPassUniform("tex",z=>z.texture));h.fragment.uniforms.add(new u.FloatPassUniform("opacity",z=>z.opacity));h.fragment.code.add(q.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return h}a.BackgroundMode=void 0;(function(e){e[e.BelowLayer=0]="BelowLayer";e[e.Only=1]="Only";e[e.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const g=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:f},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=g;a.build=f})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3f64","../../../chunks/vec4f64"],
function(a,b,c,y){let p=function(){function u(q,k,d,f,g,e){this.texture=q;this.type=k;q.retain();this.offsetAndScale=y.fromValues(d.offset[0],d.offset[1],d.scale,d.scale);this.opacities=c.fromValues(f,g,e)}u.prototype.destroy=function(){this.texture.release()};return b._createClass(u)}();a.TextureReference=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){const x=c.getLogger("esri.views.3d.terrain");c=function(){function D(v,B){this._rctx=v;this._techniqueRepository=B;this._fbos=[];this._vectorTileHelper=new q.VectorTileRendererHelper3D;this._bindParameters=new n.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new k.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=m.createQuadVAO(this._rctx,l.Pos2Tex)}
var A=D.prototype;A.dispose=function(){this._fbos.forEach(y.disposeMaybe);this._fbos=null;this._vtFBO=y.disposeMaybe(this._vtFBO);this._vaoQuad=y.disposeMaybe(this._vaoQuad);this._vectorTileHelper=y.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=y.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=y.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=y.releaseMaybe(this._blendLayersTechnique)};A._getBlendLayersTechnique=function(v,B,C,E=h.PremultipliedAlphaSource.Off,
F=z.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=B;this._blendLayersTechniqueConfig.blendMode=v;this._blendLayersTechniqueConfig.baseOpacityMode=C;this._blendLayersTechniqueConfig.premultipliedSource=E;this._blendLayersTechniqueConfig.background=F;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(k.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};A.drawBackground=function(v,B){B=this._getBlendLayersTechnique(e.LayerBlendMode.Normal,
B?h.BlendLayersOutput.ColorComposite:h.BlendLayersOutput.GridComposite,h.BaseOpacityMode.NotRequired,h.PremultipliedAlphaSource.Off,z.BackgroundMode.Only);v=this._rctx.bindTechnique(B,v,this._bindParameters);this._render(v)};A._render=function(v){this._rctx.bindVAO(this._vaoQuad);v.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,r.vertexCount(this._vaoQuad,"geometry"))};A.drawGroup=function(v,B,C,E,F,M=h.PremultipliedAlphaSource.On){B===
h.BlendLayersOutput.Composite&&(v.fboTexture=this._fbos[this.getLastOnHoldId()].get(C).colorTexture);v.texture=this.currentFBO(C).colorTexture;this.closeGroup(C);B=this._getBlendLayersTechnique(E,B,F,M);v=this._rctx.bindTechnique(B,v,this._bindParameters);this._render(v)};A.drawRasterData=function(v,B,C,E,F,M=h.PremultipliedAlphaSource.Off){null!=v.texture&&(v.fboTexture=B===h.BlendLayersOutput.GroupBackgroundComposite||E===e.LayerBlendMode.Normal&&F===h.BaseOpacityMode.NotRequired&&M===h.PremultipliedAlphaSource.Off?
null:this.switch(C).colorTexture,B=this._getBlendLayersTechnique(E,B,F,M),v=this._rctx.bindTechnique(B,v,this._bindParameters),this._render(v))};A.drawImageryTileData=function(v,B,C,E,F,M){var K=M.sourceLayerInfo.data;K.source&&(M.tile.surface.layerViewByIndex(M.layerIndex,d.LayerClass.MAP).ensureSymbolizerParameters(K),K.bind(this._rctx)&&(v.fboTexture=E===e.LayerBlendMode.Normal&&F===h.BaseOpacityMode.NotRequired?null:this.switch(C).colorTexture,B=this._getRasterColorizerTechnique(K,B,E,F),K.opacity=
v.opacity,K=K.getUniforms(),K.scale=M.scale,K.offset=M.offset,K.backgroundColor=v.backgroundColor,K.fboTexture=v.fboTexture,K.baseOpacity=v.baseOpacity,v=this._rctx.bindTechnique(B,K,null),this._render(v)))};A._getRasterColorizerTechnique=function(v,B,C,E){const F=v.symbolizerParameters,M=["stretch","lut","hillshade"].indexOf(F.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new f.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));
this._rasterColorizerConfig.output=B;this._rasterColorizerConfig.blendMode=C;this._rasterColorizerConfig.baseOpacityMode=E;this._rasterColorizerConfig.colorizerType=M;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.requireBilinearWithNN=v.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=v.hasStretchTypeNone()?u.RasterColorizerStretchType.Noop:u.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(f.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};A.drawVectorData=function(v,B,C,E,F,M,K,G,L){const O=this._rctx,I=M.sourceLayerInfo.data,H=M.tile.surface.layerViewByIndex(M.layerIndex,d.LayerClass.MAP),J=F===h.BaseOpacityMode.Required||1>v.opacity||E!==e.LayerBlendMode.Normal||B!==h.BlendLayersOutput.Composite,N=J?h.PremultipliedAlphaSource.On:h.PremultipliedAlphaSource.Off;this._getBlendLayersTechnique(E,B,F,N).bindPipelineState(O);let R=null,W=null;J?(W=this.currentFBO(C),null==this._vtFBO&&
(this._vtFBO=new g.MultiSizeFramebuffer(this._rctx)),R=this._vtFBO.get(C),O.bindFramebuffer(R),this._clearCurrentFBO()):L&&O.clearSafe(t.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(O,M.sourceLod,I,H.painter,H.layer.styleRepository,H.schemaHelper,Math.round(1/M.scale),M.offset,G,K,H.contentZoom),M.vtlNeighborInfos.forAll(T=>this._vectorTileHelper.renderSymbols(O,T.sourceLod,T.sourceLayerInfo.data,H.painter,H.layer.styleRepository,H.schemaHelper,1,T.offset,G,K,H.contentZoom))}catch(T){x.warnOnce("A render call containing vector tiles did not resolve correctly.",
T)}return null!=R?(O.bindFramebuffer(W),v.texture=R.colorTexture,v.offset=p.ZEROS,v.scale=1,this.drawRasterData(v,B,C,E,F,N),L):!0};A.copyFBOToTexture=function(v){const B=this._rctx,C=B.bindTexture(v.texture,w.Texture.TEXTURE_UNIT_FOR_UPDATES),E=v.descriptor;B.gl.copyTexImage2D(t.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);v.generateMipmap();B.bindTexture(C,w.Texture.TEXTURE_UNIT_FOR_UPDATES)};A._clearCurrentFBO=function(){this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);
this._rctx.clearSafe(t.ClearBufferBit.COLOR_BUFFER_BIT|t.ClearBufferBit.DEPTH_BUFFER_BIT)};A._initFBO=function(v,B,C){this._rctx.bindFramebuffer(v);C&&(this._rctx.setViewport(0,0,B,B),this._clearCurrentFBO())};A.ensureBuffer=function(v){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(v)};A.bind=function(v,B=0,C=!0){this._current=B;if(B>=this._fbos.length)for(let E=this._fbos.length;E<=B;E++)this._fbos.push(new g.MultiSizeFramebuffer(this._rctx));
this._initFBO(this._fbos[B].get(v),v,C)};A._bindNextFreeBuffer=function(v){0<this._lastUsedIds.length?this.bind(v,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(v,this._lastCreatedBufferId))};A.openGroup=function(v){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(v)};A.switch=function(v){const B=this.currentFBO(v),C=this._current;this._bindNextFreeBuffer(v);this._lastUsedIds.push(C);return B};A.getLastOnHoldId=function(){return this._onHoldIds[this._onHoldIds.length-
1]};A.closeGroup=function(v){const B=this._current;this._bindNextFreeBuffer(v);this._lastUsedIds.push(B);this._lastUsedIds.push(this._onHoldIds.pop())};A.unbind=function(){this._rctx.bindFramebuffer(null)};A.currentFBO=function(v){return this._fbos[this._current].get(v)};return b._createClass(D)}();a.TileCompositor=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../Viewpoint ../../ViewState ./style/StyleDefinition ../../../../geometry/Point".split(" "),
function(a,b,c,y,p,u,q){c=function(){function k(){this._renderParams={context:null,drawPhase:1,state:new p({viewpoint:new y({targetGeometry:new q(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,
dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}var d=k.prototype;d.dispose=function(){this._renderParams=null};d.render=function(f,g,e,h,z,n,l,m,t,w,r){this._render(f,g,e,h,z,n,l,m,t,w,r)};d.renderSymbols=function(f,g,e,h,z,n,l,m,t,w,r){this._render(f,g,e,h,z,n,l,m,t,w,r,u.StyleLayerType.SYMBOL)};d._render=function(f,g,e,h,z,n,l,m,t,w,r,x){const D=g[0]-n.getLevelShift(g[0]),A=this._renderParams;A.context=f;A.painter=h;A.glyphMosaic=h.glyphMosaic;A.spriteMosaic=
h.spriteMosaic;A.pixelRatio=w*r;A.displayLevel=D;A.requiredLevel=D;w=n.getScale(g[0]);const [v,B]=n.getOffset(g,l*w);g=.125*l*w/t;n=e.transforms.dvs;n[0]=g;n[4]=-g;n[6]=-1-v-m[0]*l*2;n[7]=1+B+(1-m[1])*l*2-2;A.state.size[0]=t/r;A.state.size[1]=t/r;A.state.pixelRatio=r;e.stage||e.attachWithContext(f);e.triangleCount=0;h.drawTile(A,e,z,x)};return b._createClass(k)}();a.VectorTileRendererHelper3D=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){var v;const B=[0,0];c=v=function(C){function E(M){M=C.call(this,M)||this;M._viewpoint2D={center:w.create(),rotation:0,scale:0,spatialReference:void 0};M.center=[0,0];M.extent=new D;M.id=0;M.inverseTransform=z.create();M.resolution=0;M.rotation=0;M.scale=0;M.transform=z.create();M.transformNoRotation=z.create();M.displayMat3=l.create();M.displayViewMat3=l.create();M.viewMat3=l.create();M.viewMat2d=h.create();M.worldScreenWidth=0;M.size=[0,0];
return M}a._inherits(E,C);var F=E.prototype;F.copy=function(M){const K=this.size,G=this.viewpoint;G&&K?(this.viewpoint=x.copy(G,M.viewpoint),this._set("size",m.copy(K,M.size))):(this.viewpoint=M.viewpoint.clone(),this._set("size",[M.size[0],M.size[1]]));this._set("pixelRatio",M.pixelRatio);return this};F.clone=function(){return new v({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(M,K,G){if(r.isVec2(K))return m.transformMat2d(M,K,this.inverseTransform);
B[0]=K;B[1]=G;return m.transformMat2d(M,B,this.inverseTransform)};F.toScreen=function(M,K,G){if(r.isVec2(K))return m.transformMat2d(M,K,this.transform);B[0]=K;B[1]=G;return m.transformMat2d(M,B,this.transform)};F.toScreenNoRotation=function(M,K,G){if(r.isVec2(K))return m.transformMat2d(M,K,this.transformNoRotation);B[0]=K;B[1]=G;return m.transformMat2d(M,B,this.transformNoRotation)};F.getScreenTransform=function(M,K){const {center:G}=this._viewpoint2D,L=this._get("pixelRatio")||1,O=this._get("size");
x.getMatrix(M,G,O,K,0,L);return M};F._update=function(){const {center:M,spatialReference:K,scale:G,rotation:L}=this._viewpoint2D,O=this._get("pixelRatio")||1,I=this._get("size"),H=new y({targetGeometry:new A(M[0],M[1],K),scale:G,rotation:L});this._set("viewpoint",H);if(I&&K&&G){this.resolution=x.getResolution(H);this.rotation=L;this.scale=G;this.spatialReference=K;m.copy(this.center,M);n.set(this.displayMat3,0!==I[0]?2/I[0]:0,0,0,0,0!==I[1]?-2/I[1]:0,0,-1,1,1);var J=n.identity(this.viewMat3),N=t.fromValues(I[0]/
2,I[1]/2),R=t.fromValues(-I[0]/2,-I[1]/2),W=g.toRadian(L);n.translate(J,J,N);n.rotate(J,J,W);n.translate(J,J,R);n.multiply(this.displayViewMat3,this.displayMat3,J);J=e.fromTranslation(this.viewMat2d,N);e.rotate(J,J,W);e.translate(J,J,R);x.getExtent(this.extent,H,I);x.getTransform(this.transform,H,I,O);e.invert(this.inverseTransform,this.transform);x.getTransformNoRotation(this.transformNoRotation,H,I,O);this.worldScreenWidth=x.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(E,[{key:"pixelRatio",set:function(M){this._set("pixelRatio",M);this._update()}},{key:"size",set:function(M){this._set("size",M);this._update()}},{key:"viewpoint",set:function(M){if(M){const K=this._viewpoint2D,G=M.targetGeometry;K.center[0]=G.x;K.center[1]=G.y;K.rotation=M.rotation;K.scale=M.scale;K.spatialReference=G.spatialReference}this._update()}}]);return E}(p.JSONSupport);b.__decorate([u.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([u.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([u.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([u.property()],c.prototype,"spatialReference",void 0);b.__decorate([u.property({type:y,json:{write:!0}})],c.prototype,"viewpoint",null);return c=v=b.__decorate([f.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(v,B){v[0]=B[0];v[1]=B[1];v[2]=B[2];v[3]=B[3];v[4]=B[4];v[5]=B[5];return v}function y(v){v[0]=
1;v[1]=0;v[2]=0;v[3]=1;v[4]=0;v[5]=0;return v}function p(v,B,C,E,F,M,K){v[0]=B;v[1]=C;v[2]=E;v[3]=F;v[4]=M;v[5]=K;return v}function u(v,B){const C=B[0],E=B[1],F=B[2],M=B[3],K=B[4];B=B[5];let G=C*M-E*F;if(!G)return null;G=1/G;v[0]=M*G;v[1]=-E*G;v[2]=-F*G;v[3]=C*G;v[4]=(F*B-M*K)*G;v[5]=(E*K-C*B)*G;return v}function q(v){return v[0]*v[3]-v[1]*v[2]}function k(v,B,C){const E=B[0],F=B[1],M=B[2],K=B[3],G=B[4];B=B[5];const L=C[0],O=C[1],I=C[2],H=C[3],J=C[4];C=C[5];v[0]=E*L+M*O;v[1]=F*L+K*O;v[2]=E*I+M*H;v[3]=
F*I+K*H;v[4]=E*J+M*C+G;v[5]=F*J+K*C+B;return v}function d(v,B,C){const E=B[0],F=B[1],M=B[2],K=B[3],G=B[4];B=B[5];const L=Math.sin(C);C=Math.cos(C);v[0]=E*C+M*L;v[1]=F*C+K*L;v[2]=E*-L+M*C;v[3]=F*-L+K*C;v[4]=G;v[5]=B;return v}function f(v,B,C){const E=B[1],F=B[2],M=B[3],K=B[4],G=B[5],L=C[0];C=C[1];v[0]=B[0]*L;v[1]=E*L;v[2]=F*C;v[3]=M*C;v[4]=K;v[5]=G;return v}function g(v,B,C){const E=B[0],F=B[1],M=B[2],K=B[3],G=B[4];B=B[5];const L=C[0];C=C[1];v[0]=E;v[1]=F;v[2]=M;v[3]=K;v[4]=E*L+M*C+G;v[5]=F*L+K*C+
B;return v}function e(v,B){const C=Math.sin(B);B=Math.cos(B);v[0]=B;v[1]=C;v[2]=-C;v[3]=B;v[4]=0;v[5]=0;return v}function h(v,B){v[0]=B[0];v[1]=0;v[2]=0;v[3]=B[1];v[4]=0;v[5]=0;return v}function z(v,B){v[0]=1;v[1]=0;v[2]=0;v[3]=1;v[4]=B[0];v[5]=B[1];return v}function n(v){return"mat2d("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+")"}function l(v){return Math.sqrt(v[0]**2+v[1]**2+v[2]**2+v[3]**2+v[4]**2+v[5]**2+1)}function m(v,B,C){v[0]=B[0]+C[0];v[1]=B[1]+C[1];v[2]=B[2]+C[2];v[3]=B[3]+
C[3];v[4]=B[4]+C[4];v[5]=B[5]+C[5];return v}function t(v,B,C){v[0]=B[0]-C[0];v[1]=B[1]-C[1];v[2]=B[2]-C[2];v[3]=B[3]-C[3];v[4]=B[4]-C[4];v[5]=B[5]-C[5];return v}function w(v,B,C){v[0]=B[0]*C;v[1]=B[1]*C;v[2]=B[2]*C;v[3]=B[3]*C;v[4]=B[4]*C;v[5]=B[5]*C;return v}function r(v,B,C,E){v[0]=B[0]+C[0]*E;v[1]=B[1]+C[1]*E;v[2]=B[2]+C[2]*E;v[3]=B[3]+C[3]*E;v[4]=B[4]+C[4]*E;v[5]=B[5]+C[5]*E;return v}function x(v,B){return v[0]===B[0]&&v[1]===B[1]&&v[2]===B[2]&&v[3]===B[3]&&v[4]===B[4]&&v[5]===B[5]}function D(v,
B){const C=v[0],E=v[1],F=v[2],M=v[3],K=v[4];v=v[5];const G=B[0],L=B[1],O=B[2],I=B[3],H=B[4];B=B[5];const J=b.getEpsilon();return Math.abs(C-G)<=J*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(E-L)<=J*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(F-O)<=J*Math.max(1,Math.abs(F),Math.abs(O))&&Math.abs(M-I)<=J*Math.max(1,Math.abs(M),Math.abs(I))&&Math.abs(K-H)<=J*Math.max(1,Math.abs(K),Math.abs(H))&&Math.abs(v-B)<=J*Math.max(1,Math.abs(v),Math.abs(B))}const A=Object.freeze(Object.defineProperty({__proto__:null,
add:m,copy:c,determinant:q,equals:D,exactEquals:x,frob:l,fromRotation:e,fromScaling:h,fromTranslation:z,identity:y,invert:u,mul:k,multiply:k,multiplyScalar:w,multiplyScalarAndAdd:r,rotate:d,scale:f,set:p,str:n,sub:t,subtract:t,translate:g},Symbol.toStringTag,{value:"Module"}));a.add=m;a.copy=c;a.determinant=q;a.equals=D;a.exactEquals=x;a.frob=l;a.fromRotation=e;a.fromScaling=h;a.fromTranslation=z;a.identity=y;a.invert=u;a.mat2d=A;a.mul=k;a.multiply=k;a.multiplyScalar=w;a.multiplyScalarAndAdd=r;a.rotate=
d;a.scale=f;a.set=p;a.str=n;a.sub=t;a.subtract=t;a.translate=g})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const d=new Float32Array(6);d[0]=1;d[3]=1;return d}function c(d){const f=new Float32Array(6);f[0]=d[0];f[1]=d[1];f[2]=d[2];f[3]=d[3];f[4]=d[4];f[5]=d[5];return f}function y(d,f,g,e,h,z){const n=new Float32Array(6);n[0]=d;n[1]=f;n[2]=g;n[3]=e;n[4]=h;n[5]=z;return n}function p(d,f){return new Float32Array(d,f,6)}function u(d,f,g,e){const h=f[e];f=f[e+1];d[e]=
g[0]*h+g[2]*f+g[4];d[e+1]=g[1]*h+g[3]*f+g[5]}function q(d,f,g,e=0,h=0,z=2){for(h=h||f.length/z;e<h;e++)u(d,f,g,e*z)}const k=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y,transform:u,transformMany:q},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.mat2df32=k;a.transform=u;a.transformMany=q})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(q){return[q[0],
q[1],q[2],q[3],q[4],q[5]]}function y(q,k,d,f,g,e){return[q,k,d,f,g,e]}function p(q,k){return new Float64Array(q,k,6)}const u=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.mat2df64=u})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(y){return y instanceof Float32Array&&2<=y.length}function c(y){return Array.isArray(y)&&
2<=y.length}a.isVec2=function(y){return b(y)||c(y)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(S,U){return U.type?k.set(S,U.x,U.y):k.copy(S,U)}function m(S,U){return Math.max(S.width/Math.max(1,U[0]),S.height/Math.max(1,U[1]))*v(S.spatialReference)}async function t(S,U,V,X){if(!S||Array.isArray(S)&&!S.length)return null;c.isCollection(S)&&(S=S.toArray());if(Array.isArray(S)&&S.length&&"object"===typeof S[0]){var Y=S.every(oa=>"attributes"in oa);var Z=S.some(oa=>!oa.geometry),ea=S;if(Y&&Z&&U&&U.allLayerViews){Y=new Map;for(var ja of S)S=ja.layer,
Z=Y.get(S)||[],ea=ja.attributes[S.objectIdField],null!=ea&&Z.push(ea),Y.set(S,Z);const oa=[];Y.forEach((ma,fa)=>{const ba=U.allLayerViews.find(aa=>aa.layer.id===fa.id);if(ba&&"queryFeatures"in ba){const aa=fa.createQuery();aa.objectIds=ma;aa.returnGeometry=!0;oa.push(ba.queryFeatures(aa))}});ja=await Promise.all(oa);S=[];for(var ha of ja)if(ha&&ha.features&&ha.features.length)for(var ia of ha.features)null!=ia.geometry&&S.push(ia.geometry);ea=S}for(const oa of ea)X=await t(oa,U,V,X);return X}if(Array.isArray(S)&&
2===S.length&&"number"===typeof S[0]&&"number"===typeof S[1])Y=new e(S);else if(S instanceof g)Y=S;else if("geometry"in S)if(S.geometry)Y=S.geometry;else if(S.layer){const oa=S.layer;(ha=U.allLayerViews.find(ma=>ma.layer.id===oa.id))&&"queryFeatures"in ha&&(ia=oa.createQuery(),ia.objectIds=[S.attributes[oa.objectIdField]],ia.returnGeometry=!0,Y=(await ha.queryFeatures(ia))?.features?.[0]?.geometry)}if(null==Y)return null;ha="point"===Y.type?new f({xmin:Y.x,ymin:Y.y,xmax:Y.x,ymax:Y.y,spatialReference:Y.spatialReference}):
Y.extent;if(!ha)return null;h.isLoaded()||h.canProjectWithoutEngine(ha.spatialReference,V)||await h.load();V=h.project(ha,V);return V?X=X?X.union(V):V:null}function w(S){if(S&&(!Array.isArray(S)||"number"!==typeof S[0])&&("object"===typeof S||Array.isArray(S)&&"object"===typeof S[0])){if("layer"in S&&S.layer&&S.layer.minScale&&S.layer.maxScale){var U=S.layer;return{min:U.minScale,max:U.maxScale}}if(Array.isArray(S)&&S.length&&S.every(V=>"layer"in V)){let V=U=0;for(const X of S)(S=X.layer)&&S.minScale&&
S.maxScale&&(U=S.minScale<U?S.minScale:U,V=S.maxScale>V?S.maxScale:V);return U&&V?{min:U,max:V}:null}}}function r(S,U){return n.equals(S.wkid?S:S.spatialReference||z.WGS84,U)?S:h.project(S,U)}function x(S,U){const V=S.targetGeometry,X=U.targetGeometry;V.x=X.x;V.y=X.y;V.spatialReference=X.spatialReference;S.scale=U.scale;S.rotation=U.rotation;return S}function D(S,U,V){return V?k.set(S,.5*(U[0]-V.right+V.left),.5*(U[1]-V.bottom+V.top)):k.scale(S,U,.5)}function A(S){var U=S.scale;S=S.targetGeometry;
S=null!=S&&n.isValid(S.spatialReference)?1/(39.37*y.getMetersPerUnitForSR(S.spatialReference)*96):1;return U*S}function v(S){return n.isValid(S)?39.37*y.getMetersPerUnitForSR(S)*96:1}function B(S){return(S=n.getInfo(S))?S.valid[1]-S.valid[0]:0}const C=180/Math.PI,E=function(){const S=d.create();return function(U,V,X){const Y=V.targetGeometry;l(S,Y);V=.5*A(V);U.xmin=S[0]-V*X[0];U.ymin=S[1]-V*X[1];U.xmax=S[0]+V*X[0];U.ymax=S[1]+V*X[1];U.spatialReference=Y.spatialReference;return U}}(),F=function(){const S=
d.create();return function(U,V,X){return k.sub(U,k.scale(U,V,.5),D(S,V,X))}}(),M=function(){const S=q.create(),U=d.create();return function(V,X,Y,Z){const ea=A(X);X=p.toRadian(X.rotation)||0;k.set(U,ea,ea);u.fromScaling(S,U);u.rotate(S,S,X);u.translate(S,S,F(U,Y,Z));u.translate(S,S,[0,Z.top-Z.bottom]);return k.set(V,S[4],S[5])}}(),K=function(){const S=d.create(),U=d.create(),V=d.create();return function(X,Y,Z,ea,ja,ha){k.negate(S,Y);k.scale(U,Z,.5*ha);k.set(V,1/ea*ha,-1/ea*ha);u.fromTranslation(X,
U);ja&&u.rotate(X,X,ja);u.scale(X,X,V);u.translate(X,X,S);return X}}(),G=function(){const S=d.create();return function(U,V,X,Y){const Z=A(V),ea=p.toRadian(V.rotation)||0;l(S,V.targetGeometry);return K(U,S,X,Z,ea,Y)}}(),L=function(){const S=d.create();return function(U,V,X,Y){const Z=A(V);l(S,V.targetGeometry);return K(U,S,X,Z,0,Y)}}(),O=function(){const S=d.create(),U=d.create(),V=[0,0,0];return function(X,Y,Z){k.subtract(S,X,Y);k.normalize(S,S);k.subtract(U,X,Z);k.normalize(U,U);k.cross(V,S,U);X=
Math.acos(k.dot(S,U)/(k.length(S)*k.length(U)))*C;0>V[2]&&(X=-X);isNaN(X)&&(X=0);return X}}(),I=function(){const S=d.create();return function(U,V,X,Y){const Z=U.targetGeometry;x(U,V);M(S,V,X,Y);Z.x+=S[0];Z.y+=S[1];return U}}(),H=function(){return function(S,U,V){x(S,U);U=S.targetGeometry;U.x=V.x;U.y=V.y;U.spatialReference=V.spatialReference;return S}}(),J=function(){const S=d.create();return function(U,V,X,Y,Z){Z||(Z="center");k.sub(S,X,Y);k.scale(S,S,.5);X=S[0];Y=S[1];switch(Z){case "center":k.set(S,
0,0);break;case "left":k.set(S,-X,0);break;case "top":k.set(S,0,Y);break;case "right":k.set(S,X,0);break;case "bottom":k.set(S,0,-Y);break;case "top-left":k.set(S,-X,Y);break;case "bottom-left":k.set(S,-X,-Y);break;case "top-right":k.set(S,X,Y);break;case "bottom-right":k.set(S,X,-Y)}Q(U,V,S);return U}}(),N=function(){const S=d.create();return function(U,V,X,Y,Z){x(U,V);isNaN(X)||0===X||(T(S,Y,V,Z),U.scale=V.scale*X,P(S,S,U,Z),Q(U,U,k.set(S,S[0]-Y[0],Y[1]-S[1])));return U}}(),R=function(){const S=
d.create();return function(U,V,X,Y,Z,ea){x(U,V);isNaN(X)||0===X||(T(S,Z,V,ea),U.scale=V.scale*X,U.rotation+=Y,P(S,S,U,ea),Q(U,U,k.set(S,S[0]-Z[0],Z[1]-S[1])));return U}}(),W=function(){const S=d.create(),U=d.create();return function(V,X,Y,Z,ea,ja,ha){F(U,ja,ha);k.add(S,ea,U);return Z?R(V,X,Y,Z,S,ja):N(V,X,Y,S,ja)}}(),T=function(){const S=q.create();return function(U,V,X,Y){var Z=k.transformMat2d;G(S,X,Y,1);X=u.invert(S,S);return Z.call(k,U,V,X)}}(),P=function(){const S=q.create();return function(U,
V,X,Y){return k.transformMat2d(U,V,G(S,X,Y,1))}}(),Q=function(){const S=d.create(),U=q.create();return function(V,X,Y){x(V,X);const Z=A(X),ea=V.targetGeometry;u.fromRotation(U,p.toRadian(X.rotation)||0);u.scale(U,U,d.fromValues(Z,Z));k.transformMat2d(S,Y,U);ea.x+=S[0];ea.y+=S[1];return V}}();a.addPadding=I;a.angleBetween=O;a.centerAt=H;a.copy=x;a.create=async function(S,U){if(!S||!U)return new b({targetGeometry:new e,scale:0,rotation:0});let V=U.spatialReference;const {constraints:X,padding:Y,viewpoint:Z,
size:ea}=U,ja=[Y?ea[0]-Y.left-Y.right:ea[0],Y?ea[1]-Y.top-Y.bottom:ea[1]];let ha=null;S instanceof b?ha=S:S.viewpoint?ha=S.viewpoint:S.target&&"esri.Viewpoint"===S.target.declaredClass&&(ha=S.target);let ia=null;if(ha&&ha.targetGeometry)ia=ha.targetGeometry;else if(S instanceof f)ia=S;else if(S||S&&("center"in S||"extent"in S||"target"in S))ia=await t(S.center,U,V)||await t(S.extent,U,V)||await t(S.target,U,V)||await t(S,U,V);!ia&&Z&&Z.targetGeometry?ia=Z.targetGeometry:!ia&&U.extent&&(ia=U.extent);
if(!V){var oa=U.spatialReference||U.extent||ia;V=oa.wkid?oa:oa.spatialReference||z.WGS84}h.isLoaded()||n.equals(ia.spatialReference,V)||h.canProjectWithoutEngine(ia,V)||await h.load();oa=r(ia.center??ia,V);var ma=0;ha&&null!=ha.targetGeometry&&"point"===ha.targetGeometry.type?ma=ha.scale:"scale"in S&&S.scale?ma=S.scale:"zoom"in S&&-1!==S.zoom&&X&&X.effectiveLODs?ma=X.zoomToScale(S.zoom):Array.isArray(ia)||"point"===ia.type||"extent"===ia.type&&0===ia.width&&0===ia.height?(ma=r(U.extent,V),ma=null!=
ma?m(ma,ja):U.extent?m(U.extent,ja):Z.scale):ma=m(r(ia.extent,V),ja);if(U=w(S))U.min&&U.min>ma?ma=U.min:U.max&&U.max<ma&&(ma=U.max);U=0;ha?U=ha.rotation:S.hasOwnProperty("rotation")?U=S.rotation:Z&&(U=Z.rotation);S=new b({targetGeometry:oa,scale:ma,rotation:U});X&&(S=X.fit(S),X.constrainByGeometry(S),X.rotationEnabled||(S.rotation=U));return S};a.extentToScale=m;a.getAnchor=D;a.getExtent=E;a.getMatrix=K;a.getPaddingMapTranslation=M;a.getPaddingScreenTranslation=F;a.getResolution=A;a.getResolutionToScaleFactor=
v;a.getTransform=G;a.getTransformNoRotation=L;a.getWorldScreenWidth=function(S,U){return Math.round(B(S)/U)};a.getWorldWidth=B;a.padAndScaleAndRotateBy=W;a.resize=J;a.rotateBy=function(S,U,V){x(S,U);S.rotation+=V;return S};a.rotateTo=function(S,U,V){x(S,U);S.rotation=V;return S};a.scaleAndRotateBy=R;a.scaleTo=function(S,U,V){x(S,U);S.scale=V;return S};a.setExtent=function(S,U,V,X,Y){H(S,U,V.center);S.scale=m(V,X);Y?.constraints?.constrain(S);return S};a.toMap=T;a.toScreen=P;a.translateBy=Q;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../symbols/cim/enums"],function(a,b,c){a.StyleLayerType=void 0;(function(y){y[y.BACKGROUND=0]="BACKGROUND";y[y.FILL=1]="FILL";y[y.LINE=2]="LINE";y[y.SYMBOL=3]="SYMBOL";y[y.CIRCLE=4]="CIRCLE"})(a.StyleLayerType||(a.StyleLayerType={}));a.Visibility=void 0;(function(y){y[y.VISIBLE=0]="VISIBLE";y[y.NONE=1]="NONE"})(a.Visibility||
(a.Visibility={}));a.SymbolPlacement=void 0;(function(y){y[y.POINT=0]="POINT";y[y.LINE=1]="LINE";y[y.LINE_CENTER=2]="LINE_CENTER"})(a.SymbolPlacement||(a.SymbolPlacement={}));a.RotationAlignment=void 0;(function(y){y[y.MAP=0]="MAP";y[y.VIEWPORT=1]="VIEWPORT";y[y.AUTO=2]="AUTO"})(a.RotationAlignment||(a.RotationAlignment={}));a.TextJustification=void 0;(function(y){y[y.AUTO=0]="AUTO";y[y.LEFT=1]="LEFT";y[y.CENTER=2]="CENTER";y[y.RIGHT=3]="RIGHT"})(a.TextJustification||(a.TextJustification={}));a.SymbolAnchor=
void 0;(function(y){y[y.CENTER=0]="CENTER";y[y.LEFT=1]="LEFT";y[y.RIGHT=2]="RIGHT";y[y.TOP=3]="TOP";y[y.BOTTOM=4]="BOTTOM";y[y.TOP_LEFT=5]="TOP_LEFT";y[y.TOP_RIGHT=6]="TOP_RIGHT";y[y.BOTTOM_LEFT=7]="BOTTOM_LEFT";y[y.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(a.SymbolAnchor||(a.SymbolAnchor={}));a.TextTransform=void 0;(function(y){y[y.NONE=0]="NONE";y[y.UPPERCASE=1]="UPPERCASE";y[y.LOWERCASE=2]="LOWERCASE"})(a.TextTransform||(a.TextTransform={}));a.TranslateAnchor=void 0;(function(y){y[y.MAP=0]="MAP";y[y.VIEWPORT=
1]="VIEWPORT"})(a.TranslateAnchor||(a.TranslateAnchor={}));a.TextWritingMode=void 0;(function(y){y[y.HORIZONTAL=0]="HORIZONTAL";y[y.VERTICAL=1]="VERTICAL"})(a.TextWritingMode||(a.TextWritingMode={}));b=b._createClass(function(){});b.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};b.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};b.lineLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:a.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:c.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:c.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};b.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line",
"line-center"],default:a.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",
value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},
"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",
minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:a.TextTransform.NONE},"text-writing-mode":{type:"array",
value:"enum",values:["horizontal","vertical"],default:[a.TextWritingMode.HORIZONTAL]}};b.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};b.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};b.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",
minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};b.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},
"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};b.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",
default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},
"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};b.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",
minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};b.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,
maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};a.StyleDefinition=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(a){a.CapType=void 0;(function(b){b[b.BUTT=0]="BUTT";b[b.ROUND=1]="ROUND";b[b.SQUARE=2]="SQUARE";b[b.UNKNOWN=
4]="UNKNOWN"})(a.CapType||(a.CapType={}));a.JoinType=void 0;(function(b){b[b.BEVEL=0]="BEVEL";b[b.ROUND=1]="ROUND";b[b.MITER=2]="MITER";b[b.UNKNOWN=4]="UNKNOWN"})(a.JoinType||(a.JoinType={}));a.Alignment=void 0;(function(b){b[b.SCREEN=0]="SCREEN";b[b.MAP=1]="MAP"})(a.Alignment||(a.Alignment={}));a.ExternalColorMixMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Ignore=1]="Ignore";b[b.Multiply=99]="Multiply"})(a.ExternalColorMixMode||(a.ExternalColorMixMode={}));a.ExtremityPlacement=void 0;(function(b){b.Both=
"Both";b.JustBegin="JustBegin";b.JustEnd="JustEnd";b.None="None"})(a.ExtremityPlacement||(a.ExtremityPlacement={}));a.FillMode=void 0;(function(b){b[b.Mosaic=0]="Mosaic";b[b.Centered=1]="Centered"})(a.FillMode||(a.FillMode={}));a.FontEffects=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Superscript=1]="Superscript";b[b.Subscript=2]="Subscript"})(a.FontEffects||(a.FontEffects={}));a.FontEncoding=void 0;(function(b){b[b.MSSymbol=0]="MSSymbol";b[b.Unicode=1]="Unicode"})(a.FontEncoding||(a.FontEncoding=
{}));a.FontType=void 0;(function(b){b[b.Unspecified=0]="Unspecified";b[b.TrueType=1]="TrueType";b[b.PSOpenType=2]="PSOpenType";b[b.TTOpenType=3]="TTOpenType";b[b.Type1=4]="Type1"})(a.FontType||(a.FontType={}));a.AngleAlignment=void 0;(function(b){b[b.Display=0]="Display";b[b.Map=1]="Map"})(a.AngleAlignment||(a.AngleAlignment={}));a.AnimatedSymbolRepeatType=void 0;(function(b){b.None="None";b.Loop="Loop";b.Oscillate="Oscillate"})(a.AnimatedSymbolRepeatType||(a.AnimatedSymbolRepeatType={}));a.DominantSizeAxis=
void 0;(function(b){b[b.Z=0]="Z";b[b.X=1]="X";b[b.Y=2]="Y"})(a.DominantSizeAxis||(a.DominantSizeAxis={}));a.RotationOrder=void 0;(function(b){b[b.XYZ=0]="XYZ";b[b.ZXY=1]="ZXY";b[b.YXZ=2]="YXZ"})(a.RotationOrder||(a.RotationOrder={}));a.BalloonCalloutStyle=void 0;(function(b){b[b.Rectangle=0]="Rectangle";b[b.RoundedRectangle=1]="RoundedRectangle";b[b.Oval=2]="Oval"})(a.BalloonCalloutStyle||(a.BalloonCalloutStyle={}));a.BlendingMode=void 0;(function(b){b[b.None=0]="None";b[b.Alpha=1]="Alpha";b[b.Screen=
2]="Screen";b[b.Multiply=3]="Multiply";b[b.Add=4]="Add"})(a.BlendingMode||(a.BlendingMode={}));a.BlockProgression=void 0;(function(b){b[b.TTB=0]="TTB";b[b.RTL=1]="RTL";b[b.BTT=2]="BTT"})(a.BlockProgression||(a.BlockProgression={}));a.BillBoardMode=void 0;(function(b){b[b.None=0]="None";b[b.SignPost=1]="SignPost";b[b.FaceNearPlane=2]="FaceNearPlane"})(a.BillBoardMode||(a.BillBoardMode={}));a.CGAAttributeType=void 0;(function(b){b[b.Float=0]="Float";b[b.String=1]="String";b[b.Boolean=2]="Boolean"})(a.CGAAttributeType||
(a.CGAAttributeType={}));a.ClippingType=void 0;(function(b){b[b.Intersect=0]="Intersect";b[b.Subtract=1]="Subtract"})(a.ClippingType||(a.ClippingType={}));a.GeometricEffectArrowType=void 0;(function(b){b.OpenEnded="OpenEnded";b.Block="Block";b.Crossed="Crossed"})(a.GeometricEffectArrowType||(a.GeometricEffectArrowType={}));a.GeometricEffectControlMeasureLineRule=void 0;(function(b){b.FullGeometry="FullGeometry";b.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";b.ReversedFirstSegment=
"ReversedFirstSegment";b.PerpendicularToSecondSegment="PerpendicularToSecondSegment";b.SecondSegmentWithTicks="SecondSegmentWithTicks";b.DoublePerpendicular="DoublePerpendicular";b.OppositeToFirstSegment="OppositeToFirstSegment";b.TriplePerpendicular="TriplePerpendicular";b.HalfCircleFirstSegment="HalfCircleFirstSegment";b.HalfCircleSecondSegment="HalfCircleSecondSegment";b.HalfCircleExtended="HalfCircleExtended";b.OpenCircle="OpenCircle";b.CoverageEdgesWithTicks="CoverageEdgesWithTicks";b.GapExtentWithDoubleTicks=
"GapExtentWithDoubleTicks";b.GapExtentMidline="GapExtentMidline";b.Chevron="Chevron";b.PerpendicularWithArc="PerpendicularWithArc";b.ClosedHalfCircle="ClosedHalfCircle";b.TripleParallelExtended="TripleParallelExtended";b.ParallelWithTicks="ParallelWithTicks";b.Parallel="Parallel";b.PerpendicularToFirstSegment="PerpendicularToFirstSegment";b.ParallelOffset="ParallelOffset";b.OffsetOpposite="OffsetOpposite";b.OffsetSame="OffsetSame";b.CircleWithArc="CircleWithArc";b.DoubleJog="DoubleJog";b.PerpendicularOffset=
"PerpendicularOffset";b.LineExcludingLastSegment="LineExcludingLastSegment";b.MultivertexArrow="MultivertexArrow";b.CrossedArrow="CrossedArrow";b.ChevronArrow="ChevronArrow";b.ChevronArrowOffset="ChevronArrowOffset";b.PartialFirstSegment="PartialFirstSegment";b.Arch="Arch";b.CurvedParallelTicks="CurvedParallelTicks";b.Arc90Degrees="Arc90Degrees"})(a.GeometricEffectControlMeasureLineRule||(a.GeometricEffectControlMeasureLineRule={}));a.GeometricEffectDonutMethod=void 0;(function(b){b.Mitered="Mitered";
b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square";b.TrueBuffer="TrueBuffer"})(a.GeometricEffectDonutMethod||(a.GeometricEffectDonutMethod={}));a.GeometricEffectEnclosingPolygonMethod=void 0;(function(b){b.ClosePath="ClosePath";b.ConvexHull="ConvexHull";b.RectangularBox="RectangularBox"})(a.GeometricEffectEnclosingPolygonMethod||(a.GeometricEffectEnclosingPolygonMethod={}));a.GeometricEffectExtensionOrigin=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectExtensionOrigin||
(a.GeometricEffectExtensionOrigin={}));a.GeometricEffectOffsetMethod=void 0;(function(b){b.Mitered="Mitered";b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square"})(a.GeometricEffectOffsetMethod||(a.GeometricEffectOffsetMethod={}));a.GeometricEffectOffsetOption=void 0;(function(b){b.Fast="Fast";b.Accurate="Accurate"})(a.GeometricEffectOffsetOption||(a.GeometricEffectOffsetOption={}));a.GeometricEffectOffsetTangentMethod=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectOffsetTangentMethod||
(a.GeometricEffectOffsetTangentMethod={}));a.GeometricEffectWaveform=void 0;(function(b){b.Sinus="Sinus";b.Square="Square";b.Triangle="Triangle";b.Random="Random"})(a.GeometricEffectWaveform||(a.GeometricEffectWaveform={}));a.GlyphHinting=void 0;(function(b){b[b.None=0]="None";b[b.Default=1]="Default";b[b.Force=2]="Force"})(a.GlyphHinting||(a.GlyphHinting={}));a.GradientAlignment=void 0;(function(b){b[b.Buffered=0]="Buffered";b[b.Left=1]="Left";b[b.Right=2]="Right";b[b.AlongLine=3]="AlongLine"})(a.GradientAlignment||
(a.GradientAlignment={}));a.GradientFillMethod=void 0;(function(b){b[b.Linear=0]="Linear";b[b.Rectangular=1]="Rectangular";b[b.Circular=2]="Circular";b[b.Buffered=3]="Buffered"})(a.GradientFillMethod||(a.GradientFillMethod={}));a.GradientStrokeType=void 0;(function(b){b[b.Discrete=0]="Discrete";b[b.Continuous=1]="Continuous"})(a.GradientStrokeType||(a.GradientStrokeType={}));a.GradientStrokeMethod=void 0;(function(b){b[b.AcrossLine=0]="AcrossLine";b[b.AloneLine=1]="AloneLine"})(a.GradientStrokeMethod||
(a.GradientStrokeMethod={}));a.HorizontalAlignment=void 0;(function(b){b[b.Left=0]="Left";b[b.Right=1]="Right";b[b.Center=2]="Center";b[b.Justify=3]="Justify"})(a.HorizontalAlignment||(a.HorizontalAlignment={}));a.LeaderLineStyle=void 0;(function(b){b[b.Base=0]="Base";b[b.MidPoint=1]="MidPoint";b[b.ThreePoint=2]="ThreePoint";b[b.FourPoint=3]="FourPoint";b[b.Underline=4]="Underline";b[b.CircularCW=5]="CircularCW";b[b.CircularCCW=6]="CircularCCW"})(a.LeaderLineStyle||(a.LeaderLineStyle={}));a.LineCapStyle=
void 0;(function(b){b.Butt="Butt";b.Round="Round";b.Square="Square"})(a.LineCapStyle||(a.LineCapStyle={}));a.LineDashEnding=void 0;(function(b){b.NoConstraint="NoConstraint";b.HalfPattern="HalfPattern";b.HalfGap="HalfGap";b.FullPattern="FullPattern";b.FullGap="FullGap";b.Custom="Custom"})(a.LineDashEnding||(a.LineDashEnding={}));a.LineDecorationStyle=void 0;(function(b){b[b.None=-1]="None";b[b.Custom=0]="Custom";b[b.Circle=1]="Circle";b[b.OpenArrow=2]="OpenArrow";b[b.ClosedArrow=3]="ClosedArrow";
b[b.Diamond=4]="Diamond"})(a.LineDecorationStyle||(a.LineDecorationStyle={}));a.LineGapType=void 0;(function(b){b[b.ExtraLeading=0]="ExtraLeading";b[b.Multiple=1]="Multiple";b[b.Exact=2]="Exact"})(a.LineGapType||(a.LineGapType={}));a.LineJoinStyle=void 0;(function(b){b.Bevel="Bevel";b.Round="Round";b.Miter="Miter"})(a.LineJoinStyle||(a.LineJoinStyle={}));a.ExpressionReturnType=void 0;(function(b){b[b.Default=0]="Default";b[b.String=1]="String";b[b.Numeric=2]="Numeric"})(a.ExpressionReturnType||(a.ExpressionReturnType=
{}));a.MarkerPlacementType=void 0;(function(b){b[b.InsidePolygon=0]="InsidePolygon";b[b.PolygonCenter=1]="PolygonCenter";b[b.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(a.MarkerPlacementType||(a.MarkerPlacementType={}));a.MaterialMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Replace=1]="Replace";b[b.Multiply=2]="Multiply"})(a.MaterialMode||(a.MaterialMode={}));a.PlacementClip=void 0;(function(b){b[b.ClipAtBoundary=0]="ClipAtBoundary";b[b.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";
b[b.DoNotTouchBoundary=2]="DoNotTouchBoundary";b[b.DoNotClip=3]="DoNotClip"})(a.PlacementClip||(a.PlacementClip={}));a.PlacementEndings=void 0;(function(b){b.NoConstraint="NoConstraint";b.WithMarkers="WithMarkers";b.WithFullGap="WithFullGap";b.WithHalfGap="WithHalfGap";b.Custom="Custom"})(a.PlacementEndings||(a.PlacementEndings={}));a.PlacementGridType=void 0;(function(b){b.Fixed="Fixed";b.Random="Random";b.RandomFixedQuantity="RandomFixedQuantity"})(a.PlacementGridType||(a.PlacementGridType={}));
a.PlacementOnLineRelativeTo=void 0;(function(b){b.LineMiddle="LineMiddle";b.LineBeginning="LineBeginning";b.LineEnd="LineEnd";b.SegmentMidpoint="SegmentMidpoint"})(a.PlacementOnLineRelativeTo||(a.PlacementOnLineRelativeTo={}));a.PlacementPolygonCenterMethod=void 0;(function(b){b.OnPolygon="OnPolygon";b.CenterOfMass="CenterOfMass";b.BoundingBoxCenter="BoundingBoxCenter"})(a.PlacementPolygonCenterMethod||(a.PlacementPolygonCenterMethod={}));a.PlacementRandomlyAlongLineRandomization=void 0;(function(b){b[b.Low=
0]="Low";b[b.Medium=1]="Medium";b[b.High=2]="High"})(a.PlacementRandomlyAlongLineRandomization||(a.PlacementRandomlyAlongLineRandomization={}));a.PlacementStepPosition=void 0;(function(b){b[b.MarkerCenter=0]="MarkerCenter";b[b.MarkerBounds=1]="MarkerBounds"})(a.PlacementStepPosition||(a.PlacementStepPosition={}));a.PointSymbolCalloutScale=void 0;(function(b){b[b.None=0]="None";b[b.PropUniform=1]="PropUniform";b[b.PropNonuniform=2]="PropNonuniform";b[b.DifUniform=3]="DifUniform";b[b.DifNonuniform=
4]="DifNonuniform"})(a.PointSymbolCalloutScale||(a.PointSymbolCalloutScale={}));a.Simple3DLineStyle=void 0;(function(b){b.Tube="Tube";b.Strip="Strip";b.Wall="Wall"})(a.Simple3DLineStyle||(a.Simple3DLineStyle={}));a.SizeVariationMethod=void 0;(function(b){b[b.Random=0]="Random";b[b.Increasing=1]="Increasing";b[b.Decreasing=2]="Decreasing";b[b.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(a.SizeVariationMethod||(a.SizeVariationMethod={}));a.SymbolUnits=void 0;(function(b){b[b.Relative=0]=
"Relative";b[b.Absolute=1]="Absolute"})(a.SymbolUnits||(a.SymbolUnits={}));a.TextCase=void 0;(function(b){b[b.Normal=0]="Normal";b[b.LowerCase=1]="LowerCase";b[b.Allcaps=2]="Allcaps"})(a.TextCase||(a.TextCase={}));a.TextReadingDirection=void 0;(function(b){b[b.LTR=0]="LTR";b[b.RTL=1]="RTL"})(a.TextReadingDirection||(a.TextReadingDirection={}));a.TextureFilter=void 0;(function(b){b.Draft="Draft";b.Picture="Picture";b.Text="Text"})(a.TextureFilter||(a.TextureFilter={}));a.VerticalAlignment=void 0;(function(b){b[b.Top=
0]="Top";b[b.Center=1]="Center";b[b.Baseline=2]="Baseline";b[b.Bottom=3]="Bottom"})(a.VerticalAlignment||(a.VerticalAlignment={}));a.VerticalGlyphOrientation=void 0;(function(b){b[b.Right=0]="Right";b[b.Upright=1]="Upright"})(a.VerticalGlyphOrientation||(a.VerticalGlyphOrientation={}));a.WaterbodySize=void 0;(function(b){b[b.Small=0]="Small";b[b.Medium=1]="Medium";b[b.Large=2]="Large"})(a.WaterbodySize||(a.WaterbodySize={}));a.WaveStrength=void 0;(function(b){b[b.Calm=0]="Calm";b[b.Rippled=1]="Rippled";
b[b.Slight=2]="Slight";b[b.Moderate=3]="Moderate"})(a.WaveStrength||(a.WaveStrength={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){d=function(n){function l(){return n.apply(this,arguments)||this}c._inherits(l,n);var m=l.prototype;m.initializeProgram=function(t){return new e.Program(t.rctx,l.shader.get().build(this.configuration),g.Default3D)};m.initializePipeline=function(){return z.makePipelineState({blending:z.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:z.defaultColorWriteParams})};return c._createClass(l)}(d.ShaderTechnique);d.shader=new k.ReloadableShaderModule(q.RasterColorizer,
()=>new Promise((n,l)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],n,l)));u=function(n){function l(){var m=n.apply(this,arguments)||this;m.colorizerType=p.RasterColorizerType.Stretch;m.stretchType=p.RasterColorizerStretchType.Noop;m.applyColormap=!0;m.requireBilinearWithNN=!1;return m}c._inherits(l,n);return c._createClass(l)}(u.TileBlendTechniqueConfiguration);y.__decorate([f.parameter({count:p.RasterColorizerType.COUNT})],u.prototype,"colorizerType",void 0);y.__decorate([f.parameter({count:p.RasterColorizerStretchType.COUNT})],
u.prototype,"stretchType",void 0);y.__decorate([f.parameter()],u.prototype,"applyColormap",void 0);y.__decorate([f.parameter()],u.prototype,"requireBilinearWithNN",void 0);b.RasterColorizerTechnique=d;b.RasterColorizerTechniqueConfiguration=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u){let q=function(){function k(f){this._rctx=f;this._fbos=new Map}var d=k.prototype;d.get=function(f){return this._getPool(f)};d.dispose=function(){this._fbos.forEach(f=>f.dispose());this._fbos.clear()};d._getPool=function(f){var g=this._fbos.get(f);if(g)return g;g=new y.FramebufferObject(this._rctx,new u.TextureDescriptor(f),new p.RenderbufferDescriptor(c.RenderbufferFormat.DEPTH_COMPONENT16,f));this._fbos.set(f,g);return g};return b._createClass(k)}();a.MultiSizeFramebuffer=q;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let y=b._createClass(function(){this.sourceLod=[0,0,0];this.offset=[0,0];this.scale=1;this.layerIndex=0;this.vtlNeighborInfos=new c({allocator:u=>u||new p})}),p=b._createClass(function(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]});a.TileRenderInfo=y;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,b,c,y,p,u){function q(t,w,r){let x=0,D=Infinity;for(let v=0;3>v;++v){var A=t[v];if(w[v]<A){if(1E-6>=r[v])return!1;x=Math.max(x,(A-w[v])/r[v])}else-1E-6>=
r[v]&&(D=Math.min(D,(A-w[v])/r[v]));if(x>D)return!1;A=t[v+3];if(w[v]>A){if(-1E-6<=r[v])return!1;x=Math.max(x,(A-w[v])/r[v])}else 1E-6<=r[v]&&(D=Math.min(D,(A-w[v])/r[v]));if(x>D)return!1}return!0}function k(t,w,r,x,D,A){let v=x;for(;r<v;){var B=t[r];w[6*B+D+3]<=A?++r:(--v,t[r]=t[v],t[v]=B)}B=r;for(v=x;B<v;)x=t[v-1],w[6*x+D]>=A?--v:(t[v-1]=t[B],t[B]=x,++B);return{next:r,mid:B}}function d(t,w,r,x){if(x<=r)return p.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var D=6*t[r];for(var A=0;3>A;++A)l[A]=w[D+0+A],m[A]=
w[D+3+A];for(r+=1;r<x;++r)for(D=6*t[r],A=0;3>A;++A)l[A]=Math.min(l[A],w[D+0+A]),m[A]=Math.max(m[A],w[D+3+A]);return p.fromValues(l[0],l[1],l[2],m[0],m[1],m[2])}function f(t){var w=t[3]-t[0];const r=t[4]-t[1],x=t[5]-t[2];w=w>r?w>x?0:r>x?1:2:r>x?1:x>w?2:0;return{axis:w,midValue:(t[w]+t[w+3])/2}}function g(t,w,r,x,D){r-=w;const A=new Float32Array(6*r);for(let B=0;B<r;++B){var v=3*(B+w);const C=t[v]*D,E=t[v+1]*D;v=t[v+2]*D;for(let F=0;3>F;++F){const M=x[C+F],K=x[E+F],G=x[v+F];A[6*B+F]=Math.min(M,K,G);
A[6*B+3+F]=Math.max(M,K,G)}}return A}function e(t,w,r,x){const D=x-r;var A=0;for(var v=r;v<x;++v)for(var B=0;3>B;++B)A=Math.max(w[3*v+B],A);x=65535>=A?new Uint16Array(3*D):new Uint32Array(3*D);for(A=0;A<D;++A)for(v=3*(t[A]+r),B=0;3>B;++B)x[3*A+B]=w[v+B];return x}let h=b._createClass(function(t,w,r,x,D){this.aabb=t;this.axis=w;this.d=r;this.midStartIndex=x;this.rightStartIndex=D}),z=function(){function t(r,x,D,A){this.globalTriangleVertexIndices=r;this.firstTriangleIndex=x;this.positionAttribute=A;
this._rayDirection=y.create();this.bspNodeTree=[];const v=D-x,B=65535>=v?new Uint16Array(v):new Uint32Array(v);this.indices=B;for(let M=0;M<v;++M)B[M]=M;const C=g(r,x,D,A.data,A.stride),E=c.clamp(Math.log2(v/40),2,10),F=(M,K,G)=>{var L=d(B,C,M,K);const O=K-M;if(40>=O)return M=new h(L,void 0,0,M,K),this.bspNodeTree.push(M),M;const {axis:I,midValue:H}=f(L),J=k(B,C,M,K,I,H),N=(R,W)=>{if(!(G>E)){var T=W-R;if(!(40>T||T>=.8*O))return F(R,W,G+1)}};L=new h(L,I,H,J.next,J.mid);this.bspNodeTree.push(L);L.leftNode=
N(M,J.next);L.rightNode=N(J.mid,K);return L};F(0,v,0);this.triangleVertexIndices=e(B,r,x,D)}var w=t.prototype;w.intersectRayTriangleRange=function(r,x){if(!(r>=x)){var D=this.triangleVertexIndices,A=this.positionAttribute.data,v=this.positionAttribute.stride,B=this._rayOrigin,C=B[0],E=B[1];B=B[2];var F=this._rayDirection,M=F[0],K=F[1];F=F[2];for(let S=r,U=3*r;S<x;++S){var G=D[U++]*v,L=A[G++],O=A[G++],I=A[G];G=D[U++]*v;var H=A[G++],J=A[G++],N=A[G];G=D[U++]*v;var R=A[G++],W=A[G++];H-=L;J-=O;N-=I;R-=
L;W-=O;G=A[G]-I;var T=K*G-W*F,P=F*R-G*M;const V=M*W-R*K;var Q=H*T+J*P+N*V;if(!(Math.abs(Q)<=Number.EPSILON)){L=C-L;O=E-O;I=B-I;T=L*T+O*P+I*V;if(0<Q){if(0>T||T>Q)continue}else if(0<T||T<Q)continue;P=O*N-J*I;I=I*H-N*L;O=L*J-H*O;L=M*P+K*I+F*O;if(0<Q){if(0>L||T+L>Q)continue}else if(0<L||T+L<Q)continue;I=(R*P+W*I+G*O)/Q;0<=I&&(Q=this.indices[S]+this.firstTriangleIndex,H=u.computeNormal(H,J,N,R,W,G,n),this._callback(I,H,Q,!1))}}t.numFacesTested+=x-r}};w.intersectRay=function(r,x){t.numFacesTested=0;var D=
y.fromValues(r.r0[0],r.r0[1],r.r0[2]),A=y.fromValues(r.r1[0],r.r1[1],r.r1[2]);r=A[0]-D[0];const v=A[1]-D[1];A=A[2]-D[2];1E-6>r*r+v*v+A*A||(this._rayOrigin=D,D=this._rayDirection,D[0]=r,D[1]=v,D[2]=A,D=this.triangleVertexIndices.length/3,this._callback=x,this.intersectRayBSP(this.bspNodeTree[0],0,D))};w.intersectRayBSP=function(r,x,D){const A=this._rayOrigin,v=this._rayDirection;if(q(r.aabb,A,v)){var B=r.axis,C=r.d;if(A[B]<C||0>v[B]){const E=r.midStartIndex;if(x<E){const F=r.leftNode;void 0!==F?this.intersectRayBSP(F,
x,E):this.intersectRayTriangleRange(x,E)}}this.intersectRayTriangleRange(r.midStartIndex,r.rightStartIndex);if(A[B]>C||0<v[B])x=r.rightStartIndex,x<D&&(r=r.rightNode,void 0!==r?this.intersectRayBSP(r,x,D):this.intersectRayTriangleRange(x,D))}};b._createClass(t,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return t}();z.numFacesTested=0;const n=y.create(),l=[Infinity,Infinity,Infinity],m=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=
z;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){g=function(e){function h(){var z=e.apply(this,arguments)||this;z.output=y.ShaderOutput.Color;z.overlayMode=k.OverlayMode.Disabled;z.tileBlendInput=d.TileBlendInput.LayerOnly;z.spherical=!1;z.doublePrecisionRequiresObfuscation=!1;z.receiveShadows=!1;z.hasSlicePlane=!1;z.backfaceCullingEnabled=!1;z.textureFadingEnabled=!1;z.renderOccluded=!1;z.hasScreenSpaceReflections=!1;z.hasCloudsReflections=!1;z.invisible=!1;z.tileBorders=!1;z.visualizeNormals=!1;z.screenSizePerspective=
!1;z.receiveAmbientOcclusion=!1;z.pbrMode=q.PBRMode.Terrain;return z}b._inherits(h,e);return b._createClass(h)}(g.DefaultTechniqueConfiguration);c.__decorate([f.parameter({count:y.ShaderOutput.COUNT})],g.prototype,"output",void 0);c.__decorate([f.parameter({count:k.OverlayMode.COUNT})],g.prototype,"overlayMode",void 0);c.__decorate([f.parameter({count:d.TileBlendInput.COUNT})],g.prototype,"tileBlendInput",void 0);c.__decorate([f.parameter()],g.prototype,"spherical",void 0);c.__decorate([f.parameter()],
g.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([f.parameter()],g.prototype,"receiveShadows",void 0);c.__decorate([f.parameter()],g.prototype,"hasSlicePlane",void 0);c.__decorate([f.parameter()],g.prototype,"backfaceCullingEnabled",void 0);c.__decorate([f.parameter()],g.prototype,"textureFadingEnabled",void 0);c.__decorate([f.parameter()],g.prototype,"renderOccluded",void 0);c.__decorate([f.parameter()],g.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([f.parameter()],
g.prototype,"hasCloudsReflections",void 0);c.__decorate([f.parameter()],g.prototype,"invisible",void 0);c.__decorate([f.parameter()],g.prototype,"tileBorders",void 0);c.__decorate([f.parameter()],g.prototype,"visualizeNormals",void 0);c.__decorate([f.parameter()],g.prototype,"screenSizePerspective",void 0);c.__decorate([f.parameter()],g.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([f.parameter({count:q.PBRMode.COUNT})],g.prototype,"pbrMode",void 0);c.__decorate([f.parameter({constValue:p.NormalType.Compressed})],
g.prototype,"normalType",void 0);c.__decorate([f.parameter({constValue:u.TextureCoordinateAttributeType.Compressed})],g.prototype,"textureCoordinateType",void 0);c.__decorate([f.parameter({constValue:!1})],g.prototype,"highStepCount",void 0);c.__decorate([f.parameter({constValue:!1})],g.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([f.parameter({constValue:!1})],g.prototype,"useFillLights",void 0);a.TerrainTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return a._createClass(function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]})})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){a.TilingSchemeLogic=function(r){function x(A){A=r.call(this,A)||this;A._handles=new p;return A}b._inherits(x,r);var D=x.prototype;D.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(q.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};D.destroy=function(){this._handles=u.destroyMaybe(this._handles);this._waitTask=
null;this.layers.destroy()};D._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var A;this.layers.some(B=>!l.isTiledLayer(B)||B.isRejected()?!1:B.isFulfilled()&&null==t.getTiledLayerInfo(B,this.viewSpatialReference,this.viewingMode)?!1:(A=B,"vector-tile"!==B?.type&&!t.isProjectableRasterLayer(B)));if(A)if(A.isResolved()){var v=t.getTiledLayerInfo(A,this.viewSpatialReference,this.viewingMode);null!=v&&(v=new w.TilingScheme(v.tileInfo),this._lockTilingScheme(v))}else this._updateWhen(A)}};
D._updateWhen=function(A){const v=A.when().catch(()=>{}).then(()=>{v!==this._waitTask||this.destroyed||this._update()});this._waitTask=v};D._lockTilingScheme=function(A){if(this.viewingMode===m.ViewingMode.Global){const v=A.levels.length-1;A.spatialReference.isWebMercator?A=w.TilingScheme.makeWebMercatorAuxiliarySphere(v):h.canProjectToWGS84ComparableLonLat(A.spatialReference)&&(A=w.TilingScheme.makeGCSWithTileSize(A.spatialReference,A.pixelSize,v))}this.tilingSchemeLocked=!0;this.tilingScheme=A;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(q.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};D._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};D._setAdHocTilingScheme=function(){if(this.viewingMode===m.ViewingMode.Global){var A=this.extentHelper.viewSpatialReference;const v=h.canProjectToWGS84ComparableLonLat(A)||n.isMars(A)||n.isMoon(A);
A.isWebMercator?this.tilingScheme=w.TilingScheme.WebMercatorAuxiliarySphere:v&&(this.tilingScheme=w.TilingScheme.makeGCSWithTileSize(A,256));this._set("extent",this.extentHelper.layerViewsExtent)}else A=this.extentHelper.layerViewsExtent,null==A||z.equals(A,this.extent)||(this.tilingScheme=w.TilingScheme.fromExtent(A,this.extentHelper.viewSpatialReference),this._set("extent",A))};b._createClass(x,[{key:"test",get:function(){return{lockTilingScheme:A=>this._lockTilingScheme(A),done:!this._waitTask}}}]);
return x}(y);c.__decorate([k.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);c.__decorate([k.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([k.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([k.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([e.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec2f64"],function(a,b,c){let y=function(){function p(){this.offset=
c.create();this.scale=0;this.tile=null}var u=p.prototype;u.init=function(q,k,d,f){this.tile=q;this.offset[0]=k;this.offset[1]=d;this.scale=f};u.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return b._createClass(p)}();a.UpsampleInfo=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){a.Stage=function(w){function r(D){D=w.call(this,D)||this;D._model=new l.Model;D._layers=new p;D._asyncChangeSet=new h.ChangeSet;D._syncChangeSet=new h.ChangeSet;D._layerSyncSet=new Set;return D}b._inherits(r,w);var x=r.prototype;x.initialize=function(){this._set("renderView",new m.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(t.TaskPriority.STAGE,this);this.addHandles(this._frameTask)};x.destroy=function(){this.removeAllHandles()};
x.add=function(D){this._model.add(D);n.isWebGLLayer(D)&&this._addLayer(D);this.renderView.requestRender()};x.remove=function(D){null==D||this.destroyed||(this._model.remove(D),n.isWebGLLayer(D)&&this._removeLayer(D),this.renderView.requestRender())};x.addMany=function(D){null!=D&&(this._model.addMany(D),this.renderView.requestRender())};x.removeMany=function(D){null!=D&&(this._model?.removeMany(D),this.renderView?.requestRender())};x.load=async function(D,A){null!=D&&(Array.isArray(D)||(D=[D]),await Promise.all(D.filter(v=>
null==v.glTexture).map(v=>this.schedule(()=>this._model.has(v)?v.load(this.renderView.renderingContext):null),A)))};x.loadImmediate=function(D){return D.load(this.renderView.renderingContext)};x.forEachOfType=function(D,A){this._model.forEachOfType(D,A)};x.handleEvent=function(D,A){this.destroyed||(this._model.dirtySet[D](A),this.renderView.requestRender())};x.runTask=function(D){this._frameTask.processQueue(D);this._commit(D)};x._commit=function(D){const A=this._model.dirtySet;this._asyncChangeSet.empty||
D.done||(this.renderer.modify(this._asyncChangeSet,D),this.renderView.requestRender(),D.madeProgress());this._layers.forAll(v=>{if(!D.done){var B=this._layerSyncSet.has(v.id)||v.updatePolicy===z.UpdatePolicy.SYNC,C=B?this._syncChangeSet:this._asyncChangeSet;A.commitLayer(v.id,C);this._layerSyncSet.delete(v.id);C.empty||(this.renderer.modify(C,B?t.noBudget:D),this.renderView.requestRender(),D.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender(),
D.madeProgress());this._layers.forAll(v=>{D.done||this._layerSyncSet.has(v.id)||v.updatePolicy!==z.UpdatePolicy.ASYNC||(A.commitLayer(v.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,D),this.renderView.requestRender(),D.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")};x.commitSyncLayers=function(){const D=this._model.dirtySet;this._layers.forAll(A=>{if(this._layerSyncSet.has(A.id)||A.updatePolicy===z.UpdatePolicy.SYNC)D.commitLayer(A.id,
this._syncChangeSet),this._layerSyncSet.delete(A.id)});for(const A of this._layerSyncSet)D.commitLayer(A,this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender())};x._commitLayer=function(D){this._model.dirtySet.commitLayer(D.id,this._syncChangeSet);this._layerSyncSet.delete(D.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender())};
x.schedule=function(D,A){return this._frameTask.schedule(D,A)};x.reschedule=function(D,A){return this._frameTask.reschedule(D,A)};x.syncLayer=function(D){this._layerSyncSet.add(D);this.renderView.requestRender()};x.getObject=function(D){return this._model.getObject(D)};x._addLayer=function(D){this._layers.includes(D)||this._layers.push(D)};x._removeLayer=function(D){this._commitLayer(D);null!=this._layers.removeUnordered(D)&&(this._model.dirtySet.getResidentRenderGeometries(D.id,this._syncChangeSet.removes),
this.renderer.modify(this._syncChangeSet,t.noBudget))};x.addRenderPlugin=function(D,A,v){D=this.renderer.renderPlugins.add(D,A,v);v=()=>{e.isIntersectionHandler(A)&&this.view.sceneIntersectionHelper.addIntersectionHandler(A)};if(u.isPromiseLike(D))return D.then(v);v()};x.removeRenderPlugin=function(D){this.destroyed||(e.isIntersectionHandler(D)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(D),this.renderer.renderPlugins.remove(D))};b._createClass(r,[{key:"viewingMode",get:function(){return this.view.state.viewingMode}},
{key:"updating",get:function(){return this.running||this.renderView.updating||this._frameTask.updating}},{key:"renderer",get:function(){return this.renderView?.renderer}},{key:"running",get:function(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}},{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const D=this;return{getCount(A){return D._model.test.content.filter(v=>
v.type===A).length},model:D._model}}}]);return r}(y);a.Stage.DebugSettings={endFrameContentValidation:!1};c.__decorate([q.property({constructOnly:!0})],a.Stage.prototype,"view",void 0);c.__decorate([q.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([q.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([q.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([q.property({readOnly:!0})],a.Stage.prototype,"updating",null);
c.__decorate([q.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([q.property({autoDestroy:!0})],a.Stage.prototype,"renderView",void 0);c.__decorate([q.property({readOnly:!0})],a.Stage.prototype,"renderer",null);c.__decorate([q.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=c.__decorate([g.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){a.Model=function(l){function m(){var w=l.apply(this,arguments)||this;w.dirtySet=new e({model:b._assertThisInitialized(w)});w._content=new Map;w._originFactory=new g.GridLocalOriginFactory(null);return w}b._inherits(m,l);var t=m.prototype;t.getObject=function(w){return this._content.get(w)};t.add=function(w){const r=w.id;z.assert(!this._content.has(r),"Model/Stage already contains object to be added");this._content.set(r,w);n.isWebGLLayer(w)&&this.dirtySet.layerAdded(w)};
t.remove=function(w){z.assert(this._content.has(w.id),"Model/Stage doesn't contain object to be removed");this._content.delete(w.id);w.unload();n.isWebGLLayer(w)&&this.dirtySet.layerRemoved(w)};t.addMany=function(w){for(const r of w)null!=r&&(z.assert(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))};t.removeMany=function(w){for(const r of w)z.assert(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),
r.unload()};t.has=function(w){return this._content.has(w.id)};t.forEachOfType=function(w,r){this._content.forEach(x=>{x.type===w&&r(x)})};t.getRenderGeometry=function(w,r){const {shaderTransformer:x,localOrigin:D}=r,A=new h.RenderGeometry(r,{shaderTransformer:x,castShadow:w.castShadow});A.updateTransformation(v=>w.getCombinedStaticTransformation(r,v));A.localOrigin=null!=D?D:this._originFactory.getOrigin(A.boundingSphere);return A};t.updateRenderGeometryTransformation=function(w,r,x){if(null==w)return!1;
x.updateTransformation(A=>w.getCombinedStaticTransformation(r,A));const D=this._originFactory.getOrigin(x.boundingSphere);return x.localOrigin!==D};t.getStats=function(){const w={},r=Array.from(this._content.values());for(let x=0;x<f.ContentObjectType.COUNT;++x)w[x]=r.filter(D=>D.type===x).length;return{contentTypes:w,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(m,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);return m}(y);c.__decorate([p.property({constructOnly:!0})],
a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([d.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=a._createClass(function(z,n,l){this.operation=z;this.geometry=n;this.states=l});c=function(z){function n(m){m=z.call(this,m)||this;m._residentGeomRecords=new Map;m._dirtyGeomRecords=new Map;m.dirty=!1;return m}a._inherits(n,z);var l=n.prototype;l.commitLayer=function(m,t){const w=this._dirtyGeomRecords.get(m);w&&(w.forEach((r,x)=>{const D=this._ensureGeomRecord(m,x);r.forEach(({geometry:A,operation:v,states:B},C)=>{let E=!1;if(v===g.DirtyOperation.UPDATE){const F=
D.get(C);if(F){if(B&g.DirtyState.TRANSFORMATION){const M=this.model.getObject(x);this.model.updateRenderGeometryTransformation(M,A,F)&&(E=!0)}E||t.updates.push({renderGeometry:F,updateType:B})}else e.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(v===g.DirtyOperation.REMOVE||E)(B=D.get(C))?(t.removes.push(B),D.delete(C)):v===g.DirtyOperation.REMOVE&&e.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(v===g.DirtyOperation.ADD||E)v=this.model.getObject(x),
null!=v&&(A=this.model.getRenderGeometry(v,A),t.adds.push(A),D.set(C,A))});0===D.size&&this._residentGeomRecords.get(m).delete(x)}),0===this._residentGeomRecords.get(m).size&&this._residentGeomRecords.delete(m),this._dirtyGeomRecords.delete(m),this.dirty=this._hasDirtyGeometryRecords)};l.getResidentRenderGeometries=function(m,t){(m=this._residentGeomRecords.get(m))&&m.forEach(w=>w.forEach(r=>t.push(r)))};l._objectStateChanged=function(m,t){for(const w of t.geometries)this._updateOrCreateDirtyRecord(t,
w,null,g.DirtyOperation.UPDATE,m)};l.visibilityChanged=function(m){this._objectStateChanged(g.DirtyState.VISIBILITY,m)};l.highlightChanged=function(m){this._objectStateChanged(g.DirtyState.HIGHLIGHT,m)};l.occlusionChanged=function(m){this._objectStateChanged(g.DirtyState.OCCLUDEE,m)};l.objectGeometryUpdated=function(m){this._updateOrCreateDirtyRecord(m.object,m.geometry,null,g.DirtyOperation.UPDATE,g.DirtyState.GEOMETRY)};l.layerAdded=function(m){m.objects.forAll(t=>this._layerObjectAdded(m,t))};
l.layerRemoved=function(m){m.objects.forAll(t=>this._layerObjectRemoved(m,t))};l.layerObjectAdded=function(m){this._layerObjectAdded(m.layer,m.object)};l._layerObjectAdded=function(m,t){m=m.id;for(const w of t.geometries)this._objectGeometryAdded(t,w,m)};l.layerObjectRemoved=function(m){this._layerObjectRemoved(m.layer,m.object)};l.layerObjectsAdded=function(m){for(const t of m.objects)this._layerObjectAdded(m.layer,t)};l.layerObjectsRemoved=function(m){for(const t of m.objects)this._layerObjectRemoved(m.layer,
t)};l._layerObjectRemoved=function(m,t){m=m.id;for(const w of t.geometries)this._objectGeometryRemoved(t,w,m)};l.shaderTransformationChanged=function(m){(m=this._residentGeomRecords.get(m.id))&&m.forEach((t,w)=>{(w=this.model.getObject(w))&&w.hasVolativeTransformation()&&t.forEach(r=>r.shaderTransformationChanged())})};l.objectTransformation=function(m){const t=this._getParentLayerId(m);this._ensureGeomRecord(t,m.id).forEach(w=>{this._updateOrCreateDirtyRecord(m,w.geometry,t,g.DirtyOperation.UPDATE,
g.DirtyState.TRANSFORMATION)})};l.objectShaderTransformation=function(){};l.objectGeometryAdded=function(m){this._objectGeometryAdded(m.object,m.geometry)};l._objectGeometryAdded=function(m,t,w=null){this._updateOrCreateDirtyRecord(m,t,w,g.DirtyOperation.ADD)};l.objectGeometryRemoved=function(m){this._objectGeometryRemoved(m.object,m.geometry)};l._objectGeometryRemoved=function(m,t,w=null){this._updateOrCreateDirtyRecord(m,t,w,g.DirtyOperation.REMOVE)};l._updateOrCreateDirtyRecord=function(m,t,w,
r,x=g.DirtyState.NONE){w=w??this._getParentLayerId(m);const D=t.id;m=this._ensureDirtyRecord(w,m.id);(w=m.get(D))?(t=w.operation,t===g.DirtyOperation.REMOVE&&r===g.DirtyOperation.ADD&&w.states!==g.DirtyState.NONE?w.operation=g.DirtyOperation.UPDATE:t===g.DirtyOperation.REMOVE&&r===g.DirtyOperation.ADD||t===g.DirtyOperation.ADD&&r===g.DirtyOperation.REMOVE?m.delete(D):(t!==g.DirtyOperation.UPDATE||r!==g.DirtyOperation.REMOVE&&r!==g.DirtyOperation.UPDATE?e.assert((t===g.DirtyOperation.REMOVE||t===g.DirtyOperation.ADD)&&
r===g.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):w.operation=r,w.states|=x)):m.set(D,new h(r,t,x));this.dirty=this._hasDirtyGeometryRecords};l._ensureGeomRecord=function(m,t){let w=this._residentGeomRecords.get(m);w||(w=new Map,this._residentGeomRecords.set(m,w));m=w.get(t);m||(m=new Map,w.set(t,m));return m};l._ensureDirtyRecord=function(m,t){let w=this._dirtyGeomRecords.get(m);w||(w=new Map,this._dirtyGeomRecords.set(m,w));m=w.get(t);m||(m=new Map,w.set(t,m));
return m};l._getParentLayerId=function(m){return m.parentLayer?m.parentLayer.id:p.NullUID};l.formatDebugInfo=function(){const m=["ADD","UPD",void 0,"REM"];let t="";this._dirtyGeomRecords.forEach((w,r)=>{w.forEach((x,D)=>{0<t.length&&(t+="\n");t+=r+"."+D;const A=[];x.forEach(v=>{const B=v.operation;A[B]||(A[B]=[]);A[B].push(v.geometry.id)});for(x=0;x<A.length;x++)if(A[x])for(t+=" "+m[x-1]+": ",D=0;D<A[x].length;D++)t+=A[x][D]+", "})});return t};a._createClass(n,[{key:"_hasDirtyGeometryRecords",get:function(){return y.someMap(this._dirtyGeomRecords,
m=>y.someMap(m,t=>t&&0<t.size))}},{key:"test",get:function(){const m=this;return{get residentLayerCount(){return m._residentGeomRecords.size},get residentObjectCount(){return Array.from(m._residentGeomRecords.values()).reduce((t,w)=>t+w.size,0)},commit:t=>m._dirtyGeomRecords.forEach((w,r)=>m.commitLayer(r,t))}}}]);return n}(c);b.__decorate([u.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([u.property()],c.prototype,"dirty",void 0);return c=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],
c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/contextUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J){a.RenderView=function(R){function W(P){var Q=R.call(this,{})||this;Q.events=new p;Q.waterTextureRepository=new K.WaterTextureRepository;Q._magnifierHelper=new D.MagnifierHelper;Q.objectAndLayerIdRenderHelper=u("enable-feature:objectAndLayerId-rendering")?new v.ObjectAndLayerIdRenderHelper:null;Q._needsUpdate=!0;Q._needsRender=!0;Q._idleSuspend=!0;Q._needsWaterReflectionUpdate=!1;Q._lastAnimationUpdate=0;Q._container=
P.container;Q._viewingMode=P.viewingMode;Q._initializeContext(P);Q.addHandles([d.watch(()=>Q.waterTextureRepository?.updating,()=>Q.requestRender(),d.initial),d.watch(()=>P.view.qualityProfile,U=>Q.renderer?.updateRenderFeature(U),d.syncAndInitial),Q._magnifierHelper.events.on("request-render",()=>Q.requestRender())]);const {memoryController:S}=P.view.resourceController;Q.stippleTextureRepository=M.createStippleTextureRepository(Q._rctx,S);Q.markerTextureRepository=F.createMarkerTextureRepository(Q._rctx,
S);Q._shaderTechniqueRepository=new m.ShaderTechniqueRepository({rctx:Q._rctx,viewingMode:P.viewingMode,stippleTextureRepository:Q.stippleTextureRepository,waterTextureRepository:Q.waterTextureRepository,markerTextureRepository:Q.markerTextureRepository});Q._textureRepository=new E.TextureRepository(P,Q._shaderTechniqueRepository,Q._rctx);Q.addHandles(Q._textureRepository.events.on("changed",U=>Q.requestRender(U)));Q._materialRepository=new x.GLMaterialRepository(Q._textureRepository,Q._shaderTechniqueRepository,
()=>Q.requestRender(),()=>Q.requestRender());Q._compositingHelper=new w(Q._rctx,Q._shaderTechniqueRepository);Q.renderer=new B.Renderer(P,Q._materialRepository,Q._textureRepository,Q._shaderTechniqueRepository,Q._rctx,Q._compositingHelper,Q._magnifierHelper,U=>Q.requestRender(U));Q._screenshotManager=new O.ScreenshotManager(Q._rctx,{renderScene:(U,V,X,Y,Z)=>Q.renderer.render(U,V,X,Y,Z),requestRenderScene:U=>Q.requestRender(U),prepareOverlay:()=>P.options.screenshot.prepareOverlay(),renderOverlay:(U,
V)=>P.options.screenshot.renderOverlay(U,V)},U=>Q.events.emit("force-camera-for-screenshot",U),()=>Q.renderer.disposeOffscreenBuffers());Q._registerFrameTask(P);return Q}b._inherits(W,R);var T=W.prototype;T.normalizeCtorArgs=function(){return{}};T.destroy=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=k.removeMaybe(this._frameTask);this._shaderTechniqueRepository=k.destroyMaybe(this._shaderTechniqueRepository)};T.requestRender=function(P=
t.RenderRequestType.UPDATE){this._needsRender=!0;P===t.RenderRequestType.UPDATE&&(this._needsUpdate=!0)};T.setIdleSuspend=function(P){this._idleSuspend!==P&&(this._idleSuspend=P,this.requestRender())};T.takeScreenshot=function(P){return this._screenshotManager.takeScreenshot(P).then(Q=>Q[0])};T.takeScreenshotWithOID=function(P){P.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(P)};T.getAlpha=function(){return!!this._rctx.contextAttributes.alpha};T.getMinimalDepthForArea=function(P,
Q,S,U,V,X=V){X=U.constrainWindowSize(Q,S,V*U.pixelRatio,X*U.pixelRatio);const Y=this._ensureDepthBuffer(X);this.renderer.readDepthPixels(U,X,Y);V=Number.MAX_VALUE;for(let Z=0;Z<X[2]*X[3];Z++){const ea=r.textureToDepth(4*Z,Y,U.nearFar);V>ea&&ea!==U.nearFar[0]&&ea!==U.nearFar[1]&&(V=ea)}null!=P&&(P=P.pickDepth(Q*U.pixelRatio,S*U.pixelRatio,U),null!=P&&V>P&&P!==U.nearFar[0]&&P!==U.nearFar[1]&&(V=P));return V===Number.MAX_VALUE?void 0:V};T._ensureDepthBuffer=function(P){P=4*P[2]*P[3];if(null==this._tmpDepthBuffer||
this._tmpDepthBuffer.byteLength<P)this._tmpDepthBuffer=new Uint8Array(P);return this._tmpDepthBuffer};T.reloadShaders=async function(){L.removeLoadedShaderModules();await this._shaderTechniqueRepository.reloadAll();this.requestRender()};T._registerFrameTask=function(P){const Q=P.view.state;let S=!1,U=t.RenderRequestType.BACKGROUND,V=!1;this._frameTask=f.addFrameTask({preRender:({time:X})=>{S=this.updating;U=this._needsUpdate?t.RenderRequestType.UPDATE:t.RenderRequestType.BACKGROUND;P.commitSyncLayers();
var Y=g.Milliseconds(X-this._lastAnimationUpdate);if(Y>this.renderer.animationTimestep||null!=Q.forcedAnimationTime||S||this._needsRender)Y=g.Milliseconds(Y/this.renderer.animationTimeDilation),Y=new A.UpdateParameters(Q.camera,Y,Q.forcedAnimationTime),this.renderer.updateAnimation(Y)&&this.requestRender(t.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=X},render:({time:X})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<Q.camera.fullWidth&&
0<Q.camera.fullHeight){const Y=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(null,null,Q,t.Decorations.ON,X);V=!0;Y&&this.renderer.hasReflections&&(this.requestRender(t.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:X})=>{const Y=new O.ScreenshotContext(Q,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update();this._screenshotManager.update(Y,
X)},finish:()=>{V&&(this.renderer.finish(Q.mode===H.RenderState.IDLE?U:t.RenderRequestType.UPDATE),V=!1)}})};T._initializeContext=function(P){const Q=P.options;this._canvas=Q.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const S=J.createContextForView("3d",this._canvas,{alpha:Q.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:Q.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:Q.preserveDrawingBuffer??
!1});null==S?q.getLogger(this).error("A WebGL2 context could not be created."):(this._rctx=this._newRenderingContext(S,P),this._loadShaderOnlyExtensions(),!Q.alpha&&this._rctx.contextAttributes.alpha&&q.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=u("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};T._newRenderingContext=function(P,Q){const S={disabledExtensions:Q.options.deactivatedWebGLExtensions||
{},debugWebGLExtensions:Q.options.debugWebGLExtensions||{},maxAnisotropy:8},U=(V,X)=>Q.view.resourceController.memoryController.newCache(V,X);if(I.contextCache.enabled){let V=N.get(P);if(V)return V.configure(S),V.newCache=U,V.ref(),V;V=new C.RenderingContext(P,S,U);N.set(P,V);V.ref();return V}return new C.RenderingContext(P,S,U)};T._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("textureFloat")};T.getObjectAndLayerIdColor=function(P){return null!=this.objectAndLayerIdRenderHelper?
this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(P):null};b._createClass(W,[{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(P){this._magnifierHelper.magnifier=
P}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"componentObjectCollection",get:function(){null==this._componentObjectCollection&&(this._componentObjectCollection=new l.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection},set:function(P){this._componentObjectCollection=P}}]);return W}(y);c.__decorate([e.property({type:Boolean,
readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_rctx",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_container",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_canvas",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"stippleTextureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"markerTextureRepository",
void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([e.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([e.property({autoDestroy:!0,
readOnly:!0})],a.RenderView.prototype,"renderer",void 0);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_screenshotManager",void 0);c.__decorate([e.property()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([e.property({autoDestroy:!0})],a.RenderView.prototype,"_componentObjectCollection",void 0);c.__decorate([e.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([e.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);
a.RenderView=c.__decorate([n.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const N=G.getContextCache();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/Indices ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T){function P(Y,Z){return Y===Z?F.ComponentParameterSummary.All:0===Y?F.ComponentParameterSummary.None:F.ComponentParameterSummary.Some}const Q=y.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");y=function(){function Y(ea,ja){this._renderManager=ea;this._viewingMode=ja;this._objects=[new u,new u];this._renderSubmit=new B.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=c("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new N.BufferManager(ea.rctx,2+(this._hasObjectAndLayerId?1:0))}var Z=Y.prototype;Z.destroy=function(){L.assert(0===this._objects[x.State.Hidden].length&&0===this._objects[x.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();const ea=this._objects.flatMap(ja=>ja.toArray());for(const ja of ea)ja?.destroy()};Z.createObject=function(ea){const ja=
new x.ComponentObject;ja.toMapSpace=ea.toMapSpace;ja.transform=ea.transform;ja.obb=m.clone(ea.obb);ja.components=new r(this._componentBufferManager,e.compactIndices(ea.geometry.componentOffsets));ja.renderable=this._createRenderable(ea,ja.components);ja.intersectionGeometry=new D(ea.geometry.positionData,ja.components);this._objects[ja.visible].push(ja);return ja};Z.destroyObject=function(ea){this._objects[ea.visible].removeUnordered(ea);ea.destroy();this._notifyDirty()};Z.setObjectVisibility=function(ea,
ja){ja!==ea.visible&&(this._objects[ea.visible].removeUnordered(ea),this._objects[ja].push(ea),ea.visible=ja,this._notifyDirty())};Z.preSubmit=function(ea){const ja=ea.camera.eye;this.visibleObjects.forAll(ha=>ha.renderable.meta.cameraDepthSquared=f.squaredDistance(ja,ha.obb.center))};Z.getMaterial=function(ea){return ea.renderable.material};Z.updateMaterial=function(ea,ja){ea=ea.renderable.material;ja(ea);ea.dirty&&this._notifyDirty()};Z.setAllComponentVisibilities=function(ea,ja){ea.components.visibility.reset(ja);
ea.components.visibilityDirty();this._notifyDirty()};Z.forEachVisibleComponent=function(ea,ja){return ea.components.visibility.forEachComponent(ja)};Z.getComponentCount=function(ea){const ja=ea.components.visibility.componentCount();return{visible:ja,invisible:ea.components.count-ja}};Z.setComponentData=function(ea,ja){const ha=ea.renderable.material,ia=ea.components;var oa=ia.materialDataBuffer;const ma=ia.materialDataIndices,fa=new E.UniformComponentParameters;oa=oa.textureBuffer;const ba=new Uint8Array(4),
aa=new Uint32Array(ba.buffer);let da=0,ca=0,na=0,qa=ia.verticalOffsets,ua=Infinity,sa=-Infinity,pa=!1,ka=!1,ra=0;for(let va=0;va<ia.count;va++){ja(va,fa);da+=+(1>fa.externalColor[3]);ca+=+(fa.externalColorMixMode===l.ColorMixModeEnum.Replace&&1===fa.externalColor[3]);na+=+fa.castShadows;l.encodeSymbolColor(fa.externalColor,fa.externalColorMixMode,ba);ba[2]=ba[2]&254|+fa.castShadows;oa.setData(ma[va],0,ba[0],ba[1],ba[2],ba[3]);pa||(pa=0<va&&ra!==aa[0]);ra=aa[0];ka||(ka=0!==fa.elevationOffset);ka&&
null==qa&&(qa=Array(va).fill(0));null!=qa&&(qa[va]=fa.elevationOffset);ua=Math.min(ua,fa.elevationOffset);sa=Math.max(sa,fa.elevationOffset);K.encodeElevationOffset(fa.elevationOffset,ba);oa.setData(ma[va],1,ba[0],ba[1],ba[2],ba[3]);const Ca=fa.objectAndLayerIdColor;null!=Ca&&oa.setData(ma[va],2,Ca[0],Ca[1],Ca[2],Ca[3]);fa.pickable!==G.getVisibility(ia.pickability,va)&&(ia.pickability=G.updateVisibilityWithCount(ia.pickability,ia.count,va,fa.pickable))}ia.verticalOffsets=ka?qa:null;ea.offsetObb=ka?
m.computeOffsetObb(ea.obb,ua,sa,this._viewingMode,null!=ea.offsetObb?ea.offsetObb:m.clone(ea.obb)):null;pa||ka||this._hasObjectAndLayerId?(ha.componentParameters=new F.ComponentParametersVarying,ha.componentParameters.castShadows=P(na,ia.count),ha.componentParameters.transparent=P(da,ia.count),ha.componentParameters.opaqueOverride=P(ca,ia.count),ha.componentParameters.texture=oa,oa.updateTexture()):(ha.componentParameters=new F.ComponentParametersUniform,ha.componentParameters.castShadows=fa.castShadows?
F.ComponentParameterSummary.All:F.ComponentParameterSummary.None,ha.componentParameters.externalColor=fa.externalColor,ha.componentParameters.externalColorMixMode=fa.externalColorMixMode);this._notifyDirty()};Z.getComponentAabb=function(ea,ja,ha,ia=!1){ea.intersectionGeometry.getComponentAabb(ja,ha);const oa=ea.components.verticalOffsets;if(ia||null==oa)return ha;ja=oa[ja];if(this._viewingMode===n.ViewingMode.Local||0===ja)return ha[2]+=ja,ha[5]+=ja,ha;ja=I.getVerticalOffsetI3S(ja);ja.localOrigin=
ea.transform.position;return ja.applyToAabb(ha)};Z.getComponentObb=function(ea){return ea.obb};Z.getObjectTransform=function(ea){return ea.transform};Z.getComponentPositions=function(ea,ja,ha){return ea.intersectionGeometry.getComponentPositions(ja,ha)};Z.intersect=function(ea,ja,ha,ia,oa,ma){null!=oa&&(oa.localOrigin=ea.transform.position);const fa=k.invert(U,ea.transform.rotationScale);f.sub(V,ja,ea.transform.position);f.sub(X,ha,ea.transform.position);f.transformMat3(V,V,fa);f.transformMat3(X,
X,fa);ja=k.transpose(U,fa);return ea.intersectionGeometry.intersect(V,X,ia,ja,oa,ea.components.verticalOffsets,ma)};Z.addEdges=function(ea,ja,ha,ia){const {indices:oa,positions:ma}=ea.intersectionGeometry,fa=ea.components.offsets;return ja.addComponentObject(ea,ea.transform,{center:ea.obb.center,radius:m.radius(ea.obb)},ma,oa,fa,ha,ia)};Z.extractEdgeInformation=async function(ea,ja,ha){var ia=ea.components.visibility;if(ia.allInvisible())return{buffer:J.extractComponentsEdgeLocationsLayout.createBuffer(0),
origin:[0,0,0]};const {indices:oa,positions:ma}=ea.intersectionGeometry,fa=ea.components.offsets,ba=H.EdgeInputBufferLayout.createBuffer(ma.length/3);z.copy(ba.position.typedBuffer,ma,ba.position.typedBufferStride,3);h.transformMat3View(ba.position,ba.position,ea.transform.rotationScale);this._setComponentIndices(ba.componentIndex,oa,fa);ia=this._computeVisibilityIndices(oa,ia,fa,ba.count);ea=g.clone(ea.transform.position);ja=await ja.extractComponentsEdgeLocations({indices:ia,indicesLength:ia.length,
skipDeduplicate:!0,data:ba,writerSettings:{reducedPrecision:!1,variants:0}},ha);return{origin:ea,buffer:ja}};Z._setComponentIndices=function(ea,ja,ha){let ia=0;for(let ma=0;ma<ha.length-1;ma++){var oa=ha[ma];const fa=ha[ma+1];for(;oa<fa;oa++)ea.set(ja?ja[oa]:oa,ia);ia++}};Z._computeVisibilityIndices=function(ea,ja,ha,ia){if(ea&&ja.allVisible())return ea;let oa=0;ja.forEachComponentRange((ba,aa)=>{oa+=ha[aa]-ha[ba];return!0});const ma=q.isArray(ea)?Array(oa):2===ea?.BYTES_PER_ELEMENT||65536>=ia?new Uint16Array(oa):
new Uint32Array(oa);let fa=0;ja.forEachComponentRange((ba,aa)=>{ba=ha[ba];for(aa=ha[aa];ba<aa;ba++)ma[fa++]=ea?ea[ba]:ba;return!0});return ma};Z.addComponentHighlight=function(ea,ja){ea=ea.components;null==ea.highlightCounts&&(ea.highlightCounts=new Uint32Array(ea.count+1));0===ea.highlightCounts[ja]++&&(ea.highlightsDirty(),this._notifyDirty());ea.highlightCounts[ea.count]++};Z.removeComponentHighlight=function(ea,ja){ea=ea.components;if(null==ea.highlightCounts)Q.warn("Removing non-existing highlight.");
else{var ha=ea.highlightCounts[ja],ia=ea.highlightCounts[ea.count];0===ha?Q.warn("Removing non-existing highlight."):1<ha?(ea.highlightCounts[ja]=ha-1,ea.highlightCounts[ea.count]=ia-1):(ea.highlightCounts[ja]=0,ea.highlightsDirty(),this._notifyDirty(),1===ia?ea.highlightCounts=null:ea.highlightCounts[ea.count]=ia-1)}};Z.clearHighlights=function(ea){ea=ea.components;null!=ea.highlightCounts&&(ea.highlightCounts=null,ea.highlightsDirty(),this._notifyDirty())};Z.getObjectGPUMemoryUsage=function(ea){return ea.renderable.meta.gpuMemoryEstimate};
Z._createRenderable=function(ea,ja){const ha=this._renderManager.rctx,ia=ea.geometry;var oa=ia.vertices.layoutParameters;const ma=R.BufferObject.createVertex(ha,W.Usage.STATIC_DRAW,ia.vertices.data),fa=p.applySome(ia.indices,ca=>R.BufferObject.createIndex(ha,W.Usage.STATIC_DRAW,ca));var ba=t.glLayout(C.createVertexBufferLayout(oa));const aa=new Uint16Array(ia.vertices.count);for(let ca=0;ca<ja.count;ca++){var da=ja.offsets[ca];const na=ja.offsets[ca+1],qa=ja.materialDataIndices[ca];if(null!=ia.indices)for(;da<
na;da++)aa[ia.indices[da]]=qa;else for(;da<na;da++)aa[da]=qa}ja=R.BufferObject.createVertex(ha,W.Usage.STATIC_DRAW,aa.buffer);ea=new F.ComponentMaterial(ea.transform,ea.toMapSpace);ba=new T.VertexArrayObject(ha,M.attributeLocations,{data:ba,componentIndices:S},{data:ma,componentIndices:ja},fa);oa=new v.RenderGeometry(ba,W.PrimitiveType.TRIANGLES,oa,null!=fa);return new A.Renderable(ea,oa,{cameraDepthSquared:.5,gpuMemoryEstimate:ma.byteLength+ja.byteLength+(null!=fa?fa.byteLength:0)})};Z._notifyDirty=
function(){this._renderManager.notifyDirty()};b._createClass(Y,[{key:"visibleObjects",get:function(){return this._objects[x.State.Visible]}}]);return Y}();const S=t.glLayout(w.newLayout().u16(O.VertexAttribute.COMPONENTINDEX)),U=d.create(),V=g.create(),X=g.create();a.ComponentObjectCollection=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../ViewingMode ./dito".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){function m(G=[0,0,0],L=[-1,-1,-1],O=q.create()){return{center:f.clone(G),halfSize:d.clone(L),quaternion:u.clone(O)}}function t(G,L){const O=z.signedDistance(L,G.center);G=w(G,z.normal(L));return O>G?1:O<-G?-1:0}function w(G,L){p.conjugate(r,G.quaternion);k.transformQuat(x,L,r);G=G.halfSize;return Math.abs(x[0]*G[0])+Math.abs(x[1]*G[1])+Math.abs(x[2]*G[2])}const r=q.create(),x=f.create(),D=f.create(),A=e.create(),v=y.create();b=b._createClass(function(G){this.buffer=
new ArrayBuffer(56*G);this.obbs=Array(G);for(let L=0;L<G;L++)this.obbs[L]={center:f.createView(this.buffer,56*L),halfSize:d.createView(this.buffer,56*L+24),quaternion:u.createView(this.buffer,56*L+36)}});const B=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],C=(()=>{const G=new Int8Array(162);let L=0;const O=I=>{for(let H=0;H<I.length;H++)G[L+H]=I[H];L+=6};O([6,2,3,1,5,4]);O([0,2,3,1,5,4]);O([0,2,3,7,5,4]);O([0,1,3,2,6,4]);O([0,1,3,2,0,0]);O([0,1,5,7,3,2]);O([0,1,3,7,6,4]);O([0,1,3,7,6,2]);O([0,1,5,7,6,2]);
O([0,1,5,4,6,2]);O([0,1,5,4,0,0]);O([0,1,3,7,5,4]);O([0,2,6,4,0,0]);O([0,0,0,0,0,0]);O([1,3,7,5,0,0]);O([2,3,7,6,4,0]);O([2,3,7,6,0,0]);O([2,3,1,5,7,6]);O([0,1,5,7,6,2]);O([0,1,5,7,6,4]);O([0,1,3,7,6,4]);O([4,5,7,6,2,0]);O([4,5,7,6,0,0]);O([4,5,1,3,7,6]);O([0,2,3,7,5,4]);O([6,2,3,7,5,4]);O([6,2,3,1,5,4]);return G})(),E=f.create(),F=f.create(),M=f.create(),K=q.create();a.ObbArray=b;a.clone=function(G){return m(G.center,G.halfSize,G.quaternion)};a.compute=function(G,L){L=L||m();l.computeOBB(G,L);return L};
a.computeOffsetObb=function(G,L,O,I,H){p.copy(H.quaternion,G.quaternion);if(I===n.ViewingMode.Global){p.conjugate(K,G.quaternion);k.transformQuat(E,G.center,K);k.abs(F,E);k.min(M,F,G.halfSize);k.sub(M,F,M);I=k.length(M);k.add(M,F,G.halfSize);const J=k.length(M);I<O?(k.copy(H.center,G.center),k.set(E,O,O,O),k.add(H.halfSize,G.halfSize,E)):(L=0<J?1+L/J:1,I=0<I?1+O/I:1,O=(I+L)/2,L=(I-L)/2,k.scale(H.halfSize,F,L),k.scaleAndAdd(H.halfSize,H.halfSize,G.halfSize,O),k.scale(H.center,F,O),k.scaleAndAdd(H.center,
H.center,G.halfSize,L),k.sign(E,E),k.multiply(H.center,H.center,E),k.transformQuat(H.center,H.center,H.quaternion))}else I=k.set(E,0,0,1),k.scaleAndAdd(H.center,G.center,I,(O+L)/2),p.conjugate(K,G.quaternion),k.transformQuat(I,I,K),k.abs(I,I),k.scaleAndAdd(H.halfSize,G.halfSize,I,(O-L)/2);return H};a.corners=function(G,L){for(let O=0;8>O;++O){const I=L[O];I[0]=O&1?-G.halfSize[0]:G.halfSize[0];I[1]=O&2?-G.halfSize[1]:G.halfSize[1];I[2]=O&4?-G.halfSize[2]:G.halfSize[2];k.transformQuat(I,I,G.quaternion);
k.add(I,I,G.center)}};a.create=m;a.intersectLine=function(G,L,O,I=0){p.conjugate(r,G.quaternion);k.subtract(x,L,G.center);L=k.transformQuat(x,x,r);O=k.transformQuat(D,O,r);let H=-Infinity,J=Infinity;for(let N=0;3>N;N++)if(1E-6<Math.abs(O[N])){const R=(I+G.halfSize[N]-L[N])/O[N],W=(-I-G.halfSize[N]-L[N])/O[N];H=Math.max(H,Math.min(R,W));J=Math.min(J,Math.max(R,W))}else if(L[N]>G.halfSize[N]+I||L[N]<-G.halfSize[N]-I)return!1;return H<=J};a.intersectPlane=t;a.intersectSphere=function(G,L){x[0]=G.center[0]-
L[0];x[1]=G.center[1]-L[1];x[2]=G.center[2]-L[2];p.conjugate(r,G.quaternion);k.transformQuat(x,x,r);k.abs(x,x);k.min(D,x,G.halfSize);return k.sqrDist(D,x)<L[3]*L[3]};a.isVisible=function(G,L){return 0>=t(G,L[0])&&0>=t(G,L[1])&&0>=t(G,L[2])&&0>=t(G,L[3])&&0>=t(G,L[4])&&0>=t(G,L[5])};a.maximumDistancePlane=function(G,L){const O=z.signedDistance(L,G.center);G=w(G,z.normal(L));return O+G};a.minimumDistancePlane=function(G,L){const O=z.signedDistance(L,G.center);G=w(G,z.normal(L));return O-G};a.projectedArea=
function(G,L,O,I,H){p.conjugate(r,G.quaternion);k.sub(x,L,G.center);k.transformQuat(x,x,r);var J=x[0]<-G.halfSize[0]?-1:x[0]>G.halfSize[0]?1:0,N=x[1]<-G.halfSize[1]?-1:x[1]>G.halfSize[1]?1:0,R=x[2]<-G.halfSize[2]?-1:x[2]>G.halfSize[2]?1:0;L=Math.abs(J)+Math.abs(N)+Math.abs(R);if(0===L)return Infinity;L=1===L?4:6;J=6*(J+3*N+9*R+13);c.fromQuat(v,G.quaternion);c.scale(v,v,G.halfSize);for(N=0;N<L;N++)R=C[J+N],k.set(x,((R&1)<<1)-1,(R&2)-1,((R&4)>>1)-1),k.transformMat3(x,x,v),k.add(A,G.center,x),A[3]=1,
g.transformMat4(A,A,O),R=1/Math.max(1E-6,A[3]),B[2*N]=A[0]*R,B[2*N+1]=A[1]*R;G=2*L-2;O=B[0]*(B[3]-B[G+1])+B[G]*(B[1]-B[G-1]);for(L=2;L<G;L+=2)O+=B[L]*(B[L+3]-B[L-1]);return Math.abs(O)*I*H*.125};a.projectedRadius=w;a.radius=function(G){return k.len(G.halfSize)};a.set=function(G,L){k.copy(L.center,G.center);k.copy(L.halfSize,G.halfSize);p.copy(L.quaternion,G.quaternion)};a.toAaBoundingBox=function(G,L){L||(L=h.create());var O=c.fromQuat(v,G.quaternion);const I=G.halfSize[0]*Math.abs(O[0])+G.halfSize[1]*
Math.abs(O[3])+G.halfSize[2]*Math.abs(O[6]),H=G.halfSize[0]*Math.abs(O[1])+G.halfSize[1]*Math.abs(O[4])+G.halfSize[2]*Math.abs(O[7]);O=G.halfSize[0]*Math.abs(O[2])+G.halfSize[1]*Math.abs(O[5])+G.halfSize[2]*Math.abs(O[8]);L[0]=G.center[0]-I;L[1]=G.center[1]-H;L[2]=G.center[2]-O;L[3]=G.center[0]+I;L[4]=G.center[1]+H;L[5]=G.center[2]+O;return L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const q=new Float32Array(4);
q[3]=1;return q}function c(q){const k=new Float32Array(4);k[0]=q[0];k[1]=q[1];k[2]=q[2];k[3]=q[3];return k}function y(q,k,d,f){const g=new Float32Array(4);g[0]=q;g[1]=k;g[2]=d;g[3]=f;return g}function p(q,k){return new Float32Array(q,k,4)}const u=Object.freeze(Object.defineProperty({__proto__:null,clone:c,create:b,createView:p,fromValues:y},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=p;a.fromValues=y;a.quatf32=u})},"esri/views/3d/support/dito":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Attribute"],function(a,b,c){function y(Y,Z,ea,ja,ha,ia){if(!(1E-6>Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]))for(z(M,ea,Z),z(K,ja,Z),z(G,ha,Z),p(Y,Z,F),O[1]=F[0],L[1]=F[1],I[1]=L[1]-O[1],ea=[ea,ja,ha],ja=[M,K,G],ha=0;3>ha;++ha){p(Y,ea[ha],F);O[0]=F[0];L[0]=F[1];p(Y,ja[ha],F);O[2]=F[0];L[2]=F[1];I[0]=L[0]-O[0];I[2]=L[2]-O[2];const oa=d(I);oa<ia.quality&&(h(ia.b0,ea[ha]),h(ia.b1,Z),h(ia.b2,ja[ha]),ia.quality=oa)}}function p(Y,Z,ea){const {data:ja,
size:ha}=Y;ea[0]=Number.POSITIVE_INFINITY;ea[1]=Number.NEGATIVE_INFINITY;for(Y=0;Y<ja.length;Y+=ha){const ia=ja[Y]*Z[0]+ja[Y+1]*Z[1]+ja[Y+2]*Z[2];ea[0]=Math.min(ea[0],ia);ea[1]=Math.max(ea[1],ia)}}function u(Y,Z,ea){h(ea.center,Y);e(ea.halfSize,Z,.5);ea.quaternion[0]=0;ea.quaternion[1]=0;ea.quaternion[2]=0;ea.quaternion[3]=1}function q(Y,Z,ea,ja,ha,ia){p(Y,Z,F);ha[0]=F[0];ia[0]=F[1];p(Y,ea,F);ha[1]=F[0];ia[1]=F[1];p(Y,ja,F);ha[2]=F[0];ia[2]=F[1]}function k(Y,Z,ea,ja,ha,ia,oa){S[0]=Y[0];S[1]=Y[1];
S[2]=Y[2];S[3]=Z[0];S[4]=Z[1];S[5]=Z[2];S[6]=ea[0];S[7]=ea[1];S[8]=ea[2];var ma=oa.quaternion,fa=S,ba=fa[0]+fa[4]+fa[8];if(0<ba)ba=Math.sqrt(ba+1),ma[3]=.5*ba,ba=.5/ba,ma[0]=(fa[5]-fa[7])*ba,ma[1]=(fa[6]-fa[2])*ba,ma[2]=(fa[1]-fa[3])*ba;else{ba=0;fa[4]>fa[0]&&(ba=1);fa[8]>fa[3*ba+ba]&&(ba=2);const aa=(ba+1)%3,da=(ba+2)%3;let ca=Math.sqrt(fa[3*ba+ba]-fa[3*aa+aa]-fa[3*da+da]+1);ma[ba]=.5*ca;ca=.5/ca;ma[3]=(fa[3*aa+da]-fa[3*da+aa])*ca;ma[aa]=(fa[3*aa+ba]+fa[3*ba+aa])*ca;ma[da]=(fa[3*da+ba]+fa[3*ba+da])*
ca}f(U,ja,ha);e(U,U,.5);e(oa.center,Y,U[0]);e(Q,Z,U[1]);f(oa.center,oa.center,Q);e(Q,ea,U[2]);f(oa.center,oa.center,Q);e(oa.halfSize,ia,.5)}function d(Y){return Y[0]*Y[1]+Y[0]*Y[2]+Y[1]*Y[2]}function f(Y,Z,ea){Y[0]=Z[0]+ea[0];Y[1]=Z[1]+ea[1];Y[2]=Z[2]+ea[2]}function g(Y,Z,ea){Y[0]=Z[0]-ea[0];Y[1]=Z[1]-ea[1];Y[2]=Z[2]-ea[2]}function e(Y,Z,ea){Y[0]=Z[0]*ea;Y[1]=Z[1]*ea;Y[2]=Z[2]*ea}function h(Y,Z,ea=0){Y[0]=Z[ea];Y[1]=Z[ea+1];Y[2]=Z[ea+2]}function z(Y,Z,ea){const ja=Z[0],ha=Z[1];Z=Z[2];const ia=ea[0],
oa=ea[1];ea=ea[2];Y[0]=ha*ea-Z*oa;Y[1]=Z*ia-ja*ea;Y[2]=ja*oa-ha*ia}function n(Y,Z){var ea=Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2];0<ea&&(ea=1/Math.sqrt(ea),Y[0]=Z[0]*ea,Y[1]=Z[1]*ea,Y[2]=Z[2]*ea)}function l(Y,Z){const ea=Z[0]-Y[0],ja=Z[1]-Y[1];Y=Z[2]-Y[2];return ea*ea+ja*ja+Y*Y}const m=[0,0,0],t=[0,0,0],w=[0,0,0],r=[0,0,0],x=[0,0,0],D=[0,0,0],A=[0,0,0],v=[0,0,0],B=[0,0,0],C=[0,0,0],E=[0,0,0],F=[0,0],M=[0,0,0],K=[0,0,0],G=[0,0,0],L=[0,0,0],O=[0,0,0],I=[0,0,0],H=[0,0,0],J=[0,0,0],N=[0,0,0],R=[0,0,0],W=[0,0,0],
T=[0,0,0],P=[0,0,0],Q=[0,0,0],S=[1,0,0,0,1,0,0,0,1],U=[0,0,0];let V=b._createClass(function(Y){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var Z=0;this.minProj=new Float64Array(this.buffer,Z,7);Z+=56;this.maxProj=new Float64Array(this.buffer,Z,7);Z+=56;for(var ea=0;7>ea;++ea)this.minVert[ea]=new Float64Array(this.buffer,Z,3),Z+=24;for(ea=0;7>ea;++ea)this.maxVert[ea]=new Float64Array(this.buffer,Z,3),Z+=24;for(Z=0;7>Z;++Z)this.minProj[Z]=Number.POSITIVE_INFINITY,this.maxProj[Z]=
Number.NEGATIVE_INFINITY;Z=Array(7);ea=Array(7);const {data:ja,size:ha}=Y;for(Y=0;Y<ja.length;Y+=ha){var ia=ja[Y];ia<this.minProj[0]&&(this.minProj[0]=ia,Z[0]=Y);ia>this.maxProj[0]&&(this.maxProj[0]=ia,ea[0]=Y);ia=ja[Y+1];ia<this.minProj[1]&&(this.minProj[1]=ia,Z[1]=Y);ia>this.maxProj[1]&&(this.maxProj[1]=ia,ea[1]=Y);ia=ja[Y+2];ia<this.minProj[2]&&(this.minProj[2]=ia,Z[2]=Y);ia>this.maxProj[2]&&(this.maxProj[2]=ia,ea[2]=Y);ia=ja[Y]+ja[Y+1]+ja[Y+2];ia<this.minProj[3]&&(this.minProj[3]=ia,Z[3]=Y);ia>
this.maxProj[3]&&(this.maxProj[3]=ia,ea[3]=Y);ia=ja[Y]+ja[Y+1]-ja[Y+2];ia<this.minProj[4]&&(this.minProj[4]=ia,Z[4]=Y);ia>this.maxProj[4]&&(this.maxProj[4]=ia,ea[4]=Y);ia=ja[Y]-ja[Y+1]+ja[Y+2];ia<this.minProj[5]&&(this.minProj[5]=ia,Z[5]=Y);ia>this.maxProj[5]&&(this.maxProj[5]=ia,ea[5]=Y);ia=ja[Y]-ja[Y+1]-ja[Y+2];ia<this.minProj[6]&&(this.minProj[6]=ia,Z[6]=Y);ia>this.maxProj[6]&&(this.maxProj[6]=ia,ea[6]=Y)}for(Y=0;7>Y;++Y)ia=Z[Y],h(this.minVert[Y],ja,ia),ia=ea[Y],h(this.maxVert[Y],ja,ia)}),X=b._createClass(function(){this.b0=
[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0});a.computeOBB=function(Y,Z){const {data:ea,size:ja}=Y;var ha=ea.length/ja;if(!(0>=ha)){var ia=new V(Y);f(m,ia.minProj,ia.maxProj);e(m,m,.5);g(t,ia.maxProj,ia.minProj);var oa=d(t),ma=new X;ma.quality=oa;14>ha&&(Y=new c.Attribute(new Float64Array(ia.buffer,112,42),3));var fa=[0,0,0],ba=[0,0,0],aa=[0,0,0];ha=[0,0,0];var da=[0,0,0],ca=[0,0,0],na=[0,0,0];var qa=Y;var ua=l(ia.maxVert[0],ia.minVert[0]),sa=0;for(var pa=1;7>pa;++pa){const va=l(ia.maxVert[pa],
ia.minVert[pa]);va>ua&&(ua=va,sa=pa)}h(fa,ia.minVert[sa]);h(ba,ia.maxVert[sa]);if(1E-6>l(fa,ba))qa=1;else{g(ha,fa,ba);n(ha,ha);const {data:va,size:Ca}=qa;ia=Number.NEGATIVE_INFINITY;ua=0;for(sa=0;sa<va.length;sa+=Ca)E[0]=va[sa]-fa[0],E[1]=va[sa+1]-fa[1],E[2]=va[sa+2]-fa[2],pa=ha[0]*E[0]+ha[1]*E[1]+ha[2]*E[2],pa=E[0]*E[0]+E[1]*E[1]+E[2]*E[2]-pa*pa/(ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2]),pa>ia&&(ia=pa,ua=sa);h(aa,va,ua);1E-6>ia?qa=2:(g(da,ba,aa),n(da,da),g(ca,aa,fa),n(ca,ca),z(na,da,ha),n(na,na),y(qa,
na,ha,da,ca,ma),qa=0)}switch(qa){case 1:u(m,t,Z);return;case 2:oa=Y;h(J,ha);Math.abs(ha[0])>Math.abs(ha[1])&&Math.abs(ha[0])>Math.abs(ha[2])?J[0]=0:Math.abs(ha[1])>Math.abs(ha[2])?J[1]=0:J[2]=0;1E-6>J[0]*J[0]+J[1]*J[1]+J[2]*J[2]&&(J[0]=J[1]=J[2]=1);z(N,ha,J);n(N,N);z(R,ha,N);n(R,R);q(oa,ha,N,R,W,T);g(P,T,W);k(ha,N,R,W,T,P,Z);return}qa=Y;ia=F;const {data:ka,size:ra}=qa;h(r,ka);h(w,r);ia[0]=H[0]*na[0]+H[1]*na[1]+H[2]*na[2];ia[1]=ia[0];for(ua=ra;ua<ka.length;ua+=ra)sa=ka[ua]*na[0]+ka[ua+1]*na[1]+ka[ua+
2]*na[2],sa<ia[0]&&(ia[0]=sa,h(r,ka,ua)),sa>ia[1]&&(ia[1]=sa,h(w,ka,ua));na=fa[0]*na[0]+fa[1]*na[1]+fa[2]*na[2];F[1]-1E-6<=na&&(w[0]=void 0);F[0]+1E-6>=na&&(r[0]=void 0);void 0!==w[0]&&(g(x,w,fa),n(x,x),g(D,w,ba),n(D,D),g(A,w,aa),n(A,A),z(v,D,ha),n(v,v),z(B,A,da),n(B,B),z(C,x,ca),n(C,C),y(qa,v,ha,D,x,ma),y(qa,B,da,A,D,ma),y(qa,C,ca,x,A,ma));void 0!==r[0]&&(g(x,r,fa),n(x,x),g(D,r,ba),n(D,D),g(A,r,aa),n(A,A),z(v,D,ha),n(v,v),z(B,A,da),n(B,B),z(C,x,ca),n(C,C),y(qa,v,ha,D,x,ma),y(qa,B,da,A,D,ma),y(qa,
C,ca,x,A,ma));q(Y,ma.b0,ma.b1,ma.b2,W,T);Y=[0,0,0];g(Y,T,W);ma.quality=d(Y);ma.quality<oa?k(ma.b0,ma.b1,ma.b2,W,T,Y,Z):u(m,t,Z)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","./IndexRange/ComponentRangeRunLengthEncoded"],function(a,b){function c(y,p,u){const q=[],k=[];let d=u.length,f=u.length;p.forEachComponent(g=>{0<y[g]?(d!==g-1&&(q.length&&q.push(u[d+
1]-q[q.length-1]),q.push(u[g])),d=g):(f!==g-1&&(k.length&&k.push(u[f+1]-k[k.length-1]),k.push(u[g])),f=g);return!0});q.length&&q.push(u[d+1]-q[q.length-1]);k.length&&k.push(u[f+1]-k[k.length-1]);return{highlightRanges:q,defaultRanges:k}}return function(){function y(u,q){this.offsets=q;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;q=this.count;this.visibility=new b.ComponentRangeRunLengthEncoded(q);this.materialDataBuffer=
u.getBuffer(q);this.materialDataIndices=new Uint16Array(q);for(u=0;u<q;u++)this.materialDataIndices[u]=this.materialDataBuffer.acquireIndex()}var p=y.prototype;p.destroy=function(){for(let u=0;u<this.count;u++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[u])};p.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};p.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};p._updateCachedHighlightRanges=function(){if((null==this.cachedHighlightRanges||
null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const {highlightRanges:u,defaultRanges:q}=c(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=u;this.cachedDefaultRanges=q}};a._createClass(y,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(null==
this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(null==this.highlightCounts)return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return y}()})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._totalCount=
u;this._indexRanges=[0,u]}var p=y.prototype;p.allVisible=function(){return this.componentCount()===this._totalCount};p.allInvisible=function(){return 0===this._indexRanges.length};p.componentCount=function(){const u=this._indexRanges;let q=0;for(let k=0;k<u.length;k+=2)q+=u[k+1];return q};p.reset=function(u){if("all"===u||u.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const d=[];if(0!==u.length){var q=u[0],k=1;for(let f=1;f<u.length;f++){const g=u[f];q+k===g?k+=1:(d.push(q),
d.push(k),q=g,k=1)}d.push(q);d.push(k)}u=d}this._indexRanges=u}};p.forEachComponent=function(u){const q=this._indexRanges;for(let d=0;d<q.length;d+=2){var k=q[d];const f=k+q[d+1];for(;k<f;k++)if(!u(k))return!1}return!0};p.forEachComponentRange=function(u){const q=this._indexRanges;for(let k=0;k<q.length;k+=2){const d=q[k];if(!u(d,d+q[k+1]))return!1}return!0};p.computeOffsetRanges=function(u){const q=Array(this._indexRanges.length),k=this._indexRanges;for(let f=0;f<k.length;f+=2){var d=k[f];const g=
u[d];d=u[d+k[f+1]];q[f]=g;q[f+1]=d-g}return q};return b._createClass(y)}();a.ComponentRangeRunLengthEncoded=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){a.ComponentObject=function(f){function g(){var e=f.apply(this,arguments)||this;e.visible=a.State.Hidden;return e}b._inherits(g,f);return b._createClass(g)}(y);c.__decorate([p.property({autoDestroy:!0})],a.ComponentObject.prototype,"renderable",void 0);c.__decorate([p.property({autoDestroy:!0})],a.ComponentObject.prototype,"components",void 0);a.ComponentObject=c.__decorate([d.subclass("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],a.ComponentObject);
a.State=void 0;(function(f){f[f.Hidden=0]="Hidden";f[f.Visible=1]="Visible"})(a.State||(a.State={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f){let g=function(){function z(l,m){this._components=m;this._indices=null!=l.indices?u.compactIndices(l.indices):u.getContinuousIndexArray(l.positions.length/3);this._positions=l.positions;this._componentIntersectionData=Array(m.count)}var n=z.prototype;n.getComponentAabb=function(l,m){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let t=0;6>t;t++)m[t]=this._perComponentAabbs[6*l+t];return m};n.getComponentPositions=function(l,m){m.indices=
this._indices;m.data=this._positions;m.stride=3;m.startIndex=this._components.offsets[l];m.endIndex=this._components.offsets[l+1]};n.intersect=function(l,m,t,w,r,x,D){const A=new k.Attribute(this._positions,3,!1,3),v=this._indices,B=this._components.offsets,C=f.computeInvDir(l,m,e),E=l[2],F=m[2];this._components.visibility.forEachComponent(M=>{if(!d.getVisibility(this._components.pickability,M))return!0;var K=this.getComponentAabb(M,h);if(null!=x){var G=x[M];null!=r?r.componentOffset=G:(l[2]=E-G,
m[2]=F-G)}null!=r&&r.applyToAabb(K);if(!f.intersectAabbInvDir(K,l,C,t))return!0;K=B[M]/3;G=B[M+1]/3;const L=(O,I,H)=>D(M,O,b.transformMat3(I,I,w),H);null==r&&G-K>q.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[M]&&(this._componentIntersectionData[M]=new q.ComponentIntersectionData(this._indices,K,G,A)),this._componentIntersectionData[M].intersectRay({r0:l,r1:m},L)):f.intersectTriangles(l,m,K,G,v,A,void 0,r,L);return!0})};n._computePerComponentAabbs=function(){const l=
this._components.count,m=p.newFloatArray(6*l),t=this._indices,w=this._positions,r=this._components.offsets;let x=0;for(let v=0;v<l;v++){var D=r[v];const B=r[v+1];let C=Infinity,E=Infinity,F=Infinity,M=-Infinity,K=-Infinity,G=-Infinity;for(;D<B;D++){var A=3*t[D];const L=w[A],O=w[A+1];A=w[A+2];C=Math.min(C,L);E=Math.min(E,O);F=Math.min(F,A);M=Math.max(M,L);K=Math.max(K,O);G=Math.max(G,A)}m[x++]=C;m[x++]=E;m[x++]=F;m[x++]=M;m[x++]=K;m[x++]=G}return m};a._createClass(z,[{key:"positions",get:function(){return this._positions}},
{key:"indices",get:function(){return this._indices}}]);return z}();const e=c.create(),h=y.create();return g})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(a,b){function c(y=!0){return{isVisibleBit:!y,data:new Uint32Array(0)}}a.defaultVisibilities=c;a.getVisibility=function(y,p){if(null==y)return!0;const {isVisibleBit:u,data:q}=y,k=8*q.BYTES_PER_ELEMENT;return p<q.length*k?(y=p/k|0,0!==(q[y]&1<<p-y*k)===u):!y.isVisibleBit};a.updateVisibilityWithCount=
function(y,p,u,q){if(u>=p)return y;null==y&&(y=c());let k=y.data;const d=8*k.BYTES_PER_ELEMENT,f=u/d|0,g=u-d*f,e=k;q=q===y.isVisibleBit;u<e.length*d||!q||(u=Math.max(f+1,Math.ceil(e.length*b.ReallocGrowthFactor)),u=Math.min(u,((p-1)/d|0)+1),k=new Uint32Array(u),k.set(e));f<k.length&&(k[f]=k[f]&~(1<<g)|(q?1:0)<<g);y.data=k;return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function y(p,u,q){this.material=p;this.geometry=u;this.meta=q}y.prototype.destroy=function(){this.material.dispose();this.geometry.dispose()};return b._createClass(y)}();a.Renderable=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(p,u,q,k){this.vao=p;this.primitiveType=
u;this.parameters=q;this.indexed=k}y.prototype.dispose=function(){this.vao.dispose()};return b._createClass(y)}();a.RenderGeometry=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./DepthRange"],function(a,b,c){let y=function(){function p(q){this._objects=q}var u=p.prototype;u.submit=function(q,k){this._objects.preSubmit(k);this._objects.visibleObjects.forAll(d=>
d.renderable.material.submit(q,k,d))};u.queryShadowCasterDepthRange=function(q){return this._objects.visibleObjects.length?c.computeDepthRange(q,this._objects.visibleObjects):null};return b._createClass(p)}();a.RenderSubmitSystem=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(K,G,L){return k.set(K,G.data[L],G.data[L+1],G.data[L+2])}function z(K,G){K.push(G[0]);K.push(G[1]);K.push(G[2])}function n(K,G,L,O){u.conjugate(v,K.quaternion);k.sub(B,G,K.center);k.transformQuat(B,B,v);const I=8*((B[0]<-K.halfSize[0]?-1:B[0]>K.halfSize[0]?1:0)+3*(B[1]<-K.halfSize[1]?-1:B[1]>K.halfSize[1]?1:0)+9*(B[2]<-K.halfSize[2]?-1:B[2]>K.halfSize[2]?1:0)+13);G=D[I];if(0===G)return G;y.fromQuat(A,K.quaternion);y.scale(A,A,K.halfSize);const H=(J,N)=>
{N=D[I+N+1];k.set(J,((N&1)<<1)-1,(N&2)-1,((N&4)>>1)-1);k.transformMat3(J,J,A);return k.add(J,K.center,J)};L.length=0;z(L,H(C,0));z(L,H(E,1));z(L,H(B,2));z(L,H(F,3));O(L);if(1===G)return G;L.length=0;z(L,C);z(L,F);z(L,H(B,4));z(L,H(M,5));O(L);if(2===G)return G;L.length=0;z(L,C);z(L,M);z(L,H(B,6));z(L,E);O(L);return G}const l=new c({allocator:K=>K||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:K=>{K.object=b.nullifyNonNullableForDispose(K.object);return K}}),m=e.empty(),t=d.create(),
w=d.create(),r=new c({deallocator:null}),x=new c({deallocator:null}),D=(()=>{const K=Array(216);let G=0;const L=O=>{for(let I=0;I<O.length;I++)K[G+I]=O[I];G+=8};L([3,0,6,2,3,1,5,4]);L([2,0,2,3,1,5,4,0]);L([3,1,0,2,3,7,5,4]);L([2,0,1,3,2,6,4,0]);L([1,0,1,3,2,0,0,0]);L([2,1,5,7,3,2,0,0]);L([3,2,0,1,3,7,6,4]);L([2,2,0,1,3,7,6,0]);L([3,3,0,1,5,7,6,2]);L([2,0,1,5,4,6,2,0]);L([1,0,1,5,4,0,0,0]);L([2,1,3,7,5,4,0,0]);L([1,0,2,6,4,0,0,0]);L([0,0,0,0,0,0,0,0]);L([1,1,3,7,5,0,0,0]);L([2,2,3,7,6,4,0,0]);L([1,
2,3,7,6,0,0,0]);L([2,3,1,5,7,6,2,0]);L([3,4,0,1,5,7,6,2]);L([2,5,7,6,4,0,1,0]);L([3,5,0,1,3,7,6,4]);L([2,4,5,7,6,2,0,0]);L([1,4,5,7,6,0,0,0]);L([2,5,1,3,7,6,4,0]);L([3,6,0,2,3,7,5,4]);L([2,6,2,3,7,5,4,0]);L([3,7,6,2,3,1,5,4]);return K})(),A=p.create(),v=q.create(),B=d.create(),C=d.create(),E=d.create(),F=d.create(),M=d.create();a.computeDepthRange=function(K,G){const L=e.empty(),{eye:O,frustum:I,viewForward:H}=K;G.forAll(J=>{var N=null!=J.offsetObb?J.offsetObb:J.obb;const R=k.dot(k.sub(B,N.center,
O),H),W=g.projectedRadius(N,H);if(!e.within(L,R-W)||!e.within(L,R+W)){a:{var T=0;for(let P=0;4>P;P++){const Q=g.intersectPlane(N,I[P]);if(0<Q){N=-1;break a}0===Q&&(T|=1<<P)}N=T}-1!==N&&(0===N?(m.far=R+W,m.near=R-W,e.union(L,m)):(T=l.pushNew(),T.near=R-W,T.far=R+W,T.mask=N,T.object=J))}});for(K=0;K<l.length;K++){const J=l.data[K];e.within(L,J.near)&&e.within(L,J.far)||(m.far=J.far,m.near=Infinity,0===n(null!=J.object.offsetObb?J.object.offsetObb:J.object.obb,O,r,N=>{var R=x;for(var W=0;4>W&&0<N.length;W++){if(0===
(J.mask&1<<W))continue;var T=I[W],P=N,Q=R;Q.length=0;const S=P.length-3;h(t,P,S);const U=f.signedDistance(T,t);0>=U&&(Q.push(t[0]),Q.push(t[1]),Q.push(t[2]));let V=0,X=U;for(V;V<S;V+=3){h(w,P,V);const Y=f.signedDistance(T,w);0>X*Y&&(k.lerp(t,w,t,Y/(Y-X)),z(Q,t));0>=Y&&z(Q,w);X=Y;k.copy(t,w)}0>X*U&&(h(w,P,S),k.lerp(t,w,t,U/(U-X)),z(Q,t));T=N;N=R;R=T}for(R=0;R<N.length;R+=3)k.set(t,N.data[R],N.data[R+1],N.data[R+2]),W=k.dot(k.sub(t,t,O),H),m.near=Math.min(m.near,W)})&&(m.near=0),e.union(L,m))}l.length=
0;return L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(p,u){return{near:p,far:u}}function y(p,u,q){p.near=u;p.far=q;return p}b=b._createClass(function(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE});a.DepthRange=b;a.ZERO={near:0,far:0};a.create=c;a.empty=function(p){return p?y(p,Infinity,-Infinity):c(Infinity,-Infinity)};a.set=
y;a.union=function(p,u,q=p){null!=u&&(q.near=Math.min(p.near,u.near),q.far=Math.max(p.far,u.far));return q};a.within=function(p,u){return p.near<=u&&u<=p.far};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,y){a.createVertexBufferLayout=
function(p){const u=b.newLayout().vec3f(y.VertexAttribute.POSITION);p.normals&&u.vec2i16(y.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});p.textureCoordinates===c.TextureCoordinateAttributeType.Default?u.vec2f(y.VertexAttribute.UV0):p.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(u.vec2f(y.VertexAttribute.UV0),u.vec4u16(y.VertexAttribute.UVREGION,{glNormalized:!0}));p.colors&&u.vec4u8(y.VertexAttribute.COLOR,{glNormalized:!0});return u};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec4f64","../../../layers/support/symbolColorUtils"],function(a,b,c,y){b=b._createClass(function(){this.externalColor=c.create();this.externalColorMixMode=y.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0});a.UniformComponentParameters=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType ../../../materials/pbrUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){let G=function(H){function J(R,W){var T=H.call(this)||this;T.toMapSpace=W;T.baseColor=g.fromValues(1,1,1,1);T.usePBR=!1;T.hasParametersFromSource=!1;T.mrrFactors=d.fromArray(K.defaultAdvancedMRRFactors);T.emissiveFactor=d.fromValues(0,0,0);T.baseColorTexture=null;T.metallicRoughnessTexture=null;T.emissionTexture=null;T.occlusionTexture=null;T.normalTexture=null;T.objectOpacity=1;T.commonMaterialParameters=new O;T.componentParameters=
new I;T.textureAlphaCutoff=B.defaultMaskAlphaCutoff;T.alphaDiscardMode=F.AlphaDiscardMode.Opaque;T.isIntegratedMesh=!1;T.polygonOffsetEnabled=!1;T.ellipsoidMode=C.EllipsoidMode.Earth;T.hasOccludees=!1;T._techniqueConfiguration=new n.ComponentTechniqueConfiguration;W=new E.TwoVectorPosition(R.position);const P=u.clone(R.rotationScale);p.invert(P,P);T.transformNormalGlobalFromModel=q.clone(p.transpose(P,P));T.transformWorldFromModelTL=W.low;T.transformWorldFromModelTH=W.high;T.transformWorldFromModelRS=
R.rotationScale;return T}b._inherits(J,H);var N=J.prototype;N.dispose=function(){this._technique=y.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};N.prepareTechnique=function(R,W,T,P){const Q=this._techniqueConfiguration;Q.hasVertexColors=P.colors;Q.hasNormals=P.normals;Q.textureCoordinateType=P.textureCoordinates;Q.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;Q.hasEmissionTexture=
null!=this.emissionTexture;Q.hasOcclusionTexture=null!=this.occlusionTexture;Q.hasNormalTexture=null!=this.normalTexture;Q.transparencyPassType=W.identifier===r.RenderPassIdentifier.Material&&null!=T.transparencyPassType?T.transparencyPassType:M.TransparencyPassType.NONE;Q.hasMultipassTerrain=W.identifier===r.RenderPassIdentifier.Material&&null!=T.multipassTerrain?T.multipassTerrain.enabled:!1;Q.cullAboveGround=W.identifier===r.RenderPassIdentifier.Material&&null!=T.multipassTerrain?T.multipassTerrain.cullAboveGround:
!1;Q.ellipsoidMode=this.ellipsoidMode;Q.componentData=this.componentParameters.type;Q.cullFace=this.commonMaterialParameters.cullFace;Q.doubleSidedMode=this.commonMaterialParameters.doubleSided?A.NormalsDoubleSidedMode.View:A.NormalsDoubleSidedMode.None;Q.hasBaseColorTexture=null!=this.baseColorTexture;P=this._computeWhichMaterialPass();Q.blendingEnabled=P===L.Transparent||P===L.OpaqueAndTransparent;Q.alphaDiscardMode=this.alphaDiscardMode;Q.integratedMeshMode=this.isIntegratedMesh?(0===T.overlays.length?
0:null!=T.overlays[h.OverlayIndex.INNER].getColorTextureNoRasterImage())?m.getOverlayNormalTexture(T)?n.IntegratedMeshMode.ColorOverlayWithWater:n.IntegratedMeshMode.ColorOverlay:n.IntegratedMeshMode.NoOverlay:n.IntegratedMeshMode.None;Q.hasPolygonOffset=this.polygonOffsetEnabled;P=this.hasParametersFromSource&&null==this.baseColorTexture;Q.pbrMode=Q.integratedMeshMode===n.IntegratedMeshMode.ColorOverlayWithWater?v.PBRMode.WaterOnIntegratedMesh:this.usePBR?P?v.PBRMode.Schematic:v.PBRMode.Normal:v.PBRMode.Disabled;
Q.normalType=Q.integratedMeshMode===n.IntegratedMeshMode.None?Q.hasNormals?D.NormalType.Compressed:D.NormalType.ScreenDerivative:D.NormalType.Ground;Q.hasSlicePlane=null!=T.slicePlane&&this.commonMaterialParameters.hasSlicePlane;if(W.identifier===r.RenderPassIdentifier.ShadowMap)Q.output=x.ShaderOutput.Shadow,Q.vertexDiscardMode=t.VertexDiscardMode.None;else if(W.identifier===r.RenderPassIdentifier.Highlight)Q.output=x.ShaderOutput.Highlight,Q.vertexDiscardMode=t.VertexDiscardMode.None;else{this._computeWhichMaterialPass()===
L.OpaqueAndTransparent?Q.vertexDiscardMode=W.transparent?t.VertexDiscardMode.Opaque:t.VertexDiscardMode.Transparent:Q.vertexDiscardMode=t.VertexDiscardMode.None;Q.output=W.output;Q.receiveAmbientOcclusion=!1;Q.receiveShadows=!1;switch(W.output){case x.ShaderOutput.Color:Q.receiveAmbientOcclusion=T.ssaoHelper.active;Q.hasOccludees=T.hasOccludees;Q.receiveShadows=T.shadowMap.ready;Q.hasScreenSpaceReflections=T.ssr.enabled;Q.hasCloudsReflections=null!=T.cloudsFade.data;break;case x.ShaderOutput.Alpha:Q.hasOccludees=
T.hasOccludees;break;case x.ShaderOutput.ObjectAndLayerIdColor:Q.objectAndLayerIdColor=!0}Q.snowCover=this.hasSnowCover(T)}this._technique=R.releaseAndAcquire(z.ComponentTechnique,Q,this._technique);this._setClean();return this._technique};N.hasSnowCover=function(R){return null!=R.weather&&R.weatherVisible&&"snowy"===R.weather.type&&"enabled"===R.weather.snowCover};N.submit=function(R,W,T){if(0!==this.objectOpacity){var P=T.renderable.geometry,Q=T.components;T=T.renderable.meta.cameraDepthSquared;
var S=Q.geometryRanges,U=Q.highlightRanges;Q=Q.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case L.Opaque:R.materialOpaque.submitDraw(this,P,S,T);break;case L.Transparent:R.materialTransparent.submitDraw(this,P,S,T);break;case L.OpaqueAndTransparent:R.materialOpaque.submitDraw(this,P,S,T);R.materialTransparent.submitDraw(this,P,S,T);break;case L.IntegratedMesh:R.materialIntegratedMesh.submitDraw(this,P,S,T),(0===W.overlays.length?0:null!=W.overlays[h.OverlayIndex.INNER].getValidTexture(h.RenderTargetType.Highlight))&&
R.highlightIntegratedMesh.submitDraw(this,P,S,T)}(W=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&R.shadowMap.submitDraw(this,P,S,T);null!=U&&(R.highlight.submitDraw(this,P,U,T),W&&R.highlightShadowMap.submitDraw(this,P,U,T));W&&null!=Q&&R.defaultShadowMap.submitDraw(this,P,Q,T)}};N._computeWhichMaterialPass=function(){return this.isIntegratedMesh?L.IntegratedMesh:1>this.objectOpacity?L.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?
L.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===F.AlphaDiscardMode.Blend||this.alphaDiscardMode===F.AlphaDiscardMode.MaskBlend?L.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?L.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?L.Transparent:L.OpaqueAndTransparent};b._createClass(J,[{key:"texture",get:function(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return null!=
this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return null!=this.emissionTexture?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",get:function(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}},{key:"textureNormal",get:function(){return null!=this.normalTexture?this.normalTexture.glTexture:null}}]);return J}(w.MaterialBase);c.__decorate([w.parameter({vectorOps:f.vec4})],G.prototype,"baseColor",
void 0);c.__decorate([w.parameter()],G.prototype,"usePBR",void 0);c.__decorate([w.parameter()],G.prototype,"hasParametersFromSource",void 0);c.__decorate([w.parameter({vectorOps:k.vec3})],G.prototype,"mrrFactors",void 0);c.__decorate([w.parameter({vectorOps:k.vec3})],G.prototype,"emissiveFactor",void 0);c.__decorate([w.parameter({dispose:!0})],G.prototype,"baseColorTexture",void 0);c.__decorate([w.parameter({dispose:!0})],G.prototype,"metallicRoughnessTexture",void 0);c.__decorate([w.parameter({dispose:!0})],
G.prototype,"emissionTexture",void 0);c.__decorate([w.parameter({dispose:!0})],G.prototype,"occlusionTexture",void 0);c.__decorate([w.parameter({dispose:!0})],G.prototype,"normalTexture",void 0);c.__decorate([w.parameter()],G.prototype,"objectOpacity",void 0);c.__decorate([w.parameterBlock()],G.prototype,"commonMaterialParameters",void 0);c.__decorate([w.parameterBlock()],G.prototype,"componentParameters",void 0);c.__decorate([w.parameter()],G.prototype,"textureAlphaCutoff",void 0);c.__decorate([w.parameter()],
G.prototype,"alphaDiscardMode",void 0);c.__decorate([w.parameter()],G.prototype,"isIntegratedMesh",void 0);c.__decorate([w.parameter()],G.prototype,"polygonOffsetEnabled",void 0);c.__decorate([w.parameter()],G.prototype,"ellipsoidMode",void 0);c.__decorate([w.parameter()],G.prototype,"hasOccludees",void 0);var L;(function(H){H[H.Opaque=0]="Opaque";H[H.Transparent=1]="Transparent";H[H.OpaqueAndTransparent=2]="OpaqueAndTransparent";H[H.IntegratedMesh=3]="IntegratedMesh"})(L||(L={}));let O=function(H){function J(){var N=
H.apply(this,arguments)||this;N.doubleSided=!1;N.cullFace=F.CullFaceOptions.Back;N.hasSlicePlane=!0;return N}b._inherits(J,H);return b._createClass(J)}(w.MaterialParameterBlock);c.__decorate([w.parameter()],O.prototype,"doubleSided",void 0);c.__decorate([w.parameter()],O.prototype,"cullFace",void 0);c.__decorate([w.parameter()],O.prototype,"hasSlicePlane",void 0);let I=function(H){function J(){var N=H.apply(this,arguments)||this;N.externalColor=g.fromValues(1,1,1,1);N.externalColorMixMode=e.ColorMixModeEnum.Multiply;
N.castShadows=a.ComponentParameterSummary.All;return N}b._inherits(J,H);b._createClass(J,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===e.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}},{key:"type",get:function(){return l.ComponentDataType.Uniform}}]);return J}(w.MaterialParameterBlock);c.__decorate([w.parameter({vectorOps:f.vec4})],I.prototype,"externalColor",void 0);c.__decorate([w.parameter()],I.prototype,"externalColorMixMode",void 0);c.__decorate([w.parameter()],I.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(H){H[H.All=0]="All";H[H.Some=1]="Some";H[H.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary=
{}));k=function(H){function J(){var N=H.apply(this,arguments)||this;N.texture=null;N.transparent=a.ComponentParameterSummary.None;N.opaqueOverride=a.ComponentParameterSummary.None;N.castShadows=a.ComponentParameterSummary.None;return N}b._inherits(J,H);b._createClass(J,[{key:"type",get:function(){return l.ComponentDataType.Varying}}]);return J}(w.MaterialParameterBlock);c.__decorate([w.parameter()],k.prototype,"texture",void 0);c.__decorate([w.parameter()],k.prototype,"transparent",void 0);c.__decorate([w.parameter()],
k.prototype,"opaqueOverride",void 0);c.__decorate([w.parameter()],k.prototype,"castShadows",void 0);a.CommonMaterialParameters=O;a.ComponentMaterial=G;a.ComponentParametersUniform=I;a.ComponentParametersVarying=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){d=function(t){function w(){return t.apply(this,arguments)||this}c._inherits(w,t);var r=w.prototype;r.initializeConfiguration=function(x,D){D.spherical=x.viewingMode===y.ViewingMode.Global;D.doublePrecisionRequiresObfuscation=x.rctx.driverTest.doublePrecisionRequiresObfuscation.result};r.initializeProgram=function(x){return new e.Program(x.rctx,w.shader.get().build(this.configuration),m)};r._setPipelineState=function(x){const D=this.configuration,A=D.integratedMeshMode!==
p.IntegratedMeshMode.None,v=x===z.TransparencyPassType.NONE,B=x===z.TransparencyPassType.FrontFace;return l.makePipelineState({blending:D.output!==q.ShaderOutput.Color&&D.output!==q.ShaderOutput.Alpha||!D.blendingEnabled?null:v?g.blendingDefault:g.oitBlending(x),culling:l.cullingParams(D.cullFace),depthTest:{func:g.oitDepthTest(x)},depthWrite:v||B?l.defaultDepthWriteParams:null,colorWrite:l.defaultColorWriteParams,stencilWrite:A||D.hasOccludees?h.stencilWriteMaskOn:null,stencilTest:A?h.replaceBitWhenDepthTestPasses(f.StencilBits.IntegratedMeshMaskExcluded):
D.hasOccludees?h.stencilBaseAllZerosParams:null,polygonOffset:v||B?D.hasPolygonOffset?{factor:2,units:2}:null:g.OITPolygonOffset})};r.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return c._createClass(w)}(d.ShaderTechnique);d.shader=new k.ReloadableShaderModule(u.ComponentShader,()=>new Promise((t,w)=>a(["./shader/ComponentShader.glsl"],t,w)));const m=new Map([[n.VertexAttribute.POSITION,0],[n.VertexAttribute.NORMAL,1],[n.VertexAttribute.NORMALCOMPRESSED,
1],[n.VertexAttribute.COLOR,2],[n.VertexAttribute.UV0,3],[n.VertexAttribute.UVREGION,4],[n.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=d;b.attributeLocations=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){a.IntegratedMeshMode=void 0;(function(m){m[m.None=0]="None";m[m.NoOverlay=1]="NoOverlay";m[m.ColorOverlay=2]="ColorOverlay";m[m.ColorOverlayWithWater=3]="ColorOverlayWithWater";m[m.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let l=function(m){function t(){var w=m.apply(this,arguments)||this;w.output=u.ShaderOutput.Color;w.textureCoordinateType=k.TextureCoordinateAttributeType.None;w.componentData=y.ComponentDataType.Uniform;w.cullFace=
z.CullFaceOptions.Back;w.vertexDiscardMode=p.VertexDiscardMode.None;w.doubleSidedMode=d.NormalsDoubleSidedMode.WindingOrder;w.alphaDiscardMode=z.AlphaDiscardMode.Opaque;w.integratedMeshMode=a.IntegratedMeshMode.None;w.transparencyPassType=n.TransparencyPassType.NONE;w.ellipsoidMode=g.EllipsoidMode.Earth;w.pbrMode=f.PBRMode.Disabled;w.normalType=q.NormalType.Attribute;w.spherical=!1;w.doublePrecisionRequiresObfuscation=!1;w.hasVertexColors=!1;w.hasNormals=!1;w.hasSlicePlane=!1;w.hasBaseColorTexture=
!1;w.receiveAmbientOcclusion=!0;w.receiveShadows=!0;w.blendingEnabled=!0;w.hasScreenSpaceReflections=!1;w.hasPolygonOffset=!1;w.hasMetallicRoughnessTexture=!1;w.hasEmissionTexture=!1;w.hasOcclusionTexture=!1;w.hasNormalTexture=!1;w.hasOccludees=!1;w.hasMultipassTerrain=!1;w.cullAboveGround=!1;w.hasCloudsReflections=!0;w.snowCover=!1;w.objectAndLayerIdColor=!1;return w}b._inherits(t,m);return b._createClass(t)}(h.ShaderTechniqueConfiguration);c.__decorate([h.parameter({count:u.ShaderOutput.COUNT})],
l.prototype,"output",void 0);c.__decorate([h.parameter({count:k.TextureCoordinateAttributeType.COUNT})],l.prototype,"textureCoordinateType",void 0);c.__decorate([h.parameter({count:y.ComponentDataType.COUNT})],l.prototype,"componentData",void 0);c.__decorate([h.parameter({count:z.CullFaceOptions.COUNT})],l.prototype,"cullFace",void 0);c.__decorate([h.parameter({count:p.VertexDiscardMode.COUNT})],l.prototype,"vertexDiscardMode",void 0);c.__decorate([h.parameter({count:d.NormalsDoubleSidedMode.COUNT})],
l.prototype,"doubleSidedMode",void 0);c.__decorate([h.parameter({count:z.AlphaDiscardMode.COUNT})],l.prototype,"alphaDiscardMode",void 0);c.__decorate([h.parameter({count:a.IntegratedMeshMode.COUNT})],l.prototype,"integratedMeshMode",void 0);c.__decorate([h.parameter({count:n.TransparencyPassType.COUNT})],l.prototype,"transparencyPassType",void 0);c.__decorate([h.parameter({count:g.EllipsoidMode.COUNT})],l.prototype,"ellipsoidMode",void 0);c.__decorate([h.parameter({count:f.PBRMode.COUNT})],l.prototype,
"pbrMode",void 0);c.__decorate([h.parameter({count:q.NormalType.COUNT})],l.prototype,"normalType",void 0);c.__decorate([h.parameter()],l.prototype,"spherical",void 0);c.__decorate([h.parameter()],l.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([h.parameter()],l.prototype,"hasVertexColors",void 0);c.__decorate([h.parameter()],l.prototype,"hasNormals",void 0);c.__decorate([h.parameter()],l.prototype,"hasSlicePlane",void 0);c.__decorate([h.parameter()],l.prototype,"hasBaseColorTexture",
void 0);c.__decorate([h.parameter()],l.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([h.parameter()],l.prototype,"receiveShadows",void 0);c.__decorate([h.parameter()],l.prototype,"blendingEnabled",void 0);c.__decorate([h.parameter()],l.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([h.parameter()],l.prototype,"hasPolygonOffset",void 0);c.__decorate([h.parameter()],l.prototype,"hasMetallicRoughnessTexture",void 0);c.__decorate([h.parameter()],l.prototype,"hasEmissionTexture",
void 0);c.__decorate([h.parameter()],l.prototype,"hasOcclusionTexture",void 0);c.__decorate([h.parameter()],l.prototype,"hasNormalTexture",void 0);c.__decorate([h.parameter()],l.prototype,"hasOccludees",void 0);c.__decorate([h.parameter()],l.prototype,"hasMultipassTerrain",void 0);c.__decorate([h.parameter()],l.prototype,"cullAboveGround",void 0);c.__decorate([h.parameter()],l.prototype,"hasCloudsReflections",void 0);c.__decorate([h.parameter()],l.prototype,"snowCover",void 0);c.__decorate([h.parameter()],
l.prototype,"objectAndLayerIdColor",void 0);c.__decorate([h.parameter({constValue:e.BindType.Draw})],l.prototype,"pbrTextureBindType",void 0);c.__decorate([h.parameter({constValue:!0})],l.prototype,"hasSliceHighlight",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"hasVertexTangents",void 0);c.__decorate([h.parameter({constValue:!0})],
l.prototype,"supportsTextureAtlas",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"highStepCount",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"instancedDoublePrecision",void 0);c.__decorate([h.parameter({constValue:!0})],l.prototype,"useFillLights",void 0);c.__decorate([h.parameter({constValue:!1})],l.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(l,m){const {vertex:t,fragment:w}=l;t.include(q.RgbaFloatEncoding);t.uniforms.add(new g.Texture2DDrawUniform("componentColorTex",r=>r.componentParameters.texture.texture));l.attributes.add(e.VertexAttribute.COMPONENTINDEX,"float");l.varyings.add("vExternalColorMixMode","mediump float");l.varyings.add("vExternalColor","vec4");(m=m.output===u.ShaderOutput.ObjectAndLayerIdColor)&&l.varyings.add("vObjectAndLayerIdColor","vec4");l.include(p.DecodeSymbolColor);
t.constants.add("elevationScale","float",2*n);t.constants.add("stride","float",y("enable-feature:objectAndLayerId-rendering")?3:2);t.code.add(f.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);t.code.add(f.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${m?f.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:f.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);w.code.add(f.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${m?f.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function z(l){const {vertex:m,fragment:t}=l;m.uniforms.add(new k.Float4DrawUniform("externalColor",w=>w.componentParameters.externalColor));t.uniforms.add(new d.IntegerDrawUniform("externalColorMixMode",w=>w.componentParameters.externalColorMixMode));l.varyings.add("vExternalColor","vec4");m.code.add(f.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);t.code.add(f.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}a.ComponentDataType=void 0;(function(l){l[l.Uniform=0]="Uniform";l[l.Varying=1]="Varying";l[l.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const n=2**32/1E4;a.ComponentData=function(l,m){switch(m.componentData){case a.ComponentDataType.Varying:return h(l,m);case a.ComponentDataType.Uniform:return z(l);case a.ComponentDataType.COUNT:break;default:b.neverReached(m.componentData)}};a.MAX_ELEVATION_OFFSET=n;a.encodeElevationOffset=function(l,m){c.packFloatRGBA(l/n*.5+.5,m)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,y){c=function(p){function u(q,k){return p.call(this,q,"int",y.BindType.Draw,(d,f,g)=>d.setUniform1i(q,k(f,g)))||this}b._inherits(u,p);return b._createClass(u)}(c.Uniform);a.IntegerDrawUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,y){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(y.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports",
"../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I){function H(R){const W=new L.ShaderBuilder;W.include(z.VertexPosition,R);W.include(h.VertexNormal,R);W.include(e.VertexColor,R);W.include(g.TextureCoordinateAttribute,R);W.include(q.ForwardLinearDepth,R);W.include(p.ComponentData,R);W.include(M.DiscardOrAdjustAlphaDraw,R);W.include(d.SlicePass,R);W.include(B.ReadBaseColorTexture,R);W.include(u.VertexDiscardByOpacity,R);const {vertex:T,fragment:P}=W;if(R.pbrMode===v.PBRMode.Normal||
R.pbrMode===v.PBRMode.Schematic)W.include(v.PhysicallyBasedRenderingParameters,R),R.hasNormalTexture&&W.include(w.ComputeNormalTexture,R);const Q=R.output===k.ShaderOutput.Shadow||R.output===k.ShaderOutput.ShadowHighlight||R.output===k.ShaderOutput.ShadowExcludeHighlight;Q&&R.componentData===p.ComponentDataType.Varying?T.code.add(G.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):T.code.add(G.glsl`#define discardShadows(castShadows) {}`);
const S=R.integratedMeshMode===y.IntegratedMeshMode.ColorOverlay||R.integratedMeshMode===y.IntegratedMeshMode.ColorOverlayWithWater,U=S&&R.output===k.ShaderOutput.Color&&R.pbrMode===v.PBRMode.WaterOnIntegratedMesh;S&&(W.include(x.EvaluateSceneLighting,R),W.include(E.OverlayIM,R),R.spherical?T.code.add(G.glsl`
      const float invEllipsoidRadius = ${G.glsl.float(1/(R.ellipsoidMode===K.EllipsoidMode.Earth?b.earth.radius:R.ellipsoidMode===K.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):T.code.add(G.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));U&&(W.varyings.add("tbnTangent","vec3"),W.varyings.add("tbnBiTangent","vec3"),W.varyings.add("groundNormal","vec3"));T.code.add(G.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${R.output===k.ShaderOutput.ObjectAndLayerIdColor?G.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${G.glsl.float(F.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${R.output===k.ShaderOutput.ObjectAndLayerIdColor?G.glsl`forwardObjectAndLayerIdColor();`:""}
      ${U?R.spherical?G.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:G.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${S?G.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);R.output===k.ShaderOutput.Alpha&&(P.include(m.ReadLinearDepth),W.include(A.multipassTerrainTest,R),W.include(t.ComputeMaterialColor,R),S&&P.uniforms.add(new O.Texture2DPassUniform("ovColorTex",(V,X)=>E.getColorTexture(V,X))),P.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${R.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${S?G.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));R.output===k.ShaderOutput.Color&&(P.include(m.ReadLinearDepth),W.include(A.multipassTerrainTest,R),W.include(t.ComputeMaterialColor,R),W.include(r.ComputeShadingNormal,R),W.include(x.EvaluateSceneLighting,R),R.receiveShadows?(W.include(C.ReadShadowMapPass,R),P.code.add(G.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):P.code.add(G.glsl`float evaluateShadow() { return 0.0; }`),S&&P.uniforms.add(new O.Texture2DPassUniform("ovColorTex",(V,X)=>E.getColorTexture(V,X))),P.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${R.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${S?G.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),R.pbrMode===v.PBRMode.Normal||R.pbrMode===v.PBRMode.Schematic?(D.addMainLightIntensity(P),P.code.add(G.glsl`
        ${R.pbrMode===v.PBRMode.Normal?G.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),R.hasNormalTexture?P.code.add(G.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):P.code.add(G.glsl`vec3 shadingNormal = normalVertex;`),P.code.add(G.glsl`${R.spherical?G.glsl`vec3 normalGround = normalize(positionWorld());`:G.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),P.code.add(G.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${R.snowCover?G.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${S?G.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(R.receiveShadows?P.code.add(G.glsl`float shadow = evaluateShadow();`):R.spherical?(x.addLightingGlobalFactor(P),P.code.add(G.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):P.code.add(G.glsl`float shadow = 0.0;`),U&&P.uniforms.add(new O.Texture2DPassUniform("ovNormalTex",(V,X)=>J(X))),R.snowCover&&P.code.add(G.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),P.code.add(G.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${S?G.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${U?G.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),P.code.add(G.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${R.transparencyPassType===I.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(R.output===k.ShaderOutput.Depth||Q)W.include(n.OutputDepth,R),P.code.add(G.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);R.output===k.ShaderOutput.Normal&&(W.include(r.ComputeShadingNormal,R),P.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${R.normalType===f.NormalType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));R.output===k.ShaderOutput.ObjectAndLayerIdColor&&W.fragment.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${S?G.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);R.output===k.ShaderOutput.Highlight&&(W.include(l.OutputHighlight,R),P.code.add(G.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${S?G.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return W}function J(R){return 0===R.overlays.length?null:R.overlays[c.OverlayIndex.INNER].getValidTexture(c.RenderTargetType.Water)}const N=Object.freeze(Object.defineProperty({__proto__:null,build:H,getOverlayNormalTexture:J},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=N;a.build=H;a.getOverlayNormalTexture=J})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,y,p,u){a.ComputeMaterialColor=function(q,k){q.include(b.VertexColor,k);q.fragment.include(c.MixExternalColor);q=q.fragment;q.uniforms.add(new y.Float4DrawUniform("baseColor",d=>d.baseColor));q.uniforms.add(new p.FloatDrawUniform("objectOpacity",d=>d.objectOpacity));k.hasVertexColors?q.code.add(u.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):q.code.add(u.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);q.code.add(u.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,y,p,u,q){a.ComputeShadingNormal=function(k,d){const f=k.fragment;switch(d.doubleSidedMode){case u.NormalsDoubleSidedMode.None:f.code.add(q.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case u.NormalsDoubleSidedMode.View:k.include(p.VertexPosition,d);f.code.add(q.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case u.NormalsDoubleSidedMode.WindingOrder:f.code.add(q.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(d.doubleSidedMode);case u.NormalsDoubleSidedMode.COUNT:}switch(d.normalType){case c.NormalType.Attribute:case c.NormalType.Compressed:k.include(y.VertexNormal,d);f.code.add(q.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalType.ScreenDerivative:k.include(p.VertexPosition,d);f.code.add(q.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalType.Ground:d.spherical?(k.include(p.VertexPosition,d),f.code.add(q.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):f.code.add(q.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);f.code.add(q.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(d.normalType);case c.NormalType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(a,
b,c,y,p,u,q,k){a.ReadBaseColorTexture=function(d,f){const g=d.fragment;!f.hasBaseColorTexture||f.output!==b.ShaderOutput.Color&&f.alphaDiscardMode===k.AlphaDiscardMode.Opaque?g.code.add(u.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(d.include(y.VertexTextureCoordinates,f),f=f.textureCoordinateType===c.TextureCoordinateAttributeType.Atlas,g.uniforms.add(new q.Texture2DDrawUniform("baseColorTexture",e=>e.texture)),f?(d.include(p.TextureAtlasLookup),g.code.add(u.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):g.code.add(u.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(p){function u(){var k=p.apply(this,arguments)||this;k._dirty=!0;return k}b._inherits(u,p);var q=u.prototype;q._setDirty=function(){this._dirty=!0};q._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const k of this._parameterBlocks)this[k]._setClean()};
q._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const k of this._parameterBlocks)if(this[k].dirty)return!0;return!1};b._createClass(u,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return u}(c.NoParameters);let y=function(){function p(){this._dirty=!0}var u=p.prototype;u._setDirty=function(){this._dirty=!0};u._setClean=function(){this._dirty=!1};b._createClass(p,[{key:"dirty",get:function(){return this._dirty}}]);return p}();
a.MaterialBase=c;a.MaterialParameterBlock=y;a.parameter=function(p={}){return(u,q)=>{const k=u._parameterCount??0;u._parameterCount=k+1;if(p.vectorOps){const d=p.vectorOps;Object.defineProperty(u,q,{get(){return this[k]},set(f){const g=this[k];if(null==g)this[k]=f;else{if(d.equals(g,f))return;d.copy(g,f)}this._setDirty()}})}else Object.defineProperty(u,q,{get(){return this[k]},set(d){this[k]!==d&&(p.dispose&&this[k]&&this[k].dispose(),this[k]=d,this._setDirty())}})}};a.parameterBlock=function(){return(p,
u)=>{const q=p._parameterCount??0;p._parameterCount=q+1;p._parameterBlocks=p._parameterBlocks||[];p._parameterBlocks.push(q);Object.defineProperty(p,u,{get(){return this[q]},set(k){this[q]!==k&&(this[q]=k,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],
function(a,b,c,y,p){let u=function(){function k(f){this._low=p.create();this._high=p.create();f&&this.set(f)}var d=k.prototype;d.set=function(f){c.copy(this._low,c.copy(q,f));f=c.sub(q,f,this._low);c.copy(this._high,f)};d.get=function(f){return c.add(f,this._low,this._high)};d.getLowScaled=function(f){return c.scale(f,this._low,1)};b._createClass(k,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return k}();const q=y.create();a.TwoVectorPosition=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,y){const p=c.newLayout().vec3f(y.VertexAttribute.POSITION).u16(y.VertexAttribute.COMPONENTINDEX).u16(y.VertexAttribute.U16PADDING),u=c.newLayout().vec2u8(y.VertexAttribute.SIDENESS);b=b.glLayout(u);c=c.newLayout().vec3f(y.VertexAttribute.POSITION0).vec3f(y.VertexAttribute.POSITION1).u16(y.VertexAttribute.COMPONENTINDEX).u8(y.VertexAttribute.VARIANTOFFSET,
{glNormalized:!0}).u8(y.VertexAttribute.VARIANTSTROKE).u8(y.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(y.VertexAttribute.U8PADDING,{glPadding:!0}).u16(y.VertexAttribute.U16PADDING,{glPadding:!0});const q=c.clone().vec3f(y.VertexAttribute.NORMAL),k=c.clone().vec3f(y.VertexAttribute.NORMALA).vec3f(y.VertexAttribute.NORMALB);y=new Map([[y.VertexAttribute.POSITION0,0],[y.VertexAttribute.POSITION1,1],[y.VertexAttribute.COMPONENTINDEX,2],[y.VertexAttribute.VARIANTOFFSET,3],[y.VertexAttribute.VARIANTSTROKE,
4],[y.VertexAttribute.VARIANTEXTENSION,5],[y.VertexAttribute.NORMAL,6],[y.VertexAttribute.NORMALA,6],[y.VertexAttribute.NORMALB,7],[y.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=p;a.EdgeShaderAttributeLocations=y;a.RegularEdgeInstancesLayout=q;a.SilhouetteEdgeInstancesLayout=k;a.VertexLayout=u;a.glVertexLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(z,n,l,m){if(n)return n=y.computeNeighbors(l,m,z.count),new g(l,m,n,z);z=c.deduplicate(z.buffer,z.stride/4,{originalIndices:l,originalIndicesLength:m});m=y.computeNeighbors(z.indices,m,z.uniqueCount);return{faces:z.indices,facesLength:z.indices.length,neighbors:m,vertices:q.EdgeInputBufferLayout.createView(z.buffer)}}let g=b._createClass(function(z,n,l,m){this.faces=z;this.facesLength=n;this.neighbors=l;this.vertices=m});const e=new k.RegularEdgeBufferWriter,
h=new k.SilhouetteEdgeBufferWriter;b=p.newLayout().vec3f(u.VertexAttribute.POSITION0).vec3f(u.VertexAttribute.POSITION1);p=p.newLayout().vec3f(u.VertexAttribute.POSITION0).vec3f(u.VertexAttribute.POSITION1).u16(u.VertexAttribute.COMPONENTINDEX).u16(u.VertexAttribute.U16PADDING,{glPadding:!0});a.extract=function(z){const n=f(z.data,z.skipDeduplicate,z.indices,z.indicesLength);e.updateSettings(z.writerSettings);h.updateSettings(z.writerSettings);return d.extractEdges(n,e,h)};a.extractComponentsEdgeLocationsLayout=
p;a.extractEdgeInformation=f;a.extractEdgeLocationsLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,c,y){c/=3;const p=new Uint32Array(y+1),u=new Uint32Array(y+1);var q=(l,m)=>{l<m?p[l+1]++:u[m+1]++};for(var k=0;k<c;k++){var d=b[3*k],f=b[3*k+1],g=b[3*k+2];q(d,f);q(f,g);q(g,d)}k=q=0;for(d=0;d<y;d++)f=p[d+1],g=u[d+1],p[d+1]=q,u[d+1]=k,q+=f,k+=g;const e=new Uint32Array(6*
c),h=p[y];q=(l,m,t)=>{l<m?(l=p[l+1]++,e[2*l]=m,e[2*l+1]=t):(m=u[m+1]++,e[2*h+2*m]=l,e[2*h+2*m+1]=t)};for(k=0;k<c;k++)d=b[3*k],f=b[3*k+1],g=b[3*k+2],q(d,f,k),q(f,g,k),q(g,d,k);q=(l,m)=>{const t=2*l;l=m-l;for(m=1;m<l;m++){const w=e[t+2*m],r=e[t+2*m+1];let x=m-1;for(x;0<=x&&e[t+2*x]>w;x--)e[t+2*x+2]=e[t+2*x],e[t+2*x+3]=e[t+2*x+1];e[t+2*x+2]=w;e[t+2*x+3]=r}};for(k=0;k<y;k++)q(p[k],p[k+1]),q(h+u[k],h+u[k+1]);const z=new Int32Array(3*c),n=(l,m)=>l===b[3*m]?0:l===b[3*m+1]?1:l===b[3*m+2]?2:-1;c=(l,m)=>{l=
n(l,m);z[3*m+l]=-1};q=(l,m,t,w)=>{l=n(l,m);z[3*m+l]=w;t=n(t,w);z[3*w+t]=m};for(k=0;k<y;k++){d=p[k];f=p[k+1];g=u[k];const l=u[k+1];for(;d<f&&g<l;){const m=e[2*d],t=e[2*h+2*g];m===t?(q(k,e[2*d+1],t,e[2*h+2*g+1]),d++,g++):m<t?(c(k,e[2*d+1]),d++):(c(t,e[2*h+2*g+1]),g++)}for(;d<f;)c(k,e[2*d+1]),d++;for(;g<l;)c(e[2*h+2*g],e[2*h+2*g+1]),g++}return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(a,b,c,y,p,u,q){function k(w){const r=e;r[0]=w.position0[0];r[1]=w.position0[1];r[2]=w.position0[2];r[3]=w.position1[0];r[4]=w.position1[1];r[5]=w.position1[2];z[0]=5381;for(w=0;w<h.length;w++)z[0]=31*z[0]+h[w];return z[0]}function d(w){const r=e;r[0]=f(w.position0[0]);r[1]=f(w.position0[1]);r[2]=f(w.position0[2]);r[3]=f(w.position1[0]);r[4]=f(w.position1[1]);r[5]=f(w.position1[2]);z[0]=5381;for(w=0;w<h.length;w++)z[0]=31*z[0]+h[w];return z[0]}function f(w){return Math.round(1E4*w)/1E4}let g=
function(){function w(){}var r=w.prototype;r.updateSettings=function(x){this.settings=x;this._edgeHashFunction=x.reducedPrecision?d:k};r.write=function(x,D,A){var v=this._edgeHashFunction(A);t.seed=v;v=t.getIntRange(0,255);const B=t.getIntRange(0,this.settings.variants-1);var C=t.getFloat();C=-(1-Math.min(C/.7,1))+Math.max(0,C-.7)/(1-.7);C=255*(Math.abs(C)**1.2*(0>C?-1:1)*.5+.5);x.position0.setVec(D,A.position0);x.position1.setVec(D,A.position1);x.componentIndex.set(D,A.componentIndex);x.variantOffset.set(D,
v);x.variantStroke.set(D,B);x.variantExtension.set(D,C)};r.trim=function(x,D){return x.slice(0,D)};return b._createClass(w)}();const e=new Float32Array(6),h=new Uint32Array(e.buffer),z=new Uint32Array(1);let n=function(){function w(){this._commonWriter=new g}var r=w.prototype;r.updateSettings=function(x){this._commonWriter.updateSettings(x)};r.allocate=function(x){return q.RegularEdgeInstancesLayout.createBuffer(x)};r.write=function(x,D,A){this._commonWriter.write(x,D,A);y.add(m,A.faceNormal0,A.faceNormal1);
y.normalize(m,m);x.normal.setVec(D,m)};r.trim=function(x,D){return this._commonWriter.trim(x,D)};return b._createClass(w)}();n.Layout=q.RegularEdgeInstancesLayout;n.glLayout=u.glLayout(q.RegularEdgeInstancesLayout,1);let l=function(){function w(){this._commonWriter=new g}var r=w.prototype;r.updateSettings=function(x){this._commonWriter.updateSettings(x)};r.allocate=function(x){return q.SilhouetteEdgeInstancesLayout.createBuffer(x)};r.write=function(x,D,A){this._commonWriter.write(x,D,A);x.normalA.setVec(D,
A.faceNormal0);x.normalB.setVec(D,A.faceNormal1)};r.trim=function(x,D){return this._commonWriter.trim(x,D)};return b._createClass(w)}();l.Layout=q.SilhouetteEdgeInstancesLayout;l.glLayout=u.glLayout(q.SilhouetteEdgeInstancesLayout,1);const m=p.create(),t=new c;a.CommonBufferWriter=g;a.RegularEdgeBufferWriter=n;a.SilhouetteEdgeBufferWriter=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports",
"../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],function(a,b,c,y,p){function u(e,h){const z=c.acosClamped(e.cosAngle),n=d.fwd,l=d.ortho;y.direction(n,e.position1,e.position0);e=0<y.dot(y.cross(l,e.faceNormal0,e.faceNormal1),n)?-1:1;return z*e>h}function q(e){const h=e.faces.length/3,z=e.faces;e=e.neighbors;var n=0;for(var l=0;l<h;l++){var m=e[3*l+1],t=e[3*l+2],w=z[3*l],r=z[3*l+1],x=z[3*l+2];n+=-1===e[3*l]||w<r?1:0;n+=-1===
m||r<x?1:0;n+=-1===t||x<w?1:0}n=new Int32Array(4*n);l=0;for(m=0;m<h;m++){t=e[3*m];w=e[3*m+1];r=e[3*m+2];x=z[3*m];const D=z[3*m+1],A=z[3*m+2];if(-1===t||x<D)n[l++]=x,n[l++]=D,n[l++]=m,n[l++]=t;if(-1===w||D<A)n[l++]=D,n[l++]=A,n[l++]=m,n[l++]=w;if(-1===r||A<x)n[l++]=A,n[l++]=x,n[l++]=m,n[l++]=r}return n}function k(e){const h=e.faces.length/3,z=e.vertices.position;e=e.faces;const n=f.v0,l=f.v1,m=f.v2,t=new Float32Array(3*h);for(let w=0;w<h;w++){const r=e[3*w+1],x=e[3*w+2];z.getVec(e[3*w],n);z.getVec(r,
l);z.getVec(x,m);y.subtract(l,l,n);y.subtract(m,m,n);y.cross(n,l,m);y.normalize(n,n);t[3*w]=n[0];t[3*w+1]=n[1];t[3*w+2]=n[2]}return t}a.EdgeType=void 0;(function(e){e[e.SOLID=0]="SOLID";e[e.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const d={edge:{position0:p.create(),position1:p.create(),faceNormal0:p.create(),faceNormal1:p.create(),componentIndex:0,cosAngle:0},ortho:p.create(),fwd:p.create()},f={v0:p.create(),v1:p.create(),v2:p.create()},g={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=
function(e,h,z,n=g){const l=e.vertices.position;var m=e.vertices.componentIndex,t=c.deg2rad(n.anglePlanar);n=c.deg2rad(n.angleSignificantEdge);const w=Math.cos(n),r=Math.cos(t),x=d.edge,D=x.position0,A=x.position1,v=x.faceNormal0,B=x.faceNormal1,C=k(e),E=q(e),F=E.length/4;e=h.allocate(F);n=0;const M=z.allocate(F);let K=0,G=0,L=0;const O=b.range(0,F),I=new Float32Array(F);I.forEach((R,W,T)=>{l.getVec(E[4*W],D);l.getVec(E[4*W+1],A);T[W]=y.distance(D,A)});O.sort((R,W)=>I[W]-I[R]);const H=[],J=[];for(let R=
0;R<F;R++){var N=O[R];const W=I[N],T=E[4*N],P=E[4*N+1],Q=E[4*N+2];N=E[4*N+3];const S=-1===N;l.getVec(T,D);l.getVec(P,A);if(S)y.set(v,C[3*Q],C[3*Q+1],C[3*Q+2]),y.copy(B,v),x.componentIndex=m.get(T),x.cosAngle=y.dot(v,B);else{y.set(v,C[3*Q],C[3*Q+1],C[3*Q+2]);y.set(B,C[3*N],C[3*N+1],C[3*N+2]);x.componentIndex=m.get(T);x.cosAngle=y.dot(v,B);if(x.cosAngle>r)continue;-.9999>x.cosAngle&&y.copy(B,v)}G+=W;L++;S||x.cosAngle<w?(h.write(e,n++,x),H.push(W)):u(x,t)&&(z.write(M,K++,x),J.push(W))}m=new Float32Array(H.reverse());
t=new Float32Array(J.reverse());return{regular:{instancesData:h.trim(e,n),lodInfo:{lengths:m}},silhouette:{instancesData:z.trim(M,K),lodInfo:{lengths:t}},averageEdgeLength:G/L}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./ManagedTextureBackedBuffer"],function(a,b,c){let y=function(){function p(q,k=1){this._rctx=q;this._fieldCount=
k;this._buffers=[]}var u=p.prototype;u.garbageCollect=function(){this._buffers=this._buffers.filter(q=>0===q.activeCount?(q.dispose(),!1):!0)};u.destroy=function(){this._buffers.forEach(q=>q.dispose());this._buffers=[]};u.getBuffer=function(q){for(const k of this._buffers)if(k.availableCount>=q)return k;if(q>c.MAX_INDEX_COUNT)return null;q=new c.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(q);return q};u.updateTextures=function(){for(const q of this._buffers)q.textureBuffer.updateTexture()};
return b._createClass(p)}();a.BufferManager=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,y){let p=function(){function u(k,d=1){this.textureBuffer=new y.TextureBackedBuffer(k,d);this._indexManager=new c.SimpleIndexManager(65536)}var q=u.prototype;q.dispose=function(){this.textureBuffer.dispose();
this.textureBuffer=void 0};q.acquireIndex=function(){const k=this._indexManager.acquire();this.textureBuffer.resizeToFit(k);return k};q.releaseIndex=function(k){this._indexManager.release(k)};b._createClass(u,[{key:"availableCount",get:function(){return this._indexManager.availableCount}},{key:"activeCount",get:function(){return this._indexManager.activeCount}}]);return u}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._maxCount=u;this._nextIndex=0;this._recycledIndices=[]}var p=y.prototype;p.acquire=function(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++};p.release=function(u){this._recycledIndices.push(u)};b._createClass(y,[{key:"activeCount",get:function(){return this._nextIndex-this._recycledIndices.length}},{key:"availableCount",get:function(){return this._recycledIndices.length+
this._maxCount-this._nextIndex}}]);return y}();a.SimpleIndexManager=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(a,b,c,y,p,u){let q=function(){function k(f,g=1){this._rctx=f;this._fieldCount=
g;this.textureWidth=4096;this._dirty=!0;f=new u.TextureDescriptor;f.samplingMode=y.TextureSamplingMode.NEAREST;f.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;f.width=this.textureWidth;f.height=1;this._texture=new p.Texture(this._rctx,f);this._data=new c.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var d=k.prototype;d.dispose=function(){this._texture.dispose();this._data=this._texture=void 0};d.setData=function(f,g,e,h,z,n){f=f*this._fieldCount+g;this._dirty=!0;this._data.set(f,0,e);this._data.set(f,
1,h);this._data.set(f,2,z);this._data.set(f,3,n)};d.setDataElement=function(f,g,e,h){f=f*this._fieldCount+g;this._dirty=!0;this._data.set(f,e,h)};d.getDataElement=function(f,g,e){f=f*this._fieldCount+g;this._dirty=!0;return this._data.get(f,e)};d.resizeToFit=function(f){f=(f+1)*this._fieldCount;f>this._data.count&&(f=new c.BufferViewVec4u8(new ArrayBuffer(Math.ceil(f/this.textureWidth)*this.textureWidth*4)),f.typedBuffer.set(this._data.typedBuffer),this._data=f)};d.updateTexture=function(){if(this._dirty){var f=
this._texture.descriptor.width;this._data.count>f*this._texture.descriptor.height&&this._texture.resize(f,this._data.count/f);this._texture.setData(this._data.typedBuffer);this._dirty=!1}};b._createClass(k,[{key:"texture",get:function(){return this._texture}}]);return k}();a.TextureBackedBuffer=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../environment/ChapmanAtmosphereTechniqueConfiguration ./glUtil3D ../../../../chunks/AtmosphereCompositing.glsl ../shaders/AtmosphereCompositingTechnique ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique ../../../../chunks/OverlayCompositing.glsl ../shaders/OverlayCompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){return function(){function t(r,x){this._rctx=r;this._techniqueRepository=x;this._configuration=new d.CompositingTechniqueConfiguration;this._atmosphereConfiguration=new c.ChapmanAtmosphereTechniqueConfiguration;this._passParameters=new q.CompositingPassParameters;this._atmosphereParameters=new p.AtmosphereCompositingPassParameters;this._oitParameters=new e.OITCompositingPassParameters;this._hudParameters=new f.HUDCompositingPassParameters;this._overlayParameters=
new z.OverlayCompositingPassParameters}var w=t.prototype;w.destroy=function(){this._vao=b.disposeMaybe(this._vao)};w.compositeOIT=function(r,x,D,A){this._oitParameters.colorTexture=x;this._oitParameters.alphaTexture=D;this._oitParameters.frontFaceTexture=A;x=this._rctx;D=this._techniqueRepository.acquire(h.OITCompositingTechnique);x.bindTechnique(D,this._oitParameters,r);r=this._ensureVAO();x.bindVAO(r);x.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(r,"geometry"));D.release()};w.compositeHUD=
function(r,x){this._hudParameters.texture=x;x=this._rctx;const D=this._techniqueRepository.acquire(g.HUDCompositingTechnique);x.bindTechnique(D,this._hudParameters,r);r=this._ensureVAO();x.bindVAO(r);x.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(r,"geometry"));D.release()};w.compositeOverlay=function(r,x,D,A){this._overlayParameters.texture=x;this._overlayParameters.opacity=D;this._overlayParameters.overlayIndex=A;x=this._rctx;D=this._techniqueRepository.acquire(n.OverlayCompositingTechnique);
x.bindTechnique(D,this._overlayParameters,r);r=this._ensureVAO();x.bindVAO(r);x.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(r,"geometry"));D.release()};w.compositeAtmosphere=function(r,x,D,A,v){const B=this._rctx;this._atmosphereParameters.texture=x;this._atmosphereParameters.depthTexture=D;this._atmosphereParameters.scale=A;this._atmosphereConfiguration.haze=v;x=this._techniqueRepository.acquire(u.AtmosphereCompositingTechnique,this._atmosphereConfiguration);B.bindTechnique(x,this._atmosphereParameters,
r);r=this._ensureVAO();B.bindVAO(r);B.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(r,"geometry"));x.release()};w.composite=function(r,x,D=d.AlphaMode.None,A=1){const v=this._rctx;this._configuration.alphaMode=D;this._configuration.hasOpacityFactor=1!==A;this._passParameters.texture=x;this._passParameters.opacity=A;x=this._techniqueRepository.acquire(k.CompositingTechnique,this._configuration);v.bindTechnique(x,this._passParameters,r);r=this._ensureVAO();v.bindVAO(r);v.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,
0,m.vertexCount(r,"geometry"));x.release()};w._ensureVAO=function(){null==this._vao&&(this._vao=y.createQuadVAO(this._rctx));return this._vao};return a._createClass(t)}()})},"esri/chunks/AtmosphereCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(z){const n=new q.ShaderBuilder;n.attributes.add(d.VertexAttribute.POSITION,"vec2");n.varyings.add("uv0","vec2");n.varyings.add("uv1","vec2");n.vertex.uniforms.add(new p.Float2PassUniform("scale",l=>l.scale));n.vertex.code.add(u.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`);n.fragment.uniforms.add(new k.Texture2DPassUniform("tex",l=>l.texture),new k.Texture2DPassUniform("depthTexture",l=>l.depthTexture),new p.Float2PassUniform("scale",l=>l.scale),new p.Float2PassUniform("clampUV",l=>{if(l.texture){var m=c.set(e,l.texture.descriptor.width,l.texture.descriptor.height);m=c.multiply(m,m,l.scale);m=c.inverse(m,m);l=c.sub(m,l.scale,m)}else l=e;return l}));z=z.haze;n.fragment.code.add(u.glsl`
    void main() {
      ${z?u.glsl`vec4`:u.glsl`float`} depthSample = texture(depthTexture, uv0) ${z?"":u.glsl`.r`};
      if (depthSample ${z?u.glsl`== vec4(0)`:u.glsl`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `);return n}let g=function(z){function n(){var l=z.apply(this,arguments)||this;l.scale=y.create();return l}b._inherits(n,z);return b._createClass(n)}(u.NoParameters);const e=y.create(),h=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:g,build:f},Symbol.toStringTag,{value:"Module"}));a.AtmosphereCompositing=h;a.AtmosphereCompositingPassParameters=g;a.build=f})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){p=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new q.Program(z.rctx,e.shader.get().build(this.configuration),u.Default3D)};h.initializePipeline=function(){return this.configuration.haze?f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_COLOR,d.BlendFactor.ONE),depthTest:{func:d.CompareFunction.ALWAYS},colorWrite:f.defaultColorWriteParams}):
f.makePipelineState({blending:f.simpleBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.ALWAYS},colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.AtmosphereCompositing,()=>new Promise((g,e)=>a(["./AtmosphereCompositing.glsl"],g,e)));b.AtmosphereCompositingTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q){function k(g){const e=new u.ShaderBuilder;e.include(c.ScreenSpacePass);e.fragment.uniforms.add(new q.Texture2DPassUniform("tex",h=>h.texture));g.hasOpacityFactor&&e.fragment.uniforms.add(new y.FloatPassUniform("opacity",h=>h.opacity));e.fragment.code.add(p.glsl`
    void main() {
      fragColor = texture(tex, uv) ${g.hasOpacityFactor?"* opacity":""};
    }`);return e}let d=function(g){function e(){var h=g.apply(this,arguments)||this;h.opacity=1;return h}b._inherits(e,g);return b._createClass(e)}(p.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:d,build:k},Symbol.toStringTag,{value:"Module"}));a.Compositing=f;a.CompositingPassParameters=d;a.build=k})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){p=function(e){function h(){return e.apply(this,arguments)||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new q.Program(n.rctx,h.shader.get().build(this.configuration),u.Default3D)};z.initializePipeline=function(){switch(this.configuration.alphaMode){case d.AlphaMode.None:return g.makePipelineState({colorWrite:g.defaultColorWriteParams});case d.AlphaMode.Alpha:return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.SRC_ALPHA,
f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams});case d.AlphaMode.PremultipliedAlpha:case d.AlphaMode.COUNT:return g.makePipelineState({blending:g.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams})}};return c._createClass(h)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.Compositing,()=>new Promise((e,h)=>a(["./Compositing.glsl"],e,h)));b.CompositingTechnique=
p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){a.AlphaMode=void 0;(function(u){u[u.None=0]="None";u[u.Alpha=1]="Alpha";u[u.PremultipliedAlpha=2]="PremultipliedAlpha";u[u.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let p=function(u){function q(){var k=
u.apply(this,arguments)||this;k.alphaMode=a.AlphaMode.None;k.hasOpacityFactor=!1;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter({count:a.AlphaMode.COUNT})],p.prototype,"alphaMode",void 0);c.__decorate([y.parameter()],p.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u){function q(){const f=new p.ShaderBuilder;f.include(c.ScreenSpacePass);f.fragment.uniforms.add(new u.Texture2DPassUniform("tex",g=>g.texture));f.fragment.code.add(y.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return f}let k=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,f);return b._createClass(g)}(y.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:k,build:q},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=d;a.HUDCompositingPassParameters=k;a.build=q})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.HUDCompositing,()=>new Promise((f,g)=>a(["./HUDCompositing.glsl"],f,g)));b.HUDCompositingTechnique=
p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,y,p,u){function q(){const f=new p.ShaderBuilder;f.include(c.ScreenSpacePass);
f.fragment.uniforms.add(new u.Texture2DPassUniform("colorTexture",g=>g.colorTexture),new u.Texture2DPassUniform("alphaTexture",g=>g.alphaTexture),new u.Texture2DPassUniform("frontFaceTexture",g=>g.frontFaceTexture));f.fragment.code.add(y.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return f}let k=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,f);return b._createClass(g)}(y.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:k,build:q},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=d;a.OITCompositingPassParameters=k;a.build=q})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){p=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new q.Program(z.rctx,e.shader.get().build(),u.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(p.ShaderTechnique);
p.shader=new y.ReloadableShaderModule(k.OITCompositing,()=>new Promise((g,e)=>a(["./OITCompositing.glsl"],g,e)));b.OITCompositingTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(){const h=new k.ShaderBuilder;h.include(y.ScreenSpacePass);h.fragment.uniforms.add(new d.Texture2DPassUniform("tex",z=>z.texture));h.fragment.uniforms.add(new u.IntegerPassUniform("overlayIdx",z=>z.overlayIndex));h.fragment.uniforms.add(new p.FloatPassUniform("opacity",z=>z.opacity));h.fragment.code.add(q.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return h}let g=function(h){function z(){var n=h.apply(this,arguments)||this;n.overlayIndex=c.OverlayIndex.INNER;n.opacity=1;return n}b._inherits(z,h);return b._createClass(z)}(q.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:g,build:f},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=e;a.OverlayCompositingPassParameters=g;a.build=f})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){p=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new q.Program(z.rctx,e.shader.get().build(),u.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.OverlayCompositing,
()=>new Promise((g,e)=>a(["./OverlayCompositing.glsl"],g,e)));b.OverlayCompositingTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(L,O){if(O.visible){var I=h.empty(),H=O.getSpatialQueryAccelerator();null!=H?m(I,L,H):t(I,L,O.objects);return I}}function m(L,O,I){var H=O.eye;const J=O.viewForward,N=O.frustum,R=T=>T.visible;var W=I.objectCount;500>W?(h.set(F,O.near,Math.min(L.near,O.far)),I.forEachInDepthRange(H,J,z.DepthOrder.FRONT_TO_BACK,F,(T,P)=>{w(L,O,T);F.far=L.near;P.setRange(F)},N,R),h.set(F,Math.max(L.far,O.near),O.far),I.forEachInDepthRange(H,J,z.DepthOrder.BACK_TO_FRONT,
F,(T,P)=>{w(L,O,T);F.near=L.far;P.setRange(F)},N,R)):(W=Math.max(Math.min(W,500),Math.ceil(.1*W)),H=I.findClosest(J,z.DepthOrder.FRONT_TO_BACK,N,R,W),I=I.findClosest(J,z.DepthOrder.BACK_TO_FRONT,N,R,W),H&&I&&(x(L,O,H.boundingVolumeWorldSpace.bounds),x(L,O,I.boundingVolumeWorldSpace.bounds)))}function t(L,O,I){M.clear();I.forAll(H=>{H.visible&&0!==H.geometries.length&&M.add(H)});M.empty||(M.sort(O),h.set(F,O.near,Math.min(L.near,O.far)),M.forEachInDepthRange(F,z.DepthOrder.FRONT_TO_BACK,(H,J)=>{J<
L.near&&w(L,O,H)}),h.set(F,Math.max(L.far,O.near),O.far),M.forEachInDepthRange(F,z.DepthOrder.BACK_TO_FRONT,(H,J,N)=>{L.far=Math.max(L.far,N)}))}function w(L,O,I){if(I.visible&&f.intersectsSphere(O.frustum,I.boundingVolumeWorldSpace.bounds)){var H=I.transformation,J=E;I.geometries.forEach(N=>{p.multiply(J,H,N.shaderTransformation);const R=e.maxScale(J);r(L,O,N.boundingInfo,J,R)})}}function r(L,O,I,H,J){if(null!=I){q.transformMat4(C,I.center,H);var {eye:N,viewForward:R}=O,W=R[0]*(C[0]-N[0])+R[1]*(C[1]-
N[1])+R[2]*(C[2]-N[2]);C[3]=I.radius*J;if(!(W-C[3]>L.near&&W+C[3]<L.far)&&f.intersectsSphere(O.frustum,C))if(100<I.radius&&I.getChildren())for(const T of I.getChildren())r(L,O,T,H,J);else G.unionDepthRangeWithAABB(L,O.viewProjectionMatrix,H,I.bbMin,I.bbMax)}}function x(L,O,I){var H=O.eye;O=O.viewForward;H=(I[0]-H[0])*O[0]+(I[1]-H[1])*O[1]+(I[2]-H[2])*O[2];L.near=Math.min(L.near,H-I[3]);L.far=Math.max(L.far,H+I[3])}let D=function(){function L(){this._items=new y({allocator:I=>I||{obj:null,distance:0,
near:0,far:0},deallocator:I=>{I.obj=null;I.distance=0;I.near=0;I.far=0;return I}})}var O=L.prototype;O.clear=function(){this._items.clear()};O.add=function(I){this._items.pushNew().obj=I};O.sort=function(I){const H=I.eye,J=I.viewForward;this._items.forAll(N=>{const R=N.obj.boundingVolumeWorldSpace.bounds,W=(R[0]-H[0])*J[0]+(R[1]-H[1])*J[1]+(R[2]-H[2])*J[2];N.distance=W;N.near=W-R[3];N.far=W+R[3]});this._items.sort((N,R)=>N.distance-R.distance)};O.forEachInDepthRange=function(I,H,J){if(H===z.DepthOrder.FRONT_TO_BACK)for(H=
0;H<this._items.length;++H){var N=this._items.data[H];N.far<I.near||N.near>I.far||J(N.obj,N.near,N.far)}else for(H=this._items.length-1;0<=H;--H)N=this._items.data[H],N.far<I.near||N.near>I.far||J(N.obj,N.near,N.far)};b._createClass(L,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return L}(),A=function(){function L(){this._view=u.create();this._viewProj=u.create();this._frustum=f.create();this._geometries=[];this._near=[];this._far=
[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}var O=L.prototype;O.compute=function(I,H){this._reset();p.copy(this._view,I.viewMatrix);p.multiply(this._viewProj,I.projectionMatrix,this._view);f.copy(this._frustum,I.frustum);I=this._view;const J=I[2],N=I[6],R=I[10],W=I[14];H.forAll(Q=>Q.forEachGeometry(S=>{if(S.visible&&S.castShadow){var U=S.boundingSphere,V=J*U[0]+N*U[1]+R*U[2]+W,X=V-U[3];U=V+U[3];this._geometries.push(S);this._near.push(-U);this._far.push(-X)}}));
H=new h.DepthRange;if(0===this._geometries.length)return H;for(I=0;I<this._geometries.length;++I)this._near[I]>H.far&&(H.far=this._near[I]),2<this._near[I]&&this._far[I]<H.near&&(H.near=this._far[I]);I=this._looseRange;I.near=Math.max(.5*H.near,2);I.far=2*H.far;var T=0;let P=0;for(let Q=0;Q<this._geometries.length;++Q)this._near[Q]<H.near&&(this._near[Q]>=I.near?H.near=this._near[Q]:this._nearCandidates[T++]=Q),this._far[Q]>H.far&&(this._far[Q]<=I.far?H.far=this._far[Q]:this._farCandidates[P++]=Q);
if(0===this._nearCandidates.length&&0===this._farCandidates.length)return H;this._nearCandidates.sort((Q,S)=>this._near[Q]<this._near[S]?-1:this._near[Q]>this._near[S]?1:0);this._farCandidates.sort((Q,S)=>this._far[Q]<this._far[S]?1:this._far[Q]>this._far[S]?-1:0);for(I=0;I<this._nearCandidates.length;++I)T=this._nearCandidates[I],this._near[T]<H.near&&(T=this._geometries[T],this._includeNearBoundingInfoRec(T.boundingInfo,T.shaderTransformation,H));for(I=0;I<this._farCandidates.length;++I)T=this._farCandidates[I],
this._far[T]>H.far&&(T=this._geometries[T],this._includeFarBoundingInfoRec(T.boundingInfo,T.shaderTransformation,H));this._reset();return H};O._reset=function(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0};O._includeNearBoundingInfoRec=function(I,H,J){if(null!=I){q.transformMat4(C,I.center,H);var N=e.maxScale(H),R=C[0],W=C[1],T=C[2];N*=I.radius;var P=this._frustum;if(!(P[0][0]*R+P[0][1]*W+P[0][2]*T+P[0][3]>N||P[1][0]*
R+P[1][1]*W+P[1][2]*T+P[1][3]>N||P[2][0]*R+P[2][1]*W+P[2][2]*T+P[2][3]>N||P[3][0]*R+P[3][1]*W+P[3][2]*T+P[3][3]>N||(R=this._view[2]*R+this._view[6]*W+this._view[10]*T+this._view[14],W=R+N,2>-(R-N)||-W>=J.near)))if(-W>this._looseRange.near)J.near=-W;else{if(100<N&&(N=I.getChildren(),void 0!==N)){for(const Q of N)this._includeNearBoundingInfoRec(Q,H,J);return}G.unionDepthRangeWithAABB(J,this._viewProj,H,I.bbMin,I.bbMax)}}};O._includeFarBoundingInfoRec=function(I,H,J){if(null!=I){var N=I.radius;q.transformMat4(C,
I.center,H);var R=e.maxScale(H),W=C[0],T=C[1],P=C[2];N*=R;R=this._frustum;if(!(R[0][0]*W+R[0][1]*T+R[0][2]*P+R[0][3]>N||R[1][0]*W+R[1][1]*T+R[1][2]*P+R[1][3]>N||R[2][0]*W+R[2][1]*T+R[2][2]*P+R[2][3]>N||R[3][0]*W+R[3][1]*T+R[3][2]*P+R[3][3]>N||(W=this._view[2]*W+this._view[6]*T+this._view[10]*P+this._view[14]-N,-W<=J.far)))if(-W<this._looseRange.far)J.far=-W;else{if(100<N&&(N=I.getChildren(),void 0!==N)){for(const Q of N)this._includeFarBoundingInfoRec(Q,H,J);return}G.unionDepthRangeWithAABB(J,this._viewProj,
H,I.bbMin,I.bbMax)}}};return b._createClass(L)}(),v=function(){function L(){this._modelViewProj=u.create();this._clipPosition=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]}var O=L.prototype;O.unionDepthRangeWithAABB=function(I,H,J,N,R){var W=this._modelViewProj;p.multiply(W,H,J);H=!1;for(J=0;8>J;++J){const T=this._clipPosition[J],P=0===J||3===J||4===J||7===J?N[0]:R[0],Q=0===J||1===J||4===J||5===J?N[1]:R[1],S=4>J?N[2]:R[2];T[0]=W[0]*P+W[4]*Q+W[8]*S+W[12];
T[1]=W[1]*P+W[5]*Q+W[9]*S+W[13];T[2]=W[2]*P+W[6]*Q+W[10]*S+W[14];T[3]=W[3]*P+W[7]*Q+W[11]*S+W[15]}for(N=0;12>N;++N){R=this._clipTriangle(this._clipPosition[B[N][0]],this._clipPosition[B[N][1]],this._clipPosition[B[N][2]]);W=!0;for(J=0;J<R.length;++J)if(2<=R[J][3]){W=!1;break}if(!W)for(H=!0,W=0;W<R.length;++W)J=R[W][3],Number.isFinite(J)&&(I.near=Math.min(J,I.near),I.far=Math.max(J,I.far))}return H};O._inside=function(I,H){if(0===H)return I[0]>=-I[3];if(1===H)return I[1]>=-I[3];if(2===H)return I[0]<=
I[3];if(3===H)return I[1]<=I[3];n.assert(!1)};O._intersect=function(I,H,J){let N=0;0===J?N=(-I[3]-I[0])/(H[0]-I[0]+H[3]-I[3]):1===J?N=(-I[3]-I[1])/(H[1]-I[1]+H[3]-I[3]):2===J?N=(I[3]-I[0])/(H[0]-I[0]-H[3]+I[3]):3===J&&(N=(I[3]-I[1])/(H[1]-I[1]-H[3]+I[3]));return k.lerp(d.create(),I,H,N)};O._clipTriangle=function(I,H,J){I=[I,H,J];for(H=0;4>H;++H){J=I;I=[];for(let N=0;N<J.length;++N){const R=J[N],W=J[(N+1)%J.length];this._inside(W,H)?(this._inside(R,H)||I.push(this._intersect(R,W,H)),I.push(W)):this._inside(R,
H)&&I.push(this._intersect(R,W,H))}}return I};return b._createClass(L)}();const B=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],C=g.create(),E=u.create(),F=h.empty(),M=new D,K=new A,G=new v;a.DepthRangeFromRenderGeometries=A;a.depthRangeFromLayer=l;a.depthRangeFromScene=function(L,O,I){let H=0;if(!O.some(N=>{H+=N.numGeometries;return 1E4<=H}))return K.compute(L,O);const J=h.empty();I.forAll(N=>{N.visible&&h.union(J,l(L,N))});return J};a.textureToDepth=
function(L,O,I){return c.unpackFloatRGBA(O,L)*(I[1]-I[0])+I[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F){a.MagnifierHelper=function(M){function K(){var L=M.apply(this,arguments)||this;L._handles=new q;L._magnifier=null;L._imageSources=null;L._imageLoadTask=null;L._resources=null;L._passParameters=new A.MagnifierPassParameters;L.events=new u;L.attributeLocations=new Map([[D.VertexAttribute.POSITION,0]]);L._tmpScreenPoint=g.createScreenPointArray();L._tmpRenderPoint=g.createRenderScreenPointArray();return L}b._inherits(K,M);var G=K.prototype;
G.destroy=function(){this._magnifier=null;this._handles.destroy();null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};G.render=function(L,O){const I=this._validMagnifier;if(null!=I){var H=Math.ceil(O.camera.pixelRatio*I.size);this._updateResources(L,H);if(null!=this._resources){var J=this._passParameters.textures;H=Math.ceil(1/this._factor*H);J.input.resize(H,H);g.screenPointObjectToArray(I.position,this._tmpScreenPoint);var N=O.camera.screenToRender(this._tmpScreenPoint,
this._tmpRenderPoint),R=O.camera.fullHeight,W=.5*H,T=.5*H;N[0]=k.clamp(N[0],W,O.camera.fullWidth-W-1);N[1]=k.clamp(N[1],T,R-T-1);R=Math.floor(N[0]-W);N=Math.floor(N[1]-T);T=this._resources.program;T.bindTexture("textureInput",J.input);L.gl.copyTexImage2D(J.input.descriptor.target,0,J.input.descriptor.pixelFormat,R,N,H,H,0);this._passParameters.magnifier=I;L.useProgram(T);T.bindPass(this._passParameters,O);L.bindVAO(this._resources.vao);L.setPipelineState(this._resources.pipelineState);L.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,
0,4)}}};G._updateResourceLoading=function(){const L=this._validMagnifier;if(null!=L){var O=L.maskUrl,I=L.overlayUrl;null==this._imageLoadTask||this._imageLoadTask.maskUrl===O&&this._imageLoadTask.overlayUrl===I||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);null==this._imageSources&&null==this._imageLoadTask&&(this._imageLoadTask={maskUrl:O,overlayUrl:I,task:p.createTask(async H=>{const J=null==O||null==I?v.loadMagnifierResources(H):null,N=null!=O?t.requestImage(O,
{signal:H}):J.then(R=>R.mask);H=null!=I?t.requestImage(I,{signal:H}):J.then(R=>R.overlay);this._imageSources={mask:await N,overlay:await H};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};G._updateResources=function(L,O){this.enabled?null!=this._resources?this._passParameters.textures.size!==O&&(L=this._createTextureResources(L,O),null==L?this._disposeResources():(this._disposeTextureResources(this._passParameters.textures),
this._passParameters.textures=L)):(O=this._createTextureResources(L,O),null!=O&&(this._resources={program:this._createProgram(L),vao:r.createQuadVAO(L,w.Pos2,this.attributeLocations,0,1),pipelineState:C.makePipelineState({blending:C.simpleBlendingParams(B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:C.defaultColorWriteParams})},this._passParameters.textures=O)):this._disposeResources()};G._disposeResources=function(){null!=this._resources&&(this._disposeTextureResources(this._passParameters.textures),
this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};G._disposeTextureResources=function(L){L.mask.dispose();L.overlay.dispose();L.input.dispose()};G._createTextureResources=function(L,O){if(null==this._imageSources)return null;this._imageSources.overlay.width=O;this._imageSources.overlay.height=O;this._imageSources.mask.width=O;this._imageSources.mask.height=O;const I=new F.TextureDescriptor;I.internalFormat=B.PixelFormat.RGBA;I.wrapMode=B.TextureWrapMode.CLAMP_TO_EDGE;
I.flipped=!0;I.preMultiplyAlpha=!e.isSVG(this._imageSources.overlay.src)||!L.driverTest.svgPremultipliesAlpha.result;const H=new E.Texture(L,I,this._imageSources.overlay);I.pixelFormat=I.internalFormat=B.PixelFormat.ALPHA;I.preMultiplyAlpha=!1;const J=new E.Texture(L,I,this._imageSources.mask);I.pixelFormat=I.internalFormat=B.PixelFormat.RGBA;I.flipped=!1;return{input:new E.Texture(L,I),mask:J,overlay:H,size:O}};G._createProgram=function(L){return new x.Program(L,A.build(),this.attributeLocations)};
b._createClass(K,[{key:"updating",get:function(){return null==this._imageSources&&null!=this._imageLoadTask&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(L){L!==this._magnifier&&(this._handles.removeAll(),this._magnifier=L,L=()=>{this._updateResourceLoading();this.events.emit("request-render")},null!=this._magnifier&&this._handles.add(f.watch(()=>d.applySome(this._magnifier,O=>O.version),L)),L())}},{key:"enabled",get:function(){return null!=
this._validMagnifier}},{key:"_validMagnifier",get:function(){return null!=this._magnifier&&this._magnifier.visible&&null!=this._magnifier.position&&0<this._magnifier.size?this._magnifier:null}},{key:"_factor",get:function(){return null!=this._magnifier?this._magnifier.factor||1:1}}]);return K}(y);c.__decorate([h.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([h.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([h.property({readOnly:!0})],a.MagnifierHelper.prototype,
"updating",null);a.MagnifierHelper=c.__decorate([m.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=b._createClass(function(){}),h=function(m){function t(){var w=m.apply(this,arguments)||this;w.textures=new e;return w}b._inherits(t,m);return b._createClass(t)}(k.NoParameters);const z=c.createScreenPointArray(),n=c.createRenderScreenPointArray(),l=p.create();a.MagnifierPassParameters=h;a.TextureResources=e;a.build=function(){const m=new d.ShaderBuilder;m.attributes.add(g.VertexAttribute.POSITION,"vec2");m.vertex.uniforms.add(new q.Float4PassUniform("drawPosition",
(t,w)=>{var r=w.camera.pixelRatio;const x=t.magnifier.offset.x*r,D=t.magnifier.offset.y*r;c.screenPointObjectToArray(t.magnifier.position,z);const A=w.camera.screenToRender(z,n);t=Math.ceil(r*t.magnifier.size);r=w.camera.fullWidth;w=w.camera.fullHeight;return y.set(l,-1+(A[0]+x)/r*2,-1+(A[1]-D)/w*2,t/r*2,t/w*2)}));m.varyings.add("vUV","vec2");m.vertex.code.add(k.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);m.fragment.uniforms.add(new f.Texture2DPassUniform("textureInput",t=>t.textures.input));m.fragment.uniforms.add(new f.Texture2DPassUniform("textureMask",t=>t.textures.mask));m.fragment.uniforms.add(new f.Texture2DPassUniform("textureOverlay",t=>t.textures.overlay));m.fragment.uniforms.add(new u.BooleanPassUniform("maskEnabled",t=>t.magnifier.maskEnabled));m.fragment.uniforms.add(new u.BooleanPassUniform("overlayEnabled",t=>t.magnifier.overlayEnabled));m.fragment.code.add(k.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,y){const p=u=>Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(u){var q=new Promise((d,f)=>a(["./mask-svg"],g=>d(p(g)),f)),k=new Promise((d,f)=>a(["./overlay-svg"],g=>d(p(g)),f));q=y.requestImage((await q).default,
{signal:u});k=y.requestImage((await k).default,{signal:u});k={mask:await q,overlay:await k};c.throwIfAborted(u);return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,c,y,p){let u=function(){function q(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new p.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}var k=q.prototype;k.setUidToObjectAndLayerId=function(d,f,g,e,h,z=null,n=null,l=null){d&&f&&g&&e&&(this._layerUidToId.set(e,g),this._layerUidToPopupEnabled.set(e,h),h&&(g=this._layerUidToGraphicsUidToObjectId.get(e),g||(g=new Map,this._layerUidToGraphicsUidToObjectId.set(e,g)),
g.set(f,{objectId:d,attributeNodeId:z,attributeIndex:n,subLayerId:l})))};k.getObjectAndLayerIdColor=function(d){d=this.getObjectAndLayerIdColorArray(d);return y.fromValues(d.get(0,1),d.get(0,2),d.get(0,3),255)};k.getObjectAndLayerIdColorArray=function(d){if(!d.layerUid||!d.graphicUid)return this.colorZero;var f=this._layerUidToPopupEnabled.get(d.layerUid);if(void 0===f)return c.getLogger(this).warn("popupEnabled is undefined for layerUid "+d.layerUid),this.colorZero;if(!1===f)return this.colorZero;
let g=this._uidToRenderColor.get(d.layerUid);g||(g=new Map,this._uidToRenderColor.set(d.layerUid,g));f=g.get(d.graphicUid);if(!f){for(;!f;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(f=e)}if(16777215<f)throw Error("Object ID Overflow");g.set(d.graphicUid,f);this._colorToUID.set(f,d)}d=new ArrayBuffer(4);(new DataView(d)).setUint32(0,f,!1);return new p.BufferViewVec4u8(d)};k.getColorToObjectAndLayerIdMapping=function(){const d=new Map;for(const [g,e]of this._colorToUID.entries()){var f=
this._layerUidToGraphicsUidToObjectId.get(e.layerUid);let h=null;f?(h=f.get(e.graphicUid))||c.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+e.graphicUid):c.getLogger(this).warn("getColorMapping: no entry found for layerUid "+e.layerUid);(f=this._layerUidToId.get(e.layerUid))||c.getLogger(this).warn("no layerId found for uid "+e.layerUid);h&&f&&d.set(g,h.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:h.objectId,lid:f,attrId:h.attributeNodeId,attrIdx:h.attributeIndex,
subLayerId:h.subLayerId}:{type:"object-and-layer-id",oid:h.objectId,lid:f})}return d};return b._createClass(q)}();a.ObjectAndLayerIdRenderHelper=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDUniforms ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea){function ja(ba){return aa=>ba.immediate.schedule(aa)}a.Renderer=function(ba){function aa(ca,na,qa,ua,sa,pa,ka,ra){var va=ba.call(this,{})||this;va._stage=ca;va._materialRepository=na;va._techniqueRepository=ua;va._rctx=sa;va._compositingHelper=pa;va._magnifierHelper=ka;va._requestRender=ra;va._materialRenderers=new d;va._needsTransparentPass=!1;va._hasHUDElements=!1;va._hasHighlights=!1;va._hasWater=
!1;va._hasOverlayWater=!1;va._renderOverlay=Ca=>{};va._isRendering=!1;va._fallbackDepthStencilTexture=null;va._sliceHelper=new W;va._state=Z.RenderState.IDLE;va._renderStateFeatures=null;va._antialiasingEnabled=!0;va._highQualityTransparencyEnabled=!0;va._terrainRenderingEnabled=!0;va._terrainTransparency=t.TransparencyMode.Opaque;va._ssrEnabled=!1;va._ssaoEnabled=!1;va._hasAnimations=!1;va._animationTimestep=new D.AnimationTimeStep;va._handles=new u;va._renderHiddenTransparentEdges=()=>{};va._oitUsed=
!1;va.updateRenderFeature(ca.view.qualityProfile);va._smaaPass=new T.SmaaRenderPass(va._rctx,ua);ra();va._offscreen=new K.OffscreenRendering(va._rctx,va._compositingHelper);va.performanceInfo=new Y.RendererPerformanceInfo(va._rctx);va._shadowMap=new R.ShadowMap(va._rctx,ca.viewingMode);va._ssaoHelper=new P.SSAOHelper(ca.view,ua,va._rctx,ra);va._highlight=new F.Highlight(ua,va._rctx);va._shadowHighlight=new N.ShadowHighlight(va._rctx,ca.viewingMode);va._shadowAccumulator=new J.ShadowAccumulator(va._rctx,
ua,ca,Ca=>{const Ba=va.shadowsEnabled;va._shadowMap.enabled=!0;va._prepare(Ca.camera,Ca.contentCamera);va._renderPlugins.prepareRender();va._shadowMap.enabled=Ba},(Ca,Ba,Ha)=>{Ca.shadowMap.start(Ca.camera,Ba,Ha,!0,va._stage.view.qualitySettings.maximumPixelRatio);va._renderShadowCascades(r.ShaderOutput.Shadow,Ca.shadowMap);Ca.camera.setGLViewport(va._rctx);va._prepare(Ca.camera,Ca.contentCamera)},ra);va._renderContext=new G.RenderContext(va._rctx,va._offscreen,va._shadowMap,va._ssaoHelper,va._sliceHelper);
va._renderPlugins=new I.RenderPluginManager({renderContext:va._renderContext,techniqueRepository:ua,textureRepository:qa,materialRepository:va._materialRepository,requestRender:ra,controller:ca});va.renderPassManager=new w.RenderPassManager(va._rctx,va._techniqueRepository);va._renderPlugins.add(va.renderPassManager.slots(),va.renderPassManager);va._handles.add([f.watch(()=>va._stage.view.state.camera,()=>ra(),f.syncAndInitial),f.watch(()=>m.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Ca=>{va._renderHiddenTransparentEdges=
Ca?()=>va._renderEdges(U.Transparency.TRANSPARENT):()=>{};ra()},f.initial),f.watch(()=>va._ssaoEnabled||va.isFeatureEnabled(O.RenderFeature.SSAO),Ca=>va._ssaoHelper.enabled=Ca,f.syncAndInitial)]);return va}b._inherits(aa,ba);var da=aa.prototype;da.updateRenderFeature=function(ca=null,na=!q("disable-feature:high-quality-idle")){this._renderStateFeatures=O.setupFeatureDefaults(na,ca);this.notifyChange("_renderStateFeatures");this._requestRender()};da.isFeatureEnabled=function(ca,na=this._state){return this._renderStateFeatures?.get(na,
ca)??!1};da.setFeatureEnabled=function(ca,na,qa){this._renderStateFeatures?.set(na,ca,qa);this.notifyChange("_renderStateFeatures");this._requestRender()};da.normalizeCtorArgs=function(){return{}};da.destroy=function(){this._handles.destroy();this._smaaPass.dispose();this._gpuTimerHandle=k.removeMaybe(this._gpuTimerHandle);this._materialRenderers.forAll(ca=>ca.dispose());this._materialRenderers.clear();this._offscreen.dispose();this._fallbackDepthStencilTexture=k.disposeMaybe(this._fallbackDepthStencilTexture);
this._shadowMap.dispose();this._ssaoHelper.destroy();this._highlight.dispose();this._shadowHighlight.dispose();this._shadowAccumulator.dispose();this._edgeView=k.destroyMaybe(this._edgeView);this.renderPassManager.destroy();v.BoundingInfo.prune()};da.disposeOffscreenBuffers=function(){this._offscreen.dispose();this._shadowMap.disposeOffscreenBuffers();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};da.ensureEdgeView=function(){null==this._edgeView&&(this._edgeView=new S.EdgeView({rctx:this._rctx,
renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:ja(this._stage.view.resourceController)}),this._handles.add(f.watch(()=>k.applySome(this._edgeView,ca=>ca.updating),()=>this._requestRender(),f.sync)),this._requestRender());return this._edgeView};da.setParameters=function(ca){const {_shadowMap:na,_bindParameters:qa}=this;void 0!==ca.qualitySettings?.reflections&&this._ssrEnabled!==
ca.qualitySettings.reflections&&(this._ssrEnabled=ca.qualitySettings.reflections,this._requestRender());void 0!==ca.qualitySettings?.ambientOcclusion&&this._ssaoEnabled!==ca.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=ca.qualitySettings.ambientOcclusion,this._requestRender());void 0!==ca.shadowMap&&this._shadowMap.enabled!==ca.shadowMap&&(this._shadowMap.enabled=ca.shadowMap,this._requestRender());void 0!==ca.shadowMapMaxCascades&&na.maxCascades!==ca.shadowMapMaxCascades&&(na.maxCascades=
ca.shadowMapMaxCascades,this._requestRender());if(null!=ca.environment){null!=ca.environment.weather&&(this._bindParameters.weather=ca.environment.weather,this._bindParameters.weatherVisible=!!ca.weatherVisible);const ua="virtual"!==ca.environment.lighting.type;qa.enableFillLights!==ua&&(qa.enableFillLights=ua,this._requestRender())}ca.background&&this._offscreen.background!==ca.background&&(this._offscreen.background=ca.background,this._requestRender());void 0!==ca.antialiasingEnabled&&this._antialiasingEnabled!==
ca.antialiasingEnabled&&(this._antialiasingEnabled=ca.antialiasingEnabled,this._requestRender());void 0!==ca.highQualityTransparency&&this._highQualityTransparencyEnabled!==ca.highQualityTransparency&&(this._highQualityTransparencyEnabled=ca.highQualityTransparency,this._requestRender());void 0!==ca.defaultHighlightOptions&&(this._highlight.setDefaultOptions(ca.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(ca.defaultHighlightOptions),this._requestRender());void 0!==ca.overlays&&
this._bindParameters.overlays!==ca.overlays&&(this._bindParameters.overlays=ca.overlays,this._requestRender());void 0!==ca.hasOverlayWater&&this._hasOverlayWater!==ca.hasOverlayWater&&(this._hasOverlayWater=ca.hasOverlayWater,this._requestRender());void 0!==ca.renderOverlay&&this._renderOverlay!==ca.renderOverlay&&(this._renderOverlay=ca.renderOverlay,this._requestRender());void 0!==ca.slicePlane&&this._sliceHelper.plane!==ca.slicePlane&&(this._sliceHelper.plane=ca.slicePlane,this._requestRender());
void 0!==ca.terrainRenderingEnabled&&this._terrainRenderingEnabled!==ca.terrainRenderingEnabled&&(this._terrainRenderingEnabled=ca.terrainRenderingEnabled,this._requestRender());void 0!==ca.terrainTransparency&&this._terrainTransparency!==ca.terrainTransparency&&(this._terrainTransparency=ca.terrainTransparency,this._requestRender());void 0!==ca.shadowCastOptions&&this._shadowAccumulator.setOptions(ca.shadowCastOptions)};da.modify=function(ca,na){this._isRendering&&console.warn("Renderer.modify called while rendering");
const {adds:qa,removes:ua,updates:sa}=ca;if(0!==qa.length||0!==ua.length||0!==sa.length){var pa=!1;L.splitRenderGeometryChangeSetByMaterial(ca).forEach((ka,ra)=>{if(!na.done){var va=this._materialRenderers.find(Ca=>Ca.material===ra);null==va&&0<ka.adds.length&&(va=new V.MergedRenderer(this._rctx,this._materialRepository,ra),this._materialRenderers.push(va));va&&(va.modify(ka),va.isEmpty&&(pa=!0));ka.removes.forEach(Ca=>ca.removes.removeUnordered(Ca));ka.adds.forEach(Ca=>ca.adds.removeUnordered(Ca));
ka.updates.forEach(Ca=>ca.updates.removeUnordered(Ca));na.madeProgress()}});pa&&this._materialRenderers.filterInPlace(ka=>ka.isEmpty?(ka.dispose(),!1):!0);this._hasHighlights=this._materialRenderers.some(ka=>ka.hasHighlights);this._bindParameters.hasOccludees=this._materialRenderers.some(ka=>ka.hasOccludees);this._hasWater=this._materialRenderers.some(ka=>ka.hasWater);this._hasHUDElements=this._materialRenderers.some(ka=>ka.requiresSlot(H.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,r.ShaderOutput.Color)||
ka.requiresSlot(H.RenderSlot.HUD_MATERIAL,r.ShaderOutput.Color)||ka.requiresSlot(H.RenderSlot.LABEL_MATERIAL,r.ShaderOutput.Color));this._requestRender()}};da.updateAnimation=function(ca){const na=this._hasAnimations;this._hasAnimations=!1;this._materialRenderers.forAll(qa=>this._hasAnimations=qa.updateAnimation(ca)||this._hasAnimations);this._hasAnimations=this._renderPlugins.updateAnimation(ca)||this._hasAnimations;this._hasAnimations!==na&&(this._gpuTimerHandle=na?k.removeMaybe(this._gpuTimerHandle):
this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations};da.resetAnimation=function(){this._animationTimestep.clear()};da.render=function(ca,na,qa,ua,sa){this._isRendering=!0;this._oitUsed=!1;this.performanceInfo.startFrame();const {camera:pa,contentCamera:ka,mode:ra,alignPixelEnabled:va}=qa;this._state=ra;this._renderOverlay(sa);this.performanceInfo.advance(Y.PerformanceCategory.OVERLAY);this._renderContext.time=sa;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;
this._bindParameters.alignPixelEnabled=va;const Ca=this._offscreen;Ca.setupRenderTarget(this.hasReflections);qa=l.create(this._sliceHelper.plane);ua===A.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(ca);pa.setGLViewport(this._rctx);this._prepare(pa,ka);this._renderPlugins.prepareRender();this.performanceInfo.advance(Y.PerformanceCategory.PREPARE);const Ba=this._computeDepthRange(pa);this._renderShadowMap(ca,pa,this._bindParameters.lighting.mainLight.direction,Ba);this.performanceInfo.advance(Y.PerformanceCategory.SHADOW_MAP);
Ca.initializeFrame(pa);this._ensureBindParameters(pa,ka);const Ha=this._terrainRenderingEnabled&&(this._terrainTransparency===t.TransparencyMode.Semitransparent||this._terrainTransparency===t.TransparencyMode.TransparentWithDraped),Ma=this._highQualityTransparency&&Ha,Qa=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(Ma,Qa);this._renderLinearDepth();this.performanceInfo.advance(Y.PerformanceCategory.LINEAR_DEPTH);this._accumulateShadows(Ba,pa,ka);this.performanceInfo.advance(Y.PerformanceCategory.ACCUMULATED_SHADOWS);
this._renderNormal();this.performanceInfo.advance(Y.PerformanceCategory.NORMALS);this._ensureBindParametersSSR(sa);this._renderSSAO(sa);this.performanceInfo.advance(Y.PerformanceCategory.SSAO);this._renderContext.output=r.ShaderOutput.Color;Ca.bindFramebuffer();this._renderOpaqueGeometry();this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE);this._renderTerrainLinearDepth(Ma);this._setMultipassTerrain(Ma);this._renderEdges(U.Transparency.OPAQUE);this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE_EDGES);
this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth);this._renderSlot(H.RenderSlot.VOXEL);this.performanceInfo.advance(Y.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();Qa&&(this._oitEnabled?this._renderOITPass(ha.Geometry):this._renderTransparentGeometry());this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT);this._renderGeometryLinearDepth(Ma);sa=this._renderHUDVisibility(Ma);Ma||this._renderInternalSlot(H.RenderSlot.LINE_CALLOUTS);
this.performanceInfo.advance(Y.PerformanceCategory.HUD_VISIBILITY);this._renderObjectAndLayerIdColor(na);this.performanceInfo.advance(Y.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(U.Transparency.TRANSPARENT,Ma);this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_EDGES);this._renderTransparentTerrain();Ha&&sa&&(Ma?this._renderLineCallouts(x.HUDTransparencyRenderStyle.Occluded):Ca.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(x.HUDTransparencyRenderStyle.Occluded,
Ca.framebuffer),this.performanceInfo.advance(Y.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);Ha&&(Ca.compositeTransparentTerrainOntoMain(this._bindParameters),Ma&&(this._renderEdges(U.Transparency.OPAQUE),this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE_EDGES),Qa&&(this._oitEnabled?this._renderOITPass(ha.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT),
this._renderEdges(U.Transparency.TRANSPARENT),this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_EDGES)));Ma&&this._renderLineCallouts(x.HUDTransparencyRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);Ca.renderToTargets(()=>{this._renderInternalSlot(H.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(H.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(H.RenderSlot.LASERLINES)},Ca.currentColorTarget,
Ca.mainDepth);this.performanceInfo.advance(Y.PerformanceCategory.ENVIRONMENT);this._renderPlugins.needsLaserlineWithContrastControl&&Ca.renderTmpAndCompositeToMain(()=>this._renderSlot(H.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,X.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(Y.PerformanceCategory.LASER_LINE);this._renderOccluded();this.performanceInfo.advance(Y.PerformanceCategory.OCCLUDED);ua=(na=ua===A.Decorations.ON&&this._magnifierHelper.enabled)&&null==ca?this._offscreen.getFramebuffer(this._offscreen.tmpColor,
this._offscreen.tmpDepth):ca;this._rctx.bindFramebuffer(ua);sa=this._offscreen.colorTexture;this._renderAntiAliasing(sa)||null==sa||this._compositingHelper.composite(this._bindParameters,sa,X.AlphaMode.None);this.performanceInfo.advance(Y.PerformanceCategory.ANTIALIASING);this._renderHUD(x.HUDTransparencyRenderStyle.NotOccluded,ua);this.performanceInfo.advance(Y.PerformanceCategory.HUD);this._renderHighlights(ua,this._bindParameters);this.performanceInfo.advance(Y.PerformanceCategory.HIGHLIGHTS);
na&&this._magnifierHelper.render(this._rctx,this._bindParameters);ua!==ca&&(this._rctx.bindFramebuffer(ca),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,X.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=qa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.finishFrame()};da._prepareShaders=function(ca,na){this._renderContext.output=r.ShaderOutput.Color;
this._prepareOpaqueGeometrySlots();this._setMultipassTerrain(ca);this._prepareSlots(H.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);ca||this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.LINE_CALLOUTS);na&&this._prepareTransparencySlots();this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._prepareSlots(H.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,H.RenderSlot.LASERLINES);this._rctx.gl.flush()};da._renderObjectAndLayerIdColor=
function(ca){if(null!=ca&&q("enable-feature:objectAndLayerId-rendering")){const na=this._renderContext.output;this._rctx.bindFramebuffer(ca);this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0);this._rctx.bindFramebuffer(ca);this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=x.HUDTransparencyRenderStyle.NotOccluded;this._renderInternalSlot(H.RenderSlot.HUD_MATERIAL)},void 0,!0,!0);this._renderContext.output=
na}};da.finish=function(ca){this._hasAnimations||this._animationTimestep.clear();var na=this.performanceInfo.gpuSamplingEnabled;if((ca=ca===A.RenderRequestType.BACKGROUND)||na){const qa=ca?this.performanceInfo.elapsedTime:0;na=na?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(qa,na),ca)}};da.readDepthPixels=function(ca,na,qa){const ua=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);this._needsLinearDepth||
(this._ensureBindParameters(ca,ca),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ea.ClearBufferBit.COLOR_BUFFER_BIT|ea.ClearBufferBit.DEPTH_BUFFER_BIT|ea.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.Depth));ua.readPixels(na[0],na[1],na[2],na[3],ea.PixelFormat.RGBA,ea.PixelType.UNSIGNED_BYTE,qa)};da.readHUDVisibility=function(ca,na,qa,ua,sa){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(ca,
na,qa,ua,ea.PixelFormat.RGBA,ea.PixelType.UNSIGNED_BYTE,sa)};da.readAccumulatedShadow=function(ca){return this._shadowAccumulator.readAccumulatedShadow(ca[0],ca[1])};da._setMultipassTerrain=function(ca){this._setMultipassEnabled(ca);this._setTerrainCulling(ca)};da._setMultipassEnabled=function(ca){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=ca};da._setTerrainCulling=function(ca){this._bindParameters.multipassTerrain.cullAboveGround=ca};da._prepareSlots=
function(...ca){this._renderPlugins.prepareSlots(ca)};da._renderSlot=function(ca){this._bindParameters.slot=ca;this._renderPlugins.render()};da._renderEdges=function(ca,na=!1){const qa=this._edgeView;null!=qa&&qa.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>qa.render(this._bindParameters,ca),this._bindParameters,X.AlphaMode.Alpha,na)};da._renderShadowMap=function(ca,na,qa,ua){const sa=this._shadowMap;sa.enabled&&(sa.start(na,qa,ua,this.isFeatureEnabled(O.RenderFeature.HighResolutionShadows),
this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(na,qa),this._needsShadowHighlight?(this._renderShadowCascades(r.ShaderOutput.ShadowHighlight,this._shadowMap,pa=>sa.takeCascadeSnapshotTo(pa,R.SnapshotSlot.Highlight)),sa.clear(),this._renderShadowCascades(r.ShaderOutput.ShadowExcludeHighlight,this._shadowMap,pa=>{sa.takeCascadeSnapshotTo(pa,R.SnapshotSlot.Default);this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.ShadowHighlight)})):this._renderShadowCascades(r.ShaderOutput.Shadow),
sa.finish(ca),na.setGLViewport(this._rctx))};da._renderShadowCascades=function(ca,na=this._shadowMap,qa=ua=>{}){for(const ua of na.cascades)ua.camera.setGLViewport(this._rctx),this._prepare(ua.camera,ua.camera),this._renderGeometryAndTransparentTerrainPass(ca),qa(ua)};da._renderLinearDepth=function(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth);
this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture};da._renderTerrainLinearDepth=function(ca){ca?(ca=this._renderContext.output,this._renderContext.output=r.ShaderOutput.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.output=ca):this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=
this._offscreen.terrainLinearDepthTexture};da._renderGeometryLinearDepth=function(ca){ca?(ca=this._renderContext.output,this._offscreen.renderToTargets(()=>this._renderGeometryPass(r.ShaderOutput.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=ca):this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture};da._renderNormal=function(){this._needsNormal?
this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)};da._computeDepthRange=function(ca){if(!this._needsDepthRange)return B.ZERO;const na=C.depthRangeFromScene(ca,this._materialRenderers,this._stage.layers);B.union(na,this.renderPlugins.queryDepthRange(ca));na.near=Math.max(ca.near,na.near);na.far=Math.min(ca.far,na.far);return na};
da._renderGeometryAndTransparentTerrainPass=function(ca){this._renderContext.output=ca;this._prepareSlots(H.RenderSlot.TRANSPARENT_TERRAIN);this._renderGeometryPass(ca);this._renderTransparentTerrain()};da._renderGeometryPass=function(ca){this._renderContext.output=ca;this._prepareSlots(H.RenderSlot.TRANSPARENT_MATERIAL);this._renderOpaqueGeometry();this._renderTransparentGeometry()};da._renderSSAO=function(ca){this._ssaoHelper.render(this._bindParameters,ca,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)};
da._prepareOpaqueGeometrySlots=function(){this._prepareSlots(H.RenderSlot.INTEGRATED_MESH,H.RenderSlot.OPAQUE_TERRAIN,H.RenderSlot.OPAQUE_MATERIAL,H.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE);this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.OPAQUE_MATERIAL)};da._renderOpaqueGeometry=function(){this._renderSlot(H.RenderSlot.INTEGRATED_MESH);this._renderSlot(H.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(H.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(H.RenderSlot.OPAQUE_MATERIAL);
this._renderSlot(H.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};da._renderTransparentGeometry=function(){this._renderInternalSlot(H.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(H.RenderSlot.TRANSPARENT_MATERIAL)};da._renderTransparentTerrain=function(){this._renderSlot(H.RenderSlot.TRANSPARENT_TERRAIN)};da._renderHUDVisibility=function(ca){let na=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=
this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;na=this._renderInternalSlot(H.RenderSlot.OCCLUSION_PIXELS)},ca);return na};da._renderLineCallouts=function(ca){this._bindParameters.renderTransparentlyOccludedHUD=ca;ca===x.HUDTransparencyRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(H.RenderSlot.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(H.RenderSlot.LINE_CALLOUTS)};da._renderHUD=
function(ca,na){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(ha.HUD,ca),this._rctx.bindFramebuffer(na),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,X.AlphaMode.PremultipliedAlpha)):ca===x.HUDTransparencyRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(x.HUDTransparencyRenderStyle.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(ca))};da._renderHUDElements=
function(ca){this._bindParameters.renderTransparentlyOccludedHUD=ca;this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,H.RenderSlot.HUD_MATERIAL,H.RenderSlot.LABEL_MATERIAL);this._renderInternalSlot(H.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(H.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(H.RenderSlot.LABEL_MATERIAL)};da._renderHighlights=function(ca,na){if(this._needsHighlight){var qa=this._highlight,ua=this._offscreen.renderToTargets(()=>
{this._renderGeometryAndTransparentTerrainPass(r.ShaderOutput.Highlight);this._rctx.clearSafe(ea.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(x.HUDTransparencyRenderStyle.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=ua.colorTexture;this._needsShadowHighlight&&this._shadowHighlight.render(na,ca);qa.render(this._bindParameters,ua,ca)}else this._offscreen.disposeTarget(this._offscreen.highlight)};da._accumulateShadows=
function(ca,na,qa){this._needsShadowCast&&null!=this._offscreen.linearDepthTexture&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,ca,na,qa)};da._prepareTransparencySlots=function(){this._renderContext.output=r.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=Q.TransparencyPassType.Alpha;this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.TRANSPARENT_MATERIAL);this._prepareSlots(H.RenderSlot.TRANSPARENT_MATERIAL);this._renderContext.output=r.ShaderOutput.Color;
this._bindParameters.transparencyPassType=Q.TransparencyPassType.Color;this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.TRANSPARENT_MATERIAL);this._prepareSlots(H.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=Q.TransparencyPassType.FrontFace;this._prepareInternalSlots(this._materialRenderers,H.RenderSlot.TRANSPARENT_MATERIAL);this._prepareSlots(H.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE};da._renderOITPass=
function(ca,na=x.HUDTransparencyRenderStyle.Both){const qa=ca===ha.HUD,ua=qa?()=>this._renderHUDElements(na):()=>this._renderTransparentGeometry();ca=pa=>{this._bindParameters.transparencyPassType=pa;this._offscreen.renderOITPass(ua,pa,qa)};const sa=this._renderContext.output;this._renderContext.output=r.ShaderOutput.Alpha;ca(Q.TransparencyPassType.Alpha);this._renderContext.output=r.ShaderOutput.Color;ca(Q.TransparencyPassType.Color);ca(Q.TransparencyPassType.FrontFace);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,
qa);this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._renderContext.output=sa;this._oitUsed=!0};da._disposeOITBuffers=function(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))};da._renderOccluded=function(){let ca=0;ia.clear();this._materialRenderers.forAll(pa=>{pa.material&&pa.material.isVisible()&&pa.material.renderOccluded===
M.RenderOccludedFlag.OccludeAndTransparentStencil&&(ca|=pa.material.renderOccluded,ia.push(pa))});const na=this._offscreen,qa=(pa,ka,ra,va,Ca)=>{0!==(ca&ka)&&(na.renderToTargets(ra,na.tmpColor,na.mainDepth,[0,0,0,0],va,Ca),na.compositeOccludedOntoMain(this._bindParameters,pa))};0!==ia.length&&(this._prepareInternalSlots(ia,H.RenderSlot.OCCLUDER_MATERIAL,H.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(H.RenderSlot.OCCLUDER_MATERIAL,ia),qa(.5,M.RenderOccludedFlag.OccludeAndTransparentStencil,
()=>this._renderInternalSlot(H.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ia),!1,!1));ia.clear();this._materialRenderers.forAll(pa=>{pa.material&&pa.material.isVisible()&&(pa.material.renderOccluded===M.RenderOccludedFlag.OccludeAndTransparent||pa.material.renderOccluded===M.RenderOccludedFlag.Transparent||pa.material.renderOccluded===M.RenderOccludedFlag.Opaque)&&(ca|=pa.material.renderOccluded,ia.push(pa))});const ua=this._renderPlugins.renderOccludedFlags;if(ca|=ua){var sa=pa=>{this._renderContext.renderOccludedMask=
pa;this._prepareInternalSlots(ia,H.RenderSlot.OPAQUE_MATERIAL,H.RenderSlot.TRANSPARENT_MATERIAL,H.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);ua>M.RenderOccludedFlag.Occlude&&this._renderSlot(H.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(H.RenderSlot.OPAQUE_MATERIAL,ia);this._renderInternalSlot(H.RenderSlot.TRANSPARENT_MATERIAL,ia);this._renderInternalSlot(H.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ia);this._renderContext.resetRenderOccludedMask()};this._renderContext.output=
r.ShaderOutput.Color;qa(.5,M.RenderOccludedFlag.OccludeAndTransparent,()=>sa(M.RenderOccludedFlag.OccludeAndTransparent),!0,A.StencilBits.OutlineVisualElementMask);qa(.5,M.RenderOccludedFlag.Transparent,()=>sa(M.RenderOccludedFlag.Transparent),!0,A.StencilBits.OutlineVisualElementMask);qa(1,M.RenderOccludedFlag.Opaque,()=>sa(M.RenderOccludedFlag.Opaque),!0,A.StencilBits.OutlineVisualElementMask);ia.clear()}};da._renderAntiAliasing=function(ca){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&
null!=ca)return this._smaaPass.render(ca),!0}else this._smaaPass.disable();return!1};da._prepare=function(ca,na){this._needsTransparentPass=this._materialRenderers.some(qa=>qa.requiresSlot(H.RenderSlot.TRANSPARENT_MATERIAL,r.ShaderOutput.Color));this._bindParameters.camera=ca;this._bindParameters.contentCamera=na};da._ensureBindParameters=function(ca,na){this._bindParameters.camera=ca;this._bindParameters.contentCamera=na;ca=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=
ca.hudVisibilityTexture;this._bindParameters.mainColorTexture=ca.mainColorTexture;this._bindParameters.highlightDepthTexture=ca.depthTexture??this._getFallbackDepthTexture()};da._ensureBindParametersSSR=function(ca){this._bindParameters.ssr.enabled=this.hasReflections;if(this._bindParameters.ssr.enabled){null==this._ssrEnableTime&&(this._ssrEnableTime=ca);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=n.IDENTITY:(z.invert(ma,this._bindParameters.camera.viewMatrix),
z.invert(oa,this._bindParameters.camera.projectionMatrix),z.multiply(fa,ma,oa),z.multiply(fa,this._renderContext.lastFrameCamera.viewMatrix,fa),z.multiply(fa,this._renderContext.lastFrameCamera.projectionMatrix,fa),this._reprojectionMatrix=fa);this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const na=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=0<na?Math.min(na,ca-this._ssrEnableTime)/na:1;1>this._bindParameters.ssr.fadeFactor&&
this._requestRender()}else this._reprojectionMatrix=n.IDENTITY,this._ssrEnableTime=this._bindParameters.ssr.lastFrameColorTexture=null};da._prepareInternalSlots=function(ca,...na){for(const qa of na)this._bindParameters.slot=qa,ca.forAll(ua=>{ua.material.shouldRender(this._renderContext)&&ua.prepareTechnique(this._renderContext)})};da._renderInternalSlot=function(ca,na=this._materialRenderers){let qa=!1;this._bindParameters.slot=ca;na.forAll(ua=>{if(ua.material.shouldRender(this._renderContext)){const sa=
ua.prepareTechnique(this._renderContext);null!=sa&&(ua.render(this._renderContext,sa),qa=!0)}});return qa};da._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=E.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(aa,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"_antialiasing",get:function(){return this._antialiasingEnabled||this.isFeatureEnabled(O.RenderFeature.Antialiasing)}},
{key:"_highQualityTransparency",get:function(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(O.RenderFeature.HighQualityTransparency)}},{key:"hasReflections",get:function(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(O.RenderFeature.WaterReflection))}},{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"updating",get:function(){return this._antialiasing&&this._smaaPass.updating||null!=this._edgeView&&this._edgeView.updating||
this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return z.equals(this._bindParameters.ssr.reprojectionMatrix,n.IDENTITY)}},{key:"_reprojectionMatrix",set:function(ca){p.update(this._bindParameters.ssr.reprojectionMatrix,ca)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){return!!this._shadowMap?.enabled}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},
{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlend.result}},{key:"_oitEnabled",get:function(){return this._highQualityTransparency&&this._hasOITSupport}},{key:"animationTimestep",get:function(){return this._animationTimestep.value}},{key:"animationTimeDilation",get:function(){return this._animationTimestep.timeDilation}},{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||
this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}},{key:"_needsNormal",get:function(){return this._ssaoHelper.active}},{key:"_needsDepthRange",get:function(){return this._shadowMap.enabled||this._needsShadowCast}},{key:"_needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"_needsShadowHighlight",get:function(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}},{key:"_needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},
{key:"gpuMemoryUsage",get:function(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}},{key:"test",get:function(){const ca=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,
weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{ca._renderStateFeatures=O.setupFeatureDefaults()},getFramebufferTexture:na=>{switch(na){case a.FramebufferId.Color:return ca._offscreen.colorTexture;case a.FramebufferId.LinearDepth:return ca._offscreen.linearDepthTexture;case a.FramebufferId.Normals:return ca._offscreen.normalTexture;case a.FramebufferId.ShadowMap:return ca._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return ca._offscreen.hudVisibilityTexture;
case a.FramebufferId.Highlight:return ca._offscreen.highlightTexture}}}}}]);return aa}(y);c.__decorate([g.property()],a.Renderer.prototype,"_renderPlugins",void 0);c.__decorate([g.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);c.__decorate([g.property()],a.Renderer.prototype,"_state",void 0);c.__decorate([g.property()],a.Renderer.prototype,"_renderStateFeatures",void 0);c.__decorate([g.property()],a.Renderer.prototype,"_antialiasingEnabled",void 0);c.__decorate([g.property({readOnly:!0})],
a.Renderer.prototype,"_antialiasing",null);c.__decorate([g.property()],a.Renderer.prototype,"_ssaoEnabled",void 0);c.__decorate([g.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([g.property({autoDestroy:!0})],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([g.property()],a.Renderer.prototype,"updating",null);c.__decorate([g.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);var ha;
(function(ba){ba[ba.Geometry=0]="Geometry";ba[ba.HUD=1]="HUD"})(ha||(ha={}));a.FramebufferId=void 0;(function(ba){ba[ba.Color=0]="Color";ba[ba.LinearDepth=1]="LinearDepth";ba[ba.Normals=2]="Normals";ba[ba.ShadowMap=3]="ShadowMap";ba[ba.HudVisibility=4]="HudVisibility";ba[ba.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const ia=new d,oa=n.create(),ma=n.create(),fa=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=function(){function t(r,x){this.rctx=r;this.shaderTechniqueRepository=x;this.canRender=!0;this._materialPassParameters=new k.MaterialPassParameters;this._shadowPassParameters=new k.ShadowMapPassParameters;this._highlightPassParameters=new k.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new d.RenderPass(r,x),materialTransparent:new d.RenderPass(r,x,d.RenderPassSorting.BackToFront),materialIntegratedMesh:new d.RenderPass(r,x),shadowMap:new d.RenderPass(r,
x),highlight:new d.RenderPass(r,x),highlightIntegratedMesh:new d.RenderPass(r,x),highlightShadowMap:new d.RenderPass(r,x),defaultShadowMap:new d.RenderPass(r,x)}}var w=t.prototype;w.destroy=function(){this._context=null;this._systems.clear()};w.register=function(r){this._systems.add(r)};w.prepareRender=function(r){if(0!==this._systems.size){for(const x of Object.values(this._passes))x.prepareSubmit();this._systems.forEach(x=>x.submit(this._passes,r.bindParameters));for(const x of Object.values(this._passes))x.finishSubmit();
this.shaderTechniqueRepository.frameUpdate()}};w.prepareTechniques=function(r){if(0===this._systems.size)return null;this._configure(r);this._materialPassParameters.output=r.output;return this._invoke(r,(x,D)=>x.prepare(D,r.bindParameters))};w.render=function(r,x){this._invoke(r,(D,A)=>D.dispatch(A,r.bindParameters,x))};w._invoke=function(r,x){switch(r.bindParameters.slot){case h.RenderSlot.OPAQUE_MATERIAL:switch(r.output){case f.ShaderOutput.Color:case f.ShaderOutput.Depth:case f.ShaderOutput.Normal:case f.ShaderOutput.ObjectAndLayerIdColor:return x(this._passes.materialOpaque,
this._materialPassParameters);case f.ShaderOutput.Highlight:return x(this._passes.highlight,this._highlightPassParameters);case f.ShaderOutput.Shadow:return x(this._passes.shadowMap,this._shadowPassParameters);case f.ShaderOutput.ShadowHighlight:return x(this._passes.highlightShadowMap,this._shadowPassParameters);case f.ShaderOutput.ShadowExcludeHighlight:return x(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case h.RenderSlot.TRANSPARENT_MATERIAL:switch(r.output){case f.ShaderOutput.Color:case f.ShaderOutput.Alpha:case f.ShaderOutput.Depth:case f.ShaderOutput.Normal:case f.ShaderOutput.ObjectAndLayerIdColor:return x(this._passes.materialTransparent,
this._materialPassParameters)}break;case h.RenderSlot.INTEGRATED_MESH:switch(r.output){case f.ShaderOutput.Color:case f.ShaderOutput.Depth:case f.ShaderOutput.Normal:case f.ShaderOutput.ObjectAndLayerIdColor:return x(this._passes.materialIntegratedMesh,this._materialPassParameters);case f.ShaderOutput.Highlight:return x(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null};w.notifyDirty=function(){this._context.requestRender()};w.slots=function(){return[h.RenderSlot.OPAQUE_MATERIAL,
h.RenderSlot.TRANSPARENT_MATERIAL,h.RenderSlot.INTEGRATED_MESH]};w.initializeRenderContext=function(r){this._context=r};w.uninitializeRenderContext=function(){};w.queryDepthRange=function(r){const x={near:Infinity,far:-Infinity};this._systems.forEach(D=>{D=D.queryShadowCasterDepthRange(r);null!=D&&e.union(x,D,x)});return x};w._configure=function(r){this._updateParameters(r,r.output===f.ShaderOutput.Shadow||r.output===f.ShaderOutput.ShadowHighlight||r.output===f.ShaderOutput.ShadowExcludeHighlight?
this._shadowPassParameters:r.output===f.ShaderOutput.Highlight?this._highlightPassParameters:this._materialPassParameters)};w._updateParameters=function(r,x){const D=r.bindParameters.camera,A=D.viewInverseTransposeMatrix;u.set(n,A[3],A[7],A[11]);m.set(n);u.copy(x.transformWorldFromViewTH,m.high);u.copy(x.transformWorldFromViewTL,m.low);u.copy(x.slicePlaneLocalOrigin,n);c.fromMat4(x.transformViewFromCameraRelativeRS,D.viewMatrix);p.copy(x.transformProjFromView,D.projectionMatrix);x.identifier===k.RenderPassIdentifier.Material&&
(this._materialPassParameters.transparent=r.bindParameters.slot===h.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=r.bindParameters.slot===h.RenderSlot.INTEGRATED_MESH,c.transpose(l,x.transformViewFromCameraRelativeRS),c.invert(x.transformNormalViewFromGlobal,l))};b._createClass(t,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);
return t}();const n=q.create(),l=y.create(),m=new g.TwoVectorPosition;a.RenderPassManager=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(a,b,c,y,p){a.RenderPassSorting=void 0;(function(k){k[k.FrontToBack=0]="FrontToBack";k[k.BackToFront=1]="BackToFront"})(a.RenderPassSorting||
(a.RenderPassSorting={}));let u=function(){function k(f,g,e=a.RenderPassSorting.FrontToBack){this._rctx=f;this._techniqueRepository=g;this._sorting=e;this._draws=new c({initialSize:32,allocator:h=>h||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var d=k.prototype;d.submitDraw=function(f,g,e,h){const z=this._draws.pushNew();z.geometry=g;z.geometryRanges=e;z.material=f;z.depthSquaredHint=h;z.indexType=(g.indexed?
g.vao.indexBuffer.indexType:null)??0};d.prepare=function(f,g){return this._draws.map(e=>e.material.prepareTechnique(this._techniqueRepository,f,g,e.geometry.parameters))};d.dispatch=function(f,g,e){const h=this._rctx;this._previouslyBoundDraw.clear();let z=null;const n=this._draws.length;for(let t=0;t<n;t++){var l=e[t];if(l!==z||l.configuration.transparencyPassType!==y.TransparencyPassType.NONE)h.bindTechnique(l,f,g),z=l;var m=this._draws.data[t];const w=m.geometry;h.bindVAO(w.vao);this._previouslyBoundDraw.get(l)!==
m.material&&(l.program.bindDraw(m.material,g,f),this._previouslyBoundDraw.set(l,m.material));l=m.geometryRanges;const r=l.length;if(0!==m.indexType){const x=q.get(m.indexType);for(let D=0;D<r;D+=2)h.drawElements(w.primitiveType,l[D+1],m.indexType,l[D]*x)}else for(m=0;m<r;m+=2)h.drawArrays(w.primitiveType,l[m],l[m+1])}};d.prepareSubmit=function(){this._draws.clear()};d.finishSubmit=function(){const f=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((g,e)=>{const h=f*(g.depthSquaredHint-
e.depthSquaredHint);return 0!==h?h:g.geometry.vao.byteSize-e.geometry.vao.byteSize})};b._createClass(k,[{key:"count",get:function(){return this._draws.length}}]);return k}();const q=new Map;q.set(p.DataType.UNSIGNED_BYTE,1);q.set(p.DataType.UNSIGNED_SHORT,2);q.set(p.DataType.UNSIGNED_INT,4);a.RenderPass=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has",
"../../../../core/mathUtils","../../../../core/time"],function(a,b,c,y,p){let u=function(){function g(){this._step=d;this._dilation=1;this._firstIdleTime=p.Milliseconds(0)}var e=g.prototype;e.frame=function(h,z){z?0===this._firstIdleTime&&(this._firstIdleTime=p.Milliseconds(performance.now())):this._firstIdleTime=p.Milliseconds(0);if(c("disable-feature:high-quality-idle"))this._dilation=1;else{z=z?performance.now()-this._firstIdleTime:0;if(z>=q+k){this._step=p.Milliseconds(Infinity);this._dilation=
1;return}this._dilation=z>=q?10:1}h=y.clamp(h/.5,d,f);this._step=Infinity===this._step?p.Milliseconds(h):p.Milliseconds(.9*this._step+h*(1-.9))};e.clear=function(){this._step=this._firstIdleTime=p.Milliseconds(0)};b._createClass(g,[{key:"value",get:function(){return this._step}},{key:"timeDilation",get:function(){return this._dilation}}]);return g}();const q=p.Milliseconds(12E4),k=p.Milliseconds(1E4),d=p.Milliseconds(1E3),f=p.Milliseconds(1E3/30);a.AnimationTimeStep=u;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./VertexArrayObject ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){let D=function(){function A(B,C){this._techniqueRep=B;this._rctx=C;this._viewportToRestore=u.create();this._passParameters=new l.HighlightPassParameters;this._downsampleDrawParameters=new z.HighlightDownsampleDrawParameters;this._blurDrawParameters=new e.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var v=A.prototype;
v._assertResources=function(){if(!this._quadVAO){this._quadVAO=d.createQuadVAO(this._rctx);var B=new r.TextureDescriptor;B.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;this._blur0Fbo=new w.FramebufferObject(this._rctx,B);this._blur1Fbo=new w.FramebufferObject(this._rctx,B);this._blurTechnique=this._techniqueRep.acquire(h.HighlightBlurTechnique);this._downsampleTechnique=this._techniqueRep.acquire(n.HighlightDownsampleTechnique);this._applyTechnique=this._techniqueRep.acquire(g.HighlightApplyTechnique)}};
v.dispose=function(){this._blurTechnique=c.releaseMaybe(this._blurTechnique);this._downsampleTechnique=c.releaseMaybe(this._downsampleTechnique);this._applyTechnique=c.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let B=1;B<this._grid.coverageMipmap.length;B++)this._grid.coverageMipmap[B].dispose();this._grid.vao&&this._grid.vao.dispose();this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null);this._blur0Fbo=c.disposeMaybe(this._blur0Fbo);this._blur1Fbo=c.disposeMaybe(this._blur1Fbo)};
v.setDefaultOptions=function(B){this._passParameters={...(new l.HighlightPassParameters),...B}};v.render=function(B,C,E){this._passParameters.highlightColorTexture=C.colorTexture;this._assertResources();var F=B.camera;p.copy(this._viewportToRestore,F.fullViewport);var M=F.pixelRatio;const K=Math.ceil(F.fullWidth/M);F=Math.ceil(F.fullHeight/M);this._blur0Fbo.resize(K,F);this._blur1Fbo.resize(K,F);M=this._rctx;M.bindVAO(this._quadVAO);let G=null;this._gridUpdateResources(C,32);this._gridComputeMipmap(B);
this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;G=this._grid.vao;const L=M.bindTechnique(this._blurTechnique,this._passParameters,B);M.bindVAO(G);M.bindFramebuffer(this._blur0Fbo);M.setViewport(0,0,K,F);M.setClearColor(0,0,0,0);M.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=C.colorTexture;y.set(this._blurDrawParameters.blurSize,1/K,0);L.bindDraw(this._blurDrawParameters,B,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,
0,x.vertexCount(G,"geometry"));M.bindFramebuffer(this._blur1Fbo);M.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture;y.set(this._blurDrawParameters.blurSize,0,1/F);L.bindDraw(this._blurDrawParameters,B,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,0,x.vertexCount(G,"geometry"));M.bindFramebuffer(E);M.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]);
this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture;M.bindTechnique(this._applyTechnique,this._passParameters,B);M.drawArrays(this._applyTechnique.primitiveType,0,x.vertexCount(G,"geometry"));M.bindVAO(null)};v._gridUpdateResources=function(B,C){const E=this._rctx,F=this._grid;var M=!1;null===F.coverageMipmap&&(F.coverageMipmap=[B],M=!0);if(F.viewportWidth!==B.width||F.viewportHeight!==B.height)M=!0,F.viewportWidth=B.width,F.viewportHeight=B.height;F.coverageMipmap[0]=B;F.cellPixelSize!==
C&&(F.cellPixelSize=C,M=!0);if(M){for(C=1;C<F.coverageMipmap.length;C++)F.coverageMipmap[C].dispose();F.mipmapLevels=Math.ceil(Math.log(F.cellPixelSize)*Math.LOG2E);F.coverageMipmap.length=F.mipmapLevels+1;for(C=0;C<F.mipmapLevels;C++)M=F.coverageMipmap[C],M=new r.TextureDescriptor(Math.ceil(M.width/2),Math.ceil(M.height/2)),M.pixelFormat=t.PixelFormat.RGB,M.dataType=t.PixelType.UNSIGNED_SHORT_5_6_5,M.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,F.coverageMipmap[C+1]=new w.FramebufferObject(E,M)}M=Math.ceil(B.height/
F.cellPixelSize);var K=Math.ceil(B.width/F.cellPixelSize);if(!F.vao||F.verticalCellCount!==M||F.horizontalCellCount!==K){F.verticalCellCount=M;F.horizontalCellCount=K;B=M+1;C=K+1;M=1/M;K=1/K;const G=new Float32Array(24*B*C);let L=0;for(let O=0;O<B;O++)for(let I=0;I<C;I++)G[L]=(I-.5)*K*2-1,G[L+1]=(O-.5)*M*2-1,G[L+2]=I*K,G[L+3]=O*M,G[L+4]=(I+.5)*K*2-1,G[L+5]=(O-.5)*M*2-1,G[L+6]=I*K,G[L+7]=O*M,G[L+8]=(I-.5)*K*2-1,G[L+9]=(O+.5)*M*2-1,G[L+10]=I*K,G[L+11]=O*M,G[L+12]=(I-.5)*K*2-1,G[L+13]=(O+.5)*M*2-1,G[L+
14]=I*K,G[L+15]=O*M,G[L+16]=(I+.5)*K*2-1,G[L+17]=(O-.5)*M*2-1,G[L+18]=I*K,G[L+19]=O*M,G[L+20]=(I+.5)*K*2-1,G[L+21]=(O+.5)*M*2-1,G[L+22]=I*K,G[L+23]=O*M,L+=24;F.vao&&F.vao.dispose();F.vao=new f.VertexArrayObject(E,q.Default3D,{geometry:k.Pos2Tex},{geometry:m.BufferObject.createVertex(E,t.Usage.STATIC_DRAW,G)})}};v._gridComputeMipmap=function(B){const C=this._rctx,E=this._grid,F=C.bindTechnique(this._downsampleTechnique,this._passParameters,B);C.bindVAO(this._quadVAO);for(let M=0;M<E.mipmapLevels;M++){C.bindFramebuffer(E.coverageMipmap[M+
1]);const K=E.coverageMipmap[M+1].width,G=E.coverageMipmap[M+1].height;this._downsampleDrawParameters.inputTexture=E.coverageMipmap[M].colorTexture;y.set(this._downsampleDrawParameters.invFramebufferDim,1/K,1/G);F.bindDraw(this._downsampleDrawParameters,B,this._passParameters);C.setViewport(0,0,K,G);C.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,x.vertexCount(this._quadVAO,"geometry"))}};b._createClass(A,[{key:"gpuMemoryUsage",get:function(){let B=(null!=this._blur0Fbo?this._blur0Fbo.gpuMemoryUsage:
0)+(null!=this._blur1Fbo?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const C of this._grid.coverageMipmap)B+=C.gpuMemoryUsage;return B}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}]);return A}();a.Highlight=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){p=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new q.Program(z.rctx,e.shader.get().build(),u.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(p.ShaderTechnique);
p.shader=new y.ReloadableShaderModule(k.HighlightApply,()=>new Promise((g,e)=>a(["./HighlightApply.glsl"],g,e)));b.HighlightApplyTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k){function d(){const g=new u.ShaderBuilder,{vertex:e,fragment:h}=g,z=e.code,n=h.code;g.attributes.add(k.VertexAttribute.POSITION,"vec2");g.varyings.add("uv","vec2");g.attributes.add(k.VertexAttribute.UV0,"vec2");e.uniforms.add(new q.Texture2DPassUniform("coverageTex",l=>l.coverageTexture));z.add(p.glsl`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);h.uniforms.add(new q.Texture2DPassUniform("tex",l=>l.blurColorTexture),new q.Texture2DPassUniform("origin",l=>l.highlightColorTexture),new y.Float4PassUniform("uColor",l=>l.color),new y.Float4PassUniform("haloColor",l=>l.haloColor),new y.Float4PassUniform("opacities",l=>b.set(f,l.haloOpacity,l.haloOpacityOccluded,l.fillOpacity,l.fillOpacityOccluded)));h.constants.add("outlineSize","float",8.6);h.constants.add("blurSize","float",.4);n.add(p.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return g}const f=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=c;a.build=d})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(){const h=new u.ShaderBuilder,{vertex:z,fragment:n}=h,l=z.code,m=n.code;h.attributes.add(d.VertexAttribute.POSITION,"vec2");h.attributes.add(d.VertexAttribute.UV0,"vec2");h.varyings.add("blurCoordinate","vec3");z.uniforms.add(new k.Texture2DPassUniform("coverageTex",t=>t.coverageTexture));n.uniforms.add(new y.Float2DrawUniform("blurSize",t=>t.blurSize));l.add(p.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);n.uniforms.add(new q.Texture2DDrawUniform("tex",t=>t.blurInputTexture));m.add(p.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return h}let g=function(h){function z(){var n=h.apply(this,arguments)||this;n.blurSize=c.create();return n}b._inherits(z,h);return b._createClass(z)}(p.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:g,build:f},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=e;a.HighlightBlurDrawParameters=g;a.build=f})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.HighlightBlur,()=>new Promise((f,g)=>a(["./HighlightBlur.glsl"],f,g)));b.HighlightBlurTechnique=
p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,y,p,u,q,k){function d(){const e=
new u.ShaderBuilder,{vertex:h,fragment:z}=e,n=h.code,l=z.code;e.attributes.add(k.VertexAttribute.POSITION,"vec2");n.add(p.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);z.uniforms.add(new q.Texture2DDrawUniform("tex",m=>m.inputTexture));z.uniforms.add(new y.Float2DrawUniform("invFramebufferDim",m=>m.invFramebufferDim));l.add(p.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return e}let f=function(e){function h(){var z=e.apply(this,arguments)||this;z.invFramebufferDim=c.create();return z}b._inherits(h,e);return b._createClass(h)}(p.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=g;a.HighlightDownsampleDrawParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.HighlightDownsample,()=>new Promise((f,g)=>a(["./HighlightDownsample.glsl"],f,g)));b.HighlightDownsampleTechnique=
p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,b,c,y,p){p=function(u){function q(){var k=u.apply(this,arguments)||this;k.color=c.fromValues(1,0,1,1);k.haloColor=c.fromValues(1,0,1,1);k.haloOpacity=1;k.haloOpacityOccluded=.25;k.fillOpacity=.2;
k.fillOpacityOccluded=.05;k.shadowColor=y.fromValues(1,0,1,1);k.shadowOpacity=.15;k.occludedShadowOpacity=.075;return k}b._inherits(q,u);return b._createClass(q)}(p.NoParameters);a.HighlightPassParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ./RenderTargetHelper ./TransparencyPassType ../shaders/CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,c,y,p,u,q,k){c=function(){function g(h,z){this._rctx=h;this._compositingHelper=z;this._mainColorTarget=0;this.height=this.width=4;this._background={type:"color",color:[0,0,0,1]};h=this._renderTargetHelper=new y.RenderTargetHelper(h);this._mainColorTargets=[h.registerColorTarget({name:"mainColorTarget0"}),h.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=h.registerColorTarget({name:"frontFaceTarget"});this.colorFloatTarget=h.registerColorTarget({name:"colorFloatTarget",
dataType:q.PixelType.HALF_FLOAT,internalFormat:q.SizedPixelFormat.RGBA16F,samplingMode:q.TextureSamplingMode.NEAREST});this.alphaFloatTarget=h.registerColorTarget({name:"alphaFloatTarget",dataType:q.PixelType.HALF_FLOAT,internalFormat:q.SizedPixelFormat.R16F,samplingMode:q.TextureSamplingMode.NEAREST});this.mainDepth=h.registerDepthTarget({name:"mainDepth"});this.linearDepth=h.registerColorTarget({name:"linearDepth",samplingMode:q.TextureSamplingMode.NEAREST});this.terrainLinearDepth=h.registerColorTarget({name:"terrainLinearDepth"});
this.geometryLinearDepth=h.registerColorTarget({name:"geometryLinearDepth"});this.normal=h.registerColorTarget({name:"normal"});this.highlight=h.registerColorTarget({name:"highlight",internalFormat:q.SizedPixelFormat.RGBA4,dataType:q.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=h.registerColorTarget({name:"hudVisibility",internalFormat:q.SizedPixelFormat.RGBA4,dataType:q.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=h.registerColorTarget({name:"tmpColor"});this.tmpDepth=h.registerDepthTarget({name:"tmpDepth"});
this.hudColor=h.registerColorTarget({name:"hudColor"})}var e=g.prototype;e.dispose=function(){this._renderTargetHelper.dispose()};e.getFramebuffer=function(h,z){return this._renderTargetHelper.getFramebuffer(this.width,this.height,h,z)};e.setupRenderTarget=function(h){h?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))};e.initializeFrame=function(h){const z=this._rctx;this.width=h.fullWidth;this.height=h.fullHeight;k.ensureAttachmentMaxSize(this,
z.parameters.maxTextureSize);this.bindTarget(this.currentColorTarget,this.mainDepth);z.setClearStencil(0);h=this._background.color;z.setClearColor(h[0]*h[3],h[1]*h[3],h[2]*h[3],h[3]);z.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT|q.ClearBufferBit.DEPTH_BUFFER_BIT|q.ClearBufferBit.STENCIL_BUFFER_BIT)};e.composite=function(h){null!=this.colorTexture&&this._compositingHelper.composite(h,this.colorTexture,u.AlphaMode.None)};e.renderTmpAndCompositeToMain=function(h,z,n,l=!1){this.renderToTargets(h,this.tmpColor,
l?this.tmpDepth:this.mainDepth,d);this._compositingHelper.composite(z,this._getColorTexture(this.tmpColor),n)};e.compositeAtmosphereToMain=function(h,z,n,l){this.bindTarget(this.currentColorTarget);this._compositingHelper.compositeAtmosphere(h,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),n,l,z);this.bindTarget(this.currentColorTarget,this.mainDepth)};e.renderHUDVisibility=function(h,z=!1){this.renderToTargets(h,this.hudVisibility,z?this.tmpDepth:this.mainDepth,f)};
e.compositeTransparentTerrainOntoHUDVisibility=function(h){this.renderToTargets(()=>this._compositingHelper.compositeHUD(h,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)};e.renderOITPass=function(h,z,n){let l,m;switch(z){case p.TransparencyPassType.Color:l=this.colorFloatTarget;m=[0,0,0,0];break;case p.TransparencyPassType.Alpha:l=this.alphaFloatTarget;m=[1,1,1,1];break;case p.TransparencyPassType.FrontFace:l=this.frontFaceTarget;m=[0,0,0,0];break;case p.TransparencyPassType.NONE:case p.TransparencyPassType.COUNT:return}n?
this.renderToTargets(h,l,this.tmpDepth,m,!0,!0):this.renderToTargets(h,l,this.mainDepth,m,!1)};e.compositeTransparentTerrainOntoMain=function(h){this.bindFramebuffer();this._compositingHelper.composite(h,this._getColorTexture(this.tmpColor),u.AlphaMode.PremultipliedAlpha)};e.compositeOccludedOntoMain=function(h,z){this.bindFramebuffer();this._compositingHelper.composite(h,this._getColorTexture(this.tmpColor),u.AlphaMode.PremultipliedAlpha,z)};e.compositeTransparentOntoOpaque=function(h,z){z?(this.bindTarget(this.hudColor,
this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeOIT(h,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};e.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};e.renderDepthDetached=function(h){this.bindTarget(this.currentColorTarget);h();this.bindTarget(this.currentColorTarget,
this.mainDepth)};e.disposeTarget=function(h){this._renderTargetHelper.disposeTargetResource(h)};e.renderToFBO=function(h,z,n=!1,l=!1){const m=this._rctx;let t=0;z&&(m.setClearColor(z[0],z[1],z[2],Math.max(1E-13,z[3])),t|=q.ClearBufferBit.COLOR_BUFFER_BIT);n&&(t|=q.ClearBufferBit.DEPTH_BUFFER_BIT);!1===l?l=0:(!0===l&&(l=255),t|=q.ClearBufferBit.STENCIL_BUFFER_BIT);t&&m.clearSafe(t,l);h();m.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth)};e.renderToTargets=function(h,z,n,l,m=!1,t=
!1){z=this.bindTarget(z,n);this.renderToFBO(h,l,m,t);return z};e.bindTarget=function(h,z){h=this._renderTargetHelper.getFramebuffer(this.width,this.height,h,z);this._rctx.bindFramebuffer(h);return h};e._getColorTexture=function(h){return this._renderTargetHelper.getColorTexture(h,this.width,this.height)};b._createClass(g,[{key:"background",get:function(){return this._background},set:function(h){this._background=h}},{key:"currentColorTarget",get:function(){return this._mainColorTargets[this._mainColorTarget]}},
{key:"previousColorTarget",get:function(){return this._mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},
{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},
{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"gpuMemoryUsage",get:function(){let h=
0;this._renderTargetHelper&&(h+=this._renderTargetHelper.gpuMemoryUsage);return h}}]);return g}();const d=[0,0,0,0],f=[0,1,0,1];a.OffscreenRendering=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k){const d={dataType:p.PixelType.UNSIGNED_BYTE,internalFormat:p.PixelFormat.RGBA},f={};let g=function(){function e(z){this._rctx=z;this._activeTargets=new Set;this._colorTextures=new Map;this._depthTextures=new Map;this._fbos=new Map}var h=e.prototype;h.dispose=function(){this._depthTextures.forEach(z=>z.dispose());this._depthTextures.clear();this._colorTextures.forEach(z=>z.dispose());this._colorTextures.clear();this._fbos.forEach(z=>z.dispose());this._fbos.clear();this._activeTargets.clear()};
h.disposeTargetResource=function(z){z=z.id;this._activeTargets.has(z)&&(this._activeTargets.delete(z),this._disposeWithFramebuffers(this._depthTextures,z),this._disposeWithFramebuffers(this._colorTextures,z))};h._disposeWithFramebuffers=function(z,n){const l=z.get(n);l&&(this._fbos.forEach((m,t)=>{if(m.colorTexture===l||m.depthStencilAttachment===l)m.detachColorTexture(),m.detachDepthStencilTexture(),m.dispose(),this._fbos.delete(t)}),l.dispose(),z.delete(n))};h._getDepthTexture=function(z,n,l){let m=
this._depthTextures.get(z.id);!m||m.descriptor.width===n&&m.descriptor.height===l||(m.dispose(),m=null);m||(n=new k.TextureDescriptor(n,l),n.pixelFormat=p.PixelFormat.DEPTH_STENCIL,n.dataType=p.PixelType.UNSIGNED_INT_24_8,n.samplingMode=p.TextureSamplingMode.NEAREST,n.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,m=new q.Texture(this._rctx,n),this._depthTextures.set(z.id,m),this._activeTargets.add(z.id));return m};h.getAllocatedDepthTexture=function(z){return this._depthTextures.get(z.id)};h.getColorTexture=
function(z,n,l){let m=this._colorTextures.get(z.id);!m||m.descriptor.width===n&&m.descriptor.height===l||(m.dispose(),m=c.nullifyNonNullableForDispose());m||(n=new k.TextureDescriptor(n,l),n.internalFormat=z.internalFormat,n.dataType=z.dataType,n.samplingMode=null!=z.samplingMode?z.samplingMode:p.TextureSamplingMode.LINEAR,n.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,m=new q.Texture(this._rctx,n),this._colorTextures.set(z.id,m),this._activeTargets.add(z.id));return m};h.getAllocatedColorTexture=function(z){return this._colorTextures.get(z.id)};
h.registerDepthTarget=function(z={}){return{id:y.generateUID(),...f,...z}};h.registerColorTarget=function(z={}){return{id:y.generateUID(),...d,...z}};h.getFramebuffer=function(z,n,l,m){const t=this._getKey(l,m);let w=this._fbos.get(t);l=this.getColorTexture(l,z,n);m=m?this._getDepthTexture(m,z,n):void 0;if(!w)return w=new u.FramebufferObject(this._rctx,l,m),this._fbos.set(t,w),w;if(w.width!==z||w.height!==n||w.colorTexture!==l||w.depthStencilAttachment!==m)w.detachColorTexture(),w.detachDepthStencilTexture(),
w.resize(z,n),w.attachColorTexture(l),w.attachDepthStencil(m);return w};h._getKey=function(z,n){return`${z.id}_${n?n.id:"X"}_${z.name}${n?"_"+n.name:""}`};b._createClass(e,[{key:"gpuMemoryUsage",get:function(){let z=0;const n=new Set,l=m=>{n.has(m)||(n.add(m),z+=m.gpuMemoryUsage)};this._colorTextures.forEach(l);this._depthTextures.forEach(l);return z}}]);return e}();a.RenderTargetHelper=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./depthRange ./Material ./RenderSlot".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){a.RenderPluginManager=function(l){function m(w){var r=l.call(this,{})||this;r._context=w;r._renderPlugins=new p;r._slots=[];for(w=0;w<z.RenderSlot.MAX_SLOTS;++w)r._slots[w]=[];return r}b._inherits(m,l);var t=m.prototype;t.normalizeCtorArgs=function(){return{}};t.add=function(w,r,x){const D=()=>{if(x?.aborted)throw r.uninitializeRenderContext(),u.createAbortError();this._renderPlugins.push(r);for(const v of w)this._slots[v].push(r);this._context.requestRender()},
A=r.initializeRenderContext(this._context,x);if(u.isPromiseLike(A))return A.then(D);D();this.notifyChange("_renderPlugins")};t.remove=function(w){if(null!=this._renderPlugins.removeUnordered(w)){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(x=>x!==w);w.uninitializeRenderContext();this._context.requestRender();this.notifyChange("_renderPlugins")}};t.prepareRender=function(){this._renderPlugins.forAll(w=>{w.prepareRender&&w.prepareRender(this._context.renderContext)})};t.updateAnimation=
function(w){let r=!1;this._renderPlugins.forAll(x=>{x.updateAnimation&&(r=x.updateAnimation(w)||r)});return r};t.prepareSlots=function(w){for(const r of w)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(x=>{x.canRender&&("prepareTechnique"in x&&x.prepareTechnique(this._context.renderContext),"prepareTechniques"in x&&x.prepareTechniques(this._context.renderContext))})};t.render=function(){const w=[];this._slots[this._context.renderContext.bindParameters.slot].filter(r=>{if(!r.canRender)return!1;
if("prepareTechnique"in r)return r=r.prepareTechnique(this._context.renderContext),null!=r?(w.push(r),!0):!1;if("prepareTechniques"in r)return r=r.prepareTechniques(this._context.renderContext),null!=r?(w.push(r),!0):!1;w.push(null);return!0}).forEach((r,x)=>r.render(this._context.renderContext,w[x]))};t.queryDepthRange=function(w){const r=n;r.near=Infinity;r.far=-Infinity;this._renderPlugins.forAll(x=>{x.queryDepthRange&&(x=x.queryDepthRange(w))&&e.union(r,x,r)});return r};b._createClass(m,[{key:"updating",
get:function(){return this._renderPlugins.some(w=>w.running)}},{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(w=>w.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this._renderPlugins.some(w=>w.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(w=>w.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const w=this._slots[z.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!w&&0<w.length}},{key:"renderOccludedFlags",
get:function(){return this._renderPlugins.reduce((w,r)=>w|r.renderOccludedFlags,h.RenderOccludedFlag.None)}}]);return m}(y);c.__decorate([q.property()],a.RenderPluginManager.prototype,"_renderPlugins",void 0);c.__decorate([q.property({readOnly:!0})],a.RenderPluginManager.prototype,"updating",null);a.RenderPluginManager=c.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.RenderPluginManager")],a.RenderPluginManager);const n={near:0,far:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E){a.ShadowAccumulator=function(M){function K(L,O,I,H,J,N){var R=M.call(this,{})||this;R._rctx=L;R._stage=I;R._prepareForShadowMapPass=H;R._renderToShadowMap=J;R._requestRender=N;R._progress=0;R._sampleCount=0;R._passParameters=new x.ShadowCastAccumulatePassParameters;R._cachedLightDirections=[];R._depthRange=m.ZERO;R._previewing=!1;R._handles=new u;R._cameraForcedForScreenshot=!1;R._bindParameters=new l.BindParameters(new r.ShadowMap(L,
I.viewingMode),null,null);R._bindParameters.shadowMap.enabled=!0;R._vao=t.createQuadVAO(L);R._accumulationRenderer=new w.ShadowCastRenderer(O,L,b._assertThisInitialized(R),N);R._handles.add([R._stage.view.resourceController.scheduler.registerTask(A.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(R)),d.watch(()=>I.renderView,W=>{R._handles.remove("renderView");null!=W&&R._handles.add(W.events.on("force-camera-for-screenshot",()=>R._cameraForcedForScreenshot=!0),"renderView")},d.syncAndInitial),
d.watch(()=>R._previewing,()=>R._requestRenderIfEnabled(),d.sync)]);return R}b._inherits(K,M);var G=K.prototype;G.normalizeCtorArgs=function(){return{}};G.dispose=function(){this._disable();this._handles.destroy();this._accumulationRenderer=k.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=k.disposeMaybe(this._fbo);this._vao=k.disposeMaybe(this._vao);this._accumulationTechniqueCached=k.releaseMaybe(this._accumulationTechniqueCached);this._sampleCount=this._cachedLightDirections.length=
0};G.runTask=function(L){for(this._prepareForShadowMapPass(this._bindParameters);!L.done&&!this._isDoneAccumulating;)this._accumulateShadow(),L.madeProgress();this._requestRender()};G.renderAccumulation=function(L,O,I,H){this._depthRange=O;this._updateCamera(I);this._bindParameters.contentCamera=H;this._passParameters.linearDepthTexture=L;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||
0===this._progress||this._cameraForcedForScreenshot)&&this._clear();L=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);for(O=0;O<L;++O)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}};G.render=function(L){this._accumulationRenderer.render(L)};G.setOptions=function(L){void 0!==L.enabled&&L.enabled!==(null!=this._fbo)&&(L.enabled?this._enable():this._disable());void 0!==L.previewing&&(this._previewing=L.previewing);void 0!==
L.lightDirections&&(this._lightDirections=L.lightDirections);this._accumulationRenderer.setOptions(L)};G.readAccumulatedShadow=function(L,O){if(!this._isActive||!this._fbo||1>this._progress||0>L||L>=this._fbo.width||0>O||O>=this._fbo.height)return 0;this._fbo.readPixels(L,O,1,1,v.PixelFormat.RGBA,v.PixelType.UNSIGNED_BYTE,F);return F[0]/this._progress};G._enable=function(){this._progress=0;const L=new C.TextureDescriptor;L.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new B.FramebufferObject(this._rctx,
L)};G._disable=function(){this._fbo=k.disposeMaybe(this._fbo)};G._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};G._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(v.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};G._accumulateShadow=function(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const L=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(L,
this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(L.primitiveType,0,E.vertexCount(this._vao,"geometry"))};G._sampleLightDirection=function(){this._progress++;return this._lightDirections[104729*this._progress%this._lightDirections.length]};G._updateCamera=function(L){!L.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(L),this._fbo.resize(L.fullWidth,L.fullHeight),this._opacityFromElevation=1-q.smoothstep(w.shadowCastDisableElevationMin,
w.shadowCastDisableElevationMax,L.relativeElevation))};G._requestRenderIfEnabled=function(){this._fbo&&this._requestRender()};b._createClass(K,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo?.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"_accumulationTechnique",get:function(){null==this._accumulationTechniqueCached&&(this._accumulationTechniqueCached=new D.ShadowCastAccumulateTechnique({rctx:this._rctx,
viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},{key:"_isActive",get:function(){return null!=this._fbo&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==m.ZERO&&this._opacityFromElevation>w.shadowCastDisabledElevationThreshold}},
{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(L){const O=this._cachedLightDirections;if(!p.equals(O,L,z.equals)){var I=Math.min(x.ShadowCastMaxSamples,L.length);this._sampleCount=O.length=I;for(let H=0;H<I;++H)O[H]=z.copy(O[H]??n.create(),L[H]);this._invalidate()}}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(L){this._accumulationRenderer.opacityFromElevation=
L}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"test",get:function(){const L=this;return{lightDirections:this._lightDirections,get isDone(){return L._isDoneAccumulating},get isActive(){return L._isActive}}}}]);return K}(y);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_fbo",
void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);c.__decorate([f.property()],
a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const F=new Uint8Array(4);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){const m=1/512;a.ShadowCastRenderer=function(t){function w(x,D,A,v){var B=t.call(this,{})||this;B._techniqueRepository=x;B._rctx=D;B._data=A;B._requestRender=v;B._passParameters=new h.ShadowCastVisualizePassParameters(B._data);B._techniqueConfig=new n.ShadowCastVisualizeTechniqueConfiguration;B._enabled=!1;B._vao=e.createQuadVAO(D);B._techniqueConfig.visualization=n.ShadowCastVisualization.Gradient;return B}b._inherits(w,t);var r=w.prototype;r.normalizeCtorArgs=
function(){return{}};r.dispose=function(){this._stop();this._vao=p.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._technique=null};r.render=function(x){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var D=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(D,this._passParameters,x);this._rctx.drawArrays(D.primitiveType,0,l.vertexCount(this._vao,"geometry"))}};r.setOptions=function(x){void 0!==
x.enabled&&this._setEnabled(x.enabled);void 0!==x.color&&this._setColor(x.color);void 0!==x.threshold&&(this._threshold=x.threshold);void 0!==x.visualization&&(this._visualization=x.visualization);void 0!==x.bandSize&&(this._bandSize=x.bandSize);void 0!==x.bandsEnabled&&(this._bandsEnabled=x.bandsEnabled)};r._setColor=function(x){g.exactEquals(x,this._passParameters.color)||(g.copy(this._passParameters.color,x),this._requestRenderIfRunning())};r._setEnabled=function(x){x!==this._enabled&&(x?this._start():
this._stop())};r._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};r._start=function(){this._enabled=!0;this._requestRender()};r._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(w,[{key:"_visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(z.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},
set:function(x){this._passParameters.opacityFromElevation!==x&&(this._passParameters.opacityFromElevation=x,this.notifyChange("opacityFromElevation"))}},{key:"_showVisualization",get:function(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>m}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(x){this._threshold!==x&&(this._passParameters.threshold=x,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},
set:function(x){x!==this._visualization&&(this._techniqueConfig.visualization=x,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(x){x!==this._bandSize&&(this._passParameters.bandSize=x,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(x){x!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=
x,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return w}(y);c.__decorate([u.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(w){const r=new g.ShaderBuilder,x=r.fragment;x.include(q.RgbaFloatEncoding);x.include(p.ReadLinearDepth);r.include(u.CameraSpace);r.include(y.ScreenSpacePass);const {visualization:D,bandsEnabled:A}=w;x.constants.add("inverseSampleValue","float",h.ShadowCastMaxSamples);x.uniforms.add(new e.Texture2DPassUniform("shadowCastMap",B=>B.shadowCastMap),new d.FloatPassUniform("sampleScale",B=>B.sampleScale),new d.FloatPassUniform("opacityFromElevation",B=>B.opacityFromElevation),
new k.Float4PassUniform("uColor",B=>B.color));w=D===z.ShadowCastVisualization.Gradient;const v=D===z.ShadowCastVisualization.Threshold;w&&A?x.uniforms.add(new d.FloatPassUniform("bandSize",B=>B.bandSize)):v&&x.uniforms.add(new d.FloatPassUniform("threshold",B=>B.threshold));x.code.add(f.glsl`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${v?f.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${w&&A?f.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${w?f.glsl`* strength`:""});
      }
    `);return r}let l=function(w){function r(x){var D=w.call(this)||this;D._data=x;D.sampleScale=0;D.opacityFromElevation=1;D.color=c.clone(m);D.bandSize=.1;D.threshold=.5;return D}b._inherits(r,w);b._createClass(r,[{key:"shadowCastMap",get:function(){return this._data.shadowCastTexture}}]);return r}(f.NoParameters);const m=c.fromValues(.01,0,.25,1),t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:l,build:n},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=
t;a.ShadowCastVisualizePassParameters=l;a.build=n})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(w){const r=new h.ShaderBuilder,x=r.fragment;x.include(d.RgbaFloatEncoding);x.include(u.ReadLinearDepth);r.include(k.CameraSpace);r.include(p.ScreenSpacePass);r.include(q.ReadShadowMapPass,w);x.uniforms.add(new z.Texture2DPassUniform("depthMap",D=>D.linearDepthTexture),new e.Matrix4PassUniform("inverseViewMatrix",(D,A)=>c.invert(t,c.translate(t,A.camera.viewMatrix,A.camera.center))),new f.Float2PassUniform("nearFar",(D,A)=>A.camera.nearFar));x.constants.add("sampleValue",
"float",m);x.code.add(g.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`);return r}let l=function(w){function r(){return w.apply(this,arguments)||this}b._inherits(r,w);return b._createClass(r)}(q.ReadShadowMapPassParameters);const m=1/255,t=y.create();y=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:l,ShadowCastMaxSamples:255,build:n},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=y;a.ShadowCastAccumulatePassParameters=l;a.ShadowCastMaxSamples=255;a.build=n})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){a.ShadowCastVisualization=void 0;(function(u){u[u.Gradient=0]="Gradient";u[u.Threshold=1]="Threshold";u[u.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.visualization=a.ShadowCastVisualization.Gradient;k.bandsEnabled=!1;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);
c.__decorate([y.parameter({count:a.ShadowCastVisualization.COUNT})],p.prototype,"visualization",void 0);c.__decorate([y.parameter()],p.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){p=function(e){function h(n,l){var m;return m=e.call(this,n,l,()=>m.destroy())||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new k.Program(n.rctx,h.shader.get().build(this.configuration),u.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:q.blendingDefault,colorWrite:g.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(h,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);
return h}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(d.ShadowCastVisualize,()=>new Promise((e,h)=>a(["./ShadowCastVisualize.glsl"],e,h)));b.ShadowCastVisualizeTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){p=function(e){function h(n){var l;return l=e.call(this,n,new d.ShadowConfiguration,()=>l.destroy())||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new q.Program(n.rctx,h.shader.get().build(this.configuration),u.Default3D)};z.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendFactor.ONE),colorWrite:g.defaultColorWriteParams,depthTest:null,
depthWrite:null})};c._createClass(h,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);return h}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.ShadowCastAccumulate,()=>new Promise((e,h)=>a(["./ShadowCastAccumulate.glsl"],e,h)));b.ShadowCastAccumulateTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6",
"../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,y){let p=function(u){function q(){var k=u.apply(this,arguments)||this;k.receiveShadows=!0;return k}b._inherits(q,u);return b._createClass(q)}(y.ShaderTechniqueConfiguration);c.__decorate([y.parameter()],p.prototype,"receiveShadows",void 0);a.ShadowConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){let e=function(){function z(l,m){this._rctx=l;this._viewingMode=m;this._maxOpacity=1;this._passParameters=new f.ShadowHighlightPassParameters;this._drawParameters=new k.ReadShadowMapDrawParameters;this._vao=d.createQuadVAO(this._rctx)}var n=z.prototype;n.render=function(l,m){if(l.shadowMap.enabled&&l.linearDepthTexture&&this.isVisible){var t=this._technique;this._drawParameters.origin=l.camera.center;this._rctx.bindFramebuffer(m);this._rctx.bindTechnique(t,this._passParameters,
l).bindDraw(this._drawParameters,l,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(t.primitiveType,0,g.vertexCount(this._vao,"geometry"))}};n.setDefaultOptions=function(l){this._passParameters={...this._passParameters,...l};this._updateMaxOpacity()};n.updateParameters=function(l,m){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,l.relativeElevation);l=this._viewingMode===q.ViewingMode.Global?p.normalize(h,l.center):p.set(h,0,0,1);m=p.dot(l,m);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*m,0,1))};n.dispose=function(){this._vao=y.disposeMaybe(this._vao);this._techniqueCached=y.releaseMaybe(this._techniqueCached)};n._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};b._createClass(z,[{key:"_technique",get:function(){null==this._techniqueCached&&(this._techniqueCached=new f.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));
return this._techniqueCached}},{key:"gpuMemoryUsage",get:function(){return this._vao?.memoryEstimate??0}},{key:"isVisible",get:function(){const {opacityElevation:l,dayNightTerminator:m}=this._passParameters;return.001953125<=this._maxOpacity*l*m}}]);return z}();const h=u.create();a.ShadowHighlight=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ./ShadowConfiguration ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){p=function(z){function n(){var l=z.apply(this,arguments)||this;l.shadowColor=y.fromValues(1,0,1,1);l.shadowOpacity=.2;l.occludedShadowOpacity=.1;l.opacityElevation=1;l.dayNightTerminator=1;return l}c._inherits(n,z);return c._createClass(n)}(p.ReadShadowMapPassParameters);q=function(z){function n(m){var t;return t=z.call(this,m,new f.ShadowConfiguration,()=>t.destroy())||this}c._inherits(n,z);var l=n.prototype;l.initializeProgram=function(m){return new d.Program(m.rctx,
n.shader.get().build(this.configuration),k.Default3D)};l.initializePipeline=function(){return h.makePipelineState({blending:h.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(n,[{key:"primitiveType",get:function(){return e.PrimitiveType.TRIANGLE_STRIP}}]);return n}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(g.ShadowHighlight,
()=>new Promise((z,n)=>a(["./ShadowHighlight.glsl"],z,n)));b.ShadowHighlightPassParameters=p;b.ShadowHighlightTechnique=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D){function A(F){const M=new r.ShaderBuilder;M.include(g.ReadShadowMapDraw,F);F=M.fragment;F.include(h.RgbaFloatEncoding);F.include(f.ReadLinearDepth);M.include(e.CameraSpace);M.include(k.ScreenSpacePass);F.uniforms.add(new x.Texture2DPassUniform("defaultDepthTex",(K,G)=>G.shadowMap.getSnapshot(D.SnapshotSlot.Default)),new x.Texture2DPassUniform("highlightDepthTex",(K,G)=>G.shadowMap.getSnapshot(D.SnapshotSlot.Highlight)),new x.Texture2DPassUniform("depthMap",
(K,G)=>G.linearDepthTexture),new x.Texture2DPassUniform("highlightMap",(K,G)=>G.highlightColorTexture),new l.Float4PassUniform("uColor",K=>K.shadowColor),new z.Float2PassUniform("nearFar",(K,G)=>G.camera.nearFar),new m.FloatPassUniform("opacity",K=>K.shadowOpacity),new m.FloatPassUniform("occludedOpacity",K=>K.occludedShadowOpacity),new m.FloatPassUniform("terminationFactor",K=>K.opacityElevation*K.dayNightTerminator),new n.Float3PassUniform("lightingMainDirectionView",(K,G)=>u.normalize(C,u.transformMat4(C,
G.lighting.mainLight.direction,G.camera.viewInverseTransposeMatrix))),new z.Float2PassUniform("texelSize",(K,G)=>null!=G.linearDepthTexture?y.set(E,1/G.linearDepthTexture.descriptor.width,1/G.linearDepthTexture.descriptor.height):p.ZEROS),new w.Matrix4PassUniform("inverseViewMatrix",(K,G)=>b.invert(B,b.translate(B,G.camera.viewMatrix,G.camera.center))));F.constants.add("unoccludedHighlightFlag","vec4",d.unoccludedHighlightFlag).add("highlightedThreshold","float",v.highlightedThreshold).add("selfShadowThreshold",
"float",v.selfShadowThreshold);F.code.add(t.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);F.code.add(t.glsl`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return M}const v={highlightedThreshold:.99999,selfShadowThreshold:.025},B=c.create(),C=q.create(),E=p.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=c;a.build=A})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function y(){this._plane=b.create()}a._createClass(y,[{key:"isEnabled",
get:function(){return!b.equals(this.plane,c)}},{key:"plane",get:function(){return this._plane},set:function(p){b.copy(p||c,this._plane)}}]);return y}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../core/shaderTechnique/ShaderTechniqueConfiguration ./BlendWeightsTechnique ./BlurTechnique ./EdgeDetectTechnique ./glUtil3D ../shaders/SMAAPassParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){b.SmaaRenderPass=function(v){function B(E,F){var M=v.call(this,{})||this;M._rctx=E;M._techniqueRep=F;M._passParameters=new w.SMAAPassParameters;M._isEnabled=!1;return M}c._inherits(B,v);var C=B.prototype;C.normalizeCtorArgs=function(){return{}};C.dispose=function(){this._abortController=u.abortMaybe(this._abortController);this.disable()};C._loadResources=function(E){if(null!=this._abortController)return!1;if(null!=this._passParameters.searchTexture)return!0;
this._abortController=new AbortController;const F=this._abortController.signal;(new Promise((M,K)=>a(["./SmaaRenderPassData"],M,K))).then(M=>this._loadTextures(M,F)).then(()=>E()).finally(()=>this._abortController=null);return!1};C._loadTextures=function(E,F){q.throwIfAborted(F);return Promise.all([this._loadTextureFromBase64(E.areaTexture,r.TextureSamplingMode.LINEAR,r.PixelFormat.RGB),this._loadTextureFromBase64(E.searchTexure,r.TextureSamplingMode.NEAREST,r.PixelFormat.LUMINANCE)]).then(([M,K])=>
{q.isAborted(F)?(M.dispose(),K.dispose(),q.throwIfAborted(F)):(this._passParameters.areaTexture=M,this._passParameters.searchTexture=K)})};C.enable=function(E){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const F=new z.ShaderTechniqueConfiguration;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(m.EdgeDetectTechnique,F,this._edgeDetectTechnique);this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(n.BlendWeightsTechnique,
F,this._blendWeightsTechnique);this._blurTechnique=this._techniqueRep.releaseAndAcquire(l.BlurTechnique,F,this._blurTechnique)}if(!this._loadResources(E))return!1;this._vao=t.createScreenSizeTriangleVAO(this._rctx);E=new A.TextureDescriptor(4,4);E.pixelFormat=r.PixelFormat.RG;E.internalFormat=r.SizedPixelFormat.RG8;E.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;this._passParameters.edges=new x.FramebufferObject(this._rctx,E);E=new A.TextureDescriptor(4,4);E.pixelFormat=r.PixelFormat.RGBA;E.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;
this._passParameters.blend=new x.FramebufferObject(this._rctx,E);return this._isEnabled=!0};C.disable=function(){this._isEnabled&&(this._vao=u.disposeMaybe(this._vao),this._passParameters.areaTexture=u.disposeMaybe(this._passParameters.areaTexture),this._passParameters.searchTexture=u.disposeMaybe(this._passParameters.searchTexture),this._passParameters.blend=u.disposeMaybe(this._passParameters.blend),this._passParameters.edges=u.disposeMaybe(this._passParameters.edges),this._isEnabled=!1)};C.render=
function(E){const F=this._validPassParameters;if(null!=F){F.colorTexture=E;var M=this._rctx,K=M.getBoundFramebufferObject(),G=E.descriptor.width;E=E.descriptor.height;M.bindVAO(this._vao);M.setViewport(0,0,G,E);F.edges.resize(G,E);M.bindFramebuffer(F.edges);M.setClearColor(0,0,0,1);M.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);M.bindTechnique(this._edgeDetectTechnique,F,null);M.drawArrays(r.PrimitiveType.TRIANGLES,0,3);F.blend.resize(G,E);M.bindFramebuffer(F.blend);M.setClearColor(0,0,1,1);M.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);
M.bindTechnique(this._blendWeightsTechnique,F,null);M.drawArrays(r.PrimitiveType.TRIANGLES,0,3);M.bindFramebuffer(K);M.setClearColor(0,1,0,1);M.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);M.bindTechnique(this._blurTechnique,F,null);M.drawArrays(r.PrimitiveType.TRIANGLES,0,3)}};C._loadTextureFromBase64=function(E,F,M){return h.requestImage(E).then(K=>{const G=new A.TextureDescriptor;G.pixelFormat=M;G.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;G.width=K.width;G.height=K.height;G.samplingMode=F;return new D.Texture(this._rctx,
G,K)})};c._createClass(B,[{key:"updating",get:function(){return null!=this._abortController}},{key:"_validPassParameters",get:function(){return this._isEnabled?this._passParameters:null}}]);return B}(p);y.__decorate([k.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);y.__decorate([k.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=y.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BlendWeightsTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/BlendWeights.glsl ../../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;
e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.BlendWeights,()=>new Promise((f,g)=>a(["../shaders/BlendWeights.glsl"],f,g)));b.BlendWeightsTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),
function(a,b,c,y,p,u){function q(){const f=new c.ShaderBuilder,{attributes:g,varyings:e,vertex:h,fragment:z}=f;g.add(p.VertexAttribute.POSITION,"vec2");e.add("uv","vec2");e.add("offsets[2]","vec4");e.add("maxOffset","vec4");e.add("pixelCoord","vec2");u.addResolutionUniform(h);h.code.add(b.glsl`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.glsl.int(k.maxSearchSteps)} );
      }
    `);z.uniforms.add(new y.Texture2DPassUniform("edgesTexture",n=>n.edges.colorTexture));z.uniforms.add(new y.Texture2DPassUniform("areaTexture",n=>n.areaTexture));z.uniforms.add(new y.Texture2DPassUniform("searchTexture",n=>n.searchTexture));u.addResolutionUniform(z);z.code.add(b.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.glsl.int(k.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `);return f}const k={maxSearchSteps:8,maxDistanceAreaTex:16},d=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=d;a.build=q})},"esri/views/3d/webgl-engine/shaders/SMAAPassParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces".split(" "),function(a,b,c,y,p,u){u=function(d){function f(){return d.apply(this,
arguments)||this}b._inherits(f,d);return b._createClass(f)}(u.NoParameters);let q=function(d){function f(){return d.apply(this,arguments)||this}b._inherits(f,d);return b._createClass(f)}(u);const k=y.create();a.SMAAPassParameters=u;a.ValidSMAAPassParameters=q;a.addResolutionUniform=function(d){d.uniforms.add(new p.Float4PassUniform("resolution",f=>{var {descriptor:g}=f.colorTexture;f=g.width;g=g.height;return c.set(k,1/f,1/g,f,g)}))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/BlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/Blur.glsl ../../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,
g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.Blur,()=>new Promise((f,g)=>a(["../shaders/Blur.glsl"],f,g)));b.BlurTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),
function(a,b,c,y,p,u){function q(){const d=new c.ShaderBuilder,{attributes:f,varyings:g,vertex:e,fragment:h}=d;f.add(p.VertexAttribute.POSITION,"vec2");g.add("uv","vec2");g.add("offsets[2]","vec4");u.addResolutionUniform(e);e.code.add(b.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`);h.uniforms.add(new y.Texture2DPassUniform("blendWeightsTexture",z=>z.blend.colorTexture),new y.Texture2DPassUniform("colorTexture",z=>z.colorTexture));u.addResolutionUniform(h);h.code.add(b.glsl`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return d}const k=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.Blur=k;a.build=q})},"esri/views/3d/webgl-engine/lib/EdgeDetectTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/EdgeDetect.glsl ../../../webgl/renderState".split(" "),function(a,b,c,y,p,u,
q,k,d){p=function(f){function g(){return f.apply(this,arguments)||this}c._inherits(g,f);var e=g.prototype;e.initializeProgram=function(h){return new q.Program(h.rctx,g.shader.get().build(),u.Default3D)};e.initializePipeline=function(){return d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return c._createClass(g)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.EdgeDetect,()=>new Promise((f,g)=>a(["../shaders/EdgeDetect.glsl"],f,g)));b.EdgeDetectTechnique=p;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,b,c,y,p,u){function q(){const f=new c.ShaderBuilder,{attributes:g,varyings:e,vertex:h,fragment:z}=f;g.add(p.VertexAttribute.POSITION,
"vec2");u.addResolutionUniform(h);e.add("uv","vec2");e.add("offsets[3]","vec4");h.code.add(b.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`);z.uniforms.add(new y.Texture2DPassUniform("colorTexture",n=>n.colorTexture));z.code.add(b.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.glsl.float(k.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.glsl.float(k.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `);return f}const k={threshold:.05,localConstrastAdaption:2},d=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=d;a.build=q})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q){function S(ma){null!=ma&&(ma.vao.vertexBuffers.instances.dispose(),ma.vao.disposeVAOOnly(),ma.vao=null)}function U(ma){let fa=null,ba=null;for(let aa=0;aa<ma.geometries.length;aa++){const da=ma.geometries[aa];if(da.material.supportsEdges){if(!fa)fa=da.transformation;else if(!p.equals(fa,da.transformation))return!1;if(!ba&&null!=da.localOrigin)ba=da;else if(ba&&null!=ba.localOrigin&&null!=da.localOrigin&&
ba.localOrigin.id!==da.localOrigin.id)return!1}}return!0}function V(ma,fa,ba){fa*=ba;ba=p.binaryIndexOf(ma,fa,!0);return-1===ba?fa<ma[0]?ma.length:0:ma.length-ba}a.EdgeView=function(ma){function fa(aa){var da=ma.call(this,aa)||this;da._updatingHandles=new t.WatchUpdatingTracking;da._perObjectData=new Map;da._perObjectDataEvictionCache=new Set;da._renderers=new Map;da._gpuMemoryUsage=0;da._workerAbort=new AbortController;da._tmpModelPosition=m.create();da._localOrigins=new C.LocalOriginManager(new v.GridLocalOriginFactory(aa.renderSR));
return da}b._inherits(fa,ma);var ba=fa.prototype;ba.initialize=function(){this._worker=new H.EdgeWorkerHandle(this.schedule);this._componentColorManager=new W.BufferManager(this.rctx,3);const aa=K.VertexLayout.createBuffer(4);for(let da=0;4>da;da++)aa.sideness.set(da,0,0===da||3===da?0:1),aa.sideness.set(da,1,0===da||1===da?0:1);this._verticesBufferObject=P.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,aa.buffer)};ba.destroy=function(){this.destroyed||(this._perObjectData.forEach(aa=>this._discardObjectEntry(aa)),
this._perObjectData.clear(),this._strokesTexture=k.disposeMaybe(this._strokesTexture),this._componentColorManager=k.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=k.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",oa))};ba.shouldRender=function(){return 0<this._renderers.size};ba.addComponentObject=async function(aa,da,ca,na,qa,ua,sa,pa){if(this.hasObject(aa))return this.getObjectMemoryUsage(aa);
let ka;ca=new X(new Promise(ra=>ka=ra),ca.center,ca.radius);this._perObjectData.set(aa,ca);aa=await this._updatingHandles.addPromise(this._addComponentGeometry(da,ca,na,qa,ua,sa,pa));this.setNeedsRender();ka();return aa};ba.addOrUpdateObject3D=async function(aa,da,ca,na){if(this.destroyed)u.getLogger(this).warn("Attempt to add an object to a destroyed instance");else{var qa=this._perObjectData.get(aa);0<qa?.renderables.length&&this._perObjectDataEvictionCache.add(qa);var ua,sa=aa.boundingVolumeWorldSpace.bounds;
sa=new X(new Promise(ka=>ua=ka),w.getCenter(sa),w.getRadius(sa));this._perObjectData.set(aa,sa);var pa=[];if(ca.mergeGeometries&&1<aa.geometries.length&&U(aa))pa.push(this._addObjectMergedGeometries(aa,sa,da,ca,na));else for(let ka=0;ka<aa.geometries.length;ka++){const ra=aa.geometries[ka];ra.material.supportsEdges&&pa.push(this._addGeometry(aa,sa,ra,da[0],ca,na))}await this._updatingHandles.addPromise(Promise.all(pa));this._perObjectDataEvictionCache.delete(sa);this._discardObjectEntry(qa);this.setNeedsRender();
ua()}};ba._discardObjectEntry=function(aa){aa&&(aa.renderables.length&&(aa.renderables.forEach(da=>this._removeRenderable(da)),this.setNeedsRender()),aa.loaded=null)};ba.hasObject=function(aa){return this._perObjectData.has(aa)};ba.updateAllComponentOpacities=async function(aa,da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));if(null!=aa){var ca=da instanceof Array?na=>da[na]:()=>da;aa.renderables.forEach(na=>{const qa=na.components.meta.length;for(let ua=0;ua<qa;ua++){const sa=
ca(ua),pa=na.components.meta[ua],ka=pa.index;pa.material.opacity=sa;na.components.buffer.textureBuffer.setDataElement(ka,1,3,255*sa)}this._updateTransparency(na)});this.setNeedsRender()}};ba.getObjectMemoryUsage=async function(aa){aa=await this._getObjectEntry(aa);return null!=aa?aa.renderables.reduce((da,ca)=>da+ca.statistics.gpuMemoryUsage,0):0};ba.updateAllComponentMaterials=async function(aa,da,ca,na){const qa=aa instanceof E.Object3D,ua=!!ca.hasSlicePlane,sa=R.determineRendererType(da),pa=O.EdgeRenderer.getKey(sa,
ua,qa);aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(ka=>{if(pa!==ka.rendererKey){var ra=this._renderers.get(ka.rendererKey);const va=this._acquireRenderer(sa,ua,qa);ra.removeRenderable(ka);--ra.refCount;ka.rendererKey=pa;va.addRenderable(ka)}for(ra=0;ra<da.length;ra++)ka.components.meta[ra].material=da[ra];na&&this._updateComponentBuffer(ka.components);this._updateTransparency(ka)}),this.setNeedsRender())};ba.updateAllVerticalOffsets=async function(aa,
da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(ca=>{const na=ca.components.meta;for(let qa=0;qa<na.length;qa++)ca.components.meta[qa].verticalOffset=da?.[qa]??0;this._updateComponentBuffer(ca.components)}),this.setNeedsRender())};ba.updateObjectVisibility=async function(aa,da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(ca=>ca.visible=da),this.setNeedsRender())};ba.removeObject=function(aa){const da=
this._perObjectData.get(aa);da&&(this._perObjectData.delete(aa),this._discardObjectEntry(da))};ba._getObjectEntry=async function(aa){aa=this._perObjectData.get(aa);if(!aa)throw Error("no object");await aa.loaded;return null==aa.loaded?null:aa};ba.render=function(aa,da){if(null!=this._componentColorManager){this._localOrigins.updateViewMatrices(aa.camera.viewMatrix);var ca=aa.camera.viewInverseTransposeMatrix,na=m.create(),qa=new A.TwoVectorPosition,ua=0,sa=0;this._renderers.forEach(ka=>{if(0===ka.refCount)this._renderers.delete(ka.key),
ka.dispose();else{let ra=!0,va=!0;ka.forEachRenderable(Ca=>{Ca.visible&&(ua+=Ca.statistics.averageEdgeLength,sa++,ra&&Ca.regular&&(ka.updateTechnique(aa,!1),ra=!1),va&&Ca.silhouette&&(ka.updateTechnique(aa,!0),va=!1))},da)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==sa){var pa=new I.EdgePassParameters(40*ua/sa,da);l.set(na,ca[3],ca[7],ca[11]);qa.set(na);l.copy(pa.transformWorldFromViewTH,qa.high);l.copy(pa.transformWorldFromViewTL,qa.low);h.fromMat4(pa.transformViewFromCameraRelativeRS,
aa.camera.viewMatrix);h.transpose(ia,pa.transformViewFromCameraRelativeRS);h.invert(pa.transformNormalViewFromGlobal,ia);pa.transformProjFromView=aa.camera.projectionMatrix;this._updateObjectCameraDistances(aa);this._renderers.forEach(ka=>{this._renderRegularEdges(ka,aa,pa);this._renderSilhouetteEdges(ka,aa,pa)})}}};ba._updateTransparency=function(aa){const da=R.determineEdgeTransparency(aa.components.meta),ca=R.determineObjectTransparency(aa.components.meta);if(da!==aa.edgeTransparency||ca!==aa.objectTransparency)aa.edgeTransparency=
da,aa.objectTransparency=ca,this._renderers.get(aa.rendererKey).setRenderablesDirty()};ba._computeModelTransformWithLocalOrigin=function(aa,da,ca){aa.getCombinedShaderTransformation(da,ca);aa=null!=da.localOrigin?this._localOrigins.register(da.localOrigin):this._localOrigins.acquire(l.set(this._tmpModelPosition,ca[12],ca[13],ca[14]));da.localOrigin=aa.origin;B.applyToModelMatrix(aa.origin.vec3,ca);return aa};ba._updateComponentBuffer=function(aa){const {meta:da,buffer:ca}=aa;aa=new Uint8Array(4);
for(let qa=0;qa<da.length;qa++){var na=da[qa].material;const ua=da[qa].index,sa=q.clamp(Math.round(na.size*O.LINE_WIDTH_FRACTION_FACTOR),0,255),pa=q.clamp(na.extensionLength,-O.EXTENSION_LENGTH_OFFSET,255-O.EXTENSION_LENGTH_OFFSET)+O.EXTENSION_LENGTH_OFFSET,ka="solid"===na.type?L.EdgeType.SOLID:L.EdgeType.SKETCH,ra=255*na.opacity;na=na.color;ca.textureBuffer.setData(ua,0,255*na[0],255*na[1],255*na[2],255*na[3]);ca.textureBuffer.setData(ua,1,sa,pa,ka,ra);D.encodeElevationOffset(da[qa].verticalOffset,
aa);ca.textureBuffer.setData(ua,2,aa[0],aa[1],aa[2],aa[3])}};ba._createComponentBuffers=function(aa){if(null==this._componentColorManager)return null;const da=[],ca=this._componentColorManager.getBuffer(aa.length);for(let na=0;na<aa.length;na++){const qa=aa[na],ua=ca.acquireIndex();da.push({index:ua,verticalOffset:0,material:qa})}aa=new Y(ca,da);this._updateComponentBuffer(aa);return aa};ba._extractEdges=function(aa,da,ca,na,qa,ua=qa.length){return this._worker.process({data:da,indices:qa,indicesLength:ua,
writerSettings:aa,skipDeduplicate:ca},this._workerAbort.signal,na)};ba._createRenderable=function(aa,da,ca,na,qa){var ua=pa=>null!=this._verticesBufferObject?new Z(new F.VertexArrayObject(this.rctx,K.EdgeShaderAttributeLocations,{vertices:K.glVertexLayout,instances:pa===T.EdgeSilhouette.REGULAR?G.RegularEdgeBufferWriter.glLayout:G.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:P.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,pa===T.EdgeSilhouette.REGULAR?
aa.regular.instancesData.buffer:aa.silhouette.instancesData.buffer)}),pa===T.EdgeSilhouette.REGULAR?aa.regular.lodInfo:aa.silhouette.lodInfo):null;const sa=0<aa.regular.lodInfo.lengths.length?ua(T.EdgeSilhouette.REGULAR):null;ua=0<aa.silhouette.lodInfo.lengths.length?ua(T.EdgeSilhouette.SILHOUETTE):null;return new ja(sa,ua,{gpuMemoryUsage:(sa?.vao.memoryEstimate??0)+(ua?.vao.memoryEstimate??0),externalMemoryUsage:qa,averageEdgeLength:aa.averageEdgeLength},ca,R.determineEdgeTransparency(da.meta),R.determineObjectTransparency(da.meta),
da,na)};ba._addGeometry=async function(aa,da,ca,na,qa,ua){var sa=ca.vertexAttributes.get(M.VertexAttribute.POSITION);const pa=ca.indices.get(M.VertexAttribute.POSITION),ka=n.create();aa=this._computeModelTransformWithLocalOrigin(aa,ca,ka);sa=new ha(sa,pa,ka,aa);return this._addPositionData(da,sa,ca.edgeIndicesLength,na,qa,ua)};ba._addPositionData=async function(aa,da,ca,na,qa,ua=!1){if(null!=aa.loaded){var sa=this._createComponentBuffers([na]);if(!(null==sa||0>=ca)){na=this._acquireRenderer(na.type,
!!qa.hasSlicePlane,!0);var {modelTransform:pa,origin:ka}=da;qa=da.indices;da=da.position;var ra=da.data.length/da.size,va=K.EdgeInputBufferLayout.createBuffer(ra);for(let Ca=0;Ca<ra;Ca++)va.position.set(Ca,0,da.data[Ca*da.size]),va.position.set(Ca,1,da.data[Ca*da.size+1]),va.position.set(Ca,2,da.data[Ca*da.size+2]);R.fillComponenBufferIndices(sa.meta,[0,va.componentIndex.count],va.componentIndex);ca=await this._updatingHandles.addPromise(this._extractEdges(na.writerSettings,va,!1,ua,qa,ca));null!=
aa.loaded&&(sa=this._createRenderable(ca,sa,new ea(pa,ka),na.key,!1),aa.renderables.push(sa),na.addRenderable(sa),this._gpuMemoryUsage+=sa.statistics.gpuMemoryUsage)}}};ba._addComponentGeometry=async function(aa,da,ca,na,qa,ua,sa){if(null==da.loaded)return 0;const pa=this._createComponentBuffers(ua);if(null==pa)return 0;ua=R.determineRendererType(ua);sa=this._acquireRenderer(ua,sa.hasSlicePlane||!1,!1);ua=K.EdgeInputBufferLayout.createBuffer(ca.length/3);r.copy(ua.position.typedBuffer,ca,ua.position.typedBufferStride,
3);R.fillComponenBufferIndices(pa.meta,qa,ua.componentIndex,na);ca=await this._updatingHandles.addPromise(this._extractEdges(sa.writerSettings,ua,!0,!1,na));if(null==da.loaded)return 0;aa=this._createRenderable(ca,pa,aa,sa.key,!0);da.renderables.push(aa);sa.addRenderable(aa);return aa.statistics.gpuMemoryUsage};ba._addObjectMergedGeometries=async function(aa,da,ca,na,qa){var ua=new Map,sa=0,pa=null,ka=0;for(var ra=0;ra<aa.geometries.length;ra++){var va=aa.geometries[ra];if(va.material.supportsEdges){!pa&&
va.localOrigin&&(pa=va);var Ca=va.vertexAttributes.get(M.VertexAttribute.POSITION);ka+=Ca.data.length/Ca.size;sa+=va.edgeIndicesLength}}ka=65536<=ka?Uint32Array:Uint16Array;sa=sa?new ka(sa):null;ka=[];ra=0;for(va=0;va<aa.geometries.length;va++){Ca=aa.geometries[va];if(!Ca.material.supportsEdges)continue;var Ba=Ca.vertexAttributes.get(M.VertexAttribute.POSITION);const Ha=Ca.indices.get(M.VertexAttribute.POSITION);let Ma=ua.get(Ba.data);if(null==Ma){Ma=ka.length/3;for(let Qa=0;Qa<Ba.data.length;Qa+=
Ba.size)ka.push(Ba.data[Qa]),ka.push(Ba.data[Qa+1]),ka.push(Ba.data[Qa+2]);ua.set(Ba.data,Ma)}if(Ha)for(Ba=0;Ba<Ca.edgeIndicesLength;Ba++)sa[ra++]=Ma+Ha[Ba]}pa=pa||aa.geometries[0];ua=n.create();pa=this._computeModelTransformWithLocalOrigin(aa,pa,ua);for(ra=0;ra<aa.geometries.length;ra++)aa.geometries[ra].localOrigin=pa.origin;aa=new ha({data:ka,size:3},sa,ua,pa);await this._updatingHandles.addPromise(this._addPositionData(da,aa,sa.length,ca[0],na,qa))};ba._acquireRenderer=function(aa,da,ca){const na=
O.EdgeRenderer.getKey(aa,da,ca);let qa=this._renderers.get(na);null==this._strokesTexture&&(this._strokesTexture=N.generateStrokesTexture(this.rctx));qa||(qa=new O.EdgeRenderer(this.rctx,this.techniqueRepository,{type:aa,hasSlicePlane:da,strokesTexture:this._strokesTexture,legacy:ca,spherical:this.viewingMode===x.ViewingMode.Global}),this._renderers.set(na,qa));++qa.refCount;return qa};ba._removeRenderable=function(aa){S(aa.regular);S(aa.silhouette);const da=this._renderers.get(aa.rendererKey);if(da){da.removeRenderable(aa);
--da.refCount;"origin"in aa.transform&&this._localOrigins.release(aa.transform.origin);this._gpuMemoryUsage-=aa.statistics.externalMemoryUsage?0:aa.statistics.gpuMemoryUsage;for(const ca of aa.components.meta)aa.components.buffer.releaseIndex(ca.index)}};ba._updateObjectCameraDistances=function(aa){const da=aa.camera.eye,ca=aa.camera.viewForward,na=m.create();aa=qa=>{l.sub(na,qa.center,da);const ua=l.dot(na,ca),sa=qa.radius,pa=ua<-sa?Infinity:ua<sa?0:ua-sa;qa.renderables.forEach(ka=>ka.distanceToCamera=
pa)};this._perObjectData.forEach(aa);this._perObjectDataEvictionCache.forEach(aa)};ba._renderRegularEdges=function(aa,da,ca){const na=aa.bindRegularEdges(ca,da),qa=da.camera.perScreenPixelRatio;aa.forEachRenderable(ua=>{if(null!=ua.regular&&ua.visible){var sa=V(ua.regular.lod.lengths,ua.distanceToCamera,qa);aa.renderRegularEdges(na,ua,ca,da,sa)}},ca.transparency)};ba._renderSilhouetteEdges=function(aa,da,ca){const na=aa.bindSilhouetteEdges(ca,da),qa=da.camera.perScreenPixelRatio;aa.forEachRenderable(ua=>
{if(null!=ua.silhouette&&ua.visible){var sa=V(ua.silhouette.lod.lengths,ua.distanceToCamera,qa);aa.renderSilhouetteEdges(na,ua,ca,da,sa)}},ca.transparency)};b._createClass(fa,[{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"usedMemory",get:function(){return this._gpuMemoryUsage}},{key:"test",get:function(){return{hasRenderedPrimitives:aa=>{let da=!1;const ca=aa.perScreenPixelRatio,na=(qa,ua)=>qa.forEachRenderable(sa=>{sa.visible&&!da&&(null!=sa.regular&&(da=0<V(sa.regular.lod.lengths,
sa.distanceToCamera,ca)),da||null==sa.silhouette||(da=0<V(sa.silhouette.lod.lengths,sa.distanceToCamera,ca)))},ua);this._renderers.forEach(qa=>{da||(na(qa,J.Transparency.OPAQUE),na(qa,J.Transparency.TRANSPARENT))});return da}}}}]);return fa}(y);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);
c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([d.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);c.__decorate([d.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let X=b._createClass(function(ma,fa,ba){this.center=fa;this.radius=ba;this.renderables=[];this.loaded=ma;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}),Y=b._createClass(function(ma,fa){this.buffer=ma;this.meta=fa}),Z=b._createClass(function(ma,fa){this.vao=ma;this.lod=fa}),ea=b._createClass(function(ma,fa){this.modelMatrix=ma;this.origin=fa}),ja=b._createClass(function(ma,fa,ba,aa,da,ca,na,qa){this.regular=ma;this.silhouette=fa;this.statistics=ba;this.transform=aa;this.edgeTransparency=
da;this.objectTransparency=ca;this.components=na;this.rendererKey=qa;this.distanceToCamera=0;this.visible=!0});c=function(ma){function fa(){return ma.apply(this,arguments)||this}b._inherits(fa,ma);return b._createClass(fa)}(ja);y=function(ma){function fa(){return ma.apply(this,arguments)||this}b._inherits(fa,ma);return b._createClass(fa)}(ja);let ha=b._createClass(function(ma,fa,ba,aa){this.position=ma;this.indices=fa;this.modelTransform=ba;this.origin=aa});const ia=z.create(),oa=()=>Promise.reject();
a.LegacyTransform=ea;a.RegularRenderable=c;a.Renderable=ja;a.SilhouetteRenderable=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const y=-b[0],p=-b[1];b=-b[2];const u=c[3],q=c[7],k=c[11],d=c[15];c[0]+=u*y;c[1]+=u*p;c[2]+=u*b;c[4]+=q*y;c[5]+=q*p;c[6]+=q*b;c[8]+=k*y;c[9]+=k*p;c[10]+=k*b;c[12]+=d*y;c[13]+=d*p;c[14]+=d*b};a.applyToViewMatrix=function(b,c){const y=
b[0],p=b[1];b=b[2];c[12]+=y*c[0]+p*c[4]+b*c[8];c[13]+=y*c[1]+p*c[5]+b*c[9];c[14]+=y*c[2]+p*c[6]+b*c[10];c[14]+=y*c[3]+p*c[7]+b*c[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,y,p){let u=function(){function k(f){this._factory=f;this._originData=new Map}var d=
k.prototype;d.acquire=function(f){return this.register(this._factory.getOrigin(f))};d.register=function(f){f=this._originData.get(f.id)||new q(f);f.refCount++;this._originData.has(f.origin.id)||this._originData.set(f.origin.id,f);return f};d.release=function(f){f.refCount--;0===f.refCount&&this._originData.delete(f.origin.id)};d.updateViewMatrices=function(f){this._originData.forEach(g=>{c.copy(g.viewMatrix,f);p.applyToViewMatrix(g.origin.vec3,g.viewMatrix)})};return b._createClass(k)}(),q=b._createClass(function(k){this.origin=
k;this.refCount=0;this.viewMatrix=y.create()});a.LocalOriginManager=u;a.OriginData=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},m={solid:z.EdgeUtilMode.SOLID,sketch:z.EdgeUtilMode.SKETCH,uber:z.EdgeUtilMode.MIXED};z=function(){function w(x,D,A){this._rctx=x;this._shaderTechniqueRepository=D;this._configuration=new e.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[h.Transparency.TRANSPARENT]:{[h.Transparency.TRANSPARENT]:new y,[h.Transparency.OPAQUE]:new y},
[h.Transparency.OPAQUE]:{[h.Transparency.TRANSPARENT]:new y,[h.Transparency.OPAQUE]:new y}};this._renderablesDirty=!1;this._drawParameters=new f.EdgeDrawParameters;this._settings={...l,...A};this.key=w.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:k.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=m[this._settings.type];this._configuration.silhouette=
!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=x.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=A.spherical}var r=w.prototype;r.dispose=function(){this._technique=c.releaseMaybe(this._technique)};r.addRenderable=function(x){this._renderables.add(x);this._renderablesDirty=!0};r.removeRenderable=function(x){this._renderables.delete(x);
this._renderablesDirty=!0};r.setRenderablesDirty=function(){this._renderablesDirty=!0};r.forEachRenderable=function(x,D){this._renderablesDirty&&this._sortRenderables();D!==h.Transparency.INVISIBLE&&(D=this._sortedRenderables[D],D[h.Transparency.TRANSPARENT].forAll(x),D[h.Transparency.OPAQUE].forAll(x))};r.updateTechnique=function(x,D){this._configuration.hasMultipassTerrain=!!x.multipassTerrain.enabled;this._configuration.cullAboveGround=!!x.multipassTerrain.cullAboveGround;this._configuration.silhouette=
D;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(g.EdgeShaderTechnique,this._configuration,this._technique)};r.bindRegularEdges=function(x,D){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(D,!1),x,D)};r.bindSilhouetteEdges=function(x,D){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(D,!0),x,D)};r.renderRegularEdges=function(x,D,A,v,B){this._render(x,D,D.regular.vao,A,v,B)};r.renderSilhouetteEdges=function(x,D,A,
v,B){this._render(x,D,D.silhouette.vao,A,v,B)};r._render=function(x,D,A,v,B,C){0<C&&(this._bindDraw(x,D,v,B),this._rctx.bindVAO(A),this._rctx.capabilities.instancing.drawArraysInstanced(n.PrimitiveType.TRIANGLE_FAN,0,4,C))};r._bindDraw=function(x,D,A,v){this._drawParameters.componentDataTexture=D.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in D.transform)this._lastOriginId!==D.transform.origin.origin.id&&(x.setUniformMatrix4fv("localView",
D.transform.origin.viewMatrix),this._lastOriginId=D.transform.origin.origin.id),x.setUniformMatrix4fv("model",D.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=D.transform.origin.origin.vec3;else{const B=new d.TwoVectorPosition(D.transform.position),C=p.transpose(t,p.invert(t,D.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=B.low;this._drawParameters.transformWorldFromModelTH=B.high;this._drawParameters.transformWorldFromModelRS=D.transform.rotationScale;
this._drawParameters.transformNormalGlobalFromModel=C;D=v.camera.viewInverseTransposeMatrix;q.set(this._drawParameters.slicePlaneLocalOrigin,D[3],D[7],D[11])}x.bindDraw(this._drawParameters,v,A)};r._sortRenderables=function(){this._renderablesDirty=!1;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].clear();this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].clear();this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].clear();
this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].clear();this._renderables.forEach(D=>{D.objectTransparency!==h.Transparency.INVISIBLE&&D.edgeTransparency!==h.Transparency.INVISIBLE&&this._sortedRenderables[D.objectTransparency][D.edgeTransparency].push(D)});const x=(D,A)=>"origin"in D.transform?"origin"in A.transform?D.transform.origin.origin.id<A.transform.origin.origin.id?-1:D.transform.origin.origin.id>A.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].sort(x);
this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].sort(x);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].sort(x);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].sort(x)};w.getKey=function(x,D,A){return`edges-t:${x}:${D}:${A}`};return b._createClass(w)}();const t=u.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=z;a.LINE_WIDTH_FRACTION_FACTOR=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,c,y,p){let u=function(q){function k(d,f){var g=q.call(this)||this;g.distanceFalloffFactor=d;g.transparency=f;g.transformNormalViewFromGlobal=c.create();return g}b._inherits(k,q);return b._createClass(k)}(p.VertexPositionPassParameters);p=function(q){function k(){var d=q.apply(this,arguments)||this;d.transformNormalViewFromGlobal=
c.create();d.slicePlaneLocalOrigin=y.create();d.transformNormalGlobalFromModel=c.create();return d}b._inherits(k,q);return b._createClass(k)}(p.VertexPositionDrawParameters);a.EdgeDrawParameters=p;a.EdgePassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f){p=function(g){function e(){return g.apply(this,arguments)||this}c._inherits(e,g);var h=e.prototype;h.initializeProgram=function(z){return new u.Program(z.rctx,e.shader.get().build(this.configuration),q.EdgeShaderAttributeLocations)};h.initializePipeline=function(z){return z.blendMinMax?f.makePipelineState({blending:f.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ZERO,d.BlendFactor.ONE,d.BlendOperation.ADD,z.blendMinMax.MAX),depthTest:{func:d.CompareFunction.LEQUAL},
colorWrite:f.defaultColorWriteParams}):f.makePipelineState({depthTest:{func:d.CompareFunction.LEQUAL},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};return c._createClass(e)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(k.EdgeShader,()=>new Promise((g,e)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],g,e)));b.EdgeShaderTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){function x(v){const B=new g.ShaderBuilder,{vertex:C,fragment:E}=B;v.legacy&&C.uniforms.add(new A("model"),new A("localView"));B.include(z.AdjustProjectedPosition,v);B.include(m.EdgeUtil,v);B.include(t.LineAmplitude,v);B.include(r.UnpackAttributes,v);B.include(w.LineOffset,v);B.include(p.SliceDraw,v);B.include(l.DiscardNonSilhouetteEdges,v);B.include(n.DiscardByCoverage,v);B.include(u.multipassTerrainTest,v);B.varyings.add("vColor","vec4");B.varyings.add("vRadius",
"float");B.varyings.add("vPosition","vec3");B.varyings.add("vWorldPosition","vec3");B.varyings.add("vViewPos","vec3");B.varyings.add("vLineLengthPixels","float");B.varyings.add("vSizeFalloffFactor","float");C.uniforms.add(new q.Float2PassUniform("pixelToNDC",(F,M)=>c.set(D,2/M.camera.fullViewport[2],2/M.camera.fullViewport[3])),new k.Float4PassUniform("viewport",(F,M)=>M.camera.fullViewport),new d.FloatPassUniform("pixelRatio",(F,M)=>M.camera.pixelRatio));B.attributes.add(h.VertexAttribute.POSITION0,
"vec3");B.attributes.add(h.VertexAttribute.POSITION1,"vec3");B.attributes.add(h.VertexAttribute.VARIANTOFFSET,"float");B.attributes.add(h.VertexAttribute.VARIANTSTROKE,"float");B.attributes.add(h.VertexAttribute.VARIANTEXTENSION,"float");C.code.add(f.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${v.antialiasing?f.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:f.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${v.mode===m.EdgeUtilMode.SKETCH?f.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:v.mode===m.EdgeUtilMode.MIXED?f.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);E.code.add(f.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${v.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return B}const D=y.create();let A=function(v){function B(C){return v.call(this,C,"mat4")||this}b._inherits(B,v);return b._createClass(B)}(e.Uniform);y=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=y;a.build=x})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,y,p,u,q){const k=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(d,f){d=d.vertex;d.include(c.IsNaN);d.constants.add("depthBias","vec2",k);d.uniforms.add(new y.Float2PassUniform("inverseViewport",(g,e)=>e.inverseViewport));f.legacy?(d.uniforms.add(new q.Matrix4PassUniform("proj",(g,e)=>e.camera.projectionMatrix)),d.code.add(p.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(d.uniforms.add(new u.Matrix3PassUniform("transformNormalViewFromGlobal",g=>g.transformNormalViewFromGlobal),new q.Matrix4PassUniform("transformProjFromView",g=>g.transformProjFromView)),d.code.add(p.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));d.code.add(p.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const y=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,y){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);y.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,y){c=c.vertex;y.silhouette?(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),y.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.EdgeUtilMode=void 0;(function(z){z[z.SOLID=0]="SOLID";z[z.SKETCH=1]="SKETCH";z[z.MIXED=2]="MIXED";z[z.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(z){z[z.REGULAR=0]="REGULAR";z[z.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(z,n){const l=z.vertex;l.include(y.RgbaFloatEncoding);l.uniforms.add(new q.FloatPassUniform("distanceFalloffFactor",m=>m.distanceFalloffFactor));l.code.add(k.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);l.uniforms.add(new e.Texture2DDrawUniform("componentDataTex",m=>m.componentDataTexture));z.attributes.add(h.VertexAttribute.COMPONENTINDEX,"float");l.constants.add("componentColorFieldOffset","float",0);l.constants.add("componentOtherFieldOffset","float",1);l.constants.add("componentVerticalOffsetFieldOffset","float",2);l.constants.add("componentFieldCount","float",3);l.constants.add("lineWidthFractionFactor","float",8);l.constants.add("extensionLengthOffset","float",128);l.constants.add("verticalOffsetScale",
"float",2*b.MAX_ELEVATION_OFFSET);l.code.add(k.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);n.legacy?l.code.add(k.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(l.uniforms.add(new d.Matrix3DrawUniform("transformNormalGlobalFromModel",m=>m.transformNormalGlobalFromModel)),l.code.add(k.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));n.silhouette?(z.attributes.add(h.VertexAttribute.NORMALA,"vec3"),z.attributes.add(h.VertexAttribute.NORMALB,"vec3"),l.code.add(k.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(z.attributes.add(h.VertexAttribute.NORMAL,"vec3"),l.code.add(k.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));n.legacy?l.code.add(k.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(l.include(c.DoublePrecision,n),l.include(c.DoublePrecision,n),l.uniforms.add(new f.Matrix3PassUniform("transformViewFromCameraRelativeRS",m=>m.transformViewFromCameraRelativeRS),new d.Matrix3DrawUniform("transformWorldFromModelRS",m=>m.transformWorldFromModelRS),new p.Float3DrawUniform("transformWorldFromModelTL",m=>m.transformWorldFromModelTL),new p.Float3DrawUniform("transformWorldFromModelTH",m=>m.transformWorldFromModelTH),new u.Float3PassUniform("transformWorldFromViewTL",m=>m.transformWorldFromViewTL),
new u.Float3PassUniform("transformWorldFromViewTH",m=>m.transformWorldFromViewTH)),l.code.add(k.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${n.spherical?k.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:k.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));l.uniforms.add(new g.Matrix4PassUniform("transformProjFromView",(m,t)=>t.camera.projectionMatrix));l.code.add(k.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);l.code.add(k.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(z){return z.mode===a.EdgeUtilMode.SKETCH||z.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(z){return z.mode===a.EdgeUtilMode.SOLID||z.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,b,c,y,p){a.LineAmplitude=function(u,q){const k=u.vertex;u.include(p.UnpackAttributes,q);switch(q.mode){case y.EdgeUtilMode.SOLID:k.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case y.EdgeUtilMode.SKETCH:k.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",d=>d.strokesTexture.amplitude));k.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case y.EdgeUtilMode.MIXED:k.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",d=>d.strokesTexture.amplitude)),k.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,y,p){a.UnpackAttributes=function(u,q){const k=u.vertex;u.attributes.add(y.VertexAttribute.SIDENESS,"vec2");q.mode===p.EdgeUtilMode.MIXED?k.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):k.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(q.mode){case p.EdgeUtilMode.MIXED:k.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case p.EdgeUtilMode.SKETCH:k.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case p.EdgeUtilMode.SOLID:k.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case p.EdgeUtilMode.COUNT:break;default:b.neverReached(q.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,b,c,y,p,u,q,k){let d=function(f){function g(){return f.apply(this,arguments)||this}b._inherits(g,f);return b._createClass(g)}(p.NoParameters);a.LineOffset=function(f,g){f.include(k.UnpackAttributes,g);const {vertex:e,fragment:h}=f;q.usesSketchLogic(g)&&(e.uniforms.add(new u.Texture2DDrawUniform("strokesTexture",z=>z.strokesTexture.texture)),e.uniforms.add(new y.FloatDrawUniform("strokesLog2Resolution",z=>Math.log2(z.strokesTexture.resolution)),new y.FloatDrawUniform("strokeVariants",z=>
z.strokesTexture.variants)),f.varyings.add("vStrokeUV","vec2"),h.uniforms.add(new u.Texture2DDrawUniform("strokesTexture",z=>z.strokesTexture.texture),new y.FloatDrawUniform("strokesNormalizationScale",z=>z.strokesTexture.normalizationScale)),e.code.add(p.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),f.fragment.include(c.RgbaFloatEncoding),h.code.add(p.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(g.mode){case q.EdgeUtilMode.SOLID:e.code.add(p.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);h.code.add(p.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case q.EdgeUtilMode.SKETCH:e.code.add(p.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);h.code.add(p.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case q.EdgeUtilMode.MIXED:f.varyings.add("vType","float"),e.code.add(p.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),h.code.add(p.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,c,y,p,u){p=function(q){function k(){var d=
q.apply(this,arguments)||this;d.mode=u.EdgeUtilMode.SOLID;d.hasSlicePlane=!1;d.silhouette=!1;d.legacy=!1;d.antialiasing=!1;d.doublePrecisionRequiresObfuscation=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;d.spherical=!1;return d}b._inherits(k,q);return b._createClass(k)}(p.DefaultTechniqueConfiguration);c.__decorate([y.parameter({count:u.EdgeUtilMode.COUNT})],p.prototype,"mode",void 0);c.__decorate([y.parameter()],p.prototype,"hasSlicePlane",void 0);c.__decorate([y.parameter()],p.prototype,"silhouette",
void 0);c.__decorate([y.parameter()],p.prototype,"legacy",void 0);c.__decorate([y.parameter()],p.prototype,"antialiasing",void 0);c.__decorate([y.parameter()],p.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([y.parameter()],p.prototype,"hasMultipassTerrain",void 0);c.__decorate([y.parameter()],p.prototype,"cullAboveGround",void 0);c.__decorate([y.parameter()],p.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/typedArrayUtil ../../../../../core/workers/WorkerHandle ../../../support/buffer/workerHelper ./edgeProcessing".split(" "),function(a,b,c,y,p,u){y=function(k){function d(g){return k.call(this,"EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},g)||
this}b._inherits(d,k);var f=d.prototype;f.process=async function(g,e,h){if(h)return u.extract(g);g=await this.invoke(new q(g),e);return this._unpackOutput(g)};f.extractEdgeLocations=async function(g,e){g=await this.invokeMethod("extractEdgeLocations",new q(g),e);return p.unpackInterleavedBuffer(g)};f.extractComponentsEdgeLocations=async function(g,e){g=await this.invokeMethod("extractComponentsEdgeLocations",new q(g),e);return p.unpackInterleavedBuffer(g)};f._unpackOutput=function(g){return{regular:{instancesData:p.unpackInterleavedBuffer(g.regular.instancesData),
lodInfo:{lengths:new Float32Array(g.regular.lodInfo.lengths)}},silhouette:{instancesData:p.unpackInterleavedBuffer(g.silhouette.instancesData),lodInfo:{lengths:new Float32Array(g.silhouette.lodInfo.lengths)}},averageEdgeLength:g.averageEdgeLength}};return b._createClass(d)}(y.WorkerHandle);let q=b._createClass(function(k){this.dataBuffer=k.data.buffer;this.writerSettings=k.writerSettings;this.skipDeduplicate=k.skipDeduplicate;this.indices=c.isArray(k.indices)?k.indices:k.indices.buffer;this.indicesType=
c.isArray(k.indices)?"Array":c.isUint32Array(k.indices)?"Uint32Array":"Uint16Array";this.indicesLength=k.indicesLength});a.EdgeWorkerHandle=y;a.PackedInput=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","./InterleavedLayout"],function(a,b){a.packInterleavedBuffer=function(c,y){y.push(c.buffer);return{buffer:c.buffer,layout:new b.PackedLayout(c.layout)}};a.unpackInterleavedBuffer=function(c){return(new b.InterleavedLayout(c.layout)).createView(c.buffer)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/floatRGBA ../../../../../core/maybe ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(a,b,c,y,p,u){function q(g,e){if(!g)return null;var h=g.length/2;const z=.1*h;h=Array(h);let n=0;e=e===k.PRESSURE;for(let l=0;l<g.length;l+=2){const m=(g[l]+g[l+1])/2;e?
h[n++]=Math.min(z,1-.5*(1-m)):h[n++]=Math.min(z,.5*m)}return h}var k;(function(g){g[g.DISTANCE=0]="DISTANCE";g[g.PRESSURE=1]="PRESSURE"})(k||(k={}));let d=function(){function g(e,h,z,n,l){this.resolution=e;this.normalizationScale=h;this.amplitude=z;this.variants=n;this.texture=l}g.prototype.dispose=function(){this.texture=y.disposeMaybe(this.texture)};return b._createClass(g)}();const f={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,
-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,
.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,
.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,
-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,
.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,
.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,
.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,
-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,
-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,
1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,
.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,
-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,
.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,
.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,
.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,
.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,
4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,
3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,
.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,
.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,
.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,
.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,
.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,
1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,
-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,
.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,
2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,
.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,
.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,
.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,
-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,
.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,
.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,
-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,
.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,
.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,
.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,
.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,
5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,
.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,
-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,
4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,
.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,
.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,
.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=d;a.generateStrokesTexture=function(g){const e=f.resolution;var h=e/2;const z=new Uint8Array(4*e*e);var n=4*e*h;h=f.amplitude;const l=2*h,m=4*e,t=Math.log2(e)+1,w=f.strokes.length;let r=(t-1)*w*
m;for(const {distance:x,pressure:D}of f.strokes){let A=x,v=D,B=r;for(let C=0;C<t;C++){0!==C&&(A=q(A,k.DISTANCE),v=q(v,k.PRESSURE));for(let E=0;E<f.resolution;E++){const F=v?v[E%v.length]:1;c.packFloatRGBA((A?A[E%A.length]/l:0)+.5,z,B);c.packFloatRGBA(F,z,B+n);B+=4}B-=m*(w+1)}r+=m}n=new u.TextureDescriptor;n.width=n.height=e;g=new p.Texture(g,n,z);return new d(e,l,h,w,g)};a.strokesDefinition=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports",
"./interfaces"],function(a,b){a.determineEdgeTransparency=function(c){let y=b.Transparency.INVISIBLE;for(const {material:p}of c)if(0<p.size*p.color[3]*p.opacity){if(1>p.color[3]*p.opacity)return b.Transparency.TRANSPARENT;y=b.Transparency.OPAQUE}return y};a.determineObjectTransparency=function(c){let y=b.Transparency.INVISIBLE;for(const {material:p}of c)if(0<p.size*p.color[3]*p.opacity){switch(p.objectTransparency){case b.Transparency.TRANSPARENT:case b.Transparency.INVISIBLE:return b.Transparency.TRANSPARENT;
case b.Transparency.OPAQUE:if(1>p.opacity)return b.Transparency.TRANSPARENT}y=b.Transparency.OPAQUE}return y};a.determineRendererType=function(c){let y=null;for(const p of c)if(c=p.type,0<p.size*p.color[3])if(null==y)y=c;else if(y!==c)return"uber";return null!=y?y:"uber"};a.fillComponenBufferIndices=function(c,y,p,u){for(let k=0;k<c.length;k++){const d=c[k].index;var q=y[k];const f=y[k+1];if(u)for(;q<f;q++)p.set(u[q],d);else for(;q<f;q++)p.set(q,d)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/TimerPool".split(" "),function(a,b,c,y,p,u,q){a.PerformanceCategory=void 0;(function(d){d.OVERLAY="overlay";d.PREPARE="prepare";d.SHADOW_MAP="shadow map";d.LINEAR_DEPTH="linear depth";d.ACCUMULATED_SHADOWS="accumulated shadows";d.NORMALS=
"normals";d.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";d.SSAO="SSAO";d.OPAQUE="opaque";d.OPAQUE_EDGES="opaque edges";d.VOXEL="voxel";d.TRANSPARENT="transparent";d.TRANSPARENT_EDGES="transparent edges";d.HUD_VISIBILITY="HUD visibility";d.TRANSPARENT_TERRAIN="transparent terrain";d.ENVIRONMENT="environment";d.LASER_LINE="laser line";d.OCCLUDED="occluded";d.ANTIALIASING="antialiasing";d.HIGHLIGHTS="highlights";d.HUD="HUD";d.HUD_OCCLUDED="HUD occluded";d.FINISH="finish"})(a.PerformanceCategory||
(a.PerformanceCategory={}));let k=function(){function d(g){this._rctx=g;this._startTimeStampCPU=p.Milliseconds(0);this._lastTimeStampCPU=p.Milliseconds(0);this._totalCPUTime=new y("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new y(e)]));this._enableGPUTimer=0;this._totalGPUTime=new y("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new y(e)]));this._totalTime=p.Milliseconds(0);this._totalFrameCount=0}var f=d.prototype;f.enableGPUPerformanceInfo=
function(){if(null==this._gpuTimerPool){const g=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=q.createElapsedTimerPool(this._rctx,g)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;return{hasGPUTimerSupport:!0,remove:u.once(()=>{--this._enableGPUTimer;0===this._enableGPUTimer&&(this._gpuTimerPool=c.disposeMaybe(this._gpuTimerPool))})}};f.startFrame=function(){this._startTimeStampCPU=this._lastTimeStampCPU=p.Milliseconds(performance.now());
null!=this._gpuTimerPool&&this._gpuTimerPool.start()};f.advance=function(g){var e=p.Milliseconds(performance.now());this._cpuTimeSamplers.get(g).record(e-this._lastTimeStampCPU);this._lastTimeStampCPU=e;null!=this._gpuTimerPool&&(e=this._gpuTimerPool.stop(g),this._gpuTimeSamplers.get(g).record(e),this._gpuTimerPool.start())};f.finishFrame=function(){if(null!=this._gpuTimerPool){var g=this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(g)}g=
p.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=p.Milliseconds(this._totalTime+g);this._totalCPUTime.record(g);null!=this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((e,h)=>e+(h.last||0),0));++this._totalFrameCount};b._createClass(d,[{key:"totalCPUTimeSampler",get:function(){return this._totalCPUTime}},{key:"cpuTimeSamplers",get:function(){return Array.from(this._cpuTimeSamplers.values())}},{key:"totalGPUTimeSampler",get:function(){return this._totalGPUTime}},
{key:"gpuTimeSamplers",get:function(){return Array.from(this._gpuTimeSamplers.values())}},{key:"gpuSamplingEnabled",get:function(){return null!=this._gpuTimerPool}},{key:"totalTime",get:function(){return this._totalTime}},{key:"totalFrameCount",get:function(){return this._totalFrameCount}},{key:"elapsedTime",get:function(){return p.Milliseconds(performance.now()-this._startTimeStampCPU)}}]);return d}();a.RendererPerformanceInfo=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","./capabilities/DisjointTimerQuery"],function(a,b,c){let y=function(){function p(q,k){this._timer=q;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;k.forEach(d=>{const f=this._timer.createQuery(),g=this._timer.createQuery();this._queryPool.push(f,g);this._queryResults.set(d,null)})}var u=p.prototype;u.start=function(){c.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),
this._timer.beginTimeElapsed(this._currentQuery)))};u.stop=function(q){if(this._timer.disjoint()||null==this._currentQuery||!this._queryResults.has(q))return this.abort(),null;this._timer.endTimeElapsed();const k=this._queryResults.get(q);if(null==k)return this._queryResults.set(q,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(k))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const d=this._timer.getResult(k)/1E6;this._queryPool.unshift(k);this._queryResults.set(q,
this._currentQuery);this._currentQuery=null;return d};u.abort=function(){null!=this._currentQuery&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)};u.dispose=function(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(q=>{this._timer.deleteQuery(q)});this._queryResults.forEach(q=>{null!=q&&this._timer.deleteQuery(q)})};return b._createClass(p)}();a.createElapsedTimerPool=function(p,
u){p=p.capabilities.disjointTimerQuery;return null==p?null:new y(p,u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./isWebGL2Context"],function(a,b,c){let y=b._createClass(function(p,u,q,k,d,f,g,e,h){this.createQuery=p;this.deleteQuery=u;this.resultAvailable=q;this.getResult=k;this.disjoint=d;this.beginTimeElapsed=f;this.endTimeElapsed=g;this.createTimestamp=
e;this.timestampBits=h});a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=y;a.createDisjointTimerQuery=function(p,u){if(u.disjointTimerQuery)return null;let q=p.getExtension("EXT_disjoint_timer_query_webgl2");return q&&c(p)?new y(()=>p.createQuery(),k=>{p.deleteQuery(k);a.hasRunningElapsedTimer=!1},k=>p.getQueryParameter(k,p.QUERY_RESULT_AVAILABLE),k=>p.getQueryParameter(k,p.QUERY_RESULT),()=>p.getParameter(q.GPU_DISJOINT_EXT),k=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,p.beginQuery(q.TIME_ELAPSED_EXT,
k))},()=>{p.endQuery(q.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},k=>q.queryCounterEXT(k,q.TIMESTAMP_EXT),()=>p.getQuery(q.TIMESTAMP_EXT,q.QUERY_COUNTER_BITS_EXT)):(q=p.getExtension("EXT_disjoint_timer_query"))?new y(()=>q.createQueryEXT(),k=>{q.deleteQueryEXT(k);a.hasRunningElapsedTimer=!1},k=>q.getQueryObjectEXT(k,q.QUERY_RESULT_AVAILABLE_EXT),k=>q.getQueryObjectEXT(k,q.QUERY_RESULT_EXT),()=>p.getParameter(q.GPU_DISJOINT_EXT),k=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,q.beginQueryEXT(q.TIME_ELAPSED_EXT,
k))},()=>{q.endQueryEXT(q.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},k=>q.queryCounterEXT(k,q.TIMESTAMP_EXT),()=>q.getQueryEXT(q.TIMESTAMP_EXT,q.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],function(a,b,c,y){y=function(p){function u(k,d,f){k=p.call(this,k,d)||this;k.newCache=f;k._refCount=1;k._appleAmdDriverHelper=null;return k}b._inherits(u,p);var q=u.prototype;q.destroy=function(){0<--this._refCount||this.dispose()};q.ref=function(){++this._refCount};q.dispose=function(){b._get(b._getPrototypeOf(u.prototype),"dispose",this).call(this);this._appleAmdDriverHelper?.dispose()};
q.bindTechnique=function(k,d,f,g){this.useProgram(k.program);k.bindPipelineState(this,f?.slot,!!g);k.program.bindPass(d,f);return k.program};b._createClass(u,[{key:"appleAmdDriverHelper",get:function(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?this._appleAmdDriverHelper=this._appleAmdDriverHelper??new c.AppleAmdDriverHelper(this):null}},{key:"test",get:function(){return this.programCache.test}}]);return u}(y.RenderingContext);a.RenderingContext=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./BufferObject","./enums"],function(a,b,c,y){let p=function(){function u(k){this._rctx=k;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}u.getShaderSources=function(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}};
var q=u.prototype;q._createHelperProgram=function(){const k=u.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))};q._createIndexbuffer=function(){return c.BufferObject.createIndex(this._rctx,y.Usage.STATIC_DRAW,new Uint32Array([0]))};q.resetIndicesType=function(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,y.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(y.PrimitiveType.POINTS,
1,y.DataType.UNSIGNED_INT,0))};q.dispose=function(){this._program.dispose();this._indexBuffer.dispose()};return b._createClass(u)}();a.AppleAmdDriverHelper=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./contextUtils ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){function w(D,A,v,B){A?B!==A&&D.bindBuffer(v,A.glName):D.bindBuffer(v,null);return A}function r(D,A){switch(D){case d.PrimitiveType.POINTS:return 2*A;case d.PrimitiveType.TRIANGLES:return A/3;case d.PrimitiveType.TRIANGLE_STRIP:return A-2;case d.PrimitiveType.TRIANGLE_FAN:return A-2;default:return 0}}let x=function(){function D(v,B){this.gl=v;this.instanceCounter=new f.InstanceCounter;this.programCache=new e.ProgramCache(this);this._state=new q.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=t(v)?k.ContextType.WEBGL2:k.ContextType.WEBGL1;this._loadExtensions();this.configure(B)}var A=D.prototype;A.configure=function(v){this._capabilities=new m.Capabilities(this.gl,v);this._parameters=new g.Parameters(this.gl,this._capabilities,v);z.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;v=this.gl.getParameter(this.gl.VIEWPORT);this._state=new q.ContextState;this._state.viewport={x:v[0],y:v[1],width:v[2],height:v[3]};
this._stateTracker=new h.StateTracker({setBlending:B=>{B?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(B.opRgb,B.opAlpha),this.setBlendFunctionSeparate(B.srcRgb,B.dstRgb,B.srcAlpha,B.dstAlpha),B=B.color,this.setBlendColor(B.r,B.g,B.b,B.a)):this.setBlendingEnabled(!1)},setCulling:B=>{B?(this.setFaceCullingEnabled(!0),this.setCullFace(B.face),this.setFrontFace(B.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:B=>{B?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(B.factor,
B.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:B=>{B?(this.setDepthTestEnabled(!0),this.setDepthFunction(B.func)):this.setDepthTestEnabled(!1)},setStencilTest:B=>{if(B){this.setStencilTestEnabled(!0);const C=B.function;this.setStencilFunction(C.func,C.ref,C.mask);B=B.operation;this.setStencilOp(B.fail,B.zFail,B.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:B=>{B?(this.setDepthWriteEnabled(!0),this.setDepthRange(B.zNear,B.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:B=>
{B?this.setColorMask(B.r,B.g,B.b,B.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:B=>{B?this.setStencilWriteMask(B.mask):this.setStencilWriteMask(0)}});this.enforceState();c.disposeMaybe(this._driverTest);this._driverTest=new l.WebGLDriverTest(this)};A.dispose=function(){c.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.type===k.ContextType.WEBGL2&&(this.unbindBuffer(d.BufferType.UNIFORM_BUFFER),
this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(d.BufferType.COPY_READ_BUFFER),this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;u.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)};A.setPipelineState=function(v){this._stateTracker.setPipeline(v)};A.setBlendingEnabled=function(v){this._state.blend!==v&&(!0===v?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._state.blend=v,this._stateTracker.invalidateBlending())};A.externalProgramUpdate=function(){this._state.program?.stop();this._state.program=null};A.externalTextureUnitUpdate=function(v,B){for(let C=0;C<v.length;++C)this._state.textureUnitMap[v[C]]=null;0<=B&&(this._state.activeTexture=B)};A.externalVertexArrayObjectUpdate=function(){const v=this.capabilities.vao;v&&(v.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=
null};A.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};A.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};A.setBlendColor=function(v,B,C,E){if(v!==this._state.blendColor.r||B!==this._state.blendColor.g||C!==this._state.blendColor.b||E!==this._state.blendColor.a)this.gl.blendColor(v,B,C,E),this._state.blendColor.r=v,this._state.blendColor.g=B,this._state.blendColor.b=C,this._state.blendColor.a=E,this._stateTracker.invalidateBlending()};A.setBlendFunction=function(v,
B){if(v!==this._state.blendFunction.srcRGB||B!==this._state.blendFunction.dstRGB)this.gl.blendFunc(v,B),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=v,this._state.blendFunction.dstRGB=B,this._state.blendFunction.dstAlpha=B,this._stateTracker.invalidateBlending()};A.setBlendFunctionSeparate=function(v,B,C,E){if(this._state.blendFunction.srcRGB!==v||this._state.blendFunction.srcAlpha!==C||this._state.blendFunction.dstRGB!==B||this._state.blendFunction.dstAlpha!==E)this.gl.blendFuncSeparate(v,
B,C,E),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=C,this._state.blendFunction.dstRGB=B,this._state.blendFunction.dstAlpha=E,this._stateTracker.invalidateBlending()};A.setBlendEquation=function(v){this._state.blendEquation.mode!==v&&(this.gl.blendEquation(v),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=v,this._stateTracker.invalidateBlending())};A.setBlendEquationSeparate=function(v,B){if(this._state.blendEquation.mode!==v||this._state.blendEquation.modeAlpha!==
B)this.gl.blendEquationSeparate(v,B),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=B,this._stateTracker.invalidateBlending()};A.setColorMask=function(v,B,C,E){if(this._state.colorMask.r!==v||this._state.colorMask.g!==B||this._state.colorMask.b!==C||this._state.colorMask.a!==E)this.gl.colorMask(v,B,C,E),this._state.colorMask.r=v,this._state.colorMask.g=B,this._state.colorMask.b=C,this._state.colorMask.a=E,this._stateTracker.invalidateColorWrite()};A.setClearColor=function(v,
B,C,E){if(this._state.clearColor.r!==v||this._state.clearColor.g!==B||this._state.clearColor.b!==C||this._state.clearColor.a!==E)this.gl.clearColor(v,B,C,E),this._state.clearColor.r=v,this._state.clearColor.g=B,this._state.clearColor.b=C,this._state.clearColor.a=E};A.setFaceCullingEnabled=function(v){this._state.faceCulling!==v&&(!0===v?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=v,this._stateTracker.invalidateCulling())};A.setPolygonOffsetFillEnabled=
function(v){this._state.polygonOffsetFill!==v&&(!0===v?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=v,this._stateTracker.invalidatePolygonOffset())};A.setPolygonOffset=function(v,B){if(this._state.polygonOffset[0]!==v||this._state.polygonOffset[1]!==B)this._state.polygonOffset[0]=v,this._state.polygonOffset[1]=B,this.gl.polygonOffset(v,B),this._stateTracker.invalidatePolygonOffset()};A.setCullFace=function(v){this._state.cullFace!==
v&&(this.gl.cullFace(v),this._state.cullFace=v,this._stateTracker.invalidateCulling())};A.setFrontFace=function(v){this._state.frontFace!==v&&(this.gl.frontFace(v),this._state.frontFace=v,this._stateTracker.invalidateCulling())};A.setScissorTestEnabled=function(v){this._state.scissorTest!==v&&(!0===v?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=v)};A.setScissorRect=function(v,B,C,E){if(this._state.scissorRect.x!==v||this._state.scissorRect.y!==
B||this._state.scissorRect.width!==C||this._state.scissorRect.height!==E)this.gl.scissor(v,B,C,E),this._state.scissorRect.x=v,this._state.scissorRect.y=B,this._state.scissorRect.width=C,this._state.scissorRect.height=E};A.setDepthTestEnabled=function(v){this._state.depthTest!==v&&(!0===v?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=v,this._stateTracker.invalidateDepthTest())};A.setClearDepth=function(v){this._state.clearDepth!==v&&(this.gl.clearDepth(v),
this._state.clearDepth=v)};A.setDepthFunction=function(v){this._state.depthFunction!==v&&(this.gl.depthFunc(v),this._state.depthFunction=v,this._stateTracker.invalidateDepthTest())};A.setDepthWriteEnabled=function(v){this._state.depthWrite!==v&&(this.gl.depthMask(v),this._state.depthWrite=v,this._stateTracker.invalidateDepthWrite())};A.setDepthRange=function(v,B){if(this._state.depthRange.zNear!==v||this._state.depthRange.zFar!==B)this.gl.depthRange(v,B),this._state.depthRange.zNear=v,this._state.depthRange.zFar=
B,this._stateTracker.invalidateDepthWrite()};A.setStencilTestEnabled=function(v){this._state.stencilTest!==v&&(!0===v?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=v,this._stateTracker.invalidateStencilTest())};A.setClearStencil=function(v){v!==this._state.clearStencil&&(this.gl.clearStencil(v),this._state.clearStencil=v)};A.setStencilFunction=function(v,B,C){if(this._state.stencilFunction.func!==v||this._state.stencilFunction.ref!==B||this._state.stencilFunction.mask!==
C)this.gl.stencilFunc(v,B,C),this._state.stencilFunction.face=d.Face.FRONT_AND_BACK,this._state.stencilFunction.func=v,this._state.stencilFunction.ref=B,this._state.stencilFunction.mask=C,this._stateTracker.invalidateStencilTest()};A.setStencilFunctionSeparate=function(v,B,C,E){if(this._state.stencilFunction.face!==v||this._state.stencilFunction.func!==B||this._state.stencilFunction.ref!==C||this._state.stencilFunction.mask!==E)this.gl.stencilFuncSeparate(v,B,C,E),this._state.stencilFunction.face=
v,this._state.stencilFunction.func=B,this._state.stencilFunction.ref=C,this._state.stencilFunction.mask=E,this._stateTracker.invalidateStencilTest()};A.setStencilWriteMask=function(v){this._state.stencilWriteMask!==v&&(this.gl.stencilMask(v),this._state.stencilWriteMask=v,this._stateTracker.invalidateStencilWrite())};A.setStencilOp=function(v,B,C){if(this._state.stencilOperation.face!==d.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==v||this._state.stencilOperation.zFail!==B||this._state.stencilOperation.zPass!==
C)this.gl.stencilOp(v,B,C),this._state.stencilOperation.face=d.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=v,this._state.stencilOperation.zFail=B,this._state.stencilOperation.zPass=C,this._stateTracker.invalidateStencilTest()};A.setStencilOpSeparate=function(v,B,C,E){if(this._state.stencilOperation.face!==v||this._state.stencilOperation.fail!==B||this._state.stencilOperation.zFail!==C||this._state.stencilOperation.zPass!==E)this.gl.stencilOpSeparate(v,B,C,E),this._state.stencilOperation.face=
v,this._state.stencilOperation.fail=B,this._state.stencilOperation.zFail=C,this._state.stencilOperation.zPass=E,this._stateTracker.invalidateStencilTest()};A.setActiveTexture=function(v,B=!1){const C=this._state.activeTexture;0<=v&&(B||v!==this._state.activeTexture)&&(this.gl.activeTexture(d.BASE_TEXTURE_UNIT+v),this._state.activeTexture=v);return C};A.clear=function(v){v&&this.gl.clear(v)};A.clearSafe=function(v,B=255){v&&(v&d.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),v&d.ClearBufferBit.DEPTH_BUFFER_BIT&&
this.setDepthWriteEnabled(!0),v&d.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(B),this.gl.clear(v))};A.drawArrays=function(v,B,C){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=r(v,C));this.gl.drawArrays(v,B,C);u.webglDebugEnabled()&&(v=n.getErrorString(this))&&console.error("drawArrays:",v)};A.drawElements=function(v,B,C,E){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=r(v,B));this.gl.drawElements(v,B,C,E);if(u.webglDebugEnabled()){const F=
n.getErrorString(this);if(F){const M=this.getBoundVAO(),K=M?.indexBuffer,G=K?.size??0,L=E+B;console.error(`drawElements: ${F}${G<L?`. Buffer is too small. Attempted to draw index ${L} of ${G}`:""}`,{args:{mode:v,count:B,type:C,offset:E},vao:{indexBuffer:K,vertexBuffers:M?.vertexBuffers}})}}};A.logInfo=function(){u.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};A.resetInfo=function(){u.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=
0)};A.setViewport=function(v,B,C,E){C=Math.max(Math.round(C),1);E=Math.max(Math.round(E),1);const F=this._state.viewport;if(F.x!==v||F.y!==B||F.width!==C||F.height!==E)F.x=v,F.y=B,F.width=C,F.height=E,this.gl.viewport(v,B,C,E)};A.getViewport=function(){const v=this._state.viewport;return{x:v.x,y:v.y,width:v.width,height:v.height}};A.useProgram=function(v){this._state.program!==v&&(this._state.program?.stop(),this._state.program=v,this.gl.useProgram(v?.glName??null))};A.bindTexture=function(v,B,C=
!1){(B>=this.parameters.maxTextureImageUnits||0>B)&&console.error("Input texture unit is out of range of available units!");const E=this._state.textureUnitMap[B];if(null==v||null==v.glName)return null!=E&&(this.setActiveTexture(B,C),this.gl.bindTexture(E.descriptor.target,null)),this._state.textureUnitMap[B]=null,E;if(!C&&E===v)return v.isDirty&&(this.setActiveTexture(B,C),v.applyChanges()),E;this.setActiveTexture(B,C);this.gl.bindTexture(v.descriptor.target,v.glName);v.applyChanges();this._state.textureUnitMap[B]=
v;return E};A.unbindTexture=function(v){if(null!=v)for(let B=0;B<this.parameters.maxTextureImageUnits;B++)this._state.textureUnitMap[B]===v&&(this.bindTexture(null,B),this._state.textureUnitMap[B]=null)};A.bindFramebuffer=function(v,B=!1){if(B||this._state.readFramebuffer!==v||this._state.drawFramebuffer!==v)null==v?(this.gl.bindFramebuffer(d.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(v.initializeAndBind(d.FramebufferTarget.FRAMEBUFFER),
this._state.readFramebuffer=v,this._state.drawFramebuffer=v)};A.bindFramebufferSeparate=function(v,B,C=!1){const E=B===d.FramebufferTarget.READ_FRAMEBUFFER,F=E?this._state.readFramebuffer:this._state.drawFramebuffer;if(C||F!==v)null==v?this.gl.bindFramebuffer(B,null):v.initializeAndBind(B),E?this._state.readFramebuffer=v??null:this._state.drawFramebuffer=v??null};A.blitFramebuffer=function(v,B,C=0,E=0,F=v.width,M=v.height,K=0,G=0,L=B.width,O=B.height,I=d.ClearBufferBit.COLOR_BUFFER_BIT,H=d.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(v,
d.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(B,d.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(C,E,F,M,K,G,L,O,I,H)};A.bindBuffer=function(v,B){if(v)switch(B??(B=v.bufferType),B){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=w(this.gl,v,B,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=w(this.gl,v,B,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=w(this.gl,v,B,this._state.uniformBuffer);
break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=w(this.gl,v,B,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=w(this.gl,v,B,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=w(this.gl,v,B,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=w(this.gl,v,B,this._state.copyWriteBuffer)}};A.bindRenderbuffer=function(v){const B=this.gl;
v||(B.bindRenderbuffer(B.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==v&&(B.bindRenderbuffer(B.RENDERBUFFER,v.glName),this._state.renderbuffer=v)};A._getBufferBinding=function(v,B){if(B>=this.parameters.maxUniformBufferBindings||0>B)return console.error("Uniform buffer binding point is out of range!"),null;v=this._state.uniformBufferBindingPoints;let C=v[B];null==C&&(C={buffer:null,offset:0,size:0},v[B]=C);return C};A.bindBufferBase=function(v,B,C){const E=this._getBufferBinding(v,
B);null==E||E.buffer===C&&0===E.offset&&0===E.size||(this.gl.bindBufferBase(v,B,C?C.glName:null),E.buffer=C,E.offset=0,E.size=0)};A.bindBufferRange=function(v,B,C,E,F){const M=this._getBufferBinding(v,B);null==M||M.buffer===C&&M.offset===E&&M.size===F||(0!==E%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(v,B,C.glName,E,F),M.buffer=C,M.offset=E,M.size=F))};A.bindUBO=function(v,
B,C,E){null==B?this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,v,null):(u.webglDebugEnabled()&&(E??B.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),B.initialize(),void 0!==C&&void 0!==E?this.bindBufferRange(d.BufferType.UNIFORM_BUFFER,v,B.buffer,C,E):this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,v,B.buffer))};A.unbindUBO=function(v){for(let B=0,C=this._state.uniformBufferBindingPoints.length;B<C;B++){const E=this._state.uniformBufferBindingPoints[B];
null!=E&&E.buffer===v.buffer&&this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,B,null)}};A.unbindBuffer=function(v){switch(v){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=w(this.gl,null,v,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=w(this.gl,null,v,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=w(this.gl,null,v,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=
w(this.gl,null,v,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=w(this.gl,null,v,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=w(this.gl,null,v,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=w(this.gl,null,v,this._state.copyWriteBuffer)}};A.bindVAO=function(v=null){null==v?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null):this._state.vertexArrayObject!==v&&(v.bind(),this._state.vertexArrayObject=v)};A.clientWaitAsync=async function(v=p.Milliseconds(10)){const B=this.gl,C=B.fenceSync(d.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!C)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(d.ResourceType.Sync,C);B.flush();let E;do await y.after(v),E=B.clientWaitSync(C,0,0);while(E===d.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(d.ResourceType.Sync,
C);B.deleteSync(C);if(E===d.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");};A.getBoundFramebufferObject=function(v=d.FramebufferTarget.FRAMEBUFFER){return v===d.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};A.getBoundVAO=function(){return this._state.vertexArrayObject};A.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);
this.type===k.ContextType.WEBGL2&&(this.unbindBuffer(d.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(d.BufferType.COPY_READ_BUFFER),this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER));for(let v=0;v<this.parameters.maxTextureImageUnits;++v)this.bindTexture(null,v);this.setBlendingEnabled(!1);this.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ZERO);this.setBlendEquation(d.BlendOperation.ADD);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(d.Face.BACK);this.setFrontFace(d.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(d.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(d.CompareFunction.ALWAYS,0,0);this.setStencilOp(d.StencilOperation.KEEP,
d.StencilOperation.KEEP,d.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};A.enforceState=function(){var v=this.capabilities.vao;v&&v.bindVertexArray(null);const {gl:B,gl2:C}=this;for(var E=0;E<this.parameters.maxVertexAttributes;E++)B.disableVertexAttribArray(E);this._state.vertexBuffer?
B.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):B.bindBuffer(d.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?B.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):B.bindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER,null);if(null!=C){this._state.uniformBuffer?C.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):C.bindBuffer(d.BufferType.UNIFORM_BUFFER,null);for(E=0;E<this._parameters.maxUniformBufferBindings;E++){const F=
this._state.uniformBufferBindingPoints[E];if(null!=F){const {buffer:M,offset:K,size:G}=F;null!==M?0===K&&0===G?C.bindBufferBase(d.BufferType.UNIFORM_BUFFER,E,M.glName):C.bindBufferRange(d.BufferType.UNIFORM_BUFFER,E,M.glName,K,G):C.bindBufferBase(d.BufferType.UNIFORM_BUFFER,E,null)}}this._state.pixelPackBuffer?C.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):C.bindBuffer(d.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?C.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):C.bindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?C.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):C.bindBuffer(d.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?C.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):C.bindBuffer(d.BufferType.COPY_WRITE_BUFFER,null);C.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,null);C.readBuffer(C.BACK);this._state.readFramebuffer&&
(C.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),C.readBuffer(d.ColorAttachment.COLOR_ATTACHMENT0));C.bindFramebuffer(d.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,B.bindFramebuffer(d.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(v&&this._state.vertexArrayObject){if(v=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(v)}B.useProgram(this._state.program?.glName??null);B.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);B.bindRenderbuffer(B.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?B.enable(this.gl.BLEND):B.disable(this.gl.BLEND);B.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);B.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);B.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);B.clearDepth(this._state.clearDepth);B.clearStencil(this._state.clearStencil);B.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);B.cullFace(this._state.cullFace);B.depthFunc(this._state.depthFunction);B.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?B.enable(B.DEPTH_TEST):B.disable(B.DEPTH_TEST);B.depthMask(this._state.depthWrite);B.frontFace(this._state.frontFace);B.lineWidth(1);!0===this._state.faceCulling?B.enable(B.CULL_FACE):B.disable(B.CULL_FACE);B.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?B.enable(B.POLYGON_OFFSET_FILL):B.disable(B.POLYGON_OFFSET_FILL);B.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?B.enable(B.SCISSOR_TEST):B.disable(B.SCISSOR_TEST);B.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);B.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?B.enable(B.STENCIL_TEST):B.disable(B.STENCIL_TEST);B.stencilMask(this._state.stencilWriteMask);
for(v=0;v<this.parameters.maxTextureImageUnits;v++)B.activeTexture(d.BASE_TEXTURE_UNIT+v),B.bindTexture(d.TextureType.TEXTURE_2D,null),B.bindTexture(d.TextureType.TEXTURE_CUBE_MAP,null),this.type===k.ContextType.WEBGL2&&(B.bindTexture(d.TextureType.TEXTURE_3D,null),B.bindTexture(d.TextureType.TEXTURE_2D_ARRAY,null)),E=this._state.textureUnitMap[v],null!=E&&B.bindTexture(E.descriptor.target,E.glName);B.activeTexture(d.BASE_TEXTURE_UNIT+this._state.activeTexture);v=this._state.viewport;B.viewport(v.x,
v.y,v.width,v.height);this.resetInfo()};A._loadExtensions=function(){this.type===k.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};b._createClass(D,[{key:"gl2",get:function(){return this.type===k.ContextType.WEBGL1?null:this.gl}},{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",
get:function(){return this._capabilities}}]);return D}();a.RenderingContext=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,b,c){b=b._createClass(function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:c.BlendFactor.ONE,dstRGB:c.BlendFactor.ZERO,srcAlpha:c.BlendFactor.ONE,dstAlpha:c.BlendFactor.ZERO};this.blendEquation={mode:c.BlendOperation.ADD,
modeAlpha:c.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=c.Face.BACK;this.frontFace=c.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=c.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:c.Face.FRONT_AND_BACK,func:c.CompareFunction.ALWAYS,
ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:c.Face.FRONT_AND_BACK,fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=
0;this.textureUnitMap=[];this.vertexArrayObject=null});a.ContextState=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,y){const p={RECORD_ALLOCATIONS:!1};let u=function(){function q(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(p.RECORD_ALLOCATIONS);this._current.length<y.ResourceType.COUNT;)this._current.push(0),
this._max.push(0)}var k=q.prototype;k.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};k.increment=function(d,f){const g=++this._current[d];this._max[d]=Math.max(g,this._max[d]);this._allocations.add(f)};k.decrement=function(d,f){--this._current[d];this._allocations.remove(f)};b._createClass(q,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((d,
f)=>d+f,0)}},{key:"resourceInformation",get:function(){let d="";if(0<this.total){d+="Live objects:\n";for(let f=0;f<y.ResourceType.COUNT;++f){const g=this._current[f];0<g&&(d+=`${y.ResourceType[f]}: ${g}\n`)}}return d+=this._allocations.information}}]);return q}();a.InstanceCounter=u;a.test=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(u){this._allocations=
new Map;u?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var p=y.prototype;p.add=function(u){this._allocations.set(u,Error().stack)};p.remove=function(u){this._allocations.delete(u)};b._createClass(y,[{key:"information",get:function(){let u="";if(0<this._allocations.size){u+=`${this._allocations.size} live object allocations:\n`;const q=new Map;this._allocations.forEach(k=>{q.set(k,(q.get(k)??0)+1)});q.forEach((k,d)=>{d=d.split("\n");d.shift();d.shift();u+=`${k}: ${d.shift()}\n`;
d.forEach(f=>u+=`   ${f}\n`)})}return u}}]);return y}();a.AllocationTracer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./capabilities/isWebGL2Context"],function(a,b,c){b=b._createClass(function(y,p,u){p=p.textureFilterAnisotropic;u=u.maxAnisotropy??Infinity;this.versionString=y.getParameter(y.VERSION);this.maxVertexTextureImageUnits=y.getParameter(y.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=y.getParameter(y.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=p?Math.min(y.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY),u):1;this.maxTextureImageUnits=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=y.getParameter(y.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=y.getParameter(y.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=y.getParameter(y.MAX_VIEWPORT_DIMS);c(y)?(this.maxUniformBufferBindings=y.getParameter(y.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=y.getParameter(y.MAX_VERTEX_UNIFORM_BLOCKS),
this.maxFragmentUniformBlocks=y.getParameter(y.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=y.getParameter(y.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=y.getParameter(y.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=y.getParameter(y.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=y.getParameter(y.MAX_SAMPLES)):(this.maxUniformBlockSize=this.maxFragmentUniformBlocks=this.maxVertexUniformBlocks=this.maxUniformBufferBindings=0,this.maxSamples=this.maxArrayTextureLayers=
this.uniformBufferOffsetAlignment=1)});a.Parameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/NestedMap","./Program"],function(a,b,c,y){let p=function(){function u(k){this._rctx=k;this._store=new c.NestedMap}var q=u.prototype;q.dispose=function(){this._store.forEach(k=>k.forEach(d=>d.dispose()));this._store.clear()};q.acquire=function(k,d,f,g){const e=this._store.get(k,
d);if(null!=e)return e.ref(),e;f=new y.Program(this._rctx,k,d,f,g);f.ref();this._store.set(k,d,f);return f};b._createClass(u,[{key:"test",get:function(){let k=0;this._store.forEach(d=>d.forEach(f=>k+=f.hasGLName?2:1));return{cachedWebGLObjects:k}}}]);return u}();a.ProgramCache=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ./checkWebGLError ./contextUtils ./enums ./ShaderTranspiler".split(" "),
function(a,b,c,y,p,u,q,k){function d(h,z,n){h=h.gl;const l=h.createShader(z);h.shaderSource(l,n);h.compileShader(l);p.webglValidateShadersEnabled()&&!h.getShaderParameter(l,h.COMPILE_STATUS)&&(console.error("Compile error in ".concat(z===q.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(h.getShaderInfoLog(l)),console.error(f(n)));e.enabled&&(e.compiledLOC+=n.match(/\n/g).length+1);return l}function f(h){let z=2;return h.replaceAll("\n",()=>{var n=z++;n=1E3<=n?n.toString():("  "+
n).slice(-3);return"\n"+n+":"})}function g(h,z,n){const l=h.get(z);return l?c.update(l,n):(h.set(z,Array.from(n)),!0)}y=function(){function h(n,l,m,t,w=new Map){this._context=n;this._locations=t;this._uniformBlockBindings=w;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;
n||console.error("RenderingContext isn't initialized!");0===l.length&&console.error("Shaders source should not be empty!");this._context.type===u.ContextType.WEBGL2&&(l=k.transpileShader(l,q.ShaderType.VERTEX_SHADER),m=k.transpileShader(m,q.ShaderType.FRAGMENT_SHADER));this._vShader=d(this._context,q.ShaderType.VERTEX_SHADER,l);this._fShader=d(this._context,q.ShaderType.FRAGMENT_SHADER,m);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(q.ResourceType.Shader,
this);p.webglValidateShadersEnabled()&&(this.vertexShader=l,this.fragmentShader=m);const r=this._context.gl,x=r.createProgram();r.attachShader(x,this._vShader);r.attachShader(x,this._fShader);this._locations.forEach((D,A)=>r.bindAttribLocation(x,D,A));r.linkProgram(x);p.webglValidateShadersEnabled()&&!r.getProgramParameter(x,r.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${r.getProgramParameter(x,r.VALIDATE_STATUS)}`+`, gl error ${r.getError()}`+`, vertex: ${r.getShaderParameter(this._vShader,
r.COMPILE_STATUS)}`+`, fragment: ${r.getShaderParameter(this._fShader,r.COMPILE_STATUS)}`+`, info log: ${r.getProgramInfoLog(x)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===u.ContextType.WEBGL2)for(const [D,A]of this._uniformBlockBindings)n=r.getUniformBlockIndex(x,D),4294967295>n&&r.uniformBlockBinding(x,n,A);this._glName=x;this._context.instanceCounter.increment(q.ResourceType.Program,this)}var z=h.prototype;z.dispose=function(){if(!(0<
--this._refCount)){var n=this._context.gl;this._vShader&&(n.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(q.ResourceType.Shader,this));this._fShader&&(n.deleteShader(this._fShader),this._fShader=null);this._glName&&(n.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(q.ResourceType.Program,this))}};z.ref=function(){++this._refCount};z._getUniformLocation=function(n){void 0===this._nameToUniformLocation[n]&&null!=this.glName&&
(++e.numUniforms,this._nameToUniformLocation[n]=this._context.gl.getUniformLocation(this.glName,n));return this._nameToUniformLocation[n]};z.hasUniform=function(n){return null!==this._getUniformLocation(n)};z.setUniform1i=function(n,l){const m=this._nameToUniform1[n];if(void 0===m||l!==m)this._context.gl.uniform1i(this._getUniformLocation(n),l),this._nameToUniform1[n]=l};z.setUniform1iv=function(n,l){g(this._nameToUniform1v,n,l)&&this._context.gl.uniform1iv(this._getUniformLocation(n),l)};z.setUniform2iv=
function(n,l){g(this._nameToUniform2,n,l)&&this._context.gl.uniform2iv(this._getUniformLocation(n),l)};z.setUniform3iv=function(n,l){g(this._nameToUniform3,n,l)&&this._context.gl.uniform3iv(this._getUniformLocation(n),l)};z.setUniform4iv=function(n,l){g(this._nameToUniform4,n,l)&&this._context.gl.uniform4iv(this._getUniformLocation(n),l)};z.setUniform1f=function(n,l){const m=this._nameToUniform1[n];if(void 0===m||l!==m)this._context.gl.uniform1f(this._getUniformLocation(n),l),this._nameToUniform1[n]=
l};z.setUniform1fv=function(n,l){g(this._nameToUniform1v,n,l)&&this._context.gl.uniform1fv(this._getUniformLocation(n),l)};z.setUniform2f=function(n,l,m){const t=this._nameToUniform2.get(n);if(void 0===t)this._context.gl.uniform2f(this._getUniformLocation(n),l,m),this._nameToUniform2.set(n,[l,m]);else if(l!==t[0]||m!==t[1])this._context.gl.uniform2f(this._getUniformLocation(n),l,m),t[0]=l,t[1]=m};z.setUniform2fv=function(n,l){g(this._nameToUniform2,n,l)&&this._context.gl.uniform2fv(this._getUniformLocation(n),
l)};z.setUniform3f=function(n,l,m,t){const w=this._nameToUniform3.get(n);if(void 0===w)this._context.gl.uniform3f(this._getUniformLocation(n),l,m,t),this._nameToUniform3.set(n,[l,m,t]);else if(l!==w[0]||m!==w[1]||t!==w[2])this._context.gl.uniform3f(this._getUniformLocation(n),l,m,t),w[0]=l,w[1]=m,w[2]=t};z.setUniform3fv=function(n,l){g(this._nameToUniform3,n,l)&&this._context.gl.uniform3fv(this._getUniformLocation(n),l)};z.setUniform4f=function(n,l,m,t,w){const r=this._nameToUniform4.get(n);if(void 0===
r)this._context.gl.uniform4f(this._getUniformLocation(n),l,m,t,w),this._nameToUniform4.set(n,[l,m,t,w]);else if(void 0===r||l!==r[0]||m!==r[1]||t!==r[2]||w!==r[3])this._context.gl.uniform4f(this._getUniformLocation(n),l,m,t,w),r[0]=l,r[1]=m,r[2]=t,r[3]=w};z.setUniform4fv=function(n,l){g(this._nameToUniform4,n,l)&&this._context.gl.uniform4fv(this._getUniformLocation(n),l)};z.setUniformMatrix3fv=function(n,l,m=!1){g(this._nameToUniformMatrix3,n,l)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(n),
m,l)};z.setUniformMatrix4fv=function(n,l,m=!1){g(this._nameToUniformMatrix4,n,l)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(n),m,l)};z.stop=function(){};b._createClass(h,[{key:"glName",get:function(){return this._glName}},{key:"hasGLName",get:function(){return null!=this._glName}},{key:"compiled",get:function(){if(this._compiled)return!0;const n=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==n||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,
n.COMPLETION_STATUS_KHR)}}]);return h}();const e={compiledLOC:0,numUniforms:0,enabled:!1};a.Program=y;a.test=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,c,y,p,u){function q(){function m(R){R.length&&K.push({type:z[C],data:R,position:O,line:G,column:L})}function t(){M=M.length?[]:M;if("/"===F&&"*"===E)return O=B+
v-1,C=0,F=E,v+1;if("/"===F&&"/"===E)return O=B+v-1,C=1,F=E,v+1;if("#"===E)return C=2,O=B+v,v;if(/\s/.test(E))return C=9,O=B+v,v;I=/\d/.test(E);H=/[^\w_]/.test(E);O=B+v;C=I?4:H?3:9999;return v}function w(){if(("\r"===E||"\n"===E)&&"\\"!==F)return m(M.join("")),C=999,v;M.push(E);F=E;return v+1}function r(){if("."===F&&/\d/.test(E))return C=5,v;if("/"===F&&"*"===E)return C=0,v;if("/"===F&&"/"===E)return C=1,v;if("."===E&&M.length){for(;x(M););C=5;return v}if(";"===E||")"===E||"("===E){if(M.length)for(;x(M););
m(E);C=999;return v+1}var R=2===M.length&&"\x3d"!==E;if(/[\w_\d\s]/.test(E)||R){for(;x(M););C=999;return v}M.push(E);F=E;return v+1}function x(R){var W=0;do{var T=u.operators.indexOf(R.slice(0,R.length+W).join(""));var P=u.operators[T];if(-1===T){if(0<W--+R.length)continue;P=R.slice(0,1).join("")}m(P);O+=P.length;M=M.slice(P.length);return M.length}while(1)}function D(){if("."===E||/[eE]/.test(E))return M.push(E),C=5,F=E,v+1;if("x"===E&&1===M.length&&"0"===M[0])return C=11,M.push(E),F=E,v+1;if(/[^\d]/.test(E))return m(M.join("")),
C=999,v;M.push(E);F=E;return v+1}function A(){"f"===E&&(M.push(E),F=E,v+=1);if(/[eE]/.test(E)||"-"===E&&/[eE]/.test(F))return M.push(E),F=E,v+1;if(/[^\d]/.test(E))return m(M.join("")),C=999,v;M.push(E);F=E;return v+1}var v=0,B=0,C=999,E,F,M=[],K=[],G=1,L=0,O=0,I=!1,H=!1,J="",N;return function(R){K=[];if(null!==R){R=R.replace?R.replace(/\r\n/g,"\n"):R;v=0;J+=R;for(N=J.length;E=J[v],v<N;){R=v;switch(C){case 0:"/"===E&&"*"===F?(M.push(E),m(M.join("")),C=999):(M.push(E),F=E);v+=1;break;case 1:v=w();break;
case 2:v=w();break;case 3:v=r();break;case 4:v=D();break;case 11:/[^a-fA-F0-9]/.test(E)?(m(M.join("")),C=999):(M.push(E),F=E,v+=1);break;case 5:v=A();break;case 9999:if(/[^\d\w_]/.test(E)){var W=M.join("");C=-1<u.literals.indexOf(W)?8:-1<u.builtins.indexOf(W)?7:6;m(M.join(""));C=999}else M.push(E),F=E,v+=1;break;case 9:/[^\s]/g.test(E)?(m(M.join("")),C=999):(M.push(E),F=E,v+=1);break;case 999:v=t()}if(R!==v)switch(J[R]){case "\n":L=0;++G;break;default:++L}}B+=v;J=J.slice(v);return K}M.length&&m(M.join(""));
C=10;m("(eof)");return K}}function k(m){return m.map(t=>"eof"!==t.type?t.data:"").join("")}function d(m,t="100",w="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const x of m)if("preprocessor"===x.type){const D=r.exec(x.data);if(D){m=D[1].replaceAll(/\s\s+/g," ");if(m===w)return m;if(m===t)return x.data="#version "+w,t;throw Error("unknown glsl version: "+m);}}m.splice(0,0,{type:"preprocessor",data:"#version "+w},{type:"whitespace",data:"\n"});return null}function f(m,t,w,r){r=r||
w;for(const x of m)if("ident"===x.type&&x.data===w)return r in t?t[r]++:t[r]=0,f(m,t,r+"_"+t[r],r);return w}function g(m,t,w="afterVersion"){const r={data:"\n",type:"whitespace"},x=A=>A<m.length?/[^\r\n]$/.test(m[A].data):!1;let D=function(A){let v=-1,B=0,C=-1;for(let F=0;F<A.length;F++){var E=A[F];"preprocessor"===E.type&&(/#(if|ifdef|ifndef)\s+.+/.test(E.data)?++B:/#endif\s*.*/.test(E.data)&&--B);("afterVersion"===w||"afterPrecision"===w)&&"preprocessor"===E.type&&/^#version/.test(E.data)&&(C=Math.max(C,
F));if("afterPrecision"===w&&"keyword"===E.type&&"precision"===E.data){a:{for(E=F;E<A.length;E++){const M=A[E];if("operator"===M.type&&";"===M.data)break a}E=null}if(null===E)throw Error("precision statement not followed by any semicolons!");C=Math.max(C,E)}v<C&&0===B&&(v=F)}return v+1}(m);x(D-1)&&m.splice(D++,0,r);for(const A of t)m.splice(D++,0,A);x(D-1)&&x(D)&&m.splice(D,0,r)}function e(m,t,w,r="lowp"){g(m,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",
data:" "},{type:"keyword",data:w},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function h(m,t,w,r,x="lowp"){g(m,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",
data:x},{type:"whitespace",data:" "},{type:"keyword",data:w},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}var z="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const n=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],l=new Map;a.transpileShader=function(m,t){if(m.startsWith("#version 300"))return m;var w=p.shaderTranspiler.enableCache?
l.get(m):null;if(null!=w)return w;w=q();var r=[];r=r.concat(w(m));w=r=r.concat(w(null));if("300 es"===d(w,"100","300 es"))return m;var x=r=null;const D={},A={};for(let E=0;E<w.length;++E){const F=w[E];switch(F.type){case "keyword":t===c.ShaderType.VERTEX_SHADER&&"attribute"===F.data?F.data="in":"varying"===F.data&&(F.data=t===c.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(F.data.trim())&&(F.data=F.data.replaceAll(/(2D|Cube|EXT)/g,""));
t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===F.data&&(r||(r=f(w,D,"fragColor"),e(w,r,"vec4")),F.data=r);if(t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===F.data){var v=void 0;let M=void 0;var B=w,C=E+1;let K=-1;for(;C<B.length;C++){const G=B[C];if("operator"===G.type&&("["===G.data&&(M=C),"]"===G.data)){v=C;break}"integer"===G.type&&(K=parseInt(G.data,10))}M&&v&&B.splice(M,v-M+1);B=K;v=f(w,D,"fragData");h(w,v,"vec4",B,"mediump");F.data=v}else t===c.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===
F.data&&(x||(x=f(w,D,"gl_FragDepth")),F.data=x);break;case "ident":if(y.includes(F.data)){if(B=t===c.ShaderType.VERTEX_SHADER)a:{for(B=E-1;0<=B;B--)if(v=w[B],"whitespace"!==v.type&&"block-comment"!==v.type)if("keyword"===v.type){if("attribute"===v.data||"in"===v.data){B=!0;break a}}else break;B=!1}if(B)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");F.data in A||(A[F.data]=f(w,D,F.data));F.data=A[F.data]}}}for(t=w.length-1;0<=t;--t)r=w[t],"preprocessor"===
r.type&&((x=r.data.match(/#extension\s+(.*):/))&&x[1]&&n.includes(x[1].trim())&&(x=w[t+1],w.splice(t,x&&"whitespace"===x.type?2:1)),(x=r.data.match(/#ifdef\s+(.*)/))&&x[1]&&n.includes(x[1].trim())&&(r.data="#if 1"),(x=r.data.match(/#ifndef\s+(.*)/))&&x[1]&&n.includes(x[1].trim())&&(r.data="#if 0"));w=k(w);p.shaderTranspiler.enableCache&&l.set(m,w);return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,b){var c={exports:{}};c.exports;(function(u){(function(q){q=q();void 0!==q&&(u.exports=q)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(c);
c=b.getDefaultExportFromCjs(c.exports);var y={exports:{}};y.exports;(function(u){(function(q){q=q();void 0!==q&&(u.exports=q)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(y);y=b.getDefaultExportFromCjs(y.exports);var p={exports:{}};p.exports;(function(u){(function(q){q=q();void 0!==q&&(u.exports=
q)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(p);
b=b.getDefaultExportFromCjs(p.exports);a.builtins=b;a.literals=c;a.operators=y})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,c,y,p,u,q){let k=function(){function d(f){this.rctx=f;this.floatBufferBlend=new p.FloatBufferBlend(f);this.svgPremultipliesAlpha=new q.SVGPremultipliedAlpha(f);this.doublePrecisionRequiresObfuscation=
new y.DoublePrecisionRequiresObfuscation(f);this.ignoresSamplerPrecision=new u.IgnoresSamplerPrecision(f);this.drawArraysRequiresIndicesTypeReset=new c.DrawArraysRequiresIndicesTypeReset(f)}d.prototype.dispose=function(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()};return b._createClass(d)}();a.WebGLDriverTest=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./contextUtils ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){g=function(e){function h(n){var l=e.call(this)||this;l._rctx=n;l._helperProgram=null;l._rctx.type===q.ContextType.WEBGL2&&
c("mac")&&c("chrome")&&(l._program=l._prepareProgram(),l._helperProgram=l._prepareHelperProgram());return l}b._inherits(h,e);var z=h.prototype;z.dispose=function(){b._get(b._getPrototypeOf(h.prototype),"dispose",this).call(this);this._helperProgram?.dispose();this._helperProgram=null};z._test=function(n){const l=this._rctx;l.resetState();var m=new f.TextureDescriptor(1);m.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;m.samplingMode=k.TextureSamplingMode.NEAREST;m=new d.FramebufferObject(l,m);const t=u.BufferObject.createIndex(this._rctx,
k.Usage.STATIC_DRAW,new Uint8Array([0]));l.bindFramebuffer(m);l.setViewport(0,0,1,1);l.useProgram(this._helperProgram);l.bindBuffer(t,k.BufferType.ELEMENT_ARRAY_BUFFER);l.drawElements(k.PrimitiveType.POINTS,1,k.DataType.UNSIGNED_BYTE,0);l.useProgram(n);l.bindVAO(null);l.drawArrays(k.PrimitiveType.TRIANGLES,0,258);n=new Uint8Array(4);m.readPixels(0,0,1,1,k.PixelFormat.RGBA,k.PixelType.UNSIGNED_BYTE,n);m.dispose();t.dispose();return 255===n[0]};z._prepareProgram=function(){const n=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${y.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
l=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${y.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(n,l,new Map([]))};z._prepareHelperProgram=function(){const n=p.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(n.vertex,n.fragment,new Map([]))};return b._createClass(h)}(g.WebGLDriverTestModule);
a.DrawArraysRequiresIndicesTypeReset=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){let y=function(){function p(){this._result=!1}p.prototype.dispose=function(){this._program=c.disposeMaybe(this._program)};b._createClass(p,[{key:"result",get:function(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}]);
return p}();a.WebGLDriverTestModule=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(l,
m){return l.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${m?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}z=function(l){function m(w){var r=l.call(this)||this;r._rctx=w;r._program=n(r._rctx,!1);r._obfuscated=n(r._rctx,!0);return r}b._inherits(m,l);var t=m.prototype;t.dispose=function(){b._get(b._getPrototypeOf(m.prototype),"dispose",this).call(this);this._obfuscated=p.disposeMaybe(this._obfuscated)};t._test=function(w){if(y("force-double-precision-obfuscation"))return!0;
if(null==this._obfuscated)return!1;w=this._runProgram(w);const r=this._runProgram(this._obfuscated);return 0!==w&&(0===r||5<w/r)};t._runProgram=function(w){var r=this._rctx;r.resetState();var x=new g.TextureDescriptor(1);x.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=d.TextureSamplingMode.NEAREST;x=new f.FramebufferObject(r,x);var D=q.BufferObject.createVertex(r,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));D=new e.VertexArrayObject(r,new Map([["position",0]]),{geometry:[new h.VertexElementDescriptor("position",
2,d.DataType.UNSIGNED_SHORT,0,4)]},{geometry:D});const A=u.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),v=u.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),B=new Float32Array(6);k.encodeDoubleArray(A,B,3);const C=new Float32Array(6);k.encodeDoubleArray(v,C,3);r.useProgram(w);w.setUniform3f("u_highA",B[0],B[2],B[4]);w.setUniform3f("u_lowA",B[1],B[3],B[5]);w.setUniform3f("u_highB",C[0],C[2],C[4]);w.setUniform3f("u_lowB",C[1],C[3],C[5]);r.bindFramebuffer(x);r.setViewport(0,
0,1,1);r.bindVAO(D);r.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);w=new Uint8Array(4);x.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,w);D.dispose();x.dispose();r=(A[2]-v[2])/25;w=c.unpackFloatRGBA(w);return Math.abs(r-w)};return b._createClass(m)}(z.WebGLDriverTestModule);a.DoublePrecisionRequiresObfuscation=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./contextUtils ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){e=function(h){function z(n){var l=h.call(this)||this;l._rctx=n;if(!n.gl)return b._possibleConstructorReturn(l);if(n.type===p.ContextType.WEBGL1)return l._result=!(!n.capabilities.textureFloat?.textureFloat||!n.capabilities.colorBufferFloat?.textureFloat),b._possibleConstructorReturn(l);if(!(n.capabilities.textureFloat?.textureFloat&&n.capabilities.colorBufferFloat?.textureFloat&&n.capabilities.colorBufferFloat?.floatBlend))return b._possibleConstructorReturn(l);l._program=
n.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]));return l}b._inherits(z,h);z.prototype._test=function(n){const l=this._rctx;var m=new d.TextureDescriptor(1);m.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;m.dataType=u.PixelType.FLOAT;m.internalFormat=
u.SizedPixelFormat.RGBA32F;m.samplingMode=u.TextureSamplingMode.NEAREST;m=new q.FramebufferObject(l,m);var t=y.BufferObject.createVertex(l,u.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new f.VertexArrayObject(l,new Map([["a_pos",0]]),{geometry:[new g.VertexElementDescriptor("a_pos",2,u.DataType.UNSIGNED_SHORT,0,4)]},{geometry:t});l.useProgram(n);n=l.getBoundFramebufferObject();const {x:w,y:r,width:x,height:D}=l.getViewport();l.bindFramebuffer(m);l.setViewport(0,0,1,1);l.bindVAO(t);l.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,
0,4);var A=k.makePipelineState({blending:c.blendingAlpha});l.setPipelineState(A);l.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);A=l.gl.getError();l.setViewport(w,r,x,D);l.bindFramebuffer(n);t.dispose();m.dispose();return 1282===A?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};return b._createClass(z)}(e.WebGLDriverTestModule);a.FloatBufferBlend=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){g=function(e){function h(z){var n=e.call(this)||this;n._rctx=z;n._program=z.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]));return n}b._inherits(h,e);h.prototype._test=function(z){const n=this._rctx;var l=new k.TextureDescriptor(1);l.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;l.samplingMode=p.TextureSamplingMode.NEAREST;const m=new u.FramebufferObject(n,l),t=new Uint8Array(4);var w=y.BufferObject.createVertex(n,p.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,
1]));w=new d.VertexArrayObject(n,new Map([["a_position",0]]),{geometry:[new f.VertexElementDescriptor("a_position",2,p.DataType.SHORT,0,4)]},{geometry:w});n.useProgram(z);l=new q.Texture(n,l,new Uint8Array([2,255,0,0]));z.setUniform1i("u_texture",0);n.bindTexture(l,0);l=n.getBoundFramebufferObject();n.bindFramebuffer(m);n.useProgram(z);const {x:r,y:x,width:D,height:A}=n.getViewport();n.setViewport(0,0,1,1);n.bindVAO(w);n.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);n.setViewport(r,x,D,A);m.readPixels(0,
0,1,1,p.PixelFormat.RGBA,p.PixelType.UNSIGNED_BYTE,t);w.dispose();m.dispose();(z=255!==t[0]||255!==t[1]||255!==t[2]||255!==t[3])&&c.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${t[0]}.${t[1]}.${t[2]}.${t[3]}]`);
n.bindFramebuffer(l);return z};return b._createClass(h)}(g.WebGLDriverTestModule);a.IgnoresSamplerPrecision=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,c,y,p,u,q,k,d,f){f=function(e){function h(n){var l=
e.call(this)||this;l._rctx=n;l._program=n.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]));return l}b._inherits(h,e);var z=h.prototype;
z.dispose=function(){b._get(b._getPrototypeOf(h.prototype),"dispose",this).call(this)};z._test=function(n){const l=this._rctx;if(!l.gl)return n.dispose(),!0;var m=new k.TextureDescriptor(1);m.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;m.samplingMode=p.TextureSamplingMode.NEAREST;m=new u.FramebufferObject(l,m);var t=y.BufferObject.createVertex(l,p.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new d.VertexArrayObject(l,new Map([["a_pos",0]]),c.Pos2us,{geometry:t});var w=new k.TextureDescriptor;
w.samplingMode=p.TextureSamplingMode.LINEAR;w.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;w=new q.Texture(l,w,g);l.useProgram(n);l.bindTexture(w,0);n.setUniform1i("u_texture",0);n=l.getBoundFramebufferObject();const {x:r,y:x,width:D,height:A}=l.getViewport();l.bindFramebuffer(m);l.setViewport(0,0,1,1);l.setClearColor(0,0,0,0);l.setBlendingEnabled(!1);l.clearSafe(p.ClearBufferBit.COLOR_BUFFER_BIT);l.bindVAO(t);l.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);m.readPixels(0,0,
1,1,p.PixelFormat.RGBA,p.PixelType.UNSIGNED_BYTE,v);t.dispose();m.dispose();w.dispose();l.setViewport(r,x,D,A);l.bindFramebuffer(n);return 255!==v[0]};return b._createClass(h)}(f.WebGLDriverTestModule);const g=new Image;g.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
g.width=5;g.height=5;g.decode();a.SVGPremultipliedAlpha=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const y={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},p={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,
2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=y;a.Pos2us=b;a.PosTex2b=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),function(a,b,c,y,p,u,q,k){let d=function(){function f(g,e){this._gl=g;this._textureFloatLinear=
this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=this._instancing=null;this._disabledExtensions=e.disabledExtensions||{};this._debugWebGLExtensions=e.debugWebGLExtensions||{}}f.prototype.enable=function(g){return this[g]};b._createClass(f,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=
y.load(this._gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||(this._instancing=p.load(this._gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=k.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=u.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}},
{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=u.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=u.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=
c.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=u.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=u.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=
u.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=u.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=q.load(this._gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",
get:function(){this._textureNorm16||(this._textureNorm16=u.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=u.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return f}();a.Capabilities=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports",
"./isWebGL2Context"],function(a,b){a.load=function(c,y){return y.disjointTimerQuery?null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:y.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports",
"./isWebGL2Context"],function(a,b){a.load=function(c){return b(c)?c:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,y,p,u,q){if(u&&
b(c))return!0;if(y[p])return!1;for(const k of q)if(c.getExtension(k))return!0;return!1};a.loadColorBufferFloat=function(c,y){if(b(c)){var p=!y.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!y.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),u=!y.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");y=!y.floatBlend&&!y.colorBufferFloat&&c.getExtension("EXT_float_blend");return p||u||y?{textureFloat:!!u,textureHalfFloat:!!p,floatBlend:!!y,R16F:c.R16F,RG16F:c.RG16F,
RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(p=!y.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),u=!y.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!y.floatBlend&&!y.colorBufferFloat&&c.getExtension("EXT_float_blend"),p||u||c?{textureFloat:!!u,textureHalfFloat:!!p,floatBlend:!!c,RGBA16F:p?p.RGBA16F_EXT:void 0,RGB16F:p?p.RGB16F_EXT:void 0,RGBA32F:u?
u.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,y){return y.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,y){return y.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,y){return b(c)?{MIN:c.MIN,MAX:c.MAX}:y.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,y){return y.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,
TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,y){if(b(c))return{textureFloat:!0,textureFloatLinear:!y.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const p=!y.textureHalfFloat&&c.getExtension("OES_texture_half_float");
return{textureFloat:!y.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!y.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!p,textureHalfFloatLinear:!y.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:p?p.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(c,y){return!b(c)||y.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,
R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const y=c.loseContext&&b.getExtension("WEBGL_lose_context");return y?{loseRenderingContext:()=>y.loseContext()}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports",
"./isWebGL2Context"],function(a,b){a.load=function(c,y){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:y.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:
null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){a.TextureRepository=function(r){function x(A,v,B){var C=r.call(this,{})||this;C._stage=A;C._techniqueRepository=v;C._rctx=B;C._textures=new Map;C._loadingCount=0;C._frameUpdates=new Map;C.events=new p;C._frameTask=A.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXTURE_UNLOAD);return C}b._inherits(x,r);var D=x.prototype;D.normalizeCtorArgs=function(){return{}};D.destroy=function(){this._frameTask.remove();this._stage.forEachOfType(z.ContentObjectType.Texture,
A=>A.unload())};D.acquire=function(A){const v=this._textures.get(A);return v?(v.ref(),v.loadingPromise??v):this._createNewRef(A)};D.update=function(){let A=!1;this._frameUpdates.forEach(v=>{const B=v.texture.frameUpdate(v.previousToken);0<=B&&B!==v.previousToken&&(v.previousToken=B,A=!0)});A&&this.events.emit("changed",h.RenderRequestType.BACKGROUND)};D._createNewRef=function(A){const v=this._stage.getObject(A);if(null==v)return m.assert(void 0!==v),null;const B=v.events.on("unloaded",()=>{B.remove();
this._onTextureUnloaded(A)}),C=new w(A,()=>{this._frameTask.schedule(()=>{C.isUnreferenced&&v.unload()})});this._textures.set(A,C);C.ref();if(null!=v.glTexture)return this._updateGLTexture(C,v.glTexture),v.requiresFrameUpdates&&this._frameUpdates.set(A,{texture:v,previousToken:-1}),C;this._loadingCount++;C.loadingPromise=this._stage.schedule(()=>{const E=v.load(this._rctx),F=K=>{this._loadingCount--;C.loadingPromise=null;this._updateGLTexture(C,K);v.requiresFrameUpdates&&this._frameUpdates.set(A,
{texture:v,previousToken:-1});return C},M=K=>{this._loadingCount--;C.loadingPromise=null;q.isAbortError(K)||u.getLogger(this).error(K);return null};return q.isPromiseLike(E)?E.then(F,M):F(E)});return C.loadingPromise};D._updateGLTexture=function(A,v){A.glTexture=v;this.events.emit("changed",h.RenderRequestType.UPDATE)};D._onTextureUnloaded=function(A){this._textures.delete(A);this._frameUpdates.delete(A)};b._createClass(x,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},
{key:"textureTechnique",get:function(){null==this._textureTechnique&&(this._textureTechnique=this._techniqueRepository.acquire(n.TextureTechnique,new l.TextureTechniqueConfiguration));return this._textureTechnique}}]);return x}(y);c.__decorate([k.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([k.property()],a.TextureRepository.prototype,"_frameTask",void 0);c.__decorate([k.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],
a.TextureRepository);let w=function(){function r(D,A){this.id=D;this._release=A;this._refCount=0}var x=r.prototype;x.ref=function(){++this._refCount};x.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(u.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))};b._createClass(r,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return r}();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports","../../support/engineContent/marker","./ProceduralTextureRepository"],function(a,b,c){a.createMarkerTextureRepository=function(y,p){return new c.ProceduralTextureRepository(u=>b.createMarkerTexture(u,y),u=>u,p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){a.WaterTextureRepository=function(r){function x(){var A=r.apply(this,arguments)||this;A._passParameters=new w;A._loading=0;return A}b._inherits(x,r);var D=x.prototype;D.destroy=function(){this._passParameters.waveNormal=q.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePertubation=q.disposeMaybe(this._passParameters.wavePertubation)};D.ensureResources=function(A){if(0<this._loading)return n.ResourceState.LOADING;if(null!=this._passParameters.waveNormal&&
null!=this._passParameters.wavePertubation)return n.ResourceState.LOADED;const v=new t.TextureDescriptor;v.samplingMode=l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;v.hasMipmap=!0;v.maxAnisotropy=8;++this._loading;h.requestImage(y.getAssetUrl("esri/images/materials/water/normals.jpg")).then(B=>this._passParameters.waveNormal=new m.Texture(A,{...v,width:B.width,height:B.height},B)).catch(B=>u.getLogger(this).error("Failed to load water material normal texture.",B)).finally(()=>--this._loading);++this._loading;
h.requestImage(y.getAssetUrl("esri/images/materials/water/perturbation.jpg")).then(B=>this._passParameters.wavePertubation=new m.Texture(A,{...v,width:B.width,height:B.height},B)).catch(B=>u.getLogger(this).error("Failed to load water material pertubation texture.",B)).finally(()=>--this._loading);return n.ResourceState.LOADING};b._createClass(x,[{key:"passParameters",get:function(){return this._passParameters}},{key:"updating",get:function(){return 0<this._loading}}]);return x}(p);c.__decorate([k.property()],
a.WaterTextureRepository.prototype,"_loading",void 0);c.__decorate([k.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);let w=function(r){function x(){return r.apply(this,arguments)||this}b._inherits(x,r);return b._createClass(x)}(z.NoParameters);a.WaterTexturePassParameters=w;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/basicInterfaces ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor ../../../../core/imageUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){let z=b._createClass(function(l,m){this.parameters=l;this.frameHasDecorations=m}),n=function(){function l(t,w,r,x){this._rctx=t;this._renderFunctions=w;this._forceCameraHook=r;this._disposeOffscreenBuffers=x;this.supersample=!0;this._screenshotQueue=[]}var m=l.prototype;m.destroy=function(){this._rctx=null};m.takeScreenshot=async function(t){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(u.RenderRequestType.BACKGROUND);const w=
y.createResolver();this._screenshotQueue.push({settings:t,resolver:w});return w.promise};m.update=function(t,w){for(const r of this._screenshotQueue){if(null==this._rctx){r.resolver.reject();continue}const x=this._renderScreenshot(t,{...r.settings,pixelRatio:r.settings.pixelRatio*t.parameters.camera.pixelRatio},w);r.resolver(x)}this._screenshotQueue.length=0};m._renderScreenshotOverlay=function(t,w,r){t.width=w.width;t.height=w.height;const x=t.getContext("2d"),D=r.pixelRatio;x.save();x.translate(0,
w.height);x.scale(1,-1);r.region&&x.translate(-r.region.x,-r.region.y);x.scale(D,D);w=this._renderFunctions.renderOverlay(t,w);x.restore();return w};m._readbackScreenshot=function(t,w){return t.resample?this._readbackScreenshotResampled({...t,resample:t.resample},w):this._readbackScreenshotImmediate(t,w)};m._readbackScreenshotResampled=function(t,w){const {framebufferWidth:r,framebufferHeight:x,region:D,resample:A}=t,v=this._ensureScreenshotEncodeCanvas();let B=h.createEmptyImageData(r,x,v);this._rctx.gl.readPixels(0,
0,r,x,d.PixelFormat.RGBA,d.DataType.UNSIGNED_BYTE,new Uint8Array(B.data.buffer));w();B=this._renderScreenshotOverlay(v,B,{...t,region:void 0});t=h.createEmptyImageData(D.width,D.height,v);return k.resampleHermite(B,t,!0,A.region.x,x-(A.region.y+A.region.height),A.region.width,A.region.height)};m._readbackScreenshotImmediate=function(t,w){const {framebufferHeight:r,region:x}=t,D=this._ensureScreenshotEncodeCanvas(),A=h.createEmptyImageData(x.width,x.height,D);this._rctx.gl.readPixels(x.x,r-(x.y+x.height),
x.width,x.height,d.PixelFormat.RGBA,d.DataType.UNSIGNED_BYTE,new Uint8Array(A.data.buffer));w();return this._renderScreenshotOverlay(D,A,t)};m._renderScreenshot=function(t,w,r){let x=null;var D=t.parameters.camera,A={width:w.framebufferWidth,height:w.framebufferHeight};f.ensureAttachmentMaxSize(A,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));var v=!1,B=w.disableDecorations&&t.frameHasDecorations,C=w.ignorePadding&&D.pixelRatio!==w.pixelRatio;B=A.width!==
D.fullWidth||A.height!==D.fullHeight||B||C||w.objectAndLayerIdColor;const E=w.objectAndLayerIdColor?new f.FramebufferObject(this._rctx,new e.TextureDescriptor(A.width,A.height),new g.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_STENCIL,A.width,A.height)):null;if(B){v=D.clone();if(w.ignorePadding){C=p.clone(v.padding);for(var F=0;4>F;F++)C[F]=Math.round(C[F]/v.pixelRatio*w.pixelRatio);v.padding=C}v.fullWidth=A.width;v.fullHeight=A.height;v.pixelRatio=w.pixelRatio;C=D.fovX-v.fovX;F=D.fovY-v.fovY;
0>C&&C<F?v.fovX=D.fovX:0>F&&F<C&&(v.fovY=D.fovY);D={camera:v,contentCamera:v,mode:q.RenderState.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(D);v=!0;x=new f.FramebufferObject(this._rctx,new e.TextureDescriptor(A.width,A.height),new g.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_STENCIL,A.width,A.height));this._renderFunctions.renderScene(x,E,D,w.disableDecorations?u.Decorations.OFF:u.Decorations.ON,r);this._disposeOffscreenBuffers()}A=()=>{this._rctx.bindFramebuffer(null);
c.disposeMaybe(x)};r=this._readbackScreenshot(w,A);A();A=null;w.objectAndLayerIdColor&&(D=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(E)},this._rctx.bindFramebuffer(E),A=this._readbackScreenshot(w,D),this._rctx.bindFramebuffer(null),D());if(B&&!this._rctx.contextAttributes.alpha)for(w=3;w<r.data.length;w+=4)r.data[w]=255;if(A&&!this._rctx.contextAttributes.alpha)for(w=3;w<A.data.length;w+=4)A.data[w]=255;v&&this._forceCameraHook(t.parameters);return[r,A]};m._ensureScreenshotEncodeCanvas=
function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return b._createClass(l)}();a.ScreenshotContext=z;a.ScreenshotManager=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(a,b,c,y){function p(l,m){const {format:t,quality:w,rotation:r,disableDecorations:x}=
l||{};var D=f(l,m.padding);var A=m.width-D.left-D.right;m=m.height-D.top-D.bottom;D={x:0,y:0,width:A,height:m};if(l&&l.area){null!=l.area.x&&(D.x=Math.floor(l.area.x));null!=l.area.y&&(D.y=Math.floor(l.area.y));var v=null!=l.area.width?Math.floor(l.area.width):null,B=null!=l.area.height?Math.floor(l.area.height):null;D.width=A-D.x;D.height=m-D.y;null!=v&&null!=B?(D.width=Math.min(D.width,v),D.height=Math.min(D.height,B)):null==v&&null!=B?(v=Math.min(D.width,v),D.height*=v/D.width,D.width=v):null!=
v&&null==B&&(v=Math.min(D.height,B),D.width*=v/D.height,D.height=v)}D=d(D,l);v=Math.floor(Math.max(D.x,0));B=Math.floor(Math.max(D.y,0));A={x:v,y:B,width:Math.floor(Math.min(D.width,A-v)),height:Math.floor(Math.min(D.height,m-B))};m=A.width/A.height;D=D.width/D.height;D!==m&&(D>m?(m=Math.floor(A.width/D),A={x:A.x,y:Math.floor(A.y+(A.height-m)/2),width:A.width,height:m}):(m=Math.floor(A.height*D),A={x:Math.floor(A.x+(A.width-m)/2),y:A.y,width:m,height:A.height}));const {width:C,height:E}=k(l,A);m=
g(t);D=z[m];D=c.clamp(null!=w?w:D,0,100);return{format:m,quality:D,area:A,width:C,height:E,rotation:r,disableDecorations:!!x,ignoreBackground:!(!l||!l.ignoreBackground),ignorePadding:!(!l||!l.ignorePadding)}}function u(l,m){null==e&&(e=document.createElement("canvas"));var t=e;if(m.premultipliedAlpha){var w=l.data;const x=w.length;for(let D=0;D<x;D+=4){var r=w[D+3];255!==r&&0<r&&(r=255/r,w[D]*=r,w[D+1]*=r,w[D+2]*=r)}}t.width=l.width;t.height=l.height;w=t.getContext("2d",{willReadFrequently:!0});w.putImageData(l,
0,0);m.flipY&&(w.save(),w.globalCompositeOperation="copy",w.scale(1,-1),w.translate(0,-w.canvas.height),w.drawImage(w.canvas,0,0),w.restore());return{ctx:w,canvas:t}}function q(l,m){return l.toDataURL(h[m.format],m.quality/100)}function k(l,m){if(!l)return m;const t=l.width;l=l.height;if(null!=t&&null!=l)return{width:Math.floor(t),height:Math.floor(l)};if(null==t&&null==l)return m;m=m.width/m.height;return null==l?{width:Math.floor(t),height:Math.floor(t/m)}:{width:Math.floor(l*m),height:Math.floor(l)}}
function d(l,m){if(!m||null==m.width||null==m.height)return l;m=m.width/m.height;const t=l.width/l.height;if(t===m)return l;if(t<m)return m=Math.floor(l.height*m),l.x-=(m-l.width)/2,l.width=m,l;m=Math.floor(l.width/m);l.y-=(m-l.height)/2;l.height=m;return l}function f(l,m){return!m||l&&l.ignorePadding?n:m}function g(l){switch(l){case "png":case "jpg":case "jpeg":return l;case null:case void 0:return"png";default:return"png"}}let e=null;const h={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},
z={png:100,jpg:98,jpeg:98},n={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=y.createEmptyImageData;a.completeUserSettings=p;a.encode=function(l,m,t){const {ctx:w,canvas:r}=u(l,t);l=w.getImageData(0,0,l.width,l.height);m=q(r,m);r.width=0;r.height=0;return{dataUrl:m,data:l}};a.encodeData=function(l,m){const {ctx:t,canvas:w}=u(l,m);l=t.getImageData(0,0,l.width,l.height);w.width=0;w.height=0;return l};a.getFormatAndQuality=function(l,m){l=g(l);const t=z[l];m=c.clamp(null!=m?m:t,0,100);return{format:l,
quality:m}};a.getMaximumResolutionScale=function(l,m){return m/Math.max(l[0],l[1])};a.resampleHermite=function(l,m,t,w=0,r=0,x=l.width-w,D=l.height-r,A=!1){const {data:v}=l,{width:B,height:C,data:E}=m;x/=B;D/=C;const F=Math.ceil(x/2),M=Math.ceil(D/2);l=l.width;for(let L=0;L<C;L++)for(let O=0;O<B;O++){const I=4*(O+(A?C-L-1:L)*B);let H=0,J=0,N=0,R=0,W=0,T=0;const P=(L+.5)*D;for(let Q=Math.floor(L*D);Q<(L+1)*D;Q++){var K=Math.abs(P-(Q+.5))/M;const S=(O+.5)*x;K*=K;for(let U=Math.floor(O*x);U<(O+1)*x;U++){var G=
Math.abs(S-(U+.5))/F;G=Math.sqrt(K+G*G);if(1<=G)continue;G=2*G*G*G-3*G*G+1;const V=4*(w+U+(r+Q)*l);T+=G*v[V+3];J+=G;!t&&255>v[V+3]&&(G=G*v[V+3]/255);N+=G*v[V];R+=G*v[V+1];W+=G*v[V+2];H+=G}}E[I]=N/H;E[I+1]=R/H;E[I+2]=W/H;E[I+3]=T/J}return m};a.screenshotSuperSampleSettings=function(l,m,t){if(!m)return l;const {framebufferWidth:w,framebufferHeight:r,pixelRatio:x,region:D}=l;m=f(l,t);t=m.left+m.right;const A=m.top+m.bottom,v=w-t,B=r-A,C=Math.min(8,Math.min((2048-t)/v,(2048-A)/B));return 1.5>C?l:{...l,
framebufferWidth:Math.round(v*C)+t,framebufferHeight:Math.round(B*C)+A,pixelRatio:x*C,resample:{region:{x:Math.round((D.x-m.left)*C)+m.left,y:Math.round((D.y-m.top)*C)+m.top,width:Math.round(D.width*C),height:Math.round(D.height*C)},width:w,height:r}}};a.toDataUrl=q;a.toRenderSettings=function(l,m){const t=p(l,m),w=t.area,r=t.width/w.width,x=f(t,m.padding),D=x.left+x.right,A=x.top+x.bottom;return{framebufferWidth:Math.floor((m.width-D)*r+D),framebufferHeight:Math.floor((m.height-A)*r+A),region:{x:Math.floor(w.x*
r)+x.left,y:Math.floor(w.y*r)+x.top,width:t.width,height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:r,layers:l&&l.layers?l.layers:[],disableDecorations:t.disableDecorations,ignoreBackground:t.ignoreBackground,ignorePadding:t.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>
{const c=b.getContextCache();c.forEach(y=>y.dispose());c.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(a,b,c,y,p,u,q,k,d,
f){function g(t,w){return null==t?null:d.isObjectIntersectorResult(t)||d.isHudIntersectorResult(t)?e(t.target?.object,w):q.isPclIntersectorResult(t)?(t=t.target.createGraphic(),{type:"graphic",graphic:t,layer:t.layer}):q.isVoxelIntersectorResult(t)?(t=t.target.createVoxelGraphic(),{type:"graphic",graphic:t,layer:t.layer}):k.isOverlayIntersectorResult(t)||f.isLodIntersectorResult(t)?e(t.target,w):q.isI3sIntersectorResult(t)?h(t.target,w):null}function e(t,w){if(null==t||null==t.graphicUid)return null;
const r=l(t,w);if(null==r)return null;if(r===w.graphics)return null==w.graphicsView||"number"!==typeof t.graphicUid?null:w.graphicsView.getHit(t.graphicUid);w=w.allLayerViews.find(x=>x.layer===r);return!w||w.suspended||null==t.graphicUid?null:"getHit"in w?w.getHit(t.graphicUid):null}function h(t,w){const r=l(t,w);return null==r?null:(w=w.allLayerViews.find(x=>x.layer===r))&&!w.suspended&&"getGraphicFromIntersectorTarget"in w?n(w.getGraphicFromIntersectorTarget(t)):null}function z(t,w){const r=l(t,
w);return null==r?null:(w=w.allLayerViews.find(x=>x.layer===r))&&!w.suspended&&"getAABBFromIntersectorTarget"in w?w.getAABBFromIntersectorTarget(t):null}function n(t){return null!=t?{type:"graphic",graphic:t,layer:t.layer}:null}function l(t,w){return t&&null!=t.layerUid?null!=w.graphicsView&&t.layerUid===w.graphicsView.processor.layer.id?w.graphics:w.map.findLayerByUid(t.layerUid):null}const m=y.create();a.getIntersectedFeatureBSRadius=function(t,w){return d.isObjectIntersectorResult(t)||d.isHudIntersectorResult(t)?
u.getRadius(t.target.object.boundingVolumeWorldSpace.bounds):f.isLodIntersectorResult(t)?(c.getScaling(m,t.transformation),t.target.baseBoundingSphere.radius*Math.max(m[0],m[1],m[2])):q.isI3sIntersectorResult(t)?b.applySome(z(t.target,w),r=>.5*p.diameter(r)):null};a.hasLod=function(t){return d.isObjectIntersectorResult(t)||d.isHudIntersectorResult(t)?!1:f.isLodIntersectorResult(t)?1<t.target.numLodLevels:q.isI3sIntersectorResult(t)?!0:!1};a.toGraphic=function(t,w){t=g(t,w);return null!=t&&"graphic"===
t.type?t.graphic:null};a.toHit=g;a.toOwner=function(t,w){return d.isObjectIntersectorResult(t)||d.isHudIntersectorResult(t)?l(t.target?.object,w):k.isTerrainIntersectorResult(t)?w.map?.ground:q.isPclIntersectorResult(t)||q.isI3sIntersectorResult(t)||k.isOverlayIntersectorResult(t)||q.isVoxelIntersectorResult(t)?l(t.target,w):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,c,y,p){let u=function(k){function d(f,g,e,h){g=k.call(this,g,e)||this;g.point=f;g.createGraphic=h;return g}b._inherits(d,k);return b._createClass(d)}(y.Graphic3DTarget),q=function(k){function d(f,g,e,h,z){var n=k.call(this,f)||this;n.layerUid=f;n.sublayerUid=g;n.nodeIndex=e;n.componentIndex=h;n.triangleNr=z;return n}b._inherits(d,k);return b._createClass(d)}(y.LayerTarget);
y=function(k){function d(f,g,e){g=k.call(this,g,null)||this;g.point=f;g.createVoxelGraphic=e;return g}b._inherits(d,k);return b._createClass(d)}(y.Graphic3DTarget);a.I3sTarget=q;a.PclTarget=u;a.VoxelTarget=y;a.isI3sIntersectorResult=function(k){return p.isValidIntersectorResult(k)&&k.intersector===c.IntersectorType.I3S&&!!k.target};a.isPclIntersectorResult=function(k){return p.isValidIntersectorResult(k)&&k.intersector===c.IntersectorType.PCL&&!!k.target};a.isVoxelIntersectorResult=function(k){return p.isValidIntersectorResult(k)&&
k.intersector===c.IntersectorType.VOXEL&&!!k.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(a){function b(c){return"graphic"===c?.type}a.filterGraphicHits=function(c){return c.filter(b)};a.findFirstGraphicHit=function(c){return c.find(b)??null};a.hitTestSelectSimilarDistance=async function(c,y){if("2d"===c.type)return c.hitTest(y);c=await c.hitTest(y);if(0===c.results.length)return c;const p=1.05*
(c.results[0].distance??0);y=c.results.findIndex(u=>(u.distance??0)>p);-1!==y&&(c.results=c.results.slice(0,y));return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports"],function(a){a.extractSafeScaleBounds=function(b){b=b.effectiveScaleRange;return{minScale:b?.minScale??0,maxScale:b?.maxScale??0}};a.highlightsSupported=function(b){return b&&"function"===typeof b.highlight};a.isScaleRangeActive=function(b,c){return null!=
b&&0<b||null!=c&&0<c};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};a.scaleBoundsPredicate=function(b,c,y){return null==b||b>y&&(0===c||b<c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/contextUtils"],function(a,b,c,y){a.check=function(p){const u=c.getWebGLCapabilities(p);if(!u.available)return"3d"===p?new b("webgl:required",
"WebGL2 is required but not supported.",Error().stack):new b("webgl:required","WebGL is required but not supported.",Error().stack);if("3d"===p&&u.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!u.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");
if(!u.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(u.type===y.ContextType.WEBGL1){if(!u.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!u.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");
if(!u.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./contextUtils"],function(a,b,c){function y(h){switch(h){case c.ContextType.WEBGL1:return p();case c.ContextType.WEBGL2:return u()}}function p(){if(!k){{const h=new g,z=q(c.ContextType.WEBGL1,
h);null!=z&&(h.supportsElementIndexUint=null!==z.getExtension("OES_element_index_uint"),h.supportsStandardDerivatives=null!==z.getExtension("OES_standard_derivatives"),h.supportsInstancedArrays=null!==z.getExtension("ANGLE_instanced_arrays"),h.supportsTextureFloat=null!==z.getExtension("OES_texture_float"),h.supportsTextureHalfFloat=null!==z.getExtension("OES_texture_half_float"),h.supportsColorBufferFloat=null!==z.getExtension("WEBGL_color_buffer_float"),h.supportsColorBufferFloatBlend=null!==z.getExtension("EXT_float_blend"),
h.supportsColorBufferHalfFloat=null!==z.getExtension("EXT_color_buffer_half_float"));k=h}}return k}function u(){if(!d){{const h=new e,z=q(c.ContextType.WEBGL2,h);null!=z&&(h.supportsColorBufferFloat=null!==z.getExtension("EXT_color_buffer_float"),h.supportsColorBufferFloatBlend=null!==z.getExtension("EXT_float_blend"),h.supportsColorBufferHalfFloat=h.supportsColorBufferFloat||null!==z.getExtension("EXT_color_buffer_half_float"));d=h}}return d}function q(h,z){if(h===c.ContextType.WEBGL1&&"undefined"===
typeof WebGLRenderingContext||h===c.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const n=document.createElement("canvas");if(!n)return null;let l=c.createContext(n,h,{failIfMajorPerformanceCaveat:!0});null==l&&(l=c.createContext(n,h),null!=l&&(z.majorPerformanceCaveat=!0));if(null==l)return l;if(h===c.ContextType.WEBGL1){if(h=l.getParameter(l.VERSION)?.match(/^WebGL\s+([\d.]*)/))h=parseFloat(h[1]),z.available=.94<=h}else z.available=!0;z.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE);
z.supportsVertexShaderSamplers=0<l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(h=l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT))z.supportsHighPrecisionFragment=0<h.precision;return l}let k,d,f=b._createClass(function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=
this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}),g=function(h){function z(){var n=h.apply(this,arguments)||this;n.type=c.ContextType.WEBGL1;return n}b._inherits(z,h);return b._createClass(z)}(f),e=function(h){function z(){var n=h.apply(this,arguments)||this;n.type=c.ContextType.WEBGL2;n.supportsElementIndexUint=!0;n.supportsStandardDerivatives=!0;n.supportsInstancedArrays=!0;n.supportsTextureFloat=!0;n.supportsTextureHalfFloat=!0;return n}b._inherits(z,
h);return b._createClass(z)}(f);a.getWebGL1Capabilities=p;a.getWebGL2Capabilities=u;a.getWebGLCapabilities=function(h){for(h=c.getContextTypes(h);1<h.length;){const z=y(h.shift());if(z.available)return z}return y(h.shift())};a.getWebGLVersionCapabilities=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){c=function(l){function m(w){var r=l.call(this,w)||this;r._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};r.components=[];r._updateViewAwareWidgets=x=>{r.components.forEach(D=>{D=r._find(D)?.widget;void 0!==D?.view&&(D.view=x)})};r._componentsWatcher=(x,D)=>{r._removeComponents(D);r._addComponents(x);r._adjustPadding(x)};return r}a._inherits(m,l);var t=m.prototype;t.initialize=function(){this.addHandles([p.watch(()=>
this.components,this._componentsWatcher,p.initial),p.watch(()=>this.view,this._updateViewAwareWidgets,p.initial)])};t._add=function(w,r,x,D,A){let v=w;if("string"===typeof w&&this._defaultPositionLookup[w]){if(this._find(w))return;v=this._createComponent(w)}a._get(a._getPrototypeOf(m.prototype),"_add",this).call(this,v,r,x,D,A)};t._removeComponents=function(w){w.forEach(r=>{if(r=this._find(r))this.remove(r),r.destroy()})};t._adjustPadding=function(w){w.includes("attribution")||this._isOverridden("padding")||
({top:w}=this.padding,this.padding=w)};t._addComponents=function(w){this.constructed&&w.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))};t._createComponent=function(w){const r=this._createWidget(w);return new f({id:w,node:r})};t._createWidget=function(w){const {view:r}=this;switch(w){case "attribution":return new e({view:r});case "compass":return new h({view:r});case "navigation-toggle":return new z({view:r});case "zoom":return new n({view:r})}};return a._createClass(m)}(g);
b.__decorate([u.property()],c.prototype,"components",void 0);return c=b.__decorate([d.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){c=function(f){function g(){var h=
f.apply(this,arguments)||this;h.widget=null;return h}a._inherits(g,f);var e=g.prototype;e.destroy=function(){this.node=null;this.widget?.destroy()};e.castNode=function(h){this.widget?.destroy();if(!h)return this._set("widget",null),null;if("string"===typeof h||h&&"nodeType"in h)return this._set("widget",null),y.byId(h);h&&"function"===typeof h.render&&!h.domNode&&(h.domNode=document.createElement("div"));this._set("widget",h);return h.domNode};a._createClass(g,[{key:"id",get:function(){return this.get("widget.id")||
this.get("node.id")}},{key:"node",set:function(h){const z=this._get("node");h!==z&&(h&&h.classList.add("esri-component"),z&&z.classList.remove("esri-component"),this._set("node",h))}}]);return g}(c);b.__decorate([p.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([p.property()],c.prototype,"node",null);b.__decorate([u.cast("node")],c.prototype,"castNode",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"widget",void 0);return c=b.__decorate([d.subclass("esri.views.ui.Component")],
c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/arrayUtils ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(x){return 0===
x?"0":`${x}px`}function m(x){const D="object"===typeof x&&null!==x&&Object.getPrototypeOf(x);return null!==D&&D!==Object.prototype||!("component"in x||"index"in x||"position"in x)?null:x}function t(x,{top:D,bottom:A,left:v,right:B}){x.style.top=D;x.style.bottom=A;x.style.left=v;x.style.right=B}const w={left:0,top:0,bottom:0,right:0},r={bottom:30,top:15,right:15,left:15};c=function(x){function D(v){var B=x.call(this,v)||this;B._cornerNameToContainerLookup={};B._positionNameToContainerLookup={};B._components=
[];B._componentMap=new Map;B._locale=n.getLocale();B.view=null;B._applyViewPadding=()=>{const C=B.container;C&&t(C,B._toPixelPosition(B._getViewPadding()))};B._applyUIPadding=()=>{const C=B._innerContainer;C&&t(C,B._toPixelPosition(B.padding))};B._initContainers();return B}a._inherits(D,x);var A=D.prototype;A.initialize=function(){this.addHandles([q.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,q.initial),q.watch(()=>this.padding,this._applyUIPadding,q.initial),q.watch(()=>
[this.container,this._locale],([v,B])=>{v&&v.setAttribute("lang",B)},q.initial),n.onLocaleChange(v=>{this._locale=v})])};A.destroy=function(){this.container=null;for(const v of this._components)v.destroy();this._components.length=0;this._componentMap.clear()};A.castPadding=function(v){return"number"===typeof v?{bottom:v,top:v,right:v,left:v}:{...r,...v}};A.add=function(v,B){let C,E,F;if(Array.isArray(v))v.forEach(K=>this.add(K,B));else{var M=m(v);M&&({index:C,position:B,component:v,key:E}=M);B&&"object"===
typeof B&&({index:C,key:E,position:B,internal:F}=B);!v||B&&!this._isValidPosition(B)||this._add(v,B,C,E,F)}};A.remove=function(v,B){if(v){if(Array.isArray(v))return v.map(F=>this.remove(F,B));var C=this._find(v);if(C&&(!this._componentMap.has(v)||this._componentMap.get(v)?.key===B)){var E=this._components.indexOf(C);C.node.parentNode?.removeChild(C.node);this._componentMap.delete(v);return this._components.splice(E,1)[0]}}};A.empty=function(v,B={removeInternal:!1}){if(Array.isArray(v))for(const C of v)this.empty(C,
B);else{v=Array.prototype.slice.call(this._positionNameToContainerLookup[v??"manual"].children).map(C=>this._findByNode(C)).filter(C=>null==C?!1:!(this._componentMap.get(C)?.internal??!1)||B.removeInternal);for(const C of v)this.remove(C)}};A.move=function(v,B){Array.isArray(v)&&v.forEach(F=>this.move(F,B));if(v){var C=m(v)||m(B);if(C){var E=C.index;B=C.position;v=C.component||v}(!B||this._isValidPosition(B))&&(v=this.remove(v))&&this.add(v,{position:B,index:E})}};A.find=function(v){return v?(v=this._findById(v))&&
(v.widget||v.node):null};A.getComponents=function(v,B={includeInternal:!1}){return v?Array.isArray(v)?v.map(C=>this._getComponentsAtPosition(C,B)).flat():this._getComponentsAtPosition(v,B):this._components.filter(C=>B.includeInternal||!(this._componentMap.get(C)?.internal??!1)).map(({widget:C,node:E})=>C??E)};A.getPosition=function(v){for(const B in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[B].contains(v))return B;return null};A._add=function(v,B,C,E,F){v instanceof
h||(v=new h({node:v}));this._place({component:v,position:B,index:C});this._components.push(v);this._componentMap.set(v,{key:E,internal:F})};A._find=function(v){return v?v instanceof h?this._findByComponent(v):"string"===typeof v?this._findById(v):this._findByNode(v.domNode||v):null};A._getViewPadding=function(){return this.view?.padding??w};A._attachContainers=function(v){v.appendChild(this._innerContainer);v.appendChild(this._manualContainer)};A._initContainers=function(){var v=document.createElement("div");
v.classList.add("esri-ui-inner-container","esri-ui-corner-container");const B=document.createElement("div");B.classList.add("esri-ui-inner-container","esri-ui-manual-container");const C=document.createElement("div");C.classList.add("esri-ui-top-left","esri-ui-corner");v.appendChild(C);const E=document.createElement("div");E.classList.add("esri-ui-top-right","esri-ui-corner");v.appendChild(E);const F=document.createElement("div");F.classList.add("esri-ui-bottom-left","esri-ui-corner");v.appendChild(F);
const M=document.createElement("div");M.classList.add("esri-ui-bottom-right","esri-ui-corner");v.appendChild(M);this._innerContainer=v;this._manualContainer=B;v=z.isRTL();this._cornerNameToContainerLookup={"top-left":C,"top-right":E,"bottom-left":F,"bottom-right":M,"top-leading":v?E:C,"top-trailing":v?C:E,"bottom-leading":v?M:F,"bottom-trailing":v?F:M};this._positionNameToContainerLookup={manual:B,...this._cornerNameToContainerLookup}};A._isValidPosition=function(v){return!!this._positionNameToContainerLookup[v]};
A._place=function(v){var B=v.position??"manual";const {component:C,index:E}=v;v=this._positionNameToContainerLookup[B];B=null!=E&&-1<E;var F=C.widget;F&&!F._started&&"function"===typeof F.postMixInProperties&&"function"===typeof F.buildRendering&&"function"===typeof F.postCreate&&"function"===typeof F.startup&&C.widget.startup();B?(B=Array.from(v.children),0===E?v.firstChild?p.insertBefore(C.node,v.firstChild):v.appendChild(C.node):E>=B.length?v.appendChild(C.node):p.insertBefore(C.node,B[E])):v.appendChild(C.node)};
A._toPixelPosition=function(v){return{top:l(v.top),left:l(v.left),right:l(v.right),bottom:l(v.bottom)}};A._findByComponent=function(v){return this._components.find(B=>B===v)??null};A._findById=function(v){return this._components.find(({id:B})=>B===v)??null};A._findByNode=function(v){return this._components.find(({node:B})=>B===v)??null};A._getComponentsAtPosition=function(v,B){return Array.prototype.slice.call(this._positionNameToContainerLookup[v].children).map(C=>this._findByNode(C)).filter(y.isSome).filter(C=>
B.includeInternal||!(this._componentMap.get(C)?.internal??!1)).map(({widget:C,node:E})=>C??E)};a._createClass(D,[{key:"container",set:function(v){const B=this._get("container");v!==B&&(v&&(v.classList.add("esri-ui"),e.setCalciteThemeClass(v),this._attachContainers(v)),B&&(B.classList.remove("esri-ui"),t(B,{top:"",bottom:"",left:"",right:""}),p.empty(B)),this._set("container",v))}},{key:"height",get:function(){const v=this.view?.height??0;if(0===v)return v;const B=this._getViewPadding(),{top:C,bottom:E}=
B;return Math.max(v-C-E,0)}},{key:"padding",get:function(){return this._get("padding")},set:function(v){this._overrideIfSome("padding",v)}},{key:"width",get:function(){const v=this.view?.width??0;if(0===v)return v;const B=this._getViewPadding(),{left:C,right:E}=B;return Math.max(v-C-E,0)}}]);return D}(u.EventedAccessor);b.__decorate([k.property()],c.prototype,"_locale",void 0);b.__decorate([k.property()],c.prototype,"container",null);b.__decorate([k.property()],c.prototype,"height",null);b.__decorate([k.property({value:r})],
c.prototype,"padding",null);b.__decorate([d.cast("padding")],c.prototype,"castPadding",null);b.__decorate([k.property()],c.prototype,"view",void 0);b.__decorate([k.property()],c.prototype,"width",null);return c=b.__decorate([g.subclass("esri.views.ui.UI")],c)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){p=function(n){function l(t,w){var r=n.call(this,t,w)||this;r._isOpen=!1;r._attributionTextOverflowed=!1;r._prevSourceNodeHeight=0;r._resizeObserver=new ResizeObserver(x=>x.forEach(({target:D})=>r._checkSourceTextOverflow(D)));r.iconClass="esri-icon-description";r.icon=null;r.itemDelimiter=" | ";r.messages=null;r.viewModel=new f;return r}a._inherits(l,n);var m=l.prototype;m.initialize=function(){this.addHandles(c.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))};
m.destroy=function(){this._resizeObserver?.disconnect()};m.render=function(){return h.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};m.renderPoweredBy=function(){return h.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",h.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",
rel:"noreferrer"},"Esri"))};m.renderSourcesNode=function(){const t=this._isOpen,w=this._isInteractive,r=w?"0":"",{attributionText:x}=this;return h.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:t,["esri-interactive"]:w}),innerHTML:x,tabindex:r})};m._afterSourcesNodeCreate=function(t){this._prevSourceNodeHeight=t.clientWidth;this._resizeObserver.observe(t)};m._checkSourceTextOverflow=function(t){let w=
!1;const {clientHeight:r,clientWidth:x,scrollWidth:D}=t;t=D>x;const A=this._attributionTextOverflowed!==t;this._attributionTextOverflowed=t;A&&(w=!0);this._isOpen&&(t=r<this._prevSourceNodeHeight,this._prevSourceNodeHeight=r,t&&(this._isOpen=!1,w=!0));w&&this.scheduleRender()};m._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(l,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((t,
w)=>{t.includes(w.text)||t.push(w.text);return t},[]).join(this.itemDelimiter)}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(t){this._overrideIfSome("label",t)}},{key:"view",get:function(){return this.viewModel.view},set:function(t){this.viewModel.view=t}}]);return l}(d);b.__decorate([y.property()],p.prototype,"_isOpen",void 0);b.__decorate([y.property()],p.prototype,"_isInteractive",null);b.__decorate([y.property()],p.prototype,"_attributionTextOverflowed",void 0);
b.__decorate([y.property()],p.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([y.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],p.prototype,"attributionText",null);b.__decorate([y.property()],p.prototype,"iconClass",void 0);b.__decorate([y.property()],p.prototype,"icon",void 0);b.__decorate([y.property()],p.prototype,"itemDelimiter",void 0);b.__decorate([y.property()],p.prototype,"label",null);b.__decorate([y.property(),e.messageBundle("esri/widgets/Attribution/t9n/Attribution")],
p.prototype,"messages",void 0);b.__decorate([y.property()],p.prototype,"view",null);b.__decorate([y.property({type:f})],p.prototype,"viewModel",void 0);b.__decorate([g.accessibleHandler()],p.prototype,"_toggleState",null);return p=b.__decorate([k.subclass("esri.widgets.Attribution")],p)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(r,x){return r&&"copyright"in r&&(!x||"function"===typeof r.originOf&&"user"===r.originOf("copyright"))}function m(r,x){return r.length!==x.length||r.some((D,A)=>D.text!==x[A].text)}function t(r,x,D){D&&x&&(r.find(A=>A.layerView===x&&A.text===D)||r.push({text:D,layerView:x}))}const w=[];p=function(r){function x(A){var v=r.call(this,A)||this;v._clear=()=>{v._fetchedAttributionData.clear();v._pendingAttributions.clear();v.handles.remove("suspension");
v.notifyChange("state")};v._pendingAttributions=new Set;v._fetchedAttributionData=new Map;v.items=new y;v.view=null;v._allLayerViewsChange=B=>{v.handles.remove("suspension");const C=v.get("view.allLayerViews");C&&v.handles.add(C.map(E=>u.watch(()=>[E.suspended,E.layer?.attributionVisible],()=>v._updateAttributionItems())),"suspension");B&&B.removed&&B.removed.forEach(E=>{v._pendingAttributions.delete(E);v._fetchedAttributionData.delete(E)});v._updateAttributionItems()};v.handles.add([u.on(()=>v.view?.allLayerViews,
"change",B=>v._allLayerViewsChange(B),{onListenerAdd:()=>v._allLayerViewsChange(),onListenerRemove:v._clear}),u.when(()=>!0===v.view?.stationary,()=>v._updateAttributionItems())]);return v}a._inherits(x,r);var D=x.prototype;D.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};D._updateAttributionItems=function(){const A=this.view,v=A?.allLayerViews;w.length=0;A&&v?(v.forEach(B=>{if(!B.suspended&&B.layer?.attributionVisible){var C=
B.layer;if(l(C,"user"))t(w,B,C.copyright);else if(C.hasAttributionData)if(this._fetchedAttributionData.has(B)){var E=this._fetchedAttributionData.get(B);E?t(w,B,this._getDynamicAttribution(E,A,C)):l(C)&&t(w,B,C.copyright)}else this._fetchAttributionData(B);else(E=C.get("portalItem.accessInformation"))?t(w,B,E):t(w,B,C.copyright)}}),m(this.items,w)&&(this.items.removeAll(),this.items.addMany(w)),w.length=0,this.notifyChange("state")):this._clear()};D._fetchAttributionData=async function(A){if(!this._pendingAttributions.has(A)){this._pendingAttributions.add(A);
var v=await c.result(A.layer.fetchAttributionData());this._pendingAttributions.has(A)&&(v=v.ok?this._createContributionIndex(v.value,"bing-maps"===A.layer.type):null,this._pendingAttributions.delete(A),this._fetchedAttributionData.set(A,v));this._updateAttributionItems()}};D._createContributionIndex=function(A,v){A=A.contributors;const B={};if(!A)return B;for(let K=0;K<A.length;K++){const G=A[K];var C=G.coverageAreas;if(!C)return;for(const L of C){var E=L.bbox,F=L.zoomMin-(v&&L.zoomMin?1:0);C=L.zoomMax-
(v&&L.zoomMax?1:0);E=new e({xmin:E[1],ymin:E[0],xmax:E[3],ymax:E[2],spatialReference:h.WGS84});for(E={extent:n.geographicToWebMercator(E),attribution:G.attribution||"",score:null!=L.score?L.score:100,id:K};F<=C;F++){var M;B[M=F]??(B[M]=[]);B[F].push(E)}}}B.maxKey=Math.max.apply(null,Object.keys(B));return B};D._getDynamicAttribution=function(A,v,B){const {extent:C,scale:E}=v;B=B.tileInfo?.scaleToZoom(E)??0;B=Math.min(A.maxKey??0,Math.round(B));if(!C||null==B||-1>=B)return"";A=A[B];const F=n.project(C.center.clone().normalize(),
v.spatialReference),M=new Set;return A?A.filter(K=>{const G=K.id;(K=!M.has(G)&&F&&K.extent&&z.extentContainsPoint(K.extent,F))&&M.add(G);return K}).sort((K,G)=>G.score-K.score||K.objectId-G.objectId).map(K=>K.attribution).join(", "):""};a._createClass(x,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return x}(p.HandleOwner);b.__decorate([q.property({readOnly:!0,type:y})],p.prototype,"items",void 0);b.__decorate([q.property({readOnly:!0})],
p.prototype,"state",null);b.__decorate([q.property()],p.prototype,"view",void 0);return p=b.__decorate([g.subclass("esri.widgets.Attribution.AttributionViewModel")],p)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){y=function(n){function l(t,w){t=n.call(this,t,w)||this;t.iconClass=f.CSS.widgetIcon;t.icon=null;t.messages=null;t.viewModel=new d;return t}a._inherits(l,n);var m=l.prototype;m.reset=function(){return this.viewModel.reset()};m.render=function(){const {orientation:t,state:w}=this.viewModel;var r="disabled"===w,x="compass"===("rotation"===w?"rotation":"compass");const D=r?-1:0;r={[f.CSS.disabled]:r,[f.CSS.interactive]:!r};x={[f.CSS.northIcon]:x,[f.CSS.rotationIcon]:!x};
const {messages:A}=this;return h.tsx("div",{bind:this,class:this.classes(f.CSS.base,r),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:D,"aria-label":A.reset,title:A.reset},h.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.icon,x),styles:this._toRotationTransform(t)}),h.tsx("span",{class:f.CSS.text},A.reset))};m._reset=function(){this.viewModel.reset()};m._toRotationTransform=function(t){return{transform:`rotateZ(${t.z}deg)`}};a._createClass(l,[{key:"goToOverride",get:function(){return this.viewModel.goToOverride},
set:function(t){this.viewModel.goToOverride=t}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(t){this._overrideIfSome("label",t)}},{key:"view",get:function(){return this.viewModel.view},set:function(t){this.viewModel.view=t}}]);return l}(k);b.__decorate([c.property()],y.prototype,"goToOverride",null);b.__decorate([c.property()],y.prototype,"iconClass",void 0);b.__decorate([c.property()],y.prototype,"icon",void 0);b.__decorate([c.property()],y.prototype,"label",null);
b.__decorate([c.property(),e.messageBundle("esri/widgets/Compass/t9n/Compass")],y.prototype,"messages",void 0);b.__decorate([c.property()],y.prototype,"view",null);b.__decorate([c.property({type:d})],y.prototype,"viewModel",void 0);b.__decorate([g.accessibleHandler()],y.prototype,"_reset",null);return y=b.__decorate([q.subclass("esri.widgets.Compass")],y)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){c=function(h){function z(l){l=h.call(this,l)||this;l._handles=new y;l.orientation={x:0,y:0,z:0};l.view=null;l._updateForCamera=l._updateForCamera.bind(a._assertThisInitialized(l));l._updateForRotation=l._updateForRotation.bind(a._assertThisInitialized(l));l._updateRotationWatcher=l._updateRotationWatcher.bind(a._assertThisInitialized(l));return l}a._inherits(z,h);var n=z.prototype;n.initialize=function(){this._handles.add(u.watch(()=>this.view,this._updateRotationWatcher,
u.initial))};n.destroy=function(){p.removeMaybe(this._handles);this.view=null};n.reset=function(){if(this.get("view.ready")){var l={};"2d"===this.view?.type?l.rotation=0:l.heading=0;this.callGoTo({target:l})}};n._updateForRotation=function(l){void 0!==l&&null!==l&&(this.orientation={z:l})};n._updateForCamera=function(l){l&&(this.orientation={x:0,y:0,z:-l.heading})};n._updateRotationWatcher=function(l){this._handles.removeAll();l&&this._handles.add("2d"===l.type?u.watch(()=>l?.rotation,this._updateForRotation,
u.initial):u.watch(()=>l?.camera,this._updateForCamera,u.initial))};a._createClass(z,[{key:"canShowNorth",get:function(){const l=this.get("view.spatialReference");return!(!l||!l.isWebMercator&&!l.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return z}(e.GoToMixin(c));b.__decorate([q.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([q.property()],c.prototype,"orientation",void 0);b.__decorate([q.property({readOnly:!0})],
c.prototype,"state",null);b.__decorate([q.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){a.GoToMixin=
f=>{f=function(g){function e(...h){h=g.call(this,...h)||this;h.goToOverride=null;h.view=null;return h}b._inherits(e,g);e.prototype.callGoTo=function(h){const {view:z}=this;y.assertIsSome(z);return this.goToOverride?this.goToOverride(z,h):z.goTo(h.target,h.options)};return b._createClass(e)}(f);c.__decorate([p.property()],f.prototype,"goToOverride",void 0);c.__decorate([p.property()],f.prototype,"view",void 0);return f=c.__decorate([d.subclass("esri.widgets.support.GoTo")],f)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports"],function(a){a.CSS={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){y=function(n){function l(t,w){t=n.call(this,t,w)||this;t.iconClass=d.CSS.widgetIcon;t.icon=null;t.messages=null;t.viewModel=new f;return t}a._inherits(l,n);var m=l.prototype;m.toggle=function(){return this.viewModel.toggle()};m.render=function(){const t="disabled"===this.get("viewModel.state");var w="pan"===this.get("viewModel.navigationMode");const r={[d.CSS.activeButton]:w};w={[d.CSS.activeButton]:!w};const x=t?-1:0,D=this.messages.toggle;return h.tsx("div",
{bind:this,class:this.classes(d.CSS.base,{[d.CSS.disabled]:t,[d.CSS.isLayoutHorizontal]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:x,"aria-label":D,title:D},h.tsx("div",{class:this.classes(d.CSS.button,d.CSS.panButton,r)},h.tsx("span",{class:d.CSS.panIcon})),h.tsx("div",{class:this.classes(d.CSS.button,d.CSS.rotateButton,w)},h.tsx("span",{class:d.CSS.rotationIcon})))};m._toggle=function(){this.toggle()};a._createClass(l,[{key:"label",get:function(){return this.messages?.widgetLabel??
""},set:function(t){this._overrideIfSome("label",t)}},{key:"layout",set:function(t){"horizontal"!==t&&(t="vertical");this._set("layout",t)}},{key:"view",get:function(){return this.viewModel.view},set:function(t){this.viewModel.view=t}}]);return l}(k);b.__decorate([c.property()],y.prototype,"iconClass",void 0);b.__decorate([c.property()],y.prototype,"icon",void 0);b.__decorate([c.property()],y.prototype,"label",null);b.__decorate([c.property({value:"vertical"})],y.prototype,"layout",null);b.__decorate([c.property(),
e.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],y.prototype,"messages",void 0);b.__decorate([c.property()],y.prototype,"view",null);b.__decorate([c.property({type:f})],y.prototype,"viewModel",void 0);b.__decorate([g.accessibleHandler()],y.prototype,"_toggle",null);return y=b.__decorate([q.subclass("esri.widgets.NavigationToggle")],y)})},"esri/widgets/NavigationToggle/css":function(){define(["exports"],function(a){a.CSS={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",
activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){c=function(f){function g(h){h=f.call(this,h)||this;h.navigationMode="pan";h.view=null;return h}a._inherits(g,f);var e=g.prototype;e.initialize=function(){this.own(y.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))};e.destroy=function(){this.view=null};e.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};e._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate"};a._createClass(g,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view?.type?"ready":"disabled"}}]);return g}(c);b.__decorate([p.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([p.property()],c.prototype,"navigationMode",void 0);b.__decorate([p.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.NavigationToggleViewModel")],c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){p=function(n){function l(t,w){t=n.call(this,t,w)||this;t.iconClass="esri-icon-zoom-in-magnifying-glass";t.icon=null;t.messages=null;t.viewModel=new z;return t}a._inherits(l,n);var m=l.prototype;m.initialize=function(){this._zoomInButton=new h({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new h({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};m.destroy=function(){this._zoomInButton=c.destroyMaybe(this._zoomInButton);
this._zoomOutButton=c.destroyMaybe(this._zoomOutButton)};m.render=function(){const t={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:w,canZoomOut:r}=this.viewModel;this._zoomInButton.enabled=w;this._zoomOutButton.enabled=r;const {zoomIn:x,zoomOut:D}=this.messages;this._zoomInButton.title=x;this._zoomOutButton.title=D;return e.tsx("div",{class:this.classes("esri-zoom esri-widget",t)},this._zoomInButton.render(),this._zoomOutButton.render())};m.zoomIn=function(){return this.viewModel.zoomIn()};
m.zoomOut=function(){return this.viewModel.zoomOut()};a._createClass(l,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(t){this._overrideIfSome("label",t)}},{key:"layout",set:function(t){"horizontal"!==t&&(t="vertical");this._set("layout",t)}},{key:"view",get:function(){return this.viewModel.view},set:function(t){this.viewModel.view=t}}]);return l}(d);b.__decorate([y.property()],p.prototype,"iconClass",void 0);b.__decorate([y.property()],p.prototype,"icon",void 0);
b.__decorate([y.property()],p.prototype,"label",null);b.__decorate([y.property({value:"vertical"})],p.prototype,"layout",null);b.__decorate([y.property(),g.messageBundle("esri/widgets/Zoom/t9n/Zoom")],p.prototype,"messages",void 0);b.__decorate([y.property()],p.prototype,"view",null);b.__decorate([y.property({type:z})],p.prototype,"viewModel",void 0);return p=b.__decorate([k.subclass("esri.widgets.Zoom")],p)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){y=function(e){function h(){var n=e.apply(this,arguments)||this;n.enabled=!0;n.iconClass=null;n.icon=null;n.title="";return n}a._inherits(h,e);var z=h.prototype;z.render=function(){const n=this.enabled?0:-1;return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:n,title:this.title},f.tsx("span",
{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",this.iconClass??"")}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};z._triggerAction=function(){this.action.call(this)};return a._createClass(h)}(k);b.__decorate([c.property()],y.prototype,"action",void 0);b.__decorate([c.property()],y.prototype,"enabled",void 0);b.__decorate([c.property()],y.prototype,"iconClass",void 0);b.__decorate([c.property()],y.prototype,"icon",void 0);b.__decorate([c.property()],y.prototype,
"title",void 0);b.__decorate([d.accessibleHandler()],y.prototype,"_triggerAction",null);return y=b.__decorate([q.subclass("esri.widgets.IconButton")],y)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){c=function(e){function h(n){return e.call(this,n)||this}a._inherits(h,e);var z=h.prototype;z.destroy=function(){this.view=null};z.zoomIn=function(){if(this.canZoomIn){var n=this.view;"2d"===n.type?n.mapViewNavigation.zoomIn():y.ignoreAbortErrors(n.goTo({zoomFactor:2}))}};z.zoomOut=function(){if(this.canZoomOut){var n=this.view;"2d"===n.type?n.mapViewNavigation.zoomOut():y.ignoreAbortErrors(n.goTo({zoomFactor:.5}))}};a._createClass(h,[{key:"canZoomIn",get:function(){return null!=
this._zoomConditions&&this._zoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}},{key:"state",get:function(){return this.view?.ready?"ready":"disabled"}},{key:"view",set:function(n){n?"2d"===n.type?this._zoomConditions=new f({view:n}):"3d"===n.type&&(this._zoomConditions=new g({view:n})):this._zoomConditions=null;this._set("view",n)}}]);return h}(c);b.__decorate([p.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([p.property()],
c.prototype,"canZoomIn",null);b.__decorate([p.property()],c.prototype,"canZoomOut",null);b.__decorate([p.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([p.property()],c.prototype,"view",null);return c=b.__decorate([d.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){c=function(d){function f(){return d.apply(this,arguments)||this}a._inherits(f,d);a._createClass(f,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const g=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return 0===e||g>e}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const g=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");
return 0===e||g<e}}]);return f}(c);b.__decorate([y.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([y.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([y.property()],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){c=function(d){function f(){return d.apply(this,arguments)||this}a._inherits(f,d);a._createClass(f,[{key:"canZoomIn",get:function(){return!!this.view.ready}},{key:"canZoomOut",get:function(){return!!this.view.ready}}]);return f}(c);b.__decorate([y.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([y.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([y.property()],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,b,c,y,p,u,q,k){y=function(d){function f(g){g=d.call(this,g)||this;g.components=["attribution","zoom","navigation-toggle","compass"];return g}a._inherits(f,d);
return a._createClass(f)}(k);b.__decorate([c.property()],y.prototype,"components",void 0);return y=b.__decorate([q.subclass("esri.views.ui.3d.DefaultUI3D")],y)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Clonable ../core/Collection ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/arcgisLayerUrl ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/featureFlags ../support/popupUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa,ba,aa,da,ca,na,qa,ua){const sa=["3DObject","Point"];u=Y.defineFieldProperties();m=function(ra){function va(...Ba){Ba=ra.call(this,...Ba)||this;Ba.featureReduction=null;Ba.rangeInfos=null;Ba.operationalLayerType="ArcGISSceneServiceLayer";Ba.type="scene";Ba.fields=null;Ba.floorInfo=null;Ba.outFields=null;Ba.nodePages=null;Ba.materialDefinitions=null;Ba.textureSetDefinitions=
null;Ba.geometryDefinitions=null;Ba.serviceUpdateTimeStamp=null;Ba.excludeObjectIds=new t;Ba.definitionExpression=null;Ba.filter=null;Ba.path=null;Ba.labelsVisible=!0;Ba.labelingInfo=null;Ba.legendEnabled=!0;Ba.priority=null;Ba.semantic=null;Ba.cachedDrawingInfo={color:!1};Ba.popupEnabled=!0;Ba.popupTemplate=null;Ba.objectIdField=null;Ba.globalIdField=null;Ba._fieldUsageInfo={};Ba.screenSizePerspectiveEnabled=!0;return Ba}b._inherits(va,ra);var Ca=va.prototype;Ca.normalizeCtorArgs=function(Ba,Ha){return"string"===
typeof Ba?{url:Ba,...Ha}:Ba};Ca.destroy=function(){this._set("renderer",null)};Ca.getField=function(Ba){return this.fieldsIndex.get(Ba)};Ca.getFieldDomain=function(Ba,Ha){return(Ha=this.getFeatureType(Ha?.feature)?.domains?.[Ba])&&"inherited"!==Ha.type?Ha:this.getField(Ba)?.domain??null};Ca.getFeatureType=function(Ba){return Ba&&this.associatedLayer?this.associatedLayer.getFeatureType(Ba):null};Ca.readNodePages=function(Ba,Ha,Ma){"Point"===Ha.layerType&&(Ba=Ha.pointNodePages);return null==Ba||"object"!==
typeof Ba?null:ja.I3SNodePageDefinition.fromJSON(Ba,Ma)};Ca.readCachedDrawingInfo=function(Ba){if(null==Ba||"object"!==typeof Ba)Ba={};null==Ba.color&&(Ba.color=!1);return Ba};Ca.readObjectIdField=function(Ba,Ha){!Ba&&Ha.fields&&Ha.fields.some(Ma=>{"esriFieldTypeOID"===Ma.type&&(Ba=Ma.name);return!!Ba});return Ba||void 0};Ca.readGlobalIdField=function(Ba,Ha){!Ba&&Ha.fields&&Ha.fields.some(Ma=>{"esriFieldTypeGlobalID"===Ma.type&&(Ba=Ma.name);return!!Ba});return Ba||void 0};Ca.readProfile=function(Ba,
Ha){Ba=Ha.store.profile;if(null!=Ba&&pa[Ba])return pa[Ba];r.getLogger(this).error("Unknown or missing profile",{profile:Ba,layer:this});return"mesh-pyramids"};Ca.load=function(Ba){const Ha=null!=Ba?Ba.signal:null,Ma=this.loadFromPortal({supportedTypes:["Scene Service"]},Ba).catch(D.throwIfAbortError).then(()=>this._fetchService(Ha)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Ha),this._setAssociatedFeatureLayer(Ha),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>
this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>ba.loadStyleRenderer(this,{origin:"service"},Ha)).then(()=>ea.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(Ba));this.addResolvingPromise(Ma);return Promise.resolve(this)};Ca.beforeSave=async function(){null!=this.filter&&(this.filter=this.filter.clone(),await this.load())};Ca._loadFilterGeometries=async function(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(Ba){r.getLogger(this).error("#_loadFilterGeometries()",
this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:Ba}),this.filter=null}};Ca.createQuery=function(){const Ba=new aa;"mesh"!==this.geometryType&&(Ba.returnGeometry=!0,Ba.returnZ=!0);Ba.where=this.definitionExpression||"1\x3d1";Ba.sqlFormat="standard";Ba.outFields=["*"];return Ba};Ca.queryExtent=function(Ba,Ha){return this._getAssociatedLayerForQuery().then(Ma=>Ma.queryExtent(Ba||this.createQuery(),Ha))};Ca.queryFeatureCount=function(Ba,Ha){return this._getAssociatedLayerForQuery().then(Ma=>
Ma.queryFeatureCount(Ba||this.createQuery(),Ha))};Ca.queryFeatures=function(Ba,Ha){return this._getAssociatedLayerForQuery().then(Ma=>Ma.queryFeatures(Ba||this.createQuery(),Ha)).then(Ma=>{if(Ma?.features)for(const Qa of Ma.features)Qa.layer=this,Qa.sourceLayer=this;return Ma})};Ca.queryCachedAttributes=async function(Ba,Ha){const Ma=ea.unpackFieldNames(this.fieldsIndex,await qa.getRequiredFields(this,qa.getFetchPopupTemplate(this)));return na.queryAttributesFromCachedAttributesId(this.parsedUrl.path,
this.attributeStorageInfo??[],Ba,Ha,Ma)};Ca.queryCachedFeature=async function(Ba,Ha){Ba=await this.queryCachedAttributes(Ba,[Ha]);if(!Ba||0===Ba.length)throw new w("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Ha=new y;Ha.attributes=Ba[0];Ha.layer=this;Ha.sourceLayer=this;return Ha};Ca.queryObjectIds=function(Ba,Ha){return this._getAssociatedLayerForQuery().then(Ma=>Ma.queryObjectIds(Ba||this.createQuery(),Ha))};Ca.queryAttachments=function(Ba,Ha){return this._getAssociatedLayerForQuery().then(Ma=>
Ma.queryAttachments(Ba,Ha))};Ca.getFieldUsageInfo=function(Ba){const Ha={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Ba]||Ha:(r.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Ha)};Ca.createPopupTemplate=function(Ba){return ca.createPopupTemplate(this,Ba)};Ca._getAssociatedLayerForQuery=function(){const Ba=this.associatedLayer;return Ba?.loaded?Promise.resolve(Ba):this._loadAssociatedLayerForQuery()};
Ca._loadAssociatedLayerForQuery=async function(){await this.load();if(!this.associatedLayer)throw new w("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(Ba){throw new w("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:Ba});}return this.associatedLayer};Ca.hasCachedStatistics=function(Ba){return null!=this.statisticsInfo&&this.statisticsInfo.some(Ha=>
Ha.name===Ba)};Ca.queryCachedStatistics=async function(Ba,Ha){await this.load(Ha);if(!this.statisticsInfo)throw new w("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ma=this.fieldsIndex.get(Ba);if(!Ma)throw new w("scenelayer:field-unexisting",`Field '${Ba}' does not exist on the layer`);for(const Qa of this.statisticsInfo)if(Qa.name===Ma.name)return Ba=v.join(this.parsedUrl.path,Qa.href),l(Ba,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Ha?
Ha.signal:null}).then(Sa=>Sa.data);throw new w("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");};Ca.saveAs=async function(Ba,Ha){return this._debouncedSaveOperations(T.SaveOperationType.SAVE_AS,{...Ha,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Ba)};Ca.save=async function(){return this._debouncedSaveOperations(T.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})};Ca.applyEdits=async function(Ba,
Ha){const {applyEdits:Ma}=await new Promise((Qa,Sa)=>a(["./graphics/editingSupport"],Qa,Sa));await this.load();if(!this.associatedLayer)throw new w(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return Ma(this,this.associatedLayer.source,Ba,Ha)};Ca.uploadAssets=async function(Ba,Ha){await this.load();if(null==this.associatedLayer)throw new w(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return this.associatedLayer.uploadAssets(Ba,
Ha)};Ca.on=function(Ba,Ha){return b._get(b._getPrototypeOf(va.prototype),"on",this).call(this,Ba,Ha)};Ca.validateLayer=function(Ba){if(Ba.layerType&&!sa.includes(Ba.layerType))throw new w("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:Ba.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new w("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});
if(2<this.version.major)throw new w("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});Ba=this.normalReferenceFrame;var Ha=this.spatialReference;let Ma=!1,Qa=!1;if(null==Ba)Qa=Ma=!0;else switch(Ha=Ha&&Ha.isGeographic,Ba){case "east-north-up":case "earth-centered":Ma=!0;Qa=Ha;break;case "vertex-reference-frame":Ma=!0;Qa=!Ha;break;default:Ma=!1}if(!Ma)throw new w("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");
if(!Qa)throw new w("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};Ca._getTypeKeywords=function(){const Ba=[];if("points"===this.profile)Ba.push("Point");else if("mesh-pyramids"===this.profile)Ba.push("3DObject");else throw new w("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return Ba};Ca._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const Ba of this.fields){const Ha=
!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Qa=>Qa.name===Ba.name)),Ma=!!this.associatedLayer?.fields?.some(Qa=>Qa&&Ba.name===Qa.name);this._fieldUsageInfo[Ba.name]={supportsLabelingInfo:Ha,supportsRenderer:Ha,supportsPopupTemplate:Ha||Ma,supportsLayerQuery:Ma}}};Ca._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides();this._applyAssociatedLayerExtentOverride()};Ca._applyAssociatedLayerFieldsOverrides=function(){if(this.associatedLayer?.fields){var Ba=
null;for(const Ha of this.associatedLayer.fields){const Ma=this.getField(Ha.name);Ma?(!Ma.domain&&Ha.domain&&(Ma.domain=Ha.domain.clone()),Ma.editable=Ha.editable,Ma.nullable=Ha.nullable,Ma.length=Ha.length):(Ba||(Ba=this.fields?this.fields.slice():[]),Ba.push(Ha.clone()))}Ba&&this._set("fields",Ba)}};Ca._applyAssociatedLayerPopupOverrides=function(){if(this.associatedLayer){var Ba=["popupTemplate","popupEnabled"],Ha=M.getProperties(this);for(let Ma=0;Ma<Ba.length;Ma++){const Qa=Ba[Ma],Sa=this.originIdOf(Qa),
La=this.associatedLayer.originIdOf(Qa);Sa<La&&(La===L.OriginId.SERVICE||La===L.OriginId.PORTAL_ITEM)&&Ha.setAtOrigin(Qa,this.associatedLayer[Qa],La)}}};Ca._applyAssociatedLayerExtentOverride=function(){const Ba=this.associatedLayer?.editingInfo?.lastEditDate,Ha=this.associatedLayer?.serverGens,Ma=this.associatedLayer?.getAtOrigin("fullExtent","service");da.sceneLayerEditingEnabled()&&null!=this.associatedLayer?.infoFor3D&&Ma&&P.isHostedAgolService(this.associatedLayer?.url)&&Ba&&this.serviceUpdateTimeStamp?.lastUpdate!==
Ba.getTime()&&(this.serviceUpdateTimeStamp||Ha?.minServerGen!==Ha?.serverGen)&&M.getProperties(this).setAtOrigin("fullExtent",Ma.clone(),L.OriginId.SERVICE)};Ca._setAssociatedFeatureLayer=async function(Ba){if(["mesh-pyramids","points"].includes(this.profile)){Ba=new X.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Ba);try{this.associatedLayer=await Ba.fetch()}catch(Ha){D.isAbortError(Ha)||this._logWarningOnPopupEnabled()}}};Ca._logWarningOnPopupEnabled=async function(){await A.whenOnce(()=>
this.popupEnabled&&null!=this.popupTemplate);const Ba=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?r.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Ba}`):r.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Ba}`)};Ca._validateElevationInfo=function(){const Ba=this.elevationInfo;Ba&&("mesh-pyramids"===this.profile&&"relative-to-scene"===
Ba.mode&&r.getLogger(this).warn(".elevationInfo\x3d","Mesh scene layers don't support relative-to-scene elevation mode"),Ba.featureExpressionInfo&&"0"!==Ba.featureExpressionInfo.expression&&r.getLogger(this).warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};b._createClass(va,[{key:"types",get:function(){return this.associatedLayer?.types??[]}},{key:"typeIdField",get:function(){return this.associatedLayer?.typeIdField??null}},{key:"templates",get:function(){return this.associatedLayer?.templates??
null}},{key:"formTemplate",get:function(){return this.associatedLayer?.formTemplate??null}},{key:"fieldsIndex",get:function(){return new Z(this.fields)}},{key:"elevationInfo",set:function(Ba){this._set("elevationInfo",Ba);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return ka[this.profile]||"mesh"}},{key:"renderer",set:function(Ba){ea.fixRendererFields(Ba,this.fieldsIndex);this._set("renderer",Ba)}},{key:"capabilities",get:function(){var Ba=this.associatedLayer?.capabilities??
Q.zeroCapabilities;const {query:Ha,editing:{supportsGlobalId:Ma,supportsRollbackOnFailure:Qa,supportsUploadWithItemId:Sa,supportsGeometryUpdate:La,supportsReturnServiceEditsInSourceSpatialReference:Ua},data:{supportsZ:Va,supportsM:cb,isVersioned:la,supportsAttachment:eb},operations:{supportsEditing:ib,supportsAdd:Pa,supportsUpdate:za,supportsDelete:Ga,supportsQuery:Fa,supportsQueryAttachments:xa,supportsAsyncConvert3D:ya}}=Ba;Ba=Ba.operations.supportsChangeTracking;const Ea=!!this.associatedLayer?.infoFor3D&&
da.sceneLayerEditingEnabled();return{query:Ha,editing:{supportsGlobalId:Ma,supportsReturnServiceEditsInSourceSpatialReference:Ua,supportsRollbackOnFailure:Qa,supportsGeometryUpdate:Ea&&La,supportsUploadWithItemId:Sa},data:{supportsAttachment:eb,supportsZ:Va,supportsM:cb,isVersioned:la},operations:{supportsQuery:Fa,supportsQueryAttachments:xa,supportsEditing:ib&&Ba,supportsAdd:Ea&&Pa&&Ba,supportsDelete:Ea&&Ga&&Ba,supportsUpdate:za&&Ba,supportsAsyncConvert3D:ya}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?
this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(Ba){this._overrideIfSome("editingEnabled",Ba)}},{key:"infoFor3D",get:function(){return this.associatedLayer?.infoFor3D??null}},{key:"defaultPopupTemplate",get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return this.associatedLayer?.displayField??null}}]);return va}(J.EditBusLayer(T.SceneService(H.ArcGISService(N.OperationalLayer(R.PortalLayer(W.ScaleRangeLayer(x.MultiOriginJSONMixin(I.APIKeyMixin(m.ClonableMixin(O))))))))));
c.__decorate([B.property({types:{key:"type",base:U.FeatureReduction,typeMap:{selection:V}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],m.prototype,"featureReduction",void 0);c.__decorate([B.property({type:[ma.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],m.prototype,"rangeInfos",void 0);
c.__decorate([B.property({json:{read:!1}})],m.prototype,"associatedLayer",void 0);c.__decorate([B.property({type:["show","hide"]})],m.prototype,"listMode",void 0);c.__decorate([B.property({type:["ArcGISSceneServiceLayer"]})],m.prototype,"operationalLayerType",void 0);c.__decorate([B.property({json:{read:!1},readOnly:!0})],m.prototype,"type",void 0);c.__decorate([B.property({...u.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],m.prototype,"fields",void 0);c.__decorate([B.property()],
m.prototype,"types",null);c.__decorate([B.property()],m.prototype,"typeIdField",null);c.__decorate([B.property()],m.prototype,"templates",null);c.__decorate([B.property()],m.prototype,"formTemplate",null);c.__decorate([B.property({readOnly:!0})],m.prototype,"fieldsIndex",null);c.__decorate([B.property({type:oa,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],m.prototype,"floorInfo",void 0);c.__decorate([B.property(u.outFields)],m.prototype,"outFields",
void 0);c.__decorate([B.property({type:ja.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],m.prototype,"nodePages",void 0);c.__decorate([K.reader("service","nodePages",["nodePages","pointNodePages"])],m.prototype,"readNodePages",null);c.__decorate([B.property({type:[ja.I3SMaterialDefinition],readOnly:!0})],m.prototype,"materialDefinitions",void 0);c.__decorate([B.property({type:[ja.I3STextureSetDefinition],readOnly:!0})],m.prototype,"textureSetDefinitions",void 0);c.__decorate([B.property({type:[ja.I3SGeometryDefinition],
readOnly:!0})],m.prototype,"geometryDefinitions",void 0);c.__decorate([B.property({readOnly:!0})],m.prototype,"serviceUpdateTimeStamp",void 0);c.__decorate([B.property({readOnly:!0})],m.prototype,"attributeStorageInfo",void 0);c.__decorate([B.property({readOnly:!0})],m.prototype,"statisticsInfo",void 0);c.__decorate([B.property({type:t.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],m.prototype,"excludeObjectIds",
void 0);c.__decorate([B.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],m.prototype,"definitionExpression",void 0);c.__decorate([B.property({type:fa,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],m.prototype,"filter",void 0);c.__decorate([B.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],m.prototype,"path",
void 0);c.__decorate([B.property(S.elevationInfo)],m.prototype,"elevationInfo",null);c.__decorate([B.property({type:String})],m.prototype,"geometryType",null);c.__decorate([B.property(S.labelsVisible)],m.prototype,"labelsVisible",void 0);c.__decorate([B.property({type:[ha],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ia.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ia.reader},write:!0}})],m.prototype,"labelingInfo",void 0);c.__decorate([B.property(S.legendEnabled)],
m.prototype,"legendEnabled",void 0);c.__decorate([B.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(ra,va){if("number"===typeof ra&&0<=ra&&1>=ra)return ra;ra=va.layerDefinition?.drawingInfo?.transparency;return void 0!==ra?ua.transparencyToOpacity(ra):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],
m.prototype,"opacity",void 0);c.__decorate([B.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],m.prototype,"priority",void 0);c.__decorate([B.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],m.prototype,"semantic",void 0);c.__decorate([B.property({types:n.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],m.prototype,"renderer",
null);c.__decorate([B.property({json:{read:!1}})],m.prototype,"cachedDrawingInfo",void 0);c.__decorate([K.reader("service","cachedDrawingInfo")],m.prototype,"readCachedDrawingInfo",null);c.__decorate([B.property({readOnly:!0,json:{read:!1}})],m.prototype,"capabilities",null);c.__decorate([B.property({type:Boolean,json:{read:!1}})],m.prototype,"editingEnabled",null);c.__decorate([B.property({readOnly:!0,json:{write:!1,read:!1}})],m.prototype,"infoFor3D",null);c.__decorate([B.property(S.popupEnabled)],
m.prototype,"popupEnabled",void 0);c.__decorate([B.property({type:p,json:{name:"popupInfo",write:!0}})],m.prototype,"popupTemplate",void 0);c.__decorate([B.property({readOnly:!0,json:{read:!1}})],m.prototype,"defaultPopupTemplate",null);c.__decorate([B.property({type:String,json:{read:!1}})],m.prototype,"objectIdField",void 0);c.__decorate([K.reader("service","objectIdField",["objectIdField","fields"])],m.prototype,"readObjectIdField",null);c.__decorate([B.property({type:String,json:{read:!1}})],
m.prototype,"globalIdField",void 0);c.__decorate([K.reader("service","globalIdField",["globalIdField","fields"])],m.prototype,"readGlobalIdField",null);c.__decorate([B.property({readOnly:!0,type:String,json:{read:!1}})],m.prototype,"displayField",null);c.__decorate([B.property({type:String,json:{read:!1}})],m.prototype,"profile",void 0);c.__decorate([K.reader("service","profile",["store.profile"])],m.prototype,"readProfile",null);c.__decorate([B.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},
read:!1}})],m.prototype,"normalReferenceFrame",void 0);c.__decorate([B.property(S.screenSizePerspectiveEnabled)],m.prototype,"screenSizePerspectiveEnabled",void 0);m=c.__decorate([G.subclass("esri.layers.SceneLayer")],m);const pa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ka={"mesh-pyramids":"mesh",points:"point",
lines:"polyline",polygons:"polygon"};return m})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){const E=u.getLogger("esri.layers.mixins.SceneService");var F;(function(K){K[K.existingItem=0]="existingItem";K[K.newItem=1]="newItem"})(F||(F={}));const M={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(K){K[K.SAVE=0]="SAVE";K[K.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";a.SceneService=K=>{K=function(G){function L(){var I=G.apply(this,arguments)||this;I.spatialReference=null;I.fullExtent=null;I.heightModelInfo=null;I.minScale=0;I.maxScale=0;I.version={major:Number.NaN,minor:Number.NaN,versionString:""};I.copyright=null;I.sublayerTitleMode="item-title";I.title=null;I.layerId=null;I.indexInfo=null;I._debouncedSaveOperations=q.debounce(async(H,J,N)=>{switch(H){case a.SaveOperationType.SAVE:return I._save(J);case a.SaveOperationType.SAVE_AS:return I._saveAs(N,
J)}});return I}b._inherits(L,G);var O=L.prototype;O.readSpatialReference=function(I,H){return this._readSpatialReference(H)};O._readSpatialReference=function(I){if(null!=I.spatialReference)return w.fromJSON(I.spatialReference);I=I.store;I=(I=I.indexCRS||I.geographicCRS)&&parseInt(I.substring(I.lastIndexOf("/")+1,I.length),10);return null!=I?new w(I):null};O.readFullExtent=function(I,H,J){if(null!=I&&"object"===typeof I)return H=null==I.spatialReference?{...I,spatialReference:this._readSpatialReference(H)}:
I,m.fromJSON(H,J);J=H.store;H=this._readSpatialReference(H);return null==H||null==J||null==J.extent||!Array.isArray(J.extent)||J.extent.some(N=>-1E38>N)?null:new m({xmin:J.extent[0],ymin:J.extent[1],xmax:J.extent[2],ymax:J.extent[3],spatialReference:H})};O.parseVersionString=function(I){const H={major:Number.NaN,minor:Number.NaN,versionString:I};I=I.split(".");2<=I.length&&(H.major=parseInt(I[0],10),H.minor=parseInt(I[1],10));return H};O.readVersion=function(I,H){I=H.store;return this.parseVersionString(null!=
I.version?I.version.toString():"")};O.readTitlePortalItem=function(I){return"item-title"!==this.sublayerTitleMode?void 0:I};O.readTitleService=function(I,H){I=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return r.titleFromUrlAndName(this.url,H.name);H=H.name;if(!H&&this.url){const J=r.parse(this.url);null!=J&&(H=J.title)}"item-title-and-service-name"===this.sublayerTitleMode&&I&&(H=I+" - "+H);return r.cleanTitle(H)};O.writeUrl=function(I,H,J,N){r.writeUrlWithLayerId(this,
I,"layers",H,N)};O._fetchIndexAndUpdateExtent=async function(I,H){this.indexInfo=D.fetchIndexInfo(this.parsedUrl.path,this.rootNode,I,this.apiKey,E,H);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)};O._updateExtent=function(I){if("page"===I?.type){var H=I.rootIndex%I.pageSize;H=I.rootPage?.nodes?.[H];if(null==H||null==H.obb||null==H.obb.center||null==H.obb.halfSize)throw new p("sceneservice:invalid-node-page","Invalid node page.");-1E38>H.obb.center[0]||null==
this.fullExtent||this.fullExtent.hasZ||(I=H.obb.halfSize,H=H.obb.center[2],I=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]),this.fullExtent.zmin=H-I,this.fullExtent.zmax=H+I)}else if("node"===I?.type&&(H=I.rootNode?.mbs,Array.isArray(H)&&4===H.length&&!(-1E38>H[0]))){I=H[2];H=H[3];var {fullExtent:J}=this;J&&(J.zmin=I-H,J.zmax=I+H)}};O._fetchService=async function(I){if(null==this.url)throw new p("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&
/SceneServer\/*$/i.test(this.url)){const H=await this._fetchFirstLayerId(I);null!=H&&(this.layerId=H)}return this._fetchServiceLayer(I)};O._fetchFirstLayerId=async function(I){I=await y(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:I});if(I.data&&Array.isArray(I.data.layers)&&0<I.data.layers.length)return I.data.layers[0].id};O._fetchServiceLayer=async function(I){I=await y(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:I});I.ssl&&
(this.url=this.url.replace(/^http:/i,"https:"));let H=!1;I.data.layerType&&"Voxel"===I.data.layerType&&(H=!0);if(H)return this._fetchVoxelServiceLayer();I=I.data;this.read(I,this._getServiceContext());this.validateLayer(I)};O._fetchVoxelServiceLayer=async function(I){I=(await y(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:I})).data;this.read(I,this._getServiceContext());this.validateLayer(I)};O._getServiceContext=function(){return{origin:"service",portalItem:this.portalItem,
portal:this.portalItem?.portal,url:this.parsedUrl}};O._ensureLoadBeforeSave=async function(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()};O.validateLayer=function(I){};O._updateTypeKeywords=function(I,H,J){I.typeKeywords||(I.typeKeywords=[]);H=H.getTypeKeywords();for(const N of H)I.typeKeywords.push(N);I.typeKeywords&&(I.typeKeywords=I.typeKeywords.filter((N,R,W)=>W.indexOf(N)===R),J===F.newItem&&(I.typeKeywords=I.typeKeywords.filter(N=>"Hosted Service"!==
N)))};O._saveAs=async function(I,H){H={...M,...H};I=B.from(I);I||(E.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new p("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));I.id&&(I=I.clone(),I.id=null);const J=I.portal||v.getDefault();await this._ensureLoadBeforeSave();I.type="Scene Service";I.portal=J;const N={origin:"portal-item",url:null,messages:[],portal:J,portalItem:I,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],
toUpdate:[],toKeep:[],pendingOperations:[]}},R={layers:[this.write({},N)]};await Promise.all(N.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(R,N,H);I.url=this.url;I.title||(I.title=this.title);this._updateTypeKeywords(I,H,F.newItem);await J.signIn();await J.user?.addItem({item:I,folder:H&&H.folder,data:R});await C.saveResources(this.resourceReferences,N,null);this.portalItem=I;l.updateOrigins(N);return N.portalItem=I};O._save=async function(I){I={...M,...I};if(!this.portalItem)throw E.error("_save(): requires the .portalItem property to be set"),
new p("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if("Scene Service"!==this.portalItem.type)throw E.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),new p("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const H={origin:"portal-item",url:this.portalItem.itemUrl&&k.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||
v.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},J={layers:[this.write({},H)]};await Promise.all(H.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(J,H,I);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,I,F.existingItem);await this.portalItem.update({data:J});await C.saveResources(this.resourceReferences,
H,null);l.updateOrigins(H);return this.portalItem};O._validateAgainstJSONSchema=async function(I,H,J){H=H.messages?.filter(T=>"error"===T.type).map(T=>new p(T.name,T.message,T.details))??[];J?.validationOptions?.ignoreUnsupported&&(H=H.filter(T=>"layer:unsupported"!==T.name&&"symbol:unsupported"!==T.name&&"symbol-layer:unsupported"!==T.name&&"property:unsupported"!==T.name&&"url:unsupported"!==T.name&&"scenemodification:unsupported"!==T.name));const N=J?.validationOptions,R=N?.enabled,W=A.getLoader();
if(R&&W&&(I=(await W()).validate(I,J.portalItemLayerType),0<I.length&&(J=`Layer item did not validate:\n${I.join("\n")}`,E.error(`_validateAgainstJSONSchema(): ${J}`),"throw"===N.failPolicy)))throw H=I.map(T=>new p("sceneservice:schema-validation",T)).concat(H),new p("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:H});if(0<H.length)throw new p("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:H});};b._createClass(L,[{key:"url",set:function(I){I=r.sanitizeUrlWithLayerId({layer:this,url:I,nonStandardUrlAllowed:!1,logger:E});this._set("url",I.url);null!=I.layerId&&this._set("layerId",I.layerId)}},{key:"parsedUrl",get:function(){var I=this._get("url");I=k.urlToObject(I);null!=this.layerId&&(I.path=`${I.path}/layers/${this.layerId}`);return I}}]);return L}(K);c.__decorate([d.property(x.id)],K.prototype,"id",void 0);c.__decorate([d.property({type:w})],K.prototype,"spatialReference",
void 0);c.__decorate([h.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readSpatialReference",null);c.__decorate([d.property({type:m})],K.prototype,"fullExtent",void 0);c.__decorate([h.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readFullExtent",null);c.__decorate([d.property({readOnly:!0,type:t})],K.prototype,"heightModelInfo",void 0);c.__decorate([d.property({type:Number,
json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],K.prototype,"minScale",void 0);c.__decorate([d.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],K.prototype,"maxScale",void 0);c.__decorate([d.property({readOnly:!0})],K.prototype,"version",void 0);c.__decorate([h.reader("version",["store.version"])],K.prototype,"readVersion",null);c.__decorate([d.property({type:String,
json:{read:{source:"copyrightText"}}})],K.prototype,"copyright",void 0);c.__decorate([d.property({type:String,json:{read:!1}})],K.prototype,"sublayerTitleMode",void 0);c.__decorate([d.property({type:String})],K.prototype,"title",void 0);c.__decorate([h.reader("portal-item","title")],K.prototype,"readTitlePortalItem",null);c.__decorate([h.reader("service","title",["name"])],K.prototype,"readTitleService",null);c.__decorate([d.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",
isRequired:!0,ignoreOrigin:!0},read:!1}}}})],K.prototype,"layerId",void 0);c.__decorate([d.property(x.url)],K.prototype,"url",null);c.__decorate([n.writer("url")],K.prototype,"writeUrl",null);c.__decorate([d.property()],K.prototype,"parsedUrl",null);c.__decorate([d.property({readOnly:!0})],K.prototype,"store",void 0);c.__decorate([d.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],K.prototype,"rootNode",void 0);return K=c.__decorate([z.subclass("esri.layers.mixins.SceneService")],
K)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(({target:y,propName:p,newOrigin:u})=>{b.isMultiOriginJSONMixin(y)&&u&&y.originOf(p)!==u&&y.updateOrigin(p,u)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],
function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error"],function(a,b,c){a.fetchIndexInfo=async function(y,p,u,q,k,d){var f=null;if(null!=u){f=`${y}/nodepages/`;const g=f+Math.floor(u.rootIndex/u.nodesPerPage);try{return{type:"page",rootPage:(await b(g,{query:{f:"json",token:q},responseType:"json",signal:d})).data,
rootIndex:u.rootIndex,pageSize:u.nodesPerPage,lodMetric:u.lodSelectionMetricType,urlPrefix:f}}catch(e){null!=k&&k.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",g,e),f=e}}if(!p)return null;p=p&&p.split("/").pop();y=`${y}/nodes/`;p=y+p;try{return{type:"node",rootNode:(await b(p,{query:{f:"json",token:q},responseType:"json",signal:d})).data,urlPrefix:y}}catch(g){throw new c("sceneservice:root-node-missing","Root node missing.",{pageError:f,nodeError:g,url:p});
}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(c){b=c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(a,b,c,y,p,u){async function q(d,
f){f=await b.result(d.resource.portalItem.addResource(d.resource,d.content,{...(null!=f?f:{}),compress:d.compress}));if(!0===f.ok)d.finish?.(d.resource);else throw d.error?.(f.error),f.error;}async function k(d,f){f=await b.result(d.resource.update(d.content,f));if(!0===f.ok)d.finish?.(d.resource);else throw d.error?.(f.error),f.error;}a.saveResources=async function(d,f,g){if(f&&f.resources){var e=f.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0;d.portalItem=f.portalItem;var h=
new Set(f.resources.toKeep.map(l=>l.resource.path)),z=new Set,n=[];h.forEach(l=>{e.delete(l);d.paths.push(l)});for(const l of f.resources.toUpdate)if(e.delete(l.resource.path),h.has(l.resource.path)||z.has(l.resource.path)){const {resource:m,content:t,finish:w,error:r}=l,x=u.getSiblingOfSameTypeI(m,p.generateUUID());d.paths.push(x.path);n.push(q({resource:x,content:t,compress:l.compress,finish:w,error:r},g))}else d.paths.push(l.resource.path),n.push(k(l,g)),z.add(l.resource.path);for(const l of f.resources.toAdd)n.push(q(l,
g)),d.paths.push(l.resource.path);e.forEach(l=>{f.portalItem&&(l=f.portalItem.resourceFromPath(l),n.push(l.portalItem.removeResource(l).catch(()=>{})))});if(0!==n.length&&(h=await y.eachAlways(n),y.throwIfAborted(g),g=h.filter(l=>"error"in l).map(l=>l.error),0<g.length))throw new c("save:resources","Failed to save one or more resources",{errors:g});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error",
"../../core/urlUtils"],function(a,b,c,y){function p(k){const d=k.lastIndexOf("/");return-1===d?[".",k]:[k.slice(0,d),k.slice(d+1)]}function u(k){{const h=y.getPathExtension(k);k=null==h?[k,""]:[k.slice(0,k.length-h.length-1),`.${h}`]}const [d,f]=k,[g,e]=p(d);return[g,e,f]}async function q(k){return k instanceof Blob?k:(await b(k.url,{responseType:"blob"})).data}a.addOrUpdateResource=async function(k,d,f,g){if(!k.hasPath())throw new c(`portal-item-resource-${d}:invalid-path`,"Resource does not have a valid path");
const e=k.portalItem;await e.load(g);d=y.join(e.userItemUrl,"add"===d?"addResources":"updateResources");const [h,z]=p(k.path);f=await q(f);const n=new FormData;h&&"."!==h&&n.append("resourcesPrefix",h);null!=g&&g.compress&&n.append("compress","true");n.append("fileName",z);n.append("file",f,z);n.append("f","json");null!=g&&g.access&&n.append("access",g.access);await e.portal.request(d,{method:"post",body:n,signal:g?.signal});return k};a.contentToBlob=q;a.fetchResources=async function(k,d={},f){await k.load(f);
const g=y.join(k.itemUrl,"resources"),{start:e=1,num:h=10,sortOrder:z="asc",sortField:n="created"}=d;d=await k.portal.request(g,{query:{start:e,num:h,sortOrder:z,sortField:n,token:k.apiKey},signal:f?.signal});return{total:d.total,nextStart:d.nextStart,resources:d.resources.map(({created:l,size:m,resource:t})=>({created:new Date(l),size:m,resource:k.resourceFromPath(t)}))}};a.getSiblingOfSameType=function(k,d){if(!k.hasPath())return null;const [f,,g]=u(k.path);return k.portalItem.resourceFromPath(y.join(f,
d+g))};a.getSiblingOfSameTypeI=function(k,d){if(!k.hasPath())return null;const [f,,g]=u(k.path);return k.portalItem.resourceFromPath(y.join(f,d+g))};a.removeAllResources=async function(k,d){await k.load(d);const f=y.join(k.userItemUrl,"removeResources");return k.portal.request(f,{method:"post",query:{deleteAll:!0},signal:d?.signal})};a.removeResource=async function(k,d,f){if(!d.hasPath())throw new c("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await k.load(f);
const g=y.join(k.userItemUrl,"removeResources");await k.portal.request(g,{method:"post",query:{resource:d.path},signal:f?.signal});d.portalItem=null};a.splitPrefixFileNameAndExtension=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,
supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,
supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,
standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,
supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(a,b,c,y,p,u,q,k){let d=function(){function f(e,h,z,n){this._parsedUrl=e;this._portalItem=h;this._apiKey=z;this.signal=n;this._rootDocument=null;if(e=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this._urlParts={root:e[1],layerId:parseInt(e[2],10)}}var g=f.prototype;g.fetch=async function(){if(!this._urlParts)return null;var e=this._portalItem??await this._portalItemFromServiceItemId();if(null==e)return this._loadFromUrl();e=await this._findAndLoadRelatedPortalItem(e);
return null==e?null:this._loadFeatureLayerFromPortalItem(e)};g.fetchPortalItem=async function(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return null==e?null:this._findAndLoadRelatedPortalItem(e)};g._fetchRootDocument=async function(){if(null!=this._rootDocument)return this._rootDocument;if(null==this._urlParts)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},h=`${this._urlParts.root}/SceneServer`;
try{this._rootDocument=(await y(h,e)).data}catch{this._rootDocument={}}return this._rootDocument};g._fetchServiceOwningPortalUrl=async function(){var e=this._parsedUrl?.path;const h=e?c.id?.findServerInfo(e):null;if(h?.owningSystemUrl)return h.owningSystemUrl;e=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const z=(await y(e,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(z)return z}catch(z){p.throwIfAbortError(z)}return null};g._findAndLoadRelatedPortalItem=
async function(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(h=>"Feature Service"===h.type)||null}catch(h){return p.throwIfAbortError(h),null}};g._loadFeatureLayerFromPortalItem=async function(e){await e.load({signal:this.signal});const h=await this._findMatchingAssociatedSublayerUrl(e.url??"");return(new u({url:h,portalItem:e})).load({signal:this.signal})};g._loadFromUrl=async function(){const e=await this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);
return(new u({url:e})).load({signal:this.signal})};g._findMatchingAssociatedSublayerUrl=async function(e){const h=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");e=this._urlParts?.layerId;var z=this._fetchRootDocument();const n=w=>y(h,{query:{f:"json"},responseType:"json",authMode:w,signal:this.signal});var l=n("anonymous").catch(()=>n("no-prompt"));const [m,t]=await Promise.all([l,z]);z=t&&t.layers;l=m.data&&m.data.layers;if(!Array.isArray(l))throw Error("expected layers array");if(!Array.isArray(z)){if(null!=
e&&e<l.length)return`${h}/${l[e].id}`}else for(let w=0;w<Math.min(z.length,l.length);w++)if(z[w].id===e)return`${h}/${l[w].id}`;throw Error("could not find matching associated sublayer");};g._portalItemFromServiceItemId=async function(){var e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;e=new k({id:e,apiKey:this._apiKey});const h=await this._fetchServiceOwningPortalUrl();null!=h&&(e.portal=new q({url:h}));try{return e.load({signal:this.signal})}catch(z){return p.throwIfAbortError(z),
null}};return b._createClass(f)}();a.FetchAssociatedFeatureLayer=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f){a.I3SNodePageDefinition=function(g){function e(){var h=g.apply(this,arguments)||this;h.nodesPerPage=null;h.rootIndex=0;h.lodSelectionMetricType=null;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);c.__decorate([p.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);c.__decorate([p.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=c.__decorate([f.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(g){function e(){var h=g.apply(this,arguments)||this;h.factor=1;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);c.__decorate([p.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=c.__decorate([f.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(g){function e(){var h=g.apply(this,arguments)||this;h.baseColorFactor=[1,1,1,1];h.baseColorTexture=null;h.metallicRoughnessTexture=null;h.metallicFactor=1;h.roughnessFactor=1;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);c.__decorate([p.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);c.__decorate([p.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);c.__decorate([p.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);c.__decorate([p.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
c.__decorate([f.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(g){function e(){var h=g.apply(this,arguments)||this;h.alphaMode="opaque";h.alphaCutoff=.25;h.doubleSided=!1;h.cullFace="none";h.normalTexture=null;h.occlusionTexture=null;h.emissiveTexture=null;h.emissiveFactor=null;h.pbrMetallicRoughness=null;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([d.enumeration({opaque:"opaque",
mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);c.__decorate([p.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);c.__decorate([p.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);c.__decorate([d.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);c.__decorate([p.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",
void 0);c.__decorate([p.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);c.__decorate([p.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);c.__decorate([p.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);c.__decorate([p.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=c.__decorate([f.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:String,json:{read:{source:["name","index"],reader:(g,e)=>null!=g?g:`${e.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);c.__decorate([d.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=c.__decorate([f.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(g){function e(){var h=g.apply(this,arguments)||this;h.atlas=!1;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);c.__decorate([p.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=c.__decorate([f.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([d.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);c.__decorate([p.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=c.__decorate([f.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([d.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);c.__decorate([p.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=c.__decorate([f.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(g){function e(){var h=g.apply(this,arguments)||this;h.offset=0;return h}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([p.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);c.__decorate([p.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);c.__decorate([p.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=c.__decorate([f.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(g){function e(){return g.apply(this,arguments)||this}b._inherits(e,g);return b._createClass(e)}(y.JSONSupport);c.__decorate([d.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);c.__decorate([p.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);
a.I3SGeometryDefinition=c.__decorate([f.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){a.RangeInfo=function(f){function g(){var e=f.apply(this,arguments)||this;e.name=null;e.field=null;e.currentRangeExtent=null;e.fullRangeExtent=null;e.type="rangeInfo";return e}b._inherits(g,f);return b._createClass(g)}(y.JSONSupport);c.__decorate([p.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);c.__decorate([p.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);c.__decorate([p.property({type:[Number],
json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);c.__decorate([p.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);c.__decorate([p.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=c.__decorate([d.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Handles ../../core/JSONSupport ../../core/lang ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){var n;p=n=function(l){function m(w){w=l.call(this,w)||this;w.spatialRelationship="disjoint";w.geometries=new h;w._geometriesSource=null;w._handles=new y;return w}a._inherits(m,l);var t=m.prototype;t.initialize=function(){this._handles.add(q.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,q.sync))};t.destroy=function(){this._handles.destroy()};t.readGeometries=function(w,r,x){Array.isArray(w)?this.geometries=h.fromJSON(w,x):this._geometriesSource=
{url:z.fromJSON(w,x),context:x}};t.loadGeometries=async function(w,r){if(null!=this._geometriesSource){var {url:x,context:D}=this._geometriesSource;r=await c(x,{responseType:"json",signal:r?.signal});var A=w.toJSON();w=r.data.map(v=>({...v,spatialReference:A}));this.geometries=h.fromJSON(w,D);this._geometriesSource=null}};t.clone=function(){const w=new n({geometries:u.clone(this.geometries),spatialRelationship:this.spatialRelationship});w._geometriesSource=this._geometriesSource;return w};return a._createClass(m)}(p.JSONSupport);
b.__decorate([k.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],p.prototype,"spatialRelationship",void 0);b.__decorate([k.property({type:h,nonNullable:!0,json:{write:!0}}),e.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],p.prototype,"geometries",void 0);b.__decorate([f.reader(["web-scene","portal-item"],"geometries")],p.prototype,"readGeometries",null);return p=n=b.__decorate([g.subclass("esri.layers.support.SceneFilter")],p)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f){function g(m,t,w){const r=u.getPropertyMetadata(t,w);return{type:String,read:(x,D,A)=>{x=f.read(x,D,A);if(r.type===String)return x;if("function"===typeof r.type)return new r.type({url:x})},write:{writer(x,D,A,v){if(v&&v.resources){var B=null==x?null:"string"===typeof x?x:x.url;B=f.toJSON(B,{...v,verifyItemRelativeUrls:v&&v.verifyItemRelativeUrls?{writtenUrls:v.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},f.MarkKeep.NO);var C=r.type!==String&&(!c.isMultiOriginJSONMixin(this)||
v&&v.origin&&this.originIdOf(w)>q.nameToId(v.origin));x={object:this,propertyName:w,value:x,targetUrl:B,dest:D,targetPropertyName:A,context:v,params:m};if(v&&v.portalItem&&B&&!y.isAbsolute(B))if(C){{const {context:E,targetUrl:F,params:M,value:K,dest:G,targetPropertyName:L}=x;E.portalItem&&(D=E.portalItem.resourceFromPath(F),A=n(K,F,E),v=d.getResourceContentExtension(A),B=y.getPathExtension(D.path),C=M?.compress??!1,v!==B?e(x):(E.resources&&z({...x,resource:D,content:A,compress:C,updates:E.resources.toUpdate}),
G[L]=F))}}else h(x);else v&&v.portalItem&&(null==B||null!=f.itemIdFromResourceUrl(B)||y.isBlobProtocol(B)||C)?e(x):D[A]=B}else D[A]="string"===typeof x?f.toJSON(x,v):x.write({},v)}}}}function e(m){const {targetUrl:t,params:w,value:r,context:x,dest:D,targetPropertyName:A}=m;if(x.portalItem){var v=f.prefixAndFilenameFromResourceUrl(t),B=v?.filename??p.generateUUID(),C=w?.prefix??v?.prefix;v=n(r,t,x);var E=y.join(C,B);B=`${E}.${d.getResourceContentExtension(v)}`;var F=x.portalItem.resourceFromPath(B);
y.isBlobProtocol(t)&&x.resources&&x.resources.pendingOperations.push(l(t).then(M=>{F.path=`${E}.${d.getResourceContentExtension(M)}`;D[A]=F.itemRelativeUrl}).catch(()=>{}));x.resources&&z({...m,resource:F,content:v,compress:w?.compress??!1,updates:x.resources.toAdd});D[A]=F.itemRelativeUrl}}function h({context:m,targetUrl:t,dest:w,targetPropertyName:r}){m.portalItem&&m.resources&&(m.resources.toKeep.push({resource:m.portalItem.resourceFromPath(t),compress:!1}),w[r]=t)}function z({object:m,propertyName:t,
updates:w,resource:r,content:x,compress:D}){w.push({resource:r,content:x,compress:D,finish:A=>{"string"===typeof m[t]?m[t]=A.url:m[t].url=A.url}})}function n(m,t,w){return"string"===typeof m?{url:t}:new Blob([JSON.stringify(m.toJSON(w))],{type:"application/json"})}async function l(m){const t=(await new Promise((w,r)=>a(["../../../request"],x=>w(Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}))),r))).default;({data:m}=await t(m,{responseType:"blob"}));
return m}b.persistable=function(m){const t=m?.origins??[void 0];return(w,r)=>{a:if("resource"===m?.type)var x=g(m,w,r);else{switch(m?.type??"other"){case "other":x={read:!0,write:!0};break a;case "url":const {read:D,write:A}=f.persistableUrlUtils;x={read:D,write:A};break a}x=void 0}for(const D of t){const A=k.propertyJSONMeta(w,D,r);for(const v in x)A[v]=x[v]}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],
function(a,b){const c={},y=c["text/plain"],p={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const u in p)c[p[u]]=u;a.getResourceContentExtension=function(u){u instanceof Blob?u=u.type:(u=b.getPathExtension(u.url),u=p[u]||"text/plain");return c[u]||y};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),function(a,b,c,y,p,u,q,k,d,f,g,e,h){var z;c=z=function(n){function l(t){return n.call(this,
t)||this}a._inherits(l,n);var m=l.prototype;m.clone=function(){return new z(this.items.map(t=>t.clone()))};m.write=function(t,w){return this.toJSON(w)};m.toJSON=function(t){const w=t?.layer?.spatialReference;return w?this.toArray().map(r=>{if(!w.equals(r.spatialReference)){if(!h.canProjectWithoutEngine(r.spatialReference,w))return t&&t.messages&&t.messages.push(new p("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,
context:t})),null;const x=new e;h.projectPolygon(r,x,w);r=x}r=r.toJSON(t);delete r.spatialReference;return r}).filter(r=>null!=r):(t?.messages&&t.messages.push(new p("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(r=>r.toJSON(t)))};l.fromJSON=function(t,w){const r=new z;t.forEach(x=>r.add(e.fromJSON(x,w)));return r};return a._createClass(l)}(y.JSONSupportMixin(c.ofType(e)));
return c=z=b.__decorate([g.subclass("esri.layers.support.PolygonCollection")],c)})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/SpatialReference ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/Attribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){function G(pa){return pa?parseInt(pa.substring(pa.lastIndexOf("/")+1,pa.length),10):void 0}function L(pa,ka){var ra=ka[0],va=ka[1];ka=ka[3];const Ca=pa[0]-ra;ra-=pa[2];const Ba=pa[1]-va;pa=va-pa[3];va=Math.max(Ca,ra,0);const Ha=Math.max(Ba,pa,0);va=va*va+Ha*Ha;return va>ka*ka?a.MbsIntersectResult.OUTSIDE:0<va?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Ca,ra,Ba,pa)>ka?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function O(pa,ka,ra){const va=[],Ca=ra&&ra.missingFields;ra=ra&&ra.originalFields;for(const Ba of pa){pa=Ba.toLowerCase();let Ha=!1;for(const Ma of ka)if(pa===Ma.name.toLowerCase()){va.push(Ma.name);Ha=!0;ra&&ra.push(Ba);break}!Ha&&Ca&&Ca.push(Ba)}return va}function I(pa,ka,ra){const va=new Map,Ca=[];ra=ra();for(const Ma of pa){var Ba=Ma.attributes[ka];for(var Ha=0;Ha<ra.length;Ha++){pa=ra[Ha];const Qa=pa.featureIds.indexOf(Ba);if(0<=Qa){Ba=va.get(pa.node);Ba||(Ba={node:pa.node,indices:[],graphics:[]},
Ca.push(Ba),va.set(pa.node,Ba));Ba.indices.push(Qa);for(Ba.graphics.push(Ma);0<Ha;Ha--)ra[Ha]=ra[Ha-1];ra[0]=pa;break}}}return Ca}async function H(pa,ka,ra,va){ka.sort((Ha,Ma)=>Ha.attributes[ra]-Ma.attributes[ra]);var Ca=ka.map(Ha=>Ha.attributes[ra]);const Ba=[];va=O(va,pa.fields,{originalFields:Ba});pa=await J(pa,Ca,va);for(Ca=0;Ca<ka.length;Ca++){const Ha=ka[Ca],Ma=pa[Ca],Qa={};if(Ha.attributes)for(const Sa in Ha.attributes)Qa[Sa]=Ha.attributes[Sa];for(let Sa=0;Sa<Ba.length;Sa++)Qa[Ba[Sa]]=Ma[va[Sa]];
Ha.attributes=Qa}return ka}function J(pa,ka,ra){var va=pa.capabilities.query.maxRecordCount;if(null!=va&&ka.length>va)return va=y.splitIntoChunks(ka,va),Promise.all(va.map(Ca=>J(pa,Ca,ra))).then(Ca=>Ca.flat());va=new v({objectIds:ka,outFields:ra,orderByFields:[pa.objectIdField]});return pa.queryFeatures(va).then(Ca=>{if(Ca&&Ca.features&&Ca.features.length===ka.length)return Ca.features.map(Ba=>Ba.attributes);throw new p("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");
})}function N(pa,ka,ra,va,Ca){const Ba=[];for(const Ha of ka)Ha&&Ca.includes(Ha.name)&&Ba.push({url:`${pa}/nodes/${ra}/attributes/${Ha.key}/0`,storageInfo:Ha});return k.eachAlways(Ba.map(Ha=>c(Ha.url,{responseType:"array-buffer"}).then(Ma=>B.readBinaryAttribute(Ha.storageInfo,Ma.data)))).then(Ha=>{const Ma=[];for(const Qa of va){const Sa={};for(let La=0;La<Ha.length;La++){const Ua=Ha[La].value;null!=Ua&&(Sa[Ba[La].storageInfo.name]=R(Ua,Qa))}Ma.push(Sa)}return Ma})}function R(pa,ka){if(!pa)return null;
ka=pa[ka];return d.isInt16Array(pa)?-32768===ka?null:ka:d.isInt32Array(pa)?ka===Y?null:ka:ka!==ka?null:ka}function W(pa){var ka=pa.store,ra=ka.indexCRS||ka.geographicCRS;if(ka=void 0===ra?ka.indexWKT:void 0)if(pa.spatialReference){if(ka!==pa.spatialReference.wkt)throw new p("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new p("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});ra=ra?new r(G(ra)):pa.spatialReference;return ra.equals(pa.spatialReference)?pa.spatialReference:ra}function T(pa){var ka=pa.store,ra=ka.vertexCRS||ka.projectedCRS;if(ka=void 0===ra?ka.vertexWKT:void 0)if(pa.spatialReference){if(ka!==pa.spatialReference.wkt)throw new p("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new p("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});ra=ra?new r(G(ra)):pa.spatialReference;return ra.equals(pa.spatialReference)?pa.spatialReference:ra}function P(pa,ka,ra){if(!w.canProjectWithoutEngine(pa,ka))throw new p("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
ra&&!Q(pa,ka))throw new p("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function Q(pa,ka){return pa.equals(ka)||pa.isWGS84&&ka.isWebMercator||pa.isWebMercator&&ka.isWGS84}function S(pa,ka,ra){const va=W(pa);pa=T(pa);P(va,ka,ra);P(pa,ka,ra)}function U(pa,ka,ra,va,Ca=0){if(va===x.getSphericalPCPF(va))if(ka.isGeographic){var Ba=t.getReferenceEllipsoid(ka);va=1+Math.max(0,Ca)/(Ba.radius+pa.center[2]);
l.set(ra.center,pa.center[0],pa.center[1],pa.center[2]+Ca);w.projectBuffer(ra.center,ka,0,ra.center,x.getSphericalPCPF(ka),0,1);z.copy(ra.quaternion,pa.quaternion);z.conjugate(ba,pa.quaternion);l.set(qa,0,0,1);l.transformQuat(qa,qa,ba);l.set(qa,pa.halfSize[0]*Math.abs(qa[0]),pa.halfSize[1]*Math.abs(qa[1]),pa.halfSize[2]*Math.abs(qa[2]));l.scale(qa,qa,Ba.inverseFlattening);l.add(ra.halfSize,pa.halfSize,qa);l.scale(ra.halfSize,ra.halfSize,va)}else{M.corners(pa,aa);l.set(ra.center,pa.center[0],pa.center[1],
pa.center[2]+Ca);w.computeTranslationToOriginAndRotation(ka,ra.center,fa,x.getSphericalPCPF(ka));l.set(ra.center,fa[12],fa[13],fa[14]);va=2*Math.sqrt(1+fa[0]+fa[5]+fa[10]);ba[0]=(fa[6]-fa[9])/va;ba[1]=(fa[8]-fa[2])/va;ba[2]=(fa[1]-fa[4])/va;ba[3]=.25*va;z.multiply(ra.quaternion,ba,pa.quaternion);z.conjugate(ba,ra.quaternion);let Ha=va=pa=0;for(Ba of aa)Ba[2]+=Ca,w.projectBuffer(Ba,ka,0,Ba,x.getSphericalPCPF(ka),0,1),l.sub(qa,Ba,ra.center),l.transformQuat(qa,qa,ba),pa=Math.max(pa,Math.abs(qa[0])),
va=Math.max(va,Math.abs(qa[1])),Ha=Math.max(Ha,Math.abs(qa[2]));l.set(ra.halfSize,pa,va,Ha)}else ka.isWGS84&&(va.isWebMercator||A.isPlateCarree(va))?(l.copy(oa,pa.center),oa[2]+=Ca,Ca=x.getSphericalPCPF(va),w.projectBuffer(oa,ka,0,oa,Ca,0,1),V(Ca,pa,oa,va,ra)):ka.isWebMercator&&A.isPlateCarree(va)?(l.copy(oa,pa.center),oa[2]+=Ca,V(ka,pa,oa,va,ra)):pa===ra?(ra.center[2]+=Ca,w.projectBuffer(ra.center,ka,0,ra.center,va,0,1)):(l.set(ra.center,pa.center[0],pa.center[1],pa.center[2]+Ca),w.projectBuffer(ra.center,
ka,0,ra.center,va,0,1),z.copy(ra.quaternion,pa.quaternion),l.copy(ra.halfSize,pa.halfSize))}function V(pa,ka,ra,va,Ca){const Ba=f.fromQuat(ma,ka.quaternion);for(let Ma=0;8>Ma;++Ma){for(var Ha=0;3>Ha;++Ha)ia[Ha]=ka.halfSize[Ha]*(0!==(Ma&1<<Ha)?-1:1);for(Ha=0;3>Ha;++Ha){let Qa=ra[Ha];for(let Sa=0;3>Sa;++Sa)Qa+=ia[Sa]*Ba[3*Sa+Ha];ja[3*Ma+Ha]=Qa}}w.projectBuffer(ja,pa,0,ja,va,0,8);M.compute(ha,Ca)}const X=D.create();a.MbsIntersectResult=void 0;(function(pa){pa[pa.OUTSIDE=0]="OUTSIDE";pa[pa.INTERSECTS_CENTER_OUTSIDE=
1]="INTERSECTS_CENTER_OUTSIDE";pa[pa.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";pa[pa.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const Y=-(2**31),Z=E.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let ea=b._createClass(function(){this.material=this.edgeMaterial=null;this.castShadows=!0});const ja=Array(24),ha=new K.Attribute(ja,3,!0),ia=m.create(),oa=m.create(),ma=g.create(),fa=h.create(),ba=n.create(),aa=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],
[0,0,0],[0,0,0]],da=D.create(),ca=D.create(),na=M.create(),qa=m.create(),ua={data:Array(72),size:3,exclusive:!0,stride:3},sa=h.create();a.SymbolInfo=ea;a.addWraparound=function(pa,ka){return(pa|0)+(ka|0)|0};a.checkPointCloudLayerCompatibleWithView=function(pa,ka){P(pa.spatialReference,ka.spatialReference,ka.viewingMode)};a.checkPointCloudLayerValid=function(pa){var ka;(ka=null==pa.store||null==pa.store.defaultGeometrySchema)||(pa=pa.store.defaultGeometrySchema,ka=!!(null==pa.geometryType||"points"!==
pa.geometryType||null!=pa.topology&&"PerAttributeArray"!==pa.topology||null!=pa.encoding&&""!==pa.encoding&&"lepcc-xyz"!==pa.encoding||null==pa.vertexAttributes||null==pa.vertexAttributes.position));if(ka)throw new p("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(pa,ka,ra){if(pa.serviceUpdateTimeStamp?.lastUpdate!==ka.serviceUpdateTimeStamp?.lastUpdate||!ra.isEmpty||q.applySome(pa.associatedLayer,va=>
va.url)!==q.applySome(ka.associatedLayer,va=>va.url))throw new p("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=function(pa,ka){S(pa,ka.spatialReference,ka.viewingMode)};a.checkSceneLayerValid=function(pa){var ka;(ka=null==pa.store||null==pa.store.defaultGeometrySchema)||(ka=pa.store.defaultGeometrySchema,ka=!!(null!=ka.geometryType&&"triangles"!==ka.geometryType||null!=ka.topology&&"PerAttributeArray"!==ka.topology||null==ka.vertexAttributes||null==ka.vertexAttributes.position));
if(ka)throw new p("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:pa.parsedUrl.path});};a.checkSpatialReference=P;a.checkSpatialReferences=S;a.computeVisibilityObb=function(pa,ka,ra,va,Ca,Ba){if(!Ba||0===Ba.length||null==ka||!pa.mbs)return null;const Ha=C.computeGlobalTransformation(pa.mbs,Ca,ra,ka);e.invert(sa,Ha);let Ma=null;const Qa=()=>{if(!Ma)if(Ma=aa,D.empty(ca),null!=pa.serviceObb){U(pa.serviceObb,ra,na,ka,Ca);M.corners(na,Ma);for(var Va of Ma)l.transformMat4(Va,
Va,sa),D.expandPointInPlace(ca,Va)}else{var cb=pa.mbs;if(cb)for(Va=cb[3],w.projectVectorToVector(cb,ra,qa,ka),l.transformMat4(qa,qa,sa),qa[2]+=Ca,cb=0;8>cb;++cb){const la=Ma[cb];l.copy(la,[qa[0]+(cb&1?Va:-Va),qa[1]+(cb&2?Va:-Va),qa[2]+(cb&4?Va:-Va)]);D.expandPointInPlace(ca,la)}}};let Sa=Infinity,La=-Infinity;const Ua=Va=>{if("replace"===Va.type&&(Va=Va.geometry,Va?.hasZ)){D.empty(da);var cb=Va.spatialReference||va;Va=Va.rings.reduce((la,eb)=>eb.reduce((ib,Pa)=>{w.projectVectorToVector(Pa,cb,qa,ka);
l.transformMat4(qa,qa,sa);D.expandPointInPlace(da,qa);return Math.min(qa[2],ib)},la),Infinity);Qa();D.intersects(ca,da)&&(Sa=Math.min(Sa,Va),La=Math.max(La,Va))}};Ba.forEach(Va=>Ua(Va));if(Infinity===Sa)return null;Ba=(Va,cb,la)=>{l.transformMat4(qa,la,Ha);Va[cb]=qa[0];Va[cb+1]=qa[1];Va[cb+2]=qa[2];cb+=24;la[2]=Sa;l.transformMat4(qa,la,Ha);Va[cb]=qa[0];Va[cb+1]=qa[1];Va[cb+2]=qa[2];cb+=24;la[2]=La;l.transformMat4(qa,la,Ha);Va[cb]=qa[0];Va[cb+1]=qa[1];Va[cb+2]=qa[2]};for(let Va=0;8>Va;++Va)Ba(ua.data,
3*Va,Ma[Va]);return M.compute(ua)};a.containsDraco=function(pa){if(u("disable-feature:i3s-draco")||!pa)return!1;for(const ka of pa)for(const ra of ka.geometryBuffers)if("draco"===ra.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=G;a.filterInPlace=function(pa,ka,ra){let va=0,Ca=0;for(let Ba=0;Ba<ka.length&&va<pa.length;Ba++)pa[va]===ka[Ba]&&(ra(Ba)&&(pa[Ca]=pa[va],Ca++),va++);pa.length=Ca};a.findFieldsCaseInsensitive=O;a.findIntersectingNodes=function(pa,ka,ra,va){ra.traverse(ka,Ca=>
{const Ba=Ca.mbs;if((null!=Ba&&L(pa,Ba))===a.MbsIntersectResult.OUTSIDE)return!1;va(Ca);return!0})};a.getCacheKeySuffix=function(pa,ka){return null==ka?"@null":ka===x.getSphericalPCPF(ka)?"@ECEF":pa.equals(ka)?"":null!=ka.wkid?"@"+ka.wkid:null};a.getCachedAttributeValue=R;a.getClipRect=function(pa,ka){if(0===ka.rotationScale[1]&&0===ka.rotationScale[2]&&0===ka.rotationScale[3]&&0===ka.rotationScale[5]&&0===ka.rotationScale[6]&&0===ka.rotationScale[7])return X[0]=(pa[0]-ka.position[0])/ka.rotationScale[0],
X[1]=(pa[1]-ka.position[1])/ka.rotationScale[4],X[2]=(pa[2]-ka.position[0])/ka.rotationScale[0],X[3]=(pa[3]-ka.position[1])/ka.rotationScale[4],X};a.getIndexCrs=W;a.getSymbolInfo=function(pa){const ka=new ea;var ra=!1;let va=!1;for(const Ba of pa.symbolLayers.items)if("fill"===Ba.type&&Ba.enabled){var Ca=Ba.material;pa=Ba.edges;null==Ca||ra||(ra=Ca.color,Ca=F.parseColorMixMode(Ca.colorMixMode),ka.material=null!=ra?{color:[ra.r/255,ra.g/255,ra.b/255],alpha:ra.a,colorMixMode:Ca}:{color:[1,1,1],alpha:1,
colorMixMode:F.ColorMixModeEnum.Multiply},ka.castShadows=Ba.castShadows,ra=!0);null==pa||va||(ka.edgeMaterial=E.createMaterialFromEdges(pa,{}),va=!0)}ka.material||(ka.material={color:[1,1,1],alpha:1,colorMixMode:F.ColorMixModeEnum.Multiply});return ka};a.getVertexCrs=T;a.intersectBoundingRectWithMbs=L;a.invalidateMbs=function(pa){null!=pa&&(pa[3]=-1)};a.invalidateObb=function(pa){null!=pa&&(pa.halfSize[0]=-1)};a.isSupportedLocalModeProjection=Q;a.isValidMbs=function(pa){return 0<=pa[3]};a.isValidObb=
function(pa){return null!=pa&&0<=pa.halfSize[0]};a.objectIdFilter=function(pa,ka,ra){let va=0,Ca=0;for(;va<ra.length;)0<=y.binaryIndexOf(pa,ra[va])===ka&&(ra[Ca]=ra[va],Ca++),va++;ra.length=Ca};a.queryAttributesFromCachedAttributesId=N;a.rendererNeedsTextures=function(pa){if(null==pa||"simple"!==pa.type&&"class-breaks"!==pa.type&&"unique-value"!==pa.type||("unique-value"===pa.type||"class-breaks"===pa.type)&&null==pa.defaultSymbol)return!0;pa=pa.getSymbols();if(0===pa.length)return!0;for(const ka of pa){if("mesh-3d"!==
ka.type||0===ka.symbolLayers.length)return!0;for(const ra of ka.symbolLayers.items)if("fill"!==ra.type||null==ra.material||null==ra.material.color||"replace"!==ra.material.colorMixMode)return!0}return!1};a.transformObb=U;a.transparentEdgeMaterial=Z;a.whenGraphicAttributes=async function(pa,ka,ra,va,Ca){if(0===ka.length)return[];const Ba=pa.attributeStorageInfo;if(null!=pa.associatedLayer)try{return await H(pa.associatedLayer,ka,ra,va)}catch(Ha){if(pa.associatedLayer.loaded)throw Ha;}if(Ba){ka=I(ka,
ra,Ca);if(null==ka)throw new p("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ha=pa.parsedUrl.path;return(await Promise.all(ka.map(Ma=>N(Ha,Ba,Ma.node.resources.attributes,Ma.indices,va).then(Qa=>{for(let Sa=0;Sa<Ma.graphics.length;Sa++){const La=Ma.graphics[Sa],Ua=Qa[Sa];if(La.attributes)for(const Va in La.attributes)Va in Ua||(Ua[Va]=La.attributes[Va]);La.attributes=Ua}return Ma.graphics})))).flat()}throw new p("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,y,p,u){function q(A,v){const B={byteOffset:0,byteCount:0,fields:Object.create(null)};let C=0;for(let E=0;E<v.length;E++){const F=v[E],M=F.valueType||F.type;B.fields[F.property]=(0,D[M])(A,C);C+=x[M].BYTES_PER_ELEMENT}B.byteCount=
C;return B}function k(A,v,B){return d(A,v,B).map(C=>(C=C?Date.parse(C):null)&&!Number.isNaN(C)?C:null)}function d(A,v,B){const C=[];let E,F=0,M;for(M=0;M<A;M+=1){E=v[M];if(0<E){var K=C,G=K.push,L=B,O=F,I=E-1;let J="",N=0;for(;N<I;){var H=L[O+N];if(128>H)J+=String.fromCharCode(H),N++;else if(192<=H&&224>H){if(N+1>=I)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");J+=String.fromCharCode((H&31)<<6|L[O+N+1]&63);N+=2}else if(224<=H&&240>H){if(N+2>=I)throw new b("utf8-decode-error",
"UTF-8 Decode failed. Multi byte character was truncated.");J+=String.fromCharCode((H&15)<<12|(L[O+N+1]&63)<<6|L[O+N+2]&63);N+=3}else if(240<=H&&248>H){if(N+3>=I)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");H=(H&7)<<18|(L[O+N+1]&63)<<12|(L[O+N+2]&63)<<6|L[O+N+3]&63;J=65536<=H?J+String.fromCharCode((H-65536>>10)+55296,(H&1023)+56320):J+String.fromCharCode(H);N+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");
}G.call(K,J);if(0!==B[F+E-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else C.push(null);F+=E}return C}function f(A,v){return new x[v.valueType](A,v.byteOffset,v.count*v.valuesPerElement)}function g(A,v){return new Uint8Array(A,v.byteOffset,v.byteCount)}function e(A,v,B){A=null!=v.header?q(A,v.header):{byteOffset:0,byteCount:0,fields:{count:B}};B={header:A,byteOffset:A.byteCount,byteCount:0,entries:Object.create(null)};let C=A.byteCount;for(let E=0;E<v.ordering.length;E++){const F=
v.ordering[E],M=c.clone(v[F]);M.count=A.fields.count??0;if("String"===M.valueType){M.byteOffset=C;M.byteCount=A.fields[F+"ByteCount"];if("UTF-8"!==M.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:M.encoding});if(M.timeEncoding&&"ECMA_ISO8601"!==M.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:M.timeEncoding});}else if(m(M.valueType)){const K=t(M.valueType);C+=0!==C%K?K-C%K:0;M.byteOffset=C;M.byteCount=K*M.valuesPerElement*
M.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:M.valueType});C+=M.byteCount??0;B.entries[F]=M}B.byteCount=C-B.byteOffset;return B}function h(A,v,B){v!==A&&w.error(`Invalid ${B} buffer size\n expected: ${A}, actual: ${v})`);if(v<A)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:A,actualSize:v});}function z(A){return{isDraco:!1,isLegacy:!1,color:null!=A.color,normal:null!=A.normal,uv0:null!=A.uv0,uvRegion:null!=A.uvRegion,featureIndex:null!=
A.faceRange&&null!=A.featureId}}function n(A){const v={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of A.ordering)if(A.vertexAttributes[B])switch(B){case "normal":v.normal=!0;break;case "color":v.color=!0;break;case "uv0":v.uv0=!0;break;case "region":v.uvRegion=!0}A.featureAttributes&&A.featureAttributeOrder&&(v.featureIndex=!0);return v}function l(A){const v={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of A)switch(B){case "normal":v.normal=
!0;break;case "uv0":v.uv0=!0;break;case "color":v.color=!0;break;case "uv-region":v.uvRegion=!0;break;case "feature-index":v.featureIndex=!0}return v}function m(A){return x.hasOwnProperty(A)}function t(A){return m(A)?x[A].BYTES_PER_ELEMENT:0}const w=y.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),r={position:u.VertexAttribute.POSITION,normal:u.VertexAttribute.NORMAL,color:u.VertexAttribute.COLOR,uv0:u.VertexAttribute.UV0,region:u.VertexAttribute.UVREGION},x={Float32:Float32Array,Float64:Float64Array,
UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},D={Float32:(A,v)=>(new DataView(A,0)).getFloat32(v,!0),Float64:(A,v)=>(new DataView(A,0)).getFloat64(v,!0),UInt8:(A,v)=>(new DataView(A,0)).getUint8(v),Int8:(A,v)=>(new DataView(A,0)).getInt8(v),UInt16:(A,v)=>(new DataView(A,0)).getUint16(v,!0),Int16:(A,v)=>(new DataView(A,0)).getInt16(v,!0),UInt32:(A,v)=>(new DataView(A,0)).getUint32(v,!0),Int32:(A,v)=>(new DataView(A,0)).getInt32(v,!0)};a.createAttributeDataIndex=
e;a.createGeometryDescriptor=function(A,v){return A&&A.compressedAttributes&&"draco"===A.compressedAttributes.encoding?l(A.compressedAttributes.attributes):A?z(A):n(v)};a.createGeometryDescriptorForDraco=l;a.createGeometryDescriptorFromDefinition=z;a.createGeometryDescriptorFromSchema=n;a.createGeometryIndexFromSchema=function(A,v){var B=q(A,v&&v.header);let C=B.byteCount;const E={isDraco:!1,header:B,byteOffset:B.byteCount,byteCount:0,vertexAttributes:{}};B=B.fields;var F=null!=B.vertexCount?B.vertexCount:
B.count;for(var M of v.ordering){if(!v.vertexAttributes[M])continue;const G={...v.vertexAttributes[M],byteOffset:C,count:F};E.vertexAttributes[r[M]||"_"+M]=G;C+=t(G.valueType)*G.valuesPerElement*F}M=B.faceCount;if(v.faces&&M){E.faces={};for(var K of v.ordering)v.faces[K]&&(F={...v.faces[K],byteOffset:C,count:M},E.faces[K]=F,C+=t(F.valueType)*F.valuesPerElement*M)}K=B.featureCount;if(v.featureAttributes&&v.featureAttributeOrder&&K){E.featureAttributes={};for(const G of v.featureAttributeOrder)v.featureAttributes[G]&&
(B={...v.featureAttributes[G],byteOffset:C,count:K},E.featureAttributes[G]=B,M="UInt64"===B.valueType?8:t(B.valueType),C+=M*B.valuesPerElement*K)}h(C,A.byteLength,"geometry");E.byteCount=C-E.byteOffset;return E};a.createRawView=g;a.createTypedView=f;a.getBytesPerValue=t;a.isValueType=m;a.readBinaryAttribute=function(A,v,B){if("lepcc-rgb"===A.encoding)return p.decodeRGB(v);if("lepcc-intensity"===A.encoding)return p.decodeIntensity(v);if(null!=A.encoding&&""!==A.encoding)throw new b("unknown-attribute-storage-info-encoding",
"Unknown Attribute Storage Info Encoding");A["attributeByteCounts "]&&!A.attributeByteCounts&&(w.warn("Warning: Trailing space in 'attributeByteCounts '."),A.attributeByteCounts=A["attributeByteCounts "]);"ObjectIds"===A.ordering[0]&&A.hasOwnProperty("objectIds")&&(w.warn("Warning: Case error in objectIds"),A.ordering[0]="objectIds");B=e(v,A,B);h(B.byteOffset+B.byteCount,v.byteLength,"attribute");if(A=B.entries.attributeValues||B.entries.objectIds){if("String"===A.valueType){B=B.entries.attributeByteCounts;
const C=f(v,B);v=g(v,A);return A.timeEncoding?k(B.count,C,v):d(B.count,C,v)}return f(v,A)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=k;a.readHeader=q;a.readStringArray=d;a.valueType2ArrayBufferReader=D;a.valueType2TypedArrayClassMap=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function c(q,k,d){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(q,d+u.identifierOffset,u.identifierLength)),version:k.getUint16(d+u.versionOffset,!0),checksum:k.getUint32(d+u.checksumOffset,!0)}}function y(q,k,d){const f=[];k=p(q,k,f);const g=[];for(let e=0;e<f.length;e++){g.length=0;k=p(q,k,g);for(let h=0;h<g.length;h++)d.push(g[h]+f[e])}return k}function p(q,k,d){var f=new DataView(q,k),g=f.getUint8(0);const e=g&31;var h=!!(g&32),z=(g&192)>>6;g=0;if(0===z)g=f.getUint32(1,!0),k+=5;else if(1===z)g=f.getUint16(1,!0),k+=3;else if(2===z)g=f.getUint8(1),
k+=2;else throw new b("lepcc-decode-error","Bad count type");if(h)throw new b("lepcc-decode-error","LUT not implemented");q=new Uint8Array(q,k,Math.ceil(g*e/8));z=h=f=0;const n=-1>>>32-e;for(let l=0;l<g;l++){for(;h<e;)f|=q[z]<<h,h+=8,z+=1;d[l]=f&n;f>>>=e;h-=e;32<h+e&&(f|=q[z-1]>>8-h)}return k+z}const u={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(q){const k=new DataView(q,0);var d=0;const {identifier:f,version:g}=c(q,k,d);d+=u.byteCount;
if("Intensity "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<g)throw new b("lepcc-decode-error","Unknown version");var e=d;var h=k.getUint32(e+0,!0);var z=k.getUint32(e+4,!0);var n=k.getUint32(e+8,!0);var l=k.getUint16(e+12,!0);var m=k.getUint8(e+14);k.getUint8(e+15);d+=16;if(z*2**32+h!==q.byteLength)throw new b("lepcc-decode-error","Bad size");h=new Uint16Array(n);if(8===m){if(n+d!==q.byteLength)throw new b("lepcc-decode-error","Bad size");q=new Uint8Array(q,d,n);for(d=0;d<n;d++)h[d]=
q[d]*l}else if(16===m){if(2*n+d!==q.byteLength)throw new b("lepcc-decode-error","Bad size");q=new Uint16Array(q,d,n);for(d=0;d<n;d++)h[d]=q[d]*l}else{m=[];if(p(q,d,m)!==q.byteLength)throw new b("lepcc-decode-error","Bad size");for(q=0;q<n;q++)h[q]=m[q]*l}return h};a.decodeRGB=function(q){var k=new DataView(q,0),d=0;const {identifier:f,version:g}=c(q,k,d);d+=u.byteCount;if("ClusterRGB"!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<g)throw new b("lepcc-decode-error","Unknown version");
var e=d;var h=k.getUint32(e+0,!0);var z=k.getUint32(e+4,!0);var n=k.getUint32(e+8,!0);var l=k.getUint16(e+12,!0);var m=k.getUint8(e+14);e=k.getUint8(e+15);d+=16;if(z*2**32+h!==q.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===m||1===m)&&0===e){if(3*l+n+d!==q.byteLength||256<l)throw new b("lepcc-decode-error","Bad count");k=new Uint8Array(q,d,3*l);d=new Uint8Array(q,d+3*l,n);q=new Uint8Array(3*n);for(l=0;l<n;l++)h=d[l],q[3*l]=k[3*h],q[3*l+1]=k[3*h+1],q[3*l+2]=k[3*h+2];return q}if(0===
m&&0===e){if(3*n+d!==q.byteLength||0!==l)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(q,d)).slice()}if(2>=m&&1===e){if(d+3!==q.byteLength||1!==l)throw new b("lepcc-decode-error","Bad count");q=k.getUint8(d);l=k.getUint8(d+1);d=k.getUint8(d+2);k=new Uint8Array(3*n);for(h=0;h<n;h++)k[3*h]=q,k[3*h+1]=l,k[3*h+2]=d;return k}throw new b("lepcc-decode-error","Bad method "+m+","+e);};a.decodeXYZ=function(q){var k=new DataView(q,0),d=0;const {identifier:f,version:g}=c(q,k,d);d+=u.byteCount;
if("LEPCC     "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<g)throw new b("lepcc-decode-error","Unknown version");var e=d;var h=k.getUint32(e+0,!0);var z=k.getUint32(e+4,!0);var n=k.getFloat64(e+8,!0);var l=k.getFloat64(e+16,!0);var m=k.getFloat64(e+24,!0);var t=k.getFloat64(e+32,!0);var w=k.getFloat64(e+40,!0);var r=k.getFloat64(e+48,!0);var x=k.getFloat64(e+56,!0);var D=k.getFloat64(e+64,!0);var A=k.getFloat64(e+72,!0);var v=k.getUint32(e+80,!0);k.getUint32(e+84,!0);d+=88;if(z*2**
32+h!==q.byteLength)throw new b("lepcc-decode-error","Bad size");h=new Float64Array(3*v);z=[];v=[];k=[];e=[];d=y(q,d,z);d=y(q,d,v);d=y(q,d,k);d=y(q,d,e);if(d!==q.byteLength)throw new b("lepcc-decode-error","Bad length");d=q=0;for(let B=0;B<z.length;B++){d+=z[B];let C=0;for(let E=0;E<v[B];E++){C+=k[q];const F=e[q];h[3*q]=Math.min(t,n+2*x*C);h[3*q+1]=Math.min(w,l+2*D*d);h[3*q+2]=Math.min(r,m+2*A*F);q++}}return{errorX:x,errorY:D,errorZ:A,result:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection"],function(a,b,c,y,p){function u(q,k,d){const f=c.create(),g=2**(4*Math.ceil(Math.log(q[3])*Math.LOG2E/4)+1);if(d.isGeographic){var e=g/y.getReferenceEllipsoid(d).radius*180/Math.PI;d=Math.max(-90,Math.min(90,Math.round(q[1]/e)*e));e/=Math.cos((Math.abs(d)-e/2)/180*Math.PI);f[0]=Math.round(q[0]/e)*
e;f[1]=d}else d=Math.round(q[1]/g),f[0]=Math.round(q[0]/g)*g,f[1]=d*g;f[2]=Math.round((q[2]+k)/g)*g;return f}a.computeGlobalTransformation=function(q,k,d,f){q=u(q,k,d);k=b.create();p.computeTranslationToOriginAndRotation(d,q,k,f);return k};a.getLocalOrigin=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(a,b){function c(y,p){return y.popupTemplate?y.popupTemplate:null!=
p&&p.defaultPopupTemplateEnabled&&null!=y.defaultPopupTemplate?y.defaultPopupTemplate:null}a.getFetchPopupTemplate=c;a.getRequiredFields=async function(y,p=y.popupTemplate){if(null==p)return[];const u=await p.getRequiredFields(y.fieldsIndex);({lastEditInfoEnabled:p}=p);const {objectIdField:q,typeIdField:k,globalIdField:d,relationships:f}=y;if(u.includes("*"))return["*"];p=p?await b.getFeatureEditFields(y):[];const g=b.fixFields(y.fieldsIndex,[...u,...p]);k&&g.push(k);g&&q&&y.fieldsIndex?.has(q)&&
!g.includes(q)&&g.push(q);g&&d&&y.fieldsIndex?.has(d)&&!g.includes(d)&&g.push(d);f&&f.forEach(e=>{({keyField:e}=e);g&&e&&y.fieldsIndex?.has(e)&&!g.includes(e)&&g.push(e)});return g};a.hasPopupTemplate=function(y,p){return null!=c(y,{defaultPopupTemplateEnabled:p})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){p=function(e){function h(){var z=e.apply(this,arguments)||this;z.type="elevation-3d";return z}a._inherits(h,e);h.prototype.initialize=function(){var z=this.view?.map?.allLayers;z=z&&z.includes(this.layer);var n=this.view?.map?.ground?.layers;n=n&&n.includes(this.layer);z&&!n&&(z=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(z)));this._addTilingSchemeMatchPromise()};
a._createClass(h,[{key:"tileInfo",get:function(){return this.layer.tileInfo}}]);return h}(f.TiledLayerView3D(d.LayerView3D(g)));b.__decorate([y.property()],p.prototype,"layer",void 0);b.__decorate([y.property()],p.prototype,"tileInfo",null);return p=b.__decorate([k.subclass("esri.views.3d.layers.ElevationLayerView3D")],p)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.LayerView3D=h=>{h=function(z){function n(){var m=z.apply(this,arguments)||this;m.slicePlaneEnabled=!1;m.supportsHeightUnitConversion=!1;return m}b._inherits(n,z);var l=n.prototype;l.postscript=function(m){b._get(b._getPrototypeOf(n.prototype),"postscript",this).call(this,m);e.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};l._validateHeightModelInfo=async function(){const m=new AbortController;var t=m.signal;this.handles.add(y.makeHandle(()=>
m.abort()));await u.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,t);p.throwIfAborted(t);if(t=e.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw t;};l.canResume=function(){const m=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return b._get(b._getPrototypeOf(n.prototype),"canResume",this).call(this)&&(!m||!m.minScale||!m.maxScale||m.minScale>=m.maxScale)};l.getSuspendInfo=function(){const m=b._get(b._getPrototypeOf(n.prototype),
"getSuspendInfo",this).call(this),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(m.outsideScaleRange=!0);return m};return b._createClass(n)}(h);c.__decorate([q.property()],h.prototype,"view",void 0);c.__decorate([q.property()],h.prototype,"slicePlaneEnabled",void 0);return h=c.__decorate([g.subclass("esri.views.3d.layers.LayerView3D")],h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){a.TiledLayerView3D=h=>{h=function(z){function n(){return z.apply(this,arguments)||this}b._inherits(n,z);var l=n.prototype;l.getTileUrl=function(m,t,w){return this.layer.getTileUrl(m,t,w)};l._addTilingSchemeMatchPromise=function(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new y("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var m=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(null!=m)return this.addResolvingPromise(Promise.reject(m));
m=p.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const t=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(t)throw t;});this.addResolvingPromise(m)};l._getTileInfoSupportError=function(m,t){if(m=e.checkIfTileInfoSupportedForView(m,t,this.view.spatialReference,this.view.state.viewingMode)){t={layer:this.layer,error:m};switch(m.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":m=
new y("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",t);break;default:m=new y("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",t)}return m}return null};l._getTileInfoCompatibilityError=function(m,t){return null!=m&&t.compatibleWith(m)?null:new y("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};
l.levelRangeFromScaleRange=function(m,t){const w={minLevel:0,maxLevel:Infinity};var r=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!r)return w;const x=r.levels[0];r=D=>{D=Math.log(x.scale/D)/Math.LN2;return 1E-9>.5-Math.abs(.5-D%1)?Math.round(D):Math.ceil(D)};null!=m&&0<m&&(w.minLevel=Math.max(0,r(m)));null!=t&&0<t&&(w.maxLevel=Math.max(0,r(t)));return w};l.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};b._createClass(n,
[{key:"imageFormatIsOpaque",get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataScaleRange",get:function(){var m=this.tileInfo.lods;let t=m[0].scale;m=m[m.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:w,effectiveMaxLOD:r}=this.layer.tilemapCache;t=this.tileInfo.lodAt(w).scale;m=this.tileInfo.lodAt(r).scale}return{minScale:t,
maxScale:m}}},{key:"dataLevelRange",get:function(){const {minScale:m,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(m,t)}},{key:"displayLevelRange",get:function(){const m=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&m.maxLevel++;return m}}]);return n}(h);c.__decorate([u.property({readOnly:!0})],h.prototype,"imageFormatIsOpaque",null);c.__decorate([u.property({readOnly:!0})],
h.prototype,"updating",void 0);c.__decorate([u.property(g.updatingProgress)],h.prototype,"updatingProgress",void 0);c.__decorate([u.property(g.updatingProgressValue)],h.prototype,"updatingProgressValue",void 0);c.__decorate([u.property()],h.prototype,"fullExtent",null);c.__decorate([u.property({readOnly:!0})],h.prototype,"isOpaque",null);c.__decorate([u.property()],h.prototype,"dataScaleRange",null);c.__decorate([u.property({readOnly:!0})],h.prototype,"dataLevelRange",null);c.__decorate([u.property({readOnly:!0})],
h.prototype,"displayLevelRange",null);c.__decorate([u.property()],h.prototype,"layer",void 0);c.__decorate([u.property()],h.prototype,"tileInfo",void 0);return h=c.__decorate([f.subclass("esri.views.3d.layers.TiledLayerView3D")],h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){p=function(h){function z(){var n=h.apply(this,arguments)||this;n.type="feature-3d";n.direct3DObjectFeatureLayerDisplayEnabled=g.direct3DObjectFeatureLayerDisplayEnabled();return n}a._inherits(z,h);z.prototype.initialize=function(){const {layer:n,view:l}=this;f.getEffectiveLayerCapabilities(n)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new c("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:n})));
null!=n.infoFor3D&&(this.direct3DObjectFeatureLayerDisplayEnabled?this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new c("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${n.geometryType}`))));"mesh"!==n.geometryType||d.canProjectWithoutEngine(n.spatialReference,l.spatialReference)||this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))};
a._createClass(z,[{key:"featureSpatialReference",get:function(){return this.view.featureTiles?.tilingScheme?.spatialReference}}]);return z}(e);b.__decorate([y.property({constructOnly:!0})],p.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);b.__decorate([y.property()],p.prototype,"layer",void 0);return p=b.__decorate([k.subclass("esri.views.3d.layers.FeatureLayerView3D")],p)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x){q=function(A){function v(C){C=A.call(this,C)||this;C._controllerTotal=0;C._processorTotal=0;C.suspendResumeExtentMode="data";return C}a._inherits(v,A);var B=v.prototype;B.initialize=function(){this.handles.add(p.watch(()=>this._updatingRequiredFieldsPromise,C=>this.updatingHandles.addPromise(C),p.syncAndInitial))};B.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._fetcherContext=y.destroyMaybe(this._fetcherContext)};
B.setVisibility=function(C,E){this.processor?.setObjectIdVisibility(C,E)};B.createQuery=function(){return a._get(a._getPrototypeOf(v.prototype),"createQuery",this).call(this)};B.queryFeatures=function(C,E){const F=()=>a._get(a._getPrototypeOf(v.prototype),"queryFeatures",this).call(this,C,E);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(C),F):F()};B.beforeSetController=function(C){C.maximumNumberOfFeatures=this.maximumNumberOfFeatures};B.createController=function(){this._fetcherContext=
new n.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const C=new e.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new l.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>C.serviceDataExtent,E=>{this.processor&&(this.processor.dataExtent=E)},p.initial);this.handles.add(p.watch(()=>this.suspended,E=>{E?C.suspend():C.resume()},p.syncAndInitial));this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,
E=>C.displayFeatureLimit=E,p.initial);this.handles.add(p.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return C};B.doRefresh=async function(C){C&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()};B._queryFeaturesMesh=async function(C,E){await this._validateQueryFeaturesMesh(C);E=await E();if(C&&C.outStatistics||null==this.graphics3DProcessor)return E;C=this.layer.objectIdField;const F=this.graphics3DProcessor.graphics3DGraphicsByObjectID,
M=[];for(const K of E.features)if(K.geometry){const G=F.get(K.attributes[C]);G&&(K.geometry=g.hydrateGeometry(G.graphic.geometry),M.push(K))}else M.push(K);E.features=M;return E};B._validateQueryFeaturesMesh=async function(C){if(C){var E=M=>{throw new c("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${M}'`);},F=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const M of F)null!=C[M]&&E(M);"returnM"in C&&C.returnM&&E("returnM");
"returnCentroid"in C&&C.returnCentroid&&E("returnCentroid");null==C.outSpatialReference||C.outSpatialReference.equals(this.view.spatialReference)||E("outSpatialReference")}};a._createClass(v,[{key:"maximumNumberOfFeatures",get:function(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")},set:function(C){this._set("maximumNumberOfFeatures",C);this.controller&&(this.controller.maximumNumberOfFeatures=C)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?
!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"updatingProgressValue",get:function(){let C=0;if(this.controller?.updating){var E=this.controller.updatingRemaining,F=Math.max(this.controller.updatingTotal,this._controllerTotal);0<F&&(C=(F-E)/F,this._controllerTotal=F)}E=0;if(this.processor?.updating){F=this.processor.updatingRemaining;const M=Math.max(F,this._processorTotal);0<M&&(E=(M-F)/M,this._processorTotal=M)}return.5*(C+E)}},{key:"updatePolicy",get:function(){if(!this.controller)return t.UpdatePolicy.ASYNC;
switch(this.controller.mode){case "snapshot":const C=D.get(this.layer.geometryType);return null==C||this.controller.serviceDataCount>C?t.UpdatePolicy.ASYNC:t.UpdatePolicy.SYNC;case "tiles":return t.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const C=this.layer,E=C.capabilities&&C.capabilities.data;return E&&E.supportsZ?"returnZ"in C&&null!=C.returnZ?C.returnZ:E.supportsZ:!1}},{key:"hasM",get:function(){const C=this.layer,E=C.capabilities&&C.capabilities.data;return E&&E.supportsM?"returnM"in
C&&null!=C.returnM?C.returnM:!1:!1}},{key:"usedMemory",get:function(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}},{key:"unloadedMemory",get:function(){const C=this.controller?.expectedFeatureDiff??0,E=this.processor?.loadedFeatures??0;return(this.processor?.unprocessedMemoryEstimate??0)+E/(E+C)*(this.processor?.usedMemoryPerFeature??0)*C}},{key:"ignoresMemoryFactor",get:function(){return this.controller?.hasMaximumNumberOfFeaturesOverride}},{key:"performanceInfo",
get:function(){var C=this.controller?.displayFeatureLimit;C=null!=C?C.averageSymbolComplexity:void 0;C=null!=C?`f:${C.primitivesPerFeature},v:${C.primitivesPerCoordinate}`:"n/a";return{...this._getResourceInfo(),partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?.mode??"n/a",symbolComplexity:C,nodes:this.controller?.tileDescriptors.length??0,...(this.controller?.debug??{storedFeatures:0,totalVertices:0})}}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller,
loadedGraphics:this.controller?.graphics}}}]);return v}(x(h.FeatureLikeLayerView3D(w(z.LayerView3D(r)))));b.__decorate([u.property()],q.prototype,"layer",void 0);b.__decorate([u.property()],q.prototype,"controller",void 0);b.__decorate([u.property()],q.prototype,"_controllerTotal",void 0);b.__decorate([u.property()],q.prototype,"_processorTotal",void 0);b.__decorate([u.property()],q.prototype,"maximumNumberOfFeatures",null);b.__decorate([u.property()],q.prototype,"maximumNumberOfFeaturesExceeded",
null);b.__decorate([u.property(m.updatingProgress)],q.prototype,"updatingProgress",void 0);b.__decorate([u.property({readOnly:!0})],q.prototype,"updatingProgressValue",null);b.__decorate([u.property({readOnly:!0})],q.prototype,"updatePolicy",null);b.__decorate([u.property({readOnly:!0})],q.prototype,"hasZ",null);b.__decorate([u.property({readOnly:!0})],q.prototype,"hasM",null);b.__decorate([u.property()],q.prototype,"suspendResumeExtentMode",void 0);q=b.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],
q);const D=new Map([["point",5E3],["polygon",500],["polyline",1E3]]);return q})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){function E(F,M){if(!M)return!1;for(const K of M)if(!F.has(K))return!0;return!1}a.FeatureTileController3D=function(F){function M(G){G=F.call(this,G)||this;G.type="feature-tile-3d";G._watchUpdatingTracking=new w.WatchUpdatingTracking;G.serviceDataExtent=null;G.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;G.vertexLimitExceeded=!1;G.displayFeatureLimit=null;G._suspended=!1;G._tileFetcher=null;G._handles=new d;G._fetchDataInfoPromise=
null;G._fetchDataInfoAbortController=null;G._lifeCycleAbortController=new AbortController;return G}b._inherits(M,F);var K=M.prototype;K._approximateExtentSizeAtScale=function(G,L){const O=this.layerView.view,I=L.levels[0];return(I.tileSize[0]/(I.scale/G)+I.tileSize[1]/(I.scale/G))/2*Math.ceil((O.width/L.pixelSize+O.height/L.pixelSize)/2)};K.initialize=function(){this._watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,
this._lifeCycleAbortController.signal)));this._watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),n.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};K._verifyCapabilities=function(){const G=this.layerView.layer;if("ogc-feature"!==G.type&&!x.getEffectiveLayerCapabilities(G)?.operations.supportsQuery)throw new k("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:G});};K.destroy=function(){this._cancelFetchServiceDataInfo();this._tileFetcher=e.destroyMaybe(this._tileFetcher);this._handles=e.destroyMaybe(this._handles);this._tilesHandle=e.removeMaybe(this._tilesHandle);this._lifeCycleAbortController=e.abortMaybe(this._lifeCycleAbortController);this._watchUpdatingTracking.destroy();this._set("_watchUpdatingTracking",null)};K.suspend=function(){this._suspended||(this._suspended=!0,null!=
this._tileFetcher&&this._tileFetcher.suspend())};K.resume=function(){this._suspended&&(this._suspended=!1,null!=this._tileFetcher&&this._tileFetcher.resume())};K.restart=function(){const G=()=>{null!=this._tileFetcher&&this._tileFetcher.restart()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(G,G))};K.refetch=function(){const G=()=>{null!=this._tileFetcher&&this._tileFetcher.refetch()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(G,G))};K._initializeTileFetcher=
function(){const G=this.layerView.view;if(G){var L=n.whenOnce(()=>G.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._watchUpdatingTracking.addPromise(L);L.then(()=>{const {layerView:O,tileDescriptors:I}=this,H=O.layer,J=new v.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:I,features:this.graphics});this._tileFetcher=J;this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const N=this.layerView.view.resourceController;N&&
this._handles.add(n.watch(()=>N.memoryController?.memoryFactor,W=>J.memoryFactor=W,n.syncAndInitial));const R="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;R&&this._handles.add(n.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[R],W=>J.lodFactor=W||1,n.initial));"ogc-feature"!==H.type&&this._watchUpdatingTracking.add(()=>H.createQueryVersion,()=>this._dataFilterChanged());this._watchUpdatingTracking.add(()=>O.availableFields,
(W,T)=>this._availableFieldsChanged(T,W));this._watchUpdatingTracking.add(()=>O.requiredFields,(W,T)=>this._requiredFieldsChanged(T,W));this._handles.add([H.on("apply-edits",W=>this._applyEdits(W)),n.watch(()=>this.extent,W=>J.filterExtent=W,n.sync),n.watch(()=>this.tileDescriptors,W=>J.tileDescriptors=W,n.sync),n.watch(()=>this.maximumNumberOfFeatures,W=>{J.maximumNumberOfFeatures=W;J.useTileCount=this.serviceDataCount>W},n.syncAndInitial),n.watch(()=>this.serviceDataCount,W=>J.useTileCount=W>this.maximumNumberOfFeatures,
n.syncAndInitial),n.watch(()=>C.FEATURE_TILE_FETCH_SHOW_TILES,W=>{W&&J&&!J.debugger?(J.debugger=new B.FeatureTileFetcher3DDebugger(J,G.featureTiles.tilingScheme.toTileInfo(),G),J.debugger.update()):!W&&this._tileFetcher&&J.debugger&&(J.debugger.destroy(),J.debugger=null)},n.syncAndInitial)]);this._supportsExceedsLimitQuery||this._watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal)))}).catch(()=>
{})}};K._modeChanged=function(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:g.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case "snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),this._tilesHandle=null)}};K._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};K._applyEdits=function(G){null!=this._tileFetcher&&
this._tileFetcher.applyEdits(G).then(L=>{if(L){if(!this._lifeCycleAbortController)throw z.createAbortError();L.exceededTransferLimit?this.layerView.layer.refresh():(L.deletedFeatures.length||L.updatedFeatures.length||L.addedFeatures.length)&&this._watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(L=>{if(!z.isAbortError(L))throw L;})};K._availableFieldsChanged=function(G,L){null!=this._tileFetcher&&E(this._tileFetcher.availableFields,L)&&
this.refetch()};K._requiredFieldsChanged=function(G,L){null!=this._tileFetcher&&E(this._tileFetcher.availableFields,L)&&this.restart()};K._createVertexLimitExceededQuery=function(G){const L=this.layerView.layer,O=L.createQuery();O.returnGeometry=!1;O.outStatistics=[new A({statisticType:"exceedslimit",maxVertexCount:G,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];L.capabilities?.query.supportsCacheHint&&(O.cacheHint=!0);return O};K._createDataInfoQuery=function(){const G=
this.layerView.layer,L=G.createQuery();L.returnGeometry=!1;L.outSpatialReference=this.layerView.view.spatialReference;G.capabilities?.query.supportsCacheHint&&(L.cacheHint=!0);return L};K._fullExtentIsAccurate=function(){const G=this.layerView.layer;if(G.definitionExpression)return!1;switch(G.type){case "feature":case "oriented-imagery":return r.isHostedAgolService(G.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};K._updateServiceDataExtent=async function(G){try{await this._tryUpdateServiceDataExtent(G)}catch(L){z.isAbortError(L)||
this._set("serviceDataExtent",f.clone(this.layerView.fullExtentInLocalViewSpatialReference))}};K._tryUpdateServiceDataExtent=async function(G){var L=this.layerView;const O=L.layer,I=O.capabilities?.query.supportsExtent??!1,H=f.clone(L.fullExtentInLocalViewSpatialReference),J=O.fullExtent,N=this._fullExtentIsAccurate(),R=this.serviceDataCount;I&&R<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!H||!N)&&"queryExtent"in O?(L=this._createDataInfoQuery(),G=await O.queryExtent(L,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,
signal:G}),this._set("serviceDataExtent",G.extent)):H?this._set("serviceDataExtent",H):null!=J?(G=await D.projectGeometry(J,L.view.spatialReference,"portalItem"in O?O.portalItem:null,G),this._set("serviceDataExtent",G)):this._set("serviceDataExtent",null)};K._updateServiceDataCount=async function(G){const L=this.layerView.layer;if("queryFeatureCount"in L&&q("featurelayer-snapshot-enabled"))if(G=await p.result(L.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,
signal:G})),!0===G.ok)this._set("serviceDataCount",G.value);else{if(z.isAbortError(G.error))throw G.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)};K._updateVertexLimitExceeded=async function(G,L){var O=this.vertexLimitInfo;if(null==O)this._set("vertexLimitExceeded",!1);else{var I=1<this._minimumNumberOfVerticesForGeometry;if(0>=O.primitivesPerFeature||I){var {primitivesPerFeature:H,
primitivesPerCoordinate:J,maximumTotalNumberOfPrimitives:N}=O;0!==H&&null!=G&&await G;O=this.serviceDataCount;var R=O!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;G=R?Math.ceil((N-O*H)/(J||1)):Math.ceil(N/(J||1));I&&(G=Math.min(G,5E6));if(R&&this._minimumNumberOfVerticesForGeometry*O>G)this._set("vertexLimitExceeded",!0);else if(this._supportsExceedsLimitQuery&&q("featurelayer-snapshot-enabled"))if(L=await p.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(G),
{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:L})),!1===L.ok){if(z.isAbortError(L.error))throw L.error;this._set("vertexLimitExceeded",!1)}else(L=L.value.features[0])&&L.attributes?this._set("vertexLimitExceeded",!!L.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>G)}else this._set("vertexLimitExceeded",!1)}};K._fetchServiceDataInfo=async function(){this._cancelFetchServiceDataInfo();let G=
new AbortController;const L=G.signal;var O=this._updateServiceDataCount(L);O=z.eachAlways([O,this._updateVertexLimitExceeded(O,L)]);const I=O.then(()=>this._updateServiceDataExtent(L)).catch(H=>{z.isAbortError(H)||g.getLogger(this).error("#fetchServiceDataInfo()",H)}).then(()=>{I===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);G=null});G&&(this._fetchDataInfoPromise=I);this._fetchDataInfoAbortController=G;return O.then(()=>{},()=>{})};K._cancelFetchServiceDataInfo=
function(){const G=this._fetchDataInfoAbortController;G&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,G.abort())};b._createClass(M,[{key:"extent",set:function(G){if(null==G||G.spatialReference.equals(this.layerView.view.spatialReference)){var L=this._get("extent");L===G||null!=L&&G&&L.equals(G)||(G=null!=G?G.clone():null,this._set("extent",G))}else g.getLogger(this).error("#extent\x3d","extent needs to be in the same spatial reference as the view")}},{key:"updating",get:function(){return!!(null!=
this._tileFetcher&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._watchUpdatingTracking&&this._watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",
get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return null!=this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},
set:function(G){G!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",G)}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var G=this.layerView.layer;if("feature"===G.type&&null!=G.infoFor3D)return"snapshot";if(!1===this.layerView.view.qualitySettings?.graphics3D?.snapshotAvailable||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";
var L=this.layerView.view;L=(L=L&&L.featureTiles)&&L.tilingScheme;return G&&G.minScale&&this.serviceDataExtent&&L&&(G=this._approximateExtentSizeAtScale(G.minScale,L),(this.serviceDataExtent.width/G+this.serviceDataExtent.height/G)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const G=this._get("maxTotalSnapshotVertices")||
0;return Math.max(G,"snapshot"===this.mode&&null!=this._tileFetcher&&this._tileFetcher.totalVertices||0)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new u([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new u}},{key:"test",get:function(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(null==this.displayFeatureLimit||null==this.displayFeatureLimit.averageSymbolComplexity)return null;
const {averageSymbolComplexity:G,maximumTotalNumberOfPrimitives:L}=this.displayFeatureLimit,{primitivesPerCoordinate:O,primitivesPerFeature:I}=G,H=this._get("vertexLimitInfo");return null==H||H.maximumTotalNumberOfPrimitives!==L||H.primitivesPerCoordinate!==O||H.primitivesPerFeature!==I?{primitivesPerCoordinate:O,primitivesPerFeature:I,maximumTotalNumberOfPrimitives:L}:H}},{key:"_supportsExceedsLimitQuery",get:function(){const G=this.layerView.layer;return null!=G.capabilities&&G.capabilities.operations&&
G.capabilities.operations.supportsExceedsLimitStatistics}},{key:"_minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:null!=this._tileFetcher?this._tileFetcher.storedFeatures:0,totalFeatures:null!=this._tileFetcher?this._tileFetcher.totalFeatures:
0,totalVertices:null!=this._tileFetcher?this._tileFetcher.totalVertices:0,missingTiles:null!=this._tileFetcher?this._tileFetcher.missingTiles:0}}}]);return M}(h.EsriPromiseMixin(y));c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);c.__decorate([l.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);c.__decorate([l.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);c.__decorate([l.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"context",void 0);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"extent",null);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"updating",null);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_watchUpdatingTracking",void 0);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);c.__decorate([l.property()],
a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);c.__decorate([l.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"vertexLimitExceeded",void 0);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);c.__decorate([l.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);c.__decorate([l.property({readOnly:!0,
dependsOn:["mode"]})],a.FeatureTileController3D.prototype,"tileDescriptors",null);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);c.__decorate([l.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);c.__decorate([l.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=c.__decorate([t.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);
a.FeatureTileController3DConstants=void 0;(function(F){F.NO_SERVICE_DATA_COUNT=Infinity;F.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;F.reset=function(){F.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;F.QUERY_STATISTICS_TIMEOUT=12E3;F.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B){function C(I){return"dummy-tile-full-extent"===I.id}function E(I){let H=0;for(const J of I)J.features&&0<J.features.length&&J.alive&&(H=Math.max(H,J.descriptor.lij[0]));return H}function F(I){I.setFeatures([],0,null);I.featuresMissing=!1;return A.FetchStatus.DONE}function M(I){return null==I?new Set:new Set(I.map(H=>H.name))}function K(I,H){if(null==I||null==H)return M(H);const J=new Set;for(const {name:N}of H)I.has(N)&&J.add(N);return J}
const G=u.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(I){function H(N){N=I.call(this,N)||this;N._useTileCount=!1;N.updating=!1;N.running=!1;N.updatingTotal=0;N.updatingRemaining=0;N.expectedFeatureDiff=0;N.maximumNumberOfFeaturesExceeded=!1;N.maximumNumberOfFeaturesExceededThrottle=1E3;N._fullRatio=1;N._farRatio=1;N._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};N._handles=new p;N._frameTask=B.ImmediateTask;N._dirty=!1;N._featureTiles=
new Map;N._displayingFeatureReferences=new Map;N._numDisplayingFeatureReferences=0;N._suspended=!0;N._pendingEdits=null;return N}b._inherits(H,I);var J=H.prototype;J.initialize=function(){this._handles.add(f.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?D.MultiFeatureReference:D.SingleFeatureReference;const N=this.context.scheduler;
null!=N&&(this._frameTask=N.registerTask(B.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};J.destroy=function(){this._frameTask.remove();this._handles=k.destroyMaybe(this._handles);this._featureTiles.forEach(N=>{this._cancelFetchTile(N);this._removeTile(N)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();this._pendingEdits=null};J.restart=function(){this._featureTiles.forEach(N=>{this._cancelFetchTile(N);this._clearTile(N);this._resetFetchTile(N)});
null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()};J.refetch=function(){this._featureTiles.forEach(N=>{this._cancelFetchTile(N);this._resetFetchTile(N)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()};J.suspend=function(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())};J.resume=function(){this._suspended&&(this._suspended=!1,this._unpause())};J._pause=function(){this._paused&&(this._featureTiles.forEach(N=>this._cancelFetchTile(N)),
this._updated())};J._unpause=function(){this._paused||(this._setDirty(),this._updated())};J.applyEdits=function(N){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const R=this._pendingEdits;R.count++;const W=R.edits.then(()=>N.result.catch(T=>{if(d.isAbortError(T))throw T;return null}).then(T=>{if(!T)return T;this._applyEditsDeleteFeatures(T.deletedFeatures);return this._applyEditsAddUpdateFeatures(T.addedFeatures,T.updatedFeatures,
R.controller.signal).then(()=>T)}).then(T=>{0===--R.count&&(this._pendingEdits===R&&(this._pendingEdits=null),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._unpause(),this._updated());return T}));R.edits=W;this._updated();return W};J._applyEditsDeleteFeatures=function(N){if(0!==N.length){var R=this.context.globalIdField,W=R&&this.availableFields.has(R),T=new Set,P=this._objectIdField;N.forEach(({objectId:Q,globalId:S})=>{(!Q||0>Q)&&R?(W||G.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${R} to be included the layer's outFields for updates to be reflected in the view`),
(Q=this.features.find(U=>U.attributes&&U.attributes[R]===S))&&T.add(t.getObjectId(Q,P))):T.add(Q)});this._featureTiles.forEach(Q=>{if(Q.features){var S=Q.features.filter(U=>!T.has(t.getObjectId(U,this._objectIdField)));S.length!==Q.features.length&&(Q.setFeatures(S,0,Q.availableFields),this._invalidateCounts())}})}};J._applyEditsAddUpdateFeatures=async function(N,R,W){const T=[],P=new Set;N.forEach(S=>T.push(S.objectId));R.forEach(S=>{T.push(S.objectId);P.add(S.objectId)});if(0!==T.length){var Q=
[];this._featureTiles.forEach(S=>{(S=this._applyEditsAddUpdateTile(S,T,P,W))&&Q.push(S)});await d.eachAlways(Q)}};J._applyEditsAddUpdateTile=async function(N,R,W,T){if(N.features){var P=this._createQuery(N);P.resultType=void 0;P.cacheHint=!1;P.objectIds=R;R=await this._queryFeatures(P,T);T=null;0<W.size&&(P=N.features.filter(Q=>!W.has(t.getObjectId(Q,this._objectIdField))),P.length!==N.features.length&&(T=P));if(0<R.features.length){T||(T=N.features.slice());for(const Q of R.features)T.push(Q)}T&&
(N.hasPreciseFeatureCount&&(N.numFeatures=Math.max(N.numFeatures,T.length)),N.setFeatures(T,0,K(N.availableFields,R.fields)),this._invalidateCounts())}};J._queryFeatures=function(N,R){return this.context.query.queryFeaturesDehydrated(N,{signal:R,timeout:6E5})};J._setDirty=function(){this._dirty=!0;this._updated()};J.runTask=function(N){this._frameTask.processQueue(N);if(this._dirty&&this.initialized){this._dirty=!1;var R=this._getListOfTiles();this._markTilesNotAlive(R);if(N.run(()=>this._addTiles(R,
N))&&N.run(()=>this._filterExtentTiles(R,N))&&N.run(()=>this._removeTiles(R,N))&&!N.done){var W=this._sortTiles(R);N.run(()=>this._showTiles(W,N))&&N.run(()=>this._fetchTiles(W,N))&&N.run(()=>this._updateMemoryEstimates(W,N))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};J._markTilesNotAlive=function(N){for(const R of N)R.alive=!1};J._addTiles=function(N,R){if(this._suspended)return!1;this.tileDescriptors.forEach(W=>{const T=
this._featureTiles.get(W.id);T?T.alive=!0:R.done||(N.push(this._addTile(W)),R.madeProgress())});return R.hasProgressed};J._filterExtentTiles=function(N,R){for(const W of N){if(R.done)break;W.alive&&(W.filtered=!W.intersects(this.filterExtent),W.filtered&&(this._clearTile(W),R.madeProgress()))}return R.hasProgressed};J._removeTiles=function(N,R){for(let W=N.length-1;0<=W&&!R.done;W--){const T=N[W];T.alive||(this._removeTile(T),W!==N.length-1&&(N[W]=N[N.length-1]),N.pop(),R.madeProgress())}return R.hasProgressed};
J._sortTiles=function(N){N.sort((R,W)=>(R.descriptor.loadPriority??0)-(W.descriptor.loadPriority??0));return N};J._showTiles=function(N,R){const W=this._updateRatio(N),T=P=>{const Q=1>this._fullRatio?W(P)*this._farRatio:1;P.reduceFeatures(Q,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(P)};for(const P of N)if(!R.run(()=>T(P))){this._setDirty();break}return R.hasProgressed};J._fetchTiles=function(N,R){if(this._paused)return!1;var W=!1;for(const P of N)if(P.needsFetching){var T=
null!=this.context.memoryCache?this.context.memoryCache.pop(P.id):null;if(null!=T)P.cache=T,this._setDirty(),this._scheduleUpdated(),R.madeProgress();else if(this._needsNumFeatures(P)&&(W=new AbortController,T=this._fetchTileCount(P,W.signal),this._handleRequest(P,T,W,()=>P.numFeatures=A.FAILED_FEATURE_COUNT),W=!0,R.madeProgress()),R.done)return!0}if(W)return R.hasProgressed;for(const P of N)if(P.needsFetching&&(N=new AbortController,W=this._fetchTile(P,N.signal),this._handleRequest(P,W,N,Q=>{P.setFeatures([],
0,null);this._invalidateCounts();P.featuresMissing=!1;this.context.logFetchError(G,Q)}),R.madeProgress()))return!0;return R.hasProgressed};J._updateMemoryEstimates=function(N,R){N.some(W=>R.run(()=>W.updateMemoryEstimates())?!1:(this._setDirty(),!0));return R.hasProgressed};J._reclip=function(N,R){if(this.initialized){var W=[];this._featureTiles.forEach(T=>{null!=T.displayingFeatures&&0!==T.displayingFeatures.length&&(T.intersectionIncludingBorrowed(R,L),T.intersectionIncludingBorrowed(N,O),m.equals(L,
O)||W.push(T))});this._refreshDisplayingFeatures(W);this._updated()}};J._refreshDisplayingFeatures=function(N){const R=new Set,W=this._changes.updates;for(const T of N)if(null!=T.displayingFeatures)for(const P of T.displayingFeatures)N=t.getObjectId(P,this._objectIdField),R.has(N)||(R.add(N),N=this._displayingFeatureReferences.get(N).feature,W.removes.push(N),W.adds.push(N));this._applyChanges()};J._updated=function(){let N=0;this._paused||this._featureTiles.forEach(W=>W.isFetching?++N:0);var R=this._dirty||
!!this._pendingEdits||0<N;this._set("running",this._dirty);this._set("updating",R);if(R){let W=0,T=0,P=0,Q=0,S=0;const U=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(X=>{++T;if(X.isFetching&&X.hasPreciseFeatureCount){const Y=this._maximumFeaturesForTile(X)*(1-X.emptyFeatureRatio);S+=Y-(null!=X.displayingFeatures?X.displayingFeatures.length*U:0)}X.needsFetching?++Q:0<X.numFeatures&&(++P,W+=X.numFeatures)});Q+=N;let V=R=0;W?(V=W,R=Math.min(Q*
W/P,W)):(V=T,R=Q);S=Math.min(this.maximumNumberOfFeatures-this.features.length,S);this._set("updatingTotal",V);this._set("updatingRemaining",R);this._set("expectedFeatureDiff",S)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};J._updateMaximumNumberOfFeaturesExceeded=function(){const N=q.someMap(this._featureTiles,R=>R.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",N)};
J._updateRatio=function(N){const R=E(N),W=Q=>1/(1<<Math.max(0,R-Q.descriptor.lij[0]));let T=0,P=0;for(const Q of N)N=Q.numFeatures,T+=N,P+=N*W(Q);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/T);this._farRatio=this.maximumNumberOfFeatures/P;this._scheduleUpdated();return W};J._maximumFeaturesUpdated=function(N,R){N!==R&&(R>N&&this._featureTiles.forEach(W=>{if(W.featuresMissing){var T=this._maximumFeaturesForTile(W);W.features&&(W.features.length>=T||W.fetchStatus===A.FetchStatus.FULL)||
(this._cancelFetchTile(W),this._resetFetchTile(W))}}),this._setDirty())};J._addTile=function(N){N=new A.FeatureTile(N);this._featureTiles.set(N.id,N);this._resetFetchTile(N);this._referenceDisplayingFeaturesFromRelatedTiles(N);return N};J._referenceDisplayingFeaturesFromRelatedTiles=function(N){const R=N.descriptor.resolution;this._featureTiles.forEach(W=>{if(!(null==W.displayingFeatures||N===W||N.descriptor.lij&&W.descriptor.lij&&!v.tilesAreRelated(N.descriptor.lij,W.descriptor.lij))){null==N.displayingFeatures&&
(N.displayingFeatures=[]);N.descriptor.extent&&W.descriptor.extent&&(null==N.extentIncludingBorrowedFeatures&&(N.extentIncludingBorrowedFeatures=m.clone(N.descriptor.extent)),m.expand(N.extentIncludingBorrowedFeatures,W.descriptor.extent,N.extentIncludingBorrowedFeatures));for(const T of W.displayingFeatures)N.displayingFeatures.push(T),W=this._displayingFeatureReferences.get(t.getObjectId(T,this._objectIdField)),W.ref(W.feature,R),this._numDisplayingFeatureReferences++}});N.featureLimit=null!=N.displayingFeatures?
N.displayingFeatures.length:0};J._removeTile=function(N){this._clearTile(N);this._featureTiles.delete(N.id)};J._resetFetchTile=function(N){N.filtered=!N.intersects(this.filterExtent);N.filtered?N.needsFetching&&(N.fetchStatus=A.FetchStatus.DONE):N.fetchStatus=A.FetchStatus.FETCH_NEEDED};J._cancelFetchTile=function(N){const R=N.requestController;null!=R&&(N.requestController=null,N.resetFetching(),R.abort())};J._fetchTileCount=async function(N,R){N.numFeatures=await this._fetchCount(N,R);this._updateRatio(this._getListOfTiles());
return N.fetchStatus===A.FetchStatus.REFETCHING?A.FetchStatus.REFETCH_NEEDED:A.FetchStatus.FETCH_NEEDED};J._fetchTile=async function(N,R){var W=this._maximumFeaturesForTile(N);if(0>=W)return F(N);const T=this._getMaxRecordCount(N);var P=Math.ceil(W/T);if(C(N)||!this.context.capabilities.supportsMaxRecordCountFactor||N.numFeatures<=W&&P>r.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(N,R);P=this._createQuery(N);P.maxRecordCountFactor=Math.ceil(W/T);N.isRefetching&&N.features&&0<N.features.length&&
(P.maxRecordCountFactor=Math.max(Math.ceil(N.features.length/(1-N.emptyFeatureRatio)/T)+1,P.maxRecordCountFactor));const {features:Q,exceededTransferLimit:S,fields:U}=await this._queryFeatures(P,R);W=S?P.maxRecordCountFactor>=r.MAX_MAX_RECORD_COUNT_FACTOR?A.FetchStatus.FULL:A.FetchStatus.DONE:A.FetchStatus.FULL;await this._frameTask.schedule(()=>{N.featuresMissing=Q.length<N.numFeatures||!!S;const V=this._removeEmptyFeatures(Q);N.setFeatures(Q,V,M(U))},R);d.throwIfAborted(R);this._invalidateCounts();
return W};J._fetchCount=async function(N,R){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(N),{signal:R})};J._fetchPagedTile=async function(N,R){let W=0,T=0,P,Q=0,S=this._maximumFeaturesForTile(N)-Q;const U=this._getMaxRecordCount(N);let V=null;for(;;){const X=this._createQuery(N),Y=this._setPagingParameters(X,W,S,U),{features:Z,exceededTransferLimit:ea,fields:ja}=await this._queryFeatures(X,R);await this._frameTask.schedule(()=>{Y&&(W+=X.num);Q+=Z.length;T+=this._removeEmptyFeatures(Z);
N.featuresMissing=W<N.numFeatures||!!ea;P=P?P.concat(Z):Z;V=K(V,ja);N.setFeatures(P,T,V)},R);d.throwIfAborted(R);this._invalidateCounts();this._setDirty();S=this._maximumFeaturesForTile(N)-Q;if(!Y||!ea||0>=S)return ea?A.FetchStatus.DONE:A.FetchStatus.FULL}};J._createFeatureCountQuery=function(N){N=this._createQuery(N);this.context.capabilities.supportsCacheHint&&(N.resultType=void 0,N.cacheHint=!0);return N};J._createQuery=function(N){const R=this.context.createQuery(),W=N.descriptor.extent;W&&(R.geometry=
m.toExtent(W,this.context.tilingScheme.spatialReference));this._setResolutionParams(R,N);this._useTileQuery(N)?R.resultType="tile":this.context.capabilities.supportsCacheHint&&(R.cacheHint=!0);return R};J._setPagingParameters=function(N,R,W,T){if(!this.context.capabilities.supportsPagination)return!1;N.start=R;0<W&&this.context.capabilities.supportsMaxRecordCountFactor?(N.maxRecordCountFactor=Math.ceil(W/T),N.num=Math.min(N.maxRecordCountFactor*T,W)):N.num=Math.min(T);return!0};J._getEffectiveTileResolution=
function(N){if(null==N.descriptor.resolution)return null;const R=this.context.viewingMode===x.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(N.descriptor.resolution,R)/this.lodFactor};J._setResolutionParams=function(N,R){this._supportsResolution&&(R=this._getEffectiveTileResolution(R),null!=R&&(this.context.capabilities.supportsQuantization?N.quantizationParameters=new w({mode:"view",originPosition:"upper-left",tolerance:R,extent:this.context.fullExtent}):
"polyline"===this.context.geometryType&&(N.maxAllowableOffset=R)))};J._removeEmptyFeatures=function(N){const R=N.length;for(let W=0;W<N.length;)t.hasVertices(N[W].geometry)?++W:(N[W]=N[N.length-1],--N.length);return R-N.length};J._needsNumFeatures=function(N){return this.useTileCount&&N.needsFeatureCount&&!C(N)};J._getMaxRecordCount=function(N){const {tileMaxRecordCount:R,maxRecordCount:W}=this.context;return this._useTileQuery(N)&&null!=R&&0<R&&this.context.capabilities.supportsResultType?R:null!=
W&&0<W?W:2E3};J._useTileQuery=function(N){return C(N)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};J._handleRequest=function(N,R,W,T){N.fetchStatus=N.needsRefetching?A.FetchStatus.REFETCHING:A.FetchStatus.FETCHING;N.requestController=W;let P=!1;R.then(Q=>{N.requestController=null;N.fetchStatus=Q}).catch(Q=>{N.requestController===W&&(N.requestController=null,N.fetchStatus=A.FetchStatus.DONE);d.isAbortError(Q)?P=!0:T(Q)}).then(()=>{P||this._setDirty();
this._scheduleUpdated()})};J._scheduleUpdated=function(){this._handles&&!this._handles.has("scheduleUpdated")&&this._handles.add(g.schedule(()=>{this._handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};J._showTile=function(N){if(null!=N.displayingFeatures&&!N.needsDisplayUpdate)return!1;var R=N.features;if(0===N.featureLimit||!R)return R=null!=N.displayingFeatures&&0<N.displayingFeatures.length,this._hideTileFeatures(N),N.displayingFeatures=[],R;const W=N.descriptor.resolution,
T=this._changes.updates,P=this._changes.adds,Q=Math.min(N.featureLimit,R.length);N.featureLimit=Q;for(let U=0;U<Q;++U){var S=R[U];const V=t.getObjectId(S,this._objectIdField),X=this._displayingFeatureReferences.get(V);X?(S=X.ref(S,W),S.oldVersion!==S.newVersion&&(S.oldVersion&&T.removes.push(S.oldVersion),S.newVersion&&T.adds.push(S.newVersion))):(this._displayingFeatureReferences.set(V,new this.FeatureReferenceClass(S,W)),P.push(S));this._numDisplayingFeatureReferences++}this._hideTileFeatures(N);
this._applyChanges();N.displayingFeatures=R.slice(0,Q);return!0};J._hideTile=function(N){this._cancelFetchTile(N);this._hideTileFeatures(N)};J._hideTileFeatures=function(N){if(null!=N.displayingFeatures){var R=this._changes.updates,W=this._changes.removes;for(const P of N.displayingFeatures){const Q=t.getObjectId(P,this._objectIdField);var T=this._displayingFeatureReferences.get(Q);T&&((T=T.unref(N.descriptor.resolution),this._numDisplayingFeatureReferences--,T)?T.oldVersion!==T.newVersion&&(null==
T.newVersion?(this._displayingFeatureReferences.delete(Q),T.oldVersion&&W.push(T.oldVersion)):(R.adds.push(T.newVersion),T.oldVersion&&R.removes.push(T.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();N.displayingFeatures=null}};J._applyChanges=function(){var N=this._changes.updates;0<N.removes.length&&(this.features.removeMany(N.removes),N.removes.length=0);0<N.adds.length&&(this.features.addMany(N.adds),N.adds.length=0);N=this._changes.adds;const R=this._changes.removes,
W=Math.min(N.length,R.length);let T=0;for(;T<W;){const P=Math.min(T+200,W);this.features.addMany(N.slice(T,P));this.features.removeMany(R.slice(T,P));T=P}N.length>W&&this.features.addMany(0===T?N:N.slice(T));R.length>W&&this.features.removeMany(0===T?R:R.slice(T));N.length=0;R.length=0};J._clearTile=function(N){this._hideTile(N);N.features&&null!=this.context.memoryCache&&this.context.memoryCache.put(N.id,N.cache,16+N.estimatedSize);N.setFeatures(null,0,null);this._invalidateCounts()};J._invalidateCounts=
function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};J._getListOfTiles=function(){return Array.from(this._featureTiles.values())};J._maximumFeaturesForTile=function(N){const R=N.hasPreciseFeatureCount?N.numFeatures:Infinity;return Math.min(Math.ceil((N.hasPreciseFeatureCount?R:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-N.emptyFeatureRatio)),R)};b._createClass(H,[{key:"maximumNumberOfFeatures",set:function(N){N=
N||Infinity;const R=this._get("maximumNumberOfFeatures");N===R||1>N||(this._set("maximumNumberOfFeatures",N),this._maximumFeaturesUpdated(R,N))}},{key:"memoryFactor",set:function(N){this.memoryFactor!==N&&(this._set("memoryFactor",N),this._setDirty())}},{key:"lodFactor",set:function(N){this.lodFactor!==N&&(this._set("lodFactor",N),this._supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&null!=this.context.query.queryFeatureCount},set:function(N){this._useTileCount=
N;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let N=0;this._featureTiles.forEach(R=>N+=R.estimatedUnusedSize);return N}},{key:"totalVertices",get:function(){let N=0;this._featureTiles.forEach(R=>N+=R.numVertices);return N}},{key:"totalFeatures",get:function(){let N=0;this._featureTiles.forEach(R=>N+=R.numFeatures);return N}},{key:"filterExtent",set:function(N){if(null!=N&&this.context.tilingScheme&&!N.spatialReference.equals(this.context.tilingScheme.spatialReference))G.error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var R=this._get("filterExtent");R===N||null!=R&&N&&R.equals(N)||(N=null!=N?N.clone():null,this._set("filterExtent",N),this._reclip(N,R))}}},{key:"_paused",get:function(){return this._suspended||!!this._pendingEdits}},{key:"availableFields",get:function(){let N=null;this._featureTiles.forEach(R=>{null!=R.displayingFeatures&&0!==R.displayingFeatures.length&&(null==N?N=new Set(R.availableFields):N.forEach(W=>{R.availableFields.has(W)||
N.delete(W)}))});return null!=N?N:new Set}},{key:"_supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((N,R)=>N+(R.features?R.features.length:0),0)}},{key:"missingTiles",get:function(){return Array.from(this._featureTiles.values()).reduce((N,R)=>N+(R.needsFetching||R.isFetching?1:0),0)}},{key:"test",get:function(){return{process:N=>this.runTask(N),
getFeatureTileById:N=>this._featureTiles.get(N),forEachFeatureTile:N=>this._featureTiles.forEach(N)}}}]);return H}(y);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);c.__decorate([e.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);
c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"running",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"updatingRemaining",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"totalVertices",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=c.__decorate([l.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const L=m.create(),O=m.create();a.contextCapabilitiesFromLayer=
function(I){const H=I.capabilities.query;a:switch(I.geometryType){case "polyline":I=!0;break a;case "polygon":I=I.capabilities&&I.capabilities.query&&I.capabilities.query.supportsQuantization;break a;default:I=!1}return{supportsMultipleResolutions:I,supportsPagination:!(!H||!H.supportsPagination),supportsResultType:!(!H||!H.supportsResultType),supportsCacheHint:!(!H||!H.supportsCacheHint),supportsQuantization:!(!H||!H.supportsQuantization),supportsQuantizationEditMode:!(!H||!H.supportsQuantizationEditMode),
supportsMaxRecordCountFactor:!(!H||!H.supportsMaxRecordCountFactor),supportsFormatPBF:!(!H||!H.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){c=function(){function m(w,r){this._highestResolutionVersion=null;this.versions=[];this.ref(w,r)}var t=m.prototype;t.ref=function(w,r){const x=this.feature;l.oldVersion=x;this.feature&&Object.defineProperty(w,"uid",{value:this.feature.uid,configurable:!0});for(var D of this.versions)if(D.resolution===r){D.refCount++;if((r=this._highestResolutionVersion===D&&!n.equals(w,D.feature))||this._highestResolutionVersion!==D)D.feature=w;l.newVersion=r?w:x;return l}D=
{feature:w,resolution:r,refCount:1};this.versions.push(D);!this._highestResolutionVersion||r<this._highestResolutionVersion.resolution?(l.newVersion=w,this._highestResolutionVersion=D):l.newVersion=x;return l};t.unref=function(w){for(let r=0;r<this.versions.length;r++){const x=this.versions[r];if(x.resolution===w)return x.refCount--,l.oldVersion=this.feature,0===x.refCount&&(this.versions[r]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===x&&(this._recalculateHighestResolutionVersion(),
l.oldVersion=x.feature)),l.newVersion=this.feature,l}return null};t._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var w=this.versions[0];for(let r=1;r<this.versions.length;r++){const x=this.versions[r];x.resolution<w.resolution&&(w=x)}this._highestResolutionVersion=w}};b._createClass(m,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}}]);return m}();y=function(){function m(w){this._feature=w;this._refCount=1}var t=m.prototype;t.ref=function(w){++this._refCount;l.oldVersion=this._feature;this.feature&&Object.defineProperty(w,"uid",{value:this.feature.uid,configurable:!0});n.equals(this._feature,w)||(this._feature=w);l.newVersion=this._feature;return l};t.unref=function(){l.oldVersion=this._feature;if(0<this._refCount&&
(this._refCount--,!this.isReferenced))return l.newVersion=null,l;l.newVersion=this._feature;return l};b._createClass(m,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"feature",get:function(){return this._feature}}]);return m}();const l={oldVersion:null,newVersion:null};a.MultiFeatureReference=c;a.SingleFeatureReference=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,y,p){const u=new Set;let q=function(){function d(g){this.descriptor=g;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;
this._estimatedUnusedSizeDirty=!1;this._availableFields=u;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var f=d.prototype;f.setFeatures=function(g,e,h){this._availableFields=h??u;this._features=g;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;g&&0<g.length?(this._emptyFeatureRatio=e/(g.length+e),this._numVertices=g.reduce((z,n)=>z+p.numVertices(n.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};f.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=
this._estimatedSize=0;if(this._features)for(var g=0;g<this._features.length;++g){const e=p.estimateSize(this._features[g]);this._estimatedSize+=e;g>=this.featureLimit&&(this._estimatedUnusedSize+=e)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(g=this.featureLimit;g<this._features.length;++g)this._estimatedUnusedSize+=p.estimateSize(this._features[g]);return!0}return!1};f.resetFetching=function(){this.fetchStatus=this.fetchStatus===
a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};f.intersects=function(g){if(null==g||!this.descriptor.extent)return!0;y.fromExtent(g,k);return y.intersects(this.descriptor.extent,k)};f.intersectionIncludingBorrowed=function(g,e){const h=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!g&&!h)return y.copy(e,y.POSITIVE_INFINITY),e;null!=g?(y.fromExtent(g,e),y.intersection(e,h,e)):y.copy(e,h);return e};f._shuffle=
function(g){this._features.sort((e,h)=>p.getObjectId(e,g)-p.getObjectId(h,g));c.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};f.reduceFeatures=function(g,e,h){if(0>=g)return!1;if(!this._features)return this.featureLimit=0,!1;let z=!1;this.featureLimit=Math.ceil(this.numFeatures*g);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,
z=!0));!this._shuffled&&1>g&&this._shuffle(h);g=Math.max(this.featureLimit,Math.ceil(e*this.numFeatures));this._features.length>g&&(this._features.length=g,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return z};b._createClass(d,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(g){this._displayingFeatures=g;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&
(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(g){this._featureLimit!==g&&(this._featureLimit=g,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?
this._numFeatures:this._features?this._features.length:0},set:function(g){this._numFeatures=g}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},
{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===
a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var g;if(g=!!this._features){a:{g=this._features;var e=this.displayingFeatures,h=this.featureLimit;if(null==e||null==g||h!==e.length||h>g.length)g=!1;else{for(let z=0;z<h;++z)if(g[z]!==e[z]){g=!1;break a}g=!0}}g=!g}return g}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,
featuresMissing:this.featuresMissing}},set:function(g){this.requestController=null;this._availableFields=g.availableFields;this._features=g.features;this._numFeatures=g.numFeatures;this._emptyFeatureRatio=g.emptyFeatureRatio;this.fetchStatus=g.fetchStatus;this.featuresMissing=g.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return d}();a.FetchStatus=void 0;(function(d){d[d.FETCH_NEEDED=0]="FETCH_NEEDED";d[d.REFETCH_NEEDED=1]="REFETCH_NEEDED";d[d.FETCHING=2]="FETCHING";
d[d.REFETCHING=3]="REFETCHING";d[d.DONE=4]="DONE";d[d.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const k=y.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(a,b,c,y,p,u,q,k,d){const f=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let g=function(){function e(z,n,l){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=z;this._view=l;this._tilingScheme=new d.TilingScheme(n);
this._loadedSymbols=f.map(m=>new q(new p({material:{color:[m[0],m[1],m[2],.6]},outline:{color:"black",size:1}})));this._loadingSymbols=[new q(new p({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this._pendingSymbols=[new q(new p({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this._dataExtentSymbol=new q(new p({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var h=e.prototype;h.destroy=function(){this.enabled=!1};h.update=function(){this._enabled?
(this._synchronizeMaps(this._loadingGraphics,{filter:z=>z.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:z=>!z.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:z=>!z.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(z=>{this._view.graphics.removeMany(z)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(z=>{this._view.graphics.removeMany(z)}),
this._loadedGraphics.clear(),this._pendingGraphics.forEach(z=>{this._view.graphics.removeMany(z)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))};h.showDataExtent=function(z){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);null!=z&&(z=y.fromExtent(z),this._dataExtentGraphic=new c({geometry:z,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))};
h._synchronizeMaps=function(z,n){const l=[];z.forEach((m,t)=>{const w=this._tileFetcher.test.getFeatureTileById(t);w&&n.filter(w)||(this._view.graphics.removeMany(m),l.push(t))});l.forEach(m=>z.delete(m));this._tileFetcher.test.forEachFeatureTile(m=>{if(n.filter(m)&&!z.has(m.id)){const [r,x,D]=m.descriptor.lij;this._tilingScheme.ensureMaxLod(r);var t=this._tilingScheme.getExtentGeometry(r,x,D),w=new c({geometry:t,symbol:n.symbols[r%n.symbols.length]});t=new c({geometry:t.center,symbol:new u({verticalOffset:{screenLength:40/
.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new k({text:`${r}/${x}/${D}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});w=[w,t];z.set(m.id,w);this._view.graphics.addMany(w)}})};b._createClass(e,[{key:"enabled",get:function(){return this._enabled},set:function(z){this._enabled=z;this.update()}}]);return e}();a.FeatureTileFetcher3DDebugger=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){a.FeatureLikeLayerView3D=v=>{v=function(B){function C(){var F=B.apply(this,arguments)||this;F.controller=null;F.updatePolicy=D.UpdatePolicy.SYNC;F.suspendResumeExtentMode="computed";F.slicePlaneEnabled=!1;F.fullExtentInLocalViewSpatialReference=null;F.suspendResumeExtent=null;F._controllerCreated=!1;F.supportsHeightUnitConversion=!0;F._pendingController=null;F.queryEngine=null;return F}b._inherits(C,B);var E=C.prototype;E.initialize=function(){const F=
this.layer;if("isTable"in F&&F.isTable)this.addResolvingPromise(Promise.reject(new y("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:F})));else{this.addResolvingPromise(this._validateGeometryType());this.updatingHandles.add(()=>this.layer.renderer,K=>this._recreateProcessor(K),u.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await x.toViewIfLocal(this);await this._initializeController()})());this.updatingHandles.add(()=>
this.updatePolicy,K=>this.processor.preferredUpdatePolicy=K);var M=()=>this.processor.featureStore;this.queryEngine=new t.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return M()},hasZ:this.hasZ,hasM:this.hasM},priority:A.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}};E.destroy=function(){this._destroyPendingController();this.controller=p.destroyMaybe(this.controller);this._set("processor",
p.destroyMaybe(this.processor));this.queryEngine=p.destroyMaybe(this.queryEngine);this.loadedGraphics=null};E._destroyPendingController=function(){this._pendingController=p.destroyMaybe(this._pendingController)};E.getHit=function(F){let M;this.loadedGraphics?.forEach(K=>{K.uid===F&&(M=e.hydrateGraphic(K,this.layer))});return M?{type:"graphic",graphic:M,layer:M.layer}:null};E.whenGraphicBounds=function(F,M){return this.processor?.whenGraphicBounds(F,M)};E.computeAttachmentOrigin=function(F,M){return this.processor?.computeAttachmentOrigin(F,
M)};E.elevationAlignPointsInFeatures=async function(F,M){const K=this.graphics3DProcessor;if(null==K)throw new y("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return l.elevationAlignPointsInFeatures(this.view,this.layer,G=>K.getGraphics3DGraphicByObjectId(G),F,M)};E.queryForSymbologySnapping=async function(F,M){return this.symbologySnappingSupported?w.queryForSymbologySnapping(this.graphics3DProcessor,F,M):{candidates:[],sourceCandidateIndices:[]}};
E.queryFeatures=function(F,M){return this.queryEngine.executeQuery(this._ensureQuery(F),M?.signal)};E.queryObjectIds=function(F,M){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),M?.signal)};E.queryFeatureCount=function(F,M){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),M?.signal)};E.queryExtent=function(F,M){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),M?.signal)};E._ensureQuery=function(F){return null==F?this.createQuery():z.from(F)};E.highlight=
function(F){return this.processor.highlight(F,this.layer.objectIdField)};E.maskOccludee=function(F){return this.processor.maskOccludee(F)};E.canResume=function(){return b._get(b._getPrototypeOf(C.prototype),"canResume",this).call(this)&&!this.processor?.scaleVisibilitySuspended};E.getSuspendInfo=function(){const F=b._get(b._getPrototypeOf(C.prototype),"getSuspendInfo",this).call(this);return this.processor?{...F,...this.processor.suspendInfo}:F};E.isUpdating=function(){return!this.processor||this.processor.destroyed?
!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)};E._initializeController=async function(){const F=this.createController();this._pendingController=F;await F.when();this._setControllerWhenInitialized(F)};E._setControllerWhenInitialized=async function(F){try{await this.when()}catch(M){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(await u.whenOnce(()=>
this.view?.basemapTerrain?.ready),this.beforeSetController(F),this._pendingController=null,this.controller=F,this.loadedGraphics=F.graphics,this.notifyChange("updating"))};E._updateClippingExtent=function(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}};E._validateGeometryType=async function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new y("featurelayerview3d:unsupported-geometry-type",
"Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}};E._recreateProcessor=function(F){var M="heatmap"===F?.type;const K="heatmap"===this.processor?.type;F=this.processor;F&&M===K||(M=M?new r.HeatmapFeatureProcessor({owner:this}):new m({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:G=>
this._updateClippingExtent(G)}),this._set("processor",M),F?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(M.initializePromise))};E._getResourceInfo=function(){const F=this.controller instanceof h.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics?.length,maximumNumberOfFeatures:F?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:F?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}};b._createClass(C,[{key:"legendEnabled",
get:function(){return this.canResume()&&this.processor?.legendEnabled}},{key:"graphics3DProcessor",get:function(){return"graphics-3d"===this.processor?.type?this.processor:null}},{key:"heatmapProcessor",get:function(){return"heatmap"===this.processor?.type?this.processor:null}},{key:"symbologySnappingSupported",get:function(){return this.layer?.renderer?.getSymbols()?.some(n.symbolHasExtrudeSymbolLayer)??!1}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return C}(v);c.__decorate([q.property()],
v.prototype,"loadedGraphics",void 0);c.__decorate([q.property()],v.prototype,"suspended",void 0);c.__decorate([q.property({readOnly:!0})],v.prototype,"legendEnabled",null);c.__decorate([q.property()],v.prototype,"updating",void 0);c.__decorate([q.property()],v.prototype,"controller",void 0);c.__decorate([q.property()],v.prototype,"processor",void 0);c.__decorate([q.property({readOnly:!0})],v.prototype,"updatePolicy",void 0);c.__decorate([q.property({readOnly:!0})],v.prototype,"suspendResumeExtentMode",
void 0);c.__decorate([q.property({type:Boolean})],v.prototype,"slicePlaneEnabled",void 0);c.__decorate([q.property({readOnly:!0})],v.prototype,"suspendInfo",void 0);c.__decorate([q.property()],v.prototype,"graphics3DProcessor",null);c.__decorate([q.property()],v.prototype,"heatmapProcessor",null);c.__decorate([q.property()],v.prototype,"symbologySnappingSupported",null);return v=c.__decorate([g.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],v)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),function(a,b,c,y,p,u,q,k,d){const f=new q.ElevationContext,g=y.makeDehydratedPoint(0,0,0,d.WGS84),e=new u.SampleElevationInfo;a.elevationAlignPointsInFeatures=
async function(h,z,n,l,m){const {elevationProvider:t,renderCoordsHelper:w,spatialReference:r}=h,{elevationInfo:x}=z;var D=k.extractExpressionInfo(x,!0);D=await k.createContext(D,r,m);c.throwIfAborted(m);m=[];const A=new Set,v=new Set;for(const {objectId:B,points:C}of l)if(l=n(B),null==l){for(const E of C)m.push(E.z??0);A.add(B)}else{l.isDraped&&v.add(B);f.setFromElevationInfo(p.getGeometryEffectiveElevationInfo(l.graphic.geometry,x));f.updateFeatureExpressionInfoContext(D,l.graphic,z);g.spatialReference=
h.spatialReference;for(const {x:E,y:F,z:M}of C)g.x=E,g.y=F,g.z=M??0,u.evaluateElevationInfoAtPoint(g,t,f,w,e),m.push(e.z)}return{elevations:m,drapedObjectIds:v,failedObjectIds:A}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../symbols/support/unitConversionUtils"],function(a,b){function c(e,h){return null!=h&&h.mode?h.mode:(e?f:g).mode}function y(e,h){return null!=h?h:e?f:g}function p(e,h){return c(null!=e?e.hasZ:
!1,h)}function u(e){const h=q(e);return p(e.geometry,h)}function q(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function k(e,h,z,n,l,m,t=null){if(null!=m){var w=null!=t?t.mode:"absolute-height";if("on-the-ground"===w)return 0;({absoluteZ:m}=d(h,z,n,l,e,m));a:{t=null!=t&&null!=t.offset?t.offset:0;switch(w){case "absolute-height":e=m-t;break a;case "relative-to-ground":e=m-((e.elevationProvider.getElevation(h,z,n,l,"ground")??0)+t);break a;case "relative-to-scene":e=m-((e.elevationProvider.getElevation(h,
z,n,l,"scene")??0)+t);break a}e=void 0}return e}}function d(e,h,z,n,l,m){const t=null!=m.offset?m.offset:0;switch(m.mode){case "absolute-height":return{absoluteZ:z+t,elevation:0};case "on-the-ground":return z=l.elevationProvider.getElevation(e,h,0,n,"ground")??0,{absoluteZ:z,elevation:z};case "relative-to-ground":return e=l.elevationProvider.getElevation(e,h,z,n,"ground")??0,{absoluteZ:z+e+t,elevation:e};case "relative-to-scene":return e=l.elevationProvider.getElevation(e,h,z,n,"scene")??0,{absoluteZ:z+
e+t,elevation:e}}}const f={mode:"absolute-height",offset:0},g={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=f;a.elevationContextAffectsAlignment=function(e,h){if(null==h)return!1;({mode:h}=h);return null!=h&&("scene"===e&&"relative-to-scene"===h||"ground"===e&&"absolute-height"!==h)};a.elevationInfoLikeEquals=function(e,h){return e===h||null!=e&&null!=h&&e.mode===h.mode&&e.offset===h.offset};a.getConvertedElevation=function(e,h,z,n=null){return k(e,h.x,h.y,h.hasZ?h.z:0,h.spatialReference,
z,n)};a.getConvertedElevationFromVector=function(e,h,z,n,l=null){return k(e,h[0],h[1],2<h.length?h[2]:0,z,n,l)};a.getEffectiveElevationInfo=y;a.getEffectiveElevationMode=c;a.getGeometryEffectiveElevationInfo=function(e,h){return y(null!=e?!!e.hasZ:!1,h)};a.getGeometryEffectiveElevationMode=p;a.getGraphicEffectiveElevationInfo=function(e){var h=q(e);e=p(e.geometry,h);h=null!=h&&"on-the-ground"!==e?(h.offset??0)*b.getMetersPerUnit(h.unit??"meters"):0;return{mode:e,offset:h}};a.getGraphicEffectiveElevationMode=
u;a.getZForElevationMode=function(e,h,z){if(null!=z&&z.mode){var n=e.hasZ?e.z:0,l=null!=z.offset?z.offset:0;switch(z.mode){case "absolute-height":return n-l;case "on-the-ground":return 0;case "relative-to-ground":return e=(h.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground")??0)+l,n-e;case "relative-to-scene":return e=(h.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene")??0)+l,n-e}}};a.hasGraphicFeatureExpressionInfo=function(e){if("on-the-ground"===u(e))return!1;
e=q(e);e=null!=e&&e.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!e||"0"===e)};a.onTheGroundElevationInfo=g;a.zValueInAbsoluteHeightMode=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){u=function(L){function O(H){H=L.call(this,H)||this;H.type="graphics-3d";H._randomRotationRenderers=null;H.elevationFeatureExpressionEnabled=!1;H.scaleVisibilityEnabled=!1;H.filterVisibilityEnabled=!1;H.frustumVisibilityEnabled=!1;H.elevationAlignmentEnabled=!1;H.timeExtentEnabled=!1;H.setUidToIdOnAdd=!0;H.dataExtent=null;H.drapeSourceType=w.DrapeSourceType.Features;H.preferredUpdatePolicy=K.UpdatePolicy.ASYNC;H._suspendResumeExtent=
null;return H}a._inherits(O,L);var I=O.prototype;I.initialize=function(){const H=this.owner,J=new x.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:H.hasZ,hasM:H.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:N=>H.view.deconflictor.addGraphicsOwner(N),labeler:(N,R)=>H.view.labeler.addGraphicsOwner(N,R),elevationAlignment:this.elevationAlignmentEnabled?
(N,R)=>new D({graphicsCoreOwner:this,graphicsCore:N,queryGraphicUIDsInExtent:R,elevationProvider:H.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(N,R)=>new B({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:R,graphicsCore:N,basemapTerrain:H.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==H.layer.geometryType?N=>new F.FeatureVisibilityFilter({context:{layerView:H,...N}}):null,objectStates:N=>
new v.Graphics3DObjectStates(N)}});this._set("graphicsCore",J);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new A({graphicsCoreOwner:this}));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(N,R)=>{z.diff(N,R)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>this.layer.labelingInfo,(N,R)=>{z.diff(N,
R)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,N=>this.graphicsCore.preferredUpdatePolicy=N);this._set("initializePromise",this._initializeAsync());this.updatingHandles.addPromise(this.initializePromise)};I._initializeAsync=async function(){await k.logOnError(this.graphicsCore.initializePromise);const H=this.owner;this.updatingHandles.add(()=>this.renderer,J=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(J)));this.updatingHandles.add(()=>
H.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this.updatingHandles.add(()=>H.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await k.logOnError(this.graphicsCore.updateLabelingInfo())};I.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("frustumVisibility",q.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",q.destroyMaybe(this.graphicsCore));this._set("owner",null)};I.maskOccludee=function(H){const {set:J,handle:N}=this.objectStates.acquireSet(M.Object3DState.MaskOccludee,null);this.objectStates.setUid(J,H.uid);return N};I.highlight=function(H,J){if(H instanceof t){const {set:N,handle:R}=this.objectStates.acquireSet(M.Object3DState.Highlight,J);this.owner.queryObjectIds(H).then(W=>this.objectStates.setObjectIds(N,W));return R}if("number"===typeof H||"string"===typeof H||H instanceof
c)return this.highlight([H],J);"toArray"in H&&(H=H.toArray());if(Array.isArray(H)&&0<H.length){if(H[0]instanceof c)if(null!=E.attributeLookup(this.layer.fieldsIndex,H[0].attributes,J))H=H.map(N=>E.attributeLookup(this.layer.fieldsIndex,N.attributes,J));else{H=H.map(W=>W.uid);const {set:N,handle:R}=this.objectStates.acquireSet(M.Object3DState.Highlight,null);this.objectStates.setUids(N,H);return R}if(Array.isArray(H)&&("number"===typeof H[0]||"string"===typeof H[0])){const {set:N,handle:R}=this.objectStates.acquireSet(M.Object3DState.Highlight,
J);this.objectStates.setObjectIds(N,H);return R}}return G};I.resetObjectStates=function(){this.objectStates.reset()};I.whenGraphicBounds=function(H,J){return this.graphicsCore?.whenGraphicBounds(H,J)};I.computeAttachmentOrigin=function(H,J){return this.graphicsCore?.computeAttachmentOrigin(H,J)};I.notifyGraphicGeometryChanged=function(H){this.graphicsCore.notifyGraphicGeometryChanged(H)};I.notifyGraphicVisibilityChanged=function(H){this.graphicsCore.notifyGraphicVisibilityChanged(H)};I.getRenderingInfo=
function(H,J,N){N=m.getRenderingInfo(H,{renderer:J,arcade:N});if(null!=N&&N.color){const R=N.color;R[0]/=255;R[1]/=255;R[2]/=255}null!=N&&null!=J&&this._randomRotationRenderers?.has(J)&&(J=this._randomRotationRenderers.get(J),H=H.attributes[J],J=new y.XXH(0),J.updateFloatArray([H]),J.updateUint8Array([173]),N.heading=8.381E-8*J.digest());return N};I.getRenderingInfoAsync=function(H,J,N,R){return m.getRenderingInfoAsync(H,{renderer:J,arcade:N,...R})};I.getSymbolLayerSize=function(H,J){return this.graphicsCore?.getSymbolLayerSize(H,
J)};I.setObjectIdVisibility=function(H,J){this.graphicsCore?.setObjectIdVisibility(H,J)};I.refreshFilter=function(){null!=this.filterVisibility&&this.filterVisibility.reapply()};I.getGraphics3DGraphicByObjectId=function(H){return this.graphicsCore?.getGraphics3DGraphicByObjectId(H)};I._updateClippingExtent=function(){const H=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(H,this.owner.view.spatialReference)&&(this.updateClippingExtent(H)||this.graphicsCore.recreateAllGraphics())};
I._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add(d.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([d.watch(()=>this.graphicsCore.computedExtent,H=>this._updateSuspendResumeExtent(H),d.initial),d.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");
break;case "data":this.handles.add([d.when(()=>this.dataExtent,H=>this._updateSuspendResumeExtent(H),d.initial),d.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:p.neverReached(this.suspendResumeExtentMode)}},d.initial))};I._updateSuspendResumeExtent=function(H){H?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(H,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)};I._extentToSuspendResumeRect=
function(H,J){const N=this.owner.view.spatialReference;if(!H.spatialReference.equals(N)){if(!n.canProject(H,N))return;H=n.project(H,N)}return C.enlargeExtent(H,J,r.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};I._suspendResumeExtentChanged=function(H){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(H);null!=this.scaleVisibility&&this.scaleVisibility.setExtent(H)};a._createClass(O,[{key:"layer",get:function(){return this.owner.layer}},{key:"renderer",get:function(){const {renderer:H,
objectIdField:J}=this.layer;if(!H||!J||"heatmap"===H.type||!H.visualVariables)return H;const N=H.visualVariables.findIndex(W=>"rotation"===W.type&&null!=W.valueExpression&&l.matchRandomRotationExpression(W.valueExpression)===J&&(null==W.axis||"heading"===W.axis)&&"geographic"===W.rotationType);if(0>N)return H;const R=H.clone();R.visualVariables.splice(N,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(R,J);return R}},{key:"scaleVisibility",
get:function(){return this.graphicsCore?.scaleVisibility}},{key:"filterVisibility",get:function(){return this.graphicsCore?.filterVisibility}},{key:"elevationAlignment",get:function(){return this.graphicsCore?.elevationAlignment}},{key:"objectStates",get:function(){return this.graphicsCore?.objectStates}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}},{key:"scaleVisibilitySuspended",get:function(){return null!=
this.scaleVisibility&&this.scaleVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){const H={};this.scaleVisibilitySuspended&&(H.outsideScaleRange=!0);null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(H.outsideOfView=!0);return H}},{key:"updating",get:function(){return!!(this.graphicsCore?.updating||null!=this.frustumVisibility&&
this.frustumVisibility.updating||this.updatingHandles?.updating)}},{key:"updatingRemaining",get:function(){return this.graphicsCore?.updatingRemaining??0}},{key:"featureStore",get:function(){return this.graphicsCore?.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){return this.owner?.fullOpacity}},{key:"filter",get:function(){return"filter"in this.owner?this.owner.filter:null}},
{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},{key:"graphics3DGraphics",get:function(){return this.graphicsCore?.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphicsCore?.graphics3DGraphicsByObjectID}},
{key:"symbolUpdateType",get:function(){return this.graphicsCore?.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){const H=this.view.resourceController?.memoryController?.memoryFactor,J=this.graphicsCore?.displayFeatureLimit;return null==H||1===H?J:{...J,maximumNumberOfFeatures:Math.ceil(J.maximumNumberOfFeatures*H),maximumTotalNumberOfFeatures:Math.ceil(J.maximumTotalNumberOfFeatures*H),minimumTotalNumberOfFeatures:Math.ceil(J.minimumTotalNumberOfFeatures*H)}}},{key:"usedMemory",get:function(){return this.graphicsCore?.usedMemory??
0}},{key:"loadedFeatures",get:function(){return this.graphicsCore?.numberOfGraphics??0}},{key:"usedMemoryPerFeature",get:function(){return this.graphicsCore?.usedMemoryPerGraphic??0}},{key:"unprocessedMemoryEstimate",get:function(){return this.graphicsCore?.unprocessedMemoryEstimate??0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:null==this.frustumVisibility||!this.frustumVisibility.suspended,
visibilityScale:!this.scaleVisibilitySuspended}}}]);return O}(u.HandleOwner);b.__decorate([f.property()],u.prototype,"type",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"owner",void 0);b.__decorate([f.property()],u.prototype,"layer",null);b.__decorate([f.property()],u.prototype,"renderer",null);b.__decorate([f.property({constructOnly:!0})],u.prototype,"updateClippingExtent",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"elevationFeatureExpressionEnabled",void 0);
b.__decorate([f.property({constructOnly:!0})],u.prototype,"graphicsCore",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"filterVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"frustumVisibilityEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,
"timeExtentEnabled",void 0);b.__decorate([f.property({constructOnly:!0})],u.prototype,"setUidToIdOnAdd",void 0);b.__decorate([f.property()],u.prototype,"scaleVisibility",null);b.__decorate([f.property()],u.prototype,"filterVisibility",null);b.__decorate([f.property()],u.prototype,"elevationAlignment",null);b.__decorate([f.property({constructOnly:!0})],u.prototype,"frustumVisibility",void 0);b.__decorate([f.property()],u.prototype,"objectStates",null);b.__decorate([f.property()],u.prototype,"initializePromise",
void 0);b.__decorate([f.property()],u.prototype,"suspendResumeExtentMode",null);b.__decorate([f.property()],u.prototype,"dataExtent",void 0);b.__decorate([f.property()],u.prototype,"scaleVisibilitySuspended",null);b.__decorate([f.property()],u.prototype,"suspended",null);b.__decorate([f.property()],u.prototype,"legendEnabled",null);b.__decorate([f.property()],u.prototype,"suspendInfo",null);b.__decorate([f.property()],u.prototype,"updating",null);b.__decorate([f.property()],u.prototype,"updatingRemaining",
null);b.__decorate([f.property()],u.prototype,"featureStore",null);b.__decorate([f.property()],u.prototype,"view",null);b.__decorate([f.property()],u.prototype,"loadedGraphics",null);b.__decorate([f.property()],u.prototype,"fullOpacity",null);b.__decorate([f.property()],u.prototype,"filter",null);b.__decorate([f.property()],u.prototype,"slicePlaneEnabled",null);b.__decorate([f.property()],u.prototype,"drapeSourceType",void 0);b.__decorate([f.property()],u.prototype,"updatePolicy",null);b.__decorate([f.property()],
u.prototype,"preferredUpdatePolicy",void 0);b.__decorate([f.property()],u.prototype,"displayFeatureLimit",null);u=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],u);const G={remove(){},pause(){},resume(){}};return u})},"esri/arcade/functions/hash":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(p){const u=[];for(let q=0,k=p.length;q<k;q++){let d=p.charCodeAt(q);128>d?u.push(d):2048>d?u.push(192|d>>6,128|d&63):55296>
d||57344<=d?u.push(224|d>>12,128|d>>6&63,128|d&63):(q++,d=65536+((d&1023)<<10|p.charCodeAt(q)&1023),u.push(240|d>>18,128|d>>12&63,128|d>>6&63,128|d&63))}return new Uint8Array(u)}let y=function(){function p(q){this._seed=q;this._totallen=0;this._bufs=[];this.init()}var u=p.prototype;u.init=function(){this._bufs=[];this._totallen=0;return this};u.updateFloatArray=function(q){const k=[];for(const d of q)isNaN(d)?k.push("NaN"):Infinity===d?k.push("Infinity"):-Infinity===d?k.push("-Infinity"):0===d?k.push("0"):
k.push(d.toString(16));this.update(c(k.join("")))};u.updateIntArray=function(q){q=Int32Array.from(q);this.update(new Uint8Array(q.buffer))};u.updateUint8Array=function(q){this.update(Uint8Array.from(q))};u.updateWithString=function(q){return this.update(c(q))};u.update=function(q){this._bufs.push(q);this._totallen+=q.length;return this};u.digest=function(){const q=new Uint8Array(this._totallen);let k=0;for(const d of this._bufs)q.set(d,k),k+=d.length;this.init();return this._xxHash32(q,this._seed)};
u._xxHash32=function(q,k=0){var d=k+374761393&4294967295;let f=0;if(16<=q.length){d=[k+2654435761+2246822519&4294967295,k+2246822519&4294967295,k+0&4294967295,k-2654435761&4294967295];k=q.length-16;var g=0;for(f=0;(f&4294967280)<=k;f+=4){var e=f;e=d[g]+(2246822519*(q[e]+(q[e+1]<<8))+(2246822519*(q[e+2]+(q[e+3]<<8))<<16))&4294967295;e=e<<13|e>>>19;d[g]=2654435761*(e&65535)+(2654435761*(e>>>16)<<16)&4294967295;g=g+1&3}d=(d[0]<<1|d[0]>>>31)+(d[1]<<7|d[1]>>>25)+(d[2]<<12|d[2]>>>20)+(d[3]<<18|d[3]>>>14)&
4294967295}d=d+q.length&4294967295;for(k=q.length-4;f<=k;f+=4)g=f,d=d+(3266489917*(q[g]+(q[g+1]<<8))+(3266489917*(q[g+2]+(q[g+3]<<8))<<16))&4294967295,d=d<<17|d>>>15,d=668265263*(d&65535)+(668265263*(d>>>16)<<16)&4294967295;for(;f<q.length;++f)d+=374761393*q[f],d=d<<11|d>>>21,d=2654435761*(d&65535)+(2654435761*(d>>>16)<<16)&4294967295;d^=d>>>15;d=(2246822519*(d&65535)&4294967295)+(2246822519*(d>>>16)<<16);d^=d>>>13;d=(3266489917*(d&65535)&4294967295)+(3266489917*(d>>>16)<<16);d^=d>>>16;return 0>d?
d+4294967296:d};return b._createClass(p)}();a.XXH=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../support/basemapUtils ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/WebGLLayer ../../../layers/support/popupUtils ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa,ba,aa,da,ca,na,qa,ua,sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa){var Sa;const La=O.create(),Ua=H.create(),Va=x.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Sa=function(za){function Ga(xa){var ya=za.call(this,xa)||this;ya._propertiesPool=new ua.PropertiesPool({computedExtent:Ca},b._assertThisInitialized(ya));ya.computedExtent=null;ya.currentRenderer=null;ya.rendererHasGeometryOperations=
!1;ya._graphicStateTracking=null;ya.graphics3DGraphics=new Map;ya.stageLayer=null;ya.stage=null;ya._graphicsDrapedUids=new Set;ya._graphicsBySymbol=new Map;ya._symbolConversionCache=new Map;ya._symbols=new Map;ya._graphicsWithoutSymbol=new Map;ya._graphicsWaitingForSymbol=new Map;ya._graphicsUpdateId=0;ya._handles=new w;ya._frameTask=va.ImmediateTask;ya._suspendSymbolCleanup=!1;ya._arcadeOnDemand=null;ya._rendererChangeAbortController=null;ya._elevationInfoChangeAbortController=null;ya._initializeAbortController=
null;ya._scaleVisibility=null;ya._filterVisibility=null;ya._spatialIndex=null;ya.extentPadding=0;ya._updatingPendingLoadedGraphicsChange=null;ya._featureStore=null;ya._deconflictor=null;ya._labeler=null;ya._objectStates=null;ya._viewElevationProvider=null;ya._stageLayerElevationProvider=null;ya._sharedSymbolResourcesOwnerHandle=null;ya._whenGraphics3DGraphicRequests={};ya._pendingUpdates=new Map;ya._numberOfGraphics=0;ya._numberOfGraphicsProvidingElevation=0;ya._pendingAdds=0;ya._pendingRemoves=0;
ya._applyPendingRemovesFirst=!1;ya._loadingSymbols=0;ya._pendingUpdatesPool=new v({allocator:Ea=>Ea||new la,deallocator:Ea=>{Ea.clear();return Ea}});ya._symbolWarningLogged=!1;ya._geometryWarningLogged=!1;ya._objectIdInvisibleSet=new Set;ya._whenSymbolRemoved=new v;ya.preferredUpdatePolicy=pa.UpdatePolicy.SYNC;ya._forcedUpdatePolicy=null;ya.elevationFeatureExpressionEnabled=!0;ya.owner=null;ya.layer=null;ya.graphicSymbolSupported=!0;ya.getRenderingInfoWithoutRenderer=!1;ya.setUidToIdOnAdd=!0;ya.hasZ=
null;ya.hasM=null;ya._usedMemory=0;ya._visible=!1;ya._startCreateGraphics=!1;ya.symbolCreationContext=new ha.Graphics3DSymbolCreationContext(xa.owner.view.resourceController.scheduler,(Ea,Oa)=>ya._frameTask.schedule(Ea,Oa));return ya}b._inherits(Ga,za);var Fa=Ga.prototype;Fa._getConvertedSymbol=function(xa){if("web-style"===xa.type)return xa.clone();var ya=this._symbolConversionCache.get(xa.id);if(null!=ya)return ya;ya=V.to3D(xa,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(xa)});
const Ea=ya.symbol||null;null==Ea&&ya.error&&Va.error(ya.error.message);this._symbolConversionCache.set(xa.id,Ea);return Ea};Fa._getSymbolComplexitiesUsedOrRenderer=function(xa){if(null==xa)return[];var ya=xa.getSymbols(),Ea="backgroundFillSymbol"in xa?xa.backgroundFillSymbol:null;if(!(Ea||ya&&ya.length))return[];xa=[];Ea=this._getSymbolComplexityUsedOrRenderer(Ea);null!=Ea&&xa.push(Ea);for(const Oa of ya)ya=this._getSymbolComplexityUsedOrRenderer(Oa),null!=ya&&xa.push(ya);return xa};Fa._getSymbolComplexityUsedOrRenderer=
function(xa){if(null==xa)return null;const ya=this._symbols.get(xa.id);if(null!=ya)return ya.complexity;xa=this._getConvertedSymbol(xa);return null!=xa?ca.defaultSymbolComplexity(xa):null};Fa._getSymbolComplexitiesUsed=function(){const xa=[];this._symbols.forEach(ya=>{null!=ya&&xa.push(ya.complexity)});return xa};Fa.initialize=function(){this._featureStore=new ea.Graphics3DFeatureStore({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,
featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Ea=>this.graphics3DGraphics.forEach(Ea)});const xa=(Ea,Oa,bb)=>this.spatialIndex.queryGraphicUIDsInExtent(Ea,Oa,bb),{componentFactories:ya}=this;null!=ya.elevationAlignment&&(this._elevationAlignment=ya.elevationAlignment(this,xa));null!=ya.scaleVisibility&&(this._scaleVisibility=ya.scaleVisibility(this,xa));null!=ya.filterVisibility&&(this._filterVisibility=ya.filterVisibility({featureStore:this._featureStore,
getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Ea=>this.modifyGraphics3DGraphicVisibilities(Oa=>Oa.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,Y.VisibilityFlag.FILTER,Ea(W.getObjectId(Oa.graphic,this._objectIdField)))),setAllFeaturesVisibility:Ea=>this.modifyGraphics3DGraphicVisibilities(Oa=>Oa.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,Y.VisibilityFlag.FILTER,Ea)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Ea=>Ea.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,
Y.VisibilityFlag.FILTER,!0))}));null!=ya.deconflictor&&(this._deconflictor=ya.deconflictor(this));null!=ya.labeler&&null!=this._scaleVisibility&&(this._labeler=ya.labeler(this,this._scaleVisibility));null!=ya.objectStates&&(this._objectStates=ya.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()};Fa._initializeAsync=async function(){const xa=this._initializeAbortController?.signal,ya=this.owner.view;this._viewElevationProvider=new X.ViewElevationProvider(this._viewSpatialReference,
ya);this._initializeStage(ya,this.layer.uid);var Ea=ya.sharedSymbolResources;this.symbolCreationContext.sharedResources=Ea;this._sharedSymbolResourcesOwnerHandle=Ea.addGraphicsOwner(this.owner);null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Ea.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=ya.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;
this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new sa.GridLocalOriginFactory(ya.renderSpatialReference);this.symbolCreationContext.elevationProvider=ya.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Oa=>this.notifyGraphicGeometryChanged(Oa);this.symbolCreationContext.notifyGraphicVisibilityChanged=Oa=>this.notifyGraphicVisibilityChanged(Oa);Ea=Z.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);
this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(Ea,this._viewSpatialReference,xa,Va);B.throwIfAborted(xa);this.symbolCreationContext.screenSizePerspectiveEnabled=ya.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;this.symbolCreationContext.skipHighSymbolLods=
!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Oa}=this;this.symbolCreationContext.drapeSourceRenderer=ya.basemapTerrain.overlayManager.registerGeometryDrapeSource(Oa);this._handles.add(r.makeHandle(()=>ya.basemapTerrain.overlayManager.unregisterDrapeSource(Oa)))}this._handles.add([C.watch(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),C.watch(()=>[this.layer?.screenSizePerspectiveEnabled,
this.owner.view?.screenSizePerspectiveEnabled],()=>{const Oa=ya.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Oa!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Oa,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),C.watch(()=>this.owner.slicePlaneEnabled,Oa=>this._slicePlaneEnabledChange(!!Oa)),C.watch(()=>this.owner.view.state?.rasterPixelRatio,()=>this._pixelRatioChange()),C.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,
Oa=>this._physicalBasedRenderingChange(Oa)),C.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Oa=>this._skipHighSymbolLoDsChange(Oa)),C.when(()=>ya.basemapTerrain?.tilingScheme,Oa=>{Oa.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==ya.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=ya.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([C.on(()=>this.owner?.loadedGraphics,
"change",bb=>{this._graphicsCollectionChanged(bb);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),C.watch(()=>this.effectiveUpdatePolicy,Oa=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=Oa);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC;Oa===pa.UpdatePolicy.SYNC&&this.runTask(va.noBudget)},C.syncAndInitial)]);
this._frameTask=ya.resourceController.scheduler.registerTask(va.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this._handles.add(C.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null};Fa._abortInitialize=function(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=
null)};Fa.destroy=function(){this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTask.remove();this._frameTask=va.ImmediateTask;this.owner.view?.deconflictor?.removeGraphicsOwner(this);this.owner.view?.labeler?.removeGraphicsOwner(this);this._elevationAlignment=A.destroyMaybe(this._elevationAlignment);this._scaleVisibility=A.destroyMaybe(this._scaleVisibility);this._filterVisibility=A.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=
null;this._objectStates=A.destroyMaybe(this._objectStates);this.clear();this._featureStore=A.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=A.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=A.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stageLayer=A.destroyMaybe(this.stageLayer),this.stage=null);this._handles=A.destroyMaybe(this._handles);this._set("owner",null);for(const xa in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[xa].reject(new t("graphic:layer-destroyed",
"Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=A.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=A.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=A.destroyMaybe(this._spatialIndex)};Fa.clear=function(){this._objectStates?.allGraphicsDeleted();null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted();
this.graphics3DGraphics.forEach(xa=>xa.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(A.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("updating");
this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")};Fa._initializeStage=function(xa,ya){this.stage=xa._stage;this.stageLayer=new ka.WebGLLayer(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},ya);xa=this.stageLayer.events;xa.on("objectTransformation",Ea=>this.notifyGraphicGeometryChanged(Ea.graphicUid));xa.on("objectShaderTransformation",Ea=>this.notifyGraphicGeometryChanged(Ea.graphicUid));xa.on("visibilityChanged",
Ea=>this.notifyGraphicVisibilityChanged(Ea.graphicUid));xa.on("objectGeometryAdded",Ea=>this.notifyGraphicGeometryChanged(Ea.object.graphicUid));xa.on("objectGeometryRemoved",Ea=>this.notifyGraphicGeometryChanged(Ea.object.graphicUid));xa.on("objectGeometryUpdated",Ea=>this.notifyGraphicGeometryChanged(Ea.object.graphicUid))};Fa.notifyGraphicGeometryChanged=function(xa){null!=this._graphicStateTracking&&null!=xa&&(xa=this.graphics3DGraphics.get(xa))&&this._graphicStateTracking.updateGraphicGeometry(xa)};
Fa.notifyGraphicVisibilityChanged=function(xa){null!=this._graphicStateTracking&&null!=xa&&(xa=this.graphics3DGraphics.get(xa))&&this._graphicStateTracking.updateGraphicVisibility(xa)};Fa._updateLayerVisibility=function(){var xa=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;xa=!this.suspendedOrOutsideOfView&&!xa;xa!==this._visible&&((this._visible=xa)?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),
this._updateStageLayerVisibility())};Fa._updateStageLayerVisibility=function(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Fa.getGraphics3DGraphicById=function(xa){return null!=xa?this.graphics3DGraphics.get(xa):void 0};Fa.getGraphics3DGraphicByObjectId=function(xa){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(xa):null};Fa._getGraphicObjectID=function(xa,ya=this.owner.layer&&this.owner.layer.objectIdField){return W.getObjectId(xa,
ya)};Fa.updateLabelingInfo=async function(xa){const ya=this._deconflictor&&this._deconflictor.labelingInfoChange(xa);xa=this._labeler&&this._labeler.labelingInfoChange(xa);await B.eachAlways([ya,xa])};Fa.updateVisibilityInfo=function(){this._deconflictor&&this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()};Fa.runTask=function(xa){this._frameTask.processQueue(xa);this._applyPendingUpdates(xa);this.notifyChange("running");this.running||this.notifyChange("updating");
this.notifyChange("updatingRemaining");if(!xa.hasProgressed)return va.Task.YIELD};Fa.setObjectIdVisibility=function(xa,ya){ya?this._objectIdInvisibleSet.delete(xa):this._objectIdInvisibleSet.add(xa);xa=this._findGraphics3DGraphicByObjectId(xa);null!=xa&&this._updateUserVisibility(xa)};Fa._findGraphics3DGraphicByObjectId=function(xa){return D.findInMap(this.graphics3DGraphics,ya=>this._getGraphicObjectID(ya.graphic)===xa)};Fa._updateUserVisibility=function(xa){if(null==xa)return!1;var ya=xa.graphic;
const Ea=this._getGraphicObjectID(ya);ya=ya.visible&&!this.owner.suspended&&(null==Ea||!this._objectIdInvisibleSet.has(Ea));return xa.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,Y.VisibilityFlag.USER,ya)};Fa._whenGraphics3DGraphic=function(xa){var ya=this.graphics3DGraphics.get(xa.uid);if(ya)return Promise.resolve(ya);if(ya=this._whenGraphics3DGraphicRequests[xa.uid])return ya.promise;ya=B.createResolver();this._whenGraphics3DGraphicRequests[xa.uid]=ya;return ya.promise};Fa._boundsForGraphics3DGraphic=
async function(xa,ya){const Ea=this._viewSpatialReference,Oa=this.owner.view.renderSpatialReference,bb=this.owner.view.basemapTerrain.spatialReference;xa=await xa.getProjectedBoundingBox((nb,kb,wb)=>I.projectBuffer(nb,Oa,kb,nb,Ea,kb,wb),(nb,kb,wb)=>I.projectBuffer(nb,bb,kb,nb,Ea,kb,wb),this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=ya?!!ya.useViewElevation:!1,minDemResolution:null!=ya?ya.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:
null,ya?.signal);if(!xa)return null;ya=xa.boundingBox;if(xa.requiresDrapedElevation){var db=this.symbolCreationContext.elevationProvider;db&&(H.center(ya,La),db=db.getElevation(La[0],La[1],0,Ea,"ground")??0,ya[2]=Math.min(ya[2],db),ya[5]=Math.max(ya[5],db))}return{boundingBox:ya,screenSpaceObjects:xa.screenSpaceObjects}};Fa.whenGraphicBounds=async function(xa,ya){await C.whenOnce(()=>this.owner?.loadedGraphics);const Ea=this.owner.layer&&this.owner.layer.objectIdField;var Oa=this.owner.loadedGraphics.find(bb=>
bb===xa?!0:null!=Ea&&null!=bb.attributes&&xa.attributes&&bb.attributes[Ea]===xa.attributes[Ea]);if(!Oa)throw new t("internal:graphic-not-part-of-view","Graphic is not part of this view");Oa=await this._whenGraphics3DGraphic(Oa);return this._boundsForGraphics3DGraphic(Oa,ya)};Fa.computeAttachmentOrigin=function(xa,ya){xa=this.graphics3DGraphics.get(xa.uid);if(!xa)return null;var Ea=xa.computeAttachmentOrigin();if(0===Ea.render.num&&0===Ea.draped.num)return null;L.set(eb,0,0,0);xa=0;if(0<Ea.render.num){if(!I.projectVectorToVector(Ea.render.origin,
this.symbolCreationContext.renderCoordsHelper.spatialReference,ib,ya))return null;L.add(eb,eb,ib);xa++}if(0<Ea.draped.num){const [Oa,bb]=Ea.draped.origin;Ea=this._viewElevationProvider.getElevation(Oa,bb,"ground")??0;L.set(ib,Oa,bb,Ea);if(!I.projectVectorToVector(ib,this._viewElevationProvider.spatialReference,ib,ya))return null;L.add(eb,eb,ib);xa++}1<xa&&L.scale(eb,eb,1/xa);return new Ba({x:eb[0],y:eb[1],z:eb[2],spatialReference:ya})};Fa.getSymbolLayerSize=function(xa,ya){var Ea=this._symbols.get(xa.id);
if(null==Ea)throw new t("internal:symbol-not-part-of-view","Symbol is not part of this view");xa=xa.symbolLayers.indexOf(ya);if(-1===xa)throw new t("internal:missing-symbol-layer","Symbol layer is not in symbol");Ea=Ea.getSymbolLayerSize(xa);if(null==Ea)throw new t("internal:missing-size","Symbol layer has no valid size");return Ea};Fa._graphicsCollectionChanged=function(xa){this._startCreateGraphics&&(this.add(xa.added),this.remove(xa.removed))};Fa.graphicUpdateHandler=function(xa){const ya=xa.graphic.uid,
Ea=this.graphics3DGraphics.get(ya);if(null!=Ea||null!=this._graphicsWithoutSymbol.get(ya))switch(xa.property){case "visible":this._graphicUpdateVisibleHandler(Ea);break;case "geometry":this._graphicUpdateGeometryHandler(Ea,xa);break;case "symbol":this._graphicUpdateSymbolHandler(Ea,xa);break;case "origin-transform":this._graphicUpdateTransformHandler(Ea,xa)}};Fa._graphicUpdateGeometryHandler=function(xa,ya){this._graphicUpdateGeometryOrTransformHandler(xa,ya,()=>null!=ya.newValue&&null!=xa&&xa.graphics3DSymbol.updateGeometry(xa,
ya.newValue));const Ea=ya.graphic.geometry;null!=Ea&&this._expandComputedExtent(Ea)};Fa._graphicUpdateTransformHandler=function(xa,ya){const Ea=ya.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(xa,ya,()=>null!=ya.newValue&&null!=xa&&null!=Ea&&xa.graphics3DSymbol.updateTransform(xa,Ea.spatialReference,ya.newValue,ya.action))};Fa._graphicUpdateGeometryOrTransformHandler=function(xa,ya,Ea){if(null==ya.graphic.geometry)this._recreateGraphic(ya.graphic);else if(null==xa){if(xa=ya.graphic.symbol&&
ya.graphic.symbol.id)if(xa=this._symbols.get(xa),null!=xa&&xa.loadStatus===aa.LoadStatus.LOADING)return;this._recreateGraphic(ya.graphic)}else Ea()||this._recreateGraphic(xa.graphic)};Fa._graphicUpdateSymbolHandler=function(xa,ya){var Ea=ya.graphic;const Oa=null!=xa?xa.graphics3DSymbol:null!=ya.oldValue?this._symbols.get(ya.oldValue.id):null;if(null==Oa||null==ya.newValue)this._recreateGraphic(Ea);else{var bb=Oa.symbol;ya=this._getConvertedSymbol(ya.newValue);if(null!=ya&&(ya.type!==bb.type||"web-style"===
ya.type)||"web-style"===bb.type)this._recreateGraphic(Ea);else{var db=this._graphicsBySymbol.get(bb.id);if(db&&1!==db.size)this._recreateGraphic(Ea);else if(db=G.diff(bb,ya),null==db)this._updateSymbolMapping(bb.id,ya);else if(db={diff:db,graphics3DGraphicPatches:[],symbolStatePatches:[]},Oa.prepareSymbolPatch(db),G.isEmpty(db.diff)){var nb=this._getRenderingInfo(Ea);if(null==nb)this._recreateGraphic(Ea);else{Ea=Oa.extentPadding;for(const kb of db.symbolStatePatches)kb();Ea!==Oa.extentPadding&&this._recomputeExtentPadding();
if(null!=xa)for(const kb of db.graphics3DGraphicPatches)kb(xa,nb);this._updateSymbolMapping(bb.id,ya)}}else this._recreateGraphic(Ea)}}};Fa._graphicUpdateVisibleHandler=function(xa){this._updateUserVisibility(xa)&&(this._labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Fa.recreateGraphics=function(xa){this._suspendSymbolCleanup=!0;this.remove(xa);this.add(xa);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===pa.UpdatePolicy.SYNC&&this._cleanupSymbols()};
Fa._recreateGraphic=function(xa){this.recreateGraphics([xa])};Fa._beginGraphicUpdate=function(xa){const ya=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(xa.uid,ya);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("updating");return ya};Fa._endGraphicUpdate=function(xa){xa&&(this._graphicsWaitingForSymbol.delete(xa.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Fa._recomputeExtentPadding=function(){let xa=
0;this._symbols.forEach(ya=>{null!=ya&&(xa=Math.max(xa,ya.extentPadding))});this._set("extentPadding",xa)};Fa._expandComputedExtent=function(xa){var ya=xa.spatialReference;W.computeAABB(xa,Ua);xa=this._viewSpatialReference;var Ea=Sa.tmpVec;!N.equals(ya,xa)&&I.projectXYZToVector(Ua[0],Ua[1],0,ya,Ea,xa)&&(Ua[0]=Ea[0],Ua[1]=Ea[1],I.projectXYZToVector(Ua[3],Ua[4],0,ya,Ea,xa),Ua[3]=Ea[0],Ua[4]=Ea[1]);if(isFinite(Ua[0])&&isFinite(Ua[3])&&isFinite(Ua[1])&&isFinite(Ua[4])){ya=this.computedExtent;Ea=null;
var Oa=isFinite(Ua[2])&&isFinite(Ua[5]),bb=Oa&&(!ya||null==ya.zmin||Ua[2]<ya.zmin);Oa=Oa&&(!ya||null==ya.zmax||Ua[5]>ya.zmax);if(ya){if(Ua[0]<ya.xmin||Ua[1]<ya.ymin||Ua[3]>ya.xmax||Ua[4]>ya.ymax||bb||Oa)Ea=this._propertiesPool.get("computedExtent"),Ea.xmin=Math.min(Ua[0],ya.xmin),Ea.ymin=Math.min(Ua[1],ya.ymin),Ea.xmax=Math.max(Ua[3],ya.xmax),Ea.ymax=Math.max(Ua[4],ya.ymax),Ea.spatialReference=xa}else Ea=this._propertiesPool.get("computedExtent"),Ea.xmin=Ua[0],Ea.ymin=Ua[1],Ea.xmax=Ua[3],Ea.ymax=
Ua[4],Ea.spatialReference=xa;Ea&&(bb&&(Ea.zmin=Ua[2]),Oa&&(Ea.zmax=Ua[5]),this._set("computedExtent",Ea))}};Fa._abortElevationInfoChange=function(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)};Fa.elevationInfoChange=async function(){this._abortElevationInfoChange();const xa=new AbortController;this._elevationInfoChangeAbortController=xa;const ya=Z.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);
this.symbolCreationContext.featureExpressionInfoContext=await Z.createContext(ya,this._viewSpatialReference,xa.signal,Va);B.throwIfAborted(xa.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Ea,Oa,bb)=>{Ea.globalPropertyChanged("elevationInfo",Oa)?Oa.forEach(db=>{const nb=db.graphic;db=db.labelLayers;for(const kb of db)kb.graphics3DSymbolLayer.updateGraphicElevationContext(nb,kb)}):this._recreateSymbol(bb)});this.updateStageLayerElevationProvider();
this._elevationAlignment?.elevationInfoChange()};Fa.updateStageLayerElevationProvider=function(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=A.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==
this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new na.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))};Fa._clearSymbolsAndGraphics=function(){this.clear();null!=this._filterVisibility&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();
this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=A.disposeMaybe(this._stageLayerElevationProvider))};Fa.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Fa.recreateAllGraphics=function(){this._recreateAllGraphics(!1)};Fa.recreateAllGraphicsAndSymbols=function(){this._recreateAllGraphics(!0)};Fa._recreateAllGraphics=function(xa=!1){if(this._startCreateGraphics){var {loadedGraphics:ya,
view:Ea}=this.owner,Oa=Ea.basemapTerrain.tilingScheme&&ya&&ya.length?ya.toArray():null;!xa&&Oa||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Oa&&(xa?this.add(Oa):this.recreateGraphics(Oa))}};Fa._recreateSymbol=function(xa){var ya=this._graphicsBySymbol.get(xa);
const Ea=[];ya&&(ya.forEach((Oa,bb)=>{const db=Oa.usedMemory;this._conditionalRemove(Oa,bb);this._spatialIndex?.remove(Oa);Ea.push(Oa.graphic);Oa.destroy();this._removeGraphics3DGraphic(bb,db);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(xa,new Map));ya=this._symbols.get(xa);A.destroyMaybe(ya);this._symbols.delete(xa);this.add(Ea)};Fa._recreateGraphicsForSymbol=function(xa){if(xa=this._graphicsBySymbol.get(xa)){const ya=[];xa.forEach(Ea=>ya.push(Ea.graphic));
this.recreateGraphics(ya)}};Fa._conditionalRemove=function(xa,ya){this._graphicsDrapedUids.delete(ya);this._objectStates?.removeGraphic(xa);this._labeler?.removeGraphic(xa);this._deconflictor?.removeGraphic(xa);null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(xa)};Fa.add=function(xa){xa&&0!==xa.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(xa)===pa.UpdatePolicy.ASYNC?this._addDelayed(xa):this._addImmediate(xa),
this.notifyChange("updating")):Va.error("#add()","Cannot add graphics before terrain surface has been initialized"))};Fa._updatePolicyForGraphics=function(xa){if(this.effectiveUpdatePolicy===pa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const ya of xa)if(null!=ya.geometry&&"mesh"===ya.geometry.type&&!ya.geometry.loaded)return pa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};Fa._addImmediate=function(xa){this._symbolWarningLogged=this._geometryWarningLogged=
!1;for(const ya of xa)this._addGraphic(ya,this._getRenderingInfo(ya,Va),pa.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};Fa._addDelayed=function(xa){for(const ya of xa){xa=ya.uid;let Ea=this._pendingUpdates.get(xa);Ea?Ea.add?Ea.state!==cb.NEW&&Ea.abortController?.abort():this._pendingAdds++:(Ea=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(xa,Ea));Ea.add=
ya}this.notifyChange("running");this.notifyChange("updatingRemaining")};Fa.remove=function(xa){this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?this._removeDelayed(xa):this._removeImmediate(xa);this.notifyChange("updating")};Fa._removeImmediate=function(xa){for(const ya of xa)this._removeGraphic(ya);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Fa._removeDelayed=function(xa){for(const Ea of xa){xa=Ea.uid;var ya=this._pendingUpdates.get(xa);
ya?ya.add&&(ya.remove?ya.add=null:this._pendingUpdates.delete(xa),ya.state===cb.LOADING&&ya.abortController?.abort(),this._pendingAdds--):(ya=this._pendingUpdatesPool.pushNew(),ya.remove=Ea,this._pendingUpdates.set(xa,ya),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};Fa._finishPendingUpdates=function(){this._pendingUpdatesPool.clear();this._cleanupSymbols();
(this._pendingAdds||this._pendingRemoves)&&Va.warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1};Fa._applyPendingUpdates=function(xa){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),xa.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [ya,Ea]of this._pendingUpdates){if(xa.done){this._applyPendingRemovesFirst=
!0;break}if(Ea.remove&&!Ea.add&&(this._pendingRemoves--,xa.madeProgress(),this._removeGraphic(Ea.remove),Ea.remove=null,this._pendingUpdates.delete(ya),0===this._pendingRemoves))break}}for(const [ya,Ea]of this._pendingUpdates){if(xa.done)break;Ea.add&&Ea.state===cb.NEW&&this._processPendingUpdateNew(Ea);let Oa=this.effectiveUpdatePolicy;!Ea.remove||Ea.add&&Ea.state!==cb.READY||(this._pendingRemoves--,xa.madeProgress(),this._removeGraphic(Ea.remove),Ea.remove=null,Oa=pa.UpdatePolicy.SYNC);if(Ea.add)switch(Ea.state){case cb.READY:this._addGraphic(Ea.add,
Ea.renderingInfo,Oa);Ea.add=null;this._pendingAdds--;xa.madeProgress();break;case cb.REJECTED:Ea.add=null,this._pendingAdds--}null==Ea.remove&&null==Ea.add&&this._pendingUpdates.delete(ya)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};Fa._processPendingUpdateNew=function(xa){if(xa.add){var ya=xa.add.geometry;null==ya||"mesh"!==ya.type||ya.loaded?this._processPendingUpdateNewRenderingInfo(xa):this._processPendingUpdateNewMesh(xa,ya)}else xa.state=cb.READY};
Fa._processPendingUpdateNewMesh=async function(xa,ya){xa.state=cb.LOADING;xa.abortController=new AbortController;const Ea=xa.abortController.signal;try{await ya.load({signal:Ea})}catch(Oa){return this._processPendingUpdateNewError(xa,Oa)}xa.abortController=null;this._processPendingUpdateNewRenderingInfo(xa)};Fa._processPendingUpdateNewError=function(xa,ya){xa.abortController=null;B.isAbortError(ya)?xa.state=cb.NEW:xa.state=cb.REJECTED};Fa._processPendingUpdateNewRenderingInfo=async function(xa){if(null==
this.layer.renderer||"dictionary"!==this.layer.renderer.type)xa.renderingInfo=this._getRenderingInfo(xa.add,Va);else{xa.state=cb.LOADING;xa.abortController=new AbortController;var ya=null;try{ya=await this._getRenderingInfoAsync(xa.add,{signal:xa.abortController.signal})}catch(Ea){xa.abortController=null;B.isAbortError(Ea)?xa.state=cb.NEW:xa.state=cb.REJECTED;return}null==ya||null==ya.symbol?(Va&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Va.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),
xa.renderingInfo=null):xa.renderingInfo=ya}xa.state=cb.READY};Fa._addGraphic=function(xa,ya,Ea){this._graphicsWithoutSymbol.set(xa.uid,xa);if(null!=ya&&null!=ya.symbol&&W.hasGeometry(xa)){if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){const sb=S.isBasemapLayer(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(xa.objectId,xa.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!sb&&ra.hasPopupTemplate(this.layer,
this.owner.view.popup?.defaultPopupTemplateEnabled))}var Oa=this.getOrCreateGraphics3DSymbol(ya.symbol,ya.renderer);if(null!=Oa){this._expandComputedExtent(xa.geometry);var bb=this._beginGraphicUpdate(xa),db=new ja(xa,ya,this.layer),nb=!1,kb=sb=>{sb===Oa.symbol.id&&(nb=!0)};this._whenSymbolRemoved.push(kb);var wb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(kb);if(this._graphicsWaitingForSymbol.get(xa.uid)!==bb||nb||Oa.destroyed||this.graphicSymbolSupported&&
xa.symbol&&xa.symbol.id!==Oa.symbol.id)--Oa.referenced,this._cleanupSymbols();else{const sb=this._createGraphics3DGraphic(Oa,db);this._spatialIndex&&null!=sb&&this._spatialIndex.add(sb);--Oa.referenced;this._endGraphicUpdate(xa)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},vb=sb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(kb),nb||(B.isAbortError(sb)?this.add([xa]):Oa.destroyed||this._endGraphicUpdate(xa)))};++this._loadingSymbols;
Ea===pa.UpdatePolicy.ASYNC?Oa.load(()=>this._frameTask.schedule(wb),sb=>this._frameTask.schedule(()=>vb(sb))):Oa.load(wb,vb)}}};Fa._removeGraphic=function(xa){xa=xa.uid;const ya=this.graphics3DGraphics.get(xa);if(ya){ya.graphics3DSymbol.onRemoveGraphic(ya);const Ea=ya.usedMemory,Oa=ya.isElevationSource;this._conditionalRemove(ya,xa);this._spatialIndex?.remove(ya);this._graphicsBySymbol.get(ya.graphics3DSymbol.symbol.id)?.delete(xa);this._graphicsWithoutSymbol.delete(xa);this._removeGraphics3DGraphic(xa,
Ea,Oa);ya.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(xa),this._graphicsWaitingForSymbol.delete(xa),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Fa._hasLabelingContext=function(xa){if(xa instanceof Ha||xa instanceof Ma){const ya=this.symbolCreationContext.layer;return ya.labelingInfo?ya.labelingInfo.some(Ea=>Ea.symbol===xa):!1}return!1};Fa._hasValidSymbolCreationContext=function(xa){return xa instanceof
Ha&&!this._hasLabelingContext(xa)?(Va.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Fa._getRenderingInfo=function(xa,ya){const Ea=xa.geometry;if(null==Ea)return ya&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!I.canProjectWithoutEngine(Ea.spatialReference,this._viewSpatialReference))return ya&&!this._geometryWarningLogged&&
(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&null!=xa.symbol)return ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;xa=this.rendererHasGeometryOperations?T.hydrateGraphic(xa,this.layer):xa;xa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
null!=this.currentRenderer)?this.owner.getRenderingInfo(xa,this.currentRenderer,this._arcadeOnDemand):{symbol:xa.symbol||U.getDefaultSymbol3D(xa.geometry)};return null==xa||null==xa.symbol?(ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):xa};Fa._getRenderingInfoAsync=function(xa,ya){if(null==xa.geometry)return Va&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Va.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),
null;if(!this.graphicSymbolSupported&&null!=xa.symbol)return Va&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Va.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;xa=this.rendererHasGeometryOperations?T.hydrateGraphic(xa,this.layer):xa;return this.owner.getRenderingInfoAsync(xa,this.currentRenderer,this._arcadeOnDemand,ya)};Fa._createGraphics3DSymbol=function(xa,ya){if(!this._hasValidSymbolCreationContext(xa))return null;xa=this._getConvertedSymbol(xa);
if(!xa)return null;let Ea;null!=ya&&"backgroundFillSymbol"in ya&&ya.backgroundFillSymbol&&(ya=V.to3D(ya.backgroundFillSymbol,{ignoreDrivers:!0}),null!=ya.symbol&&"web-style"!==ya.symbol.type&&"cim"!==ya.symbol.type&&(Ea=ya.symbol.symbolLayers));const Oa=ia.make(xa,this.symbolCreationContext,Ea);Oa.load(()=>{const bb=Oa.extentPadding;bb>this.extentPadding&&this._set("extentPadding",bb);this.notifyChange("averageSymbolComplexity")},()=>{});return Oa};Fa.getOrCreateGraphics3DSymbol=function(xa,ya){let Ea=
this._symbols.get(xa.id);void 0===Ea&&(Ea=xa instanceof Qa?new oa(xa,Oa=>this._frameTask.schedule(Oa),Oa=>this._createGraphics3DSymbol(Oa,ya)):this._createGraphics3DSymbol(xa,ya),this._symbols.set(xa.id,Ea));null!=Ea&&++Ea.referenced;return Ea};Fa.trackGraphicState=function(xa){null==this._graphicStateTracking&&(this._graphicStateTracking=new ma.GraphicStateTracking(this));return this._graphicStateTracking.add(xa)};Fa._addGraphics3DGraphic=function(xa){this._usedMemory+=xa.usedMemory;this.graphics3DGraphics.set(xa.graphic.uid,
xa);this._numberOfGraphics++;xa.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Fa._removeGraphics3DGraphic=function(xa,ya,Ea=!1){this._usedMemory-=ya;this.graphics3DGraphics.delete(xa);this._numberOfGraphics--;Ea&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Fa._createGraphics3DGraphic=function(xa,ya){const Ea=ya.graphic;this._graphicsWithoutSymbol.delete(Ea.uid);
if(!this._symbols.has(xa.symbol.id))return this.add([Ea]),null;if(this.graphics3DGraphics.has(Ea.uid))return null;ya=xa.createGraphics3DGraphic(ya);if(null==ya)return null;this._addGraphics3DGraphic(ya);xa=xa.symbol.id;this._graphicsBySymbol.has(xa)||this._graphicsBySymbol.set(xa,new Map);this._graphicsBySymbol.get(xa).set(Ea.uid,ya);ya.isDraped&&this._graphicsDrapedUids.add(Ea.uid);ya.centroid=null;null!=Ea.geometry&&"point"!==Ea.geometry.type&&(ya.centroid=fa.computeCentroid(Ea.geometry,this._viewSpatialReference));
this._updateUserVisibility(ya);null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(ya);null!=this._filterVisibility&&({defaultVisibility:xa}=this._filterVisibility,ya.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,Y.VisibilityFlag.FILTER,xa),xa||this._filterVisibility.reapply());this._deconflictor?.addGraphic(ya);this._labeler?.addGraphic(ya);this._objectStates?.addGraphic(ya);this._deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ya);ya.initialize(this.stageLayer,
this.owner);null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(ya);if(xa=this._whenGraphics3DGraphicRequests[Ea.uid])delete this._whenGraphics3DGraphicRequests[Ea.uid],xa.resolve(ya);return ya};Fa._abortRendererChange=function(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)};Fa.rendererChange=async function(xa){this._abortRendererChange();if(xa!==this.currentRenderer)if(this._validateRenderer(xa),null==
xa&&this._currentRendererChange(null,!1),P.isSupportedRenderer3D(xa))if(null!=xa&&xa.arcadeRequired){var ya=new AbortController;this._rendererChangeAbortController=ya;const {arcadeUtils:Ea}=await this._ensureArcade();B.throwIfAborted(ya);const Oa=Ea.hasGeometryOperations(xa);Oa&&(await Ea.enableGeometryOperations(),B.throwIfAborted(ya));this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?await this._frameTask.schedule(()=>this._currentRendererChange(xa,Oa),ya.signal):this._currentRendererChange(xa,
Oa);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=ya=new AbortController,await this._frameTask.schedule(()=>this._currentRendererChange(xa,!1),ya.signal),this._rendererChangeAbortController=null):this._currentRendererChange(xa,!1);else this._currentRendererChange(xa,!1)};Fa._ensureArcade=async function(){null==this._arcadeOnDemand&&(this._arcadeOnDemand=await Q.loadArcade());return this._arcadeOnDemand};Fa._currentRendererChange=
function(xa,ya){this.currentRenderer=xa;this.rendererHasGeometryOperations=ya;this.symbolCreationContext.arcade=this._arcadeOnDemand;ya=this.symbolCreationContext.renderer;if(xa!==ya)if(this._symbolConversionCache.clear(),null==xa)this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Ea=G.diff(ya,xa);this._updateUnchangedSymbolMappings(Ea,xa,ya);this.symbolCreationContext.renderer=xa;null!=Ea&&("complete"===Ea.type?this.recreateAllGraphicsAndSymbols():"partial"===
Ea.type&&(this._applyRendererDiff(Ea,xa,ya)?this._volatileGraphicsUpdated():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};Fa._diffHasSymbolChange=function(xa){for(const ya in xa.diff)switch(ya){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete xa.diff[ya];break;default:return!0}return!1};Fa._applySymbolSetDiff=function(xa,ya,Ea){xa=xa||[];ya=ya||[];const Oa=[];
for(const bb of ya){const db=this._graphicsBySymbol.get(bb.id);db&&db.forEach((nb,kb)=>{var wb=nb.graphic,vb=this.layer instanceof R?this.layer:null;const sb=this._arcadeOnDemand;if(bb!==Ea.defaultSymbol||Ea.getSymbol(T.hydrateGraphic(wb,vb),{arcade:sb})!==Ea.defaultSymbol)vb=nb.usedMemory,xa.length||Ea.defaultSymbol?Oa.push(wb):this._graphicsWithoutSymbol.set(kb,wb),wb=this.graphics3DGraphics.get(kb),this._conditionalRemove(wb,kb),nb.destroy(),db.delete(kb),this._removeGraphics3DGraphic(kb,vb),this._updateLayerVisibility()});
this._whenSymbolRemoved.forAll(nb=>nb(bb.id))}if(xa.length||Oa.length)this._graphicsWithoutSymbol.forEach(bb=>Oa.push(bb)),this._graphicsWithoutSymbol.clear(),this.add(Oa);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Fa._applyUniqueValueRendererDiff=function(xa,ya,Ea){const Oa=xa.diff.defaultSymbol,bb=xa.diff.uniqueValueInfos;if(Oa||bb){const db=bb?bb.added.map(kb=>kb.symbol).filter(l.isSome):[],nb=bb?bb.removed.map(kb=>kb.symbol).filter(l.isSome):
[];if(bb)for(let kb=0;kb<bb.changed.length;kb++)db.push(bb.changed[kb].newValue.symbol),nb.push(bb.changed[kb].oldValue.symbol);Oa?(Ea.defaultSymbol&&nb.push(Ea.defaultSymbol),ya.defaultSymbol&&db.push(ya.defaultSymbol)):Ea.defaultSymbol&&db.length&&nb.push(ya.defaultSymbol);this._applySymbolSetDiff(db,nb,ya);delete xa.diff.defaultSymbol;delete xa.diff.uniqueValueInfos;return!0}return!1};Fa._calculateUnchangedSymbolMapping=function(xa,ya,Ea){if("unique-value"!==ya?.type||"unique-value"!==Ea?.type||
null!=xa&&"partial"!==xa.type)return[];const Oa=db=>null!=db?db.id:null;var bb=xa&&xa.diff;xa=bb&&bb.defaultSymbol;if(bb=bb&&bb.uniqueValueInfos)bb=bb.unchanged.map(db=>({oldId:Oa(db.oldValue.symbol),newId:Oa(db.newValue.symbol)}));else{bb=[];for(const db of Ea.uniqueValueInfos??[]){const nb=Oa(db.symbol),kb=ya.uniqueValueInfos?.find(wb=>wb.value===db.value);kb&&nb!==Oa(kb.symbol)&&bb.push({oldId:nb,newId:Oa(kb.symbol)})}}!xa&&Ea.defaultSymbol&&bb.push({oldId:Oa(Ea.defaultSymbol),newId:Oa(ya.defaultSymbol)});
return bb};Fa._updateSymbolMapping=function(xa,ya){const Ea=null!=ya&&ya?"string"===typeof ya?ya:ya.id:null;if(null!=xa&&xa!==Ea){var Oa=this._graphicsBySymbol.get(xa);this._graphicsBySymbol.delete(xa);void 0!==Oa&&this._graphicsBySymbol.set(Ea,Oa);Oa=this._symbols.get(xa);void 0!==Oa&&(this._symbols.delete(xa),this._symbols.set(Ea,Oa),null!=Oa&&(xa="string"===typeof ya?null:ya,null!=xa?Oa.symbol=xa:Oa.symbol.id=Ea))}};Fa._updateUnchangedSymbolMappings=function(xa,ya,Ea){xa=this._calculateUnchangedSymbolMapping(xa,
ya,Ea);for(const {oldId:Oa,newId:bb}of xa)this._updateSymbolMapping(Oa,bb)};Fa._applyRendererDiff=function(xa,ya,Ea){if(this._diffHasSymbolChange(xa))return!1;if(ya instanceof e&&Ea instanceof e&&this._applyUniqueValueRendererDiff(xa,ya,Ea)&&0===Object.keys(xa.diff).length)return!0;for(const [Oa]of this._graphicsBySymbol)if(Ea=this._symbols.get(Oa),null!=Ea)switch(Ea.applyRendererDiff(xa,ya)){case ba.ApplyRendererDiffResult.RecreateSymbol:this._recreateSymbol(Oa);break;case ba.ApplyRendererDiffResult.RecreateGraphics:this._recreateGraphicsForSymbol(Oa)}return!0};
Fa.opacityChange=function(){this.forEachGraphics3DSymbol((xa,ya)=>xa.globalPropertyChanged("opacity",ya));this._updateStageLayerVisibility()};Fa._slicePlaneEnabledChange=function(xa){xa!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=xa,this.stageLayer.sliceable=xa,this.forEachGraphics3DSymbol((ya,Ea)=>ya.globalPropertyChanged("slicePlaneEnabled",Ea)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),this._labeler&&this._labeler.slicePlaneEnabledChange())};
Fa._physicalBasedRenderingChange=function(xa){this.symbolCreationContext.physicalBasedRenderingEnabled=xa;this.forEachGraphics3DSymbol((ya,Ea,Oa)=>{ya.globalPropertyChanged("physicalBasedRenderingEnabled",Ea)||this._recreateSymbol(Oa)})};Fa._skipHighSymbolLoDsChange=function(xa){this.symbolCreationContext.skipHighSymbolLods=xa;this.forEachGraphics3DSymbol((ya,Ea,Oa)=>{ya.globalPropertyChanged("skipHighSymbolLods",Ea)||this._recreateSymbol(Oa)})};Fa._pixelRatioChange=function(){this.forEachGraphics3DSymbol((xa,
ya,Ea)=>{xa.globalPropertyChanged("pixelRatio",ya)||this._recreateSymbol(Ea)})};Fa._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=E.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Fa.setClippingExtent=function(xa,ya){const Ea=this.symbolCreationContext.clippingExtent,Oa=J.create();qa.toBoundingRect(xa,Oa,ya)?this.symbolCreationContext.clippingExtent=
H.fromRect(H.create(),Oa):this.symbolCreationContext.clippingExtent=null;return!H.equals(this.symbolCreationContext.clippingExtent,Ea)};Fa.modifyGraphics3DGraphicVisibilities=function(xa){if(!this.destroyed){var ya=!1;this.graphics3DGraphics.forEach(Ea=>{xa(Ea)&&(ya=!0)});ya&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor?.setDirty())}};Fa.forEachGraphics3DSymbol=function(xa){for(const [ya,Ea]of this._symbols){if(null==Ea)break;const Oa=this._graphicsBySymbol.get(ya);xa(Ea,Oa||
Pa,ya)}};Fa.updateAllGraphicsVisibility=function(){null!=this._filterVisibility&&this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(xa=>{const ya=this._updateUserVisibility(xa);xa=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(xa);return ya||xa})};Fa._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(xa=>xa.setVisibilityFlag(Y.VisibilityGroup.GRAPHIC,Y.VisibilityFlag.USER,!1))};Fa._validateRenderer=function(xa){(xa=P.validateTo3D(xa,{geometryType:this.layer?.geometryType}))&&
Va.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,xa.message)};Fa._volatileGraphicsUpdated=function(){this._labeler?.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Fa._cleanupSymbols=function(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var xa=!1;this._symbols.forEach((ya,Ea)=>{if(!(null==ya||0<ya.referenced)){var Oa=this._graphicsBySymbol.get(Ea);Oa&&
0!==Oa.size||(this._graphicsBySymbol.delete(Ea),this._symbols.delete(Ea),A.destroyMaybe(ya),xa=!0)}});xa&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};b._createClass(Ga,[{key:"_viewSpatialReference",get:function(){return this.owner.view.spatialReference}},{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new da.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),
this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}},{key:"numberOfGraphics",get:function(){return this._numberOfGraphics}},{key:"effectiveUpdatePolicy",get:function(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?pa.UpdatePolicy.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}},{key:"featureStore",get:function(){return this._featureStore}},{key:"initializePromise",get:function(){return this._initializePromise}},
{key:"scaleVisibility",get:function(){return this._scaleVisibility}},{key:"elevationAlignment",get:function(){return this._elevationAlignment}},{key:"objectStates",get:function(){return this._objectStates}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"updating",get:function(){return!!(0<this._graphicsWaitingForSymbol.size||this.running||this._elevationAlignment?.updating||null!=this._scaleVisibility&&this._scaleVisibility.updating||null!=this._filterVisibility&&this._filterVisibility.updating||
this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||0<this._loadingSymbols)}},{key:"running",get:function(){return 0<this._pendingUpdates.size||!!this._spatialIndex?.updating}},{key:"suspendedOrOutsideOfView",get:function(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}},{key:"updatingRemaining",get:function(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||
0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}},{key:"displayFeatureLimit",get:function(){var xa=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ya=xa?xa.graphics3D.minTotalNumberOfFeatures:0,Ea=xa?xa.graphics3D.maxTotalNumberOfFeatures:0;xa=xa?xa.graphics3D.maxTotalNumberOfPrimitives:0;const Oa=this.averageSymbolComplexity,bb=Math.max(ya,Math.min(Ea,Math.ceil(xa/Math.max(1,null!=Oa?Oa.primitivesPerFeature:1)),null!=Oa&&0<Oa.drawCallsPerFeature?Ea/Oa.drawCallsPerFeature*
.3:Ea)),db=this._get("displayFeatureLimit");return db&&db.minimumTotalNumberOfFeatures===ya&&db.maximumTotalNumberOfFeatures===Ea&&db.maximumTotalNumberOfPrimitives===xa&&db.averageSymbolComplexity===Oa&&db.maximumNumberOfFeatures===bb?db:{minimumTotalNumberOfFeatures:ya,maximumTotalNumberOfFeatures:Ea,maximumTotalNumberOfPrimitives:xa,averageSymbolComplexity:Oa,maximumNumberOfFeatures:bb}}},{key:"averageSymbolComplexity",get:function(){const xa=ca.averageSymbolComplexities(this._symbolComplexities),
ya=this._get("averageSymbolComplexity");return 0===xa.numComplexities||null!=ya&&(xa.estimated&&(ya.primitivesPerFeature>=xa.primitivesPerFeature||ya.primitivesPerCoordinate>=xa.primitivesPerCoordinate||ya.drawCallsPerFeature>=xa.drawCallsPerFeature)||ya.primitivesPerFeature===xa.primitivesPerFeature&&ya.primitivesPerCoordinate===xa.primitivesPerCoordinate&&ya.drawCallsPerFeature===xa.drawCallsPerFeature)?ya:xa}},{key:"usedMemory",get:function(){const xa=null!=this.averageSymbolComplexity&&this.labelsEnabled?
this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,ya=this._getSymbolComplexitiesUsed().reduce((Ea,Oa)=>Ea+Oa.memory.resourceBytes,0);return this._usedMemory+xa+ya}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):null!=this.averageSymbolComplexity?this.averageSymbolComplexity.memory.bytesPerFeature+
(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}},{key:"_symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"visible",get:function(){return this._visible}},{key:"_objectIdField",get:function(){return this.layer.objectIdField}},
{key:"graphics3DGraphicsByObjectID",get:function(){const xa=this.owner.layer&&this.owner.layer.objectIdField;if(xa){var ya=new Map;this.graphics3DGraphics.forEach(Ea=>{if(Ea){var Oa=this._getGraphicObjectID(Ea.graphic,xa);null!=Oa&&ya.set(Oa,Ea)}});return ya}}},{key:"labelsEnabled",get:function(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this._pendingUpdates.size)return"unknown";let xa=0,ya=0;return D.someMap(this._symbols,(Ea,Oa)=>
{if(null!=Ea){Ea=Ea.getFastUpdateStatus();if(0<Ea.loading)return!0;this._graphicsBySymbol.has(Oa)&&(ya+=Ea.fast,xa+=Ea.slow)}return!1})?"unknown":0<=ya&&0===xa?"fast":0<=xa&&0===ya?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(xa=>({symbolId:xa,graphics:[...this._graphicsBySymbol.get(xa).keys()].sort()})),graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),
graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:xa=>{this._forcedUpdatePolicy=xa}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this._graphicsWithoutSymbol.size,pending:this._pendingUpdates.size}}}]);return Ga}(n);a.Graphics3DCore.tmpVec=O.create();c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,
"computedExtent",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_elevationInfoChangeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_initializePromise",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_spatialIndex",void 0);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_labeler",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"_objectStates",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([F.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"owner",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"componentFactories",void 0);c.__decorate([F.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"featureStore",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"initializePromise",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,"objectStates",null);c.__decorate([F.property()],a.Graphics3DCore.prototype,
"filterVisibility",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);c.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);c.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);c.__decorate([F.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives",
"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);c.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);c.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);c.__decorate([F.property()],a.Graphics3DCore.prototype,"_objectIdField",
null);a.Graphics3DCore=Sa=c.__decorate([K.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var cb;(function(za){za[za.NEW=0]="NEW";za[za.LOADING=1]="LOADING";za[za.READY=2]="READY";za[za.REJECTED=3]="REJECTED"})(cb||(cb={}));let la=function(){function za(){this.renderingInfo=this.add=null;this.state=cb.NEW;this.remove=this.abortController=null}za.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=cb.NEW;this.remove=this.abortController=null};return b._createClass(za)}();
const eb=O.create(),ib=O.create(),Pa=new Map;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(a,b,c,y,p){function u(f){return null==f||"simple"===f.type||"unique-value"===f.type||"class-breaks"===f.type||"dictionary"===f.type||"heatmap"===f.type}function q(f,g){if(!g)return null;g=Array.isArray(g)?g:[g];
if(0<g.length){const e=g.map(z=>z.details.symbol.type||z.details.symbol.declaredClass).filter(z=>!!z);e.sort();const h=[];e.forEach((z,n)=>{0!==n&&z===e[n-1]||h.push(z)});return new y("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${h.join(", ")}) which are not supported in 3D`,{renderer:f,symbolErrors:g})}return null}function k(f,g){const e={...p.defaultTo3DOptions,...g};g=f.uniqueValueInfos?.map(z=>p.to3D(z.symbol,e).error).filter(b.isSome);const h=p.to3D(f.defaultSymbol,
e);h.error&&g?.unshift(h.error);return q(f,g)}function d(f){const g=f.classBreakInfos.map(h=>p.to3D(h.symbol).error).filter(b.isSome),e=p.to3D(f.defaultSymbol);e.error&&g.unshift(e.error);return q(f,g)}a.isSupportedRenderer3D=u;a.validateTo3D=function(f,g){if(null==f)return null;if(!u(f))return new y("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${f.type||f.declaredClass}'`,{renderer:f});switch(f.type){case "simple":return q(f,p.to3D(f.symbol).error);case "unique-value":return k(f,
g);case "class-breaks":return d(f)}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,c,y,p,u,q,k,d,f){const g=u.fromSimpleMarkerSymbol(d.defaultPointSymbol2D),e=y.fromSimpleLineSymbol(d.defaultPolylineSymbol2D),h=q.fromSimpleFillSymbol(d.defaultPolygonSymbol2D),
z=new p({symbolLayers:[new c({material:{color:f.defaultColor},edges:new k({size:"1px",color:f.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(n){if(null==n)return null;switch(n.type){case "mesh":return z;case "point":case "multipoint":return g;case "polyline":return e;case "polygon":case "extent":return h}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l){const m=e.create();a.Graphics3DFeatureStore=function(w){function r(D){var A=w.call(this,D)||this;A.events=new p;A.hasZ=null;A.hasM=null;A.objectIdField=null;A.featureAdapter={getAttribute(v,B){return"graphic"in v?v.graphic.attributes[B]:l.optimizedFeatureQueryEngineAdapter.getAttribute(v,B)},getAttributes(v){return"graphic"in v?v.graphic.attributes:l.optimizedFeatureQueryEngineAdapter.getAttributes(v)},getObjectId:v=>"graphic"in v?h.getObjectId(v.graphic,
A.objectIdField)??void 0:l.optimizedFeatureQueryEngineAdapter.getObjectId(v),getGeometry:v=>"graphic"in v?v.getAsOptimizedGeometry(A.hasZ,A.hasM):l.optimizedFeatureQueryEngineAdapter.getGeometry(v),getCentroid:(v,B)=>{if("graphic"in v){let C=null;null!=v.centroid?C=v.centroid:"point"===v.graphic.geometry.type&&g.projectPoint(v.graphic.geometry,t,A.viewSpatialReference)&&(C=t);v=Array(2+(B.hasZ?1:0)+(B.hasM?1:0));null==C?(v[0]=0,v[1]=0,v[2]=0,v[3]=0):(v[0]=C.x,v[1]=C.y,B.hasZ&&(v[2]=C.hasZ?C.z:0),
B.hasM&&(v[B.hasZ?3:2]=C.hasM?C.m:0));return new n([],v)}return l.optimizedFeatureQueryEngineAdapter.getCentroid(v,B)},cloneWithGeometry:(v,B)=>"graphic"in v?new z.OptimizedFeature(B,A.featureAdapter.getAttributes(v),null,A.featureAdapter.getObjectId(v)):l.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(v,B)};return A}b._inherits(r,w);var x=r.prototype;x.forEachInBounds=function(D,A){this.getSpatialIndex().forEachInBounds(D,A)};x.forEachBounds=function(D,A){const v=this.getSpatialIndex();for(const B of D)D=
this.featureAdapter.getObjectId(B),null!=v.getBounds(D,m)&&A(m)};return b._createClass(r)}(y);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);c.__decorate([u.property({constructOnly:!0})],
a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);c.__decorate([u.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=c.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const t={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,c,y){a.optimizedFeatureQueryEngineAdapter={getObjectId(p){return p.objectId},getAttributes(p){return p.attributes},getAttribute(p,u){return p.attributes[u]},cloneWithGeometry(p,u){return new c.OptimizedFeature(u,p.attributes,null,p.objectId)},getGeometry(p){return p.geometry},getCentroid(p,u){null==
p.centroid&&(p.centroid=b.getCentroidOptimizedGeometry(new y,p.geometry,u.hasZ,u.hasM));return p.centroid}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function b(y,p,u,q,k,d,f=1){d=k?d?4:3:d?3:2;let g=u,e=u+d,h=0,z=0,n=u=0,l=0;for(let m=0,t=q-1;m<t;m++,g+=d,e+=d){q=p[g];const w=p[g+1],r=p[g+2],x=p[e],D=p[e+1],A=p[e+2];let v=q*D-x*w;n+=v;h+=(q+x)*v;z+=(w+D)*v;k&&(v=q*A-x*r,u+=(r+A)*v,l+=v);q<y[0]&&(y[0]=
q);q>y[1]&&(y[1]=q);w<y[2]&&(y[2]=w);w>y[3]&&(y[3]=w);k&&(r<y[4]&&(y[4]=r),r>y[5]&&(y[5]=r))}0<n*f&&(n*=-1);0<l*f&&(l*=-1);if(!n)return null;y=[h,z,.5*n];k&&(y[3]=u,y[4]=.5*l);return y}function c(y,p,u,q,k){k=q?k?4:3:k?3:2;let d=p,f=p+k,g=0,e=0,h=0,z=0;for(let t=0,w=u-1;t<w;t++,d+=k,f+=k){var n=y[d];const r=y[d+1],x=y[d+2],D=y[f],A=y[f+1],v=y[f+2];if(q){var l=D-n;var m=A-r;const B=v-x;l=Math.sqrt(l*l+m*m+B*B)}else l=D-n,m=A-r,l=Math.sqrt(l*l+m*m);l&&(g+=l,q?(n=[n+.5*(D-n),r+.5*(A-r),x+.5*(v-x)],e+=
l*n[0],h+=l*n[1],z+=l*n[2]):(n=[n+.5*(D-n),r+.5*(A-r)],e+=l*n[0],h+=l*n[1]))}return 0<g?q?[e/g,h/g,z/g]:[e/g,h/g]:0<u?q?[y[p],y[p+1],y[p+2]]:[y[p],y[p+1]]:null}a.getCentroidOptimizedGeometry=function(y,p,u,q,k){if(null==p||!p.lengths.length)return null;const d="upperLeft"===k?.originPosition?-1:1;y.lengths.length&&(y.lengths.length=0);y.coords.length&&(y.coords.length=0);k=y.coords;const f=[],g=u?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:e,coords:h}=p,z=u?q?4:3:q?3:2;let n=0;for(var l of e){const m=b(g,h,n,l,u,q,d);m&&f.push(m);n+=l*z}f.sort((m,t)=>{let w=d*m[2]-d*t[2];0===w&&u&&(w=m[4]-t[4]);return w});f.length&&(l=6*f[0][2],k[0]=f[0][0]/l,k[1]=f[0][1]/l,u&&(l=6*f[0][4],k[2]=0!==l?f[0][3]/l:0),k[0]<g[0]||k[0]>g[1]||k[1]<g[2]||k[1]>g[3]||u&&(k[2]<g[4]||k[2]>g[5]))&&(k.length=
0);if(!k.length)if(p=p.lengths[0]?c(h,0,e[0],u,q):null)k[0]=p[0],k[1]=p[1],u&&2<p.length&&(k[2]=p[2]);else return null;return y};a.lineCentroid=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,c){a.make=function(y,p,u){switch(y.type){case "point-3d":return new b(y,p,u);default:return new c(y,p,u)}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),function(a,b,c,y,p,u,q){return function(k){function d(g,e,h){g=k.call(this,g,e,h)||this;g._calloutSymbolLayer=null;g.symbol.hasVisibleCallout()&&(g._calloutSymbolLayer=p.make(g.symbol,
e));return g}a._inherits(d,k);var f=d.prototype;f.doLoad=async function(g){const e=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await a._get(a._getPrototypeOf(d.prototype),"doLoad",this).call(this,g),y.throwIfAborted(g)}catch(h){throw this._calloutSymbolLayer?.abortLoad(),h;}e&&await e};f.destroy=function(){a._get(a._getPrototypeOf(d.prototype),"destroy",this).call(this);this._calloutSymbolLayer=c.destroyMaybe(this._calloutSymbolLayer)};f.createGraphics3DGraphic=function(g,
e){e=a._get(a._getPrototypeOf(d.prototype),"createGraphics3DGraphic",this).call(this,g,e);null!=this._calloutSymbolLayer&&null!=e&&(g=this._createCalloutGraphic(g))&&e.setCalloutGraphic(g);return e};f.globalPropertyChanged=function(g,e){return a._get(a._getPrototypeOf(d.prototype),"globalPropertyChanged",this).call(this,g,e)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(g,e,h=>h.calloutLayer):!0:!1};f.updateGeometry=function(g,e){const h=a._get(a._getPrototypeOf(d.prototype),
"updateGeometry",this).call(this,g,e);return h&&this._calloutSymbolLayer&&(g=g.calloutLayer)?this._calloutSymbolLayer.updateGeometry(g,e):h};f._createCalloutGraphic=function(g){const e=g.renderingInfo;g.renderingInfo=new u.LineCalloutSymbolLayerRenderingInfo(e.renderer,e.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(g)};return a._createClass(d)}(q)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,y,p){let u=function(){function q(d){this._graphicsCore=d;this._idToState=new Map;this._states=new Set;const f=d.owner.layer&&d.owner.layer.objectIdField;f?(this._getGraphicId=g=>p.getObjectId(g,f),this._getGraphics3DGraphicById=g=>this._graphicsCore.getGraphics3DGraphicByObjectId(g)):(this._getGraphicId=g=>g.uid,this._getGraphics3DGraphicById=g=>this._graphicsCore.getGraphics3DGraphicById(g))}
var k=q.prototype;k.destroy=function(){this._idToState.clear();this._states.forEach((d,f)=>this.remove(f))};k.add=function(d){const f=y.makeHandle(()=>this.remove(d));if(this._states.has(d))return f;const g=this._getGraphicId(d.graphic),e=this._getGraphics3DGraphicById(g);this._states.has(d)||this._states.add(d);this._ensureStateList(g).push(d);d.displaying=null!=e?e.isVisible():!1;d.isDraped=null!=e?e.isDraped:!1;d.tracking=!0;null!=e&&d.emit("changed");return f};k.remove=function(d){if(this._states.has(d)){if(this._idToState.size){const f=
this._getGraphicId(d.graphic),g=this._idToState.get(f);g&&(c.remove(g,d),0===g.length&&this._idToState.delete(f))}this._states.delete(d);d.tracking=!1;d.displaying=!1}};k.addGraphic=function(d){this._forEachState(d,f=>{f.displaying=d.isVisible();f.isDraped=d.isDraped;f.emit("changed")})};k.removeGraphic=function(d){this._forEachState(d,f=>{f.displaying=!1;f.isDraped=!1})};k.updateGraphicGeometry=function(d){this._forEachState(d,f=>f.emit("changed"))};k.updateGraphicVisibility=function(d){this._forEachState(d,
f=>f.displaying=d.isVisible())};k.allGraphicsDeleted=function(){this._states.forEach(d=>{d.displaying=!1})};k._ensureStateList=function(d){var f=this._idToState.get(d);if(f)return f;f=[];this._idToState.set(d,f);return f};k._forEachState=function(d,f){0!==this._states.size&&0!==this._idToState.size&&(d=this._getGraphicId(d.graphic),d=this._idToState.get(d),null!=d&&d.forEach(f))};return b._createClass(q)}();a.GraphicStateTracking=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){a.SpatialIndex2D=function(n){function l(t){t=n.call(this,t)||this;t._index=new g.PooledRBush(9,p("esri-csp-restrictions")?w=>({minX:w.extent[0],minY:w.extent[1],maxX:w.extent[2],maxY:w.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);t._missing=new Set;t._boundsByFeature=new Map;t.spatialReference=null;t.hasZ=null;t.hasM=null;t.objectIdField=null;t.updating=!1;return t}b._inherits(l,n);var m=l.prototype;m.setup=function(t){this._addMany(t)};m.destroy=
function(){this._missing.clear();this._index=u.destroyMaybe(this._index);this._boundsByFeature.clear();this._boundsByFeature=null};m.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};m.queryGraphicUIDsInExtent=function(t,w,r){null!=w&&w.equals(this.spatialReference)&&(z.minX=t[0],z.minY=t[1],z.maxX=t[2],z.maxY=t[3],this.update(),this._index.search(z,x=>r(x.graphic.uid)))};m.add=function(t){this._missing.add(t);this.updating=
!0};m.remove=function(t){this._missing.delete(t)?this.updating=0<this._missing.size:(this._index.remove(t),t=h.getObjectId(t.graphic,this._get("objectIdField")),null!=t&&this._boundsByFeature.delete(t))};m._addMany=function(t){if(0!==t.length){var w=this._get("objectIdField");for(const r of t){r.computeExtent(this.spatialReference);const x=h.getObjectId(r.graphic,w);null!=x&&this._boundsByFeature.set(x,r.extent)}this._index.load(t)}};m.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};m.forEachInBounds=function(t,w){z.minX=t[0];z.minY=t[1];z.maxX=t[2];z.maxY=t[3];this.update();this._index.search(z,r=>{w(r)})};m.getBounds=function(t,w){this.update();return(t=this._boundsByFeature.get(t))?e.fromRect(w,t):null};b._createClass(l,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return l}(y);c.__decorate([q.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);c.__decorate([q.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);c.__decorate([q.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);c.__decorate([q.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);c.__decorate([q.property()],a.SpatialIndex2D.prototype,"updating",void 0);c.__decorate([q.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=c.__decorate([f.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const z={minX:0,minY:0,maxX:0,
maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,b,c,y,p,u){function q(B,C){k(B,0,B.children.length,C,B)}function k(B,C,E,F,M){M||(M=new A([]));M.minX=Infinity;M.minY=Infinity;M.maxX=-Infinity;M.maxY=-Infinity;for(let K=C,G;K<E;K++)G=B.children[K],d(M,B.leaf?F(G):G);return M}
function d(B,C){B.minX=Math.min(B.minX,C.minX);B.minY=Math.min(B.minY,C.minY);B.maxX=Math.max(B.maxX,C.maxX);B.maxY=Math.max(B.maxY,C.maxY)}function f(B,C){return B.minX-C.minX}function g(B,C){return B.minY-C.minY}function e(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function h(B){return B.maxX-B.minX+(B.maxY-B.minY)}function z(B,C){return B.minX<=C.minX&&B.minY<=C.minY&&C.maxX<=B.maxX&&C.maxY<=B.maxY}function n(B,C){return C.minX<=B.maxX&&C.minY<=B.maxY&&C.maxX>=B.minX&&C.maxY>=B.minY}function l(B,
C,E,F,M){for(C=[C,E];C.length;){E=y.assumeNonNull(C.pop());const K=y.assumeNonNull(C.pop());if(E-K<=F)continue;const G=K+Math.ceil((E-K)/F/2)*F;u.quickselect(B,G,K,E,M);C.push(K,G,G,E)}}let m=function(){function B(E=9,F){this._compareMinX=f;this._compareMinY=g;this._toBBox=M=>M;this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this._toBBox=F:this._initFormat(F));this.clear()}var C=B.prototype;C.destroy=function(){this.clear();t.prune();
w.prune();r.prune();x.prune()};C.all=function(E){this._all(this._data,E)};C.search=function(E,F){let M=this._data;const K=this._toBBox;if(n(E,M))for(t.clear();M;){for(let G=0,L=M.children.length;G<L;G++){const O=M.children[G],I=M.leaf?K(O):O;n(E,I)&&(M.leaf?F(O):z(E,I)?this._all(O,F):t.push(O))}M=t.pop()}};C.collides=function(E){let F=this._data;const M=this._toBBox;if(!n(E,F))return!1;for(t.clear();F;){for(let K=0,G=F.children.length;K<G;K++){const L=F.children[K],O=F.leaf?M(L):L;if(n(E,O)){if(F.leaf||
z(E,O))return!0;t.push(L)}}F=t.pop()}return!1};C.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let F=0,M=E.length;F<M;F++)this.insert(E[F]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this._data.children.length)if(this._data.height===E.height)this._splitRoot(this._data,E);else{if(this._data.height<E.height){const F=this._data;this._data=E;E=F}this._insert(E,this._data.height-E.height-1,!0)}else this._data=E;return this};C.insert=function(E){E&&this._insert(E,
this._data.height-1);return this};C.clear=function(){this._data=new A([]);return this};C.remove=function(E){if(!E)return this;let F=this._data,M=null,K=0,G=!1,L;const O=this._toBBox(E);r.clear();for(x.clear();F||0<r.length;){F||(F=y.assumeNonNull(r.pop()),M=r.data[r.length-1],K=x.pop()??0,G=!0);if(F.leaf&&(L=c.indexOf(F.children,E,F.children.length,F.indexHint),-1!==L)){F.children.splice(L,1);r.push(F);this._condense(r);break}G||F.leaf||!z(F,O)?M?(K++,F=M.children[K],G=!1):F=null:(r.push(F),x.push(K),
K=0,M=F,F=F.children[0])}return this};C.toJSON=function(){return this._data};C.fromJSON=function(E){this._data=E;return this};C._all=function(E,F){for(w.clear();E;){if(!0===E.leaf)for(const M of E.children)F(M);else w.pushArray(E.children);E=w.pop()??null}};C._build=function(E,F,M,K){var G=M-F+1,L=this._maxEntries;if(G<=L)return E=new A(E.slice(F,M+1)),q(E,this._toBBox),E;K||(K=Math.ceil(Math.log(G)/Math.log(L)),L=Math.ceil(G/L**(K-1)));const O=new v([]);O.height=K;G=Math.ceil(G/L);L=G*Math.ceil(Math.sqrt(L));
for(l(E,F,M,L,this._compareMinX);F<=M;F+=L){const I=Math.min(F+L-1,M);l(E,F,I,G,this._compareMinY);for(let H=F;H<=I;H+=G)O.children.push(this._build(E,H,Math.min(H+G-1,I),K-1))}q(O,this._toBBox);return O};C._chooseSubtree=function(E,F,M,K){for(;;){K.push(F);if(!0===F.leaf||K.length-1===M)break;let G=Infinity,L=Infinity,O=void 0;for(let I=0,H=F.children.length;I<H;I++){const J=F.children[I],N=e(J),R=(Math.max(J.maxX,E.maxX)-Math.min(J.minX,E.minX))*(Math.max(J.maxY,E.maxY)-Math.min(J.minY,E.minY))-
N;R<L?(L=R,G=N<G?N:G,O=J):R===L&&N<G&&(G=N,O=J)}F=O||F.children[0]}return F};C._insert=function(E,F,M){var K=this._toBBox;M=M?E:K(E);r.clear();K=this._chooseSubtree(M,this._data,F,r);K.children.push(E);for(d(K,M);0<=F;)if(r.data[F].children.length>this._maxEntries)this._split(r,F),F--;else break;this._adjustParentBBoxes(M,r,F)};C._split=function(E,F){const M=E.data[F];var K=M.children.length;const G=this._minEntries;this._chooseSplitAxis(M,G,K);(K=this._chooseSplitIndex(M,G,K))?(K=M.children.splice(K,
M.children.length-K),K=M.leaf?new A(K):new v(K),K.height=M.height,q(M,this._toBBox),q(K,this._toBBox),F?E.data[F-1].children.push(K):this._splitRoot(M,K)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};C._splitRoot=function(E,F){this._data=new v([E,F]);this._data.height=E.height+1;q(this._data,this._toBBox)};C._chooseSplitIndex=function(E,F,M){let K,G,L=void 0;K=G=Infinity;for(let I=F;I<=M-F;I++){var O=k(E,0,I,this._toBBox);const H=k(E,I,M,this._toBBox),J=Math.max(0,
Math.min(O.maxX,H.maxX)-Math.max(O.minX,H.minX))*Math.max(0,Math.min(O.maxY,H.maxY)-Math.max(O.minY,H.minY));O=e(O)+e(H);J<K?(K=J,L=I,G=O<G?O:G):J===K&&O<G&&(G=O,L=I)}return L};C._chooseSplitAxis=function(E,F,M){const K=E.leaf?this._compareMinX:f,G=E.leaf?this._compareMinY:g,L=this._allDistMargin(E,F,M,K);F=this._allDistMargin(E,F,M,G);L<F&&E.children.sort(K)};C._allDistMargin=function(E,F,M,K){E.children.sort(K);K=this._toBBox;var G=k(E,0,F,K);const L=k(E,M-F,M,K);let O=h(G)+h(L);for(let I=F;I<M-
F;I++){const H=E.children[I];d(G,E.leaf?K(H):H);O+=h(G)}for(M=M-F-1;M>=F;M--)G=E.children[M],d(L,E.leaf?K(G):G),O+=h(L);return O};C._adjustParentBBoxes=function(E,F,M){for(;0<=M;M--)d(F.data[M],E)};C._condense=function(E){for(let F=E.length-1;0<=F;F--){const M=E.data[F];if(0===M.children.length)if(0<F){const K=E.data[F-1],G=K.children;G.splice(c.indexOf(G,M,G.length,K.indexHint),1)}else this.clear();else q(M,this._toBBox)}};C._initFormat=function(E){const F=["return a"," - b",";"];this._compareMinX=
new Function("a","b",F.join(E[0]));this._compareMinY=new Function("a","b",F.join(E[1]));this._toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return b._createClass(B)}();const t=new p,w=new p,r=new p,x=new p({deallocator:void 0});p=b._createClass(function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity});let D=function(B){function C(){var E=B.apply(this,arguments)||this;E.height=1;E.indexHint=new c.PositionHint;return E}b._inherits(C,
B);return b._createClass(C)}(p),A=function(B){function C(E){var F=B.call(this)||this;F.children=E;F.leaf=!0;return F}b._inherits(C,B);return b._createClass(C)}(D),v=function(B){function C(E){var F=B.call(this)||this;F.children=E;F.leaf=!1;return F}b._inherits(C,B);return b._createClass(C)}(D);a.BBox=p;a.PooledRBush=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,b){var c={exports:{}};c.exports;
(function(y){(function(p){p=p();void 0!==p&&(y.exports=p)})(function(){function p(k,d,f,g,e){for(;g>f;){if(600<g-f){var h=g-f+1,z=d-f+1,n=Math.log(h),l=.5*Math.exp(2*n/3);n=.5*Math.sqrt(n*l*(h-l)/h)*(0>z-h/2?-1:1);p(k,d,Math.max(f,Math.floor(d-z*l/h+n)),Math.min(g,Math.floor(d+(h-z)*l/h+n)),e)}h=k[d];z=f;l=g;u(k,f,d);for(0<e(k[g],h)&&u(k,f,g);z<l;){u(k,z,l);z++;for(l--;0>e(k[z],h);)z++;for(;0<e(k[l],h);)l--}0===e(k[f],h)?u(k,f,l):(l++,u(k,l,g));l<=d&&(f=l+1);d<=l&&(g=l-1)}}function u(k,d,f){var g=
k[d];k[d]=k[f];k[f]=g}function q(k,d){return k<d?-1:k>d?1:0}return function(k,d,f,g,e){p(k,d,f||0,g||k.length-1,e||q)}})})(c);b=b.getDefaultExportFromCjs(c.exports);a.quickselect=b})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r){a.StageLayerElevationProvider=function(E){function F(K){K=E.call(this,K)||this;K._elevationOffset=0;K._layerHandes=new u;return K}b._inherits(F,E);var M=F.prototype;M.initialize=function(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=w.newIntersector(this.view.state.viewingMode);this._intersector.options.store=r.StoreResults.MIN;var K=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=K[2];this._zmax=K[5];K=this.stageLayer.events;this._layerHandes.add([K.on("layerObjectAdded",G=>this._objectChanged(G.object)),K.on("layerObjectRemoved",G=>this._objectChanged(G.object)),K.on("objectGeometryAdded",G=>this._objectChanged(G.object)),K.on("objectGeometryRemoved",G=>this._objectChanged(G.object)),K.on("objectGeometryUpdated",G=>this._objectChanged(G.object)),K.on("objectTransformation",G=>this._objectChanged(G))])};M.dispose=function(){this._layerHandes.destroy()};
M.elevationInfoChanged=function(){const K=null!=this.layer?this.layer.elevationInfo:null;if(null!=K&&"on-the-ground"!==K.mode){const G=k.getMetersPerVerticalUnitForSR(this.layer.spatialReference),L=t.getMetersPerUnit(K.unit??"meters");this._elevationOffset=(K.offset??0)*L/G}else this._elevationOffset=0};M.getElevation=function(K,G,L,O){v[0]=K;v[1]=G;v[2]=L;if(!this._renderCoordsHelper.toRenderCoords(v,O,v))return q.getLogger(this).error("could not project point for elevation alignment"),null;K=this._elevationOffset;
G=this._zmin+K;this._renderCoordsHelper.setAltitude(B,this._zmax+K,v);this._renderCoordsHelper.setAltitude(C,G,v);this._intersector.reset(B,C,null);this._intersector.intersect(this._intersectLayers,null,1,null,I=>!!I.lastValidElevationBB);return this._intersector.results.min.getIntersectionPoint(v)?this._renderCoordsHelper.getAltitude(v):null};M._objectChanged=function(K){const G=this.spatialReference;if(K.lastValidElevationBB&&G){l.empty(x);var L=K.lastValidElevationBB;L.isEmpty()||this._expandExtent(G,
L.min,L.max,x);var {min:O,max:I}=K.boundingVolumeWorldSpace;this._expandExtent(G,O,I,x);l.toRect(x,D);this._zmin=Math.min(this._zmin,x[2]);this._zmax=Math.max(this._zmax,x[5]);A.extent=D;A.spatialReference=G;this.emit("elevation-change",A);z.copy(L.min,O);z.copy(L.max,I)}};M._computeLayerExtent=function(K,G){l.empty(x);null!=K&&G.objects.forAll(L=>this._expandExtent(K,L.boundingVolumeWorldSpace.min,L.boundingVolumeWorldSpace.max,x));return x};M._expandExtent=function(K,G,L,O){for(let I=0;8>I;++I)v[0]=
I&1?G[0]:L[0],v[1]=I&2?G[1]:L[1],v[2]=I&4?G[2]:L[2],this._renderCoordsHelper.fromRenderCoords(v,v,K),l.expandWithVec3(O,v);return O};b._createClass(F,[{key:"spatialReference",get:function(){return this.view?.spatialReference}}]);return F}(p.EventedMixin(y));c.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);c.__decorate([d.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);c.__decorate([d.property({constructOnly:!0})],
a.StageLayerElevationProvider.prototype,"view",void 0);c.__decorate([d.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=c.__decorate([h.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const x=l.empty(),D=m.empty(),A={spatialReference:null,extent:D,context:"scene"},v=n.create(),B=n.create(),C=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){c=function(l){function m(w){w=l.call(this,w)||this;w._dirtyExtents=new h.ExtentSet;w._globalDirty=!1;w._averageExtentUpdateSize=0;w._dirtyGraphicsSet=new Set;w._handles=new p;w._updateElevation=!1;w.graphicsCoreOwner=null;w.graphicsCore=null;w.events=new y;return w}a._inherits(m,l);var t=m.prototype;t.initialize=function(){const w=this.graphicsCoreOwner.view.resourceController.scheduler;this._handles.add([this.elevationProvider.on("elevation-change",r=>this._elevationChanged(r)),
q.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),w.registerTask(n.TaskPriority.ELEVATION_ALIGNMENT,this)])};t.destroy=function(){this._dirtyGraphicsSet.clear();this._handles=u.destroyMaybe(this._handles);this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=null};t.clear=function(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")};t._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:
!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))};t.elevationInfoChange=function(){this._globalDirty=!0;this.notifyChange("updating")};t.runTask=function(w){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,w.madeProgress());for(w.run(()=>this._dirtyExtents.merge(w));this.running&&!w.done;)this._updateDirtyGraphics(w),this._updateDirtyExtents(w);this.notifyChange("updating")};t._updateDirtyGraphics=function(w){const r=
this.graphicsCoreOwner.view.renderCoordsHelper,x=this.graphicsCore.effectiveUpdatePolicy===z.UpdatePolicy.ASYNC;for(const D of this._dirtyGraphicsSet.keys()){const A=this.graphicsCore.getGraphics3DGraphicById(D);this._dirtyGraphicsSet.delete(D);null!=A&&(A.alignWithElevation(this.elevationProvider,r,x),this.graphicsCoreOwner.view.deconflictor.setDirty(),w.madeProgress());if(w.done)break}};t._updateDirtyExtents=function(w){for(;!this._dirtyExtents.empty&&!w.done;){const r=this._dirtyExtents.pop(),
x=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:r,spatialReference:x});const D=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(r,x,A=>{const v=this.graphicsCore.getGraphics3DGraphicById(A);null!=v&&v.needsElevationUpdates()&&this._dirtyGraphicsSet.add(A)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-D)+.9*this._averageExtentUpdateSize;w.madeProgress()}};t._markAllGraphicsElevationDirty=function(){this._dirtyExtents.clear();this._dirtyGraphicsSet.clear();
this.graphicsCore.graphics3DGraphics.forEach((w,r)=>this._dirtyGraphicsSet.add(r))};t._elevationChanged=function(w){if("scene"!==w.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:r,spatialReference:x}=w;this.graphicsCoreOwner.suspended?(this._updateElevation||(w=this.graphicsCore.computedExtent)&&r[2]>w.xmin&&r[0]<w.xmax&&r[3]>w.ymin&&r[1]<w.ymax&&(this._updateElevation=!0),this.events.emit("invalidate-elevation",{extent:r,
spatialReference:x})):(-Infinity===r[0]?this._globalDirty=!0:this._dirtyExtents.add(r),this.notifyChange("updating"))}};a._createClass(m,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}},{key:"updatingRemaining",get:function(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}}]);return m}(c);b.__decorate([k.property()],c.prototype,
"graphicsCoreOwner",void 0);b.__decorate([k.property()],c.prototype,"graphicsCore",void 0);b.__decorate([k.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([k.property()],c.prototype,"elevationProvider",void 0);b.__decorate([k.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([k.property({readOnly:!0})],c.prototype,"updatingRemaining",null);return c=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,c,y,p){let u=function(){function q(){this._extents=new c({allocator:d=>d||y.create()});this._tmpExtent=y.create();this._dirty=!1}var k=q.prototype;k.clear=function(){this._extents.clear()};k.add=function(d){this._contains(d)||(this._removeContained(d),y.copy(this._extents.pushNew(),d),this._dirty=!0)};k.pop=function(){this._dirty&&this._mergeTight();
return this._extents.pop()};k.merge=function(d){this._mergeTight(d);return d.hasProgressed};k._mergeTight=function(d=p.noBudget){const f=this._extents,g=new Set;let e=0;for(;e!==f.length;){f.sort((h,z)=>h[0]-z[0]);e=f.length;g.clear();for(let h=0;h<f.length;++h){if(d.done)return;const z=f.at(h);if(z){for(let n=h+1;n<f.length;++n){const l=f.at(n);if(null==l||l[0]>=z[2])break;g.add(l)}g.forEach(n=>{if(z!==n)if(n[2]<=z[0])g.delete(n);else{var l=y.area(z),m=y.area(n),t=this._tmpExtent;y.expand(z,n,t);
l+=m;.05>(y.area(t)-l)/l&&(y.copy(z,t),g.delete(n),f.remove(n),d.madeProgress())}});g.add(z)}}}this._dirty=!1};k._contains=function(d){return this._extents.some(f=>y.contains(f,d))};k._removeContained=function(d){this._extents.filterInPlace(f=>!y.contains(d,f))};b._createClass(q,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const d=this;return{containsPoint:f=>d._extents.some(g=>y.containsPoint(g,
f))}}}]);return q}();a.ExtentSet=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){c=function(n){function l(t){t=n.call(this,t)||this;t.suspended=!1;t._extent=null;t._extentIntersectionDirty=!0;t._isVisibleBelowSurfaceInternal=!1;t._handles=new y;t.graphicsCoreOwner=null;t.updating=!0;return t}a._inherits(l,n);var m=l.prototype;m.initialize=function(){var {graphicsCoreOwner:t}=this;this._extentIntersection=new h.FrustumExtentIntersection({renderCoordsHelper:t.view.renderCoordsHelper});const w=t.view,r=w.basemapTerrain;t=w.resourceController.scheduler;
this._handles.add([w.on("resize",()=>this._viewChange()),u.watch(()=>w.state.camera,()=>this._viewChange(),u.sync),t.registerTask(z.TaskPriority.FRUSTUM_VISIBILITY,this),u.watch(()=>r.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===w.viewingMode?this._isVisibleBelowSurface=!0:this._handles.add([u.watch(()=>[r.baseOpacity,r.wireframe,w.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),u.initial)])};m.destroy=function(){this._set("graphicsCoreOwner",
null);this._extentIntersection=this._extent=null;this._handles=p.destroyMaybe(this._handles)};m._setDirty=function(){this.updating||this._set("updating",!0)};m.setExtent=function(t){this._extent=t;this._extentIntersectionDirty=!0;this._setDirty()};m._viewChange=function(){this._setDirty()};m._elevationBoundsChange=function(){this._setDirty();this._extentIntersectionDirty=!0};m._updateIsVisibleBelowSurface=function(){const t=this.graphicsCoreOwner.view,w=t.basemapTerrain,r="none"===t.map.ground?.navigationConstraint?.type;
this._isVisibleBelowSurface="local"===t.viewingMode||!w.opaque||r};m._updateExtentIntersection=function(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var t=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var w=-.3*e.getReferenceEllipsoid(t.spatialReference).radius;else{const {min:r,max:x}=t.basemapTerrain.visibleElevationBounds;w=r-Math.max(1,(x-r)*(1.2-1))}this._extentIntersection.update(this._extent,t.spatialReference,w)}};m.runTask=function(t){this._set("updating",
!1);if(!this._extent)return this._set("suspended",!1),z.Task.YIELD;this._updateExtentIntersection();const w=this.graphicsCoreOwner.view.frustum,r=e.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(w,r));t.madeProgress()};a._createClass(l,[{key:"_isVisibleBelowSurface",set:function(t){this._isVisibleBelowSurfaceInternal=t;this._setDirty();this._extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return l}(c);b.__decorate([q.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([q.property({constructOnly:!0})],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils",
"./Graphics3DObjectStateSet"],function(a,b,c,y){let p=function(){function u(k){this._graphicsCore=k;this._stateSets=[]}var q=u.prototype;q.destroy=function(){this.reset();this._stateSets=null};q.reset=function(){this._stateSets&&(this._stateSets.forEach(k=>k.objectStateSet.removeAll()),this._stateSets.length=0)};q.acquireSet=function(k,d){const f=new y.Graphics3DObjectStateSet(k,d);this._stateSets.push(f);k=c.makeHandle(()=>this.releaseSet(f));return{set:f,handle:k}};q.releaseSet=function(k){k.objectStateSet.removeAll();
k=this._stateSets?this._stateSets.indexOf(k):-1;-1!==k&&this._stateSets.splice(k,1)};q._addObjectStateSet=function(k,d){k.addObjectStateSet(d.stateType,d.objectStateSet)};q._removeObjectStateSet=function(k,d){k.removeObjectState(d.objectStateSet)};q.setUid=function(k,d){k.ids.add(d);(d=this._graphicsCore.graphics3DGraphics.get(d))&&this._addObjectStateSet(d,k)};q.setUids=function(k,d){d.forEach(f=>this.setUid(k,f))};q.setObjectIds=function(k,d){d.forEach(f=>k.ids.add(f));this._initializeSet(k)};q.addGraphic=
function(k){this._stateSets.forEach(d=>{!d.paused&&d.hasGraphic(k)&&this._addObjectStateSet(k,d)})};q.removeGraphic=function(k){this._stateSets.forEach(d=>{d.hasGraphic(k)&&this._removeObjectStateSet(k,d)})};q.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(k=>k.objectStateSet.removeAll())};q._initializeSet=function(k){const d=this._graphicsCore.graphics3DGraphics;k.objectIdField?d.forEach(f=>{f&&k.hasGraphic(f)&&this._addObjectStateSet(f,k)}):k.ids.forEach(f=>{(f=d.get(f))&&
this._addObjectStateSet(f,k)})};b._createClass(u,[{key:"test",get:function(){return{states:this._stateSets}}}]);return u}();a.Graphics3DObjectStates=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/Object3DStateSet"],function(a,b,c){let y=function(){function p(u,q){this.stateType=u;this.objectIdField=q;this.objectStateSet=new c.Object3DStateSet;
this.ids=new Set;this.paused=!1}p.prototype.hasGraphic=function(u){return this.objectIdField?this.ids.has(u.graphic.attributes[this.objectIdField]):this.ids.has(u.graphic.uid)};return b._createClass(p)}();a.Graphics3DObjectStateSet=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b,c){var y;(function(u){u[u.Object=0]="Object";
u[u.RenderGeometry=1]="RenderGeometry";u[u.External=2]="External";u[u.COUNT=3]="COUNT"})(y||(y={}));let p=function(){function u(){this._items=[]}var q=u.prototype;q.addObject=function(k,d){this._items.push({type:y.Object,objectStateId:d,object:k})};q.addRenderGeometry=function(k,d,f){this._items.push({type:y.RenderGeometry,objectStateId:d,renderGeometry:k,owner:f})};q.addExternal=function(k,d){this._items.push({type:y.External,objectStateId:d,remove:k})};q.remove=function(k){for(let d=this._items.length-
1;0<=d;--d){const f=this._items[d];f.objectStateId===k&&(this._removeObjectStateItem(f),this._items.splice(d,1))}};q.removeObject=function(k){for(let d=this._items.length-1;0<=d;--d){const f=this._items[d];f.type===y.Object&&f.object===k&&(this._removeObjectStateItem(f),this._items.splice(d,1))}};q.removeRenderGeometry=function(k){for(let d=this._items.length-1;0<=d;--d){const f=this._items[d];f.type===y.RenderGeometry&&f.renderGeometry===k&&(this._removeObjectStateItem(f),this._items.splice(d,1))}};
q.removeAll=function(){this._items.forEach(k=>{this._removeObjectStateItem(k)});this._items=[]};q._removeObjectStateItem=function(k){switch(k.type){case y.Object:k.objectStateId.channel===c.Object3DState.Highlight?k.object.removeHighlight(k.objectStateId):k.objectStateId.channel===c.Object3DState.MaskOccludee&&k.object.removeOcclude(k.objectStateId);break;case y.RenderGeometry:k.owner.removeRenderGeometryObjectState(k.renderGeometry,k.objectStateId);break;case y.External:k.remove(k.objectStateId)}};
return b._createClass(u)}();a.Object3DStateSet=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){const n=y.getLogger("esri.views.3d.layers.graphics.Graphics3DScaleVisibility");c=function(m){function t(r){r=m.call(this,r)||this;r._scaleRangeActive=!1;r._layerScaleRangeVisibilityQuery=!1;r._extent=null;r.graphicsCoreOwner=null;r.layer=null;r.queryGraphicUIDsInExtent=null;r.graphicsCore=null;r.basemapTerrain=null;r.layerScaleEnabled=!0;r.suspended=!1;r._dirty=!0;return r}a._inherits(t,m);var w=t.prototype;w.initialize=function(){this.updateScaleRangeActive();
this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(z.TaskPriority.SCALE_VISIBILITY,this));this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())};w.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null};w._setDirty=function(){this._dirty=!0};w.setExtent=function(r){const x=
this.graphicsCoreOwner.view.spatialReference,D=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(x===D)this._extent=r??null;else{const A=g.create();f.projectBoundingRect(r,x,A,D)?this._extent=A:this._extent=null}this._setDirty()};w.scaleRangeActive=function(){return this._scaleRangeActive};w.updateScaleRangeActive=function(){var r=this.layer,x=r.effectiveScaleRange;x=this.layerScaleEnabled&&null!=x&&(0<x.minScale||0<x.maxScale);r.labelingInfo&&!x&&(x=r.labelingInfo.some(D=>D&&(0<(D.minScale??
0)||0<(D.maxScale??0))));r=this._scaleRangeActive!==x;(this._scaleRangeActive=x)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",D=>this._scaleUpdateHandler(D)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!x&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return r};w.runTask=function(r){const x=this.graphicsCoreOwner.view.basemapTerrain;
if(this._extent&&x&&x.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return z.Task.YIELD;this._layerScaleRangeVisibilityQuery=!0;const {minScale:D,maxScale:A}=this.layer.effectiveScaleRange;x.queryVisibleScaleRange(this._extent,D,A,v=>this._finishUpdate(v))}else this._finishUpdate(!0);r.madeProgress()};w._finishUpdate=function(r){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!r);this._dirty=!1};w._visibleAtLayerScale=function(r){const x=
this.layer.effectiveScaleRange;return!this.layerScaleEnabled||h.scaleBoundsPredicate(r,x.minScale||0,x.maxScale||0)};w._visibleAtLabelScale=function(r,x){return h.scaleBoundsPredicate(r,x.minScale||0,x.maxScale||0)};w._graphicScale=function(r){let x;null!=r.centroid?x=r.centroid:null!=r.graphic.geometry&&"point"===r.graphic.geometry.type&&(x=r.graphic.geometry);return x?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(x):1:null};w._graphicVisible=function(r){if(!this.layerScaleEnabled)return!0;
r=this._graphicScale(r);return this._visibleAtLayerScale(r)};w.updateVisibility=function(r){if(this._scaleRangeActive){const x=this._graphicVisible(r);return r.setVisibilityFlag(e.VisibilityGroup.GRAPHIC,e.VisibilityFlag.SCALE_RANGE,x)}return!1};w.updateGraphicLabelScaleVisibility=function(r){if(!this._scaleRangeActive||!r.labelLayers||0===r.labelLayers.length)return!1;const x=this._graphicScale(r);if(r=this._updateLabelScaleVisibility(r,x))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();
return r};w._updateLabelScaleVisibility=function(r,x){if(!r.labelLayers||0===r.labelLayers.length)return!1;const D=r.labelLayers[0]._labelClass;return D&&null!=D.minScale&&null!=D.maxScale&&(x=this._visibleAtLabelScale(x,D),r.setVisibilityFlag(e.VisibilityGroup.LABEL,e.VisibilityFlag.SCALE_RANGE,x))?!0:!1};w._scaleUpdateHandler=function(r){this._setDirty();if(this.graphicsCore.visible){var x=r.extent,D=r.scale,A=this._visibleAtLayerScale(D),v=!1,B=this.graphicsCoreOwner.view.spatialReference;r=r.spatialReference;
if(null==r)n.error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var C=!r.equals(B);C&&!f.projectBoundingRect(x,r,l,B)?n.error("scaleUpdate: Internal error, cannot project AABR from "+r+" to wkid "+B):(this.queryGraphicUIDsInExtent(C?l:x,B,E=>{E=this.graphicsCore.getGraphics3DGraphicById(E);if(null!=E){var F=E.centroid;null!=F&&(x[0]>F.x||x[1]>F.y||x[2]<F.x||x[3]<F.y)||(E.setVisibilityFlag(e.VisibilityGroup.GRAPHIC,e.VisibilityFlag.SCALE_RANGE,A)&&(v=!0),this._updateLabelScaleVisibility(E,
D)&&(v=!0))}}),v&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()))}}};w.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(r=>r.setVisibilityFlag(e.VisibilityGroup.GRAPHIC,e.VisibilityFlag.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(t,[{key:"updating",get:function(){return this._dirty||
this.updatingHandles.updating}},{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return t}(c.HandleOwner);b.__decorate([p.property()],c.prototype,"graphicsCoreOwner",void 0);b.__decorate([p.property()],c.prototype,"layer",void 0);b.__decorate([p.property()],c.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([p.property()],c.prototype,"graphicsCore",void 0);b.__decorate([p.property()],c.prototype,"basemapTerrain",void 0);b.__decorate([p.property({constructOnly:!0})],
c.prototype,"layerScaleEnabled",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([p.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([p.property()],c.prototype,"_dirty",void 0);c=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c);const l=g.create();return c})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(b,c,y){if(!y||null==c)return null;
if(!b){a:{b=y.toLowerCase();for(var p in c)if(p.toLowerCase()===b){c=c[p];break a}c=null}return c}return(p=b.get(y))?c[p.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){a.FeatureVisibilityFilter=function(w){function r(D){var A=w.call(this,D)||this;A._updateTask=null;A._frameTask=null;A._queryEngine=null;A._updateRequested=!0;A._updateVisibility=async v=>{if(null==A._compositedFeatureFilter&&null==A._sceneFilter||0===A.context.getFeatureCount())return A._frameTask.schedule(()=>A.clear(),v);try{const B=await A._queryEngine.executeQueryForIdSet(A._compositedFeatureFilter,A._sceneFilter,v);return A._frameTask.schedule(()=>
{A.context.updateFeatureVisibilities(C=>B.has(C))},v)}catch(B){return k.throwIfAbortError(B),u.getLogger(b._assertThisInitialized(A)).warn(`FeatureFilter query failed: ${B}`,{error:B}),A._frameTask.schedule(()=>{A.context.setAllFeaturesVisibility(!0)},v)}};return A}b._inherits(r,w);var x=r.prototype;x.initialize=function(){const D=t.TaskPriority.FILTER_VISIBILITY,{layer:A,view:v}=this._layerView,{featureStore:B}=this.context;this._queryEngine=new m.QueryEngine({context:{spatialReference:v.spatialReference,
layer:A,scheduler:v.resourceController.scheduler,featureStore:B,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:D});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(D,this);this.updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),d.initial)};x.destroy=function(){this._updateRequested=!1;this.handles.removeAll();this.updatingHandles.removeAll();this.clear();this._updateTask=
q.abortMaybe(this._updateTask);this._frameTask=q.removeMaybe(this._frameTask);this._queryEngine=q.destroyMaybe(this._queryEngine);this._set("context",null)};x.reapply=function(){this._updateRequested=!0};x.clear=function(){this._queryEngine.clear();this.context.clearFeaturesVisibility()};x.runTask=function(D){this._updateRequested&&(this._updateTask=q.abortMaybe(this._updateTask),this._updateTask=y.createTask(this._updateVisibility),this._updateRequested=!1,D.madeProgress());this._frameTask.processQueue(D)};
b._createClass(r,[{key:"updating",get:function(){return this.running||this.updatingHandles.updating||null!=this._updateTask&&!this._updateTask.finished}},{key:"running",get:function(){return this._updateRequested||this._frameTask.updating}},{key:"defaultVisibility",get:function(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}},{key:"_featureFilter",get:function(){return"filter"in this._layerView?this._layerView.filter:null}},{key:"_sceneFilter",get:function(){return"layerFilter"in
this._layerView?this._layerView.layerFilter:null}},{key:"_floorFilter",get:function(){return l.getFloorFilterClause(this._layerView)}},{key:"_timeExtent",get:function(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}},{key:"_compositedFeatureFilter",get:function(){const {_featureFilter:D,_timeExtent:A,_floorFilter:v}=this;if(null==A&&null==v)return D;const B=null!=D?D.clone():new n;null!=A&&(B.timeExtent=null!=B.timeExtent?B.timeExtent.intersection(A):A);null!=v&&(B.where=null==
B.where||""===B.where?v:`(${B.where}) AND (${v})`);return B}},{key:"_layerView",get:function(){return this.context.layerView}}]);return r}(p.HandleOwner);c.__decorate([f.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"updating",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"running",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);
c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,
"_layerView",null);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);c.__decorate([f.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=c.__decorate([z.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(c,y){if(!c?.length)return null;
c=c.filter(p=>""!==p).map(p=>`'${p}'`);c.push("''");return`${y} IN (${c.join(",")}) OR ${y} IS NULL`}a.getFloorFilterClause=function(c){const y=c.layer;return"floorInfo"in y&&y.floorInfo?.floorField&&"floors"in c.view?b(c.view.floors,y.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(c,y){return"floorInfo"in y&&y.floorInfo?.floorField?b(c,y.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l=e.QueryEngine;a.QueryEngine=function(m){function t(r){r=m.call(this,r)||this;r._dataQueryEngineInstance=null;return r}b._inherits(t,m);var w=t.prototype;w.destroy=function(){this.clear()};w.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};w.executeQueryForIdSet=async function(r,x,D){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(r,x),D)};
w.executeQueryForCount=async function(r,x){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(r),x)};w.executeQueryForExtent=async function(r,x){const {count:D,extent:A}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(r),x);r=g.fromJSON(A);return{count:D,extent:r}};w.executeQueryForIds=async function(r,x){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(r),x)};w.executeQueryForLatestObservations=async function(r,x){r=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(r),
x);r=h.fromJSON(r);r.features.forEach(D=>{D.layer=this.layer;D.sourceLayer=this.layer});return r};w.executeQuery=async function(r,x){r=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(r),x);r=h.fromJSON(r);r.features.forEach(D=>{D.layer=this.layer;D.sourceLayer=this.layer});return r};w._ensureQueryJSON=function(r,x){let D=this.defaultQueryJSON;null!=r&&("outSpatialReference"in r&&!r.outSpatialReference&&(r.outSpatialReference=this.spatialReference),D=r.toJSON());null!=x&&(r=x.geometries.map(A=>
A.toJSON()).reduce((A,v)=>{A.rings=A.rings.concat(v.rings);return A}),D={...D,sceneFilter:{...x,geometry:r}});return D};w._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const r="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,x=this.layer.objectIdField,D=n.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),A=this.layer.fields?.map(K=>K.toJSON())??[],v=this.priority,B=this.spatialReference.toJSON(),
{hasZ:C,hasM:E,featureStore:F,scheduler:M}=this.context;return this._dataQueryEngineInstance=new l({hasZ:C,hasM:E,geometryType:D,fields:A,timeInfo:r,spatialReference:B,objectIdField:x,featureStore:F,scheduler:M,priority:v})};b._createClass(t,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new z({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return t}(p);c.__decorate([u.property({constructOnly:!0})],a.QueryEngine.prototype,"context",void 0);c.__decorate([u.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);c.__decorate([u.property()],a.QueryEngine.prototype,"layer",null);c.__decorate([u.property()],
a.QueryEngine.prototype,"spatialReference",null);c.__decorate([u.property()],a.QueryEngine.prototype,"_queryGeometryType",null);c.__decorate([u.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=c.__decorate([f.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C){function E(L){return null!=L&&L.every(O=>"exceedslimit"!==O.statisticType)}let F=b._createClass(function(L,O=null,I,H,J){this.attributes=L;this.geometry=I;this.centroid=H;this.filterFlags=J;this.groupId=-1;this.displayId=O});const M=new q.MemCacheStorage(2E6);let K=0,G=function(){function L(I){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:w.queryCapabilities};this.geometryType=I.geometryType;this.hasM=!!I.hasM;
this.hasZ=!!I.hasZ;this.objectIdField=I.objectIdField;this.spatialReference=I.spatialReference;this.definitionExpression=I.definitionExpression;this.featureStore=I.featureStore;this.aggregateAdapter=I.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=I.timeInfo;I.cacheSpatialQueries&&(this._geometryQueryCache=new q.MemCache(K++ +"$$",M));this.fieldsIndex=new v(I.fields);I.scheduler&&I.priority&&(this._frameTask=I.scheduler.registerTask(I.priority))}
var O=L.prototype;O.destroy=function(){this._frameTask=u.removeMaybe(this._frameTask);this.clearCache();u.destroyMaybe(this._geometryQueryCache);this._changeHandle=u.removeMaybe(this._changeHandle);u.destroyMaybe(this.fieldsIndex)};O.clearCache=function(){this._geometryQueryCache?.clear();this._timeExtentPromise=this._allFeaturesPromise=null};O.executeQuery=async function(I,H){try{return(await this._executeQuery(I,{},H)).createQueryResponse()}catch(J){if(J!==A.QUERY_ENGINE_EMPTY_RESULT)throw J;return(new r.QueryEngineResult([],
I,this)).createQueryResponse()}};O.executeQueryForCount=async function(I={},H){try{return(await this._executeQuery(I,{returnGeometry:!1,returnCentroid:!1,outSR:null},H)).createQueryResponseForCount()}catch(J){if(J!==A.QUERY_ENGINE_EMPTY_RESULT)throw J;return 0}};O.executeQueryForExtent=async function(I,H){const J=I.outSR;try{const N=await this._executeQuery(I,{returnGeometry:!0,returnCentroid:!1,outSR:null},H),R=N.size;if(!R)return{count:0,extent:null};const W=await this._getBounds(N.items,N.spatialReference,
J||this.spatialReference);return{count:R,extent:W}}catch(N){if(N===A.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw N;}};O.executeQueryForIds=async function(I,H){return this.executeQueryForIdSet(I,H).then(J=>Array.from(J))};O.executeQueryForIdSet=async function(I,H){try{const J=await this._executeQuery(I,{returnGeometry:!0,returnCentroid:!1,outSR:null},H),N=J.items,R=new Set;await this._reschedule(()=>{for(const W of N)R.add(J.featureAdapter.getObjectId(W))},H);return R}catch(J){if(J===
A.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw J;}};O.executeQueryForSnapping=async function(I,H){const {point:J,distance:N,returnEdge:R,returnVertex:W}=I;if(!R&&!W)return{candidates:[]};const T=await this._reschedule(()=>this._checkQuerySupport(I.query),H),P=!n.equals(J.spatialReference,this.spatialReference);P&&await t.checkProjectionSupport(J.spatialReference,this.spatialReference);var Q="number"===typeof N?N:N.x,S="number"===typeof N?N:N.y;Q={xmin:J.x-Q,xmax:J.x+Q,ymin:J.y-S,ymax:J.y+S,spatialReference:J.spatialReference};
Q=P?t.project(Q,this.spatialReference):Q;if(!Q)return{candidates:[]};S=(await z.normalizeCentralMeridian(h.fromJSON(J),null,{signal:H}))[0];const U=(await z.normalizeCentralMeridian(h.fromJSON(Q),null,{signal:H}))[0];if(null==S||null==U)return{candidates:[]};const V=new r.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(U.toJSON())),H),T,this);await this._reschedule(()=>this._executeObjectIdsQuery(V),H);await this._reschedule(()=>this._executeTimeQuery(V),H);
await this._reschedule(()=>this._executeAttributesQuery(V),H);H=S.toJSON();H=P?t.project(H,this.spatialReference):H;return V.createSnappingResponse({...I,point:H,distance:P?Math.max(Q.xmax-Q.xmin,Q.ymax-Q.ymin)/2:N},J.spatialReference)};O.executeQueryForLatestObservations=async function(I,H){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new y("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:I,timeInfo:this.timeInfo});try{const J=await this._executeQuery(I,
{},H);await this._reschedule(()=>this._filterLatest(J),H);return J.createQueryResponse()}catch(J){if(J!==A.QUERY_ENGINE_EMPTY_RESULT)throw J;return(new r.QueryEngineResult([],I,this)).createQueryResponse()}};O.executeQueryForSummaryStatistics=async function(I={},H,J){const {field:N,normalizationField:R,valueExpression:W}=H;return(await this._getQueryEngineResultForStats(I,{field:N,normalizationField:R,valueExpression:W},J)).createSummaryStatisticsResponse(H)};O.executeQueryForUniqueValues=async function(I=
{},H,J){const {field:N,field2:R,field3:W,valueExpression:T}=H;return(await this._getQueryEngineResultForStats(I,{field:N,field2:R,field3:W,valueExpression:T},J)).createUniqueValuesResponse(H)};O.executeQueryForClassBreaks=async function(I={},H,J){const {field:N,normalizationField:R,valueExpression:W}=H;return(await this._getQueryEngineResultForStats(I,{field:N,normalizationField:R,valueExpression:W},J)).createClassBreaksResponse(H)};O.executeQueryForHistogram=async function(I={},H,J){const {field:N,
normalizationField:R,valueExpression:W}=H;return(await this._getQueryEngineResultForStats(I,{field:N,normalizationField:R,valueExpression:W},J)).createHistogramResponse(H)};O.fetchRecomputedExtents=async function(I){const [H,J]=await Promise.all(["getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getBounds(await this._getAllFeatures(),this.spatialReference,this.spatialReference),null!=this._timeExtentPromise?
this._timeExtentPromise:this._timeExtentPromise=D.getTimeExtent(this.timeInfo,this.featureStore)]);k.throwIfAborted(I);return{fullExtent:H,timeExtent:J}};O._getBounds=async function(I,H,J){const N=f.set(f.create(),f.NEGATIVE_INFINITY);await this.featureStore.forEachBounds(I,R=>f.expandWithAABB(N,R));I={xmin:N[0],ymin:N[1],xmax:N[3],ymax:N[4],spatialReference:A.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(N[2])&&isFinite(N[5])&&(I.zmin=N[2],I.zmax=N[5]);H=t.project(I,H,J);H.spatialReference=
A.cleanFromGeometryEngine(J);0===H.xmax-H.xmin&&(J=d.getMetersPerUnitForSR(H.spatialReference),H.xmin-=J,H.xmax+=J);0===H.ymax-H.ymin&&(J=d.getMetersPerUnitForSR(H.spatialReference),H.ymin-=J,H.ymax+=J);this.hasZ&&null!=H.zmin&&null!=H.zmax&&0===H.zmax-H.zmin&&(J=d.getMetersPerUnitForSR(H.spatialReference),H.zmin-=J,H.zmax+=J);return H};O._schedule=async function(I,H){return null!=this._frameTask?this._frameTask.schedule(I,H):I(C.noBudget)};O._reschedule=async function(I,H){return null!=this._frameTask?
this._frameTask.reschedule(I,H):I(C.noBudget)};O._getAllFeaturesQueryEngineResult=async function(I){return new r.QueryEngineResult(await this._getAllFeatures(),I,this)};O._getAllFeatures=async function(){if(null==this._allFeaturesPromise){const J=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(N=>J.push(N))})().then(()=>J)}const I=this._allFeaturesPromise,H=await I;return I===this._allFeaturesPromise?H.slice():this._getAllFeatures()};O._executeQuery=async function(I,H,J){I=
p.clone(I);I=await this._schedule(()=>A.normalizeQuery(I,this.definitionExpression,this.spatialReference),J);I=await this._reschedule(()=>this._checkQuerySupport(I),J);I={...I,...H};const N=await this._reschedule(()=>this._executeSceneFilterQuery(I,J),J),R=await this._reschedule(()=>this._executeGeometryQuery(I,N,J),J);await this._reschedule(()=>this._executeAggregateIdsQuery(R),J);await this._reschedule(()=>this._executeObjectIdsQuery(R),J);await this._reschedule(()=>this._executeTimeQuery(R),J);
await this._reschedule(()=>this._executeAttributesQuery(R),J);return R};O._executeSceneFilterQuery=async function(I,H){if(null==I.sceneFilter)return null;const {outSR:J,returnGeometry:N,returnCentroid:R}=I;var W=this.featureStore.featureSpatialReference,T=I.sceneFilter.geometry;const P=null==W||n.equals(W,T.spatialReference)?T:t.project(T,W);if(!P)return null;W=N||R;W=n.isValid(J)&&!n.equals(this.spatialReference,J)&&W?async V=>this._project(V,J):V=>V;const Q=this.featureAdapter;T=await this._reschedule(()=>
this._searchFeatures(this._getQueryBBoxes(P)),H);if("disjoint"===I.sceneFilter.spatialRelationship){if(!T.length)return null;const V=new Set;for(var S of T)V.add(Q.getObjectId(S));const X=await this._reschedule(()=>this._getAllFeatures(),H);S=await this._reschedule(async()=>{const Y=await x.getSpatialQueryOperator("esriSpatialRelDisjoint",P,this.geometryType,this.hasZ,this.hasM),Z=await this._runSpatialFilter(X,ea=>!V.has(Q.getObjectId(ea))||Y(Q.getGeometry(ea)),H);return new r.QueryEngineResult(Z,
I,this)},H);return W(S)}if(!T.length)return new r.QueryEngineResult([],I,this);if(this._canExecuteSinglePass(P,I))return W(new r.QueryEngineResult(T,I,this));const U=await x.getSpatialQueryOperator("esriSpatialRelContains",P,this.geometryType,this.hasZ,this.hasM);S=await this._runSpatialFilter(T,V=>U(Q.getGeometry(V)),H);return W(new r.QueryEngineResult(S,I,this))};O._executeGeometryQuery=async function(I,H,J){if(null!=H&&0===H.items.length)return H;I=null!=H?H.query:I;const {geometry:N,outSR:R,spatialRel:W,
returnGeometry:T,returnCentroid:P}=I;var Q=this.featureStore.featureSpatialReference;const S=!N||null==Q||n.equals(Q,N.spatialReference)?N:t.project(N,Q),U=T||P,V=n.isValid(R)&&!n.equals(this.spatialReference,R),X=this._geometryQueryCache&&null==H?V&&U?JSON.stringify({originalFilterGeometry:N,spatialRelationship:W,outSpatialReference:R}):JSON.stringify({originalFilterGeometry:N,spatialRelationship:W}):null;Q=X?this._geometryQueryCache.get(X):null;if(null!=Q)return new r.QueryEngineResult(Q,I,this);
Q=async ha=>{V&&U&&await this._project(ha,R);X&&this._geometryQueryCache.put(X,ha.items,ha.items.length+1);return ha};if(!S)return Q(null!=H?H:await this._getAllFeaturesQueryEngineResult(I));const Y=this.featureAdapter;let Z=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(N)),J);if("esriSpatialRelDisjoint"===W){if(!Z.length)return Q(null!=H?H:await this._getAllFeaturesQueryEngineResult(I));const ha=new Set;for(var ea of Z)ha.add(Y.getObjectId(ea));const ia=null!=H?H.items:await this._reschedule(()=>
this._getAllFeatures(),J);ea=await this._reschedule(async()=>{const oa=await x.getSpatialQueryOperator(W,S,this.geometryType,this.hasZ,this.hasM),ma=await this._runSpatialFilter(ia,fa=>!ha.has(Y.getObjectId(fa))||oa(Y.getGeometry(fa)),J);return new r.QueryEngineResult(ma,I,this)},J);return Q(ea)}if(null!=H){const ha=new c.PositionHint;Z=Z.filter(ia=>0<=c.indexOf(H.items,ia,H.items.length,ha))}if(!Z.length)return Q=new r.QueryEngineResult([],I,this),X&&this._geometryQueryCache.put(X,Q.items,1),Q;if(this._canExecuteSinglePass(S,
I))return Q(new r.QueryEngineResult(Z,I,this));const ja=await x.getSpatialQueryOperator(W,S,this.geometryType,this.hasZ,this.hasM);ea=await this._runSpatialFilter(Z,ha=>ja(Y.getGeometry(ha)),J);return Q(new r.QueryEngineResult(ea,I,this))};O._executeAggregateIdsQuery=function(I){if(0!==I.items.length&&I.query.aggregateIds&&I.query.aggregateIds.length&&null!=this.aggregateAdapter){var H=new Set;for(const N of I.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(N).forEach(R=>H.add(R));var J=
this.featureAdapter.getObjectId;I.items=I.items.filter(N=>H.has(J(N)))}};O._executeObjectIdsQuery=function(I){if(0!==I.items.length&&I.query.objectIds&&I.query.objectIds.length){var H=new Set(I.query.objectIds),J=this.featureAdapter.getObjectId;I.items=I.items.filter(N=>H.has(J(N)))}};O._executeTimeQuery=function(I){if(0!==I.items.length){var H=D.getTimeOperator(this.timeInfo,I.query.timeExtent,this.featureAdapter);null!=H&&(I.items=I.items.filter(H))}};O._executeAttributesQuery=function(I){if(0!==
I.items.length){var H=m.getWhereClause(I.query.where,this.fieldsIndex);if(H){if(!H.isStandardized)throw new TypeError("Where clause is not standardized");I.items=I.items.filter(J=>H.testFeature(J,this.featureAdapter))}}};O._runSpatialFilter=async function(I,H,J){if(!H)return I;if(null==this._frameTask)return I.filter(T=>H(T));let N=0;const R=[],W=async T=>{for(;N<I.length;){const P=I[N++];H(P)&&(R.push(P),T.madeProgress());T.done&&await this._reschedule(Q=>W(Q),J)}};return this._reschedule(T=>W(T),
J).then(()=>R)};O._filterLatest=function(I){const {trackIdField:H,startTimeField:J,endTimeField:N}=this.timeInfo,R=N||J,W=new Map,T=this.featureAdapter.getAttribute;for(const P of I.items){const Q=T(P,H),S=T(P,R),U=W.get(Q);(!U||S>T(U,R))&&W.set(Q,P)}I.items=Array.from(W.values())};O._canExecuteSinglePass=function(I,H){({spatialRel:H}=H);return x.canQueryWithRBush(I)&&("esriSpatialRelEnvelopeIntersects"===H||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===H||"esriSpatialRelContains"===
H||"esriSpatialRelWithin"===H))};O._project=async function(I,H){if(!H||n.equals(this.spatialReference,H))return I;const J=this.featureAdapter;H=await t.projectMany(I.items.map(N=>A.getGeometry(this.geometryType,this.hasZ,this.hasM,J.getGeometry(N))),this.spatialReference,H);I.items=H.map((N,R)=>J.cloneWithGeometry(I.items[R],l.convertFromGeometry(N,this.hasZ,this.hasM)));return I};O._getQueryBBoxes=function(I){if(x.canQueryWithRBush(I)){if(h.isExtent(I))return[g.fromValues(I.xmin,I.ymin,I.xmax,I.ymax)];
if(h.isPolygon(I))return I.rings.map(H=>g.fromValues(Math.min(H[0][0],H[2][0]),Math.min(H[0][1],H[2][1]),Math.max(H[0][0],H[2][0]),Math.max(H[0][1],H[2][1])))}return[e.getBoundsXY(g.create(),I)]};O._searchFeatures=async function(I){const H=new Set;await Promise.all(I.map(J=>this.featureStore.forEachInBounds(J,N=>H.add(N))));I=Array.from(H.values());H.clear();return I};O._checkStatisticsSupport=async function(I,H){if(0>(I.distance??0)||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||
I.text||I.outStatistics||I.groupByFieldsForStatistics||I.having||I.orderByFields)throw new y("feature-store:unsupported-query","Unsupported query options",{query:I});this._checkAttributesQuerySupport(I);return Promise.all([this._checkStatisticsParamsSupport(H,I),x.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),t.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)};O._checkStatisticsParamsSupport=async function(I,H){var J=[];I.valueExpression&&({arcadeUtils:J}=
await B.loadArcade(),J=J.extractFieldNames(I.valueExpression));I.field&&J.push(I.field);I.field2&&J.push(I.field2);I.field3&&J.push(I.field3);I.normalizationField&&J.push(I.normalizationField);if(!J.length&&!I.valueExpression)throw new y("feature-store:unsupported-query","field or valueExpression is required",{params:I});m.validateFields(this.fieldsIndex,J,{errorMessage:"Cannot calculate statistics for missing fields",query:H});m.validateFieldTypes(this.fieldsIndex,J,{expressionName:"statistics",
query:H})};O._checkQuerySupport=async function(I){if(0>(I.distance??0)||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text)throw new y("feature-store:unsupported-query","Unsupported query options",{query:I});this._checkAttributesQuerySupport(I);this._checkStatisticsQuerySupport(I);return Promise.all([x.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),t.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)};O._checkAttributesQuerySupport=
function(I){const {outFields:H,orderByFields:J,returnDistinctValues:N,outStatistics:R}=I,W=R?R.map(T=>T.outStatisticFieldName&&T.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(J&&0<J.length){const T=J.map(P=>{const Q=P.toLowerCase();return Q.includes(" asc")?Q.split(" asc")[0]:Q.includes(" desc")?Q.split(" desc")[0]:P}).filter(P=>!W.includes(P));m.validateFields(this.fieldsIndex,T,{expressionName:"orderByFields",query:I})}if(H&&0<H.length)m.validateFields(this.fieldsIndex,H,{expressionName:"outFields",
query:I});else if(N)throw new y("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:I});m.validateWhere(this.fieldsIndex,I.where,I)};O._checkStatisticsQuerySupport=function(I){const {outStatistics:H,groupByFieldsForStatistics:J,having:N}=I;var R=J&&J.length,W=H&&H.length;if(N){if(!R||!W)throw new y("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:I});m.validateHaving(this.fieldsIndex,
N,H,I)}if(W&&E(H)){W=H.map(T=>T.onStatisticField).filter(Boolean);m.validateFields(this.fieldsIndex,W,{expressionName:"onStatisticFields",query:I});R&&m.validateFields(this.fieldsIndex,J,{expressionName:"groupByFieldsForStatistics",query:I});R=new Set([...m.validNumericTypesKebabDict.jsonValues,...m.validDateTypesKebabDict.jsonValues]);W=(new Intl.ListFormat("en-US",{type:"conjunction"})).format([...m.validNumericTypesKebabDict.apiValues,...m.validDateTypesKebabDict.apiValues]);for(const T of H){const {onStatisticField:P,
statisticType:Q}=T;if(("percentile_disc"===Q||"percentile_cont"===Q)&&"statisticParameters"in T){const {statisticParameters:S}=T;if(!S)throw new y("feature-store:unsupported-query","statisticParameters should be set for percentile type",{definition:T,query:I});}else if("count"!==Q&&"min"!==Q&&"max"!==Q&&P&&m.hasInvalidFieldType(P,this.fieldsIndex,R))throw new y("feature-store:unsupported-query",`outStatistics with '${Q}' statistic type, only supports ${W} field types`,{definition:T,query:I});}}};
O._getQueryEngineResultForStats=async function(I,H,J){I=p.clone(I);try{I=await this._schedule(()=>A.normalizeQuery(I,this.definitionExpression,this.spatialReference),J);I=await this._reschedule(()=>this._checkStatisticsSupport(I,H),J);const N=await this._reschedule(()=>this._executeSceneFilterQuery(I,J),J),R=await this._reschedule(()=>this._executeGeometryQuery(I,N,J),J);await this._reschedule(()=>this._executeAggregateIdsQuery(R),J);await this._reschedule(()=>this._executeObjectIdsQuery(R),J);await this._reschedule(()=>
this._executeTimeQuery(R),J);await this._reschedule(()=>this._executeAttributesQuery(R),J);return R}catch(N){if(N!==A.QUERY_ENGINE_EMPTY_RESULT)throw N;return new r.QueryEngineResult([],I,this)}};b._createClass(L,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}}]);return L}();a.Feature=F;a.QueryEngine=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/jsonMap",
"../../../core/sql/WhereClauseCache"],function(a,b,c,y){function p(m,t,w={}){t=u(m,t);if(!t)throw new b("feature-store:unsupported-query","invalid SQL expression",{expression:m});const r=w.expressionName||"expression";if(w.validateStandardized&&!t.isStandardized)throw new b("feature-store:unsupported-query",`${r} is not standard`,{expression:m});if(w.validateAggregate&&!t.isAggregate)throw new b("feature-store:unsupported-query",`${r} does not contain a valid aggregate function`,{expression:m});return t.fieldNames}
function u(m,t){return m?e.get(m,t):null}function q(m,t,w={}){w.errorMessage||(w.errorMessage=w.expressionName?`${w.expressionName} contains invalid fields`:"Fields are invalid");d(m,t,(r,x)=>x.has(r),w)}function k(m,t,w={}){w.errorMessage||(w.errorMessage=w.expressionName?`${w.expressionName} only supports ${l} field types`:`Only ${l} field types are supported`);d(m,t,(r,x)=>!g(r,x),w)}function d(m,t,w,r={}){const x=r.verifyExpression??!0,D=[];for(const A of t)if(t=w(A,m),"*"!==A&&!t)if(x){t=f(A);
try{const v=p(t,m,{validateStandardized:!0});d(m,v,w,r)}catch(v){t=v?.details;if(t?.expression)throw v;t?.invalidFields?D.push(...t.invalidFields):D.push(A)}}else D.push(A);if(D.length)throw new b("feature-store:unsupported-query",r.errorMessage,{invalidFields:D,query:r.query});}function f(m){return m.split(" as ")[0]}function g(m,t,w=n){return(m=t.get(m))?!w.has(m.type):!1}const e=new y.WhereClauseCache(50,500);y=new c.JSONMap({esriFieldTypeString:"string"});const h=new c.JSONMap({esriFieldTypeOID:"oid",
esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long"}),z=new c.JSONMap({esriFieldTypeDate:"date"});c=new c.JSONMap({esriFieldTypeGUID:"guid",esriFieldTypeGlobalId:"global-id"});const n=new Set([...h.jsonValues,...z.jsonValues,...y.jsonValues,...c.jsonValues]),l=(new Intl.ListFormat("en-US",{type:"conjunction"})).format([...h.apiValues,...z.apiValues,...y.apiValues,...c.apiValues]);a.getAliasFromFieldName=
function(m){return m.split(" as ")[1]};a.getExpressionFromFieldName=f;a.getWhereClause=u;a.hasInvalidFieldType=g;a.validDateTypesKebabDict=z;a.validGuidTypesKebabDict=c;a.validNumericTypesKebabDict=h;a.validStringTypesKebabDict=y;a.validateFieldTypes=k;a.validateFields=q;a.validateHaving=function(m,t,w,r){if(!t)return!0;const x=p(t,m,{validateAggregate:!0,expressionName:"having"});q(m,x,{expressionName:"having",query:r});k(m,x,{expressionName:"having",query:r});if(!e.get(t,m)?.getExpressions().every(D=>
{const {aggregateType:A,field:v}=D,B=m.get(v)?.name;return w.some(C=>{const {onStatisticField:E,statisticType:F}=C;return m.get(E)?.name===B&&F.toLowerCase().trim()===A})}))throw new b("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:t});return!0};a.validateWhere=function(m,t,w){if(!t)return!0;t=p(t,m,{validateStandardized:!0,expressionName:"where clause"});q(m,t,{expressionName:"where clause",query:w});k(m,t,{expressionName:"where clause",query:w});
return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../LRUCache","./WhereClause"],function(a,b,c,y){let p=function(){function u(q,k){this._cache=new c.LRUCache(q);this._invalidCache=new c.LRUCache(k)}u.prototype.get=function(q,k){const d=`${k.uid}:${q}`,f=this._cache.get(d);if(f)return f;if(void 0!==this._invalidCache.get(d))return null;try{const g=y.WhereClause.create(q,k);
this._cache.put(d,g);return g}catch{return this._invalidCache.put(d,null),null}};return b._createClass(u)}();a.WhereClauseCache=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,b,c,y,p,u){function q(G,L){G+="";return G.length>=L?G:Array(L-G.length+1).join("0")+G}function k(G,L,O="0",I="0",H="0",J="0",
N="",R="0",W="0"){return"+"===N||"-"===N?(G=`${q(parseInt(G,10),4)}-${q(parseInt(L,10),2)}-${q(parseInt(O,10),2)}`,L="",10>parseFloat(J)&&(L="0"),I=`${q(parseInt(I,10),2)}:${q(parseInt(H,10),2)}:${L+parseFloat(J).toString()}`,N=`${N}${q(parseInt(R,10),2)}:${q(parseInt(W,10),2)}`,new Date(G+"T"+I+N)):new Date(parseInt(G,10),parseInt(L,10)-1,parseInt(O,10),parseInt(I,10),parseInt(H,10),parseFloat(J))}function d(G){let L=D.exec(G);if(null!==L){const [,O,I,H,J,N,R]=L;return k(O,I,H,J,N,R)}L=A.exec(G);
if(null!==L){const [,O,I,H,J,N,R,W,T,P]=L;return k(O,I,H,J,N,R,W,T,P)}L=v.exec(G);if(null!==L){const [,O,I,H,J,N,R,W,T]=L;return k(O,I,H,J,N,"0",R,W,T)}L=B.exec(G);if(null!==L){const [,O,I,H,J,N]=L;return k(O,I,H,J,N)}L=x.exec(G);if(null!==L){const [,O,I,H]=L;return k(O,I,H)}throw Error("SQL Invalid Timestamp");}function f(G){const L=x.exec(G);if(null===L)try{return d(G)}catch{throw Error("SQL Invalid Date");}const [,O,I,H]=L;return new Date(parseInt(O,10),parseInt(I,10)-1,parseInt(H,10))}function g(G){return Array.isArray(G)?
G:[G]}function e(G){return null!==G?!0!==G:null}function h(G,L){return null!=G&&null!=L?!0===G&&!0===L:!1===G||!1===L?!1:null}function z(G,L){return null!=G&&null!=L?!0===G||!0===L:!0===G||!0===L?!0:null}function n(G,L){if(null==G)return null;let O=!1;for(const I of L)if(null==I)O=null;else if(G===I){O=!0;break}return O}function l(G,L,O){if(null==G)return null;let I="",H=M.Normal;for(let J=0;J<L.length;J++){const N=L.charAt(J);switch(H){case M.Normal:N===O?H=M.Escaped:I="-[]/{}()*+?.\\^$|".includes(N)?
I+("\\"+N):"%"===N?I+".*":"_"===N?I+".":I+N;break;case M.Escaped:I="-[]/{}()*+?.\\^$|".includes(N)?I+("\\"+N):I+N,H=M.Normal}}return(new RegExp("^"+I+"$","m")).test(G)}function m(G){return G instanceof Date?G.valueOf():G}function t(G,L,O){if(null==L||null==O)return null;L=m(L);O=m(O);switch(G){case "\x3c\x3e":return L!==O;case "\x3d":return L===O;case "\x3e":return L>O;case "\x3c":return L<O;case "\x3e\x3d":return L>=O;case "\x3c\x3d":return L<=O}}function w(G,L,O){if("||"===G)return p.evaluateFunction("concat",
[L,O]);if(L instanceof p.SqlInterval)if(O instanceof Date)switch(G){case "+":return new Date(L.valueInMilliseconds()+O.getTime());case "-":return L.valueInMilliseconds()-O.getTime();case "*":return L.valueInMilliseconds()*O.getTime();case "/":return L.valueInMilliseconds()/O.getTime()}else if(O instanceof p.SqlInterval)switch(G){case "+":return p.SqlInterval.createFromMilliseconds(L.valueInMilliseconds()+O.valueInMilliseconds());case "-":return p.SqlInterval.createFromMilliseconds(L.valueInMilliseconds()-
O.valueInMilliseconds());case "*":return L.valueInMilliseconds()*O.valueInMilliseconds();case "/":return L.valueInMilliseconds()/O.valueInMilliseconds()}else L=L.valueInMilliseconds();else if(O instanceof p.SqlInterval)if(L instanceof Date)switch(G){case "+":return new Date(O.valueInMilliseconds()+L.getTime());case "-":return new Date(L.getTime()-O.valueInMilliseconds());case "*":return L.getTime()*O.valueInMilliseconds();case "/":return L.getTime()/O.valueInMilliseconds()}else O=O.valueInMilliseconds();
else if(L instanceof Date&&"number"===typeof O)switch(O*=864E5,L=L.getTime(),G){case "+":return new Date(L+O);case "-":return new Date(L-O);case "*":return new Date(L*O);case "/":return new Date(L/O)}else if(O instanceof Date&&"number"===typeof L)switch(L*=864E5,O=O.getTime(),G){case "+":return new Date(L+O);case "-":return new Date(L-O);case "*":return new Date(L*O);case "/":return new Date(L/O)}switch(G){case "+":return L+O;case "-":return L-O;case "*":return L*O;case "/":return L/O}}function r(G,
L,O,I){G=I.getAttribute(G,L);return null!=G&&1===O[L]?new Date(G):G}const x=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,D=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,B=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,C=new Set(["current_timestamp","current_date","current_time"]);let E=function(){function G(){}
G.makeBool=function(L){return!0===L};G.featureValue=function(L,O,I,H){return r(L,O,I,H)};G.equalsNull=function(L){return null===L};G.applyLike=function(L,O,I){return l(L,O,I)};G.ensureArray=function(L){return g(L)};G.applyIn=function(L,O){return n(L,O)};G.currentDate=function(){const L=new Date;L.setHours(0,0,0,0);return L};G.makeSqlInterval=function(L,O,I){return p.SqlInterval.createFromValueAndQualifer(L,O,I)};G.convertInterval=function(L){return L instanceof p.SqlInterval?L.valueInMilliseconds():
L};G.currentTimestamp=function(){return new Date};G.compare=function(L,O,I){return t(L,O,I)};G.calculate=function(L,O,I){return w(L,O,I)};G.makeComparable=function(L){return m(L)};G.evaluateFunction=function(L,O){return p.evaluateFunction(L,O)};G.lookup=function(L,O){L=O[L];return void 0===L?null:L};G.between=function(L,O){return null==L||null==O[0]||null==O[1]?null:L>=O[0]&&L<=O[1]};G.notbetween=function(L,O){return null==L||null==O[0]||null==O[1]?null:L<O[0]||L>O[1]};G.ternaryNot=function(L){return e(L)};
G.ternaryAnd=function(L,O){return h(L,O)};G.ternaryOr=function(L,O){return z(L,O)};return b._createClass(G)}(),F=function(){function G(O,I){this.fieldsIndex=I;this._datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=u.WhereGrammar.parse(O);const {isStandardized:H,isAggregate:J,referencedFieldNames:N}=this._extractExpressionInfo(I);this._referencedFieldNames=N;this.isStandardized=H;this.isAggregate=J}G.create=function(O,I){return new G(O,I)};var L=G.prototype;L.testSet=function(O,
I=K){const H={};for(const J of this.fieldNames)H[J]=O.map(N=>I.getAttribute(N,J));return!!this._evaluateNode(this.parseTree,{attributes:H},K)};L.calculateValue=function(O,I=K){O=this._evaluateNode(this.parseTree,O,I);return O instanceof p.SqlInterval?O.valueInMilliseconds()/864E5:O};L.calculateValueCompiled=function(O,I=K){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(O,this.parameters,I,this._datefields);if(c("esri-csp-restrictions"))return this.calculateValue(O,
I);this._compileMe();return this.parseTree._compiledVersion(O,this.parameters,I,this._datefields)};L.testFeature=function(O,I=K){return!!this._evaluateNode(this.parseTree,O,I)};L.testFeatureCompiled=function(O,I=K){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(O,this.parameters,I,this._datefields);if(c("esri-csp-restrictions"))return this.testFeature(O,I);this._compileMe();return!!this.parseTree._compiledVersion(O,this.parameters,I,this._datefields)};L.getFunctions=
function(){const O=new Set;this._visitAll(this.parseTree,I=>{"function"===I.type&&O.add(I.name.toLowerCase())});return Array.from(O)};L.getExpressions=function(){const O=new Map;this._visitAll(this.parseTree,I=>{if("function"===I.type){const H=I.name.toLowerCase();I=I.args.value[0];if("column-reference"===I.type){I=I.column;const J=`${H}-${I}`;O.has(J)||O.set(J,{aggregateType:H,field:I})}}});return[...O.values()]};L.getVariables=function(){const O=new Set;this._visitAll(this.parseTree,I=>{"parameter"===
I.type&&O.add(I.value.toLowerCase())});return Array.from(O)};L._compileMe=function(){const O="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",O)).bind(E)};L._extractExpressionInfo=function(O){const I=[],H=new Set;let J=!0,N=!0;this._visitAll(this.parseTree,R=>{switch(R.type){case "column-reference":const W=O?.get(R.column);let T,P;W?T=P=W.name??"":(P=R.column,T=P.toLowerCase());
W&&W.name&&("date"===W.type||"esriFieldTypeDate"===W.type)&&(this._datefields[W.name]=1);H.has(T)||(H.add(T),I.push(P));R.column=P;break;case "function":const {name:Q,args:S}=R;R=S.value.length;J&&(J=p.isStandardized(Q,R));N&&(N=y.isAggregate(Q,R))}});return{referencedFieldNames:Array.from(I),isStandardized:J,isAggregate:N}};L._visitAll=function(O,I){if(null!=O)switch(I(O),O.type){case "when-clause":this._visitAll(O.operand,I);this._visitAll(O.value,I);break;case "case-expression":for(const H of O.clauses)this._visitAll(H,
I);"simple"===O.format&&this._visitAll(O.operand,I);null!==O.else&&this._visitAll(O.else,I);break;case "expression-list":for(const H of O.value)this._visitAll(H,I);break;case "unary-expression":this._visitAll(O.expr,I);break;case "binary-expression":this._visitAll(O.left,I);this._visitAll(O.right,I);break;case "function":this._visitAll(O.args,I)}};L.evaluateNodeToJavaScript=function(O){switch(O.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(O.value)+", "+JSON.stringify(O.qualifier)+
","+JSON.stringify(O.op)+")";case "case-expression":var I="";if("simple"===O.format){var H="this.makeComparable("+this.evaluateNodeToJavaScript(O.operand)+")";I="( ";for(let J=0;J<O.clauses.length;J++)I+=" ("+H+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(O.clauses[J].operand)+")) ? ("+this.evaluateNodeToJavaScript(O.clauses[J].value)+") : "}else for(I="( ",H=0;H<O.clauses.length;H++)I+=" this.makeBool("+this.evaluateNodeToJavaScript(O.clauses[H].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(O.clauses[H].value)+") : ";I=null!==O.else?I+this.evaluateNodeToJavaScript(O.else):I+"null";return I+" )";case "parameter":return"this.lookup("+JSON.stringify(O.value.toLowerCase())+",lookups)";case "expression-list":I="[";for(H of O.value)"["!==I&&(I+=","),I+=this.evaluateNodeToJavaScript(H);return I+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(O.expr)+")";case "binary-expression":switch(O.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+" )";case "IS":if("null"!==O.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(O.left)+")";case "ISNOT":if("null"!==O.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(O.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(O.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(O.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(O.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(O.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+","+JSON.stringify(O.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+","+JSON.stringify(O.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(O.operator)+","+this.evaluateNodeToJavaScript(O.left)+","+
this.evaluateNodeToJavaScript(O.right)+")";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(O.operator)+","+this.evaluateNodeToJavaScript(O.left)+","+this.evaluateNodeToJavaScript(O.right)+")"}throw Error("Not Supported Operator "+O.operator);case "null":case "boolean":case "string":case "number":return JSON.stringify(O.value);case "date":return"(new Date("+f(O.value).getTime().toString()+"))";case "timestamp":return"(new Date("+d(O.value).getTime().toString()+
"))";case "current-time":return"date"===O.mode?"this.currentDate()":"this.currentTimestamp()";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(O.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(O.name)+","+this.evaluateNodeToJavaScript(O.args)+")"}throw Error("Unsupported sql syntax "+O.type);};L._evaluateNode=function(O,I,H){switch(O.type){case "interval":return I=this._evaluateNode(O.value,I,H),p.SqlInterval.createFromValueAndQualifer(I,
O.qualifier,O.op);case "case-expression":if("simple"===O.format){var J=m(this._evaluateNode(O.operand,I,H));for(var N=0;N<O.clauses.length;N++)if(J===m(this._evaluateNode(O.clauses[N].operand,I,H)))return this._evaluateNode(O.clauses[N].value,I,H)}else for(J=0;J<O.clauses.length;J++)if(!0===this._evaluateNode(O.clauses[J].operand,I,H))return this._evaluateNode(O.clauses[J].value,I,H);return null!==O.else?this._evaluateNode(O.else,I,H):null;case "parameter":return this.parameters[O.value.toLowerCase()];
case "expression-list":J=[];for(N of O.value)J.push(this._evaluateNode(N,I,H));return J;case "unary-expression":return e(this._evaluateNode(O.expr,I,H));case "binary-expression":switch(O.operator){case "AND":return h(this._evaluateNode(O.left,I,H),this._evaluateNode(O.right,I,H));case "OR":return z(this._evaluateNode(O.left,I,H),this._evaluateNode(O.right,I,H));case "IS":if("null"!==O.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(O.left,I,H);case "ISNOT":if("null"!==
O.right.type)throw Error("Unsupported RHS for IS");return null!==this._evaluateNode(O.left,I,H);case "IN":return J=g(this._evaluateNode(O.right,I,H)),n(this._evaluateNode(O.left,I,H),J);case "NOT IN":return J=g(this._evaluateNode(O.right,I,H)),e(n(this._evaluateNode(O.left,I,H),J));case "BETWEEN":return J=this._evaluateNode(O.left,I,H),O=this._evaluateNode(O.right,I,H),null==J||null==O[0]||null==O[1]?null:J>=m(O[0])&&J<=m(O[1]);case "NOTBETWEEN":return J=this._evaluateNode(O.left,I,H),O=this._evaluateNode(O.right,
I,H),null==J||null==O[0]||null==O[1]?null:J<m(O[0])||J>m(O[1]);case "LIKE":return l(this._evaluateNode(O.left,I,H),this._evaluateNode(O.right,I,H),O.escape);case "NOT LIKE":return e(l(this._evaluateNode(O.left,I,H),this._evaluateNode(O.right,I,H),O.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return t(O.operator,this._evaluateNode(O.left,I,H),this._evaluateNode(O.right,I,H));case "-":case "+":case "*":case "/":case "||":return w(O.operator,this._evaluateNode(O.left,
I,H),this._evaluateNode(O.right,I,H))}case "null":case "boolean":case "string":case "number":return O.value;case "date":return f(O.value);case "timestamp":return d(O.value);case "current-time":return I=new Date,"date"===O.mode&&I.setHours(0,0,0,0),I;case "column-reference":return r(I,O.column,this._datefields,H);case "data-type":return O.value;case "function":return I=this._evaluateNode(O.args,I,H),this.isAggregate?y.aggregateFunction(O.name,I):p.evaluateFunction(O.name,I)}throw Error("Unsupported sql syntax "+
O.type);};b._createClass(G,[{key:"fieldNames",get:function(){return this._referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,O=>{"current-time"===O.type?this._hasDateFunctions=!0:"function"===O.type&&(this._hasDateFunctions=this._hasDateFunctions||C.has(O.name.toLowerCase()))});return this._hasDateFunctions}}]);return G}();var M;(function(G){G[G.Normal=0]="Normal";G[G.Escaped=
1]="Escaped"})(M||(M={}));const K={getAttribute(G,L){return(G&&"object"===typeof G.attributes?G.attributes:G)[L]}};a.WhereClause=F;a.defaultAttributeAdapter=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function b(p){let u=0;for(let q=0;q<p.length;q++)u+=p[q];return u/p.length}function c(p){const u=b(p),q=p.length;let k=0;for(const d of p)k+=(d-u)**2;return 1<q?k/(q-1):0}const y={min:{minParams:1,maxParams:1,
evaluate:p=>null==p[0]?null:Math.min.apply(Math,p[0])},max:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.max.apply(Math,p[0])},avg:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:b(p[0])},sum:{minParams:1,maxParams:1,evaluate:p=>{if(null==p[0])p=null;else{p=p[0];let u=0;for(let q=0;q<p.length;q++)u+=p[q];p=u}return p}},stddev:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.sqrt(c(p[0]))},count:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:p[0].length},var:{minParams:1,
maxParams:1,evaluate:p=>null==p[0]?null:c(p[0])}};a.aggregateFunction=function(p,u){const q=y[p.toLowerCase()];if(null==q)throw Error("Function Not Recognised");if(u.length<q.minParams||u.length>q.maxParams)throw Error(`Invalid Parameter count for call to ${p.toUpperCase()}`);return q.evaluate(u)};a.isAggregate=function(p,u){p=y[p.toLowerCase()];return null!=p&&u>=p.minParams&&u<=p.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../arcade/featureset/support/errorsupport","../string","../../chunks/datetime"],function(a,b,c,y,p){function u(f){f=new Date(f.getTime());f.setHours(0,0,0,0);return f}function q(f,g){if(f instanceof Date)return g?u(f):f;if("string"===typeof f||f instanceof String)if(f=p.DateTime.fromSQL(f),f.isValid)return g?u(f.toJSDate()):f.toJSDate();throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);}let k=function(){function f(){this.op="+";this.millis=this.minute=
this.year=this.month=this.hour=this.second=this.day=0}f._fixDefaults=function(g){if(null!==g.precision||null!==g.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};f._parseSecondsComponent=function(g,e){e.includes(".")?(e=e.split("."),g.second=parseFloat(e[0]),g.millis=parseInt(e[1],10)):g.second=parseFloat(e)};f.createFromMilliseconds=function(g){const e=new f;e.second=g/1E3;return e};f.createFromValueAndQualifer=function(g,e,h){let z=null;const n=new f;n.op="-"===
h?"-":"+";if("interval-period"===e.type){f._fixDefaults(e);h=RegExp("^[0-9]{1,}$");if("year"===e.period||"month"===e.period)throw Error("Year-Month Intervals not supported");if("second"===e.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(g))f._parseSecondsComponent(n,g);else throw Error("Illegal Interval");else if(h.test(g))n[e.period]=parseFloat(g);else throw Error("Illegal Interval");}else{f._fixDefaults(e.start);f._fixDefaults(e.end);if("year"===e.start.period||"month"===e.start.period)throw Error("Year-Month Intervals not supported");
if("year"===e.end.period||"month"===e.end.period)throw Error("Year-Month Intervals not supported");switch(e.start.period){case "day":switch(e.end.period){case "hour":z=RegExp("^[0-9]{1,} [0-9]{1,}$");if(z.test(g))n[e.start.period]=parseFloat(g.split(" ")[0]),n[e.end.period]=parseFloat(g.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":z=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(z.test(g))n[e.start.period]=parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),n.hour=parseFloat(g[0]),
n.minute=parseFloat(g[1]);else throw Error("Illegal Interval");break;case "second":z=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(z.test(g))n[e.start.period]=parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),n.hour=parseFloat(g[0]),n.minute=parseFloat(g[1]),f._parseSecondsComponent(n,g[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "hour":switch(e.end.period){case "minute":z=RegExp("^[0-9]{1,}:[0-9]{1,}$");
if(z.test(g))n.hour=parseFloat(g.split(":")[0]),n.minute=parseFloat(g.split(":")[1]);else throw Error("Illegal Interval");break;case "second":z=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(z.test(g))g=g.split(":"),n.hour=parseFloat(g[0]),n.minute=parseFloat(g[1]),f._parseSecondsComponent(n,g[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "minute":switch(e.end.period){case "second":z=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");
if(z.test(g))g=g.split(":"),n.minute=parseFloat(g[0]),f._parseSecondsComponent(n,g[1]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;default:throw Error("Invalid Interval.");}}return n};f.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return b._createClass(f)}();const d={extract:{minParams:2,maxParams:2,evaluate:([f,
g])=>{if(null==g)return null;if(g instanceof Date)switch(f.toUpperCase()){case "SECOND":return g.getSeconds();case "MINUTE":return g.getMinutes();case "HOUR":return g.getHours();case "DAY":return g.getDate();case "MONTH":return g.getMonth()+1;case "YEAR":return g.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:f=>{if(2===f.length){const [g,e]=f;return null==g||null==e?null:g.toString().substring(e-1)}if(3===f.length){const [g,e,h]=
f;return null==g||null==e||null==h?null:0>=h?"":g.toString().substring(e-1,e+h-1)}}},position:{minParams:2,maxParams:2,evaluate:([f,g])=>null==f||null==g?null:g.indexOf(f)+1},trim:{minParams:2,maxParams:3,evaluate:f=>{var g=3===f.length,e=g?f[1]:" ";g=g?f[2]:f[1];if(null==e||null==g)return null;e=`(${y.escapeRegExpString(e)})`;switch(f[0]){case "BOTH":return g.replaceAll(new RegExp(`^${e}*|${e}*$`,"g"),"");case "LEADING":return g.replaceAll(new RegExp(`^${e}*`,"g"),"");case "TRAILING":return g.replaceAll(new RegExp(`${e}*$`,
"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.abs(f[0])},ceiling:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.ceil(f[0])},floor:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.floor(f[0])},log:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])},log10:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?
null:Math.sin(f[0])},cos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cos(f[0])},tan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.tan(f[0])},asin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.asin(f[0])},acos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.acos(f[0])},atan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.atan(f[0])},sign:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:0<f[0]?1:0>f[1]?-1:0},power:{minParams:2,maxParams:2,
evaluate:f=>null==f[0]||null==f[1]?null:f[0]**f[1]},mod:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==f[1]?null:f[0]%f[1]},round:{minParams:1,maxParams:2,evaluate:f=>{const g=f[0];f=2===f.length?10**f[1]:1;return null==g?null:Math.round(g*f)/f}},truncate:{minParams:1,maxParams:2,evaluate:f=>null==f[0]?null:1===f.length?parseInt(f[0].toFixed(0),10):parseFloat(f[0].toFixed(f[1]))},char_length:{minParams:1,maxParams:1,evaluate:f=>"string"===typeof f[0]||f[0]instanceof String?f[0].length:0},
concat:{minParams:1,maxParams:Infinity,evaluate:f=>{let g="";for(let e=0;e<f.length;e++){if(null==f[e])return null;g+=f[e].toString()}return g}},lower:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:f=>{for(const g of f)if(null!==g)return g;return null}},cosh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cosh(f[0])},
sinh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sinh(f[0])},tanh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.tanh(f[0])},nullif:{minParams:2,maxParams:2,evaluate:f=>{const g=f[0];f=f[1];return(g instanceof Date?g.valueOf():g)===(f instanceof Date?f.valueOf():f)?null:g}},cast:{minParams:2,maxParams:2,evaluate:f=>{var g=f[0];f=f[1];if(null===g)return null;switch(f.type){case "integer":g=parseInt(g,10);if(isNaN(g))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return g;
case "smallint":g=parseInt(g,10);if(isNaN(g))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);if(32767<g||-32767>g)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return g;case "float":case "real":g=parseFloat(g);if(isNaN(g))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return g;case "date":return q(g,!0);case "timestamp":return q(g,!1);case "varchar":g=g.toString();if(g.length>f.size)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return g;default:throw new c.SqlError(c.SqlErrorCodes.InvalidDataType);
}}}};a.SqlInterval=k;a.evaluateFunction=function(f,g){const e=d[f.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(g.length<e.minParams||g.length>e.maxParams)throw Error(`Invalid Parameter count for call to ${f.toUpperCase()}`);return e.evaluate(g)};a.isStandardized=function(f,g){f=d[f.toLowerCase()];return null!=f&&g>=f.minParams&&g<=f.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../executionError"],function(a,b,c){a.SqlErrorCodes=void 0;(function(k){k.InvalidFunctionParameters="InvalidFunctionParameters";k.UnsupportedSqlFunction="UnsupportedSqlFunction";k.UnsupportedOperator="UnsupportedOperator";k.UnsupportedSyntax="UnsupportedSyntax";k.UnsupportedIsRhs="UnsupportedIsRhs";k.UnsupportedIsLhs="UnsupportedIsLhs";k.InvalidDataType="InvalidDataType";k.CannotCastValue="CannotCastValue";k.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||
(a.SqlErrorCodes={}));const y={[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",
[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};let p=function(k){function d(f,g){f=k.call(this,c.doSubstitutions(y[f],g))||this;f.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(f),d);return f}b._inherits(d,k);return b._createClass(d)}(b._wrapNativeSuper(Error));
a.FeatureSetErrorCodes=void 0;(function(k){k.NeverReach="NeverReach";k.NotImplemented="NotImplemented";k.Cancelled="Cancelled";k.InvalidStatResponse="InvalidStatResponse";k.InvalidRequest="InvalidRequest";k.RequestFailed="RequestFailed";k.MissingFeatures="MissingFeatures";k.AggregationFieldNotFound="AggregationFieldNotFound";k.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const u={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",
[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};let q=function(k){function d(f,
g){f=k.call(this,c.doSubstitutions(u[f],g))||this;f.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(f),d);return f}b._inherits(d,k);return b._createClass(d)}(b._wrapNativeSuper(Error));a.FeatureSetError=q;a.FeatureSetErrorMessages=u;a.SqlError=p;a.SqlErrorMessages=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],
function(a,b){function c(h){return h&&h.loc?`Line : ${h.loc.start?.line}, ${h.loc.start?.column}: `:""}function y(h,z){try{if(!z)return h;for(const n in z){let l=z[n];l||(l="");h=h.replace("{"+n+"}",z[n])}}catch(n){}return h}a.ExecutionErrorCodes=void 0;(function(h){h.AsyncNotEnabled="AsyncNotEnabled";h.ModulesNotSupported="ModulesNotSupported";h.CircularModules="CircularModules";h.NeverReach="NeverReach";h.UnsupportedHashType="UnsupportedHashType";h.InvalidParameter="InvalidParameter";h.UnexpectedToken=
"UnexpectedToken";h.Unrecognised="Unrecognised";h.UnrecognisedType="UnrecognisedType";h.MaximumCallDepth="MaximumCallDepth";h.BooleanConditionRequired="BooleanConditionRequired";h.TypeNotAllowedInFeature="TypeNotAllowedInFeature";h.KeyMustBeString="KeyMustBeString";h.WrongNumberOfParameters="WrongNumberOfParameters";h.CallNonFunction="CallNonFunction";h.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";h.NoFunctionInDictionary="NoFunctionInDictionary";h.NoFunctionInArray="NoFunctionInArray";
h.AssignModuleFunction="AssignModuleFunction";h.LogicExpressionOrAnd="LogicExpressionOrAnd";h.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean";h.FunctionNotFound="FunctionNotFound";h.InvalidMemberAccessKey="InvalidMemberAccessKey";h.UnsupportedUnaryOperator="UnsupportUnaryOperator";h.InvalidIdentifier="InvalidIdentifier";h.MemberOfNull="MemberOfNull";h.UnsupportedOperator="UnsupportedOperator";h.Cancelled="Cancelled";h.ModuleAccessorMustBeString="ModuleAccessorMustBeString";h.ModuleExportNotFound=
"ModuleExportNotFound";h.Immutable="Immutable";h.OutOfBounds="OutOfBounds";h.IllegalResult="IllegalResult";h.FieldNotFound="FieldNotFound";h.PortalRequired="PortalRequired";h.LogicError="LogicError";h.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";h.KeyAccessorMustBeString="KeyAccessorMustBeString";h.WrongSpatialReference="WrongSpatialReference"})(a.ExecutionErrorCodes||(a.ExecutionErrorCodes={}));const p={[a.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",
[a.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[a.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",[a.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[a.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",[a.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[a.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[a.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",
[a.ExecutionErrorCodes.FunctionNotFound]:"Function not found",[a.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",[a.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",[a.ExecutionErrorCodes.Cancelled]:"Execution cancelled",[a.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[a.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[a.ExecutionErrorCodes.PortalRequired]:"Portal is required",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",
[a.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",[a.ExecutionErrorCodes.Unrecognised]:"Unrecognised code structure",[a.ExecutionErrorCodes.UnrecognisedType]:"Unrecognised type",[a.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[a.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[a.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",
[a.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",[a.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[a.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[a.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[a.ExecutionErrorCodes.Immutable]:"Object is immutable",[a.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",[a.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",
[a.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",[a.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",[a.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognised",[a.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[a.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[a.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",[a.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",
[a.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",[a.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[a.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26"};let u=function(h){function z(...n){return h.call(this,...n)||this}b._inherits(z,h);return b._createClass(z)}(b._wrapNativeSuper(Error)),q=function(h){function z(n,l){n=h.call(this,c(l)+n.message,{cause:n})||this;n.loc=null;Error.captureStackTrace&&
Error.captureStackTrace(b._assertThisInitialized(n),z);l&&l.loc&&(n.loc=l.loc);return n}b._inherits(z,h);return b._createClass(z)}(u),k=function(h){function z(n,l,m,t){n=h.call(this,"Execution error - "+c(m)+y(p[l],t))||this;n.loc=null;n.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(n),z);m&&m.loc&&(n.loc=m.loc);return n}b._inherits(z,h);return b._createClass(z)}(b._wrapNativeSuper(Error)),d=function(h){function z(n,
l,m,t){n=h.call(this,"Compilation error - "+c(m)+y(p[l],t))||this;n.loc=null;n.declaredRootClass="esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(n),z);m&&m.loc&&(n.loc=m.loc);return n}b._inherits(z,h);return b._createClass(z)}(b._wrapNativeSuper(Error)),f=function(h){function z(){var n=h.call(this,"Uncompilable code structures")||this;n.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(n),
z);return n}b._inherits(z,h);return b._createClass(z)}(b._wrapNativeSuper(Error));a.ModuleErrorCodes=void 0;(function(h){h.UnrecognisedUri="UnrecognisedUri";h.UnsupportedUriProtocol="UnsupportedUriProtocol"})(a.ModuleErrorCodes||(a.ModuleErrorCodes={}));const g={[a.ModuleErrorCodes.UnrecognisedUri]:"Unrecognised uri - {uri}",[a.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognised uri protocol"};let e=function(h){function z(n,l){n=h.call(this,y(g[n],l))||this;n.declaredRootClass="esri.arcade.arcademoduleerror";
Error.captureStackTrace&&Error.captureStackTrace(b._assertThisInitialized(n),z);return n}b._inherits(z,h);return b._createClass(z)}(b._wrapNativeSuper(Error));a.ArcadeCompilationError=d;a.ArcadeExecutionError=k;a.ArcadeUncompilableError=f;a.ErrorWithCause=u;a.ExecutionErrorMessages=p;a.LocatableArcadeExecutionError=q;a.ModuleError=e;a.ModuleErrorMessages=g;a.doSubstitutions=y;a.ensureArcadeExecutionError=function(h,z,n){return"esri.arcade.arcadeexecutionerror"===n.declaredRootClass||"esri.arcade.arcadecompilationerror"===
n.declaredRootClass?null===n.loc&&z&&z.loc?new q(n,{cause:n}):n:z&&z.loc?new q(n,{cause:n}):n};a.parsingValidationMessage=function(h,z,n){return"Parsing error - "+c(h)+y(p[z],n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/_commonjsHelpers"],function(a,b,c){var y={exports:{}};y.exports;(function(u){(function(q,k){u.exports&&(u.exports=k())})(c.commonjsGlobal,function(){function q(d,
f,g,e){d=Error.call(this,d);Object.setPrototypeOf&&Object.setPrototypeOf(d,q.prototype);d.expected=f;d.found=g;d.location=e;d.name="SyntaxError";return d}function k(d,f,g){g=g||" ";if(d.length>f)return d;f-=d.length;g+=g.repeat(f);return d+g.slice(0,f)}(function(d,f){function g(){this.constructor=d}g.prototype=f.prototype;d.prototype=new g})(q,Error);q.prototype.format=function(d){var f="Error: "+this.message;if(this.location){var g=null,e;for(e=0;e<d.length;e++)if(d[e].source===this.location.source){g=
d[e].text.split(/\r\n|\n|\r/g);break}d=this.location.start;e=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(d):d;var h=this.location.source+":"+e.line+":"+e.column;if(g){var z=this.location.end,n=k("",e.line.toString().length," ");g=g[d.line-1];z=(d.line===z.line?z.column:g.length+1)-d.column||1;f+="\n --\x3e "+h+"\n"+n+" |\n"+e.line+" | "+g+"\n"+n+" | "+k("",d.column-1," ")+k("",z,"^")}else f+="\n at "+h}return f};q.buildMessage=function(d,f){function g(l){return l.charCodeAt(0).toString(16).toUpperCase()}
function e(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+g(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+g(m)})}function h(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+
g(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+g(m)})}function z(l){return n[l.type](l)}var n={literal:function(l){return'"'+e(l.text)+'"'},class:function(l){var m=l.parts.map(function(t){return Array.isArray(t)?h(t[0])+"-"+h(t[1]):h(t)});return"["+(l.inverted?"^":"")+m.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};return"Expected "+function(l){l=l.map(z);var m,t;l.sort();if(0<l.length){for(t=m=1;m<
l.length;m++)l[m-1]!==l[m]&&(l[t]=l[m],t++);l.length=t}switch(l.length){case 1:return l[0];case 2:return l[0]+" or "+l[1];default:return l.slice(0,-1).join(", ")+", or "+l[l.length-1]}}(d)+" but "+(f?'"'+e(f)+'"':"end of input")+" found."};return{SyntaxError:q,parse:function(d,f){function g(Aa,Da){return{type:"literal",text:Aa,ignoreCase:Da}}function e(Aa,Da,Ka){return{type:"class",parts:Aa,inverted:Da,ignoreCase:Ka}}function h(Aa){var Da=Yd[Aa],Ka;if(!Da){for(Ka=Aa-1;!Yd[Ka];)Ka--;Da=Yd[Ka];for(Da=
{line:Da.line,column:Da.column};Ka<Aa;)10===d.charCodeAt(Ka)?(Da.line++,Da.column=1):Da.column++,Ka++;Yd[Aa]=Da}return Da}function z(Aa,Da,Ka){var $a=h(Aa),mb=h(Da);Aa={source:eb,start:{offset:Aa,line:$a.line,column:$a.column},end:{offset:Da,line:mb.line,column:mb.column}};Ka&&eb&&"function"===typeof eb.offset&&(Aa.start=eb.offset(Aa.start),Aa.end=eb.offset(Aa.end));return Aa}function n(Aa){ta<mc||(ta>mc&&(mc=ta,ze=[]),ze.push(Aa))}function l(){var Aa=ta;La();var Da=t();Da!==la?(La(),Aa=Da):(ta=Aa,
Aa=la);return Aa}function m(){var Aa=ta;var Da=t();if(Da!==la){Aa=[];var Ka=ta;var $a=La();var mb=Ma();if(mb!==la){var Db=La();var Eb=t();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;for(;Ka!==la;)Aa.push(Ka),Ka=ta,$a=La(),mb=Ma(),mb!==la?(Db=La(),Eb=t(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);Ka={type:"expression-list"};Da=[Da];for($a=0;$a<Aa.length;$a++)Da.push(Aa[$a][3]);Ka.value=Da;Aa=Ka}else ta=Aa,Aa=la;return Aa}function t(){var Aa=ta;var Da=w();if(Da!==la){Aa=
[];var Ka=ta;var $a=La();var mb=ma();if(mb!==la){var Db=La();var Eb=w();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;for(;Ka!==la;)Aa.push(Ka),Ka=ta,$a=La(),mb=ma(),mb!==la?(Db=La(),Eb=w(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);Aa=cb(Da,Aa)}else ta=Aa,Aa=la;return Aa}function w(){var Aa=ta;var Da=r();if(Da!==la){Aa=[];var Ka=ta;var $a=La();var mb=oa();if(mb!==la){var Db=La();var Eb=r();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;for(;Ka!==la;)Aa.push(Ka),
Ka=ta,$a=La(),mb=oa(),mb!==la?(Db=La(),Eb=r(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);Aa=cb(Da,Aa)}else ta=Aa,Aa=la;return Aa}function r(){var Aa=ta;var Da=ia();if(Da===la){Da=ta;if(33===d.charCodeAt(ta)){var Ka=za;ta++}else Ka=la,0===Wa&&n(bd);if(Ka!==la){var $a=ta;Wa++;if(61===d.charCodeAt(ta)){var mb=Ga;ta++}else mb=la,0===Wa&&n(cd);Wa--;mb===la?$a=void 0:(ta=$a,$a=la);$a!==la?Da=Ka=[Ka,$a]:(ta=Da,Da=la)}else ta=Da,Da=la}Da!==la?(Ka=La(),$a=r(),$a!==la?Aa={type:"unary-expression",
operator:"NOT",expr:$a}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la);if(Aa===la){Da=ta;Aa=v();if(Aa!==la){La();Da=[];Ka=ta;$a=La();mb=x();if(mb!==la){var Db=La();var Eb=v();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;if(Ka!==la)for(;Ka!==la;)Da.push(Ka),Ka=ta,$a=La(),mb=x(),mb!==la?(Db=La(),Eb=v(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);else Da=la;Da!==la&&(Da={type:"arithmetic",tail:Da});Da===la&&(Da=ta,Ka=A(),Ka!==la?(La(),$a=Qa(),$a!==la?(La(),$a=m(),$a!==la?(La(),mb=Sa(),mb!==
la?Da={op:Ka,right:$a}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la),Da===la&&(Da=ta,Ka=A(),Ka!==la?(La(),$a=Qa(),$a!==la?(La(),$a=Sa(),$a!==la?Da={op:Ka,right:{type:"expression-list",value:[]}}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la),Da===la&&(Da=ta,Ka=A(),Ka!==la?(La(),$a=O(),$a!==la?Da={op:Ka,right:$a}:(ta=Da,Da=la)):(ta=Da,Da=la))),Da===la&&(Da=ta,mb=ia(),mb!==la?(La(),Ka=fa(),Ka!==la?(La(),$a=v(),$a!==la?(La(),Db=oa(),Db!==la?(La(),mb=v(),mb!==la?Da={op:"NOT"+Ka,right:{type:"expression-list",
value:[$a,mb]}}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la),Da===la&&(Da=ta,mb=fa(),mb!==la?(La(),Ka=v(),Ka!==la?(La(),$a=oa(),$a!==la?(La(),Db=v(),Db!==la?Da={op:mb,right:{type:"expression-list",value:[Ka,Db]}}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)),Da===la&&(Da=ta,Ka=ja(),Ka!==la?(La(),$a=ia(),$a!==la?(La(),$a=v(),$a!==la?Da={op:Ka+"NOT",right:$a}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la),Da===la&&(Da=ta,Ka=ja(),Ka!==la?(La(),$a=v(),$a!==la?Da=
{op:Ka,right:$a}:(ta=Da,Da=la)):(ta=Da,Da=la)),Da===la&&(Da=ta,Ka=D(),Ka!==la?(La(),$a=W(),$a!==la?(La(),mb=ta,d.substr(ta,6).toLowerCase()===ab?(Db=d.substr(ta,6),ta+=6):(Db=la,0===Wa&&n(Pd)),Db!==la?(Db=ta,Wa++,Eb=G(),Wa--,Eb===la?Db=void 0:(ta=Db,Db=la),Db!==la?mb="ESCAPE":(ta=mb,mb=la)):(ta=mb,mb=la),mb!==la?(La(),mb=T(),mb!==la?Da={op:Ka,right:$a,escape:mb.value}:(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la)):(ta=Da,Da=la),Da===la&&(Da=ta,Ka=D(),Ka!==la?(La(),$a=W(),$a!==la?Da={op:Ka,right:$a,
escape:""}:(ta=Da,Da=la)):(ta=Da,Da=la))))));Da===la&&(Da=null);""==Da||void 0==Da||null==Da?Da=Aa:(Ka=null,Da=Ka="arithmetic"==Da.type?cb(Aa,Da.tail):Va(Da.op,Aa,Da.right,Da.escape))}else ta=Da,Da=la;Aa=Da}return Aa}function x(){if(d.substr(ta,2)===Fa){var Aa=Fa;ta+=2}else Aa=la,0===Wa&&n(dd);Aa===la&&(62===d.charCodeAt(ta)?(Aa=xa,ta++):(Aa=la,0===Wa&&n(Dd)),Aa===la&&(d.substr(ta,2)===ya?(Aa=ya,ta+=2):(Aa=la,0===Wa&&n(Ed)),Aa===la&&(d.substr(ta,2)===Ea?(Aa=Ea,ta+=2):(Aa=la,0===Wa&&n(Fd)),Aa===la&&
(60===d.charCodeAt(ta)?(Aa=Oa,ta++):(Aa=la,0===Wa&&n(Gd)),Aa===la&&(61===d.charCodeAt(ta)?(Aa=Ga,ta++):(Aa=la,0===Wa&&n(cd)),Aa===la&&(d.substr(ta,2)===bb?(Aa=bb,ta+=2):(Aa=la,0===Wa&&n(ve))))))));return Aa}function D(){var Aa=Aa=ta;var Da=ia();if(Da!==la){var Ka=La();var $a=ha();$a!==la?Aa=Da=[Da,Ka,$a]:(ta=Aa,Aa=la)}else ta=Aa,Aa=la;Aa!==la&&(Aa=Aa[0]+" "+Aa[2]);Aa===la&&(Aa=ha());return Aa}function A(){var Aa=Aa=ta;var Da=ia();if(Da!==la){var Ka=La();var $a=ea();$a!==la?Aa=Da=[Da,Ka,$a]:(ta=Aa,
Aa=la)}else ta=Aa,Aa=la;Aa!==la&&(Aa=Aa[0]+" "+Aa[2]);Aa===la&&(Aa=ea());return Aa}function v(){var Aa=ta;var Da=C();if(Da!==la){Aa=[];var Ka=ta;var $a=La();var mb=B();if(mb!==la){var Db=La();var Eb=C();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;for(;Ka!==la;)Aa.push(Ka),Ka=ta,$a=La(),mb=B(),mb!==la?(Db=La(),Eb=C(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);Aa=cb(Da,Aa)}else ta=Aa,Aa=la;return Aa}function B(){if(43===d.charCodeAt(ta)){var Aa=db;ta++}else Aa=la,0===Wa&&
n(ed);Aa===la&&(45===d.charCodeAt(ta)?(Aa=nb,ta++):(Aa=la,0===Wa&&n(fd)),Aa===la&&(d.substr(ta,2)===kb?(Aa=kb,ta+=2):(Aa=la,0===Wa&&n(Ac))));return Aa}function C(){var Aa=ta;var Da=F();if(Da!==la){Aa=[];var Ka=ta;var $a=La();var mb=E();if(mb!==la){var Db=La();var Eb=F();Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;for(;Ka!==la;)Aa.push(Ka),Ka=ta,$a=La(),mb=E(),mb!==la?(Db=La(),Eb=F(),Eb!==la?Ka=$a=[$a,mb,Db,Eb]:(ta=Ka,Ka=la)):(ta=Ka,Ka=la);Aa=cb(Da,Aa)}else ta=Aa,Aa=la;return Aa}function E(){if(42===
d.charCodeAt(ta)){var Aa=wb;ta++}else Aa=la,0===Wa&&n(Bc);Aa===la&&(47===d.charCodeAt(ta)?(Aa=vb,ta++):(Aa=la,0===Wa&&n(wc)));return Aa}function F(){var Aa=T();if(Aa===la){var Da=ta;var Ka=ta;var $a=U();if($a!==la){var mb=V();if(mb!==la){var Db=X();Db!==la?Ka=parseFloat($a+mb+Db):(ta=Ka,Ka=la)}else ta=Ka,Ka=la}else ta=Ka,Ka=la;Ka===la&&(Ka=ta,$a=U(),$a!==la?(mb=V(),mb!==la?Ka=parseFloat($a+mb):(ta=Ka,Ka=la)):(ta=Ka,Ka=la),Ka===la&&(Ka=ta,$a=U(),$a!==la?(mb=X(),mb!==la?Ka=parseFloat($a+mb):(ta=Ka,
Ka=la)):(ta=Ka,Ka=la),Ka===la&&(Ka=ta,$a=U(),$a!==la&&($a=parseFloat($a)),Ka=$a)));var Eb=Ka;if(Eb!==la){var Zd=ta;Wa++;var pf=K();Wa--;pf===la?Zd=void 0:(ta=Zd,Zd=la);Zd!==la?Da={type:"number",value:Eb}:(ta=Da,Da=la)}else ta=Da,Da=la;Aa=Da;if(Aa===la){var pd=ta;var Kc=ta;if(d.substr(ta,4).toLowerCase()===Ja){var $d=d.substr(ta,4);ta+=4}else $d=la,0===Wa&&n(Kd);if($d!==la){var qd=ta;Wa++;var qf=G();Wa--;qf===la?qd=void 0:(ta=qd,qd=la);qd!==la?Kc=$d=[$d,qd]:(ta=Kc,Kc=la)}else ta=Kc,Kc=la;var Cc=Kc;
Cc!==la&&(Cc={type:"boolean",value:!0});pd=Cc;if(pd===la){pd=ta;var Lc=ta;if(d.substr(ta,5).toLowerCase()===Na){var ae=d.substr(ta,5);ta+=5}else ae=la,0===Wa&&n(Ld);if(ae!==la){var rd=ta;Wa++;var rf=G();Wa--;rf===la?rd=void 0:(ta=rd,rd=la);rd!==la?Lc=ae=[ae,rd]:(ta=Lc,Lc=la)}else ta=Lc,Lc=la;Cc=Lc;Cc!==la&&(Cc={type:"boolean",value:!1});pd=Cc}Aa=pd;if(Aa===la){var Mc=ta;if(d.substr(ta,4).toLowerCase()===hb){var be=d.substr(ta,4);ta+=4}else be=la,0===Wa&&n(Jd);if(be!==la){var sd=ta;Wa++;var sf=G();
Wa--;sf===la?sd=void 0:(ta=sd,sd=la);sd!==la?Mc=be=[be,sd]:(ta=Mc,Mc=la)}else ta=Mc,Mc=la;var Ae=Mc;Ae!==la&&(Ae={type:"null",value:null});Aa=Ae;if(Aa===la){var Nc=ta;if(ca()!==la){La();var Ne=W();Ne!==la?Nc={type:"date",value:Ne.value}:(ta=Nc,Nc=la)}else ta=Nc,Nc=la;Aa=Nc;if(Aa===la){var Oc=ta;if(da()!==la){La();var Oe=W();Oe!==la?Oc={type:"timestamp",value:Oe.value}:(ta=Oc,Oc=la)}else ta=Oc,Oc=la;Aa=Oc;if(Aa===la){var Wb=ta;var Be=na();if(Be!==la){La();if(45===d.charCodeAt(ta)){var rc=nb;ta++}else rc=
la,0===Wa&&n(fd);rc===la&&(43===d.charCodeAt(ta)?(rc=db,ta++):(rc=la,0===Wa&&n(ed)));if(rc!==la){La();var td=W();if(td!==la){La();var Pe=H();Pe!==la?Wb={type:"interval",value:td,qualifier:Pe,op:rc}:(ta=Wb,Wb=la)}else ta=Wb,Wb=la}else ta=Wb,Wb=la}else ta=Wb,Wb=la;Wb===la&&(Wb=ta,Be=na(),Be!==la?(La(),rc=W(),rc!==la?(La(),td=H(),td!==la?Wb={type:"interval",value:rc,qualifier:td,op:""}:(ta=Wb,Wb=la)):(ta=Wb,Wb=la)):(ta=Wb,Wb=la));Aa=Wb}}}}}}var Mb=Aa;if(Mb===la){var dc=ta;var Pc=ta;if(d.substr(ta,7).toLowerCase()===
Za){var Qe=d.substr(ta,7);ta+=7}else Qe=la,0===Wa&&n(Ud);if(Qe!==la){var ce=ta;Wa++;var tf=G();Wa--;tf===la?ce=void 0:(ta=ce,ce=la);ce!==la?Pc="EXTRACT":(ta=Pc,Pc=la)}else ta=Pc,Pc=la;if(Pc!==la){La();var uf=Qa();if(uf!==la){La();var jc=qa();jc===la&&(jc=ua(),jc===la&&(jc=sa(),jc===la&&(jc=pa(),jc===la&&(jc=ka(),jc===la&&(jc=ra())))));var Re=jc;if(Re!==la){La();var vf=ba();if(vf!==la){La();var Se=t();if(Se!==la){La();var wf=Sa();wf!==la?dc={type:"function",name:"extract",args:{type:"expression-list",
value:[{type:"string",value:Re},Se]}}:(ta=dc,dc=la)}else ta=dc,dc=la}else ta=dc,dc=la}else ta=dc,dc=la}else ta=dc,dc=la}else ta=dc,dc=la;Mb=dc;if(Mb===la){var ec=ta;var Qc=ta;if(d.substr(ta,9).toLowerCase()===Ta){var Te=d.substr(ta,9);ta+=9}else Te=la,0===Wa&&n(Td);if(Te!==la){var de=ta;Wa++;var xf=G();Wa--;xf===la?de=void 0:(ta=de,de=la);de!==la?Qc="SUBSTRING":(ta=Qc,Qc=la)}else ta=Qc,Qc=la;if(Qc!==la){La();var yf=Qa();if(yf!==la){La();var Ce=t();if(Ce!==la){La();var zf=ba();if(zf!==la){La();var De=
t();if(De!==la){La();var sc=ta;var Rc=ta;if(d.substr(ta,3).toLowerCase()===Ra){var Ue=d.substr(ta,3);ta+=3}else Ue=la,0===Wa&&n(Sd);if(Ue!==la){var ee=ta;Wa++;var Af=G();Wa--;Af===la?ee=void 0:(ta=ee,ee=la);ee!==la?Rc="FOR":(ta=Rc,Rc=la)}else ta=Rc,Rc=la;var ud=Rc;if(ud!==la){var Bf=La();var Ve=t();if(Ve!==la){var Cf=La();sc=ud=[ud,Bf,Ve,Cf]}else ta=sc,sc=la}else ta=sc,sc=la;sc===la&&(sc=null);ud=Sa();ud!==la?ec={type:"function",name:"substring",args:{type:"expression-list",value:sc?[Ce,De,sc[2]]:
[Ce,De]}}:(ta=ec,ec=la)}else ta=ec,ec=la}else ta=ec,ec=la}else ta=ec,ec=la}else ta=ec,ec=la}else ta=ec,ec=la;Mb=ec;if(Mb===la){var Qb=ta;var Ee=aa();if(Ee!==la){La();var Fe=Qa();if(Fe!==la){La();var tc=I();tc===la&&(tc=null);La();var vd=t();if(vd!==la){La();var Ge=ba();if(Ge!==la){La();var We=t();if(We!==la){La();var Df=Sa();Df!==la?Qb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==tc?"BOTH":tc},vd,We]}}:(ta=Qb,Qb=la)}else ta=Qb,Qb=la}else ta=Qb,Qb=la}else ta=
Qb,Qb=la}else ta=Qb,Qb=la}else ta=Qb,Qb=la;Qb===la&&(Qb=ta,Ee=aa(),Ee!==la?(La(),Fe=Qa(),Fe!==la?(La(),tc=I(),tc===la&&(tc=null),La(),vd=t(),vd!==la?(La(),Ge=Sa(),Ge!==la?Qb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==tc?"BOTH":tc},vd]}}:(ta=Qb,Qb=la)):(ta=Qb,Qb=la)):(ta=Qb,Qb=la)):(ta=Qb,Qb=la));Mb=Qb;if(Mb===la){var fc=ta;var Sc=ta;if(d.substr(ta,8).toLowerCase()===lb){var Xe=d.substr(ta,8);ta+=8}else Xe=la,0===Wa&&n(Vd);if(Xe!==la){var fe=ta;Wa++;
var Ef=G();Wa--;Ef===la?fe=void 0:(ta=fe,fe=la);fe!==la?Sc="POSITION":(ta=Sc,Sc=la)}else ta=Sc,Sc=la;if(Sc!==la){La();var Ff=Qa();if(Ff!==la){La();var Ye=t();if(Ye!==la){La();var Gf=ea();if(Gf!==la){La();var Ze=t();if(Ze!==la){La();var Hf=Sa();Hf!==la?fc={type:"function",name:"position",args:{type:"expression-list",value:[Ye,Ze]}}:(ta=fc,fc=la)}else ta=fc,fc=la}else ta=fc,fc=la}else ta=fc,fc=la}else ta=fc,fc=la}else ta=fc,fc=la;Mb=fc;if(Mb===la){var gc=ta;var Tc=ta;if(d.substr(ta,4).toLowerCase()===
Kb){var $e=d.substr(ta,4);ta+=4}else $e=la,0===Wa&&n(ye);if($e!==la){var ge=ta;Wa++;var If=G();Wa--;If===la?ge=void 0:(ta=ge,ge=la);ge!==la?Tc="CAST":(ta=Tc,Tc=la)}else ta=Tc,Tc=la;if(Tc!==la){La();var Jf=Qa();if(Jf!==la){La();var af=t();if(af!==la){La();var Uc=ta;if(d.substr(ta,2).toLowerCase()===Ob){var bf=d.substr(ta,2);ta+=2}else bf=la,0===Wa&&n(Qd);if(bf!==la){var he=ta;Wa++;var Kf=G();Wa--;Kf===la?he=void 0:(ta=he,he=la);he!==la?Uc="AS":(ta=Uc,Uc=la)}else ta=Uc,Uc=la;var Lf=Uc;if(Lf!==la){La();
var Nb=ta;var Vc=ta;if(d.substr(ta,7).toLowerCase()===qb){var cf=d.substr(ta,7);ta+=7}else cf=la,0===Wa&&n(Mf);if(cf!==la){var ie=ta;Wa++;var Nf=G();Wa--;Nf===la?ie=void 0:(ta=ie,ie=la);ie!==la?Vc="INTEGER":(ta=Vc,Vc=la)}else ta=Vc,Vc=la;var Rb=Vc;Rb!==la&&(Rb={type:"data-type",value:{type:"integer"}});Nb=Rb;if(Nb===la){Nb=ta;var Wc=ta;if(d.substr(ta,8).toLowerCase()===xb){var df=d.substr(ta,8);ta+=8}else df=la,0===Wa&&n(Of);if(df!==la){var je=ta;Wa++;var Pf=G();Wa--;Pf===la?je=void 0:(ta=je,je=la);
je!==la?Wc="SMALLINT":(ta=Wc,Wc=la)}else ta=Wc,Wc=la;Rb=Wc;Rb!==la&&(Rb={type:"data-type",value:{type:"smallint"}});Nb=Rb;if(Nb===la){Nb=ta;var Xc=ta;if(d.substr(ta,5).toLowerCase()===zb){var ef=d.substr(ta,5);ta+=5}else ef=la,0===Wa&&n(Qf);if(ef!==la){var ke=ta;Wa++;var Rf=G();Wa--;Rf===la?ke=void 0:(ta=ke,ke=la);ke!==la?Xc="FLOAT":(ta=Xc,Xc=la)}else ta=Xc,Xc=la;Rb=Xc;Rb!==la&&(Rb={type:"data-type",value:{type:"float"}});Nb=Rb;if(Nb===la){Nb=ta;var Yc=ta;if(d.substr(ta,4).toLowerCase()===Hb){var ff=
d.substr(ta,4);ta+=4}else ff=la,0===Wa&&n(Sf);if(ff!==la){var le=ta;Wa++;var Tf=G();Wa--;Tf===la?le=void 0:(ta=le,le=la);le!==la?Yc="REAL":(ta=Yc,Yc=la)}else ta=Yc,Yc=la;Rb=Yc;Rb!==la&&(Rb={type:"data-type",value:{type:"real"}});Nb=Rb;if(Nb===la&&(Nb=ta,Rb=ca(),Rb!==la&&(Rb={type:"data-type",value:{type:"date"}}),Nb=Rb,Nb===la&&(Nb=ta,Rb=da(),Rb!==la&&(Rb={type:"data-type",value:{type:"timestamp"}}),Nb=Rb,Nb===la))){Nb=ta;var Zc=ta;if(d.substr(ta,7).toLowerCase()===Jb){var gf=d.substr(ta,7);ta+=7}else gf=
la,0===Wa&&n(Uf);if(gf!==la){var me=ta;Wa++;var Vf=G();Wa--;Vf===la?me=void 0:(ta=me,me=la);me!==la?Zc="VARCHAR":(ta=Zc,Zc=la)}else ta=Zc,Zc=la;Rb=Zc;if(Rb!==la){La();var Wf=Qa();if(Wf!==la){La();var hf=Y();if(hf!==la){La();var Xf=Sa();Xf!==la?Nb={type:"data-type",value:{type:"varchar",size:parseInt(hf)}}:(ta=Nb,Nb=la)}else ta=Nb,Nb=la}else ta=Nb,Nb=la}else ta=Nb,Nb=la}}}}var jf=Nb;if(jf!==la){La();var Yf=Sa();Yf!==la?gc={type:"function",name:"cast",args:{type:"expression-list",value:[af,jf]}}:(ta=
gc,gc=la)}else ta=gc,gc=la}else ta=gc,gc=la}else ta=gc,gc=la}else ta=gc,gc=la}else ta=gc,gc=la;Mb=gc;if(Mb===la){var zc=ta;var ne;var kc=ta;kc=ne=M();if(kc===la)if(kc=ta,96===d.charCodeAt(ta)?(ne=Dc,ta++):(ne=la,0===Wa&&n(kf)),ne!==la){var oe=[];if(Gc.test(d.charAt(ta))){var uc=d.charAt(ta);ta++}else uc=la,0===Wa&&n(lf);if(uc!==la)for(;uc!==la;)oe.push(uc),Gc.test(d.charAt(ta))?(uc=d.charAt(ta),ta++):(uc=la,0===Wa&&n(lf));else oe=la;oe!==la?(96===d.charCodeAt(ta)?(uc=Dc,ta++):(uc=la,0===Wa&&n(kf)),
uc!==la?kc=oe.join(""):(ta=kc,kc=la)):(ta=kc,kc=la)}else ta=kc,kc=la;var mf=kc;if(mf!==la){La();var Zf=Qa();if(Zf!==la){La();var pe=m();pe===la&&(pe=null);La();var $f=Sa();$f!==la?zc={type:"function",name:mf,args:pe?pe:{type:"expression-list",value:[]}}:(ta=zc,zc=la)}else ta=zc,zc=la}else ta=zc,zc=la;Mb=zc;if(Mb===la){var nc;var Xb=ta;var He=va();if(He!==la){La();var wd=t();if(wd!==la){La();var xd=[];for(nc=Q();nc!==la;)xd.push(nc),nc=Q();nc=La();var qe=Ca();qe!==la?Xb={type:"case-expression",format:"simple",
operand:wd,clauses:xd,else:null}:(ta=Xb,Xb=la)}else ta=Xb,Xb=la}else ta=Xb,Xb=la;if(Xb===la)if(Xb=ta,He=va(),He!==la)if(La(),wd=t(),wd!==la){La();xd=[];for(nc=Q();nc!==la;)xd.push(nc),nc=Q();nc=La();qe=S();if(qe!==la){La();var ag=Ca();ag!==la?Xb={type:"case-expression",format:"simple",operand:wd,clauses:xd,else:qe.value}:(ta=Xb,Xb=la)}else ta=Xb,Xb=la}else ta=Xb,Xb=la;else ta=Xb,Xb=la;var Ie=Xb;if(Ie===la){var oc;var bc=ta;var Je=va();if(Je!==la){La();var yd=[];for(oc=P();oc!==la;)yd.push(oc),oc=
P();oc=La();var re=Ca();re!==la?bc={type:"case-expression",format:"searched",clauses:yd,else:null}:(ta=bc,bc=la)}else ta=bc,bc=la;if(bc===la)if(bc=ta,Je=va(),Je!==la){La();yd=[];for(oc=P();oc!==la;)yd.push(oc),oc=P();oc=La();re=S();if(re!==la){La();var bg=Ca();bg!==la?bc={type:"case-expression",format:"searched",clauses:yd,else:re.value}:(ta=bc,bc=la)}else ta=bc,bc=la}else ta=bc,bc=la;Ie=bc}Mb=Ie;if(Mb===la){var se;var te=ta;var nf=K();if(nf!==la){var of=[];for(se=L();se!==la;)of.push(se),se=L();
te=nf+of.join("")}else ta=te,te=la;var ue=te;if(ue!==la){var Ke=ue;ue=/^CURRENT_DATE$/i.test(Ke)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ke)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Ke}}Mb=ue;if(Mb===la&&(Mb=O(),Mb===la)){Mb=ta;var cg=Qa();if(cg!==la){La();var Le=t();if(Le!==la){La();var dg=Sa();dg!==la?(Le.paren=!0,Mb=Le):(ta=Mb,Mb=la)}else ta=Mb,Mb=la}else ta=Mb,Mb=la}}}}}}}}}return Mb}function M(){var Aa;var Da=ta;var Ka=K();if(Ka!==
la){Da=[];for(Aa=G();Aa!==la;)Da.push(Aa),Aa=G();Da=Ka+Da.join("")}else ta=Da,Da=la;return Da}function K(){if(Ec.test(d.charAt(ta))){var Aa=d.charAt(ta);ta++}else Aa=la,0===Wa&&n(Hc);return Aa}function G(){if($c.test(d.charAt(ta))){var Aa=d.charAt(ta);ta++}else Aa=la,0===Wa&&n(Hd);return Aa}function L(){if(zd.test(d.charAt(ta))){var Aa=d.charAt(ta);ta++}else Aa=la,0===Wa&&n(xc);return Aa}function O(){var Aa=ta;if(64===d.charCodeAt(ta)){var Da=sb;ta++}else Da=la,0===Wa&&n(yc);if(Da!==la){var Ka=M();
Ka!==la?Aa=Da=[Da,Ka]:(ta=Aa,Aa=la)}else ta=Aa,Aa=la;Aa!==la&&(Aa={type:"parameter",value:Aa[1]});return Aa}function I(){var Aa=ta;if(d.substr(ta,7).toLowerCase()===yb){var Da=d.substr(ta,7);ta+=7}else Da=la,0===Wa&&n(od);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="LEADING":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;Aa===la&&(Aa=ta,d.substr(ta,8).toLowerCase()===Bb?(Da=d.substr(ta,8),ta+=8):(Da=la,0===Wa&&n(ld)),Da!==la?(Da=ta,Wa++,Ka=G(),Wa--,Ka===la?Da=void 0:(ta=Da,Da=
la),Da!==la?Aa="TRAILING":(ta=Aa,Aa=la)):(ta=Aa,Aa=la),Aa===la&&(Aa=ta,d.substr(ta,4).toLowerCase()===Gb?(Da=d.substr(ta,4),ta+=4):(Da=la,0===Wa&&n(xe)),Da!==la?(Da=ta,Wa++,Ka=G(),Wa--,Ka===la?Da=void 0:(ta=Da,Da=la),Da!==la?Aa="BOTH":(ta=Aa,Aa=la)):(ta=Aa,Aa=la)));return Aa}function H(){var Aa=ta;var Da=ta;var Ka=J();if(Ka!==la){La();var $a=Qa();if($a!==la)if(La(),$a=R(),$a!==la){La();var mb=Sa();mb!==la?Da={type:"interval-period",period:Ka.value,precision:$a,secondary:null}:(ta=Da,Da=la)}else ta=
Da,Da=la;else ta=Da,Da=la}else ta=Da,Da=la;Da===la&&(Da=ta,Ka=J(),Ka!==la&&(Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Da=Ka);if(Da!==la)if(La(),Ka=ta,d.substr(ta,2).toLowerCase()===Yb?($a=d.substr(ta,2),ta+=2):($a=la,0===Wa&&n(eg)),$a!==la?($a=ta,Wa++,mb=G(),Wa--,mb===la?$a=void 0:(ta=$a,$a=la),$a!==la?Ka="TO":(ta=Ka,Ka=la)):(ta=Ka,Ka=la),Ka!==la){La();Ka=ta;$a=J();$a!==la&&($a={type:"interval-period",period:$a.value,precision:null,secondary:null});Ka=$a;if(Ka===la){Ka=
ta;$a=ra();if($a!==la)if(La(),$a=Qa(),$a!==la)if(La(),$a=R(),$a!==la)if(La(),mb=Ma(),mb!==la)if(La(),mb=N(),mb!==la){La();var Db=Sa();Db!==la?Ka={type:"interval-period",period:"second",precision:$a,secondary:mb}:(ta=Ka,Ka=la)}else ta=Ka,Ka=la;else ta=Ka,Ka=la;else ta=Ka,Ka=la;else ta=Ka,Ka=la;else ta=Ka,Ka=la;Ka===la&&(Ka=ta,$a=ra(),$a!==la?(La(),$a=Qa(),$a!==la?(La(),$a=R(),$a!==la?(La(),mb=Sa(),mb!==la?Ka={type:"interval-period",period:"second",precision:$a,secondary:null}:(ta=Ka,Ka=la)):(ta=Ka,
Ka=la)):(ta=Ka,Ka=la)):(ta=Ka,Ka=la),Ka===la&&(Ka=ta,$a=ra(),$a!==la&&($a={type:"interval-period",period:"second",precision:null,secondary:null}),Ka=$a))}Ka!==la?Aa={type:"interval-qualifier",start:Da,end:Ka}:(ta=Aa,Aa=la)}else ta=Aa,Aa=la;else ta=Aa,Aa=la;Aa===la&&(Aa=ta,Ka=J(),Ka!==la?(La(),Da=Qa(),Da!==la?(La(),Da=N(),Da!==la?(La(),$a=Sa(),$a!==la?Aa={type:"interval-period",period:Ka.value,precision:Da,secondary:null}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la),Aa===la&&(Aa=ta,Ka=
J(),Ka!==la&&(Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null}),Aa=Ka,Aa===la&&(Aa=ta,Ka=ra(),Ka!==la?(La(),Da=Qa(),Da!==la?(La(),Da=R(),Da!==la?(La(),$a=Ma(),$a!==la?(La(),Ka=N(),Ka!==la?(La(),$a=Sa(),$a!==la?Aa={type:"interval-period",period:"second",precision:Da,secondary:Ka}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la),Aa===la&&(Aa=ta,Ka=ra(),Ka!==la?(La(),Da=Qa(),Da!==la?(La(),Da=N(),Da!==la?(La(),$a=Sa(),$a!==la?Aa={type:"interval-period",
period:"second",precision:Da,secondary:null}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la)):(ta=Aa,Aa=la),Aa===la&&(Aa=ta,Ka=ra(),Ka!==la&&(Ka={type:"interval-period",period:"second",precision:null,secondary:null}),Aa=Ka)))));return Aa}function J(){var Aa=ta;Aa=sa();Aa!==la&&(Aa={type:"string",value:"day"});Aa===la&&(Aa=ta,Aa=pa(),Aa!==la&&(Aa={type:"string",value:"hour"}),Aa===la&&(Aa=ta,Aa=ka(),Aa!==la&&(Aa={type:"string",value:"minute"}),Aa===la&&(Aa=ta,Aa=ua(),Aa!==la&&(Aa={type:"string",value:"month"}),
Aa===la&&(Aa=ta,Aa=qa(),Aa!==la&&(Aa={type:"string",value:"year"})))));return Aa}function N(){var Aa=Y();Aa!==la&&(Aa=parseFloat(Aa));return Aa}function R(){var Aa=Y();Aa!==la&&(Aa=parseFloat(Aa));return Aa}function W(){var Aa=T();Aa===la&&(Aa=O());return Aa}function T(){var Aa=ta;if(39===d.charCodeAt(ta)){var Da=Ab;ta++}else Da=la,0===Wa&&n(pc);Da===la&&(d.substr(ta,2)===Ib?(Da=Ib,ta+=2):(Da=la,0===Wa&&n(gd)));if(Da!==la){Da=[];var Ka=ta;d.substr(ta,2)===rb?(Ka=rb,ta+=2):(Ka=la,0===Wa&&n(Ic));Ka!==
la&&(Ka="'");Ka===la&&(Fc.test(d.charAt(ta))?(Ka=d.charAt(ta),ta++):(Ka=la,0===Wa&&n(Jc)));for(;Ka!==la;)Da.push(Ka),Ka=ta,d.substr(ta,2)===rb?(Ka=rb,ta+=2):(Ka=la,0===Wa&&n(Ic)),Ka!==la&&(Ka="'"),Ka===la&&(Fc.test(d.charAt(ta))?(Ka=d.charAt(ta),ta++):(Ka=la,0===Wa&&n(Jc)));39===d.charCodeAt(ta)?(Ka=Ab,ta++):(Ka=la,0===Wa&&n(pc));Ka!==la?Aa={type:"string",value:Da.join("")}:(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function P(){var Aa=ta;if(Ba()!==la){La();var Da=t();if(Da!==la){La();var Ka=Ha();Ka!==
la?(La(),Ka=t(),Ka!==la?Aa={type:"when-clause",operand:Da,value:Ka}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la)}else ta=Aa,Aa=la}else ta=Aa,Aa=la;return Aa}function Q(){var Aa=ta;if(Ba()!==la){La();var Da=t();if(Da!==la){La();var Ka=Ha();Ka!==la?(La(),Ka=t(),Ka!==la?Aa={type:"when-clause",operand:Da,value:Ka}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la)}else ta=Aa,Aa=la}else ta=Aa,Aa=la;return Aa}function S(){var Aa=ta;var Da=ta;if(d.substr(ta,4).toLowerCase()===lc){var Ka=d.substr(ta,4);ta+=4}else Ka=la,0===Wa&&n(fg);if(Ka!==
la){Ka=ta;Wa++;var $a=G();Wa--;$a===la?Ka=void 0:(ta=Ka,Ka=la);Ka!==la?Da="ELSE":(ta=Da,Da=la)}else ta=Da,Da=la;Da!==la?(La(),Da=t(),Da!==la?Aa={type:"else-clause",value:Da}:(ta=Aa,Aa=la)):(ta=Aa,Aa=la);return Aa}function U(){var Aa=Y();if(Aa===la){Aa=ta;if(45===d.charCodeAt(ta)){var Da=nb;ta++}else Da=la,0===Wa&&n(fd);Da===la&&(43===d.charCodeAt(ta)?(Da=db,ta++):(Da=la,0===Wa&&n(ed)));if(Da!==la){var Ka=Y();Ka!==la?Aa=Da[0]+Ka:(ta=Aa,Aa=la)}else ta=Aa,Aa=la}return Aa}function V(){var Aa=ta;if(46===
d.charCodeAt(ta)){var Da=Fb;ta++}else Da=la,0===Wa&&n(hd);Da!==la?(Aa=Y(),Aa===la&&(Aa=null),Aa="."+(null!=Aa?Aa:"")):(ta=Aa,Aa=la);return Aa}function X(){var Aa;var Da=Aa=ta;if(Bd.test(d.charAt(ta))){var Ka=d.charAt(ta);ta++}else Ka=la,0===Wa&&n(Id);Ka!==la?(Cd.test(d.charAt(ta))?(Da=d.charAt(ta),ta++):(Da=la,0===Wa&&n(we)),Da===la&&(Da=null),Da="e"+(null===Da?"":Da)):(ta=Da,Da=la);Da!==la?(Ka=Y(),Ka!==la?Aa=Da+Ka:(ta=Aa,Aa=la)):(ta=Aa,Aa=la);return Aa}function Y(){var Aa=[];var Da=Z();if(Da!==la)for(;Da!==
la;)Aa.push(Da),Da=Z();else Aa=la;Aa!==la&&(Aa=Aa.join(""));return Aa}function Z(){if(Ad.test(d.charAt(ta))){var Aa=d.charAt(ta);ta++}else Aa=la,0===Wa&&n(qc);return Aa}function ea(){var Aa=ta;if(d.substr(ta,2).toLowerCase()===Xa){var Da=d.substr(ta,2);ta+=2}else Da=la,0===Wa&&n(Md);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="IN":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ja(){var Aa=ta;if(d.substr(ta,2).toLowerCase()===fb){var Da=d.substr(ta,2);ta+=2}else Da=
la,0===Wa&&n(Nd);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="IS":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ha(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===jb){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(Od);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="LIKE":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ia(){var Aa=ta;if(d.substr(ta,3).toLowerCase()===pb){var Da=d.substr(ta,3);ta+=3}else Da=la,0===Wa&&n(id);
if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="NOT":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function oa(){var Aa=ta;if(d.substr(ta,3).toLowerCase()===tb){var Da=d.substr(ta,3);ta+=3}else Da=la,0===Wa&&n(jd);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="AND":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ma(){var Aa=ta;if(d.substr(ta,2).toLowerCase()===Ya){var Da=d.substr(ta,2);ta+=2}else Da=la,0===Wa&&n(kd);if(Da!==la){Da=
ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="OR":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function fa(){var Aa=ta;if(d.substr(ta,7).toLowerCase()===wa){var Da=d.substr(ta,7);ta+=7}else Da=la,0===Wa&&n(md);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="BETWEEN":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ba(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===Ia){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(Rd);if(Da!==la){Da=ta;Wa++;var Ka=
G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="FROM":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function aa(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===gb){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(nd);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="TRIM":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function da(){var Aa=ta;if(d.substr(ta,9).toLowerCase()===ob){var Da=d.substr(ta,9);ta+=9}else Da=la,0===Wa&&n(Wd);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===
la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="TIMESTAMP":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ca(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===ub){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(Xd);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="DATE":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function na(){var Aa=ta;if(d.substr(ta,8).toLowerCase()===Cb){var Da=d.substr(ta,8);ta+=8}else Da=la,0===Wa&&n(gg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=
void 0:(ta=Da,Da=la);Da!==la?Aa="INTERVAL":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function qa(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===Sb){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(hg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="YEAR":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ua(){var Aa=ta;if(d.substr(ta,5).toLowerCase()===Tb){var Da=d.substr(ta,5);ta+=5}else Da=la,0===Wa&&n(ig);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:
(ta=Da,Da=la);Da!==la?Aa="MONTH":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function sa(){var Aa=ta;if(d.substr(ta,3).toLowerCase()===hc){var Da=d.substr(ta,3);ta+=3}else Da=la,0===Wa&&n(jg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="DAY":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function pa(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===cc){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(kg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);
Da!==la?Aa="HOUR":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ka(){var Aa=ta;if(d.substr(ta,6).toLowerCase()===Vb){var Da=d.substr(ta,6);ta+=6}else Da=la,0===Wa&&n(lg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="MINUTE":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function ra(){var Aa=ta;if(d.substr(ta,6).toLowerCase()===ic){var Da=d.substr(ta,6);ta+=6}else Da=la,0===Wa&&n(mg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa=
"SECOND":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function va(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===Zb){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(ng);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="CASE":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function Ca(){var Aa=ta;if(d.substr(ta,3).toLowerCase()===$b){var Da=d.substr(ta,3);ta+=3}else Da=la,0===Wa&&n(og);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="END":(ta=
Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function Ba(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===ac){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(pg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="WHEN":(ta=Aa,Aa=la)}else ta=Aa,Aa=la;return Aa}function Ha(){var Aa=ta;if(d.substr(ta,4).toLowerCase()===Lb){var Da=d.substr(ta,4);ta+=4}else Da=la,0===Wa&&n(qg);if(Da!==la){Da=ta;Wa++;var Ka=G();Wa--;Ka===la?Da=void 0:(ta=Da,Da=la);Da!==la?Aa="THEN":(ta=Aa,Aa=la)}else ta=
Aa,Aa=la;return Aa}function Ma(){if(44===d.charCodeAt(ta)){var Aa=Pb;ta++}else Aa=la,0===Wa&&n(rg);return Aa}function Qa(){if(40===d.charCodeAt(ta)){var Aa=Ub;ta++}else Aa=la,0===Wa&&n(sg);return Aa}function Sa(){if(41===d.charCodeAt(ta)){var Aa=vc;ta++}else Aa=la,0===Wa&&n(tg);return Aa}function La(){var Aa;var Da=[];for(Aa=Ua();Aa!==la;)Da.push(Aa),Aa=Ua();return Da}function Ua(){if(ad.test(d.charAt(ta))){var Aa=d.charAt(ta);ta++}else Aa=la,0===Wa&&n(ug);return Aa}function Va(Aa,Da,Ka,$a){Aa={type:"binary-expression",
operator:Aa,left:Da,right:Ka};void 0!==$a&&(Aa.escape=$a);return Aa}function cb(Aa,Da){for(var Ka=0;Ka<Da.length;Ka++)Aa=Va(Da[Ka][1],Aa,Da[Ka][3]);return Aa}f=void 0!==f?f:{};var la={},eb=f.grammarSource,ib={start:l},Pa=l,za="!",Ga="\x3d",Fa="\x3e\x3d",xa="\x3e",ya="\x3c\x3d",Ea="\x3c\x3e",Oa="\x3c",bb="!\x3d",db="+",nb="-",kb="||",wb="*",vb="/",sb="@",Ab="'",Ib="N'",rb="''",Fb=".",hb="null",Ja="true",Na="false",Xa="in",fb="is",jb="like",ab="escape",pb="not",tb="and",Ya="or",wa="between",Ia="from",
Ra="for",Ta="substring",Za="extract",gb="trim",lb="position",ob="timestamp",ub="date",yb="leading",Bb="trailing",Gb="both",Kb="cast",Ob="as",qb="integer",xb="smallint",zb="float",Hb="real",Jb="varchar",Yb="to",Cb="interval",Sb="year",Tb="month",hc="day",cc="hour",Vb="minute",ic="second",Zb="case",$b="end",ac="when",Lb="then",lc="else",Pb=",",Ub="(",vc=")",Dc="`",Ec=/^[A-Za-z_\x80-\uFFFF]/,$c=/^[A-Za-z0-9_]/,zd=/^[A-Za-z0-9_.\x80-\uFFFF]/,Fc=/^[^']/,Ad=/^[0-9]/,Bd=/^[eE]/,Cd=/^[+\-]/,ad=/^[ \t\n\r]/,
Gc=/^[^`]/,bd=g("!",!1),cd=g("\x3d",!1),dd=g("\x3e\x3d",!1),Dd=g("\x3e",!1),Ed=g("\x3c\x3d",!1),Fd=g("\x3c\x3e",!1),Gd=g("\x3c",!1),ve=g("!\x3d",!1),ed=g("+",!1),fd=g("-",!1),Ac=g("||",!1),Bc=g("*",!1),wc=g("/",!1),Hc=e([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Hd=e([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),xc=e([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),yc=g("@",!1),pc=g("'",!1),gd=g("N'",!1),Ic=g("''",!1),Jc=e(["'"],!0,!1),hd=g(".",!1),qc=e([["0","9"]],!1,!1),
Id=e(["e","E"],!1,!1),we=e(["+","-"],!1,!1),Jd=g("NULL",!0),Kd=g("TRUE",!0),Ld=g("FALSE",!0),Md=g("IN",!0),Nd=g("IS",!0),Od=g("LIKE",!0),Pd=g("ESCAPE",!0),id=g("NOT",!0),jd=g("AND",!0),kd=g("OR",!0),md=g("BETWEEN",!0),Rd=g("FROM",!0),Sd=g("FOR",!0),Td=g("SUBSTRING",!0),Ud=g("EXTRACT",!0),nd=g("TRIM",!0),Vd=g("POSITION",!0),Wd=g("TIMESTAMP",!0),Xd=g("DATE",!0),od=g("LEADING",!0),ld=g("TRAILING",!0),xe=g("BOTH",!0),ye=g("CAST",!0),Qd=g("AS",!0),Mf=g("INTEGER",!0),Of=g("SMALLINT",!0),Qf=g("FLOAT",!0),
Sf=g("REAL",!0),Uf=g("VARCHAR",!0),eg=g("TO",!0),gg=g("INTERVAL",!0),hg=g("YEAR",!0),ig=g("MONTH",!0),jg=g("DAY",!0),kg=g("HOUR",!0),lg=g("MINUTE",!0),mg=g("SECOND",!0),ng=g("CASE",!0),og=g("END",!0),pg=g("WHEN",!0),qg=g("THEN",!0),fg=g("ELSE",!0),rg=g(",",!1),sg=g("(",!1),tg=g(")",!1),ug=e([" ","\t","\n","\r"],!1,!1),kf=g("`",!1),lf=e(["`"],!0,!1),ta=0,Yd=[{line:1,column:1}],mc=0,ze=[],Wa=0;if("startRule"in f){if(!(f.startRule in ib))throw Error("Can't start parsing from rule \""+f.startRule+'".');
Pa=ib[f.startRule]}var Me=Pa();if(Me!==la&&ta===d.length)return Me;Me!==la&&ta<d.length&&n({type:"end"});throw function(Aa,Da,Ka){return new q(q.buildMessage(Aa,Da),Aa,Da,Ka)}(ze,mc<d.length?d.charAt(mc):null,mc<d.length?z(mc,mc+1):z(mc,mc));}}})})(y);var p=y.exports;y=function(){function u(){}u.parse=function(q){return p.parse(q)};return b._createClass(u)}();a.WhereGrammar=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,b,c,y,p,u,q){function k(n,l){if(!l)return null;if("x"in l){var m={x:0,y:0};[m.x,m.y]=n(l.x,l.y,g);null!=l.z&&(m.z=l.z);null!=l.m&&(m.m=l.m);return m}return"xmin"in l?(m={xmin:0,ymin:0,xmax:0,ymax:0},[m.xmin,m.ymin]=n(l.xmin,l.ymin,g),[m.xmax,m.ymax]=n(l.xmax,l.ymax,g),l.hasZ&&(m.zmin=l.zmin,m.zmax=l.zmax,m.hasZ=!0),l.hasM&&(m.mmin=l.mmin,m.mmax=l.mmax,m.hasM=!0),m):"rings"in l?{rings:d(l.rings,n),hasM:l.hasM,hasZ:l.hasZ}:"paths"in l?{paths:d(l.paths,n),hasM:l.hasM,hasZ:l.hasZ}:"points"in
l?{points:f(l.points,n),hasM:l.hasM,hasZ:l.hasZ}:null}function d(n,l){const m=[];for(const t of n)m.push(f(t,l));return m}function f(n,l){const m=[];for(const t of n)n=l(t[0],t[1],[0,0]),m.push(n),2<t.length&&n.push(t[2]),3<t.length&&n.push(t[3]);return m}const g=[0,0],e=k.bind(null,q.lngLatToXY),h=k.bind(null,q.xyToLngLat),z=new (function(){function n(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var l=n.prototype;l.push=async function(m,t,w){if(!(m&&m.length&&t&&w)||u.equals(t,
w))return m;const r={geometries:m,inSpatialReference:t,outSpatialReference:w,resolve:null};this._jobs.push(r);return new Promise(x=>{r.resolve=x;null===this._timer&&(this._timer=setTimeout(this._process,10))})};l._process=function(){this._timer=null;const m=this._jobs.shift();if(m){var {geometries:t,inSpatialReference:w,outSpatialReference:r,resolve:x}=m;q.canProject(w,r)?u.isWebMercator(r)?x(t.map(e)):x(t.map(h)):x(y.projectMany(p.jsonAdapter,t,w,r,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}};return b._createClass(n)}());a.checkProjectionSupport=async function(n,l){n&&l&&(n=Array.isArray(n)?n.map(m=>null!=m.geometry?m.geometry.spatialReference:null).filter(c.isSome):[n],await y.initializeProjection(n.map(m=>({source:m,dest:l}))))};a.project=function(n,l,m,t){if(!n)return n;m||(m=l,l=n.spatialReference);return u.isValid(l)&&u.isValid(m)&&!u.equals(l,m)?q.canProject(l,m)?(n=u.isWebMercator(m)?e(n):h(n),n.spatialReference=m,n):y.projectMany(p.jsonAdapter,[n],l,m,null,t)[0]:n};a.projectMany=
function(n,l,m){return z.push(n,l,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=b._createClass(function(k,d,f){this.x=k;this.y=d;this.spatialReference=f;this.m=this.z=void 0}),y=b._createClass(function(k,d,f,g){this.rings=k;this.spatialReference=d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);g&&(this.hasM=g)}),p=b._createClass(function(k,d,f,g){this.paths=
k;this.spatialReference=d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);g&&(this.hasM=g)}),u=b._createClass(function(k,d,f,g){this.points=k;this.spatialReference=d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);g&&(this.hasM=g)}),q=b._createClass(function(k,d,f,g,e){this.xmin=k;this.ymin=d;this.xmax=f;this.ymax=g;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0});a.jsonAdapter={convertToGEGeometry:function(k,d){return null==d?null:k.convertJSONToGeometry(d)},exportPoint:function(k,
d,f){f=new c(k.getPointX(d),k.getPointY(d),f);const g=k.hasZ(d),e=k.hasM(d);g&&(f.z=k.getPointZ(d));e&&(f.m=k.getPointM(d));return f},exportPolygon:function(k,d,f){return new y(k.exportPaths(d),f,k.hasZ(d),k.hasM(d))},exportPolyline:function(k,d,f){return new p(k.exportPaths(d),f,k.hasZ(d),k.hasM(d))},exportMultipoint:function(k,d,f){return new u(k.exportPoints(d),f,k.hasZ(d),k.hasM(d))},exportExtent:function(k,d,f){var g=k.hasZ(d);const e=k.hasM(d);f=new q(k.getXMin(d),k.getYMin(d),k.getXMax(d),
k.getYMax(d),f);g&&(g=k.getZExtent(d),f.zmin=g.vmin,f.zmax=g.vmax);e&&(k=k.getMExtent(d),f.mmin=k.vmin,f.mmax=k.vmax);return f}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./projectionSupport ./SnappingCandidate ./utils ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h){function z(t,w,r,x){const D=x.x-r.x;x=x.y-r.y;w=Math.min(1,Math.max(0,((w.x-r.x)*D+(w.y-r.y)*x)/(D*D+x*x)));t.x=r.x+D*w;t.y=r.y+x*w}function n(t,w){return t?w?4:3:w?3:2}let l=function(){function t(r,x,D){this.items=r;this.query=x;this.geometryType=D.geometryType;this.hasM=D.hasM;this.hasZ=D.hasZ;this.fieldsIndex=D.fieldsIndex;this.objectIdField=D.objectIdField;this.spatialReference=D.spatialReference;this.featureAdapter=D.featureAdapter}var w=t.prototype;w.createQueryResponseForCount=
function(){const r=new k(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return r.countDistinctValues(this.items);const {groupByFieldsForStatistics:x,having:D,outStatistics:A}=this.query;if(!x?.length)return 1;const v=new Map,B=new Map,C=new Set;for(const M of A){var {statisticType:E}=M;E="exceedslimit"!==E?M.onStatisticField:void 0;if(!B.has(E)){var F=[];for(const K of x){const G=this._getAttributeValues(r,K,v);F.push(G)}B.set(E,this._calculateUniqueValues(F,r.returnDistinctValues))}E=
B.get(E);for(const K in E){const {data:G,items:L}=E[K];F=G.join(",");D&&!r.validateItems(L,D)||C.add(F)}}return C.size};w.createQueryResponse=async function(){let r;r=this.query.outStatistics?this.query.outStatistics.some(x=>"exceedslimit"===x.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const x=this.query.geometry;q.isValid(this.query.outSR)&&!q.equals(x.spatialReference,
this.query.outSR)?r.queryGeometry=g.cleanFromGeometryEngine({spatialReference:this.query.outSR,...d.project(x,x.spatialReference,this.query.outSR)}):r.queryGeometry=g.cleanFromGeometryEngine({spatialReference:this.query.outSR,...x})}return r};w.createSnappingResponse=function(r,x){const D=this.featureAdapter,A=n(this.hasZ,this.hasM),{point:v,mode:B}=r,C="number"===typeof r.distance?r.distance:r.distance.x,E="number"===typeof r.distance?r.distance:r.distance.y,F={candidates:[]},M="esriGeometryPolygon"===
this.geometryType;x=this._getPointCreator(B,this.spatialReference,x);const K=new m(null,0),G=new m(null,0),L={x:0,y:0,z:0};for(const W of this.items){var O=D.getGeometry(W);if(null==O)continue;const {coords:T,lengths:P}=O;K.coords=T;G.coords=T;if(r.returnEdge){O=0;for(var I=0;I<P.length;I++){var H=P[I];for(var J=0;J<H;J++,O+=A){var N=K;N.coordsIndex=O;if(J!==H-1){const Q=G;Q.coordsIndex=O+A;const S=L;z(L,v,N,Q);var R=(v.x-S.x)/C;const U=(v.y-S.y)/E;R=R*R+U*U;1>=R&&F.candidates.push(f.makeEdgeCandidate(D.getObjectId(W),
x(S),Math.sqrt(R),x(N),x(Q)))}}}}if(r.returnVertex)for(O=M?T.length-A:T.length,I=0;I<O;I+=A)H=K,H.coordsIndex=I,J=(v.x-H.x)/C,N=(v.y-H.y)/E,J=J*J+N*N,1>=J&&F.candidates.push(f.makeVertexCandidate(D.getObjectId(W),x(H),Math.sqrt(J)))}F.candidates.sort((W,T)=>W.distance-T.distance);return F};w._getPointCreator=function(r,x,D){const A=null==D||q.equals(x,D)?B=>B:B=>d.project(B,x,D),{hasZ:v}=this;return"3d"===r?v?({x:B,y:C,z:E})=>A({x:B,y:C,z:E}):({x:B,y:C})=>A({x:B,y:C,z:0}):({x:B,y:C})=>A({x:B,y:C})};
w.createSummaryStatisticsResponse=async function(r){const {field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,minValue:C,maxValue:E,scale:F}=r;r=this.fieldsIndex.isDateField(x);var M=await this._getDataValues({field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,scale:F});const K=h.isNullCountSupported({normalizationType:v,normalizationField:A,minValue:C,maxValue:E}),G=this.fieldsIndex.get(x),L={value:.5,fieldType:G?.type};M=
e.isStringField(G)?h.calculateStringStatistics({values:M,supportsNullCount:K,percentileParams:L}):h.calculateStatistics({values:M,minValue:C,maxValue:E,useSampleStdDev:!v,supportsNullCount:K,percentileParams:L});return h.processSummaryStatisticsResult(M,r)};w.createUniqueValuesResponse=async function(r){const {field:x,valueExpression:D,domains:A,returnAllCodedValues:v,scale:B}=r;var C=await this._getDataValues({field:x,field2:r.field2,field3:r.field3,fieldDelimiter:r.fieldDelimiter,valueExpression:D,
scale:B});C=h.calculateUniqueValuesCount(C);return h.createUVResult(C,A,v,r.fieldDelimiter)};w.createClassBreaksResponse=async function(r){const {field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,classificationMethod:C,standardDeviationInterval:E,minValue:F,maxValue:M,numClasses:K,scale:G}=r;r=await this._getDataValues({field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,scale:G});r=h.calculateClassBreaks(r,{field:x,normalizationField:A,
normalizationType:v,normalizationTotal:B,classificationMethod:C,standardDeviationInterval:E,minValue:F,maxValue:M,numClasses:K});return h.resolveCBResult(r,C)};w.createHistogramResponse=async function(r){const {field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,classificationMethod:C,standardDeviationInterval:E,minValue:F,maxValue:M,numBins:K,scale:G}=r;r=await this._getDataValues({field:x,valueExpression:D,normalizationField:A,normalizationType:v,normalizationTotal:B,
scale:G});return h.calculateHistogram(r,{field:x,normalizationField:A,normalizationType:v,normalizationTotal:B,classificationMethod:C,standardDeviationInterval:E,minValue:F,maxValue:M,numBins:K})};w._sortFeatures=function(r,x,D){if(1<r.length&&x&&x.length)for(const A of x.reverse()){x=A.split(" ");const v=x[0],B=this.fieldsIndex.get(v);x=x[1]?"desc"===x[1].toLowerCase():!1;const C=h.getAttributeComparator(B?.type,x);r.sort((E,F)=>{E=D(E,v,B);F=D(F,v,B);return C(E,F)})}};w._createFeatureQueryResponse=
function(r){const x=this.items,{geometryType:D,hasM:A,hasZ:v,objectIdField:B,spatialReference:C}=this,{outFields:E,outSR:F,quantizationParameters:M,resultRecordCount:K,resultOffset:G,returnZ:L,returnM:O}=r,I=null!=K?x.length>(G||0)+K:!1,H=E&&(E.includes("*")?[...this.fieldsIndex.fields]:E.map(J=>this.fieldsIndex.get(J)));return{exceededTransferLimit:I,features:this._createFeatures(r,x),fields:H,geometryType:D,hasM:A&&O,hasZ:v&&L,objectIdFieldName:B,spatialReference:g.cleanFromGeometryEngine(F||C),
transform:M&&u.toQuantizationTransform(M)||null}};w._createFeatures=function(r,x){const D=new k(r,this.featureAdapter,this.fieldsIndex),{hasM:A,hasZ:v}=this,{orderByFields:B,quantizationParameters:C,returnGeometry:E,returnCentroid:F,maxAllowableOffset:M,resultOffset:K,resultRecordCount:G,returnZ:L=!1,returnM:O=!1}=r,I=v&&L,H=A&&O;r=[];var J=0;x=[...x];this._sortFeatures(x,B,(W,T,P)=>D.getFieldValue(W,T,P));if(E||F){var N=u.toQuantizationTransform(C)??void 0;if(E&&!F)for(var R of x)r[J++]={attributes:D.getAttributes(R),
geometry:g.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),M,N,I,H)};else if(!E&&F)for(const W of x)r[J++]={attributes:D.getAttributes(W),centroid:g.transformCentroid(this,this.featureAdapter.getCentroid(W,this),N)};else for(const W of x)r[J++]={attributes:D.getAttributes(W),centroid:g.transformCentroid(this,this.featureAdapter.getCentroid(W,this),N),geometry:g.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(W),M,N,I,H)}}else for(N of x)(R=
D.getAttributes(N))&&(r[J++]={attributes:R});J=K||0;null!=G&&(r=r.slice(J,Math.min(r.length,J+G)));return r};w._createExceedsLimitQueryResponse=function(r){var x=!1;let D=Number.POSITIVE_INFINITY,A=Number.POSITIVE_INFINITY;x=Number.POSITIVE_INFINITY;for(const v of r.outStatistics??[])if("exceedslimit"===v.statisticType){D=null!=v.maxPointCount?v.maxPointCount:Number.POSITIVE_INFINITY;A=null!=v.maxRecordCount?v.maxRecordCount:Number.POSITIVE_INFINITY;x=null!=v.maxVertexCount?v.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)x=this.items.length>D;else if(this.items.length>A)x=!0;else{r=n(this.hasZ,this.hasM);const v=this.featureAdapter;x=this.items.reduce((B,C)=>{C=v.getGeometry(C);return B+(null!=C&&C.coords.length||0)},0)/r>x}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(x)}}]}};w._createStatisticsQueryResponse=async function(r){var x=
{attributes:{}};const D=[],A=new Map,v=new Map,B=new Map,C=new Map,E=new k(r,this.featureAdapter,this.fieldsIndex);var F=r.outStatistics;const {groupByFieldsForStatistics:M,having:K,orderByFields:G}=r;r=M&&M.length;const L=!!r,O=L?M[0]:null,I=L&&!this.fieldsIndex.get(O);for(const W of F??[]){const {outStatisticFieldName:T,statisticType:P}=W;F=W;var H="exceedslimit"!==P?W.onStatisticField:void 0;const Q="percentile_disc"===P||"percentile_cont"===P,S="EnvelopeAggregate"===P||"CentroidAggregate"===P||
"ConvexHullAggregate"===P,U=L&&1===r&&(H===O||I)&&"count"===P;if(L){if(!B.has(H)){var J=[];for(const V of M){var N=this._getAttributeValues(E,V,A);J.push(N)}B.set(H,this._calculateUniqueValues(J,S?!1:E.returnDistinctValues))}J=B.get(H);for(const V in J){const {count:X,data:Y,items:Z,itemPositions:ea}=J[V];N=Y.join(",");if(!K||E.validateItems(Z,K)){const ja=C.get(N)||{attributes:{}};if(S){ja.aggregateGeometries||(ja.aggregateGeometries={});const {aggregateGeometries:ia,outStatisticFieldName:oa}=await this._getAggregateGeometry(F,
Z);ja.aggregateGeometries[oa]=ia}else{var R=null;if(U)R=X;else{const ia=this._getAttributeValues(E,H,A);R=ea.map(oa=>ia[oa]);R=Q&&"statisticParameters"in F?this._getPercentileValue(F,R):this._getStatisticValue(F,R,null,E.returnDistinctValues)}ja.attributes[T]=R}let ha=0;M.forEach((ia,oa)=>ja.attributes[this.fieldsIndex.get(ia)?ia:`EXPR_${++ha}`]=Y[oa]);C.set(N,ja)}}}else if(S){x.aggregateGeometries||(x.aggregateGeometries={});const {aggregateGeometries:V,outStatisticFieldName:X}=await this._getAggregateGeometry(F,
this.items);x.aggregateGeometries[X]=V}else H=this._getAttributeValues(E,H,A),x.attributes[T]=Q&&"statisticParameters"in F?this._getPercentileValue(F,H):this._getStatisticValue(F,H,v,E.returnDistinctValues);D.push({name:T,alias:T,type:"esriFieldTypeDouble"})}x=L?Array.from(C.values()):[x];this._sortFeatures(x,G,(W,T)=>W.attributes[T]);return{fields:D,features:x}};w._getAggregateGeometry=async function(r,x){const {convexHull:D,union:A}=await new Promise((L,O)=>a(["../../../geometry/geometryEngineJSON"],
L,O)),{statisticType:v,outStatisticFieldName:B}=r,{featureAdapter:C,spatialReference:E,geometryType:F,hasZ:M,hasM:K}=this;x=x.map(L=>g.getGeometry(F,M,K,C.getGeometry(L)));const G=D(E,x,!0)[0];r={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===v?(x=G?p.getPolygonExtent(G):p.getGeometryExtent(A(E,x)),r.aggregateGeometries={...x,spatialReference:E},r.outStatisticFieldName=B||"extent"):"CentroidAggregate"===v?(x=G?y.polygonCentroid(G):y.extentCentroid(p.getGeometryExtent(A(E,
x))),r.aggregateGeometries={x:x[0],y:x[1],spatialReference:E},r.outStatisticFieldName=B||"centroid"):"ConvexHullAggregate"===v&&(r.aggregateGeometries=G,r.outStatisticFieldName=B||"convexHull");return r};w._getStatisticValue=function(r,x,D,A){const {onStatisticField:v,statisticType:B}=r;r=null;r=D?.has(v)?D.get(v):e.isStringField(this.fieldsIndex.get(v))?h.calculateStringStatistics({values:x,returnDistinct:A}):h.calculateStatistics({values:A?[...(new Set(x))]:x,minValue:null,maxValue:null,useSampleStdDev:!0});
D&&D.set(v,r);return r["var"===B?"variance":B]};w._getPercentileValue=function(r,x){const {onStatisticField:D,statisticParameters:A,statisticType:v}=r,{value:B,orderBy:C}=A;r=this.fieldsIndex.get(D);return h.calculatePercentile(x,{value:B,orderBy:C,fieldType:r?.type,isDiscrete:"percentile_disc"===v})};w._getAttributeValues=function(r,x,D){if(D.has(x))return D.get(x);const A=this.fieldsIndex.get(x),v=this.items.map(B=>r.getFieldValue(B,x,A));D.set(x,v);return v};w._calculateUniqueValues=function(r,
x){const D={},A=this.items,v=A.length;for(let B=0;B<v;B++){const C=A[B],E=[];for(const M of r)E.push(M[B]);const F=E.join(",");null==D[F]?D[F]={count:1,data:E,items:[C],itemPositions:[B]}:(x||D[F].count++,D[F].items.push(C),D[F].itemPositions.push(B))}return D};w._getDataValues=async function(r){const x=new k(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:D,scale:A}=r,v=D?{viewingMode:"map",scale:A,spatialReference:this.query.outSR||this.spatialReference}:null;return D?x.getExpressionValues(this.items,
D,v,{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM}):x.getDataValues(this.items,{field:r.field,field2:r.field2,field3:r.field3,fieldDelimiter:r.fieldDelimiter,normalizationField:r.normalizationField,normalizationType:r.normalizationType,normalizationTotal:r.normalizationTotal})};c._createClass(t,[{key:"size",get:function(){return this.items.length}}]);return t}(),m=function(){function t(w,r){this.coords=w;this.coordsIndex=r}c._createClass(t,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},
{key:"y",get:function(){return this.coords[this.coordsIndex+1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]);return t}();b.QueryEngineResult=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./attributeSupport","./utils","../../../statistics/utils","../../../support/arcadeOnDemand"],function(a,b,c,y,p){return function(){function u(k,d,f){this._fieldDataCache=
new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=k.returnDistinctValues??!1;this.fieldsIndex=f;this.featureAdapter=d;if((d=k.outFields)&&!d.includes("*")){this.outFields=d;k=0;for(const e of d){var g=b.getExpressionFromFieldName(e);g=(d=this.fieldsIndex.get(g))?null:b.getWhereClause(g,f);d=d?d.name:b.getAliasFromFieldName(e)||`FIELD_EXP_${k++}`;this._fieldDataCache.set(e,{alias:d,clause:g})}}}var q=u.prototype;q.countDistinctValues=function(k){if(!this.returnDistinctValues)return k.length;
k.forEach(d=>this.getAttributes(d));return this._returnDistinctMap.size};q.getAttributes=function(k){k=this._processAttributesForOutFields(k);return this._processAttributesForDistinctValues(k)};q.getFieldValue=function(k,d,f){const g=f?f.name:d;let e=null;this._fieldDataCache.has(g)?e=this._fieldDataCache.get(g)?.clause:f||(e=b.getWhereClause(d,this.fieldsIndex),this._fieldDataCache.set(g,{alias:g,clause:e}));return f?this.featureAdapter.getAttribute(k,g):e?.calculateValue(k,this.featureAdapter)};
q.getDataValues=function(k,d){const f=d.normalizationType,g=d.normalizationTotal;return k.map(e=>{let h=d.field&&this.getFieldValue(e,d.field,this.fieldsIndex.get(d.field));d.field2&&(h=`${y.processNullValue(h)}${d.fieldDelimiter}${y.processNullValue(this.getFieldValue(e,d.field2,this.fieldsIndex.get(d.field2)))}`,d.field3&&(h=`${h}${d.fieldDelimiter}${y.processNullValue(this.getFieldValue(e,d.field3,this.fieldsIndex.get(d.field3)))}`));f&&Number.isFinite(h)&&(e="field"===f&&d.normalizationField?
this.getFieldValue(e,d.normalizationField,this.fieldsIndex.get(d.normalizationField)):null,h=y.getNormalizedValue(h,f,e,g));return h})};q.getExpressionValues=async function(k,d,f,g){const {arcadeUtils:e}=await p.loadArcade(),h=e.hasGeometryOperations(d);h&&await e.enableGeometryOperations();const z=e.createFunction(d),n=f&&e.getViewInfo(f),l={fields:this.fieldsIndex.fields};return k.map(m=>{m={attributes:this.featureAdapter.getAttributes(m),layer:l,geometry:h?{...c.getGeometry(g.geometryType,g.hasZ,
g.hasM,this.featureAdapter.getGeometry(m)),spatialReference:f?.spatialReference}:null};m=e.createExecContext(m,n);return e.executeFunction(z,m)})};q.validateItem=function(k,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:b.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testFeature(k,this.featureAdapter)??!1};q.validateItems=function(k,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:b.getWhereClause(d,this.fieldsIndex)});
return this._fieldDataCache.get(d)?.clause?.testSet(k,this.featureAdapter)??!1};q._processAttributesForOutFields=function(k){const d=this.outFields;if(!d||!d.length)return this.featureAdapter.getAttributes(k);const f={};for(const g of d){const {alias:e,clause:h}=this._fieldDataCache.get(g);f[e]=h?h.calculateValue(k,this.featureAdapter):this.featureAdapter.getAttribute(k,e)}return f};q._processAttributesForDistinctValues=function(k){if(null==k||!this.returnDistinctValues)return k;var d=this.outFields,
f=[];if(d)for(const e of d){var {alias:g}=this._fieldDataCache.get(e);f.push(k[g])}else for(g in k)f.push(k[g]);d=`${(d||["*"]).join(",")}=${f.join(",")}`;f=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++f);return 1<f?null:k};return a._createClass(u)}()})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){async function h(v,B,C){if(!v)return null;var {where:E}=v;v.where=E=E&&E.trim();if(!E||/^1 *= *1$/.test(E)||B&&B===E)v.where=null;if(!v.geometry)return v;B=await n(v);v.distance=0;v.units=null;"esriSpatialRelEnvelopeIntersects"===v.spatialRel&&({spatialReference:E}=v.geometry,B=u.getGeometryExtent(B),B.spatialReference=E);if(B){await e.checkProjectionSupport(B.spatialReference,C);E=B.spatialReference;B=z(B,C)&&q.isExtent(B)?{spatialReference:E,rings:[[[B.xmin,B.ymin],
[B.xmin,B.ymax],[B.xmax,B.ymax],[B.xmax,B.ymin],[B.xmin,B.ymin]]]}:B;E=(await k.normalizeCentralMeridian(q.fromJSON(B)))[0];if(null==E)throw t;const F="quantizationParameters"in v&&v.quantizationParameters?.tolerance||"maxAllowableOffset"in v&&v.maxAllowableOffset||0;B=F&&z(B,C)?{densificationStep:8*F}:void 0;E=E.toJSON();B=await e.project(E,E.spatialReference,C,B);if(!B)throw t;B.spatialReference=C;v.geometry=B}return v}function z(v,B){if(!v)return!1;const C=v.spatialReference;return(q.isExtent(v)||
q.isPolygon(v)||q.isPolyline(v))&&!d.equals(C,B)&&!p.canProjectWithoutEngine(C,B)}async function n(v){const {distance:B,units:C}=v,E=v.geometry;if(null==B||"vertexAttributes"in E)return E;var F=E.spatialReference;v=C?m.fromJSON(C):y.getUnitString(F);F=F&&(d.isGeographic(F)||d.isWebMercator(F))?E:await e.checkProjectionSupport(F,d.WGS84).then(()=>e.project(E,d.WGS84));return(await l())(F.spatialReference,F,B,v)}async function l(){return(await new Promise((v,B)=>a(["../../../geometry/geometryEngineJSON"],
v,B))).geodesicBuffer}const m=new c.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),t=Object.freeze({}),w=new g,r=new g,x=new g,D={esriGeometryPoint:f.convertToPoint,esriGeometryPolyline:f.convertToPolyline,esriGeometryPolygon:f.convertToPolygon,esriGeometryMultipoint:f.convertToMultipoint},A=(v,B)=>"_geVersion"!==v?B:void 0;b.QUERY_ENGINE_EMPTY_RESULT=
t;b.cleanFromGeometryEngine=function(v){return v&&"_geVersion"in v?JSON.parse(JSON.stringify(v,A)):v};b.getGeometry=function(v,B,C,E,F,M,K=B,G=C){const L=B&&K,O=C&&G;E=null!=E?"coords"in E?E:E.geometry:null;if(null==E)return null;if(F)return B=f.generalizeOptimizedGeometry(r,E,B,C,v,F,K,G),M&&(B=f.quantizeOptimizedGeometry(x,B,L,O,v,M)),D[v]?.(B,L,O)??null;if(M)return M=f.quantizeOptimizedGeometry(x,E,B,C,v,M,K,G),D[v]?.(M,L,O)??null;f.removeZMValues(w,E,B,C,K,G);return D[v]?.(w,L,O)??null};b.normalizeQuery=
async function(v,B,C){const {outFields:E,orderByFields:F,groupByFieldsForStatistics:M,outStatistics:K}=v;if(E)for(var G=0;G<E.length;G++)E[G]=E[G].trim();if(F)for(G=0;G<F.length;G++)F[G]=F[G].trim();if(M)for(G=0;G<M.length;G++)M[G]=M[G].trim();if(K)for(G=0;G<K.length;G++)K[G].onStatisticField&&(K[G].onStatisticField=K[G].onStatisticField.trim());v.geometry&&!v.outSR&&(v.outSR=v.geometry.spatialReference);return h(v,B,C)};b.normalizeQueryLike=h;b.transformCentroid=function(v,B,C,E=v.hasZ,F=v.hasM){if(null==
B)return null;const M=v.hasZ&&E,K=v.hasM&&F;return C?(v=f.quantizeOptimizedGeometry(x,B,v.hasZ,v.hasM,"esriGeometryPoint",C,E,F),f.convertToPoint(v,M,K)):f.convertToPoint(B,M,K)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,c){function y(A){return null==A||"string"===typeof A&&!A?"\x3cNull\x3e":A}function p(A){const v=null!=A.minValue||
null!=A.maxValue,B=!!A.sqlExpression&&A.supportsSQLExpression;return!(null!=A.normalizationField||null!=A.normalizationType)&&!v&&!B}function u(A){const {values:v,useSampleStdDev:B,supportsNullCount:C}=A;var E=Number.POSITIVE_INFINITY;let F=Number.NEGATIVE_INFINITY,M=null,K=null;var G=null;let L=null,O=0;const I=null==A.minValue?-Infinity:A.minValue,H=null==A.maxValue?Infinity:A.maxValue;for(const J of v)Number.isFinite(J)?J>=I&&J<=H&&(M=null===M?J:M+J,E=Math.min(E,J),F=Math.max(F,J),O++):"string"===
typeof J&&O++;if(O&&null!=M){K=M/O;G=0;for(const J of v)Number.isFinite(J)&&J>=I&&J<=H&&(G+=(J-K)**2);L=B?1<O?G/(O-1):0:0<O?G/O:0;G=Math.sqrt(L)}else F=E=null;E={avg:K,count:O,max:F,min:E,stddev:G,sum:M,variance:L};C&&(E.nullcount=v.length-O);A.percentileParams&&(E.median=q(v,A.percentileParams));return E}function q(A,v){const {fieldType:B,value:C,orderBy:E,isDiscrete:F}=v,M=k(B,"desc"===E);A=[...A].filter(O=>null!=O).sort((O,I)=>M(O,I));if(0===A.length)return null;if(0>=C)return A[0];if(1<=C)return A[A.length-
1];var K=(A.length-1)*C,G=Math.floor(K);v=G+1;K%=1;G=A[G];const L=A[v];return v>=A.length||F||"string"===typeof G||"string"===typeof L?G:G*(1-K)+L*K}function k(A,v){const B=v?1:-1,C=g(v),E=f(v);if(!A||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...x].includes(A))return(F,M)=>"number"===typeof F&&"number"===typeof M?C(F,M):"string"===typeof F&&"string"===typeof M?E(F,M):B;if("esriFieldTypeDate"===A)return(F,M)=>{F=(new Date(F)).getTime();M=(new Date(M)).getTime();
return isNaN(F)||isNaN(M)?B:C(F,M)};if(x.has(A))return(F,M)=>C(F,M);if("esriFieldTypeString"===A)return(F,M)=>E(F,M);if("esriFieldTypeGUID"===A||"esriFieldTypeGlobalID"===A){const F=f(v);return(M,K)=>F(e(M),e(K))}return v?(F,M)=>1:(F,M)=>-1}function d(A,v,B){if(B){if(null==A)return null==v?0:1;if(null==v)return-1}else{if(null==A)return null==v?0:-1;if(null==v)return 1}return null}function f(A){return A?(v,B)=>{const C=d(v,B,!0);if(null!=C)return C;v=v.toUpperCase();B=B.toUpperCase();return v>B?-1:
v<B?1:0}:(v,B)=>{const C=d(v,B,!1);if(null!=C)return C;v=v.toUpperCase();B=B.toUpperCase();return v<B?-1:v>B?1:0}}function g(A){return A?(v,B)=>{const C=d(v,B,!0);return null!=C?C:B-v}:(v,B)=>{const C=d(v,B,!1);return null!=C?C:v-B}}function e(A){return A.substr(24,12)+A.substr(19,4)+A.substr(16,2)+A.substr(14,2)+A.substr(11,2)+A.substr(9,2)+A.substr(6,2)+A.substr(4,2)+A.substr(2,2)+A.substr(0,2)}function h(A){return"coded-value"!==A?.type?[]:A.codedValues.map(v=>v.code)}function z(A,v){const B=l({field:v.field,
normalizationType:v.normalizationType,normalizationField:v.normalizationField,classificationMethod:v.classificationMethod,standardDeviationInterval:v.standardDeviationInterval,breakCount:v.numClasses||5});A=n(A,v.minValue,v.maxValue);return c.createGenerateRendererClassBreaks({definition:B,values:A,normalizationTotal:v.normalizationTotal})}function n(A,v,B){const C=null==v?-Infinity:v,E=null==B?Infinity:B;return A.filter(F=>Number.isFinite(F)&&F>=C&&F<=E)}function l(A){const {breakCount:v,field:B,
normalizationField:C,normalizationType:E}=A,F=A.classificationMethod||"equal-interval";return new b({breakCount:v,classificationField:B,classificationMethod:F,normalizationField:"field"===E?C:void 0,normalizationType:E,standardDeviationInterval:"standard-deviation"===F?A.standardDeviationInterval||1:void 0})}function m(A,v){const {field:B,classificationMethod:C,standardDeviationInterval:E,normalizationType:F,normalizationField:M,normalizationTotal:K,minValue:G,maxValue:L}=v,O=v.numBins||10;let I=
v=null,H=null;C&&"equal-interval"!==C||F?({classBreaks:A}=z(A,{field:B,normalizationType:F,normalizationField:M,normalizationTotal:K,classificationMethod:C,standardDeviationInterval:E,minValue:G,maxValue:L,numClasses:O}),v=A[0].minValue,I=A[A.length-1].maxValue,H=A.map(J=>[J.minValue,J.maxValue])):(null!=G&&null!=L?(v=G,I=L):(A=u({values:A,minValue:G,maxValue:L,useSampleStdDev:!F,supportsNullCount:p({normalizationType:F,normalizationField:M,minValue:G,maxValue:L})}),v=A.min??null,I=A.max??null),H=
w(v??0,I??0,O));return{min:v,max:I,intervals:H}}function t(A,v){let B=-1;for(let C=A.length-1;0<=C;C--)if(v>=A[C][0]){B=C;break}return B}function w(A,v,B){const C=(v-A)/B,E=[];let F;for(let M=1;M<=B;M++)F=A+C,F=Number(F.toFixed(16)),E.push([A,M===B?v:F]),A=F;return E}const r=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,x=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),D="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=
z;a.calculateHistogram=function(A,v){var B=m(A,v);if(null==B.min&&null==B.max)return{bins:[],minValue:B.min,maxValue:B.max,normalizationTotal:v.normalizationTotal};const C=B.intervals,E=B.min??0;B=B.max??0;const F=C.map((M,K)=>({minValue:C[K][0],maxValue:C[K][1],count:0}));for(const M of A)null!=M&&M>=E&&M<=B&&(A=t(C,M),-1<A&&F[A].count++);return{bins:F,minValue:E,maxValue:B,normalizationTotal:v.normalizationTotal}};a.calculatePercentile=q;a.calculateStatistics=u;a.calculateStringStatistics=function(A){const v=
A.returnDistinct?[...(new Set(A.values))]:A.values;var B=v.filter(E=>null!=E).sort();const C=B.length;B={count:C,min:B[0],max:B[C-1]};A.supportsNullCount&&(B.nullcount=v.length-C);A.percentileParams&&(B.median=q(v,A.percentileParams));return B};a.calculateUniqueValuesCount=function(A){const v={};for(let B of A){if(null==B||"string"===typeof B&&""===B.trim())B=null;null==v[B]?v[B]={count:1,data:B}:v[B].count++}return{count:v}};a.createClassBreaksDefinition=l;a.createUVResult=function(A,v,B,C){A=A.count;
const E=[];if(B&&v){B=[];var F=h(v[0]);for(const M of F)if(v[1]){F=h(v[1]);for(const K of F)if(v[2]){F=h(v[2]);for(const G of F)B.push(`${y(M)}${C}${y(K)}${C}${y(G)}`)}else B.push(`${y(M)}${C}${y(K)}`)}else B.push(M);for(const M of B)A.hasOwnProperty(M)||(A[M]={data:M,count:0})}for(const M in A)v=A[M],E.push({value:v.data,count:v.count,label:v.label});return{uniqueValueInfos:E}};a.getAttributeComparator=k;a.getEqualIntervalBins=w;a.getNormalizedValue=function(A,v,B,C){let E=null;switch(v){case "log":0!==
A&&(E=Math.log(A)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(C)&&0!==C&&(E=A/C*100);break;case "field":Number.isFinite(B)&&0!==B&&(E=A/B);break;case "natural-log":0<A&&(E=Math.log(A));break;case "square-root":0<A&&(E=A**.5)}return E};a.isNullCountSupported=p;a.processNullValue=y;a.processSummaryStatisticsResult=function(A,v){let B;for(B in A)D.includes(B)&&(Number.isFinite(A[B])||(A[B]=null));if(!v)return A;["avg","stddev","variance"].forEach(C=>{null!=A[C]&&(A[C]=Math.ceil(A[C]??
0))});return A};a.resolveCBResult=function(A,v){let B=A.classBreaks;const C=B[0]?.minValue,E=B[B.length-1]?.maxValue,F="standard-deviation"===v;B=B.map(M=>{const K=M.label;M={minValue:M.minValue,maxValue:M.maxValue,label:K};if(F&&K){const G=K.match(r)?.map(L=>+L.trim())??[];2===G.length?(M.minStdDev=G[0],M.maxStdDev=G[1],0>G[0]&&0<G[1]&&(M.hasAvg=!0)):1===G.length&&(K.includes("\x3c")?(M.minStdDev=null,M.maxStdDev=G[0]):K.includes("\x3e")&&(M.minStdDev=G[0],M.maxStdDev=null))}return M});return{minValue:C,
maxValue:E,classBreakInfos:B,normalizationTotal:A.normalizationTotal}};a.statisticTypes=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f){u=new c.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});c=new c.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});y=function(g){function e(h){h=g.call(this,h)||this;h.type="class-breaks-definition";h.breakCount=
null;h.classificationField=null;h.classificationMethod=null;h.normalizationField=null;h.normalizationType=null;return h}a._inherits(e,g);a._createClass(e,[{key:"standardDeviationInterval",set:function(h){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",h)}},{key:"definedInterval",set:function(h){"defined-interval"===this.classificationMethod&&this._set("definedInterval",h)}}]);return e}(y.JSONSupport);b.__decorate([d.enumeration({classBreaksDef:"class-breaks-definition"})],
y.prototype,"type",void 0);b.__decorate([p.property({json:{write:!0}})],y.prototype,"breakCount",void 0);b.__decorate([p.property({json:{write:!0}})],y.prototype,"classificationField",void 0);b.__decorate([p.property({type:String,json:{read:u.read,write:u.write}})],y.prototype,"classificationMethod",void 0);b.__decorate([p.property({json:{write:!0}})],y.prototype,"normalizationField",void 0);b.__decorate([p.property({json:{read:c.read,write:c.write}})],y.prototype,"normalizationType",void 0);b.__decorate([p.property({value:null,
json:{write:!0}})],y.prototype,"standardDeviationInterval",null);b.__decorate([p.property({value:null,json:{write:!0}})],y.prototype,"definedInterval",null);return y=b.__decorate([f.subclass("esri.rest.support.ClassBreaksDefinition")],y)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function c(h){var z=h.definition;const {classificationMethod:n,normalizationType:l,definedInterval:m}=z;z=z.breakCount??1;const t=[];var w=h.values;if(0===
w.length)return[];w=w.sort((B,C)=>B-C);var r=w[0],x=w[w.length-1];if("equal-interval"===n)if(w.length>=z){w=(x-r)/z;h=r;for(var D=1;D<z;D++){var A=Number((r+D*w).toFixed(6));t.push({minValue:h,maxValue:A,label:y(h,A,l)});h=A}t.push({minValue:h,maxValue:x,label:y(h,x,l)})}else w.forEach(B=>{t.push({minValue:B,maxValue:B,label:y(B,B,l)})});else if("natural-breaks"===n){w=p(w);h=u(w.uniqueValues,h.valueFrequency||w.valueFrequency,z);for(D=1;D<z;D++)w.uniqueValues.length>D&&(A=Number(w.uniqueValues[h[D]].toFixed(6)),
t.push({minValue:r,maxValue:A,label:y(r,A,l)}),r=A);t.push({minValue:r,maxValue:x,label:y(r,x,l)})}else if("quantile"===n)if(w.length>=z&&r!==x){h=Math.ceil(w.length/z);D=0;for(A=1;A<z;A++){var v=h+D-1;v>w.length&&(v=w.length-1);0>v&&(v=0);t.push({minValue:r,maxValue:w[v],label:y(r,w[v],l)});r=w[v];D+=h;h=Math.ceil((w.length-D)/(z-A))}t.push({minValue:r,maxValue:x,label:y(r,x,l)})}else for(z=-1,x=0;x<w.length;x++)r=w[x],r!==z&&(z=r,t.push({minValue:z,maxValue:r,label:y(z,r,l)}),z=r);else if("standard-deviation"===
n)if(h=d(w),D=f(w,h),0===D)t.push({minValue:w[0],maxValue:w[0],label:y(w[0],w[0],l)});else{w=k(r,x,z,h,D)*D;D=0;for(A=z;1<=A;A--)v=Number((h-(A-.5)*w).toFixed(6)),t.push({minValue:r,maxValue:v,label:y(r,v,l)}),r=v,D++;A=Number((h+.5*w).toFixed(6));t.push({minValue:r,maxValue:A,label:y(r,A,l)});r=A;D++;for(v=1;v<=z;v++)A=D===2*z?x:Number((h+(v+.5)*w).toFixed(6)),t.push({minValue:r,maxValue:A,label:y(r,A,l)}),r=A,D++}else if("defined-interval"===n){if(!m)return t;z=w[0];x=w[w.length-1];w=Math.ceil((x-
z)/m);r=z;for(h=1;h<w;h++)D=Number((z+h*m).toFixed(6)),t.push({minValue:r,maxValue:D,label:y(r,D,l)}),r=D;t.push({minValue:r,maxValue:x,label:y(r,x,l)})}return t}function y(h,z,n){let l=null;return l=h===z?n&&"percent-of-total"===n?h+"%":h.toString():n&&"percent-of-total"===n?h+"% - "+z+"%":h+" - "+z}function p(h){const z=[],n=[];let l=Number.MIN_VALUE,m=1,t=-1;for(let w=0;w<h.length;w++){const r=h[w];r===l?(m++,n[t]=m):null!==r&&(z.push(r),l=r,m=1,n.push(m),t++)}return{uniqueValues:z,valueFrequency:n}}
function u(h,z,n){var l=h.length;const m=[];n>l&&(n=l);for(var t=0;t<n;t++)m.push(Math.round(t*l/n-1));m.push(l-1);t=q(m,h,z,n);l=t.mean;t=t.sdcm;var w=n,r=0,x=0;let D=0,A=0,v=!0;for(let C=0;2>C&&v;C++){0===C&&(v=!1);for(var B=0;B<w-1;B++)for(;m[B+1]+1!==m[B+2];)if(m[B+1]+=1,r=g(B,m,h,z),D=r.sbMean,r=r.sbSdcm,x=g(B+1,m,h,z),A=x.sbMean,x=x.sbSdcm,r+x<t[B]+t[B+1])t[B]=r,t[B+1]=x,l[B]=D,l[B+1]=A,v=!0;else{--m[B+1];break}for(B=w-1;0<B;B--)for(;m[B]!==m[B-1]+1;)if(--m[B],r=g(B-1,m,h,z),D=r.sbMean,r=r.sbSdcm,
x=g(B,m,h,z),A=x.sbMean,x=x.sbSdcm,r+x<t[B-1]+t[B])t[B-1]=r,t[B]=x,l[B-1]=D,l[B]=A,v=!0;else{m[B]+=1;break}}v&&(t=q(m,h,z,n));return m}function q(h,z,n,l){let m=[];var t=[],w=[];let r=0;const x=[],D=[];for(var A=0;A<l;A++){var v=g(A,h,z,n);x.push(v.sbMean);D.push(v.sbSdcm);r+=D[A]}v=r;for(A=!0;A||r<v;){A=!1;m=[];for(t=0;t<l;t++)m.push(h[t]);for(w=0;w<l;w++)for(v=h[w]+1;v<=h[w+1];v++)if(t=z[v],0<w&&v!==h[w+1]&&Math.abs(t-x[w])>Math.abs(t-x[w-1]))h[w]=v;else if(w<l-1&&h[w]!==v-1&&Math.abs(t-x[w])>Math.abs(t-
x[w+1])){h[w+1]=v-1;break}v=r;r=0;t=[];w=[];for(let B=0;B<l;B++){t.push(x[B]);w.push(D[B]);const C=g(B,h,z,n);x[B]=C.sbMean;D[B]=C.sbSdcm;r+=D[B]}}if(r>v){for(z=0;z<l;z++)h[z]=m[z],x[z]=t[z],D[z]=w[z];r=v}return{mean:x,sdcm:D}}function k(h,z,n,l,m){h=Math.max(l-h,z-l)/m/n;return 1<=h?1:.5<=h?.5:.25}function d(h){let z=0;for(let n=0;n<h.length;n++)z+=h[n];return z/=h.length}function f(h,z){let n=0;for(let l=0;l<h.length;l++){const m=h[l];n+=(m-z)*(m-z)}n/=h.length;return Math.sqrt(n)}function g(h,
z,n,l){var m=0,t=0;for(var w=z[h]+1;w<=z[h+1];w++){const r=l[w];m+=n[w]*r;t+=r}0>=t&&e.warn("Exception in Natural Breaks calculation");m/=t;t=0;for(w=z[h]+1;w<=z[h+1];w++)t+=l[w]*(n[w]-m)**2;return{sbMean:m,sbSdcm:t}}const e=b.getLogger("esri.rest.support.generateRendererUtils");a.createGenerateRendererClassBreaks=function(h){const {normalizationTotal:z}=h;return{classBreaks:c(h),normalizationTotal:z}};a.createGenerateRendererUniqueValues=function(h){h=p(h);const z=[],n=h.uniqueValues.length;for(let l=
0;l<n;l++){const m=h.uniqueValues[l];z.push({value:m,count:h.valueFrequency[l],label:m.toString()})}return{uniqueValues:z}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){function h(){return new Promise((t,w)=>a(["../../../geometry/geometryEngineJSON"],t,w))}const z={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var n={esriSpatialRelIntersects:!0,
esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},l={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=
function(t){if(u.isExtent(t))return!0;if(u.isPolygon(t)){for(const w of t.rings)if(5!==w.length||w[0][0]!==w[1][0]||w[0][0]!==w[4][0]||w[2][0]!==w[3][0]||w[0][1]!==w[3][1]||w[0][1]!==w[4][1]||w[1][1]!==w[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(t,w,r){const {spatialRel:x,geometry:D}=t;if(D){if(null==x||!0!==n[x])throw new c("feature-store:unsupported-query","Unsupported query spatial relationship",{query:t});if(q.isValid(D.spatialReference)&&q.isValid(r)){if(null==
D||!0!==l[u.getJsonType(D)])throw new c("feature-store:unsupported-query","Unsupported query geometry type",{query:t});if(null==w||!0!==m[w])throw new c("feature-store:unsupported-query","Unsupported layer geometry type",{query:t});if(t.outSR)return g.checkProjectionSupport(t.geometry&&t.geometry.spatialReference,t.outSR)}}};b.getSpatialQueryOperator=function(t,w,r,x,D){if(u.isPolygon(w)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const A=d.convertFromPolygon(new f,
w,!1,!1);return Promise.resolve(v=>k.polygonContainsPoint(A,!1,!1,v))}if(u.isPolygon(w)&&"esriGeometryMultipoint"===r){const A=d.convertFromPolygon(new f,w,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve(v=>k.polygonContainsMultipoint(A,!1,!1,v,x,D))}if(u.isExtent(w)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve(A=>y.extentContainsPoint(w,e.getGeometry(r,x,D,A)));if(u.isExtent(w)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===
t)return Promise.resolve(A=>y.extentContainsMultipoint(w,e.getGeometry(r,x,D,A)));if(u.isExtent(w)&&"esriSpatialRelIntersects"===t){const A=p.getExtentIntersector(r);return Promise.resolve(v=>A(w,e.getGeometry(r,x,D,v)))}return h().then(A=>{const v=A[z[t]].bind(null,w.spatialReference,w);return B=>v(e.getGeometry(r,x,D,B))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=
b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.extentIntersectsRings=b.extentIntersectsRings;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(c){return"mesh"===c?b.extentIntersectsExtent:
b.getFeatureExtentIntersector(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(c,y,p,u,q){if(!c)return!1;y=y?p?4:3:p?3:2;const {coords:k,lengths:d}=c;p=!1;c=0;for(const g of d){var f=c;for(let e=c,h=c+g*y;e<h;e+=y){f=e+y;f===h&&(f=c);const z=k[e],n=k[e+1],l=k[f];f=k[f+1];(n<q&&f>=q||f<q&&n>=q)&&z+(q-n)/(f-n)*(l-z)<u&&(p=!p)}c+=g*y}return p}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(c,
y,p,u,q,k){q=q?k?4:3:k?3:2;const {coords:d,lengths:f}=u;if(!f)return!1;for(let g=0,e=0;g<f.length;g++,e+=q)if(!b(c,y,p,d[e],d[e+1]))return!1;return!0};a.polygonContainsPoint=function(c,y,p,u){return b(c,y,p,u.coords[0],u.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(p,u,q,k,d){if(null!=k&&null!=d)return f=>{const g=p.getAttribute(f,u);f=p.getAttribute(f,q);return(null==g||g<=
d)&&(null==f||f>=k)};if(null!=k)return f=>{f=p.getAttribute(f,q);return null==f||f>=k};if(null!=d)return f=>{f=p.getAttribute(f,u);return null==f||f<=d}}function c(p,u,q,k){if(null!=q&&null!=k&&q===k)return d=>p.getAttribute(d,u)===q;if(null!=q&&null!=k)return d=>{d=p.getAttribute(d,u);return d>=q&&d<=k};if(null!=q)return d=>p.getAttribute(d,u)>=q;if(null!=k)return d=>p.getAttribute(d,u)<=k}function y(){return()=>!1}a.getTimeExtent=async function(p,u){if(!p)return null;const q=u.featureAdapter,{startTimeField:k,
endTimeField:d}=p;let f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(k&&d)await u.forEach(e=>{const h=q.getAttribute(e,k);e=q.getAttribute(e,d);null==h||isNaN(h)||(f=Math.min(f,h));null==e||isNaN(e)||(g=Math.max(g,e))});else{const e=k||d;await u.forEach(h=>{h=q.getAttribute(h,e);null==h||isNaN(h)||(f=Math.min(f,h),g=Math.max(g,h))})}return{start:f,end:g}};a.getTimeOperator=function(p,u,q){if(!u||!p)return null;const {startTimeField:k,endTimeField:d}=p;if(!k&&!d)return null;const {start:f,
end:g}=u;return null===f&&null===g?null:void 0===f&&void 0===g?y():k&&d?b(q,k,d,f,g):c(q,k||d,f,g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,b,c){const y={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(p,u,q){if(null==p||0===u.candidates.length)return y;var k=p.graphics3DGraphicsByObjectID??
p.graphics3DGraphics,d=[];const f=[],{renderer:g}=p,e=null!=g&&"arcadeRequired"in g&&g.arcadeRequired?c.loadArcade():null;var h=async(t,{graphic:w,graphics3DSymbol:r})=>{const x=await e;w=await p.getRenderingInfoAsync(w,g,x,{signal:q});return null==w?[]:r.queryForSnapping(t,n,w,q)};const {candidates:z,spatialReference:n}=u;for(u=0;u<z.length;++u){var l=z[u],{objectId:m}=l;m="number"===typeof m?k?.get(m):void 0;if(null==m)continue;const {graphics3DSymbol:t}=m;t.symbologySnappingSupported&&(d.push(h(l,
m)),f.push(u))}if(0===d.length)return y;k=await Promise.all(d);b.throwIfAborted(q);d=[];h=[];for(u=0;u<k.length;++u){l=k[u];m=f[u];for(const t of l)d.push(t),h.push(m)}return{candidates:d,sourceCandidateIndices:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/arrayUtils ../../../../core/byteSizeEstimations ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T){const P=k.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(S){function U(X){X=S.call(this,X)||this;X.type="heatmap";X.preferredUpdatePolicy=H.UpdatePolicy.ASYNC;X.dataExtent=null;X.drapeSourceType=C.DrapeSourceType.Features;X._renderGeometries=new Map;X._fieldTotal=0;X._drapeSourceRenderer=null;X._dataType=W.PixelType.HALF_FLOAT;X._pixelFormat=W.PixelFormat.RGBA;
X.initializePromise=Promise.resolve();return X}b._inherits(U,S);var V=U.prototype;V.initialize=function(){this._featureStore=new A({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:X,samplingMode:Y,pixelFormat:Z,internalFormat:ea}=T.loadHeatmapTextureConfiguration(this._renderView.renderingContext,P);this._dataType=X;this._pixelFormat=Z;const ja=X!==W.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,G.DrapedHeatmapRenderer,
{...this._rendererParameters,dataType:X,samplingMode:Y,pixelFormat:Z,internalFormat:ea});this._material=new N.HeatmapDensityMaterial({usesHalfFloats:ja});this._materialWithField=new N.HeatmapDensityMaterial({usesHalfFloats:ja,isAttributeDriven:!0});this._filterVisibility=new E.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:ha=>this._setAllFeaturesVisibility(ha),clearFeaturesVisibility:()=>
this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:ha=>this._updateFeatureVisibilities(ha)}});this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,ha=>this._onLoadedFeaturesChange(ha),f.initial);this.updatingHandles.addWhen(()=>this._materialParameters,ha=>this._forEachMaterial(ia=>ia.setParameters(ha)),f.initial);this.updatingHandles.add(()=>this._rendererParameters,ha=>this._drapeSourceRenderer.set(ha));this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},
f.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:ha,numeric:ia})=>{if(null!=ha&&ia){let oa=0;this._featureStore.forEach(ma=>oa+=ma.attributes[ha]??0);this._fieldTotal=oa}else this._fieldTotal=this._featureStore.numFeatures},f.initial);this.handles.add([f.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:ha,field:ia})=>{ha&&!ia&&P.warn(`Heatmap renderer field '${ha}' for layer '${this.layer.title??
this.layer.id}' not found`)}),f.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:ha,numeric:ia})=>{null==ha||ia||P.warn(`Heatmap renderer field '${ha.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),q.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])};V.destroy=function(){this._renderGeometries.clear();this._material=d.disposeMaybe(this._material);
this._materialWithField=d.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};V.whenGraphicBounds=async function(){return null};V.computeAttachmentOrigin=function(){return null};V.highlight=function(){return Q};V.maskOccludee=function(){return Q};V.setObjectIdVisibility=function(){};V.refreshFilter=function(){this.filterVisibility.reapply()};V._onLoadedFeaturesChange=function(X){if(this._featuresArePoints){var {objectIdField:Y}=this.layer;this._featureStore.removeManyById(X.removed.map(ea=>
w.getObjectId(ea,Y)));this._featureStore.addMany(X.added.map(ea=>{const ja=new x.OptimizedFeature(r.convertFromPoint(new D,ea.geometry),ea.attributes,d.applySome(ea.centroid,ha=>r.convertFromPoint(new D,ha)),w.getObjectId(ea,Y));ja.displayId=ea.uid;return ja}));var Z=X.added;X=X.removed;this._fieldTotal+=this._computeFieldTotalChange(Z,X);X=X.map(({uid:ea})=>{const ja=this._renderGeometries.get(ea);this._renderGeometries.delete(ea);return ja}).filter(y.isSome);Z=Z.map(ea=>{const ja=this._pointGraphicToRenderGeometry(ea);
this._renderGeometries.set(ea.uid,ja);return ja});0<X.length&&this._drapeSourceRenderer.removeGeometries(X,O.DirtyOperation.REMOVE);0<Z.length&&this._drapeSourceRenderer.addGeometries(Z,O.DirtyOperation.ADD);if(0<Z.length||0<X.length)this.filterVisibility.reapply(),this._renderView.requestRender()}};V._recreate=function(){if(this._loadedPointGraphics){var X=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:X,removed:X})}};V._pointGraphicToRenderGeometry=function(X){const Y=this._heatmapRendererFieldName,
Z=null!=Y?this._materialWithField:this._material;var ea=l.create();m.projectPointToVector(X.geometry,ea,this._overlaySpatialReference);ea[2]=F.DRAPED_Z;ea=[[J.VertexAttribute.POSITION,new M.Attribute(ea,ea.length)]];const ja=this._heatmapRendererFieldIsNumeric;null!=Y&&ea.push([J.VertexAttribute.FEATUREATTRIBUTE,new M.Attribute([ja?X.attributes[Y]??0:0],1)]);X=new I.RenderGeometry(new L.Geometry(Z,ea,null,null,K.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:X.uid});X.visible=this.filterVisibility.defaultVisibility;
return X};V._forEachMaterial=function(X){X(this._material);X(this._materialWithField)};V._computeFieldTotalChange=function(X,Y){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return X.length-Y.length;const Z=this._heatmapRendererFieldName,ea=(ja,ha)=>ja+(ha.attributes[Z]??0);return X.reduce(ea,0)-Y.reduce(ea,0)};V._clampSearchRadius=function(X){112<X&&P.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(X,112)};V._updateFeatureVisibilities=
function(X){const Y=[];this._featureStore.forEach(({objectId:Z,displayId:ea})=>{Z=X(Z);(ea=this._renderGeometries.get(ea))&&ea.visible!==Z&&(Y.push(ea),ea.visible=Z)});this._drapeSourceRenderer.modifyGeometries(Y,O.DirtyState.VISIBILITY)};V._setAllFeaturesVisibility=function(X){const Y=[];for(const Z of this._renderGeometries.values())Z.visible!==X&&(Y.push(Z),Z.visible=X);this._drapeSourceRenderer.modifyGeometries(Y,O.DirtyState.VISIBILITY)};b._createClass(U,[{key:"layer",get:function(){return this.owner.layer}},
{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating||this.filterVisibility.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"displayFeatureLimit",get:function(){var X=this.owner?.view?.resourceController?.memoryController?.memoryFactor??1;const Y=
this.owner?.view?.qualitySettings;X=Y?Math.ceil(Y.heatmap.maxTotalNumberOfFeatures*X):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:X,maximumTotalNumberOfPrimitives:2*X,maximumNumberOfFeatures:X}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",
get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){if(!this._isScaleRangeActive)return!1;const {minScale:X,maxScale:Y}=this.layer.effectiveScaleRange,{scale:Z}=this.view;return!R.scaleBoundsPredicate(Z,X??0,Y??0)}},{key:"usedMemory",get:function(){const X=Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return X*X*(this._pixelFormat===W.PixelFormat.RED?1:4)*(this._dataType===W.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*
this._featureStore.numFeatures}},{key:"usedMemoryPerFeature",get:function(){var X=this._loadedPointGraphics.find(()=>!0);if(null==X)return 0;X=p.estimateAttributesObjectSize(X);const Y=p.estimateNumberByteSize(),Z=6*p.estimateFixedArraySize([0,0,0],Y),ea=6*p.estimateFixedArraySize([0,0],Y);return Z+ea+(this._heatmapRendererFieldIsNumeric?6*Y:0)+X}},{key:"loadedFeatures",get:function(){return this._featureStore.numFeatures}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",
get:function(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"renderer",get:function(){return this._heatmapRenderer}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return this._overlayRenderer.spatialReference}},{key:"_rendererParameters",get:function(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,
...this._pixelRatioParameter}}},{key:"_materialParameters",get:function(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}},{key:"_densityParameters",get:function(){const X=this._heatmapRenderer;if(null==X)return null;const {minDensity:Y,maxDensity:Z}=X;return{minDensity:Y,maxDensity:Z,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){return d.applySome(this._heatmapRenderer,({radius:X})=>({searchRadius:g.pt2px(this._clampSearchRadius(X))}))}},{key:"_resolutionForScaleParameter",
get:function(){return d.applySome(this._heatmapRenderer,({referenceScale:X})=>({resolutionForScale:0===X?0:t.getResolutionForScale(X,this.view.spatialReference)}))}},{key:"_colorRampParameter",get:function(){return d.applySome(this._heatmapRenderer,X=>({colorRampData:B.generateGradient(X.colorStops)}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){return(this.owner?.view?.qualitySettings.heatmap.pixelRatio??
1)*Math.sqrt(this.owner?.view?.resourceController?.memoryController?.memoryFactor??1)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){const X=this.layer.renderer;return"heatmap"===X?.type?X:null}},{key:"_heatmapRendererFieldName",get:function(){return d.applySome(this._heatmapRenderer,
X=>X.field)}},{key:"_heatmapRendererField",get:function(){return d.applySome(this._heatmapRendererFieldName,X=>this.layer.fieldsIndex.get(X))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const X=this._heatmapRendererField;return null==X?!1:v.isNumericField(X)}},{key:"_isScaleRangeActive",get:function(){const {layer:X}=this;if(!("effectiveScaleRange"in X))return!1;const {minScale:Y,maxScale:Z}=X.effectiveScaleRange;return R.isScaleRangeActive(Y,Z)}},{key:"_visibleFeatures",get:function(){let X=
0;this._renderGeometries.forEach(Y=>{Y.visible&&++X});return X}},{key:"test",get:function(){return{visibleFeatureCount:this._visibleFeatures}}}]);return U}(u.HandleOwner);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);c.__decorate([e.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",
null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",
null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"view",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);
c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_filterVisibility",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_renderGeometries",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_drapeSourceRenderer",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=c.__decorate([n.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const Q=q.makeHandle();a.MAX_RADIUS_PT=112;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter ./utils".split(" "),
function(a,b,c,y,p,u,q,k,d,f){const g=p.create();return function(){function e(z){this.geometryInfo=z;this._boundsStore=new k.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=d.optimizedFeatureQueryEngineAdapter}var h=e.prototype;h.getFullExtent=function(z){if(null==this.fullBounds)return null;const [n,l,m,t]=this.fullBounds;return{xmin:n,ymin:l,xmax:m,ymax:t,spatialReference:f.cleanFromGeometryEngine(z)}};h.add=function(z){this._add(z);this._emitChanged()};
h.addMany=function(z){for(const n of z)this._add(n);this._emitChanged()};h.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};h.removeById=function(z){z=this._featuresById.get(z);if(!z)return null;this._remove(z);this._emitChanged();return z};h.removeManyById=function(z){this._boundsStore.invalidateIndex();for(const n of z)(z=this._featuresById.get(n))&&this._remove(z);this._emitChanged()};h.forEachBounds=function(z,n){for(const l of z)(z=this._boundsStore.get(l.objectId))&&
n(p.fromRect(g,z))};h.getFeature=function(z){return this._featuresById.get(z)};h.has=function(z){return this._featuresById.has(z)};h.forEach=function(z){this._featuresById.forEach(n=>z(n))};h.forEachInBounds=function(z,n){this._boundsStore.forEachInBounds(z,l=>{n(this._featuresById.get(l))})};h.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};h.sweep=function(){let z=!1;this._featuresById.forEach((n,l)=>{this._markedIds.has(l)||(z=!0,this._remove(n))});
this._markedIds.clear();z&&this._emitChanged()};h._emitChanged=function(){this.events.emit("changed",void 0)};h._add=function(z){if(z){var n=z.objectId;if(null==n)y.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:z}));else{var l=this._featuresById.get(n);this._markedIds.add(n);if(l){z.displayId=l.displayId;var m=this._boundsStore.get(n);this._boundsStore.delete(n)}else if(null!=this.onFeatureAdd)this.onFeatureAdd(z);null!=
z.geometry&&z.geometry.coords&&z.geometry.coords.length?(m=q.getBoundsOptimizedGeometry(null!=m?m:u.create(),z.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=m&&this._boundsStore.set(n,m)):this._boundsStore.set(n,null);this._featuresById.set(n,z)}}};h._remove=function(z){if(null!=this.onFeatureRemove)this.onFeatureRemove(z);const n=z.objectId;this._markedIds.delete(n);this._boundsStore.delete(n);this._featuresById.delete(n);return z};a._createClass(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},
{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){let z=0;this._featuresById.forEach(n=>{null!=n.geometry&&n.geometry.coords&&(z+=n.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:z/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);
return e}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,c,y,p){function u(d,f,g){q.minX=f[0];q.minY=f[1];q.maxX=f[2];q.maxY=f[3];d.search(q,g)}const q={minX:0,minY:0,maxX:0,maxY:0};let k=function(){function d(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=
new y.PooledRBush(9,c("esri-csp-restrictions")?g=>({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const g=Array(this._idByBounds.size);let e=0;this._idByBounds.forEach((h,z)=>{g[e++]=z});this._indexInvalid=!1;this._index.clear();this._index.load(g)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(g=>this._idByBounds.has(g))))),this._boundsToLoad.length=0)}}var f=d.prototype;f.clear=function(){this._indexInvalid=
!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};f.delete=function(g){const e=this._boundsById.get(g);this._boundsById.delete(g);e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))};f.forEachInBounds=function(g,e){this._loadIndex();u(this._index,g,h=>e(this._idByBounds.get(h)))};f.get=function(g){return this._boundsById.get(g)};f.has=function(g){return this._boundsById.has(g)};f.invalidateIndex=function(){this._indexInvalid||
(this._indexInvalid=!0,this._boundsToLoad.length=0)};f.set=function(g,e){if(!this._indexInvalid){const h=this._boundsById.get(g);h&&(this._index.remove(h),this._idByBounds.delete(h))}this._boundsById.set(g,e);e&&(this._idByBounds.set(e,g),this._indexInvalid||(this._boundsToLoad.push(e),5E4<this._boundsToLoad.length&&this._loadIndex()))};b._createClass(d,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;const g=p.empty();for(const e of this._boundsById.values())e&&(g[0]=Math.min(e[0],
g[0]),g[1]=Math.min(e[1],g[1]),g[2]=Math.max(e[2],g[2]),g[3]=Math.max(e[3],g[3]));return g}},{key:"valid",get:function(){return!this._indexInvalid}}]);return d}();a.BoundsStore=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){a.DrapedHeatmapRenderer=function(r){function x(A){var v=r.call(this,A)||this;v.pixelRatio=1;v._colorRampData=new Uint8ClampedArray(4);v.type="draped-heatmap";v._heatmapParameters=new z.HeatmapPassParameters;var B=new t.TextureDescriptor;B.pixelFormat=A.pixelFormat;B.internalFormat=A.internalFormat;B.dataType=A.dataType;B.samplingMode=A.samplingMode;B.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;const C=A.rendererContext.rctx;v._densityMap=new l.FramebufferObject(C,
B);v._quad=e.createQuadVAO(C);B=new z.HeatmapTechniqueConfiguration;B.usesHalfFloat=A.dataType!==n.PixelType.FLOAT;v._technique=new z.HeatmapTechnique({rctx:C,viewingMode:g.ViewingMode.Local},B);return v}b._inherits(x,r);var D=x.prototype;D.initialize=function(){const A=this._colorRampData,v=new t.TextureDescriptor(A.length/4,1);v.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new m.Texture(this.rctx,v,A);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(p.watch(()=>
[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};D.destroy=function(){this._technique=y.releaseMaybe(this._technique);this._densityMap=y.disposeMaybe(this._densityMap);this._quad=y.disposeMaybe(this._quad);this._colorRamp=y.disposeMaybe(this._colorRamp)};D.render=function(A){const v=this._sortedMaterialRenderers;if(0!==v.length){var B=this.rctx.getBoundFramebufferObject(),C=this.rctx.getViewport(),
{pixelRatio:E}=this,F=Math.ceil(C.width*E);E=Math.ceil(C.height*E);this._densityMap.resize(F,E);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,F,E);this.rctx.clear(n.ClearBufferBit.COLOR_BUFFER_BIT);var M=!1;v.forAll(K=>{if(K.material.shouldRender(A)){const G=K.prepareTechnique(A);null!=G&&(K.render(A,G),M=!0)}});this.rctx.bindFramebuffer(B);this.rctx.setViewport(C.x,C.y,C.width,C.height);M&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,
A.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,w.vertexCount(this._quad,"geometry")))}};b._createClass(x,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(A){A!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=A,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(A){A!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=
A,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(A){A!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=A,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(A){this._heatmapParameters.fieldTotal=A;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(A){const {colorRamp:v}=
this._heatmapParameters;if(null!=v&&A!==this._colorRampData){const B=A.length/4;B!==v.descriptor.width&&v.resize(B,1);v.setData(A)}this._colorRampData=A}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(A){this._heatmapParameters.colorRamp=A}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return x}(h.SortedRenderGeometryRenderer);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,
"searchRadius",null);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([u.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,
"dataType",void 0);c.__decorate([u.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([u.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([u.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);c.__decorate([u.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],
a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){p=function(l){function m(){var t=l.apply(this,arguments)||this;t.colorRamp=null;t.densityMap=null;t.searchRadius=1;t.fieldTotal=0;t.minDensity=0;t.maxDensity=100;return t}c._inherits(m,l);return c._createClass(m)}(p.NoParameters);q=function(l){function m(w,r){var x;return x=l.call(this,w,r,()=>x.destroy())||this}c._inherits(m,l);var t=m.prototype;t.initializeProgram=function(w){return new g.Program(w.rctx,m.shader.get().build(this.configuration),d.Default3D)};
t.initializePipeline=function(){return n.makePipelineState({blending:f.blendingDefault,colorWrite:n.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(m,[{key:"primitiveType",get:function(){return z.PrimitiveType.TRIANGLE_STRIP}}]);return m}(q.ShaderTechnique);q.shader=new u.ReloadableShaderModule(h.HeatmapShader,()=>new Promise((l,m)=>a(["./Heatmap.glsl"],l,m)));u=function(l){function m(){var t=l.apply(this,arguments)||this;t.usesHalfFloat=!1;return t}c._inherits(m,l);return c._createClass(m)}(e.DefaultTechniqueConfiguration);
y.__decorate([k.parameter()],u.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=p;b.HeatmapTechnique=q;b.HeatmapTechniqueConfiguration=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,y,p,u,q){function k(f){const g=new u.ShaderBuilder;g.include(b.ScreenSpacePass);g.include(c.DiscardOrAdjustAlphaBlend);({usesHalfFloat:f}=f);g.fragment.uniforms.add(new q.Texture2DPassUniform("densityMap",e=>e.densityMap),new q.Texture2DPassUniform("tex",e=>e.colorRamp),new y.FloatPassUniform("densityNormalizer",e=>1/(e.maxDensity-e.minDensity)),new y.FloatPassUniform("minDensity",e=>e.minDensity),new y.FloatPassUniform("densityMultiplier",e=>3/(e.searchRadius*e.searchRadius*Math.PI)));
f&&g.constants.add("compressionFactor","float",4);g.fragment.code.add(p.glsl`
    void main() {
      float density = texture(densityMap, uv).r * densityMultiplier${f?p.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      fragColor = color;
    }
  `);return g}const d=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=d;a.build=k})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){let h=function(w){function r(){var x=w.apply(this,arguments)||this;x.isAttributeDriven=!1;x.usesHalfFloats=!1;return x}b._inherits(r,w);return b._createClass(r)}(e.HeatmapDensityPassParameters);k=function(w){function r(D){D=w.call(this,D,new h)||this;D._configuration=new e.HeatmapDensityTechniqueConfiguration;return D}b._inherits(r,w);var x=r.prototype;x.requiresSlot=function(D,A){return D===d.RenderSlot.DRAPED_MATERIAL&&A===u.ShaderOutput.Color};x.getConfiguration=
function(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;return this._configuration};x.createGLMaterial=function(D){return new z(D)};x.intersect=function(){};x.intersectDraped=function(D,A,v,B,C,E){A=D.vertexAttributes.get(f.VertexAttribute.POSITION);({parameters:v}=this);({searchRadius:v}=v);({screenToWorldRatio:D}=D);D=v*D+2*D;D*=D;v=A.data.length/A.size;for(let M=0;M<v;M++){var F=M*A.size;F=c.set(t,A.data[F],
A.data[F+1]);c.squaredDistance(F,B)<D&&C(E.dist,E.normal,-1,!1)}};x.createBufferWriter=function(){return new n(this.parameters.isAttributeDriven?m:l)};return b._createClass(r)}(k.Material);let z=function(w){function r(){return w.apply(this,arguments)||this}b._inherits(r,w);r.prototype.beginSlot=function(x){return this.ensureTechnique(e.HeatmapDensityTechnique,x)};return b._createClass(r)}(q),n=function(){function w(x){this.vertexBufferLayout=x}var r=w.prototype;r.elementCount=function(x){return 6*
x.indices.get(f.VertexAttribute.POSITION).length};r.write=function(x,D,A,v,B){g.writePosition(A.indices.get(f.VertexAttribute.POSITION),A.vertexAttributes.get(f.VertexAttribute.POSITION).data,x,v.position,B,6);x=A.indices.get(f.VertexAttribute.POSITION).length;D=v.uv0;let C=B;for(let E=0;E<x;++E)D.setValues(C++,-1,-1),D.setValues(C++,1,-1),D.setValues(C++,1,1),D.setValues(C++,1,1),D.setValues(C++,-1,1),D.setValues(C++,-1,-1);(v=f.VertexAttribute.FEATUREATTRIBUTE in v?v.featureAttribute:null)&&g.writeBufferFloat(A.indices.get(f.VertexAttribute.FEATUREATTRIBUTE),
A.vertexAttributes.get(f.VertexAttribute.FEATUREATTRIBUTE).data,v,B,6)};return b._createClass(w)}();const l=p.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0),m=l.clone().f32(f.VertexAttribute.FEATUREATTRIBUTE),t=y.create();a.HeatmapDensityMaterial=k;a.HeatmapDensityMaterialParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){d=function(n){function l(){var m=n.apply(this,arguments)||this;m.searchRadius=128;m.resolutionForScale=0;return m}c._inherits(l,n);return c._createClass(l)}(d.MaterialParameters);u=function(n){function l(){return n.apply(this,arguments)||this}c._inherits(l,n);var m=l.prototype;m.initializeProgram=function(t){return new f.Program(t.rctx,l.shader.get().build(this.configuration),k.Default3D)};m.initializePipeline=function(){return z.makePipelineState({blending:z.simpleBlendingParams(h.BlendFactor.ONE,
h.BlendFactor.ONE,h.BlendOperation.ADD),colorWrite:z.defaultColorWriteParams,depthTest:null,depthWrite:null})};m.destroy=function(){c._get(c._getPrototypeOf(l.prototype),"destroy",this).call(this)};return c._createClass(l)}(u.ShaderTechnique);u.shader=new p.ReloadableShaderModule(e.HeatmapDensity,()=>new Promise((n,l)=>a(["./HeatmapDensity.glsl"],n,l)));p=function(n){function l(){var m=n.apply(this,arguments)||this;m.isAttributeDriven=!1;m.usesHalfFloat=!1;return m}c._inherits(l,n);return c._createClass(l)}(g.DefaultTechniqueConfiguration);
y.__decorate([q.parameter()],p.prototype,"isAttributeDriven",void 0);y.__decorate([q.parameter()],p.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=d;b.HeatmapDensityTechnique=u;b.HeatmapDensityTechniqueConfiguration=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/terrain/Overlay ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q){function k(f){const g=new u.ShaderBuilder,{vertex:e,fragment:h,attributes:z,varyings:n}=g;c.addProjViewLocalOrigin(e,f);const {isAttributeDriven:l,usesHalfFloat:m}=f;z.add(q.VertexAttribute.POSITION,"vec3");z.add(q.VertexAttribute.UV0,"vec2");l&&(z.add(q.VertexAttribute.FEATUREATTRIBUTE,"float"),n.add("attributeValue","float"));m&&g.constants.add("compressionFactor","float",.25);n.add("unitCirclePos","vec2");e.uniforms.add(new y.FloatPassUniform("radius",({resolutionForScale:t,
searchRadius:w},{camera:r,screenToWorldRatio:x})=>2*w*(0===t?1:t/x)*r.pixelRatio/r.fullViewport[2]/b.OverlayStretch));e.code.add(p.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${q.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${l?p.glsl`attributeValue = ${q.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);h.code.add(p.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${l?p.glsl` * attributeValue`:""} ${m?p.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return g}const d=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=d;a.build=k})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","../../core/maybe","./enums"],function(a,b,c,y){a.loadHeatmapTextureConfiguration=function(p,u){const {textureFloat:q,colorBufferFloat:k}=p.capabilities,d=q?.textureFloat,f=q?.textureFloatLinear;var g=q?.textureHalfFloat;const e=q?.textureHalfFloatLinear,h=q?.HALF_FLOAT,
z=k?.textureFloat;var n=k?.textureHalfFloat;const l=k?.floatBlend;p=c.unwrapOrThrow(p.driverTest).floatBufferBlend.result;if(!d&&!g)throw new b("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!z&&!n)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(l&&p||n))throw new b("heatmap:missing-float-blend",
`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${p?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);g=g&&n;n=!!k?.R32F;const m=!!k?.R16F;if(d&&z&&l&&p&&(f||!e))return f||u.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:y.PixelType.FLOAT,samplingMode:f?y.TextureSamplingMode.LINEAR:y.TextureSamplingMode.NEAREST,pixelFormat:n?y.PixelFormat.RED:y.PixelFormat.RGBA,
internalFormat:n?y.SizedPixelFormat.R32F:y.PixelFormat.RGBA};if(g)return e||u.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),{dataType:h,samplingMode:e?y.TextureSamplingMode.LINEAR:y.TextureSamplingMode.NEAREST,pixelFormat:m?y.PixelFormat.RED:y.PixelFormat.RGBA,internalFormat:m?y.SizedPixelFormat.R16F:y.PixelFormat.RGBA};throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,c){a.toViewIfLocal=function(y){const p=y.view.spatialReference,u=y.layer.fullExtent;var q=null!=u&&u.spatialReference;if(null==u||!q)return Promise.resolve(null);if(q.equals(p))return Promise.resolve(u.clone());q=b.project(u,p);return null!=q?Promise.resolve(q):
y.view.state.isLocal?c.projectGeometry(u,p,y.layer.portalItem).then(k=>!y.destroyed&&k?k:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,c,y,p){let u=function(){function q(d){this._capabilities=this._memoryCache=
null;const f=d.layerView.layer;this._layerView=d.layerView;this.objectIdField=f.objectIdField;this.globalIdField="globalIdField"in f?f.globalIdField:null;this._returnZ=d.returnZ;this._returnM=d.returnM;d=this._layerView.view.resourceController;this.query=p.createFeatureTileQuery3D(f,d.normal);d&&this._memoryCacheEnabled&&(this._memoryCache=d.memoryController.newCache(`fl-${f.uid}`))}var k=q.prototype;k.destroy=function(){this._memoryCache=c.destroyMaybe(this._memoryCache);this.query.destroy()};k.createQuery=
function(){const d=this._layerView.layer.createQuery();d.outFields=this._layerView.availableFields;d.returnZ=this._returnZ;d.returnM=this._returnM;d.outSpatialReference=this.tilingScheme.spatialReference;return d};k.logFetchError=function(d,f){d.error("#fetchTile()",this._layerView.layer,f&&f.message?f.message:f)};b._createClass(q,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}},
{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const d=this._layerView.view.resourceController;return d?d.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",
get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return null!=this._capabilities?this._capabilities:this._capabilities=y.contextCapabilitiesFromLayer(this._layerView.layer)}}]);return q}();a.FeatureTileFetcher3DLayerViewContext=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){let n=function(w){function r(D){return w.call(this,D)||this}b._inherits(r,w);var x=r.prototype;x.queryFeatureCount=function(D,A){return this.layer.queryFeatureCount(D,A)};x.destroy=function(){this._decoder=p.destroyMaybe(this._decoder)};x._createRequestOptions=function(D){return{...D,query:{...this.layer.customParameters,token:this.layer.apiKey,...D?.query}}};b._createClass(r,[{key:"queryFeaturesDehydrated",get:function(){var D=this.layer.capabilities;D=D&&D.query;
const A=this.layer.parsedUrl;if(D&&D.supportsFormatPBF){null==this._decoder&&(this._decoder=new z.PBFDecoder(this.controller));const v={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(B,C)=>h.runQuery(A,B,"pbf",this._createRequestOptions(C)).then(E=>{u.throwIfAborted(C);return null!=this._decoder?this._decoder.invoke({buffer:E.data,options:v},C.signal):Promise.reject(u.createAbortError())})}return(v,B)=>h.executeQuery(A,v,
this.layer.spatialReference,this._createRequestOptions(B)).then(C=>e.fromFeatureSetJSON(C.data))}}]);return r}(y);c.__decorate([q.property({constructOnly:!0})],n.prototype,"layer",void 0);c.__decorate([q.property({constructOnly:!0})],n.prototype,"controller",void 0);c.__decorate([q.property({readOnly:!0})],n.prototype,"queryFeaturesDehydrated",null);n=c.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],n);let l=function(w){function r(D){return w.call(this,
D)||this}b._inherits(r,w);var x=r.prototype;x.queryFeaturesDehydrated=function(D,A){return this.layer.queryFeatures(D,A)};x.queryFeatureCount=function(D,A){return this.layer.queryFeatureCount(D,A)};return b._createClass(r)}(y);c.__decorate([q.property({constructOnly:!0})],l.prototype,"layer",void 0);c.__decorate([q.property({readOnly:!0})],l.prototype,"queryFeaturesDehydrated",null);l=c.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],l);let m=
function(w){function r(x){return w.call(this,x)||this}b._inherits(r,w);r.prototype.queryFeaturesDehydrated=function(x,D){return this.layer.queryFeatures(x,D)};return b._createClass(r)}(y);c.__decorate([q.property({constructOnly:!0})],m.prototype,"layer",void 0);m=c.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],m);let t=function(w){function r(D){return w.call(this,D)||this}b._inherits(r,w);var x=r.prototype;x.queryFeaturesDehydrated=function(D,
A){return this.source.queryFeaturesJSON(D,A).then(e.fromFeatureSetJSON,v=>{if(v&&"query-features-json:unsupported"===v.name)return this.layer.queryFeatures(D,A);throw v;})};x.queryFeatureCount=function(D,A){return this.layer.queryFeatureCount(D,A)};return b._createClass(r)}(y);c.__decorate([q.property({constructOnly:!0})],t.prototype,"layer",void 0);c.__decorate([q.property({constructOnly:!0})],t.prototype,"source",void 0);t=c.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
t);a.createFeatureTileQuery3D=function(w,r){return"feature"===w.type&&"feature-layer"===w.source.type?null!=w.infoFor3D?new l({layer:w}):new n({layer:w,controller:r}):"feature"===w.type&&"memory"===w.source.type||"csv"===w.type||"geojson"===w.type||"oriented-imagery"===w.type||"wfs"===w.type?new t({layer:w,source:w.source}):"ogc-feature"===w.type?new m({layer:w}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,c,y,p,u,q){function k(g){switch(g.type){case "polyline":g.paths.reduce((e,h)=>e+h.length,0)<y.NATIVE_ARRAY_MAX_SIZE&&(g.paths=g.hasZ||g.hasM?g.paths.map(e=>e.map(h=>[h[0],h[1],h[2]])):g.paths.map(e=>e.map(h=>[h[0],h[1]])));break;case "polygon":g.rings.reduce((e,h)=>e+h.length,0)<y.NATIVE_ARRAY_MAX_SIZE&&(g.rings=g.hasZ||g.hasM?g.rings.map(e=>e.map(h=>[h[0],h[1],h[2]])):g.rings.map(e=>e.map(h=>[h[0],h[1]])))}}let d=function(){function g(h){this._controller=h;this._handle=new f(z=>h.schedule(z))}
var e=g.prototype;e.destroy=function(){this._handle.destroy()};e.invoke=function(h,z){if(!h.buffer||0===h.buffer.byteLength)return Promise.resolve(null);h.options.sourceSpatialReference&&h.options.sourceSpatialReference instanceof u&&(h.options={...h.options,sourceSpatialReference:h.options.sourceSpatialReference.toJSON()});return this._handle.invoke(h,z).then(n=>{let l=0,m=0;const t=async w=>{n.spatialReference=u.fromJSON(n.spatialReference);if(n.fields)for(;l<n.fields.length;)if(n.fields[l]=q.fromJSON(n.fields[l]),
l++,w.madeProgress())return this._controller.reschedule(x=>t(x));const r=n.spatialReference;for(;m<n.features.length;){const x=n.features[m];++m;x.uid=c.generateUID();if(null!=x.geometry&&(x.geometry.spatialReference=r,k(x.geometry),w.madeProgress()))return this._controller.reschedule(D=>t(D))}return n};return this._controller.schedule(w=>t(w))})};return b._createClass(g)}(),f=function(g){function e(h){return g.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:z=>[z.buffer]},h)||
this}b._inherits(e,g);return b._createClass(e)}(p.WorkerHandle);a.PBFDecoder=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,c,y,p){c=function(u){function q(){var d=u.apply(this,arguments)||this;d._set=new Set;return d}b._inherits(q,u);var k=q.prototype;k.clear=function(){if(0<
this._set.size){const d=this.toArray();this._set.clear();this.emit("after-changes",{type:y.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:d})}};k.addMany=function(d){if(0!==d.length){for(const f of d)this._set.add(f);this.emit("after-changes",{type:y.ObservableChangesType.ADD});this.emit("change",{added:d,removed:[]})}};k.remove=function(d){this._set.delete(d)&&(this.emit("after-changes",{type:y.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[d]}))};k.removeMany=
function(d){const f=[];for(const g of d)this._set.delete(g)&&f.push(g);0<f.length&&(this.emit("after-changes",{type:y.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:f}))};k.toArray=function(){return[...this._set]};k.find=function(d){let f;p.someSet(this._set,g=>d(g)?(f=g,!0):!1);return f};k.forEach=function(d){this._set.forEach(f=>d(f))};b._createClass(q,[{key:"length",get:function(){return this._set.size}}]);return q}(c);a.EventedSet=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){const r=y.getLogger("esri.views.layers.FeatureLayerView");return x=>{x=function(D){function A(...B){B=D.call(this,...B)||this;B._updatingRequiredFieldsPromise=null;B.filter=null;B.timeExtent=null;B.layer=null;B.requiredFields=[];B.view=null;return B}a._inherits(A,D);var v=A.prototype;v.initialize=function(){this.handles.add([u.watch(()=>{const B=this.layer;return[B?.elevationInfo?.featureExpressionInfo,B&&"displayField"in B?B.displayField:null,B&&"timeInfo"in
B&&B.timeInfo,B&&"renderer"in B&&B.renderer,B&&"labelingInfo"in B&&B.labelingInfo,B&&"floorInfo"in B&&B.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),u.syncAndInitial),u.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),u.on(()=>{const B=this.layer;return B&&"sublayers"in B?B.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])};v.highlight=function(B){throw Error("missing implementation");};v.createQuery=function(){var B=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};B=null!=this.filter?this.filter.createQuery(B):new m(B);if("feature"===this.layer.type){const C=l.getFloorFilterClause(this);null!=C&&(B.where=B.where?`(${B.where}) AND (${C})`:C)}null!=this.timeExtent&&(B.timeExtent=null!=B.timeExtent?B.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return B};v.createAggregateQuery=function(){return new m({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})};
v.queryFeatures=function(B,C){throw Error("missing implementation");};v.queryObjectIds=function(B,C){throw Error("missing implementation");};v.queryFeatureCount=function(B,C){throw Error("missing implementation");};v.queryExtent=function(B,C){throw Error("missing implementation");};v.fetchPopupFeatures=async function(B,C){if(B=this.validateFetchPopupFeatures(C))throw B;return this.fetchClientPopupFeatures(C)};v._loadArcadeModules=function(B){return B.get("expressionInfos.length")||Array.isArray(B.content)&&
B.content.some(C=>"expression"===C.type)?t.loadArcade():Promise.resolve()};v._handleRequiredFieldsChange=function(){const B=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",B);B.then(()=>{this._updatingRequiredFieldsPromise===B&&this._set("_updatingRequiredFieldsPromise",null)})};v._updateRequiredFields=async function(){if(this.layer&&this.view){var B="3d"===this.view.type,{layer:C,layer:{fieldsIndex:E,objectIdField:F}}=this,M="renderer"in C&&C.renderer,K="orderBy"in C&&C.orderBy,
G="featureReduction"in C?C.featureReduction:null,L=new Set;M=await p.eachAlways([M?M.collectRequiredFields(L,E):null,n.collectLabelingFields(L,C),B?n.collectElevationFields(L,C):null,null!=this.filter?n.collectFilterFields(L,C,this.filter):null,null!=this.featureEffect?n.collectFilterFields(L,C,this.featureEffect.filter):null,G?n.collectFeatureReductionFields(L,C,G):null,K?n.collectOrderByInfos(L,C,K):null]);"timeInfo"in C&&C.timeInfo&&this.timeExtent&&n.collectFields(L,C.fieldsIndex,[C.timeInfo.startField,
C.timeInfo.endField]);"feature"===C.type&&(C.floorInfo&&n.collectFields(L,C.fieldsIndex,[C.floorInfo.floorField]),B&&null!=C.infoFor3D&&(null==C.globalIdField&&r.error("globalIdField missing on 3DObjectFeatureLayer"),n.collectFields(L,C.fieldsIndex,[C.globalIdField])));"subtype-group"===C.type&&(n.collectField(L,E,C.subtypeField),K=C.sublayers.map(O=>Promise.all([O.renderer?.collectRequiredFields(L,E),n.collectLabelingFields(L,O)])),await p.eachAlways(K));for(const O of M)O.error&&r.error(O.error);
n.collectField(L,E,F);B&&"displayField"in C&&C.displayField&&n.collectField(L,E,C.displayField);B=Array.from(L).sort();this._set("requiredFields",B)}};v.validateFetchPopupFeatures=function(B){if(null==B)return null;for(const C of B.clientGraphics??[]){const E=C.layer;if("popupEnabled"in E&&!E.popupEnabled)return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:E});if(C.isAggregate){const F="featureReduction"in E?E.featureReduction:null;if(!(F&&"popupTemplate"in F&&F.popupEnabled&&
F.popupTemplate))return new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:E})}else if("popupTemplate"in E&&!w.getFetchPopupTemplate(E,B))return new c("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:E})}};v.fetchClientPopupFeatures=async function(B){const C=null!=B?B.clientGraphics:null;if(!C||0===C.length)return[];const E=Array(C.length),F=new Map,M=await this.createPopupQuery(B);for(let G=0;G<C.length;G++){const L=C[G];if(L.isAggregate){E[G]=
L;continue}var K=L.layer;if(!("popupEnabled"in K))continue;const O=n.unpackFieldNames(this.layer.fieldsIndex,M.outFields);K=w.getFetchPopupTemplate(K,B);if(null==K)continue;const I=await this._loadArcadeModules(K);I&&I.arcadeUtils.hasGeometryOperations(K)||!n.featureHasFields(O,L)?F.set(L.getObjectId(),{graphic:L,index:G}):E[G]=L}if("stream"===this.layer.type||0===F.size)return E.filter(Boolean);M.objectIds=Array.from(F.keys());try{const G=await this.layer.queryFeatures(M);for(const L of G.features){const {graphic:{geometry:O},
index:I}=F.get(L.getObjectId());L.geometry||(L.geometry=O);E[I]=L}}catch{}return E.filter(Boolean)};v.createPopupQuery=async function(B){const C=this.layer.createQuery(),E=new Set;var F=!1,M=null!=B&&B.clientGraphics?B.clientGraphics.map(K=>K.layer):[this.layer];for(const K of M)if("popupEnabled"in K&&(M=w.getFetchPopupTemplate(K,B),null!=M)){F=(F=await this._loadArcadeModules(M))&&F.arcadeUtils.hasGeometryOperations(M);F=!("point"!==this.layer.geometryType&&!F);M=await w.getRequiredFields(this.layer,
M);for(const G of M)E.add(G)}C.returnGeometry=F;C.returnZ=F;C.returnM=F;C.outFields=Array.from(E);C.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(B=l.getFloorFilterClause(this),null!=B&&(C.where=C.where?`(${C.where}) AND (${B})`:B));return C};v.canResume=function(){return!a._get(a._getPrototypeOf(A.prototype),"canResume",this).call(this)||null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0};a._createClass(A,[{key:"availableFields",get:function(){const {layer:B,layer:{fieldsIndex:C},
requiredFields:E}=this;return"outFields"in B&&B.outFields?n.fixFields(C,[...n.unpackFieldNames(C,B.outFields),...E]):n.fixFields(C,E)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(B){this._override("featureEffect",B)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(B){r.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",
get:function(){return!1}}]);return A}(x);b.__decorate([q.property()],x.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([q.property({readOnly:!0})],x.prototype,"availableFields",null);b.__decorate([q.property({type:h})],x.prototype,"featureEffect",null);b.__decorate([q.property({type:z})],x.prototype,"filter",void 0);b.__decorate([q.property(e.combinedViewLayerTimeExtentProperty)],x.prototype,"timeExtent",void 0);b.__decorate([q.property()],x.prototype,"layer",void 0);b.__decorate([q.property({type:Number})],
x.prototype,"maximumNumberOfFeatures",null);b.__decorate([q.property({readOnly:!0,type:Boolean})],x.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([q.property({readOnly:!0})],x.prototype,"requiredFields",void 0);b.__decorate([q.property()],x.prototype,"suspended",void 0);b.__decorate([q.property()],x.prototype,"view",void 0);return x=b.__decorate([g.subclass("esri.views.layers.FeatureLayerView")],x)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f){return g=>{g=function(e){function h(){return e.apply(this,arguments)||this}a._inherits(h,e);h.prototype.initialize=function(){this.handles.add(p.on(()=>this.layer,"refresh",z=>{this.doRefresh(z.dataChanged).catch(n=>{y.isAbortError(n)||c.getLogger(this).error(n)})}),"RefreshableLayerView")};return a._createClass(h)}(g);b.__decorate([u.property()],g.prototype,"layer",void 0);return g=b.__decorate([f.subclass("esri.layers.mixins.RefreshableLayerView")],g)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../core/has ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea){function ja(oa){return ma=>oa.immediate.schedule(ma)}const ha=x.create();z=function(oa){function ma(){var ba=oa.apply(this,arguments)||this;ba.type="point-cloud-3d";ba.maximumPointCount=4E6;ba.slicePlaneEnabled=!1;ba._renderer=null;ba._rendererAdded=!1;ba._renderedNodes=new Set;ba._nodeScales=new Map;ba._updateViewNeeded=!0;ba._lodFactor=1;ba._maxLoggedBoxWarnings=5;ba._pageMultiplier=1;ba._nodeLoadEpoch=
0;ba._indexQueue=[];ba._workQueue=[];ba._idleQueue=new K.PromiseQueue;ba._indexPagesLoading=new Map;ba._loadingNodes=new Map;ba._recalcWork=!0;ba._layerIsVisible=!1;ba._codedDomainPopulationPromise=null;ba._codedDomainPopulationAbortController=null;ba._totalWork=0;ba._index=null;ba._loadingInitNodePage=!1;ba._nodeIdArray=[];ba.ignoresMemoryFactor=!1;return ba}a._inherits(ma,oa);var fa=ma.prototype;fa.initialize=function(){const ba=this.view.resourceController;var aa=ja(ba);this._worker=new O.PointCloudWorkerHandle(aa);
this.addResolvingPromise(this._worker.promise);this._tmpPoint=D.makeDehydratedPoint(0,0,0,this.layer.spatialReference);I.checkPointCloudLayerValid(this.layer);I.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=ba.createStreamDataRequester(S.ClientType.I3S_INDEX);this._dataRequester=ba.createStreamDataRequester(S.ClientType.I3S_DATA);this._initRenderer();aa=this._initNodePages();const da=this.view.resourceController.memoryController;this._memCache=da.newCache(`pcl-${this.layer.uid}`);
this.updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),d.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),d.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),d.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),d.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),d.initial);this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());
this.updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",ca=>this._scaleUpdateHandler(ca)),d.watch(()=>da.memoryFactor,()=>this._setUpdateViewNeeded(),d.sync)]);this.addResolvingPromise(aa);this.when(()=>{this.handles.add([ba.scheduler.registerTask(ea.TaskPriority.POINT_CLOUD_LAYER,this),ba.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,
ca=>{ca?this._clearNodeState():this._setUpdateViewNeeded()},d.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};fa._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};fa.destroy=function(){this.cancelLoading();this._worker=q.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=q.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=q.abortMaybe(this._codedDomainPopulationAbortController);this._codedDomainPopulationPromise=
null};fa._initRenderer=function(){this._renderer=new T.PointRenderer({createGraphic:(ba,aa,da)=>this._createGraphic(ba,aa,da)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,ba=>this._renderer.clippingBox=ba,d.initial);this.updatingHandles.add(()=>this.suspended,ba=>this._setPointsVisible(!ba),d.initial);this.updatingHandles.add(()=>this.pointScale,ba=>this._renderer.scaleFactor=ba,d.initial);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(()=>
this.useRealWorldSymbolSizes,ba=>this._renderer.useRealWorldSymbolSizes=ba,d.initial);this.updatingHandles.add(()=>this.pointSize,ba=>{const aa=f.pt2px(ba);this._renderer.size=ba;this._renderer.sizePx=aa},d.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,ba=>this._renderer.slicePlaneEnabled=ba,d.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),d.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),d.initial);
this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,ba=>{this._lodFactor=ba;this._setUpdateViewNeeded()},d.initial)};fa._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};fa._createGraphic=function(ba,aa,da){const ca=null!=ba.pointIdFilterMap?ba.pointIdFilterMap[aa]:aa;da=this.view.computeMapPointFromVec3d(da);const na=this._createGraphicAttributes(ba,ca);return new W.PointGraphic({pointCloudMetadata:{nodeId:ba.id,pointIndexInNode:aa,
attributePointIndexInNode:ca,epoch:this._nodeLoadEpoch},geometry:da,attributes:na,layer:this.layer,sourceLayer:this.layer})};fa._createGraphicAttributes=function(ba,aa){const da={};for(const ca of ba.attributes)this._encodeGraphicAttribute(ca.attributeInfo,ca.values,aa,da);return da};fa._encodeGraphicAttribute=function(ba,aa,da,ca){var na=ba.storageInfo?.attributeValues;const qa=na?.valuesPerElement??1;if(1===qa)ca[ba.name]=aa[da];else if("UInt8"===na?.valueType&&4>=qa){na=0;da*=qa;for(let ua=da;ua<
da+qa;ua++)na=(na<<8)+aa[ua];ca[ba.name]=na}else ca[ba.name]=void 0};fa._setPointsVisible=function(ba){ba&&!this._rendererAdded?(this.view._stage.addRenderPlugin([X.RenderSlot.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!ba&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};fa._rendererChanged=function(){this._renderer.useFixedSizes=N.rendererUsesFixedSizes(this.layer.renderer);this._reload()};fa._reload=function(){this._clearNodeState();
this._memCache.clear();this._setUpdateViewNeeded()};fa._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};fa._scaleUpdateHandler=function(ba){const aa=this.layer.effectiveScaleRange;Z.isScaleRangeActive(aa.minScale,aa.maxScale)?t.projectBoundingRect(ba.extent,ba.spatialReference,ia,this.layer.spatialReference)&&(this._nodeScales.forEach((da,ca)=>{this._renderedNodes.has(ca)?(da=this._index.getNode(ca),r.containsPoint(ia,da.obb.center)&&this._nodeScales.set(ca,
ba.scale)):this._nodeScales.delete(ca)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};fa._displayNodes=function(ba){this._workQueue=H.nodeDiff([...this._renderedNodes],ba,this._index);H.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);H.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<ba.length||this._loadingInitNodePage;this.notifyChange("suspended")};
fa.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};fa._cancelNodeLoading=function(){const ba=[];this._loadingNodes.forEach(({abortController:aa})=>ba.push(aa));this._loadingNodes.clear();for(const aa of ba)aa.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};fa._updateQueues=function(){const ba=new Set;this._workQueue.forEach(ca=>ca.load.forEach(na=>ba.add(na)));const aa=[],da=new Map;this._loadingNodes.forEach((ca,
na)=>{ba.has(na)?da.set(na,ca):aa.push(ca)});this._loadingNodes=da;for(const {abortController:ca}of aa)ca.abort();this._workQueue=this._workQueue.filter(ca=>{for(const na of ca.load)if(this._loadingNodes.has(na))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};fa._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:ba})=>ba.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();
this._updateLoading()};fa._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(ba=>this._removeFromRenderer(ba));this._cancelNodeLoading()};fa._idleBegin=function(){this._setUpdateViewNeeded()};fa._idleEnd=function(){this._setUpdateViewNeeded()};fa.runTask=function(ba){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,ba=this._isRootNodeVisible(),ba!==this._layerIsVisible&&(this._layerIsVisible=ba,this.notifyChange("suspended")),this._updateLoading());else{for(ba.run(()=>
this._updateWorkQueues());0<this._indexQueue.length&&ba.run(()=>this._processIndexQueue()););this._processWorkQueue(ba);this._idleQueue.runTask(ba)}};fa._processIndexQueue=function(){const ba=this._indexQueue.shift(),aa=this._loadNodePage(ba);this._indexPagesLoading.set(ba,aa);aa.promise.then(da=>{this._index.addPage(ba,da,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(ba)},()=>{this._indexPagesLoading.delete(ba)});return!0};fa._processWorkQueue=function(ba){for(;!ba.done;){const aa=
this._scheduleWorkEntry();if(null==aa)break;this._processWorkEntry(aa);ba.madeProgress()}};fa._scheduleWorkEntry=function(){let ba=this._workQueue.length;for(;ba--;){const aa=this._workQueue.shift();if(aa.remove.find(da=>!this._renderedNodes.has(da)))this._workQueue.push(aa);else return aa}return null};fa._processWorkEntry=function(ba){if(0===ba.load.length)for(const aa of ba.remove)this._removeFromRenderer(aa);else Promise.all(ba.load.map(aa=>{const da=new AbortController,ca=this._memCache.pop(aa.toString());
null!=ca?this._loadingNodes.set(aa,{abortController:da,promise:Promise.resolve(ca)}):this._loadingNodes.has(aa)||this._loadingNodes.set(aa,{abortController:da,promise:this._loadNode(aa,da.signal)});return this._loadingNodes.get(aa).promise})).then(aa=>{for(let da=0;da<ba.load.length;da++)if(aa[da]){const ca=this._setupRendererData(ba.load[da],aa[da]);this._addToRenderer(ca)}for(const da of ba.remove)this._removeFromRenderer(da)}).catch(()=>{}).then(()=>{for(const aa of ba.load)this._loadingNodes.delete(aa);
this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};fa._populateClassCodeCodedDomain=async function(ba,aa){const da=this.layer.fieldsIndex.get("CLASS_CODE");da&&!da.domain&&ba.includes(da.name)&&(ba=await y.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:aa})),!1!==ba.ok&&(ba=ba.value?.stats?.labels?.labels)&&Array.isArray(ba)&&(da.domain=
new B({name:"CLASS_CODE",codedValues:ba.map(ca=>new A.CodedValue({code:ca.value,name:ca.label}))})))};fa.prepareFetchPopupFeatures=async function(ba){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(ba,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise};fa.whenGraphicAttributes=
async function(ba,aa){const da=this._splitGraphicsPerNode(ba),ca=this.layer.attributeStorageInfo,na=aa.map(sa=>N.getAttributeInfo(ca,sa)).filter(c.isSome),qa=async(sa,pa)=>{const ka=this._index.getNode(pa);await y.forEach(na,async ra=>{const va=ra.useElevation?await this._loadElevationAttributeFromGeometry(ka.resourceId):await this._loadAndParseAttribute(ka,ra);if(va)for(const Ca of sa)this._isValidPointGraphic(Ca)&&this._encodeGraphicAttribute(ra,va,Ca.pointCloudMetadata.attributePointIndexInNode,
Ca.attributes)})},ua=[];da.forEach((sa,pa)=>{ua.push(qa(sa,pa))});await k.eachAlways(ua);return ba};fa._isValidPointGraphic=function(ba){return ba instanceof W.PointGraphic&&ba.pointCloudMetadata?.epoch===this._nodeLoadEpoch};fa._splitGraphicsPerNode=function(ba){const aa=new Map;for(const da of ba){if(!this._isValidPointGraphic(da))continue;ba=da.pointCloudMetadata;const ca=aa.get(ba.nodeId);ca?ca.push(da):aa.set(ba.nodeId,[da])}return aa};fa._loadAndParseAttribute=async function(ba,aa){const da=
await this._loadAttribute(ba.resourceId,aa,null);return null!=da?R.getAttributeValues({attributeInfo:aa,buffer:da},null,ba.vertexCount):null};fa._loadElevationAttributeFromGeometry=async function(ba){ba=R.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(ba,null));return R.elevationFromPositions(ba,ba.length/3)};fa.highlight=function(ba){if(!ba)return{remove(){}};ba=p.isCollection(ba)?ba.toArray():Array.isArray(ba)?ba:[ba];return this._renderer.highlight(ba.map(aa=>this._graphicToPointDefinition(aa)))};
fa._graphicToPointDefinition=function(ba){if(!this._isValidPointGraphic(ba))return null;const {nodeId:aa,pointIndexInNode:da}=ba.pointCloudMetadata;return null!=aa&&null!=da?{nodeId:aa,pointId:da}:null};fa._computeWork=function(){let ba=0;for(const aa of this._workQueue)ba+=aa.load.length+aa.remove.length;ba+=this._loadingNodes.size;ba+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;ba+=this._loadingInitNodePage?100:0;return ba+=this._updateViewNeeded?100:0};fa._updateLoading=
function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};fa.canResume=function(){return a._get(a._getPrototypeOf(ma.prototype),"canResume",this).call(this)&&this._layerIsVisible};fa.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};fa._initNodePages=function(){const ba=this.layer.store.index;this._index=new J(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,ba.nodesPerPage||ba.nodePerIndexBlock);this._cancelIndexLoading();
this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=ba.nodesPerPage?1:ba.nodePerIndexBlock;return this._loadNodePage(0).promise.then(aa=>{this._index.addPage(0,aa,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};fa._loadNodePage=function(ba){const aa=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${ba*
this._pageMultiplier}`,aa.signal).then(da=>da.nodes.map((ca,na)=>({resourceId:null!=ca.resourceId?ca.resourceId:ba*this._index.pageSize+na,obb:ca.obb,firstChild:ca.firstChild,childCount:ca.childCount,vertexCount:ca.vertexCount??ca.pointCount,lodThreshold:ca.lodThreshold??ca.effectiveArea}))),abortController:aa}};fa._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let ba=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const aa=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();
let da=this._computeNodesForMinimumDensity(ba),ca=this._computePointCount(da),na=Math.sqrt(ca/(.75*aa));for(;ca>aa;)ba*=na,da=this._computeNodesForMinimumDensity(ba),ca=this._computePointCount(da),na=Math.sqrt(2);this._displayNodes(da);this._updateViewNeeded=!1;this._updateLoading();return!0};fa._computePointCount=function(ba){let aa=0;for(let da=0;da<ba.length;da++){const ca=this._index.getNode(ba[da]);ca&&(aa+=ca.vertexCount)}return aa};fa._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};
fa._isRootNodeVisible=function(){let ba=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(aa,da,ca)=>{ba=ca;return!1},pageMiss:()=>{}});return ba};fa._computeNodesForMinimumDensity=function(ba){const aa=this.view.state.contentCamera,da=aa.frustum,ca=this._clippingBox,na=aa.viewForward,qa=l.dot(na,aa.eye),ua=x.fromNormalAndOffset(na,-qa,ha),sa=aa.perScreenPixelRatio/2,pa=ba*ba,ka=this._nodeIdArray;ka.length=0;const {minScale:ra,maxScale:va}=
Z.extractSafeScaleBounds(this.layer),Ca=0===ra&&0===va?Ba=>ka.push(Ba):Ba=>{const Ha=this._getScale(Ba);Z.scaleBoundsPredicate(Ha,ra,va)&&ka.push(Ba)};this._traverseVisible({frustum:da,clippingBox:ca},{predicate:(Ba,Ha,Ma)=>{if(!Ma)return!1;if(0===Ha.childCount)return Ca(Ba),!1;Ma=this._index.getRenderObb(Ba);return this._computeAveragePixelArea(Ma,Ha.lodThreshold,Ha.vertexCount,ua,sa)<=pa?(Ca(Ba),!1):!0},pageMiss:(Ba,Ha)=>{Ca(Ba);this._indexQueue.includes(Ha)||this._indexQueue.push(Ha)}});return ka};
fa._getScale=function(ba){var aa=this._nodeScales.get(ba);null==aa&&(aa=this._index.getNode(ba).obb.center,this._tmpPoint.x=aa[0],this._tmpPoint.y=aa[1],this._tmpPoint.z=aa[2],aa=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(ba,aa));return aa};fa._computeAveragePixelArea=function(ba,aa,da,ca,na){ba=Math.max(1E-7,U.minimumDistancePlane(ba,ca));return aa/(ba*ba)/(4*na*na)/da};fa._loadNode=function(ba,aa){try{return this._loadNodeAsync(ba,aa)}catch(da){throw k.isAbortError(da)||
u.getLogger(this).error(da),da;}};fa._loadAdditionalUserAttributes=async function(ba,aa,da){var ca=this.layer.outFields;if(!ca)return[];ca=M.unpackFieldNames(this.layer.fieldsIndex,ca);ba=new Set(ba.map(ua=>null!=ua?ua.name:null));const na=this.layer.attributeStorageInfo,qa=[];for(const ua of ca)ba.has(ua)||(ca=N.getAttributeInfo(na,ua))&&qa.push(aa(ca));aa=await k.eachAlwaysValues(qa);k.throwIfAborted(da);return aa.filter(c.isSome)};fa._loadNodeAsync=async function(ba,aa){const da=this._index.getNode(ba),
ca=N.getRendererInfo(this.layer),na=N.getFilterInfo(this.layer),qa=da.resourceId,ua=async sa=>{if(!sa)return null;if(sa.useElevation)return{attributeInfo:sa,buffer:null};const pa=await this._loadAttribute(qa,sa,aa);return null!=pa?{attributeInfo:sa,buffer:pa}:null};return this._idleQueue.push(async()=>{var sa=this._loadGeometry(qa,aa);const {primaryAttribute:pa,modulationAttribute:ka}=ca,ra=ua(pa),va=ua(ka);var Ca=na.map(Ua=>Ua.attributeInfo);const Ba=Ca.map(Ua=>ua(Ua));Ca=this._loadAdditionalUserAttributes([pa,
ka,...Ca],ua,aa);const [Ha,Ma,Qa,Sa,La]=await Promise.all([sa,ra,va,Promise.all(Ba),Ca]);k.throwIfAborted(aa);sa={geometryBuffer:Ha,primaryAttributeData:Ma,modulationAttributeData:Qa,filterAttributesData:Sa,userAttributesData:La,schema:this.layer.store.defaultGeometrySchema,rendererInfo:ca,filterInfo:na,obb:this._index.getRenderObb(ba),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(sa,
aa)},aa)};fa._loadGeometry=async function(ba,aa){return this._requestData(`${this.baseUrl}/nodes/${ba}/geometries/0`,aa)};fa._loadAttribute=async function(ba,aa,da){return null!=aa&&aa.storageInfo?this._requestData(`${this.baseUrl}/nodes/${ba}/attributes/${aa.storageInfo.key}`,da):null};fa._requestNodePage=function(ba,aa){return this._indexRequester.request(ba,"json",{query:{f:"json",token:this.layer.apiKey},signal:aa})};fa._requestData=function(ba,aa){return this._dataRequester.request(ba,"binary",
{query:{token:this.layer.apiKey},signal:aa})};fa._removeFromRenderer=function(ba){if(this._renderedNodes.has(ba)){const aa=this._renderer.removeNode(ba);this._renderedNodes.delete(ba);this._nodeScales.delete(ba);this._memCache.put(aa.id.toString(),aa,5*aa.coordinates.length+128)}};fa._addToRenderer=function(ba){this._renderedNodes.has(ba.id)||(this._renderedNodes.add(ba.id),this._renderer.addNode(ba))};fa._setupRendererData=function(ba,aa){const da=this._index.getNode(ba),ca=Math.sqrt(da.lodThreshold/
da.vertexCount),na=this._index.getRenderObb(ba);if(T.isInstanceOfNode(aa))return aa.splatSize=ca,aa.obb=na,l.copy(aa.origin,aa.obb.center),aa;var qa=.01*Math.max(na.halfSize[0],na.halfSize[1],na.halfSize[2]);if(aa.obb.halfSize[0]>na.halfSize[0]+qa||aa.obb.halfSize[1]>na.halfSize[1]+qa||aa.obb.halfSize[2]>na.halfSize[2]+qa)0<this._maxLoggedBoxWarnings&&(qa=ua=>`[${ua.halfSize[0]}, ${ua.halfSize[1]}, ${ua.halfSize[2]}]`,u.getLogger(this).warn(`Node ${ba} reported bounding box too small. got ${qa(na)} but points cover ${qa(aa.obb)}`),
0===--this._maxLoggedBoxWarnings&&u.getLogger(this).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(ba,aa.obb);return new T.PointRendererNode(ba,ca,m.clone(na.center),na,0===da.childCount,aa.points,aa.rgb,aa.attributes,aa.pointIdFilterMap)};a._createClass(ma,[{key:"baseUrl",get:function(){return this.layer.parsedUrl.path}},{key:"pointScale",get:function(){const ba=N.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return ba&&null!=ba.scaleFactor?
ba.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const ba=N.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return ba&&null!=ba.useRealWorldSymbolSizes?ba.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const ba=N.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return ba&&null!=ba.size?ba.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var ba=
N.getRendererInfo(this.layer);const aa=new Set;ba.primaryAttribute&&aa.add(ba.primaryAttribute.name);ba.modulationAttribute&&aa.add(ba.modulationAttribute.name);if(ba=N.getFilterInfo(this.layer))for(const da of ba)da.attributeInfo&&aa.add(da.attributeInfo.name);if(this.layer.outFields)for(const da of M.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))aa.add(da);return Array.from(aa)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const ba=w.create();
return Q.projectToBoundingBox(this.view.clippingArea,ba,this.view.renderSpatialReference)?ba:null}},{key:"_elevationOffset",get:function(){const ba=this.layer&&this.layer.elevationInfo;if(ba&&"absolute-height"===ba.mode){const aa=e.getMetersPerVerticalUnitForSR(this.layer.spatialReference),da=G.getMetersPerUnit(ba.unit);return(ba.offset??0)*da/aa}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||
this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const ba=this._computeWork();return 1-Math.min(this._totalWork,ba)/this._totalWork}},{key:"usedMemory",get:function(){let ba=0;this._renderer.forEachNode(aa=>{ba+=160;ba+=g.estimateSize(aa.coordinates);for(const da of aa.attributes)aa=da.values,g.isArrayBuffer(aa.buffer)&&(ba+=g.estimateSize(aa))});return ba}},{key:"unloadedMemory",get:function(){const ba=this._renderedNodes.size;
if(4>ba)return 0;const aa=[...this._renderedNodes].reduce((ca,na)=>ca+this._index.getNode(na).vertexCount);let da=this._loadingNodes.size;for(let ca=0;ca<this._workQueue.length;ca++)da+=this._workQueue[ca].load.length,da-=this._workQueue[ca].remove.length;return 0>da?0:da*aa/ba*((this.usedMemory-160*ba)/aa)+160*da}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((ba,aa)=>ba+this._index.getNode(aa).vertexCount,0),
maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ma}(P.PopupSceneLayerView(L.LayerView3D(Y)));b.__decorate([h.property()],z.prototype,"layer",void 0);b.__decorate([h.property()],z.prototype,"baseUrl",null);b.__decorate([h.property()],
z.prototype,"pointScale",null);b.__decorate([h.property()],z.prototype,"useRealWorldSymbolSizes",null);b.__decorate([h.property()],z.prototype,"pointSize",null);b.__decorate([h.property()],z.prototype,"inverseDensity",null);b.__decorate([h.property()],z.prototype,"maximumPointCount",void 0);b.__decorate([h.property({readOnly:!0})],z.prototype,"availableFields",null);b.__decorate([h.property({readOnly:!0})],z.prototype,"_clippingBox",null);b.__decorate([h.property({readOnly:!0})],z.prototype,"_elevationOffset",
null);b.__decorate([h.property({type:Boolean})],z.prototype,"slicePlaneEnabled",void 0);b.__decorate([h.property()],z.prototype,"updating",void 0);b.__decorate([h.property(V.updatingProgress)],z.prototype,"updatingProgress",void 0);b.__decorate([h.property({readOnly:!0})],z.prototype,"updatingProgressValue",null);b=z=b.__decorate([n.subclass("esri.views.3d.layers.PointCloudLayerView3D")],z);const ia=r.create();return b})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(y){function p(u){var q;return q=y.call(this,"PointCloudWorker","transform",{transform:k=>q._getTransferList(k)},u)||this}b._inherits(p,y);p.prototype._getTransferList=function(u){const q=[u.geometryBuffer];null!=u.primaryAttributeData&&u.primaryAttributeData.buffer&&q.push(u.primaryAttributeData.buffer);null!=u.modulationAttributeData&&u.modulationAttributeData.buffer&&q.push(u.modulationAttributeData.buffer);
if(null!=u.filterAttributesData)for(const k of u.filterAttributesData)null!=k&&k.buffer&&q.push(k.buffer);for(const k of u.userAttributesData)k.buffer&&q.push(k.buffer);return q};return b._createClass(p)}(c.WorkerHandle);a.PointCloudWorkerHandle=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,b){function c(d,f,g){for(;0<d;){const e=f.indexOf(d);if(0<=e)return e;d=g.getParentId(d)}return f.indexOf(d)}
function y(d,f,g){const e=[f.remove[0]],h=[];for(;1===e.length;){const n=e.pop();h.length=0;for(let l=0;l<f.load.length;l++){let m=f.load[l];for(var z=g.getParentId(m);z!==n;)m=z,z=g.getParentId(m);z=e.indexOf(m);0>z&&(z=e.length,e.push(m),h.push([]));h[z].push(f.load[l])}}f.load=e;for(f=0;f<e.length;f++)1<h[f].length?d.push({remove:[e[f]],load:h[f]}):e[f]=h[f][0]}const p=[!1],u=[null],q=[!1],k=[null];a.nodeDiff=function(d,f,g){for(var e=0;e<f.length;e++)q[e]=!1,k[e]=null;for(e=0;e<d.length;e++)p[e]=
!1,u[e]=null;for(e=0;e<f.length;e++){var h=c(f[e],d,g);0<=h&&(q[e]=!0,null!=u[h]?u[h].push(f[e]):u[h]=[f[e]])}for(e=0;e<d.length;e++)h=c(d[e],f,g),0<=h&&(p[e]=!0,null!=k[h]?k[h].push(d[e]):k[h]=[d[e]]);g=[];for(e=0;e<d.length;e++)null!=u[e]||p[e]||g.push({load:[],remove:[d[e]]});for(e=0;e<f.length;e++)null!=k[e]||q[e]||g.push({load:[f[e]],remove:[]});for(e=0;e<f.length;e++)null!=k[e]&&(1<k[e].length||k[e][0]!==f[e])&&g.push({load:[f[e]],remove:k[e]});for(f=0;f<d.length;f++)null!=u[f]&&(1<u[f].length||
u[f][0]!==d[f])&&g.push({load:u[f],remove:[d[f]]});return g};a.sortFrontToBack=function(d,f,g){return d.sort((e,h)=>{if(0===e.load.length&&0===h.load.length)return 0;if(0===e.load.length)return-1;if(0===h.load.length)return 1;if(0===e.remove.length&&0===h.remove.length)return e=g.getRenderCenter(e.load[0]),h=g.getRenderCenter(h.load[0]),b.dot(e,f)-b.dot(h,f);if(0===e.remove.length)return-1;if(0===h.remove.length)return 1;if(1===e.load.length&&1===h.load.length)return e=g.getRenderCenter(e.load[0]),
h=g.getRenderCenter(h.load[0]),b.dot(e,f)-b.dot(h,f);if(1===e.load.length)return-1;if(1===h.load.length)return 1;e=g.getRenderCenter(e.remove[0]);h=g.getRenderCenter(h.remove[0]);return b.dot(e,f)-b.dot(h,f)})};a.splitWorkEntries=function(d,f,g){for(let e=0;e<d.length;++e){const h=d[e];h.load.length>f&&1===h.remove.length&&y(d,h,g)}};a.splitWorkEntry=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,c,y){return function(){function p(q,k,d){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=q;this._renderSR=k;this.pageSize=d}var u=p.prototype;u.addPage=function(q,k,d=0){for(;this._pages.length<q;)this._pages.push(null);var f=this._nodeSR,g=this._renderSR,e=new y.ObbArray(k.length);for(var h=0;h<k.length;h++)c.transformObb(k[h].obb,f,e.obbs[h],g,d);this._pages[q]=
{nodes:k,renderObbs:e.obbs,parents:new Uint32Array(this.pageSize)};q=this._pages;k=this.pageSize;for(d=[0];d.length;)for(f=d.pop(),g=q[f/k|0].nodes[f%k],e=0;e<g.childCount;e++)h=g.firstChild+e,null!=q[h/k|0]&&(q[h/k|0].parents[h%k]=f,d.push(h))};u.hasPage=function(q){return!!this._pages[q]};u.getNode=function(q){const k=this.pageSize;return this._pages[q/k|0].nodes[q%k]};u.getRenderObb=function(q){const k=this.pageSize;return this._pages[q/k|0].renderObbs[q%k]};u.getRenderCenter=function(q){return this.getRenderObb(q).center};
u.setRenderObb=function(q,k){const d=this.pageSize;y.set(k,this._pages[q/d|0].renderObbs[q%d])};u.getParentId=function(q){const k=this.pageSize;return this._pages[q/k|0].parents[q%k]};u.hasNodes=function(q,k){var d=q/this.pageSize|0;for(q=(q+k-1)/this.pageSize|0;d<=q;d++)if(null==this._pages[d])return!1;return!0};u.forEachNodeId=function(q){for(let k=0;k<this._pages.length;k++){const d=this._pages[k];if(d)for(let f=0;f<d.nodes.length;f++)q(k*this.pageSize+f)}};u.createVisibilityTraverse=function(){var q=
this,k=[],d=[],f=b.create();return(g,e)=>{if(q.hasNodes(0,1))for(k.length=0,k.push(0),d.length=0,d.push(0);0<k.length;){var h=k.pop();let w=d.pop();var z=q.getNode(h),n=q.getRenderObb(h),l=!0;if(null!=g.clippingBox){var m=1<<g.frustum.length;if(0===(w&m)){var t=y.toAaBoundingBox(n,f);b.contains(g.clippingBox,t)?w|=m:b.intersects(g.clippingBox,t)||(l=!1)}}for(m=0;m<g.frustum.length&&l;m++)if(t=1<<m,0===(w&t)){const r=y.intersectPlane(n,g.frustum[m]);0<r?l=!1:0>r&&(w|=t)}if(e.predicate(h,z,l)){n=z.firstChild;
z=z.childCount;l=!1;t=n/q.pageSize|0;for(m=(n+z-1)/q.pageSize|0;t<=m;t++)if(!q.hasPage(t)){e.pageMiss(h,t);l=!0;break}if(!l)for(h=0;h<z;h++)k.push(n+h),d.push(w)}}}};return a._createClass(p)}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(y,p){for(const u of y??[])if(u.name===p&&null!=u.attributeValues&&"UInt8"===u.attributeValues.valueType&&3===u.attributeValues.valuesPerElement)return{name:p,storageInfo:u,useElevation:!1};return null}
function c(y,p){for(const u of y??[])if(u.name===p)return(y="embedded-elevation"===u.encoding)?{name:p,storageInfo:null,useElevation:y}:{name:p,storageInfo:u,useElevation:y};return"elevation"===p?.toLowerCase()?{name:p,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=c;a.getFilterInfo=function(y){const p=y.filters;return p?p.map(u=>({filterJSON:u.toJSON(),attributeInfo:c(y.attributeStorageInfo,u.field)})):[]};a.getFixedSizeAlgorithm=function(y){return(y=y?.pointSizeAlgorithm)&&"fixed-size"===
y.type?y:null};a.getRendererInfo=function(y){const p=y.renderer;var u=p?.type;const q=p?.toJSON()??null;let k=null,d=!1;y=y.attributeStorageInfo;"point-cloud-unique-value"===u?k=c(y,p.field):"point-cloud-stretch"===u?k=c(y,p.field):"point-cloud-class-breaks"===u?k=c(y,p.field):(k="point-cloud-rgb"===u?b(y,p.field):b(y,"RGB"),d=null!=k);u=null;p?.colorModulation&&(u=c(y,p.colorModulation.field));return{rendererJSON:q,isRGBRenderer:d,primaryAttribute:k,modulationAttribute:u}};a.getSplatSizeAlgorithm=
function(y){return(y=y?.pointSizeAlgorithm)&&"splat"===y.type?y:null};a.rendererUsesFixedSizes=function(y){return(y=y?.pointSizeAlgorithm)&&y.type?"fixed-size"===y.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/has ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,c,y,p,u,q){function k(g,e){const h=new Float64Array(e);for(let z=0;z<e;z++)h[z]=g[3*z+2];return h}function d(g){switch(g){default:case null:case "none":return e=>e;case "low-four-bit":return e=>e&15;case "high-four-bit":return e=>(e&240)>>4;case "absolute-value":return e=>Math.abs(e);case "modulo-ten":return e=>e%10}}function f(g){let e=0;for(const h of g||[])e|=1<<h;return e}a.elevationFromPositions=k;a.evaluateRenderer=function(g,e,h,z){const {rendererJSON:n,isRGBRenderer:l}=g;var m=
g=null;if(e&&l)g=e;else if(e&&"pointCloudUniqueValueRenderer"===n?.type){m=p.fromJSON(n);var t=m.colorUniqueValueInfos;g=new Uint8Array(3*z);var w=d(m.fieldTransformType);for(var r=0;r<z;r++){var x=(w?w(e[r]):e[r])+"";for(var D=0;D<t.length;D++)if(t[D].values.includes(x)){g[3*r]=t[D].color.r;g[3*r+1]=t[D].color.g;g[3*r+2]=t[D].color.b;break}}}else if(e&&"pointCloudStretchRenderer"===n?.type)for(m=y.fromJSON(n),t=m.stops,g=new Uint8Array(3*z),w=d(m.fieldTransformType),r=0;r<z;r++)if(x=w?w(e[r]):e[r],
D=t.length-1,x<t[0].value)g[3*r]=t[0].color.r,g[3*r+1]=t[0].color.g,g[3*r+2]=t[0].color.b;else if(x>=t[D].value)g[3*r]=t[D].color.r,g[3*r+1]=t[D].color.g,g[3*r+2]=t[D].color.b;else for(D=1;D<t.length;D++){if(x<t[D].value){x=(x-t[D-1].value)/(t[D].value-t[D-1].value);g[3*r]=t[D].color.r*x+t[D-1].color.r*(1-x);g[3*r+1]=t[D].color.g*x+t[D-1].color.g*(1-x);g[3*r+2]=t[D].color.b*x+t[D-1].color.b*(1-x);break}}else if(e&&"pointCloudClassBreaksRenderer"===n?.type)for(m=c.fromJSON(n),t=m.colorClassBreakInfos,
g=new Uint8Array(3*z),w=d(m.fieldTransformType),r=0;r<z;r++)for(x=w?w(e[r]):e[r],D=0;D<t.length;D++){if(x>=t[D].minValue&&x<=t[D].maxValue){g[3*r]=t[D].color.r;g[3*r+1]=t[D].color.g;g[3*r+2]=t[D].color.b;break}}else g=(new Uint8Array(3*z)).fill(255);if(h&&m&&m.colorModulation)for(e=m.colorModulation.minValue,m=m.colorModulation.maxValue,t=0;t<z;t++)w=h[t],w=w>=m?1:w<=e?.3:.3+.7*(w-e)/(m-e),g[3*t]*=w,g[3*t+1]*=w,g[3*t+2]*=w;return g};a.filterInPlace=function(g,e,h,z,n){const l=g.length/3;let m=0;for(let A=
0;A<l;A++){let v=!0;for(let B=0;B<z.length&&v;B++){var {filterJSON:t}=z[B],w=n[B].values[A];switch(t.type){case "pointCloudValueFilter":var r="exclude"===t.mode;t.values.includes(w)===r&&(v=!1);break;case "pointCloudBitfieldFilter":r=f(t.requiredSetBits);t=f(t.requiredClearBits);if((w&r)!==r||0!==(w&t))v=!1;break;case "pointCloudReturnFilter":var x=w&15,D=w>>>4&15;w=1<D;r=1===x;x=x===D;D=!1;for(const C of t.includedReturns)if("last"===C&&x||"firstOfMany"===C&&r&&w||"lastOfMany"===C&&x&&w||"single"===
C&&!w){D=!0;break}D||(v=!1)}}v&&(h[m]=A,g[3*m]=g[3*A],g[3*m+1]=g[3*A+1],g[3*m+2]=g[3*A+2],e[3*m]=e[3*A],e[3*m+1]=e[3*A+1],e[3*m+2]=e[3*A+2],m++)}return m};a.getAttributeValues=function(g,e,h){return null!=g&&g.attributeInfo.useElevation?e?k(e,h):null:null!=g&&g.attributeInfo.storageInfo?u.readBinaryAttribute(g.attributeInfo.storageInfo,g.buffer,h):null};a.readGeometry=function(g,e){if(null==g.encoding||""===g.encoding){g=u.createGeometryIndexFromSchema(e,g);if(null==g.vertexAttributes.position)return;
e=u.createTypedView(e,g.vertexAttributes.position);var h=g.header.fields;g=[h.offsetX,h.offsetY,h.offsetZ];h=[h.scaleX,h.scaleY,h.scaleZ];const z=e.length/3,n=new Float64Array(3*z);for(let l=0;l<z;l++)n[3*l]=e[3*l]*h[0]+g[0],n[3*l+1]=e[3*l+1]*h[1]+g[1],n[3*l+2]=e[3*l+2]*h[2]+g[2];return n}if("lepcc-xyz"===g.encoding)return q.decodeXYZ(e).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,c,y,p,u,q,k,d,f){var g;p=g=function(e){function h(z){z=e.call(this,z)||this;z.type="point-cloud-class-breaks";z.field=null;z.legendOptions=null;z.fieldTransformType=null;z.colorClassBreakInfos=null;return z}a._inherits(h,e);h.prototype.clone=function(){return new g({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:c.clone(this.colorClassBreakInfos),legendOptions:c.clone(this.legendOptions)})};return a._createClass(h)}(k);b.__decorate([u.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
p.prototype,"type",void 0);b.__decorate([y.property({json:{write:!0},type:String})],p.prototype,"field",void 0);b.__decorate([y.property({type:d.LegendOptions,json:{write:!0}})],p.prototype,"legendOptions",void 0);b.__decorate([y.property({type:k.fieldTransformTypeKebabDict.apiValues,json:{type:k.fieldTransformTypeKebabDict.jsonValues,read:k.fieldTransformTypeKebabDict.read,write:k.fieldTransformTypeKebabDict.write}})],p.prototype,"fieldTransformType",void 0);b.__decorate([y.property({type:[f],json:{write:!0}})],
p.prototype,"colorClassBreakInfos",void 0);return p=g=b.__decorate([q.subclass("esri.renderers.PointCloudClassBreaksRenderer")],p)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f){q=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});y=function(g){function e(z){z=g.call(this,z)||this;z.type=void 0;z.pointSizeAlgorithm=null;z.colorModulation=null;z.pointsPerInch=10;return z}a._inherits(e,g);var h=e.prototype;h.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);
return null};h.cloneProperties=function(){return{pointSizeAlgorithm:p.clone(this.pointSizeAlgorithm),colorModulation:p.clone(this.colorModulation),pointsPerInch:p.clone(this.pointsPerInch)}};return a._createClass(e)}(y.JSONSupport);b.__decorate([u.property({type:q.apiValues,readOnly:!0,nonNullable:!0,json:{type:q.jsonValues,read:!1,write:q.write}})],y.prototype,"type",void 0);b.__decorate([u.property({types:f.pointSizeAlgorithmTypes,json:{write:!0}})],y.prototype,"pointSizeAlgorithm",void 0);b.__decorate([u.property({type:d,
json:{write:!0}})],y.prototype,"colorModulation",void 0);b.__decorate([u.property({json:{write:!0},nonNullable:!0,type:Number})],y.prototype,"pointsPerInch",void 0);y=b.__decorate([k.subclass("esri.renderers.PointCloudRenderer")],y);(y||(y={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return y})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){var d;c=d=function(f){function g(){var e=f.apply(this,arguments)||this;e.field=null;e.minValue=0;e.maxValue=255;return e}a._inherits(g,f);g.prototype.clone=function(){return new d({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return a._createClass(g)}(c.JSONSupport);b.__decorate([y.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);
b.__decorate([y.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=d=b.__decorate([k.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,c,y){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":c,splat:y}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k,d){c=new c.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});
y=function(f){function g(){return f.apply(this,arguments)||this}a._inherits(g,f);return a._createClass(g)}(y.JSONSupport);b.__decorate([p.property({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],y.prototype,"type",void 0);return y=b.__decorate([d.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],y)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;y=f=function(g){function e(){var h=g.apply(this,arguments)||this;h.type="fixed-size";h.size=0;h.useRealWorldSymbolSizes=null;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return a._createClass(e)}(d);b.__decorate([q.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],y.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],
y.prototype,"size",void 0);b.__decorate([c.property({type:Boolean,json:{write:!0}})],y.prototype,"useRealWorldSymbolSizes",void 0);return y=f=b.__decorate([k.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],y)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,y,p,u,q,k,d){var f;y=f=function(g){function e(){var h=g.apply(this,arguments)||this;h.type="splat";h.scaleFactor=1;return h}a._inherits(e,g);e.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};return a._createClass(e)}(d);b.__decorate([q.enumeration({pointCloudSplatAlgorithm:"splat"})],y.prototype,"type",void 0);b.__decorate([c.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],y.prototype,"scaleFactor",void 0);return y=f=b.__decorate([k.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],
y)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,y,p,u,q,k){var d;y=d=function(f){function g(){var e=f.apply(this,arguments)||this;e.description=null;e.label=null;e.minValue=
0;e.maxValue=0;e.color=null;return e}a._inherits(g,f);g.prototype.clone=function(){return new d({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:p.clone(this.color)})};return a._createClass(g)}(y.JSONSupport);b.__decorate([u.property({type:String,json:{write:!0}})],y.prototype,"description",void 0);b.__decorate([u.property({type:String,json:{write:!0}})],y.prototype,"label",void 0);b.__decorate([u.property({type:Number,json:{read:{source:"classMinValue"},
write:{target:"classMinValue"}}})],y.prototype,"minValue",void 0);b.__decorate([u.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],y.prototype,"maxValue",void 0);b.__decorate([u.property({type:c,json:{type:[q.Integer],write:!0}})],y.prototype,"color",void 0);return y=d=b.__decorate([k.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],y)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,c,y,p,u,q,k,d,f){var g;p=g=function(e){function h(z){z=e.call(this,z)||this;z.type="point-cloud-stretch";z.field=null;z.legendOptions=null;z.fieldTransformType=null;z.stops=null;return z}a._inherits(h,e);h.prototype.clone=function(){return new g({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),stops:c.clone(this.stops),legendOptions:c.clone(this.legendOptions)})};return a._createClass(h)}(k);b.__decorate([u.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
p.prototype,"type",void 0);b.__decorate([y.property({json:{write:!0},type:String})],p.prototype,"field",void 0);b.__decorate([y.property({type:d.LegendOptions,json:{write:!0}})],p.prototype,"legendOptions",void 0);b.__decorate([y.property({type:k.fieldTransformTypeKebabDict.apiValues,json:{type:k.fieldTransformTypeKebabDict.jsonValues,read:k.fieldTransformTypeKebabDict.read,write:k.fieldTransformTypeKebabDict.write}})],p.prototype,"fieldTransformType",void 0);b.__decorate([y.property({type:[f],json:{write:!0}})],
p.prototype,"stops",void 0);return p=g=b.__decorate([q.subclass("esri.renderers.PointCloudStretchRenderer")],p)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,b,c,y,p,u,q,k,d,f){var g;p=g=function(e){function h(z){z=e.call(this,z)||this;z.type="point-cloud-unique-value";z.field=null;z.fieldTransformType=null;z.colorUniqueValueInfos=null;z.legendOptions=null;return z}a._inherits(h,e);h.prototype.clone=function(){return new g({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),colorUniqueValueInfos:c.clone(this.colorUniqueValueInfos),legendOptions:c.clone(this.legendOptions)})};return a._createClass(h)}(k);
b.__decorate([u.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],p.prototype,"type",void 0);b.__decorate([y.property({json:{write:!0},type:String})],p.prototype,"field",void 0);b.__decorate([y.property({type:k.fieldTransformTypeKebabDict.apiValues,json:{type:k.fieldTransformTypeKebabDict.jsonValues,read:k.fieldTransformTypeKebabDict.read,write:k.fieldTransformTypeKebabDict.write}})],p.prototype,"fieldTransformType",void 0);b.__decorate([y.property({type:[f],json:{write:!0}})],
p.prototype,"colorUniqueValueInfos",void 0);b.__decorate([y.property({type:d.LegendOptions,json:{write:!0}})],p.prototype,"legendOptions",void 0);return p=g=b.__decorate([q.subclass("esri.renderers.PointCloudUniqueValueRenderer")],p)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k){var d;y=d=function(f){function g(){var e=f.apply(this,arguments)||this;e.description=null;e.label=null;e.values=null;e.color=null;return e}a._inherits(g,f);g.prototype.clone=function(){return new d({description:this.description,label:this.label,values:p.clone(this.values),color:p.clone(this.color)})};return a._createClass(g)}(y.JSONSupport);b.__decorate([u.property({type:String,json:{write:!0}})],y.prototype,"description",void 0);b.__decorate([u.property({type:String,json:{write:!0}})],
y.prototype,"label",void 0);b.__decorate([u.property({type:[String],json:{write:!0}})],y.prototype,"values",void 0);b.__decorate([u.property({type:c,json:{type:[q.Integer],write:!0}})],y.prototype,"color",void 0);return y=d=b.__decorate([k.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],y)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d){a.PointGraphic=function(f){function g(e){e=f.call(this,e)||this;e.pointCloudMetadata=null;return e}b._inherits(g,f);return b._createClass(g)}(y);c.__decorate([p.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=c.__decorate([d.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B){function C(O,I,H,J,N){if(H.drawScreenSpace)return H.fixedSize*I*J;N=r.getMaxPointSizeScreenspace(N)*I*J;return H.useFixedSizes?Math.min(H.fixedSize/2,N):0<H.screenMinSize?Math.min(Math.max(H.screenMinSize*I*J,O/2),N):Math.min(O/2,N)}function E(O,I,H,J,N){return H.drawScreenSpace?0:C(O,I,H,J,N)}function F(O){return null!=O.component?O.component:-1}function M(O,I){if(null==O)return O;O=O.filter(H=>H.id!==I);return 0===O.length?null:O}function K(O){return null!=
O.dist&&null!=O.point&&null!=O.pointId&&null!=O.node}const G={positions:[new B.VertexElementDescriptor(w.VertexAttribute.POSITION,3,v.DataType.FLOAT,0,12)],colors:[new B.VertexElementDescriptor(w.VertexAttribute.COLOR,3,v.DataType.UNSIGNED_BYTE,0,3,!0)]};w=function(){function O(H){this._params=H;this.type=m.IntersectorType.PCL;this.isGround=!1;this._passParameters=new r.PointRendererPassParameters;this._highlights=new e.PointHighlights({forEachNode:J=>this.forEachNode(J),addHighlight:(J,N,R)=>this._addHighlight(J,
N,R),removeHighlight:(J,N)=>this._removeHighlight(J,N)});this.canRender=!0;this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new D.PointRendererTechniqueConfiguration;this._nodes=new y}var I=O.prototype;I.initializeRenderContext=function(H){this._context=H;this._techniqueRepository=this._context.techniqueRepository;H.requestRender()};I.uninitializeRenderContext=function(){};I.intersect=function(H,J,N,R){const W=u.create(),T=u.create(),P=u.create(),Q=u.create(),S=d.create(),U=H.camera.perScreenPixelRatio/
2,V=H.camera.near;p.subtract(T,R,N);const X=1/p.length(T);p.scale(T,T,X);p.negate(P,T);q.set(S,T[0],T[1],T[2],-p.dot(T,N));const Y=new L,Z=new L,ea=[],ja=k.create(),ha=k.create(this._passParameters.clipBox);k.offset(ha,-N[0],-N[1],-N[2],ha);this._nodes.forAll(fa=>{const ba=fa.splatSize*this._passParameters.scaleFactor;var aa=h.minimumDistancePlane(fa.obb,S),da=h.maximumDistancePlane(fa.obb,S);aa-=E(ba,aa+V,this._passParameters,U,fa.isLeaf);da-=E(ba,da+V,this._passParameters,U,fa.isLeaf);aa=null!=
Y.dist&&null!=Z.dist&&Y.dist<aa*X&&Z.dist>da*X;if(!(0>da||aa)&&(da=C(ba,da+V,this._passParameters,U,fa.isLeaf),h.intersectLine(fa.obb,N,T,da))){da*=da;h.toAaBoundingBox(fa.obb,ja);k.offset(ja,-N[0],-N[1],-N[2],ja);aa=!k.contains(ha,ja);p.subtract(Q,fa.origin,N);var ca=fa.coordinates.length/3;for(let sa=0;sa<ca;sa++){W[0]=Q[0]+fa.coordinates[3*sa];W[1]=Q[1]+fa.coordinates[3*sa+1];W[2]=Q[2]+fa.coordinates[3*sa+2];if(aa&&!k.containsPoint(ha,W))continue;var na=p.dot(W,T),qa=p.squaredLength(W)-na*na;if(qa>
da)continue;var ua=na+V;const pa=E(ba,ua,this._passParameters,U,fa.isLeaf);if(0>na-pa)continue;ua-=pa;ua=C(ba,ua,this._passParameters,U,fa.isLeaf);if(qa>ua*ua)continue;const ka=(na-pa)*X;na=ra=>{var va=sa,Ca=ra.point;null==Ca&&(Ca=u.create());Ca[0]=fa.origin[0]+fa.coordinates[3*va];Ca[1]=fa.origin[1]+fa.coordinates[3*va+1];Ca[2]=fa.origin[2]+fa.coordinates[3*va+2];ra.point=Ca;ra.dist=ka;ra.normal=P;ra.node=fa;ra.pointId=sa;ra.layerUid=this.layerUid;return ra};(null==Y.dist||ka<Y.dist)&&(null==J||
J(N,R,ka))&&na(Y);H.options.store!==m.StoreResults.MIN&&(null==Z.dist||ka>Z.dist)&&(null==J||J(N,R,ka))&&na(Z);H.options.store!==m.StoreResults.ALL||null!=J&&!J(N,R,ka)||(qa=new L,ea.push(na(qa)))}}});const ia=fa=>{const {layerUid:ba,node:aa,pointId:da}=fa;return new g.PclTarget(fa.point,ba,da,()=>this._params.createGraphic(aa,da,fa.point))},oa=(fa,ba)=>{const aa=ia(ba);fa.set(this.type,aa,ba.dist,ba.normal)};if(K(Y)){var ma=H.results.min;(null==ma.dist||Y.dist<ma.dist)&&oa(ma,Y)}K(Z)&&H.options.store!==
m.StoreResults.MIN&&(ma=H.results.max,(null==ma.dist||Z.dist>ma.dist)&&oa(ma,Z));if(H.options.store===m.StoreResults.ALL){ma=f.fromPoints(N,R);for(const fa of ea){const ba=l.newIntersectorResult(ma);oa(ba,fa);H.results.all.push(ba)}}};I.prepareTechnique=function(H){if(0===this._nodes.length||H.output!==z.ShaderOutput.Color&&H.output!==z.ShaderOutput.Depth&&H.output!==z.ShaderOutput.Highlight)return null;this._nodes.forAll(J=>{null==J.vao&&this._initNode(H,J)});this._techniqueConfig.drawScreenSize=
this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=H.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=H.output===z.ShaderOutput.Depth?z.ShaderOutput.Depth:H.output===z.ShaderOutput.Highlight?z.ShaderOutput.Highlight:z.ShaderOutput.Color;return this._techniqueRepository.releaseAndAcquire(x.PointRendererTechnique,
this._techniqueConfig,this._technique)};I.render=function(H,J){const N=H.rctx,R=N.bindTechnique(J,this._passParameters,H.bindParameters),W=H.output===z.ShaderOutput.Highlight;this._nodes.forAll(T=>{0===T.coordinates.length||W&&!T.highlights||(R.bindDraw(T,H.bindParameters,this._passParameters),N.bindVAO(T.vao),W?this._renderHighlightFragments(N,T):N.drawArrays(v.PrimitiveType.POINTS,0,T.coordinates.length/3))})};I._renderHighlightFragments=function(H,J){var N=J.highlights;if(null!=N){J=N[0].component;
var R=J+1;for(let W=1;W<N.length;W++){const T=N[W].component;T!==R&&(R-=J,0<R&&H.drawArrays(v.PrimitiveType.POINTS,J,R),J=T);R=T+1}N=R-J;0<N&&H.drawArrays(v.PrimitiveType.POINTS,J,N)}};I.addNode=function(H){this._nodes.push(H);this._highlights.nodeAdded(H);this._requestRender()};I.removeNode=function(H){let J=null;this._nodes.filterInPlace(N=>N.id===H?(J=N,N.vao=c.disposeMaybe(N.vao),this._highlights.nodeRemoved(N),!1):!0);this._requestRender();return J};I.forEachNode=function(H){this._nodes.forAll(H)};
I.removeAll=function(){this._nodes.forAll(H=>H.vao=c.disposeMaybe(H.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()};I.highlight=function(H){return this._highlights.add(H)};I._addHighlight=function(H,J,N){var R=H.highlights;null==R&&(R=[]);J={component:J,id:N};R.push(J);J=F(J);for(N=R.length-1;0<N&&J<F(R[N-1]);)[R[N-1],R[N]]=[R[N],R[N-1]],--N;H.highlights=R;this._requestRender()};I._removeHighlight=function(H,J){H.highlights=M(H.highlights,J);this._requestRender()};I._initNode=
function(H,J){H=H.rctx;J.vao=new t.VertexArrayObject(H,n.Default3D,G,{positions:A.BufferObject.createVertex(H,v.Usage.STATIC_DRAW,J.coordinates),colors:A.BufferObject.createVertex(H,v.Usage.STATIC_DRAW,J.rgb)})};I._requestRender=function(){this._context&&this._context.requestRender()};b._createClass(O,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._passParameters.useFixedSizes},set:function(H){this._passParameters.useFixedSizes!==
H&&(this._passParameters.useFixedSizes=H,this._requestRender())}},{key:"scaleFactor",get:function(){return this._passParameters.scaleFactor},set:function(H){this._passParameters.scaleFactor!==H&&(this._passParameters.scaleFactor=H,this._requestRender())}},{key:"minSizePx",get:function(){return this._passParameters.minSizePx},set:function(H){this._passParameters.minSizePx!==H&&(this._passParameters.minSizePx=H,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._passParameters.useRealWorldSymbolSizes},
set:function(H){this._passParameters.useRealWorldSymbolSizes!==H&&(this._passParameters.useRealWorldSymbolSizes=H,this._requestRender())}},{key:"size",get:function(){return this._passParameters.size},set:function(H){this._passParameters.size!==H&&(this._passParameters.size=H,this._requestRender())}},{key:"sizePx",get:function(){return this._passParameters.sizePx},set:function(H){this._passParameters.sizePx!==H&&(this._passParameters.sizePx=H,this._requestRender())}},{key:"clippingBox",set:function(H){k.set(this._passParameters.clipBox,
H||k.POSITIVE_INFINITY)}},{key:"_clippingEnabled",get:function(){return!k.equals(this._passParameters.clipBox,k.POSITIVE_INFINITY,(H,J)=>H===J)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(H){this._slicePlaneEnabled!==H&&(this._slicePlaneEnabled=H,this._requestRender())}}]);return O}();B=function(O){function I(H,J,N,R,W,T,P,Q,S=null,U=null){J=O.call(this,N,W,J)||this;J.id=H;J.obb=R;J.coordinates=T;J.rgb=P;J.attributes=Q;J.pointIdFilterMap=S;J.highlights=U;
return J}b._inherits(I,O);return b._createClass(I)}(r.PointRendererDrawParameters);let L=b._createClass(function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""});a.PointRenderer=w;a.PointRendererNode=B;a.isInstanceOfNode=function(O){return O.hasOwnProperty("splatSize")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils",
"../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Object3DStateID"],function(a,b,c,y,p){let u=function(){function k(f){this._context=f;this._highlights=new Set}var d=k.prototype;d.destroy=function(){this._highlights=null};d.add=function(f){const g=new q(f);this._highlights.add(g);this._enableSet(g);return c.makeHandle(()=>this._removeSet(g))};d._removeSet=function(f){this._disableSet(f);this._highlights.delete(f)};d._enableSet=function(f){f.enabled||(f.enabled=!0,this._context.forEachNode(g=>
this._enableSetForNode(f,g)))};d._enableSetForNode=function(f,g){if(f.enabled){var e=f.ids.get(g.id);e&&e.forEach(h=>this._context.addHighlight(g,h,f.id))}};d._disableSet=function(f){f.enabled&&(f.enabled=!1,this._context.forEachNode(g=>this._disableSetForNode(f,g)))};d._disableSetForNode=function(f,g){f.enabled||this._context.removeHighlight(g,f.id)};d.nodeAdded=function(f){this._highlights.forEach(g=>this._enableSetForNode(g,f))};d.nodeRemoved=function(f){this._highlights.forEach(g=>this._disableSetForNode(g,
f))};d.removeAll=function(){this._highlights.forEach(f=>this._disableSet(f))};b._createClass(k,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return k}(),q=function(){function k(d){this.id=new p.Object3DStateID(y.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const f of d)null!=f&&this._add(f.nodeId,f.pointId)}k.prototype._add=function(d,f){const g=this.ids.get(d);g?g.add(f):this.ids.set(d,new Set([f]))};return b._createClass(k)}();a.PointHighlights=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A){function v(G){const L=new D.ShaderBuilder,O=G.output===e.ShaderOutput.Color,I=G.output===e.ShaderOutput.Depth,H=G.output===e.ShaderOutput.Highlight,{vertex:J,fragment:N}=L;L.include(h.SliceDraw,G);L.attributes.add(A.VertexAttribute.POSITION,"vec3");L.attributes.add(A.VertexAttribute.COLOR,"vec3");J.uniforms.add(new r.Matrix4DrawUniform("modelView",(R,W)=>y.multiply(F,W.camera.viewMatrix,y.fromTranslation(F,R.origin))),new x.Matrix4PassUniform("proj",
(R,W)=>W.camera.projectionMatrix),new l.Float2DrawUniform("screenMinMaxSize",(R,W,T)=>u.set(K,T.useFixedSizes?0:T.minSizePx*W.camera.pixelRatio,(R.isLeaf?256:64)*W.camera.pixelRatio)),G.useFixedSizes?new m.Float2PassUniform("pointScale",(R,W)=>u.set(K,R.fixedSize*W.camera.pixelRatio,W.camera.fullHeight)):new l.Float2DrawUniform("pointScale",(R,W,T)=>u.set(K,R.splatSize*T.scaleFactor*W.camera.pixelRatio,W.camera.fullHeight/W.camera.pixelRatio)));G.clippingEnabled?J.uniforms.add(new t.Float3DrawUniform("clipMin",
(R,W,T)=>k.set(M,T.clipBox[0]-R.origin[0],T.clipBox[1]-R.origin[1],T.clipBox[2]-R.origin[2])),new t.Float3DrawUniform("clipMax",(R,W,T)=>k.set(M,T.clipBox[3]-R.origin[0],T.clipBox[4]-R.origin[1],T.clipBox[5]-R.origin[2]))):(J.constants.add("clipMin","vec3",[-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32,-c.NUMBER_MAX_FLOAT32]),J.constants.add("clipMax","vec3",[c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32,c.NUMBER_MAX_FLOAT32]));I?(g.addNearFar(L),g.addCalculateLinearDepth(L),L.varyings.add("depth","float")):
G.output!==e.ShaderOutput.Highlight&&L.varyings.add("vColor","vec3");J.code.add(w.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${G.drawScreenSize?w.glsl`
      float clampedScreenSize = pointSize;`:w.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${I?w.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${O?w.glsl`vColor = color;`:""}
    }
  `);N.include(n.RgbaFloatEncoding,G);H&&L.include(z.OutputHighlight,G);N.code.add(w.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${I?w.glsl`fragColor = float2rgba(depth);`:""}
      ${H?w.glsl`outputHighlight();`:""}
      ${O?w.glsl`fragColor = vec4(vColor, 1.0);`:""}
    }
  `);return L}function B(G){return G?256:64}let C=function(G){function L(){var O=G.apply(this,arguments)||this;O.clipBox=f.create(f.POSITIVE_INFINITY);O.useFixedSizes=!1;O.useRealWorldSymbolSizes=!1;O.scaleFactor=1;O.minSizePx=0;O.size=0;O.sizePx=0;return O}b._inherits(L,G);b._createClass(L,[{key:"fixedSize",get:function(){return this.drawScreenSpace?this.sizePx:this.size}},{key:"screenMinSize",get:function(){return this.useFixedSizes?0:this.minSizePx}},{key:"drawScreenSpace",get:function(){return this.useFixedSizes&&
!this.useRealWorldSymbolSizes}}]);return L}(w.NoParameters),E=function(G){function L(O,I,H){var J=G.call(this,O)||this;J.origin=O;J.isLeaf=I;J.splatSize=H;return J}b._inherits(L,G);return b._createClass(L)}(h.SlicePlaneParameters);const F=p.create(),M=d.create(),K=q.create();p=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:E,PointRendererPassParameters:C,build:v,getMaxPointSizeScreenspace:B},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=E;a.PointRendererPassParameters=
C;a.PointRendererShader=p;a.build=v;a.getMaxPointSizeScreenspace=B})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){p=
function(e){function h(n,l,m){return e.call(this,n,l,m)||this}c._inherits(h,e);var z=h.prototype;z.initializeProgram=function(n){return new q.Program(n.rctx,h.shader.get().build(this.configuration),u.Default3D)};z.initializePipeline=function(){return g.makePipelineState({depthTest:{func:f.CompareFunction.LESS},depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?k.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?
k.stencilBaseAllZerosParams:null})};return c._createClass(h)}(p.ShaderTechnique);p.shader=new y.ReloadableShaderModule(d.PointRendererShader,()=>new Promise((e,h)=>a(["./PointRenderer.glsl"],e,h)));b.PointRendererTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,y,p,u){u=function(q){function k(){var d=q.apply(this,arguments)||this;d.output=y.ShaderOutput.Color;d.hasSlicePlane=!1;d.drawScreenSize=!1;d.useFixedSizes=!1;d.hasOccludees=!1;d.clippingEnabled=!1;return d}b._inherits(k,q);return b._createClass(k)}(u.DefaultTechniqueConfiguration);c.__decorate([p.parameter({count:y.ShaderOutput.COUNT})],u.prototype,"output",void 0);c.__decorate([p.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],u.prototype,"drawScreenSize",
void 0);c.__decorate([p.parameter()],u.prototype,"useFixedSizes",void 0);c.__decorate([p.parameter()],u.prototype,"hasOccludees",void 0);c.__decorate([p.parameter()],u.prototype,"clippingEnabled",void 0);c.__decorate([p.parameter({constValue:!0})],u.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.PopupSceneLayerView=e=>{e=function(h){function z(){return h.apply(this,arguments)||this}b._inherits(z,h);var n=z.prototype;n._validateFetchPopupFeatures=function(l){const {layer:m}=this,{popupEnabled:t}=m;if(!t)throw new y("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:m});if(!g.getFetchPopupTemplate(m,l))throw new y("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:m});};n.prepareFetchPopupFeatures=async function(l){};
n.fetchPopupFeatures=async function(l,m){this._validateFetchPopupFeatures(m);l=null!=m?m.clientGraphics:null;if(!l||0===l.length)return[];const t="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let w=[];"fieldsIndex"in this.layer&&(w=f.unpackFieldNames(this.layer.fieldsIndex,await g.getRequiredFields(t,g.getFetchPopupTemplate(this.layer,m))));await this.prepareFetchPopupFeatures(w);m=new Set;const r=[],x=[];for(const D of l)f.populateMissingFields(w,
D,m)?x.push(D):r.push(D);return 0===x.length?r:this.whenGraphicAttributes(x,[...m]).catch(()=>x).then(D=>r.concat(D))};return b._createClass(z)}(e);return e=c.__decorate([d.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/ReactiveSet ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/featureEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N){d=G.defineFieldProperties();t=function(R){function W(){var P=R.apply(this,arguments)||this;P.type="scene-layer-3d";P._setVisibilityHiddenObjectIds=new u;P.progressiveLoadFactor=1;P._elevationContext="scene";P._isIntegratedMesh=!1;P._supportsLabeling=!0;P._interactiveEditingSessions=new Map;P._queryEngine=null;return P}a._inherits(W,R);var T=W.prototype;T.tryRecycleWith=function(P,Q){return P.url===this.layer.url&&
this.i3sOverrides.isEmpty?P.load(Q).then(()=>{M.checkRecyclable(this.layer,P,this.i3sOverrides);this.layer=P;this.i3sOverrides.destroy();this.i3sOverrides=new B.I3SOverrides({view:this.view,layer:P,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null};T.initialize=function(){this._fieldsHelper=new O.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,Q=>this._rangeInfosChanged(Q),q.initial);this.updatingHandles.add(()=>
this.layer.renderer,Q=>this.updatingHandles.addPromise(this._rendererChange(Q)),q.initial);const P=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,P);this.updatingHandles.add(()=>this.filter,P);this.updatingHandles.add(()=>this._floorFilterClause,P);this.updatingHandles.add(()=>this._excludeObjectIdsSorted,P);this.updatingHandles.add(()=>this._setVisibilityHiddenObjectIdsSorted,P);this.updatingHandles.add(()=>null!=this.viewFilter?this.viewFilter.sortedObjectIds:
null,P);this.updatingHandles.add(()=>null!=this.viewFilter?this.viewFilter.parsedWhereClause:null,P);this.updatingHandles.add(()=>[null!=this.viewFilter?this.viewFilter.parsedGeometry:null,null!=this.filter?this.filter.spatialRelationship:null,null!=this.layer.filter?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange());m.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&this.updatingHandles.add(()=>this.i3sOverrides.sortedGeometryChangedObjectIds,P);this.handles.add(this.layer.on("apply-edits",
Q=>this.updatingHandles.addPromise(Q.result)));this.handles.add(this.layer.on("edits",Q=>this._handleEdits(Q)))};T.destroy=function(){this._fieldsHelper=p.destroyMaybe(this._fieldsHelper)};T._rangeInfosChanged=function(P){null!=P&&0<P.length&&y.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};T.createQuery=function(){const P={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};
return null!=this.filter?this.filter.createQuery(P):new l(P)};T.queryExtent=function(P,Q){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(P),Q?.signal)};T.queryFeatureCount=function(P,Q){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(P),Q?.signal)};T.queryFeatures=function(P,Q){return this._ensureQueryEngine().executeQuery(this._ensureQuery(P),Q?.signal).then(S=>{if(!S?.features)return S;const U=this.layer;for(const V of S.features)V.layer=U,V.sourceLayer=
U;return S})};T.queryObjectIds=function(P,Q){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(P),Q?.signal)};T._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};T._createQueryEngine=function(){const P=D.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new C.I3SQueryEngine({layerView:this,priority:N.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new F.I3SQueryFeatureStore({featureAdapter:new E.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,
attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:P}),forAllFeatures:(Q,S)=>this._forAllFeatures((U,V,X)=>Q({id:U,index:V,meta:X}),S,w.ForAllFeaturesMode.QUERYABLE),getFeatureExtent:P,sourceSpatialReference:M.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};T.highlight=function(P){const Q=this._highlights;if(P instanceof l){const {set:S,handle:U}=Q.acquireSet();this.queryObjectIds(P).then(V=>Q.setFeatureIds(S,V));return U}return a._get(a._getPrototypeOf(W.prototype),
"highlight",this).call(this,P)};T.createInteractiveEditSession=function(P){return x.createInteractiveEditSession(this._attributeEditingContext,P)};T._createLayerGraphic=function(P){P=new c(null,null,P);P.layer=this.layer;P.sourceLayer=this.layer;return P};T.getFilters=function(){const P=a._get(a._getPrototypeOf(W.prototype),"getFilters",this).call(this);m.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.sortedGeometryChangedObjectIds.length&&P.push((U,V)=>{0<=V.node.index&&
M.objectIdFilter(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,U)});const Q=this._setVisibilityHiddenObjectIdsSorted;null!=Q&&P.push(U=>M.objectIdFilter(Q,!1,U));const S=this._excludeObjectIdsSorted;null!=S&&P.push(U=>M.objectIdFilter(S,!1,U));this._floorFilterClause&&this.addSqlFilter(P,this._floorFilterClause,this.logError);this.addSqlFilter(P,this.parsedDefinitionExpression,this.logError);null!=this.viewFilter&&this.viewFilter.addFilters(P,this.view,this._controller.crsIndex,this._collection);
return P};T.setVisibility=function(P,Q){Q?this._setVisibilityHiddenObjectIds.delete(P):this._setVisibilityHiddenObjectIds.add(P)};T.isUpdating=function(){return a._get(a._getPrototypeOf(W.prototype),"isUpdating",this).call(this)||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating};T._ensureQuery=function(P){return this._addDefinitionExpressionToQuery(null==P?this.createQuery():l.from(P))};T._handleEdits=function(P){m.sceneLayerEditingEnabled()&&
x.processGeometryEdits(this._attributeEditingContext,P);x.processAttributeEdits(this._attributeEditingContext,P)};T.computeNodeFiltering=function(P){const Q=this.viewFilter;return null==Q||!this.view.spatialReference||Q.isMBSGeometryVisible(P,this.view.spatialReference,this._controller.crsIndex)?v.NodeFilterImpact.Unmodified:v.NodeFilterImpact.Culled};a._createClass(W,[{key:"i3slayer",get:function(){return this.layer}},{key:"layerPopupEnabledAndHasTemplate",get:function(){return this.layer.popupEnabled&&
J.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}},{key:"filter",get:function(){return this._get("filter")},set:function(P){this._set("filter",A.I3SMeshViewFilter.checkSupport(P)?P:null)}},{key:"viewFilter",get:function(){const P=this.filter,Q=this.layerFilter;if(null==P&&null==Q)return null;const S=this._get("viewFilter");if(null==S)return new A.I3SMeshViewFilter({layerFilter:Q,viewFilter:P,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:U=>this._loadAsyncModule(U),
addSqlFilter:(U,V)=>this.addSqlFilter(U,V,this.logError)});S.viewFilter=P;S.layerFilter=Q;return S}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"_floorFilterClause",get:function(){const P=n.getFloorFilterClause(this);return null!=P?h.WhereClause.create(P,this.layer.fieldsIndex):null}},{key:"_excludeObjectIdsSorted",get:function(){const P=this.layer.excludeObjectIds.toArray();return P.length?P.sort((Q,S)=>Q-S):null}},{key:"_setVisibilityHiddenObjectIdsSorted",
get:function(){return this._setVisibilityHiddenObjectIds.size?Array.from(this._setVisibilityHiddenObjectIds).sort((P,Q)=>P-Q):null}},{key:"_objectQualitySettings",get:function(){return this.view?.qualitySettings?.sceneService?.object}},{key:"lodFactor",get:function(){return this._objectQualitySettings?.lodFactor??1}},{key:"lodCrossfadeinDuration",get:function(){return this._objectQualitySettings.lodCrossfadeinDuration??0}},{key:"lodCrossfadeoutDuration",get:function(){return this._objectQualitySettings.lodCrossfadeoutDuration??
0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"_attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:P=>this._forAllNodes(Q=>null!=Q?P(Q.node,Q.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??
[],i3sOverrides:this.i3sOverrides,getAttributeData:P=>this.getAttributeData(P),setAttributeData:(P,Q)=>this.setAttributeData(P,Q),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const P=this.viewFilter;return null!=P&&null!=P.parsedGeometry}}]);return W}(t.I3SMeshView3D(K.DefinitionExpressionSceneLayerView(L.PopupSceneLayerView(r.LayerView3D(H)))));b.__decorate([k.property()],t.prototype,"i3slayer",null);b.__decorate([k.property(I.updatingProgress)],t.prototype,"updatingProgress",
void 0);b.__decorate([k.property({type:z})],t.prototype,"filter",null);b.__decorate([k.property({readOnly:!0})],t.prototype,"viewFilter",null);b.__decorate([k.property(d.requiredFields)],t.prototype,"requiredFields",null);b.__decorate([k.property(d.availableFields)],t.prototype,"availableFields",void 0);b.__decorate([k.property()],t.prototype,"_fieldsHelper",void 0);b.__decorate([k.property()],t.prototype,"_floorFilterClause",null);b.__decorate([k.property()],t.prototype,"_excludeObjectIdsSorted",
null);b.__decorate([k.property()],t.prototype,"_setVisibilityHiddenObjectIds",void 0);b.__decorate([k.property()],t.prototype,"_setVisibilityHiddenObjectIdsSorted",null);b.__decorate([k.property()],t.prototype,"_objectQualitySettings",null);b.__decorate([k.property()],t.prototype,"lodFactor",null);b.__decorate([k.property()],t.prototype,"updatingProgressValue",null);return t=b.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],t)})},"esri/core/ReactiveSet":function(){define(["../chunks/_rollupPluginBabelHelpers",
"./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b,c){return function(y,p){function u(){this._set=new Set;this._observable=new c.SimpleObservable}var q=u.prototype;q.add=function(k){const d=this._set.size;this._set.add(k);this._set.size!==d&&this._observable.notify();return this};q.clear=function(){0<this._set.size&&(this._set.clear(),this._observable.notify())};q.delete=function(k){(k=this._set.delete(k))&&this._observable.notify();return k};q.entries=function(){b.trackAccess(this._observable);
return this._set.entries()};q.forEach=function(k,d){b.trackAccess(this._observable);this._set.forEach((f,g)=>k.call(d,f,g,this),d)};q.has=function(k){b.trackAccess(this._observable);return this._set.has(k)};q.keys=function(){b.trackAccess(this._observable);return this._set.keys()};q.values=function(){b.trackAccess(this._observable);return this._set.values()};q[y]=function(){b.trackAccess(this._observable);return this._set[Symbol.iterator]()};a._createClass(u,[{key:"size",get:function(){b.trackAccess(this._observable);
return this._set.size}},{key:p,get:function(){return this._set[Symbol.toStringTag]}}]);return u}(Symbol.iterator,Symbol.toStringTag)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa,ba,aa,da,ca,na,qa,ua,sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa,Sa,La,Ua,Va,cb,la,eb,ib,Pa){function za(ab,pb){n.isAbortError(ab)||db.warn("Error while processing edges. Edges on this layer might not display correctly",pb,ab)}function Ga(ab){if(null==ab)return!1;const pb=ab.metallicRoughness;return pb&&0<=pb.baseColorTextureId||pb&&0<=pb.metallicRoughnessTextureId||0<=ab.normalTextureId||
0<=ab.emissiveTextureId||0<=ab.occlusionTextureId}function Fa(ab){return null!=ab&&t.isArrayBuffer(ab.data)}function xa(ab,pb){ab=1024+ab.interleavedVertexData.byteLength+(ab.indices?ab.indices.byteLength:0)+ab.positionData.data.byteLength+ab.positionData.indices.byteLength;if(null!=pb)for(const tb of pb)null!=tb&&t.isArrayBuffer(tb.data)&&(ab+=tb.data.byteLength);return ab}function ya(ab,pb){return pb.byteSize>vb?(db.warn(`Node is too big to store in IndexedDB cache: ${ab.id} (${pb.byteSize} bytes)`),
!1):0<pb.byteSize}function Ea(ab){if(0===ab.length)return null;const pb=new Float64Array(10*ab.length);ab.forAll((tb,Ya)=>{let wa=tb.serviceObb;null==wa&&(wa=Fb,F.copy(wa.center,tb.mbs),wa.halfSize[0]=wa.halfSize[1]=wa.halfSize[2]=tb.mbs[3]);tb=10*Ya;pb[tb]=wa.center[0];pb[tb+1]=wa.center[1];pb[tb+2]=wa.center[2];pb[tb+3]=wa.halfSize[0];pb[tb+4]=wa.halfSize[1];pb[tb+5]=wa.halfSize[2];pb[tb+6]=wa.quaternion[0];pb[tb+7]=wa.quaternion[1];pb[tb+8]=wa.quaternion[2];pb[tb+9]=wa.quaternion[3]});return pb}
function Oa(ab,pb){ab.forEach(tb=>tb.opacity=pb)}function bb(ab){return pb=>{if(ab.immediate)return ab.immediate.schedule(pb);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}const db=g.getLogger("esri.views.3d.layers.I3SMeshView3D"),nb=[1,1,1,1];let kb=function(ab){function pb(tb,Ya,wa,Ia,Ra,Ta,Za,gb,lb){var ob=ab.call(this)||this;ob.node=tb;ob.featureIds=Ya;ob.objectHandle=wa;ob.cachedRendererVersion=Ia;ob.attributeInfo=Ra;ob.material=Ta;ob.textures=Za;
ob.anchorIds=gb;ob.anchors=lb;ob.cachedElevationAnchors=null;ob.cachedEdgeMaterials=[];ob.edgeMemoryUsage=0;return ob}c._inherits(pb,ab);return c._createClass(pb)}(ca.NodeCrossfadeMetaData);var wb;(function(ab){ab[ab.CastShadows=4]="CastShadows";ab[ab.Pickable=5]="Pickable"})(wb||(wb={}));const vb=100*k.ByteSizeUnit.MEGABYTES;var sb;(function(ab){ab[ab.ADD=0]="ADD";ab[ab.REMOVE=1]="REMOVE";ab[ab.UPDATE=2]="UPDATE"})(sb||(sb={}));const Ab=I.create(),Ib=H.create(),rb=H.create(),Fb=La.create(),hb=[0,
0,0,0],Ja=new p([0,0,0,0]),Na=W.fromValues(0,0,0,0),Xa={remove(){},pause(){},resume(){}};b.ElevationMode=void 0;(function(ab){ab[ab.Absolute=0]="Absolute";ab[ab.RelativeToGround=1]="RelativeToGround";ab[ab.OnTheGround=2]="OnTheGround"})(b.ElevationMode||(b.ElevationMode={}));const fb=M.create(),jb=I.create();b.I3SMeshView3D=ab=>{ab=function(pb){function tb(...wa){wa=pb.call(this,wa)||this;wa._nodeId2Meta=new Map;wa._nodeId2MetaReloading=new Map;wa._i3sWasmLoaded=!1;wa._snappingSourcesTrackers=[];
wa._hasLoadedPBRTextures=!1;wa._asyncModuleLoading=0;wa._addTasks=new Map;wa._currentRenderer=null;wa._rendererVersion=0;wa._colorVariable=null;wa._opacityVariable=null;wa._rendererFields=null;wa._symbologyFields=null;wa._symbologyOverride=null;wa._symbologyOverrideFields=null;wa._symbolInfos=new Map;wa._visibleGeometryChangedSchedulerHandle=null;wa._idbCache=f("enable-feature:idb-mock-cache")?new Ba.IDBMockCache:new Ca.IDBCache("esri-scenelayer-cache","geometries");wa._hasComponentData=!1;wa._hasVertexColors=
!1;wa.updating=!0;wa.holeFilling="auto";wa._hasColors=!1;wa._hasTextures=!1;wa._hasData=!1;wa.slicePlaneEnabled=!1;wa._modifications=[];wa.ignoresMemoryFactor=!1;wa._layerUrl="";wa._cacheKeySuffix=null;wa._elevationTask=null;wa._filters=[];wa._arcade=null;wa._tmpAttributeOnlyGraphic=new u(null,null,{});wa._crossfadeHelper=new ca.I3SCrossfadeHelper(c._assertThisInitialized(wa));return wa}c._inherits(tb,pb);var Ya=tb.prototype;Ya.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);
var wa=this.view.resourceController;this.i3sOverrides=new ka.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:wa.memoryController});this._worker=new ha.I3SMeshWorkerHandle(bb(wa));this.addResolvingPromise(this._worker.promise);wa=this.i3slayer.store;this._worker.setLegacySchema(this.uid,wa.defaultGeometrySchema);va.checkSceneLayerValid(this.i3slayer);va.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new Q({layerView:this,
worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();wa=wa.defaultGeometrySchema;if(this._isIntegratedMesh||!wa)this._hasComponentData=!1;else{const Ia=wa.featureAttributes;this._hasComponentData=!!(Ia&&Ia.faceRange&&Ia.id)}this._hasVertexColors=null!=(wa?.vertexAttributes.color??null)&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);
this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,Ia=>this._deleteComponentObject(Ia));this._intersectionHandler=new ua.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Ia=>null!=this._controller.index&&null!=this._controller.index.rootNode?
this._controller.index.traverse(this._controller.index.rootNode,Ra=>{var Ta=Ra.index;Ta=this._nodeId2Meta.get(Ta)||this._nodeId2MetaReloading.get(Ta);return Ia(Ra,null!=Ta?Ta.objectHandle:null)}):()=>{}});this.updatingHandles.add(()=>this.layerUid,Ia=>this._intersectionHandler.layerUid=Ia);this.updatingHandles.add(()=>this.sublayerUid,Ia=>this._intersectionHandler.sublayerUid=Ia);this._elevationProvider=new na({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=
this._usePBR;this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),l.initial);this.updatingHandles.add(()=>this.fullOpacity,Ia=>this._opacityChange(Ia));this.updatingHandles.add(()=>this.slicePlaneEnabled,Ia=>this._slicePlaneEnabledChange(Ia));this.updatingHandles.add(()=>this.elevationOffset,(Ia,Ra)=>{this._reloadAll(Ra);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(Ia,Ra)=>this._elevationInfoChanged(Ia,Ra),l.initial);
this.updatingHandles.add(()=>this.contentVisible&&this.elevationInfo.mode!==b.ElevationMode.Absolute,(Ia,Ra)=>{Ia?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:Ta})=>this._ensureElevationTask().addExtent(Ta)),"elevation-change"):Ra&&this.handles.remove("elevation-change")},l.initial);this.updatingHandles.add(()=>this._usePBR,Ia=>this._updatePBR(Ia));wa=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,wa);this.updatingHandles.add(()=>
this.uncompressedTextureDownsamplingEnabled,wa);this.updatingHandles.add(()=>this.contentVisible,Ia=>this._contentVisibleChanged(Ia),l.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),l.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),l.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),l.initial);this.handles.add([l.watch(()=>Qa.I3S_TREE_SHOW_TILES,Ia=>{if(Ia&&!this._treeDebugger){const Ra=
this._controller.crsIndex;(new Promise((Ta,Za)=>a(["./support/I3STreeDebugger"],Ta,Za))).then(({I3STreeDebugger:Ta})=>{!this._treeDebugger&&Qa.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Ta({lv:this,view:this.view,nodeSR:Ra}))})}else Ia||Qa.I3S_TREE_SHOW_TILES||(this._treeDebugger=h.destroyMaybe(this._treeDebugger))},l.initial),l.watch(()=>Qa.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),l.initial)]);this._cacheKeySuffix=va.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);
this._idbCache.init().catch(Ia=>db.warn(`Failed to initialize IndexedDB cache: ${Ia}`))};Ya.destroy=function(){this._clearAddTasks();this._elevationTask=h.destroyMaybe(this._elevationTask);this.i3sOverrides=h.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),
this._intersectionHandler=null);const wa=this._worker;wa&&(wa.destroyContext(this.uid).then(()=>wa.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=h.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=h.destroyMaybe(this._labeler);this._treeDebugger=h.destroyMaybe(this._treeDebugger);this._controller=h.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=
h.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};Ya._memEstimateTextureAdded=function(wa){wa=wa.memoryEstimate;this._gpuMemoryEstimate+=wa;this._texMemoryEstimate+=wa;return wa};Ya._memEstimateTextureRemoved=function(wa){null!=wa&&(wa=wa.memoryEstimate,this._gpuMemoryEstimate-=wa,this._texMemoryEstimate-=wa)};Ya._memEstimateGeometryAdded=
function(wa){wa=this._collection.getObjectGPUMemoryUsage(wa);this._gpuMemoryEstimate+=wa;this._geoMemoryEstimate+=wa;return wa};Ya._memEstimateGeometryRemoved=function(wa){wa=this._collection.getObjectGPUMemoryUsage(wa);this._gpuMemoryEstimate-=wa;this._geoMemoryEstimate-=wa};Ya.isNodeLoaded=function(wa){return this._nodeId2Meta.has(wa)};Ya.isNodeReloading=function(wa){return this._nodeId2MetaReloading.has(wa)};Ya._labelingChanged=function(){if(!fa.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=
this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==this._labeler){var wa=new ja({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(Ia=>null!=Ia&&this._addMetaToLabeler(wa,Ia));this._labeler=wa}};Ya._loadAsyncModule=function(wa){++this._asyncModuleLoading;return wa.then(Ia=>{--this._asyncModuleLoading;return Ia},Ia=>{--this._asyncModuleLoading;throw Ia;})};Ya._modificationsChanged=function(){if(!this._i3sWasmLoaded&&
this.hasModifications)this._i3sWasmLoaded=oa.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var wa=this.uid,Ia=this.i3slayer.spatialReference;this._worker.setModifications(wa,this._layerClippingArea,this._modifications,Ia);var Ra=ha.toWasmModification(this._layerClippingArea,this._modifications,Ia);oa.setModificationsSync({context:wa,modifications:Ra,isGeodetic:Ia.isGeographic});this._controller.modificationsChanged();
var Ta=this.hasModifications?new z:null;this._nodeId2Meta.forEach((Za,gb)=>{null==Za?(this._nodeId2Meta.delete(gb),this._controller.updateLoadStatus(gb,!1)):Za.node.hasModifications?(this._nodeId2Meta.delete(gb),this._nodeId2MetaReloading.set(gb,Za)):null!=Ta&&Ta.push(Za.node)});null!=Ta&&this._nodeId2MetaReloading.forEach(Za=>Ta.push(Za.node));null!=Ta&&0<Ta.length&&(this.updateNodeModificationStatus(Ta),Ta.forAll(Za=>{if(Za.imModificationImpact!==pa.NodeIMModificationImpact.Culled){const gb=this._nodeId2Meta.get(Za.index);
this._controller.invalidateGeometryVisibility(Za.index);null!=gb?(this._nodeId2Meta.delete(Za.index),this._nodeId2MetaReloading.set(Za.index,gb)):this._nodeId2Meta.has(Za.index)&&(this._nodeId2Meta.delete(Za.index),this._controller.updateLoadStatus(Za.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};Ya._showModifications=function(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=
null);if(Qa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var wa={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Ia={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ra of this._modifications){const Ta=Ra.geometry;Ta.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new u({geometry:Ta,symbol:{...Ia,color:wa[Ra.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}};Ya._addMetaToLabeler=
function(wa,Ia){wa.addNodeMeta(Ia,(Ra,Ta)=>this._createAttributes(Ra,Ta))};Ya._contentVisibleChanged=function(wa){wa?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))};
Ya.getLoadedAttributes=function(wa){wa=this._nodeId2Meta.get(wa);if(null!=wa&&null!=wa.attributeInfo)return wa.attributeInfo.loadedAttributes};Ya.getAttributeData=function(wa){wa=this._nodeId2Meta.get(wa);if(null!=wa&&null!=wa.attributeInfo)return wa.attributeInfo.attributeData};Ya.setAttributeData=function(wa,Ia){wa=this._nodeId2Meta.get(wa);null!=wa&&null!=wa.attributeInfo&&(wa.attributeInfo.attributeData=Ia,this._attributeValuesChanged(wa))};Ya.updateAttributes=async function(wa,Ia,Ra){const Ta=
this._nodeId2Meta.get(wa);null!=Ta&&(await this.i3sOverrides.applyAttributeOverrides(Ta.featureIds,Ia,Ra),Ta.attributeInfo=Ia,this._controller.reschedule(()=>this._attributeValuesChanged(Ta),Ra).catch(Za=>{n.isAbortError(Za)||db.warn("Error while updating attribute values. Layer might not display correctly.",Za)}))};Ya._attributeValuesChanged=function(wa){wa.cachedRendererVersion=this._getInvalidRendererVersion();wa.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(wa,(Ia,
Ra)=>this._createAttributes(Ia,Ra));this._updateEngineObject(wa)};Ya.clearMemCache=function(){null!=this._memCache&&this._memCache.clear()};Ya.getVisibleNodes=function(){const wa=[];this._nodeId2Meta.forEach(Ia=>null!=Ia&&wa.push(Ia.node));return wa};Ya.getNodeComponentObb=function(wa){wa=this._nodeId2Meta.get(wa.index)??this._nodeId2MetaReloading.get(wa.index);return null!=wa?this._collection.getComponentObb(wa.objectHandle):null};Ya.getLoadedNodeIndices=function(wa){this._nodeId2Meta.forEach((Ia,
Ra)=>wa.push(Ra));this._nodeId2MetaReloading.forEach((Ia,Ra)=>wa.push(Ra))};Ya._preLoadBasis=function(){!f("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ba.TextureEncoding.Basis)&&h.applySome(this.i3slayer.textureSetDefinitions,wa=>wa.some(Ia=>Ia.formats.some(Ra=>"basis"===Ra.format||"ktx2"===Ra.format)))&&ib.loadBasis()};Ya._getVertexBufferLayout=function(wa,Ia){wa={hasTexture:Ga(wa.params.material),hasNormals:Ia.normal,hasRegions:Ia.uvRegion};return Va.glLayout(la.createVertexBufferLayout(this._getGeometryParameters(wa)))};
Ya._getObjectIdField=function(){return this.i3slayer.objectIdField||P.fallbackObjectIDAttribute};Ya._getGlobalIdField=function(){return this.i3slayer.associatedLayer?.globalIdField};Ya._findGraphicNodeAndIndex=function(wa){const Ia=Ha.attributeLookup(this.i3slayer.fieldsIndex,wa.attributes,this._getObjectIdField());let Ra=null;e.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;const Za=Ta.featureIds.indexOf(Ia);if(-1===Za)return!1;Ra={node:Ta.node,index:Za};return!0});return Ra};Ya._getGraphicIndices=
function(wa,Ia){wa=this._nodeId2Meta.get(wa.index);if(null==wa)return[];const Ra=[],Ta=this._getObjectIdField(),Za=this.i3slayer.fieldsIndex;for(const gb of Ia)Ia=Ha.attributeLookup(Za,gb.attributes,Ta),Ia=wa.featureIds.indexOf(Ia),-1!==Ia&&Ra.push(Ia);return Ra};Ya.whenGraphicBounds=function(wa){wa=this._findGraphicNodeAndIndex(wa);if(!wa)return Promise.reject();wa=this._getAABB(wa.node.index,wa.index);return null==wa?Promise.reject():Promise.resolve({boundingBox:wa,screenSpaceObjects:[]})};Ya.getAABBFromIntersectorTarget=
function(wa){return null==wa.nodeIndex||null==wa.componentIndex?null:this._getAABB(wa.nodeIndex,wa.componentIndex)};Ya._getAABB=function(wa,Ia){wa=this._nodeId2Meta.get(wa);if(null==wa||null==wa.featureIds||Ia>=wa.featureIds.length)return null;Ia=qa.boundingBoxCornerPoints(Ia,this._collection,wa.objectHandle,J.newDoubleArray(24),0);if(!O.projectBuffer(Ia,this.view.renderSpatialReference,0,Ia,this.view.spatialReference,0,8))return null;wa=I.empty();I.expandWithBuffer(wa,Ia,0,8);return wa};Ya.whenGraphicAttributes=
function(wa,Ia){return va.whenGraphicAttributes(this.i3slayer,wa,this._getObjectIdField(),Ia,()=>[...this._nodeId2Meta.values()].filter(q.isSome))};Ya.getGraphicFromIntersectorTarget=function(wa){if(null==wa.nodeIndex||null==wa.componentIndex)return null;const Ia=this._nodeId2Meta.get(wa.nodeIndex);return null==Ia||null==Ia.featureIds||wa.componentIndex>=Ia.featureIds.length?null:this._createGraphic(wa.componentIndex,Ia)};Ya._getCacheKey=function(wa){return`${this._layerUrl}/v${23}/${wa}${this._cacheKeySuffix}`};
Ya._getMemCacheKey=function(wa,Ia=this.elevationOffset){return wa+"#"+Ia};Ya.loadCachedGPUData=function(wa){return null!=this._memCache?this._memCache.pop(this._getMemCacheKey(wa)):null};Ya.deleteCachedGPUData=function(wa){null!=wa&&this._deleteComponentObject(wa)};Ya._cacheGPUData=function(wa,Ia=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(wa);else{var Ra=this._controller.indexDepth-wa.node.level;this._memCache.put(this._getMemCacheKey(wa.node.index,Ia),wa,wa.node.memory,
Ra)}};Ya.loadMissingTextures=function(wa,Ia,Ra,Ta){const Za=wa?.filter((gb,lb)=>{if(0===(gb.usage&this.rendererTextureUsage))return!1;if(null==Ia)return!0;gb=sa.selectEncoding(gb.encodings,this.supportedTextureEncodings);lb=Ia[lb];return null==lb||null==lb.data||gb&&lb.encoding!==gb.encoding?!0:!1})??[];return 0===Za.length?Promise.resolve(!1):Ra(Za,Ta).then(gb=>{let lb=0;for(let ob=0;ob<wa.length;ob++)lb<gb.length&&gb[lb].id===wa[ob].id&&(Ia[ob]=gb[lb],lb++);return!0})};Ya.loadCachedNodeData=function(wa,
Ia,Ra){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(wa.id),Ia).then(Ta=>{if(null==Ta)return null;if(Ta.nodeVersion!==wa.version)return this._idbCache.remove(this._getCacheKey(wa.id)),null;this.elevationInfo.mode===b.ElevationMode.Absolute&&(wa.geometryObb=Ta.geometryObb);return this.loadMissingTextures(Ta.requiredTextures,Ta.textureData,Ra,Ia).then(Za=>{Za&&this._idbCache.initialized&&null!=Ta.textureData&&(Ta.byteSize=xa(Ta.transformedGeometry,Ta.textureData),Ta.textureData.every(Fa)&&
ya(wa,Ta)&&this._idbCache.put(this._getCacheKey(wa.id),Ta).catch(gb=>db.warn(`Failed to update node with textures in IndexedDB cache: ${wa.id}: ${gb}`)));n.throwIfAborted(Ia);return Ta})}):Promise.resolve(null)};Ya.addNode=function(wa,Ia,Ra){return"geometryData"in Ia?null==Ia.geometryBuffer?(this._addNodeMeta(wa.index,null),Promise.resolve()):this._addData(wa,Ia.attributeDataInfo,()=>this._transformNode(wa,Ia,Ra).then(Ta=>this._safeReschedule(()=>{if(null==Ta)return wa.hasModifications=!1,this._addCachedNodeData(wa,
null,Ra);wa.hasModifications=Ta.transformedGeometry.hasModifications;const {obb:Za,componentOffsets:gb,featureIds:lb,anchorIds:ob,anchors:ub,transformedGeometry:yb}=Ta;var Bb=ra.computeGlobalTransformation(wa.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),Gb=La.create([Za.center.x,Za.center.y,Za.center.z],[Za.extents.x,Za.extents.y,Za.extents.z],E.fromValues(Za.orientation.x,Za.orientation.y,Za.orientation.z,Za.orientation.w));F.transformMat4(Gb.center,Gb.center,
Bb);this.elevationInfo.mode===b.ElevationMode.Absolute&&(wa.geometryObb=Gb);Ia.geometryData.componentOffsets=gb;lb&&(Ia.geometryData.featureIds=Array.from(lb));Ia.geometryData.anchorIds=ob;Ia.geometryData.anchors=ub;Bb={nodeVersion:wa.version,geometryData:Ia.geometryData,requiredTextures:Ia.requiredTextures,textureData:Ia.textureData,transformedGeometry:yb,globalTrafo:Bb,geometryObb:Gb,byteSize:xa(yb,Ia.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&ya(wa,Bb)&&(Gb=null!=Bb.textureData?
Bb.textureData.map(Kb=>Fa(Kb)?Kb:null):null,this._idbCache.put(this._getCacheKey(wa.id),{...Bb,textureData:Gb}).catch(Kb=>db.warn(`Failed to store node in IndexedDB cache: ${wa.id}: ${Kb}`)));return this._addCachedNodeData(wa,Bb,Ra)},Ra))):Promise.reject()};Ya.getElevationRange=function(wa){let Ia=Infinity,Ra=-Infinity;const Ta=L.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference);this._nodeId2Meta.forEach(Za=>{if(null!=Za&&null!=Za.node.geometryObb&&La.intersectSphere(Za.node.geometryObb,
wa)){var gb=this._collection.getObjectTransform(Za.objectHandle);gb=this.view.renderCoordsHelper.getAltitude(gb.position);for(let ob=0;ob<Za.featureIds.length;ob++){var lb=this._collection.getComponentAabb(Za.objectHandle,ob,jb);if("local"===this.view.viewingMode)Ia=Math.min(Ia,gb+lb[2]),Ra=Math.max(Ra,gb+lb[5]);else{Ia=Math.min(Ia,gb+lb[2]);const ub=Math.max(Math.abs(lb[3]),Math.abs(lb[0])),yb=Math.max(Math.abs(lb[4]),Math.abs(lb[1]));lb=gb+lb[5]+Ta.radius;Ra=Math.max(Ra,Math.sqrt(ub*ub+yb*yb+lb*
lb)-Ta.radius)}}}});return{min:Ia,max:Ra}};Ya.computeVisibilityObb=function(wa){return va.computeVisibilityObb(wa,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Ya._transformNode=function(wa,Ia,Ra){var Ta=Ia.geometryData.geometries??[];const Za=Array(Ta.length);for(var gb=0;gb<Ta.length;++gb)Za[gb]=this._getVertexBufferLayout(Ta[gb],Ia.geometryDescriptor);Ta=wa.mbs;gb=this.elevationOffset;var lb=this._controller.crsIndex,
ob=this._controller.crsVertex;const ub=this.view.renderSpatialReference,yb=ra.getLocalOrigin(Ta,gb,lb),Bb=ra.computeGlobalTransformation(Ta,gb,lb,ub);lb=O.getProjectorName(lb,ob);ob=O.getProjectorName(ob,ub);return null==lb||null==ob?Promise.resolve(null):this._worker.invoke({context:this.uid,geometryBuffer:Ia.geometryBuffer,geometryData:Ia.geometryData,geometryDescriptor:Ia.geometryDescriptor,layouts:Za,localOrigin:yb,globalTrafo:Bb,mbs:Ta,obb:wa.serviceObb,elevationOffset:gb,needNormals:!this._isIntegratedMesh&&
this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:lb,vertexToRenderProjector:ob},Ra)};Ya._setNewNodeOpacity=function(wa){this._setNodeOpacity(wa,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Ya.addCachedGPUData=function(wa,Ia,Ra){this.elevationInfo.mode===b.ElevationMode.Absolute&&(wa.geometryObb=La.clone(this._collection.getComponentObb(Ia.objectHandle)));this._controller.isGeometryVisible(wa)?(null!=this._labeler&&this._addMetaToLabeler(this._labeler,
Ia),wa=wa.index,this._addNodeMeta(wa,Ia),this.updateNodeState(wa,Ra),this._collection.setObjectVisibility(Ia.objectHandle,cb.State.Visible),this._updateMaterial(Ia),this._setNewNodeOpacity(Ia),this.elevationInfo.mode!==b.ElevationMode.Absolute&&this._ensureElevationTask().schedule(wa),this._updateEngineObject(Ia),this._highlights.objectCreated(Ia),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(Ia)};Ya.addCachedNodeData=function(wa,Ia,Ra,Ta){return this._addData(wa,Ra,()=>
this._addCachedNodeData(wa,Ia,Ta))};Ya.deleteCachedNodeData=async function(wa){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(wa))};Ya._addCachedNodeData=async function(wa,Ia,Ra){if(this.contentVisible&&this._controller.isGeometryVisible(wa))if(null==Ia)this._addNodeMeta(wa.index,null);else{var Ta=this._addTasks.get(wa.index),{geometryData:Za,transformedGeometry:gb,globalTrafo:lb}=Ia;await this.i3sOverrides.applyAttributeOverrides(Za.featureIds,Ta.attributeInfo,Ra);var ob=
null!=Ia.textureData?Ia.textureData.filter(Pb=>null!=Pb&&0!==(Pb.usage&this.rendererTextureUsage)):[];!f("disable-feature:i3s-basis")&&ob.some(Pb=>null!=Pb&&(Pb.encoding===ba.TextureEncoding.Basis||Pb.encoding===ba.TextureEncoding.KTX2))&&await ib.loadBasis();wa.memory=0;var {componentOffsets:ub,geometries:yb,featureIds:Bb,anchorIds:Gb,anchors:Kb}=Za,Ob=this._collection,qb=yb[0],{layout:xb,indices:zb,interleavedVertexData:Hb,positionData:Jb,hasColors:Yb}=gb,Cb=this._materialParameters(qb,xb),Sb=ub||
new Uint32Array([0,zb?zb.length:Hb.byteLength/xb[0].stride]);Sb={vertices:{data:Hb,count:Hb.byteLength/xb[0].stride,layoutParameters:Cb.geometryParams},positionData:{positions:N.compactFloatArray(Jb.data),indices:R.compactIndices(Jb.indices)},indices:zb,componentOffsets:Sb};var Tb=qb.transformation?C.clone(qb.transformation):C.create();B.multiply(Tb,lb,Tb);qb=B.getTranslation(M.create(),Tb);Tb=A.fromMat4(v.create(),Tb);var hc=this.view.renderSpatialReference,cc=this.view.basemapTerrain.spatialReference,
Vb=M.create(),ic=[1,1,1];O.localLinearScaleFactors(qb,hc,ic,cc)||db.errorOnce("Unsupported coordinate system for IM overlay");O.projectVectorToVector(qb,hc,Vb,cc);var Zb=Ob.createObject({toMapSpace:G.fromValues(Vb[0],Vb[1],ic[0],ic[1]),geometry:Sb,obb:Ia.geometryObb,transform:{position:qb,rotationScale:Tb}}),{textures:$b,texturePromise:ac}=this._initMaterialAndTextures(Zb,Cb.material,ob,Cb.geometryParams.textureCoordinates===eb.TextureCoordinateAttributeType.Atlas);wa.memory+=this._memEstimateGeometryAdded(Zb);
wa.memory+=$b.reduce((Pb,Ub)=>Pb+(null!=Ub?this._memEstimateTextureAdded(Ub):0),0);ob=!!Cb.material.hasParametersFromSource;Cb="blend"!==Cb.material.alphaMode&&1<=Cb.material.metallicRoughness.baseColorFactor[3];var Lb=new kb(wa,Bb,Zb,this._getInvalidRendererVersion(),Ta.attributeInfo,{hasParametersFromSource:ob,isOpaque:Cb},$b,Gb,Kb);Ta.meta=Lb;!this._hasTextures&&Ia.requiredTextures?.some(({usage:Pb})=>0!==(Pb&ba.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=
this._hasColors||Yb;this._hasTextures=this._hasTextures||!!wa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var lc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(Lb),ac]).then(([Pb])=>{null!=Pb&&Pb.updateObjectVisibility(Lb.objectHandle,!1).catch(Ub=>za(Ub,this.i3slayer.title));return this._safeReschedule(()=>{var Ub=this._addTasks.get(wa.index);if(Ub)if(this._addNodeMeta(wa.index,Lb),Ub.meta=null,this.contentVisible){Ob.setObjectVisibility(Zb,cb.State.Visible);
null!=Pb&&Pb.updateObjectVisibility(Lb.objectHandle,!0).catch($c=>za($c,this.i3slayer.title));Lb.attributeInfo=Ub.attributeInfo;Ub=Lb.cachedRendererVersion!==this._rendererVersion;var vc=lc!==this.slicePlaneEnabled;this._updateElevationOffsets(Lb);var Dc=Lb.elevationOffsets;this._updateComponentData(Lb);var Ec=this._applyFiltersToNode(Lb);(Ub||null!=Pb&&(vc||Ec||Dc))&&this._addOrUpdateEdgeRendering(Lb);null!=this._labeler&&this._addMetaToLabeler(this._labeler,Lb);this._visibleGeometryChanged(Lb,sb.ADD);
this._highlights.objectCreated(Lb);this._updateMaterial(Lb);this._setNewNodeOpacity(Lb);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(wa.index,this.elevationOffset)},Ra)}).catch(Pb=>{null!=Ta.meta&&(this._cacheGPUData(Ta.meta),Ta.meta=null);throw Pb;})}else this._removeNodeStageData(wa.index,this.elevationOffset,this._nodeId2MetaReloading)};Ya._addNodeMeta=function(wa,Ia){this._removeNodeStageData(wa,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(wa)){db.error("Removing duplicated node");
const Ra=this._nodeId2Meta.get(wa);null!=Ra&&this._deleteComponentObject(Ra)}else this._controller.updateLoadStatus(wa,!0);null!=Ia&&(Ia.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Oa(Ia.cachedEdgeMaterials,0));this._nodeId2Meta.set(wa,Ia)};Ya._updateElevationOffsets=function(wa){const Ia=this.view.renderSpatialReference,Ra=this._controller.crsIndex,Ta=this.elevationInfo,Za=this.view.basemapTerrain,gb=Za.spatialReference,lb=Ta.mode;if(null==Ia||null==gb||lb===b.ElevationMode.Absolute)wa.elevationOffsets=
null;else{var ob=this._collection.getObjectTransform(wa.objectHandle);wa.elevationOffsets=wa.elevationOffsets??[];var ub=lb===b.ElevationMode.OnTheGround,yb=this.view.renderCoordsHelper,Bb=wa.featureIds.length,Gb=(()=>{if(wa.cachedElevationAnchors)return wa.cachedElevationAnchors;const qb=J.newDoubleArray(3*Bb);wa.cachedElevationAnchors=qb;for(let xb=0;xb<Bb;xb++){const zb=3*xb,Hb=wa.anchorIds?.indexOf(xb)??-1;wa.anchors&&0<=Hb?(F.set(fb,wa.anchors[3*Hb],wa.anchors[3*Hb+1],wa.anchors[3*Hb+2]),F.add(fb,
fb,wa.node.mbs),O.projectVectorToVector(fb,Ra,fb,gb),qb[zb]=fb[0],qb[zb+1]=fb[1],qb[zb+2]=yb.getAltitude(fb)):(this._collection.getComponentAabb(wa.objectHandle,xb,jb,!0),F.set(fb,(jb[0]+jb[3])/2,(jb[1]+jb[4])/2,jb[2]),F.transformMat3(fb,fb,ob.rotationScale),F.add(fb,fb,ob.position),qb[zb+2]=yb.getAltitude(fb),O.projectVectorToVector(fb,Ia,fb,gb),qb[zb]=fb[0],qb[zb+1]=fb[1])}return qb})(),Kb=Ta.offset,Ob=wa.elevationOffsets;Za.getElevations(Gb,Bb,(qb,xb)=>{const zb=ub?Gb[3*qb+2]:0;Ob[qb]=Kb+(null!=
xb?xb-zb:0)})}};Ya._ensureElevationTask=function(){return null!=this._elevationTask?this._elevationTask:this._elevationTask=new da.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,wa=>{wa=this._controller.updateElevationChanged(wa,this.view.basemapTerrain.spatialReference);return null!=wa?wa.filterInPlace(Ia=>null!=this._nodeId2Meta.get(Ia)):null},wa=>{wa=this._nodeId2Meta.get(wa);this._nodeElevationAlignmentChanged(wa)})};Ya._elevationInfoChanged=function(wa,Ia){const Ra=wa.mode!==
b.ElevationMode.Absolute;wa=!!Ia&&Ia!==wa&&Ia.mode!==b.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Ra,this.view.state.viewingMode);Ra&&!wa&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Ta=>this._nodeElevationAlignmentChanged(Ta))};Ya._nodeElevationAlignmentChanged=function(wa){null!=wa&&(this._updateElevationOffsets(wa),this._updateComponentData(wa),this._updateEdgeRendering(wa),null!=this._labeler&&this._labeler.updateLabelPositions(wa),this._updateSnappingSources(wa,
sb.UPDATE))};Ya._safeReschedule=function(wa,Ia){n.throwIfAborted(Ia);return this._controller.reschedule(wa,Ia)};Ya._materialParameters=function(wa,Ia){wa=null!=wa.params.material?wa.params.material:sa.defaultMaterial();const Ra=Ia.some(Za=>"uvRegion"===Za.name);Ia=Ia.some(Za=>"normalCompressed"===Za.name);const Ta=Ga(wa);return{geometryParams:this._getGeometryParameters({hasTexture:Ta,hasNormals:Ia,hasRegions:Ra}),material:wa}};Ya._initMaterialAndTextures=function(wa,Ia,Ra,Ta){const Za=this._stage.renderView,
gb=Ra.map(ob=>sa.createTexture(ob,Ia,Ta,Za));this._stage.addMany(gb);let lb=null;this._collection.updateMaterial(wa,ob=>{lb=sa.configureMaterial(ob,Ia,gb,Ra,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(ob)});return{textures:gb,texturePromise:lb}};Ya._getGeometryParameters=
function(wa){return{textureCoordinates:wa.hasTexture?wa.hasRegions?eb.TextureCoordinateAttributeType.Atlas:eb.TextureCoordinateAttributeType.Default:eb.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:wa.hasNormals&&!this._isIntegratedMesh}};Ya._addData=function(wa,Ia,Ra){let Ta=this._addTasks.get(wa.index);Ta?Ta.attributeInfo=Ia:(Ta={...n.createResolver(),attributeInfo:Ia,meta:null},this._addTasks.set(wa.index,Ta),Ra().then(Ta.resolve,Ta.reject).then(()=>this._addTasks.delete(wa.index)).catch(Za=>
{this._addTasks.delete(wa.index);throw Za;}));return Ta.promise};Ya._clearAddTasks=function(){this._addTasks.forEach(wa=>{null!=wa.meta&&(this._cacheGPUData(wa.meta),wa.meta=null)});this._addTasks.clear()};Ya._clippingAreaChanged=function(){var wa=this.view.renderSpatialReference;const Ia=this.i3slayer.spatialReference,Ra=H.create();this._renderClippingArea=Sa.toBoundingRect(this.view.clippingArea,Ra,wa)?Ra:null;wa=H.create();this._layerClippingArea=Sa.toBoundingRect(this.view.clippingArea,wa,Ia)?
wa:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};Ya._geometryFilterChange=function(){const wa=this.hasGeometryFilter;this._controller.geometryFilterChanged(wa);this._applyFilters(wa)};Ya._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};Ya._applyFilters=function(wa){this._filters=this.getFilters();wa?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Ia=>
{null!=Ia&&this._applyFiltersToNode(Ia)&&(this._addOrUpdateEdgeRendering(Ia),this._visibleGeometryChanged(Ia,sb.UPDATE))})};Ya.getFilters=function(){const wa=[],Ia=this._renderClippingArea;null!=Ia&&wa.push((Ra,Ta)=>this._boundingRectFilter(Ra,Ta,Ia));return wa};Ya.addSqlFilter=function(wa,Ia,Ra){if(null!=Ia){const Ta=Ia.fieldNames;wa.push((Za,gb)=>this._sqlFilter(Za,gb,Ia,Ta,Ra))}};Ya._sqlFilter=function(wa,Ia,Ra,Ta,Za){const gb={},lb=this._createLayerGraphic(gb),ob=this.i3slayer.objectIdField,ub=
Ia.featureIds,yb=null!=Ia.attributeInfo&&Ia.attributeInfo.attributeData;Ta.every(Bb=>Bb===ob||yb&&null!=yb[Bb])&&va.filterInPlace(wa,ub,Bb=>{gb[ob]=ub[Bb];for(const Gb of Ta)Gb!==ob&&(gb[Gb]=yb?va.getCachedAttributeValue(yb[Gb],Bb):null);try{return Ra.testFeature(lb)}catch(Gb){return Za(Gb),!1}})};Ya._boundingRectNodeTest=function(wa,Ia){O.projectBoundingSphere(wa.node.mbs,this._controller.crsIndex,Na,this.view.renderSpatialReference);return va.intersectBoundingRectWithMbs(Ia,Na)};Ya._boundingRectFeatureTest=
function(wa,Ia,Ra){this._collection.getComponentAabb(wa.objectHandle,Ia,Ab);I.toRect(Ab,Ib);return H.intersects(Ra,Ib)};Ya._boundingRectFilter=function(wa,Ia,Ra){var Ta=this._collection;const Za=this._boundingRectNodeTest(Ia,Ra);if(Za!==va.MbsIntersectResult.INSIDE)if(Za===va.MbsIntersectResult.OUTSIDE)wa.length=0;else if(Ta=Ta.getComponentCount(Ia.objectHandle),Ta.invisible+Ta.visible===Ia.featureIds.length){var gb=this._transformClippingArea(rb,Ra,Ia.objectHandle);va.filterInPlace(wa,Ia.featureIds,
lb=>this._boundingRectFeatureTest(Ia,lb,gb))}};Ya._transformClippingArea=function(wa,Ia,Ra){var Ta=this._collection.getObjectTransform(Ra);Ra=Ta.position;Ta=Ta.rotationScale;wa[0]=(Ia[0]-Ra[0])/Ta[0];wa[1]=(Ia[1]-Ra[1])/Ta[4];wa[2]=(Ia[2]-Ra[0])/Ta[0];wa[3]=(Ia[3]-Ra[1])/Ta[4];return wa};Ya._addOrUpdateEdgeRendering=function(wa,Ia=!0){const Ra=this._edgeView;if(null==Ra)return Promise.resolve(null);const Ta=wa.objectHandle;var Za=Ra.hasObject(Ta);const {hasEdges:gb,perFeatureEdgeMaterials:lb}=this._getFilteredEdgeMaterials(wa),
ob={hasSlicePlane:this.slicePlaneEnabled};if(gb&&Za)return this.nodeCrossfadingEnabled&&(Za=this.getNodeOpacity(wa),Oa(lb,Za)),Ra.updateAllComponentMaterials(Ta,lb,ob,Ia).catch(ub=>za(ub,this.i3slayer.title)),Ra.updateObjectVisibility(Ta,!0).catch(ub=>za(ub,this.i3slayer.title)),Ra.updateAllVerticalOffsets(Ta,wa.elevationOffsets).catch(ub=>za(ub,this.i3slayer.title)),Promise.resolve(Ra);if(gb&&!Za)return this._collection.addEdges(Ta,Ra,lb,ob).then(ub=>{wa.edgeMemoryUsage=ub;wa.node.memory+=ub;Ra.updateAllVerticalOffsets(Ta,
wa.elevationOffsets).catch(yb=>za(yb,this.i3slayer.title));return Ra});!gb&&Za&&(wa.node.memory-=wa.edgeMemoryUsage,wa.edgeMemoryUsage=0,Ra.removeObject(Ta));return Promise.resolve(null)};Ya._applyFiltersToNode=function(wa){return this._applyFiltersToNodeComponents(wa)?(null!=this._labeler&&this._labeler.applyFilterChange(wa),!0):!1};Ya._applyFiltersToNodeComponents=function(wa){const Ia=this._collection;var Ra=0===Ia.getComponentCount(wa.objectHandle).invisible;Ia.setAllComponentVisibilities(wa.objectHandle,
"all");if(0===this._filters.length)return wa.filteredIds=null,!Ra;this._updateCachedFilteredIds(wa);if(wa.filteredIds===wa.featureIds)return!Ra;Ra=this._computeFilteredComponentIndices(wa);Ia.setAllComponentVisibilities(wa.objectHandle,Ra);return!0};Ya._updateCachedFilteredIds=function(wa){if(null==wa.filteredIds||wa.appliedFilters!==this._filters)wa.filteredIds=this._computeFilteredIds(wa),wa.appliedFilters=this._filters};Ya._computeFilteredIds=function(wa){const Ia=wa.featureIds.slice();for(const Ra of this._filters)if(Ra(Ia,
wa),0===Ia.length)break;return Ia.length===wa.featureIds.length?wa.featureIds:Ia};Ya._computeFilteredComponentIndices=function(wa){const Ia=[],Ra=wa.filteredIds;null!=Ra&&wa.featureIds.forEach((Ta,Za)=>{Ra[Ia.length]===Ta&&Ia.push(Za)});return Ia};Ya._removeAllNodeDataFromStage=function(wa=this.elevationOffset){this._nodeId2Meta.forEach((Ia,Ra)=>this._removeNodeStageData(Ra,wa));this._nodeId2MetaReloading.forEach((Ia,Ra)=>this._removeNodeStageData(Ra,wa,this._nodeId2MetaReloading));this._elevationTask=
h.destroyMaybe(this._elevationTask)};Ya.removeNode=function(wa){const Ia=this.elevationOffset;this._removeNodeStageData(wa,Ia);this._removeNodeStageData(wa,Ia,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(wa)};Ya._removeNodeStageData=function(wa,Ia,Ra=this._nodeId2Meta){Ra.has(wa)&&this._controller.updateLoadStatus(wa,!1);const Ta=Ra.get(wa);null==Ta?Ra.delete(wa):(this._collection.setObjectVisibility(Ta.objectHandle,cb.State.Hidden),null!=this._edgeView&&this._edgeView.hasObject(Ta.objectHandle)&&
this._edgeView.updateObjectVisibility(Ta.objectHandle,!1).catch(Za=>za(Za,this.i3slayer.title)),this._visibleGeometryChanged(Ta,sb.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(Ta),Ra.delete(wa),this._highlights.objectDeleted(Ta),Ra===this._nodeId2Meta?(this._cacheGPUData(Ta,Ia),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Ta)):this._deleteComponentObject(Ta),null!=this._treeDebugger&&this._treeDebugger.update())};Ya._deleteComponentObject=function(wa){null!=this._edgeView&&
this._edgeView.removeObject(wa.objectHandle);this._memEstimateGeometryRemoved(wa.objectHandle);this._collection.destroyObject(wa.objectHandle);if(wa.textures)for(const Ia of wa.textures)this._memEstimateTextureRemoved(Ia),this._stage.remove(Ia)};Ya.updateNodeState=function(wa,Ia){wa=this._nodeId2Meta.get(wa);null!=wa&&this._collection.updateMaterial(wa.objectHandle,Ra=>Ra.polygonOffsetEnabled=Ia===pa.NodeState.Hole)};Ya.updateNodeIndex=function(wa,Ia){if(this._nodeId2Meta.has(wa)){var Ra=this._nodeId2Meta.get(wa);
this._nodeId2Meta.delete(wa);this._nodeId2Meta.set(Ia,Ra)}if(Ra=this._nodeId2MetaReloading.get(wa))this._nodeId2MetaReloading.delete(wa),this._nodeId2MetaReloading.set(Ia,Ra)};Ya._invalidateAllSymbols=function(){this._rendererVersion=va.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Ya._getInvalidRendererVersion=function(){return va.addWraparound(this._rendererVersion,-1)};Ya._rendererChange=async function(wa){this._currentRenderer=wa;this.notifyChange("rendererTextureUsage");
this._rendererVersion=va.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();wa&&(this._rendererFields=await wa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&wa&&"arcadeRequired"in wa&&wa.arcadeRequired&&(this._arcade=await X.loadArcade());if(wa&&"visualVariables"in wa&&wa.visualVariables)for(const Ia of wa.visualVariables)"color"===Ia.type?this._colorVariable=Ia:"opacity"===
Ia.type?this._opacityVariable=Ia:db.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ia.type}`);if(wa)for(const Ia of wa.getSymbols())"mesh-3d"!==Ia.type&&db.error(`Symbols of type '${Ia.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()};Ya._getCachedEdgeMaterials=function(wa){this._hasComponentData&&wa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(wa);return wa.cachedEdgeMaterials};Ya._getComponentParameters=
function(wa){this._hasComponentData&&wa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(wa);const Ia=wa.cachedSymbology;return(Ra,Ta)=>{const Za=5*Ra;K.set(Ta.externalColor,Ia[Za]/255,Ia[Za+1]/255,Ia[Za+2]/255,Ia[Za+3]/255);if(null!=this._stage.renderView.objectAndLayerIdRenderHelper){const gb=wa.featureIds[Ra],lb=Y.isBasemapLayer(this.view.map,this.layerUid);this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(gb,gb,this.layerId,this.layerUid+
"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&!lb,wa.node.resources.attributes,Ra,this.sublayerId);Ta.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:gb,layerUid:this.layerUid+"_"+this.sublayerId})}Ta.externalColorMixMode=Ia[Za+4]&(1<<wb.CastShadows)-1;Ta.castShadows=0!==(Ia[Za+4]&1<<wb.CastShadows);Ta.pickable=0!==(Ia[Za+4]&1<<wb.Pickable);Ta.elevationOffset=wa.elevationOffsets?.[Ra]??0}};Ya._getSymbolInfo=function(wa,Ia){Ia=wa&&wa.getSymbol(Ia,{arcade:this._arcade});
if(!(Ia instanceof Z))return null;wa=Ia.id;if(this._symbolInfos.has(wa))return this._symbolInfos.get(wa);Ia=va.getSymbolInfo(Ia);this._symbolInfos.set(wa,Ia);return Ia};Ya._setSymbologyOverride=function(wa,Ia){this._symbologyOverride!==wa&&(this._symbologyOverride=wa,this._symbologyOverrideFields=Ia,this._invalidateAllSymbols(),this._updateSymbologyFields())};Ya._updateSymbologyFields=function(){this._symbologyFields=null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=
this._rendererFields&&0<this._rendererFields.length?S.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};Ya._updateCachedRendererData=function(wa){wa.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Ia=this._tmpAttributeOnlyGraphic,Ra={};Ia.attributes=Ra;var Ta=this._currentRenderer,Za=wa.attributeInfo?.attributeData,gb=null!=wa.featureIds?this.i3slayer.objectIdField:null,lb=
null!=Za&&null!=this._symbologyFields&&0<this._symbologyFields.length,ob=null,ub=null;if(lb&&null!=this._symbologyFields){ob=[];ub=[];for(var yb of this._symbologyFields){var Bb=Za[yb];Bb&&(ob.push(yb),ub.push(Bb))}}wa.cachedSymbology||(wa.cachedSymbology=T.newUByteArray(5*wa.featureIds.length));Za={color:hb,castShadows:!0,pickable:!0,colorMixMode:Ma.ColorMixModeEnum.Multiply,edgeMaterial:null};yb=this.fullOpacity;yb=this.nodeCrossfadingEnabled?this.getNodeOpacity(wa):yb;Bb=null;var Gb=Pa.Transparency.OPAQUE,
Kb=va.transparentEdgeMaterial,Ob=0;for(let Hb=0;Hb<wa.featureIds.length;Hb++){null!=gb&&(Ra[gb]=wa.featureIds[Hb]);if(lb&&ob)for(var qb=0;qb<ob.length;qb++)Ra[ob[qb]]=va.getCachedAttributeValue(ub[qb],Hb);var xb=Ta?this._getSymbolInfo(Ta,Ia):null;let Jb=qb=null;if(Ta&&"visualVariables"in Ta){if(this._colorVariable){var zb=V.getColor(this._colorVariable,Ia,{color:Ja,arcade:this._arcade});zb&&(qb=hb,qb[0]=zb.r/255,qb[1]=zb.g/255,qb[2]=zb.b/255,this._opacityVariable||null===zb.a||(Jb=zb.a))}this._opacityVariable&&
(Jb=V.getOpacity(this._opacityVariable,Ia,{arcade:this._arcade}))}xb&&xb.material&&(zb=xb.material,qb=null==qb||null==Jb?ma.overrideColor(qb,Jb,zb.color,zb.alpha,nb,hb):ma.overrideColor(qb,Jb,null,null,nb,hb));null==qb&&(qb=hb,qb[0]=1,qb[1]=1,qb[2]=1,qb[3]=1);Za.pickable=!0;Za.castShadows=xb?xb.castShadows:!0;Za.colorMixMode=xb&&xb.material?xb.material.colorMixMode:Ma.ColorMixModeEnum.Multiply;Za.edgeMaterial=xb?xb.edgeMaterial:null;null!=this._symbologyOverride&&(Za.color=qb,this._symbologyOverride(Ia,
Za),qb=Za.color);if(null!=Za.edgeMaterial){xb=0>=qb[3]?Pa.Transparency.INVISIBLE:1<=qb[3]&&(wa.material.isOpaque||Za.colorMixMode===Ma.ColorMixModeEnum.Replace)?Pa.Transparency.OPAQUE:Pa.Transparency.TRANSPARENT;if(Za.edgeMaterial!==Bb||xb!==Gb)Kb={...Za.edgeMaterial,opacity:yb,objectTransparency:xb},Bb=Za.edgeMaterial,Gb=xb;wa.cachedEdgeMaterials[Hb]=Kb}else wa.cachedEdgeMaterials[Hb]=va.transparentEdgeMaterial;wa.cachedSymbology[Ob++]=Math.round(255*qb[0]);wa.cachedSymbology[Ob++]=Math.round(255*
qb[1]);wa.cachedSymbology[Ob++]=Math.round(255*qb[2]);wa.cachedSymbology[Ob++]=Math.round(255*qb[3]);wa.cachedSymbology[Ob++]=Za.colorMixMode|+Za.castShadows<<wb.CastShadows|+Za.pickable<<wb.Pickable}}};Ya._getFilteredEdgeMaterials=function(wa){var Ia=this._getCachedEdgeMaterials(wa);this.nodeCrossfadingEnabled||Oa(Ia,this.fullOpacity);const Ra=wa.filteredIds;if(null==Ra)return{hasEdges:Ia.some(gb=>gb!==va.transparentEdgeMaterial),perFeatureEdgeMaterials:Ia};let Ta=0,Za=!1;Ia=Ia.map((gb,lb)=>{if(wa.featureIds[lb]!==
Ra[Ta])return va.transparentEdgeMaterial;Za=Za||gb!==va.transparentEdgeMaterial;Ta++;return gb});return{hasEdges:Za,perFeatureEdgeMaterials:Ia}};Ya._updateComponentData=function(wa){if(this._hasComponentData){var Ia=wa.objectHandle;wa=this._getComponentParameters(wa);this._collection.setComponentData(Ia,wa);this._stage.renderView.requestRender()}};Ya._reloadAll=function(wa=this.elevationOffset){this._removeAllNodeDataFromStage(wa);null!=this._controller&&this._controller.restartNodeLoading()};Ya._opacityChange=
function(wa){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Ia=>{null!=Ia&&(this._collection.updateMaterial(Ia.objectHandle,Ra=>Ra.objectOpacity=wa),Oa(Ia.cachedEdgeMaterials,wa),this._updateEdgeRendering(Ia))})};Ya._updateMaterial=function(wa){this._collection.updateMaterial(wa.objectHandle,Ia=>{Ia.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Ia.usePBR=this._usePBR;this._updateMaterialOverlay(Ia)})};Ya._updateMaterialOverlay=function(wa){};
Ya._updateEngineObject=function(wa){this._updateComponentData(wa);this._applyFiltersToNode(wa);this._addOrUpdateEdgeRendering(wa);this._visibleGeometryChanged(wa,sb.UPDATE)};Ya._slicePlaneEnabledChange=function(wa){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=wa);null!=this._labeler&&(this._labeler.slicePlaneEnabled=wa);this._nodeId2Meta.forEach(Ia=>{null!=Ia&&(this._collection.updateMaterial(Ia.objectHandle,Ra=>Ra.commonMaterialParameters.hasSlicePlane=wa),this._updateEdgeRendering(Ia,
!1))})};Ya._updatePBR=function(wa){this._nodeId2Meta.forEach(Ia=>{null!=Ia&&this._collection.updateMaterial(Ia.objectHandle,Ra=>Ra.usePBR=wa)});this._hasLoadedPBRTextures=!0};Ya._updateEdgeRendering=function(wa,Ia=!0){null!=this._edgeView&&this._edgeView.hasObject(wa.objectHandle)&&this._addOrUpdateEdgeRendering(wa,Ia)};Ya._forAllNodes=function(wa){this._nodeId2Meta.forEach(wa)};Ya._ignoreClientNodeOverriddenFeatures=function(wa){return this.i3sOverrides.hasGeometryChanges?wa:(Ia,Ra,Ta)=>0<=Ta.node.index&&
this.i3sOverrides.featureHasGeometryChanges(Ia)?ia.ForAllFeaturesReturnType.CONTINUE:wa(Ia,Ra,Ta)};Ya._forAllFeatures=function(wa,Ia,Ra){e.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;if(null!=Ia)switch(Ia(Ta)){case ia.ForAllFeaturesReturnType.EXIT:return!0;case ia.ForAllFeaturesReturnType.SKIP:return!1}let Za=ia.ForAllFeaturesReturnType.CONTINUE;switch(Ra){case ia.ForAllFeaturesMode.ALL:Za=this._forAllFeaturesOfNode(Ta,wa);break;case ia.ForAllFeaturesMode.VISIBLE_ONLY:Za=this._forAllVisibleFeaturesOfNode(Ta,
wa);break;case ia.ForAllFeaturesMode.QUERYABLE:Za=this._forAllQueryableFeaturesOfNode(Ta,wa)}return Za===ia.ForAllFeaturesReturnType.EXIT})};Ya._forAllFeaturesOfNode=function(wa,Ia){let Ra=ia.ForAllFeaturesReturnType.CONTINUE;const Ta=wa.featureIds;for(let Za=0;Za<Ta.length&&(Ra=Ia(Ta[Za],Za,wa),Ra!==ia.ForAllFeaturesReturnType.EXIT);Za++);return Ra};Ya._forAllVisibleFeaturesOfNode=function(wa,Ia){let Ra=ia.ForAllFeaturesReturnType.CONTINUE;const Ta=wa.featureIds;this._collection.forEachVisibleComponent(wa.objectHandle,
Za=>{Ra=Ia(Ta[Za],Za,wa);return Ra===ia.ForAllFeaturesReturnType.CONTINUE});return Ra};Ya._forAllQueryableFeaturesOfNode=function(wa,Ia){Ia=this._ignoreClientNodeOverriddenFeatures(Ia);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(wa,Ia);var Ra=this._boundingRectNodeTest(wa,this._renderClippingArea);if(Ra===va.MbsIntersectResult.OUTSIDE)return ia.ForAllFeaturesReturnType.CONTINUE;if(Ra===va.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(wa,Ia);Ra=ia.ForAllFeaturesReturnType.CONTINUE;
const Ta=wa.featureIds,Za=va.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(wa.objectHandle));for(let gb=0;gb<Ta.length;gb++){if(!this._boundingRectFeatureTest(wa,gb,Za))continue;const lb=Ia(Ta[gb],gb,wa);if(lb===ia.ForAllFeaturesReturnType.EXIT)return lb}return Ra};Ya._createAttributes=function(wa,Ia){const Ra={};null!=Ia.featureIds&&(Ra[this._getObjectIdField()]=Ia.featureIds[wa]);Ia=Ia.attributeInfo?.attributeData;if(null!=Ia)for(const Ta of Object.keys(Ia))Ra[Ta]=va.getCachedAttributeValue(Ia[Ta],
wa);return Ra};Ya._createGraphic=function(wa,Ia){return this._createLayerGraphic(this._createAttributes(wa,Ia))};Ya.highlight=function(wa){const Ia=this._highlights;"number"===typeof wa?wa=[wa]:wa instanceof u?wa=[wa]:wa instanceof d&&(wa=wa.toArray());if(Array.isArray(wa)&&0<wa.length){if(wa[0]instanceof u){const Ra=this.i3slayer.fieldsIndex,Ta=this._getObjectIdField();wa=wa.map(lb=>Ha.attributeLookup(Ra,lb.attributes,Ta));const {set:Za,handle:gb}=Ia.acquireSet();Ia.setFeatureIds(Za,wa);return gb}if("number"===
typeof wa[0]){const {set:Ra,handle:Ta}=Ia.acquireSet();Ia.setFeatureIds(Ra,wa);return Ta}}return Xa};Ya.resetHighlights=function(){h.destroyMaybe(this._highlights);this._highlights=new aa({collection:this._collection,forAllFeatures:wa=>this._forAllFeatures(wa,null,ia.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(wa,Ia)=>this._forAllFeaturesOfNode(wa,Ia)})};Ya._visibleGeometryChanged=function(wa,Ia){this._elevationProvider&&(this._elevationProvider.objectChanged(wa.node),null==this._visibleGeometryChangedSchedulerHandle&&
(this._visibleGeometryChangedSchedulerHandle=m.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(wa,Ia))};Ya.getNodeOpacityByIndex=function(wa){wa=this._nodeId2Meta.get(wa);return this.getNodeOpacity(wa)};Ya.getNodeOpacity=function(wa){return null!=wa?this._collection.getMaterial(wa.objectHandle).objectOpacity:0};Ya.isNodeFullyFadedIn=function(wa){return this._crossfadeHelper.isNodeFullyFadedIn(wa)};Ya.getNodeCrossfadeMetaData=
function(wa){return this._nodeId2Meta.get(wa)};Ya.markNodeToRemove=function(wa){this._controller&&this._controller.markNodeToRemove(wa)};Ya.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Ya.foreachCrossfadeNode=function(wa){this._nodeId2Meta.forEach((Ia,Ra)=>wa(Ra,Ia))};Ya.fadeNode=function(wa,Ia,Ra){if(this.nodeCrossfadingEnabled){var Ta=this._nodeId2Meta.get(wa);null!=Ta&&this._crossfadeHelper.fadeNode(wa,Ta,Ia,Ra)}};Ya.setNodeOpacityByIndex=function(wa,Ia){wa=
this._nodeId2Meta.get(wa);null!=wa&&this._setNodeOpacity(wa,Ia)};Ya._setNodeOpacity=function(wa,Ia){this._collection.updateMaterial(wa.objectHandle,Ra=>Ra.objectOpacity=Ia);this._setNodeEdgeOpacity(wa,Ia)};Ya._setNodeEdgeOpacity=function(wa,Ia){null!=this._edgeView&&wa.cachedEdgeMaterials&&(Oa(wa.cachedEdgeMaterials,Ia),wa=wa.objectHandle,this._edgeView.hasObject(wa)&&this._edgeView.updateAllComponentOpacities(wa,Ia).catch(Ra=>za(Ra,this.i3slayer.title)))};Ya.updateNodeModificationStatus=function(wa){var Ia=
wa.length;if(this.hasModifications&&!(0>=Ia)&&!0===this._i3sWasmLoaded){Ia=this.uid;var Ra=Ea(wa);if(null!=Ra){oa.filterObbsForModificationsSync({context:Ia,buffer:Ra.buffer});const Ta=new Float64Array(Ra.buffer);wa.forAll((Za,gb)=>{gb=oa.interpretObbModificationResults(Ta[gb]);Za.imModificationImpact=gb;gb!==pa.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Za.index)})}}};Ya.notifyUpdate=function(){this.notifyChange("updating")};Ya.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};
Ya.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||null!=this._elevationTask&&this._elevationTask.running};Ya.trackSnappingSources=function(wa){const Ia={events:wa,fetchEdgeLocations:async(Ra,Ta,Za)=>{Ra=this._nodeId2Meta.get(Ra);if(null==Ra)throw Error("invalid-node");const {origin:gb,
buffer:lb}=await this._collection.extractEdgeInformation(Ra.objectHandle,Ta,Za);this._snappingLocationsApplyElevation(Ra,lb,gb);return{type:"components",objectIds:Ra.featureIds,locations:lb,origin:gb}},remove:()=>{q.removeUnordered(this._snappingSourcesTrackers,Ia)}};this._snappingSourcesTrackers.push(Ia);this._nodeId2Meta.forEach((Ra,Ta)=>{null!=Ra&&(Ra=this._controller.getRenderMbs(Ra.node),null!=Ra&&wa.add(Ta,Ra))});return Ia};Ya._snappingLocationsApplyElevation=function(wa,Ia,Ra){if(wa.elevationOffsets&&
this.elevationInfo.mode!==b.ElevationMode.Absolute){var Ta=Ia.position0,Za=Ia.position1;Ia=Ia.componentIndex;var gb=M.create(),lb=M.create(),ob=(ub,yb)=>{F.add(ub,ub,Ra);this.view.renderCoordsHelper.worldUpAtPosition(ub,lb);F.add(ub,ub,F.scale(lb,lb,yb));F.subtract(ub,ub,Ra)};for(let ub=0;ub<Ta.count;ub++){const yb=wa.elevationOffsets[Ia.get(ub)];Ta.getVec(ub,gb);ob(gb,yb);Ta.setVec(ub,gb);Za.getVec(ub,gb);ob(gb,yb);Za.setVec(ub,gb)}}};Ya._updateSnappingSources=function(wa,Ia){const {index:Ra}=wa.node;
wa=this._controller.getRenderMbs(wa.node);if(null!=wa)for(const Ta of this._snappingSourcesTrackers)Ia!==sb.REMOVE&&Ia!==sb.UPDATE||Ta.events.remove(Ra),Ia!==sb.ADD&&Ia!==sb.UPDATE||Ta.events.add(Ra,wa)};c._createClass(tb,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},
{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},{key:"contentVisible",get:function(){return!this.suspended&&this._controller?.rootNodeVisible}},{key:"legendEnabled",get:function(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?
"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return va.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.AllTexturesPBR:ba.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.GeometryTexturesPBR:ba.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const wa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=wa&&"absolute-height"===wa.mode){const Ia=w.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),
Ra=ea.getMetersPerUnit(wa.unit);return(wa.offset??0)*Ra/Ia}return 0}},{key:"elevationInfo",get:function(){const wa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==wa)return{mode:b.ElevationMode.Absolute,offset:0};var Ia=w.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Ra=ea.getMetersPerUnit(wa.unit);Ia=(wa.offset??0)*Ra/Ia;switch(wa.mode){case "absolute-height":return{mode:b.ElevationMode.Absolute,offset:Ia};case "relative-to-ground":return{mode:b.ElevationMode.RelativeToGround,
offset:Ia};case "on-the-ground":return{mode:b.ElevationMode.OnTheGround,offset:0};default:return{mode:b.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return sa.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){const wa=0===(this.supportedTextureEncodings&ba.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&wa}},{key:"clientGeometry",
get:function(){return this.i3sOverrides.geometryOverrides}},{key:"usedMemory",get:function(){let wa=null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Ia=>wa+=null!=Ia?Ia.node.memory:0);this._nodeId2MetaReloading.forEach(Ia=>wa+=null!=Ia?Ia.node.memory:0);return wa}},{key:"unloadedMemory",get:function(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&
!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderer.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",
get:function(){return!1}},{key:"_usePBR",get:function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"performanceInfo",get:function(){const wa={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/
1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.unloadedMemory/1048576).toFixed(1)+"MB"};null!=this._memCache&&(wa.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(wa.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(wa));return wa}},{key:"test",get:function(){const wa=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Ia=[];wa._forAllFeatures(Ra=>{Ia.push(Ra);
return ia.ForAllFeaturesReturnType.CONTINUE},null,ia.ForAllFeaturesMode.VISIBLE_ONLY);Ia.sort((Ra,Ta)=>Ra-Ta);return Ia},get numNodes(){return wa._nodeId2Meta.size},get loadedNodes(){return Array.from(wa._nodeId2Meta.keys()).sort((Ia,Ra)=>Ia-Ra)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&null!=this._layerClippingArea||this._modifications&&0<this._modifications.length}}]);return tb}(ab);y.__decorate([r.property()],ab.prototype,"_hasLoadedPBRTextures",void 0);y.__decorate([r.property()],
ab.prototype,"_asyncModuleLoading",void 0);y.__decorate([r.property()],ab.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);y.__decorate([r.property()],ab.prototype,"view",void 0);y.__decorate([r.property()],ab.prototype,"i3slayer",void 0);y.__decorate([r.property()],ab.prototype,"_controller",void 0);y.__decorate([r.property()],ab.prototype,"_labeler",void 0);y.__decorate([r.property()],ab.prototype,"updating",void 0);y.__decorate([r.property()],ab.prototype,"suspended",void 0);y.__decorate([r.property()],
ab.prototype,"contentVisible",null);y.__decorate([r.property({readOnly:!0})],ab.prototype,"legendEnabled",null);y.__decorate([r.property()],ab.prototype,"holeFilling",void 0);y.__decorate([r.property(Ua.updatingProgress)],ab.prototype,"updatingProgress",void 0);y.__decorate([r.property()],ab.prototype,"updatingProgressValue",null);y.__decorate([r.property()],ab.prototype,"hasTexturesOrVertexColors",null);y.__decorate([r.property()],ab.prototype,"rendererTextureUsage",null);y.__decorate([r.property()],
ab.prototype,"elevationOffset",null);y.__decorate([r.property()],ab.prototype,"elevationInfo",null);y.__decorate([r.property({type:Boolean})],ab.prototype,"slicePlaneEnabled",void 0);y.__decorate([r.property()],ab.prototype,"supportedTextureEncodings",null);y.__decorate([r.property()],ab.prototype,"uncompressedTextureDownsamplingEnabled",null);y.__decorate([r.property({type:[U]})],ab.prototype,"_modifications",void 0);y.__decorate([r.property({readOnly:!0})],ab.prototype,"clientGeometry",null);y.__decorate([r.property()],
ab.prototype,"_elevationTask",void 0);y.__decorate([r.property({readOnly:!0})],ab.prototype,"_usePBR",null);return ab=y.__decorate([D.subclass("esri.views.3d.layers.I3SMeshView3D")],ab)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UByteArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.newUByteArray=function(c,y=!1){return c<=b.NATIVE_ARRAY_MAX_SIZE?y?Array(c).fill(0):Array(c):new Uint8Array(c)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SClientNodeLoader ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O){function I(Q,S){return null!=Q&&Q.length===S.length&&Q.every(U=>0<=H(S,U.name))}function H(Q,S){S=S.toLowerCase();for(let U=0;U<Q.length;U++)if(Q[U].name.toLowerCase()===S)return U;return-1}const J=u.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");c=function(Q){function S(V){V=Q.call(this,V)||this;V.screenSizeFactor=0;V.featureTarget=5E4;V.fixedFeatureTarget=!1;V.updating=!0;V.updatingProgress=1;V.leavesReached=
!1;V.scaleVisibilityEnabled=!0;V.worker=null;V._featureLOD=1;V._stableFeatureLOD=!1;V._isIdle=!1;V._cameraDirty=!0;V._invisibleDirty=!1;V._idleStateCallbacks=null;V._newLoadingNodes=new q({deallocator:null});V._loadedNodeScales=new Map;V._modificationsNodeFilteringArray=new q;V._downloadingCount=0;V._loadingNodes=new Map;V._updatingNodes=new Map;V._progressMaxNumNodes=1;V._requiredAttributes=[];V._requiredAttributesDirty=!0;V._updatesDisabled=!1;V.disableIDBCache=!1;V._disableMemCache=!1;V._restartNodeLoading=
!1;V._fields=null;V._attributeStorageInfo=null;V._handles=new y;V._idleQueue=new t.PromiseQueue;V._elevationUpdateNodes=new q({deallocator:null});V._errorCount=0;return V}a._inherits(S,Q);var U=S.prototype;U.initialize=function(){const {layerView:V,layer:X}=this;this._disableMemCache=!V.loadCachedGPUData||!V.addCachedGPUData;this._lodHandling=new A(V);this._defaultGeometrySchema=X.store.defaultGeometrySchema;this.disableIDBCache=p("disable-feature:idb-cache");"fields"in X&&(this._fields=X.fields,
this._attributeStorageInfo=X.attributeStorageInfo);this.addResolvingPromise(Promise.all([X.indexInfo,X.when(),V.when()]).then(([Y])=>{if(!this.destroyed&&V&&!V.destroyed&&Y){var {view:Z,clientGeometry:ea}=V,{resourceController:ja}=Z;this._setClippingArea(Z.clippingArea);this.addHandles([f.watch(()=>Z?.pointsOfInterest?.focus?.renderLocation,ha=>this._pointOfInterestChanged(ha),f.initial),f.watch(()=>ja.memoryController.memoryFactor,()=>this._setCameraDirty(),f.sync),f.watch(()=>V.contentVisible,ha=>
{const ia=ha?()=>this._updateIdleState(!0):()=>this._updateViewData(),oa=ha?()=>this._updateIdleState(!1):()=>{};ha&&null!=this._index&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(ha||this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ia,this._idleStateCallbacks.idleEnd=oa):this._idleStateCallbacks=ja.scheduler.registerIdleStateCallbacks(ia,oa)},f.initial),x.addCallback(V.view.resourceController.scheduler,this),f.watch(()=>V.uncompressedTextureDownsamplingEnabled,
()=>this.restartNodeLoading()),f.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),f.watch(()=>Z.state?.contentCamera,()=>this._setCameraDirty()),f.watch(()=>X.elevationInfo,ha=>this._elevationInfoChanged(ha)),f.watch(()=>X.effectiveScaleRange,()=>this._scaleBoundsChanged()),f.watch(()=>V.lodFactor,()=>this._setCameraDirty()),f.watch(()=>V.availableFields,()=>this._requiredFieldsChange()),f.watch(()=>V.holeFilling,ha=>null!=this._index&&
(this._index.holeFilling=ha))]);this._updateScaleHandles();this._viewportQueries=new F(this.crsIndex,Z.renderCoordsHelper,Z.state.contentCamera,!Z.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?Z.basemapTerrain:Z.elevationProvider,w.viewingModeFromString(Z.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._clientNodeLoader=new r.I3SClientNodeLoader(this.layer.uid,
this.crsIndex,Z.renderCoordsHelper.spatialReference,Z.state.viewingMode,Z.resourceController.memoryController,this.worker);this._index=new D.I3SIndex(X,Y,this.indexStreamController,this._clientNodeLoader,this._viewportQueries,J,V.holeFilling,ha=>V.isNodeLoaded(ha),ha=>V.isNodeReloading(ha),ha=>this._shouldLoadNode(ha),ha=>this._enableFromGPUCache(ha,v.NodeState.Leaf),ha=>this._needsUpdate(ha),()=>!this.indexStreamController.busy,ha=>V.computeVisibilityObb?V.computeVisibilityObb(ha):null,V?.computeNodeFiltering?
ha=>V.computeNodeFiltering(ha):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!V.hasModifications);this._index.layerFilterChanged(!!V.hasGeometryFilter);if(null!=ea){for(const ha of ea)this._addMesh(ha.mesh,ha.oid);this.addHandles(ea.on("change",ha=>{for(const ia of ha.removed)this._removeMesh(ia.oid);for(const ia of ha.added)this._addMesh(ia.mesh,ia.oid)}))}this._startNodeLoading()}}));this._tmpPoint=m.makeDehydratedPoint(0,
0,0,this.crsIndex)};U.updateNodeModificationStatus=function(V){const X=this._index,Y=this.layerView;null!=X&&Y?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),V.forAll(Z=>{Z=X.getNode(Z);null!=Z&&this._modificationsNodeFilteringArray.push(Z)}),Y.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};U.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=
null);this._handles.destroy();this._nodeLoader=null;N.prune();null!=R&&(R.hide(),R=null)};U._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const V=this._attributeStorageInfo,X=this._fields,Y=this.layer.objectIdField;return this.layerView.availableFields.map(Z=>{const ea=H(V,Z);Z=H(X,Z);return 0<=ea&&0<=Z?{index:ea,name:X[Z].name,field:X[Z],attributeStorageInfo:V[ea]}:null}).filter(Z=>null!=Z&&Z.name!==Y)};U._requiredFieldsChange=
function(){const V=this._getRequiredAttributes();I(this._requiredAttributes,V)||(this._requiredAttributes=V,this._requiredAttributesDirty=!1,this.restartNodeLoading())};U.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};U._setClippingArea=function(V){const X=l.create();K.toBoundingRect(V,X,this.layerView.view.renderSpatialReference)?this._clippingArea=X:this._clippingArea=null};U._pointOfInterestChanged=function(V){null!=this._viewportQueries&&(this._viewportQueries.setPointOfInterest(V),
null!=this._index&&(this._index.progressiveLoadPenalty=W.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};U.updateClippingArea=function(V){this._setClippingArea(V);null!=this._viewportQueries&&null!=this._index&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};U._setCameraDirty=function(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};U._addMesh=
function(V,X){null!=this._index&&(V=this._clientNodeLoader.createMeshNodeInfo(V,X),X=this._index.addClientNodeToIndex(V.id,V.mbs),this._clientNodeLoader.addMeshNode(X,V),this._evaluateUpdating(),this.notifyChange("rootNodeVisible"))};U._removeMesh=function(V){V=this._clientNodeLoader.getMeshNodeIndex(V);if(null!=V)if(null!=this._index)this._index.removeClientNodeFromIndex(V,(X,Y)=>{this.layerView.removeNode(Y);this._loadedNodeScales.delete(Y);this._clientNodeLoader.removeNode(X);this.layerView.deleteCachedNodeData&&
null!=X&&this.layerView.deleteCachedNodeData(X);this.layerView.deleteCachedGPUData?.(this.layerView.loadCachedGPUData?.(Y))},(X,Y,Z)=>{this._clientNodeLoader.updateNodeIndex(X,Y,Z);this.layerView.updateNodeIndex&&this.layerView.updateNodeIndex(Y,Z)}),this.notifyChange("rootNodeVisible");else throw Error("delayed removal of client side i3s node geometry not supported yet.");};U.updateElevationChanged=function(V,X){const Y=this._index;if(null==Y||null==Y.rootNode||null==X)return null;this.crsIndex.equals(X)||
(n.projectBoundingRect(V,X,T,this.crsIndex),V=T);const Z=this._elevationUpdateNodes;Z.clear();E.findIntersectingNodes(V,Y.rootNode,Y,ea=>Z.push(ea.index));Z.length&&(Z.forAll(ea=>Y.updateElevationChanged(ea)),this._setCameraDirty());return Z};U.removeAllGeometryObbs=function(){null!=this._index&&this._index.removeAllGeometryObbs()};U.getRenderMbs=function(V){return null!=this._viewportQueries?this._viewportQueries.getRenderMbs(V):null};U._elevationInfoChanged=function(V){null!=this._index&&(this._index.updateElevationInfo(V,
this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())};U._updateScaleHandles=function(){this._handles.remove("scale-bounds");this._areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",V=>this._scaleUpdateHandler(V)),"scale-bounds")};U._scaleBoundsChanged=function(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};U._scaleUpdateHandler=function(V){this._updateScaleInBoundingRect(V.extent,V.spatialReference);
this._setCameraDirty()};U._updateScaleInBoundingRect=function(V,X){const Y=this._index;null!=Y&&null!=Y.rootNode&&n.projectBoundingRect(V,X,T,this.crsIndex)&&this._loadedNodeScales.forEach((Z,ea)=>{Z=Y.getNode(ea);null!=Z&&l.intersectsSphere(T,Z.mbs)&&this._loadedNodeScales.set(ea,this._computeScale(Z))})};U.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};U.schedule=function(V,X){return this._idleQueue.push(V,X)};U.reschedule=function(V,
X){return this._idleQueue.unshift(V,X)};U._loadNodeData=async function(V,X){return(0>V.index?this._clientNodeLoader:this._nodeLoader).loadNodeData(V,X)};U._loadAttributes=async function(V,X,Y){return(0>V.index?this._clientNodeLoader:this._nodeLoader).loadAttributes(V,X,Y)};U.runTask=function(V,X){if(!this.layerView.contentVisible)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||null==this._index)return-Infinity;this._processWithErrorLogging(V,X);return this._index.maxPriority};
U._processWithErrorLogging=function(V,X){try{this._process(V,X)}catch(Y){50>this._errorCount?J.error("Error during processing: "+Y):50===this._errorCount&&J.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};U._process=function(V,X){this._restartNodeLoading&&this._startNodeLoading();null!=this._nodeLoader&&null!=this._index&&(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(V)&&(this._invisibleDirty=!1),this._isIntegratedMesh&&
(V.enabled=!1),V.run(()=>this._processIndex(V)),this._updateFeatureLOD(),V.run(()=>this._processCache(V)),this._isIntegratedMesh&&(V.enabled=!0),V.run(()=>this._processNodes(V,X)),this._idleQueue.runTask(V),V.run(()=>this._prefetchIndex()),X.numIndexLoading+=this._index.indexLoading,X.numNodesLoading+=this._downloadingCount,V.run(()=>this._lodHandling.lodGlobalHandling(V)),this._evaluateUpdating())};U._processIndex=function(V){if(null==this._index)return!1;this._index.dirty&&(this._newLoadingNodes.clear(),
this._index.update(Array.from(this._loadingNodes.keys()),V,X=>this.updateNodeModificationStatus(X)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),V=this._index.featureEstimate.leavesReached,this._index.isLoading||V===this._get("leavesReached")||this._set("leavesReached",V));return this._index.load()};U._prefetchIndex=function(){return null==
this._index||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};U._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&null!=this._index&&null!=this._viewportQueries){var V=!this._index.isLoading,X=this.featureTarget*this._baseLOD,Y=this._index.featureEstimate;Y.estimate=Y.estimate||X/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(V&&Y.estimate<X){if(Y.leavesReached||1E4<=this._featureLOD||
this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(X/Y.estimate,1.001));V=this._lod;X=this._index.checkFeatureTarget(X,V);X!==V&&(this._featureLOD=X/this._baseLOD,this._stableFeatureLOD=!0)}else if(Y.estimate>1.2*X||V&&Y.estimate>X){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(Y.estimate/X-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.requestUpdate()}};
U._processCache=function(V){const X=this._index;if(null==X)return!1;for(;0<this._newLoadingNodes.length&&!V.done;){var Y=this._newLoadingNodes.pop();for(Y=X.getParent(Y);null!=Y&&!this.layerView.isNodeLoaded(Y.index)&&this._isNodeInScaleBounds(Y);Y=X.getParent(Y.index))if(this._enableFromGPUCache(Y,v.NodeState.Hole)){V.madeProgress();break}}return V.hasProgressed};U._processNodes=function(V,X){if(null==this._index)return!1;let Y=(this._isIdle?100:2)-this._loadingNodes.size;const Z=this._index.updates;
Z.cancel.forEach(this._cancelNode,this);for(Z.cancel=[];0<Z.remove.length&&!V.done;)this.layerView.removeNode(Z.remove.pop()),V.madeProgress();for(;0<Z.update.length&&!V.done;){var ea=this._index.getNode(Z.update.pop());null!=ea&&(this._updateLoadedNode(ea),V.madeProgress())}for(;0<Z.add.length&&!V.done&&0<Y;){--Y;ea=this._index.getNode(Z.add.back());if(null==ea||ea.cacheState!==v.CacheState.Cached&&!this._hasNodeLoadToken(X))break;Z.add.pop();this._loadNode(ea);V.madeProgress()}return V.hasProgressed};
U._cancelAllNodes=function(){this._loadingNodes.forEach(V=>V.abort());this._loadingNodes.clear();this._updatingNodes.forEach(V=>V.abort());this._updatingNodes.clear()};U._cancelNode=function(V){const X=this._loadingNodes.get(V);X&&(X.abort(),this._loadingNodes.delete(V))};U._hasNodeLoadToken=function(V){return!this._isIdle&&2<=V.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<G.maxDownloadSlots&&!this.dataStreamController.busy};U._evaluateUpdating=function(){let V=!1;var X=0;this.layerView&&
(this.layerView.contentVisible?(X=(null!=this._index?this._index.indexMissing:0)+3*(null!=this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size,V=!!(0<X||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||null!=this._index&&this._index.isPrefetching),0===X&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(X,this._progressMaxNumNodes),X=1-X/this._progressMaxNumNodes):
X=(V=this._cameraDirty)?0:1,this.updating=V,this.updatingProgress=X)};U._updateViewData=function(){if(this._cameraDirty&&null!=this._index&&null!=this._viewportQueries){var V=this.layerView.view,{contentCamera:X,fixedContentCamera:Y}=V.state;this.screenSizeFactor=1/(X.perScreenPixelRatio/2);this._viewportQueries.updateCamera(X,!Y||this.isGraphics3D);this._viewportQueries.setPointOfInterest(V.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.invalidateVisibilityCache();
this._index.progressiveLoadPenalty=W.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};U._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};U.isGeometryVisible=function(V){return null!=this._index&&this._index.isGeometryVisible(V.index)};U.updateVisibility=
function(V){null!=this._index&&this._index.invalidateNodeVisibilityCache(V)};U.invalidateGeometryVisibility=function(V){null!=this._index&&this._index.invalidateGeometryVisibility(V)};U.invalidateVisibilityObbs=function(){null!=this._index&&this._index.invalidateVisibilityObbs()};U.modificationsChanged=function(){null!=this._index&&this._index.imModificationsChanged(!!this.layerView.hasModifications);this._invisibleDirty=!0};U._shouldLoadNode=function(V){return this._lodHandling.shouldLoadNode(V)&&
!this._shouldDropNode(V)&&null!=this._index&&this._index.isGeometryVisible(V.index)?this._isNodeInScaleBounds(V):!1};U._shouldDropNode=function(V){if(null==this._viewportQueries)return!1;const X=this._lodDropFactor;return 1<=X||!this._lodHandling.hasNoVisibleChildren(V)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(V))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*X};U._startNodeLoading=function(){this._restartNodeLoading=!1;
const V=this._index;this._updatesDisabled||null==V||null==this._viewportQueries||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new B(this.layer,this.dataStreamController,J,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,
loadFeatureData:this.useMaximumNumberOfFeatures}),V.requestUpdate(),this._lodHandling.startNodeLoading(X=>this._isNodeInScaleBounds(X),(X,Y)=>this._removeNodes(X,Y,P.fadeout),V,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};U.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};U.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),
this._nodeLoader=null,this._evaluateUpdating())};U._removeInvisibleNodes=function(V){const X=this._index;if(null==X||null==this._viewportQueries)return!1;N.clear();this.layerView.getLoadedNodeIndices(N);const Y=0===this._viewportQueries.maxDistance,Z=Y?()=>!1:ea=>this._shouldDropNode(ea);N.filterInPlace(ea=>{const ja=X.getNode(ea);return null==ja||!X.isGeometryVisible(ea)||Z(ja)||!this._isNodeInScaleBounds(ja)});0<N.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(N,V,P.pop);if(Y&&
1>this._lodDropFactor)return!1;if(0===N.length)return!0;N.clear();return!1};U.markNodeToRemove=function(V){N.push(V)};U.removeMarkedNodes=function(){this._removeNodes(N,O.noBudget,P.pop)};U._removeNodes=function(V,X,Y){const Z=V.length;if(0!==Z&&!X.done){for(null!=this._index&&this._index.requestUpdate();0<V.length&&!X.done;){const ea=V.pop(),ja=this._index;Y===P.fadeout&&this.layerView.nodeFadeoutEnabled&&null!=ja&&ja.isGeometryVisible(ea)?this.layerView.fadeNode(ea,M.FadeDirection.FadeOut,!0):this.layerView.removeNode(ea);
X.madeProgress()}if(0<this._loadedNodeScales.size)for(X=V.length;X<Z;X++)this._loadedNodeScales.delete(V.data[X])}};U._needsUpdate=function(V){if(V.resources.isEmpty||this._updatingNodes.has(V.index))return!1;V=this.layerView.getLoadedAttributes(V.index);return null!=V&&V!==this._requiredAttributes};U._updateLoadedNode=async function(V){const X=new AbortController;this._updatingNodes.set(V.index,X);this._evaluateUpdating();try{const Y=this.layerView.getLoadedAttributes(V.index);let Z=null;Z=I(Y,this._requiredAttributes)?
await Promise.resolve(this.layerView.getAttributeData(V.index)):await this._loadAttributes(V,this._requiredAttributes,X.signal);await this.schedule(()=>this.layerView.updateAttributes(V.index,{loadedAttributes:this._requiredAttributes,attributeData:Z},X.signal),X.signal)}catch(Y){if(!d.isAbortError(Y))return this.layerView.updateAttributes(V.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},X.signal)}this._updatingNodes.delete(V.index);this._evaluateUpdating()};U._loadNode=function(V){if(this._loadingNodes.has(V.index))J.error("already loading node "+
V.index);else{var X=new AbortController;this._loadingNodes.set(V.index,X);this._evaluateUpdating();this._loadAndAddNode(V,X.signal).then(Y=>{Y&&null!=this._index&&this._loadingNodes.get(V.index)===X&&(this._loadingNodes.delete(V.index),this._index.requestUpdate())}).catch(Y=>{if(!d.isAbortError(Y))throw Y;}).finally(()=>{this._loadingNodes.get(V.index)===X&&this._loadingNodes.delete(V.index);this._evaluateUpdating()})}};U._loadAndAddNode=function(V,X){return V.cacheState===v.CacheState.Uncached?this._loadUncached(V,
X).then(()=>!1):this._loadCached(V,X).then(Y=>{if(Y)return!1;V.cacheState=v.CacheState.Uncached;return!0}).catch(Y=>d.isAbortError(Y)?!1:(V.cacheState=v.CacheState.Uncached,!0))};U._enableFromGPUCache=function(V,X){if(this._disableMemCache||null==this._index)return!1;if(X===v.NodeState.Hole&&!this._index.useNodeAsHole(V.index))return!0;const Y=this._loadCachedGPUData(V);if(!Y)return!1;this.layerView.addCachedGPUData(V,Y,X);this._nodeAdded();return!0};U._loadCachedGPUData=function(V){V=this.layerView.loadCachedGPUData(V.index);
if(null!=V&&null!=V.attributeInfo&&I(V.attributeInfo.loadedAttributes,this._requiredAttributes))return V;this.layerView.deleteCachedGPUData(V);return null};U._nodeAdded=function(){null!=this._index&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};U.updateLoadStatus=function(V,X){const Y=this._index;null!=Y&&Y.updateChildrenLoaded(V,X?1:-1)};U._loadCached=async function(V,X){if(this._enableFromGPUCache(V,v.NodeState.Leaf))return!0;const Y=this.layerView;
if(this.disableIDBCache||!Y.loadCachedNodeData||!Y.addCachedNodeData)return!1;const Z=(ma,fa)=>this._nodeLoader.loadTextures(V,ma,fa),ea=(ma,fa)=>this._clientNodeLoader.loadTextures(V,ma,fa),ja=0<=V.index?Z:ea,ha=await this.schedule(()=>Y.loadCachedNodeData(V,X,ja),X);if(null==ha)return!1;const ia=this._requiredAttributes,oa=await this.reschedule(()=>this._loadAttributes(V,ia,X),X);await this.reschedule(()=>Y.addCachedNodeData(V,ha,{loadedAttributes:ia,attributeData:oa},X),X);this._nodeAdded();return!0};
U._loadUncached=function(V,X){this._downloadingCount++;return this._loadNodeData(V,X).catch(Y=>{this._downloadingCount--;throw Y;}).then(Y=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(V,Y,X),X)}).then(()=>{this._nodeAdded();V.cacheState=v.CacheState.Cached}).catch(Y=>{if(!d.isAbortError(Y))throw J.error("#loadNodeData()",this.layer,`Failed to load node '${V.id}'`,Y),V.failed=!0,null!=this._index&&this._index.requestUpdate(),Y;})};U._updateIdleState=function(V){V!==this._isIdle&&
(this._isIdle=V,this._evaluateUpdating(),V&&this._index&&null!=this._index&&this._index.resetFailedNodes())};U._getScale=function(V){if(this._loadedNodeScales.has(V.index))return this._loadedNodeScales.get(V.index);const X=this._computeScale(V);this.layerView.isNodeLoaded(V.index)&&this._loadedNodeScales.set(V.index,X);return X};U._computeScale=function(V){this._tmpPoint.x=V.mbs[0];this._tmpPoint.y=V.mbs[1];this._tmpPoint.z=V.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,
V.mbs[3])};U._isNodeInScaleBounds=function(V){if(!this._areScaleBoundsActive)return!0;V=this._getScale(V);const {minScale:X,maxScale:Y}=L.extractSafeScaleBounds(this.layer);return L.scaleBoundsPredicate(V,X,Y)};U.updateStats=function(V){V.index=null!=this._index?this._index.size:0;this.isGraphics3D&&(V.detail=this._featureLOD,V.target=this.featureTarget*this._baseLOD);null!=this._index&&this._index.updateStats(V)};U.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();
null!=this._index&&this._index.requestUpdate()};U.geometryFilterChanged=function(V){const X=this._index;null!=X&&X.layerFilterChanged(V);this._setCameraDirty()};a._createClass(S,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}},{key:"isGraphics3D",get:function(){return"points"===this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(null==this.layer.priority||"High"===this.layer.priority)}},
{key:"indexStreamController",get:function(){const V=this.layerView.view.resourceController.createStreamDataRequester(G.ClientType.I3S_INDEX);return new C.I3SStreamDataController(V,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const V=this.layerView.view.resourceController.createStreamDataRequester(G.ClientType.I3S_DATA);return new C.I3SStreamDataController(V,this.layer.apiKey)}},{key:"crsVertex",get:function(){return E.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return E.getIndexCrs(this.layer)}},
{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"running",get:function(){return this.updating}},{key:"rootNodeVisible",get:function(){if(null!=this._index){const V=this._index.rootNode;if(null!=V)return this._updateViewData(),this._index.isNodeVisible(V.index)}return!0}},{key:"index",get:function(){return this._index}},{key:"_isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},{key:"_areScaleBoundsActive",get:function(){const {minScale:V,maxScale:X}=L.extractSafeScaleBounds(this.layer);
return this.scaleVisibilityEnabled&&(0<V||0<X)}},{key:"unloadedMemoryEstimate",get:function(){return null!=this._index&&this.layerView.contentVisible?this._index.unloadedMemoryEstimate*this._lodDropFactor:0}},{key:"indexDepth",get:function(){return null!=this._index?this._index.maxLevel:0}},{key:"disableMemCache",set:function(V){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=V}},{key:"_lod",get:function(){return this._featureLOD*
this._baseLOD}},{key:"_baseLOD",get:function(){const V=this.layerView.lodFactor,X=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<V?V:1)*X}},{key:"_lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const V=this.layerView.view.resourceController.memoryController;return(Math.min(V.memoryFactor,.5)-V.minQuality)/(.5-V.minQuality)}},{key:"test",get:function(){const V=this;return{index:this._index,set disableUpdates(X){(V._updatesDisabled=
X)?V.cancelNodeLoading():V.requestUpdate()},set disableIDBCache(X){V.disableIDBCache=X},set ignoreServiceObb(X){null!=V._index&&(V._index.ignoreServiceObb=X)},shouldLoadNode:X=>V._shouldLoadNode(X)}}}]);return S}(k.EsriPromiseMixin(c));b.__decorate([g.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"isGraphics3D",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"useMaximumNumberOfFeatures",null);b.__decorate([g.property({readOnly:!0})],
c.prototype,"indexStreamController",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"dataStreamController",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"crsVertex",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"crsIndex",null);b.__decorate([g.property()],c.prototype,"screenSizeFactor",void 0);b.__decorate([g.property()],c.prototype,"featureTarget",void 0);b.__decorate([g.property()],c.prototype,"fixedFeatureTarget",void 0);b.__decorate([g.property()],c.prototype,
"layerView",void 0);b.__decorate([g.property()],c.prototype,"layer",null);b.__decorate([g.property()],c.prototype,"updating",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"running",null);b.__decorate([g.property()],c.prototype,"updatingProgress",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"leavesReached",void 0);b.__decorate([g.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([g.property({constructOnly:!0})],c.prototype,"worker",
void 0);b.__decorate([g.property({readOnly:!0,dependsOn:[]})],c.prototype,"rootNodeVisible",null);c=b.__decorate([z.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c);const N=new q({deallocator:null});let R;const W={factorIM:.2,factor3dObject:.05,distancePenalty:10},T=l.create();var P;(function(Q){Q[Q.pop=0]="pop";Q[Q.fadeout=1]="fadeout"})(P||(P={}));return c})},"esri/views/3d/layers/i3s/I3SClientNodeLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/uuid ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../chunks/sphere ../../../ViewingMode ./I3SClientMaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(r,x){var {spatialReference:D}=r;const A=[1,-1],v=[.5*r.width,.5*r.height,r.hasZ?.5*(r.zmax-r.zmin):0];D=D.isGeographic?D.metersPerUnit:1;const B=r.center;let C=0;if(r.hasZ)for(r=0;2>r;++r)for(var E=0;2>E;++E)for(var F=0;2>F;++F){var M=(B.x+A[r]*v[0]-x.x)*D;const K=(B.y+A[E]*v[1]-x.y)*D,G=B.z+A[F]*v[2]-x.z;C=Math.max(M*M+K*K+G*G,C)}else for(r=0;2>r;++r)for(E=0;2>E;++E)F=(B.x+A[r]*v[0]-x.x)*D,M=(B.y+A[E]*v[1]-x.y)*D,C=Math.max(F*F+M*M,C);return h.fromCenterAndRadius([x.x,
x.y,x.z],Math.sqrt(C))}async function m(r,x,D,A){const {transform:v,vertexAttributes:B}=x.loadedMesh;r="source"===r.shading?B.normal:null;if(null==r||null==v||0===v.rotationAngle&&f.exactEquals(v.scale,g.ONES))return{transformed:r,original:B.normal};if(!x.normalsTransformPromise){y.assertIsSome(D,"SceneLayerWorker is needed to transform mesh normals");const C=d.create();k.normalFromMat4(C,v.localMatrix);x.normalsTransformPromise=D.transformNormals({normalMatrix:C,normals:r},A)}return x.normalsTransformPromise}
function t(r,x,D){r[x]=255&D;r[x+1]=255&D>>8;r[x+2]=255&D>>16;r[x+3]=255&D>>24}let w=function(){function r(D,A,v,B,C,E){this._uid=D;this._indexSR=A;this._renderSR=v;this._viewingMode=B;this._worker=E;this._id2Meta=new Map;this._oid2Meta=new Map;this._memCache=C.newCache(`sl-client-mesh-data-${this._uid}`)}var x=r.prototype;x.createMeshNodeInfo=function(D,A){const v=`mesh${A}`;var B=D.extent,C=B.spatialReference,E=this._indexSR;B=l(B,D.origin);e.projectBoundingSphere(B,C,B,E);E=D.metadata.displaySource?.source;
if(null==E||!Array.isArray(E)||!E.length||E[0]instanceof File)var F=q.generateUUID();else{C="";for(F of E)C+=F.makeHash();F=JSON.stringify(null!=D.transform?D.transform.toJSON():"");E=D.vertexSpace.isRelative?JSON.stringify(D.vertexSpace.origin):"";F=C+F+E}return{type:"mesh",id:v,version:F,oid:A,mbs:B,componentNodeIds:[],unloadedMesh:D,nodeIndex:null,loadMeshPromise:null}};x.addMeshNode=function(D,A){if(null!=this.getMeshNodeIndex(A.oid))throw new c(`I3SClientNodeLoader: client side mesh for feature oid=${A.oid} already exists`);
A.nodeIndex=D;this._id2Meta.set(A.id,A);this._oid2Meta.set(A.oid,A)};x.getMeshNodeIndex=function(D){D=this._oid2Meta.get(D);return null==D||"mesh"!==D.type?null:D.nodeIndex};x.removeNode=function(D){if(null!=D){var A=this._id2Meta.get(D);null!=A&&(this._id2Meta.delete(D),"mesh"===A.type&&this._oid2Meta.delete(A.oid))}};x.loadNodeJSON=async function(D){const A=this._id2Meta.get(D);if(null==A)throw new c(`I3SClientNodeLoader::loadNodeJSON unable to find node ${D}`);switch(A.type){case "mesh":return this._loadMeshNodeJSON(A);
case "mesh-component":return this._loadMeshComponentNodeJSON(A);default:throw new c(`I3SClientNodeLoader::loadNodeJSON unable to handle node ${D}`);}};x._loadMeshNodeJSON=async function(D){const A=D.id;var v=(await this._getMeshData(D)).loadedMesh;if(null==v.components||0===v.components.length)return{id:A,version:null,mbs:D.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null};const B=[];v=v.components;for(let C=0;C<v.length;++C){const E=`${A}-component${C}`,
F={type:"mesh-component",id:E,mbs:D.mbs,componentIndex:C,meshNodeInfo:D,textureData:new Map};this._id2Meta.set(F.id,F);D.componentNodeIds.push(E);B.push({id:F.id,href:null,mbs:F.mbs,obb:null})}return{id:A,version:null,mbs:D.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:B}};x.updateNodeIndex=function(D,A,v){null!=D&&(D=this._id2Meta.get(D))&&"mesh"===D.type&&(D.nodeIndex=v)};x._loadMeshComponentNodeJSON=async function(D){return{id:D.id,version:D.meshNodeInfo.version,
mbs:D.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null,isEmpty:!1}};x.loadNodeData=async function(D,A){var v=this._id2Meta.get(D.id);if(null==v||"mesh-component"!==v.type)throw new c(`Failed to load client node data for node ${D.id} (unexpected node info)`);var B=v.meshNodeInfo,C=await this._getMeshData(B),E=C.loadedMesh;B=B.oid;if(null==E.components)throw new c(`Failed to load client node data for node ${D.id} (unexpected null reference)`);D=E.components[v.componentIndex];
const {material:F,requiredTextures:M,textureData:K}=await n.convertMeshMaterialToPBRMaterial(D.material);if(null!=K)for(var G of K)null!=G&&v.textureData.set(G.id,G);v={params:{material:F},type:"ArrayBufferView"};const {vertexSpace:L,origin:O,transform:I}=E;G=[O.x,O.y,O.z??0];v={featureDataPosition:G,featureIds:[],geometries:[v]};C.projectionPromise||(y.assertIsSome(this._worker,"SceneLayerWorker is needed to project mesh"),C.projectionPromise=this._worker.project({positions:E.vertexAttributes.position,
localMatrix:I?.localMatrix,vertexSpace:L.toJSON(),origin:G,inSpatialReference:E.spatialReference.toJSON(),outSpatialReference:this._indexSR.toJSON(),local:this._viewingMode===z.ViewingMode.Local},A));const {projected:H,original:J}=await C.projectionPromise;E.vertexAttributes.position=J;const {transformed:N,original:R}=await m(D,C,this._worker,A);E.vertexAttributes.normal=R;u.throwIfAborted(A);A=D.faces;C=E.vertexAttributes.uv;E=E.vertexAttributes.color;D=A.length/3;var W=3*D,T,P=0;G=!1;var Q=0;let S=
!1;var U=0;let V=!1;var X=0;let Y=0,Z=0;P=T=8;T+=12*W;null!=N&&(G=!0,Q=T,T+=12*W);null!=C&&(S=!0,U=T,T+=8*W);null!=E&&(V=!0,X=T,T+=4*W);Y=T;Z=T+=8;T=new ArrayBuffer(T+8);const ea=new Uint8Array(T);t(ea,0,W);t(ea,4,1);W=new Float32Array(T,P);Q=null!=N?new Float32Array(T,Q):null;U=null!=C?new Float32Array(T,U):null;X=null!=E?new Uint8Array(T,X):null;for(P=0;P<D;++P){const fa=3*P;for(let ba=0;3>ba;++ba){var ja=A[fa+ba],ha=3*ja,ia=9*P+3*ba;W[ia]=H[ha];W[ia+1]=H[ha+1];W[ia+2]=H[ha+2];null!=Q&&(Q[ia]=N[ha],
Q[ia+1]=N[ha+1],Q[ia+2]=N[ha+2]);null!=U&&(ha=2*ja,ia=6*P+2*ba,U[ia]=C[ha],U[ia+1]=C[ha+1]);null!=X&&(ja*=4,ha=12*P+4*ba,X[ha]=E[ja],X[ha+1]=E[ja+1],X[ha+2]=E[ja+2],X[ha+3]=E[ja+3])}}t(ea,Y,B);t(ea,Y+4,B/2**32);t(ea,Z,0);t(ea,Z+4,D-1);const {geometryBuffer:oa,geometryDescriptor:ma}={geometryBuffer:T,geometryDescriptor:{isDraco:!1,isLegacy:!0,color:V,normal:G,uv0:S,uvRegion:!1,featureIndex:!0}};return{geometryData:v,attributeDataInfo:{attributeData:{},loadedAttributes:[]},geometryBuffer:oa,geometryDescriptor:ma,
requiredTextures:M,textureData:K}};x.loadAttributes=async function(D,A,v){D=D.numFeatures;v={};for(const {field:{name:B}}of A)v[B]=Array(D);return v};x.loadTextures=async function(D,A,v){v=this._id2Meta.get(D.id);if(null==v||"mesh-component"!==v.type)throw Error(`Failed to load textures for node ${D.id} (unexpected node info)`);D=[];for(const B of A)D.push(v.textureData.get(B.id)||null);return D};x._getMeshData=async function(D){const A=D.version,v=this._memCache.get(A);if(null==v){if(null!=D.loadMeshPromise)return D.loadMeshPromise;
const B=async(C,E)=>{var F=D.unloadedMesh.clone();try{await F.load()}catch(M){E(M)}E=F.memoryUsage;F={loadedMesh:F,projectionPromise:null,normalsTransformPromise:null,usedMemoryInBytes:E};this._memCache.put(A,F,E,p.MIN_PRIORITY);D.loadMeshPromise=null;C(F)};D.loadMeshPromise=new Promise((C,E)=>B(C,E));return D.loadMeshPromise}return v};b._createClass(r,[{key:"indexSR",get:function(){return this._indexSR}},{key:"renderSR",get:function(){return this._renderSR}}]);return r}();a.I3SClientNodeLoader=w;
a.createSphereFromExtent=l;a.transformNormals=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SClientMaterialUtil":function(){define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/materials/pbrUtils".split(" "),function(a,b,c,y,p,u,q,k){async function d(g,e,h,z){if(null==g)return-1;const n=h.length;var l=g.data;g=g.url;
if(null!=l){if(l instanceof HTMLImageElement||l instanceof HTMLCanvasElement)return l=f(l),h.push({id:n,usage:z,data:l,encoding:u.TextureEncoding.PNG,downsampled:!1}),e.push({id:n,usage:z,encodings:[{name:void 0,encoding:u.TextureEncoding.PNG}]}),n;if(!(l instanceof HTMLVideoElement)){if(l instanceof ImageData)throw new c("ImageData textures not supported yet for client side I3S nodes");if(l instanceof p.EncodedMeshTexture)throw new c("EncodedMeshTexture textures not supported yet for client side I3S nodes");
}}else if(null!=g)return l=new Image,l.src=g,l=await y.loadImageAsync(l,l.src,!1,void 0),l=f(l),h.push({id:n,usage:z,data:l,encoding:u.TextureEncoding.PNG,downsampled:!1}),e.push({id:n,usage:z,encodings:[{name:void 0,encoding:u.TextureEncoding.PNG}]}),n;return-1}function f(g){var e=g.width*g.height;if(4096<=e){let h=g.width,z=g.height;do h=Math.ceil(h/2),z=Math.ceil(z/2),e=h*z;while(1048576<e);e=document.createElement("canvas");e.width=h;e.height=z;e.getContext("2d").drawImage(g,0,0,h,z);return e}return g}
a.convertMeshMaterialToPBRMaterial=async function(g){const e=[],h=[];if(null==g)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:e,textureData:h};const z=g.hasOwnProperty("metallicRoughnessTexture");
"auto"===g.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');return{material:{alphaMode:"auto"===g.alphaMode?"blend":g.alphaMode,alphaCutoff:g.alphaCutoff,doubleSided:g.doubleSided,cullFace:g.doubleSided?q.CullFaceOptions.None:q.CullFaceOptions.Back,normalTextureId:await d(g.normalTexture,e,h,u.TextureUsage.Normal),emissiveTextureId:z?await d(g.emissiveTexture,e,h,u.TextureUsage.Emissive):-1,occlusionTextureId:z?await d(g.occlusionTexture,e,h,u.TextureUsage.Occlusion):
-1,emissiveFactor:z&&null!=g.emissiveColor?b.toUnitRGB(g.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=g.color?b.toUnitRGBA(g.color):[1,1,1,1],baseColorTextureId:await d(g.colorTexture,e,h,u.TextureUsage.Color),metallicRoughnessTextureId:z?await d(g.metallicRoughnessTexture,e,h,u.TextureUsage.MetallicRoughness):-1,metallicFactor:z?g.metallic:0,roughnessFactor:z?g.roughness:0},wrapTextures:!0,hasParametersFromSource:k.useSchematicPBR({normalTexture:g.normalTexture,emissiveTexture:z?
g.emissiveTexture:null,emissiveFactor:z?b.toUnitRGB(g.emissiveColor):null,occlusionTexture:z?g.occlusionTexture:null,metallicRoughnessTexture:z?g.metallicRoughnessTexture:null,metallicFactor:z?g.metallic:null,roughnessFactor:z?g.roughness:null})},requiredTextures:e,textureData:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=
4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]=
"AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f){let g=function(z){function n(){var m=z.call(this)||this;m.referenceCount=0;m.callbacks=[];m.runIndex=0;return m}b._inherits(n,z);var l=n.prototype;l.runTask=function(m){this._sort();const t=this.callbacks,w={numIndexLoading:0,numNodesLoading:0};for(let r=0;r<t.length&&!m.done;++r)t[r].priority=t[r].runTask(m,w),this.runIndex=r};l._sort=function(){const m=this.callbacks;let t=m.length;for(let w=this.runIndex;0<w;w--){const r=m[w-1];let x=w;for(;x<m.length&&r.priority<=
m[x].priority&&(x!==t||r.priority<m[x].priority);)m[x-1]=m[x],x++;m[x-1]=r;t=x-1}this.runIndex=0};l.add=function(m){this._sort();m.priority=Infinity;this.callbacks.unshift(m);this.notifyChange("running")};l.remove=function(m){p.removeUnordered(this.callbacks,m);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")};b._createClass(n,[{key:"running",get:function(){return this.callbacks.some(m=>m.running)}}]);return n}(y);c.__decorate([u.property({readOnly:!0})],g.prototype,"running",
null);g=c.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],g);let e=b._createClass(function(z,n){this.task=z;this.handle=n});const h=new Map;a.addCallback=function(z,n){let l=h.get(z);if(null==l){const m=new g,t=z.registerTask(f.TaskPriority.I3S_CONTROLLER,m);l=new e(m,t);h.set(z,l)}l.task.add(n);return{remove:()=>{null!=l&&(l.task.remove(n),0<l.task.callbacks.length||(h.delete(z),l.handle.remove(),l.task.destroy()),l=null)}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/sphere ../../../../support/featureFlags ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),function(a,b,c,y,p,u,q,k,d,f,g){function e(M){null!=M.node&&(f.invalidateMbs(M.node.renderMbs),f.invalidateObb(M.node.serviceObbInRenderSR));null!=M.ref&&
(f.invalidateMbs(M.ref.renderMbs),f.invalidateObb(M.ref.serviceObbInRenderSR))}function h(M,K){return 0>M?-1:0===K?0:M/K|0}function z(M=[],K=[],G=[]){return{nodes:M,children:K,parents:G}}function n(M,K){return 0>M?-M-1:0===K?M:M%K}function l(M,K,G){return-1===K?-(M+1):0===G?M:K*G+M}function m(M){if(M)for(let K=0;K<M.length;K++)for(const G of A)if(G[0]===M[K].metricType)return{lodMetric:G[1],maxError:M[K].maxError};return{lodMetric:d.LodMetric.None,maxError:0}}function t(M){return Math.sqrt(4/Math.PI*
M)}let w=b._createClass(function(M,K,G,L,O){this.childOffset=M;this.childCount=K;this.visibilityCache=G;this.ref=L;this.node=O;this.useAsHole=0;this.filterImpact=d.NodeFilterImpact.NotChecked}),r=function(){function M(G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V){this._layer=G;this._streamDataController=O;this._clientNodeLoader=I;this._viewportQueries=H;this._logger=J;this.holeFilling=N;this._isLoaded=R;this._isReloading=W;this._isSelected=T;this._enable=P;this._needsUpdate=Q;this._canRequest=S;this._computeVisibilityObb=
U;this._computeNodeFiltering=V;this._dirty=!0;this._nodePages=[];this._clientNodePage=null;this._rootIndex=this._nodesPerPage=this._nodeCount=0;this._lodMetric=d.LodMetric.None;this._lodConversion=X=>X;this._isEditable=!1;this._urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=f.addWraparound(0,2);this._visibilityCacheVersion=
f.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new c({deallocator:null});this._prefetch=new c({deallocator:null});this._updates=new D(this._missing);this._imModificationUncategorized=new c({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._isEditable=k.i3sPatchingEnabled()&&null!=G.associatedLayer&&
null!=G.associatedLayer.infoFor3D;G.serviceUpdateTimeStamp&&G.serviceUpdateTimeStamp.lastUpdate&&(this._lastUpdate=`${G.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(L)}var K=M.prototype;K._init=function(G){if("page"===G.type){var L=G.rootPage;this._urlPrefix=G.urlPrefix;this._nodesPerPage=G.pageSize;switch(G.lodMetric){case "maxScreenThreshold":this._lodMetric=d.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=
d.LodMetric.MaxScreenThreshold,this._lodConversion=t}if(this._isEditable){this._rootIndex=-1;var O=n(G.rootIndex,G.pageSize);O=L.nodes[O];O={nodes:[{index:this._rootIndex,children:[G.rootIndex],mesh:void 0,obb:O.obb,lodThreshold:O.lodThreshold}]};this._addPage(h(this._rootIndex,this._nodesPerPage),O);this.getNode(-1).serviceObb=void 0}else this._rootIndex=G.rootIndex;this._addPage(h(G.rootIndex,this._nodesPerPage),L);this._updateParentsAndLevel()}else"node"===G.type&&(this._urlPrefix=G.urlPrefix,
this._nodePages.push(z()),this._isEditable?(this._clientNodePage=z(),L={id:"-1",version:null,mbs:G.rootNode.mbs,obb:G.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",href:"../root",mbs:G.rootNode.mbs,obb:G.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new d.NodeBase(L.id,null),-1),(L=this._validateNode(L.id,L))&&this._addNode(L,this._rootIndex)):this._rootIndex=this._makeRefNode(new d.NodeBase(G.rootNode.id,null),-1),(G=this._validateNode(G.rootNode.id,
G.rootNode))&&this._addNode(G,0))};K.addClientNodeToIndex=function(G,L){G=new d.NodeBase(G,L);G=this._makeClientRefNode(G,-1);this._linkChildToParentNode(-1,G);this.requestUpdate();return G};K.removeClientNodeFromIndex=function(G,L,O){this._destroyClientRefNode(G,L,O);this.requestUpdate()};K._loadPage=function(G){this._loading.add(G);this._streamDataController.request(this._urlPrefix+G,"json").then(L=>{this._pageQueue.push({pageIndex:G,page:L})}).catch(L=>{this._loading.delete(G);y.isAbortError(L)||
(this._failedPages.add(G),this._logger.error("#loadPage()",this._layer,`Error when loading page ${G}`,L))})};K._addQueuedPages=function(G){for(;0<this._pageQueue.length&&!G.done;){const {pageIndex:L,page:O}=this._pageQueue.shift();this._addPage(L,O);this._loading.delete(L);G.madeProgress()}this._updateParentsAndLevel()};K._addPage=function(G,L){const O=[],I=[];L=L.nodes.map((H,J)=>{const N=O.length,R=H.children?H.children.length:0;I.push(this._rootIndex);for(var W=0;W<R;W++)O.push(H.children[W]);
const T=`${H.index}`;W=g.clone(H.obb);const P=q.fromValues(W.center[0],W.center[1],W.center[2],p.length(W.halfSize));var Q=H.mesh&&H.mesh.attribute;const S=H.mesh&&H.mesh.geometry,U=H.mesh&&H.mesh.material;Q={hasSharedResource:!1,isEmpty:null==S,attributes:Q&&null!=Q.resource?`${Q.resource}`:void 0,geometry:S&&null!=S.resource?`${S.resource}`:void 0,texture:U&&null!=U.resource?`${U.resource}`:void 0,geometryDefinition:S?S.definition:-1,materialDefinition:U?U.definition:-1};H=new d.Node(T,l(J,G,this._nodesPerPage),
P,R,0,Q,this._lastUpdate,this._lodMetric,this._lodConversion(H.lodThreshold),S?S.featureCount:null);H.serviceObb=W;H.visibilityObb=this._computeVisibilityObb(H);H.vertexCount=S?S.vertexCount:0;return new w(N,R,f.addWraparound(this._visibilityCacheVersion,-2),null,H)});if(-1===G)this._clientNodePage=z(L,O,I);else{for(let H=this._nodePages.length;H<G;H++)this._nodePages[H]=null;this._nodePages[G]=z(L,O,I)}this._nodeCount+=L.length};K._updateParentsAndLevel=function(){const G=[],L=(O,I,H)=>{const J=
this._getPage(O);if(null!=J){const N=n(O,this._nodesPerPage);J.parents[N]=null!=I?I:-1;I=J.nodes[N].node;null!=I&&(I.level=H,G.push(O))}};for(L(this._rootIndex,null,0);G.length;){const O=G.pop(),I=this.getNode(O);if(null!=I)for(let H=0;H<I.childCount;H++){const J=this.getChildIndex(I.index,H);L(J,O,I.level+1);this._maxLevel=Math.max(this._maxLevel,I.level+1)}}};K._getPage=function(G){G=h(G,this._nodesPerPage);return 0>G?this._clientNodePage:this._nodePages[G]};K._getNodeInternal=function(G){const L=
this._getPage(G);return null==L?null:L.nodes[n(G,this._nodesPerPage)]};K._addNode=function(G,L){null!=G.children&&this.populateChildren(L,G.children);var O=this.getParent(L);O=null!=O?O.level+1:0;this._maxLevel=Math.max(this._maxLevel,G.children?O+1:O);const {lodMetric:I,maxError:H}=m(G.lodSelection),J=this._getNodeInternal(L);J.node=new d.Node(G.id,L,G.mbs,J.childCount,O,G.resources,G.version,I,H,G.numFeatures);G.obb&&(J.node.serviceObb=g.clone(G.obb));J.node.visibilityObb=this._computeVisibilityObb(J.node);
null!=J.ref&&(null==J.ref.mbs&&(J.ref.mbs=G.mbs),J.node.renderMbs=J.ref.renderMbs,J.node.serviceObbInRenderSR=J.ref.serviceObbInRenderSR,J.ref.visibilityObb=J.node.visibilityObb);return J.node};K._makeRefNode=function(G,L){const O=this._nodePages[0];if(-1>L)return this._makeClientRefNode(G,L);if(null==O)return-1;const I=O.nodes.length;O.nodes.push(new w(0,0,f.addWraparound(this._visibilityCacheVersion,-2),G,null));this._nodeCount++;O.parents.push(L);f.invalidateMbs(G.renderMbs);f.invalidateObb(G.serviceObbInRenderSR);
return I};K._makeClientRefNode=function(G,L){const O=this._clientNodePage;if(null==O)return-1;if(0<=L)throw Error("I3SIndex::client side nodes can not be made children of service side nodes.");const I=-(O.nodes.length+1);O.nodes.push(new w(0,0,f.addWraparound(this._visibilityCacheVersion,-2),G,null));this._nodeCount++;O.parents.push(L);f.invalidateMbs(G.renderMbs);f.invalidateObb(G.serviceObbInRenderSR);return I};K._linkChildToParentNode=function(G,L){const O=this._clientNodePage;if(!(null==O||0<=
G)){var I=n(G,this._nodesPerPage),H=n(L,this._nodesPerPage);I=O.nodes[I];var J=I.childOffset;O.children.splice(I.childOffset+I.childCount,0,L);I.childCount+=1;null!=I.node&&(I.node.childCount+=1);for(const N of O.nodes)N.childOffset>J&&(N.childOffset+=1);O.parents[H]=G;this._updateParentBoundingInformation(G)}};K._destroyClientRefNode=function(G,L,O){const I=this._clientNodePage;if(null!=I){var H=this.getParentIndex(G);if(null!=H){var J=new Set,N=new Map,R=Z=>{var ea=n(Z,this._nodesPerPage);ea=I.nodes[ea];
if(0<ea.childCount)for(let ja=ea.childOffset;ja<ea.childOffset+ea.childCount;++ja)R(I.children[ja]);L(ea.node?.id,Z);J.add(ea);this._nodeTraversalState.delete(Z)};R(G);G=I.nodes;var W=I.children,T=I.nodes.map(()=>-1),P=[],Q=[];for(var S=0;S<G.length;++S){var U=G[S];if(!J.has(U)){var V=P.length,X=l(S,-1,this._nodesPerPage);V=l(V,-1,this._nodesPerPage);U.node&&(U.node.index=V);T[S]=V;P.push(U);X!==V&&(O(U.node?.id,X,V),N.set(X,V))}}this._nodeCount-=G.length-P.length;O=P.map(()=>-1);for(N=0;N<P.length;++N){S=
l(N,-1,this._nodesPerPage);U=P[N];X=Q.length;for(V=U.childOffset;V<U.childOffset+U.childCount;++V){var Y=W[V];0<=Y?Q.push(Y):(Y=n(Y,this._nodesPerPage),J.has(G[Y])||(Y=T[Y],Q.push(Y),Y=n(Y,this._nodesPerPage),O[Y]=S))}U.childOffset=X;U.childCount=Q.length-X;U.node&&(U.node.childCount=U.childCount)}I.nodes=P;I.children=Q;I.parents=O;this._updateParentBoundingInformation(T[n(H,this._nodesPerPage)])}}};K._updateParentBoundingInformation=function(G){do{let I=null;var L=this._clientNodeLoader.indexSR;
const H=this._clientNodeLoader.renderSR,J=this._getNodeInternal(G);if(null==J)break;for(let N=0;N<J.childCount;N++){var O=this.getChildIndex(G,N);O=this._getNodeInternal(O);O=null!=O?O.ref||O.node:null;if(null!=O&&0<O.mbs[3])if(null==I)I=q.copy(O.mbs,B);else{const R=C,W=E,T=F;u.projectBoundingSphere(O.mbs,L,R,H);u.projectBoundingSphere(I,L,W,H);q.union(R,W,T);u.projectBoundingSphere(T,H,I,L)}}L=J.ref||J.node;null!=L&&(null!=I?L.mbs=q.copy(I,null!=L.mbs?L.mbs:q.create()):f.invalidateMbs(L.mbs),f.invalidateMbs(L.renderMbs),
f.invalidateObb(L.serviceObbInRenderSR),L.geometryObb=null);this.invalidateNodeVisibilityCacheInternal(J);G=this.getParentIndex(G)}while(null!=G)};K.populateChildren=function(G,L){var O=this._getNodeInternal(G);const I=this._getPage(G);O.childOffset=I.children.length;O.childCount=L.length;for(O=0;O<L.length;O++){const H=this._makeRefNode(L[O],G);I.children.push(H)}};K.getNode=function(G){G=this._getNodeInternal(G);return null!=G?G.node:null};K.getIndexById=function(G){let L;this._forAllNodes((O,I)=>
{null!=O.node&&O.node.id===G?L=I:null!=O.ref&&O.ref.id===G&&(L=I)});return L};K.getNodeById=function(G){G=this.getIndexById(G);return null!=G&&0<=G?this.getNode(G):null};K.getChildIndex=function(G,L){const O=this._getPage(G);if(null==O)return-1;G=O.nodes[n(G,this._nodesPerPage)];return O.children[G.childOffset+L]};K.getParentIndex=function(G){const L=this._getPage(G);return null!=L&&G!==this._rootIndex?L.parents[n(G,this._nodesPerPage)]:null};K.getParent=function(G){G=this.getParentIndex(G);return null!=
G?this.getNode(G):null};K.isLeaf=function(G){G=this._getNodeInternal(G);return null!=G&&0===G.childCount};K.removeAllGeometryObbs=function(){this._forAllNodes(G=>{null!=G.node&&(G.node.geometryObb=null)})};K.invalidateVisibilityCache=function(){this._visibilityCacheVersion=f.addWraparound(this._visibilityCacheVersion,2)};K.invalidateNodeVisibilityCache=function(G){G=this._getNodeInternal(G);null!=G&&this.invalidateNodeVisibilityCacheInternal(G)};K.invalidateNodeVisibilityCacheInternal=function(G){G.visibilityCache=
f.addWraparound(this._visibilityCacheVersion,-2)};K.invalidateBoundingVolumeCache=function(G){G=this._getNodeInternal(G);null!=G&&(e(G),this.invalidateNodeVisibilityCacheInternal(G))};K.updateElevationChanged=function(G){const L=this._getNodeInternal(G);null!=L&&(this.needNodeElevationRange?(G=null!=L.node?L.node:L.ref,null!=G&&(G=G.elevationRange,null!=G&&(G.valid=!1))):this.invalidateBoundingVolumeCache(G))};K.invalidateGeometryVisibility=function(G){G=this._getNodeInternal(G);null!=G&&null!=G.node&&
(G.node.geometryObb=null,f.invalidateMbs(G.node.renderMbs),f.invalidateObb(G.node.serviceObbInRenderSR))};K.invalidateVisibilityObbs=function(){null!=this.rootNode&&this.traverse(this.rootNode,G=>{G.visibilityObb=this._computeVisibilityObb(G);G.geometryObb=null;return!0})};K._updateElevationRange=function(G){const L=this._getNodeInternal(G);if(null==L)return null;var O=null!=L.node?L.node:L.ref;if(null==O)return null;const I=O.elevationRange;if(null!=I&&I.valid)return I;const H=new d.ElevationRange;
let J=!1;for(let N=0;N<L.childCount;N++){const R=this._updateElevationRange(this.getChildIndex(G,N));null==R?J=!0:(H.min=Math.min(H.min,R.min),H.max=Math.max(H.max,R.max))}if(0===L.childCount||J&&null!=L.node&&L.node.resources.geometry)O=this._viewportQueries.getElevationRange(O),null!=O&&(H.min=Math.min(H.min,O.min),H.max=Math.max(H.max,O.max));if(null!=I&&I.min===H.min&&I.max===H.max)return I.valid=!0,I;H.valid=!0;null!=L.node&&(L.node.elevationRange=H);null!=L.ref&&(L.ref.elevationRange=H);this.invalidateBoundingVolumeCache(G);
return H};K.isNodeVisible=function(G){const L=this._getNodeInternal(G);if(null==L||null!=L.ref&&!L.ref.mbs)return!0;this.needNodeElevationRange&&this._updateElevationRange(G);if((L.visibilityCache&-2)!==this._visibilityCacheVersion){G=L.node;const I=!G||L.ref&&!G.visibilityObb?L.ref??null:G;if(this._layerHasFilter&&this._computeNodeFiltering&&(null!=G||null!=L.ref)&&L.filterImpact===d.NodeFilterImpact.NotChecked){var O=null!=G?G.mbs:null!=L.ref?L.ref.mbs:null;L.filterImpact=null!=O?this._computeNodeFiltering(O):
d.NodeFilterImpact.Unmodified}O=null!=G&&L.filterImpact===d.NodeFilterImpact.Culled;G=!(null!=G&&G.imModificationImpact===d.NodeIMModificationImpact.Culled)&&(!I||this._viewportQueries.isNodeVisible(I))&&!O;L.visibilityCache=this._visibilityCacheVersion+(G?1:0);return G}return 1===(L.visibilityCache&1)};K.isGeometryVisible=function(G){if(!this.isNodeVisible(G))return!1;G=this._getNodeInternal(G);return null==G||null==G.node||null==G.node.geometryObb||this.layerHasModifications&&G.node.imModificationImpact===
d.NodeIMModificationImpact.NotChecked?!0:this._viewportQueries.isGeometryVisible(G.node)};K._traverseCoverage=function(G,L,O,I,H){G=this._getPage(G);if(null!=G&&0!==L.childCount){var J=L.childOffset+L.childCount,N=[];for(L=L.childOffset;L<J;++L){const R=G.children[L],W=this._getNodeInternal(R);null!=W&&null!=W.node&&this.isGeometryVisible(R)&&N.push(W)}I/=N.length;for(const R of N)G=R.node.index,this._isLoaded(G)||this._isReloading(G)?(H.delta=Math.max(H.delta,O),H.coverage+=I):this._traverseCoverage(G,
R,O+1,I,H)}};K.useNodeAsHole=function(G){if("off"===this.holeFilling)return!1;const L=this._getNodeInternal(G);if(null==L)return!1;if("always"===this.holeFilling)return!0;if((L.useAsHole&-2)===this._version)return 1===(L.useAsHole&1);const O={delta:0,coverage:0};this._traverseCoverage(G,L,0,1,O);G=.5>=O.delta*O.coverage;L.useAsHole=this._version+(G?1:0);return G};K.destroy=function(){this._updates.add.prune();this._updates.update.prune()};K.requestUpdate=function(){this._dirty=!0;this._indexMissing=
1;this._version=f.addWraparound(this._version,2)};K.imModificationsChanged=function(G){this.layerHasModifications=G;this._forAllNodes(({node:L})=>{null!=L&&(L.imModificationImpact=d.NodeIMModificationImpact.NotChecked,L.visibilityObb=this._computeVisibilityObb(L),L.hasModifications&&this.invalidateGeometryVisibility(L.index))});this.invalidateVisibilityCache()};K.layerFilterChanged=function(G){this._layerHasFilter=G;this._forAllNodes(L=>{null!=L&&(L.filterImpact=d.NodeFilterImpact.NotChecked,L=L.node,
null!=L&&this.invalidateNodeVisibilityCache(L.index))});this.invalidateVisibilityCache()};K.update=function(G,L,O){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(L);this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(G);x.clear();var I=!0,H=new v,J=new v,N=this._imModificationUncategorized;N.clear();var R=new Set;this.traverseVisible((T,P,Q)=>{if(null==P)P=this._entryPriority(T),Infinity===P&&(P=this._entryPriority(Q)),
T=h(T,this._nodesPerPage),x.set(T,Math.max(P,x.get(T)||0)),this._loading.has(T)||this._failedPages.has(T)||this._missing.push(T),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P);else{var S=P.node;this._updateNodeFeatureEstimate(S,J);if(null==S)P=this._entryPriority(T),this._loading.has(T)||this._failedNodes.has(T)||(this._missing.push(T),x.set(T,P)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P);else{Q=this._getPage(T);if(0===this._missing.length&&0===this._nodesPerPage)for(let U=
0;U<P.childCount;U++){const V=Q.children[P.childOffset+U],X=this._getNodeInternal(V);null==X||X.node||this._loading.has(V)||this._failedNodes.has(V)||(x.set(V,this._entryPriority(V)),this._prefetch.push(V))}S.failed||S.resources.isEmpty?I&&0<P.childCount&&this._isSelected(S)&&(I=!1):(R.add(S.id),this._isLoaded(T)?(H.known+=S.memory,++H.knownNodes,this._isSelected(S)?0<P.childCount&&(I=!1):(H.unremoved+=S.memory,I=!1),this._needsUpdate(S)&&(P=this._entryPriority(T),x.set(T,P),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,P),this._updates.update.push(T))):(S.memory&&(H.known+=S.memory,++H.knownNodes),this._isSelected(S)?(0<P.childCount&&(I=!1),S.memory?(H.missing+=S.memory,H.known+=S.memory,++H.knownNodes):++H.missingNodes,G.includes(S.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(T)),this._updates.cancel=this._updates.cancel.filter(U=>U!==S.index)):!L.done&&this._enable(S)?L.madeProgress():(P=this._entryPriority(T),x.set(T,P),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,P),this._updates.add.push(T),this.layerHasModifications&&O&&null!=S&&S.imModificationImpact===d.NodeIMModificationImpact.NotChecked&&N.push(T))):this._isReloading(T)&&this._updates.remove.push(T)))}}});var W=this._updates.add;0<W.length&&this.layerHasModifications&&(0<N.length&&O?.(N),W.filterInPlace(T=>{var P=this._getNodeInternal(T);(P=null==P||null==P.node||P.node.imModificationImpact!==d.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(T);return P}));
this._unloadedMemoryEstimate=H.missing-H.unremoved;3<H.knownNodes&&0<H.missingNodes&&(this._unloadedMemoryEstimate+=H.known/H.knownNodes*H.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(J);this._featureEstimate.leavesReached=I;this._missing.sort((T,P)=>T-P);this._missing.filterInPlace((T,P)=>1>P||this._missing.data[P-1]!==T);this._missing.sort((T,P)=>x.get(T)-x.get(P));0<this._missing.length&&(this._maxUnloadedPrio=
x.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(T=>x.get(T)>=this._maxUnloadedPrio).sort((T,P)=>x.get(T)-x.get(P));this._updates.update.sort((T,P)=>x.get(T)-x.get(P));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;x.clear()}};K.checkFeatureTarget=function(G,L){const O=this._viewportQueries.updateScreenSpaceErrorBias(L);let I=L,H=L,J=O,N=10;for(;N--;){const R=new v;this._updateFeatureEstimate(I,R);if(this._computeFeatureEstimate(R)<=
G){if(I>=L||0<R.missingNodes||0===N)break;J=I;I=.5*(I+H)}else H=I,I=.5*(I+J)}this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(O);return Math.min(L,I)};K._updateFeatureEstimate=function(G,L){this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(G);this.traverseVisible((O,I)=>this._updateNodeFeatureEstimate(null!=I?I.node:void 0,L))};K._updateNodeFeatureEstimate=function(G,L){null==G||G.failed||null==G.numFeatures||
(this._isLoaded(G.index)?(L.known+=G.numFeatures,++L.knownNodes,this._isSelected(G)||(L.unremoved+=G.numFeatures)):this._isSelected(G)&&(null!=G.numFeatures?(L.missing+=G.numFeatures,L.known+=G.numFeatures,++L.knownNodes):++L.missingNodes))};K._computeFeatureEstimate=function(G){let L=G.known-G.unremoved;3<G.knownNodes&&0<G.missingNodes&&(L+=G.known/G.knownNodes*G.missingNodes);return Math.max(0,L)};K.load=function(){return this._load(this._missing)};K.prefetch=function(){this._prefetch.sort((G,L)=>
x.get(G)-x.get(L));return this._load(this._prefetch)};K._load=function(G){if(0===G.length||!this._canRequest())return!1;for(;0<G.length&&this._canRequest();)if(0===this._nodesPerPage)this._loadNode(G.pop());else{const L=G.pop();0<=L?this._loadPage(L):this._loadNode(L)}return!0};K.nodeTraversalState=function(G){if(null==G)return null;let L=this._nodeTraversalState.get(G.index);if(L&&(L.version&-2)===this._version)return L;const O=this._viewportQueries.getLodLevel(G),I=this._viewportQueries.hasLOD(G);
var H=!0;I?(H=this.getParentIndex(G.index),null!=H?(H=this._nodeTraversalState.get(H),H=!!H&&O>H.lodLevel):H=0<O):H=0===G.childCount;if(L)return L.lodLevel=O,L.isChosen=H,L.version=this._version+1,L;L=new d.NodeTraversalState(I,H,O,this._version+1);this._nodeTraversalState.set(G.index,L);return L};K._loadNode=async function(G){this._loading.add(G);var L=this._getNodeInternal(G).ref;if(null==L)this._failedNodes.add(G);else{L=L.id;var O=this._urlPrefix+L,I=()=>{this._loading.delete(G);0===this._missing.length&&
0===this._loading.size&&this.requestUpdate()},H=null;try{H=0<=G?await this._streamDataController.request(O,"json"):await this._clientNodeLoader.loadNodeJSON(L)}catch(J){I();y.isAbortError(J)||(this._logger.error("#loadNode()",this._layer,"Error loading node: "+O),this._failedNodes.add(G));return}I();L=this._validateNode(L,H);null!=L&&(L.obb&&this.invalidateNodeVisibilityCache(G),L=this._addNode(L,G),this.nodeTraversalState(L))}};K._validateNode=function(G,L){if(null==L||"object"!==typeof L||L.id!==
G)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${G}"`),null;if(!Array.isArray(L.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${G}.`),null;L.sharedResource&&"./shared"!==L.sharedResource.href&&"./shared/"!==L.sharedResource.href&&this._logger.warn("#validateNode()",this._layer,`Invalid shared resource href on node "${G}"`);var O=L.geometryData;null==O||Array.isArray(O)&&0===O.length||Array.isArray(O)&&
1===O.length&&"./geometries/0"===O[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${G}"`);O=L.attributeData;const I=this._layer.attributeStorageInfo;null==O||Array.isArray(O)&&!O.some((R,W)=>R.href!==`./attributes/${I?.[W]?.key??`f_${W}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${G}"`);L.featureData&&1<L.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${G} has ${L.featureData.length} bundles. Only the first bundle will be loaded.`);
O=L.hasOwnProperty("obb")&&!this.ignoreServiceObb?L.obb:null;const H=L.featureData&&1===L.featureData.length&&L.featureData[0].featureRange?L.featureData[0].featureRange[1]-L.featureData[0].featureRange[0]+1:void 0;var J=R=>{if(null==R)return null;var W=T=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${G}: ${T}`);if("number"===typeof R.id)W(`id ${R.id} is a number instead of a string.`);else if("string"!==typeof R.id||!Array.isArray(R.mbs))return W("Missing or invalid id."),
null;if(!Array.isArray(R.mbs))return W(`Invalid bounding volume on reference ${R.id}.`),null;R.href&&R.href!=="../"+R.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${G}"`);W=R.hasOwnProperty("obb")&&!this.ignoreServiceObb?R.obb:null;R=new d.NodeBase(`${R.id}`,R.mbs);R.serviceObb=W;R.visibilityObb=this._computeVisibilityObb(R);return R};J=Array.isArray(L.children)?L.children.map(J).filter(R=>null!=R):null;const N=L.isEmpty&&!0===L.isEmpty;return{id:G,mbs:L.mbs,obb:O,
children:J,resources:{isEmpty:!(L.featureData&&1<L.featureData.length)&&N,hasSharedResource:null!=L.sharedResource,attributes:L.attributeData?G:void 0,texture:L.textureData&&0<L.textureData.length?G:void 0,geometry:null!=L.geometryData?G:void 0},version:"string"===typeof L.version?L.version:null,lodSelection:Array.isArray(L.lodSelection)?L.lodSelection:null,numFeatures:H}};K.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(G=>{null!=G.node&&(G.node.failed=
!1)})};K._entryPriority=function(G){var L=this._getNodeInternal(G),O=this.getParentIndex(G);if(null==L||null==O&&null==L.node)return null==O?Infinity:this._entryPriority(O);let I=0;L.node&&null!=O&&(O=this._nodeTraversalState.get(O),null!=O&&(I=O.lodLevel));for(O=this.progressiveLoadPenalty;null!=G;G=this.getParentIndex(G))if(this._isLoaded(G)){O=0;break}L=null!=L.ref?this._viewportQueries.distToPOI(L.ref):null!=L.node?this._viewportQueries.distToPOI(L.node):0;return-L-I*(L+this.progressiveLoadPenalty)+
O};K.traverseVisible=function(G){const L=this._getNodeInternal(this._rootIndex);null==L?G(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,L,G)};K._traverseVisible=function(G,L,O,I){if(O.node&&0===O.childCount)this.isGeometryVisible(G)&&I(G,O,L);else if(this.isNodeVisible(G)&&(I(G,O,L),null!=O.node&&(L=this.nodeTraversalState(O.node),!L?.nodeHasLOD||L.lodLevel!==this._maxLodLevel))){L=this._getPage(G);for(let H=0;H<O.childCount;H++){const J=L.children[O.childOffset+H],N=this._getNodeInternal(J);
null!=N?this._traverseVisible(J,G,N,I):I(J,null,G)}}};K.traverse=function(G,L){L(G)&&this.traverseChildren(G,L)};K.traverseChildren=function(G,L){G=G.index;const O=this._getNodeInternal(G);null!=O&&this._traverseChildren(G,O,L)};K._traverseChildren=function(G,L,O){G=this._getPage(G);if(null!=G){var I=L.childOffset+L.childCount;for(L=L.childOffset;L<I;++L){const H=G.children[L],J=this._getNodeInternal(H);null!=J&&null!=J.node&&O(J.node)&&this._traverseChildren(H,J,O)}}};K.updateChildrenLoaded=function(G,
L){for(G=this.getNode(G);null!=G;)G.childrenLoaded+=L,G=this.getParent(G.index)};K.checkChildrenLoadedInvariant=function(){if(null==this.rootNode)return!0;const G=[],L=O=>{let I=this._isLoaded(O.index)||this._isReloading(O.index)?1:0;this.traverseChildren(O,H=>{I+=L(H);return!1});O.childrenLoaded!==I&&G.push(O.index);return I};L(this.rootNode);G.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+G.join(","));return 0<G.length};K.updateStats=function(G){0<this._updates.add.length&&
(G.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)G.index+=" + "+this._indexMissing||this._prefetch.length;G.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const L=this._featureEstimate.estimate-G.features;0<L?G.features+=" + "+L:0>L&&(G.features+=" - "+-L)}};K.updateElevationInfo=function(G,L){this.needNodeElevationRange=L&&!!G&&("relative-to-ground"===G.mode||"on-the-ground"===G.mode);this._viewportQueries.updateElevationInfo(G);this.invalidateAllElevationRanges()};
K.invalidateAllElevationRanges=function(){this._forAllNodes(G=>{e(G);null!=G.node&&(G.node.elevationRange=null);null!=G.ref&&(G.ref.elevationRange=null)})};K._forAllNodes=function(G){if(null!=this._clientNodePage){var L=this._clientNodePage;for(var O=0;O<L.nodes.length;O++)G(L.nodes[O],-(O+1))}for(L=0;L<this._nodePages.length;L++)if(O=this._nodePages[L]){const I=L*this._nodesPerPage;for(let H=0;H<O.nodes.length;H++)G(O.nodes[H],I+H)}};b._createClass(M,[{key:"rootNode",get:function(){return this.getNode(this._rootIndex)}},
{key:"size",get:function(){return this._nodeCount}},{key:"isEditable",get:function(){return this._isEditable}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"isLoading",get:function(){return 0<this._indexMissing}},{key:"isPrefetching",get:function(){return 0<this._prefetch.length}},{key:"indexLoading",get:function(){return this._loading.size}},{key:"indexMissing",get:function(){return this._indexMissing}},{key:"unloadedMemoryEstimate",
get:function(){return this._unloadedMemoryEstimate}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"maxPriority",get:function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)}},{key:"test",get:function(){return{addNode:(G,L)=>this._addNode(G,L)}}}]);return M}();const x=new Map;let D=function(){function M(K){this.missing=K;this.update=new c({deallocator:null});this.add=new c({deallocator:null});this.remove=
new c({deallocator:null});this.cancel=[]}M.prototype.reset=function(K){this.add.clear();this.update.clear();this.cancel=K};return b._createClass(M)}();const A=[["maxScreenThreshold",d.LodMetric.MaxScreenThreshold],["screenSpaceRelative",d.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",d.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",d.LodMetric.DistanceRangeFromDefaultCamera]];let v=b._createClass(function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=
this.known=0});const B=q.create(),C=q.create(),E=q.create(),F=q.create();a.I3SIndex=r;a.selectErrorMetric=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/sphere"],function(a,b,c){let y=b._createClass(function(k,d){this.id=k;this.mbs=d;this.renderMbs=c.fromValues(0,0,0,-1);this.elevationRange=null}),p=b._createClass(function(){this.min=Infinity;this.max=
-Infinity;this.valid=!1});a.NodeFilterImpact=void 0;(function(k){k[k.Unmodified=0]="Unmodified";k[k.Culled=1]="Culled";k[k.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(k){k[k.Unmodified=0]="Unmodified";k[k.PotentiallyModified=1]="PotentiallyModified";k[k.Culled=2]="Culled";k[k.Unknown=3]="Unknown";k[k.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let u=function(k){function d(f,g,e,
h,z,n,l,m,t,w){f=k.call(this,f,e)||this;f.index=g;f.childCount=h;f.level=z;f.resources=n;f.version=l;f.lodMetric=m;f.maxError=t;f.numFeatures=w;f.failed=!1;f.cacheState=a.CacheState.Unknown;f.vertexCount=0;f.memory=0;f.childrenLoaded=0;f.hasModifications=!1;f.imModificationImpact=a.NodeIMModificationImpact.NotChecked;return f}b._inherits(d,k);return b._createClass(d)}(y);a.CacheState=void 0;(function(k){k[k.Unknown=0]="Unknown";k[k.Uncached=1]="Uncached";k[k.Cached=2]="Cached"})(a.CacheState||(a.CacheState=
{}));a.LodMetric=void 0;(function(k){k[k.None=0]="None";k[k.MaxScreenThreshold=1]="MaxScreenThreshold";k[k.ScreenSpaceRelative=2]="ScreenSpaceRelative";k[k.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";k[k.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(k){k[k.Hole=0]="Hole";k[k.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));let q=b._createClass(function(k,d,f,g){this.nodeHasLOD=k;this.isChosen=d;this.lodLevel=
f;this.version=g});a.ElevationRange=p;a.Node=u;a.NodeBase=y;a.NodeTraversalState=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,c,y){let p=function(){function q(d){this._layerView=d;this._lodGlobalDirty=!1}var k=q.prototype;k.startNodeLoading=function(d,f,g,e){this._maxLodLevel=e.maxLodLevel;
this._index=g;this._isNodeInScaleBounds=d;this._removeNodes=f};k.shouldLoadNode=function(d){if(null==d)return!1;const f=this._index.nodeTraversalState(d);return this._isChosenMaxLOD(f)?!0:f.isChosen?this._childrenRequireLoading(d):!1};k.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};k.lodGlobalHandling=function(d){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var f=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));u.clear();
this._lodGlobalHandling(this._index.rootNode,f,!1,!!this._layerView.nodeCrossfadingEnabled);f=u.length;this._removeNodes(u,d);d=u.length<f;0!==u.length&&(this._lodGlobalDirty=!0);u.clear();return d};k._lodGlobalHandling=function(d,f,g,e){if(null==d)return!1;const h=d.index,z=this._index,n=this._layerView;var l=z.nodeTraversalState(d);l=this._isChosenMaxLOD(l);var m=d.resources.isEmpty;if(l&&m)return 0<d.childrenLoaded&&this._removeChildrenRecursive(d),!0;m=n.isNodeLoaded(h);if(e&&m&&l){var t=!g&&
this.hasNoVisibleChildren(d);n.fadeNode(h,y.FadeDirection.FadeIn,!t)}t=m&&(!n.isNodeFullyFadedIn||n.isNodeFullyFadedIn(h));if(m&&(n.updateNodeState(h,l?c.NodeState.Leaf:c.NodeState.Hole),l))return t&&this._removeChildrenRecursive(d),t;var w=0<d.childCount;let r=w;if(w)for(w=0;w<d.childCount;w++){const x=z.getChildIndex(h,w),D=z.getNode(x);null!=D?z.isGeometryVisible(x)&&!this._lodGlobalHandling(D,f,g||t,e)&&this._isNodeInScaleBounds(D)&&(r=!1):z.isNodeVisible(x)&&(r=!1)}(f=m&&!l&&(r||u.length<f))&&
u.push(h);!e||f||!m||g||r||n.fadeNode(h,y.FadeDirection.FadeIn,!1);d=d.resources.isEmpty;return r||t&&!f||d};k._removeChildrenRecursive=function(d){this._index.traverseChildren(d,f=>{(this._layerView.isNodeLoaded(f.index)||this._layerView.isNodeReloading(f.index))&&u.push(f.index);return 0<f.childrenLoaded})};k.hasNoVisibleChildren=function(d){let f=!0;this._index.traverseChildren(d,g=>f&&this._index.isNodeVisible(g.index)?this._layerView.isNodeLoaded(g.index)?f=!1:0<g.childrenLoaded:!1);return f};
k._childrenRequireLoading=function(d){let f=!1,g=!0;this._index.traverseChildren(d,e=>{if(!g||!this._index.isNodeVisible(e.index))return!1;const h=this._index.nodeTraversalState(e);this._isChosenMaxLOD(h)&&this._index.isGeometryVisible(e.index)&&(f=!0);return this._layerView.isNodeLoaded(e.index)?g=!1:0<e.childrenLoaded});return g&&f};k._isChosenMaxLOD=function(d){return d.isChosen&&(!d.nodeHasLOD||d.lodLevel===this._maxLodLevel)};a._createClass(q,[{key:"requiresLODGlobalHandling",get:function(){return null!=
this._index&&!0===this._lodGlobalDirty}}]);return q}();const u=new b({deallocator:null});return p})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,b,c,y,p,u,q,k,d){return function(){function f(e,h,z,n,l,m){this._streamDataController=h;this._logger=z;this._defaultGeometrySchema=n;this._requiredAttributes=l;this._options=m;this._logLayer=e;this._layerUrl=e.parsedUrl.path;this._geometryDefinitions=e.geometryDefinitions;if(e.materialDefinitions){const t=e.textureSetDefinitions;this._materialAndTextures=e.materialDefinitions.map(w=>d.getMaterialAndTextures(t,w))}}var g=f.prototype;g._load=function(e,h,z){return this._streamDataController.request(e,
h,z)};g._loadAttribute=function(e,h,z){return this._load(`${this._layerUrl}/nodes/${e.resources.attributes}/attributes/${h.key}/0`,"binary",z).then(n=>k.readBinaryAttribute(h,n))};g.loadAttributes=function(e,h,z){return p.eachAlways(h.map(n=>this._loadAttribute(e,n.attributeStorageInfo,z))).then(n=>{const l={};for(let m=0;m<h.length;++m){const t=n[m].value;if(t)l[h[m].name]=t;else{if(p.isAbortError(n[m].error))throw n[m].error;this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${h[m].name}' on node '${e.id}'`,
n[m].error)}}return l})};g.loadNodeData=async function(e,h){var z=null!=this._requiredAttributes&&e.resources.attributes?b.result(this.loadAttributes(e,this._requiredAttributes,h)):null;var n=this._geometryDefinitions;var l={bufferDefinition:null,bufferIndex:0};var m=e.resources.geometryDefinition;if(!(null==n||null==m||0>m)&&(n=0<=m?n[m].geometryBuffers:null,null!=n))for(m=0;m<n.length;m++){var t=n[m];if(null!=t.compressedAttributes){if("draco"===t.compressedAttributes.encoding&&!c("disable-feature:i3s-draco")){l.bufferIndex=
m;l.bufferDefinition=t;break}}else l.bufferIndex=m,l.bufferDefinition=n[m]}const {bufferDefinition:w,bufferIndex:r}=l;m=(t=!!e.resources.geometry)?b.result(this._loadGeometry(e.resources.geometry,r,h)):null;n=e.resources.hasSharedResource?await this._loadShared(e,h):null;l=e.resources.materialDefinition;l=this._materialAndTextures&&null!=l&&0<=l?this._materialAndTextures[l]:null!=n?d.getMaterialAndTexturesFromShared(n):null;var x=l?.material;l=l?.textures??[];const D=`${e.id}`,A=!t&&this._options.loadFeatureData;
t=A?await this._loadFeatureData(D,h):null;if(A)a:{if(t)for(B of t.featureData)if(x=B.geometries,null!=x)for(var v of x){var B={featureIds:[B.id],featureDataPosition:B.position,geometries:[v]};break a}B=null}else B={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:x}}],featureDataPosition:[0,0,0]};if(null==B)if(t){v=[];for(C of t.featureData)null!=C.position&&v.push({featureIds:[C.id],featureDataPosition:C.position,geometries:[]});var C=v}else C=null;else C=null;v=0<l.length?b.result(this.loadTextures(e,
l,h)):null;h=e=null;m&&(e=b.assertResult(await m),(h=this._defaultGeometrySchema)&&n&&n.materialDefinitions&&(m=Object.keys(n.materialDefinitions)[0],!n.materialDefinitions[m].params.vertexRegions&&h.vertexAttributes.region&&(h=y.clone(h),delete h.vertexAttributes.region)),h=k.createGeometryDescriptor(w,h));n=v?b.assertResult(await v):null;z=(z=z?b.assertResult(await z):{})?{attributeData:z,loadedAttributes:this._requiredAttributes}:null;if(null!=B)return{geometryData:B,attributeDataInfo:z,geometryBuffer:e,
geometryDescriptor:h,requiredTextures:l,textureData:n};if(null!=C)return{pointData:C,attributeDataInfo:z,geometryBuffer:e,geometryDescriptor:h,requiredTextures:l,textureData:n};throw Error();};f._addAbsoluteHrefTexture=function(e,h){e=e.textureDefinitions;if(null!=e)for(const z of Object.keys(e))for(const n of e[z].images)Array.isArray(n.href)?n.hrefConcat=n.href.map(l=>u.makeAbsolute(l,h)):n.hrefConcat=u.makeAbsolute(n.href,h)};f._fixTextureEncodings=function(e){e=e.textureDefinitions;if(null!=e)for(const z in e){const n=
e[z];if(Array.isArray(n.encoding))for(var h=0;h<n.encoding.length;h++){const l=n.encoding[h];"data:"===l.substring(0,5)&&(n.encoding[h]=l.substring(5))}else h=n.encoding,"data:"===h.substring(0,5)&&(n.encoding=h.substring(5))}};g._loadShared=function(e,h){const z=`${this._layerUrl}/nodes/${e.resources.geometry}/shared`;return this._load(z,"json",h).then(n=>{f._fixTextureEncodings(n);f._addAbsoluteHrefTexture(n,z);return n})};g._loadTexture=function(e,h,z,n,l,m){let t=!1;return l===q.TextureEncoding.DDS_S3TC||
l===q.TextureEncoding.KTX2||l===q.TextureEncoding.Basis?this._load(e,"binary",m).then(w=>({id:h,usage:z,data:w,encoding:l,downsampled:t})):this._load(e,"image",m).then(w=>{var r=w;if(n&&4096<=w.width*w.height){r=Math.ceil(w.width/2);const x=Math.ceil(w.height/2),D=document.createElement("canvas");D.width=r;D.height=x;D.getContext("2d").drawImage(w,0,0,r,x);r=D;t=!0}return{id:h,usage:z,data:r,encoding:l,downsampled:t}})};g.loadTextures=function(e,h,z){const n=!!this._options.uncompressedTextureDownsamplingEnabled,
l=this._options.textureUsageMask;return Promise.all(h.map(m=>{if(0===(m.usage&l))return null;const t=d.selectEncoding(m.encodings,this._options.textureEncodings);return null==t?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${e.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${e.resources.texture||e.id}/textures/${t.name}`,m.id,m.usage,n,t.encoding,z)}))};g._loadFeatureData=function(e,h){return this._load(`${this._layerUrl}/nodes/${e}/features/0`,
"json",h)};g._loadGeometry=function(e,h,z){return this._load(`${this._layerUrl}/nodes/${e}/geometries/${h}`,"binary",z)};return a._createClass(f)}()})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(r){return r.sort((x,D)=>x.encoding-D.encoding)}function h(r,x,D){if(null==r||D===y.TextureUsage.None)return null;for(let A=0;A<r.length;A++){const v=r[A];if(null!=v&&0!==(v.usage&D))return r=x[A],null!=r?r.id:null}return null}function z(r){switch(r){case y.TextureEncoding.KTX2:return k.TextureEncodingMimeType.KTX2_ENCODING;case y.TextureEncoding.Basis:return k.TextureEncodingMimeType.BASIS_ENCODING;case y.TextureEncoding.DDS_S3TC:return k.TextureEncodingMimeType.DDS_ENCODING;
case y.TextureEncoding.PNG:return"image/png";case y.TextureEncoding.JPG:return"image/jpeg";case y.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const n={ktx2:y.TextureEncoding.KTX2,basis:y.TextureEncoding.Basis,dds:y.TextureEncoding.DDS_S3TC,png:y.TextureEncoding.PNG,jpg:y.TextureEncoding.JPG,"ktx-etc2":y.TextureEncoding.KTX_ETC2},l={[k.TextureEncodingMimeType.KTX2_ENCODING]:y.TextureEncoding.Basis,[k.TextureEncodingMimeType.BASIS_ENCODING]:y.TextureEncoding.Basis,[k.TextureEncodingMimeType.DDS_ENCODING]:y.TextureEncoding.DDS_S3TC,
"image/png":y.TextureEncoding.PNG,"image/jpg":y.TextureEncoding.JPG,"image/jpeg":y.TextureEncoding.JPG,"image/ktx":y.TextureEncoding.KTX_ETC2},m=()=>({alphaMode:"opaque",alphaCutoff:u.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:k.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
t={s:g.TextureWrapMode.CLAMP_TO_EDGE,t:g.TextureWrapMode.CLAMP_TO_EDGE},w={s:g.TextureWrapMode.REPEAT,t:g.TextureWrapMode.REPEAT};a.configureMaterial=function(r,x,D,A,v,B){const C=B.rendererTextureUsage;var E=x.metallicRoughness.baseColorFactor,F=c.clamp(x.metallicRoughness.baseColorFactor[3],0,1);r.baseColor=[E[0],E[1],E[2],F];r.hasParametersFromSource=!!x.hasParametersFromSource;r.usePBR=B.usePBR;r.mrrFactors=[x.metallicRoughness.metallicFactor,x.metallicRoughness.roughnessFactor,x.hasParametersFromSource?
f.defaultSchematicMRRFactors[2]:f.defaultAdvancedMRRFactors[2]];r.emissiveFactor=x.emissiveFactor;r.isIntegratedMesh=B.isIntegratedMesh;r.textureAlphaCutoff="mask"===x.alphaMode?x.alphaCutoff:u.defaultMaskAlphaCutoff;r.alphaDiscardMode="opaque"===x.alphaMode?k.AlphaDiscardMode.Opaque:"mask"===x.alphaMode?k.AlphaDiscardMode.Mask:k.AlphaDiscardMode.MaskBlend;E=[];F=h(A,D,(y.TextureUsage.Color|y.TextureUsage.AlphaMask)&C);null!=F&&(r.baseColorTexture=new p.RenderTexture(v,F),E.push(r.baseColorTexture.loadPromise));
F=h(A,D,y.TextureUsage.MetallicRoughness&C);null!=F&&(r.metallicRoughnessTexture=new p.RenderTexture(v,F),E.push(r.metallicRoughnessTexture.loadPromise));F=h(A,D,y.TextureUsage.Emissive&C);null!=F&&(r.emissionTexture=new p.RenderTexture(v,F),E.push(r.emissionTexture.loadPromise));F=h(A,D,y.TextureUsage.Occlusion&C);null!=F&&(r.occlusionTexture=new p.RenderTexture(v,F),E.push(r.occlusionTexture.loadPromise));D=h(A,D,y.TextureUsage.Normal&C);null!=D&&(r.normalTexture=new p.RenderTexture(v,D),E.push(r.normalTexture.loadPromise));
r.commonMaterialParameters.hasSlicePlane=B.slicePlaneEnabled;r.commonMaterialParameters.doubleSided=x.doubleSided;r.commonMaterialParameters.cullFace=x.cullFace;r.ellipsoidMode=q.getEllipsoidMode(B.viewSpatialReference);return Promise.all(E)};a.createTexture=function(r,x,D,A){if(null==r||null==r.data)return null;const v=r.data;A=A.renderingContext.parameters.maxMaxAnisotropy;const B=!r.downsampled&&1<A;D=D||!x.wrapTextures?t:w;const C=z(r.encoding);return new d.Texture(v,{mipmap:B,maxAnisotropy:A,
encoding:C,wrap:D,components:r.usage&y.TextureUsage.Color?"opaque"===x.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=m;a.getMaterialAndTextures=function(r,x){const D=new Map,A=(G,L)=>{if(null==G)return-1;var O=D.get(G.id);if(O)return O.usage|=L,O.id;O=D.size;D.set(G.id,{id:O,usage:L});return O};var v=x.pbrMetallicRoughness;const B=v?.baseColorFactor,C=x.emissiveFactor,E=f.useSchematicPBR({normalTexture:x.normalTexture,emissiveTexture:x.emissiveTexture,emissiveFactor:x.emissiveFactor,occlusionTexture:x.occlusionTexture,
metallicRoughnessTexture:v?.metallicRoughnessTexture,metallicFactor:v?.metallicFactor,roughnessFactor:v?.roughnessFactor}),F=E?f.defaultSchematicMRRFactors[0]:v?.metallicFactor??f.defaultAdvancedMRRFactors[0],M=E?f.defaultSchematicMRRFactors[1]:v?.roughnessFactor??f.defaultAdvancedMRRFactors[1];v={baseColorFactor:B?[B[0],B[1],B[2],B[3]]:[1,1,1,1],baseColorTextureId:A(v&&v.baseColorTexture,"mask"===x.alphaMode?y.TextureUsage.Color|y.TextureUsage.AlphaMask:y.TextureUsage.Color),metallicRoughnessTextureId:A(v&&
v.metallicRoughnessTexture,y.TextureUsage.MetallicRoughness),metallicFactor:F,roughnessFactor:M};x={alphaMode:x.alphaMode,alphaCutoff:x.alphaCutoff,doubleSided:x.doubleSided,cullFace:"none"===x.cullFace?k.CullFaceOptions.None:"back"===x.cullFace?k.CullFaceOptions.Back:"front"===x.cullFace?k.CullFaceOptions.Front:k.CullFaceOptions.None,normalTextureId:A(x.normalTexture,y.TextureUsage.Normal),emissiveTextureId:A(x.emissiveTexture,y.TextureUsage.Emissive),occlusionTextureId:A(x.occlusionTexture,y.TextureUsage.Occlusion),
emissiveFactor:C?[C[0],C[1],C[2]]:[0,0,0],metallicRoughness:v,wrapTextures:!1,hasParametersFromSource:E};const K=[];D.forEach(({usage:G},L)=>{var O=null!=r&&r[L]&&r[L].formats;O=O?e(O.map(({name:I,format:H})=>({name:I,encoding:n[H]}))):[];K.push({id:L,usage:G,encodings:O})});return{material:x,textures:K}};a.getMaterialAndTexturesFromShared=function(r){var x=r&&r.materialDefinitions?Object.keys(r.materialDefinitions)[0]:null,D=r&&r.textureDefinitions?Object.keys(r.textureDefinitions)[0]:null;x=x?r.materialDefinitions?.[x]:
null;D=D?r.textureDefinitions?.[D]:null;r=m();if(null!=x){x=x.params;x.diffuse&&(r.metallicRoughness.baseColorFactor=[x.diffuse[0],x.diffuse[1],x.diffuse[2],1]);null!=x.doubleSided&&(r.doubleSided=x.doubleSided,r.cullFace=x.doubleSided?k.CullFaceOptions.None:k.CullFaceOptions.Back);if("none"===x.cullFace||"front"===x.cullFace||"back"===x.cullFace)r.cullFace="none"===x.cullFace?k.CullFaceOptions.None:"back"===x.cullFace?k.CullFaceOptions.Back:k.CullFaceOptions.Front;x.transparency&&(r.metallicRoughness.baseColorFactor[3]=
c.clamp(1-x.transparency,0,1));if(x.useVertexColorAlpha||1>r.metallicRoughness.baseColorFactor[3])r.alphaMode="blend"}x=[];if(null!=D){!D.wrap||"repeat"!==D.wrap[0]&&"repeat"!==D.wrap[1]||(r.wrapTextures=!0);let A=y.TextureUsage.Color;"rgba"===D.channels&&(r.alphaMode="blend",A|=y.TextureUsage.AlphaMask);const v=D.images[D.images.length-1],B=C=>C&&C.split("/").pop();D=Array.isArray(D.encoding)?e(D.encoding.map((C,E)=>({name:B(v.href[E]),encoding:l[C]||0}))):[{name:B(v.href),encoding:l[D.encoding]||
0}];x.push({id:0,usage:A,encodings:D});r.metallicRoughness.baseColorTextureId=0}return{material:r,textures:x}};a.getSupportedEncodings=function(r){const x=!!r.compressedTextureS3TC;r=!!r.compressedTextureETC;const D=b("disable-feature:i3s-basis")?0:y.TextureEncoding.Basis|y.TextureEncoding.KTX2,A=D|y.TextureEncoding.DDS_S3TC;return y.TextureEncoding.JPG|y.TextureEncoding.PNG|(x?A:0)|(r?D:0)};a.selectEncoding=function(r,x){if(null!=x)return r.find(D=>0!==(D.encoding&x))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,c,y){let p=function(){function u(q,k){this._textureRep=q;this.loadPromise=null;this._disposed=!1;q=this._textureRep.acquire(k);y.isPromiseLike(q)?(q.then(d=>{this._disposed?c.releaseMaybe(d):this._textureRef=d}),this.loadPromise=q):this._textureRef=q}u.prototype.dispose=
function(){this._textureRef=c.releaseMaybe(this._textureRef);this._disposed=!0};b._createClass(u,[{key:"glTexture",get:function(){return null!=this._textureRef?this._textureRef.glTexture:null}}]);return u}();a.RenderTexture=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,b,c){let y=function(){function p(q,k){this._requester=
q;this._apiKey=k;this._activeRequests=new Set}var u=p.prototype;u.request=function(q,k,d){const f=new AbortController;d=c.onAbortOrThrow(d,()=>f.abort());q=this._requester.request(q,k,{signal:f.signal,query:{token:this._apiKey}});const g={response:q,abortController:f,abortHandle:d};this._activeRequests.add(g);c.always(q,()=>{g.abortController=null;g.abortHandle?.remove();g.abortHandle=null;this._activeRequests.delete(g)});return q};u.cancelAll=function(){this._activeRequests.forEach(q=>{q.abortController?.abort();
q.abortController=null;q.abortHandle?.remove()});this._activeRequests.clear()};b._createClass(p,[{key:"busy",get:function(){return this._requester.busy}}]);return p}();a.I3SStreamDataController=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){return function(){function t(r,x,D,A,v,B,C,E,F={}){this._indexSR=r;this._renderCoordsHelper=x;this._clippingArea=v;this._elevationProvider=B;this._viewingMode=C;this._options=F;this._frustum=k.create();this._useFrustumCulling=!1;this._poi=c.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=m.create();this._tmp1=c.create();this._tmp2=c.create();this._tmp3=c.create();this._tmp0=c.create();this._screenspaceErrorBias=
F.screenspaceErrorBias||1;this._progressiveLoadFactor=F.progressiveLoadFactor||1;this.updateCamera(D,A);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(E);this._tmpPoint=g.makeDehydratedPoint(0,0,0,r);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||d.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=p.getReferenceEllipsoid(this._indexSR).radius}var w=t.prototype;w.updateElevationInfo=function(r){null==r?this._elevationContext=
null:(this._elevationContext=h.ElevationContext.fromElevationInfo(r),this._elevationContext.updateFeatureExpressionInfoContext(z.createContextWithoutExpressionSupport(z.extractExpressionInfo(r,!1))))};w.updateCamera=function(r,x){(this._useFrustumCulling=x)&&k.fromMatrix(r.viewMatrix,r.projectionMatrix,this._frustum);this._screenSizeFactor=1/(r.perScreenPixelRatio/2);this._camPos=r.eye;this.minDistance=Infinity;this.maxDistance=0};w.setPointOfInterest=function(r){this._poi=r};w.updateScreenSpaceErrorBias=
function(r){const x=this._screenspaceErrorBias;this._screenspaceErrorBias=r;return x};w.updateClippingArea=function(r){this._clippingArea=r};w.getElevationRange=function(r){if(null==this._elevationContext)return null;r=r.mbs;if(!r)return null;const x="relative-to-scene"===this._elevationContext.mode?"scene":"ground";if(this._elevationProvider.getSphereElevationBounds)return this._elevationProvider.getSphereElevationBounds(r,this._indexSR);r=this._elevationProvider.getElevation(r[0],r[1],r[2],this._indexSR,
x);return null!=r?{min:r,max:r}:null};w.getRenderMbs=function(r){const x=r.renderMbs;if(l.isValidMbs(x))return x;r.mbs&&y.copy(x,r.mbs);if(this._elevationContext&&r.elevationRange&&Number.isFinite(r.elevationRange.min)){let D=0,A=0;switch(this._elevationContext.mode){case "relative-to-ground":D=this._elevationContext.geometryZWithOffset(x[2],this._renderCoordsHelper)+r.elevationRange.min-x[2];A=r.elevationRange.max-r.elevationRange.min;break;case "on-the-ground":D=r.elevationRange.min-x[2],A=r.elevationRange.max-
r.elevationRange.min}x[2]+=D+.5*A;x[3]+=.5*A}else this._elevationContext&&1E5>x[3]&&(this._tmpPoint.x=x[0],this._tmpPoint.y=x[1],this._tmpPoint.z=x[2],x[2]=e.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));u.projectBoundingSphere(x,this._indexSR,x,this.engineSR);return x};w.getVisibilityObb=function(r){if(null!=r.visibilityObb)return r.visibilityObb;const x=r.serviceObb,D=.01*this._indexSREllipsoidRadius;if(null==x||!r.mbs||
!l.isValidObb(x)||this._isECEFOBBInLocalMode&&x.halfSize.some(A=>A>D))return null;r.serviceObbInRenderSR=this._computeRenderObb(x,r.serviceObbInRenderSR,r.mbs[3],r.elevationRange);return r.serviceObbInRenderSR};w._computeRenderObb=function(r,x,D,A){if(null==x)x=m.create();else if(l.isValidObb(x))return x;let v=0,B=0;if(this._elevationContext&&null!=A&&Number.isFinite(A.min))switch(this._elevationContext.mode){case "relative-to-ground":v=this._elevationContext.geometryZWithOffset(r.center[2],this._renderCoordsHelper)+
A.min-r.center[2];B=A.max-A.min;break;case "on-the-ground":v=A.min-r.center[2],B=A.max-A.min}else this._elevationContext&&1E5>D&&(this._tmpPoint.x=r.center[0],this._tmpPoint.y=r.center[1],this._tmpPoint.z=r.center[2],v=e.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-r.center[2]);0<B?(l.transformObb(r,this._indexSR,this._tmpObb,this.engineSR,v),m.computeOffsetObb(this._tmpObb,0,B,this._viewingMode,x)):l.transformObb(r,this._indexSR,
x,this.engineSR,v);return x};w.isNodeVisible=function(r){const x=this.getRenderMbs(r);if(!this._isMBSinClippingArea(x))return!1;if(!this._useFrustumCulling)return!0;r=this.getVisibilityObb(r);return null!=r?m.isVisible(r,this._frustum):k.intersectsSphere(this._frustum,f.wrap(x))};w.isGeometryVisible=function(r){if(!this._useFrustumCulling)return!0;const x=r.geometryObb;return null!=x?m.isVisible(x,this._frustum):this.isNodeVisible(r)};w._isMBSinClippingArea=function(r){return null==this._clippingArea?
!0:l.intersectBoundingRectWithMbs(this._clippingArea,r)!==l.MbsIntersectResult.OUTSIDE};w._screenSpaceDiameterMbs=function(r,x){var D=this.getRenderMbs(r);r=Math.sqrt(b.squaredDistance(D,this._camPos));D=r-D[3];this._updateMinMaxDistance(r);return 0>D?.5*Number.MAX_VALUE:x/D*this._screenSizeFactor};w.calcCameraDistance=function(r){return this.calcCameraDistanceToCenter(r)-this.getRenderMbs(r)[3]};w.calcCameraDistanceToCenter=function(r){r=this.getRenderMbs(r);r=b.distance(r,this._camPos);this._updateMinMaxDistance(r);
return r};w.calcAngleDependentLoD=function(r){r=this.getRenderMbs(r);const x=r[3];r=(Math.abs(r[0]*(r[0]-this._camPos[0])+r[1]*(r[1]-this._camPos[1])+r[2]*(r[2]-this._camPos[2]))/b.length(r)+x)/b.distance(r,this._camPos);return Math.min(1,r)};w.hasLOD=function(r){return r.lodMetric!==n.LodMetric.None};w._getDistancePlanarMode=function(r,x){var D=r[0]-x[0];const A=r[1]-x[1];r=r[2]-x[2];D=D*D+A*A;x=x[3];if(D<=x*x)return Math.abs(r);x=Math.sqrt(D)-x;return Math.sqrt(r*r+x*x)};w._getDistanceGlobeMode=
function(r,x){var D=b.length(x);const A=b.length(r)-D;b.scale(this._tmp0,r,b.dot(r,x)/b.squaredLength(r));var v=b.squaredDistance(x,this._tmp0),B=x[3];if(v<=B*B)return Math.abs(A);x=b.scale(this._tmp0,x,1/D);D=b.scale(this._tmp1,x,D-B*B/2/D);v=b.subtract(this._tmp2,r,D);v=b.subtract(this._tmp2,v,b.scale(this._tmp3,x,b.dot(x,v)));D=b.add(this._tmp2,D,b.scale(this._tmp2,v,B/b.length(v)));B=b.distance(r,D);2E5<=A&&(r=b.subtract(this._tmp1,r,D),r=b.dot(r,x)/b.length(r),.08>r&&(r=1E-4),B/=r);return B};
w._getDistance=function(r,x){return this.engineSR===q.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(r,x):this._getDistancePlanarMode(r,x)};w._updateMinMaxDistance=function(r){0<r?(this.minDistance=Math.min(this.minDistance,r),this.maxDistance=Math.max(this.maxDistance,r)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-r))};w.getLodLevel=function(r){if(r.lodMetric===n.LodMetric.None)return 0;if(0===r.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const x=
this._screenspaceErrorBias;return this.evaluateLODmetric(r,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(r,x)?2:1:0}return this.evaluateLODmetric(r,this._screenspaceErrorBias)?this.maxLodLevel:0};w.evaluateLODmetric=function(r,x){switch(r.lodMetric){case n.LodMetric.ScreenSpaceRelative:const D=this.getRenderMbs(r),A=this._getDistance(this._camPos,D),v=2*A/this._screenSizeFactor;this._updateMinMaxDistance(A+D[3]);return r.maxError*x<=v;case n.LodMetric.MaxScreenThreshold:return x=
this._screenSpaceDiameterMbs(r,r.mbs[3]*x),this._options.angleDependentLoD&&(x*=this.calcAngleDependentLoD(r)),x<r.maxError;case n.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(r,r.maxError)*x;case n.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(r)>r.maxError*x}return!1};w.distToPOI=function(r){r=this.getRenderMbs(r);return b.distance(r,this._poi)-r[3]};w.distCameraToPOI=function(){return b.distance(this._camPos,this._poi)};return a._createClass(t)}()})},
"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),function(a,b,c,y,p,
u,q,k,d,f,g,e,h){var z;c=z=function(n){function l(t){t=n.call(this,t)||this;t.geometry=null;t.type="clip";return t}a._inherits(l,n);var m=l.prototype;m.writeGeometry=function(t,w,r,x){if(x.layer&&x.layer.spatialReference&&!x.layer.spatialReference.equals(this.geometry.spatialReference)){if(!e.canProjectWithoutEngine(t.spatialReference,x.layer.spatialReference)){x&&x.messages&&x.messages.push(new u("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:x.layer.spatialReference,context:x}));return}const D=new h;e.projectPolygon(t,D,x.layer.spatialReference);w[r]=D.toJSON(x)}else w[r]=t.toJSON(x);delete w[r].spatialReference};m.clone=function(){return new z({geometry:p.clone(this.geometry),type:this.type})};return a._createClass(l)}(y.JSONSupport);b.__decorate([q.property({type:h}),g.persistable()],c.prototype,"geometry",void 0);b.__decorate([f.writer(["web-scene","portal-item"],"geometry")],c.prototype,"writeGeometry",
null);b.__decorate([q.property({type:["clip","mask","replace"],nonNullable:!0}),g.persistable()],c.prototype,"type",void 0);return c=z=b.__decorate([d.subclass("esri.layers.support.SceneModification")],c)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Handles ../../../core/lang ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/DoubleArray ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B){let C=a._createClass(function(G,L){this.meta=G;this.index=L}),E=a._createClass(function(G,L){this.graphic=G;this.geometry=L;this.components=[];this.overridesDirty=!1});c=function(G){function L(I){I=G.call(this,I)||this;I.loadedGraphics=new A.LimitGraphicsMap(5E4);I.slicePlaneEnabled=!1;I._renderingInfo={symbol:new B};I._handles=new u;I._featuresMap=new Map;return I}a._inherits(L,G);var O=L.prototype;O.initialize=function(){const I=this.view.basemapTerrain;
this._graphicsCore=new r.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:v.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:H=>this.view.deconflictor.addGraphicsOwner(H),labeler:(H,J)=>this.view.labeler.addGraphicsOwner(H,J,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
scaleVisibility:(H,J)=>new x({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:J,graphicsCore:H,basemapTerrain:I,layerScaleEnabled:!1})}});this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this._handles.add(f.watch(()=>this.layer.labelingInfo,(H,J)=>{n.diff(H,J)&&this._graphicsCore.updateLabelingInfo()}))};O.destroy=function(){this._handles=d.destroyMaybe(this._handles);this._graphicsCore=d.destroyMaybe(this._graphicsCore);this.loadedGraphics=
d.destroyMaybe(this.loadedGraphics);this.view=null};O.addNodeMeta=function(I,H){let J=0;const N=I.filteredIds,R=this.view.spatialReference,W=[];for(let Q=0;Q<I.featureIds.length;Q++){const S=I.featureIds[Q];var T=null==N;N&&J<N.length&&S===N[J]&&(T=!0,J++);if(!this._enabledForFeatureInNode(I,Q))continue;var P=this._featuresMap.get(S);if(P){P.components.push(new C(I,Q));this._updateLabelPosition(S);continue}const U=H(Q,I);P=w.makeDehydratedPoint(0,0,0,R);T={objectId:S,uid:g.generateUID(),attributes:U,
visible:T,geometry:P};P=new E(T,P);P.components.push(new C(I,Q));this._featuresMap.set(S,P);this._updateLabelGeometry(S);W.push(T)}this.loadedGraphics.addMany(W)};O.updateLabelPositions=function(I){const H=this.view.renderCoordsHelper;this._forEachGraphic(I,(J,N,R)=>{N=this._graphicsCore.getGraphics3DGraphicById(N.uid);null!=N&&this._updateLabelGeometry(I.featureIds[J])&&N.alignWithAbsoluteElevation(R.z??0,H,!1)})};O.setNodeMetaAttributes=function(I,H){const J=[];this._forEachGraphic(I,(N,R)=>{N=
H(N,I);q.equalsShallow(R.attributes,N)||(R.attributes=N,J.push(R.uid))});this._graphicsCore.updateLabelingInfo(J)};O.applyFilterChange=function(I){this._forEachFeature(I,(H,J,N)=>{if(this._enabledForFeatureInNode(I,H))H=J.graphic,J=H.visible,J!==N&&(H.visible=N,F.graphic=H,F.property="visible",F.oldValue=J,F.newValue=N,this._graphicsCore.graphicUpdateHandler(F));else switch(N=I.featureIds[H],this._removeFeature(J,I,H)){case M.REMOVED:this.loadedGraphics.removeManyByObjectId([N]);break;case M.MODIFIED:this._updateLabelPosition(N)}})};
O.removeNodeMeta=function(I){const H=[];this._forEachGraphic(I,J=>{const N=I.featureIds[J],R=this._featuresMap.get(N);if(R)switch(this._removeFeature(R,I,J)){case M.MODIFIED:this._updateLabelPosition(N);break;case M.REMOVED:H.push(N)}});this.loadedGraphics.removeManyByObjectId(H)};O._removeFeature=function(I,H,J){const N=I.components.length;p.filterInPlace(I.components,R=>!(R.meta===H&&R.index===J));return 0===I.components.length?(this._featuresMap.delete(H.featureIds[J]),M.REMOVED):N!==I.components.length?
M.MODIFIED:M.UNMODIFIED};O.getRenderingInfo=function(){return this._renderingInfo};O.notifyGraphicGeometryChanged=function(){};O.notifyGraphicVisibilityChanged=function(){};O._updateLabelPosition=function(I){const H=this._featuresMap.get(I);H&&this._updateLabelGeometry(I)&&(this.loadedGraphics.removeManyByObjectId([I]),this.loadedGraphics.addMany([H.graphic]))};O._updateLabelGeometry=function(I){I=this._featuresMap.get(I);if(!I)return!1;const H=I.geometry,J=this.view.spatialReference,N=this.view.renderCoordsHelper,
R=H.x,W=H.y,T=H.z??0,P=t.newDoubleArray(I.components.length*D.BOUNDING_BOX_CORNERS_POINTS_STRIDE);let Q=0;for(const {meta:S,index:U}of I.components)D.boundingBoxCornerPoints(U,this.collection,S.objectHandle,P,Q),Q+=D.BOUNDING_BOX_CORNERS_POINTS_STRIDE;l.projectBuffer(P,N.spatialReference,0,P,J,0,P.length/3);m.set(K,m.NEGATIVE_INFINITY);m.expandWithBuffer(K,P);H.x=(K[0]+K[3])/2;H.y=(K[1]+K[4])/2;H.z=K[5];return!k.floatEqualUlp(H.x,R)||!k.floatEqualUlp(H.y,W)||!k.floatEqualUlp(H.z,T)};O._forEachGraphic=
function(I,H){this._forEachFeature(I,(J,{graphic:N,geometry:R},W)=>{this._enabledForFeatureInNode(I,J)&&H(J,N,R,W)})};O._forEachFeature=function(I,H){let J=0;for(let N=0;N<I.featureIds.length;N++){const R=this._featuresMap.get(I.featureIds[N]);let W=null==I.filteredIds;I.filteredIds&&I.filteredIds[J]===I.featureIds[N]&&(W=!0,J++);R&&H(N,R,W)}};O._enabledForFeatureInNode=function(I,H){return 0>I.node.index||!this.overrides?.featureHasGeometryChanges(I.featureIds[H])};a._createClass(L,[{key:"updating",
get:function(){return this._graphicsCore?.updating??!1}},{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return L}(y);b.__decorate([e.property()],c.prototype,"view",void 0);b.__decorate([e.property()],c.prototype,"layer",void 0);
b.__decorate([e.property()],c.prototype,"collection",void 0);b.__decorate([e.property()],c.prototype,"loadedGraphics",void 0);b.__decorate([e.property()],c.prototype,"overrides",void 0);b.__decorate([e.property()],c.prototype,"updating",null);b.__decorate([e.property()],c.prototype,"slicePlaneEnabled",void 0);b.__decorate([e.property()],c.prototype,"_graphicsCore",void 0);c=b.__decorate([z.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],c);const F={graphic:null,property:null,oldValue:null,newValue:null};
var M;(function(G){G[G.UNMODIFIED=0]="UNMODIFIED";G[G.MODIFIED=1]="MODIFIED";G[G.REMOVED=2]="REMOVED"})(M||(M={}));const K=m.create();return c})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),function(a,b,c,y,p,u){function q(f,g,e,h,z){f=g.getComponentAabb(e,f,k);g=g.getObjectTransform(e);for(e=0;8>
e;++e)d[0]=e&1?f[0]:f[3],d[1]=e&2?f[1]:f[4],d[2]=e&4?f[2]:f[5],b.transformMat3(d,d,g.rotationScale),b.add(d,d,g.position),h[z++]=d[0],h[z++]=d[1],h[z++]=d[2];return h}const k=p.create(),d=c.create();a.BOUNDING_BOX_CORNERS_POINTS_STRIDE=24;a.boundingBoxCornerPoints=q;a.createGetFeatureExtent=function(f,g,e){const h=u.newDoubleArray(24);return z=>{var n=z.meta.featureExtents;if(null==n){n=new Float64Array(6*z.meta.featureIds.length);z.meta.featureExtents=n;for(let l=0;l<n.length;l+=6)n[l]=Number.POSITIVE_INFINITY}n=
new Float64Array(n.buffer,6*z.index*Float64Array.BYTES_PER_ELEMENT,6);n[0]===Number.POSITIVE_INFINITY&&(q(z.index,e,z.meta.objectHandle,h,0),y.projectBuffer(h,g,0,h,f,0,8)?(p.set(n,p.NEGATIVE_INFINITY),p.expandWithBuffer(n,h,0,8)):p.set(n,p.ZERO));return n}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],
function(a,b,c,y,p){c=function(k){function d(g){var e=k.call(this)||this;e._limit=g;e._all=new p.GraphicsMap;e._active=new q(b._assertThisInitialized(e));e._pending=new Map;e._handle=e._all.on("change",h=>e._handleChanges(h));return e}b._inherits(d,k);var f=d.prototype;f.destroy=function(){this._handle.remove()};f.toArray=function(){return this._active.toArray()};f.find=function(g){return this._active.find(g)};f.forEach=function(g){this._active.forEach(g)};f.addMany=function(g){this._all.addMany(g)};
f.removeManyByObjectId=function(g){this._all.removeManyByObjectId(g)};f._handleChanges=function(g){let e=g.removed;if(0<this._pending.size){e=[];for(var h of g.removed)this._pending.delete(h.objectId)||e.push(h)}h=this._limit-this._active.length+e.length;h<g.added.length&&(this._active.removeMany(e),e=[],u.reset(1-this._limit/(this._active.length+g.added.length)),this._active.forEach(n=>{u.sample()&&(e.push(n),this._pending.set(n.objectId,n))}),h=this._limit-this._active.length+e.length);let z=g.added;
if(h<g.added.length){z=[];u.reset(h/g.added.length);for(const n of g.added)u.sample()?z.push(n):this._pending.set(n.objectId,n)}g=h-z.length;0<g&&0<this._pending.size&&(u.reset(g/this._pending.size),this._pending.forEach(n=>{u.sample()&&(z.push(n),this._pending.delete(n.objectId))}));this._active.addAndRemove(z,e)};b._createClass(d,[{key:"length",get:function(){return this._active.length}}]);return d}(c);const u=new (function(){function k(){this._percentage=1;this._last=-1;this._index=0}var d=k.prototype;
d.reset=function(f){this._percentage=f;this._last=-1};d.sample=function(){const f=Math.floor(this._index*this._percentage);++this._index;if(f===this._last)return!1;this._last=f;return!0};return b._createClass(k)}());let q=function(){function k(f){this._parent=f;this._map=new Map}var d=k.prototype;d.forEach=function(f){this._map.forEach(g=>f(g))};d.find=function(f){let g=void 0;y.someMap(this._map,e=>f(e)?(g=e,!0):!1);return g};d.toArray=function(){return[...this._map.values()]};d.addAndRemove=function(f,
g){for(const e of f)this._map.set(e.objectId,e);for(const e of g)this._map.delete(e.objectId);(0<f.length||0<g.length)&&this._parent.emit("change",{added:f,removed:g})};d.removeMany=function(f){for(const g of f)this._map.delete(g.objectId);0<f.length&&this._parent.emit("change",{added:[],removed:f})};b._createClass(k,[{key:"length",get:function(){return this._map.size}}]);return k}();a.LimitGraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,b,c,y){c=function(p){function u(){var k=p.apply(this,arguments)||this;k._map=new Map;return k}b._inherits(u,p);var q=u.prototype;q.clear=function(){if(0<this._map.size){const k=this.toArray();this._map.clear();this.emit("change",{added:[],removed:k})}};q.get=function(k){return this._map.get(k)};q.addMany=function(k){if(0!==k.length){var d=new Set;for(let f=0;f<k.length;f++){const g=k[f],e=g.objectId,
h=this._map.get(e);h?(d.add(e),g!==h&&(k[f]=h),h.refCount||(h.refCount=0),++h.refCount):(g.refCount=1,this._map.set(e,g))}k=0<d.size?k.filter(f=>!d.has(f.objectId)):k;0<k.length&&this.emit("change",{added:k,removed:[]})}};q.removeMany=function(k){const d=[];for(const f of k){k=f.objectId;const g=this._map.get(k);null!=g&&(!g.refCount||0>=--g.refCount)&&(this._map.delete(k),d.push(f))}0<d.length&&this.emit("change",{added:[],removed:d})};q.removeManyByObjectId=function(k){const d=[];for(const f of k)k=
this._map.get(f),null!=k&&(!k.refCount||0>=--k.refCount)&&(this._map.delete(f),d.push(k));0<d.length&&this.emit("change",{added:[],removed:d})};q.toArray=function(){return[...this._map.values()]};q.find=function(k){let d;y.someMap(this._map,f=>k(f)?(d=f,!0):!1);return d};q.forEach=function(k){this._map.forEach(d=>k(d))};b._createClass(u,[{key:"length",get:function(){return this._map.size}}]);return u}(c);a.GraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),
function(a,b,c,y,p,u,q,k){function d(e,h,z){f.clear();var n=Infinity;let l=Infinity,m=-Infinity,t=-Infinity,w=!1;for(const x of h){var r="clip"===x.type?k.ModificationType.Inside:"mask"===x.type?k.ModificationType.Outside:k.ModificationType.Replace;const D=y.unwrapOrThrow(x.geometry,"modification.geometry");h=A=>A;if(D.spatialReference){if(!q.canProjectWithoutEngine(D.spatialReference,z)){c.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}h=A=>{q.projectVectorToVector(A,D.spatialReference,g,z);return g}}else D.hasZ||(g[2]=0,h=A=>{g[0]=A[0];g[1]=A[1];return g});w=w||r===k.ModificationType.Outside;f.push(r);f.push(D.rings.length);for(const A of D.rings){f.push(A.length);for(const v of A)r=h(v),f.push(r[0]),f.push(r[1]),f.push(r[2]),n=Math.min(n,r[0]),l=Math.min(l,r[1]),m=Math.max(m,r[0]),t=Math.max(t,r[1])}}null!=e&&(w?(f.push(k.ModificationType.Inside),f.push(2),f.push(4),f.push(n-1E-4),f.push(l-1E-4),f.push(0),f.push(m+1E-4),
f.push(l-1E-4),f.push(0),f.push(m+1E-4),f.push(t+1E-4),f.push(0),f.push(n-1E-4),f.push(t+1E-4),f.push(0)):(f.push(k.ModificationType.Outside),f.push(1)),f.push(4),f.push(e[0]),f.push(e[1]),f.push(0),f.push(e[2]),f.push(e[1]),f.push(0),f.push(e[2]),f.push(e[3]),f.push(0),f.push(e[0]),f.push(e[3]),f.push(0));f.push(k.ModificationType.Finished);e=new Float64Array(f.length);for(n=0;n<f.length;++n)e[n]=f.at(n);return e}u=function(e){function h(n){return e.call(this,"SceneLayerWorker","process",{process:l=>
[l.geometryBuffer],project:l=>[l.positions.buffer],transformNormals:l=>[l.normals.buffer]},n,{hasInitialize:!0})||this}b._inherits(h,e);var z=h.prototype;z.setModifications=function(n,l,m,t){n={context:n,modifications:d(l,m,t),isGeodetic:t.isGeographic};this.broadcast(n,"setModifications")};z.setLegacySchema=function(n,l){l=JSON.stringify(l);this.broadcast({context:n,jsonSchema:l},"setLegacySchema")};z.destroyContext=function(n){return this.broadcast(n,"destroyContext")};z.project=function(n,l){return this.invokeMethod("project",
n,l)};z.transformNormals=function(n,l){return this.invokeMethod("transformNormals",n,l)};return b._createClass(h)}(u.WorkerHandle);const f=new p({deallocator:null}),g=[0,0,0];a.I3SMeshWorkerHandle=u;a.toWasmModification=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;
(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.QUERYABLE=2]="QUERYABLE"})(a.ForAllFeaturesMode||(a.ForAllFeaturesMode={}));a.ForAllFeaturesReturnType=
void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/support/DoubleArray ../../../geometry/support/MeshGeoreferencedRelativeVertexSpace ../../../geometry/support/MeshGeoreferencedVertexSpace ../../../geometry/support/MeshLocalVertexSpace ../../../chunks/vec32 ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){function e(x){const D=x.modifications,A=w._malloc(8*D.length),v=new Float64Array(w.HEAPU8.buffer,A,D.length);for(let B=0;B<D.length;++B)v[B]=D[B];w.setModifications(x.context,A,D.length,x.isGeodetic);w._free(A)}function h(x,D){if(!w)return null;const {context:A,localOrigin:v,globalTrafo:B,mbs:C,obb:E,elevationOffset:F,geometryBuffer:M,geometryDescriptor:K,indexToVertexProjector:G,vertexToRenderProjector:L}=x;var O=w._malloc(M.byteLength),I=w._malloc(33*Float64Array.BYTES_PER_ELEMENT),
H=new Uint8Array(w.HEAPU8.buffer,O,M.byteLength);H.set(new Uint8Array(M));var J=new Float64Array(w.HEAPU8.buffer,I,33);l(J,v);var N=J.byteOffset+3*J.BYTES_PER_ELEMENT,R=new Float64Array(J.buffer,N);l(R,B);N+=16*J.BYTES_PER_ELEMENT;R=new Float64Array(J.buffer,N);l(R,C);N+=4*J.BYTES_PER_ELEMENT;null!=E&&(R=new Float64Array(J.buffer,N),l(R,E.center),N+=3*J.BYTES_PER_ELEMENT,R=new Float64Array(J.buffer,N),l(R,E.halfSize),N+=3*J.BYTES_PER_ELEMENT,R=new Float64Array(J.buffer,N),l(R,E.quaternion));J={isDraco:!1,
isLegacy:!1,color:x.layouts.some(Q=>Q.some(S=>"color"===S.name)),normal:x.needNormals&&x.layouts.some(Q=>Q.some(S=>"normalCompressed"===S.name)),uv0:x.layouts.some(Q=>Q.some(S=>"uv0"===S.name)),uvRegion:x.layouts.some(Q=>Q.some(S=>"uvRegion"===S.name)),featureIndex:K.featureIndex};H=w.process(A,!!x.obb,O,H.byteLength,K,J,I,F,G,L,x.normalReferenceFrame);w._free(I);w._free(O);if(0<H.error.length)throw Error(`i3s.wasm: ${H.error}`);if(H.discarded)return null;O=0<H.componentOffsets.length?H.componentOffsets.slice():
null;I=0<H.featureIds.length?H.featureIds.slice():null;J=0<H.anchorIds.length?Array.from(H.anchorIds):null;N=0<H.anchors.length?Array.from(H.anchors):null;R=H.interleavedVertedData.slice().buffer;const W=H.indicesType===d.IndexType.Int16?(new Uint16Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/2)).slice():(new Uint32Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/4)).slice(),T=H.positions.slice(),P=H.positionIndicesType===d.IndexType.Int16?(new Uint16Array(H.positionIndices.buffer,
H.positionIndices.byteOffset,H.positionIndices.byteLength/2)).slice():(new Uint32Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/4)).slice();x={layout:x.layouts[0],interleavedVertexData:R,indices:W,hasColors:H.hasColors,hasModifications:H.hasModifications,positionData:{data:T,indices:P}};I&&D.push(I.buffer);O&&D.push(O.buffer);D.push(R);D.push(W.buffer);D.push(T.buffer);D.push(P.buffer);return{componentOffsets:O,featureIds:I,anchorIds:J,anchors:N,transformedGeometry:x,
obb:H.obb}}function z(x){const {context:D,buffer:A}=x;x=w._malloc(A.byteLength);const v=A.byteLength/Float64Array.BYTES_PER_ELEMENT,B=new Float64Array(w.HEAPU8.buffer,x,v),C=new Float64Array(A);B.set(C);w.filterOBBs(D,x,v);C.set(B);w._free(x)}function n(x){w&&(w.destroy(x),w=null)}function l(x,D){for(let A=0;A<D.length;++A)x[A]=D[A]}function m(){if(w)return Promise.resolve();t||(t=f.get().then(x=>{w=x;t=null}));return t}let t,w;const r={transform:h,destroy:n};b.destroyContext=function(x){n(x)};b.dracoDecompressPointCloudData=
async function(x){await m();const D=[x.geometryBuffer];var {geometryBuffer:A}=x,v=A.byteLength;x=w._malloc(v);v=new Uint8Array(w.HEAPU8.buffer,x,v);v.set(new Uint8Array(A));A=w.dracoDecompressPointCloudData(x,v.byteLength);w._free(x);if(0<A.error.length)throw Error(`i3s.wasm: ${A.error}`);x=0<A.featureIds?.length?A.featureIds.slice():null;A=A.positions.slice();x&&D.push(x.buffer);D.push(A.buffer);return{result:{positions:A,featureIds:x},transferList:D}};b.filterObbsForModifications=async function(x){await m();
z(x);x={buffer:x.buffer};return{result:x,transferList:[x.buffer]}};b.filterObbsForModificationsSync=z;b.initialize=m;b.interpretObbModificationResults=function(x){return 0===x?g.NodeIMModificationImpact.Unmodified:1===x?g.NodeIMModificationImpact.PotentiallyModified:2===x?g.NodeIMModificationImpact.Culled:g.NodeIMModificationImpact.Unknown};b.process=async function(x){await m();const D=[x.geometryBuffer];return{result:h(x,D),transferList:D}};b.project=async function(x){const {localMatrix:D,origin:A,
positions:v,vertexSpace:B,local:C}=x;var E=c.fromJSON(x.inSpatialReference);x=c.fromJSON(x.outSpatialReference);var F={georeferenced:u,georeferencedRelative:p,local:q}[B.type].fromJSON(B);if("georeferenced"===F.type){const {projectBuffer:L,initializeProjection:O}=await new Promise((I,H)=>a(["../../../geometry/projection"],I,H));await O(E,x);F=new Float64Array(v.length);L(v,E,0,F,x,0,F.length/3)}else{const {project:L}=await new Promise((O,I)=>a(["../../../geometry/support/meshUtils/georeference"],
O,I));F=y.toFloat64Array(L({positions:v,transform:D?{localMatrix:D}:void 0,vertexSpace:F,inSpatialReference:E,outSpatialReference:x,local:C}))}E=F.length;const [M,K,G]=A;for(x=0;x<E;x+=3)F[x]-=M,F[x+1]-=K,F[x+2]-=G;return{result:{projected:F,original:v},transferList:[F.buffer,v.buffer]}};b.setLegacySchema=async function(x){await m();w.setLegacySchema(x.context,x.jsonSchema)};b.setModifications=async function(x){await m();e(x)};b.setModificationsSync=e;b.test=r;b.transformNormals=async function({normalMatrix:x,
normals:D}){const A=new Float32Array(D.length);k.transformMat3(A,D,x);k.normalize(A,A);return{result:{transformed:A,original:D},transferList:[A.buffer,D.buffer]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){c=function(e){function h(){var z=e.call(this,{})||this;z.type="georeferenced";z.isRelative=!1;z.isGeoreferenced=!0;return z}a._inherits(h,e);return a._createClass(h)}(c.ClonableMixin(y.JSONSupport));b.__decorate([f.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0);return c=b.__decorate([g.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],c)})},"esri/geometry/support/MeshLocalVertexSpace":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../chunks/vec3f64 ../Point".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e){c=function(h){function z(l){l=h.call(this,l)||this;l.type="local";l.isRelative=!0;l.isGeoreferenced=!1;l.origin=g.create();return l}a._inherits(z,h);var n=z.prototype;n.getOriginPoint=function(l){const [m,t,w]=this.origin;return new e({x:m,y:t,z:w,spatialReference:l})};n.setOriginFormPoint=function({x:l,y:m,z:t}){this.origin=g.fromValues(l,m,t??0)};return a._createClass(z)}(c.ClonableMixin(y.JSONSupport));b.__decorate([d.enumeration({local:"local"},{readOnly:!0})],
c.prototype,"type",void 0);b.__decorate([p.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"origin",void 0);return c=b.__decorate([f.subclass("esri.geometry.support.MeshLocalVertexSpace")],c)})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,c){function y(u){return c.getAssetUrl(`esri/libs/i3s/${u}`)}let p;b.get=function(){p||(p=(new Promise(u=>(new Promise((q,k)=>a(["../../chunks/i3s"],q,k))).then(q=>q.i3s).then(({default:q})=>
{const k=q({locateFile:y,onRuntimeInitialized:()=>u(k)});delete k.then}))).catch(u=>{throw u;}));return p};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../II3SMeshView3D"],function(a,b,c){let y=a._createClass(function(){this.ids=new Set;this.paused=!1});return function(){function p({collection:q,forAllFeatures:k,forAllFeaturesOfNode:d}){this._highlights=
[];this._collection=q;this._forAllFeatures=k;this._forAllFeaturesOfNode=d}var u=p.prototype;u.destroy=function(){this._highlights.forEach(q=>this._releaseSet(q));this._highlights=null};u.acquireSet=function(){const q=new y;this._highlights.push(q);return{set:q,handle:{remove:()=>{this._highlights&&(this._releaseSet(q),b.removeUnordered(this._highlights,q))},pause:()=>{this._releaseSet(q);q.paused=!0},resume:()=>{q.paused=!1;this._initializeSet(q)}}}};u.setFeatureIds=function(q,k){k.forEach(d=>q.ids.add(d));
this._initializeSet(q)};u._initializeSet=function(q){this._forAllFeatures((k,d,f)=>{q.ids.has(k)&&this._collection.addComponentHighlight(f.objectHandle,d);return c.ForAllFeaturesReturnType.CONTINUE})};u._releaseSet=function(q){this._forAllFeatures((k,d,f)=>{q.ids.has(k)&&this._collection.removeComponentHighlight(f.objectHandle,d);return c.ForAllFeaturesReturnType.CONTINUE})};u.objectCreated=function(q){this._highlights.forEach(k=>{k.paused||this._forAllFeaturesOfNode(q,(d,f)=>{k.ids.has(d)&&this._collection.addComponentHighlight(q.objectHandle,
f);return c.ForAllFeaturesReturnType.CONTINUE})})};u.objectDeleted=function(q){this._collection.clearHighlights(q.objectHandle)};return a._createClass(p)}()})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.I3SAsyncElevationUpdater=function(e){function h(n,l,m){var t=e.call(this,{})||this;t._updateExtent=l;t._updateNode=m;t.running=!1;t._extentSet=new f.ExtentSet;t._nodeSet=new Set;t.addHandles(n.registerTask(g.TaskPriority.ELEVATION_ALIGNMENT,b._assertThisInitialized(t)));return t}b._inherits(h,e);var z=h.prototype;z.normalizeCtorArgs=function(){return{}};z.addExtent=function(n){this._extentSet.add(n);this.running=!0};z.schedule=function(n){this._nodeSet.add(n);this.running=
!0};z.remove=function(n){this._nodeSet.delete(n);this._updateRunning()};z.runTask=function(n){const l=this._extentSet;for(n.run(()=>l.merge(n));!l.empty&&!n.done;){var m=this._updateExtent(l.pop());null!=m&&m.forAll(t=>this.schedule(t));n.madeProgress()}if(!n.done){m=this._nodeSet;for(const t of m)if(m.delete(t),this._updateNode(t),n.madeProgress(),n.done)break;this._updateRunning()}};z._updateRunning=function(){this.running=0<this._nodeSet.size||0<this._extentSet.size};return b._createClass(h)}(y);
c.__decorate([p.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=c.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,
c,y,p){let u=b._createClass(function(){this.lodCrossfadeSignedDuration=0}),q=function(){function k(f){this._view=f;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var d=k.prototype;d.destroy=function(){this._preRenderFrameTaskHandle?.remove();this._view=this._preRenderFrameTaskHandle=null};d.stopNodeFading=function(f){null!=f.lodCrossfadeProgress&&(this._numFadingNodes--,f.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&
(this._preRenderFrameTaskHandle=c.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))};d._startNodeFading=function(f,g,e){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=y.addFrameTask({preRender:h=>this._updateAllNodeFading(h)}),this._view.notifyLODUpdate());null==f.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());f.lodCrossfadeSignedDuration=e;f.lodCrossfadeProgress=g};d._updateAllNodeFading=function(f){const g=
this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((e,h)=>{if(null!=h&&null!=h.lodCrossfadeProgress){const z=h.lodCrossfadeSignedDuration,n=h.lodCrossfadeProgress+Math.abs(f.deltaTime/z),l=!g||1<=n||0===z,m=(0<z?this._view.fullOpacity:0)-(l?0:0<z?1:-1)*(1-n);l?(this.stopNodeFading(h),0>z&&this._view.markNodeToRemove(e)):h.lodCrossfadeProgress=n;this._view.setNodeOpacityByIndex(e,m)}});this._view.removeMarkedNodes()};d.stopAllNodeFading=function(){this._view.foreachCrossfadeNode((f,
g)=>{null!=g&&null!=g.lodCrossfadeProgress&&(this.stopNodeFading(g),g=g.lodCrossfadeSignedDuration,0>g&&this._view.markNodeToRemove(f),this._view.setNodeOpacityByIndex(f,0<g?this._view.fullOpacity:0))});this._view.removeMarkedNodes()};d.fadeNode=function(f,g,e,h){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var z=this._view;const n=z.nodeCrossfadingEnabled,l=e===p.FadeDirection.FadeIn?z.fullOpacity:0;h=n?h?e===p.FadeDirection.FadeIn?z.lodCrossfadeinDuration:z.lodCrossfadeoutDuration:
z.lodCrossfadeUncoveredDuration:0;z=this._view.getNodeOpacityByIndex(f);n&&z!==l&&0<h?this._startNodeFading(g,1-Math.abs(l-z),(e===p.FadeDirection.FadeIn?1:-1)*h):(this.stopNodeFading(g),this._view.setNodeOpacityByIndex(f,l),e===p.FadeDirection.FadeOut&&this._view.removeNode(f))};d.isNodeFullyFadedIn=function(f){const g=this._view.getNodeCrossfadeMetaData(f);return null==g||null==g.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(f)===this._view.fullOpacity};b._createClass(k,[{key:"updating",
get:function(){return 0<this._numFadingNodes}}]);return k}();a.I3SCrossfadeHelper=q;a.NodeCrossfadeMetaData=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w){const r=l.empty(),x=e.create(),D=m.fromValues(0,0,0,0),A=z.create(),v=z.create(),B=z.create();c=function(C){function E(M){M=C.call(this,M)||this;M._tmpEvent={spatialReference:null,extent:r,context:"scene"};return M}a._inherits(E,C);var F=E.prototype;F.initialize=function(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=t.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
w.StoreResults.MIN;const M=this.layerView.i3slayer.fullExtent;null==M?p.getLogger(this).error("I3SElevationProvider expected fullExtent on I3SLayer."):(this._zmin=M.zmin,this._zmax=M.zmax);this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};F.getElevation=function(M,K,G,L){A[0]=M;A[1]=K;A[2]=G;if(!this._renderCoordsHelper.toRenderCoords(A,L,A))return p.getLogger(this).error("could not project point to compute elevation"),null;M=this.layerView.elevationOffset;K=this._zmin+M;
this._renderCoordsHelper.setAltitude(v,this._zmax+M,A);this._renderCoordsHelper.setAltitude(B,K,A);this._intersector.reset(v,B,null);this.intersectionHandler.intersect(this._intersector,null,v,B);return this._intersector.results.min.getIntersectionPoint(A)?this._renderCoordsHelper.getAltitude(A):null};F.getSphereElevationBounds=function(M,K){n.projectBoundingSphere(M,K,D,this._renderCoordsHelper.spatialReference);return this.layerView.getElevationRange(D)};F.layerChanged=function(){this.spatialReference&&
(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};F.objectChanged=function(M){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(M),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};F._computeObjectExtent=function(M){l.empty(r);this._expandExtent(M,r);return r};F._computeLayerExtent=function(){l.empty(r);for(const M of this.layerView.getVisibleNodes())this._expandExtent(M,
r);return r};F._expandExtent=function(M,K){const G=this.spatialReference;if(null!=G&&(M=this.layerView.getNodeComponentObb(M),null!=M)){g.fromQuat(x,M.quaternion);x[12]=M.center[0];x[13]=M.center[1];x[14]=M.center[2];for(let L=0;8>L;++L)A[0]=L&1?M.halfSize[0]:-M.halfSize[0],A[1]=L&2?M.halfSize[1]:-M.halfSize[1],A[2]=L&4?M.halfSize[2]:-M.halfSize[2],h.transformMat4(A,A,x),this._renderCoordsHelper.fromRenderCoords(A,A,G),l.expand(K,A,K)}};a._createClass(E,[{key:"spatialReference",get:function(){return this.view?.elevationProvider?.spatialReference}}]);
return E}(y.EventedMixin(c));b.__decorate([u.property({constructOnly:!0})],c.prototype,"layerView",void 0);b.__decorate([u.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);b.__decorate([u.property()],c.prototype,"view",void 0);b.__decorate([u.property()],c.prototype,"spatialReference",null);return c=b.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],c)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(e,h,z,n=0){n=e[3]+n;const l=h[0]-e[0],m=h[1]-e[1];e=h[2]-e[2];h=z[0];const t=z[1];z=z[2];const w=h*l+t*m+z*e;return 0<=w*w-(h*h+t*t+z*z)*(l*l+m*m+e*e-n*n)}let g=function(){function e(z){this.type=k.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=z.layerUid;this.sublayerUid=z.sublayerUid;this._collection=z.collection;this._traverseNodeHierarchy=z.traverseNodeHierarchy;this.slicePlaneEnabled=z.slicePlaneEnabled;this.isGround=z.isGround}var h=e.prototype;
h.updateElevationAlignState=function(z,n){this._needVerticalOffset=z&&n===c.ViewingMode.Global};h.intersect=function(z,n,l,m){const t=z.results,w=z.options.store===k.StoreResults.ALL,r=z.ray.direction,x=z.tolerance;let D=B=>B,A=B=>B;const v=d.getVerticalOffsetI3S(null!=z.verticalOffset?z.verticalOffset:this._needVerticalOffset?0:null);null!=z.verticalOffset&&null!=v&&(D=B=>v.applyToMbs(B),A=B=>v.applyToObb(B));this._traverseNodeHierarchy((B,C)=>{if(0===B.childrenLoaded)return!1;const E=null!=B.serviceObbInRenderSR&&
y.isValidObb(B.serviceObbInRenderSR)?B.serviceObbInRenderSR:null;if(null!=E&&!u.intersectLine(A(E),l,r,x))return!1;!C||null==E&&y.isValidMbs(B.renderMbs)&&!f(D(B.renderMbs),l,r,x)||null!=B.geometryObb&&!u.intersectLine(A(B.geometryObb),l,r,x)||this._collection.intersect(C,l,m,x,v,(F,M,K,G)=>{if(0<=M&&(null==n||n(l,m,M))){var L=O=>{const I=new p.I3sTarget(this.layerUid,this.sublayerUid,B.index,F,G);O.set(this.type,I,M,K)};this.isGround&&(null==t.ground.dist||M<t.ground.dist)&&L(t.ground);if(!z.options.isFiltered&&
((null==t.min.dist||M<t.min.dist)&&L(t.min),(null==t.max.dist||M>t.max.dist)&&L(t.max),w)){const O=q.newIntersectorResult(z.ray);L(O);z.results.all.push(O)}}});return!0})};return b._createClass(e)}();a.I3SIntersectionHandler=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Collection ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/ReactiveSet ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../rest/support/meshFeatureSet ../../../../support/featureFlags ../../../../support/requestUtils ../FeatureLayerView3D".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v){a.I3SOverrides=function(E){function F(K){K=E.call(this,K)||this;K._warnMaximumChangedObjectsExceeded=!1;K._maximumNumberOfEditOVerrides=5E4;K._original3DOFLDefinitionExpression=null;K._interactiveEditingSessions=new d;K.geometryOverrides=new d;K._clientGeometryCache=new Map;K._associatedLayerView=null;K._attributeChangedObjectIds=new h;K._geometryChangedObjectIds=new h;K._pendingFetchChangedObjectIds=null;K._pendingFetchAbortController=new AbortController;
K._pendingAttributeQueriesCache=new Map;return K}b._inherits(F,E);var M=F.prototype;M.initialize=function(){this._memCache=this.memoryController.newCache(`i3s-attribute-overrides-${this.layer.uid}`);this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.finally(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&null!=this._associatedLayer&&(D.direct3DObjectFeatureLayerDisplayEnabled()?
this._associatedLayer.load().then(K=>{this.destroyed||(this._original3DOFLDefinitionExpression=K.definitionExpression,this.addHandles(z.watch(()=>this._definitionExpression,G=>K.definitionExpression=G,z.initial)),this._associatedLayerView=new v({layer:this._associatedLayer,view:this.view}))}):D.i3sPatchingEnabled())};M.destroy=function(){this.is3DOFL&&null!=this._associatedLayer&&(D.direct3DObjectFeatureLayerDisplayEnabled()?null!=this._associatedLayerView&&(this._associatedLayer.definitionExpression=
this._original3DOFLDefinitionExpression):D.i3sPatchingEnabled());this._set("layer",null);this._memCache=g.destroyMaybe(this._memCache);this._pendingFetchAbortController=g.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null;this._pendingAttributeQueriesCache.clear()};M.featureHasGeometryChanges=function(K){return this._geometryChangedObjectIds.has(K)};M.featureHasAttributeChanges=function(K){return this._attributeChangedObjectIds.has(K)};M.createInteractiveEditSession=
function(K){this._attributeChangedObjectIds.add(K);const G=D.sceneLayerEditingEnabled()&&D.i3sPatchingEnabled()&&null!=this.is3DOFL,L=this._interactiveEditingSessions,O=new B(K,{rollback:()=>{L.remove(O)},commit:(I,H)=>{for(const [J,N]of I)this.updateAttributeValue(K,J,N);G&&null!=H&&this.updateGeometry(K,H)}});L.unshift(O);return O};M.applyAttributeOverrides=async function(K,G,L){if(null!=G){var {loadedAttributes:O,attributeData:I}=G;if(null!=O&&0!==O.length&&null!=I&&(this._pendingFetchChangedObjectIds&&
await e.whenOrAbort(this._pendingFetchChangedObjectIds,L),0!==this._attributeChangedObjectIds.size)){G={loadedAttributes:O,attributeData:I};var H=this._getOverridesFromCache(K,G,this._attributeChangedObjectIds),{objectIds:J,fieldNames:N}=H;0!==J.length&&0!==N.length&&(L=await this._queryAttributeOverridesFromAssociatedLayer(J,N,L),null!=L&&this._processOverridesFromAssociatedLayer(K,L,N,G))}}};M.updateGeometry=function(K,G){this._geometryChangedObjectIds.add(K);const L=this._clientGeometryCache.get(K);
null!=L&&(this.geometryOverrides.remove(L),this._clientGeometryCache.delete(K));null!=G&&(G={oid:K,mesh:G},this.geometryOverrides.add(G),this._clientGeometryCache.set(K,G))};M.updateAttributeValue=function(K,G,L){this._attributeChangedObjectIds.add(K);this._cacheAttributeValue(K,G,L)};M.featureAdded=function(K){this.is3DOFL&&D.i3sPatchingEnabled()&&this._geometryChangedObjectIds.add(K);this._attributeChangedObjectIds.add(K)};M._cacheAttributeValue=function(K,G,L){this._memCache.put(this._getAttributeCacheKey(K,
G),L,this._memCacheAttributeValueSize(L))};M._getOverridesFromCache=function(K,{loadedAttributes:G,attributeData:L},O){const I=new Set,H=[];for(var J of G)H[J.index]=L[J.name];L=new Set;for(J=0;J<K.length;J++){const N=K[J];if(O.has(N))for(const R of G){const W=this._attributeFromCache(N,R.index);void 0!==W?H[R.index][J]=W:(I.add(N),L.add(R.name))}}return{objectIds:Array.from(I),fieldNames:Array.from(L)}};M._attributeFromCache=function(K,G){const L=this._fromInteractiveEditingSession(K,G);if(void 0!==
L)return L;K=this._getAttributeCacheKey(K,G);return this._memCache.get(K)};M._fromInteractiveEditingSession=function(K,G){if(null!=this._interactiveEditingSessions)for(const L of this._interactiveEditingSessions){if(L.objectId!==K)continue;const O=L.getAttribute(G);if(void 0!==O)return O}};M._getAttributeCacheKey=function(K,G){return`${K}-${G}`};M._queryAttributeOverridesFromAssociatedLayer=async function(K,G,L){if(0===K.length)return null;this._logWarningIfMaximumObjectsExceeded();var {associatedLayer:O}=
this.layer;if(null==O)return null;const I=this._pendingAttributeQueriesCache;var H=[];const J=new Map;for(var N of K)(K=I.get(N))?H.push(K):(K=e.createResolver(),e.ignoreAbortErrors(K.promise),J.set(N,K),I.set(N,K.promise));K=Array.from(J.keys());const R=O.createQuery();({objectIdField:N}=O);G=[N,...G];R.where="1\x3d1";R.returnGeometry=!1;R.outFields=G;R.cacheHint=!0;R.objectIds=K;const [W,T]=await Promise.all([this._executeBatchQuery(O,K,R,L),Promise.all(H)]).then(P=>{e.throwIfAborted(L);return P}).catch(P=>
{for(const [Q,S]of J)I.delete(Q),S.reject(P);throw P;});O=[];for(const P of W)if(P.ok)for(const Q of P.value.features)H=Q,G=H.attributes[N],J.get(G)?.resolve(H),I.delete(G),J.delete(G),O.push(H);for(const P of T)P&&O.push(P);for(const [P,Q]of J)I.delete(P),Q.resolve(null);return O};M._queryGeometryOverridesFromAssociatedLayer=async function(K,G){if(0===K.length||!this.is3DOFL||!D.i3sPatchingEnabled())return null;this._logWarningIfMaximumObjectsExceeded();var L=this.layer.associatedLayer;const {objectIdField:O,
globalIdField:I}=L;var H=[O,...(null!=I?[I]:[])],J=L.createQuery();J.where="1\x3d1";J.returnGeometry=!0;J.outFields=H;J.cacheHint=!0;J.objectIds=K;J.returnZ=L.hasZ;J.returnM=L.hasM;H=await this._executeBatchQuery(L,K,J,G);K=L.infoFor3D;({spatialReference:L}=L);G=[];for(const N of H){if(!N.ok)continue;const {assetMaps:R,features:W,globalIdFieldName:T}=N.value;if(null!=R){H=x.assetMapFromAssetMapsJSON(K,R);for(const P of W){J=x.extractMesh(P,T,L,K,H);const Q=P;null!=J?(Q.geometry=J,G.push(Q)):Q.geometry=
null}}}return G};M._logWarningIfMaximumObjectsExceeded=function(){if(this._warnMaximumChangedObjectsExceeded){this._warnMaximumChangedObjectsExceeded=!1;var K=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${w.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`,G=this.layer.portalItem;K=G&&G.loaded?K+` (${G.portal.url}/home/item.html?id=${G.id}#settings)`:
K+` (${this.layer.parsedUrl.path})`;f.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,`${K}.`)}};M._executeBatchQuery=async function(K,G,L,O){if(0===G.length)return[];const I=r.getMaximumQuerySize(K);G=[...G].sort((H,J)=>H-J);G=u.splitIntoChunks(G,I).map(H=>{const J=L.clone();J.objectIds=H;return q.resultOrAbort(r.queryAllJSON(K,J,{signal:O}))});return Promise.all(G)};M._processOverridesFromAssociatedLayer=function(K,G,L,{loadedAttributes:O,attributeData:I}){var H=
this._associatedLayer;if(null!=H){H=H.objectIdField;var J=L.map(W=>{W in I||(I[W]=Array(K.length));return I[W]}),N=new Map(O.map(W=>[W.name,W.index]));O=L.map(W=>N.get(W));var R=new Map(Array.from(K,(W,T)=>[W,T]));for(const W of G){G=W.attributes[H];for(let T=0;T<L.length;T++){const P=O[T],Q=R.get(G),S=W.attributes[L[T]];J[T][Q]=S;this._cacheAttributeValue(G,P,S)}}}};M._memCacheAttributeValueSize=function(K){return"string"===typeof K?k.estimateStringByteSize(K):k.estimateNumberByteSize()};M._fetchChangedObjectIds=
async function(K){var G=this.layer;await G.load({signal:K});this._geometryChangedObjectIds.clear();this._attributeChangedObjectIds.clear();({associatedLayer:G}=G);if(null!=G&&G.capabilities?.operations?.supportsChangeTracking){var L=this._getFetchChangedObjectIdsServerGen();if(null!=L){var O=G.layerId,I=this.is3DOFL;L={f:"json",returnIdsOnly:!0,layers:`[${O}]`,returnUpdates:!0,returnDeletes:I,returnInserts:I,layerServerGens:JSON.stringify([{id:O,serverGen:L}])};I&&(O=G.infoFor3D,L.fieldsToCompare=
JSON.stringify({fields:[...Object.values(O.transformFieldRoles),O.sourceHashField]}));L=await q.result(y(`${G.url}/extractChanges`,{method:"post",query:L,timeout:1E4,signal:K}));!L.ok&&A.isTimeoutError(L.error)&&(O=this.layer.title,f.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("extractChanges:timeout",O,`${O} could not obtain edited features that are not cached in the scene service. Display of features may not be up to date with the latest edits. Consider re-caching the scene service.`));
if(L.ok&&1===L.value.data?.edits?.length){O=L.value.data.edits[0];L=O?.objectIds;var H=L?.adds??[];const J=L?.updates??[],N=L?.deletes??[];L=[...H,...J,...N];I=I?[...H,...(O?.fieldUpdates??J),...N]:[];O=Math.min(this._maximumNumberOfEditOVerrides,L.length);O<L.length&&(this._warnMaximumChangedObjectsExceeded=!0);L=L.sort((R,W)=>R-W);for(H=0;H<O;++H)this._attributeChangedObjectIds.add(L[H]);for(const R of I)this._geometryChangedObjectIds.add(R);if(this.is3DOFL&&D.i3sPatchingEnabled()&&0<this._geometryChangedObjectIds.size&&
(K=await this._queryGeometryOverridesFromAssociatedLayer(Array.from(this._geometryChangedObjectIds),K),null!=K))for(const R of K)null!=R.geometry&&this.updateGeometry(R.attributes[G.objectIdField],R.geometry)}}}};M._getFetchChangedObjectIdsServerGen=function(){var K=this.layer;if(null!=K.serviceUpdateTimeStamp&&null!=K.serviceUpdateTimeStamp.lastUpdate)return K.serviceUpdateTimeStamp.lastUpdate;K=K.associatedLayer;return null!=K&&null!=K.serverGens&&null!=K.serverGens.minServerGen?K.serverGens.minServerGen:
null};b._createClass(F,[{key:"is3DOFL",get:function(){return D.sceneLayerEditingEnabled()&&null!=this._associatedLayer&&null!=this._associatedLayer.infoFor3D}},{key:"sortedGeometryChangedObjectIds",get:function(){return this.is3DOFL?[...this._geometryChangedObjectIds].sort((K,G)=>K-G):[]}},{key:"_associatedLayer",get:function(){return null==this.layer?null:this.layer.associatedLayer}},{key:"hasGeometryChanges",get:function(){return 0<this._geometryChangedObjectIds.size}},{key:"_definitionExpression",
get:function(){const K=this.sortedGeometryChangedObjectIds;return 0===K.length?"1 \x3d 0":`OBJECTID IN (${K.join(",")})`}},{key:"updating",get:function(){if(!this.is3DOFL)return!1;if(D.direct3DObjectFeatureLayerDisplayEnabled())return null==this._associatedLayerView||null!=this._associatedLayerView&&this._associatedLayerView.updating;D.i3sPatchingEnabled();return!1}},{key:"isEmpty",get:function(){return null==this._pendingFetchChangedObjectIds&&0===this._attributeChangedObjectIds.size&&0===this._geometryChangedObjectIds.size}},
{key:"test",get:function(){const K=this;return{changedObjectIds:Array.from(this._attributeChangedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return K._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(G){K._maximumNumberOfEditOVerrides=G}}}}]);return F}(p);c.__decorate([n.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SOverrides.prototype,"layer",
void 0);c.__decorate([n.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);c.__decorate([n.property()],a.I3SOverrides.prototype,"_interactiveEditingSessions",void 0);c.__decorate([n.property({readOnly:!0})],a.I3SOverrides.prototype,"sortedGeometryChangedObjectIds",null);c.__decorate([n.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryOverrides",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"_clientGeometryCache",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,
"_associatedLayer",null);c.__decorate([n.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);c.__decorate([n.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"_attributeChangedObjectIds",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"_geometryChangedObjectIds",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"hasGeometryChanges",null);c.__decorate([n.property()],a.I3SOverrides.prototype,
"_pendingFetchChangedObjectIds",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"_pendingFetchAbortController",void 0);c.__decorate([n.property()],a.I3SOverrides.prototype,"_definitionExpression",null);c.__decorate([n.property()],a.I3SOverrides.prototype,"updating",null);c.__decorate([n.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=c.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);let B=function(){function E(M,K){this.objectId=M;
this._options=K;this._updates=new Map;this._updatedGeometry=void 0;this._state=C.ACTIVE}var F=E.prototype;F.getAttribute=function(M){return this._updates.get(M)};F.setAttribute=function(M,K){this.isActive&&this._updates.set(M,K)};F.getGeometry=function(){return this._updatedGeometry};F.setGeometry=function(M){this.isActive&&(this._updatedGeometry=M)};F.rollback=function(){this.isActive&&(this._state=C.ROLLED_BACK,this._options.rollback(),this._updatedGeometry=void 0)};F.commit=function(){this.isActive&&
(this._state=C.COMMITTED,this._options.commit(this._updates,this._updatedGeometry),this._updates.clear(),this._updatedGeometry=void 0)};b._createClass(E,[{key:"isActive",get:function(){return this._state===C.ACTIVE}}]);return E}();var C;(function(E){E[E.ACTIVE=0]="ACTIVE";E[E.COMMITTED=1]="COMMITTED";E[E.ROLLED_BACK=2]="ROLLED_BACK"})(C||(C={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../rest/support/Query"],
function(a,b){function c(u){return p(u)*y(u)}function y(u){return u.capabilities.query.maxRecordCount||2E3}function p(u){return u.capabilities.query.supportsMaxRecordCountFactor?b.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=p;a.getMaximumQuerySize=c;a.getMaximumRecordCount=y;a.queryAllJSON=async function(u,q,k){q=q.clone();u.capabilities.query.supportsMaxRecordCountFactor&&(q.maxRecordCountFactor=p(u));const d=c(u),f=u.capabilities.query.supportsPagination;q.start=0;q.num=d;let g=null;
for(;;){const e=await u.source.queryFeaturesJSON(q,k);null==g?g=e:g.features=g.features.concat(e.features);g.exceededTransferLimit=e.exceededTransferLimit;if(!f||!e.exceededTransferLimit)break;q.start+=d}return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureSet":function(){define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../chunks/vec3f64 ../../geometry/Extent ../../geometry/Mesh ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/MeshGeoreferencedRelativeVertexSpace ../../geometry/support/MeshLocalVertexSpace ../../geometry/support/MeshTransform ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){function l(A){return({attributes:v})=>{if(!v)return{};if(!A)return v;for(const B in v)A.has(B)||delete v[B];return v}}function m(A,v,B,C,E){E=E.get(A.attributes[v]);if(null==E)return x().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",A),null;if(!A.geometry)return x().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",A),null;const {originPoint:F,originVector:M}=t(A,B,
C);v=u.fromJSON(A.geometry);v.spatialReference=B;A=w(A.attributes,C);B=E.projectVertices?new f({origin:M}):new g({origin:M});a:{E=Array.from(E.files.values());C=[];for(K of E){if(K.status!==D.COMPLETED){var K=null;break a}E=[];for(const G of K.parts){if(!G){K=null;break a}E.push(new h.ServiceAssetPart(G.url,G.hash))}C.push(new h.ServiceAsset(K.name,K.mimeType,E))}K=C}return K?q.createWithExternalSource(F,K,{extent:v,transform:A,vertexSpace:B}):q.createIncomplete(F,{extent:v,transform:A,vertexSpace:B})}
function t({attributes:A},v,{transformFieldRoles:B}){const C=A[B.originX],E=A[B.originY];A=A[B.originZ];return{originPoint:new k({x:C,y:E,z:A,spatialReference:v}),originVector:p.fromValues(C,E,A)}}function w(A,{transformFieldRoles:v}){return new e({translation:[A[v.translationX],-A[v.translationZ],A[v.translationY]],rotationAxis:[A[v.rotationX],A[v.rotationZ],A[v.rotationY]],rotationAngle:A[v.rotationDeg],scale:[A[v.scaleX],A[v.scaleY],A[v.scaleZ]]})}function r(A,v){const B=new Map;for(const E of v){var C=
E.parentGlobalId;if(null==C)continue;const F=E.assetName,M=E.assetType;v=E.assetHash;const K=E.assetURL,G=E.conversionStatus,L=E.seqNo,O=z.getFormatIdMimeType(M,A.supportedFormats);O?(C=y.getOrCreateMapValue(B,C,()=>({projectVertices:E.flags.includes("PROJECT_VERTICES"),files:new Map})),y.getOrCreateMapValue(C.files,F,()=>{a:switch(G){case "COMPLETED":case "SUBMITTED":var I=D.COMPLETED;break a;case "INPROGRESS":I=D.PENDING;break a;default:I=D.FAILED}return{name:F,type:M,mimeType:O,status:I,parts:[]}}).parts[L]=
{hash:v,url:K}):x().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${M}, but it does not list it as a supported type`)}return B}const x=()=>c.getLogger("esri.rest.support.meshFeatureSet");var D;(function(A){A[A.FAILED=0]="FAILED";A[A.PENDING=1]="PENDING";A[A.COMPLETED=2]="COMPLETED"})(D||(D={}));a.assetMapFromAssetMapsJSON=r;a.extractMesh=m;a.meshFeatureSetFromJSON=function(A,v,B){var C=B.features;B.features=[];delete B.geometryType;const E=n.fromJSON(B);E.geometryType=
"mesh";if(!B.assetMaps)return E;const F=r(v,B.assetMaps),M=A.sourceSpatialReference??d.WGS84;B=B.globalIdFieldName;({outFields:A}=A);A=null!=A&&0<A.length?l(A.includes("*")?null:new Set(A)):()=>({});for(const K of C)C=m(K,B,M,v,F),null!=C&&E.features.push(new b({geometry:C,attributes:A(K)}));return E};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/Mesh":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/HandleOwner ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/MeshGeoreferencedRelativeVertexSpace ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/georeference ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N){var R;e={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:v,"georeferenced-relative":A,local:B}};p=R=function(P){function Q(U){U=P.call(this,U)||this;U.components=null;U.vertexSpace=new v;U.transform=null;U.metadata=new O.Metadata;U.hasZ=!0;U.hasM=!1;U.vertexAttributes=new E.MeshVertexAttributes;U.type="mesh";return U}b._inherits(Q,P);var S=Q.prototype;S.initialize=function(){if(0===this.metadata.externalSources.length||
this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.handles.add(f.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(U=>U.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})};S.addComponent=function(U){this.loaded?(this.components||(this.components=[]),this.components.push(D.from(U)),this.notifyChange("components")):q.getLogger(this).error("addComponent()","Mesh must be loaded before applying operations")};S.removeComponent=function(U){if(this.loaded){if(this.components&&
(U=this.components.indexOf(U),-1!==U)){this.components.splice(U,1);this.notifyChange("components");return}q.getLogger(this).error("removeComponent()","Provided component is not part of the list of components")}else q.getLogger(this).error("removeComponent()","Mesh must be loaded before applying operations")};S.rotate=function(U,V,X,Y){x.composeAxes(U,V,X,T);J.rotate(this,T,Y);return this};S.offset=function(U,V,X,Y){if(!this.loaded)return q.getLogger(this).error("offset()","Mesh must be loaded before applying operations"),
this;W[0]=U;W[1]=V;W[2]=X;I.offset(this,W,Y);return this};S.scale=function(U,V){if(!this.loaded)return q.getLogger(this).error("scale()","Mesh must be loaded before applying operations"),this;N.scale(this,U,V);return this};S.centerAt=function(U,V){if(!this.loaded)return q.getLogger(this).error("centerAt()","Mesh must be loaded before applying operations"),this;K.centerAt(this,U,V);return this};S.load=function(U){const {metadata:{displaySource:V}}=this;V&&this.addResolvingPromise(L.loadExternal(this,
V,U));return Promise.resolve(this)};S.addExternalSources=function(U){this.metadata.externalSources.addMany(U)};S.updateDisplaySource=function(U){this.metadata.displaySource=U};S.clone=function(){return this.cloneWithVertexSpace(this.vertexSpace.clone())};S.cloneWithVertexSpace=function(U){let V=null;if(this.components){const X=new Map,Y=new Map;V=this.components.map(Z=>Z.cloneWithDeduplication(X,Y))}U={components:V,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),
vertexSpace:U,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new R(U)};S.cloneShallow=function(){return new R({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})};S.vertexAttributesChanged=function(){this.notifyChange("vertexAttributes")};S.toBinaryGLTF=async function(U){var V=new Promise((Y,Z)=>a(["./support/meshUtils/exporters/gltf/gltfexport"],
Y,Z));const X=this.load();V=await Promise.all([V,X]);({toBinaryGLTF:V}=V[0]);return V(this,U)};S._clearSources=function(){this.metadata.clearSources()};Q.createBox=function(U,V){if(!(U instanceof w))return q.getLogger("esri.geometry.Mesh").error(".createBox()","expected location to be a Point instance"),null;U=new R(H.convertUnitGeometry(H.createUnitSizeBox(),U,V));return V&&V.imageFace&&"all"!==V.imageFace?H.extractSingleFaceOfBox(U,V.imageFace):U};Q.createSphere=function(U,V){return U instanceof
w?new R(H.convertUnitGeometry(H.createUnitSizeSphere(V&&V.densificationFactor||0),U,V)):(q.getLogger("esri.geometry.Mesh").error(".createSphere()","expected location to be a Point instance"),null)};Q.createCylinder=function(U,V){return U instanceof w?new R(H.convertUnitGeometry(H.createUnitSizeCylinder(V&&V.densificationFactor||0),U,V)):(q.getLogger("esri.geometry.Mesh").error(".createCylinder()","expected location to be a Point instance"),null)};Q.createPlane=function(U,V){if(!(U instanceof w))return q.getLogger("esri.geometry.Mesh").error(".createPlane()",
"expected location to be a Point instance"),null;const X=V?.facing??"up",Y=H.convertPlaneSizeParameter(X,V?.size);return new R(H.convertUnitGeometry(H.createUnitSizePlane(X),U,{...V,size:Y}))};Q.createFromPolygon=function(U,V){if(!(U instanceof r))return q.getLogger("esri.geometry.Mesh").error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const X=F.triangulate(U);return new R({vertexAttributes:new E.MeshVertexAttributes({position:X.position}),components:[new D({faces:X.faces,
shading:"flat",material:V?.material??null})],spatialReference:U.spatialReference,vertexSpace:new v})};Q.createFromGLTF=async function(U,V,X){if(!(U instanceof w))throw q.getLogger("esri.geometry.Mesh").error(".createfromGLTF()","expected location to be a Point instance"),new y("invalid-input","Expected location to be a Point instance");const {loadGLTFMesh:Y}=await d.whenOrAbort(new Promise((Z,ea)=>a(["./support/meshUtils/loadGLTFMesh"],Z,ea)),X);return new R(await Y(U,V,X))};Q.createFromFiles=async function(U,
V,X){if(!(U instanceof w))throw q.getLogger("esri.geometry.Mesh").error(".createFromFiles()","Expected location to be a Point instance"),new y("invalid-input","Expected location to be a Point instance");U=R.createWithExternalSource(U,V);V=X?.layer;if(!V)throw q.getLogger("esri.geometry.Mesh").error(".createFromFiles()","A layer is needed to convert the files"),new y("invalid-input","A layer is needed to convert the files");[X]=await V.uploadAssets([U],X);return X};Q.createWithExternalSource=function(U,
V,X){var Y=X?.extent??null;const {x:Z,y:ea,z:ja,spatialReference:ha}=U;U=X?.transform?.clone()??new C;X=X?.vertexSpace??new B({origin:[Z,ea,ja??0]});V={source:V,extent:Y};Y=new O.Metadata;Y.externalSources.push(V);return new R({metadata:Y,transform:U,vertexSpace:X,spatialReference:ha})};Q.createIncomplete=function(U,V){const {x:X,y:Y,z:Z,spatialReference:ea}=U;U=V?.transform?.clone()??new C;V=V?.vertexSpace??new B({origin:[X,Y,Z??0]});V=new R({transform:U,vertexSpace:V,spatialReference:ea});V.addResolvingPromise(Promise.reject(new y("mesh-incomplete",
"Mesh resources are not complete")));return V};b._createClass(Q,[{key:"hasExtent",get:function(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}},{key:"_transformedExtent",get:function(){const {components:U,spatialReference:V,vertexAttributes:X,vertexSpace:Y}=this;var Z=X.position;if(0===Z.length||U&&0===U.length)return new m({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:V});if("local"===
Y.type){const {_untransformedExtent:ea,transform:ja}=this;return M.getProjectedExtent(ea,ja,Y,V)}if("georeferenced-relative"===Y.type){const {transform:ea}=this;Z=G.project({positions:Z,transform:ea,vertexSpace:Y,inSpatialReference:V,outSpatialReference:V,local:!1});return M.getExtentFromPositions(Z,V)}return M.getExtentFromPositions(Z,V)}},{key:"_untransformedExtent",get:function(){return M.getExtentFromPositions(this.vertexAttributes.position,this.spatialReference)}},{key:"anchor",get:function(){const {vertexSpace:U}=
this;if(U.isRelative)return U.getOriginPoint(this.spatialReference);const {center:V,zmin:X}=this._transformedExtent;return new w({x:V.x,y:V.y,z:X,spatialReference:this.spatialReference})}},{key:"origin",get:function(){const {vertexSpace:U}=this;return U.isRelative?U.getOriginPoint(this.spatialReference):this._transformedExtent.center}},{key:"extent",get:function(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}},{key:"memoryUsage",
get:function(){let U;U=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const V of this.components)U+=V.memoryUsage;return U}}]);return Q}(p.HandleOwnerMixin(u.LoadableMixin(k.EsriPromiseMixin(t))));c.__decorate([g.property({type:[D],json:{write:!0}})],p.prototype,"components",void 0);c.__decorate([g.property({nonNullable:!0,types:e,constructOnly:!0,json:{write:!0}})],p.prototype,"vertexSpace",void 0);c.__decorate([g.property({type:C,json:{write:!0}})],p.prototype,"transform",void 0);
c.__decorate([g.property({constructOnly:!0})],p.prototype,"metadata",void 0);c.__decorate([g.property()],p.prototype,"hasExtent",null);c.__decorate([g.property()],p.prototype,"_transformedExtent",null);c.__decorate([g.property()],p.prototype,"_untransformedExtent",null);c.__decorate([g.property()],p.prototype,"anchor",null);c.__decorate([g.property()],p.prototype,"origin",null);c.__decorate([g.property({readOnly:!0,json:{read:!1}})],p.prototype,"extent",null);c.__decorate([g.property({readOnly:!0,
json:{read:!1,write:!0,default:!0}})],p.prototype,"hasZ",void 0);c.__decorate([g.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],p.prototype,"hasM",void 0);c.__decorate([g.property({type:E.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],p.prototype,"vertexAttributes",void 0);p=R=c.__decorate([n.subclass("esri.geometry.Mesh")],p);const W=l.create(),T=x.create();return p})},"esri/geometry/support/MeshTransform":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/mat4 ../../chunks/mat4f64 ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64 ./axisAngleDegrees".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){var l;c=l=function(t){function w(x){x=t.call(this,x)||this;x.translation=z.create();x.rotationAxis=z.fromArray(n.UP);x.rotationAngle=0;x.scale=z.fromValues(1,1,1);return x}a._inherits(w,t);var r=w.prototype;r.applyLocal=function(x,D){return h.transformMat4(D,x,this.localMatrix)};r.applyLocalInverse=function(x,D){return h.transformMat4(D,x,this.localMatrixInverse)};r.equals=function(x){return this===x||null!=x&&d.exactEquals(this.localMatrix,x.localMatrix)};
r.clone=function(){const x={translation:z.clone(this.translation),rotationAxis:z.clone(this.rotationAxis),rotationAngle:this.rotationAngle,scale:z.clone(this.scale)};return new l(x)};a._createClass(w,[{key:"rotation",get:function(){return n.fromAxisAndAngle(this.rotationAxis,this.rotationAngle)},set:function(x){this.rotationAxis=z.clone(n.axis(x));this.rotationAngle=n.angle(x)}},{key:"localMatrix",get:function(){const x=f.create();g.setAxisAngle(m,n.axis(this.rotation),n.angleRad(this.rotation));
d.fromRotationTranslationScale(x,m,this.translation,this.scale);return x}},{key:"localMatrixInverse",get:function(){return d.invert(f.create(),this.localMatrix)}}]);return w}(c.JSONSupport);b.__decorate([y.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"translation",void 0);b.__decorate([y.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"rotationAxis",void 0);b.__decorate([y.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"rotationAngle",
void 0);b.__decorate([y.property({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"scale",void 0);b.__decorate([y.property()],c.prototype,"rotation",null);b.__decorate([y.property()],c.prototype,"localMatrix",null);b.__decorate([y.property()],c.prototype,"localMatrixInverse",null);c=l=b.__decorate([k.subclass("esri.geometry.support.MeshTransform")],c);const m=e.create();return c})},"esri/geometry/support/meshUtils/bounds":function(){define(["exports","../../Extent","./georeference"],function(a,
b,c){function y(u,q){let k=Infinity,d=Infinity,f=Infinity,g=-Infinity,e=-Infinity,h=-Infinity;const z=u.length;let n=0;for(;n<z;){const l=u[n++],m=u[n++],t=u[n++];k=Math.min(k,l);d=Math.min(d,m);f=Math.min(f,t);g=Math.max(g,l);e=Math.max(e,m);h=Math.max(h,t)}return new b({xmin:k,ymin:d,zmin:f,xmax:g,ymax:e,zmax:h,spatialReference:q})}let p=null;a.getExtentFromPositions=y;a.getProjectedExtent=function({xmin:u,xmax:q,ymin:k,ymax:d,zmin:f,zmax:g},e,h,z){f??(f=0);g??(g=0);p??(p=new Float64Array(24));
const n=p;n[0]=u;n[1]=k;n[2]=f;n[3]=u;n[4]=d;n[5]=f;n[6]=q;n[7]=d;n[8]=f;n[9]=q;n[10]=k;n[11]=f;n[12]=u;n[13]=k;n[14]=g;n[15]=u;n[16]=d;n[17]=g;n[18]=q;n[19]=d;n[20]=g;n[21]=q;n[22]=k;n[23]=g;c.project({positions:n,transform:e,vertexSpace:h,inSpatialReference:z,outSpatialReference:z,outPositions:n,local:!1});return y(n,z)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/georeference":function(){define("exports ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../DoubleArray ../MeshGeoreferencedRelativeVertexSpace ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t){function w(F,M,K){if(m.isGeographicMesh(M.spatialReference,K)){var G=M.spatialReference,L=A(M,K,B),O=new Float64Array(F.position.length);M=F.position;var I=G;var H=O;l.transformMat4(H,M,L);M=new Float64Array(M.length);I=t.projectFromPCPF(H,M,I);L=k.normalFromMat4(E,L);H=O;M=F.normal;K=L;var J=G;if(null==M)H=null;else{var N=new Float32Array(M.length);l.transformMat3(N,M,K);t.projectNormalFromPCPF(N,I,H,J,N);H=N}F=F.tangent;if(null==F)F=null;else{M=new Float32Array(F.length);
l.transformMat3(M,F,L,4);for(L=3;L<M.length;L+=4)M[L]=F[L];t.projectTangentFromPCPF(M,I,O,G,M);F=M}F={position:I,normal:H,tangent:F}}else{G=new Float64Array(F.position.length);I=F.position;O=M.x;L=M.y;H=M.z??0;M=v(K?K.unit:null,M.spatialReference);for(K=0;K<I.length;K+=3)G[K]=I[K]*M+O,G[K+1]=I[K+1]*M+L,G[K+2]=I[K+2]*M+H;F={position:G,normal:F.normal,tangent:F.tangent}}return F}function r(F,M,K,G){const {position:L,normal:O,tangent:I}=F;if(!M.isRelative)return{position:L,normal:O,tangent:I};var H=
K?.localMatrix??p.IDENTITY;F=l.transformMat4(new Float64Array(L.length),L,H);K=null!=O?t.transformNormal(O,new Float32Array(O.length),H):null;H=null!=I?t.transformTangent(I,new Float32Array(I.length),H):null;return w({position:F,normal:K,tangent:H},M.getOriginPoint(G),{geographic:!M.isGeoreferenced})}function x(F,M,K){if(m.isGeographicMesh(M.spatialReference,K)){const I=M.spatialReference;A(M,K,B);var G=y.invert(C,B);M=new Float64Array(F.position.length);K=G;var L=t.projectToPCPF(F.position,I,M),
O=new Float64Array(L.length);l.transformMat4(O,L,K);K=O;G=k.normalFromMat4(E,G);O=F.normal;L=G;null==O?L=null:(O=t.projectNormalToPCPF(O,F.position,M,I,new Float32Array(O.length)),l.transformMat3(O,O,L),L=O);O=F.tangent;null==O?F=null:(F=t.projectTangentToPCPF(O,F.position,M,I,new Float32Array(O.length)),l.transformMat3(F,F,G,4));F={position:K,normal:L,tangent:F}}else F=D(F,M,K);return F}function D(F,M,K){const G=new Float64Array(F.position.length),L=F.position,O=M.x,I=M.y,H=M.z??0;M=v(K?K.unit:null,
M.spatialReference);for(K=0;K<L.length;K+=3)G[K]=(L[K]-O)/M,G[K+1]=(L[K+1]-I)/M,G[K+2]=(L[K+2]-H)/M;return{position:G,normal:F.normal,tangent:F.tangent}}function A(F,M,K){d.computeTranslationToOriginAndRotation(F.spatialReference,[F.x,F.y,F.z??0],K,f.getSphericalPCPF(F.spatialReference));F=v(M?M.unit:null,F.spatialReference);y.scale(K,K,[F,F,F]);return K}function v(F,M){if(null==F)return 1;M=b.getMetersPerCartesianUnitForSR(M);return 1/b.convertUnit(M,"meters",F)}const B=p.create(),C=p.create(),E=
c.create();a.georeference=w;a.georeferenceApplyTransform=r;a.georeferenceByTransform=function(F,M,K){if(K?.useTransform){const {position:G,normal:L,tangent:O}=F,{x:I,y:H,z:J}=M;F=q.fromValues(I,H,J??0);return{vertexAttributes:{position:G,normal:L,tangent:O},vertexSpace:K.geographic??!0?new z({origin:F}):new e({origin:F}),transform:new n}}return{vertexAttributes:w(F,M,K),vertexSpace:new h,transform:null}};a.project=function({positions:F,transform:M,vertexSpace:K,inSpatialReference:G,outSpatialReference:L,
outPositions:O,local:I}){const H=K.isRelative?K.origin:q.ZEROS;M=K.isRelative?M?.localMatrix??p.IDENTITY:p.IDENTITY;if(K.isGeoreferenced){O=O??g.newDoubleArray(F.length);y.equals(M,p.IDENTITY)?g.copyInto(O,F):l.transformMat4(O,F,M);if(!u.exactEquals(H,q.ZEROS)){const [J,N,R]=H;for(F=0;F<O.length;F+=3)O[F]+=J,O[F+1]+=N,O[F+2]+=R}d.projectBuffer(O,G,0,O,L,0,O.length/3);return O}K=f.getSphericalPCPF(G);I=!I&&d.canProjectWithoutEngine(G,K)?K:G;d.computeTranslationToOriginAndRotation(G,H,B,I);y.multiply(B,
B,M);G=O??g.newDoubleArray(F.length);l.transformMat4(G,F,B);d.projectBuffer(G,I,0,G,L,0,G.length/3);return G};a.ungeoreference=x;a.ungeoreferenceByTransform=function(F,M,K,G,L){if(!M.isRelative)return x(F,G,L);const {spatialReference:O}=G;F=r(F,M,K,O);return G.equals(M.getOriginPoint(O))?D(F,G,L):x(F,G,L)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/Logger"],function(a,b){a.isGeographicMesh=
function(c,y){return c.isGeographic||c.isWebMercator&&(y?.geographic??!0)};a.validateGeographicFlag=function(c,y,p){const u=!c.isGeoreferenced;null!=p?.geographic&&p.geographic!==u&&b.getLogger(y).warnOnce(`Specifying the 'geographic' parameter (${p.geographic}) for a Mesh vertex space of type "${c.type}" is not supported. This parameter will be ignored.`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/centerAt":function(){define("exports ../../../core/Logger ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ./geographicUtils ./georeference".split(" "),
function(a,b,c,y,p,u,q){const k=y.create(),d=y.create(),f=y.create();a.centerAt=function(g,e,h){if(g.vertexAttributes&&g.vertexAttributes.position){var {vertexSpace:z}=g,n=h?.origin??g.origin;if(z.isRelative)u.validateGeographicFlag(z,"esri.geometry.support.meshUtils.centerAt",h),{vertexSpace:h}=g,h.isRelative&&(p.projectPointToVector(e,k,g.spatialReference)?(p.projectPointToVector(n,d,g.spatialReference)||(e=g.origin,d[0]=e.x,d[1]=e.y,d[2]=e.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${n.spatialReference.wkid}) to mesh spatial reference (wkid:${g.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load().")),g=c.subtract(f,k,d),n=h.origin,h.origin=c.add(y.create(),n,g)):b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${g.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));else if(u.isGeographicMesh(g.spatialReference,h)){n=q.ungeoreference(g.vertexAttributes,n,{geographic:!0});const {position:l,
normal:m,tangent:t}=q.georeference(n,e,{geographic:!0});g.vertexAttributes.position=l;g.vertexAttributes.normal=m;g.vertexAttributes.tangent=t;g.vertexAttributesChanged()}else if(p.projectPointToVector(e,k,g.spatialReference)){p.projectPointToVector(n,d,g.spatialReference)||(e=g.origin,d[0]=e.x,d[1]=e.y,d[2]=e.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${n.spatialReference.wkid}) to mesh spatial reference (wkid:${g.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load()."));if(n=g.vertexAttributes.position)for(e=0;e<n.length;e+=3)for(h=0;3>h;h++)n[e+h]+=k[h]-d[h];g.vertexAttributesChanged()}else b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${g.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/loadExternal":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(a,b,c,y,p,u,q){function k(m){const t=u.removeFile(m.url);return w=>{var r=u.makeRelative(w,t,t);return((r=r?r.replace(/^ *\.\//,""):null)?m.files.get(r):null)??w}}async function d(m,t){if(Array.isArray(m)){if(!m.length)throw new y("mesh-load-external:missing-assets","There must be at least one file to load");
return m[0]instanceof File?g(m):e(m,t)}return l.fromBlob(m)}async function f(m,t){const {parts:w}=m;if(1===w.length)return new l(w[0].partUrl);m=await m.toBlob(t);p.throwIfAborted(t);return l.fromBlob(m)}function g(m){m=m.map(t=>({name:t.name,mimeType:t.type,source:l.fromBlob(t)}));return h(m)}async function e(m,t){m=await p.eachAlwaysValues(m.map(async w=>{const r=await f(w);p.throwIfAborted(t);return{name:w.assetName,mimeType:w.assetMimeType,source:r}}));if(p.isAborted(t))throw m.forEach(w=>w.source.dispose()),
p.createAbortError();return h(m)}function h(m){const t=new Map;let w=null;for(const {name:r,mimeType:x,source:D}of m){if(null==w||z.test(x)||n.test(r))w=D.url;t.set(r,D.url);D.files.forEach((A,v)=>t.set(v,A))}if(null==w)throw new y("mesh-load-external:missing-files","Missing files to load external mesh source");return new l(w,()=>m.forEach(({source:r})=>r.dispose()),t)}const z=/^(model\/gltf\+json)|(model\/gltf-binary)$/,n=/\.(gltf|glb)/i;let l=function(){function m(t,w=()=>{},r=new Map){this.url=
t;this.dispose=w;this.files=r}m.fromBlob=function(t){const w=URL.createObjectURL(t);return new m(w,()=>URL.revokeObjectURL(w))};return c._createClass(m)}();b.loadExternal=async function(m,t,w){({source:t}=t);const {loadGLTFMesh:r}=await p.whenOrAbort(new Promise((v,B)=>a(["./loadGLTFMesh"],v,B)),w),x=await d(t,w);p.throwIfAborted(w);w=r(new q({x:0,y:0,z:0,spatialReference:m.spatialReference}),x.url,{resolveFile:k(x),useTransform:!0,signal:w?.signal});w.then(()=>x.dispose(),()=>x.dispose());const {vertexAttributes:D,
components:A}=await w;m.vertexAttributes=D;m.components=A};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/Metadata":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/Collection ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./External".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.Metadata=function(e){function h(){var n=e.call(this)||this;n.externalSources=new p;n._explicitDisplaySource=null;return n}b._inherits(h,e);var z=h.prototype;z.clearSources=function(){this.displaySource=null;this.externalSources.removeAll()};z.getExternalSourcesOnService=function(n){return this.externalSources.items.filter(l=>g.externalIsOnService(l,n))};b._createClass(h,[{key:"displaySource",get:function(){return this._explicitDisplaySource??this._implicitDisplaySource},
set:function(n){if(null!=n&&!g.isDisplayExternal(n))throw Error("Cannot use this source for display: it is not in a supported format.");(this._explicitDisplaySource=n)&&this.externalSources.every(l=>!g.externalSourcesAreEqual(l,n))&&this.externalSources.add(n)}},{key:"_implicitDisplaySource",get:function(){return this.externalSources.find(g.isDisplayExternal)}}]);return h}(y.Clonable);c.__decorate([u.property()],a.Metadata.prototype,"externalSources",void 0);c.__decorate([u.property()],a.Metadata.prototype,
"displaySource",null);c.__decorate([u.property()],a.Metadata.prototype,"_implicitDisplaySource",null);c.__decorate([u.property()],a.Metadata.prototype,"_explicitDisplaySource",void 0);a.Metadata=c.__decorate([f.subclass("esri.geometry.support.meshUtils.Metadata")],a.Metadata);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/offset":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ./geographicUtils ./projection".split(" "),
function(a,b,c,y,p,u,q,k,d,f){function g(n,l){if(n)for(let m=0;m<n.length;m+=3)for(let t=0;3>t;t++)n[m+t]+=l[t]}const e=u.create(),h=y.create(),z=c.create();a.offset=function(n,l,m){if(n.vertexAttributes&&n.vertexAttributes.position){var {vertexSpace:t}=n;if(t.isRelative)d.validateGeographicFlag(t,"esri.geometry.support.meshUtils.offset",m),n=t.origin,t.origin=p.add(u.create(),n,l);else{if(d.isGeographicMesh(n.spatialReference,m)){t=n.spatialReference;m=n.vertexAttributes.position;const w=n.vertexAttributes.normal,
r=n.vertexAttributes.tangent,x=new Float64Array(m.length),D=null!=w?new Float32Array(w.length):null,A=null!=r?new Float32Array(r.length):null,v=n.extent.center;q.computeTranslationToOriginAndRotation(t,[v.x,v.y,v.z],h,k.getSphericalPCPF(t));b.fromMat4(z,h);p.transformMat3(e,l,z);f.projectToPCPF(m,t,x);null!=w&&null!=D&&f.projectNormalToPCPF(w,m,x,t,D);null!=r&&null!=A&&f.projectTangentToPCPF(r,m,x,t,A);g(x,e);f.projectFromPCPF(x,m,t);null!=w&&null!=D&&f.projectNormalFromPCPF(D,m,x,t,w);null!=r&&null!=
A&&f.projectTangentFromPCPF(A,m,x,t,r)}else g(n.vertexAttributes.position,l);n.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/primitives":function(){define("exports ../../../chunks/mat3f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../MeshComponent ../MeshVertexAttributes ./georeference".split(" "),function(a,b,c,y,p,u,q){var k=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],d=[0,0,1,0,0,1,0,0,1,0,0,1],f=[0,1,1,1,1,0,0,0],g=[0,
1,2,0,2,3],e={east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]};const h={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],
uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},z={south:0,east:1,north:2,west:3,up:4,down:5},n=y.create(),l=b.create();a.boxFaceOrder=z;a.convertPlaneSizeParameter=function(m,t){const w="number"===typeof t?t:null!=t?t.width:1;t="number"===typeof t?t:null!=t?t.height:1;switch(m){case "up":case "down":return{width:w,depth:t};case "north":case "south":return{width:w,height:t};case "east":case "west":return{depth:w,height:t}}};
a.convertUnitGeometry=function(m,t,w){if(!m.isPlane)for(var r=0;r<m.position.length;r+=3)m.position[r+2]+=.5;r=w?.size;if(null!=r){r="number"===typeof r?[r,r,r]:[null!=r.width?r.width:1,null!=r.depth?r.depth:1,null!=r.height?r.height:1];l[0]=r[0];l[4]=r[1];l[8]=r[2];for(var x=0;x<m.position.length;x+=3){for(var D=0;3>D;D++)n[D]=m.position[x+D];c.transformMat3(n,n,l);for(D=0;3>D;D++)m.position[x+D]=n[D]}if(r[0]!==r[1]||r[1]!==r[2])for(l[0]=1/r[0],l[4]=1/r[1],l[8]=1/r[2],r=0;r<m.normal.length;r+=3){for(x=
0;3>x;x++)n[x]=m.normal[r+x];c.transformMat3(n,n,l);c.normalize(n,n);for(x=0;3>x;x++)m.normal[r+x]=n[x]}}const {vertexAttributes:A,vertexSpace:v,transform:B}=q.georeferenceByTransform(m,t,w);return{vertexAttributes:new u.MeshVertexAttributes({...A,uv:m.uv}),vertexSpace:v,transform:B,components:[new p({faces:m.faces,material:w&&w.material||null})],spatialReference:t.spatialReference}};a.createUnitSizeBox=function(){const {faceDescriptions:m,faceVertexOffsets:t,uvScales:w}=h;var r=4*m.length;const x=
new Float64Array(3*r),D=new Float32Array(3*r);r=new Float32Array(2*r);const A=new Uint32Array(6*m.length);let v=0,B=0,C=0,E=0;for(let M=0;M<m.length;M++){const K=m[M];var F=v/3;for(const G of t)A[E++]=F+G;F=K.corners;for(let G=0;4>G;G++){const L=F[G];let O=0;r[C++]=.25*w[G][0]+K.uvOrigin[0];r[C++]=K.uvOrigin[1]-.25*w[G][1];for(let I=0;3>I;I++)0!==K.axis[I]?(x[v++]=.5*K.axis[I],D[B++]=K.axis[I]):(x[v++]=.5*L[O++],D[B++]=0)}}return{position:x,normal:D,uv:r,faces:A}};a.createUnitSizeCylinder=function(m=
0){m=Math.round(16*2**m);var t=4*(m+1)+2*m;const w=new Float64Array(3*t),r=new Float32Array(3*t);t=new Float32Array(2*t);const x=new Uint32Array(12*m);let D=0,A=0,v=0,B=0,C=0;for(let F=0;5>=F;F++){const M=0===F||5===F,K=1>=F||4<=F,G=2===F||4===F,L=M?m-1:m;for(let O=0;O<=L;O++){var E=O/L*2*Math.PI;const I=M?0:.5;n[0]=I*Math.sin(E);n[1]=I*-Math.cos(E);n[2]=2>=F?.5:-.5;for(E=0;3>E;E++)w[D++]=n[E],K?r[A++]=2===E?1>=F?1:-1:0:r[A++]=2===E?0:n[E]/I;t[v++]=(O+(M?.5:0))/m;1>=F?t[v++]=1*F/3:3>=F?t[v++]=(F-
2)/3+1/3:t[v++]=(F-4)/3+2/3;G||0===F||O===m||(5!==F&&(x[B++]=C,x[B++]=C+1,x[B++]=C-m),1!==F&&(x[B++]=C,x[B++]=C-m,x[B++]=C-m-1));C++}}return{position:w,normal:r,uv:t,faces:x}};a.createUnitSizePlane=function(m){m=e[m];const t=new Float64Array(k.length),w=new Float32Array(d.length);let r=0;for(let D=0;4>D;D++){const A=r;for(let v=0;3>v;v++){var x=m[v];const B=Math.abs(x)-1;x=0<=x?1:-1;t[r]=k[A+B]*x;w[r]=d[A+B]*x;r++}}return{position:t,normal:w,uv:new Float32Array(f),faces:new Uint32Array(g),isPlane:!0}};
a.createUnitSizeSphere=function(m=0){m=Math.round(8*2**m);const t=2*m;var w=(m-1)*(t+1)+2*t;const r=new Float64Array(3*w),x=new Float32Array(3*w);w=new Float32Array(2*w);const D=new Uint32Array((m-1)*t*6);let A=0,v=0,B=0,C=0;for(let M=0;M<=m;M++){var E=M/m*Math.PI+.5*Math.PI;const K=Math.cos(E);n[2]=Math.sin(E);const G=(E=0===M||M===m)?t-1:t;for(let L=0;L<=G;L++){var F=L/G*2*Math.PI;n[0]=-Math.sin(F)*K;n[1]=Math.cos(F)*K;for(F=0;3>F;F++)r[A]=.5*n[F],x[A]=n[F],++A;w[v++]=(L+(E?.5:0))/t;w[v++]=M/m;
0!==M&&L!==t&&(M!==m&&(D[B++]=C,D[B++]=C+1,D[B++]=C-t),1!==M&&(D[B++]=C,D[B++]=C-t,D[B++]=C-t-1));C++}}return{position:r,normal:x,uv:w,faces:D}};a.extractSingleFaceOfBox=function(m,t){const w=m.components[0];var r=w.faces,x=z[t],D=6*x;t=Array(6);const A=Array(r.length-6);var v=0;let B=0;for(let C=0;C<r.length;C++)C>=D&&C<D+6?t[v++]=r[C]:A[B++]=r[C];if(null!=m.vertexAttributes.uv){r=new Float32Array(m.vertexAttributes.uv);x*=8;D=[0,1,1,1,1,0,0,0];for(v=0;v<D.length;v++)r[x+v]=D[v];m.vertexAttributes.uv=
r}m.components=[new p({faces:t,material:w.material}),new p({faces:A})];return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/rotate":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ../axisAngleDegrees ../MeshTransform ./geographicUtils ./projection".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z){function n(D,A,v,B=k.ZEROS){if(null!=D)for(p.fromRotation(w,g.angleRad(A),g.axis(A)),A=0;A<D.length;A+=v){for(var C=0;3>C;C++)l[C]=D[A+C]-B[C];q.transformMat4(l,l,w);for(C=0;3>C;C++)D[A+C]=l[C]+B[C]}}const l=k.create(),m=k.create(),t=g.create(),w=u.create(),r=y.create(),x=k.create();a.rotate=function(D,A,v){if(D.vertexAttributes&&D.vertexAttributes.position&&0!==A[3]){var {spatialReference:B,vertexSpace:C}=D;if(C.isRelative){h.validateGeographicFlag(C,"esri.geometry.support.meshUtils.rotate",
v);v=v?.origin??D.origin;D.transform??(D.transform=new e);D=D.transform;var E=C.origin;v=q.set(l,v.x,v.y,v.z??0);v=q.subtract(l,v,E);D.applyLocalInverse(v,m);D.rotation=g.compose(D.rotation,A,g.create());D.applyLocalInverse(v,v);q.subtract(v,v,m);D.translation=q.add(k.create(),D.translation,v)}else{E=v?.origin??D.origin;if(h.isGeographicMesh(B,v)){var F=E;v=D.spatialReference;E=f.getSphericalPCPF(v);d.projectPointToVector(F,x,E)||d.projectPointToVector(D.origin,x,E);F=D.vertexAttributes.position;
const M=D.vertexAttributes.normal,K=D.vertexAttributes.tangent,G=new Float64Array(F.length),L=null!=M?new Float32Array(M.length):null,O=null!=K?new Float32Array(K.length):null;d.computeTranslationToOriginAndRotation(E,x,w,E);c.fromMat4(r,w);q.transformMat3(g.axis(t),g.axis(A),r);t[3]=A[3];z.projectToPCPF(F,v,G);null!=M&&null!=L&&z.projectNormalToPCPF(M,F,G,v,L);null!=K&&null!=O&&z.projectTangentToPCPF(K,F,G,v,O);n(G,t,3,x);z.projectFromPCPF(G,F,v);null!=M&&null!=L&&(n(L,t,3),z.projectNormalFromPCPF(L,
F,G,v,M));null!=K&&null!=O&&(n(O,t,4),z.projectTangentFromPCPF(O,F,G,v,K))}else v=E,d.projectPointToVector(v,x,D.spatialReference)||(E=D.origin,x[0]=E.x,x[1]=E.y,x[2]=E.z,b.getLogger("esri.geometry.support.meshUtils.rotate").error(`Failed to project specified origin (wkid:${v.spatialReference.wkid}) to mesh spatial reference (wkid:${D.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),n(D.vertexAttributes.position,A,3,x),n(D.vertexAttributes.normal,A,3),n(D.vertexAttributes.tangent,
A,4);D.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/scale":function(){define("exports ../../../core/Logger ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ../MeshTransform ./geographicUtils ./projection".split(" "),function(a,b,c,y,p,u,q,k,d){function f(z,n,l=y.ZEROS){if(z)for(let t=0;t<z.length;t+=3){for(var m=0;3>m;m++)g[m]=z[t+m]-l[m];c.scale(g,g,n);for(m=0;3>m;m++)z[t+
m]=g[m]+l[m]}}const g=y.create(),e=y.create(),h=y.create();a.scale=function(z,n,l){if(z.vertexAttributes&&z.vertexAttributes.position){var {spatialReference:m,vertexSpace:t}=z;if(t.isRelative){k.validateGeographicFlag(t,"esri.geometry.support.meshUtils.scale",l);var w=l?.origin??z.origin;z.transform??(z.transform=new q);z=z.transform;l=t.origin;w=c.set(g,w.x,w.y,w.z);w=c.subtract(g,w,l);z.applyLocalInverse(w,e);n=c.scale(y.create(),z.scale,n);z.scale=n;z.applyLocalInverse(w,w);c.subtract(w,w,e);z.translation=
c.add(y.create(),z.translation,w)}else{w=k.isGeographicMesh(m,l);l=l?.origin??z.origin;if(w){w=z.spatialReference;var r=u.getSphericalPCPF(w);p.projectPointToVector(l,h,r)||p.projectPointToVector(z.origin,h,r);l=z.vertexAttributes.position;r=z.vertexAttributes.normal;const x=z.vertexAttributes.tangent,D=new Float64Array(l.length),A=null!=r?new Float32Array(r.length):null,v=null!=x?new Float32Array(x.length):null;d.projectToPCPF(l,w,D);null!=r&&null!=A&&d.projectNormalToPCPF(r,l,D,w,A);null!=x&&null!=
v&&d.projectTangentToPCPF(x,l,D,w,v);f(D,n,h);d.projectFromPCPF(D,l,w);null!=r&&null!=A&&d.projectNormalFromPCPF(A,l,D,w,r);null!=x&&null!=v&&d.projectTangentFromPCPF(v,l,D,w,x)}else w=l,p.projectPointToVector(w,h,z.spatialReference)||(l=z.origin,h[0]=l.x,h[1]=l.y,h[2]=l.z,b.getLogger("esri.geometry.support.meshUtils.scale").error(`Failed to project specified origin (wkid:${w.spatialReference.wkid}) to mesh spatial reference (wkid:${z.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),
f(z.vertexAttributes.position,n,h);z.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/ByteSizeUnit","../../../../core/Error","../../../../core/promiseUtils"],function(a,b,c,y,p){function u(d){return new Promise((f,g)=>{d.oncomplete=()=>f();d.onerror=()=>g(d.error);d.onabort=()=>g(d.error)})}function q(d){return new Promise((f,
g)=>{"done"===d.readyState?null!=d.error?g(d.error):f(d.result):(d.onsuccess=()=>f(d.result),d.onerror=()=>g(d.error))})}let k=function(){function d(g,e,h=14){this._version=h;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=c.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=g;this._storeName=e}var f=d.prototype;f.init=function(){return Promise.resolve().then(()=>{const g=indexedDB.open(this._dbName,
this._version);g.onupgradeneeded=e=>{var h=g.result;const z=g.transaction,n=h.objectStoreNames.contains(this._storeName)?z.objectStore(this._storeName):h.createObjectStore(this._storeName);h=h.objectStoreNames.contains("last_access")?z.objectStore("last_access"):h.createObjectStore("last_access");h.indexNames.contains("date")||h.createIndex("date","date",{unique:!1});h.indexNames.contains("byteSize")||h.createIndex("byteSize","byteSize",{unique:!1});e.oldVersion<this._version&&(n.clear(),h.clear())};
return q(g)}).then(g=>{this._destroyed?g.close():this._db=g})};f.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};f.getHitRate=function(){return this._hit/(this._hit+this._miss)};f.put=function(g,e){return null==this._db?Promise.reject(new y("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(g,e)).catch(h=>{if(h&&"QuotaExceededError"===h.name)return null==
this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(z=>this._removeLeastRecentlyAccessed(e.byteSize+Math.ceil(z*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(g,e));throw h;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(h=>this._removeLeastRecentlyAccessed(h-
this.maxByteSize)))})};f.get=function(g,e){const h=this._db;if(null==h)return Promise.resolve(void 0);let z=null;return Promise.resolve().then(()=>{const n=h.transaction(this._storeName,"readonly");z=p.onAbort(e,()=>{n.abort()});const l=n.objectStore(this._storeName).get(g);return q(l)}).then(n=>{null==n?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:n.byteSize},g));null!=z&&z.remove();return n}).catch(()=>
{++this._miss;p.throwIfAborted(e);null!=z&&z.remove()})};f.remove=function(g){const e=this._db;return null==e?Promise.resolve():Promise.resolve().then(async()=>{const h=e.transaction([this._storeName,"last_access"],"readwrite");var z=h.objectStore(this._storeName),n=h.objectStore("last_access");z=z.delete(g);n=n.delete(g);await Promise.all([q(z),q(n),u(h)])})};f._put=function(g,e){var h=this._db;if(null==h)return Promise.resolve();h=h.transaction([this._storeName,"last_access"],"readwrite");var z=
h.objectStore(this._storeName);const n=h.objectStore("last_access");z=z.put(e,g);g=n.put({date:Date.now(),byteSize:e.byteSize},g);return Promise.all([q(z),q(g),u(h)])};f._removeLeastRecentlyAccessed=function(g){if(0>=g||!this._db)return Promise.resolve();const e=this._db.transaction([this._storeName,"last_access"],"readwrite"),h=e.objectStore(this._storeName),z=e.objectStore("last_access");let n=0;const l=z.index("date").openCursor(null,"next");l.onsuccess=()=>{const m=l.result;null!=m&&(null!=m.value.byteSize&&
(n+=m.value.byteSize),h.delete(m.primaryKey),z.delete(m.primaryKey),n<g&&m.continue())};return u(e)};f._getCacheSize=function(){var g=this._db;if(null==g)return Promise.resolve(0);g=g.transaction("last_access");let e=0;const h=g.objectStore("last_access").index("byteSize").openKeyCursor();h.onsuccess=()=>{const z=h.result;if(z){var n=z.key;null!=n&&(e+=n);z.continue()}};return u(g).then(()=>e)};b._createClass(d,[{key:"initialized",get:function(){return null!=this._db}}]);return d}();a.IDBCache=k;
a.whenRequest=q;a.whenTransaction=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function y(){this._data=new Map;this._hit=this._miss=0;this.initialized=!0}var p=y.prototype;p.init=function(){return Promise.resolve()};p.get=async function(u,q){if(this._data.has(u))return this._hit++,this._data.get(u)??void 0;this._miss++};p.destroy=
function(){};p.put=function(u,q){this._data.set(u,q);return Promise.resolve()};p.remove=function(u){this._data.delete(u);return Promise.resolve()};p.getHitRate=function(){return this._hit/(this._hit+this._miss)};return b._createClass(y)}();a.IDBMockCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/featureEditing":function(){define(["exports","../../../../core/lang","../support/attributeUtils"],function(a,b,c){function y(e,{edits:h,addedFeatures:z}){const n=
new Map;h=h.addAssetFeatures;const {fieldsIndex:l,globalIdField:m}=e;if(!h||0===h.length||null==m)return n;e=u(z);for(const t of h)z=c.attributeLookup(l,t.attributes,m),z=e.get(z),null!=t.geometry&&"mesh"===t.geometry.type&&null!=z&&n.set(z,t);return n}function p(e,h){const z=h.edits.updateFeatures;if(!z||0===z.length)return new g;const n=q(h.updatedFeatures),l=new g;h=new Map;for(let r=0;r<e.attributeStorageInfo.length;r++)h.set(e.attributeStorageInfo[r].name,r);const m=e.fieldsIndex,t=e.objectIdField,
w=z.filter(r=>{r=c.attributeLookup(m,r.attributes,t);return n.has(r)});e.forEachNode((r,x)=>{const D=new Set(x);for(const E of w){const F=c.attributeLookup(m,E.attributes,t);if(!D.has(F))continue;const M=x.indexOf(F);for(const K in E.attributes){var A=e.fieldsIndex.normalizeFieldName(K);var v=l;var B=r.index,C=v.get(B);C?v=C:(C=new f,v.set(B,C),v=C);(B=null!=A&&v.get(A))?A=B:(B=[],v.set(A,B),A=B);A.push({featureIndex:M,featureId:F,value:E.attributes[K]})}}});return l}function u(e){const h=new Map;
if(!e)return h;for(const z of e)null!=z.globalId&&null!=z.objectId&&null==z.error&&h.set(z.globalId,z.objectId);return h}function q(e,h=null){const z=new Set;if(!e)return z;for(const n of e)null==n.error&&(null!=n.objectId&&-1!==n.objectId?z.add(n.objectId):null!=n.globalId&&null!=h&&(e=h.get(n.globalId),null!=e&&z.add(e)));return z}const k={setAttribute(){},setGeometry(e){},rollback(){},commit(){}};var d;(function(e){e[e.EDITING=0]="EDITING";e[e.ROLLED_BACK=1]="ROLLED_BACK";e[e.COMMITTED=2]="COMMITTED"})(d||
(d={}));const f=Map,g=Map;a.createInteractiveEditSession=function(e,h){const z=h.attributes[e.objectIdField];var n=e.sessions.get(z);if(n)return n;const l=b.clone(h.attributes),m=new Set;if(null==z)return k;const t=e.i3sOverrides.createInteractiveEditSession(z),w=new Map;let r=d.EDITING;n={setAttribute(x,D){if(r===d.EDITING){var A=e.fieldsIndex.get(x);if(A){var v=e.attributeStorageInfo.findIndex(E=>E.name===A.name);if(!(0>v)){t.setAttribute(v,D);var B=e.attributeStorageInfo[v],C=!1;m.add(x);e.forEachNode((E,
F)=>{var M=w.get(E);null==M?(F=F.indexOf(z),w.set(E,F)):F=M;if(-1!==F&&(M=e.getAttributeData(E.index))){const K=M[B.name];K&&(K[F]=D,e.setAttributeData(E.index,M,h),C=!0)}});C&&e.clearMemCache()}}}},setGeometry(x){r===d.EDITING&&t.setGeometry(x)},rollback(){if(r===d.EDITING){for(const x of m)this.setAttribute(x,l[x]);t.rollback();r=d.ROLLED_BACK;e.sessions.delete(z)}},commit(){r===d.EDITING&&(t.commit(),r=d.COMMITTED,e.sessions.delete(z))}};e.sessions.set(z,n);return n};a.processAttributeEdits=function(e,
h){var z=p(e,h);h=y(e,h);if(0!==z.size||0!==h.size){var n=new Map;for(var l=0;l<e.attributeStorageInfo.length;l++)n.set(e.attributeStorageInfo[l].name,l);var m=!1;z.forEach((D,A)=>{const v=e.getAttributeData(A);let B=!1;D.forEach((C,E)=>{const F=null!=v?v[E]:null;E=n.get(E);for(const {featureIndex:M,value:K,featureId:G}of C)F&&(F[M]=K,m=B=!0),e.i3sOverrides.updateAttributeValue(G,E,K)});B&&e.setAttributeData(A,v,null)});m&&e.clearMemCache();var {fieldsIndex:t,i3sOverrides:w,objectIdField:r,globalIdField:x}=
e;z=w.layer.associatedLayer?.infoFor3D;z=new Set(z?[...Object.values(z.assetMapFieldRoles),...Object.values(z.transformFieldRoles)]:[]);for(const [D,A]of h){w.featureAdded(D);({attributes:h}=A);for(const v in h)v!==r&&v!==x&&z.has(v)||(l=t.normalizeFieldName(v),l=null!=l?n.get(l):null,null!=l&&w.updateAttributeValue(D,l,h[v]))}}};a.processGeometryEdits=function(e,h){const z=e.fieldsIndex,n=e.objectIdField;var l=e.globalIdField;if(null!=l){var m=new Map,t=u(h.addedFeatures),w=h.edits.addFeatures,r=
q(h.updatedFeatures),x=h.edits.updateFeatures;var D=h.edits?.deleteFeatures;var A=new Map;if(D)for(const v of D){let B=D=null;"attributes"in v?(D=c.attributeLookup(z,v.attributes,n),B=c.attributeLookup(z,v.attributes,l)):(D=v.objectId,B=v.globalId);null!=B&&null!=D&&A.set(B,D)}A=q(h.deletedFeatures,A);h=h.edits.deleteFeatures;if(null!=w&&0<w.length)for(const v of w)w=c.attributeLookup(z,v.attributes,l),w=t.get(w),null!=v.geometry&&"mesh"===v.geometry.type&&null!=w&&m.set(w,v.geometry);if(null!=x&&
0<x.length)for(const v of x)l=c.attributeLookup(z,v.attributes,n),null!=v.geometry&&"mesh"===v.geometry.type&&r.has(l)&&m.set(l,v.geometry);if(null!=h&&0<h.length)for(const v of h)r=null,r="attributes"in v?c.attributeLookup(z,v.attributes,n):v.objectId,null!=r&&A.has(r)&&m.set(r,null);for(const [v,B]of m)e.i3sOverrides.updateGeometry(v,B)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K){function G(V,X,Y){if(null==X)return null;if("disjoint"===Y&&"polygon"===X.type){Y=X.rings.length;const Z=X.spatialReference,ea=Array(Y);for(let ia=0;ia<Y;++ia){const oa=D.fromValues(Infinity,Infinity,-Infinity,-Infinity);D.expandWithNestedArray(oa,X.rings[ia]);ea[ia]={type:"polygon",rings:[X.rings[ia]],spatialReference:Z,cache:{},aabr:oa}}ea.sort((ia,oa)=>ia.aabr[0]-oa.aabr[0]);const ja=new Set,ha=new q.PositionHint;for(X=0;X<ea.length;++X){const ia=
ea[X],oa=ia.aabr[0];ja.forEach(ma=>{oa>=ma.aabr[2]?ja.delete(ma):ia.aabr[1]>ma.aabr[3]||ia.aabr[3]<ma.aabr[1]||!V.intersects(ia,ma)||(ia.rings=ia.rings.concat(ma.rings),D.expand(ia.aabr,ma.aabr,ia.aabr),ia.cache={},ja.delete(ma),ma=q.indexOf(ea,ma,ea.length,ha),ea.splice(ma,1))});ja.add(ia)}for(const ia of ea)ia.aabr=void 0;return ea}return[X]}function L(V,X,Y,Z,ea){if(X[3]>=.5*(X[2]+w.getReferenceEllipsoid(Z).radius))return!0;const ja=H(V,X,Z);return Y.every(ha=>J(V,ha,ja,ea)!==Q.DISCARD)}function O(V,
X,Y,Z,ea,ja,ha,ia){const oa=ha[0].spatialReference||ea.spatialReference;if(r.projectBoundingSphere(Y.node.mbs,ja,S,oa)){ja=H(V,S,oa);var ma=I(ia,ea,oa,Z,Y.objectHandle);for(const fa of ha){if(0===X.length)break;switch(J(V,fa,ja,ia)){case Q.DISCARD:X.length=0;return;case Q.KEEP:continue}M.filterInPlace(X,Y.featureIds,ba=>W(V,fa,ba,ma))}}else T.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function I(V,X,Y,Z,ea){X=X.renderSpatialReference;
const ja=new Map,ha={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:Y};ha.rings[0][3]=ha.rings[0][0];let ia,oa;switch(V){case "intersects":ia=(ma,fa,ba)=>ma.intersects(fa,ba)?Q.KEEP:Q.TEST;oa=N;break;case "contains":ia=(ma,fa,ba)=>ma.contains(fa,ba)?Q.TEST:Q.DISCARD;oa=N;break;default:ia=(ma,fa,ba)=>ma.disjoint(fa,ba)?Q.TEST:Q.DISCARD,oa=R}return{collection:Z,object:ea,type:V,maskSR:Y,renderSR:X,aabbCache:ja,triangle:ha,positions:{indices:null,data:null,stride:0,startIndex:0,
endIndex:0},triangleTest:ia,geometryTest:oa}}function H(V,X,Y){const Z={type:"point",x:X[0],y:X[1],hasZ:!1,hasM:!1,spatialReference:Y};Y=!B.isWGS84(Y)&&!B.isWebMercator(Y);X=Number.isNaN(X[3])?0:d.clamp(X[3],0,2*v.earth.radius);V=Y?V.buffer(Z,X,1):V.geodesicBuffer(Z,X,1);V.type="polygon";return V}function J(V,X,Y,Z){switch(Z){case "intersects":case "contains":return N(V,X,Y);case "disjoint":return R(V,X,Y)}}function N(V,X,Y){return V.intersects(X,Y)?V.contains(X,Y)?Q.KEEP:Q.TEST:Q.DISCARD}function R(V,
X,Y){return V.intersects(X,Y)?V.contains(X,Y)?Q.DISCARD:Q.TEST:Q.KEEP}function W(V,X,Y,Z){const {collection:ea,object:ja,renderSR:ha,maskSR:ia,geometryTest:oa,aabbCache:ma}=Z;var fa=ma.get(Y);if(!fa){fa=ea.getObjectTransform(ja);ea.getComponentAabb(ja,Y,U);var ba=[[U[0],U[1],0],[U[0],U[4],0],[U[3],U[4],0],[U[3],U[1],0]];for(var aa=0;4>aa;++aa)m.transformMat3(ba[aa],ba[aa],fa.rotationScale),m.add(ba[aa],ba[aa],fa.position),r.projectVectorToVector(ba[aa],ha,ba[aa],ia);fa={type:"polygon",rings:[ba],
spatialReference:ia,cache:{}};fa.rings[0][4]=fa.rings[0][0];ma.set(Y,fa)}switch(oa(V,X,fa)){case Q.DISCARD:return!1;case Q.KEEP:return!0}const {triangle:da,triangleTest:ca,positions:na}=Z;fa=da.rings[0][0];ba=da.rings[0][1];aa=da.rings[0][2];const qa=ea.getObjectTransform(ja);ea.getComponentPositions(ja,Y,na);const {indices:ua,data:sa,stride:pa,startIndex:ka,endIndex:ra}=na;for(Y=ka;Y<ra;Y+=3){const va=pa*ua[Y],Ca=pa*ua[Y+1],Ba=pa*ua[Y+2];m.set(fa,sa[va],sa[va+1],sa[va+2]);m.set(ba,sa[Ca],sa[Ca+1],
sa[Ca+2]);m.set(aa,sa[Ba],sa[Ba+1],sa[Ba+2]);m.transformMat3(fa,fa,qa.rotationScale);m.transformMat3(ba,ba,qa.rotationScale);m.transformMat3(aa,aa,qa.rotationScale);m.add(fa,fa,qa.position);m.add(ba,ba,qa.position);m.add(aa,aa,qa.position);r.projectVectorToVector(fa,ha,fa,ia);r.projectVectorToVector(ba,ha,ba,ia);r.projectVectorToVector(aa,ha,aa,ia);switch(ca(V,X,da)){case Q.DISCARD:return!1;case Q.KEEP:return!0}}switch(Z.type){case "intersects":return!1;default:return!0}}const T=k.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");
b.I3SMeshViewFilter=function(V){function X(Z){Z=V.call(this,Z)||this;Z._projectionEngineLoaded=!1;return Z}c._inherits(X,V);var Y=X.prototype;Y.initialize=function(){g.whenOnce(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule((new Promise((Z,ea)=>a(["../../../../geometry/geometryEngine"],Z,ea))).then(Z=>{this.destroyed||(this._geometryEngine=Z)})))};Y.addFilters=function(Z,ea,ja,ha){const ia=this.sortedObjectIds;null!=ia&&Z.push(ba=>M.objectIdFilter(ia,!0,ba));
this.addSqlFilter(Z,this.parsedWhereClause);const oa=f.unwrapUpdating(this._layerMaskGeometries),ma=this._geometryEngine;if(null!=oa&&null!=this.layerFilter&&null!=ma){const ba=this.layerFilter.spatialRelationship;Z.push((aa,da)=>O(ma,aa,da,ha,ea,ja,oa,ba))}const fa=f.unwrapUpdating(this._viewMaskGeometries);if(null!=fa&&null!=this.viewFilter&&null!=ma){const ba=this.viewFilter.spatialRelationship;Z.push((aa,da)=>O(ma,aa,da,ha,ea,ja,fa,ba))}};Y.isMBSGeometryVisible=function(Z,ea,ja){var ha=f.unwrapUpdating(this._layerMaskGeometries);
const ia=this._geometryEngine;if(null!=ha&&null!=this.layerFilter&&null!=ia){var oa=this.layerFilter.spatialRelationship;ea=ha[0].spatialReference||ea;return r.projectBoundingSphere(Z,ja,S,ea)?L(ia,S,ha,ea,oa):(T.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}ha=f.unwrapUpdating(this._viewMaskGeometries);return null!=ha&&null!=this.viewFilter&&null!=ia?(oa=this.viewFilter.spatialRelationship,ea=ha[0].spatialReference||ea,r.projectBoundingSphere(Z,
ja,S,ea)?L(ia,S,ha,ea,oa):(T.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0};X.checkSupport=function(Z){if(null==Z)return!1;if(Z.timeExtent)return T.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;Z=Z.spatialRelationship;return null!=Z&&P.includes(Z)?!0:(T.warn(`Filters with spatialRelationship other than ${P.join(", ")} are not supported for mesh scene layers`),!1)};c._createClass(X,[{key:"sortedObjectIds",
get:function(){if(null==this.viewFilter||null==this.viewFilter.objectIds)return null;const Z=A.doubleArrayFrom(this.viewFilter.objectIds);Z.sort();return Z}},{key:"parsedWhereClause",get:function(){const Z=null!=this.viewFilter?this.viewFilter.where:null;if(null==Z||!Z)return null;try{return t.WhereClause.create(Z,this.layerFieldsIndex)}catch(ea){T.error(`Failed to parse filter where clause: ${ea}`)}return null}},{key:"parsedGeometry",get:function(){const Z=f.unwrapUpdating(this._viewMaskGeometries),
ea=f.unwrapUpdating(this._layerMaskGeometries);return null==Z||null==ea?Z||ea:ea.concat(Z)}},{key:"_layerMaskGeometries",get:function(){const Z=this.layerFilter;return null==Z?null:null==this._geometryEngine?f.updating:"disjoint"===Z.spatialRelationship?Z.geometries.map(ea=>({type:"polygon",rings:ea.rings,spatialReference:ea.spatialReference,cache:{}})):[Z.geometries.reduce((ea,ja)=>{ea.rings=[...ea.rings,...ja.rings];return ea},{type:"polygon",rings:[],spatialReference:Z.geometries[0].spatialReference,
cache:{}})]}},{key:"_viewMaskGeometries",get:function(){if(null==this.viewFilter)return null;var {geometry:Z}=this.viewFilter;if(null==Z)return null;if(null==this.viewFilter||null==this._geometryEngine)return f.updating;const {distance:ea,units:ja}=this.viewFilter,ha=this.viewFilter.spatialRelationship;Z="mesh"===Z.type?Z.extent:Z;if(null==ea||0===ea)return G(this._geometryEngine,Z,ha);const ia=ja||e.getUnitString(Z.spatialReference);if(Z.spatialReference.isWGS84)return Z=this._geometryEngine.geodesicBuffer(Z,
ea,ia),G(this._geometryEngine,Z,ha);var oa=E.project(Z,K.WGS84);if(null!=oa)return Z=E.project(this._geometryEngine.geodesicBuffer(oa,ea,ia),Z.spatialReference),G(this._geometryEngine,Z,ha);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(r.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;oa=null;try{oa=r.project(Z,K.WGS84)}catch(ma){}if(oa)try{oa=r.project(this._geometryEngine.geodesicBuffer(oa,ea,ia),Z.spatialReference)}catch(ma){oa=null}oa||T.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${Z.spatialReference.wkid}) to WGS84.`);
return G(this._geometryEngine,oa,ha)}},{key:"updating",get:function(){return f.isUpdating(this._layerMaskGeometries)||f.isUpdating(this._viewMaskGeometries)}}]);return X}(u);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);y.__decorate([h.property({type:F})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",
void 0);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);y.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);y.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);y.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);y.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);y.__decorate([h.property({readOnly:!0})],
b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"updating",null);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);y.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=y.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const P=["contains","intersects","disjoint"];var Q;(function(V){V[V.KEEP=0]="KEEP";
V[V.DISCARD=1]="DISCARD";V[V.TEST=2]="TEST"})(Q||(Q={}));const S=C.fromValues(0,0,0,0),U=x.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m){const t=n.QueryEngine;a.I3SQueryEngine=function(w){function r(D){D=w.call(this,D)||this;D._handles=new u;return D}b._inherits(r,w);var x=r.prototype;x.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};x.destroy=function(){this._dataQueryEngineInstance=q.destroyMaybe(this._dataQueryEngineInstance);this._handles=q.destroyMaybe(this._handles);this._set("layerView",null)};x.executeQueryForCount=
async function(D,A){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(D),A)};x.executeQueryForExtent=async function(D,A){const {count:v,extent:B}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(D),A);D=h.fromJSON(B);return{count:v,extent:D}};x.executeQueryForIds=async function(D,A){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(D),A)};x.executeQuery=async function(D,A){D=this._ensureQueryJSON(D);if(D.returnGeometry)throw new p("feature-store:unsupported-query",
"returnGeometry is not yet supported for mesh scene layer queries");if(D.returnCentroid)throw new p("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");A=await this._dataQueryEngine.executeQuery(D,A);A=l.fromJSON(A);A.features.forEach(v=>{v.geometry=null});return A};x._ensureQueryJSON=function(D){return null==D?this.defaultQueryJSON:D.toJSON()};x._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const D=this.layer.objectIdField||z.fallbackObjectIDAttribute,A=this.layer.fields?.map(C=>C.toJSON())??[],v=this.layerView.view.resourceController.scheduler,B=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new t({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:A,timeInfo:null,spatialReference:B,objectIdField:D,featureStore:this.spatialIndex,scheduler:v,priority:this.priority})};b._createClass(r,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},
{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",get:function(){return(new m({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return r}(y);c.__decorate([k.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);c.__decorate([k.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);c.__decorate([k.property({constructOnly:!0})],a.I3SQueryEngine.prototype,
"spatialIndex",void 0);c.__decorate([k.property()],a.I3SQueryEngine.prototype,"spatialReference",null);c.__decorate([k.property()],a.I3SQueryEngine.prototype,"layer",null);c.__decorate([k.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=c.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,b,c,y,p,u){let q=function(){function d(g){this._objectIdField=g.objectIdField;this._getFeatureExtent=g.getFeatureExtent}var f=d.prototype;f.getObjectId=function(g){return g.id};f.getAttributes=function(g){const {meta:e,index:h}=g,z={};this._objectIdField&&(z[this._objectIdField]=g.id);g=e.attributeInfo?.attributeData;if(null!=g)for(const n of Object.keys(g))z[n]=u.getCachedAttributeValue(g[n],h);return z};f.getAttribute=function(g,e){if(e===this._objectIdField)return g.id;const {meta:h,
index:z}=g;g=h.attributeInfo?.attributeData;return null!=g?u.getCachedAttributeValue(g[e],z):null};f.getGeometry=function(g){if(g.geometry)return g.geometry;const [e,h,z,n,l]=this._getFeatureExtent(g,k);return new p([5],[e,h,z,n,h,z,n,l,z,e,l,z,e,h,z])};f.getCentroid=function(g,e){if(g.geometry)return y.getCentroidOptimizedGeometry(new p,g.geometry,e.hasZ,e.hasM);const [h,z,n,l,m,t]=this._getFeatureExtent(g,k);return new p([0],[(h+l)/2,(z+m)/2,(n+t)/2])};f.cloneWithGeometry=function(g,e){const {id:h,
index:z,meta:n}=g;return{id:h,index:z,meta:n,geometry:e}};return b._createClass(d)}();const k=c.create();a.I3SQueryFeatureAdapter=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l=e.create();a.I3SQueryFeatureStore=function(r){function x(A){A=r.call(this,A)||this;A.events=new p;return A}b._inherits(x,r);var D=x.prototype;D.forEach=function(A){this.forAllFeatures(v=>{A(v);return n.ForAllFeaturesReturnType.CONTINUE})};D.forEachBounds=function(A,v){const B=this.getFeatureExtent;for(const C of A)v(B(C,l))};D.forEachInBounds=function(A,v){this.forAllFeatures(B=>{const C=this.getFeatureExtent(B,t);h.intersects(A,e.toRect(C,w))&&v(B);
return n.ForAllFeaturesReturnType.CONTINUE},B=>{g.projectBoundingSphere(B.node.mbs,this.sourceSpatialReference,m,this.viewSpatialReference);if(m[0]>=A[0]&&m[2]<=A[2]&&m[1]>=A[1]&&m[3]<=A[3])return n.ForAllFeaturesReturnType.CONTINUE;B=m[0]-Math.max(A[0],Math.min(m[0],A[2]));const C=m[1]-Math.max(A[1],Math.min(m[1],A[3]));return B*B+C*C<=m[3]*m[3]?n.ForAllFeaturesReturnType.CONTINUE:n.ForAllFeaturesReturnType.SKIP})};return b._createClass(x)}(y);c.__decorate([u.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,
"featureAdapter",void 0);c.__decorate([u.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);c.__decorate([u.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);c.__decorate([u.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);c.__decorate([u.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=c.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],
a.I3SQueryFeatureStore);const m=z.fromValues(0,0,0,0),t=e.create(),w=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g){a.DefinitionExpressionSceneLayerView=e=>{e=function(h){function z(){var l=h.apply(this,arguments)||this;l._definitionExpressionErrors=0;l._maxDefinitionExpressionErrors=20;l.logError=m=>{l._definitionExpressionErrors<l._maxDefinitionExpressionErrors&&y.getLogger(b._assertThisInitialized(l)).error("Error while evaluating definitionExpression: "+m);l._definitionExpressionErrors++;l._definitionExpressionErrors===l._maxDefinitionExpressionErrors&&y.getLogger(b._assertThisInitialized(l)).error("Further errors are ignored")};
return l}b._inherits(z,h);var n=z.prototype;n._evaluateClause=function(l,m){try{return l.testFeature(m)}catch(t){return this.logError(t),!1}};n._addDefinitionExpressionToQuery=function(l){if(!this.parsedDefinitionExpression)return l;const m=this.i3slayer.definitionExpression;l=l.clone();l.where=l.where?`(${m}) AND (${l.where})`:m;return l};b._createClass(z,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const l=f.WhereClause.create(this.i3slayer.definitionExpression,
this.i3slayer.fieldsIndex);if(!l.isStandardized)return y.getLogger(this).error("definitionExpression is using non standard function"),null;const m=[];g.findFieldsCaseInsensitive(l.fieldNames,this.i3slayer.fields,{missingFields:m});if(0<m.length)return y.getLogger(this).error(`definitionExpression references unknown fields: ${m.join(", ")}`),null;this._definitionExpressionErrors=0;return l}catch(l){return y.getLogger(this).error("Failed to parse definitionExpression: "+l),null}}},{key:"definitionExpressionFields",
get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}}]);return z}(e);c.__decorate([p.property()],e.prototype,"i3slayer",void 0);c.__decorate([p.property({readOnly:!0})],e.prototype,"parsedDefinitionExpression",null);c.__decorate([p.property({readOnly:!0})],e.prototype,"definitionExpressionFields",null);return e=c.__decorate([d.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],e)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:c,layer:{fieldsIndex:y},requiredFields:p}=this;return c.outFields?b.fixFields(y,[...b.unpackFieldNames(y,c.outFields),...p]):b.fixFields(y,p)}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),function(a,
b,c,y,p,u,q,k,d,f,g,e){async function h(z){const n=new Set;try{return await z(n),Array.from(n).sort()}catch(l){return u.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(l),null}}a.SceneLayerViewRequiredFields=function(z){function n(l){return z.call(this,l)||this}b._inherits(n,z);n.prototype.initialize=function(){this.handles.add([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:l,renderer:m}=this.layer;return m?h(t=>m.collectRequiredFields(t,l)):null}),
this.autoUpdateAsync("labelingFields",async()=>{const {layer:l}=this;return l.labelsVisible?h(m=>e.collectLabelingFields(m,l)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:l,filter:m}=this.layerView;return h(t=>e.collectFilterFields(t,l,m))})])};b._createClass(n,[{key:"layer",get:function(){return this.layerView.layer}},{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:l},definitionExpressionFields:m},rendererFields:t,labelingFields:w,viewFilterFields:r}=
this;return e.fixFields(l,[...(m??[]),...(t??[]),...(w??[]),...(r??[])])}}]);return n}(y.AsyncUpdateMixin(p.HandleOwner));c.__decorate([q.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);c.__decorate([q.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);c.__decorate([q.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);c.__decorate([q.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);c.__decorate([q.property()],
a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);c.__decorate([q.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=c.__decorate([g.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,b,c,y,p,u,q,k,d){function f(h,z){const n=()=>{if(!l||m)return z();l.clear();m=!0;const t=u.runTracked(l,z);m=!1;return t};let l=new d.SimpleTrackingTarget(()=>{l&&!m&&h(n)}),m=!1;h(n);return{remove:()=>{l&&(l.destroy(),l=null)}}}const g=h=>{h=function(z){function n(){var m=z.apply(this,arguments)||this;m._numUpdating=0;m._asyncUpdateState=new Map;return m}b._inherits(n,z);var l=n.prototype;l.autoUpdateAsync=function(m,t){return f(w=>this._updateAsync(m,w),t)};l._updateAsync=async function(m,
t){if(!this._startAsyncUpdate(m)){try{const w=await t();this._set(m,w)}catch(w){p.getLogger(this).warn(`Async update of "${String(m)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(m)&&this._updateAsync(m,t)}};l._startAsyncUpdate=function(m){const t=this._asyncUpdateState.get(m)??e.None;if(t&e.Updating)return this._asyncUpdateState.set(m,t|e.Invalidated),!0;++this._numUpdating;this._asyncUpdateState.set(m,t|e.Updating);return!1};l._endAsyncUpdate=function(m){--this._numUpdating;
const t=(this._asyncUpdateState.get(m)??e.None)&~e.Updating;if(t&e.Invalidated)return this._asyncUpdateState.set(m,t&~e.Invalidated),!0;this._asyncUpdateState.set(m,t);return!1};b._createClass(n,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return n}(h);c.__decorate([q.property({readOnly:!0})],h.prototype,"updating",null);c.__decorate([q.property()],h.prototype,"_numUpdating",void 0);return h=c.__decorate([k.subclass("esri.core.AsyncUpdate")],h)};var e;(function(h){h[h.None=0]="None";
h[h.Updating=1]="Updating";h[h.Invalidated=2]="Invalidated"})(e||(e={}));a.AsyncUpdate=function(h){function z(){return h.apply(this,arguments)||this}b._inherits(z,h);return b._createClass(z)}(g(y));a.AsyncUpdate=c.__decorate([k.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n){const l=p.getLogger("esri.views.layers.SceneLayerView");p=function(m){function t(){var r=m.apply(this,arguments)||this;r.layer=null;r.filter=null;r._geometryEngine=null;r._projectionEngineLoaded=!1;r._abortController=new AbortController;return r}b._inherits(t,m);var w=t.prototype;w.initialize=function(){const {signal:r}=this._abortController;d.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,r).then(async()=>{k.throwIfAbortError(r);
this._geometryEngine=await new Promise((x,D)=>a(["../../geometry/geometryEngine"],x,D))}).catch(k.throwIfNotAbortError);this._projectionEngineLoaded=z.isLoaded();d.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,r).then(async()=>{k.throwIfAbortError(r);await z.load();this._projectionEngineLoaded=!0}).catch(k.throwIfNotAbortError)};w.destroy=function(){this._abortController=u.abortMaybe(this._abortController)};w.highlight=function(r){throw Error("Not implemented");
};w.queryFeatures=function(r,x){throw Error("Not implemented");};w.queryObjectIds=function(r,x){throw Error("Not implemented");};w.queryFeatureCount=function(r,x){throw Error("Not implemented");};w.createQuery=function(){throw Error("Not implemented");};w.queryExtent=function(r,x){throw Error("Not implemented");};b._createClass(t,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(r){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",
get:function(){return!1}},{key:"layerFilter",get:function(){return q.unwrapUpdating(this._layerFilter)}},{key:"_layerFilter",get:function(){const r=this.layer.filter;if(null==r||1>r.geometries.length)return null;const x=this._geometryEngine;if(null==x||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return q.updating;const D=r.geometries.at(0).spatialReference,A=r.geometries.toArray().map(E=>{try{E=x.simplify(E)}catch(F){return l.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),
null}if(null==E)return null;if(E.spatialReference.equals(D))return E;try{return z.project(E,D)}catch(F){return l.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}}).filter(y.isSome).sort((E,F)=>E.extent.xmin-F.extent.xmin),v=new Set,B=[],C=[];for(let E of A){const F=E.extent.xmin;B.length=0;v.forEach(M=>{F>=M.extent.xmax?(C.push(M),v.delete(M)):E.extent.ymin<=M.extent.ymax&&E.extent.ymax>=M.extent.ymin&&x.intersects(E,M)&&B.push(M)});if(0<B.length){B.push(E);
try{E=x.union(B)}catch(M){l.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}B.pop();B.forEach(M=>v.delete(M))}v.add(E)}v.forEach(E=>C.push(E));return 0<C.length?{spatialRelationship:r.spatialRelationship,geometries:C}:null}},{key:"_filterNeedsProjectionEngine",get:function(){const r=this.layer.filter;if(null==r||1>=r.geometries.length)return!1;const x=r.geometries.at(0).spatialReference;return r.geometries.some(({spatialReference:D})=>!D.equals(x)&&!z.canProjectWithoutEngine(D,
x))}},{key:"layerFilterUpdating",get:function(){return q.isUpdating(this._layerFilter)}}]);return t}(n);c.__decorate([f.property()],p.prototype,"layer",void 0);c.__decorate([f.property()],p.prototype,"availableFields",null);c.__decorate([f.property()],p.prototype,"maximumNumberOfFeatures",null);c.__decorate([f.property({readOnly:!0})],p.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([f.property()],p.prototype,"filter",void 0);c.__decorate([f.property({readOnly:!0})],p.prototype,"layerFilter",
null);c.__decorate([f.property({readOnly:!0})],p.prototype,"_layerFilter",null);c.__decorate([f.property()],p.prototype,"_geometryEngine",void 0);c.__decorate([f.property()],p.prototype,"_projectionEngineLoaded",void 0);c.__decorate([f.property()],p.prototype,"_filterNeedsProjectionEngine",null);c.__decorate([f.property()],p.prototype,"layerFilterUpdating",null);return p=c.__decorate([h.subclass("esri.views.layers.SceneLayerView")],p)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ../../../support/basemapUtils ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/featureEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V){function X(ia){return"geometryBuffer"in ia&&null!==ia.geometryBuffer}function Y(ia){const oa=ia.attributeInfo,ma=ia.node.index;if(null!=oa&&null!=oa.loadedAttributes&&null!=oa.attributeData)for(let fa=0;fa<ia.graphics.length;fa++){const ba=ia.graphics[fa];if(ba.nodeIndex===ma){ba.attributes||(ba.attributes={});for(const {name:aa}of oa.loadedAttributes)oa.attributeData[aa]&&(ba.attributes[aa]=O.getCachedAttributeValue(oa.attributeData[aa],
fa))}}}g=H.defineFieldProperties();let Z=b._createClass(function(ia,oa,ma,fa){this.graphics=ia;this.featureIds=oa;this.attributeInfo=ma;this.node=fa});E=function(ia){function oa(){var fa=ia.apply(this,arguments)||this;fa.type="scene-layer-graphics-3d";fa._queryEngine=null;fa._memCache=null;fa._interactiveEditingSessions=new Map;fa.loadedGraphics=new G.I3SGraphicsMap((ba,aa,da)=>{{const ca=aa.attributeInfo;if(null==ca||null==ca.loadedAttributes||null==ca.attributeData)ba=!1;else{aa=!1;for(const {name:na}of ca.loadedAttributes)if(ca.attributeData[na]){const qa=
O.getCachedAttributeValue(ca.attributeData[na],da);qa!==ba.attributes[na]&&(ba.attributes[na]=qa,aa=!0)}ba=aa}}return ba},ba=>fa.processor.graphicsCore.recreateGraphics(ba));fa.holeFilling="always";fa.progressiveLoadFactor=1;fa.supportsHeightUnitConversion=!0;fa._coordinatesOutsideExtentErrors=0;fa._maxCoordinatesOutsideExtentErrors=20;return fa}b._inherits(oa,ia);var ma=oa.prototype;ma.tryRecycleWith=function(fa,ba){return fa.url===this.layer.url&&this._i3sOverrides.isEmpty?fa.load(ba).then(()=>
{O.checkRecyclable(this.layer,fa,this._i3sOverrides);this.layer=fa;this._i3sOverrides.destroy();this._i3sOverrides=new L.I3SOverrides({view:this.view,layer:fa,memoryController:this.view.resourceController?.memoryController});q.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null};ma.initialize=function(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new L.I3SOverrides({view:this.view,layer:this.layer,memoryController:this.view.resourceController?.memoryController});
O.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new N.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,fa=>this._rangeInfosChanged(fa),k.initial);this.updatingHandles.add(()=>this.layer.renderer,(fa,ba)=>this._rendererChange(fa,ba));this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange());this.handles.add(k.watch(()=>R.I3S_TREE_SHOW_TILES,
fa=>{if(fa&&!this._treeDebugger){const ba=this._controller.crsIndex;(new Promise((aa,da)=>a(["./support/I3STreeDebugger"],aa,da))).then(({I3STreeDebugger:aa})=>{!this._treeDebugger&&R.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new aa({lv:this,view:this.view,nodeSR:ba}))})}else fa||!this._treeDebugger||R.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},k.initial));this._set("processor",new F({owner:this,preferredUpdatePolicy:Q.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,
filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:fa=>this._updateClippingExtent(fa)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",fa=>this._controller.updateElevationChanged(fa.extent,fa.spatialReference));this.supportsHeightUnitConversion&&(this._verticalScale=t.getGeometryZScaler("point",this.layer.spatialReference,
this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`);this._controller=new D({layerView:this,scaleVisibilityEnabled:!1});O.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new C.I3SPointsWorkerHandle(fa=>this.view.resourceController.immediate.schedule(fa)));this.handles.add(this.layer.on("apply-edits",fa=>this.updatingHandles.addPromise(fa.result)));this.handles.add(this.layer.on("edits",
fa=>this._handleEdits(fa)));this.when(()=>{this._setupQueryEngine();this.updatingHandles.add(()=>this.maximumNumberOfFeatures,fa=>this._controller.featureTarget=fa,k.initial);this.updatingHandles.add(()=>this.suspended,fa=>{fa&&this._removeAllNodeData()})})};ma.destroy=function(){this._treeDebugger=q.destroyMaybe(this._treeDebugger);this._i3sOverrides=q.destroyMaybe(this._i3sOverrides);this._set("processor",q.destroyMaybe(this.processor));this._controller=q.destroyMaybe(this._controller);this._queryEngine=
q.destroyMaybe(this._queryEngine);this._worker=q.destroyMaybe(this._worker);this._memCache=q.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=q.destroyMaybe(this._fieldsHelper)};ma.whenGraphicAttributes=async function(fa,ba){return O.whenGraphicAttributes(this.layer,fa,this._getObjectIdField(),ba,()=>[...this.loadedGraphics.nodes()])};ma.getHit=function(fa){if(!this.loadedGraphics)return null;const ba=x.hydrateGraphic(this.loadedGraphics.find(da=>da.uid===fa),this.layer),
aa=this._getObjectIdField();if(!ba||!ba.attributes||!ba.attributes[aa])return null;ba.layer=this.layer;ba.sourceLayer=this.layer;return{type:"graphic",graphic:ba,layer:ba.layer}};ma.whenGraphicBounds=function(fa,ba){return this.processor.whenGraphicBounds(fa,ba)};ma.computeAttachmentOrigin=function(fa,ba){return this.processor.computeAttachmentOrigin(fa,ba)};ma.isUpdating=function(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)};
ma.highlight=function(fa){return this.processor.highlight(fa,this.layer.objectIdField)};ma.createInteractiveEditSession=function(fa){return K.createInteractiveEditSession(this._attributeEditingContext,fa)};ma._decompressBinaryPointData=async function(fa,ba){fa={geometryBuffer:fa.geometryBuffer};null==this._worker&&(this._worker=new C.I3SPointsWorkerHandle(aa=>this.view.resourceController.immediate.schedule(aa)));ba=await this._worker.invoke(fa,ba);if(null==ba)throw Error("Failed to decompress Draco point data");
return{positionData:ba.positions,featureIds:ba.featureIds}};ma.addNode=async function(fa,ba,aa){if(!(X(ba)||"pointData"in ba))throw Error();if(this.loadedGraphics.hasNode(fa.index))u.getLogger(this).error("I3S node "+fa.id+" already added");else{if(null!=this.layer.fullExtent){var da=this.layer.fullExtent.clone();da.xmin-=.5;da.ymin-=.5;da.xmax+=.5;da.ymax+=.5;null!=da.zmin&&null!=da.zmax&&(da.zmin-=.5,da.zmax+=.5);null!=da.mmin&&null!=da.mmax&&(da.mmin-=.5,da.mmax+=.5)}else da=null;var ca=da;da=
[];var {featureIds:na,pointPositions:qa}=X(ba)?await this._extractBinaryPointPositions(fa,ba,aa):this._extractLegacyPointPositions(ba);this._validatePositions(fa,na,qa,ca,da);var ua=this._controller.crsVertex;n.projectBuffer(qa,ua,0,qa,this.view.spatialReference,0,na.length);ca=X(ba)?fa.level:0;ca=this._createGraphics(na,qa,fa.index,ca);ca=new Z(ca,na,ba.attributeDataInfo,fa);await this._i3sOverrides.applyAttributeOverrides(ca.featureIds,ba.attributeDataInfo,aa);fa.numFeatures=ca.graphics.length;
this._updateNodeMemory(fa);Y(ca);0<da.length&&(this._computeObb(fa,da,ua),this._controller.updateVisibility(fa.index));if(this._controller.isGeometryVisible(fa)){if(null!=this._verticalScale)for(var sa of ca.graphics)this._verticalScale(sa.geometry);ba=this.view._stage.renderView.objectAndLayerIdRenderHelper;if(null!=ba)for(aa=B.isBasemapLayer(this.view.map,this.layer.uid),sa=0;sa<ca.featureIds.length;sa++)ba.setUidToObjectAndLayerId(ca.featureIds[sa],ca.graphics[sa].uid,this.layer.id,this.layer.uid,
this.layer.popupEnabled&&!aa&&U.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled),ca.node.resources.attributes,sa);this.loadedGraphics.addNode(fa.index,ca);this._controller.updateLoadStatus(fa.index,!0);this._filterNode(ca);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(ca)}};ma._computeObb=function(fa,ba,aa){const da=this._controller.crsIndex,ca=da.isGeographic?this.view.renderSpatialReference:da;n.projectBuffer(ba,aa,0,ba,ca,0,ba.length/3);fa.serviceObb=
W.compute(new P.Attribute(ba,3));da.isGeographic&&n.projectVectorToVector(fa.serviceObb.center,ca,fa.serviceObb.center,da)};ma.isNodeLoaded=function(fa){return this.loadedGraphics.hasNode(fa)};ma.isNodeReloading=function(){return!1};ma.updateNodeState=function(){};ma._extractBinaryPointPositions=async function(fa,ba,aa){ba=await this._decompressBinaryPointData(ba,aa);aa=ba.positionData;const da=aa.length/3,ca=m.newDoubleArray(3*da);fa=null!=fa.serviceObb?fa.serviceObb.center:[0,0,0];const na=Math.abs(fa[2])*
2**-20;for(let qa=0;qa<da;qa++){const ua=3*qa;ca[ua]=aa[ua]+fa[0];ca[ua+1]=aa[ua+1]+fa[1];ca[ua+2]=aa[ua+2]+fa[2];Math.abs(ca[ua+2])<na&&(ca[ua+2]=0)}return{featureIds:ba.featureIds?m.doubleArrayFrom(ba.featureIds):[],pointPositions:ca}};ma._extractLegacyPointPositions=function(fa){const ba=fa.pointData.length,aa=m.newDoubleArray(3*ba),da=[];for(let qa=0;qa<ba;qa++){var ca=fa.pointData[qa];const ua=ca.featureDataPosition,sa=ua.length;var na=ca.geometries?.[0]??ea[sa];ca=ca.featureIds[0];if("Embedded"!==
na.type||"points"!==na.params.type||2>sa||3<sa)continue;na=na.params.vertexAttributes?.position??[0,0,0];const pa=3*da.length;aa[pa]=ua[0]+na[0];aa[pa+1]=ua[1]+na[1];aa[pa+2]=3===sa?ua[2]+na[2]:NaN;da.push(ca)}return{featureIds:da,pointPositions:aa}};ma._validatePositions=function(fa,ba,aa,da,ca){if(null!=da||!fa.serviceObb){ba=ba.length;for(let qa=0;qa<ba;qa++){var na=3*qa;h.set(ja,aa[na],aa[na+1],aa[na+2]);na=!Number.isNaN(aa[2]);null==da||(na?l.extentContainsCoords3D(da,ja):l.extentContainsCoords2D(da,
ja))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&u.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&u.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);fa.serviceObb||ca.push(ja[0],ja[1],ja[2])}}};ma._createGraphics=function(fa,ba,aa,da){const ca=fa.length,na=this._getObjectIdField(),
qa=this.processor.graphicsCore,ua=[],sa=this.view.spatialReference;for(let va=0;va<ca;va++){var pa=fa[va];const Ca={};null!=pa&&(Ca[na]=pa);pa=null==pa?y.generateUID():pa;var ka=3*va,ra=isNaN(ba[ka+2])?void 0:ba[ka+2];ka=r.makeDehydratedPoint(ba[ka],ba[ka+1],ra,sa);ra=this.loadedGraphics.get(pa);if(null!=ra){if(null==ra.level||ra.level<da)ha.property="geometry",ha.graphic=ra,ha.oldValue=ra.geometry,ha.newValue=ka,ra.geometry=ka,ra.level=da,qa.graphicUpdateHandler(ha);ua.push(ra)}else ra=y.generateUID(),
ua.push({objectId:pa,uid:ra,geometry:ka,attributes:Ca,visible:!0,nodeIndex:aa,level:da})}return ua};ma._updateNodeMemory=function(fa){fa.memory=4096+(null!=fa.numFeatures?fa.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};ma._cacheNodeData=function(fa){const ba=fa.graphics.reduce((aa,da)=>r.estimateSize(da)+aa,d.estimateSize(fa.featureIds)+1024);this._memCache.put(this._getMemCacheKey(fa.node),fa,ba)};ma._getMemCacheKey=function(fa){return`${fa.index}`};ma._removeAllNodeData=function(){this.loadedGraphics.forEachNode((fa,
ba)=>{fa&&(this._updateNodeMemory(fa.node),this._cacheNodeData(fa));this._controller.updateLoadStatus(ba,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};ma.removeNode=function(fa){if(fa=this._removeNodeStageData(fa))this._updateNodeMemory(fa.node),this._cacheNodeData(fa)};ma._removeNodeStageData=function(fa){const ba=this.loadedGraphics.getNode(fa);if(null==ba)return null;this._controller.updateLoadStatus(fa,!1);this.loadedGraphics.removeNode(fa);this._treeDebugger&&
this._treeDebugger.update();return ba};ma.loadCachedNodeData=async function(fa){return this._memCache?.pop(this._getMemCacheKey(fa))};ma.addCachedNodeData=async function(fa,ba,aa,da){this.loadedGraphics.hasNode(fa.index)?u.getLogger(this).error("I3S node "+fa.id+" already added"):(await this._i3sOverrides.applyAttributeOverrides(ba.featureIds,aa,da),this.loadedGraphics.addNode(fa.index,ba),this._controller.updateLoadStatus(fa.index,!0),this._updateNodeMemory(fa),ba.attributeInfo=aa,this._attributeValuesChanged(ba),
this._filterNode(ba),this._treeDebugger&&this._treeDebugger.update())};ma.getLoadedNodeIds=function(){const fa=[];this.loadedGraphics.forEachNode(ba=>fa.push(ba.node.id));return fa.sort()};ma.getVisibleNodes=function(){const fa=[];this.loadedGraphics.forEachNode(ba=>fa.push(ba.node));return fa};ma.getLoadedNodeIndices=function(fa){this.loadedGraphics.forEachNode((ba,aa)=>fa.push(aa))};ma.getLoadedAttributes=function(fa){fa=this.loadedGraphics.getNode(fa);if(null!=fa&&null!=fa.attributeInfo)return fa.attributeInfo.loadedAttributes};
ma.getAttributeData=function(fa){fa=this.loadedGraphics.getNode(fa);if(null!=fa&&null!=fa.attributeInfo)return fa.attributeInfo.attributeData};ma._setAttributeData=function(fa,ba){fa=this.loadedGraphics.getNode(fa);null!=fa&&null!=fa.attributeInfo&&(fa.attributeInfo.attributeData=ba,this._attributeValuesChanged(fa))};ma.updateAttributes=async function(fa,ba,aa){fa=this.loadedGraphics.getNode(fa);null!=fa&&(await this._i3sOverrides.applyAttributeOverrides(fa.featureIds,ba,aa),fa.attributeInfo=ba,this._attributeValuesChanged(fa))};
ma._attributeValuesChanged=function(fa){Y(fa);this._filterNode(fa);this.processor.graphicsCore.labelsEnabled&&(fa=fa.graphics.map(ba=>ba.uid),this.processor.graphicsCore.updateLabelingInfo(fa))};ma._updateClippingExtent=function(fa){this._controller&&this._controller.updateClippingArea(fa);return!1};ma._getObjectIdField=function(){return this.layer.objectIdField||w.fallbackObjectIDAttribute};ma._getGlobalIdField=function(){return this.layer.associatedLayer?.globalIdField};ma._rendererChange=async function(fa,
ba){const {layer:{fieldsIndex:aa}}=this,da=new Set;let ca;fa?(await fa.collectRequiredFields(da,aa),ca=Array.from(da).sort()):ca=[];da.clear();let na;ba?(await ba.collectRequiredFields(da,aa),na=Array.from(da).sort()):na=[];ca.length===na.length&&ca.every((qa,ua)=>ca[ua]===na[ua])||this._reloadAllNodes()};ma._rangeInfosChanged=function(fa){null!=fa&&0<fa.length&&u.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
ma._filterChange=function(){this.loadedGraphics.forEachNode(fa=>this._filterNode(fa))};ma._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};ma._filterNode=function(fa){const ba=this.parsedDefinitionExpression,aa=this._excludeObjectIdsSorted,da=this._getObjectIdField();for(const ca of fa.graphics){fa=ca.visible;const na=!ba||this._evaluateClause(ba,ca),qa=null==aa||0>p.binaryIndexOf(aa,ca.attributes[da]);ca.visible=na&&qa;fa!==ca.visible&&
(ha.graphic=ca,ha.property="visible",ha.oldValue=fa,ha.newValue=ca.visible,this.processor.graphicsCore.graphicUpdateHandler(ha))}};ma.createQuery=function(){const fa={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(fa):new v(fa)};ma.queryFeatures=function(fa,ba){return this._queryEngine.executeQuery(this._ensureQuery(fa),ba?.signal)};ma.queryObjectIds=function(fa,ba){return this._queryEngine.executeQueryForIds(this._ensureQuery(fa),
ba?.signal)};ma.queryFeatureCount=function(fa,ba){return this._queryEngine.executeQueryForCount(this._ensureQuery(fa),ba?.signal)};ma.queryExtent=function(fa,ba){return this._queryEngine.executeQueryForExtent(this._ensureQuery(fa),ba?.signal)};ma._ensureQuery=function(fa){return this._addDefinitionExpressionToQuery(null==fa?this.createQuery():v.from(fa))};ma._setupQueryEngine=function(){const fa=()=>this.processor.featureStore;this._queryEngine=new M.QueryEngine({context:{spatialReference:this.view.spatialReference,
layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return fa()},hasZ:this.hasZ,hasM:this.hasM},priority:V.TaskPriority.FEATURE_QUERY_ENGINE})};ma._handleEdits=function(fa){K.processAttributeEdits(this._attributeEditingContext,fa)};b._createClass(oa,[{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??1}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??
[]}},{key:"maximumNumberOfFeatures",get:function(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0},set:function(fa){null!=fa?(this._override("maximumNumberOfFeatures",fa),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",
get:function(){const fa=this.layer.excludeObjectIds;return fa.length?fa.toArray().sort((ba,aa)=>ba-aa):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"contentVisible",get:function(){return!this.suspended&&!!this._controller?.rootNodeVisible}},{key:"legendEnabled",get:function(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}},
{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this.processor?.graphicsCore?.usedMemory??0}},{key:"unloadedMemory",get:function(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}},{key:"ignoresMemoryFactor",get:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_attributeEditingContext",get:function(){const fa=this._getObjectIdField(),
ba=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:fa,globalIdField:ba,forEachNode:aa=>this.loadedGraphics.forEachNode(da=>aa(da.node,da.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:aa=>this.getAttributeData(aa),setAttributeData:(aa,da,ca)=>{this._setAttributeData(aa,da);aa=this.loadedGraphics.getNode(aa);null!=ca?(ca=this.loadedGraphics.get(ca.attributes[fa]),
null!=ca&&this.processor.graphicsCore.recreateGraphics([ca])):null!=aa&&this.processor.graphicsCore.recreateGraphics(aa.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const fa={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.loadedGraphics.nodeCount,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(fa);return fa}},{key:"test",get:function(){return{controller:this._controller,
numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}}]);return oa}(I.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(E.LayerView3D(S))));c.__decorate([f.property()],E.prototype,"processor",void 0);c.__decorate([f.property({type:A})],E.prototype,"filter",void 0);c.__decorate([f.property()],E.prototype,"loadedGraphics",void 0);c.__decorate([f.property()],E.prototype,"i3slayer",null);c.__decorate([f.property()],E.prototype,"_controller",void 0);c.__decorate([f.property()],
E.prototype,"updating",void 0);c.__decorate([f.property()],E.prototype,"suspended",void 0);c.__decorate([f.property()],E.prototype,"holeFilling",void 0);c.__decorate([f.property(T.updatingProgress)],E.prototype,"updatingProgress",void 0);c.__decorate([f.property()],E.prototype,"updatingProgressValue",null);c.__decorate([f.property(g.requiredFields)],E.prototype,"requiredFields",null);c.__decorate([f.property(g.availableFields)],E.prototype,"availableFields",void 0);c.__decorate([f.property()],E.prototype,
"_fieldsHelper",void 0);c.__decorate([f.property({type:Number})],E.prototype,"maximumNumberOfFeatures",null);c.__decorate([f.property({readOnly:!0})],E.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([f.property()],E.prototype,"_excludeObjectIdsSorted",null);c.__decorate([f.property({readOnly:!0})],E.prototype,"lodFactor",null);c.__decorate([f.property({readOnly:!0})],E.prototype,"hasM",null);c.__decorate([f.property({readOnly:!0})],E.prototype,"hasZ",null);c.__decorate([f.property()],
E.prototype,"contentVisible",null);c.__decorate([f.property({readOnly:!0})],E.prototype,"legendEnabled",null);c=E=c.__decorate([e.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],E);const ea={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ja=z.create(),ha={graphic:null,property:null,oldValue:null,newValue:null};return c})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(y){function p(u){return y.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:q=>[q.geometryBuffer]},u,{hasInitialize:!0})||this}b._inherits(p,y);return b._createClass(p)}(c.WorkerHandle);a.I3SPointsWorkerHandle=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/Evented","../../../../core/MapUtils"],function(a,b,c,y){c=function(p){function u(k,d){var f=p.call(this)||this;f._updateAndCompare=k;f._notifyUpdated=d;f._nodes=new Map;f._graphics=new Map;f._duplicates=new Map;return f}b._inherits(u,p);var q=u.prototype;q.clear=function(){if(0<this._graphics.size){const k=this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:k})}this._nodes.clear()};q.get=function(k){return this._graphics.get(k)};q.getNode=function(k){return this._nodes.get(k)};
q.hasNode=function(k){return this._nodes.has(k)};q.nodes=function(){return this._nodes.values()};q.addNode=function(k,d){this._nodes.set(k,d);const f=d.graphics;if(0!==f.length){var g=new Set;for(let h=0;h<f.length;h++){var e=f[h];const z=e.objectId,n=this._graphics.get(z);n?(g.add(z),e!==n&&(f[h]=n),(e=this._duplicates.get(z))?e.push(k):this._duplicates.set(z,[n.nodeIndex,k])):(e.nodeIndex=k,this._graphics.set(z,e))}g.size&&this._updateForeignGraphics(d);k=0<g.size?f.filter(h=>!g.has(h.objectId)):
f;0<k.length&&this.emit("change",{added:k,removed:[]})}};q.removeNode=function(k){var d=this._nodes.get(k);if(d){this._nodes.delete(k);var f=new Set,g=[];for(const z of d.graphics){d=z.objectId;var e=this._graphics.get(d);if(!e)continue;const n=this._duplicates.get(d);if(n){var h=n.indexOf(k);if(-1===h)console.error("error: removing graphic from node that should not reference it.");else{n.splice(h,1);if(e.nodeIndex===k){e=this.getNode(n[0]);for(h=1;h<n.length;h++){const l=this.getNode(n[h]);if(null==
e||null!=l&&l.node.level>e.node.level)e=l}null!=e&&f.add(e)}1===n.length&&this._duplicates.delete(d)}}else this._graphics.delete(d),g.push(z)}0<g.length&&this.emit("change",{added:[],removed:g});f.forEach(z=>this._updateForeignGraphics(z))}else console.error("Removing unknown node")};q._updateForeignGraphics=function(k){const d=[],f=k.node.index,g=k.node.level;let e=0;for(;e<k.graphics.length;){var h=k.graphics[e].nodeIndex;if(h===f){e++;continue}let z=1;for(;e+z<k.graphics.length&&k.graphics[e+z].nodeIndex===
h;)z++;h=this.getNode(h);if(!(null!=h&&h.node.level>g))for(h=e;h<e+z;h++){const n=k.graphics[h];n.nodeIndex=f;this._updateAndCompare(n,k,h)&&d.push(n)}e+=z}this._notifyUpdated(d)};q.toArray=function(){return Array.from(this._graphics.values())};q.find=function(k){let d=void 0;y.someMap(this._graphics,f=>k(f)?(d=f,!0):!1);return d};q.forEach=function(k){this._graphics.forEach(d=>k(d))};q.forEachNode=function(k){this._nodes.forEach((d,f)=>k(d,f))};q._checkInvariants=function(){const k=new Map;this._nodes.forEach((f,
g)=>{g!==f.node.index&&console.error("Mismatched node index");f.graphics.forEach(e=>{k.set(e.objectId,1+(k.get(e.objectId)??0));const h=this._duplicates.get(e.objectId);h&&!h.includes(g)&&console.error("Node not listed in duplicate list");h||e.nodeIndex===g||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==k.size&&console.error("Mismatch between actual and expected number of graphics");let d=0;k.forEach((f,g)=>{d+=1<f?1:0;const e=this._graphics.get(g);
if(e){var h=this._nodes.get(e.nodeIndex);h?(g=this._duplicates.get(g))?(g.length!==f&&console.error("Wrong number of entries in duplicate list"),g.forEach(z=>{(z=this._nodes.get(z))?z.node.level>h.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<f&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});this._duplicates.size!==d&&
console.error("Mismatch between expected and actual number of duplicate entries")};b._createClass(u,[{key:"length",get:function(){return this._graphics.size}},{key:"nodeCount",get:function(){return this._nodes.size}}]);return u}(c);a.I3SGraphicsMap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
b,c,y,p,u,q,k,d,f,g,e,h,z,n,l,m,t,w,r,x,D,A,v,B,C,E,F,M,K,G,L,O,I,H,J,N,R,W,T,P,Q,S,U,V,X,Y,Z,ea,ja,ha,ia,oa,ma,fa,ba,aa,da,ca,na,qa,ua,sa,pa,ka,ra,va,Ca,Ba,Ha,Ma,Qa,Sa,La,Ua,Va,cb,la,eb,ib,Pa,za,Ga,Fa,xa,ya,Ea,Oa,bb,db){function nb(rb,Fb){rb.layerUids||(rb.layerUids=new Set);rb.layerUids.add(Fb)}function kb(rb,Fb){return null!=rb&&G.canProjectWithoutEngine(rb.spatialReference,Fb)?G.project(rb,Fb):null}const wb=rb=>Object.freeze(Object.defineProperty({__proto__:null,default:rb},Symbol.toStringTag,
{value:"Module"}));p=function(rb){function Fb(Ja){var Na=rb.call(this,Ja)||this;Na._userClippingArea=null;Na._clippingArea=null;Na._initialDefaultSpatialReference=null;Na._defaults={};Na._externallySet={environment:!1};Na._createGraphicsViewController=null;Na._resolveWhenReady=[];Na._propertiesPool=new pa.PropertiesPool({slicePlane:O.BoundedPlaneClass},b._assertThisInitialized(Na));Na._resourceController=va.newResourceController(b._assertThisInitialized(Na));Na._defaultToMapOptions={include:new Set};
Na._defaultHitTestOptions={exclude:new Set};Na.deconflictor=new ia.GraphicsDeconflictor({view:b._assertThisInitialized(Na)});Na.labeler=new oa.Labeler({view:b._assertThisInitialized(Na),deconflictor:Na.deconflictor.labels});Na.sharedSymbolResources=null;Na.analyses=new R.AnalysesCollection;Na.basemapTerrain=null;Na.elevationProvider=null;Na.canvas=null;Na.constraints=new Z.Constraints;Na.environmentManager=new ja.SceneViewEnvironmentManager;Na.floors=new k;Na.fullOpacity=1;Na.graphicsView=null;Na.analysisViewManager=
new Y({view:b._assertThisInitialized(Na)});Na.groundView=null;Na.map=null;Na.screenSizePerspectiveEnabled=!0;Na.state=new fa;Na.spatialReference=null;Na.alphaCompositingEnabled=!1;Na.preserveDrawingBufferEnabled=!1;Na.supersampleScreenshotsEnabled=!0;Na.type="3d";Na.ui=new ya;Na._numUpdating=0;Na._lastUpdateTime=0;Na.updatingProgress=.5;Na.highlightOptions=new ua;Na.voxelWasm=null;Na.voxelWasmPromise=null;D.initialize();Ja&&Ja.environment||(Na._defaults.environment=new ea,Na.environment=Na._defaults.environment);
const Xa=(fb=null)=>{if(null==fb||fb.type!==m.ObservableChangesType.MOVE)Na._updatingChanged(),Na.map&&Na.map.allLayers.forEach(async jb=>{try{await jb.when()}catch{}Na._updatingChanged()})};Na.addHandles([w.on(()=>Na.map?.allLayers,"after-changes",fb=>Xa(fb),{onListenerAdd:()=>Xa(),onListenerRemove:()=>Xa(),sync:!0}),Na.allLayerViews.on("after-changes",fb=>Na._updateUpdatingMonitors(fb)),w.watch(()=>Na.map,fb=>{fb&&"load"in fb&&fb.load&&fb.load().catch(()=>{})})]);Na.inputManager=new ha({view:b._assertThisInitialized(Na)});
Na.stateManager=new ba.ViewStateManager({view:b._assertThisInitialized(Na)});return Na}b._inherits(Fb,rb);var hb=Fb.prototype;hb.initialize=function(){this.groundView=new P({view:this});this._updateUpdatingMonitors();const Ja=()=>this._updateDefaultToMapOptions();this.addHandles(w.on(()=>this.map?.allLayers,"after-changes",Ja,{onListenerAdd:Ja,onListenerRemove:Ja}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Na=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=
Na)},w.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Na=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Na)},w.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Na=>r.setFrameDuration(0<Na?1E3/Math.ceil(Na):0),w.initial);this.updatingHandles.add(()=>this.map?.ground,Ja,w.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),w.syncAndInitial);
this.addHandles(w.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),w.sync))};hb.destroy=function(){this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=l.destroyMaybe(this.sharedSymbolResources),this._set("labeler",l.destroyMaybe(this.labeler)),this._set("deconflictor",l.destroyMaybe(this.deconflictor)),this._resourceController=
l.destroyMaybe(this._resourceController),this._set("stateManager",l.destroyMaybe(this.stateManager)),this._set("inputManager",l.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",l.destroyMaybe(this.environmentManager)),this.groundView=l.destroyMaybe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())};
hb.installContentCameraReset=function(Ja={sticky:!1}){return this.stateManager.installContentCameraReset(Ja)};hb.castEnvironment=function(Ja){return Ja?Ja instanceof ea?Ja:Ja instanceof Ea?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ja):ea.fromWebsceneEnvironment(Ja):E.ensureType(ea,Ja):new ea};hb.on=function(Ja,Na,Xa,fb){return(Xa=this.viewEvents.on(Ja,Na,Xa,fb))?Xa:b._get(b._getPrototypeOf(Fb.prototype),"on",this).call(this,Ja,Na)};hb.hasEventListener=function(Ja){return b._get(b._getPrototypeOf(Fb.prototype),
"hasEventListener",this).call(this,Ja)||this.viewEvents.hasHandler(Ja)};hb.toMap=function(Ja,Na){if(!this.ready)return n.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Na=Na?this.externalToInternalIntersectOptions(Na):this._defaultToMapOptions;var Xa=null!=Na.graphics&&(null!=Na.graphics.include||null!=Na.graphics.exclude);Ja=za.isSupportedScreenPointEvent(Ja)?za.createScreenPointFromSupportedEvent(this,Ja):Ja;Ja=x.screenPointObjectToArray(Ja);Na.enableDraped=
Na.include&&!Na.include.has(la.TERRAIN_ID)||Na.exclude&&Na.exclude.has(la.TERRAIN_ID);const fb=this.sceneIntersectionHelper,jb=La.newIntersector(this.state.viewingMode);jb.options.selectionMode=!0;jb.options.store=Xa?Ua.StoreResults.ALL:Ua.StoreResults.MIN;fb.intersectIntersectorScreen(Ja,jb,Na);if(Xa){for(const ab of jb.results.all)if(Xa=cb.toHit(ab,this),null==Xa||"graphic"!==Xa.type||this._testGraphicUidFilter(Na.graphics,Xa.graphic))return this._intersectResultToMapPoint(ab);return null}return this._intersectResultToMapPoint(jb.results.min)};
hb.toScreen=function(Ja){if(!this.ready)return n.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const Na=(null==Ja.z?qa.getElevationAtPoint(this.elevationProvider,Ja):null)??0;G.projectPointToVector(Ja,sb,this.renderSpatialReference,Na);this.state.camera.projectToScreen(sb,Ab);return x.createScreenPoint(Ab[0],Ab[1])};hb.pixelSizeAt=function(Ja){if(!this.ready)return n.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;
if(!Ja)return 0;G.projectPointToVector(Ja,sb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(sb)};hb.overlayPixelSizeInMapUnits=function(Ja){const Na=this.basemapTerrain.overlayManager;return Na?Na.overlayPixelSizeInMapUnits(Ja):1};hb.hitTest=function(Ja,Na){if(!this.ready)return n.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;Ja=za.isSupportedScreenPointEvent(Ja)?za.createScreenPointFromSupportedEvent(this,Ja):Ja;var Xa=x.createScreenPointArray(Ja.x,
Ja.y),fb=Na?this.externalToInternalIntersectOptions(Na):this._defaultHitTestOptions;fb.requiresGroundFeedback=!0;fb.enableDraped=!0;Na=La.newIntersector(this.state.viewingMode);Na.options.selectionMode=!0;Na.options.store=Ua.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Xa,Na,fb);Xa=this._intersectResultsToHits(Na.results.all,fb.graphics);fb=Na.results.ground;var jb=cb.toOwner(fb,this);jb=null!=jb&&"type"in jb&&"integrated-mesh"===jb.type?jb:null;Ja={screenPoint:Ja,results:Xa,
ground:{mapPoint:this._intersectResultToMapPoint(fb),distance:Va.isValidIntersectorResult(fb)?fb.distanceInRenderSpace:0,layer:jb}};ca.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ja.intersector=Na);return Promise.resolve(Ja)};hb.popupHitTest=async function(Ja){const {results:Na,ground:Xa}=await eb.hitTestSelectSimilarDistance(this,Ja);let fb=null;!(0===Na.length||1E-5>Math.abs((Na[0].distance??0)-Xa.distance))||Xa.layer&&"integrated-mesh"===Xa.layer.type||(fb=Xa.mapPoint);return{results:Na,screenPoint:Ja,
mapPoint:fb}};hb.goTo=function(Ja,Na){return this.updatingHandles.addPromise(this.stateManager.goTo(Ja,Na))};hb.whenAnalysisView=async function(Ja){if(null==Ja.parent)throw new f("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ja});switch(Ja.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(Ja.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Ja)}};hb.whenLayerView=function(Ja){return b._get(b._getPrototypeOf(Fb.prototype),
"whenLayerView",this).call(this,Ja)};hb.takeScreenshot=async function(Ja){Ja=this._completeSettings(Ja);await this.whenReady();const Na=await this._stage.renderView.takeScreenshot(Ja);return Pa.encode(Na,Ja,this._pixelFormat())};hb._takeScreenshot=async function(Ja){Ja=this._completeSettings(Ja);await this.whenReady();Ja=await this._stage.renderView.takeScreenshot(Ja);return Pa.encodeData(Ja,this._pixelFormat())};hb._takeScreenshotWithObjectAndLayerId=async function(Ja){Ja=this._completeSettings(Ja);
await this.whenReady();Ja=await this._stage.renderView.takeScreenshotWithOID(Ja);return[Pa.encodeData(Ja[0],this._pixelFormat()),Pa.encodeData(Ja[1],this._pixelFormat())]};hb._completeSettings=function(Ja){Ja=Pa.toRenderSettings(Ja,this);Ja.pixelRatio/=this.state.pixelRatio;return Pa.screenshotSuperSampleSettings(Ja,this.supersampleScreenshotsEnabled,this.padding)};hb._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};hb.takeScreenshotWithObjectAndLayerId=
async function(Ja){if(!h("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");var Na=this._completeSettings(Ja);await this.whenReady();var Xa=await this._stage.renderView.takeScreenshotWithOID(Na);Na=Pa.encode(Xa[0],Na,this._pixelFormat());Ja=this._completeSettings(Ja);Ja.format="png";Xa=Pa.encode(Xa[1],Ja,this._pixelFormat());return[Na,Xa]};hb.getColorToObjectAndLayerIdMapping=function(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw Error("has enable-feature:objectAndLayerId-rendering must be true");
return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()};hb.addUpdatingPromise=function(Ja){return this.updatingHandles.addPromise(Ja)};hb.importLayerView=function(Ja){return X.layerView3DImporter.importLayerView(Ja)};hb.hasLayerViewModule=function(Ja){return X.layerView3DImporter.hasLayerViewModule(Ja)};hb.forceDOMReadyCycle=function(){this.forceReadyCycle()};hb.getDefaultSpatialReference=function(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||
this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null};hb.validate=async function(){let Ja=Fa.check(this.type);const Na=h("safari");Na&&9>Na&&(Ja=new f("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Na}));if(null!=Ja)throw n.getLogger(this).warn("#validate()",Ja.message),Ja;};hb.getSpatialReferenceSupport=function({spatialReference:Ja,layer:Na}){var Xa=
this._predeterminedViewingMode;if(null!=Xa)return this._validateSpatialReferenceForViewingMode(Ja,Na,Xa)?{constraints:this._makeSpatialReferenceConstraints(Ja,Na,Xa)}:null;Xa=this._validateSpatialReferenceForViewingMode(Ja,Na,V.ViewingMode.Local);const fb=this._validateSpatialReferenceForViewingMode(Ja,Na,V.ViewingMode.Global);return Xa||fb?Xa&&fb?{constraints:this._makeSpatialReferenceConstraints(Ja,Na,null)}:Xa?{constraints:this._makeSpatialReferenceConstraints(Ja,Na,V.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ja,
Na,V.ViewingMode.Global)}:null};hb._validateSpatialReferenceForViewingMode=function(Ja,Na,Xa){return Ga.isSpatialReferenceSupported(Ja,Xa)?null==Na||N.isImageryTileLayer(Na)?!0:N.isTiledLayer(Na)&&null==Qa.getTiledLayerInfo(Na,Ja,Xa)||N.isVoxelLayer(Na)&&Xa===V.ViewingMode.Global?!1:!0:!1};hb._makeSpatialReferenceConstraints=function(Ja,Na,Xa){if(null==Na)return[{spatialReference:Ja,viewingMode:Xa}];const fb=Ja.isWebMercator,jb=Ja.isWGS84;return N.isImageryTileLayer(Na)&&(fb||jb)?(jb&&Xa!==V.ViewingMode.Local?
null===Qa.checkIfTileInfoSupportedForView(Na.tileInfo,Na.fullExtent,Ja,V.ViewingMode.Global):1)?[{spatialReference:Ja,viewingMode:Xa},{spatialReference:Oa.WebMercator,viewingMode:Xa}]:[{spatialReference:fb?Oa.WGS84:Oa.WebMercator,viewingMode:Xa}]:N.isTiledLayer(Na)||N.isVoxelLayer(Na)||!fb&&!jb?N.isTiledLayer(Na)&&fb&&Xa!==V.ViewingMode.Global?[{spatialReference:Ja,viewingMode:Xa},{spatialReference:Oa.WGS84,viewingMode:V.ViewingMode.Local}]:[{spatialReference:Ja,viewingMode:Xa}]:[{spatialReference:Ja,
viewingMode:Xa},{spatialReference:fb?Oa.WGS84:Oa.WebMercator,viewingMode:Xa}]};hb._validateSpatialReference=function(Ja){const Na=null!=this.getSpatialReferenceSupport({spatialReference:Ja}),Xa=this._predeterminedViewingMode;Na||(null!=Xa?n.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${V.stringFromViewingMode(Xa)} viewing mode.`):Ja.isGeographic&&n.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Na};hb.whenReady=function(){return new Promise(Ja=>
{this.ready?Ja(this):this._resolveWhenReady.push(Ja)})};hb.computeMapPointFromVec3d=function(Ja,Na){let Xa=this.spatialReference||Oa.WGS84;G.projectVectorToVector(Ja,this.renderSpatialReference,Ja,Xa)||(Xa=Oa.WGS84,G.projectVectorToVector(Ja,this.renderSpatialReference,Ja,Xa));Na?(Na.x=Ja[0],Na.y=Ja[1],Na.z=Ja[2],Na.spatialReference=Xa):Na=new bb(Ja,Xa);return Na};hb.trackGraphicState=function(Ja){if(!Ja.graphic)return n.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),
null;const Na=this.getViewForGraphic(Ja.graphic);let Xa=null,fb=!1;const jb=ab=>{!fb&&null!=ab&&"processor"in ab&&"graphics-3d"===ab.processor?.type&&ab.processor.graphicsCore&&(Xa=ab.processor.graphicsCore.trackGraphicState(Ja))};null!=Na?jb(Na):this.whenViewForGraphic(Ja.graphic,{waitForLayer:!0}).then(ab=>jb(ab),()=>{}).catch(()=>{});return{remove:()=>{fb=!0;null!=Xa&&(Xa.remove(),Xa=null)}}};hb.highlight=function(Ja){if(Array.isArray(Ja))return e.handlesGroup(Ja.map(Xa=>this.highlight(Xa)));if(k.isCollection(Ja))return e.handlesGroup(Ja.toArray().map(Xa=>
this.highlight(Xa)));const Na=this.getViewForGraphic(Ja);return Na&&"highlight"in Na?Na.highlight(Ja):e.makeHandle()};hb.maskOccludee=function(Ja){if(!Ja)return n.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Na=this.getViewForGraphic(Ja);let Xa=null,fb=!1;const jb=ab=>{!fb&&null!=ab&&ib.occludeesSupported(ab)&&(Xa=ab.maskOccludee(Ja))};null!=Na?jb(Na):this.whenViewForGraphic(Ja,{waitForLayer:!0}).then(ab=>jb(ab),()=>{}).catch(()=>
{});return{remove:()=>{fb=!0;null!=Xa&&(Xa.remove(),Xa=null)}}};hb.getViewForGraphic=function(Ja){return Ja.layer===this.graphics?this.graphicsView:Ja.layer?this.allLayerViews.find(Na=>Na.layer===Ja.layer):null};hb.graphicChanged=function(Ja){null!=this.graphicsView&&this.graphicsView.graphicChanged(Ja)};hb.whenViewForGraphic=async function(Ja,Na){if(Ja.layer===this)return await w.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ja.layer||!this.map)throw new f("no-view-for-graphic");return Na&&
Na.waitForLayer&&!this.map.allLayers.includes(Ja.layer)?new Promise((Xa,fb)=>{const jb=this.map.allLayers.on("change",ab=>{ab.added.includes(Ja.layer)&&(jb.remove(),this.whenLayerView(Ja.layer).then(Xa,fb))})}):this.whenLayerView(Ja.layer)};hb.externalToInternalIntersectOptions=function(Ja){const Na=this._externalToInternalRenderItems(Ja.include,vb.INCLUDE);Ja=this._externalToInternalRenderItems(Ja.exclude,vb.EXCLUDE);return{include:Na.layerUids,exclude:Ja.layerUids,graphics:{include:Na.graphicUids,
exclude:Ja.graphicUids}}};hb._intersectResultToMapPoint=function(Ja,Na){return Ja.getIntersectionPoint(sb)?(Na=this.computeMapPointFromVec3d(sb,Na),Ja.intersector===Ua.IntersectorType.TERRAIN&&this.basemapTerrain&&(Na.z=qa.getElevationAtPoint(this.basemapTerrain,Na)??0),Na):null};hb._intersectResultsToHits=function(Ja,Na){const Xa=[];let fb=null;for(let pb=0;pb<Ja.length;pb++){const tb=Ja[pb];var jb=cb.toOwner(tb,this);if(null!=jb&&(jb===this.map.ground||"type"in jb&&"integrated-mesh"===jb.type))break;
jb=cb.toHit(tb,this);if(null!=jb){if("graphic"===jb.type){null==fb&&pb!==Ja.length-1&&(fb=new Set);if(null!=fb){var ab=this._getGraphicFilterUid(jb.graphic);if(fb.has(ab))continue;fb.add(ab)}if(!this._testGraphicUidFilter(Na,jb.graphic))continue}ab=this._intersectResultToMapPoint(tb);Xa.push({...jb,mapPoint:ab,distance:tb.distanceInRenderSpace})}}return Xa};hb._getGraphicFilterUid=function(Ja){var Na=Ja.sourceLayer,Xa=Ja.layer;if(Na=Na&&"objectIdField"in Na?Na:Xa&&"objectIdField"in Xa?Xa:Na)if(Xa=
Na.objectIdField??J.fallbackObjectIDAttribute,Xa=Ja.attributes?.[Xa])return`o-${Na.id}-${Xa}`;return`u-${Ja.uid}`};hb._testGraphicUidFilter=function(Ja,Na){Na=this._getGraphicFilterUid(Na);return null==Ja||(null==Ja.include||Ja.include.has(Na))&&(null==Ja.exclude||!Ja.exclude.has(Na))};hb._externalToInternalRenderItems=function(Ja,Na,Xa={layerUids:void 0,graphicUids:void 0}){if(!Ja)return Xa;if(Ja instanceof u){var fb=this._getGraphicFilterUid(Ja);Xa.graphicUids||(Xa.graphicUids=new Set);Xa.graphicUids.add(fb);
Na===vb.INCLUDE&&(null!=this.graphicsView&&Ja.layer===this?nb(Xa,this.graphicsView.processor.layer.id):Ja.layer&&nb(Xa,Ja.layer.uid))}else if(z.isIterable(Ja))for(fb of Ja)fb===this.graphics&&null!=this.graphicsView?nb(Xa,this.graphicsView.processor.layer.id):fb===this.map.ground?nb(Xa,la.TERRAIN_ID):this._externalToInternalRenderItems(fb,Na,Xa);else"uid"in Ja&&nb(Xa,Ja.uid);return Xa};hb._initBasemapTerrain=function(){this._set("basemapTerrain",new Ma({view:this}));this._set("elevationProvider",
new da.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};hb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};hb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ha.PointsOfInterest({view:this}));
this._set("featureTiles",new ma.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ja=()=>{var Na=this.basemapTerrain?.extent;this.clippingArea||Na?Na&&this.basemapTerrain.spatialReference?(Na=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?
G.project(L.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Na):Na):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ca.FEATURE_TILE_TREE_SHOW_TILES,Na=>{Na&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Xa,fb)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],
Xa,fb))).then(({FeatureTileTree3DDebugger:Xa})=>{!this._featureTreeDebugger&&ca.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Xa({view:this}))}):Na||!this._featureTreeDebugger||ca.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},w.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ja,w.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ja,w.syncAndInitial)],"feature-tiles");this.stateManager.init()};
hb._exitGlobe=function(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};hb._initCoordinateSystem=function(){if(this.spatialReference){var Ja=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ja)||
this._set("mapCoordsHelper",new sa.MapCoordsHelper(this.map,Ja));const Na=this.state.isGlobal;Ja=I.renderSRFromViewSR(Na,Ja);Ja!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ra.RenderCoordsHelper.create(this.state.viewingMode,Ja)),Na||this.addHandles(w.watch(()=>this.basemapTerrain?.extent,Xa=>{const fb=this.renderCoordsHelper.spatialReference;null==Xa||0===Xa[0]&&0===Xa[1]&&0===Xa[2]&&0===Xa[3]||!G.projectBoundingRect(Xa,this.basemapTerrain.spatialReference,Ib,fb)||(this.renderCoordsHelper.extent=
Ib)},w.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(La.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};hb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};hb._updatingChanged=function(){this.notifyChange("updating")};hb._updateUpdatingMonitors=
function(Ja=null){if(null==Ja||Ja.type!==m.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Na=>{Na.destroyed||(this.addHandles(w.watch(()=>[Na.updating,Na.updatingProgress],()=>this._updatingChanged(),w.sync),"updatingMonitors"),Na.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged()};hb._prepareScreenshotOverlay=async function(){this.overlay&&await this.overlay.prepare()};hb._renderScreenshotOverlay=function(Ja,Na){if(!this.overlay||
!this.overlay.hasVisibleItems)return Na;const Xa=Ja.getContext("2d");Xa.putImageData(Na,0,0);this.overlay.renderCanvas(Ja);return Xa.getImageData(0,0,Na.width,Na.height)};hb._initStage=function(){var Ja={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Xa,
fb)=>this._renderScreenshotOverlay(Xa,fb)}},Na=new aa.SceneIntersectionHelper(this.state.viewingMode,Xa=>this._stage.layers.forAll(Xa),this);this._set("sceneIntersectionHelper",Na);Na=d.byId(this.surface);this._stage=new Sa.Stage({view:this,options:Ja,container:Na});this._stage.renderer.setParameters({slicePlane:this.slicePlane});this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),
w.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Xa=>this._stage.renderer.setParameters({highQualityTransparency:Xa}),w.initial),w.watch(()=>this.magnifier,Xa=>this._stage.renderView.magnifier=Xa,w.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),g.on(this._stage.renderView.canvas,"webglcontextlost",Xa=>this.fatalError=new f("webgl-context-lost",Xa.statusMessage))],"stage");Ja=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:ua.toEngineOptions(this.highlightOptions)})};
this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],Ja),"stage");Ja();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(La.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};hb._exitStage=function(){this._set("sceneIntersectionHelper",
null);this._stage=l.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)};hb._initSurface=function(Ja){this._exitSurface();this.state.init(Ja,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ba.SharedSymbolResources({view:this,viewingMode:Ja,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};hb._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),
this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};hb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=new AbortController;var Ja=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ja,Ja);this._updatingChanged()}};
hb._createGraphicsViewAsync=async function(Ja){const Na=(await new Promise((Xa,fb)=>a(["./3d/layers/GraphicsView3D"],jb=>Xa(wb(jb)),fb))).default;t.throwIfAborted(Ja);await w.whenOnce(()=>this.basemapTerrain?.ready,Ja);this._set("graphicsView",new Na({view:this}))};hb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),
this.graphicsView.destroy(),this._set("graphicsView",null))};hb._startup=function(){var Ja=V.viewingModeFromString(this.viewingMode);Ja===V.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ja);this._set("ready",!0);this.addHandles(w.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ja=this.get("map.initialViewProperties.environment"))&&(this.environment=Ja);this.labeler.setup();
this.environmentManager.connectView(this);this.inputManager.connect();Ja=this._resolveWhenReady;this._resolveWhenReady=[];Ja.forEach(Na=>Na(this))};hb._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._exitSurface();this._set("ready",!1)};hb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&
this._defaultToMapOptions.include.add(la.TERRAIN_ID);for(const Ja of this.map.allLayers.items)"integrated-mesh"===Ja.type&&this._defaultToMapOptions.include.add(Ja.uid)}};hb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(la.TERRAIN_ID);for(const Ja of this.map.allLayers.items)"integrated-mesh"===Ja.type&&1>Ja.opacity&&this._defaultHitTestOptions.exclude.add(Ja.uid)}};
hb.addVoxelLayerViewToWasm=function(Ja){return null==this.voxelWasm?(null==this.voxelWasmPromise&&(this.voxelWasmPromise=(new Promise((Na,Xa)=>a(["../layers/VoxelWasmPerSceneView"],fb=>Na(wb(fb)),Xa))).then(Na=>this.voxelWasm=new Na.default(this))),this.voxelWasmPromise.then(Na=>Na.addVoxelLayer(Ja))):this.voxelWasm.addVoxelLayer(Ja)};hb.removeVoxelLayerViewFromWasm=function(Ja){null!=this.voxelWasm&&1>this.voxelWasm.removeVoxelLayer(Ja)&&(this.voxelWasmPromise=this.voxelWasm=null)};b._createClass(Fb,
[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain?.spatialReference}},{key:"animation",get:function(){return this.state?.animation}},{key:"camera",get:function(){return this.stateManager?.camera},set:function(Ja){this.stateManager&&(this.stateManager.camera=Ja)}},{key:"contentCamera",get:function(){return this.stateManager?.contentCamera},set:function(Ja){this.stateManager&&
(this.stateManager.contentCamera=Ja)}},{key:"center",get:function(){return this.stateManager?.center},set:function(Ja){this.stateManager&&(this.stateManager.center=Ja)}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Ja=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);if(!this._userClippingArea&&!this.get("map.clippingEnabled")||null==Ja)return this._clippingArea=null;if(!(Ja instanceof db))return n.getLogger(this).error("#clippingArea",
"only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Ja=kb(Ja,this.spatialReference),null==Ja))return n.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ja=Ja.clone();null==Ja.intersection(this._groundAndLayersExtent)&&(Ja.xmin=Ja.xmax,Ja.ymin=Ja.ymax);Ja.zmin=void 0;Ja.zmax=void 0;Ja.equals(this._clippingArea)||(this._clippingArea=Ja);return this._clippingArea},set:function(Ja){this.ready&&
"global"===this.viewingMode&&null!=Ja?n.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Ja}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===V.ViewingMode.Global)return null;const Ja=this.renderSpatialReference,Na=this.dataExtent;return null==Na||null==Ja||Na.spatialReference.equals(Ja)?Na:kb(Na,Ja)}},{key:"dataExtent",get:function(){let Ja=this._groundAndLayersExtent;var Na=kb(this.clippingArea,this.spatialReference||
Oa.WGS84);null!=Na&&(Ja=null!=Ja?Ja.intersection(Na):Na);Na=this._get("dataExtent");return null!=Ja&&Ja.equals(Na)?Na:Ja}},{key:"_groundAndLayersExtent",get:function(){const Ja=this.spatialReference||Oa.WGS84;let Na;const Xa=jb=>{jb=kb(jb,Ja);null!=jb&&(null!=Na?Na.union(jb):Na=jb.clone())};var fb=this.basemapTerrain;if(fb?.spatialReference){const jb=fb.groundExtent;Xa(new db({xmin:jb[0],ymin:jb[1],zmin:0,xmax:jb[2],ymax:jb[3],zmax:0,spatialReference:fb.spatialReference}))}this.map&&this.map.allLayers.forEach(jb=>
{null==jb.fullExtent||"graphics"===jb.type&&jb.internal||Xa(jb.fullExtent)});if(null==Na)return null;Na.hasZ?(Na.zmin=Math.min(0,Na.zmin??0),Na.zmax=Math.max(0,Na.zmax??0)):(Na.zmin=0,Na.zmax=0);fb=this._get("_groundAndLayersExtent");return Na.equals(fb)?fb:Na}},{key:"environment",set:function(Ja){Ja!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ja)}},{key:"extent",get:function(){return this.stateManager?.extent},set:function(Ja){this.stateManager&&(this.stateManager.extent=
Ja)}},{key:"screenCenter",get:function(){return this.stateManager?.screenCenter}},{key:"frustum",get:function(){return this.stateManager?.frustum}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||(this.toolViewManager?.interacting??!1)}},{key:"stationary",get:function(){return!this.animation&&
!this.resizing&&(null==this.state||this.state.stationary)}},{key:"navigating",get:function(){return this.state?.navigating??!1}},{key:"padding",get:function(){return this.stateManager?.padding},set:function(Ja){this.stateManager&&(this.stateManager.padding=Ja)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||na.getDefaultProfile()},set:function(Ja){na.isValidProfile(Ja)&&(na.apply(Ja,this.qualitySettings),this._set("qualityProfile",Ja))}},{key:"slicePlane",set:function(Ja){null!=
this._stage&&this._stage.renderer.setParameters({slicePlane:Ja});if(null==Ja)this._set("slicePlane",null);else{var Na=this._propertiesPool.get("slicePlane");O.copy(Ja,Na);this._set("slicePlane",Na)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?H.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"scale",get:function(){return this.stateManager?.scale},set:function(Ja){this.stateManager&&
(this.stateManager.scale=Ja)}},{key:"heightModelInfo",get:function(){const Ja=this.getDefaultHeightModelInfo();return null!=Ja?K.deriveUnitFromSR(Ja,this.spatialReference):null}},{key:"updating",get:function(){if(this.destroyed)return!1;let Ja=0,Na=this.layerViewManager.updating,Xa=Na?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(ab=>{ab.isFulfilled()?ab.updating&&(Na=!0,ab.suspended||Qa.isSurfaceLayerView(ab)||(++Xa,Ja+=ab.updatingProgress)):++Xa});for(var fb of this._updatingObjects)null!=
fb&&fb.updating&&(Xa+=.1,Ja+=.05);for(var jb of this._updatingObjectsWithProgress)null!=jb&&jb.updating&&(++Xa,Ja+=jb.updatingProgress);fb=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;(Na=!!(Na||0<Xa||this.updatingHandles.updating||!this.ready||!this.stationary||fb||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(ab=>!ab.isFulfilled())))?(this._numUpdating=Math.max(Xa,this._numUpdating),Ja+=this._numUpdating-Xa):this._numUpdating=
0;Ja=0<this._numUpdating?Ja/this._numUpdating:Na?0:1;this._get("updatingProgress")!==Ja&&(fb=performance.now(),1>Ja&&(jb=Math.min((fb-this._lastUpdateTime)/2E3,1),Ja=this.updatingProgress*(1-jb)+Ja*jb),this._set("updatingProgress",Ja),this._lastUpdateTime=Na&&1>Ja?fb:0);return Na}},{key:"_updatingObjects",get:function(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,
this.toolViewManager,this.analysisViewManager]}},{key:"_updatingObjectsWithProgress",get:function(){return[this.deconflictor,this.labeler,this.basemapTerrain]}},{key:"viewingMode",get:function(){var Ja=this._predeterminedViewingMode;return null!=Ja?V.stringFromViewingMode(Ja):(Ja=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&Ja.equals(this.defaultsFromMap.spatialReference)?V.stringFromViewingMode(this.defaultsFromMap.viewingMode):Ga.isSpatialReferenceSupported(Ja,V.ViewingMode.Global)?
"global":"local":"global"},set:function(Ja){this.ready?n.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Ja)}},{key:"viewpoint",get:function(){return this.stateManager?.viewpoint},set:function(Ja){this.stateManager&&(this.stateManager.viewpoint=Ja)}},{key:"zoom",get:function(){return this.stateManager.zoom},set:function(Ja){this.stateManager&&(this.stateManager.zoom=Ja)}},{key:"resourceController",get:function(){return this._resourceController}},
{key:"performanceInfo",get:function(){return new Ca(this)}},{key:"test",get:function(){return{takeScreenshot:Ja=>this._takeScreenshot(Ja),takeScreenshotWithObjectAndLayerId:Ja=>this._takeScreenshotWithObjectAndLayerId(Ja)}}},{key:"_predeterminedViewingMode",get:function(){const Ja=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=Ja?V.viewingModeFromString(Ja):null}}]);return Fb}(W.BreakpointsOwner(Q.PopupView(T.DOMContainer(S))));
p.type="3d";c.__decorate([A.property()],p.prototype,"_userClippingArea",void 0);c.__decorate([A.property()],p.prototype,"_resourceController",void 0);c.__decorate([A.property()],p.prototype,"_stage",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"deconflictor",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"labeler",void 0);c.__decorate([A.property(M.owningCollectionProperty(R.AnalysesCollection,"analyses"))],p.prototype,"analyses",void 0);c.__decorate([A.property({type:U,
readOnly:!0})],p.prototype,"animation",null);c.__decorate([A.property({readOnly:!0})],p.prototype,"basemapTerrain",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"elevationProvider",void 0);c.__decorate([A.property()],p.prototype,"camera",null);c.__decorate([A.property({type:y})],p.prototype,"contentCamera",null);c.__decorate([A.property({readOnly:!0})],p.prototype,"canvas",void 0);c.__decorate([A.property({type:bb})],p.prototype,"center",null);c.__decorate([A.property({type:db})],p.prototype,
"clippingArea",null);c.__decorate([A.property({type:Z.Constraints})],p.prototype,"constraints",void 0);c.__decorate([A.property({type:db,readOnly:!0})],p.prototype,"renderDataExtent",null);c.__decorate([A.property({type:db,readOnly:!0})],p.prototype,"dataExtent",null);c.__decorate([A.property({type:db,readOnly:!0})],p.prototype,"_groundAndLayersExtent",null);c.__decorate([A.property({value:null,type:ea})],p.prototype,"environment",null);c.__decorate([v.cast("environment")],p.prototype,"castEnvironment",
null);c.__decorate([A.property({readOnly:!0})],p.prototype,"environmentManager",void 0);c.__decorate([A.property({type:db})],p.prototype,"extent",null);c.__decorate([A.property()],p.prototype,"floors",void 0);c.__decorate([A.property()],p.prototype,"screenCenter",null);c.__decorate([A.property()],p.prototype,"frustum",null);c.__decorate([A.property({type:Number,readOnly:!0})],p.prototype,"fullOpacity",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"graphicsView",void 0);c.__decorate([A.property({readOnly:!0})],
p.prototype,"analysisViewManager",void 0);c.__decorate([A.property()],p.prototype,"groundView",void 0);c.__decorate([A.property({type:Boolean})],p.prototype,"initialExtentRequired",null);c.__decorate([A.property()],p.prototype,"_defaultsFromMapSettings",null);c.__decorate([A.property()],p.prototype,"interacting",null);c.__decorate([A.property()],p.prototype,"stationary",null);c.__decorate([A.property()],p.prototype,"navigating",null);c.__decorate([A.property()],p.prototype,"map",void 0);c.__decorate([A.property({readOnly:!0})],
p.prototype,"mapCoordsHelper",void 0);c.__decorate([A.property()],p.prototype,"padding",null);c.__decorate([A.property({type:Ha.PointsOfInterest,readOnly:!0})],p.prototype,"pointsOfInterest",void 0);c.__decorate([A.property({type:ma.FeatureTileTree3D,readOnly:!0})],p.prototype,"featureTiles",void 0);c.__decorate([A.property()],p.prototype,"_featureTreeDebugger",void 0);c.__decorate([A.property({type:Boolean})],p.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([A.property({constructOnly:!0})],
p.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],p.prototype,"debugWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],p.prototype,"renderCanvas",void 0);c.__decorate([A.property({constructOnly:!0})],p.prototype,"state",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"inputManager",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"stateManager",void 0);c.__decorate([A.property({type:["low","medium","high"]})],
p.prototype,"qualityProfile",null);c.__decorate([A.property({type:ka,get(){let rb=this._get("qualitySettings");rb||(rb=new ka,na.apply(this.qualityProfile,rb));return rb}})],p.prototype,"qualitySettings",void 0);c.__decorate([A.property()],p.prototype,"slicePlane",null);c.__decorate([A.property({readOnly:!0})],p.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([A.property({readOnly:!0})],p.prototype,"renderCoordsHelper",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"sceneIntersectionHelper",
void 0);c.__decorate([A.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],p.prototype,"resolution",null);c.__decorate([A.property({type:Number})],p.prototype,"scale",null);c.__decorate([A.property()],p.prototype,"heightModelInfo",null);c.__decorate([A.property()],p.prototype,"spatialReference",void 0);c.__decorate([A.property({type:Boolean,constructOnly:!0})],p.prototype,"alphaCompositingEnabled",void 0);c.__decorate([A.property({constructOnly:!0})],p.prototype,"preserveDrawingBufferEnabled",
void 0);c.__decorate([A.property({type:Boolean})],p.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([A.property({readOnly:!0})],p.prototype,"type",void 0);c.__decorate([A.property(),v.cast(rb=>rb instanceof xa?rb:E.ensureClass(ya,rb))],p.prototype,"ui",void 0);c.__decorate([A.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating".split(" ")})],
p.prototype,"updating",null);c.__decorate([A.property()],p.prototype,"_updatingObjects",null);c.__decorate([A.property()],p.prototype,"_updatingObjectsWithProgress",null);c.__decorate([A.property({type:Number,readOnly:!0,dependsOn:["updating"]})],p.prototype,"updatingProgress",void 0);c.__decorate([A.property({type:["global","local"]})],p.prototype,"viewingMode",null);c.__decorate([A.property({type:q})],p.prototype,"viewpoint",null);c.__decorate([A.property({type:Number})],p.prototype,"zoom",null);
c.__decorate([A.property({type:ua})],p.prototype,"highlightOptions",void 0);p=c.__decorate([C.subclass("esri.views.SceneView")],p);var vb;(function(rb){rb[rb.INCLUDE=0]="INCLUDE";rb[rb.EXCLUDE=1]="EXCLUDE"})(vb||(vb={}));const sb=F.create(),Ab=x.createScreenPointArray(),Ib=L.create();return p});