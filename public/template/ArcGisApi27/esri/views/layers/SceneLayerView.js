// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),function(z,w,e,A,c,B,u,p,x,f,F,G,C,q,D){const v=c.getLogger("esri.views.layers.SceneLayerView");
c=function(y){function r(){var a=y.apply(this,arguments)||this;a.layer=null;a.filter=null;a._geometryEngine=null;a._projectionEngineLoaded=!1;a._abortController=new AbortController;return a}w._inherits(r,y);var h=r.prototype;h.initialize=function(){const {signal:a}=this._abortController;x.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,a).then(async()=>{p.throwIfAbortError(a);this._geometryEngine=await new Promise((d,k)=>z(["../../geometry/geometryEngine"],
d,k))}).catch(p.throwIfNotAbortError);this._projectionEngineLoaded=q.isLoaded();x.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,a).then(async()=>{p.throwIfAbortError(a);await q.load();this._projectionEngineLoaded=!0}).catch(p.throwIfNotAbortError)};h.destroy=function(){this._abortController=B.abortMaybe(this._abortController)};h.highlight=function(a){throw Error("Not implemented");};h.queryFeatures=function(a,d){throw Error("Not implemented");};h.queryObjectIds=
function(a,d){throw Error("Not implemented");};h.queryFeatureCount=function(a,d){throw Error("Not implemented");};h.createQuery=function(){throw Error("Not implemented");};h.queryExtent=function(a,d){throw Error("Not implemented");};w._createClass(r,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(a){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return u.unwrapUpdating(this._layerFilter)}},
{key:"_layerFilter",get:function(){const a=this.layer.filter;if(null==a||1>a.geometries.length)return null;const d=this._geometryEngine;if(null==d||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return u.updating;const k=a.geometries.at(0).spatialReference,E=a.geometries.toArray().map(b=>{try{b=d.simplify(b)}catch(m){return v.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==b)return null;if(b.spatialReference.equals(k))return b;
try{return q.project(b,k)}catch(m){return v.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}}).filter(A.isSome).sort((b,m)=>b.extent.xmin-m.extent.xmin),n=new Set,l=[],t=[];for(let b of E){const m=b.extent.xmin;l.length=0;n.forEach(g=>{m>=g.extent.xmax?(t.push(g),n.delete(g)):b.extent.ymin<=g.extent.ymax&&b.extent.ymax>=g.extent.ymin&&d.intersects(b,g)&&l.push(g)});if(0<l.length){l.push(b);try{b=d.union(l)}catch(g){v.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");
continue}l.pop();l.forEach(g=>n.delete(g))}n.add(b)}n.forEach(b=>t.push(b));return 0<t.length?{spatialRelationship:a.spatialRelationship,geometries:t}:null}},{key:"_filterNeedsProjectionEngine",get:function(){const a=this.layer.filter;if(null==a||1>=a.geometries.length)return!1;const d=a.geometries.at(0).spatialReference;return a.geometries.some(({spatialReference:k})=>!k.equals(d)&&!q.canProjectWithoutEngine(k,d))}},{key:"layerFilterUpdating",get:function(){return u.isUpdating(this._layerFilter)}}]);
return r}(D);e.__decorate([f.property()],c.prototype,"layer",void 0);e.__decorate([f.property()],c.prototype,"availableFields",null);e.__decorate([f.property()],c.prototype,"maximumNumberOfFeatures",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",null);e.__decorate([f.property()],c.prototype,"filter",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"layerFilter",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"_layerFilter",null);
e.__decorate([f.property()],c.prototype,"_geometryEngine",void 0);e.__decorate([f.property()],c.prototype,"_projectionEngineLoaded",void 0);e.__decorate([f.property()],c.prototype,"_filterNeedsProjectionEngine",null);e.__decorate([f.property()],c.prototype,"layerFilterUpdating",null);return c=e.__decorate([C.subclass("esri.views.layers.SceneLayerView")],c)});