// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(t,f,y,u,g,E,F,G,z,A,p,B){return d=>{d=function(v){function l(){var a=v.apply(this,arguments)||
this;a._rasterFieldPrefix="Raster.";a.layer=null;a.view=null;a.tileInfo=null;return a}t._inherits(l,v);var m=l.prototype;m._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)};m.supportsSpatialReference=function(a){return!!this.projectFullExtent(a)};m.projectFullExtent=function(a){const b=this.layer.fullExtent,c=p.getDefaultDatumTransformationForDataset(b,a,!1);return p.projectExtent(b,a,c)};m.fetchPopupFeatures=async function(a,b){const {layer:c}=this;if(!a)throw new u("imageryTileLayerView:fetchPopupFeatures",
"Nothing to fetch without area",{layer:c});var {popupEnabled:h}=c;b=B.getFetchPopupTemplate(c,b);if(!h||null==b)throw new u("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:h,popupTemplate:b});h=[];const {value:k,magdirValue:w,processedValue:C}=await c.identify(a,{timeExtent:this.timeExtent});let n="";if(k&&k.length){n="imagery-tile"===c.type&&c.hasStandardTime()&&null!=k[0]?k.map(q=>c.getStandardTimeValue(q)).join(", "):k.join(", ");a={ObjectId:0};
a["Raster.ServicePixelValue"]=C?.join(", ")??n;a["Raster.ServicePixelValue.Raw"]=n;b=c.rasterInfo.attributeTable;if(null!=b){const {fields:q,features:D}=b,x=q.find(({name:r})=>"value"===r.toLowerCase());if(b=x?D.find(r=>String(r.attributes[x.name])===n):null)for(var e in b.attributes)b.attributes.hasOwnProperty(e)&&(a[this._rasterFieldPrefix+e]=b.attributes[e])}e=c.rasterInfo.dataType;if("vector-magdir"===e||"vector-uv"===e)a["Raster.Magnitude"]=w?.[0],a["Raster.Direction"]=w?.[1];e=new y(this.fullExtent.clone(),
null,a);e.layer=c;e.sourceLayer=e.layer;h.push(e)}return h};t._createClass(l,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}},{key:"datumTransformation",get:function(){return p.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0)}}]);return l}(d);f.__decorate([g.property()],d.prototype,
"layer",void 0);f.__decorate([g.property(A.combinedViewLayerTimeExtentProperty)],d.prototype,"timeExtent",void 0);f.__decorate([g.property()],d.prototype,"view",void 0);f.__decorate([g.property()],d.prototype,"fullExtent",null);f.__decorate([g.property()],d.prototype,"tileInfo",void 0);f.__decorate([g.property({readOnly:!0})],d.prototype,"hasTilingEffects",null);f.__decorate([g.property()],d.prototype,"datumTransformation",null);return d=f.__decorate([z.subclass("esri.views.layers.ImageryTileLayerView")],
d)}});