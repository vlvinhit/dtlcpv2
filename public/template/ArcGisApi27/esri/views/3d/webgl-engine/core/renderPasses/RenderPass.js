// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(k,u,v,w,q){k.RenderPassSorting=void 0;(function(g){g[g.FrontToBack=0]="FrontToBack";g[g.BackToFront=1]="BackToFront"})(k.RenderPassSorting||(k.RenderPassSorting={}));let z=function(){function g(f,a,d=k.RenderPassSorting.FrontToBack){this._rctx=f;this._techniqueRepository=a;this._sorting=d;this._draws=new v({initialSize:32,allocator:e=>
e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var l=g.prototype;l.submitDraw=function(f,a,d,e){const h=this._draws.pushNew();h.geometry=a;h.geometryRanges=d;h.material=f;h.depthSquaredHint=e;h.indexType=(a.indexed?a.vao.indexBuffer.indexType:null)??0};l.prepare=function(f,a){return this._draws.map(d=>d.material.prepareTechnique(this._techniqueRepository,f,a,d.geometry.parameters))};l.dispatch=function(f,
a,d){const e=this._rctx;this._previouslyBoundDraw.clear();let h=null;const x=this._draws.length;for(let m=0;m<x;m++){var b=d[m];if(b!==h||b.configuration.transparencyPassType!==w.TransparencyPassType.NONE)e.bindTechnique(b,f,a),h=b;var c=this._draws.data[m];const r=c.geometry;e.bindVAO(r.vao);this._previouslyBoundDraw.get(b)!==c.material&&(b.program.bindDraw(c.material,a,f),this._previouslyBoundDraw.set(b,c.material));b=c.geometryRanges;const t=b.length;if(0!==c.indexType){const y=n.get(c.indexType);
for(let p=0;p<t;p+=2)e.drawElements(r.primitiveType,b[p+1],c.indexType,b[p]*y)}else for(c=0;c<t;c+=2)e.drawArrays(r.primitiveType,b[c],b[c+1])}};l.prepareSubmit=function(){this._draws.clear()};l.finishSubmit=function(){const f=this._sorting===k.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((a,d)=>{const e=f*(a.depthSquaredHint-d.depthSquaredHint);return 0!==e?e:a.geometry.vao.byteSize-d.geometry.vao.byteSize})};u._createClass(g,[{key:"count",get:function(){return this._draws.length}}]);return g}();
const n=new Map;n.set(q.DataType.UNSIGNED_BYTE,1);n.set(q.DataType.UNSIGNED_SHORT,2);n.set(q.DataType.UNSIGNED_INT,4);k.RenderPass=z;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});