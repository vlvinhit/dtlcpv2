// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../../../../../core/Logger","../../lib/Util"],function(m,g,y,p,z){const u=p.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");p=function(){function b(){this._includedModules=new Map}b.prototype.include=function(e,a){if(this._includedModules.has(e)){const d=this._includedModules.get(e);if(d!==a){u.error("Trying to include shader module multiple times with different sets of options.");
a=new Set;for(const c of Object.keys(d))d[c]!==e[c]&&a.add(c);for(const c of Object.keys(e))d[c]!==e[c]&&a.add(c);a.forEach(c=>console.error(`  ${c}: current ${d[c]} new ${e[c]}`))}}else this._includedModules.set(e,a),e(this.builder,a)};return g._createClass(b)}();let D=function(b){function e(){var d=b.apply(this,arguments)||this;d.vertex=new q;d.fragment=new q;d.attributes=new A;d.varyings=new B;d.extensions=new r;d.constants=new v;return d}g._inherits(e,b);var a=e.prototype;a.generate=function(d){const c=
this.extensions.generateSource(d),f=this.attributes.generateSource(d),n=this.varyings.generateSource(d);var l="vertex"===d?this.vertex:this.fragment;const h=l.uniforms.generateSource(),k=l.code.generateSource();d="vertex"===d?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n\nout vec4 fragColor;";l=this.constants.generateSource().concat(l.constants.generateSource());
return`#version 300 es\n${c.join("\n")}\n\n${d}\n\n${l.join("\n")}\n\n${h.join("\n")}\n\n${f.join("\n")}\n\n${n.join("\n")}\n\n${k.join("\n")}`};a.generateBind=function(d,c){const f=new Map;this.vertex.uniforms.entries.forEach(h=>{const k=h.bind[d];null!=k&&f.set(h.name,k)});this.fragment.uniforms.entries.forEach(h=>{const k=h.bind[d];null!=k&&f.set(h.name,k)});const n=Array.from(f.values()),l=n.length;return(h,k,C)=>{for(let t=0;t<l;++t)n[t](c,h,k,C)}};g._createClass(e,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},
{key:"builder",get:function(){return this}}]);return e}(p),w=function(){function b(){this._entries=new Map}var e=b.prototype;e.add=function(...a){for(const d of a)this._add(d)};e.get=function(a){return this._entries.get(a)};e._add=function(a){if(null==a)u.error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(a.name)&&!this._entries.get(a.name).equals(a))throw new y(`Duplicate uniform name ${a.name} for different uniform type`);this._entries.set(a.name,a)}};e.generateSource=
function(){return Array.from(this._entries.values()).map(a=>null!=a.arraySize?`uniform ${a.type} ${a.name}[${a.arraySize}];`:`uniform ${a.type} ${a.name};`)};g._createClass(b,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return b}(),x=function(){function b(){this._entries=[]}var e=b.prototype;e.add=function(a){this._entries.push(a)};e.generateSource=function(){return this._entries};return g._createClass(b)}(),q=function(b){function e(){var a=b.apply(this,arguments)||
this;a.uniforms=new w;a.code=new x;a.constants=new v;return a}g._inherits(e,b);g._createClass(e,[{key:"builder",get:function(){return this}}]);return e}(p),A=function(){function b(){this._entries=[]}var e=b.prototype;e.add=function(a,d){this._entries.push([a,d])};e.generateSource=function(a){return"fragment"===a?[]:this._entries.map(d=>`in ${d[1]} ${d[0]};`)};return g._createClass(b)}(),B=function(){function b(){this._entries=new Map}var e=b.prototype;e.add=function(a,d){this._entries.has(a)&&z.assert(this._entries.get(a)===
d);this._entries.set(a,d)};e.generateSource=function(a){const d=[];this._entries.forEach((c,f)=>d.push("vertex"===a?`out ${c} ${f};`:`in ${c} ${f};`));return d};return g._createClass(b)}(),r=function(){function b(){this._entries=new Set}var e=b.prototype;e.add=function(a){this._entries.add(a)};e.generateSource=function(a){const d="vertex"===a?b.ALLOWLIST_VERTEX:b.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(c=>d.includes(c)).map(c=>`#extension ${c} : enable`)};return g._createClass(b)}();
r.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];r.ALLOWLIST_VERTEX=[];let v=function(){function b(){this._entries=new Set}var e=b.prototype;e.add=function(a,d,c){let f="ERROR_CONSTRUCTOR_STRING";switch(d){case "float":f=b._numberToFloatStr(c);break;case "int":f=b._numberToIntStr(c);break;case "bool":f=c.toString();break;case "vec2":f=`vec2(${b._numberToFloatStr(c[0])},                            ${b._numberToFloatStr(c[1])})`;break;case "vec3":f=`vec3(${b._numberToFloatStr(c[0])},                            ${b._numberToFloatStr(c[1])},                            ${b._numberToFloatStr(c[2])})`;
break;case "vec4":f=`vec4(${b._numberToFloatStr(c[0])},                            ${b._numberToFloatStr(c[1])},                            ${b._numberToFloatStr(c[2])},                            ${b._numberToFloatStr(c[3])})`;break;case "ivec2":f=`ivec2(${b._numberToIntStr(c[0])},                             ${b._numberToIntStr(c[1])})`;break;case "ivec3":f=`ivec3(${b._numberToIntStr(c[0])},                             ${b._numberToIntStr(c[1])},                             ${b._numberToIntStr(c[2])})`;
break;case "ivec4":f=`ivec4(${b._numberToIntStr(c[0])},                             ${b._numberToIntStr(c[1])},                             ${b._numberToIntStr(c[2])},                             ${b._numberToIntStr(c[3])})`;break;case "mat2":case "mat3":case "mat4":f=`${d}(${Array.prototype.map.call(c,n=>b._numberToFloatStr(n)).join(", ")})`}this._entries.add(`const ${d} ${a} = ${f};`);return this};b._numberToIntStr=function(a){return a.toFixed(0)};b._numberToFloatStr=function(a){return Number.isInteger(a)?
a.toFixed(1):a.toString()};e.generateSource=function(){return Array.from(this._entries)};return g._createClass(b)}();m.Code=x;m.Includes=p;m.ShaderBuilder=D;m.Stage=q;m.Uniforms=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});