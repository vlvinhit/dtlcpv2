// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../../../../chunks/vec2 ./glUtil3D ./SSAOBlurTechnique ./SSAONoiseData ./SSAOTechnique ../../../../chunks/SSAO.glsl ../shaders/SSAOParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),function(n,w,l,x,r,y,z,A,B,C,t,h,u,D,E,F){let G=function(){function p(a,d,c,e){this._view=a;this._techniqueRepository=
d;this._rctx=c;this._requestRender=e;this._quadVAO=null;this._passParameters=new t.SSAOPassParameters;this._drawParameters=new t.BlurDrawParameters}var k=p.prototype;k.dispose=function(){this.enabled=!1;this._quadVAO=l.disposeMaybe(this._quadVAO)};k.destroy=function(){this.dispose()};k.disposeOffscreenBuffers=function(){this._ssaoFBO?.resize(0,0);this._blurFBO?.resize(0,0)};k.render=function(a,d,c,e){if(null!=this._enableTime&&null!=c&&null!=e&&null!=this._ssaoFBO&&null!=this._blurFBO)if(this.active){0===
this._enableTime&&(this._enableTime=d);var b=this._rctx,f=a.camera,g=this._view.qualitySettings.fadeDuration;d=0<g?Math.min(g,d-this._enableTime)/g:1;this._passParameters.normalTexture=e;this._passParameters.depthTexture=c;this._passParameters.projScale=1/f.computeRenderPixelSizeAtDist(1);this._passParameters.intensity=2/C.getRadius(f)**6*d;c=f.fullViewport;e=c[2];f=c[3];g=e/2;var m=f/2;this._ssaoFBO.resize(e,f);this._blurFBO.resize(g,m);null==this._quadVAO&&(this._quadVAO=y.createQuadVAO(this._rctx));
b.bindFramebuffer(this._ssaoFBO);b.setViewport(0,0,e,f);b.bindTechnique(this._ssaoTechnique,this._passParameters,a).bindDraw(this._drawParameters,a,this._passParameters);b.bindVAO(this._quadVAO);var q=F.vertexCount(this._quadVAO,"geometry");b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,q);var v=b.bindTechnique(this._blurTechnique,this._passParameters,a);b.setViewport(0,0,g,m);b.bindFramebuffer(this._blurFBO);this._drawParameters.colorTexture=this._ssaoFBO.colorTexture;r.set(this._drawParameters.blurSize,
0,2/f);v.bindDraw(this._drawParameters,a,this._passParameters);b.setViewport(0,0,g,m);b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,q);b.bindFramebuffer(this._ssaoFBO);b.setViewport(0,0,e,f);b.setClearColor(1,1,1,0);b.clear(h.ClearBufferBit.COLOR_BUFFER_BIT);b.setViewport(0,0,g,m);this._drawParameters.colorTexture=this._blurFBO.colorTexture;r.set(this._drawParameters.blurSize,2/e,0);v.bindDraw(this._drawParameters,a,this._passParameters);b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,q);b.setViewport(c[0],
c[1],c[2],c[3]);1>d&&this._requestRender()}else this._enableTime=d,this._requestRender()};k._enable=function(){if(null==this._enableTime){var a=new E.TextureDescriptor;a.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;this._ssaoFBO=new u.FramebufferObject(this._rctx,a);this._blurFBO=new u.FramebufferObject(this._rctx,a);var d=Uint8Array.from(atob(A.noiseData),c=>c.charCodeAt(0));a.pixelFormat=h.PixelFormat.RGB;a.wrapMode=h.TextureWrapMode.REPEAT;a.hasMipmap=!0;a.width=32;a.height=32;this._passParameters.noiseTexture=
new D.Texture(this._rctx,a,d);null==this._ssaoTechnique&&(this._ssaoTechnique=this._techniqueRepository.acquire(B.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._techniqueRepository.acquire(z.SSAOBlurTechnique));this._enableTime=x.Milliseconds(0);this._requestRender()}};k._disable=function(){this._enableTime=null;this._passParameters.noiseTexture=l.disposeMaybe(this._passParameters.noiseTexture);this._blurFBO=l.disposeMaybe(this._blurFBO);this._ssaoFBO=l.disposeMaybe(this._ssaoFBO)};
w._createClass(p,[{key:"enabled",get:function(){return null!=this._enableTime},set:function(a){a?this._enable():this._disable()}},{key:"active",get:function(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}},{key:"colorTexture",get:function(){return this._ssaoFBO?.colorTexture}},{key:"gpuMemoryUsage",get:function(){return(this._blurFBO?.gpuMemoryUsage??0)+(this._ssaoFBO?.gpuMemoryUsage??0)}}]);return p}();n.SSAOHelper=G;n.blurSizePixels=2;Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})});