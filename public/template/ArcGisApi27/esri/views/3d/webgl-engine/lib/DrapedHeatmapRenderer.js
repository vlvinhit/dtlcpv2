// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(c,r,e,k,y,f,G,H,I,z,A,B,C,n,l,D,E,t,F){c.DrapedHeatmapRenderer=function(u){function m(a){var b=u.call(this,a)||this;b.pixelRatio=1;b._colorRampData=new Uint8ClampedArray(4);b.type="draped-heatmap";b._heatmapParameters=new n.HeatmapPassParameters;var d=new t.TextureDescriptor;d.pixelFormat=a.pixelFormat;d.internalFormat=a.internalFormat;d.dataType=a.dataType;d.samplingMode=a.samplingMode;d.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;const g=a.rendererContext.rctx;b._densityMap=new D.FramebufferObject(g,
d);b._quad=B.createQuadVAO(g);d=new n.HeatmapTechniqueConfiguration;d.usesHalfFloat=a.dataType!==l.PixelType.FLOAT;b._technique=new n.HeatmapTechnique({rctx:g,viewingMode:A.ViewingMode.Local},d);return b}r._inherits(m,u);var p=m.prototype;p.initialize=function(){const a=this._colorRampData,b=new t.TextureDescriptor(a.length/4,1);b.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new E.Texture(this.rctx,b,a);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(y.watch(()=>
[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};p.destroy=function(){this._technique=k.releaseMaybe(this._technique);this._densityMap=k.disposeMaybe(this._densityMap);this._quad=k.disposeMaybe(this._quad);this._colorRamp=k.disposeMaybe(this._colorRamp)};p.render=function(a){const b=this._sortedMaterialRenderers;if(0!==b.length){var d=this.rctx.getBoundFramebufferObject(),g=this.rctx.getViewport(),
{pixelRatio:h}=this,v=Math.ceil(g.width*h);h=Math.ceil(g.height*h);this._densityMap.resize(v,h);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,v,h);this.rctx.clear(l.ClearBufferBit.COLOR_BUFFER_BIT);var w=!1;b.forAll(q=>{if(q.material.shouldRender(a)){const x=q.prepareTechnique(a);null!=x&&(q.render(a,x),w=!0)}});this.rctx.bindFramebuffer(d);this.rctx.setViewport(g.x,g.y,g.width,g.height);w&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,
a.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,F.vertexCount(this._quad,"geometry")))}};r._createClass(m,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(a){a!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=a,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(a){a!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=
a,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(a){a!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=a,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(a){this._heatmapParameters.fieldTotal=a;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(a){const {colorRamp:b}=
this._heatmapParameters;if(null!=b&&a!==this._colorRampData){const d=a.length/4;d!==b.descriptor.width&&b.resize(d,1);b.setData(a)}this._colorRampData=a}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(a){this._heatmapParameters.colorRamp=a}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return m}(C.SortedRenderGeometryRenderer);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,
"searchRadius",null);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"minDensity",null);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"maxDensity",null);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"fieldTotal",null);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"colorRampData",null);e.__decorate([f.property({constructOnly:!0})],c.DrapedHeatmapRenderer.prototype,
"dataType",void 0);e.__decorate([f.property({constructOnly:!0})],c.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);e.__decorate([f.property({constructOnly:!0})],c.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);e.__decorate([f.property({constructOnly:!0})],c.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);e.__decorate([f.property()],c.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);c.DrapedHeatmapRenderer=e.__decorate([z.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],
c.DrapedHeatmapRenderer);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});