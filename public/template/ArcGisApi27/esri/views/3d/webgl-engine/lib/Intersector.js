// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),function(x,v,G,B,g,q,K,L,h,H,n,M,N,C){let R=function(){function d(a){this.options=new n.IntersectorOptions;this._results=new O;this.transform=
new C.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=h.create();this._rayEnd=q.create();this._rayBeginTransformed=q.create();this._rayEndTransformed=q.create();this.viewingMode=null==a?H.ViewingMode.Global:a}var b=d.prototype;b.reset=function(a,c,e){this.resetWithRay(h.fromPoints(a,c,this._ray),e)};b.resetWithRay=function(a,c){this.camera=c;a!==this._ray&&h.copy(a,this._ray);0!==this.options.verticalOffset?this.viewingMode===H.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:
this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;g.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};b.intersect=function(a=null,c,e,r,l){this.point=c;this.filterPredicate=r;this.tolerance=null==e?1E-5:e;c=C.getVerticalOffsetObject3D(this.verticalOffset);if(a&&0<a.length){const p=l?f=>{l(f)&&this.intersectObject(f)}:f=>{this.intersectObject(f)};for(const f of a)a=f.getSpatialQueryAccelerator&&f.getSpatialQueryAccelerator(),null!=a?(null!=
c?a.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,p,c):a.forEachAlongRay(this._ray.origin,this._ray.direction,p),this.options.selectionMode&&this.options.hud&&a.forEachDegenerateObject(p)):f.objects.forAll(D=>p(D))}this.sortResults()};b.intersectObject=function(a){const c=a.geometries;if(c){var e=a.shaderTransformation,r=C.getVerticalOffsetObject3D(this.verticalOffset);for(const l of c){if(!l.visible)continue;const {material:p,id:f}=l;this.transform.setAndInvalidateLazyTransforms(e,
l.shaderTransformation);g.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);g.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const D=this.transform.transform;null!=r&&(r.objectTransform=this.transform);p.intersect(l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,I,J,m,y,P)=>{if(0<=t&&(null==this.filterPredicate||this.filterPredicate(this._ray.origin,this._rayEnd,t))){var k=m?this._results.hud:this._results,
z=m?E=>{const Q=new M.HudTarget(a,f,J,P);E.set(n.IntersectorType.HUD,Q,t,I,B.IDENTITY,y)}:E=>E.set(n.IntersectorType.OBJECT,{object:a,geometryId:f,triangleNr:J},t,I,D,y);(null==k.min.drapedLayerOrder||y>=k.min.drapedLayerOrder)&&(null==k.min.dist||t<k.min.dist)&&z(k.min);this.options.store!==n.StoreResults.MIN&&(null==k.max.drapedLayerOrder||y<k.max.drapedLayerOrder)&&(null==k.max.dist||t>k.max.dist)&&z(k.max);this.options.store===n.StoreResults.ALL&&(m?(m=new F(this._ray),z(m),this._results.hud.all.push(m)):
(m=new u(this._ray),z(m),this._results.all.push(m)))}})}}};b.sortResults=function(a=this._results.all){a.sort((c,e)=>c.dist!==e.dist?(c.dist??0)-(e.dist??0):c.drapedLayerOrder!==e.drapedLayerOrder?(c.drapedLayerOrder??Number.MAX_VALUE)-(e.drapedLayerOrder??Number.MAX_VALUE):(e.drapedLayerGraphicOrder??Number.MIN_VALUE)-(c.drapedLayerGraphicOrder??Number.MIN_VALUE))};v._createClass(d,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",
get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return d}(),O=function(){function d(){this.min=new u(h.create());this.max=new u(h.create());this.hud={min:new F(h.create()),max:new F(h.create()),all:[]};this.ground=new u(h.create());this.all=[]}d.prototype.init=function(b){this.min.init(b);this.max.init(b);this.ground.init(b);this.all.length=0;this.hud.min.init(b);this.hud.max.init(b);this.hud.all.length=0};return v._createClass(d)}(),u=function(){function d(a){this.intersector=
n.IntersectorType.OBJECT;this.normal=q.create();this.transformation=B.create();this._ray=h.create();this.init(a)}var b=d.prototype;b.getIntersectionPoint=function(a){if(!N.isValidIntersectorResult(this))return!1;g.scale(A,this.ray.direction,this.dist);g.add(a,this.ray.origin,A);return!0};b.getTransformedNormal=function(a){g.copy(w,this.normal);w[3]=0;K.transformMat4(w,w,this.transformation);g.copy(a,w);return g.normalize(a,a)};b.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.target=this.dist=null;this.intersector=n.IntersectorType.OBJECT;h.copy(a,this._ray)};b.set=function(a,c,e,r,l,p,f){this.intersector=a;this.dist=e;g.copy(this.normal,r??q.UNIT_Z);G.copy(this.transformation,l??B.IDENTITY);this.target=c;this.drapedLayerOrder=p;this.drapedLayerGraphicOrder=f};b.copy=function(a){h.copy(a.ray,this._ray);this.intersector=a.intersector;this.dist=a.dist;this.target=a.target;this.drapedLayerOrder=a.drapedLayerOrder;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;
g.copy(this.normal,a.normal);G.copy(this.transformation,a.transformation)};v._createClass(d,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return null!=this.dist?(g.scale(A,this.ray.direction,this.dist),g.length(A)):null}}]);return d}(),F=function(d){function b(){var a=d.apply(this,arguments)||this;a.intersector=n.IntersectorType.HUD;return a}v._inherits(b,d);return v._createClass(b)}(u);const A=q.create(),w=L.create();x.DEFAULT_TOLERANCE=1E-5;x.newIntersector=
function(d){return new R(d)};x.newIntersectorResult=function(d){return new u(d)};Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});