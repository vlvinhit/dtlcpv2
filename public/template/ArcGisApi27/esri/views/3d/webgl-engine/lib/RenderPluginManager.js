// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./depthRange ./Material ./RenderSlot".split(" "),function(e,h,g,r,t,k,l,z,A,B,u,v,w,m){e.RenderPluginManager=function(n){function f(b){var a=
n.call(this,{})||this;a._context=b;a._renderPlugins=new t;a._slots=[];for(b=0;b<m.RenderSlot.MAX_SLOTS;++b)a._slots[b]=[];return a}h._inherits(f,n);var d=f.prototype;d.normalizeCtorArgs=function(){return{}};d.add=function(b,a,c){const p=()=>{if(c?.aborted)throw a.uninitializeRenderContext(),k.createAbortError();this._renderPlugins.push(a);for(const x of b)this._slots[x].push(a);this._context.requestRender()},q=a.initializeRenderContext(this._context,c);if(k.isPromiseLike(q))return q.then(p);p();this.notifyChange("_renderPlugins")};
d.remove=function(b){if(null!=this._renderPlugins.removeUnordered(b)){for(let a=0;a<this._slots.length;++a)this._slots[a]=this._slots[a].filter(c=>c!==b);b.uninitializeRenderContext();this._context.requestRender();this.notifyChange("_renderPlugins")}};d.prepareRender=function(){this._renderPlugins.forAll(b=>{b.prepareRender&&b.prepareRender(this._context.renderContext)})};d.updateAnimation=function(b){let a=!1;this._renderPlugins.forAll(c=>{c.updateAnimation&&(a=c.updateAnimation(b)||a)});return a};
d.prepareSlots=function(b){for(const a of b)this._context.renderContext.bindParameters.slot=a,this._slots[a].filter(c=>{c.canRender&&("prepareTechnique"in c&&c.prepareTechnique(this._context.renderContext),"prepareTechniques"in c&&c.prepareTechniques(this._context.renderContext))})};d.render=function(){const b=[];this._slots[this._context.renderContext.bindParameters.slot].filter(a=>{if(!a.canRender)return!1;if("prepareTechnique"in a)return a=a.prepareTechnique(this._context.renderContext),null!=
a?(b.push(a),!0):!1;if("prepareTechniques"in a)return a=a.prepareTechniques(this._context.renderContext),null!=a?(b.push(a),!0):!1;b.push(null);return!0}).forEach((a,c)=>a.render(this._context.renderContext,b[c]))};d.queryDepthRange=function(b){const a=y;a.near=Infinity;a.far=-Infinity;this._renderPlugins.forAll(c=>{c.queryDepthRange&&(c=c.queryDepthRange(b))&&v.union(a,c,a)});return a};h._createClass(f,[{key:"updating",get:function(){return this._renderPlugins.some(b=>b.running)}},{key:"needsTransparentPass",
get:function(){return this._renderPlugins.some(b=>b.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this._renderPlugins.some(b=>b.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(b=>b.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const b=this._slots[m.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!b&&0<b.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((b,a)=>b|a.renderOccludedFlags,
w.RenderOccludedFlag.None)}}]);return f}(r);g.__decorate([l.property()],e.RenderPluginManager.prototype,"_renderPlugins",void 0);g.__decorate([l.property({readOnly:!0})],e.RenderPluginManager.prototype,"updating",null);e.RenderPluginManager=g.__decorate([u.subclass("esri.views.3d.webgl-engine.lib.RenderPluginManager")],e.RenderPluginManager);const y={near:0,far:0};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});