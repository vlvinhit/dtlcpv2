// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(h,k,r,t,u,m,l,n,v,w,p){l=function(e){function f(a,b,g=""){var c=e.call(this)||this;c.stage=a;c.apiLayerUid=g;c.type=n.ContentObjectType.Layer;c.events=new r;c.sliceable=!1;c._objects=new m;c._objectsAdded=new m;c._handles=new t;c.apiLayerUid=g;
c.visible=b?.visible??!0;c.pickable=b?.pickable??!0;c.updatePolicy=b?.updatePolicy??p.UpdatePolicy.ASYNC;c._disableOctree=b?.disableOctree??!1;a.add(k._assertThisInitialized(c));for(const q of v.DirtyEventNames)c._handles.add(c.events.on(q,x=>a.handleEvent(q,x)));return c}k._inherits(f,e);var d=f.prototype;d.destroy=function(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())};d.add=function(a){this._objects.push(a);a.parentLayer=this;this.events.emit("layerObjectAdded",
{layer:this,object:a});null!=this._octree&&this._objectsAdded.push(a)};d.remove=function(a){this._objects.removeUnordered(a)&&(a.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:a}),null!=this._octree&&(this._objectsAdded.removeUnordered(a)||this._octree.remove([a])))};d.addMany=function(a){this._objects.pushArray(a);for(const b of a)b.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:a});null!=this._octree&&this._objectsAdded.pushArray(a)};d.removeMany=
function(a){const b=[];this._objects.removeUnorderedMany(a,a.length,b);if(0!==b.length){for(const g of b)g.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:b});if(null!=this._octree){for(a=0;a<b.length;)this._objectsAdded.removeUnordered(b[a])?(b[a]=b[b.length-1],--b.length):++a;this._octree.remove(b)}}};d.sync=function(){this.updatePolicy!==p.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)};d.notifyObjectBBChanged=function(a,b){null==this._octree||this._objectsAdded.includes(a)||
this._octree.update(a,b)};d.getSpatialQueryAccelerator=function(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new w(a=>a.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree};d.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",
this)};d.invalidateSpatialQueryAccelerator=function(){this._octree=u.destroyMaybe(this._octree);this._objectsAdded.clear()};k._createClass(f,[{key:"objects",get:function(){return this._objects}}]);return f}(l.ContentObject);h.WebGLLayer=l;h.isWebGLLayer=function(e){return null!=e&&e.type===n.ContentObjectType.Layer};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});