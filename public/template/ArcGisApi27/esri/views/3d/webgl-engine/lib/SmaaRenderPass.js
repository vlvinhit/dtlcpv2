// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../core/shaderTechnique/ShaderTechniqueConfiguration ./BlendWeightsTechnique ./BlurTechnique ./EdgeDetectTechnique ./glUtil3D ../shaders/SMAAPassParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(v,h,q,m,w,k,n,r,G,H,I,x,y,z,A,B,C,D,E,d,t,F,p){h.SmaaRenderPass=function(u){function l(b,c){var a=u.call(this,{})||this;a._rctx=b;a._techniqueRep=c;a._passParameters=new E.SMAAPassParameters;a._isEnabled=!1;return a}q._inherits(l,u);var g=l.prototype;g.normalizeCtorArgs=function(){return{}};g.dispose=function(){this._abortController=k.abortMaybe(this._abortController);this.disable()};g._loadResources=function(b){if(null!=this._abortController)return!1;if(null!=this._passParameters.searchTexture)return!0;
this._abortController=new AbortController;const c=this._abortController.signal;(new Promise((a,e)=>v(["./SmaaRenderPassData"],a,e))).then(a=>this._loadTextures(a,c)).then(()=>b()).finally(()=>this._abortController=null);return!1};g._loadTextures=function(b,c){n.throwIfAborted(c);return Promise.all([this._loadTextureFromBase64(b.areaTexture,d.TextureSamplingMode.LINEAR,d.PixelFormat.RGB),this._loadTextureFromBase64(b.searchTexure,d.TextureSamplingMode.NEAREST,d.PixelFormat.LUMINANCE)]).then(([a,e])=>
{n.isAborted(c)?(a.dispose(),e.dispose(),n.throwIfAborted(c)):(this._passParameters.areaTexture=a,this._passParameters.searchTexture=e)})};g.enable=function(b){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const c=new z.ShaderTechniqueConfiguration;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(C.EdgeDetectTechnique,c,this._edgeDetectTechnique);this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(A.BlendWeightsTechnique,
c,this._blendWeightsTechnique);this._blurTechnique=this._techniqueRep.releaseAndAcquire(B.BlurTechnique,c,this._blurTechnique)}if(!this._loadResources(b))return!1;this._vao=D.createScreenSizeTriangleVAO(this._rctx);b=new p.TextureDescriptor(4,4);b.pixelFormat=d.PixelFormat.RG;b.internalFormat=d.SizedPixelFormat.RG8;b.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;this._passParameters.edges=new t.FramebufferObject(this._rctx,b);b=new p.TextureDescriptor(4,4);b.pixelFormat=d.PixelFormat.RGBA;b.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;
this._passParameters.blend=new t.FramebufferObject(this._rctx,b);return this._isEnabled=!0};g.disable=function(){this._isEnabled&&(this._vao=k.disposeMaybe(this._vao),this._passParameters.areaTexture=k.disposeMaybe(this._passParameters.areaTexture),this._passParameters.searchTexture=k.disposeMaybe(this._passParameters.searchTexture),this._passParameters.blend=k.disposeMaybe(this._passParameters.blend),this._passParameters.edges=k.disposeMaybe(this._passParameters.edges),this._isEnabled=!1)};g.render=
function(b){const c=this._validPassParameters;if(null!=c){c.colorTexture=b;var a=this._rctx,e=a.getBoundFramebufferObject(),f=b.descriptor.width;b=b.descriptor.height;a.bindVAO(this._vao);a.setViewport(0,0,f,b);c.edges.resize(f,b);a.bindFramebuffer(c.edges);a.setClearColor(0,0,0,1);a.clear(d.ClearBufferBit.COLOR_BUFFER_BIT);a.bindTechnique(this._edgeDetectTechnique,c,null);a.drawArrays(d.PrimitiveType.TRIANGLES,0,3);c.blend.resize(f,b);a.bindFramebuffer(c.blend);a.setClearColor(0,0,1,1);a.clear(d.ClearBufferBit.COLOR_BUFFER_BIT);
a.bindTechnique(this._blendWeightsTechnique,c,null);a.drawArrays(d.PrimitiveType.TRIANGLES,0,3);a.bindFramebuffer(e);a.setClearColor(0,1,0,1);a.clear(d.ClearBufferBit.COLOR_BUFFER_BIT);a.bindTechnique(this._blurTechnique,c,null);a.drawArrays(d.PrimitiveType.TRIANGLES,0,3)}};g._loadTextureFromBase64=function(b,c,a){return y.requestImage(b).then(e=>{const f=new p.TextureDescriptor;f.pixelFormat=a;f.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;f.width=e.width;f.height=e.height;f.samplingMode=c;return new F.Texture(this._rctx,
f,e)})};q._createClass(l,[{key:"updating",get:function(){return null!=this._abortController}},{key:"_validPassParameters",get:function(){return this._isEnabled?this._passParameters:null}}]);return l}(w);m.__decorate([r.property()],h.SmaaRenderPass.prototype,"_abortController",void 0);m.__decorate([r.property({readOnly:!0})],h.SmaaRenderPass.prototype,"updating",null);h.SmaaRenderPass=m.__decorate([x.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],h.SmaaRenderPass);Object.defineProperty(h,
Symbol.toStringTag,{value:"Module"})});