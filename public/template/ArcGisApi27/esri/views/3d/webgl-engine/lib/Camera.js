// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(b,D,g,G,H,u,E,k,N,O,P,I,n,r,F,J,f,t,l,v,z,K,L,M,w){var A;b.Camera=A=function(p){function x(a={}){a=p.call(this,a)||this;a._center=t.create();a._up=t.create();a._viewUp=t.create();a._viewForward=t.create();a._viewRight=t.create();a._ray=K.create();a._viewport=v.fromValues(0,0,1,1);a._padding=v.fromValues(0,0,0,0);a._fov=55/180*Math.PI;a._nearFar=J.fromValues(1,1E3);a._viewDirty=!0;a._viewMatrix=r.create();a._viewProjectionDirty=!0;a._viewProjectionMatrix=r.create();a._viewInverseTransposeMatrixDirty=
!0;a._viewInverseTransposeMatrix=r.create();a._frustumDirty=!0;a._frustum=z.create();a._fullViewport=v.create();a._pixelRatio=1;a.relativeElevation=0;return a}D._inherits(x,p);var h=x.prototype;h.depthNDCToWorld=function(a){return 2*this.near*this.far/(this.far+this.near-(2*a-1)*(this.far-this.near))};h.copyFrom=function(a){f.copy(this._ray.origin,a.eye);this.center=a.center;this.up=a.up;l.copy(this._viewport,a.viewport);this.notifyChange("_viewport");l.copy(this._padding,a.padding);this.notifyChange("_padding");
F.copy(this._nearFar,a.nearFar);this.notifyChange("_nearFar");this._fov=a.fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(n.copy(this._viewMatrix,a.viewMatrix),f.copy(this._viewRight,a.viewRight),f.copy(this._viewUp,a.viewUp),f.copy(this._viewForward,a.viewForward));this._viewProjectionDirty=!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(z.copy(this._frustum,a.frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=
!0:(n.copy(this._viewInverseTransposeMatrix,a.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);l.copy(this._fullViewport,a.fullViewport);this.pixelRatio=a.pixelRatio;return this};h.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};h.clone=function(){return(new A).copyFrom(this)};h.equals=function(a){return f.exactEquals(this.eye,a.eye)&&f.exactEquals(this.center,a.center)&&f.exactEquals(this.up,a.up)&&l.exactEquals(this._viewport,a.viewport)&&l.exactEquals(this._padding,
a.padding)&&F.exactEquals(this.nearFar,a.nearFar)&&this._fov===a.fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};h.almostEquals=function(a){if(.001<=Math.abs(a.fov-this._fov)||1<=l.squaredDistance(a.screenPadding,this.screenPadding)||1<=l.squaredDistance(this.screenViewport,a.screenViewport))return!1;f.sub(m,a.eye,a.center);f.sub(B,this.eye,this.center);const c=f.dot(m,B),e=f.sqrLen(m),q=f.sqrLen(B);return c*c>=(1-1E-10)*e*q&&f.sqrDist(a.eye,this.eye)<2.5E-7*Math.max(e,
q)};h.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(a))};h.computeRenderPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};h.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(a))};h._viewDirectionDistance=function(a){return Math.abs(L.projectPointSignedLength(this.viewForward,f.subtract(m,a,this.eye)))};h.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};
h.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};h.getScreenCenter=function(a=E.createScreenPointArray()){a[0]=(this.padding[b.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;a[1]=(this.padding[b.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return a};h.getRenderCenter=function(a,c=.5,e=.5){a[0]=this.padding[b.PaddingSide.LEFT]+this.width*c;a[1]=this.padding[b.PaddingSide.BOTTOM]+this.height*e;a[2]=.5;return a};h.setGLViewport=function(a){const c=
this.viewport,e=this.padding;a.setViewport(c[0]-e[3],c[1]-e[2],c[2]+e[1]+e[3],c[3]+e[0]+e[2])};h.applyProjection=function(a,c){a!==d&&f.copy(d,a);d[3]=1;l.transformMat4(d,d,this.projectionMatrix);a=Math.abs(d[3]);f.scale(d,d,1/a);const e=this.fullViewport;c[0]=u.lerp(0,e[0]+e[2],.5+.5*d[0]);c[1]=u.lerp(0,e[1]+e[3],.5+.5*d[1]);c[2]=.5*(d[2]+1);c[3]=a};h.unapplyProjection=function(a,c){const e=this.fullViewport;d[0]=(a[0]/(e[0]+e[2])*2-1)*a[3];d[1]=(a[1]/(e[1]+e[3])*2-1)*a[3];d[2]=(2*a[2]-1)*a[3];d[3]=
a[3];null!=this.inverseProjectionMatrix&&(l.transformMat4(d,d,this.inverseProjectionMatrix),c[0]=d[0],c[1]=d[1],c[2]=d[2])};h.projectToScreen=function(a,c){this.projectToRenderScreen(a,C);this.renderToScreen(C,c);return c};h.projectToRenderScreen=function(a,c){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1;l.transformMat4(d,d,this.viewProjectionMatrix);if(0===d[3])return null;f.scale(d,d,1/Math.abs(d[3]));a=this.fullViewport;"x"in c?(c.x=u.lerp(0,a[0]+a[2],.5+.5*d[0]),c.y=u.lerp(0,a[1]+a[3],.5+.5*d[1])):(c[0]=
u.lerp(0,a[0]+a[2],.5+.5*d[0]),c[1]=u.lerp(0,a[1]+a[3],.5+.5*d[1]),2<c.length&&(c[2]=.5*(d[2]+1)));return c};h.unprojectFromScreen=function(a,c){return this.unprojectFromRenderScreen(this.screenToRender(a,C),c)};h.unprojectFromRenderScreen=function(a,c){n.multiply(y,this.projectionMatrix,this.viewMatrix);if(!n.invert(y,y))return null;const e=this.fullViewport;d[0]=2*(a[0]-e[0])/e[2]-1;d[1]=2*(a[1]-e[1])/e[3]-1;d[2]=2*a[2]-1;d[3]=1;l.transformMat4(d,d,y);if(0===d[3])return null;c[0]=d[0]/d[3];c[1]=
d[1]/d[3];c[2]=d[2]/d[3];return c};h.constrainWindowSize=function(a,c,e,q){a*=this.pixelRatio;c*=this.pixelRatio;return[Math.max(a-e/2,0),Math.max(this.fullHeight-c-q/2,0),e- -Math.min(a-e/2,0)- -Math.min(this.fullWidth-a-e/2,0),q- -Math.min(this.fullHeight-c-q/2,0)- -Math.min(c-q/2,0)]};h.computeUp=function(a){a===M.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};h.screenToRender=function(a,c){const e=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=e;return c};
h.renderToScreen=function(a,c){const e=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=e};h._computeUpGlobal=function(){f.subtract(m,this.center,this.eye);const a=f.length(this.center);1>a?(f.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(f.dot(m,this.center))>.9999*f.length(m)*a||(f.cross(this._up,m,this.center),f.cross(this._up,this._up,m),f.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};h._computeUpLocal=function(){f.direction(m,
this.eye,this.center);.9999>=Math.abs(m[2])&&(f.scale(m,m,m[2]),f.set(this._up,-m[0],-m[1],1-m[2]),f.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};h._compareAndSetView=function(a,c,e=""){"number"===typeof a[0]&&isFinite(a[0])&&"number"===typeof a[1]&&isFinite(a[1])&&"number"===typeof a[2]&&isFinite(a[2])?f.exactEquals(a,c)||(f.copy(c,a),this._markViewDirty(),e.length&&this.notifyChange(e)):H.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")};
h._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};h._recomputeFrustum=function(){this._frustumDirty&&(z.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};h._ensureViewClean=function(){this._viewDirty&&(n.lookAt(this._viewMatrix,this.eye,this.center,this.up),f.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),f.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),
f.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};D._createClass(x,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(a){this._pixelRatio=0<a?a:1}},{key:"eye",get:function(){return this._ray.origin},set:function(a){this._compareAndSetView(a,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center,"_center")}},{key:"ray",
get:function(){f.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up,"_up")}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){n.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},
{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(a){this._nearFar[0]!==a&&(this._nearFar[0]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(a){this._nearFar[1]!==a&&(this._nearFar[1]=
a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;const a=l.scale(v.create(),this._viewport,1/this.pixelRatio),c=this._get("screenViewport");return c&&l.equals(a,c)?c:a}},{key:"screenPadding",get:function(){if(1===this.pixelRatio)return this._padding;const a=
l.scale(v.create(),this._padding,1/this.pixelRatio),c=this._get("screenPadding");return c&&l.equals(a,c)?c:a}},{key:"x",get:function(){return this._viewport[0]},set:function(a){a+=this._padding[b.PaddingSide.LEFT];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(a){a+=this._padding[b.PaddingSide.BOTTOM];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=
this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+
this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT]},set:function(a){this.width=a-(this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]},set:function(a){this.height=a-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[b.PaddingSide.LEFT];
this._fullViewport[1]=this._viewport[1]-this._padding[b.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"_aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(a){l.exactEquals(this._padding,a)||(this._viewport[0]+=a[b.PaddingSide.LEFT]-this._padding[b.PaddingSide.LEFT],this._viewport[1]+=a[b.PaddingSide.BOTTOM]-this._padding[b.PaddingSide.BOTTOM],this._viewport[2]-=
a[b.PaddingSide.RIGHT]+a[b.PaddingSide.LEFT]-(this._padding[b.PaddingSide.RIGHT]+this._padding[b.PaddingSide.LEFT]),this._viewport[3]-=a[b.PaddingSide.TOP]+a[b.PaddingSide.BOTTOM]-(this._padding[b.PaddingSide.TOP]+this._padding[b.PaddingSide.BOTTOM]),l.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(n.multiply(this._viewProjectionMatrix,this.projectionMatrix,
this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){var a=this.width,c=this.height;const e=this.near*Math.tan(this.fovY/2),q=e*this._aspect;a=n.frustum(r.create(),-q*(1+2*this._padding[b.PaddingSide.LEFT]/a),q*(1+2*this._padding[b.PaddingSide.RIGHT]/a),-e*(1+2*this._padding[b.PaddingSide.BOTTOM]/c),e*(1+2*this._padding[b.PaddingSide.TOP]/c),this.near,this.far);return(c=this._get("projectionMatrix"))&&n.equals(c,a)?c:a}},{key:"inverseProjectionMatrix",
get:function(){return n.invert(r.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||r.create()}},{key:"fov",get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovX",get:function(){return w.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=w.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovY",get:function(){return w.fovd2fovy(this._fov,this.width,
this.height)},set:function(a){this._fov=w.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"distance",get:function(){return f.distance(this.center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)n.invert(this._viewInverseTransposeMatrix,this.viewMatrix),n.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&0<=this.relativeElevation}}]);return x}(G);g.__decorate([k.property()],b.Camera.prototype,"_center",void 0);g.__decorate([k.property()],b.Camera.prototype,"_up",void 0);
g.__decorate([k.property()],b.Camera.prototype,"_viewport",void 0);g.__decorate([k.property()],b.Camera.prototype,"_padding",void 0);g.__decorate([k.property()],b.Camera.prototype,"_fov",void 0);g.__decorate([k.property()],b.Camera.prototype,"_nearFar",void 0);g.__decorate([k.property()],b.Camera.prototype,"_pixelRatio",void 0);g.__decorate([k.property()],b.Camera.prototype,"pixelRatio",null);g.__decorate([k.property()],b.Camera.prototype,"eye",null);g.__decorate([k.property()],b.Camera.prototype,
"center",null);g.__decorate([k.property()],b.Camera.prototype,"up",null);g.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"nearFar",null);g.__decorate([k.property()],b.Camera.prototype,"near",null);g.__decorate([k.property()],b.Camera.prototype,"far",null);g.__decorate([k.property()],b.Camera.prototype,"viewport",null);g.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"screenViewport",null);g.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"screenPadding",null);g.__decorate([k.property()],
b.Camera.prototype,"x",null);g.__decorate([k.property()],b.Camera.prototype,"y",null);g.__decorate([k.property()],b.Camera.prototype,"width",null);g.__decorate([k.property()],b.Camera.prototype,"height",null);g.__decorate([k.property()],b.Camera.prototype,"fullWidth",null);g.__decorate([k.property()],b.Camera.prototype,"fullHeight",null);g.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"_aspect",null);g.__decorate([k.property()],b.Camera.prototype,"padding",null);g.__decorate([k.property({readOnly:!0})],
b.Camera.prototype,"projectionMatrix",null);g.__decorate([k.property({readOnly:!0})],b.Camera.prototype,"inverseProjectionMatrix",null);g.__decorate([k.property()],b.Camera.prototype,"fov",null);g.__decorate([k.property()],b.Camera.prototype,"fovX",null);g.__decorate([k.property()],b.Camera.prototype,"fovY",null);b.Camera=A=g.__decorate([I.subclass("esri.views.3d.webgl-engine.lib.Camera")],b.Camera);const d=v.create(),y=r.create(),m=t.create(),B=t.create(),C=E.createRenderScreenPointArray3();b.PaddingSide=
void 0;(function(p){p[p.TOP=0]="TOP";p[p.RIGHT=1]="RIGHT";p[p.BOTTOM=2]="BOTTOM";p[p.LEFT=3]="LEFT"})(b.PaddingSide||(b.PaddingSide={}));Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});