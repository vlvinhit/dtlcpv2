// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),function(g,n,d,h,e,p,q,r,t,k,u){let v=function(){function f(a,b){this._rctx=a;this._viewingMode=b;this._maxOpacity=1;this._passParameters=new k.ShadowHighlightPassParameters;this._drawParameters=
new r.ReadShadowMapDrawParameters;this._vao=t.createQuadVAO(this._rctx)}var c=f.prototype;c.render=function(a,b){if(a.shadowMap.enabled&&a.linearDepthTexture&&this.isVisible){var l=this._technique;this._drawParameters.origin=a.camera.center;this._rctx.bindFramebuffer(b);this._rctx.bindTechnique(l,this._passParameters,a).bindDraw(this._drawParameters,a,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(l.primitiveType,0,u.vertexCount(this._vao,"geometry"))}};c.setDefaultOptions=
function(a){this._passParameters={...this._passParameters,...a};this._updateMaxOpacity()};c.updateParameters=function(a,b){this._passParameters.opacityElevation=1-d.smoothstep(4E4,5E4,a.relativeElevation);a=this._viewingMode===q.ViewingMode.Global?e.normalize(m,a.center):e.set(m,0,0,1);b=e.dot(a,b);this._passParameters.dayNightTerminator=d.smoothstep(0,1,d.clamp(30*b,0,1))};c.dispose=function(){this._vao=h.disposeMaybe(this._vao);this._techniqueCached=h.releaseMaybe(this._techniqueCached)};c._updateMaxOpacity=
function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};n._createClass(f,[{key:"_technique",get:function(){null==this._techniqueCached&&(this._techniqueCached=new k.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._techniqueCached}},{key:"gpuMemoryUsage",get:function(){return this._vao?.memoryEstimate??0}},{key:"isVisible",get:function(){const {opacityElevation:a,
dayNightTerminator:b}=this._passParameters;return.001953125<=this._maxOpacity*a*b}}]);return f}();const m=p.create();g.ShadowHighlight=v;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});