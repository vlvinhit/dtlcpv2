// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(A,u,v,x,h,t,G,H,B,z,I,C,J,y){z=function(k){function q(a={}){var b=k.call(this)||this;b.type=I.ContentObjectType.Object;b._hasVolatileTransformation=!1;b._parentLayer=
null;b._visible=!0;b.castShadow=a.castShadow??!0;b.usesVerticalDistanceToGround=a.usesVerticalDistanceToGround??!1;b.graphicUid=a.graphicUid;b.layerUid=a.layerUid;a.isElevationSource&&(b.lastValidElevationBB=new D);b._geometries=a.geometries?Array.from(a.geometries):[];return b}u._inherits(q,k);var d=q.prototype;d.clearShaderTransformation=function(){this._shaderTransformation=void 0;this._invalidateBoundingVolume();this._emit("objectShaderTransformation",this)};d.dispose=function(){this._geometries.length=
0};d.addGeometry=function(a){a.visible=this._visible;this._geometries.push(a);this._hasVolatileTransformation=this._hasVolatileTransformation||a.hasVolatileTransformation;this._emit("objectGeometryAdded",{object:this,geometry:a});this._invalidateBoundingVolume()};d.removeGeometry=function(a){if(a=this._geometries.splice(a,1)[0])this._emit("objectGeometryRemoved",{object:this,geometry:a}),this._invalidateBoundingVolume()};d.removeAllGeometries=function(){for(;0<this._geometries.length;)this.removeGeometry(0)};
d.geometryVertexAttrsUpdated=function(a){this._emit("objectGeometryUpdated",{object:this,geometry:a});this._invalidateBoundingVolume()};d.maskOccludee=function(){const a=new C.Object3DStateID(B.Object3DState.MaskOccludee);for(const b of this._geometries)b.occludees=y.addObject3DStateID(b.occludees,a);this._emit("occlusionChanged",this);return a};d.removeOcclude=function(a){for(const b of this._geometries)b.occludees=y.removeObject3DStateID(b.occludees,a);this._emit("occlusionChanged",this)};d.highlight=
function(){const a=new C.Object3DStateID(B.Object3DState.Highlight);for(const b of this._geometries)b.highlights=y.addObject3DStateID(b.highlights,a);this._emit("highlightChanged",this);return a};d.removeHighlight=function(a){for(const b of this._geometries)b.highlights=y.removeObject3DStateID(b.highlights,a);this._emit("highlightChanged",this)};d.getCombinedStaticTransformation=function(a,b){return v.multiply(b,this.transformation,a.transformation)};d.getCombinedShaderTransformation=function(a,b=
x.create()){return v.multiply(b,this.shaderTransformation,a.shaderTransformation)};d.hasVolativeTransformation=function(){return this._hasVolatileTransformation};d._validateBoundingVolume=function(a,b){b=b===w.ObjectSpace;for(var r of this._geometries){var p=r.boundingInfo;if(p){var e=a,m=b?r.shaderTransformation:this.getCombinedShaderTransformation(r),c=p.bbMin;p=p.bbMax;if(v.hasIdentityRotation(m))for(m=h.set(K,m[12],m[13],m[14]),h.add(l,c,m),h.add(n,p,m),c=0;3>c;++c)e.min[c]=Math.min(e.min[c],
l[c]),e.max[c]=Math.max(e.max[c],n[c]);else if(h.transformMat4(l,c,m),h.exactEquals(c,p))for(c=0;3>c;++c)e.min[c]=Math.min(e.min[c],l[c]),e.max[c]=Math.max(e.max[c],l[c]);else{h.transformMat4(n,p,m);for(var f=0;3>f;++f)e.min[f]=Math.min(e.min[f],l[f],n[f]),e.max[f]=Math.max(e.max[f],l[f],n[f]);for(f=0;3>f;++f){h.copy(l,c);h.copy(n,p);l[f]=p[f];n[f]=c[f];h.transformMat4(l,l,m);h.transformMat4(n,n,m);for(let g=0;3>g;++g)e.min[g]=Math.min(e.min[g],l[g],n[g]),e.max[g]=Math.max(e.max[g],l[g],n[g])}}}}h.lerp(a.bounds,
a.min,a.max,.5);for(const g of this._geometries)r=g.boundingInfo,null!=r&&(c=b?g.shaderTransformation:this.getCombinedShaderTransformation(g),e=H.maxScale(c),h.transformMat4(E,r.center,c),c=h.distance(E,a.bounds),a.bounds[3]=Math.max(a.bounds[3],c+r.radius*e))};d._invalidateBoundingVolume=function(){const a=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&a&&this._parentLayer.notifyObjectBBChanged(this,a)};d._emit=function(a,b){this._parentLayer&&this._parentLayer.events.emit(a,
b)};u._createClass(q,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation??x.IDENTITY},set:function(a){this._transformation=v.copy(this._transformation??x.create(),a);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"shaderTransformation",get:function(){return this._shaderTransformation??this.transformation},set:function(a){this._shaderTransformation=v.copy(this._shaderTransformation??x.create(),
a);this._invalidateBoundingVolume();this._emit("objectShaderTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(a){J.assert(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a}},{key:"visible",get:function(){return this._visible},set:function(a){if(this._visible!==a){this._visible=a;for(const b of this._geometries)b.visible=this._visible;this._emit("visibilityChanged",this)}}},{key:"boundingVolumeWorldSpace",
get:function(){if(!this._bvWorldSpace||this._hasVolatileTransformation)this._bvWorldSpace=this._bvWorldSpace||new F,this._validateBoundingVolume(this._bvWorldSpace,w.WorldSpace);return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){if(!this._bvObjectSpace||this._hasVolatileTransformation)this._bvObjectSpace=this._bvObjectSpace||new F,this._validateBoundingVolume(this._bvObjectSpace,w.ObjectSpace);return this._bvObjectSpace}},{key:"test",get:function(){const a=this;return{hasGeometry:b=>
a._geometries.includes(b),getGeometryIndex:b=>a._geometries.indexOf(b)}}}]);return q}(z.ContentObject);let D=function(){function k(){this.min=t.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=t.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}k.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return u._createClass(k)}(),F=function(k){function q(){var d=k.apply(this,arguments)||this;d.bounds=G.create();
return d}u._inherits(q,k);return u._createClass(q)}(D);const K=t.create(),l=t.create(),n=t.create(),E=t.create();var w;(function(k){k[k.WorldSpace=0]="WorldSpace";k[k.ObjectSpace=1]="ObjectSpace"})(w||(w={}));A.Object3D=z;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});