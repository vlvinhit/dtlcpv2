// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(l,q,r,m,g,t,n,p){const u={dataType:g.PixelType.UNSIGNED_BYTE,internalFormat:g.PixelFormat.RGBA},v={};let w=function(){function k(a){this._rctx=a;this._activeTargets=new Set;this._colorTextures=new Map;this._depthTextures=new Map;this._fbos=new Map}var f=k.prototype;
f.dispose=function(){this._depthTextures.forEach(a=>a.dispose());this._depthTextures.clear();this._colorTextures.forEach(a=>a.dispose());this._colorTextures.clear();this._fbos.forEach(a=>a.dispose());this._fbos.clear();this._activeTargets.clear()};f.disposeTargetResource=function(a){a=a.id;this._activeTargets.has(a)&&(this._activeTargets.delete(a),this._disposeWithFramebuffers(this._depthTextures,a),this._disposeWithFramebuffers(this._colorTextures,a))};f._disposeWithFramebuffers=function(a,c){const d=
a.get(c);d&&(this._fbos.forEach((b,h)=>{if(b.colorTexture===d||b.depthStencilAttachment===d)b.detachColorTexture(),b.detachDepthStencilTexture(),b.dispose(),this._fbos.delete(h)}),d.dispose(),a.delete(c))};f._getDepthTexture=function(a,c,d){let b=this._depthTextures.get(a.id);!b||b.descriptor.width===c&&b.descriptor.height===d||(b.dispose(),b=null);b||(c=new p.TextureDescriptor(c,d),c.pixelFormat=g.PixelFormat.DEPTH_STENCIL,c.dataType=g.PixelType.UNSIGNED_INT_24_8,c.samplingMode=g.TextureSamplingMode.NEAREST,
c.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE,b=new n.Texture(this._rctx,c),this._depthTextures.set(a.id,b),this._activeTargets.add(a.id));return b};f.getAllocatedDepthTexture=function(a){return this._depthTextures.get(a.id)};f.getColorTexture=function(a,c,d){let b=this._colorTextures.get(a.id);!b||b.descriptor.width===c&&b.descriptor.height===d||(b.dispose(),b=r.nullifyNonNullableForDispose());b||(c=new p.TextureDescriptor(c,d),c.internalFormat=a.internalFormat,c.dataType=a.dataType,c.samplingMode=
null!=a.samplingMode?a.samplingMode:g.TextureSamplingMode.LINEAR,c.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE,b=new n.Texture(this._rctx,c),this._colorTextures.set(a.id,b),this._activeTargets.add(a.id));return b};f.getAllocatedColorTexture=function(a){return this._colorTextures.get(a.id)};f.registerDepthTarget=function(a={}){return{id:m.generateUID(),...v,...a}};f.registerColorTarget=function(a={}){return{id:m.generateUID(),...u,...a}};f.getFramebuffer=function(a,c,d,b){const h=this._getKey(d,b);let e=
this._fbos.get(h);d=this.getColorTexture(d,a,c);b=b?this._getDepthTexture(b,a,c):void 0;if(!e)return e=new t.FramebufferObject(this._rctx,d,b),this._fbos.set(h,e),e;if(e.width!==a||e.height!==c||e.colorTexture!==d||e.depthStencilAttachment!==b)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a,c),e.attachColorTexture(d),e.attachDepthStencil(b);return e};f._getKey=function(a,c){return`${a.id}_${c?c.id:"X"}_${a.name}${c?"_"+c.name:""}`};q._createClass(k,[{key:"gpuMemoryUsage",get:function(){let a=
0;const c=new Set,d=b=>{c.has(b)||(c.add(b),a+=b.gpuMemoryUsage)};this._colorTextures.forEach(d);this._depthTextures.forEach(d);return a}}]);return k}();l.RenderTargetHelper=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});