// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),function(J,S,F,K,T,U,V,k,x,L,M,w){function G(b,d,a){return k.set(b,d.data[a],d.data[a+1],d.data[a+2])}function g(b,d){b.push(d[0]);b.push(d[1]);b.push(d[2])}
function W(b,d,a,q){U.conjugate(N,b.quaternion);k.sub(l,d,b.center);k.transformQuat(l,l,N);const r=8*((l[0]<-b.halfSize[0]?-1:l[0]>b.halfSize[0]?1:0)+3*(l[1]<-b.halfSize[1]?-1:l[1]>b.halfSize[1]?1:0)+9*(l[2]<-b.halfSize[2]?-1:l[2]>b.halfSize[2]?1:0)+13);d=O[r];if(0===d)return d;K.fromQuat(C,b.quaternion);K.scale(C,C,b.halfSize);const p=(e,c)=>{c=O[r+c+1];k.set(e,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);k.transformMat3(e,e,C);return k.add(e,b.center,e)};a.length=0;g(a,p(H,0));g(a,p(P,1));g(a,p(l,2));g(a,
p(Q,3));q(a);if(1===d)return d;a.length=0;g(a,H);g(a,Q);g(a,p(l,4));g(a,p(R,5));q(a);if(2===d)return d;a.length=0;g(a,H);g(a,R);g(a,p(l,6));g(a,P);q(a);return d}const D=new F({allocator:b=>b||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:b=>{b.object=S.nullifyNonNullableForDispose(b.object);return b}}),u=w.empty(),h=x.create(),y=x.create(),X=new F({deallocator:null}),Y=new F({deallocator:null}),O=(()=>{const b=Array(216);let d=0;const a=q=>{for(let r=0;r<q.length;r++)b[d+r]=q[r];d+=
8};a([3,0,6,2,3,1,5,4]);a([2,0,2,3,1,5,4,0]);a([3,1,0,2,3,7,5,4]);a([2,0,1,3,2,6,4,0]);a([1,0,1,3,2,0,0,0]);a([2,1,5,7,3,2,0,0]);a([3,2,0,1,3,7,6,4]);a([2,2,0,1,3,7,6,0]);a([3,3,0,1,5,7,6,2]);a([2,0,1,5,4,6,2,0]);a([1,0,1,5,4,0,0,0]);a([2,1,3,7,5,4,0,0]);a([1,0,2,6,4,0,0,0]);a([0,0,0,0,0,0,0,0]);a([1,1,3,7,5,0,0,0]);a([2,2,3,7,6,4,0,0]);a([1,2,3,7,6,0,0,0]);a([2,3,1,5,7,6,2,0]);a([3,4,0,1,5,7,6,2]);a([2,5,7,6,4,0,1,0]);a([3,5,0,1,3,7,6,4]);a([2,4,5,7,6,2,0,0]);a([1,4,5,7,6,0,0,0]);a([2,5,1,3,7,6,
4,0]);a([3,6,0,2,3,7,5,4]);a([2,6,2,3,7,5,4,0]);a([3,7,6,2,3,1,5,4]);return b})(),C=T.create(),N=V.create(),l=x.create(),H=x.create(),P=x.create(),Q=x.create(),R=x.create();J.computeDepthRange=function(b,d){const a=w.empty(),{eye:q,frustum:r,viewForward:p}=b;d.forAll(e=>{var c=null!=e.offsetObb?e.offsetObb:e.obb;const f=k.dot(k.sub(l,c.center,q),p),m=M.projectedRadius(c,p);if(!w.within(a,f-m)||!w.within(a,f+m)){a:{var n=0;for(let v=0;4>v;v++){const t=M.intersectPlane(c,r[v]);if(0<t){c=-1;break a}0===
t&&(n|=1<<v)}c=n}-1!==c&&(0===c?(u.far=f+m,u.near=f-m,w.union(a,u)):(n=D.pushNew(),n.near=f-m,n.far=f+m,n.mask=c,n.object=e))}});for(b=0;b<D.length;b++){const e=D.data[b];w.within(a,e.near)&&w.within(a,e.far)||(u.far=e.far,u.near=Infinity,0===W(null!=e.object.offsetObb?e.object.offsetObb:e.object.obb,q,X,c=>{var f=Y;for(var m=0;4>m&&0<c.length;m++){if(0===(e.mask&1<<m))continue;var n=r[m],v=c,t=f;t.length=0;const I=v.length-3;G(h,v,I);const z=L.signedDistance(n,h);0>=z&&(t.push(h[0]),t.push(h[1]),
t.push(h[2]));let E=0,A=z;for(E;E<I;E+=3){G(y,v,E);const B=L.signedDistance(n,y);0>A*B&&(k.lerp(h,y,h,B/(B-A)),g(t,h));0>=B&&g(t,y);A=B;k.copy(h,y)}0>A*z&&(G(y,v,I),k.lerp(h,y,h,z/(z-A)),g(t,h));n=c;c=f;f=n}for(f=0;f<c.length;f+=3)k.set(h,c.data[f],c.data[f+1],c.data[f+2]),m=k.dot(k.sub(h,h,q),p),u.near=Math.min(u.near,m)})&&(u.near=0),w.union(a,u))}D.length=0;return a};Object.defineProperty(J,Symbol.toStringTag,{value:"Module"})});