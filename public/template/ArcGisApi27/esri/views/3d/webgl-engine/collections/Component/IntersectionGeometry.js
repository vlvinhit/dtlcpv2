// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),function(C,D,E,F,G,z,A,H,I,x){let M=function(){function y(b,a){this._components=a;this._indices=null!=b.indices?z.compactIndices(b.indices):
z.getContinuousIndexArray(b.positions.length/3);this._positions=b.positions;this._componentIntersectionData=Array(a.count)}var u=y.prototype;u.getComponentAabb=function(b,a){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let k=0;6>k;k++)a[k]=this._perComponentAabbs[6*b+k];return a};u.getComponentPositions=function(b,a){a.indices=this._indices;a.data=this._positions;a.stride=3;a.startIndex=this._components.offsets[b];a.endIndex=this._components.offsets[b+1]};
u.intersect=function(b,a,k,m,f,g,n){const h=new H.Attribute(this._positions,3,!1,3),l=this._indices,v=this._components.offsets,p=x.computeInvDir(b,a,J),q=b[2],r=a[2];this._components.visibility.forEachComponent(c=>{if(!I.getVisibility(this._components.pickability,c))return!0;var e=this.getComponentAabb(c,K);if(null!=g){var d=g[c];null!=f?f.componentOffset=d:(b[2]=q-d,a[2]=r-d)}null!=f&&f.applyToAabb(e);if(!x.intersectAabbInvDir(e,b,p,k))return!0;e=v[c]/3;d=v[c+1]/3;const t=(w,B,L)=>n(c,w,D.transformMat3(B,
B,m),L);null==f&&d-e>A.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[c]&&(this._componentIntersectionData[c]=new A.ComponentIntersectionData(this._indices,e,d,h)),this._componentIntersectionData[c].intersectRay({r0:b,r1:a},t)):x.intersectTriangles(b,a,e,d,l,h,void 0,f,t);return!0})};u._computePerComponentAabbs=function(){const b=this._components.count,a=G.newFloatArray(6*b),k=this._indices,m=this._positions,f=this._components.offsets;let g=0;for(let l=0;l<b;l++){var n=
f[l];const v=f[l+1];let p=Infinity,q=Infinity,r=Infinity,c=-Infinity,e=-Infinity,d=-Infinity;for(;n<v;n++){var h=3*k[n];const t=m[h],w=m[h+1];h=m[h+2];p=Math.min(p,t);q=Math.min(q,w);r=Math.min(r,h);c=Math.max(c,t);e=Math.max(e,w);d=Math.max(d,h)}a[g++]=p;a[g++]=q;a[g++]=r;a[g++]=c;a[g++]=e;a[g++]=d}return a};C._createClass(y,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return y}();const J=E.create(),K=F.create();return M});