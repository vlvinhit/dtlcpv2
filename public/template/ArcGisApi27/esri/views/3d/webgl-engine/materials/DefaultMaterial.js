// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(u,k,K,f,n,C,L,e,M,v,y,N,w,z,O,x,l,P,Q,D,E,R,S){z=function(m){function g(a){a=m.call(this,a,T)||this;a.supportsEdges=!0;a._configuration=new R.DefaultMaterialTechniqueConfiguration;var b=a.parameters;const c=L.newLayout().vec3f(l.VertexAttribute.POSITION);b.normalType===M.NormalType.Compressed?c.vec2i16(l.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):c.vec3f(l.VertexAttribute.NORMAL);b.hasVertexTangents&&c.vec4f(l.VertexAttribute.TANGENT);(b.textureId||b.normalTextureId||b.metallicRoughnessTextureId||
b.emissiveTextureId||b.occlusionTextureId)&&c.vec2f(l.VertexAttribute.UV0);b.hasVertexColors&&c.vec4u8(l.VertexAttribute.COLOR);b.hasSymbolColors&&c.vec4u8(l.VertexAttribute.SYMBOLCOLOR);K("enable-feature:objectAndLayerId-rendering")&&c.vec4u8(l.VertexAttribute.OBJECTANDLAYERIDCOLOR);a._vertexBufferLayout=c;return a}k._inherits(g,m);var d=g.prototype;d.isVisibleForOutput=function(a){return a===e.ShaderOutput.Shadow||a===e.ShaderOutput.ShadowExcludeHighlight||a===e.ShaderOutput.ShadowHighlight?this.parameters.castShadows:
!0};d.isVisible=function(){var a=this.parameters;if(!k._get(k._getPrototypeOf(g.prototype),"isVisible",this).call(this)||0===a.layerOpacity)return!1;const {hasInstancedColor:b,hasVertexColors:c,hasSymbolColors:q,vvColor:r}=a,p="replace"===a.colorMixMode,h=0<a.opacity;a=a.externalColor&&0<a.externalColor[3];const t=b||r||q;return c&&t?p||h:c?p?a:h:t?p||h:p?a:h};d.getConfiguration=function(a,b){this._configuration.output=a;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=
!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=
this.parameters.hasSlicePlane?N.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=b.multipassTerrain.enabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(a===e.ShaderOutput.Color||a===e.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?v.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.WindingOrder:v.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=
b.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?y.PBRMode.Schematic:y.PBRMode.Normal:y.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=b.transparencyPassType,this._configuration.enableOffset=b.camera.relativeElevation<O.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(b),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,
this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};d.hasSnowCover=function(a){return null!=a.weather&&a.weatherVisible&&"snowy"===a.weather.type&&"enabled"===a.weather.snowCover};d.intersect=function(a,b,c,q,r,p){if(null!=
this.parameters.verticalOffset){const t=c.camera;f.set(A,b[12],b[13],b[14]);b=null;switch(c.viewingMode){case C.ViewingMode.Global:b=f.normalize(F,A);break;case C.ViewingMode.Local:b=f.copy(F,U)}let G=0;var h=f.subtract(V,A,t.eye);const H=f.length(h);h=f.scale(h,h,1/H);let I=null;this.parameters.screenSizePerspective&&(I=f.dot(b,h));G+=D.verticalOffsetAtDistance(t,H,this.parameters.verticalOffset,I??0,this.parameters.screenSizePerspective);f.scale(b,b,G);f.transformMat3(B,b,c.transform.inverseRotation);
q=f.subtract(W,q,B);r=f.subtract(X,r,B)}D.intersectTriangleGeometry(a,c,q,r,P.getVerticalOffsetObject3D(c.verticalOffset),p)};d.requiresSlot=function(a,b){return b===e.ShaderOutput.Color||b===e.ShaderOutput.Alpha||b===e.ShaderOutput.Depth||b===e.ShaderOutput.Normal||b===e.ShaderOutput.Shadow||b===e.ShaderOutput.ShadowHighlight||b===e.ShaderOutput.ShadowExcludeHighlight||b===e.ShaderOutput.Highlight||b===e.ShaderOutput.ObjectAndLayerIdColor?a===(this.parameters.transparent?this.parameters.writeDepth?
x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:x.RenderSlot.OPAQUE_MATERIAL)||a===x.RenderSlot.DRAPED_MATERIAL:!1};d.createGLMaterial=function(a){return new J(a)};d.createBufferWriter=function(){return new Q.DefaultBufferWriter(this._vertexBufferLayout)};return k._createClass(g)}(z.Material);let J=function(m){function g(a){return m.call(this,{...a,...a.material.parameters})||this}k._inherits(g,m);var d=g.prototype;d._updateShadowState=function(a){a.shadowMap.enabled!==
this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:a.shadowMap.enabled})};d._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};d.beginSlot=function(a){if(this._output===e.ShaderOutput.Color||this._output===e.ShaderOutput.Alpha)this._updateShadowState(a),this._updateOccludeeState(a);const b=this._material.parameters;this.updateTexture(b.textureId);const c=
a.camera.viewInverseTransposeMatrix;f.set(b.origin,c[3],c[7],c[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(b.treeRendering?S.RealisticTreeTechnique:E.DefaultMaterialTechnique,a)};return k._createClass(g)}(w.GLTextureMaterial);w=function(m){function g(){var d=m.apply(this,arguments)||this;d.initTextureTransparent=!1;d.treeRendering=!1;d.hasVertexTangents=!1;return d}k._inherits(g,m);return k._createClass(g)}(E.DefaultMaterialPassParameters);const T=new w,
W=n.create(),X=n.create(),U=n.fromValues(0,0,1),F=n.create(),B=n.create(),A=n.create(),V=n.create();u.DefaultGLMaterial=J;u.DefaultMaterial=z;u.DefaultMaterialParameters=w;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});