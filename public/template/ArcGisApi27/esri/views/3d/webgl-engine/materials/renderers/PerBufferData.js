// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(g,k,l,p,q){function h(){return new l({allocator:b=>b||new q.DrawCommand,deallocator:b=>b})}function m(b,c){const a=b.back();null==a?(b=b.pushNew(),b.first=c.from,b.count=c.numElements):a.first+a.count>=c.from?a.count=c.from-a.first+c.numElements:(b=b.pushNew(),b.first=c.from,b.count=c.numElements)}let n=function(){function b(){this._numElements=0;this._instances=
new Map;this.holes=new l({allocator:a=>a||new p.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=h();this.drawCommandsHighlight=h();this.drawCommandsOccludees=h();this.drawCommandsShadowHighlightRest=h()}var c=b.prototype;c.addInstance=function(a,e){this.deleteInstance(a);this._instances.set(a,e);this._numElements+=e.numElements};c.deleteInstance=function(a){const e=this._instances.get(a);e&&(this._numElements-=
e.numElements,this._instances.delete(a))};c.updateInstance=function(a,e,d){if(a=this._instances.get(a))this._numElements-=a.numElements,a.from=e,a.to=d,this._numElements+=a.numElements};c.updateDrawState=function(a){a.isVisible?(a.hasHighlights&&(this.hasHighlights=!0),a.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0};c.updateDrawCommands=function(a){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();
this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){a=Array.from(this._instances.values()).sort((d,f)=>d.from===f.from?d.to-f.to:d.from-f.from);for(var e of a)e.isVisible&&(m(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),m(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}else{const d=this.drawCommandsDefault.pushNew();e=this.holes.front();null!=this.vao&&1===this.holes.length&&e.to===Math.floor(this.vao.byteSize/
a)?(d.first=0,d.count=e.from):(d.first=Infinity,d.count=0,this._instances.forEach(f=>{d.first=Math.min(d.first,f.from);d.count=Math.max(d.count,f.to)}),d.count-=d.first)}};c.needsMultipleCommands=function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances};k._createClass(b,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}}]);return b}(),r=function(b){function c(){return b.apply(this,arguments)||this}k._inherits(c,
b);return k._createClass(c)}(n);g.PerBufferData=n;g.PerVaoData=r;g.hasVao=function(b){return null!=b.vao};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});