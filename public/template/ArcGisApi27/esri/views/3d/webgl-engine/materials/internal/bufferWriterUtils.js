// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(w,H,z,v,x){function I(g,c,b,d){const a=b.typedBuffer;b=b.typedBufferStride;const f=g.length;d*=b;for(let e=0;e<f;++e){const h=2*g[e];a[d]=c[h];a[d+1]=c[h+1];d+=b}}function J(g,c,b,d,a){const f=b.typedBuffer;b=b.typedBufferStride;const e=g.length;d*=b;if(null==a||1===a)for(a=0;a<e;++a){var h=3*g[a];f[d]=c[h];f[d+1]=c[h+1];f[d+2]=c[h+2];d+=b}else for(h=
0;h<e;++h){const m=3*g[h];for(let u=0;u<a;++u)f[d]=c[m],f[d+1]=c[m+1],f[d+2]=c[m+2],d+=b}}function K(g,c,b,d,a=1){const f=b.typedBuffer;b=b.typedBufferStride;const e=g.length;d*=b;if(1===a)for(a=0;a<e;++a){var h=4*g[a];f[d]=c[h];f[d+1]=c[h+1];f[d+2]=c[h+2];f[d+3]=c[h+3];d+=b}else for(h=0;h<e;++h){const m=4*g[h];for(let u=0;u<a;++u)f[d]=c[m],f[d+1]=c[m+1],f[d+2]=c[m+2],f[d+3]=c[m+3],d+=b}}function M(g,c,b,d,a,f=1){if(b){var e=d.typedBuffer;d=d.typedBufferStride;var h=g.length,m=b[0],u=b[1],A=b[2],
B=b[4],C=b[5],D=b[6],E=b[8],F=b[9],G=b[10],r=b[12],p=b[13],k=b[14];a*=d;var l=0,q=0,n=0;b=H.hasIdentityRotation(b)?t=>{l=c[t]+r;q=c[t+1]+p;n=c[t+2]+k}:t=>{const y=c[t],L=c[t+1];t=c[t+2];l=m*y+B*L+E*t+r;q=u*y+C*L+F*t+p;n=A*y+D*L+G*t+k};if(1===f)for(f=0;f<h;++f)b(3*g[f]),e[a]=l,e[a+1]=q,e[a+2]=n,a+=d;else for(let t=0;t<h;++t){b(3*g[t]);for(let y=0;y<f;++y)e[a]=l,e[a+1]=q,e[a+2]=n,a+=d}}else J(g,c,d,a,f)}function N(g,c,b,d,a,f=1){if(b){var e=d.typedBuffer;d=d.typedBufferStride;var h=g.length,m=b[0],
u=b[1],A=b[2],B=b[4],C=b[5],D=b[6],E=b[8],F=b[9],G=b[10],r=!H.isOrthoNormal(b);a*=d;var p=0,k=0,l=0;b=H.hasIdentityRotation(b)?n=>{p=c[n];k=c[n+1];l=c[n+2]}:n=>{const t=c[n],y=c[n+1];n=c[n+2];p=m*t+B*y+E*n;k=u*t+C*y+F*n;l=A*t+D*y+G*n};if(1===f)if(r)for(f=0;f<h;++f)b(3*g[f]),r=p*p+k*k+l*l,.999999>r&&1E-6<r?(r=1/Math.sqrt(r),e[a]=p*r,e[a+1]=k*r,e[a+2]=l*r):(e[a]=p,e[a+1]=k,e[a+2]=l),a+=d;else for(f=0;f<h;++f)b(3*g[f]),e[a]=p,e[a+1]=k,e[a+2]=l,a+=d;else for(let n=0;n<h;++n){b(3*g[n]);if(r){var q=p*p+
k*k+l*l;.999999>q&&1E-6<q&&(q=1/Math.sqrt(q),p*=q,k*=q,l*=q)}for(q=0;q<f;++q)e[a]=p,e[a+1]=k,e[a+2]=l,a+=d}}else J(g,c,d,a,f)}function O(g,c,b,d,a,f=1){if(b){var e=d.typedBuffer;d=d.typedBufferStride;var h=g.length,m=b[0],u=b[1],A=b[2],B=b[4],C=b[5],D=b[6],E=b[8],F=b[9],G=b[10];b=!H.isOrthoNormal(b);a*=d;if(1===f)for(f=0;f<h;++f){var r=4*g[f],p=c[r],k=c[r+1],l=c[r+2];r=c[r+3];var q=m*p+B*k+E*l,n=u*p+C*k+F*l;p=A*p+D*k+G*l;b&&(k=q*q+n*n+p*p,.999999>k&&1E-6<k&&(k=1/Math.sqrt(k),q*=k,n*=k,p*=k));e[a]=
q;e[a+1]=n;e[a+2]=p;e[a+3]=r;a+=d}else for(r=0;r<h;++r){q=4*g[r];k=c[q];l=c[q+1];const t=c[q+2];q=c[q+3];n=m*k+B*l+E*t;p=u*k+C*l+F*t;k=A*k+D*l+G*t;b&&(l=n*n+p*p+k*k,.999999>l&&1E-6<l&&(l=1/Math.sqrt(l),n*=l,p*=l,k*=l));for(l=0;l<f;++l)e[a]=n,e[a+1]=p,e[a+2]=k,e[a+3]=q,a+=d}}else K(g,c,d,a,f)}function P(g,c,b,d,a,f=1){var e=d.typedBuffer,h=d.typedBufferStride,m=g.length;a*=h;if(b===c.length&&4===b)for(e[a]=c[0],e[a+1]=c[1],e[a+2]=c[2],e[a+3]=c[3],g=new Uint32Array(d.typedBuffer.buffer,d.start),h/=
4,a/=4,c=g[a],a+=h,m*=f,e=1;e<m;++e)g[a]=c,a+=h;else if(1===f)if(4===b)for(f=0;f<m;++f)b=4*g[f],e[a]=c[b],e[a+1]=c[b+1],e[a+2]=c[b+2],e[a+3]=c[b+3],a+=h;else for(f=0;f<m;++f)b=3*g[f],e[a]=c[b],e[a+1]=c[b+1],e[a+2]=c[b+2],e[a+3]=255,a+=h;else if(4===b)for(b=0;b<m;++b){d=4*g[b];for(var u=0;u<f;++u)e[a]=c[d],e[a+1]=c[d+1],e[a+2]=c[d+2],e[a+3]=c[d+3],a+=h}else for(b=0;b<m;++b)for(d=3*g[b],u=0;u<f;++u)e[a]=c[d],e[a+1]=c[d+1],e[a+2]=c[d+2],e[a+3]=255,a+=h}function Q(g,c,b,d){const a=b.typedBuffer;b=b.typedBufferStride;
g=g.length;c=c[0];d*=b;for(let f=0;f<g;++f)a[d]=c,d+=b}function R(g,c,b,d,a=1){const f=c.typedBuffer;c=c.typedBufferStride;d*=c;if(1===a)for(a=0;a<b;++a)f[d]=g[0],f[d+1]=g[1],f[d+2]=g[2],f[d+3]=g[3],d+=c;else for(let e=0;e<b;++e)for(let h=0;h<a;++h)f[d]=g[0],f[d+1]=g[1],f[d+2]=g[2],f[d+3]=g[3],d+=c}function S(g,c,b,d,a,f,e){switch(g){case x.VertexAttribute.POSITION:v.assert(3===c.size);a=f.getField(g,z.BufferViewVec3f);v.assert(!!a,`No buffer view for ${g}`);a&&M(b,c.data,d,a,e);break;case x.VertexAttribute.NORMAL:v.assert(3===
c.size);d=f.getField(g,z.BufferViewVec3f);v.assert(!!d,`No buffer view for ${g}`);d&&N(b,c.data,a,d,e);break;case x.VertexAttribute.NORMALCOMPRESSED:v.assert(2===c.size);a=f.getField(g,z.BufferViewVec2i16);v.assert(!!a,`No buffer view for ${g}`);a&&I(b,c.data,a,e);break;case x.VertexAttribute.UV0:v.assert(2===c.size);a=f.getField(g,z.BufferViewVec2f);v.assert(!!a,`No buffer view for ${g}`);a&&I(b,c.data,a,e);break;case x.VertexAttribute.COLOR:case x.VertexAttribute.SYMBOLCOLOR:a=f.getField(g,z.BufferViewVec4u8);
v.assert(!!a,`No buffer view for ${g}`);v.assert(3===c.size||4===c.size);!a||3!==c.size&&4!==c.size||P(b,c.data,c.size,a,e);break;case x.VertexAttribute.COLORFEATUREATTRIBUTE:a=f.getField(g,z.BufferViewFloat);v.assert(!!a,`No buffer view for ${g}`);v.assert(1===c.size);a&&1===c.size&&Q(b,c.data,a,e);break;case x.VertexAttribute.TANGENT:v.assert(4===c.size);d=f.getField(g,z.BufferViewVec4f);v.assert(!!d,`No buffer view for ${g}`);d&&O(b,c.data,a,d,e);break;case x.VertexAttribute.PROFILERIGHT:case x.VertexAttribute.PROFILEUP:case x.VertexAttribute.PROFILEVERTEXANDNORMAL:case x.VertexAttribute.FEATUREVALUE:v.assert(4===
c.size),a=f.getField(g,z.BufferViewVec4f),v.assert(!!a,`No buffer view for ${g}`),a&&K(b,c.data,a,e)}}w.writeBufferFloat=function(g,c,b,d,a=1){const f=b.typedBuffer;b=b.typedBufferStride;const e=g.length;d*=b;if(1===a)for(a=0;a<e;++a)f[d]=c[g[a]],d+=b;else for(let h=0;h<e;++h){const m=c[g[h]];for(let u=0;u<a;u++)f[d]=m,d+=b}};w.writeBufferMat3f=function(g,c,b,d){const a=b.typedBuffer;b=b.typedBufferStride;const f=g.length;d*=b;for(let e=0;e<f;++e){const h=9*g[e];for(let m=0;9>m;++m)a[d+m]=c[h+m];
d+=b}};w.writeBufferMat4f=function(g,c,b,d){const a=b.typedBuffer;b=b.typedBufferStride;const f=g.length;d*=b;for(let e=0;e<f;++e){const h=16*g[e];for(let m=0;16>m;++m)a[d+m]=c[h+m];d+=b}};w.writeBufferVec2=I;w.writeBufferVec3=J;w.writeBufferVec4=K;w.writeBufferVec4Zeros=function(g,c,b){const d=g.typedBuffer;g=g.typedBufferStride;c*=g;for(let a=0;a<b;++a)d[c]=0,d[c+1]=0,d[c+2]=0,d[c+3]=0,c+=g};w.writeColor=P;w.writeColorFeatureAttribute=Q;w.writeDefaultAttribute=S;w.writeDefaultAttributes=function(g,
c,b,d,a,f){for(const h of c.fields.keys()){c=g.vertexAttributes.get(h);var e=g.indices.get(h);c&&e?S(h,c,e,b,d,a,f):h===x.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=g.objectAndLayerIdColor&&(c=g.indices.get(x.VertexAttribute.POSITION),v.assert(!!c,`No buffer view for ${h}`),c&&(c=c.length,e=a.getField(h,z.BufferViewVec4u8),R(g.objectAndLayerIdColor,e,c,f)))}};w.writeNormal=N;w.writeObjectAndLayerIdColor=R;w.writePosition=M;w.writeTangent=O;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});