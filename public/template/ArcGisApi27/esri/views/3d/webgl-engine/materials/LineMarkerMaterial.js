// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(C,n,y,E,N,p,O,D,q,g,P,F,z,G){let S=function(m){function h(a){a=
m.call(this,a,new H)||this;a._vertexAttributeLocations=F.vertexAttributeLocations;a._configuration=new z.LineMarkerTechniqueConfiguration;a._layout=a.createLayout();return a}n._inherits(h,m);var b=h.prototype;b.dispose=function(){};b.getConfiguration=function(a,c){this._configuration.output=a;this._configuration.space=c.slot===q.RenderSlot.DRAPED_MATERIAL?z.LineMarkerSpace.Draped:this.parameters.worldSpace?z.LineMarkerSpace.World:z.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;
this._configuration.hasCap=this.parameters.cap!==G.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;
this._configuration.occluder=this.parameters.renderOccluded===D.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=c.transparencyPassType;this._configuration.hasMultipassTerrain=c.multipassTerrain.enabled;this._configuration.cullAboveGround=c.multipassTerrain.cullAboveGround;return this._configuration};b.intersect=function(){};b.createLayout=function(){const a=N.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0).vec3f(g.VertexAttribute.AUXPOS1);
this.parameters.worldSpace&&a.vec3f(g.VertexAttribute.NORMAL);this.parameters.vvSize?a.f32(g.VertexAttribute.SIZEFEATUREATTRIBUTE):a.f32(g.VertexAttribute.SIZE);this.parameters.vvColor?a.f32(g.VertexAttribute.COLORFEATUREATTRIBUTE):a.vec4f(g.VertexAttribute.COLOR);this.parameters.vvOpacity&&a.f32(g.VertexAttribute.OPACITYFEATUREATTRIBUTE);return a};b.createBufferWriter=function(){return new Q(this._layout,this.parameters)};b.requiresSlot=function(a,c){return c===p.ShaderOutput.Color||c===p.ShaderOutput.Alpha||
c===p.ShaderOutput.Highlight||c===p.ShaderOutput.Depth?a===q.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===D.RenderOccludedFlag.OccludeAndTransparentStencil?a===q.RenderSlot.OPAQUE_MATERIAL||a===q.RenderSlot.OCCLUDER_MATERIAL||a===q.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:c===p.ShaderOutput.Color||c===p.ShaderOutput.Alpha?a===(this.parameters.writeDepth?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):a===q.RenderSlot.OPAQUE_MATERIAL:!1};
b.createGLMaterial=function(a){return new R(a)};return n._createClass(h)}(D.Material),R=function(m){function h(){var a=m.apply(this,arguments)||this;a._markerPrimitive=null;return a}n._inherits(h,m);var b=h.prototype;b.dispose=function(){n._get(n._getPrototypeOf(h.prototype),"dispose",this).call(this);this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null};b._updateParameters=function(a){const c=this._material.parameters.markerPrimitive;c!==this._markerPrimitive&&
(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(c,this._markerPrimitive)}),this._markerPrimitive=c);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(F.LineMarkerTechnique,a)};b._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};b.beginSlot=function(a){this._output!==p.ShaderOutput.Color&&this._output!==p.ShaderOutput.Alpha||this._updateOccludeeState(a);
return this._updateParameters(a)};return n._createClass(h)}(O.GLTextureMaterial),H=function(m){function h(){var b=m.apply(this,arguments)||this;b.width=0;b.color=[1,1,1,1];b.markerPrimitive="arrow";b.placement="end";b.cap=G.CapType.BUTT;b.anchor=z.LineMarkerAnchor.Center;b.hasTip=!1;b.worldSpace=!1;b.hideOnShortSegments=!1;b.writeDepth=!0;b.hasSlicePlane=!1;b.vvFastUpdate=!1;b.hasOccludees=!1;b.markerTexture=null;return b}n._inherits(h,m);return n._createClass(h)}(P.VisualVariablePassParameters),
Q=function(){function m(b,a){this.vertexBufferLayout=b;this._parameters=a}var h=m.prototype;h.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};h.write=function(b,a,c,t,T){const r=c.vertexAttributes.get(g.VertexAttribute.POSITION).data,I=r.length/3;let A=[1,0,0];a=c.vertexAttributes.get(g.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=a&&(A=a.data);let J=1,K=0;this._parameters.vvSize?K=c.vertexAttributes.get(g.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:c.vertexAttributes.has(g.VertexAttribute.SIZE)&&
(J=c.vertexAttributes.get(g.VertexAttribute.SIZE).data[0]);let u=[1,1,1,1],L=0;this._parameters.vvColor?L=c.vertexAttributes.get(g.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:c.vertexAttributes.has(g.VertexAttribute.COLOR)&&(u=c.vertexAttributes.get(g.VertexAttribute.COLOR).data);let M=0;this._parameters.vvOpacity&&(M=c.vertexAttributes.get(g.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const e=new Float32Array(t.buffer);let f=this.vertexBufferLayout.stride/4*T;const w=(d,v,k,l)=>{e[f++]=
d[0];e[f++]=d[1];e[f++]=d[2];e[f++]=k[0];e[f++]=k[1];e[f++]=v[0];e[f++]=v[1];e[f++]=v[2];this._parameters.worldSpace&&(e[f++]=A[0],e[f++]=A[1],e[f++]=A[2]);this._parameters.vvSize?e[f++]=K:e[f++]=J;this._parameters.vvColor?e[f++]=L:(d=Math.min(4*l,u.length-4),e[f++]=u[d],e[f++]=u[d+1],e[f++]=u[d+2],e[f++]=u[d+3]);this._parameters.vvOpacity&&(e[f++]=M)};let B;(function(d){d[d.ASCENDING=1]="ASCENDING";d[d.DESCENDING=-1]="DESCENDING"})(B||(B={}));c=(d,v)=>{const k=y.set(U,r[3*d],r[3*d+1],r[3*d+2]),l=
V;let x=d+v;do y.set(l,r[3*x],r[3*x+1],r[3*x+2]),x+=v;while(y.equals(k,l)&&0<=x&&x<I);b&&(y.transformMat4(k,k,b),y.transformMat4(l,l,b));w(k,l,[-1,-1],d);w(k,l,[1,-1],d);w(k,l,[1,1],d);w(k,l,[-1,-1],d);w(k,l,[1,1],d);w(k,l,[-1,1],d)};t=this._parameters.placement;"begin"!==t&&"begin-end"!==t||c(0,B.ASCENDING);"end"!==t&&"begin-end"!==t||c(I-1,B.DESCENDING)};return n._createClass(m)}();const U=E.create(),V=E.create();C.LineMarkerMaterial=S;C.Parameters=H;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});