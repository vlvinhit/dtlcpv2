// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(d,m,g,E,q,h,F,G,H,r,t,u,n,v,w){const x=u.QueryEngine;d.QueryEngine=function(p){function k(a){a=p.call(this,a)||this;a._dataQueryEngineInstance=null;return a}m._inherits(k,p);var e=k.prototype;e.destroy=function(){this.clear()};e.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};e.executeQueryForIdSet=async function(a,b,c){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a,b),c)};
e.executeQueryForCount=async function(a,b){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)};e.executeQueryForExtent=async function(a,b){const {count:c,extent:f}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b);a=t.fromJSON(f);return{count:c,extent:a}};e.executeQueryForIds=async function(a,b){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)};e.executeQueryForLatestObservations=async function(a,b){a=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),
b);a=n.fromJSON(a);a.features.forEach(c=>{c.layer=this.layer;c.sourceLayer=this.layer});return a};e.executeQuery=async function(a,b){a=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(a),b);a=n.fromJSON(a);a.features.forEach(c=>{c.layer=this.layer;c.sourceLayer=this.layer});return a};e._ensureQueryJSON=function(a,b){let c=this.defaultQueryJSON;null!=a&&("outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference),c=a.toJSON());null!=b&&(a=b.geometries.map(f=>
f.toJSON()).reduce((f,l)=>{f.rings=f.rings.concat(l.rings);return f}),c={...c,sceneFilter:{...b,geometry:a}});return c};e._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,b=this.layer.objectIdField,c=w.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),f=this.layer.fields?.map(y=>y.toJSON())??[],l=this.priority,z=this.spatialReference.toJSON(),
{hasZ:A,hasM:B,featureStore:C,scheduler:D}=this.context;return this._dataQueryEngineInstance=new x({hasZ:A,hasM:B,geometryType:c,fields:f,timeInfo:a,spatialReference:z,objectIdField:b,featureStore:C,scheduler:D,priority:l})};m._createClass(k,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new v({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return k}(q);g.__decorate([h.property({constructOnly:!0})],d.QueryEngine.prototype,"context",void 0);g.__decorate([h.property({constructOnly:!0})],d.QueryEngine.prototype,"priority",void 0);g.__decorate([h.property()],d.QueryEngine.prototype,"layer",null);g.__decorate([h.property()],
d.QueryEngine.prototype,"spatialReference",null);g.__decorate([h.property()],d.QueryEngine.prototype,"_queryGeometryType",null);g.__decorate([h.property()],d.QueryEngine.prototype,"defaultQueryJSON",null);d.QueryEngine=g.__decorate([r.subclass("esri.views.3d.layers.graphics.QueryEngine")],d.QueryEngine);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});