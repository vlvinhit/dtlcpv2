// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(t,k,w,x,y,A,B,C,D,l,E,v,F,G,u,H,z,I,p,J,K,n,q){u=function(m){function h(a,b){a=m.call(this,a,null,b,L)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}k._inherits(h,m);var f=h.prototype;f.doLoad=async function(){this._material=new q.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)};f.destroy=function(){k._get(k._getPrototypeOf(h.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);
this._material=null};f._perInstanceMaterialParameters=function(a){const b=this._materialParameters;b.screenOffset=a.screenOffset||y.ZEROS;b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};f._defaultElevationInfoNoZ=function(){return M};f.createGraphics3DGraphic=function(a){const b=a.renderingInfo;a=a.graphic;const c=this.setGraphicElevationContext(a,new E.ElevationContext,b.elevationOffset||0);var d=b.symbol;const g="on-the-ground"===this._elevationContext.mode&&("cim"===d.type||!d.symbolLayers.some(e=>
"object"===e.type||"text"===e.type));if("label-3d"!==d.type&&g||"point-3d"===d.type&&d.symbolLayers.every(e=>"text"===e.type&&!C.textSymbolLayerSupportsVerticalOffset(e)))return null;d=H.computeCentroid(a.geometry);return null==d?null:this._createAs3DShape(d,c,b,a.uid)};f.layerOpacityChanged=function(){this._material?.setParameters(this._materialParameters)};f.layerElevationInfoChanged=function(a,b,c){c=l.elevationModeChangeUpdateType(h.elevationModeChangeTypes,c,this._elevationContext.mode);if(c!==
l.SymbolUpdateType.UPDATE)return c;a.forEach(d=>{const g=b(d);null!=g&&this.updateGraphicElevationContext(d.graphic,g)});return c};f.slicePlaneEnabledChanged=function(){this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};f.physicalBasedRenderingChanged=function(){return!0};f.setGraphicElevationContext=function(a,b,c=0){a=k._get(k._getPrototypeOf(h.prototype),"setGraphicElevationContext",this).call(this,a,b);a.addOffsetRenderUnits(c);return a};f.updateGraphicElevationContext=
function(a,b){this.setGraphicElevationContext(a,b.elevationContext,null!=b.metadata?b.metadata.elevationOffset:0);b.needsElevationUpdates=l.needsElevationUpdates2D(b.elevationContext.mode)};f.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:I.emptySymbolComplexity.memory}};f._createVertexData=function(a){const {translation:b,centerOffset:c}=a;a=b?new p.Attribute([b[0],b[1],b[2]],3,!0):new p.Attribute([0,0,0],3,!0);const d=
c?new p.Attribute([c[0],c[1],c[2],c[3]],4,!0):new p.Attribute([0,0,0,1],4,!0);return[[n.VertexAttribute.POSITION,a],[n.VertexAttribute.NORMAL,new p.Attribute([0,0,1],3,!0)],[n.VertexAttribute.AUXPOS1,d]]};f._getOrCreateMaterial=function(a){const b=this._perInstanceMaterialParameters(a),c=q.LineCalloutMaterial.uniqueMaterialIdentifier(b);if(this._material&&c===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(null!=a.materialCollection){let d=a.materialCollection.get(c);
null==d&&(d=new q.LineCalloutMaterial(b),a.materialCollection.add(c,d));return{material:d,isUnique:!1}}return{material:new q.LineCalloutMaterial(b),isUnique:!0}};f._createAs3DShape=function(a,b,c,d){var g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:d,layerUid:this._context.layer.uid}),e=this._getOrCreateMaterial(c);g=new K.Geometry(e.material,this._createVertexData(c),N,null,J.ContentObjectType.Point,g);d=z.createStageObject(this._context,a,g,b,d);if(null==d)return null;e=
new F.Graphics3DObject3DGraphicLayer(this,d.object,[g],e.isUnique?[e.material]:null,null,D.perObjectElevationAligner,b);e.metadata=new G.Graphics3DObjectMetadata(c.elevationOffset);e.alignedSampledElevation=d.sampledElevation;e.needsElevationUpdates=l.needsElevationUpdates2D(b.mode);z.extendPointGraphicElevationContext(e,a,this._context.elevationProvider);return e};k._createClass(h,[{key:"_materialParameters",get:function(){const a=new q.Parameters;var b=this.symbol,c=b.callout;a.color=null!=c.color?
w.toUnitRGBA(c.color):[0,0,0,0];a.color[3]*=this._getLayerOpacity();a.size=x.pt2px(c.size||0);if(b.verticalOffset){const {screenLength:d,minWorldLength:g,maxWorldLength:e}=b.verticalOffset;a.verticalOffset={screenLength:x.pt2px(d),minWorldLength:g||0,maxWorldLength:null!=e?e:Infinity}}a.borderColor=null!=c.border&&null!=c.border.color?w.toUnitRGBA(c.border.color):null;c="object"===b.symbolLayers.at(0).type;b="label-3d"===b.type;a.occlusionTest=!c;a.shaderPolygonOffset=c?0:void 0;a.depthHUDAlignStart=
b;a.hasSlicePlane=this._context.slicePlaneEnabled;a.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return a}}]);return h}(u.Graphics3DSymbolLayer);u.elevationModeChangeTypes={definedChanged:l.SymbolUpdateType.UPDATE,staysOnTheGround:l.SymbolUpdateType.UPDATE,onTheGroundChanged:l.SymbolUpdateType.RECREATE};var r=[0];const N=[[n.VertexAttribute.POSITION,r],[n.VertexAttribute.NORMAL,r],[n.VertexAttribute.AUXPOS1,r]],M=
{mode:"relative-to-ground",offset:0},L={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};r=k._createClass(function(m,h,f=A.create(),a=B.create(),b=y.create(),c="world",d=0,g=null){this.renderer=m;this.symbol=h;this.translation=f;this.centerOffset=a;this.screenOffset=b;this.centerOffsetUnits=c;this.elevationOffset=d;this.materialCollection=g});v=function(m){function h(){return m.apply(this,arguments)||this}k._inherits(h,m);return k._createClass(h)}(v);t.Graphics3DLineCalloutSymbolLayer=u;t.LineCalloutCreationContext=
v;t.LineCalloutSymbolLayerRenderingInfo=r;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});