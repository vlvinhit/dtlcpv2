// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity ../support/FastSymbolUpdates".split(" "),function(r,t,x,u,y,z,A,n,B,C,p,D,E,F,q){function v(h){const g={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};h&&"visualVariables"in h&&h.visualVariables&&
h.visualVariables.forEach(c=>{switch(c.type){case "color":g.color=!0;if(c.stops)for(let a=0;a<c.stops.length;a++){const b=c.stops[a].color;b&&(g.opacity=!0,1>b.a&&(g.opacityAlwaysOpaque=!1))}break;case "opacity":g.opacity=!0;g.opacityAlwaysOpaque=!1;break;case "size":g.size=!0}});return g}const l=y.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");u=function(h){function g(a,b,d,f){var e=h.call(this,d.schedule)||this;e.symbol=a;e.symbolLayer=b;e._context=d;e._elevationInfoOverride=null;
e.ignoreDrivers=!1;e._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};e.complexity=null;e.logger=l;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.skipHighSymbolLodsChanged=!0;e._renderPriority=f.renderPriority;e._renderPriorityStep=f.renderPriorityStep;e._elevationContext=new B.ElevationContext;e.complexity=e.computeComplexity();e.ignoreDrivers=f.ignoreDrivers;e.ignoreDrivers||(e._drivenProperties=v(e._context.renderer));e._updateElevationContext();
return e}t._inherits(g,h);var c=g.prototype;c.getCachedSize=function(){return null};c._drivenPropertiesChanged=function(a){if(this.ignoreDrivers)return!1;const b=this._drivenProperties;a=v(a);return a.color!==b.color||a.opacity!==b.opacity||a.opacityAlwaysOpaque!==b.opacityAlwaysOpaque||a.size!==b.size};c._logGeometryCreationWarnings=function(a,b,d,f){const e="polygons"in a?a.polygons:null,k=`${f} geometry failed to be created`;let m=null;a.projectionSuccess?!this._logGeometryValidationWarnings(b,
d,f)&&e&&0===e.length&&"rings"===d&&0<b.length&&2<b[0].length&&(m=`${k} (filled rings should use clockwise winding - try reversing the order of vertices)`):m=`${k} (failed to project geometry to view spatial reference)`;m&&l.warnOncePerTick(m)};c._logGeometryValidationWarnings=function(a,b,d){d=`${d} geometry failed to be created`;return!a.length||1===a.length&&!a[0].length?(l.warnOncePerTick(`${d} (no ${b} were defined)`),!0):Array.isArray(a)&&Array.isArray(a[0])?!1:(l.warnOncePerTick(`${d} (${b} should be defined as a 2D array)`),
!0)};c._validateGeometry=function(a,b=null,d=null){return null==b||b.includes(a.type)?"point"!==a.type||isFinite(a.x)&&isFinite(a.y)?!0:(l.warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+d+` symbol: ${a.type}`),!1)};c._defaultElevationInfoNoZ=function(){return G};c._defaultElevationInfoZ=function(){return H};c._updateElevationContext=function(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};c.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};c.getGeometryElevationMode=function(a,b=this.getDefaultElevationInfo(a)){return this._elevationContext.mode||
b.mode};c.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};c.setGraphicElevationContext=function(a,b){var d=a.geometry;const f=this.getDefaultElevationInfo(d);b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:f.unit;b.mode=this.getGeometryElevationMode(d,f);b.offsetMeters=this._elevationContext.meterUnitOffset??f.offset??0;if(d=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode="relative-to-ground",b.offsetMeters=
0;b.updateFeatureExpressionInfoContext(d?C.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};c.prepareSymbolLayerPatch=function(a){};c.updateGeometry=function(a,b){return!1};c.updateTransform=function(a,b,d,f){return!1};c.onRemoveGraphic=function(a){};c._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const a=this._context.layer.opacity;
return null==a?1:a};c._getCombinedOpacity=function(a,b=w){let d=1;this.draped||(d*=this._getLayerOpacity());if(this._drivenProperties.opacity)return d;null!=a?d*=a.a:b.hasIntrinsicColor||(d=0);return d};c._getCombinedOpacityAndColor=function(a,b=w){b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return p.mixinColorAndOpacity(null,b);a=null!=a?x.toUnitRGB(a):z.ONES;return p.mixinColorAndOpacity(a,b)};c._getVertexOpacityAndColor=function(a,b=null){a=p.mixinColorAndOpacity(this._drivenProperties.color?
a.color:null,this._drivenProperties.opacity?a.opacity:null);b&&(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b);return a};c.isFastUpdatesEnabled=function(){return null!=this._fastUpdates};c.computeComplexity=function(){return F.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};c.globalPropertyChanged=function(a,b,d){switch(a){case "opacity":return this.layerOpacityChanged(b,d),!0;case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,d,
a)===n.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,d);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}};c.updateGraphics3DGraphicElevationInfo=function(a,b,d){let f=n.SymbolUpdateType.UPDATE;a.forEach(e=>{const k=b(e);null!=k?(this.setGraphicElevationContext(e.graphic,k.elevationContext),
k.needsElevationUpdates=d(k.elevationContext.mode)):f=n.SymbolUpdateType.RECREATE});return f};c.applyRendererDiff=function(a,b){return D.ApplyRendererDiffResult.RecreateSymbol};c.getFastUpdateAttrValues=function(a){if(!this._fastUpdates)return null;const b=this._fastUpdates.visualVariables,d=b.size?q.getAttributeValue(b.size.field,a):0,f=b.color?q.getAttributeValue(b.color.field,a):0;a=b.opacity?q.getAttributeValue(b.opacity.field,a):0;return A.fromValues(d,f,a,0)};c.ensureDrapedStatus=function(a){if(null==
this._draped)return this._draped=a,!0;a!==this.draped&&l.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};c.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,
rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}};t._createClass(g,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"pixelRatioChanged",get:function(){return!0}},{key:"draped",get:function(){return this._draped}}]);return g}(E.Loadable);const G={mode:"on-the-ground",offset:0,unit:"meters"},H={mode:"absolute-height",offset:0,unit:"meters"},w=
{hasIntrinsicColor:!1};r.Graphics3DSymbolLayer=u;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});