// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(f,h,k,l,m){let n=function(){function g(a){this._graphicsCore=a;this._idToState=new Map;this._states=new Set;const b=a.owner.layer&&a.owner.layer.objectIdField;b?(this._getGraphicId=c=>m.getObjectId(c,b),this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicByObjectId(c)):(this._getGraphicId=c=>c.uid,
this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicById(c))}var d=g.prototype;d.destroy=function(){this._idToState.clear();this._states.forEach((a,b)=>this.remove(b))};d.add=function(a){const b=l.makeHandle(()=>this.remove(a));if(this._states.has(a))return b;const c=this._getGraphicId(a.graphic),e=this._getGraphics3DGraphicById(c);this._states.has(a)||this._states.add(a);this._ensureStateList(c).push(a);a.displaying=null!=e?e.isVisible():!1;a.isDraped=null!=e?e.isDraped:!1;a.tracking=
!0;null!=e&&a.emit("changed");return b};d.remove=function(a){if(this._states.has(a)){if(this._idToState.size){const b=this._getGraphicId(a.graphic),c=this._idToState.get(b);c&&(k.remove(c,a),0===c.length&&this._idToState.delete(b))}this._states.delete(a);a.tracking=!1;a.displaying=!1}};d.addGraphic=function(a){this._forEachState(a,b=>{b.displaying=a.isVisible();b.isDraped=a.isDraped;b.emit("changed")})};d.removeGraphic=function(a){this._forEachState(a,b=>{b.displaying=!1;b.isDraped=!1})};d.updateGraphicGeometry=
function(a){this._forEachState(a,b=>b.emit("changed"))};d.updateGraphicVisibility=function(a){this._forEachState(a,b=>b.displaying=a.isVisible())};d.allGraphicsDeleted=function(){this._states.forEach(a=>{a.displaying=!1})};d._ensureStateList=function(a){var b=this._idToState.get(a);if(b)return b;b=[];this._idToState.set(a,b);return b};d._forEachState=function(a,b){0!==this._states.size&&0!==this._idToState.size&&(a=this._getGraphicId(a.graphic),a=this._idToState.get(a),null!=a&&a.forEach(b))};return h._createClass(g)}();
f.GraphicStateTracking=n;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});