// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(u,x,t,v,p,A,B,C,D,y,w){function z(m){return m.isVisible()?m.parameters.transparent?w.Transparency.TRANSPARENT:w.Transparency.OPAQUE:w.Transparency.INVISIBLE}
let E=x._createClass(function(m,e,a){this.baseMaterial=m;this.edgeMaterials=e;this.properties=a}),G=function(){function m(a,b,d,h,c,g,k,f=null){this.graphics3DSymbolLayer=a;this.stageObject=b;this._uniqueGeometries=d;this._uniqueMaterials=h;this._sharedResource=c;this.elevationAligner=g;this.elevationContext=k;this._edgeState=f;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=
!1}var e=m.prototype;e.initialize=function(a){this._stageLayer=a;a=a.stage;a.addMany(this._uniqueMaterials);a.addMany(this._uniqueGeometries);a.add(this.stageObject)};e.destroy=function(){if(this._stageLayer){var a=this._stageLayer.stage;a.removeMany(this._uniqueMaterials);a.removeMany(this._uniqueGeometries);a.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);a=a.renderer.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);
this.stageObject.dispose();null!=this._sharedResource&&this._sharedResource.release();this._visible=!1;this._stageLayer=null}};e.layerOpacityChanged=function(a,b){if(null!=this._edgeState){var d=z(this._edgeState.baseMaterial),h=!1;for(const c of this._edgeState.edgeMaterials)c.objectTransparency!==d&&(c.objectTransparency=d,h=!0);h&&this.resetEdgeObject(b);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};e.slicePlaneEnabledChanged=function(a,b){null!=
this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:a},!b),this._edgeState.properties.hasSlicePlane=a)};e.setVisibility=function(a){if(null!=this._stageLayer&&this._visible!==a&&(this._visible=a,this.stageObject.visible=a,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const b=this._stageLayer.stage.renderer.ensureEdgeView();
b.hasObject(this.stageObject)?b.updateObjectVisibility(this.stageObject,a):a&&this._addOrUpdateEdgeObject(b,!1)}};e.alignWithElevation=function(a,b,d,h){null!=this.elevationAligner&&(null!=d&&C.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,a.spatialReference,(c,g)=>B.evaluateElevationInfoAtPoint(c,a,this.elevationContext,b,g),b),this.resetEdgeObject(h))};e.alignWithAbsoluteElevation=function(a,
b,d){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(h,c)=>{c.sampledElevation=a;c.verticalDistanceToGround=0;c.z=a},b);this.resetEdgeObject(d)};e.getCenterObjectSpace=function(a=v.create()){return t.copy(a,A.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};e.getBoundingBoxObjectSpace=function(a=p.create()){const b=this.stageObject.boundingVolumeObjectSpace;p.setMin(a,b.min);p.setMax(a,b.max);return a};e.computeAttachmentOrigin=function(a){if(this.useObjectOriginAsAttachmentOrigin){var b=
this.stageObject.shaderTransformation;a.render.origin[0]+=b[12];a.render.origin[1]+=b[13];a.render.origin[2]+=b[14];a.render.num++}else for(b of this.stageObject.geometries)b.computeAttachmentOrigin(l)&&(t.transformMat4(l,l,this.stageObject.shaderTransformation),t.add(a.render.origin,a.render.origin,l),a.render.num++)};e.getProjectedBoundingBox=async function(a,b,d,h,c){c=this.getBoundingBoxObjectSpace(c);var g=F,k=p.isPoint(c)?1:g.length;for(var f=0;f<k;f++){const r=g[f];n[0]=c[r[0]];n[1]=c[r[1]];
n[2]=c[r[2]];t.transformMat4(n,n,this.stageObject.transformation);q[3*f]=n[0];q[3*f+1]=n[1];q[3*f+2]=n[2]}if(!a(q,0,k))return null;p.empty(c);a=null;this.calculateRelativeScreenBounds&&(a=this.calculateRelativeScreenBounds());for(g=0;g<3*k;g+=3){for(f=0;3>f;f++)c[f]=Math.min(c[f],q[g+f]),c[f+3]=Math.max(c[f+3],q[g+f]);a&&d.push({location:q.slice(g,g+3),screenSpaceBoundingRect:a})}if(b&&b.service&&"absolute-height"!==this.elevationContext.mode){p.center(c,l);d="relative-to-scene"===this.elevationContext.mode?
"scene":"ground";k=0;if(b.useViewElevation)k=b.service.getElevation(l[0],l[1],d)??0;else try{const r=D.demResolutionForBoundingBox(c,b.service.spatialReference,b);k=await b.service.queryElevation(l[0],l[1],h,r,d)??0}catch(r){}p.offset(c,0,0,-this.alignedSampledElevation+k)}return c};e.addObjectState=function(a,b){a===y.Object3DState.Highlight&&b.addObject(this.stageObject,this.stageObject.highlight());a===y.Object3DState.MaskOccludee&&b.addObject(this.stageObject,this.stageObject.maskOccludee())};
e.removeObjectState=function(a){a.removeObject(this.stageObject)};e.resetEdgeObject=function(a){if(null!=this._edgeState){var b=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};e._addOrUpdateEdgeObject=function(a,b){const d=this._edgeState;if(null!=d){var h=z(d.baseMaterial);for(const c of d.edgeMaterials)c.objectTransparency=h;a.addOrUpdateObject3D(this.stageObject,d.edgeMaterials,d.properties,!b).then(()=>this._stageLayer?.sync())}};
x._createClass(m,[{key:"isElevationSource",get:function(){return!!this.stageObject.lastValidElevationBB}},{key:"visible",get:function(){return this._visible}}]);return m}();const q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=v.create(),l=v.create(),F=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];u.Graphics3DObject3DGraphicLayer=G;u.Object3DEdgeState=E;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});