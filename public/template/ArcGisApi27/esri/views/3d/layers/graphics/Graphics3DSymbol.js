// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),function(l,u,v,p,w,x,y,z,q,m,A){let E=function(r){function k(a,d,c){var b=r.call(this,d.schedule)||this;b._symbol=a;b._context=d;b._backgroundLayers=c;b._destroyed=!1;b.symbolLayers=[];b.referenced=
0;b._extentPadding=0;return b}l._inherits(k,r);var h=k.prototype;h.doLoad=async function(a){let d=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(d=this._backgroundLayers.concat(d));const c=d.length;for(;this.symbolLayers.length<d.length;)this.symbolLayers.push(null);this.symbolLayers.length=d.length;const b=[];for(let e=0;e<c;e++){var f=d.at(e);if(!1===f.enabled)continue;n.renderPriority=1-(1+e)/c;n.renderPriorityStep=1/c;n.ignoreDrivers=f.ignoreDrivers;const g=z.make(this.symbol,
f,this._context,n);(f=p.onAbortOrThrow(a,()=>{this.symbolLayers[e]=null;g.destroy()}))&&b.push(f);this.symbolLayers[e]=g}await v.forEach(this.symbolLayers,async(e,g)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[g]=null}});b.forEach(e=>e.remove());p.throwIfAborted(a);if(this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw Error();};h.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return null!=a?a.getCachedSize():
null};h.createGraphics3DGraphic=function(a,d){const c=a.graphic,b=this.symbolLayers.map(f=>f?.createGraphics3DGraphic(a)??null);return new w(c,d||this,b,a.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};h.globalPropertyChanged=function(a,d){const c=this.symbolLayers.length;for(let b=0;b<c;b++){const f=this.symbolLayers[b],e=g=>{g=g.layers[b];return g instanceof
x.Graphics3DObject3DGraphicLayer?g:null};if(null!=f&&!f.globalPropertyChanged(a,d,e))return!1}return!0};h.applyRendererDiff=function(a,d){return this.loadStatus!==m.LoadStatus.LOADED?q.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((c,b)=>c!==q.ApplyRendererDiffResult.RecreateSymbol&&null!=b?Math.min(c,b.applyRendererDiff(a,d)):c,q.ApplyRendererDiffResult.FastUpdate)};h.prepareSymbolPatch=function(a){if(this.loadStatus!==m.LoadStatus.FAILED&&"partial"===a.diff.type){var d=a.diff.diff;
if(d.symbolLayers&&"partial"===d.symbolLayers.type){var c=d.symbolLayers.diff;this.symbolLayers.forEach((b,f)=>{if(null!=b){var e=c[f];if(e){const g={diff:e,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(g);a.symbolStatePatches.push(...g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push((B,C)=>{const t=B.layers[f];null!=t&&g.graphics3DGraphicPatches.forEach(D=>D(t,C))})}}})}}};h.updateGeometry=function(a,d){return this._updateGeometryOrTransform(a,
(c,b)=>c.updateGeometry(b,d))};h.updateTransform=function(a,d,c,b){return this._updateGeometryOrTransform(a,(f,e)=>f.updateTransform(e,d,c,b))};h._updateGeometryOrTransform=function(a,d){for(let c=0;c<this.symbolLayers.length;c++){const b=this.symbolLayers[c];if(null==b)continue;const f=a.layers[c];if(!f||!d(b,f))return!1}return!0};h.onRemoveGraphic=function(a){for(let d=0;d<this.symbolLayers.length;d++){const c=this.symbolLayers[d];if(null==c)continue;const b=a.layers[d];if(null!=b)c.onRemoveGraphic(b)}};
h.getFastUpdateStatus=function(){let a=0,d=0,c=0;this.symbolLayers.forEach(b=>{null!=b&&(b.loadStatus===m.LoadStatus.LOADING?a++:b.isFastUpdatesEnabled()?c++:d++)});return{loading:a,slow:d,fast:c}};h.queryForSnapping=async function(a,d,c,b){var f=this.symbolLayers.filter(u.isSome).filter(e=>null!=e.queryForSnapping).map(e=>e.queryForSnapping(a,d,c,b));f=await Promise.all(f);p.throwIfAborted(b);return f.flat()};h.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{l._get(l._getPrototypeOf(k.prototype),"destroy",this).call(this);for(const a of this.symbolLayers)null!=a&&a.destroy();this.symbolLayers.length=0;this._destroyed=!0}};l._createClass(k,[{key:"symbol",get:function(){return this._symbol},set:function(a){this._symbol=a;a.symbolLayers.forEach((d,c)=>{c=this.symbolLayers[c];null!=c&&(c.symbol=a,c.symbolLayer=d)})}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(a=>
null!=a&&a.queryForSnapping)}},{key:"complexity",get:function(){return A.totalSymbolComplexities(this.symbolLayers.map(a=>null!=a?a.complexity:null))}},{key:"destroyed",get:function(){return this._destroyed}}]);return k}(m.Loadable);const n=new y.Graphics3DSymbolLayerCreationContext;return E});