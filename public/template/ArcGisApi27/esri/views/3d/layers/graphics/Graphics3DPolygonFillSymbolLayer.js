// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(z,l,I,J,A,f,B,t,n,K,L,M,u,N,x,O,p,q,C,D,E,F,P,G,Q,R,S){const T=["polyline","polygon","extent"],H=new q.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});u=function(m){function h(a,b,c,e){a=m.call(this,a,b,c,e)||this;a._needsUV=!1;a._hasOutline=!1;return a}l._inherits(h,m);var d=h.prototype;d.doLoad=async function(){this._fastUpdates=q.initFastSymbolUpdatesState(this._context.renderer,H)};d._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};d._ensureFillMaterial=
function(){if(null==this._material){var a=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._material=C.createMaterial(this.symbolLayer,{color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._material instanceof R.PatternMaterial;this._context.stage.add(this._material)}};d._ensureOutlineMaterial=
function(){const a=this.symbolLayer.outline;!this._outlineMaterial&&this._isValidOutline(a)&&(this._hasOutline=!0,this._outlineMaterial=(b=>{const c=Q.getStipplePatternForLinePattern(a.pattern);return new S.RibbonLineMaterial({width:b,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleScaleWithLineWidth:!0,cap:O.parseCapType(a.patternCap||"butt")})})(J.pt2px(a.size)),this._context.stage.add(this._outlineMaterial))};d._isValidOutline=
function(a){return null!=a&&null!=a.size&&0<a.size&&null!=a.color&&(null==a.pattern||"style"!==a.pattern.type||"none"!==a.pattern.style)};d.destroy=function(){l._get(l._getPrototypeOf(h.prototype),"destroy",this).call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};d.createGraphics3DGraphic=function(a){const b=a.graphic;if(!this._validateGeometry(b.geometry,T,this.symbolLayer.type))return null;a=this._getVertexOpacityAndColor(a.renderingInfo,
255);const c=this.setGraphicElevationContext(b,new K.ElevationContext);this.ensureDrapedStatus("on-the-ground"===c.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(b,a):this._createAs3DShape(b,a,c)};d.applyRendererDiff=function(a,b){for(const c in a.diff)switch(c){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,b,H))this._material&&this._material.setParameters(this._fastUpdates.materialParameters);else return x.ApplyRendererDiffResult.RecreateSymbol;
break;default:return x.ApplyRendererDiffResult.RecreateSymbol}return x.ApplyRendererDiffResult.FastUpdate};d.layerOpacityChanged=function(){if(null!=this._material){var a=this._material.parameters.color;const b=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._material.setParameters({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass})}null!=this._outlineMaterial&&(a=this._outlineMaterial.parameters.color,this._outlineMaterial.setParameters({color:[a[0],a[1],
a[2],this._getOutlineOpacity()]}))};d.layerElevationInfoChanged=function(a,b,c){const e=this._elevationContext.mode;c=n.elevationModeChangeUpdateType(h.elevationModeChangeTypes,c,e);if(c!==n.SymbolUpdateType.UPDATE)return c;const g=n.needsElevationUpdates2D(e);return this.updateGraphics3DGraphicElevationInfo(a,b,()=>g)};d.slicePlaneEnabledChanged=function(){this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0};d.physicalBasedRenderingChanged=function(){return!0};d._createAs3DShape=function(a,b,c){const e=p.geometryAsPolygon(a.geometry);if(!e)return null;var g=F.geometryToRenderInfo(e,this._context.elevationProvider,this._context.renderCoordsHelper,c);b=new U(g,b,this._context.layer.uid,a.uid);g=b.renderData.position.length/3;this._needsUV&&(b.uvMapSpace=t.newFloatArray(4*g,!0),b.boundingRect=B.newDoubleArray(9*g,!0),D.createMapSpaceUVCoords(b.uvMapSpace,b.boundingRect,b.renderData.position,this._context.renderCoordsHelper));
b.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(b);this._createAs3DShapeFill(a,b);this._hasOutline&&this._createAs3DShapeOutline(b);this._logGeometryCreationWarnings(b.renderData,e.rings,"rings","FillSymbol3DLayer");if(0===b.outGeometries.length)return null;a=new P.Object3D({geometries:b.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:a.uid});a=new M.Graphics3DObject3DGraphicLayer(this,a,b.outGeometries,null,null,C.uvElevationAligner,c);a.alignedSampledElevation=
b.renderData.sampledElevation;a.needsElevationUpdates=n.needsElevationUpdates2D(c.mode);return a};d._createAs3DShapeFill=function(a,b){var c=b.renderData.polygons;for(const {position:e,mapPositions:g,holeIndices:r,index:v,count:w}of c){if(null!=this._context.clippingExtent&&(f.empty(k),f.expandWithBuffer(k,g),!f.intersectsClippingArea(k,this._context.clippingExtent)))continue;c=A.earcut(g,r,3);if(0===c.length)continue;const y=this._fastUpdates?.visualVariables.color;c=p.createColorGeometry({material:this._material,
indices:c,mapPositions:g,attributeData:{position:e,color:y?null:b.color,colorFeature:y?q.getAttributeValue(y.field,a):null,uvMapSpace:this._needsUV?t.floatSubArray(b.uvMapSpace,4*v,4*w):null,boundingRect:this._needsUV?B.doubleSubArray(b.boundingRect,9*v,9*w):null,objectAndLayerIdColor:b.objectAndLayerIdColor}});b.outGeometries.push(c)}};d._createAs3DShapeOutline=function(a){if(this._hasOutline){var b=a.renderData.outlines;for(let c=0;c<b.length;++c){const {mapPositions:e,position:g}=b[c];if(null!=
this._context.clippingExtent&&(f.empty(k),f.expandWithBuffer(k,e),!f.intersectsClippingArea(k,this._context.clippingExtent)))continue;const r=E.createGeometry(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:e,attributeData:{position:g}},a.objectAndLayerIdColor);a.outGeometries.push(r)}}};d._createAsOverlay=function(a,b){const c=p.geometryAsPolygon(a.geometry);if(null==c)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2;null!=
this._outlineMaterial&&(this._outlineMaterial.renderPriority=this._renderPriority);var e=F.geometryToRenderInfoDraped(c,this._context.overlaySR);b=new V(e,b,this._context.layer.uid,a.uid);e=b.renderData.position.length/3;this._needsUV&&(b.uvMapSpace=t.newFloatArray(4*e,!0),D.createMapSpaceUVCoordsDraped(b.uvMapSpace,b.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));b.outBoundingBox=f.empty();b.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(b);
this._createAsOverlayFill(a,b);this._hasOutline&&this._createAsOverlayOutline(b);this._logGeometryCreationWarnings(b.renderData,c.rings,"rings","FillSymbol3DLayer");return 0===b.outGeometries.length?null:new L(this,b.outGeometries,b.outBoundingBox,this._context.drapeSourceRenderer)};d._createAsOverlayFill=function(a,b){var c=b.renderData.polygons;for(const {position:g,holeIndices:r,index:v,count:w}of c){var e=f.empty(k);f.expandWithBuffer(e,g);f.intersectsClippingArea(e,this._context.clippingExtent)&&
(c=A.earcut(g,r,3),0!==c.length&&(f.expandWithAABB(b.outBoundingBox,e),e=this._fastUpdates?.visualVariables.color,c=p.createColorGeometry({material:this._material,indices:c,attributeData:{position:g,color:e?null:b.color,colorFeature:e?q.getAttributeValue(e.field,a):null,uvMapSpace:this._needsUV?t.floatSubArray(b.uvMapSpace,4*v,4*w):null,objectAndLayerIdColor:b.objectAndLayerIdColor}}),b.outGeometries.push(new G.RenderGeometry(c,b))))}};d._createAsOverlayOutline=function(a){if(this._hasOutline){var b=
a.renderData.outlines;for(let e=0;e<b.length;++e){var {position:c}=b[e];f.empty(k);f.expandWithBuffer(k,c);f.intersectsClippingArea(k,this._context.clippingExtent)&&(f.expandWithAABB(a.outBoundingBox,k),c=E.createGeometry(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:c}},a.objectAndLayerIdColor),a.outGeometries.push(new G.RenderGeometry(c,a)))}}};d._getOutlineOpacity=
function(){const a=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=a?a.a:0)};d._getOutlineColor=function(){const a=this.symbolLayer?.outline?.color,b=this._getOutlineOpacity();return N.mixinColorAndOpacity(null!=a?I.toUnitRGB(a):null,b)};d.test=function(){return{...l._get(l._getPrototypeOf(h.prototype),"test",this).call(this),createAsOverlay:(a,b)=>this._createAsOverlay(a,b),createAs3DShape:(a,b,c)=>this._createAs3DShape(a,b,c)}};return l._createClass(h)}(u.Graphics3DSymbolLayer);
u.elevationModeChangeTypes={definedChanged:n.SymbolUpdateType.RECREATE,staysOnTheGround:n.SymbolUpdateType.NONE,onTheGroundChanged:n.SymbolUpdateType.RECREATE};const k=f.create();let U=function(m){function h(d,a,b,c){d=m.call(this,d,b,c)||this;d.color=a;return d}l._inherits(h,m);return l._createClass(h)}(p.PolygonCreationDataBase),V=function(m){function h(d,a,b,c){d=m.call(this,d,b,c)||this;d.color=a;return d}l._inherits(h,m);return l._createClass(h)}(p.PolygonCreationDataBase);z.Graphics3DPolygonFillSymbolLayer=
u;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});