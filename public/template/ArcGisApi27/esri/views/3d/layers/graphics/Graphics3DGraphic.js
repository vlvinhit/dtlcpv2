// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(t,u,v,w,x,y,z,A,B,C,D,k,n,E,q,F,g,G){const r=new x(Array,l=>k.set(l,k.ZERO),null,10,5),H=n.create();return function(){function l(a,b,d,f,e){this.graphic=a;this.graphics3DSymbol=b;this.layers=d;this._visibleFlags=g.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++b.referenced;this._featureExpressionFeature=e?G.createFeature(e,a,f):null}var c=l.prototype;c.initialize=function(a){this._layer=a;this._forEachSymbolLayerGraphic(b=>{b.initialize(a);b.setVisibility(this.isVisible())})};c.destroy=
function(){this._forEachSymbolLayerGraphic(a=>a.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};c.clearLabelGraphics=function(){this._forEachLabelGraphic(a=>a.destroy());this._labelLayers=null};c.addLabelGraphic=function(a,b){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(a);a.initialize(b);a.setVisibility(this.isVisible(g.VisibilityGroup.LABEL))};c.setCalloutGraphic=function(a){this._calloutLayer=a;this._layer&&(a.initialize(this._layer),
a.setVisibility(this.isVisible()))};c.isVisible=function(a=g.VisibilityGroup.GRAPHIC,b){b=b?this._visibleFlags|b|g.VisibilityGroup.LABEL*b:this._visibleFlags;return a===g.VisibilityGroup.GRAPHIC?(b&g.VisibilityFlag.ALL_GRAPHIC)===g.VisibilityFlag.ALL_GRAPHIC:(b&g.VisibilityFlag.ALL_LABEL)===g.VisibilityFlag.ALL_LABEL};c.setVisibilityFlag=function(a,b,d){const f=this.isVisible(a);this._visibleFlags=d?this._visibleFlags|a*b:this._visibleFlags&~(a*b);const e=this.isVisible(a);if(f===e)return!1;if(a===
g.VisibilityGroup.LABEL)this._forEachLabelGraphic(h=>h.setVisibility(e));else{this._forEachSymbolLayerGraphic(m=>m.setVisibility(e));const h=this.isVisible(g.VisibilityGroup.LABEL);this._forEachLabelGraphic(m=>m.setVisibility(h))}return!0};c.getVisibilityFlag=function(a,b){return 0!==(this._visibleFlags&a*b)};c.computeExtent=function(a){if(!this._extent){var b=this.graphic.geometry;if(null==b)return!1;this._extent=n.create();q.computeAABR(b,this._extent);b=b.spatialReference;if(!E.equals(b,a)&&!D.projectBoundingRect(this._extent,
b,this._extent,a))return this._extent=null,!1}return!0};c.getAsOptimizedGeometry=function(a,b){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,a,b));return this._optimizedGeometry};c._convertGraphicToOptimizedGeometry=function(a,b,d){a=a.geometry;if("mesh"===a.type||"extent"===a.type)a=C.fromExtent("mesh"===a.type?a.extent:a);return F.convertFromGeometry(a,b,d)};c.computeAttachmentOrigin=function(){const a={render:{origin:B.create(),num:0},draped:{origin:z.create(),
num:0}};for(const b of this.layers)null!=b&&b.computeAttachmentOrigin(a);1<a.render.num&&A.scale(a.render.origin,a.render.origin,1/a.render.num);1<a.draped.num&&y.scale(a.draped.origin,a.draped.origin,1/a.draped.num);return a};c.getProjectedBoundingBox=async function(a,b,d,f,e){e||(e={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});e.boundingBox?k.empty(e.boundingBox):e.boundingBox=k.empty();e.requiresDrapedElevation=!1;await v.forEach(this.layers,async h=>{if(null!=h){var m="draped"===
h.type?b:a,p=r.acquire();h=await h.getProjectedBoundingBox(m,d,e.screenSpaceObjects,f,p);isFinite(h[2])&&isFinite(h[5])||(e.requiresDrapedElevation=!0);h&&k.expandWithAABB(e.boundingBox,p);r.release(p)}});return k.allFinite(e.boundingBox)||n.allFinite(k.toRect(e.boundingBox,H))?e:null};c.needsElevationUpdates=function(){for(const a of this.layers)if(null!=a&&("object3d"===a.type||"lod-instance"===a.type)&&a.needsElevationUpdates)return!0;return this._labelLayers?.some(a=>a?.needsElevationUpdates??
!1)??!1};c.alignWithElevation=function(a,b,d){this._forEachRenderedGraphic(f=>{"object3d"!==f.type&&"lod-instance"!==f.type||f.alignWithElevation(a,b,this._featureExpressionFeature,d)})};c.alignWithAbsoluteElevation=function(a,b,d){this._forEachRenderedGraphic(f=>{"object3d"===f.type&&f.alignWithAbsoluteElevation(a,b,d)})};c.addObjectStateSet=function(a,b){this._forEachSymbolLayerGraphic(d=>d.addObjectState(a,b))};c.removeObjectState=function(a){this._forEachSymbolLayerGraphic(b=>b.removeObjectState(a))};
c._forEachGraphicList=function(a,b){a?.forEach(d=>d&&b(d))};c._forEachSymbolLayerGraphic=function(a){this._forEachGraphicList(this.layers,a);this._calloutLayer&&a(this._calloutLayer)};c._forEachLabelGraphic=function(a){this._forEachGraphicList(this._labelLayers,a)};c._forEachRenderedGraphic=function(a){this._forEachSymbolLayerGraphic(a);this._forEachLabelGraphic(a)};t._createClass(l,[{key:"labelLayers",get:function(){return this._labelLayers||u.EmptyArray}},{key:"extent",get:function(){return this._extent}},
{key:"isElevationSource",get:function(){return this.layers.some(a=>a?.isElevationSource)}},{key:"destroyed",get:function(){return null==this.layers}},{key:"calloutLayer",get:function(){return this._calloutLayer}},{key:"isDraped",get:function(){let a=!1;this._forEachSymbolLayerGraphic(b=>{"draped"===b.type&&(a=!0)});return a}},{key:"usedMemory",get:function(){let a=w.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(b=>{const d=b.graphics3DSymbolLayer.complexity;
null!=d&&(b="draped"===b.type?d.memory.draped:d.memory,a+=b.bytesPerFeature,b.bytesPerCoordinate&&(a+=q.numVertices(this.graphic.geometry)*b.bytesPerCoordinate))});return a}},{key:"test",get:function(){const a=this;return{addLabelLayer:b=>{a._labelLayers||(a._labelLayers=[]);a._labelLayers.push(b)}}}}]);return l}()});