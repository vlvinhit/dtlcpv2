// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),function(r,n,t,A,g,h,B,C,D,E,F,G){A.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");t=function(u){function m(){var c=u.apply(this,arguments)||this;
c._originalGeometries=[];c._fastTransformUpdatesEnabled=!1;return c}n._inherits(m,u);var l=m.prototype;l.enableFastTransformUpdates=function(c,d){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:e}=this,a=e.geometries.slice();e.removeAllGeometries();var b=g.getTranslation(p,e.transformation);d=d.getOrigin(b);for(const f of a)b=c(f.material),b=f.instantiate({material:b}),b.localOrigin=d,e.addGeometry(b);this._originalGeometries=a}};l.disableFastTransformUpdates=
function(c){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:d}=this,e=d.geometries.map(a=>c(a.material));d.removeAllGeometries();for(let a=0;a<this._originalGeometries.length;a++){const b=this._originalGeometries[a],f=e[a];f.setParameters({modelTransformation:null});f===b.material?d.addGeometry(b):d.addGeometry(b.instantiate({material:f}))}this._originalGeometries.length=0}};l.updateFastLocalOrigin=function(c,d,e){if(this._fastTransformUpdatesEnabled){var {stageObject:a}=
this;if(0!==a.geometries.length){var b=a.geometries[0].localOrigin,f=g.getTranslation(p,c),k=e.getOrigin(f);if(k!==b){var q=d?.localMatrix??h.IDENTITY;a.clearShaderTransformation();a.transformation=c;a.geometries.forEach(v=>{v.transformation=q;v.localOrigin=k})}}}};l.updateTransform=function(c,d,e){const {stageObject:a}=this,b=d?.localMatrix??h.IDENTITY;if(this._fastTransformUpdatesEnabled){d=g.multiply(w,a.transformation,a.geometries[0].transformation);var f=g.multiply(x,c,b);a.shaderTransformation=
c;this._setFastMaterialTransformation({matA:d,matB:f});c=()=>b;for(const k of a.geometries)k.shaderTransformer=c}else a.clearShaderTransformation(),a.transformation=c,a.geometries.forEach(k=>{k.transformation=b});this.resetEdgeObject(e)};l.alignWithElevation=function(c,d,e,a){if(this._fastTransformUpdatesEnabled){null!=e&&F.setContextFeature(this.elevationContext.featureExpressionInfoContext,e);var {stageObject:b}=this;if(b.geometries[0].material.parameters.modelTransformation){e=g.multiply(w,b.transformation,
b.geometries[0].transformation);var f=g.copy(H,b.shaderTransformation);this.alignedSampledElevation=D.perObjectElevationAligner(this,this.elevationContext,c.spatialReference,(k,q)=>E.evaluateElevationInfoAtPoint(k,c,this.elevationContext,d,q),d,f);b.shaderTransformation=f;b=g.multiply(x,f,b.geometries[0].shaderTransformation);this._setFastMaterialTransformation({matA:e,matB:b});this.resetEdgeObject(a)}}else n._get(n._getPrototypeOf(m.prototype),"alignWithElevation",this).call(this,c,d,e,a)};l._setFastMaterialTransformation=
function({matA:c,matB:d}){const {stageObject:e}=this;if(0!==e.geometries.length){var a=g.fromTranslation(I,B.scale(p,e.geometries[0].localOrigin.vec3,-1));c=g.multiply(y,a,c);d=g.multiply(z,a,d);a=g.invert(y,c);d=g.multiply(z,d,a);for(const b of e.geometries)b.material.setParameters({modelTransformation:d})}};n._createClass(m,[{key:"fastTransformUpdatesEnabled",get:function(){return this._fastTransformUpdatesEnabled}}]);return m}(G.Graphics3DObject3DGraphicLayer);const p=C.create(),w=h.create(),x=
h.create(),H=h.create(),y=h.create(),z=h.create(),I=h.create();r.Graphics3DMeshObject3DGraphicLayer=t;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});