// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),function(r,t,n,f,u,v,w,m){let x=function(){function p(a,b,g,k){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=g;this._drapeSourceRenderer=k;this.type="draped";this.stage=null;this.isElevationSource=
this._addedToStage=this._visible=!1}var d=p.prototype;d.initialize=function(a){this.stage=a.stage};d.setVisibility=function(a){if(null!=this.stage&&this._visible!==a)if((this._visible=a)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,m.DirtyOperation.ADD);else if(a||this._addedToStage){for(const b of this.renderGeometries)b.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,m.DirtyState.VISIBILITY)}};d.destroy=
function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,m.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};d.getCenterObjectSpace=function(a=n.create()){return t.set(a,0,0,0)};d.getBoundingBoxObjectSpace=function(a=f.create()){return f.empty(a)};d.addObjectState=function(a,b){a===w.Object3DState.Highlight&&(this.renderGeometries.forEach(g=>{const k=g.geometry.addHighlight();b.addRenderGeometry(g,k,this)}),this._addedToStage&&
this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,m.DirtyState.HIGHLIGHT))};d.removeObjectState=function(a){this.renderGeometries.forEach(b=>{a.removeRenderGeometry(b)})};d.removeRenderGeometryObjectState=function(a,b){a.geometry.removeHighlight(b);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,m.DirtyState.HIGHLIGHT)};d.computeAttachmentOrigin=function(a){for(const b of this.renderGeometries)b.geometry.computeAttachmentOrigin(l)&&(a.draped.origin[0]+=
l[0],a.draped.origin[1]+=l[1],a.draped.num++)};d.getProjectedBoundingBox=async function(a,b,g,k,c){f.empty(c);for(let h=0;h<this.renderGeometries.length;h++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[h],a,q,g),f.expandWithRect(c,q);if(b){f.center(c,l);let h;a=v.demResolutionForBoundingBox(c,b.service.spatialReference,b);try{h=await b.service.queryElevation(l[0],l[1],k,a,"ground")}catch(y){}null!=h&&(c[2]=Math.min(c[2],h),c[5]=Math.max(c[5],h))}return c};d._getRenderGeometryProjectedBoundingRect=
function(a,b,g,k){if(this.boundingBox)f.set(e,this.boundingBox);else{a=a.boundingSphere;const c=a[3];e[0]=a[0]-c;e[1]=a[1]-c;e[2]=a[2]-c;e[3]=a[0]+c;e[4]=a[1]+c;e[5]=a[2]+c}b(e,0,2);this.calculateRelativeScreenBounds&&k.push({location:f.center(e),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return f.toRect(e,g)};return r._createClass(p)}();const q=u.create(),e=f.create(),l=n.create();return x});