// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/MapUtils"],function(p,q,m,t){m=function(r){function l(a,e){var d=r.call(this)||this;d._updateAndCompare=a;d._notifyUpdated=e;d._nodes=new Map;d._graphics=new Map;d._duplicates=new Map;return d}q._inherits(l,r);var k=l.prototype;k.clear=function(){if(0<this._graphics.size){const a=this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:a})}this._nodes.clear()};k.get=function(a){return this._graphics.get(a)};
k.getNode=function(a){return this._nodes.get(a)};k.hasNode=function(a){return this._nodes.has(a)};k.nodes=function(){return this._nodes.values()};k.addNode=function(a,e){this._nodes.set(a,e);const d=e.graphics;if(0!==d.length){var f=new Set;for(let b=0;b<d.length;b++){var c=d[b];const g=c.objectId,h=this._graphics.get(g);h?(f.add(g),c!==h&&(d[b]=h),(c=this._duplicates.get(g))?c.push(a):this._duplicates.set(g,[h.nodeIndex,a])):(c.nodeIndex=a,this._graphics.set(g,c))}f.size&&this._updateForeignGraphics(e);
a=0<f.size?d.filter(b=>!f.has(b.objectId)):d;0<a.length&&this.emit("change",{added:a,removed:[]})}};k.removeNode=function(a){var e=this._nodes.get(a);if(e){this._nodes.delete(a);var d=new Set,f=[];for(const g of e.graphics){e=g.objectId;var c=this._graphics.get(e);if(!c)continue;const h=this._duplicates.get(e);if(h){var b=h.indexOf(a);if(-1===b)console.error("error: removing graphic from node that should not reference it.");else{h.splice(b,1);if(c.nodeIndex===a){c=this.getNode(h[0]);for(b=1;b<h.length;b++){const n=
this.getNode(h[b]);if(null==c||null!=n&&n.node.level>c.node.level)c=n}null!=c&&d.add(c)}1===h.length&&this._duplicates.delete(e)}}else this._graphics.delete(e),f.push(g)}0<f.length&&this.emit("change",{added:[],removed:f});d.forEach(g=>this._updateForeignGraphics(g))}else console.error("Removing unknown node")};k._updateForeignGraphics=function(a){const e=[],d=a.node.index,f=a.node.level;let c=0;for(;c<a.graphics.length;){var b=a.graphics[c].nodeIndex;if(b===d){c++;continue}let g=1;for(;c+g<a.graphics.length&&
a.graphics[c+g].nodeIndex===b;)g++;b=this.getNode(b);if(!(null!=b&&b.node.level>f))for(b=c;b<c+g;b++){const h=a.graphics[b];h.nodeIndex=d;this._updateAndCompare(h,a,b)&&e.push(h)}c+=g}this._notifyUpdated(e)};k.toArray=function(){return Array.from(this._graphics.values())};k.find=function(a){let e=void 0;t.someMap(this._graphics,d=>a(d)?(e=d,!0):!1);return e};k.forEach=function(a){this._graphics.forEach(e=>a(e))};k.forEachNode=function(a){this._nodes.forEach((e,d)=>a(e,d))};k._checkInvariants=function(){const a=
new Map;this._nodes.forEach((d,f)=>{f!==d.node.index&&console.error("Mismatched node index");d.graphics.forEach(c=>{a.set(c.objectId,1+(a.get(c.objectId)??0));const b=this._duplicates.get(c.objectId);b&&!b.includes(f)&&console.error("Node not listed in duplicate list");b||c.nodeIndex===f||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==a.size&&console.error("Mismatch between actual and expected number of graphics");let e=0;a.forEach((d,f)=>{e+=1<d?1:
0;const c=this._graphics.get(f);if(c){var b=this._nodes.get(c.nodeIndex);b?(f=this._duplicates.get(f))?(f.length!==d&&console.error("Wrong number of entries in duplicate list"),f.forEach(g=>{(g=this._nodes.get(g))?g.node.level>b.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<d&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});
this._duplicates.size!==e&&console.error("Mismatch between expected and actual number of duplicate entries")};q._createClass(l,[{key:"length",get:function(){return this._graphics.size}},{key:"nodeCount",get:function(){return this._nodes.size}}]);return l}(m);p.I3SGraphicsMap=m;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});