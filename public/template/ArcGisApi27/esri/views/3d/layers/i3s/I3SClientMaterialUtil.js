// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/materials/pbrUtils".split(" "),function(l,k,m,q,r,f,n,t){async function h(a,c,d,b){if(null==a)return-1;const g=d.length;var e=a.data;a=a.url;if(null!=e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e=p(e),d.push({id:g,usage:b,data:e,encoding:f.TextureEncoding.PNG,downsampled:!1}),c.push({id:g,
usage:b,encodings:[{name:void 0,encoding:f.TextureEncoding.PNG}]}),g;if(!(e instanceof HTMLVideoElement)){if(e instanceof ImageData)throw new m("ImageData textures not supported yet for client side I3S nodes");if(e instanceof r.EncodedMeshTexture)throw new m("EncodedMeshTexture textures not supported yet for client side I3S nodes");}}else if(null!=a)return e=new Image,e.src=a,e=await q.loadImageAsync(e,e.src,!1,void 0),e=p(e),d.push({id:g,usage:b,data:e,encoding:f.TextureEncoding.PNG,downsampled:!1}),
c.push({id:g,usage:b,encodings:[{name:void 0,encoding:f.TextureEncoding.PNG}]}),g;return-1}function p(a){var c=a.width*a.height;if(4096<=c){let d=a.width,b=a.height;do d=Math.ceil(d/2),b=Math.ceil(b/2),c=d*b;while(1048576<c);c=document.createElement("canvas");c.width=d;c.height=b;c.getContext("2d").drawImage(a,0,0,d,b);return c}return a}l.convertMeshMaterialToPBRMaterial=async function(a){const c=[],d=[];if(null==a)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,
emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:c,textureData:d};const b=a.hasOwnProperty("metallicRoughnessTexture");"auto"===a.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');return{material:{alphaMode:"auto"===a.alphaMode?
"blend":a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,cullFace:a.doubleSided?n.CullFaceOptions.None:n.CullFaceOptions.Back,normalTextureId:await h(a.normalTexture,c,d,f.TextureUsage.Normal),emissiveTextureId:b?await h(a.emissiveTexture,c,d,f.TextureUsage.Emissive):-1,occlusionTextureId:b?await h(a.occlusionTexture,c,d,f.TextureUsage.Occlusion):-1,emissiveFactor:b&&null!=a.emissiveColor?k.toUnitRGB(a.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=a.color?k.toUnitRGBA(a.color):
[1,1,1,1],baseColorTextureId:await h(a.colorTexture,c,d,f.TextureUsage.Color),metallicRoughnessTextureId:b?await h(a.metallicRoughnessTexture,c,d,f.TextureUsage.MetallicRoughness):-1,metallicFactor:b?a.metallic:0,roughnessFactor:b?a.roughness:0},wrapTextures:!0,hasParametersFromSource:t.useSchematicPBR({normalTexture:a.normalTexture,emissiveTexture:b?a.emissiveTexture:null,emissiveFactor:b?k.toUnitRGB(a.emissiveColor):null,occlusionTexture:b?a.occlusionTexture:null,metallicRoughnessTexture:b?a.metallicRoughnessTexture:
null,metallicFactor:b?a.metallic:null,roughnessFactor:b?a.roughness:null})},requiredTextures:c,textureData:d}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});