// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(u,h,c,y,v,l,H,I,J,z,A,B,C,q,D,m,E,F,G){const f=m.empty(),k=B.create(),w=E.fromValues(0,0,0,0),b=q.create(),r=q.create(),t=q.create();c=function(x){function n(a){a=x.call(this,a)||this;a._tmpEvent={spatialReference:null,extent:f,context:"scene"};return a}u._inherits(n,x);var d=n.prototype;d.initialize=function(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=F.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
G.StoreResults.MIN;const a=this.layerView.i3slayer.fullExtent;null==a?v.getLogger(this).error("I3SElevationProvider expected fullExtent on I3SLayer."):(this._zmin=a.zmin,this._zmax=a.zmax);this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};d.getElevation=function(a,e,p,g){b[0]=a;b[1]=e;b[2]=p;if(!this._renderCoordsHelper.toRenderCoords(b,g,b))return v.getLogger(this).error("could not project point to compute elevation"),null;a=this.layerView.elevationOffset;e=this._zmin+a;
this._renderCoordsHelper.setAltitude(r,this._zmax+a,b);this._renderCoordsHelper.setAltitude(t,e,b);this._intersector.reset(r,t,null);this.intersectionHandler.intersect(this._intersector,null,r,t);return this._intersector.results.min.getIntersectionPoint(b)?this._renderCoordsHelper.getAltitude(b):null};d.getSphereElevationBounds=function(a,e){D.projectBoundingSphere(a,e,w,this._renderCoordsHelper.spatialReference);return this.layerView.getElevationRange(w)};d.layerChanged=function(){this.spatialReference&&
(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};d.objectChanged=function(a){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(a),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};d._computeObjectExtent=function(a){m.empty(f);this._expandExtent(a,f);return f};d._computeLayerExtent=function(){m.empty(f);for(const a of this.layerView.getVisibleNodes())this._expandExtent(a,
f);return f};d._expandExtent=function(a,e){const p=this.spatialReference;if(null!=p&&(a=this.layerView.getNodeComponentObb(a),null!=a)){A.fromQuat(k,a.quaternion);k[12]=a.center[0];k[13]=a.center[1];k[14]=a.center[2];for(let g=0;8>g;++g)b[0]=g&1?a.halfSize[0]:-a.halfSize[0],b[1]=g&2?a.halfSize[1]:-a.halfSize[1],b[2]=g&4?a.halfSize[2]:-a.halfSize[2],C.transformMat4(b,b,k),this._renderCoordsHelper.fromRenderCoords(b,b,p),m.expand(e,b,e)}};u._createClass(n,[{key:"spatialReference",get:function(){return this.view?.elevationProvider?.spatialReference}}]);
return n}(y.EventedMixin(c));h.__decorate([l.property({constructOnly:!0})],c.prototype,"layerView",void 0);h.__decorate([l.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);h.__decorate([l.property()],c.prototype,"view",void 0);h.__decorate([l.property()],c.prototype,"spatialReference",null);return c=h.__decorate([z.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],c)});