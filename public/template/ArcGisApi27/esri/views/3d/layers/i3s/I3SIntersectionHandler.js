// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(v,B,C,w,D,x,E,y,F){function G(d,e,a,f=0){f=d[3]+f;const g=e[0]-d[0],h=e[1]-d[1];d=e[2]-d[2];e=a[0];const c=a[1];a=a[2];const l=e*g+c*h+a*d;return 0<=l*l-(e*e+c*c+a*a)*(g*g+h*h+d*d-f*f)}let L=function(){function d(a){this.type=
y.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this._collection=a.collection;this._traverseNodeHierarchy=a.traverseNodeHierarchy;this.slicePlaneEnabled=a.slicePlaneEnabled;this.isGround=a.isGround}var e=d.prototype;e.updateElevationAlignState=function(a,f){this._needVerticalOffset=a&&f===C.ViewingMode.Global};e.intersect=function(a,f,g,h){const c=a.results,l=a.options.store===y.StoreResults.ALL,r=a.ray.direction,m=a.tolerance;let z=b=>b,t=
b=>b;const n=F.getVerticalOffsetI3S(null!=a.verticalOffset?a.verticalOffset:this._needVerticalOffset?0:null);null!=a.verticalOffset&&null!=n&&(z=b=>n.applyToMbs(b),t=b=>n.applyToObb(b));this._traverseNodeHierarchy((b,A)=>{if(0===b.childrenLoaded)return!1;const u=null!=b.serviceObbInRenderSR&&w.isValidObb(b.serviceObbInRenderSR)?b.serviceObbInRenderSR:null;if(null!=u&&!x.intersectLine(t(u),g,r,m))return!1;!A||null==u&&w.isValidMbs(b.renderMbs)&&!G(z(b.renderMbs),g,r,m)||null!=b.geometryObb&&!x.intersectLine(t(b.geometryObb),
g,r,m)||this._collection.intersect(A,g,h,m,n,(H,k,I,J)=>{if(0<=k&&(null==f||f(g,h,k))){var q=p=>{const K=new D.I3sTarget(this.layerUid,this.sublayerUid,b.index,H,J);p.set(this.type,K,k,I)};this.isGround&&(null==c.ground.dist||k<c.ground.dist)&&q(c.ground);if(!a.options.isFiltered&&((null==c.min.dist||k<c.min.dist)&&q(c.min),(null==c.max.dist||k>c.max.dist)&&q(c.max),l)){const p=E.newIntersectorResult(a.ray);q(p);a.results.all.push(p)}}});return!0})};return B._createClass(d)}();v.I3SIntersectionHandler=
L;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});