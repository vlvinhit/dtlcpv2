// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/Error ../../../core/accessorSupport/decorators/subclass ./DynamicLayerView3D ../../layers/ImageryLayerView".split(" "),function(h,l,m,n,f,t,u,v,w,p,q,r){f=function(k){function g(){var a=k.apply(this,arguments)||this;a.type="imagery-3d";a.redrawDebounced=
m.debounce(async c=>{a.redraw((b,e)=>a._redrawImage(b,e),c)},2E3);return a}h._inherits(g,k);var d=g.prototype;d.initialize=function(){this.handles.add([n.when(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))]);this.updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,()=>{this.updatingHandles.addPromise(this.refreshDebounced())});this.updatingHandles.add(()=>
this.layer?.renderer,()=>{this.updatingHandles.addPromise(this.refreshDebounced())});this.updatingHandles.add(()=>this.timeExtent,()=>this.updatingHandles.addPromise(this.refreshDebounced()))};d._initializeMaximumDataResolution=function(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null};d.getFetchOptions=function(){return{timeExtent:this.timeExtent}};d.processResult=async function(a,c,b){c.imageOrCanvasElement?a.image=c.imageOrCanvasElement:(a.image=document.createElement("canvas"),
a.pixelData=c.pixelData,await this._redrawImage(a,b))};d._redrawImage=async function(a,c){if(!(a.image instanceof HTMLCanvasElement)||null==a.pixelData)throw Error();var b=a.image;const e=b.getContext("2d");a=await this.layer.applyRenderer(a.pixelData,{signal:c});a=this.layer.applyFilter(a).pixelBlock;if(null==a)throw Error();b.width=a.width;b.height=a.height;b=e.createImageData(a.width,a.height);b.data.set(a.getAsRGBA());e.putImageData(b,0,0)};return h._createClass(g)}(r(q));return f=l.__decorate([p.subclass("esri.views.3d.layers.ImageryLayerView3D")],
f)});