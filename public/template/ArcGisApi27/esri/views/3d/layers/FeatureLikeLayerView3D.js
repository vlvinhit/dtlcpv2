// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(p,h,e,m,l,q,f,G,H,I,t,u,v,w,x,y,z,A,B,C,D,E,F){p.FeatureLikeLayerView3D=d=>{d=function(r){function k(){var a=r.apply(this,arguments)||this;a.controller=null;a.updatePolicy=E.UpdatePolicy.SYNC;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._controllerCreated=!1;a.supportsHeightUnitConversion=!0;a._pendingController=null;a.queryEngine=null;return a}h._inherits(k,r);var c=k.prototype;c.initialize=function(){const a=
this.layer;if("isTable"in a&&a.isTable)this.addResolvingPromise(Promise.reject(new m("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:a})));else{this.addResolvingPromise(this._validateGeometryType());this.updatingHandles.add(()=>this.layer.renderer,g=>this._recreateProcessor(g),q.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await D.toViewIfLocal(this);await this._initializeController()})());this.updatingHandles.add(()=>
this.updatePolicy,g=>this.processor.preferredUpdatePolicy=g);var b=()=>this.processor.featureStore;this.queryEngine=new A.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return b()},hasZ:this.hasZ,hasM:this.hasM},priority:F.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}};c.destroy=function(){this._destroyPendingController();this.controller=l.destroyMaybe(this.controller);this._set("processor",
l.destroyMaybe(this.processor));this.queryEngine=l.destroyMaybe(this.queryEngine);this.loadedGraphics=null};c._destroyPendingController=function(){this._pendingController=l.destroyMaybe(this._pendingController)};c.getHit=function(a){let b;this.loadedGraphics?.forEach(g=>{g.uid===a&&(b=u.hydrateGraphic(g,this.layer))});return b?{type:"graphic",graphic:b,layer:b.layer}:null};c.whenGraphicBounds=function(a,b){return this.processor?.whenGraphicBounds(a,b)};c.computeAttachmentOrigin=function(a,b){return this.processor?.computeAttachmentOrigin(a,
b)};c.elevationAlignPointsInFeatures=async function(a,b){const g=this.graphics3DProcessor;if(null==g)throw new m("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return y.elevationAlignPointsInFeatures(this.view,this.layer,n=>g.getGraphics3DGraphicByObjectId(n),a,b)};c.queryForSymbologySnapping=async function(a,b){return this.symbologySnappingSupported?B.queryForSymbologySnapping(this.graphics3DProcessor,a,b):{candidates:[],sourceCandidateIndices:[]}};
c.queryFeatures=function(a,b){return this.queryEngine.executeQuery(this._ensureQuery(a),b?.signal)};c.queryObjectIds=function(a,b){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),b?.signal)};c.queryFeatureCount=function(a,b){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),b?.signal)};c.queryExtent=function(a,b){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),b?.signal)};c._ensureQuery=function(a){return null==a?this.createQuery():w.from(a)};c.highlight=
function(a){return this.processor.highlight(a,this.layer.objectIdField)};c.maskOccludee=function(a){return this.processor.maskOccludee(a)};c.canResume=function(){return h._get(h._getPrototypeOf(k.prototype),"canResume",this).call(this)&&!this.processor?.scaleVisibilitySuspended};c.getSuspendInfo=function(){const a=h._get(h._getPrototypeOf(k.prototype),"getSuspendInfo",this).call(this);return this.processor?{...a,...this.processor.suspendInfo}:a};c.isUpdating=function(){return!this.processor||this.processor.destroyed?
!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)};c._initializeController=async function(){const a=this.createController();this._pendingController=a;await a.when();this._setControllerWhenInitialized(a)};c._setControllerWhenInitialized=async function(a){try{await this.when()}catch(b){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(await q.whenOnce(()=>
this.view?.basemapTerrain?.ready),this.beforeSetController(a),this._pendingController=null,this.controller=a,this.loadedGraphics=a.graphics,this.notifyChange("updating"))};c._updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};c._validateGeometryType=async function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new m("featurelayerview3d:unsupported-geometry-type",
"Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}};c._recreateProcessor=function(a){var b="heatmap"===a?.type;const g="heatmap"===this.processor?.type;a=this.processor;a&&b===g||(b=b?new C.HeatmapFeatureProcessor({owner:this}):new z({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:n=>
this._updateClippingExtent(n)}),this._set("processor",b),a?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(b.initializePromise))};c._getResourceInfo=function(){const a=this.controller instanceof v.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics?.length,maximumNumberOfFeatures:a?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:a?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}};h._createClass(k,[{key:"legendEnabled",
get:function(){return this.canResume()&&this.processor?.legendEnabled}},{key:"graphics3DProcessor",get:function(){return"graphics-3d"===this.processor?.type?this.processor:null}},{key:"heatmapProcessor",get:function(){return"heatmap"===this.processor?.type?this.processor:null}},{key:"symbologySnappingSupported",get:function(){return this.layer?.renderer?.getSymbols()?.some(x.symbolHasExtrudeSymbolLayer)??!1}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return k}(d);e.__decorate([f.property()],
d.prototype,"loadedGraphics",void 0);e.__decorate([f.property()],d.prototype,"suspended",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"legendEnabled",null);e.__decorate([f.property()],d.prototype,"updating",void 0);e.__decorate([f.property()],d.prototype,"controller",void 0);e.__decorate([f.property()],d.prototype,"processor",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"updatePolicy",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspendResumeExtentMode",
void 0);e.__decorate([f.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspendInfo",void 0);e.__decorate([f.property()],d.prototype,"graphics3DProcessor",null);e.__decorate([f.property()],d.prototype,"heatmapProcessor",null);e.__decorate([f.property()],d.prototype,"symbologySnappingSupported",null);return d=e.__decorate([t.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],d)};Object.defineProperty(p,Symbol.toStringTag,
{value:"Module"})});