// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),function(f,k,p,B,M,N,l,x,O,P,C,Q,R){function r(a){return null!==a&&void 0!==a}function q(a){return"number"===typeof a}
function u(a){return"string"===typeof a}function g(a,c){a&&a.push(c)}function S(a,c,b,d=x.create()){a=a||0;c=c||0;b=b||0;0!==a&&l.rotateZ(d,d,-a/180*Math.PI);0!==c&&l.rotateX(d,d,c/180*Math.PI);0!==b&&l.rotateY(d,d,b/180*Math.PI);return d}function m(a,c,b,d,e){const h=a.minSize,v=a.maxSize;if(a.expression)return g(e,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=d.symbolSize[b],c.minSize[b]=a,c.maxSize[b]=a,c.offset[b]=c.minSize[b],c.factor[b]=0,c.type[b]=
f.FastSizeType.DefinedSize,!0;if(r(a.field)){if(r(a.stops)){if(2===a.stops.length&&q(a.stops[0].size)&&q(a.stops[1].size))return D(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,c,b),c.type[b]=f.FastSizeType.DefinedSize,!0;g(e,"Could not convert size info: stops only supported with 2 elements");return!1}if(q(h)&&q(v)&&r(a.minDataValue)&&r(a.maxDataValue))return D(h,v,a.minDataValue,a.maxDataValue,c,b),c.type[b]=f.FastSizeType.DefinedSize,!0;if("unknown"===a.valueUnit)return g(e,
"Could not convert size info: proportional size not supported"),!1;if(null!=C.meterIn[a.valueUnit])return c.minSize[b]=-Infinity,c.maxSize[b]=Infinity,c.offset[b]=0,c.factor[b]=1/C.meterIn[a.valueUnit],c.type[b]=f.FastSizeType.DefinedSize,!0;g(e,"Could not convert size info: scale-dependent size not supported");return!1}if(!r(a.field)){if(a.stops&&a.stops[0]&&q(a.stops[0].size))return c.minSize[b]=a.stops[0].size,c.maxSize[b]=a.stops[0].size,c.offset[b]=c.minSize[b],c.factor[b]=0,c.type[b]=f.FastSizeType.DefinedSize,
!0;if(q(h))return c.minSize[b]=h,c.maxSize[b]=h,c.offset[b]=h,c.factor[b]=0,c.type[b]=f.FastSizeType.DefinedSize,!0}g(e,"Could not convert size info: unsupported variant of sizeInfo");return!1}function D(a,c,b,d,e,h){d=0<Math.abs(d-b)?(c-a)/(d-b):0;e.minSize[h]=0<d?a:c;e.maxSize[h]=0<d?c:a;e.offset[h]=a-b*d;e.factor[h]=d}function T(a,c,b,d){if(a.normalizationField||a.valueRepresentation)return g(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!u(e))return g(d,
"Could not convert size info: field is not a string"),null;if(!c.size)c.size=new E(a.field);else if(a.field)if(!c.size.field)c.size.field=a.field;else if(a.field!==c.size.field)return g(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=m(a,c.size,0,b,d))?c:null;case "height":return(e=m(a,c.size,2,b,d))?c:null;case "depth":return(e=m(a,c.size,1,b,d))?c:null;case "width-and-depth":return(e=m(a,c.size,0,b,d))&&m(a,c.size,1,b,d),e?c:null;case null:case void 0:case "all":return(e=
(e=(e=m(a,c.size,0,b,d))&&m(a,c.size,1,b,d))&&m(a,c.size,2,b,d))?c:null;default:return g(d,`Could not convert size info: unknown axis "${a.axis}""`),null}}function U(a,c,b){for(let d=0;3>d;++d){let e=c.unitInMeters;a.type[d]===f.FastSizeType.DefinedSize&&(e*=c.modelSize[d],a.type[d]=f.FastSizeType.DefinedScale);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(a.type[0]!==f.FastSizeType.Undefined)c=0;else if(a.type[1]!==f.FastSizeType.Undefined)c=1;else if(a.type[2]!==f.FastSizeType.Undefined)c=
2;else return g(b,"No size axis contains a valid size or scale"),!1;for(b=0;3>b;++b)a.type[b]===f.FastSizeType.Undefined&&(a.minSize[b]=a.minSize[c],a.maxSize[b]=a.maxSize[c],a.offset[b]=a.offset[c],a.factor[b]=a.factor[c],a.type[b]=a.type[c]);return!0}function F(a,c,b){a[4*c]=b.r/255;a[4*c+1]=b.g/255;a[4*c+2]=b.b/255;a[4*c+3]=b.a}function V(a,c,b){if(a.normalizationField)return g(b,"Could not convert color info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return g(b,
"Could not convert color info: too many color stops"),null;c.color=new G(a.field);a=a.stops;for(b=0;8>b;++b){const d=a[Math.min(b,a.length-1)];c.color.values[b]=d.value;F(c.color.colors,b,d.color)}}else return g(b,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(a=a.stops&&0<=a.stops.length&&a.stops[0].color,c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)c.color.values[b]=
Infinity,F(c.color.colors,b,a);else return g(b,"Could not convert color info: no field and no colors/stops"),null;return c}function W(a,c,b){if(a.normalizationField)return g(b,"Could not convert opacity info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return g(b,"Could not convert opacity info: too many opacity stops"),null;c.opacity=new H(a.field);a=a.stops;for(b=0;8>b;++b){const d=a[Math.min(b,a.length-1)];c.opacity.values[b]=d.value;c.opacity.opacityValues[b]=d.opacity}}else return g(b,
"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].opacity:0,c.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},b=0;8>b;b++)c.opacity.values[b]=Infinity,c.opacity.opacityValues[b]=a;else return g(b,"Could not convert opacity info: no field and no opacities/stops"),null;return c}function y(a,c,b){a=2===b&&"arithmetic"===a.rotationType;c.offset[b]=a?90:0;c.factor[b]=a?-1:1;c.type[b]=
1}function X(a,c,b){if(!u(a.field))return g(b,"Could not convert rotation info: field is not a string"),null;if(!c.rotation)c.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!c.rotation.field)c.rotation.field=a.field;else if(a.field!==c.rotation.field)return g(b,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return y(a,c.rotation,0),c;case "roll":return y(a,c.rotation,1),c;case null:case void 0:case "heading":return y(a,
c.rotation,2),c;default:return g(b,`Could not convert rotation info: unknown axis "${a.axis}""`),null}}function z(a,c,b){if(!a)return null;const d=a.reduce((e,h)=>{if(!e)return e;if(h.valueExpression)return g(b,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return c.supports.size?T(h,e,c,b):e;case "color":return c.supports.color?V(h,e,b):e;case "opacity":return c.supports.opacity?W(h,e,b):null;case "rotation":return c.supports.rotation?X(h,
e,b):e;default:return null}},new I);return 0<a.length&&d&&!d.size&&!d.color&&!d.opacity&&!d.rotation||d&&d.size&&!U(d.size,c,b)?null:d}function w(a,c,b){if(!!a!==!!c||a&&a.field!==c?.field)return!1;if(a&&"rotation"===b)for(b=0;3>b;b++)if(a.type[b]!==c.type[b]||a.offset[b]!==c.offset[b]||a.factor[b]!==c.factor[b])return!1;return!0}function A(a,c){a=new J(a);a.vvSize&&(a.vvSymbolAnchor=c.anchor,l.identity(t),S(c.rotation[2],c.rotation[0],c.rotation[1],t),a.vvSymbolRotationMatrix=a.vvSymbolRotationMatrix||
N.create(),M.fromMat4(a.vvSymbolRotationMatrix,t));return a}f.FastSizeType=void 0;(function(a){a[a.Undefined=0]="Undefined";a[a.DefinedSize=1]="DefinedSize";a[a.DefinedScale=2]="DefinedScale"})(f.FastSizeType||(f.FastSizeType={}));f.FastRotationType=void 0;(function(a){a[a.Undefined=0]="Undefined";a[a.DefinedAngle=1]="DefinedAngle"})(f.FastRotationType||(f.FastRotationType={}));p=k._createClass(function(a){this.field=a});let E=function(a){function c(b){b=a.call(this,b)||this;b.minSize=[0,0,0];b.maxSize=
[0,0,0];b.offset=[0,0,0];b.factor=[0,0,0];b.type=[f.FastSizeType.Undefined,f.FastSizeType.Undefined,f.FastSizeType.Undefined];return b}k._inherits(c,a);return k._createClass(c)}(p),G=function(a){function c(b){b=a.call(this,b)||this;b.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];b.values=[0,0,0,0,0,0,0,0];return b}k._inherits(c,a);return k._createClass(c)}(p),H=function(a){function c(b){b=a.call(this,b)||this;b.values=[0,0,0,0,0,0,0,0];b.opacityValues=[0,0,0,0,0,0,0,0];
return b}k._inherits(c,a);return k._createClass(c)}(p);p=function(a){function c(b){b=a.call(this,b)||this;b.offset=[0,0,0];b.factor=[1,1,1];b.type=[0,0,0];return b}k._inherits(c,a);return k._createClass(c)}(p);let I=k._createClass(function(){}),Y=k._createClass(function(a,c=[1,1,1],b=[1,1,1],d=1,e=[0,0,0],h=[1,1,1],v=[0,0,0]){this.supports=a;this.modelSize=c;this.symbolSize=b;this.unitInMeters=d;this.anchor=e;this.scale=h;this.rotation=v}),K=k._createClass(function(a,c,b){this.visualVariables=a;this.materialParameters=
c;this.requiresShaderTransformation=b}),J=function(a){function c(b){var d=a.call(this)||this;d.vvSize=b?.size??null;d.vvColor=b?.color??null;d.vvOpacity=b?.opacity??null;return d}k._inherits(c,a);return k._createClass(c)}(R.NoParameters);const n=x.create(),L=P.create(),t=x.create();f.ConvertOptions=Y;f.FastColorInfo=G;f.FastOpacityInfo=H;f.FastRotationInfo=p;f.FastSizeInfo=E;f.FastSymbolUpdatesState=K;f.FastVisualVariables=I;f.VisualVariablesParameters=J;f.convertVisualVariables=z;f.evaluateModelTransform=
function(a,c,b){if(!a.vvSize)return b;l.copy(n,b);b=a.vvSymbolRotationMatrix;l.set(t,b[0],b[1],b[2],0,b[3],b[4],b[5],0,b[6],b[7],b[8],0,0,0,0,1);l.multiply(n,n,t);for(b=0;3>b;++b)L[b]=B.clamp(a.vvSize.offset[b]+c[0]*a.vvSize.factor[b],a.vvSize.minSize[b],a.vvSize.maxSize[b]);l.scale(n,n,L);l.translate(n,n,a.vvSymbolAnchor);return n};f.evaluateModelTransformScale=function(a,c,b){if(c.vvSize)for(let d=0;3>d;++d)a[d]=B.clamp(c.vvSize.offset[d]+b[0]*c.vvSize.factor[d],c.vvSize.minSize[d],c.vvSize.maxSize[d]);
else O.set(a,1,1,1)};f.getAttributeValue=function(a,c){a=null==a?0:c.attributes[a];return"number"===typeof a&&isFinite(a)?a:0};f.getMaterialParameters=A;f.initFastSymbolUpdatesState=function(a,c){return!a||Q.TESTS_DISABLE_FAST_UPDATES?null:(a=z(a.visualVariables,c))?new K(a,A(a,c),!!a.size):null};f.updateFastSymbolUpdatesState=function(a,c,b){if(!c||!a)return!1;const d=a.visualVariables;c=z(c.visualVariables,b);if(!(c&&w(d.size,c.size,"size")&&w(d.color,c.color,"color")&&w(d.rotation,c.rotation,"rotation")&&
w(d.opacity,c.opacity,"opacity")))return!1;a.visualVariables=c;a.materialParameters=A(c,b);a.requiresShaderTransformation=!!c.size;return!0};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});