// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(Ua,z,W,v,Va,fa,va,Wa,Xa,ma,Ya,wa,G,Za,X,H,$a,xa,ya,x,Ub,ab,bb,cb,za,Aa,db,I,Y,eb,fb,gb,P,Z,aa,Ba,hb,ib,jb,kb,lb,mb,nb,ob,Ca,pb,qb,rb,Da,sb,Ea,B,ha,Fa,tb,O,ub,vb,Ga,wb,xb,yb,ba,na,zb,oa,w,Ab,Bb,pa,qa,ca,Ha,ia,Cb,Db,ra,Eb,ja,Ia,ka){function Q(h,p){X.isAbortError(h)||L.warn("Error while processing edges. Edges on this layer might not display correctly",p,h)}function Ja(h){if(null==h)return!1;const p=h.metallicRoughness;return p&&0<=p.baseColorTextureId||p&&0<=p.metallicRoughnessTextureId||0<=
h.normalTextureId||0<=h.emissiveTextureId||0<=h.occlusionTextureId}function Ka(h){return null!=h&&xa.isArrayBuffer(h.data)}function La(h,p){h=1024+h.interleavedVertexData.byteLength+(h.indices?h.indices.byteLength:0)+h.positionData.data.byteLength+h.positionData.indices.byteLength;if(null!=p)for(const t of p)null!=t&&xa.isArrayBuffer(t.data)&&(h+=t.data.byteLength);return h}function Ma(h,p){return p.byteSize>Fb?(L.warn(`Node is too big to store in IndexedDB cache: ${h.id} (${p.byteSize} bytes)`),
!1):0<p.byteSize}function Gb(h){if(0===h.length)return null;const p=new Float64Array(10*h.length);h.forAll((t,f)=>{let a=t.serviceObb;null==a&&(a=Hb,I.copy(a.center,t.mbs),a.halfSize[0]=a.halfSize[1]=a.halfSize[2]=t.mbs[3]);t=10*f;p[t]=a.center[0];p[t+1]=a.center[1];p[t+2]=a.center[2];p[t+3]=a.halfSize[0];p[t+4]=a.halfSize[1];p[t+5]=a.halfSize[2];p[t+6]=a.quaternion[0];p[t+7]=a.quaternion[1];p[t+8]=a.quaternion[2];p[t+9]=a.quaternion[3]});return p}function da(h,p){h.forEach(t=>t.opacity=p)}function Ib(h){return p=>
{if(h.immediate)return h.immediate.schedule(p);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}const L=Ya.getLogger("esri.views.3d.layers.I3SMeshView3D"),Na=[1,1,1,1];let Jb=function(h){function p(t,f,a,b,c,d,e,g,k){var l=h.call(this)||this;l.node=t;l.featureIds=f;l.objectHandle=a;l.cachedRendererVersion=b;l.attributeInfo=c;l.material=d;l.textures=e;l.anchorIds=g;l.anchors=k;l.cachedElevationAnchors=null;l.cachedEdgeMaterials=[];l.edgeMemoryUsage=0;return l}
W._inherits(p,h);return W._createClass(p)}(Ga.NodeCrossfadeMetaData);var T;(function(h){h[h.CastShadows=4]="CastShadows";h[h.Pickable=5]="Pickable"})(T||(T={}));const Fb=100*Wa.ByteSizeUnit.MEGABYTES;var J;(function(h){h[h.ADD=0]="ADD";h[h.REMOVE=1]="REMOVE";h[h.UPDATE=2]="UPDATE"})(J||(J={}));const Oa=Z.create(),Pa=aa.create(),Kb=aa.create(),Hb=ia.create(),ea=[0,0,0,0],Lb=new Va([0,0,0,0]),Qa=jb.fromValues(0,0,0,0),Mb={remove(){},pause(){},resume(){}};z.ElevationMode=void 0;(function(h){h[h.Absolute=
0]="Absolute";h[h.RelativeToGround=1]="RelativeToGround";h[h.OnTheGround=2]="OnTheGround"})(z.ElevationMode||(z.ElevationMode={}));const C=Y.create(),U=Z.create();z.I3SMeshView3D=h=>{h=function(p){function t(...a){a=p.call(this,a)||this;a._nodeId2Meta=new Map;a._nodeId2MetaReloading=new Map;a._i3sWasmLoaded=!1;a._snappingSourcesTrackers=[];a._hasLoadedPBRTextures=!1;a._asyncModuleLoading=0;a._addTasks=new Map;a._currentRenderer=null;a._rendererVersion=0;a._colorVariable=null;a._opacityVariable=null;
a._rendererFields=null;a._symbologyFields=null;a._symbologyOverride=null;a._symbologyOverrideFields=null;a._symbolInfos=new Map;a._visibleGeometryChangedSchedulerHandle=null;a._idbCache=ma("enable-feature:idb-mock-cache")?new Bb.IDBMockCache:new Ab.IDBCache("esri-scenelayer-cache","geometries");a._hasComponentData=!1;a._hasVertexColors=!1;a.updating=!0;a.holeFilling="auto";a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._modifications=[];a.ignoresMemoryFactor=!1;a._layerUrl=
"";a._cacheKeySuffix=null;a._elevationTask=null;a._filters=[];a._arcade=null;a._tmpAttributeOnlyGraphic=new fa(null,null,{});a._crossfadeHelper=new Ga.I3SCrossfadeHelper(W._assertThisInitialized(a));return a}W._inherits(t,p);var f=t.prototype;f.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);var a=this.view.resourceController;this.i3sOverrides=new zb.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:a.memoryController});this._worker=new Ea.I3SMeshWorkerHandle(Ib(a));
this.addResolvingPromise(this._worker.promise);a=this.i3slayer.store;this._worker.setLegacySchema(this.uid,a.defaultGeometrySchema);w.checkSceneLayerValid(this.i3slayer);w.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new mb({layerView:this,worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;
this.resetHighlights();a=a.defaultGeometrySchema;if(this._isIntegratedMesh||!a)this._hasComponentData=!1;else{const b=a.featureAttributes;this._hasComponentData=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=(a?.vertexAttributes.color??null)&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,b=>this._deleteComponentObject(b));
this._intersectionHandler=new yb.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:b=>null!=this._controller.index&&null!=this._controller.index.rootNode?this._controller.index.traverse(this._controller.index.rootNode,c=>{var d=c.index;d=this._nodeId2Meta.get(d)||this._nodeId2MetaReloading.get(d);return b(c,null!=d?d.objectHandle:null)}):()=>{}});this.updatingHandles.add(()=>
this.layerUid,b=>this._intersectionHandler.layerUid=b);this.updatingHandles.add(()=>this.sublayerUid,b=>this._intersectionHandler.sublayerUid=b);this._elevationProvider=new wb({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),H.initial);this.updatingHandles.add(()=>this.fullOpacity,b=>this._opacityChange(b));this.updatingHandles.add(()=>this.slicePlaneEnabled,b=>
this._slicePlaneEnabledChange(b));this.updatingHandles.add(()=>this.elevationOffset,(b,c)=>{this._reloadAll(c);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(b,c)=>this._elevationInfoChanged(b,c),H.initial);this.updatingHandles.add(()=>this.contentVisible&&this.elevationInfo.mode!==z.ElevationMode.Absolute,(b,c)=>{b?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:d})=>this._ensureElevationTask().addExtent(d)),"elevation-change"):
c&&this.handles.remove("elevation-change")},H.initial);this.updatingHandles.add(()=>this._usePBR,b=>this._updatePBR(b));a=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,a);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,a);this.updatingHandles.add(()=>this.contentVisible,b=>this._contentVisibleChanged(b),H.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),H.initial);this.updatingHandles.add(()=>
this.i3slayer.labelingInfo,()=>this._labelingChanged(),H.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),H.initial);this.handles.add([H.watch(()=>ca.I3S_TREE_SHOW_TILES,b=>{if(b&&!this._treeDebugger){const c=this._controller.crsIndex;(new Promise((d,e)=>Ua(["./support/I3STreeDebugger"],d,e))).then(({I3STreeDebugger:d})=>{!this._treeDebugger&&ca.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new d({lv:this,view:this.view,nodeSR:c}))})}else b||ca.I3S_TREE_SHOW_TILES||
(this._treeDebugger=G.destroyMaybe(this._treeDebugger))},H.initial),H.watch(()=>ca.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),H.initial)]);this._cacheKeySuffix=w.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(b=>L.warn(`Failed to initialize IndexedDB cache: ${b}`))};f.destroy=function(){this._clearAddTasks();this._elevationTask=G.destroyMaybe(this._elevationTask);this.i3sOverrides=G.destroyMaybe(this.i3sOverrides);this._elevationProvider&&
(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const a=this._worker;a&&(a.destroyContext(this.uid).then(()=>a.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=G.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=
null;this._labeler=G.destroyMaybe(this._labeler);this._treeDebugger=G.destroyMaybe(this._treeDebugger);this._controller=G.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=G.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};f._memEstimateTextureAdded=
function(a){a=a.memoryEstimate;this._gpuMemoryEstimate+=a;this._texMemoryEstimate+=a;return a};f._memEstimateTextureRemoved=function(a){null!=a&&(a=a.memoryEstimate,this._gpuMemoryEstimate-=a,this._texMemoryEstimate-=a)};f._memEstimateGeometryAdded=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this._gpuMemoryEstimate+=a;this._geoMemoryEstimate+=a;return a};f._memEstimateGeometryRemoved=function(a){a=this._collection.getObjectGPUMemoryUsage(a);this._gpuMemoryEstimate-=a;this._geoMemoryEstimate-=
a};f.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};f.isNodeReloading=function(a){return this._nodeId2MetaReloading.has(a)};f._labelingChanged=function(){if(!tb.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==this._labeler){var a=new sb({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(b=>null!=b&&this._addMetaToLabeler(a,b));this._labeler=
a}};f._loadAsyncModule=function(a){++this._asyncModuleLoading;return a.then(b=>{--this._asyncModuleLoading;return b},b=>{--this._asyncModuleLoading;throw b;})};f._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=ha.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var a=this.uid,b=this.i3slayer.spatialReference;this._worker.setModifications(a,this._layerClippingArea,
this._modifications,b);var c=Ea.toWasmModification(this._layerClippingArea,this._modifications,b);ha.setModificationsSync({context:a,modifications:c,isGeodetic:b.isGeographic});this._controller.modificationsChanged();var d=this.hasModifications?new Za:null;this._nodeId2Meta.forEach((e,g)=>{null==e?(this._nodeId2Meta.delete(g),this._controller.updateLoadStatus(g,!1)):e.node.hasModifications?(this._nodeId2Meta.delete(g),this._nodeId2MetaReloading.set(g,e)):null!=d&&d.push(e.node)});null!=d&&this._nodeId2MetaReloading.forEach(e=>
d.push(e.node));null!=d&&0<d.length&&(this.updateNodeModificationStatus(d),d.forAll(e=>{if(e.imModificationImpact!==na.NodeIMModificationImpact.Culled){const g=this._nodeId2Meta.get(e.index);this._controller.invalidateGeometryVisibility(e.index);null!=g?(this._nodeId2Meta.delete(e.index),this._nodeId2MetaReloading.set(e.index,g)):this._nodeId2Meta.has(e.index)&&(this._nodeId2Meta.delete(e.index),this._controller.updateLoadStatus(e.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();
this._showModifications()}};f._showModifications=function(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(ca.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var a={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},b={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const c of this._modifications){const d=c.geometry;d.spatialReference=this.i3slayer.spatialReference;
this._modificationGraphics.push(new fa({geometry:d,symbol:{...b,color:a[c.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}};f._addMetaToLabeler=function(a,b){a.addNodeMeta(b,(c,d)=>this._createAttributes(c,d))};f._contentVisibleChanged=function(a){a?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&
this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))};f.getLoadedAttributes=function(a){a=this._nodeId2Meta.get(a);if(null!=a&&null!=a.attributeInfo)return a.attributeInfo.loadedAttributes};f.getAttributeData=function(a){a=this._nodeId2Meta.get(a);if(null!=a&&null!=a.attributeInfo)return a.attributeInfo.attributeData};f.setAttributeData=function(a,b){a=this._nodeId2Meta.get(a);null!=a&&null!=
a.attributeInfo&&(a.attributeInfo.attributeData=b,this._attributeValuesChanged(a))};f.updateAttributes=async function(a,b,c){const d=this._nodeId2Meta.get(a);null!=d&&(await this.i3sOverrides.applyAttributeOverrides(d.featureIds,b,c),d.attributeInfo=b,this._controller.reschedule(()=>this._attributeValuesChanged(d),c).catch(e=>{X.isAbortError(e)||L.warn("Error while updating attribute values. Layer might not display correctly.",e)}))};f._attributeValuesChanged=function(a){a.cachedRendererVersion=this._getInvalidRendererVersion();
a.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(a,(b,c)=>this._createAttributes(b,c));this._updateEngineObject(a)};f.clearMemCache=function(){null!=this._memCache&&this._memCache.clear()};f.getVisibleNodes=function(){const a=[];this._nodeId2Meta.forEach(b=>null!=b&&a.push(b.node));return a};f.getNodeComponentObb=function(a){a=this._nodeId2Meta.get(a.index)??this._nodeId2MetaReloading.get(a.index);return null!=a?this._collection.getComponentObb(a.objectHandle):null};f.getLoadedNodeIndices=
function(a){this._nodeId2Meta.forEach((b,c)=>a.push(c));this._nodeId2MetaReloading.forEach((b,c)=>a.push(c))};f._preLoadBasis=function(){!ma("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&O.TextureEncoding.Basis)&&G.applySome(this.i3slayer.textureSetDefinitions,a=>a.some(b=>b.formats.some(c=>"basis"===c.format||"ktx2"===c.format)))&&Ia.loadBasis()};f._getVertexBufferLayout=function(a,b){a={hasTexture:Ja(a.params.material),hasNormals:b.normal,hasRegions:b.uvRegion};return Db.glLayout(Eb.createVertexBufferLayout(this._getGeometryParameters(a)))};
f._getObjectIdField=function(){return this.i3slayer.objectIdField||lb.fallbackObjectIDAttribute};f._getGlobalIdField=function(){return this.i3slayer.associatedLayer?.globalIdField};f._findGraphicNodeAndIndex=function(a){const b=pa.attributeLookup(this.i3slayer.fieldsIndex,a.attributes,this._getObjectIdField());let c=null;wa.someMap(this._nodeId2Meta,d=>{if(null==d)return!1;const e=d.featureIds.indexOf(b);if(-1===e)return!1;c={node:d.node,index:e};return!0});return c};f._getGraphicIndices=function(a,
b){a=this._nodeId2Meta.get(a.index);if(null==a)return[];const c=[],d=this._getObjectIdField(),e=this.i3slayer.fieldsIndex;for(const g of b)b=pa.attributeLookup(e,g.attributes,d),b=a.featureIds.indexOf(b),-1!==b&&c.push(b);return c};f.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return Promise.reject();a=this._getAABB(a.node.index,a.index);return null==a?Promise.reject():Promise.resolve({boundingBox:a,screenSpaceObjects:[]})};f.getAABBFromIntersectorTarget=function(a){return null==
a.nodeIndex||null==a.componentIndex?null:this._getAABB(a.nodeIndex,a.componentIndex)};f._getAABB=function(a,b){a=this._nodeId2Meta.get(a);if(null==a||null==a.featureIds||b>=a.featureIds.length)return null;b=xb.boundingBoxCornerPoints(b,this._collection,a.objectHandle,Ba.newDoubleArray(24),0);if(!P.projectBuffer(b,this.view.renderSpatialReference,0,b,this.view.spatialReference,0,8))return null;a=Z.empty();Z.expandWithBuffer(a,b,0,8);return a};f.whenGraphicAttributes=function(a,b){return w.whenGraphicAttributes(this.i3slayer,
a,this._getObjectIdField(),b,()=>[...this._nodeId2Meta.values()].filter(va.isSome))};f.getGraphicFromIntersectorTarget=function(a){if(null==a.nodeIndex||null==a.componentIndex)return null;const b=this._nodeId2Meta.get(a.nodeIndex);return null==b||null==b.featureIds||a.componentIndex>=b.featureIds.length?null:this._createGraphic(a.componentIndex,b)};f._getCacheKey=function(a){return`${this._layerUrl}/v${23}/${a}${this._cacheKeySuffix}`};f._getMemCacheKey=function(a,b=this.elevationOffset){return a+
"#"+b};f.loadCachedGPUData=function(a){return null!=this._memCache?this._memCache.pop(this._getMemCacheKey(a)):null};f.deleteCachedGPUData=function(a){null!=a&&this._deleteComponentObject(a)};f._cacheGPUData=function(a,b=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(a);else{var c=this._controller.indexDepth-a.node.level;this._memCache.put(this._getMemCacheKey(a.node.index,b),a,a.node.memory,c)}};f.loadMissingTextures=function(a,b,c,d){const e=a?.filter((g,k)=>{if(0===(g.usage&
this.rendererTextureUsage))return!1;if(null==b)return!0;g=ba.selectEncoding(g.encodings,this.supportedTextureEncodings);k=b[k];return null==k||null==k.data||g&&k.encoding!==g.encoding?!0:!1})??[];return 0===e.length?Promise.resolve(!1):c(e,d).then(g=>{let k=0;for(let l=0;l<a.length;l++)k<g.length&&g[k].id===a[l].id&&(b[l]=g[k],k++);return!0})};f.loadCachedNodeData=function(a,b,c){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(a.id),b).then(d=>{if(null==d)return null;if(d.nodeVersion!==
a.version)return this._idbCache.remove(this._getCacheKey(a.id)),null;this.elevationInfo.mode===z.ElevationMode.Absolute&&(a.geometryObb=d.geometryObb);return this.loadMissingTextures(d.requiredTextures,d.textureData,c,b).then(e=>{e&&this._idbCache.initialized&&null!=d.textureData&&(d.byteSize=La(d.transformedGeometry,d.textureData),d.textureData.every(Ka)&&Ma(a,d)&&this._idbCache.put(this._getCacheKey(a.id),d).catch(g=>L.warn(`Failed to update node with textures in IndexedDB cache: ${a.id}: ${g}`)));
X.throwIfAborted(b);return d})}):Promise.resolve(null)};f.addNode=function(a,b,c){return"geometryData"in b?null==b.geometryBuffer?(this._addNodeMeta(a.index,null),Promise.resolve()):this._addData(a,b.attributeDataInfo,()=>this._transformNode(a,b,c).then(d=>this._safeReschedule(()=>{if(null==d)return a.hasModifications=!1,this._addCachedNodeData(a,null,c);a.hasModifications=d.transformedGeometry.hasModifications;const {obb:e,componentOffsets:g,featureIds:k,anchorIds:l,anchors:n,transformedGeometry:q}=
d;var r=oa.computeGlobalTransformation(a.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),A=ia.create([e.center.x,e.center.y,e.center.z],[e.extents.x,e.extents.y,e.extents.z],db.fromValues(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w));I.transformMat4(A.center,A.center,r);this.elevationInfo.mode===z.ElevationMode.Absolute&&(a.geometryObb=A);b.geometryData.componentOffsets=g;k&&(b.geometryData.featureIds=Array.from(k));b.geometryData.anchorIds=
l;b.geometryData.anchors=n;r={nodeVersion:a.version,geometryData:b.geometryData,requiredTextures:b.requiredTextures,textureData:b.textureData,transformedGeometry:q,globalTrafo:r,geometryObb:A,byteSize:La(q,b.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&Ma(a,r)&&(A=null!=r.textureData?r.textureData.map(K=>Ka(K)?K:null):null,this._idbCache.put(this._getCacheKey(a.id),{...r,textureData:A}).catch(K=>L.warn(`Failed to store node in IndexedDB cache: ${a.id}: ${K}`)));return this._addCachedNodeData(a,
r,c)},c))):Promise.reject()};f.getElevationRange=function(a){let b=Infinity,c=-Infinity;const d=gb.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference);this._nodeId2Meta.forEach(e=>{if(null!=e&&null!=e.node.geometryObb&&ia.intersectSphere(e.node.geometryObb,a)){var g=this._collection.getObjectTransform(e.objectHandle);g=this.view.renderCoordsHelper.getAltitude(g.position);for(let l=0;l<e.featureIds.length;l++){var k=this._collection.getComponentAabb(e.objectHandle,l,U);if("local"===
this.view.viewingMode)b=Math.min(b,g+k[2]),c=Math.max(c,g+k[5]);else{b=Math.min(b,g+k[2]);const n=Math.max(Math.abs(k[3]),Math.abs(k[0])),q=Math.max(Math.abs(k[4]),Math.abs(k[1]));k=g+k[5]+d.radius;c=Math.max(c,Math.sqrt(n*n+q*q+k*k)-d.radius)}}}});return{min:b,max:c}};f.computeVisibilityObb=function(a){return w.computeVisibilityObb(a,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};f._transformNode=function(a,b,c){var d=
b.geometryData.geometries??[];const e=Array(d.length);for(var g=0;g<d.length;++g)e[g]=this._getVertexBufferLayout(d[g],b.geometryDescriptor);d=a.mbs;g=this.elevationOffset;var k=this._controller.crsIndex,l=this._controller.crsVertex;const n=this.view.renderSpatialReference,q=oa.getLocalOrigin(d,g,k),r=oa.computeGlobalTransformation(d,g,k,n);k=P.getProjectorName(k,l);l=P.getProjectorName(l,n);return null==k||null==l?Promise.resolve(null):this._worker.invoke({context:this.uid,geometryBuffer:b.geometryBuffer,
geometryData:b.geometryData,geometryDescriptor:b.geometryDescriptor,layouts:e,localOrigin:q,globalTrafo:r,mbs:d,obb:a.serviceObb,elevationOffset:g,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:k,vertexToRenderProjector:l},c)};f._setNewNodeOpacity=function(a){this._setNodeOpacity(a,this.nodeCrossfadingEnabled?0:this.fullOpacity)};f.addCachedGPUData=function(a,b,c){this.elevationInfo.mode===
z.ElevationMode.Absolute&&(a.geometryObb=ia.clone(this._collection.getComponentObb(b.objectHandle)));this._controller.isGeometryVisible(a)?(null!=this._labeler&&this._addMetaToLabeler(this._labeler,b),a=a.index,this._addNodeMeta(a,b),this.updateNodeState(a,c),this._collection.setObjectVisibility(b.objectHandle,ra.State.Visible),this._updateMaterial(b),this._setNewNodeOpacity(b),this.elevationInfo.mode!==z.ElevationMode.Absolute&&this._ensureElevationTask().schedule(a),this._updateEngineObject(b),
this._highlights.objectCreated(b),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(b)};f.addCachedNodeData=function(a,b,c,d){return this._addData(a,c,()=>this._addCachedNodeData(a,b,d))};f.deleteCachedNodeData=async function(a){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(a))};f._addCachedNodeData=async function(a,b,c){if(this.contentVisible&&this._controller.isGeometryVisible(a))if(null==b)this._addNodeMeta(a.index,null);else{var d=this._addTasks.get(a.index),
{geometryData:e,transformedGeometry:g,globalTrafo:k}=b;await this.i3sOverrides.applyAttributeOverrides(e.featureIds,d.attributeInfo,c);var l=null!=b.textureData?b.textureData.filter(D=>null!=D&&0!==(D.usage&this.rendererTextureUsage)):[];!ma("disable-feature:i3s-basis")&&l.some(D=>null!=D&&(D.encoding===O.TextureEncoding.Basis||D.encoding===O.TextureEncoding.KTX2))&&await Ia.loadBasis();a.memory=0;var {componentOffsets:n,geometries:q,featureIds:r,anchorIds:A,anchors:K}=e,M=this._collection,m=q[0],
{layout:u,indices:y,interleavedVertexData:F,positionData:R,hasColors:Nb}=g,S=this._materialParameters(m,u),sa=n||new Uint32Array([0,y?y.length:F.byteLength/u[0].stride]);sa={vertices:{data:F,count:F.byteLength/u[0].stride,layoutParameters:S.geometryParams},positionData:{positions:hb.compactFloatArray(R.data),indices:ib.compactIndices(R.indices)},indices:y,componentOffsets:sa};var V=m.transformation?Aa.clone(m.transformation):Aa.create();za.multiply(V,k,V);m=za.getTranslation(Y.create(),V);V=bb.fromMat4(cb.create(),
V);var Ra=this.view.renderSpatialReference,Sa=this.view.basemapTerrain.spatialReference,ta=Y.create(),ua=[1,1,1];P.localLinearScaleFactors(m,Ra,ua,Sa)||L.errorOnce("Unsupported coordinate system for IM overlay");P.projectVectorToVector(m,Ra,ta,Sa);var la=M.createObject({toMapSpace:fb.fromValues(ta[0],ta[1],ua[0],ua[1]),geometry:sa,obb:b.geometryObb,transform:{position:m,rotationScale:V}}),{textures:Ta,texturePromise:Ob}=this._initMaterialAndTextures(la,S.material,l,S.geometryParams.textureCoordinates===
ja.TextureCoordinateAttributeType.Atlas);a.memory+=this._memEstimateGeometryAdded(la);a.memory+=Ta.reduce((D,N)=>D+(null!=N?this._memEstimateTextureAdded(N):0),0);l=!!S.material.hasParametersFromSource;S="blend"!==S.material.alphaMode&&1<=S.material.metallicRoughness.baseColorFactor[3];var E=new Jb(a,r,la,this._getInvalidRendererVersion(),d.attributeInfo,{hasParametersFromSource:l,isOpaque:S},Ta,A,K);d.meta=E;!this._hasTextures&&b.requiredTextures?.some(({usage:D})=>0!==(D&O.TextureUsage.ColorTextures))&&
(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Nb;this._hasTextures=this._hasTextures||!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Pb=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(E),Ob]).then(([D])=>{null!=D&&D.updateObjectVisibility(E.objectHandle,!1).catch(N=>Q(N,this.i3slayer.title));return this._safeReschedule(()=>{var N=this._addTasks.get(a.index);if(N)if(this._addNodeMeta(a.index,E),N.meta=null,this.contentVisible){M.setObjectVisibility(la,
ra.State.Visible);null!=D&&D.updateObjectVisibility(E.objectHandle,!0).catch(Qb=>Q(Qb,this.i3slayer.title));E.attributeInfo=N.attributeInfo;N=E.cachedRendererVersion!==this._rendererVersion;var Rb=Pb!==this.slicePlaneEnabled;this._updateElevationOffsets(E);var Sb=E.elevationOffsets;this._updateComponentData(E);var Tb=this._applyFiltersToNode(E);(N||null!=D&&(Rb||Tb||Sb))&&this._addOrUpdateEdgeRendering(E);null!=this._labeler&&this._addMetaToLabeler(this._labeler,E);this._visibleGeometryChanged(E,
J.ADD);this._highlights.objectCreated(E);this._updateMaterial(E);this._setNewNodeOpacity(E);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(a.index,this.elevationOffset)},c)}).catch(D=>{null!=d.meta&&(this._cacheGPUData(d.meta),d.meta=null);throw D;})}else this._removeNodeStageData(a.index,this.elevationOffset,this._nodeId2MetaReloading)};f._addNodeMeta=function(a,b){this._removeNodeStageData(a,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(a)){L.error("Removing duplicated node");
const c=this._nodeId2Meta.get(a);null!=c&&this._deleteComponentObject(c)}else this._controller.updateLoadStatus(a,!0);null!=b&&(b.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&da(b.cachedEdgeMaterials,0));this._nodeId2Meta.set(a,b)};f._updateElevationOffsets=function(a){const b=this.view.renderSpatialReference,c=this._controller.crsIndex,d=this.elevationInfo,e=this.view.basemapTerrain,g=e.spatialReference,k=d.mode;if(null==b||null==g||k===z.ElevationMode.Absolute)a.elevationOffsets=null;
else{var l=this._collection.getObjectTransform(a.objectHandle);a.elevationOffsets=a.elevationOffsets??[];var n=k===z.ElevationMode.OnTheGround,q=this.view.renderCoordsHelper,r=a.featureIds.length,A=(()=>{if(a.cachedElevationAnchors)return a.cachedElevationAnchors;const m=Ba.newDoubleArray(3*r);a.cachedElevationAnchors=m;for(let u=0;u<r;u++){const y=3*u,F=a.anchorIds?.indexOf(u)??-1;a.anchors&&0<=F?(I.set(C,a.anchors[3*F],a.anchors[3*F+1],a.anchors[3*F+2]),I.add(C,C,a.node.mbs),P.projectVectorToVector(C,
c,C,g),m[y]=C[0],m[y+1]=C[1],m[y+2]=q.getAltitude(C)):(this._collection.getComponentAabb(a.objectHandle,u,U,!0),I.set(C,(U[0]+U[3])/2,(U[1]+U[4])/2,U[2]),I.transformMat3(C,C,l.rotationScale),I.add(C,C,l.position),m[y+2]=q.getAltitude(C),P.projectVectorToVector(C,b,C,g),m[y]=C[0],m[y+1]=C[1])}return m})(),K=d.offset,M=a.elevationOffsets;e.getElevations(A,r,(m,u)=>{const y=n?A[3*m+2]:0;M[m]=K+(null!=u?u-y:0)})}};f._ensureElevationTask=function(){return null!=this._elevationTask?this._elevationTask:
this._elevationTask=new vb.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,a=>{a=this._controller.updateElevationChanged(a,this.view.basemapTerrain.spatialReference);return null!=a?a.filterInPlace(b=>null!=this._nodeId2Meta.get(b)):null},a=>{a=this._nodeId2Meta.get(a);this._nodeElevationAlignmentChanged(a)})};f._elevationInfoChanged=function(a,b){const c=a.mode!==z.ElevationMode.Absolute;a=!!b&&b!==a&&b.mode!==z.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(c,
this.view.state.viewingMode);c&&!a&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(d=>this._nodeElevationAlignmentChanged(d))};f._nodeElevationAlignmentChanged=function(a){null!=a&&(this._updateElevationOffsets(a),this._updateComponentData(a),this._updateEdgeRendering(a),null!=this._labeler&&this._labeler.updateLabelPositions(a),this._updateSnappingSources(a,J.UPDATE))};f._safeReschedule=function(a,b){X.throwIfAborted(b);return this._controller.reschedule(a,b)};f._materialParameters=
function(a,b){a=null!=a.params.material?a.params.material:ba.defaultMaterial();const c=b.some(e=>"uvRegion"===e.name);b=b.some(e=>"normalCompressed"===e.name);const d=Ja(a);return{geometryParams:this._getGeometryParameters({hasTexture:d,hasNormals:b,hasRegions:c}),material:a}};f._initMaterialAndTextures=function(a,b,c,d){const e=this._stage.renderView,g=c.map(l=>ba.createTexture(l,b,d,e));this._stage.addMany(g);let k=null;this._collection.updateMaterial(a,l=>{k=ba.configureMaterial(l,b,g,c,this.view._stage.renderView.textureRepository,
{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(l)});return{textures:g,texturePromise:k}};f._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?ja.TextureCoordinateAttributeType.Atlas:ja.TextureCoordinateAttributeType.Default:ja.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,
normals:a.hasNormals&&!this._isIntegratedMesh}};f._addData=function(a,b,c){let d=this._addTasks.get(a.index);d?d.attributeInfo=b:(d={...X.createResolver(),attributeInfo:b,meta:null},this._addTasks.set(a.index,d),c().then(d.resolve,d.reject).then(()=>this._addTasks.delete(a.index)).catch(e=>{this._addTasks.delete(a.index);throw e;}));return d.promise};f._clearAddTasks=function(){this._addTasks.forEach(a=>{null!=a.meta&&(this._cacheGPUData(a.meta),a.meta=null)});this._addTasks.clear()};f._clippingAreaChanged=
function(){var a=this.view.renderSpatialReference;const b=this.i3slayer.spatialReference,c=aa.create();this._renderClippingArea=Ha.toBoundingRect(this.view.clippingArea,c,a)?c:null;a=aa.create();this._layerClippingArea=Ha.toBoundingRect(this.view.clippingArea,a,b)?a:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};f._geometryFilterChange=function(){const a=this.hasGeometryFilter;this._controller.geometryFilterChanged(a);
this._applyFilters(a)};f._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};f._applyFilters=function(a){this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(b=>{null!=b&&this._applyFiltersToNode(b)&&(this._addOrUpdateEdgeRendering(b),this._visibleGeometryChanged(b,J.UPDATE))})};f.getFilters=function(){const a=[],b=this._renderClippingArea;null!=b&&a.push((c,d)=>this._boundingRectFilter(c,d,b));return a};f.addSqlFilter=function(a,
b,c){if(null!=b){const d=b.fieldNames;a.push((e,g)=>this._sqlFilter(e,g,b,d,c))}};f._sqlFilter=function(a,b,c,d,e){const g={},k=this._createLayerGraphic(g),l=this.i3slayer.objectIdField,n=b.featureIds,q=null!=b.attributeInfo&&b.attributeInfo.attributeData;d.every(r=>r===l||q&&null!=q[r])&&w.filterInPlace(a,n,r=>{g[l]=n[r];for(const A of d)A!==l&&(g[A]=q?w.getCachedAttributeValue(q[A],r):null);try{return c.testFeature(k)}catch(A){return e(A),!1}})};f._boundingRectNodeTest=function(a,b){P.projectBoundingSphere(a.node.mbs,
this._controller.crsIndex,Qa,this.view.renderSpatialReference);return w.intersectBoundingRectWithMbs(b,Qa)};f._boundingRectFeatureTest=function(a,b,c){this._collection.getComponentAabb(a.objectHandle,b,Oa);Z.toRect(Oa,Pa);return aa.intersects(c,Pa)};f._boundingRectFilter=function(a,b,c){var d=this._collection;const e=this._boundingRectNodeTest(b,c);if(e!==w.MbsIntersectResult.INSIDE)if(e===w.MbsIntersectResult.OUTSIDE)a.length=0;else if(d=d.getComponentCount(b.objectHandle),d.invisible+d.visible===
b.featureIds.length){var g=this._transformClippingArea(Kb,c,b.objectHandle);w.filterInPlace(a,b.featureIds,k=>this._boundingRectFeatureTest(b,k,g))}};f._transformClippingArea=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[0])/d[0];a[3]=(b[3]-c[1])/d[4];return a};f._addOrUpdateEdgeRendering=function(a,b=!0){const c=this._edgeView;if(null==c)return Promise.resolve(null);const d=a.objectHandle;var e=
c.hasObject(d);const {hasEdges:g,perFeatureEdgeMaterials:k}=this._getFilteredEdgeMaterials(a),l={hasSlicePlane:this.slicePlaneEnabled};if(g&&e)return this.nodeCrossfadingEnabled&&(e=this.getNodeOpacity(a),da(k,e)),c.updateAllComponentMaterials(d,k,l,b).catch(n=>Q(n,this.i3slayer.title)),c.updateObjectVisibility(d,!0).catch(n=>Q(n,this.i3slayer.title)),c.updateAllVerticalOffsets(d,a.elevationOffsets).catch(n=>Q(n,this.i3slayer.title)),Promise.resolve(c);if(g&&!e)return this._collection.addEdges(d,
c,k,l).then(n=>{a.edgeMemoryUsage=n;a.node.memory+=n;c.updateAllVerticalOffsets(d,a.elevationOffsets).catch(q=>Q(q,this.i3slayer.title));return c});!g&&e&&(a.node.memory-=a.edgeMemoryUsage,a.edgeMemoryUsage=0,c.removeObject(d));return Promise.resolve(null)};f._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(null!=this._labeler&&this._labeler.applyFilterChange(a),!0):!1};f._applyFiltersToNodeComponents=function(a){const b=this._collection;var c=0===b.getComponentCount(a.objectHandle).invisible;
b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;c=this._computeFilteredComponentIndices(a);b.setAllComponentVisibilities(a.objectHandle,c);return!0};f._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters};f._computeFilteredIds=function(a){const b=a.featureIds.slice();
for(const c of this._filters)if(c(b,a),0===b.length)break;return b.length===a.featureIds.length?a.featureIds:b};f._computeFilteredComponentIndices=function(a){const b=[],c=a.filteredIds;null!=c&&a.featureIds.forEach((d,e)=>{c[b.length]===d&&b.push(e)});return b};f._removeAllNodeDataFromStage=function(a=this.elevationOffset){this._nodeId2Meta.forEach((b,c)=>this._removeNodeStageData(c,a));this._nodeId2MetaReloading.forEach((b,c)=>this._removeNodeStageData(c,a,this._nodeId2MetaReloading));this._elevationTask=
G.destroyMaybe(this._elevationTask)};f.removeNode=function(a){const b=this.elevationOffset;this._removeNodeStageData(a,b);this._removeNodeStageData(a,b,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(a)};f._removeNodeStageData=function(a,b,c=this._nodeId2Meta){c.has(a)&&this._controller.updateLoadStatus(a,!1);const d=c.get(a);null==d?c.delete(a):(this._collection.setObjectVisibility(d.objectHandle,ra.State.Hidden),null!=this._edgeView&&this._edgeView.hasObject(d.objectHandle)&&
this._edgeView.updateObjectVisibility(d.objectHandle,!1).catch(e=>Q(e,this.i3slayer.title)),this._visibleGeometryChanged(d,J.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(d),c.delete(a),this._highlights.objectDeleted(d),c===this._nodeId2Meta?(this._cacheGPUData(d,b),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(d)):this._deleteComponentObject(d),null!=this._treeDebugger&&this._treeDebugger.update())};f._deleteComponentObject=function(a){null!=this._edgeView&&this._edgeView.removeObject(a.objectHandle);
this._memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures)for(const b of a.textures)this._memEstimateTextureRemoved(b),this._stage.remove(b)};f.updateNodeState=function(a,b){a=this._nodeId2Meta.get(a);null!=a&&this._collection.updateMaterial(a.objectHandle,c=>c.polygonOffsetEnabled=b===na.NodeState.Hole)};f.updateNodeIndex=function(a,b){if(this._nodeId2Meta.has(a)){var c=this._nodeId2Meta.get(a);this._nodeId2Meta.delete(a);this._nodeId2Meta.set(b,
c)}if(c=this._nodeId2MetaReloading.get(a))this._nodeId2MetaReloading.delete(a),this._nodeId2MetaReloading.set(b,c)};f._invalidateAllSymbols=function(){this._rendererVersion=w.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};f._getInvalidRendererVersion=function(){return w.addWraparound(this._rendererVersion,-1)};f._rendererChange=async function(a){this._currentRenderer=a;this.notifyChange("rendererTextureUsage");this._rendererVersion=w.addWraparound(this._rendererVersion,
1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();a&&(this._rendererFields=await a.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&a&&"arcadeRequired"in a&&a.arcadeRequired&&(this._arcade=await pb.loadArcade());if(a&&"visualVariables"in a&&a.visualVariables)for(const b of a.visualVariables)"color"===b.type?this._colorVariable=b:"opacity"===b.type?this._opacityVariable=b:L.warn(`Unsupported visual variable type for 3D Object Scene Services: ${b.type}`);
if(a)for(const b of a.getSymbols())"mesh-3d"!==b.type&&L.error(`Symbols of type '${b.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()};f._getCachedEdgeMaterials=function(a){this._hasComponentData&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedEdgeMaterials};f._getComponentParameters=function(a){this._hasComponentData&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);
const b=a.cachedSymbology;return(c,d)=>{const e=5*c;eb.set(d.externalColor,b[e]/255,b[e+1]/255,b[e+2]/255,b[e+3]/255);if(null!=this._stage.renderView.objectAndLayerIdRenderHelper){const g=a.featureIds[c],k=qb.isBasemapLayer(this.view.map,this.layerUid);this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(g,g,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&!k,a.node.resources.attributes,c,this.sublayerId);d.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:g,
layerUid:this.layerUid+"_"+this.sublayerId})}d.externalColorMixMode=b[e+4]&(1<<T.CastShadows)-1;d.castShadows=0!==(b[e+4]&1<<T.CastShadows);d.pickable=0!==(b[e+4]&1<<T.Pickable);d.elevationOffset=a.elevationOffsets?.[c]??0}};f._getSymbolInfo=function(a,b){b=a&&a.getSymbol(b,{arcade:this._arcade});if(!(b instanceof rb))return null;a=b.id;if(this._symbolInfos.has(a))return this._symbolInfos.get(a);b=w.getSymbolInfo(b);this._symbolInfos.set(a,b);return b};f._setSymbologyOverride=function(a,b){this._symbologyOverride!==
a&&(this._symbologyOverride=a,this._symbologyOverrideFields=b,this._invalidateAllSymbols(),this._updateSymbologyFields())};f._updateSymbologyFields=function(){this._symbologyFields=null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=this._rendererFields&&0<this._rendererFields.length?nb.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};f._updateCachedRendererData=function(a){a.cachedRendererVersion=
this._rendererVersion;if(this._hasComponentData){var b=this._tmpAttributeOnlyGraphic,c={};b.attributes=c;var d=this._currentRenderer,e=a.attributeInfo?.attributeData,g=null!=a.featureIds?this.i3slayer.objectIdField:null,k=null!=e&&null!=this._symbologyFields&&0<this._symbologyFields.length,l=null,n=null;if(k&&null!=this._symbologyFields){l=[];n=[];for(var q of this._symbologyFields){var r=e[q];r&&(l.push(q),n.push(r))}}a.cachedSymbology||(a.cachedSymbology=kb.newUByteArray(5*a.featureIds.length));
e={color:ea,castShadows:!0,pickable:!0,colorMixMode:qa.ColorMixModeEnum.Multiply,edgeMaterial:null};q=this.fullOpacity;q=this.nodeCrossfadingEnabled?this.getNodeOpacity(a):q;r=null;var A=ka.Transparency.OPAQUE,K=w.transparentEdgeMaterial,M=0;for(let F=0;F<a.featureIds.length;F++){null!=g&&(c[g]=a.featureIds[F]);if(k&&l)for(var m=0;m<l.length;m++)c[l[m]]=w.getCachedAttributeValue(n[m],F);var u=d?this._getSymbolInfo(d,b):null;let R=m=null;if(d&&"visualVariables"in d){if(this._colorVariable){var y=Ca.getColor(this._colorVariable,
b,{color:Lb,arcade:this._arcade});y&&(m=ea,m[0]=y.r/255,m[1]=y.g/255,m[2]=y.b/255,this._opacityVariable||null===y.a||(R=y.a))}this._opacityVariable&&(R=Ca.getOpacity(this._opacityVariable,b,{arcade:this._arcade}))}u&&u.material&&(y=u.material,m=null==m||null==R?Fa.overrideColor(m,R,y.color,y.alpha,Na,ea):Fa.overrideColor(m,R,null,null,Na,ea));null==m&&(m=ea,m[0]=1,m[1]=1,m[2]=1,m[3]=1);e.pickable=!0;e.castShadows=u?u.castShadows:!0;e.colorMixMode=u&&u.material?u.material.colorMixMode:qa.ColorMixModeEnum.Multiply;
e.edgeMaterial=u?u.edgeMaterial:null;null!=this._symbologyOverride&&(e.color=m,this._symbologyOverride(b,e),m=e.color);if(null!=e.edgeMaterial){u=0>=m[3]?ka.Transparency.INVISIBLE:1<=m[3]&&(a.material.isOpaque||e.colorMixMode===qa.ColorMixModeEnum.Replace)?ka.Transparency.OPAQUE:ka.Transparency.TRANSPARENT;if(e.edgeMaterial!==r||u!==A)K={...e.edgeMaterial,opacity:q,objectTransparency:u},r=e.edgeMaterial,A=u;a.cachedEdgeMaterials[F]=K}else a.cachedEdgeMaterials[F]=w.transparentEdgeMaterial;a.cachedSymbology[M++]=
Math.round(255*m[0]);a.cachedSymbology[M++]=Math.round(255*m[1]);a.cachedSymbology[M++]=Math.round(255*m[2]);a.cachedSymbology[M++]=Math.round(255*m[3]);a.cachedSymbology[M++]=e.colorMixMode|+e.castShadows<<T.CastShadows|+e.pickable<<T.Pickable}}};f._getFilteredEdgeMaterials=function(a){var b=this._getCachedEdgeMaterials(a);this.nodeCrossfadingEnabled||da(b,this.fullOpacity);const c=a.filteredIds;if(null==c)return{hasEdges:b.some(g=>g!==w.transparentEdgeMaterial),perFeatureEdgeMaterials:b};let d=
0,e=!1;b=b.map((g,k)=>{if(a.featureIds[k]!==c[d])return w.transparentEdgeMaterial;e=e||g!==w.transparentEdgeMaterial;d++;return g});return{hasEdges:e,perFeatureEdgeMaterials:b}};f._updateComponentData=function(a){if(this._hasComponentData){var b=a.objectHandle;a=this._getComponentParameters(a);this._collection.setComponentData(b,a);this._stage.renderView.requestRender()}};f._reloadAll=function(a=this.elevationOffset){this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};
f._opacityChange=function(a){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(b=>{null!=b&&(this._collection.updateMaterial(b.objectHandle,c=>c.objectOpacity=a),da(b.cachedEdgeMaterials,a),this._updateEdgeRendering(b))})};f._updateMaterial=function(a){this._collection.updateMaterial(a.objectHandle,b=>{b.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;b.usePBR=this._usePBR;this._updateMaterialOverlay(b)})};f._updateMaterialOverlay=function(a){};
f._updateEngineObject=function(a){this._updateComponentData(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);this._visibleGeometryChanged(a,J.UPDATE)};f._slicePlaneEnabledChange=function(a){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=a);null!=this._labeler&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(b=>{null!=b&&(this._collection.updateMaterial(b.objectHandle,c=>c.commonMaterialParameters.hasSlicePlane=a),this._updateEdgeRendering(b,!1))})};
f._updatePBR=function(a){this._nodeId2Meta.forEach(b=>{null!=b&&this._collection.updateMaterial(b.objectHandle,c=>c.usePBR=a)});this._hasLoadedPBRTextures=!0};f._updateEdgeRendering=function(a,b=!0){null!=this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._addOrUpdateEdgeRendering(a,b)};f._forAllNodes=function(a){this._nodeId2Meta.forEach(a)};f._ignoreClientNodeOverriddenFeatures=function(a){return this.i3sOverrides.hasGeometryChanges?a:(b,c,d)=>0<=d.node.index&&this.i3sOverrides.featureHasGeometryChanges(b)?
B.ForAllFeaturesReturnType.CONTINUE:a(b,c,d)};f._forAllFeatures=function(a,b,c){wa.someMap(this._nodeId2Meta,d=>{if(null==d)return!1;if(null!=b)switch(b(d)){case B.ForAllFeaturesReturnType.EXIT:return!0;case B.ForAllFeaturesReturnType.SKIP:return!1}let e=B.ForAllFeaturesReturnType.CONTINUE;switch(c){case B.ForAllFeaturesMode.ALL:e=this._forAllFeaturesOfNode(d,a);break;case B.ForAllFeaturesMode.VISIBLE_ONLY:e=this._forAllVisibleFeaturesOfNode(d,a);break;case B.ForAllFeaturesMode.QUERYABLE:e=this._forAllQueryableFeaturesOfNode(d,
a)}return e===B.ForAllFeaturesReturnType.EXIT})};f._forAllFeaturesOfNode=function(a,b){let c=B.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds;for(let e=0;e<d.length&&(c=b(d[e],e,a),c!==B.ForAllFeaturesReturnType.EXIT);e++);return c};f._forAllVisibleFeaturesOfNode=function(a,b){let c=B.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,e=>{c=b(d[e],e,a);return c===B.ForAllFeaturesReturnType.CONTINUE});return c};f._forAllQueryableFeaturesOfNode=
function(a,b){b=this._ignoreClientNodeOverriddenFeatures(b);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(a,b);var c=this._boundingRectNodeTest(a,this._renderClippingArea);if(c===w.MbsIntersectResult.OUTSIDE)return B.ForAllFeaturesReturnType.CONTINUE;if(c===w.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(a,b);c=B.ForAllFeaturesReturnType.CONTINUE;const d=a.featureIds,e=w.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(a.objectHandle));for(let g=
0;g<d.length;g++){if(!this._boundingRectFeatureTest(a,g,e))continue;const k=b(d[g],g,a);if(k===B.ForAllFeaturesReturnType.EXIT)return k}return c};f._createAttributes=function(a,b){const c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo?.attributeData;if(null!=b)for(const d of Object.keys(b))c[d]=w.getCachedAttributeValue(b[d],a);return c};f._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};f.highlight=function(a){const b=
this._highlights;"number"===typeof a?a=[a]:a instanceof fa?a=[a]:a instanceof Xa&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof fa){const c=this.i3slayer.fieldsIndex,d=this._getObjectIdField();a=a.map(k=>pa.attributeLookup(c,k.attributes,d));const {set:e,handle:g}=b.acquireSet();b.setFeatureIds(e,a);return g}if("number"===typeof a[0]){const {set:c,handle:d}=b.acquireSet();b.setFeatureIds(c,a);return d}}return Mb};f.resetHighlights=function(){G.destroyMaybe(this._highlights);this._highlights=
new ub({collection:this._collection,forAllFeatures:a=>this._forAllFeatures(a,null,B.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(a,b)=>this._forAllFeaturesOfNode(a,b)})};f._visibleGeometryChanged=function(a,b){this._elevationProvider&&(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=$a.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(a,
b))};f.getNodeOpacityByIndex=function(a){a=this._nodeId2Meta.get(a);return this.getNodeOpacity(a)};f.getNodeOpacity=function(a){return null!=a?this._collection.getMaterial(a.objectHandle).objectOpacity:0};f.isNodeFullyFadedIn=function(a){return this._crossfadeHelper.isNodeFullyFadedIn(a)};f.getNodeCrossfadeMetaData=function(a){return this._nodeId2Meta.get(a)};f.markNodeToRemove=function(a){this._controller&&this._controller.markNodeToRemove(a)};f.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};
f.foreachCrossfadeNode=function(a){this._nodeId2Meta.forEach((b,c)=>a(c,b))};f.fadeNode=function(a,b,c){if(this.nodeCrossfadingEnabled){var d=this._nodeId2Meta.get(a);null!=d&&this._crossfadeHelper.fadeNode(a,d,b,c)}};f.setNodeOpacityByIndex=function(a,b){a=this._nodeId2Meta.get(a);null!=a&&this._setNodeOpacity(a,b)};f._setNodeOpacity=function(a,b){this._collection.updateMaterial(a.objectHandle,c=>c.objectOpacity=b);this._setNodeEdgeOpacity(a,b)};f._setNodeEdgeOpacity=function(a,b){null!=this._edgeView&&
a.cachedEdgeMaterials&&(da(a.cachedEdgeMaterials,b),a=a.objectHandle,this._edgeView.hasObject(a)&&this._edgeView.updateAllComponentOpacities(a,b).catch(c=>Q(c,this.i3slayer.title)))};f.updateNodeModificationStatus=function(a){var b=a.length;if(this.hasModifications&&!(0>=b)&&!0===this._i3sWasmLoaded){b=this.uid;var c=Gb(a);if(null!=c){ha.filterObbsForModificationsSync({context:b,buffer:c.buffer});const d=new Float64Array(c.buffer);a.forAll((e,g)=>{g=ha.interpretObbModificationResults(d[g]);e.imModificationImpact=
g;g!==na.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(e.index)})}}};f.notifyUpdate=function(){this.notifyChange("updating")};f.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};f.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||
null!=this._elevationTask&&this._elevationTask.running};f.trackSnappingSources=function(a){const b={events:a,fetchEdgeLocations:async(c,d,e)=>{c=this._nodeId2Meta.get(c);if(null==c)throw Error("invalid-node");const {origin:g,buffer:k}=await this._collection.extractEdgeInformation(c.objectHandle,d,e);this._snappingLocationsApplyElevation(c,k,g);return{type:"components",objectIds:c.featureIds,locations:k,origin:g}},remove:()=>{va.removeUnordered(this._snappingSourcesTrackers,b)}};this._snappingSourcesTrackers.push(b);
this._nodeId2Meta.forEach((c,d)=>{null!=c&&(c=this._controller.getRenderMbs(c.node),null!=c&&a.add(d,c))});return b};f._snappingLocationsApplyElevation=function(a,b,c){if(a.elevationOffsets&&this.elevationInfo.mode!==z.ElevationMode.Absolute){var d=b.position0,e=b.position1;b=b.componentIndex;var g=Y.create(),k=Y.create(),l=(n,q)=>{I.add(n,n,c);this.view.renderCoordsHelper.worldUpAtPosition(n,k);I.add(n,n,I.scale(k,k,q));I.subtract(n,n,c)};for(let n=0;n<d.count;n++){const q=a.elevationOffsets[b.get(n)];
d.getVec(n,g);l(g,q);d.setVec(n,g);e.getVec(n,g);l(g,q);e.setVec(n,g)}}};f._updateSnappingSources=function(a,b){const {index:c}=a.node;a=this._controller.getRenderMbs(a.node);if(null!=a)for(const d of this._snappingSourcesTrackers)b!==J.REMOVE&&b!==J.UPDATE||d.events.remove(c),b!==J.ADD&&b!==J.UPDATE||d.events.add(c,a)};W._createClass(t,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},
{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},{key:"contentVisible",get:function(){return!this.suspended&&this._controller?.rootNodeVisible}},{key:"legendEnabled",get:function(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??
0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return w.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?O.TextureUsage.AllTexturesPBR:O.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?O.TextureUsage.GeometryTexturesPBR:O.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const a=null!=this.i3slayer?
this.i3slayer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){const b=ya.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),c=Da.getMetersPerUnit(a.unit);return(a.offset??0)*c/b}return 0}},{key:"elevationInfo",get:function(){const a=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==a)return{mode:z.ElevationMode.Absolute,offset:0};var b=ya.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const c=Da.getMetersPerUnit(a.unit);b=(a.offset??0)*c/b;switch(a.mode){case "absolute-height":return{mode:z.ElevationMode.Absolute,
offset:b};case "relative-to-ground":return{mode:z.ElevationMode.RelativeToGround,offset:b};case "on-the-ground":return{mode:z.ElevationMode.OnTheGround,offset:0};default:return{mode:z.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return ba.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){const a=0===(this.supportedTextureEncodings&O.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&
a}},{key:"clientGeometry",get:function(){return this.i3sOverrides.geometryOverrides}},{key:"usedMemory",get:function(){let a=null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(b=>a+=null!=b?b.node.memory:0);this._nodeId2MetaReloading.forEach(b=>a+=null!=b?b.node.memory:0);return a}},{key:"unloadedMemory",get:function(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}},{key:"_idbCacheEnabled",
get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderer.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&0<
this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"_usePBR",get:function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"performanceInfo",get:function(){const a={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/
1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.unloadedMemory/1048576).toFixed(1)+"MB"};null!=this._memCache&&(a.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a}},{key:"test",get:function(){const a=this;return{controller:this._controller,labeler:this._labeler,
get visibleObjectIds(){const b=[];a._forAllFeatures(c=>{b.push(c);return B.ForAllFeaturesReturnType.CONTINUE},null,B.ForAllFeaturesMode.VISIBLE_ONLY);b.sort((c,d)=>c-d);return b},get numNodes(){return a._nodeId2Meta.size},get loadedNodes(){return Array.from(a._nodeId2Meta.keys()).sort((b,c)=>b-c)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&null!=this._layerClippingArea||this._modifications&&0<this._modifications.length}}]);return t}(h);v.__decorate([x.property()],h.prototype,
"_hasLoadedPBRTextures",void 0);v.__decorate([x.property()],h.prototype,"_asyncModuleLoading",void 0);v.__decorate([x.property()],h.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);v.__decorate([x.property()],h.prototype,"view",void 0);v.__decorate([x.property()],h.prototype,"i3slayer",void 0);v.__decorate([x.property()],h.prototype,"_controller",void 0);v.__decorate([x.property()],h.prototype,"_labeler",void 0);v.__decorate([x.property()],h.prototype,"updating",void 0);v.__decorate([x.property()],
h.prototype,"suspended",void 0);v.__decorate([x.property()],h.prototype,"contentVisible",null);v.__decorate([x.property({readOnly:!0})],h.prototype,"legendEnabled",null);v.__decorate([x.property()],h.prototype,"holeFilling",void 0);v.__decorate([x.property(Cb.updatingProgress)],h.prototype,"updatingProgress",void 0);v.__decorate([x.property()],h.prototype,"updatingProgressValue",null);v.__decorate([x.property()],h.prototype,"hasTexturesOrVertexColors",null);v.__decorate([x.property()],h.prototype,
"rendererTextureUsage",null);v.__decorate([x.property()],h.prototype,"elevationOffset",null);v.__decorate([x.property()],h.prototype,"elevationInfo",null);v.__decorate([x.property({type:Boolean})],h.prototype,"slicePlaneEnabled",void 0);v.__decorate([x.property()],h.prototype,"supportedTextureEncodings",null);v.__decorate([x.property()],h.prototype,"uncompressedTextureDownsamplingEnabled",null);v.__decorate([x.property({type:[ob]})],h.prototype,"_modifications",void 0);v.__decorate([x.property({readOnly:!0})],
h.prototype,"clientGeometry",null);v.__decorate([x.property()],h.prototype,"_elevationTask",void 0);v.__decorate([x.property({readOnly:!0})],h.prototype,"_usePBR",null);return h=v.__decorate([ab.subclass("esri.views.3d.layers.I3SMeshView3D")],h)};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});