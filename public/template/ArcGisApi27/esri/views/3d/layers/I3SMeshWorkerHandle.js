// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),function(q,v,y,z,A,r,w,k){function x(d,f,h){a.clear();var b=Infinity;let c=Infinity,m=-Infinity,l=-Infinity,t=!1;for(const u of f){var e="clip"===u.type?k.ModificationType.Inside:"mask"===u.type?k.ModificationType.Outside:k.ModificationType.Replace;const n=z.unwrapOrThrow(u.geometry,
"modification.geometry");f=g=>g;if(n.spatialReference){if(!w.canProjectWithoutEngine(n.spatialReference,h)){y.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}f=g=>{w.projectVectorToVector(g,n.spatialReference,p,h);return p}}else n.hasZ||(p[2]=0,f=g=>{p[0]=g[0];p[1]=g[1];return p});t=t||e===k.ModificationType.Outside;a.push(e);a.push(n.rings.length);for(const g of n.rings){a.push(g.length);
for(const B of g)e=f(B),a.push(e[0]),a.push(e[1]),a.push(e[2]),b=Math.min(b,e[0]),c=Math.min(c,e[1]),m=Math.max(m,e[0]),l=Math.max(l,e[1])}}null!=d&&(t?(a.push(k.ModificationType.Inside),a.push(2),a.push(4),a.push(b-1E-4),a.push(c-1E-4),a.push(0),a.push(m+1E-4),a.push(c-1E-4),a.push(0),a.push(m+1E-4),a.push(l+1E-4),a.push(0),a.push(b-1E-4),a.push(l+1E-4),a.push(0)):(a.push(k.ModificationType.Outside),a.push(1)),a.push(4),a.push(d[0]),a.push(d[1]),a.push(0),a.push(d[2]),a.push(d[1]),a.push(0),a.push(d[2]),
a.push(d[3]),a.push(0),a.push(d[0]),a.push(d[3]),a.push(0));a.push(k.ModificationType.Finished);d=new Float64Array(a.length);for(b=0;b<a.length;++b)d[b]=a.at(b);return d}r=function(d){function f(b){return d.call(this,"SceneLayerWorker","process",{process:c=>[c.geometryBuffer],project:c=>[c.positions.buffer],transformNormals:c=>[c.normals.buffer]},b,{hasInitialize:!0})||this}v._inherits(f,d);var h=f.prototype;h.setModifications=function(b,c,m,l){b={context:b,modifications:x(c,m,l),isGeodetic:l.isGeographic};
this.broadcast(b,"setModifications")};h.setLegacySchema=function(b,c){c=JSON.stringify(c);this.broadcast({context:b,jsonSchema:c},"setLegacySchema")};h.destroyContext=function(b){return this.broadcast(b,"destroyContext")};h.project=function(b,c){return this.invokeMethod("project",b,c)};h.transformNormals=function(b,c){return this.invokeMethod("transformNormals",b,c)};return v._createClass(f)}(r.WorkerHandle);const a=new A({deallocator:null}),p=[0,0,0];q.I3SMeshWorkerHandle=r;q.toWasmModification=
x;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});