// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/layerUtils ./LayerView3D ./TiledLayerView3D ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(k,g,q,n,r,l,d,z,A,t,u,
v,w,x,y){d=function(p){function h(){var b=p.apply(this,arguments)||this;b.type="wmts-3d";return b}k._inherits(h,p);var e=h.prototype;e.initialize=function(){this._getCompatibleTileInfoMatrixSet(a=>this._getTileInfoSupportError(a.tileInfo,a.fullExtent));const b=r.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const a=this._getCompatibleTileInfoMatrixSet(c=>this._getTileInfoError(c.tileInfo,c.fullExtent));null!=a&&(null!==a.id&&this.layer.activeLayer.tileMatrixSetId!==a.id&&(this.layer.activeLayer.tileMatrixSetId=
a.id),a.tileInfo&&(this.tileInfo=a.tileInfo),this.layer.fullExtent=a.fullExtent)});this.addResolvingPromise(b);this.when(()=>this._postInitialize())};e.refresh=function(){this.emit("data-changed")};e.canResume=function(){if(!k._get(k._getPrototypeOf(h.prototype),"canResume",this).call(this))return!1;const b=this.layer.activeLayer.tileMatrixSet;return null!=b&&!this._getTileInfoError(b.tileInfo,b.fullExtent)};e.doRefresh=async function(){this.suspended||this.emit("data-changed")};e._postInitialize=
function(){this.updatingHandles.add(()=>this.layer?.activeLayer?.styleId,()=>this.refresh());this.updatingHandles.add(()=>this.layer?.activeLayer,b=>{const a=this._getCompatibleTileInfoMatrixSet(c=>this._getTileInfoError(c.tileInfo,c.fullExtent),!0);null!=a&&null!==a.id&&b.tileMatrixSetId!==a.id&&(this.layer.activeLayer.tileMatrixSetId=a.id);this.notifyChange("suspended");this.canResume()&&this.refresh()})};e._getCompatibleTileInfoMatrixSet=function(b,a=!1){const c=u.getTileMaxtrixSetFromActiveLayer(this.layer);
if(null!=c){if(q.isCollection(c))return c.find(f=>{f=b(f);null!=f&&(a?n.getLogger(this).error("The selected tile matrix set is not compatible with the view",f):this.addResolvingPromise(Promise.reject(f)));return null==f});const m=b(c);null!=m&&(a?n.getLogger(this).error("The selected tile matrix set is not compatible with the view",m):this.addResolvingPromise(Promise.reject(m)));return c}return null};e._getTileInfoError=function(b,a){return this._getTileInfoSupportError(b,a)||this._getTileInfoCompatibilityError(b,
this.view.basemapTerrain.tilingScheme)};k._createClass(h,[{key:"hasMixedImageFormats",get:function(){return!0}}]);return h}(y(w.TiledLayerView3D(v.LayerView3D(x))));g.__decorate([l.property({readOnly:!0})],d.prototype,"hasMixedImageFormats",null);g.__decorate([l.property()],d.prototype,"layer",void 0);g.__decorate([l.property()],d.prototype,"suspended",void 0);g.__decorate([l.property()],d.prototype,"tileInfo",void 0);return d=g.__decorate([t.subclass("esri.views.3d.layers.WMTSLayerView3d")],d)});