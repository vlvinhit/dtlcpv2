// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(n,p,d,l,t,e,x,y,z,u,q,v){n.TiledLayerView3D=c=>{c=function(r){function m(){return r.apply(this,arguments)||this}
p._inherits(m,r);var h=m.prototype;h.getTileUrl=function(a,b,f){return this.layer.getTileUrl(a,b,f)};h._addTilingSchemeMatchPromise=function(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new l("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var a=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(null!=a)return this.addResolvingPromise(Promise.reject(a));a=t.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>
{const b=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(b)throw b;});this.addResolvingPromise(a)};h._getTileInfoSupportError=function(a,b){if(a=v.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.state.viewingMode)){b={layer:this.layer,error:a};switch(a.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":a=new l("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",b);break;default:a=new l("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return a}return null};h._getTileInfoCompatibilityError=function(a,b){return null!=a&&b.compatibleWith(a)?null:new l("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.levelRangeFromScaleRange=function(a,b){const f=
{minLevel:0,maxLevel:Infinity};var g=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!g)return f;const w=g.levels[0];g=k=>{k=Math.log(w.scale/k)/Math.LN2;return 1E-9>.5-Math.abs(.5-k%1)?Math.round(k):Math.ceil(k)};null!=a&&0<a&&(f.minLevel=Math.max(0,g(a)));null!=b&&0<b&&(f.maxLevel=Math.max(0,g(b)));return f};h.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};p._createClass(m,[{key:"imageFormatIsOpaque",get:function(){return!1}},
{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataScaleRange",get:function(){var a=this.tileInfo.lods;let b=a[0].scale;a=a[a.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:f,effectiveMaxLOD:g}=this.layer.tilemapCache;b=this.tileInfo.lodAt(f).scale;a=this.tileInfo.lodAt(g).scale}return{minScale:b,maxScale:a}}},{key:"dataLevelRange",get:function(){const {minScale:a,
maxScale:b}=this.dataScaleRange;return this.levelRangeFromScaleRange(a,b)}},{key:"displayLevelRange",get:function(){const a=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&a.maxLevel++;return a}}]);return m}(c);d.__decorate([e.property({readOnly:!0})],c.prototype,"imageFormatIsOpaque",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"updating",void 0);d.__decorate([e.property(q.updatingProgress)],
c.prototype,"updatingProgress",void 0);d.__decorate([e.property(q.updatingProgressValue)],c.prototype,"updatingProgressValue",void 0);d.__decorate([e.property()],c.prototype,"fullExtent",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"isOpaque",null);d.__decorate([e.property()],c.prototype,"dataScaleRange",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"dataLevelRange",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"displayLevelRange",null);d.__decorate([e.property()],
c.prototype,"layer",void 0);d.__decorate([e.property()],c.prototype,"tileInfo",void 0);return c=d.__decorate([u.subclass("esri.views.3d.layers.TiledLayerView3D")],c)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});