// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AnalysisView3D ./Dimension/DimensionController ./Dimension/DimensionTool ./Dimension/DimensionVisualization ./Dimension/LengthDimensionComputation ./support/projectionUtils ../../analysis/analysisViewUtils ../../analysis/DimensionAnalysisView".split(" "),
function(n,c,b,u,v,k,p,d,E,F,G,w,x,y,z,A,B,q,m,C){b=function(r){function l(a){a=r.call(this,a)||this;a.type="dimension-view-3d";a.tool=null;a.computations=new u;a.selectedDimension=null;a._dimensionsToComputations=new Map;a._placementTask=null;a._projectAndAlignPoint=null;return a}n._inherits(l,r);var g=l.prototype;g.initialize=function(){this._projectAndAlignPoint=a=>{if(null==a)return null;const {spatialReference:e,elevationProvider:h}=this.view,f=q.applyProjectionAndElevationAlignment(a,e,h);null==
f&&q.logFailedGeometryProjectionError(this.analysis,a.spatialReference,v.getLogger(this));return f};this.addHandles([m.connectAnalysisViewToTool(this,z.DimensionTool),p.on(()=>this.analysis.dimensions,"after-add",a=>this._onDimensionAdd(a.item),{onListenerAdd:a=>{for(const e of a)this._onDimensionAdd(e)},onListenerRemove:()=>{this._onDimensionsClear()}}),p.on(()=>this.analysis.dimensions,"after-remove",a=>this._onDimensionRemove(a.item))]);this._analysisVisualization=new A.DimensionVisualization({analysisViewData:this,
view:this.view});this._analysisController=new y.DimensionController({analysisViewData:this,view:this.view})};g.destroy=function(){this._placementTask=k.abortMaybe(this._placementTask);this._analysisVisualization=k.destroyMaybe(this._analysisVisualization);m.removeAnalysisViewTool(this)};g.createLengthDimensions=async function(a){this.selectedDimension=null;this._placementTask=k.abortMaybe(this._placementTask);this._placementTask=m.activateAnalysisViewTool(this,a);return this._placementTask.promise};
g._onDimensionAdd=function(a){const {computations:e,_dimensionsToComputations:h}=this;if(!h.has(a)){var f=new B.LengthDimensionComputation({dimension:a,projectAndAlignPoint:this._projectAndAlignPoint});e.add(f);h.set(a,f)}};g._onDimensionRemove=function(a){const {computations:e,_dimensionsToComputations:h}=this,f=e.findIndex(D=>D.dimension===a),t=e.at(f);t.dimension===this.selectedDimension&&(this.selectedDimension=null);e.removeAt(f);h.delete(a);k.destroyMaybe(t)};g._onDimensionsClear=function(){this.computations.drain(a=>
a.destroy());this._dimensionsToComputations.clear()};n._createClass(l,[{key:"updating",get:function(){return this._analysisVisualization?.loadingMessages??!1}},{key:"results",get:function(){return this.analysis.dimensions.map(a=>this._dimensionsToComputations.get(a).result)}},{key:"selectedComputation",get:function(){const {selectedDimension:a}=this;return null==a?null:this._dimensionsToComputations.get(a)}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}}]);
return l}(C(x.AnalysisView3D(b)));c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property()],b.prototype,"tool",void 0);c.__decorate([d.property()],b.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"results",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"computations",void 0);c.__decorate([d.property()],b.prototype,"selectedDimension",void 0);c.__decorate([d.property()],b.prototype,"selectedComputation",null);c.__decorate([d.property()],
b.prototype,"_analysisVisualization",void 0);c.__decorate([d.property()],b.prototype,"_analysisController",void 0);c.__decorate([d.property()],b.prototype,"_dimensionsToComputations",void 0);c.__decorate([d.property()],b.prototype,"_placementTask",void 0);return b=c.__decorate([w.subclass("esri.views.3d.analysis.DimensionAnalysisView3D")],b)});