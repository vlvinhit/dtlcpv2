// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/support/WatchUpdatingTracking ./LineOfSightVisualElement ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/PointVisualElement ../../webgl-engine/lib/Material".split(" "),
function(e,F,k,f,J,K,L,x,M,m,Y,Z,aa,N,O,y,g,P,Q,z,G,A){e.LineOfSightVisualization=function(H){function u(a){a=H.call(this,a)||this;a._lineOfSightVisualElements=[];a._computationHandles=new K;a._updatingHandles=new P.WatchUpdatingTracking;return a}F._inherits(u,H);var h=u.prototype;h.initialize=function(){this.addHandles(this._connectComputations());this._createObserverVisualization()};h.destroy=function(){this._updatingHandles=x.destroyMaybe(this._updatingHandles);this._computationHandles=x.destroyMaybe(this._computationHandles);
this._observerVisualElement=x.destroyMaybe(this._observerVisualElement)};h._createLineOfSightVisualization=function(){var a=this._configuration,b=this.view,c={view:b,attached:!0,width:a.outerWidth,innerWidth:a.innerWidth},d=f.toUnitRGBA(a.visibleOuterColor);const r=f.toUnitRGBA(a.visibleInnerColor);var t=f.toUnitRGBA(a.occludedOuterColor);const B=f.toUnitRGBA(a.occludedInnerColor),C=f.toUnitRGBA(a.undefinedOuterColor);a=f.toUnitRGBA(a.undefinedInnerColor);d=new z.LineVisualElement({...c,color:d,innerColor:r});
t=new z.LineVisualElement({...c,color:t,innerColor:B});c=new z.LineVisualElement({...c,color:C,innerColor:a});b=new G.PointVisualElement({view:b,attached:!0,...I,size:8});b=new Q.LineOfSightVisualElement(d,t,c,b);this._lineOfSightVisualElements.push(b);return b};h._destroyLineOfSightVisualization=function(a){a.destroy();this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(a),1)};h._updateLineOfSightVisualization=function(a,b,c){const d=this._configuration,{computationResult:r,
inputPoints:t}=a,{start:B,end:C,intersection:R,isValid:S,isTargetVisible:T}=r;var {observer:l}=t;const p=U;p[12]=l[0];p[13]=l[1];p[14]=l[2];const D=y.subtract(V,B,l),E=y.subtract(W,C,l);l=y.subtract(X,R,l);const {visibleLineVisualElement:n,occludedLineVisualElement:v,undefinedLineVisualElement:w,targetVisualElement:q}=b;b=null==this.analysisViewData.elevationAlignedObserver||null==a.elevationAlignedTargetLocation;b=this.visible&&!b;n.visible=b;v.visible=b;w.visible=b;q.visible=b;q.attached=!c.interactiveAndEditable;
b&&(n.geometry=null,v.geometry=null,w.geometry=null,q.geometry=a.elevationAlignedTargetLocation,S?T?(n.geometry=[[g.fromArray(D),g.fromArray(E)]],n.transform=p,n.color=f.toUnitRGBA(d.visibleOuterColor),q.color=f.toUnitRGBA(d.visibleInnerColor)):(n.geometry=[[g.fromArray(D),g.fromArray(l)]],n.transform=p,n.color=f.toUnitRGBA(d.occludedOuterColor),v.geometry=[[g.fromArray(l),g.fromArray(E)]],v.transform=p,q.color=f.toUnitRGBA(d.occludedInnerColor)):(w.geometry=[[g.fromArray(D),g.fromArray(E)]],w.transform=
p,q.color=f.toUnitRGBA(d.undefinedInnerColor)))};h._getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}};h._connectComputation=function(a){const b=this._computationHandles;if(!b.has(a)){var c=this._createLineOfSightVisualization();b.add([this._updatingHandles.add(()=>
this._getLineOfSightVisualizationDependencies(a),d=>this._updateLineOfSightVisualization(a,c,d),{initial:!0,equals:()=>!1}),L.makeHandle(()=>this._destroyLineOfSightVisualization(c))],a)}};h._disconnectComputation=function(a){this._computationHandles.remove(a)};h._connectComputations=function(){return this._updatingHandles.addOnCollectionChange(()=>this.analysisViewData.computations,a=>this._onComputationsCollectionChange(a),{initial:!0,final:!0})};h._onComputationsCollectionChange=function({added:a,
removed:b}){for(const c of b)this._disconnectComputation(c);for(const c of a)this._connectComputation(c)};h._createObserverVisualization=function(){const a=f.toUnitRGBA(this._configuration.visibleInnerColor),b=new G.PointVisualElement({view:this.view,attached:!1,color:a,...I});this._observerVisualElement=b;this.addHandles(this._updatingHandles.add(()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible}),({observer:c,interactiveAndEditable:d,
visible:r})=>{null==c||d||!r?b.attached=!1:(b.geometry=c,this._observerVisualElement.attached=!0)},M.initial))};F._createClass(u,[{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"test",get:function(){return{disablePartialOcclusion:()=>{for(const a of this._lineOfSightVisualElements)a.visibleLineVisualElement.renderOccluded=
A.RenderOccludedFlag.Occlude,a.occludedLineVisualElement.renderOccluded=A.RenderOccludedFlag.Occlude,a.undefinedLineVisualElement.renderOccluded=A.RenderOccludedFlag.Occlude},visualizations:this._lineOfSightVisualElements}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}}]);return u}(J);k.__decorate([m.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,"analysis",void 0);k.__decorate([m.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,
"analysisViewData",void 0);k.__decorate([m.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,"view",void 0);k.__decorate([m.property({readOnly:!0})],e.LineOfSightVisualization.prototype,"visible",null);k.__decorate([m.property()],e.LineOfSightVisualization.prototype,"updating",null);k.__decorate([m.property()],e.LineOfSightVisualization.prototype,"interactiveAndEditable",null);k.__decorate([m.property()],e.LineOfSightVisualization.prototype,"test",null);k.__decorate([m.property()],
e.LineOfSightVisualization.prototype,"_configuration",null);e.LineOfSightVisualization=k.__decorate([N.subclass("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],e.LineOfSightVisualization);const I={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},V=g.create(),W=g.create(),X=g.create(),U=O.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});