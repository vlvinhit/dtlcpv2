// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../geometry/projection ../../../../../geometry/support/aaBoundingRect ../../support/projectionUtils ../../../../interactive/coordinateHelper ../../../../interactive/editGeometry/EditGeometry ../../../../interactive/editGeometry/EditGeometryOperations".split(" "),
function(f,m,g,u,v,w,x,n,h,F,G,H,y,z,A,l,B,C,p,q){const D=w.getLogger("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurement3DPathHelper");f.AreaMeasurement3DPathHelper=function(r){function k(a={}){a=r.call(this,a)||this;a._handles=new v;a._version=0;a._internalGeometryChange=!1;a._extent=l.empty();return a}m._inherits(k,r);var d=k.prototype;d.destroy=function(){this._handles=x.destroyMaybe(this._handles)};d._initialize=function(a,b){this._handles.removeAll();this._handles.add(n.watch(()=>
a.geometry,()=>{this._updateEditGeometryFromModelGeometry(a,b)},n.syncAndInitial));this._makeDirty(!0)};d._makeDirty=function(a=!1){this.notifyChange("isValidPolygon");this.notifyChange("initialized");this.notifyChange("extent");a&&this.notifyChange("numVertices")};d._updateEditGeometryFromModelGeometry=function(a,b){this._version++;if(!this._internalGeometryChange){this._handles.remove("EditGeometry");var c=a.geometry;if(null!=c){const e=A.tryProjectWithZConversion(c,b.spatialReference);null==e&&
B.logFailedGeometryProjectionError(a,c.spatialReference,D);c=e}this._editGeometryOperations=null!=c?q.EditGeometryOperations.fromGeometry(c,b.state.viewingMode):new q.EditGeometryOperations(new p.EditGeometry("polygon",C.createCoordinateHelper(!0,!1,b.spatialReference)));this._makeDirty(!0);this.emit("change");this._handles.add(this._editGeometry.on("change",e=>{this._makeDirty(null!=e.addedVertices||null!=e.removedVertices);this._internalGeometryChange=!0;a.geometry=0<this.numVertices?this._editGeometry.geometry:
null;this._internalGeometryChange=!1}),"EditGeometry")}};d.getVertex=function(a){if(!this.constructed||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const b=this._editGeometry.components[0].vertices[0];let c=b;do{if(c.index===a)return c;c=c.rightEdge.rightVertex}while(c!==b&&null!=c);return null};d.getVertexPositionAsPoint=function(a){return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)};d.getVertexPositionAsPointFromIndex=function(a){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(a).pos)};
d.forEachVertex=function(a){this.constructed&&0<this._editGeometry.components.length&&this._editGeometry.components[0].iterateVertices(a)};d.forEachVertexPosition=function(a){const b=this._editGeometry.coordinateHelper;this.forEachVertex((c,e)=>{b.vectorToPoint(c.pos,t);a(t,e)})};d.clear=function(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)};d.add=function(a){if(!this.constructed)return null;if(0===this._editGeometry.components.length){const b=this.view;this._editGeometry.components.push(new p.Component(b.spatialReference,
b.state.viewingMode))}a=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(a));this.emit("change");return a};d.close=function(){if(!this.constructed||0===this._editGeometry.components.length)return null;const a=this._editGeometryOperations.closeComponent(this._editGeometry.components[0]);this.emit("change");return a};d.ensureContains=function(a,b=""){let c=!1;this._editGeometry.components.forEach(e=>{e.iterateVertices(E=>{E===a&&(c=!0)})});if(!c)throw Error(`vertex doesnt exist ${b}`);
return c};d.setVertexPosition=function(a,b){if(!this.constructed)return null;a=this._editGeometryOperations.setVertexPosition(a,this._editGeometry.coordinateHelper.pointToVector(b));this.emit("change");return a};d.equals=function(a){if(this.numVertices!==a.numVertices)return!1;let b=!0;this.forEachVertexPosition((c,e)=>{e=a.getVertexPositionAsPointFromIndex(e);c.equals(e)||(b=!1)});return b?!0:!1};m._createClass(k,[{key:"areaMeasurement",set:function(a){this._set("areaMeasurement",a);null!=a&&null!=
this.view&&this._initialize(a,this.view)}},{key:"view",set:function(a){this._set("view",a);null!=a&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,a)}},{key:"constructed",get:function(){return null!=this.areaMeasurement&&null!=this.view}},{key:"version",get:function(){return this._version}},{key:"isValidPolygon",get:function(){return this.constructed&&0<this._editGeometry.components.length&&this._editGeometry.components[0].isClosed()}},{key:"extent",get:function(){if(this.constructed&&
0<this._editGeometry.components.length&&0<this._editGeometry.components[0].vertices.length){const a=l.empty(this._extent);this.forEachVertex(b=>{l.expandPointInPlace(a,b.pos)});return a}return null}},{key:"spatialReference",get:function(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}},{key:"_editGeometry",get:function(){return this._editGeometryOperations.data}},{key:"vertices",get:function(){const a=[];this.forEachVertex(b=>{a.push(b)});return a}},{key:"numVertices",
get:function(){return this.constructed&&0<this._editGeometry.components.length?this._editGeometry.components[0].vertices.length:0}},{key:"lastPoint",get:function(){if(this.constructed&&0<this._editGeometry.components.length){const a=this._editGeometry.components[0].getLastVertex();if(null!=a)return this._editGeometry.coordinateHelper.vectorToPoint(a.pos)}return null}}]);return k}(u.EventedAccessor);g.__decorate([h.property({value:null})],f.AreaMeasurement3DPathHelper.prototype,"areaMeasurement",null);
g.__decorate([h.property({value:null})],f.AreaMeasurement3DPathHelper.prototype,"view",null);g.__decorate([h.property()],f.AreaMeasurement3DPathHelper.prototype,"isValidPolygon",null);g.__decorate([h.property()],f.AreaMeasurement3DPathHelper.prototype,"extent",null);g.__decorate([h.property()],f.AreaMeasurement3DPathHelper.prototype,"spatialReference",null);g.__decorate([h.property()],f.AreaMeasurement3DPathHelper.prototype,"numVertices",null);f.AreaMeasurement3DPathHelper=g.__decorate([y.subclass("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurement3DPathHelper")],
f.AreaMeasurement3DPathHelper);const t=new z;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});