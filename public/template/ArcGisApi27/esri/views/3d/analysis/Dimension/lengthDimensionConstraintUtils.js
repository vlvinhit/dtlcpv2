// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../geometry ../../../../analysis/dimensionUtils ../../../../core/has ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks ./lengthDimensionManipulatorUtils ./lengthDimensionUtils ./settings ../../../../geometry/Point".split(" "),function(e,y,v,z,m,p,w,q,x,t){function u(a,b,c){const {constraint:g,elevationAlignedStartPoint:d,elevationAlignedEndPoint:h,unconstrainedGeometry:k,view:r}=c,{dimension:f,previousConstraint:n,preConstraintProperties:l}=a;if(null!=d&&null!=
h){c=()=>{"startPoint"in b?f.startPoint=b.startPoint:"endPoint"in b&&(f.endPoint=b.endPoint)};if(null==g)c(),null!=n&&null!=l&&(f.measureType=l.measureType,f.orientation=l.orientation);else switch(f.measureType=v.LengthDimensionMeasureType.Direct,g){case e.LengthDimensionConstraint.Horizontal:g!==n&&(f.orientation=0);"startPoint"in b?(c=b.startPoint,null!=c&&(c.z=h.z),f.startPoint=c):"endPoint"in b&&(c=b.endPoint,null!=c&&(c.z=d.z),f.endPoint=c);break;case e.LengthDimensionConstraint.Vertical:g!==
n&&(f.orientation=w.automaticHeadingFromCamera(k,r));"startPoint"in b?(c=b.startPoint,null!=c&&(c.x=h.x,c.y=h.y),f.startPoint=c):"endPoint"in b&&(c=b.endPoint,null!=c&&(c.x=d.x,c.y=d.y),f.endPoint=c);break;case e.LengthDimensionConstraint.Direct:g!==n&&null!=l&&(f.orientation=l.orientation),c()}a.previousConstraint=g;a.unconstrainedGeometry=k}}e.LengthDimensionConstraint=void 0;(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical";a[a.Direct=2]="Direct"})(e.LengthDimensionConstraint||
(e.LengthDimensionConstraint={}));e.applyConstraint=u;e.computeConstraint=function(a,b){if(q.isGeodesicDimension(a))return e.LengthDimensionConstraint.Direct;if(!a.enabled)return null;({geometry:a}=a);if(null==a||m.exactEquals(a.directSegment.startRenderSpace,a.directSegment.endRenderSpace))return null;const {constraintThresholdPx:c}=x.settings,{camera:g}=b.state;b=q.directUp(p.sv3d.get(),a,b.renderCoordsHelper);var d=q.directStartToEnd(p.sv3d.get(),a);b=m.scale(p.sv3d.get(),b,m.dot(d,b));d=m.subtract(p.sv3d.get(),
d,b);d=m.squaredLength(d);b=m.squaredLength(b);const {startRenderSpace:h,endRenderSpace:k}=a.directSegment;a=Math.max(g.computeRenderPixelSizeAt(h)*c,g.computeRenderPixelSizeAt(k)*c)**2;return d<a?e.LengthDimensionConstraint.Vertical:b<a?e.LengthDimensionConstraint.Horizontal:null};e.constraintDependencies=function(a,b){return{enabled:b.effectiveFeatureEnabled,elevationAlignedStartPoint:a.elevationAlignedStartPoint,elevationAlignedEndPoint:a.elevationAlignedEndPoint,geometry:a.geometry}};e.reapplyConstraint=
function(a,b,{constraint:c,view:g}){const {unconstrainedGeometry:d}=a;if(null!=d){var {renderCoordsHelper:h,spatialReference:k}=g,{startRenderSpace:r,endRenderSpace:f}=d.directSegment,n=h.fromRenderCoords(r,new t,k),l=h.fromRenderCoords(f,new t,k);u(a,"start"===b?{startPoint:n}:{endPoint:l},{constraint:c,elevationAlignedStartPoint:a.elevationAlignedStartPoint,elevationAlignedEndPoint:a.elevationAlignedEndPoint,unconstrainedGeometry:d,view:g})}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});