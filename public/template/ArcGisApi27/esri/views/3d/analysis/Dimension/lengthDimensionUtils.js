// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../analysis/dimensionUtils ../../../../core/mathUtils ../../../../core/quantityUtils ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/Axis ../../../../geometry/support/vectorStacks ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../interactive/visualElements/support/Segment ../../../support/euclideanLengthMeasurementUtils".split(" "),
function(f,p,z,A,B,C,H,d,u,I,m,J,K,w,D){function E(a,c,b){b.toRenderCoords(c.elevationAlignedStartPoint,a.startRenderSpace);b.toRenderCoords(c.elevationAlignedEndPoint,a.endRenderSpace);return a}function x(a,c){const {measureType:b,elevationAlignedStartPoint:e,elevationAlignedEndPoint:g,directSegment:{startRenderSpace:h,endRenderSpace:k},directSegment:n,renderCoordsHelper:r}=c;var q=n.eval(.5,m.sv3d.get()),l=r.worldUpAtPosition(q,m.sv3d.get());q=r.worldBasisAtPosition(q,I.Axis.Y,m.sv3d.get());switch(b){case p.LengthDimensionMeasureType.Horizontal:d.copy(a,
l);break;case p.LengthDimensionMeasureType.Vertical:d.dot(h,l)<d.dot(k,l)?d.sub(a,k,h):d.sub(a,h,k);d.cross(a,a,l);d.cross(a,a,l);break;case p.LengthDimensionMeasureType.Direct:if(c=c.orientation??0,y({elevationAlignedStartPoint:e,elevationAlignedEndPoint:g}))C.fromRotation(v,-z.deg2rad(c),l),d.transformMat4(a,q,v);else{const t=d.sub(m.sv3d.get(),k,h);l=d.cross(m.sv3d.get(),t,l);d.cross(l,l,t);C.fromRotation(v,z.deg2rad(c),t);d.transformMat4(a,l,v)}}return d.equals(a,u.ZEROS)?d.copy(a,q):d.normalize(a,
a)}function y({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c}){return null!=a&&null!=c&&a.x===c.x&&a.y===c.y}function F(a,c){const {offsetAxis:b,offset:e,relativeToSegment:{startRenderSpace:g,endRenderSpace:h},relativeToSegment:k,renderCoordsHelper:n}=c,[r,q]=L(g,h,b,e/n.unitInMeters);d.scaleAndAdd(a.startRenderSpace,k.startRenderSpace,b,r);d.scaleAndAdd(a.endRenderSpace,k.endRenderSpace,b,q);return a}function L(a,c,b,e=0){c=d.dot(c,b);a=d.dot(a,b);b=Math.abs(c-a)+e;return c>a?[b,e]:[e,
b]}function G(a,c,b={invert:!1}){const {startRenderSpace:e,endRenderSpace:g}=c.dimensionSegment;return b.invert?d.sub(a,e,g):d.sub(a,g,e)}f.OffsetSegmentLocation=void 0;(function(a){a[a.Start=0]="Start";a[a.End=1]="End"})(f.OffsetSegmentLocation||(f.OffsetSegmentLocation={}));const M=J.makeDehydratedPoint(0,0,0,null),N=new w.EuclideanSegment,v=H.create(),O=u.create();f.GEODESIC_DISTANCE_THRESHOLD=1E5;f.arePointsVerticallyAligned=y;f.computationToGeometryDependencies=function(a){const {elevationAlignedStartPoint:c,
elevationAlignedEndPoint:b,dimension:{offset:e,measureType:g,orientation:h}}=a;return{elevationAlignedStartPoint:c,elevationAlignedEndPoint:b,offset:e,measureType:g,orientation:h}};f.computeGeometryFromDimension=function({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,offset:b,measureType:e,orientation:g},h,k=null){if(null==a||null==c)return null;const n=E(null!=k?k.directSegment:new w.EuclideanSegment,{elevationAlignedStartPoint:a,elevationAlignedEndPoint:c},h),r=null!=k?k.primaryOffsetAxis:
u.create();x(r,{measureType:e,elevationAlignedStartPoint:a,elevationAlignedEndPoint:c,directSegment:n,orientation:g,renderCoordsHelper:h});g=null!=k?k.dimensionSegment:new w.EuclideanSegment;y({elevationAlignedStartPoint:a,elevationAlignedEndPoint:c})&&e===p.LengthDimensionMeasureType.Vertical?(d.copy(g.startRenderSpace,n.startRenderSpace),d.copy(g.endRenderSpace,n.endRenderSpace)):F(g,{offsetAxis:r,offset:b,relativeToSegment:n,renderCoordsHelper:h});return{directSegment:n,dimensionSegment:g,primaryOffsetAxis:r,
spatialReference:h.spatialReference}};f.computeLength=function(a,c,b){if(null==a)return null;a=D.euclideanDirectDistance(a.dimensionSegment.startRenderSpace,a.dimensionSegment.endRenderSpace,a.spatialReference);if(null==a)return null;c=c===p.LengthDimensionMeasureType.Vertical?B.preferredVerticalLengthUnit(a.value,a.unit,b):B.preferredLengthUnit(a.value,a.unit,b);return A.toUnit(a,c)};f.computeOffsetAxis=x;f.computeOffsetForPoint=function(a,c,b,e){({directSegment:b}=b);c=x(m.sv3d.get(),{measureType:c,
directSegment:b,renderCoordsHelper:e});b=F(N,{offsetAxis:c,offset:0,relativeToSegment:b,renderCoordsHelper:e}).eval(.5,m.sv3d.get());a=d.sub(m.sv3d.get(),a,b);return d.dot(a,c)*e.unitInMeters};f.computeSegmentForMeasureType=function(a,c,b,e){switch(c){case p.LengthDimensionMeasureType.Direct:return E(a,b,e);case p.LengthDimensionMeasureType.Horizontal:case p.LengthDimensionMeasureType.Vertical:const {elevationAlignedStartPoint:k,elevationAlignedEndPoint:n,dimension:r,geometry:q}=b;if(r.measureType===
p.LengthDimensionMeasureType.Direct){var g=q,h=g.directSegment.eval(.5,m.sv3d.get());b=e.worldUpAtPosition(h,m.sv3d.get());g=g.dimensionSegment.eval(.5,m.sv3d.get());h=d.sub(m.sv3d.get(),g,h);b=d.equals(h,u.ZEROS)?!1:0<d.dot(h,b);b=b===k.z>n.z;c===p.LengthDimensionMeasureType.Horizontal&&(b=!b)}else{const {startRenderSpace:P,endRenderSpace:Q}=q.dimensionSegment,{startRenderSpace:R,endRenderSpace:S}=q.directSegment;b=!(d.sqrDist(R,P)<d.sqrDist(S,Q))}const [l,t]=b?[k,n]:[n,k];b=K.clonePoint(t,M);c===
p.LengthDimensionMeasureType.Horizontal?b.z=l.z:(b.x=l.x,b.y=l.y);e.toRenderCoords(l,a.startRenderSpace);e.toRenderCoords(b,a.endRenderSpace);return a}};f.computeSpanningSegment=function(a,c,b,e){c===f.OffsetSegmentLocation.Start?(d.copy(a.startRenderSpace,b.startRenderSpace),d.copy(a.endRenderSpace,e.startRenderSpace)):(d.copy(a.startRenderSpace,b.endRenderSpace),d.copy(a.endRenderSpace,e.endRenderSpace));return a};f.dimensionStartToEnd=G;f.directStartToEnd=function(a,c){const {startRenderSpace:b,
endRenderSpace:e}=c.directSegment;return d.sub(a,e,b)};f.directUp=function(a,c,b){c=c.directSegment.eval(.5,m.sv3d.get());return b.worldUpAtPosition(c,a)};f.headingFromGeometry=function(a,c){const b=a.directSegment.eval(.5,m.sv3d.get());return c.headingAtPosition(b,a.primaryOffsetAxis)};f.isGeodesicDimension=function(a){const {elevationAlignedStartPoint:c,elevationAlignedEndPoint:b}=a;if(null==c||null==b)return!1;a=D.euclideanDirectDistanceBetweenPoints(c,b);return null!=a&&1E5<A.toUnit(a,"meters").value};
f.isValidComputation=function(a){return null!=a.geometry};f.maxScreenLengthSquaredFromGeometry=function(a,c){return d.squaredLength(G(O,a))/c**2};f.offsetSegment=function(a,c,b,e){d.scaleAndAdd(a.startRenderSpace,c.startRenderSpace,b,e);d.scaleAndAdd(a.endRenderSpace,c.endRenderSpace,b,e)};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});