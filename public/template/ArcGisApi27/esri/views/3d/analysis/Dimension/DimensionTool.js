// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/clock ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/vectorStacks ./lengthDimensionManipulatorUtils ./LengthDimensionSubTool ./settings ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../../interactive/AnalysisToolBase ../../../interactive/keybindings ../../../support/screenUtils".split(" "),
function(c,m,d,r,n,t,g,e,C,D,E,u,v,p,w,x,y,z,A,q,B){var h;(function(k){k.Ready="ready";k.Creating="creating";k.Created="created"})(h||(h={}));c.DimensionTool=function(k){function l(a){a=k.call(this,a)||this;a.automaticManipulatorSelection=!1;a.removeIncompleteOnCancel=!1;a._pointerMoveTimerMs=x.settings.pointerMoveTimeoutMs;a._prevPointerMoveTimeout=null;return a}m._inherits(l,k);var b=l.prototype;b.initialize=function(){this._intersector=y.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
z.StoreResults.MIN;this._lengthDimensionSubTool=new w.LengthDimensionSubTool({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view});this.addHandles([n.destroyHandle(this._lengthDimensionSubTool),n.makeHandle(()=>this._clearPointerMoveTimeout()),g.watch(()=>this.state,a=>{a===h.Created&&this.finishToolCreation()},g.syncAndInitial),g.when(()=>this.firstGrabbedManipulator,a=>{this.selectedDimension=a.metadata},g.syncAndInitial),
g.watch(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),g.syncAndInitial)])};b.onInputEvent=function(a){switch(a.type){case "immediate-click":this._clickHandler(a);break;case "immediate-double-click":this._doubleClickHandler(a);break;case "pointer-move":this._pointerMoveHandler(a);break;case "key-down":q.SKETCH_KEYS.cancel===a.key?null!=this._activeSubTool&&this._activeSubTool.removeStaged()?a.stopPropagation():this.active||(this.selectedDimension=null):q.SKETCH_KEYS.delete.includes(a.key)&&
this._deleteKeyHandler()}};b.onActivate=function(){this._activeSubTool=this._lengthDimensionSubTool};b.onDeactivate=function(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)};b.onShow=function(){this._resetPointerMoveTimeout()};b.onManipulatorSelectionChanged=function(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()};b.onHide=function(){this.selectedDimension=null};b._clickHandler=function(a){if(this.hasFocusedManipulators)a.stopPropagation();
else if(null!=this._activeSubTool){var f=this._intersectScreen(a);null!=f&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:f,pointerType:a.pointerType}),a.stopPropagation())}};b._doubleClickHandler=function(a){this.active&&(this.view.activeTool=null,a.stopPropagation())};b._pointerMoveHandler=function(a){this._resetPointerMoveTimeout();if(null!=this._activeSubTool&&!this.hasFocusedManipulators){var f=this._intersectScreen(a);if(null!=f)this._activeSubTool.onPointerMove({mapPoint:f,pointerType:a.pointerType})}};
b._deleteKeyHandler=function(){null!=this._activeSubTool&&this._activeSubTool.removeStaged();this._removeSelected()};b._intersectScreen=function(a){a=B.createScreenPointArrayFromEvent(a);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,this._intersector);a=this._intersector.results.min;const f=v.sv3d.get();return a.getIntersectionPoint(f)?this.view.renderCoordsHelper.fromRenderCoords(f,this.view.spatialReference):null};b._removeSelected=function(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),
this.selectedDimension=null)};b._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout=t.removeMaybe(this._prevPointerMoveTimeout)};b._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout();this.manipulators.forEach(a=>{a.manipulator.state|=p.DidPointerMoveRecentlyFlag});this._prevPointerMoveTimeout=r.clock.setTimeout(()=>{this.manipulators.forEach(a=>{a.manipulator.state&=~p.DidPointerMoveRecentlyFlag})},this._pointerMoveTimerMs)};m._createClass(l,[{key:"state",get:function(){return this.analysis.dimensions.some(a=>
"length"===a.type)?null!=this._activeSubTool?h.Creating:h.Created:h.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"selectedDimension",get:function(){return this.analysisViewData.selectedDimension},set:function(a){this.analysisViewData.selectedDimension=a}},{key:"testInfo",get:function(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:a=>{this._pointerMoveTimerMs=
a;this._resetPointerMoveTimeout()}}}}]);return l}(A.AnalysisToolBase);d.__decorate([e.property({constructOnly:!0})],c.DimensionTool.prototype,"view",void 0);d.__decorate([e.property({constructOnly:!0})],c.DimensionTool.prototype,"analysis",void 0);d.__decorate([e.property({readOnly:!0})],c.DimensionTool.prototype,"state",null);d.__decorate([e.property({readOnly:!0})],c.DimensionTool.prototype,"updating",null);d.__decorate([e.property({readOnly:!0})],c.DimensionTool.prototype,"cursor",null);d.__decorate([e.property({constructOnly:!0})],
c.DimensionTool.prototype,"analysisViewData",void 0);d.__decorate([e.property()],c.DimensionTool.prototype,"selectedDimension",null);d.__decorate([e.property()],c.DimensionTool.prototype,"automaticManipulatorSelection",void 0);d.__decorate([e.property()],c.DimensionTool.prototype,"_activeSubTool",void 0);d.__decorate([e.property()],c.DimensionTool.prototype,"_lengthDimensionSubTool",void 0);c.DimensionTool=d.__decorate([u.subclass("esri.views.3d.analysis.Dimension.DimensionTool")],c.DimensionTool);
Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});