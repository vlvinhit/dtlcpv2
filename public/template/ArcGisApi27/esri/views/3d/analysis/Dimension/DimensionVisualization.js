// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../intl ../../../../core/Accessor ../../../../core/handleUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ./LengthDimensionVisualization ./settings ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/LineMarkerTechniqueConfiguration ../../../../intl/locale ../../../../intl/messages".split(" "),
function(d,r,g,w,I,x,y,e,z,l,J,K,L,A,m,B,t,h,C,u,n,D,E,F){d.DimensionVisualization=function(v){function p(a){a=v.call(this,a)||this;a.loadingMessages=!1;a._messages=null;a._dimensionVisualizations=new Map;a._markerMaterial=new C.LineMarkerMaterial({width:1,anchor:D.LineMarkerAnchor.Tip,color:m.ZEROS,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,markerPrimitive:"triangle"});a._dimensionLineMaterial=new n.RibbonLineMaterial({width:1,
color:m.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,markerParameters:a._markerMaterial.parameters});a._offsetLineMaterial=new n.RibbonLineMaterial({width:1,color:m.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:u.createStipplePatternSimple(5),stippleScaleWithLineWidth:!0});a._smallDimensionLineMaterial=new n.RibbonLineMaterial({width:1,color:m.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent});a._smallOffsetLineMaterial=new n.RibbonLineMaterial({width:1,
color:m.ZEROS,renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:u.createStipplePatternSimple(5),stippleScaleWithLineWidth:!0});return a}r._inherits(p,v);var k=p.prototype;k.initialize=function(){for(const b of this._lineMaterials())this.view._stage.add(b),this.addHandles(y.makeHandle(()=>{this.view._stage?.remove(b);b.dispose()}));const {computations:a}=this.analysisViewData;for(const b of a)this._addComputation(b);this.addHandles([a.on("change",({added:b,removed:c})=>{for(const f of c)this._removeComputation(f);
for(const f of b)this._addComputation(f)}),e.watch(()=>w.toUnitRGBA(this.analysis.style.color),b=>{for(const c of this._lineMaterials())c.setParameters({color:b})},e.syncAndInitial),e.watch(()=>this.analysis.style.lineSize,b=>{b=z.pt2px(b);this._markerMaterial.setParameters({width:b*t.settings.markers.lineSizeFraction});this._dimensionLineMaterial.setParameters({width:b,markerParameters:this._markerMaterial.parameters});this._offsetLineMaterial.setParameters({width:Math.max(b*t.settings.offsetLine.lineSizeFraction,
1)})},e.syncAndInitial),e.watch(()=>{var b=this.view.state.camera;const {fontSize:c,lineSize:f,textColor:q,textBackgroundColor:G}=this.analysis.style;var H={fontSize:c,lineSize:f,textBackgroundColor:G.clone(),textColor:q.clone()};return{camera:b,style:H}},({camera:b,style:c})=>{for(const [f,q]of this._dimensionVisualizations)q.updateCameraDependentElements(b,f.geometry,c),q.updateLabelStyle(c)}),e.watch(()=>this.visible,b=>{for(const c of this._dimensionVisualizations.values())c.visible=b})]);this.addHandles([E.onLocaleChange(()=>
this._updateMessageBundle()),e.when(()=>!this.loadingMessages,()=>{for(const b of this._dimensionVisualizations.values())b.updateUnitsMessages(this._messages)},e.sync)]);this._updateMessageBundle()};k.destroy=function(){this._dimensionVisualizations.forEach(a=>{a.destroy()});this._dimensionVisualizations.clear()};k._addComputation=function(a){this._dimensionVisualizations.has(a)||this._dimensionVisualizations.set(a,new B.LengthDimensionVisualization({analysis:this.analysis,computation:a,view:this.view,
visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))};k._removeComputation=function(a){const b=this._dimensionVisualizations.get(a);null!=b&&(b.destroy(),this._dimensionVisualizations.delete(a))};k._lineMaterials=function(){return[this._markerMaterial,this._dimensionLineMaterial,
this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]};k._updateMessageBundle=async function(){this.loadingMessages=!0;try{this._messages=await F.fetchMessageBundle("esri/core/t9n/Units")}finally{this.loadingMessages=!1}};r._createClass(p,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"testInfo",get:function(){return{visualizations:Array.from(this._dimensionVisualizations.values()),
disablePartialOcclusion:()=>{for(const a of this._lineMaterials())a.setParameters({renderOccluded:h.RenderOccludedFlag.Occlude})}}}}]);return p}(x);g.__decorate([l.property({constructOnly:!0})],d.DimensionVisualization.prototype,"analysisViewData",void 0);g.__decorate([l.property({constructOnly:!0,nonNullable:!0})],d.DimensionVisualization.prototype,"view",void 0);g.__decorate([l.property()],d.DimensionVisualization.prototype,"analysis",null);g.__decorate([l.property()],d.DimensionVisualization.prototype,
"visible",null);g.__decorate([l.property()],d.DimensionVisualization.prototype,"loadingMessages",void 0);d.DimensionVisualization=g.__decorate([A.subclass("esri.views.3d.analysis.Dimension.DimensionVisualization")],d.DimensionVisualization);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});