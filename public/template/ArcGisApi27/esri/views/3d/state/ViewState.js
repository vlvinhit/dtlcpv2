// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(p,c,b,v,w,d,E,F,G,x,y,k,z,A,l,B,C,m,q,e,r){b=function(t){function n(){var a=t.apply(this,arguments)||this;a._propertiesPool=new q.PropertiesPool({camera:e.Camera},p._assertThisInitialized(a));a._lastSeenCameraProjectionValues=new e.Camera;a.mode=r.RenderState.ANIMATING;a._cssCamera=new e.Camera;a._camera=new e.Camera;a.rasterPixelRatio=1;a.contentPixelRatio=1;a.events=new v;a.viewingMode=l.ViewingMode.Global;a._cameraChanged=!1;a._updateQueue=[];a._processingUpdates=!1;return a}p._inherits(n,
t);var h=n.prototype;h.init=function(a,f){this._set("viewingMode",a);this._set("spatialReference",f);this._set("constraints",new B.Constraints({mode:this.viewingMode}))};h.exit=function(){this.cameraController?.destroy();this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new q.PropertiesPool({camera:e.Camera},this)};h.destroy=function(){this.cameraController?.destroy();this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null};h.createInitialCamera=
function(){if(this.viewingMode===l.ViewingMode.Global){const a=z.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new e.Camera({eye:k.fromValues(4*a,0,0),center:k.fromValues(a,0,0),up:k.fromValues(0,0,1)})}else this.camera=new e.Camera({eye:k.fromValues(0,0,100),center:k.fromValues(0,0,0),up:k.fromValues(0,1,0)})};h.switchCameraController=function(a){this.cameraController=a;return a.state!==m.State.Rejected};h.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?
!1:!0};h.updateCamera=function(a){this._updateQueue.push(a);this._processUpdateQueue()};h._processUpdateQueue=function(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var a=this._updateQueue.shift();g.copyFrom(this._get("camera"));a(g);this.camera=g;this._processingUpdates=!1;this._processUpdateQueue()}};h._cameraProjectionChanged=function(a,f){return a.fov!==f.fov||a.fullViewport[0]!==f.fullViewport[0]||a.fullViewport[1]!==f.fullViewport[1]||a.fullViewport[2]!==
f.fullViewport[2]||a.fullViewport[3]!==f.fullViewport[3]||a.padding[e.PaddingSide.TOP]!==f.padding[e.PaddingSide.TOP]||a.padding[e.PaddingSide.RIGHT]!==f.padding[e.PaddingSide.RIGHT]||a.padding[e.PaddingSide.BOTTOM]!==f.padding[e.PaddingSide.BOTTOM]||a.padding[e.PaddingSide.LEFT]!==f.padding[e.PaddingSide.LEFT]?!0:!1};p._createClass(n,[{key:"animation",get:function(){return this.cameraController instanceof C.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:
null}},{key:"camera",get:function(){return this._camera},set:function(a){a!==g&&g.copyFrom(a);g.computeUp(this.viewingMode);this.events.emit("before-camera-change",g);a=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,g)&&(this._lastSeenCameraProjectionValues.copyFrom(g),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!a.equals(g)&&(this._camera=this._propertiesPool.get("camera").copyFrom(g),this._cameraChanged=!a.almostEquals(g))){const f=
y.afterDispatch(()=>{this._cameraChanged=!1;f.remove()})}}},{key:"cssCamera",get:function(){const a=this._cssCamera.copyFrom(this.camera),{height:f,width:D,pixelRatio:u}=this.camera;a.pixelRatio=1;a.height=Math.round(f/u);a.width=Math.round(D/u);return a}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"alignPixelEnabled",get:function(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===r.RenderState.IDLE}},{key:"updating",get:function(){return!this.alignPixelEnabled}},
{key:"contentCamera",get:function(){return this._contentCamera??this.camera},set:function(a){this._contentCamera=null!=a?a.clone():null}},{key:"fixedContentCamera",get:function(){return null!=this._contentCamera}},{key:"isGlobal",get:function(){return this.viewingMode===l.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===l.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&
!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(a){this.stopActiveCameraController()?(this.cameraController?.destroy(),a&&(this.removeHandles("ViewStateHandles"),this.addHandles(w.when(()=>a.state===m.State.Finished||a.state===m.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(f=>a.onControllerEnd(f))},{sync:!0,once:!0}),"ViewStateHandles"),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=
m.State.Rejected)}}]);return n}(b);c.__decorate([d.property()],b.prototype,"mode",void 0);c.__decorate([d.property({readOnly:!0,type:A})],b.prototype,"animation",null);c.__decorate([d.property({type:e.Camera})],b.prototype,"camera",null);c.__decorate([d.property({type:e.Camera})],b.prototype,"cssCamera",null);c.__decorate([d.property()],b.prototype,"_cssCamera",void 0);c.__decorate([d.property()],b.prototype,"_camera",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"pixelRatio",null);
c.__decorate([d.property()],b.prototype,"rasterPixelRatio",void 0);c.__decorate([d.property()],b.prototype,"contentPixelRatio",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"alignPixelEnabled",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"updating",null);c.__decorate([d.property({})],b.prototype,"_contentCamera",void 0);c.__decorate([d.property({type:e.Camera})],b.prototype,"contentCamera",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"fixedContentCamera",
null);c.__decorate([d.property({readOnly:!0})],b.prototype,"constraints",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"events",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"isGlobal",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"isLocal",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"viewingMode",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"spatialReference",void 0);c.__decorate([d.property()],b.prototype,"navigating",null);
c.__decorate([d.property()],b.prototype,"stationary",null);c.__decorate([d.property()],b.prototype,"_cameraChanged",void 0);c.__decorate([d.property()],b.prototype,"cameraController",null);c=b=c.__decorate([x.subclass("esri.views.3d.state.ViewState")],b);const g=new e.Camera;return c});