// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),function(l,r,q,v,w,x,t,u,C,D,E,y,z,A){function n(k,
g,h,a,c,d,e){for(const f of g)g=f.getElevation(h,a,c,d,e),null!=g&&(k=null!=k?Math.max(g,k):g);return k}l.CombinedElevationProvider=function(k){function g(a){a=k.call(this,a)||this;a._im=[];a._ground=[];a._scene=[];a._handles=new Map;a.lastElevationQuery=null;a.elevationCacheEnabled=!1;return a}r._inherits(g,k);var h=g.prototype;h.destroy=function(){this._elevationQueryCached=x.destroyMaybe(this._elevationQueryCached)};h.enableElevationCache=function(a){a||(this.lastElevationQuery=null);this.elevationCacheEnabled=
a};h.getElevation=function(a,c,d,e,f){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var b=this.lastElevationQuery;if(a===b.x&&c===b.y&&d===b.z&&z.equals(e,b.spatialReference)&&f===b.queryContext)return b.result}b=n(null,this._im,a,c,d,e,f);null==b&&(b=n(b,this._ground,a,c,d,e,f));"scene"===f&&(b=n(b,this._scene,a,c,d,e,f));this.elevationCacheEnabled&&(this.lastElevationQuery={x:a,y:c,z:d,spatialReference:e,queryContext:f,result:b});return b};h.getSphereElevationBounds=function(a,c){let d=
Infinity,e=-Infinity;for(const f of[this._im,this._ground,this._scene])f.forEach(b=>{b.getSphereElevationBounds&&(b=b.getSphereElevationBounds(a,c),null!=b&&(d=Math.min(d,b.min),e=Math.max(e,b.max)))});return{min:d,max:e}};h.queryElevation=function(a,c,d,e,f,b=null,B=0){const p=t.createResolver();this._elevationQuery.queryElevation(a,c,b,B).then(m=>{"scene"===f&&(m=n(m,this._scene,a,c,d,e,f));p.resolve(m)}).catch(m=>{t.isAbortError(m)?p.reject(m):p.resolve(this.getElevation(a,c,d,e,f))});return p.promise};
h.register=function(a,c){this._handles.set(c,c.on("elevation-change",d=>this.emit("elevation-change",d)));this._providersFromContext(a).push(c)};h.unregister=function(a){this._handles.has(a)&&(this._handles.get(a)?.remove(),this._handles.delete(a));for(const c of[this._im,this._ground,this._scene]){const d=c.indexOf(a);-1<d&&c.splice(d,1)}};h._providersFromContext=function(a){switch(a){case "ground":return this._ground;case "im":return this._im;case "scene":return this._scene}};r._createClass(g,[{key:"spatialReference",
get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){null==this._elevationQueryCached&&(this._elevationQueryCached=new A.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return g}(w.EventedMixin(v));q.__decorate([u.property({constructOnly:!0})],l.CombinedElevationProvider.prototype,"view",void 0);q.__decorate([u.property()],
l.CombinedElevationProvider.prototype,"spatialReference",null);l.CombinedElevationProvider=q.__decorate([y.subclass("esri.views.3d.support.CombinedElevationProvider")],l.CombinedElevationProvider);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});