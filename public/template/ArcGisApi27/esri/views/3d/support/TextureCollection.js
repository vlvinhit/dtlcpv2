// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(d,f,l,q,m,t,u,v,r,n){d.TextureCollection=function(h){function g(a,b){var c=h.call(this,{})||this;c._stage=a;c._textureRequests=new Map;c._frameTask=b?.registerTask(n.TaskPriority.TEXTURE_UNLOAD)??
n.ImmediateTask;return c}f._inherits(g,h);var e=g.prototype;e.normalizeCtorArgs=function(){return{}};e.destroy=function(){f._get(f._getPrototypeOf(g.prototype),"destroy",this).call(this);this._frameTask?.remove();this._textureRequests?.forEach(a=>this._releaseTextureRequest(a));this._textureRequests?.clear()};e.fromData=function(a,b,c){const k=this.makeUid(a);a=this._textureRequests.get(k);a||(c=new p(c),c.texture=b(),this._stage?.add(c.texture),this._stage?.loadImmediate(c.texture),this._textureRequests.set(k,
c),a=c);a.referenceCount++;return{uid:k,texture:a.texture,release:()=>this._release(k)}};e._release=function(a){const b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)};e._releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||
(this._releaseTextureRequest(b),this._textureRequests.delete(a))}};e._releaseTextureRequest=function(a){if(a.onRemove)a.onRemove();a.texture?this._stage?.remove(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};e.makeUid=function(a,b=null){return null!=b?`${a}.${b}px`:a};f._createClass(g,[{key:"updating",get:function(){return this._frameTask.updating}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return g}(q);l.__decorate([m.property()],
d.TextureCollection.prototype,"_frameTask",void 0);l.__decorate([m.property()],d.TextureCollection.prototype,"updating",null);d.TextureCollection=l.__decorate([r.subclass("esri.views.3d.support.TextureCollection")],d.TextureCollection);let p=f._createClass(function(h){this.onRemove=h;this.referenceCount=0});d.TextureRequest=p;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});