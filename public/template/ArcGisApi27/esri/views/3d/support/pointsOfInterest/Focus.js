// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(d,n,f,x,y,r,z,g,G,H,I,A,h,p,B,C,D,E,t,q){const F=Array;d.Focus=function(u){function m(a){a=u.call(this,a)||this;a._propertiesPool=new D.PropertiesPool({location:B,renderLocation:F},n._assertThisInitialized(a));a._dirty=!0;a.renderLocation=a._propertiesPool.get("renderLocation");return a}n._inherits(m,u);var k=m.prototype;k.initialize=function(){this.handles.add([r.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),r.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(q.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};k.destroy=function(){this._propertiesPool=y.destroyMaybe(this._propertiesPool)};k.runTask=function(){var a=this._get("renderLocation");const c=this.centerOnSurface.renderLocation;var b=this.renderCoordsHelper,e=this.state.contentCamera;this._dirty=!1;b.worldUpAtPosition(c,v);b=Math.max(0,(Math.acos(h.dot(v,e.viewForward))-.5*Math.PI)*(e.aboveGround?1:-1));if(Number.isNaN(b))return a&&h.equals(a,
c)||(a=this._propertiesPool.get("renderLocation"),h.copy(a,c),this._set("renderLocation",a)),q.Task.YIELD;b=1-x.clamp(b/(.5*Math.PI),0,1);b*=b*b;this._calculateScreenHorizontalEdgeOnSurface(w);e=this._propertiesPool.get("renderLocation");h.lerp(e,c,w,b);a&&h.equals(a,e)||this._set("renderLocation",e);return q.Task.YIELD};k._calculateScreenHorizontalEdgeOnSurface=function(a){const c=this.state.contentCamera;var b=c.getRenderCenter(z.createRenderScreenPointArray3());b[1]=c.aboveGround?c.padding[t.PaddingSide.BOTTOM]:
c.fullHeight-c.padding[t.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(b,a))return a;const e=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return c.unprojectFromRenderScreen(b,l)&&(h.subtract(l,l,c.eye),b=h.normalize(l,l),this.renderCoordsHelper.intersectManifold(C.wrap(c.eye,b),e,a))?a:this.renderCoordsHelper.setAltitude(a,e,c.eye)};k.updateRenderLocation=function(){this._dirty=!0};n._createClass(m,[{key:"updating",get:function(){return this._dirty||
this.centerOnSurface.updating}},{key:"location",get:function(){const a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a}},{key:"running",get:function(){return this._dirty}}]);return m}(E.PointOfInterest);f.__decorate([g.property()],d.Focus.prototype,"_dirty",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"scheduler",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,
"centerOnSurface",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"updating",null);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"location",null);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"renderLocation",void 0);d.Focus=f.__decorate([A.subclass("esri.views.3d.support.pointsOfInterest.Focus")],d.Focus);const v=p.create(),l=p.create(),w=
p.create();Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});