// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(x,C,z,y,U,u,A,e,l,M,v,ea){function V(b,f,k){f===M.ViewingMode.Global?e.normalize(N,b.eye):e.set(N,0,0,1);e.scale(O,b.viewForward,-1);f=ea.angle(O,N);const g=Math.max(f-.5,0);y.fromRotation(W,-Math.max(.25,f-.25-
.85*g/(g+1)),b.viewRight);e.transformMat4(k,O,W);e.add(k,k,e.scale(fa,b.viewRight,.2));e.normalize(k,k)}function X(b,f,k,g){const p=ha,c=y.identity(ia);if(k===M.ViewingMode.Global)v.SunCalc.getPosition(b,0,0,p),e.set(g,0,0,-1),y.rotateX(c,c,-p.azimuth),y.rotateY(c,c,-p.altitude);else{var d=q.planarDirection;k=d.globalAngles;d=(Math.abs(f[2])-d.localAltitude)/(d.globalAltitude-d.localAltitude);d=z.clamp(d,0,1);1>d?(v.SunCalc.getPosition(b,f[1],f[0],p),p.azimuth=(1-d)*p.azimuth+d*k.azimuth,p.altitude=
(1-d)*p.altitude+d*k.altitude):(p.azimuth=k.azimuth,p.altitude=k.altitude);e.set(g,0,-1,0);y.rotateZ(c,c,-p.azimuth);y.rotateX(c,c,-p.altitude)}e.transformMat4(g,g,c)}function Y(b){switch(b){case "disabled":case "sunny":return new B(1,1);case "cloudy":return new B(1,1);case "rainy":return new B(.4,1.2);case "snowy":return new B(.5,1.3);case "foggy":return new B(.2,1.6)}}function Z(b,f){const k=(b[0]+b[1]+b[2])/3;b[0]+=(k-b[0])*f;b[1]+=(k-b[1])*f;b[2]+=(k-b[2])*f}const q={local:{altitude:1500,ambientAtNight:.1,
ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let B=C._createClass(function(b,f){this.direct=b;this.ambient=f});const ja=l.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);C=C._createClass(function(){this.ambient={color:l.fromValues(1,1,1),intensity:.55};this.direct={color:l.fromValues(1,1,1),intensity:.55,
directionToLightSource:l.clone(ja)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1});const ia=U.create(),ha={azimuth:0,altitude:0},P=l.fromValues(.01,.01,.01),D=l.fromValues(1,.6,.5),E=l.fromValues(1,.98,.98),aa=l.fromValues(1,1,1),Q=l.fromValues(.8,.8,1),F=l.fromValues(.8,.8,1),G=l.fromValues(.98,.98,1),ba=l.fromValues(1,1,1),R=A.fromValues(.01,q.local.ambientAtNight),H=A.fromValues(q.local.directAtTwilight,q.local.ambientAtTwilight),I=A.fromValues(.9*q.local.directAtNoon,
q.local.ambientAtNoon),ca=A.fromValues(q.local.directAtNoon,q.local.ambientAtNoon),da=new Date(0),W=U.create(),N=l.create(),O=l.create(),fa=l.create();x.ColorAndIntensity=C;x.computeColorAndIntensity=function(b,f,k,g,p,c){e.set(c.ambient.color,1,1,1);c.ambient.intensity=q.global.ambient;e.set(c.direct.color,1,1,1);c.direct.intensity=q.global.direct;var d=z.clamp((Math.abs(f[2])-q.local.altitude)/(q.global.altitude-q.local.altitude),0,1);c.globalFactor=d;var r;null!=b&&(r=v.SunCalc.getTimes(b,f[1],
f[0]));if(1>d){if(null!=b){var h=r;var a=b.valueOf();if(h.polarException===v.SunCalc.PolarException.MIDNIGHT_SUN){var m=a-36E5*(b.getHours()+48)-6E4*b.getMinutes();h=m+432E6}else h.polarException===v.SunCalc.PolarException.POLAR_NIGHT?(m=a-2,h=a-1):(m=h.sunrise.valueOf(),h=h.sunset.valueOf());var n=h-m;var t=m+n/2,w=n/4;const J=t-w;w=t+w;n*=.06;const S=m-n/2,K=m+n/2,L=h-n/2,T=h+n/2;m=A.create();n=l.create();h=l.create();a<S||a>T?(u.copy(m,R),e.copy(n,P),e.copy(h,Q)):a<K?(a=(a-S)/(K-S),u.lerp(m,R,
H,a),e.lerp(n,P,D,a),e.lerp(h,Q,F,a)):a<J?(a=(a-K)/(J-K),u.lerp(m,H,I,a),e.lerp(n,D,E,a),e.lerp(h,F,G,a)):a<t?(a=(a-J)/(t-J),u.lerp(m,I,ca,a),e.lerp(n,E,aa,a),e.lerp(h,G,ba,a)):a<w?(a=(a-t)/(w-t),u.lerp(m,ca,I,a),e.lerp(n,aa,E,a),e.lerp(h,ba,G,a)):a<L?(a=(a-w)/(L-w),u.lerp(m,I,H,a),e.lerp(n,E,D,a),e.lerp(h,G,F,a)):a<T&&(a=(a-L)/(T-L),u.lerp(m,H,R,a),e.lerp(n,D,P,a),e.lerp(h,F,Q,a));a=0;switch(g){case "rainy":case "foggy":a=.8;break;case "snowy":a=.5}0<a&&(Z(n,a),Z(h,a));t=Y(g);a=m[0]*t.direct;m=m[1]*
t.ambient}else h=Y(g),a=q.local.directAtNoon*h.direct,n=l.fromValues(1,1,1),m=q.local.ambientAtNoon*h.ambient,h=l.fromValues(1,1,1);e.lerp(c.ambient.color,h,c.ambient.color,d);c.ambient.intensity=z.lerp(m,c.ambient.intensity,d);e.lerp(c.direct.color,n,c.direct.color,d);c.direct.intensity=z.lerp(a,c.direct.intensity,d);c.specularStrength="rainy"===g||"snowy"===g||"foggy"===g?0:1;c.environmentStrength="rainy"===g?.7:"snowy"===g||"foggy"===g?.75:1}null!=b?(g=b.valueOf(),r.polarException===v.SunCalc.PolarException.MIDNIGHT_SUN?
(d=g-36E5*(b.getHours()+48)-6E4*b.getMinutes(),r=d+432E6):r.polarException===v.SunCalc.PolarException.POLAR_NIGHT?(d=g-2,r=g-1):(d=r.sunrise.valueOf(),r=r.sunset.valueOf()),g=1-z.clamp(Math.abs(g-(d+(r-d)/2))/432E5,0,1)):g=1;c.noonFactor=g;null!=b?X(b,f,k,c.direct.directionToLightSource):V(p,k,c.direct.directionToLightSource)};x.computeDirectionsOverTime=function(b,f,k,g,p){b=b.getTime();f=f.getTime()-b;f=Math.floor(f/k)+1;const c=Array(f);for(let d=0;d<f;++d)da.setTime(b+k*d),c[d]=l.create(),X(da,
g,p,c[d]);return c};x.computeShadowsEnabled=function(b,f){return f===M.ViewingMode.Global?!0:Math.abs(b)<q.planarDirection.localAltitude};x.computeVirtualLightDirection=V;Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});