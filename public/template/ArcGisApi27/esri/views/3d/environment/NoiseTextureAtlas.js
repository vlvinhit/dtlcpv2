// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(d,m,k,r,e,n,z,A,B,t,u,v,c,l,p,w,x,y){d.NoiseTextureAtlas=function(q){function f(a){var b=q.call(this,a)||this;b._needsRender=!0;b._passParameters=new v.NoiseTextureAtlasPassParameters;b._frameBuffer=new x.FramebufferObject(a.context.renderContext.rctx,new y.TextureDescriptor(l.ATLAS_SIZE));b._vao=w.createQuadVAO(a.context.renderContext.rctx);return b}m._inherits(f,q);var g=f.prototype;g._setDirty=function(){this._needsRender=!0};g.updateWeatherMap=function(a){if(this._passParameters.weatherTile[0]!==
a[0]||this._passParameters.weatherTile[1]!==a[1])u.copy(this._passParameters.weatherTile,a),this._setDirty()};g.destroy=function(){this._fullTechniqueCached=e.releaseMaybe(this._fullTechniqueCached);this._weatherMapTechniqueCached=e.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=e.disposeMaybe(this._frameBuffer);this._vao=e.disposeMaybe(this._vao)};g._render=function(a){if(null==this._vao||null==this._frameBuffer)return null;var b=a===c.NoiseTextureRenderMode.Full?this._fullTechnique:
this._weatherMapTechnique;a=this.context.renderContext.rctx;const h=a.getViewport();a.setViewport(0,0,l.ATLAS_SIZE,l.ATLAS_SIZE);a.bindFramebuffer(this._frameBuffer);b=a.bindTechnique(b,this._passParameters,null);a.bindVAO(this._vao);b.assertCompatibleVertexAttributeLocations(this._vao);a.gl.drawArrays(a.gl.TRIANGLE_STRIP,0,4);a.setViewport(h.x,h.y,h.width,h.height);this._needsRender=!1;return this._frameBuffer.colorTexture};m._createClass(f,[{key:"_techniqueRepository",get:function(){return this.context.techniqueRepository}},
{key:"textureAtlas",get:function(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(c.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(c.NoiseTextureRenderMode.Full));return this._texture}},{key:"_fullTechnique",get:function(){if(null==this._fullTechniqueCached){const a=new c.NoiseTextureAtlasTechniqueConfiguration;a.mode=c.NoiseTextureRenderMode.Full;
this._fullTechniqueCached=this._techniqueRepository.acquire(p.NoiseTextureAtlasTechnique,a)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(null==this._weatherMapTechniqueCached){const a=new c.NoiseTextureAtlasTechniqueConfiguration;a.mode=c.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(p.NoiseTextureAtlasTechnique,a)}return this._weatherMapTechniqueCached}}]);return f}(r);k.__decorate([n.property({constructOnly:!0})],
d.NoiseTextureAtlas.prototype,"context",void 0);k.__decorate([n.property({readOnly:!0})],d.NoiseTextureAtlas.prototype,"_techniqueRepository",null);d.NoiseTextureAtlas=k.__decorate([t.subclass("esri.views.3d.environment.NoiseTextureAtlas")],d.NoiseTextureAtlas);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});