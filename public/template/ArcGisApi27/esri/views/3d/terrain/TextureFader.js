// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(d,k,e,l){let h=function(){function c(a){this._getFadeDuration=a;this._delayedTime=this._fadeStart=0}var f=c.prototype;f.clear=function(){this._current=e.destroyMaybe(this._current);this._next=e.destroyMaybe(this._next);this._waiting=e.destroyMaybe(this._waiting);this._delayed=e.destroyMaybe(this._delayed)};f.push=function(a,b=d.ActivationTime.Immediate){this._delayed=e.destroyMaybe(this._delayed);
this._push(a,b)};f._push=function(a,b){this._isFadingEnabled||this.clear();if(null==this._current)this._current=a;else{var g=c.test.fadeMoment||performance.now();b!==d.ActivationTime.Immediate?(this._delayed=a,this._delayedTime=g+b):null==this._next?(this._next=a,this._fadeStart=this._alignFadeStart(g)):null!=a&&(e.destroyMaybe(this._waiting),this._waiting=a)}};f._alignFadeStart=function(a){const b=this._getFadeDuration();return a+b-a%b};k._createClass(c,[{key:"current",get:function(){if(null==this._current)return null;
if(!this._isFadingEnabled){var a=this._delayed||this._waiting||this._next||this._current;a!==this._current&&(this._current=null,this.clear(),this._current=a)}a=c.test.fadeMoment;null!=this._delayed&&(a=a||performance.now(),a>=this._delayedTime&&(this._push(this._delayed,d.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){a=a||performance.now();const b=this._next.type!==l.TextureUpdate.FADING,g=a-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||
b||g)e.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(a)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(null==this._next)return 1;var a=c.test.fadeMoment||performance.now();a=Math.max(0,a-this._fadeStart);const b=this._fadeDuration;return a>b?0:1-a/b}},{key:"isFading",get:function(){return null!=this._next||null!=this._delayed}},{key:"_fadeDuration",get:function(){return null==
this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return c}();h.test={fadeMoment:0};d.ActivationTime=void 0;(function(c){c[c.Immediate=0]="Immediate";c[c.Delayed=5E3]="Delayed"})(d.ActivationTime||(d.ActivationTime={}));d.TextureFader=h;Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});