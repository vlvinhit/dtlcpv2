// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(l,p,d,q,m,e){const n={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let w=function(){function h(a,b,c=null,g=null){this.type="raster-tile";this._interpolation=
this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=a;this.source=b;this.width=c||b.width;this.height=g||b.height}var f=h.prototype;f.bind=function(a){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(a,this.bandIds);null!=this._rasterTexture&&
(this._updateColormapTexture(a),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=e.createTransformTexture(a,this.transformGrid)));return!0};f.getUniforms=function(){const {symbolizerParameters:a,transformGrid:b,width:c,height:g,opacity:k}=this,r=e.getCommonUniforms(b,[c,g],[this.source.width,this.source.height],k),t=e.getColormapUniforms(a.colormap,a.colormapOffset),u="stretch"===this.symbolizerParameters.type?e.getStretchUniforms(this.symbolizerParameters):null,v=
"hillshade"===this.symbolizerParameters.type?e.getShadedReliefUniforms(this.symbolizerParameters):null;return new q.ColorizerUniforms(r,t,u||v,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};f.release=function(){this._rasterTexture=d.disposeMaybe(this._rasterTexture);this._transformGridTexture=d.disposeMaybe(this._transformGridTexture);this._colormapTexture=d.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};f._updateRasterTexture=
function(a,b){const c=this.source?this.source.extractBands(b):null;c&&c.pixels&&0<c.pixels.length?(b=null==b&&null==this.bandIds||null!=b&&null!=this.bandIds&&b.join("")===this.bandIds.join(""),null!=this._rasterTexture&&b||(this._rasterTexture=d.disposeMaybe(this._rasterTexture),b=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=e.createRasterTexture(a,c,b,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=d.disposeMaybe(this._rasterTexture)};f.hasStretchTypeNone=
function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};f._getRasterTextureInterpolation=function(a){return"lut"===this.symbolizerParameters.type||"nearest"===a||"majority"===a||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"};f._updateColormapTexture=function(a){const b=this._colormap,c=this.symbolizerParameters.colormap;if(!c)this._colormapTexture=d.disposeMaybe(this._colormapTexture),
this._colormap=null;else if(!b)this._colormapTexture=e.createColormapTexture(a,c),this._colormap=c;else if(c.length!==b.length||c.some((g,k)=>g!==b[k]))this._colormapTexture=d.disposeMaybe(this._colormapTexture),this._colormapTexture=e.createColormapTexture(a,c),this._colormap=c};p._createClass(h,[{key:"source",get:function(){return this._source},set:function(a){this._source=a;this._rasterTexture=d.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?
{...n,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||n},set:function(a){this._symbolizerParameters=a}},{key:"bandIds",get:function(){return this._bandIds},set:function(a){null!=a&&0<a.length?this._bandIds&&a.every((b,c)=>this._bandIds?.[c]?b===this._bandIds[c]:!1)||(this._bandIds=a,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(a){this._interpolation=a;null!=this._rasterTexture&&(a=this._getRasterTextureInterpolation(a),
this._rasterTexture.setSamplingMode("bilinear"===a?m.TextureSamplingMode.LINEAR:m.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(a){this._transformGrid=a;this._transformGridTexture=d.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"isBilinearWithStretchColorRamp",get:function(){const {symbolizerParameters:a}=this;return"bilinear"===this.interpolation&&null!=a.colormap&&"stretch"===a.type}},{key:"memoryUsage",get:function(){null==
this._memoryUsed&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(a=>null!=a?a.descriptor.width*a.descriptor.height*4:0).reduce((a,b)=>a+b,0));return this._memoryUsed}}]);return h}();l.RasterTile=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});