// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/reactiveUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/vectorStacks ../../../../layers/graphics/dehydratedFeatures ./EngineVisualElement ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(t,u,C,l,D,e,m,v,w,n,E,r,F,G,H,I,x,J,y,z,A){r=function(B){function p(a){var b=B.call(this,a)||this;b._maxSize=0;b._position=m.create();b._up=m.create();b._right=m.create();b._renderOccluded=x.RenderOccludedFlag.OccludeAndTransparent;b._color=w.fromValues(1,0,0,1);b._outlineColor=w.fromValues(0,0,0,1);b._outlineSize=0;b._size=32;b._outlineRenderOccluded=x.RenderOccludedFlag.Opaque;b.applyProps(a);return b}u._inherits(p,B);var d=p.prototype;d.createObject3DResourceFactory=function(a){return{view:a,
createResources:b=>this._createObject3DResources(b),destroyResources:b=>this._destroyObject3DResources(b),cameraChanged:()=>this._updateTransformObject3D()}};d.createDrapedResourceFactory=function(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:b=>this._destroyDrapedResources(b)}};d._createObject3DResources=function(a){const b=new z.ColorMaterial(this._quadMaterialParameters),c=0===this._outlineSize?void 0:new A.RibbonLineMaterial(this._outlineMaterialParameters);
this._createObject3DGeometries(a,b,c);return{quadMaterial:b,outlineMaterial:c,forEach:f=>{f(b);c&&f(c)}}};d._destroyObject3DResources=function(a){a.quadMaterial.dispose();a.outlineMaterial?.dispose()};d._createObject3DGeometries=function(a,b,c){if(!e.exactEquals(this._up,m.ZEROS)||!e.exactEquals(this._right,m.ZEROS)){b=this._createGeometries(b,c);for(const f of b)a.addGeometry(f);this._updateTransformObject3D(a)}};d._createDrapedResources=function(){const a=new z.ColorMaterial(this._quadMaterialParameters),
b=0===this._outlineSize?void 0:new A.RibbonLineMaterial(this._outlineMaterialParameters),c=this._createGeometries(a,b).map(k=>new J.RenderGeometry(k));this._setTransformDraped(c);const f=C.watch(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{quadMaterial:a,outlineMaterial:b,geometries:c,pixelRatioHandle:f}};d._destroyDrapedResources=function(a){a.pixelRatioHandle.remove();a.geometries=[];a.outlineMaterial?.dispose();a.quadMaterial.dispose()};d._createGeometries=
function(a,b){const {up:c,right:f,corner:k}=this._getVertices();a=this._quadGeometryData(c,f,k,a);if(!b)return[a];b=I.createPolylineGeometry(b,[c,k,f]);return[a,b]};d._getVertices=function(){let a=this._up,b=this._right;const c=e.add(n.sv3d.get(),a,b);this.isDraped&&(a=e.copy(n.sv3d.get(),a),b=e.copy(n.sv3d.get(),b),a[2]=0,b[2]=0,c[2]=0);return{up:a,right:b,corner:c}};d._updateTransform=function(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()};d._updateTransformObject3D=
function(a=this.object3dResources.object){if(a){var b=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position);b=Math.min(this._maxSize,b);l.fromTranslation(h,this._position);l.scale(h,h,[b,b,b]);a.transformation=h}};d._setTransformDraped=function(a){if(0!==a.length){var {view:{basemapTerrain:{overlayManager:b},state:{contentPixelRatio:c}}}=this,{_position:f,_size:k}=this,q=e.copy(n.sv3d.get(),f);q[2]=F.DRAPED_Z;var g=K;g.spatialReference=b.renderer.spatialReference;g.x=q[0];g.y=
q[1];g=b.overlayPixelSizeInMapUnits(g)*c;g=Math.min(this._maxSize,k*g);l.fromTranslation(h,q);l.scale(h,h,[g,g,1]);for(const L of a)L.updateTransformation(M=>{l.copy(M,h)})}};d._quadGeometryData=function(a,b,c,f){return new H.Geometry(f,[[y.VertexAttribute.POSITION,new G.Attribute([0,0,0,...b,...a,...c],3,!0)]],[[y.VertexAttribute.POSITION,[0,1,2,1,2,3]]])};d._updateQuadMaterial=function(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters);this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)};
d._updateOutlineMaterial=function(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters);this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)};u._createClass(p,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(a){v.copy(this._color,a);this._updateQuadMaterial()}},
{key:"outlineColor",get:function(){return this._outlineColor},set:function(a){v.copy(this._outlineColor,a);this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(a){const b=0===this._outlineSize!==(0===a);this._outlineSize=a;b?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(a){a!==this._size&&(this._size=a,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},
set:function(a){this._outlineRenderOccluded=a;this._updateOutlineMaterial()}},{key:"geometry",set:function({previous:a,center:b,next:c}){this._maxSize=Math.min(e.distance(b,a),e.distance(b,c))/3;e.normalize(this._up,e.subtract(this._up,a,b));e.normalize(this._right,e.subtract(this._right,c,b));e.copy(this._position,b);this.recreateGeometry()}},{key:"_quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},
{key:"_outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}}]);return p}(r.EngineVisualElement);const h=D.create(),K=E.makeDehydratedPoint(0,0,void 0,null);t.RightAngleQuadVisualElement=r;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});