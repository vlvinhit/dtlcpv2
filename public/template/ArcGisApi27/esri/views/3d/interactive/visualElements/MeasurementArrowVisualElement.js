// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/analysisThemeUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/vectorStacks ./Object3DVisualElement ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),
function(w,x,p,q,C,h,D,E,F,G,y,r,k,t,H,I,J){t=function(z){function l(a){var b=z.call(this,a)||this;b._parameters={arrowWidth:16,arrowOutlineColor:p.toUnitRGBA(q.getAccentColor()),arrowStripeEvenColor:p.toUnitRGBA(q.getContrastColor()),arrowStripeOddColor:p.toUnitRGBA(q.getAccentColor()),arrowSubdivisions:128};b._origin=y.create();b._originTransform=F.create();b._arrowCenter=y.create();b._renderOccluded=I.RenderOccludedFlag.OccludeAndTransparent;b._geometry=null;b._stripeLength=1;b._stripesEnabled=
!0;b._opacity=1;b.applyProps(a);return b}x._inherits(l,z);var d=l.prototype;d.createExternalResources=function(){const {arrowStripeEvenColor:a,arrowStripeOddColor:b,arrowOutlineColor:e}=this._parameters;this._arrowMaterial=new J.MeasurementArrowMaterial({outlineColor:e,stripeEvenColor:this._stripesEnabled?a:b,stripeOddColor:b,renderOccluded:this.renderOccluded,polygonOffset:!0});this._handles=new C;this._handles.add(E.watch(()=>this.view.state.camera,()=>{this._viewChanged()}))};d.destroyExternalResources=
function(){this._arrowMaterial=null;this._handles=D.destroyMaybe(this._handles)};d.forEachExternalMaterial=function(a){a(this._arrowMaterial)};d.createGeometries=function(a){if(null!=this._geometry&&null!=this._geometry.startRenderSpace&&null!=this._geometry.endRenderSpace){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);b.transformation=this._originTransform;a.addGeometry(b);this._viewChanged()}};d._createArrowGeometry=function(a,
b,e,c){const m=this.view.renderCoordsHelper,n=[],A=[],v=(u,f)=>{const g=k.sv3d.get();G.subtract(g,u,e);n.push(g);A.push(f)};if("euclidean"===c.type)c.eval(.5,this._arrowCenter),c=k.sv3d.get(),m.worldUpAtPosition(this._arrowCenter,c),v(a,c),v(b,c);else for(c.eval(.5,this._arrowCenter),a=this._parameters.arrowSubdivisions+1&-2,b=0;b<a;++b){const u=b/(a-1),f=k.sv3d.get(),g=k.sv3d.get();c.eval(u,f);m.worldUpAtPosition(f,g);v(f,g)}return H.createPolylineGeometry(this._arrowMaterial,n,A)};d._geometryChanged=
function(){this.recreateGeometry()};d._viewChanged=function(){if(this.view.ready&&this.attached&&null!=this._geometry){const a=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*a})}};d._updateArrowOpacity=function(){var a=this.opacity;const {arrowStripeEvenColor:b,arrowStripeOddColor:e,arrowOutlineColor:c}=this._parameters,m=h.applyOpacity(B,this._stripesEnabled?b:e,a),n=h.applyOpacity(K,c,a);a=h.applyOpacity(L,
e,a);this._arrowMaterial.setParameters({stripeEvenColor:m,outlineColor:n,stripeOddColor:a})};x._createClass(l,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:a}))}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this._geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(a){this._stripeLength=
a;this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(a){this._stripesEnabled=a;if(this.attached){a=this.opacity;const {arrowStripeEvenColor:b,arrowStripeOddColor:e}=this._parameters;a=h.applyOpacity(B,this._stripesEnabled?b:e,a);this._arrowMaterial.setParameters({stripeEvenColor:a})}}},{key:"opacity",get:function(){return this._opacity},set:function(a){a!==this._opacity&&(this._opacity=
a,this._updateArrowOpacity())}}]);return l}(t.Object3DVisualElement);const B=r.create(),K=r.create(),L=r.create();w.MeasurementArrowVisualElement=t;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});