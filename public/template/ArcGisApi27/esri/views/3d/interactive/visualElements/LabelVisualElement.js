// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./VisualElement ../../../interactive/support/viewUtils ../../../overlay/LineOverlayItem ../../../overlay/TextOverlayItem".split(" "),function(u,C,x,J,K,m,e,L,v,y,M,N,O){function z(p,q,f,a){p.eval(q,A,D);L.add(E,A,D);f.projectToRenderScreen(A,F);f.projectToRenderScreen(E,
G);e.subtract(a,P,Q);e.normalize(a,a)}y=function(p){function q(a){var c=p.call(this,a.view)||this;c._handles=new J;c._textItem=null;c._calloutItem=null;c._showCallout=!0;c._showText=!0;c._geometry=null;c._text="-";c._fontSize=14;c._backgroundColor=new x([0,0,0,.6]);c._calloutColor=new x([0,0,0,.5]);c._textColor=new x([255,255,255]);c._distance=25;c._anchor="right";c.updatePositionOnCameraMove=!0;c.applyProps(a);return c}C._inherits(q,p);var f=q.prototype;f.overlaps=function(a){return this.attached?
this.textItem.visible&&a.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,a.textItem):!1};f.updateLabelPosition=function(){if(this.attached){this._showCallout=this._showText=!1;var {geometry:a,view:c,visible:g}=this;if(null!=a&&c._stage)switch(a.type){case "point":if(!this._computeLabelPositionFromPoint(a.point,k))break;if(a.callout){var h=this._camera;const l=a.callout.distance;e.add(d,d,[0,a.callout.offset]);h.renderToScreen(d,k);e.set(b,0,1);e.scale(b,b,l);e.add(b,b,d);h.renderToScreen(b,
r);this._showCallout=this._updatePosition(k,r)}else this._textItem.position=[k[0],k[1]],this._textItem.anchor="center";this._showText=!0;break;case "corner":if(!this._computeLabelPositionFromCorner(a,this._distance,k,r))break;this._showCallout=this._updatePosition(k,r);this._showText=!0;break;case "segment":this._computeLabelPositionFromSegment(a,this._distance,this._anchor,k,r)&&(this._showText=!0,h=this._updatePosition(k,r),this._showCallout=!1!==a.callout&&h,this._showCallout||(this._textItem.anchor=
"center"))}this.updateVisibility(g)}};f._computeLabelPositionFromPoint=function(a,c){const g=this._camera;g.projectToRenderScreen(a,d);if(0>d[2]||1<d[2])return!1;g.renderToScreen(d,c);return!0};f._computeLabelPositionFromCorner=function(a,c,g,h){if(!a)return!1;const l=this._camera;z(a.left,1,l,n);e.negate(n,n);z(a.right,0,l,H);e.add(b,n,H);e.negate(b,b);e.normalize(b,b);l.projectToRenderScreen(a.left.endRenderSpace,d);if(0>d[2]||1<d[2])return!1;l.renderToScreen(d,g);e.scale(b,b,c);e.add(b,b,d);l.renderToScreen(b,
h);return!0};f._computeLabelPositionFromSegment=function(a,c,g,h,l){if(!a)return!1;const B=a.segment,w=this._camera;M.renderScreenSpaceTangent(B.startRenderSpace,B.endRenderSpace,w,n);e.set(b,-n[1],n[0]);let t=!1;switch(g){case "top":t=0>b[1];break;case "bottom":t=0<b[1];break;case "left":t=0<b[0];break;case "right":t=0>b[0]}t&&e.negate(b,b);if(0===e.length(b))switch(g){case "top":b[1]=1;break;case "bottom":b[1]=-1;break;case "left":b[0]=-1;break;case "right":b[0]=1}B.eval(R[a.sampleLocation],I);
w.projectToRenderScreen(I,d);if(0>d[2]||1<d[2])return!1;w.renderToScreen(d,h);e.scale(b,b,c);e.add(b,b,d);w.renderToScreen(b,l);return!0};f._updatePosition=function(a,c){if(c){const g=c[0]-a[0],h=c[1]-a[1];this._textItem.position=[c[0],c[1]];this._textItem.anchor=Math.abs(g)>Math.abs(h)?0<g?"left":"right":0<h?"top":"bottom";this._calloutItem.startPosition=[a[0],a[1]];this._calloutItem.endPosition=[c[0],c[1]];return!0}this._textItem.position=[a[0],a[1]];this._textItem.anchor="center";return!1};f.createResources=
function(){this._textItem=new O({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor});this._calloutItem=new N({color:this._calloutColor.toRgba(),visible:!0,width:2});this.updateLabelPosition();this.view.overlay?.items.addMany([this._textItem,this._calloutItem]);this.updatePositionOnCameraMove&&this._handles.add(K.watch(()=>this.view.state.camera,()=>this.updateLabelPosition()))};f.destroyResources=function(){this.view.overlay&&!this.view.overlay.destroyed&&
this.view.overlay.items.removeMany([this._textItem,this._calloutItem]);this._handles.removeAll()};f.updateVisibility=function(a){this._textItem.visible=this._showText&&a;this._calloutItem.visible=this._showCallout&&a};C._createClass(q,[{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this.updateLabelPosition()}},{key:"textItem",get:function(){return this._textItem}},{key:"text",get:function(){return this._text},set:function(a){this._text=a;this.attached&&(this._textItem.text=
this._text)}},{key:"fontSize",get:function(){return this._fontSize},set:function(a){this._fontSize=a;this.attached&&(this._textItem.fontSize=this._fontSize)}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a;this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}},{key:"calloutColor",get:function(){return this._calloutColor},set:function(a){this._calloutColor=a;this.attached&&(this._calloutItem.color=this._calloutColor.toRgba())}},
{key:"textColor",get:function(){return this._textColor},set:function(a){this._textColor=a;this.attached&&(this._textItem.textColor=this._textColor)}},{key:"distance",get:function(){return this._distance},set:function(a){this._distance!==a&&(this._distance=a,this.updateLabelPosition())}},{key:"anchor",get:function(){return this._anchor},set:function(a){this._anchor!==a&&(this._anchor=a,this.updateLabelPosition())}},{key:"_camera",get:function(){return this.view.state.cssCamera}}]);return q}(y.VisualElement);
const A=v.create(),E=v.create(),D=v.create(),n=m.createRenderScreenPointArray(),H=m.createRenderScreenPointArray(),b=m.createRenderScreenPointArray(),I=v.create(),d=m.createRenderScreenPointArray3(),k=m.createScreenPointArray(),r=m.createScreenPointArray(),F=m.createRenderScreenPointArray3(),Q=F,G=m.createRenderScreenPointArray3(),P=G,R={start:0,center:.5,end:1};u.LabelVisualElement=y;u.mirrorPosition=function(p){switch(p){case "top":return"bottom";case "right":return"left";case "bottom":return"top";
case "left":return"right"}};u.screenSpaceTangent=z;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});