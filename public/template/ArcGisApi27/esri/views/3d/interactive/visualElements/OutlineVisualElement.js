// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ../../../../symbols/support/ElevationInfo ./EngineVisualElement ./LaserlineVisualElement ../../layers/graphics/ElevationContext ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Material ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(r,l,z,m,t,h,n,A,B,C,D,E,F,p,G,H,u,v,q,I,J,w){p=function(x){function k(a){var b=x.call(this,a)||this;b._attachmentOrigin=D.makeDehydratedPoint(0,0,0,null);b._attachmentOriginDirty=!0;b.events=new z;b._geometry=null;b._width=1;b._color=n.fromValues(1,0,1,1);b._innerWidth=0;b._innerColor=n.fromValues(1,1,1,1);b._stipplePattern=null;b._stippleOffColor=null;b._falloff=0;b._elevationInfo=null;b._laserlineStyle=null;b._laserlineEnabled=!1;b._renderOccluded=q.RenderOccludedFlag.OccludeAndTransparentStencil;
b._attachmentOrigin.spatialReference=a.view.spatialReference;b._laserline=new G.LaserlineVisualElement({view:a.view});b.applyProps(a);b.attached=a.attached??!0;return b}l._inherits(k,x);var e=k.prototype;e.destroy=function(){this._laserline.destroy();l._get(l._getPrototypeOf(k.prototype),"destroy",this).call(this)};e.createObject3DResourceFactory=function(a){return{view:a,createResources:b=>this._createObject3DResources(b),destroyResources:b=>this._destroyExternalResources(b),recreateGeometry:(b,
c)=>{b.geometries.length=0;this._recreateGeometry(c,b.material,b.geometries)}}};e.createDrapedResourceFactory=function(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:b=>this._destroyExternalResources(b),recreateGeometry:b=>{b.geometries=this._createRenderGeometriesDraped(b.material);this._attachmentOriginChanged()}}};e.onAttachedChange=function(a){this._laserline.attached=this._laserlineAttached;a&&this._attachmentOriginChanged()};e._updateMaterial=function(){null!=
this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters);null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)};e._recreateGeometry=function(a,b,c){this._createRenderGeometries(b,c);for(const d of c)a.addGeometry(d);this._attachmentOriginChanged()};e._attachmentOriginChanged=function(){this._attachmentOriginDirty=!0;this.events.emit("attachment-origin-changed")};e._destroyExternalResources=
function(a){a.geometries=[];a.material.dispose()};e._createObject3DResources=function(a){const b=new w.RibbonLineMaterial(this._materialParameters),c=[];this._recreateGeometry(a,b,c);return{material:b,geometries:c,forEach:d=>{d(b);c.forEach(d)}}};e._createDrapedResources=function(){const a=new w.RibbonLineMaterial(this._materialParameters),b=this._createRenderGeometriesDraped(a);return{material:a,geometries:b}};e._createRenderGeometriesDraped=function(a){const {geometry:b,view:c}=this,d=c.basemapTerrain.spatialReference;
return null==b||null==d?[]:v.geometryToRenderInfoDraped(b,d).lines.map(({position:f})=>new I.RenderGeometry(u.createGeometry(a,{overlayInfo:{spatialReference:d,renderCoordsHelper:c.renderCoordsHelper},attributeData:{position:f},removeDuplicateStartEnd:this._isClosed})))};e.calculateMapBounds=function(a){if(null==this.object3dResources.resources)return!1;const b=this.view.renderCoordsHelper;for(const c of this.object3dResources.resources.geometries){const d=c.vertexAttributes.get(J.VertexAttribute.POSITION),
f=C.newDoubleArray(d.data.length);A.projectBuffer(d.data,b.spatialReference,0,f,this.view.spatialReference,0,d.data.length/3);B.expandWithBuffer(a,f)}return!0};e._createRenderGeometries=function(a,b){var c=this.geometry;if(null!=c){c=v.geometryToRenderInfo(c,this.view.elevationProvider,this.view.renderCoordsHelper,H.ElevationContext.fromElevationInfo(this.elevationInfo??new F({mode:E.getGeometryEffectiveElevationMode(c,null)})));var d=[];for(const {position:f,mapPositions:K}of c.lines)b.push(u.createGeometry(a,
{mapPositions:K,attributeData:{position:f},removeDuplicateStartEnd:this._isClosed})),d.push(f);this._laserline.pathVerticalPlane=d}};l._createClass(k,[{key:"_laserlineAttached",get:function(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(a){a!==this._width&&(this._width=
a,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(a){h.exactEquals(a,this._color)||(h.copy(this._color,a),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=a,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(a){h.exactEquals(a,this._innerColor)||(h.copy(this._innerColor,a),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},
set:function(a){const b=null!=a!==(null!=this._stipplePattern);this._stipplePattern=a;b?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(a){a&&this._stippleOffColor&&h.exactEquals(a,this._stippleOffColor)||(this._stippleOffColor=a?n.clone(a):null,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(a){a!==this._falloff&&(this._falloff=a,this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},
set:function(a){this._elevationInfo=a;this.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;this._laserline.attached=this._laserlineAttached;null!=a&&(this._laserline.style=a)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this._laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},
set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const a=this.object3dResources.resources?.geometries;if(!a||0===a.length)return null;m.set(g,0,0,0);let b=0;for(const c of a)c.computeAttachmentOrigin(y)&&(m.add(g,g,y),b++);if(0===b)return null;m.scale(g,g,1/b);this.view.renderCoordsHelper.fromRenderCoords(g,this._attachmentOrigin);this._attachmentOriginDirty=
!1;return this._attachmentOrigin}},{key:"_isClosed",get:function(){return null!=this.geometry&&"polygon"===this.geometry.type}},{key:"_materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}},{key:"_normalizedRenderOccluded",
get:function(){return this.isDraped&&this._renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil?q.RenderOccludedFlag.OccludeAndTransparent:this._renderOccluded}}]);return k}(p.EngineVisualElement);const y=t.create(),g=t.create();r.OutlineVisualElement=p;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});