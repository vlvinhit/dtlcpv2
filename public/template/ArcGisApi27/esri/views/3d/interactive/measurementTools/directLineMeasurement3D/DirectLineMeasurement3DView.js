// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Color ../../../../../core/Accessor ../../../../../core/analysisThemeUtils ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/lineSegment ../../../analysis/interfaces ../../../analysis/DirectLineMeasurement/interfaces ../../Manipulator3D ../../manipulatorUtils ../../visualElements/LaserlineVisualElement".split(" "),
function(c,w,d,u,y,r,z,l,m,e,G,H,I,A,v,B,C,x,D,E,F){var n;(function(p){p.Manipulators="manipulators";p.AnalysisViewDestroyed="analysis-view-destroyed";p.AnalysisView="analysis-view"})(n||(n={}));c.DirectLineMeasurement3DView=function(p){function t(a){a=p.call(this,a)||this;a._params={laserLineGlowColor:u.toUnitRGB(r.getAccentColor(.75)),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:u.toUnitRGB(r.getContrastColor(.75)),laserLineInnerWidth:.75,laserLineGlobalAlpha:r.getOpacity(.75),
handleColor:u.toUnitRGBA(r.getAccentColor(.5)),handleRadius:5};a.cursorPoint=null;a._visible=!1;a._laserLine=null;a.laserLineEnabled=!0;a._handles=new z;a._lastDraggedHandle=null;return a}w._inherits(t,p);var k=t.prototype;k.initialize=function(){this._laserLine=new F.LaserlineVisualElement({view:this.view,attached:!0});this._updateVisibility(this._visible);this._connectToAnalysisView()};k.destroy=function(){this._handles=l.destroyMaybe(this._handles);this._laserLine=l.destroyMaybe(this._laserLine)};
k.createManipulators=function(){var a=()=>{const f=E.createSphereManipulator(this.view,this._params.handleColor);f.available=!1;f.radius=this._params.handleRadius;return f};const b=a(),g=a();a=new D.Manipulator3D({view:this.view});a.available=!1;a.interactive=!1;null!=this.analysis.startPoint&&(b.location=this.analysis.startPoint,b.available=!0);null!=this.analysis.endPoint&&(g.location=this.analysis.endPoint,g.available=!0);var h=()=>{let f=this._lastDraggedHandle;b.grabbing&&!g.grabbing&&(f="start");
g.grabbing&&!b.grabbing&&(f="end");b.grabbing||g.grabbing||(f=null);this._lastDraggedHandle=f};const q=b.events.on("grab-changed",h);h=g.events.on("grab-changed",h);this._handles.add([q,h],n.Manipulators);return{start:b,end:g,cursor:a}};k.show=function(){this.destroyed||this._visible||this._updateVisibility(!0)};k.hide=function(){!this.destroyed&&this._visible&&this._updateVisibility(!1)};k._connectToAnalysisView=function(){this._handles.remove(n.AnalysisView);this._handles.add([m.watch(()=>l.applySome(this.analysisViewData,
a=>a.destroyed),a=>{a&&this._handles.remove(n.AnalysisView)},m.initial),m.watch(()=>["measured"===this.toolState.lineState,this.analysisViewData],([a,b])=>{null==b||b.destroyed||(b.allowVisualElementsOrientationChange=!a)},m.initial),m.watch(()=>this._laserLineParams,a=>{const b=this._laserLine;b.heightManifoldTarget=a.heightManifoldTarget;b.pointDistanceLine=a.pointDistanceLine;b.lineVerticalPlaneSegment=a.lineVerticalPlaneSegment},m.initial)],n.AnalysisView)};k._updateVisibility=function(a){this.initialized&&
((this._visible=a)?this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}:this.view.cursor=null,this._laserLine.visible=a)};w._createClass(t,[{key:"visible",get:function(){return this._visible},set:function(a){a?this.show():this.hide()}},{key:"testData",get:function(){const a=
this._laserLine.testData,b=this.analysisViewData.testData;return{labels:b?.labels,stripeLength:b?.stripeLength,laserLineRenderer:{heightManifoldEnabled:null!=a?a.heightManifoldEnabled:!1,heightManifoldTarget:null!=a?a.heightManifoldTarget:null,pointDistanceEnabled:null!=a?a.pointDistanceEnabled:!1,pointDistanceOrigin:null!=a?a.pointDistanceOrigin:null,pointDistanceTarget:null!=a?a.pointDistanceTarget:null,lineVerticalPlaneEnabled:null!=a?a.lineVerticalPlaneEnabled:!1}}}},{key:"_cursorPosition",get:function(){const a=
v.create();l.applySome(this.cursorPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_startPosition",get:function(){const a=v.create();l.applySome(this.analysis.startPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_endPosition",get:function(){const a=v.create();l.applySome(this.analysis.endPoint,b=>this.view.renderCoordsHelper.toRenderCoords(b,a));return a}},{key:"_laserLineParams",get:function(){const a=this._focusPosition,{active:b,lineState:g}=
this.toolState,h=this.analysisViewData,q=this.laserLineEnabled&&!!a&&"measured"!==g&&b;if(!q||!this.visible||null==h||h.destroyed)return{heightManifoldTarget:null,pointDistanceLine:null,lineVerticalPlaneSegment:null};const f=h.actualVisualizedMeasurement;return{heightManifoldTarget:"euclidean"===f?a:null,pointDistanceLine:"local"!==this.view.viewingMode&&q&&this.analysis.startPoint&&"geodesic"===f?this._pointDistanceLine:null,lineVerticalPlaneSegment:q&&h.viewMode===x.ViewMode.Triangle?B.fromPoints(this._startPosition,
this._endPosition):null}}},{key:"_focusPosition",get:function(){const {lineState:a}=this.toolState;var b=this.analysisViewData;b=null!=b&&!b.destroyed&&b.measurementMode===C.MeasurementMode.Euclidean&&b.viewMode===x.ViewMode.Direct;switch(a){case "drawing":return b?this._startPosition:this.analysis.endPoint?this._endPosition:this._startPosition;case "editing":return b?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;
default:return null!=this.cursorPoint?this._cursorPosition:null}}},{key:"_pointDistanceLine",get:function(){return{origin:"drawing"===this.toolState.lineState||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition,target:this._focusPosition}}}]);return t}(y);d.__decorate([e.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"view",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_params",void 0);d.__decorate([e.property({constructOnly:!0})],
c.DirectLineMeasurement3DView.prototype,"analysis",void 0);d.__decorate([e.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"analysisViewData",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"cursorPoint",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"toolState",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"visible",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,
"testData",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_visible",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_laserLine",void 0);d.__decorate([e.property({constructOnly:!0})],c.DirectLineMeasurement3DView.prototype,"laserLineEnabled",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_cursorPosition",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_startPosition",null);d.__decorate([e.property()],
c.DirectLineMeasurement3DView.prototype,"_endPosition",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_lastDraggedHandle",void 0);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_laserLineParams",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_focusPosition",null);d.__decorate([e.property()],c.DirectLineMeasurement3DView.prototype,"_pointDistanceLine",null);c.DirectLineMeasurement3DView=d.__decorate([A.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],
c.DirectLineMeasurement3DView);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});