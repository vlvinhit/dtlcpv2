// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/HandleOwner ../../../../../../core/reactiveUtils ../../../../../../core/accessorSupport/decorators/property ../../../../../../core/accessorSupport/ensureType ../../../../../../core/arrayUtils ../../../../../../core/has ../../../../../../core/accessorSupport/decorators/subclass ../../../../../../layers/support/TileKey ../../../../layers/support/FeatureTileDescriptor3D ../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils".split(" "),
function(b,n,c,q,p,e,y,z,A,r,t,u,l){function v({lij:[h,f,k],extent:a}){return new t.TileKey(`${h}/${f}/${k}`,h,f,k,a)}b.FeatureServiceTiles3D=function(h){function f(a){a=h.call(this,a)||this;a.pointOfInterest=null;return a}n._inherits(f,h);var k=f.prototype;k.initialize=function(){this.handles.add(p.watch(()=>this.view.featureTiles,a=>{this.handles.remove("feature-tiles");a&&this.handles.add(a.addClient(),"feature-tiles")},p.initial))};k._filterTiles=function(a){return null==a?[]:a.filter(d=>50<Math.abs(d.measures.screenRect[3]-
d.measures.screenRect[1])&&d.measures.visibility===u.Visibility.VISIBLE_ON_SURFACE)};n._createClass(f,[{key:"tiles",get:function(){const a=this.tilesCoveringView,d=this._effectivePointOfInterest;if(null!=d){const m=a.map(g=>l.distanceToTile(d,g));for(let g=1;g<m.length;g++)if(m[g-1]>m[g])return a.sort((w,x)=>l.distanceToTile(d,w)-l.distanceToTile(d,x)),a.slice()}return a}},{key:"tilesCoveringView",get:function(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(v)}},{key:"tileInfo",
get:function(){return this.view.featureTiles?.tilingScheme.toTileInfo()??null}},{key:"tileSize",get:function(){return this.view.featureTiles?.tileSize??256}},{key:"_effectivePointOfInterest",get:function(){const a=this.pointOfInterest;return null!=a?a:this.view.pointsOfInterest?.focus.location}}]);return f}(q.HandleOwner);c.__decorate([e.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tiles",null);c.__decorate([e.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tilesCoveringView",
null);c.__decorate([e.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tileInfo",null);c.__decorate([e.property({readOnly:!0})],b.FeatureServiceTiles3D.prototype,"tileSize",null);c.__decorate([e.property({constructOnly:!0})],b.FeatureServiceTiles3D.prototype,"view",void 0);c.__decorate([e.property()],b.FeatureServiceTiles3D.prototype,"pointOfInterest",void 0);c.__decorate([e.property()],b.FeatureServiceTiles3D.prototype,"_effectivePointOfInterest",null);b.FeatureServiceTiles3D=c.__decorate([r.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],
b.FeatureServiceTiles3D);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});