// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec4f64 ../../../geometry/support/vectorStacks ../../../layers/graphics/hydratedFeatures ./Manipulator3D ./RenderObject ../layers/graphics/graphicUtils ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Material ../webgl-engine/lib/VertexAttribute ../webgl-engine/materials/ColorMaterial ../webgl-engine/materials/ImageMaterial ../webgl-engine/materials/NativeLineMaterial ../webgl-engine/materials/RibbonLineMaterial ../webgl-engine/materials/ShadedColorMaterial ../../interactive/interfaces".split(" "),
function(f,J,k,y,h,K,z,m,L,A,w,M,x,n,p,B,N,O,P,Q,l){function C(a,b=n.RenderOccludedFlag.OccludeAndTransparent,c=!0){const d=y.fromValues(a[0],a[1],a[2],3<a.length?a[3]:1);a=1>a[3];const e=!a;return c?new Q.ShadedColorMaterial({color:d,transparent:a,writeDepth:e,cullFace:w.CullFaceOptions.Back,renderOccluded:b}):new B.ColorMaterial({color:d,transparent:a,writeDepth:e,cullFace:w.CullFaceOptions.Back,renderOccluded:b})}function D(a,b){const c=b.material??new N.ImageMaterial({transparent:!0,writeDepth:!1,
textureId:b.texture?.id,renderOccluded:n.RenderOccludedFlag.Opaque}),d=b.focusMultiplier??q.focusMultiplier,e=b.calloutLength??q.calloutLength,r=q.discRadius*(b.discScale??1),E=r*d,G=(g,R)=>{const F=[0,1,2,2,3,0];return new M.Geometry(R,[[p.VertexAttribute.POSITION,new A.Attribute([e-g,-g,0,e+g,-g,0,e+g,g,0,e-g,g,0],3,!0)],[p.VertexAttribute.UV0,new A.Attribute([0,0,1,0,1,1,0,1],2,!0)]],[[p.VertexAttribute.POSITION,F],[p.VertexAttribute.UV0,F]])};var t=b.calloutWidth??q.calloutWidth,u=new (1<t?P.RibbonLineMaterial:
O.NativeLineMaterial)({width:t,color:b.calloutColor,renderOccluded:n.RenderOccludedFlag.OccludeAndTransparent});t=x.createPolylineGeometry(u,[[0,0,0],[e-r,0,0]]);u=x.createPolylineGeometry(u,[[0,0,0],[e-E,0,0]]);const v=b.customStateMask??l.ManipulatorStateCustomFlags.None;a.collisionType={type:"disc",direction:[0,0,1],offset:[e,0,0]};a.focusMultiplier=d;a.metadata=b.metadata;a.radius=r;a.renderObjects=[new m.RenderObject(G(r,c),l.ManipulatorStateFlags.Unfocused|v),new m.RenderObject(t,l.ManipulatorStateFlags.Unfocused|
v),new m.RenderObject(G(E,c),l.ManipulatorStateFlags.Focused|v),new m.RenderObject(u,l.ManipulatorStateFlags.Focused|v)]}function H(a,b,c,d){a=k.normalize(h.sv3d.get(),a);b=k.normalize(h.sv3d.get(),b);const e=k.cross(h.sv3d.get(),a,b);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=0;d[4]=b[0];d[5]=b[1];d[6]=b[2];d[7]=0;d[8]=e[0];d[9]=e[1];d[10]=e[2];d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d}function I(a,b){const c=a.getViewForGraphic(b);return null!=c&&"computeAttachmentOrigin"in c?c.computeAttachmentOrigin(b,
a.spatialReference):null}const q=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),S=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});f.calculateInputRotationTransform=function(a,b,c,d){a=k.subtract(h.sv3d.get(),a,c);d=k.cross(h.sv3d.get(),d,a);c=H(a,d,c,h.sm4d.get());J.invert(c,c);b=k.transformMat4(h.sv3d.get(),b,c);return Math.atan2(b[1],b[0])};f.calculateTranslateRotateFromBases=H;f.createManipulatorMaterial=C;f.createManipulatorOutlineMaterial=function(a,
b=n.RenderOccludedFlag.OccludeAndTransparent){a=y.fromValues(a[0],a[1],a[2],4===a.length?a[3]:1);return new B.ColorMaterial({color:a,transparent:!0,writeDepth:!0,cullFace:w.CullFaceOptions.Front,renderOccluded:b})};f.createRotateManipulator=function(a,b){a=new z.Manipulator3D({view:a,autoScaleRenderObjects:!1,collisionPriority:1,metadata:b.metadata});D(a,b);return a};f.createSphereManipulator=function(a,b,c=l.ManipulatorStateCustomFlags.None){b=C(b);c=[new m.RenderObject(x.createSphereGeometry(b,
1,32,32),c)];return new z.Manipulator3D({view:a,renderObjects:c})};f.getGraphicAttachmentOrigin=I;f.placeAtGraphic=function(a,b,c){a=I(a,c);null!=a?b.elevationAlignedLocation=a:(c=c.geometry,null!=c&&(c="mesh"===c.type?c.anchor:L.computeCentroid(c),null!=c&&(b.location=K.hydrateGeometry(c))))};f.updateRotateManipulator=D;f.worldScaledManipulatorSettings=S;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});