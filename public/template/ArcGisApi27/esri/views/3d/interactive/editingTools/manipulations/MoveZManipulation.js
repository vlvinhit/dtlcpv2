// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/Evented ../../../../../core/mathUtils ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces ../../../../support/colorUtils".split(" "),
function(B,C,M,N,O,y,P,n,t,Q,w,p,R,D,E,z,A,S,F,G,H,q,T){A=function(I){function x(a){var b=I.call(this)||this;b._radius=z.DISC_RADIUS;b.events=new N;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulator();b.forEachManipulator(k=>b._tool.manipulators.add(k));return b}C._inherits(x,I);var u=x.prototype;u.destroy=function(){this._manipulator.applyObjectTransform=U;this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()})};u.forEachManipulator=function(a){a(this._manipulator,
D.ManipulatorType.TRANSLATE_Z)};u.createGraphicDragPipeline=function(a,b,k){const d=b.graphic.geometry.spatialReference;return S.createGraphicMoveDragPipeline(b,k,f=>this.createDragPipeline((c,l,m,e,g)=>{({steps:l,cancel:m}=a(c,l,m,e,g));return f(c,l,m)},d),this._view.state.viewingMode)};u.createDragPipeline=function(a,b){const k=this._view;return H.createManipulatorDragEventPipeline(this._manipulator,(d,f,c,l,m)=>{f=f.next(e=>({...e,manipulatorType:D.ManipulatorType.TRANSLATE_Z})).next(R.screenToZConstrained(k,
d.renderLocation,b)).next(H.addScreenDelta());a(d,f,c,l,m)})};u._updateManipulator=function(){var a=this._radius/z.DISC_RADIUS;const b=E.getSettings(this._view),k=b.zManipulator.height*a;var d=b.zManipulator.coneHeight*a;const f=b.zManipulator.coneWidth*a;a*=b.zManipulator.width;var c=[t.fromValues(0,0,0),t.fromValues(0,0,k)];const l=[t.fromValues(0,0,0),t.fromValues(0,0,k+d)],m=(r=>{const h=P.create();y.translate(h,h,[0,0,k]);y.rotateX(h,h,Math.PI/2);r&&(r=1+2*r/f,y.scale(h,h,[r,r,r]));return h})(0);
var e=(r,h)=>{h=T.darken(b.zManipulator.color,h);h.a*=r;return M.toUnitRGBA(h)};const g=w.createManipulatorMaterial(e(1,.25),G.RenderOccludedFlag.Occlude),J=w.createManipulatorMaterial(e(1,0),G.RenderOccludedFlag.Occlude),K=w.createManipulatorMaterial(e(.7,0),b.zManipulator.renderOccluded);e=w.createManipulatorMaterial(e(.85,0),b.zManipulator.renderOccluded);c=F.createTubeGeometry(g,c,a/2,16,!1);d=F.createConeGeometry(g,d,f/2,16,!1);d.transformation=m;this._manipulator.renderObjects=[new p.RenderObject(d,
q.ManipulatorStateFlags.Unfocused),new p.RenderObject(c,q.ManipulatorStateFlags.Unfocused),new p.RenderObject(d.instantiate({material:J}),q.ManipulatorStateFlags.Focused),new p.RenderObject(c.instantiate({material:J}),q.ManipulatorStateFlags.Focused),new p.RenderObject(d.instantiate({material:K}),q.ManipulatorStateFlags.Unfocused),new p.RenderObject(c.instantiate({material:K}),q.ManipulatorStateFlags.Unfocused),new p.RenderObject(d.instantiate({material:e}),q.ManipulatorStateFlags.Focused),new p.RenderObject(c.instantiate({material:e}),
q.ManipulatorStateFlags.Focused)];this._manipulator.radius=a/2+2;this._manipulator.collisionType={type:"line",paths:[l]}};u._createManipulator=function(){const a=this._view,b=E.getSettings(a),k=new Q.Manipulator3D({view:a,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});k.applyObjectTransform=d=>{var f=a.state.camera,c=L;a.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,c);
const l=n.dist(f.eye,c),m=f.computeRenderPixelSizeAtDist(l);var e=n.subtract(v,c,f.eye);n.normalize(e,e);var g=V;a.renderCoordsHelper.worldUpAtPosition(L,g);c=Math.abs(n.dot(e,g));e=n.cross(v,e,g);g=n.cross(v,e,g);c=O.clamp(c,.01,1);f=1-Math.sqrt(1-c*c)/c/f.fullWidth;c=this._radius/z.DISC_RADIUS*b.zManipulator.width;n.scale(g,n.normalize(g,g),(1/f-1)*l+m*c);d[12]-=v[0];d[13]-=v[1];d[14]-=v[2]};this._manipulator=k;this._updateManipulator()};C._createClass(x,[{key:"radius",get:function(){return this._radius},
set:function(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]);return x}(A.Manipulation);const L=t.create(),v=t.create(),V=t.create(),U=()=>{};B.MoveZManipulation=A;Object.defineProperty(B,Symbol.toStringTag,{value:"Module"})});