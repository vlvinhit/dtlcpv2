// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../geometry ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/quantityUtils ../../../../../core/reactiveUtils ../../../../../core/unitUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/Polyline ../../../../../geometry/support/coordsUtils ../../../../../geometry/support/plane ../../../../../geometry/support/vectorStacks ../../../../../layers/graphics/dehydratedFeatures ../../../../../support/elevationInfoUtils ../../../../../symbols/support/utils ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../../SegmentLabels3D ../../SnappingVisualizer3D ../dragEventPipeline3D ../ManipulatorType ../manipulatorUtils ../settings ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ../manipulations/moveUtils ../manipulations/MoveXYGraphicManipulation ./edgeOffsetUtils ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/GeometryUtil ../../../../input/IViewEvents ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/editGeometry/interfaces ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep ../../../../interactive/tooltip/ReshapeTooltipInfos ../../../../interactive/tooltip/Tooltip ../../../../interactive/tooltip/TranslateTooltipInfos ../../../../support/automaticAreaMeasurementUtils ../../../../support/automaticLengthMeasurementUtils ../../../../support/colorUtils ../../../../support/euclideanLengthMeasurementUtils ../../../../support/geodesicLengthMeasurementUtils ../../../../../geometry/SpatialReference".split(" "),
function(q,da,r,Ka,pa,La,qa,ra,sa,P,y,J,H,ta,t,Ma,ua,va,K,ea,wa,xa,ya,za,fa,Q,ha,Y,E,z,Aa,ia,V,ja,Z,R,Ba,Ca,u,aa,Da,L,ka,Ea,M,la,A,n,Fa,ba,ma,na,oa,Ga,N,Ha,S,F,ca,Ia,Ja){q.ReshapeOperation=function(v){function W(a){var b=v.call(this,a)||this;b._selectedIndex=0;b._manipulatorHandles=new sa;b._manipulatorInfos=[];b._numGrabbing=0;b._numDragging=0;b._reshapeEventState=p.NONE;b._recreatingManipulators=!1;b.outputGeometry=null;b._vertexLaserLineVisualElement=null;a=R.getSettings(a.tool.view).manipulators;
var c=a.vertex;b._vertexManipulatorMaterial=E.createManipulatorMaterial(F.unitRGBAFromColor(c.color),c.renderOccluded);b._vertexManipulatorOutlineMaterial=E.createManipulatorOutlineMaterial(F.unitRGBAFromColor(c.outlineColor),c.renderOccluded);b._vertexManipulatorHoverOutlineMaterial=E.createManipulatorOutlineMaterial(F.unitRGBAFromColor(c.hoverOutlineColor),c.renderOccluded);c=a.edge;b._edgeManipulatorMaterial=E.createManipulatorMaterial(F.unitRGBAFromColor(c.color),c.renderOccluded);b._edgeManipulatorOutlineMaterial=
E.createManipulatorOutlineMaterial(F.unitRGBAFromColor(c.outlineColor),c.renderOccluded);c=a.edgeOffset;b._edgeOffsetManipulatorMaterial=E.createManipulatorMaterial(F.unitRGBAFromColor(c.color),c.renderOccluded,!1);b._edgeOffsetManipulatorHoverMaterial=E.createManipulatorMaterial(F.unitRGBAFromColor(c.hoverColor),c.renderOccluded,!1);a=a.selected;b._selectedManipulatorMaterial=E.createManipulatorMaterial(F.unitRGBAFromColor(a.color),a.renderOccluded);b._selectedManipulatorOutlineMaterial=E.createManipulatorOutlineMaterial(F.unitRGBAFromColor(a.outlineColor),
a.renderOccluded);b._selectedManipulatorHoverOutlineMaterial=E.createManipulatorOutlineMaterial(F.unitRGBAFromColor(a.hoverOutlineColor),a.renderOccluded);return b}da._inherits(W,v);var h=W.prototype;h.initialize=function(){const {graphic:a,view:b}=this,c=this._graphicState=new Ea.GraphicState({graphic:a});this._tooltip=new Ga.Tooltip({view:b});this.addHandles([H.watch(()=>c.displaying,d=>{for(const e of this._manipulatorInfos)e.manipulator.available=d}),H.watch(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,
edgeOffsetEnabled:this.enableEdgeOffset}),({labels:d,enabled:e,edgeOffsetEnabled:f})=>{null!=d&&(d.visible=e,d.edgeDistance=f?"far":"default")},H.initial),H.when(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),H.initial),this.view.trackGraphicState(c)])};h.destroy=function(){this._segmentLabels=y.destroyMaybe(this._segmentLabels);this._tooltip=y.destroyMaybe(this._tooltip);this._removeManipulators()};h.removeSelectedVertices=function(){const a=this._manipulatorInfos.filter(b=>b.manipulator.selected&&
"vertex"===b.type);this._removeVertices(a)};h.onManipulatorSelectionChanged=function(){this.emit("manipulators-changed")};h._removeManipulators=function(){this._manipulatorHandles.removeAll();this._moveManipulation=y.destroyMaybe(this._moveManipulation);this._graphicMoveManipulation=y.destroyMaybe(this._graphicMoveManipulation);this.manipulators.removeAll();this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0};h._createManipulators=function(a){if(null!=this._editGeometryOperations){var b=
Q.getGraphicEffectiveElevationInfo(this.graphic);for(const c of this._editGeometryOperations.data.components){const d=a?.byComponentIndex.get(c.index);for(const e of c.vertices){const f=d?.has(e.index);this._createVertexOrEdgeManipulator(e,b,f)}for(const e of c.edges)this._createVertexOrEdgeManipulator(e,b)}this._createGraphicMoveManipulation();this._createMoveManipulation(b);this._createVisualElements()}};h.redo=function(){if(null==this._editGeometryOperations)return null;const a=this._editGeometryOperations.redo();
null!=a&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());return a};h.undo=function(){if(null==this._editGeometryOperations)return null;this.emit("undo");const a=this._editGeometryOperations.undo();null!=a&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators());return a};h._recreateManipulators=function(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),
this._createManipulators(),this._recreatingManipulators=!1)};h._recreateEditGeometryAndManipulators=function(a){const b={byComponentIndex:new Map};if(null!=a&&null!=this.inputGeometry&&xa.hasCompatibleTopology(a,this.inputGeometry))for(const c of this._manipulatorInfos)if("vertex"===c.type&&c.manipulator.selected){const {index:d,component:{index:e}}=c.handle,{byComponentIndex:f}=b,g=f.get(e)||new Set;g.add(d);f.set(e,g)}this._recreatingManipulators=!0;this._removeManipulators();this._tooltip.clear();
this._editGeometryOperations=y.destroyMaybe(this._editGeometryOperations);this._segmentLabels=y.destroyMaybe(this._segmentLabels);null!=a&&(this._editGeometryOperations=Fa.EditGeometryOperations.fromGeometry("mesh"===a.type?a.anchor:a,this.view.state.viewingMode),this._createManipulators(b),this._segmentLabels=new Aa.SegmentLabels3D({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:Q.getGraphicEffectiveElevationInfo(this.graphic),labelOptions:this._labelOptions,
graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}));this._recreatingManipulators=!1};h._perGraphicManipulatorDragAction=function(a,b){if("end"===b.action)return b;let c=0;const d=[],e=this._manipulatorInfos.some(f=>"vertex"===f.type&&f.manipulator.selected);a=a===O.SELECTED_OR_ALL&&e;for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.grabbing||a&&!f.manipulator.selected||d.push(f),c++);if(0===d.length)return b;this._moveVertices(d,b);if(d.length===
c){this._updateEventState(p.MOVING);if(this.destroyed)return b;this.emit("move",{type:"move",dx:b.screenDeltaX,dy:b.screenDeltaY,mover:this.graphic})}else{this._updateEventState(p.RESHAPING);if(this.destroyed)return b;this.emit("reshape",{type:"reshape",mover:this.graphic})}return b};h._isMultiVertexSelection=function(){return 1<this._manipulatorInfos.reduce((a,b)=>"vertex"===b.type&&b.manipulator.selected?a+1:a,0)};h._perVertexManipulatorDragAction=function(a){this._updateEventState(p.RESHAPING);
if(!this.destroyed){var {mapDeltaX:b,mapDeltaY:c,mapDeltaZ:d}=a;if(b||c||d){var e=[];for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.selected&&!f.manipulator.grabbing||f===a.info)&&e.push(f);this._moveVertices(e,a,ba.AccumulationBehaviour.ACCUMULATE_STEPS);this.emit("reshape",{type:"reshape",mover:this.graphic})}}};h._updateEventState=function(a){if(a===this._reshapeEventState)return!1;switch(a){case p.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case p.MOVING:this.emit("move",
{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case p.MOVING:switch(this._reshapeEventState){case p.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case p.RESHAPING:switch(this._reshapeEventState){case p.NONE:this.emit("reshape",
{type:"reshape-start",mover:this.graphic});break;case p.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const b=this._reshapeEventState!==a;this._reshapeEventState=a;return b};h._createGraphicMoveManipulation=function(){const {tool:a,view:b}=this;this._graphicMoveManipulation=new Da.MoveXYGraphicManipulation({tool:a,view:b,graphicState:this._graphicState});if(this.enableMoveGraphic){let c=
null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((d,e,f)=>{e.next(g=>this._trackNumDragging(g)).next(g=>{"start"===g.action&&(c=this._editGeometryOperations.createUndoGroup());return g}).next(g=>this._perGraphicManipulatorDragAction(O.ALL,g)).next(g=>{this._updateTranslateGraphicTooltip(u.ManipulationType.XY,g);return g}).next(g=>{"end"===g.action&&(this._tooltip.clear(),c=y.removeMaybe(c))});f.next(()=>this._onDragCancel(!0,()=>c=y.removeMaybe(c)))}));this._graphicMoveManipulation.forEachManipulator(d=>
this._manipulatorHandles.add(this._watchAndUpdateGrabState(d,!1)))}else this._graphicMoveManipulation.forEachManipulator(c=>{c.grabbable=!1;c.cursor=null});this._graphicMoveManipulation.forEachManipulator(c=>this._manipulatorHandles.add(c.events.on("immediate-click",d=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...d,graphic:this.graphic});d.stopPropagation()})))};h._createMoveManipulation=function(a){const {graphic:b,handles:c,tool:d,
view:e}=this,f=this._graphicState;this._moveManipulation=new u.MoveManipulation({tool:d,view:e,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Z.canMoveZ(b),snapToScene:!1,radius:u.MoveManipulation.radiusForSymbol(b.symbol)});this._moveManipulation.forEachManipulator(k=>c.add([k.events.on("immediate-click",l=>{this._moveManipulation.zManipulation.hasManipulator(k)||this._manipulatorInfos.some(m=>m.manipulator.selected)||this.emit("immediate-click",{...l,graphic:b});l.stopPropagation()}),
this._watchAndUpdateGrabState(k,!1)]));const g=k=>l=>{c.add(l.events.on("focus-changed",({action:m})=>{"focus"===m&&this._tooltipOptions.enabled?this._updateTranslateTooltip(k):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(g(u.ManipulationType.XY));this._moveManipulation.xyAxisManipulation.forEachManipulator(g(u.ManipulationType.XY_AXIS));this._moveManipulation.zManipulation.forEachManipulator(g(u.ManipulationType.Z));this._moveManipulation.elevationInfo={mode:"absolute-height",
offset:0};c.add([this._moveManipulation.createDragPipeline((k,l,m,B,C)=>{const {snappingStep:I,cancelSnapping:D}=na.createSnapDragEventPipelineStep({predicate:w=>!!w.info,snappingManager:d.snappingManager,snappingContext:new ma.SnappingContext({editGeometryOperations:this._editGeometryOperations,elevationInfo:a,pointer:C,excludeFeature:b,visualizer:new ia.SnappingVisualizer3D}),updatingHandles:this.updatingHandles,useZ:!1});B=B.next(w=>{this._onDragCancel();return w}).next(D);m=m.next(w=>this._trackNumDragging(w)).next(w=>
{const x=this._manipulatorInfos.filter(T=>"vertex"===T.type&&T.manipulator.selected);return w.manipulatorType===ja.ManipulatorType.TRANSLATE_XY&&1===x.length?{...w,info:x[0],snapOrigin:x[0].handle.pos}:w}).next(A.sceneSnappingAtLocation(this.view,a,b)).next(...I).next(A.addMapDelta()).next(w=>this._perGraphicManipulatorDragAction(O.SELECTED_OR_ALL,w)).next(w=>{this._updateTranslateTooltip(k,w);return w});return{steps:m,cancel:B}},a,b.geometry.spatialReference,b),H.watch(()=>f.displaying,()=>this._updateMoveManipulationPosition(),
H.initial),f.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),H.watch(()=>f.isDraped,k=>{this._updateMoveManipulationPosition();k?c.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),"align-move-manipulation"):c.remove("align-move-manipulation")},H.initial)])};h._createVisualElements=function(){const {graphic:a,view:b}=this,c=Ba.createVisualElements({view:b,graphic:a,forEachManipulator:d=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(d);
this._moveManipulation.forEachManipulator(d);for(const e of this._manipulatorInfos)d(e.manipulator,ja.ManipulatorType.TRANSLATE_XY)}},onManipulatorsChanged:d=>this.on("manipulators-changed",d)});null!=c&&(this._outlineVisualElement=c.visualElement instanceof ka.OutlineVisualElement?c.visualElement:null);null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}));
this._manipulatorHandles.add(c)};h._createEdgeOffsetManipulator=function(a,b=Q.getGraphicEffectiveElevationInfo(this.graphic)){var c=R.getSettings(this.view).manipulators.edgeOffset,d=c.size/2,e=d+c.collisionPadding;d/=e;const f=d*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=M.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,f,d/2,d/2,c.height,c.offset));null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=
M.createExtrudedTriangle(this._edgeOffsetManipulatorMaterial,-f,d/2,d/2,c.height,-c.offset));d=[new z.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate(),n.ManipulatorStateFlags.Unfocused),new z.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),n.ManipulatorStateFlags.Focused),new z.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate(),n.ManipulatorStateFlags.Unfocused),new z.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),
n.ManipulatorStateFlags.Focused)];e=new Y.Manipulator3D({view:this.view,renderObjects:d,elevationInfo:"on-the-ground"!==b.mode||ha.isVolumetricSymbol(this.graphic.symbol)?{mode:"absolute-height",offset:0}:b,worldOriented:!1,focusMultiplier:1,radius:e,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:ea.fromValues(0,0,1)},collisionPriority:1,metadata:{deleting:!1}});d=new Y.Manipulator3D({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||
!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}});const g={manipulator:e,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,elevationInfo:b,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(g,c.minSquaredEdgeLength);this._updateEdgeOffsetManipulator(g);a=[];for(var k of[g.handle.leftVertex,g.handle.rightVertex])c=this._getManipulatorInfoFromHandle(k),null!=c&&a.push(c.manipulator.events.on("location-update",
()=>this._updateEdgeOffsetManipulator(g)));g.locationUpdateHandle=P.handlesGroup(a);this._manipulatorHandles.add(g.locationUpdateHandle,e);this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!0),this._watchAndUpdateGrabState(d,!0)],e);this._manipulatorHandles.add(A.createManipulatorDragEventPipeline(e,this._createEdgeOffsetPipeline(g,b)),e);this._manipulatorHandles.add(A.createManipulatorDragEventPipeline(d,(l,m,B,C)=>{if("touch"===C)this._createEdgeOffsetPipeline(g,b)(l,m,B);else if(this.enableMoveGraphic){C=
this.graphic;const I=null!=C.geometry?C.geometry.spatialReference:null;m.next(D=>this._trackNumDragging(D)).next(A.dragAtLocation(this.view,l.elevationAlignedLocation)).next(V.screenToMapXYAtLocation(this.view,l.elevationAlignedLocation,b,I,C)).next(A.addScreenDelta()).next(A.addMapDelta()).next(D=>this._perGraphicManipulatorDragAction(O.ALL,D)).next(D=>{this._updateTranslateGraphicTooltip(u.ManipulationType.XY,D);return D}).next(D=>{"end"===D.action&&this._tooltip.clear()});B.next(()=>this._onDragCancel(!l.metadata.deleting))}}),
e);k=l=>{this._manipulatorInfos.some(m=>m.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...l,graphic:this.graphic});l.stopPropagation()};this._manipulatorHandles.add([e.events.on("immediate-click",k),d.events.on("immediate-click",k),e.events.on("focus-changed",({action:l})=>{const m=this._tooltipOptions;"focus"===l&&m.enabled?(l=this._tooltip.info=new oa.ReshapeEdgeOffsetTooltipInfo({tooltipOptions:m}),this._updateTooltipAreaOrTotalLength(l)):this._tooltip.clear()})],e);
this._manipulatorInfos.push(g);this.manipulators.add(e);this.manipulators.add(d);this.emit("manipulators-changed");return g};h._autoHideEdgeOffsetManipulator=function(a,b){const c=a.manipulator,d=a.edgeManipulator,e=()=>{a.visibilityHandle=y.removeMaybe(a.visibilityHandle);var f=this._getManipulatorInfoFromHandle(a.handle.leftVertex);const g=this._getManipulatorInfoFromHandle(a.handle.rightVertex);f=null!=f&&null!=g&&L.screenEdgeLengthSquared(f.manipulator.renderLocation,g.manipulator.renderLocation,
this.view.state.camera)<b;if(!c.focused&&!d.focused||f)c.grabbable=!f,d.grabbable=!f,a.visibilityHandle=P.handlesGroup([c.disableDisplay(),{remove:()=>{c.grabbable=!0;d.grabbable=this.enableMoveGraphic}}])};this._manipulatorHandles.add([c.events.on("focus-changed",e),d.events.on("focus-changed",e),{remove:()=>{y.removeMaybe(a.visibilityHandle);d.metadata.deleting=!0;this.manipulators.remove(d)}}],c);e()};h._updateEdgeOffsetManipulator=function(a){this._updateManipulatorPosition(a);var {coordinateHelper:b}=
this._editGeometryOperations.data;b=L.createEdgeOffsetIntersectionPlane(this.view,a.manipulator.elevationAlignedLocation,L.createEdgeOffsetOperation(b,a.handle,a.manipulator.elevationInfo));var c=this._getManipulatorInfoFromHandle(a.handle.leftVertex),d=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=c&&null!=d&&(c=c.manipulator.renderLocation,d=d.manipulator.renderLocation,b=null!=b?L.edgeOffsetRotationMatrix(b,c,d):va.IDENTITY,a.manipulator.modelTransform=b,a.edgeManipulator.elevationAlignedLocation=
a.manipulator.elevationAlignedLocation,a.edgeManipulator.modelTransform=b,b=K.length(K.subtract(X,c,d))/2,a.edgeManipulator.collisionType={type:"line",paths:[[[-b,0,0],[b,0,0]]]})};h._createEdgeOffsetPipeline=function(a,b){return(c,d,e)=>{this._clearSelection();const {step:f,cleanup:g}=this._initializeEdgeOffset(a,b);d.next(k=>this._trackNumDragging(k)).next(A.dragAtLocation(this.view,c.elevationAlignedLocation)).next(f).next(V.screenToRenderPlaneFromEvent(this.view)).next(V.convertToMapCoordinates(this.view,
this._editGeometryOperations.data.spatialReference)).next(A.addMapDelta()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(a)).next(this._showEdgeOffsetTooltip()).next(k=>{"end"===k.action&&g()});e.next(()=>{c.metadata.deleting||(g(),this._onDragCancel())})}};h._initializeEdgeOffset=function(a,b){var {view:c}=this;const d=this._editGeometryOperations,e=L.createEdgeOffsetOperation(d.data.coordinateHelper,a.handle,b);b=d.createUndoGroup();const f=L.createEdgeOffsetIntersectionPlane(c,
a.manipulator.elevationAlignedLocation,e);if(e.requiresSplitEdgeLeft){var g=this._getManipulatorInfoFromHandle(a.handle.leftVertex.leftEdge);null!=g&&this._splitEdgeManipulator(g,1)}e.requiresSplitEdgeRight&&(g=this._getManipulatorInfoFromHandle(a.handle.rightVertex.rightEdge),null!=g&&this._splitEdgeManipulator(g,0));const k=()=>new wa({paths:[[a.handle.leftVertex.pos,a.handle.rightVertex.pos]],spatialReference:d.data.spatialReference});g=R.getSettings(c);const l=new ka.OutlineVisualElement({view:c,
isDraped:this._graphicState.isDraped,geometry:k(),elevationInfo:a.elevationInfo,width:g.visualElements.lineGraphics.outline.width,color:F.unitRGBAFromColor(g.colors.accent),attached:!0});let m;const B=()=>{this._cleanEdgeOffsetCollapsedEdges(a);m=y.removeMaybe(m)};c=this.on("undo",B);m=P.handlesGroup([P.destroyHandle(l),H.watch(()=>this._graphicState.isDraped,C=>l.isDraped=C),this._graphicState.on("changed",()=>l.geometry=k()),b,c]);return{step:C=>null==e||null==f?(B(),null):{...C,operation:e,plane:f},
cleanup:B}};h._applyEdgeOffsetStep=function(a){return b=>{if(this.destroyed||null==b.operation)return b;this._updateEventState(p.RESHAPING);const {mapDeltaX:c,mapDeltaY:d,mapDeltaZ:e}=b;if(c||d||e)this._offsetEdge(a,b),this.emit("reshape",{type:"reshape",mover:this.graphic});return b}};h._applyComputeEdgeOffsetDistanceStep=function(){return a=>{const {operation:b,mapEnd:c}=a;if(null==b||null==c)return a;"start"===a.action&&b.selectArrowFromStartPoint(c);return{...a,signedDistance:b.signedDistanceToPoint(c)}}};
h._showEdgeOffsetTooltip=function(){return a=>{const {mapEnd:b,signedDistance:c,operation:d}=a;var e=this._tooltip,f=this._tooltipOptions;if(!f.enabled||null==c)return e.clear(),a;let g=e.info;if(null==g||"reshape-edge-offset"!==g.type)g=e.info=new oa.ReshapeEdgeOffsetTooltipInfo({tooltipOptions:f});var {coordinateHelper:k}=this._editGeometryOperations.data;e=g;if("end"===a.action)f=J.zeroMeters;else a:{f=c*d.selectedArrow;var l=d.plane;if(this._graphicState.isDraped){const m=k.toXYZ(k.pointToVector(b));
l=ya.projectPoint(l,m,za.sv3d.get());k=Ia.geodesicDistance(l,m,k.spatialReference);if(null!=k){f=J.createLength(k.value*Math.sign(f),k.unit);break a}}f=J.createLength(f*ta.getMetersPerUnitForSR(b.spatialReference),"meters")}e.distance=f;this._updateTooltipAreaOrTotalLength(g);return a}};h._cleanEdgeOffsetCollapsedEdges=function(a){var b=a.handle.leftVertex.leftEdge?.leftVertex,c=a.handle.leftVertex;const d=a.handle.rightVertex.rightEdge?.rightVertex,e=a.handle.rightVertex,f=this._editGeometryOperations.data.coordinateHelper;
a=[];b&&1E-6>f.distance(b.pos,c.pos)&&(b=this._getManipulatorInfoFromHandle(c),null!=b&&a.push(b));if(1E-6>f.distance(c.pos,e.pos)||d&&1E-6>f.distance(d.pos,e.pos))c=this._getManipulatorInfoFromHandle(e),null!=c&&a.push(c);a.length&&this._removeVertices(a)};h._computeVertexManipulatorSizeAndOutline=function(a){const b=a.size/2,c=b+a.collisionPadding;return{size:b/c,outlineSize:(b+a.outlineSize)/c}};h._createVertexOrEdgeManipulator=function(a,b=Q.getGraphicEffectiveElevationInfo(this.graphic),c=!1){const {view:d}=
this;var e=R.getSettings(d);if("edge"===a.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(a,b);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const {size:l,outlineSize:m}=this._computeVertexManipulatorSizeAndOutline(e.manipulators.vertex);this._vertexManipulatorGeometry=M.createSphereGeometry(this._vertexManipulatorMaterial,l,16,16);this._vertexManipulatorOutlineGeometry=M.createSphereGeometry(this._vertexManipulatorOutlineMaterial,
m,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const {size:l,outlineSize:m}=this._computeVertexManipulatorSizeAndOutline(e.manipulators.edge);this._edgeManipulatorGeometry=M.createSphereGeometry(this._edgeManipulatorMaterial,l,16,16);this._edgeManipulatorOutlineGeometry=M.createSphereGeometry(this._edgeManipulatorOutlineMaterial,m,16,16)}({geometry:e}=this.graphic);e=e?.type;e="point"===e||"mesh"===e?[]:[new z.RenderObject(this._vertexManipulatorGeometry.instantiate(),
G.Vertex|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate(),G.Vertex|n.ManipulatorStateFlags.Unfocused|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),G.Vertex|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),
n.ManipulatorStateFlags.Selected),new z.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),n.ManipulatorStateFlags.Selected|n.ManipulatorStateFlags.Unfocused),new z.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),n.ManipulatorStateFlags.Selected|n.ManipulatorStateFlags.Focused)];this.enableMidpoints&&e.push(new z.RenderObject(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),
G.Edge|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),G.Edge|n.ManipulatorStateFlags.Focused|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._edgeManipulatorGeometry.instantiate(),G.Edge|n.ManipulatorStateFlags.Unfocused|n.ManipulatorStateFlags.Unselected),new z.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate(),G.Edge|n.ManipulatorStateFlags.Unfocused|
n.ManipulatorStateFlags.Unselected));const f=new Y.Manipulator3D({view:d,renderObjects:e,elevationInfo:b,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});f.selected=c;this._setTypeSpecificManipulatorSettings(f,a,b);const g="edge"===a.type?{manipulator:f,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:f,handle:a,type:"vertex",selectedIndex:0};this._manipulatorInfos.push(g);this.manipulators.add(f);
this._updateManipulatorPosition(g);if("edge"===g.type){a=[];for(var k of[g.handle.leftVertex,g.handle.rightVertex])c=this._getManipulatorInfoFromHandle(k),null!=c&&a.push(c.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(g)));g.locationUpdateHandle=P.handlesGroup(a);this._manipulatorHandles.add(g.locationUpdateHandle,f)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(f,!0),f);k=A.createManipulatorDragEventPipeline(f,(l,m,B,C)=>{let I=null;const {snappingStep:D,
cancelSnapping:w}=na.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ma.SnappingContext({editGeometryOperations:this._editGeometryOperations,elevationInfo:b,pointer:C,excludeFeature:this.graphic,visualizer:new ia.SnappingVisualizer3D}),updatingHandles:this.updatingHandles,useZ:!1});B=B.next(x=>{this._onDragCancel(!l.metadata.deleting,()=>I=y.removeMaybe(I));return x}).next(w);m.next(x=>this._trackNumDragging(x)).next(x=>
{"start"===x.action&&(I=this._editGeometryOperations.createUndoGroup());if("edge"===g.type){const T=this._splitEdgeManipulator(g);return{...x,info:T,snapOrigin:T.handle.pos}}return{...x,info:g,snapOrigin:g.handle.pos}}).next(A.dragAtLocation(this.view,l.elevationAlignedLocation)).next(V.screenToMapXYForGraphicAtLocation(this.view,this.graphic,l.elevationAlignedLocation,l.location.spatialReference,this.graphic)).next(A.sceneSnappingAtLocation(this.view,b,this.graphic)).next(...D).next(A.addMapDelta()).next(x=>
{this._perVertexManipulatorDragAction(x);"end"===x.action&&(I=y.removeMaybe(I));this._updateTranslateVertexTooltip(l,u.ManipulationType.XY,x)})});this._manipulatorHandles.add([k,f.events.on("immediate-click",l=>this._manipulatorClickCallback(l,g)),f.events.on("select-changed",()=>{g.selectedIndex=++this._selectedIndex;this._updateMoveManipulationPosition()}),f.events.on("focus-changed",({action:l})=>{"focus"===l&&"edge"!==g.type?this._updateTranslateVertexTooltip(f,u.ManipulationType.XY):this._tooltip.clear()})],
f);this.emit("manipulators-changed");return g};h._trackNumDragging=function(a){switch(a.action){case "start":this._numDragging++;break;case "end":this._numDragging--}return a};h._onDragCancel=function(a=!0,b){this._numDragging--;a&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null);null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping();this._tooltip.clear();switch(this._reshapeEventState){case p.MOVING:this.emit("move",
{type:"move",dx:0,dy:0,mover:this.graphic});break;case p.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}b&&b();this.destroyed||this._updateEventState(p.NONE)};h._setTypeSpecificManipulatorSettings=function(a,b,c){const {graphic:d,view:e}=this,f=R.getSettings(e);switch(b.type){case "vertex":a.state=G.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;const {size:g,collisionPadding:k}=f.manipulators.vertex;a.radius=g/2+k;a.elevationInfo=c;({geometry:b}=d);b=b?.type;a.interactive=
null!=b&&"point"!==b&&"mesh"!==b;break;case "edge":a.state=G.Edge;a.selectable=!1;a.cursor="copy";a.collisionPriority=-1;const {size:l,collisionPadding:m}=f.manipulators.edge;a.radius=l/2+m;a.elevationInfo="on-the-ground"!==c.mode||ha.isVolumetricSymbol(d.symbol)?{mode:"absolute-height",offset:0}:c}};h._watchAndUpdateGrabState=function(a,b){return a.events.on("grab-changed",c=>this._onGrabStateChanged(a,b,c.action,c.pointerType))};h._onGrabStateChanged=function(a,b,c,d="mouse"){if(!this._recreatingManipulators){if("start"===
c)b&&this._updateSelection(a),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(p.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing;if("touch"!==d||this.enableEdgeOffset)this._manipulatorInfos.forEach(e=>{const {manipulator:f}=e;var {geometry:g}=this.graphic;g=g?.type;f.interactive=f.grabbing||!this._numGrabbing&&null!=g&&"point"!==g&&"mesh"!==g;"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)}),
this._graphicMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing})}};h._clearSelection=function(){for(const a of this._manipulatorInfos)a.manipulator.grabbing||(a.manipulator.selected=!1)};h._updateSelection=function(a){a.grabbing&&!a.selected&&a.selectable&&(this._clearSelection(),a.selected=!0,this.emit("manipulators-changed"))};h._removeManipulator=function(a){null!=a&&(a.manipulator.metadata.deleting=!0,this.manipulators.remove(a.manipulator),this._manipulatorHandles.remove(a.manipulator),
pa.removeUnordered(this._manipulatorInfos,a),this.emit("manipulators-changed"))};h._getManipulatorInfoFromHandle=function(a){if(a)for(const b of this._manipulatorInfos)if(a===b.handle)return b;return null};h._updateManipulatorPosition=function(a){if(null!=a){var b=this._editGeometryOperations;if("vertex"===a.type)a.manipulator.location=b.data.coordinateHelper.vectorToDehydratedPoint(a.handle.pos,U),a.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=
a.manipulator.renderLocation);else if("edge"===a.type){var c=this._getManipulatorInfoFromHandle(a.handle.leftVertex),d=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=c&&null!=d&&(c=c.manipulator,d=d.manipulator,null!=a.manipulator.elevationInfo&&"on-the-ground"===a.manipulator.elevationInfo.mode?(c=c.location,d=d.location,a.manipulator.location=fa.makeDehydratedPoint(c.x+.5*(d.x-c.x),c.y+.5*(d.y-c.y),c.hasZ&&d.hasZ?0:void 0,b.data.spatialReference)):(K.lerp(X,c.renderLocation,d.renderLocation,
.5),a.manipulator.renderLocation=X))}}};h._splitEdgeManipulator=function(a,b=.5){var c=this._editGeometryOperations;b=c.splitEdge(a.handle,b).createdVertex;a.locationUpdateHandle=y.removeMaybe(a.locationUpdateHandle);var d=Q.getGraphicEffectiveElevationInfo(this.graphic);let e;this.enableEdgeOffset?(this._removeManipulator(a),e=this._createVertexOrEdgeManipulator(b)):(e=a,e.handle=b,e.type="vertex",this._setTypeSpecificManipulatorSettings(a.manipulator,a.handle,d));b.leftEdge&&this._createVertexOrEdgeManipulator(b.leftEdge);
b.rightEdge&&this._createVertexOrEdgeManipulator(b.rightEdge);this.outputGeometry=c.data.geometry;this._updateManipulatorPosition(e);this.enableEdgeOffset||this._updateTranslateVertexTooltip(e.manipulator,u.ManipulationType.XY);this._updateSelection(a.manipulator);a=this._updateEventState(p.RESHAPING);d=c.data.coordinateHelper.vectorToArray(e.handle.pos);c=c.data.components.indexOf(b.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:d,componentIndex:c,vertexIndex:b.index}],
added:d});a&&this._updateEventState(p.NONE);return e};h._updateMoveManipulationPosition=function(){const a=K.set(X,0,0,0);let b=0,c=!1;var d=null;let e=null;for(var f of this._manipulatorInfos)if("vertex"===f.type)if(f.manipulator.selected)if(b++,K.add(a,a,f.manipulator.renderLocation),null==d||f.selectedIndex>d.selectedIndex)e=d,d=f;else{if(null==e||f.selectedIndex>e.selectedIndex)e=f}else c=!0;if(0===b)d=this._graphicState.displaying&&this.enableMoveGraphic,this._moveManipulation.xyManipulation.available=
d,this._moveManipulation.xyAxisManipulation.available=d,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=d,this._moveManipulation.zManipulation.available=d&&this.enableZShape&&Z.canMoveZ(this.graphic),this._moveManipulation.angle=aa.shapeOrientation(this.graphic.geometry),this._moveManipulation.radius=u.MoveManipulation.radiusForSymbol(this.graphic.symbol);else{f=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=f;this._moveManipulation.xyAxisManipulation.available=
f;this._moveManipulation.zManipulation.available=f&&this.enableZVertex&&Z.canMoveZ(this.graphic);this._moveManipulation.xyAxisManipulation.orthogonalAvailable=f&&1!==b;f=0;if(null!=d){const g=d.handle.pos,k=null!=e?e.handle.pos:d.handle.leftEdge&&d.handle.leftEdge.leftVertex?d.handle.leftEdge.leftVertex.pos:null;d=null==e&&d.handle.rightEdge&&d.handle.rightEdge.rightVertex?d.handle.rightEdge.rightVertex.pos:null;k&&d?this._moveManipulation.xyAxisManipulation.available=!1:k?f=Math.atan2(g[1]-k[1],
g[0]-k[0])+Math.PI/2:d&&(f=Math.atan2(d[1]-g[1],d[0]-g[0])+Math.PI/2)}this._moveManipulation.angle=f;this._moveManipulation.radius=Ca.DISC_RADIUS_SMALL}0!==b&&c?(K.scale(a,a,1/b),U.spatialReference=this._editGeometryOperations.data.spatialReference,U.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,U),this._moveManipulation.elevationAlignedLocation=U):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?E.placeAtGraphic(this.view,
this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin};h._removeVertices=function(a){var b=[];const c=this._editGeometryOperations;for(var d of a)"vertex"===d.type&&c.canRemoveVertex()&&(b.push(d.handle),this._removeManipulator(d),this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.rightEdge)),(a=c.removeVertices([d.handle]).removedVertices?.[0].createdEdge)&&
this._createVertexOrEdgeManipulator(a));if(0<b.length&&(b=b.map(e=>{const f=c.data.components.indexOf(e.component);return{coordinates:c.data.coordinateHelper.vectorToArray(e.pos),componentIndex:f,vertexIndex:e.index}}),this.outputGeometry=c.data.geometry,d=this._updateEventState(p.RESHAPING),!this.destroyed&&(this.emit("vertex-remove",{type:"vertex-remove",removed:b.map(e=>e.coordinates),vertices:b}),!this.destroyed))){if(d&&(this._updateEventState(p.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}};
h._moveVertices=function(a,b,c="start"===b.action?ba.AccumulationBehaviour.NEW_STEP:ba.AccumulationBehaviour.ACCUMULATE_STEPS){const d=this._editGeometryOperations;d.moveVertices(a.map(e=>e.handle),b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ,c);this.outputGeometry=d.data.geometry;for(const e of a)this._updateManipulatorPosition(e)};h._offsetEdge=function(a,b){if(null!=b.operation&&null!=b.signedDistance){var c=this._editGeometryOperations,d=b.operation.clone();d.distance=b.signedDistance;c.updateVertices([a.handle.leftVertex,
a.handle.rightVertex],d);this.outputGeometry=c.data.geometry;this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.leftVertex));this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.rightVertex))}};h._manipulatorClickCallback=function(a,b){a.shiftKey||this._clearSelection();"vertex"===b.type&&(b.manipulator.selected=!b.manipulator.selected,a.button===la.MouseButton.Right&&this._removeVertices([b]));"edge"===b.type&&a.button===la.MouseButton.Left&&this._splitEdgeManipulator(b);
a.stopPropagation()};h._updateTranslateTooltip=function(a,b){const c=this._manipulatorInfos.filter(d=>"vertex"===d.type&&d.manipulator.selected);1===c.length?this._updateTranslateVertexTooltip(c[0].manipulator,a,b):this._updateTranslateGraphicTooltip(a,b)};h._updateTranslateGraphicTooltip=function(a,b){const c=this._tooltipOptions;if(c.enabled){var d=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(a){case u.ManipulationType.XY:this._tooltip.info=new N.TranslateGraphicTooltipInfo({tooltipOptions:c});
this._updateTranslateTooltipDistance(this._tooltip.info,b,(e,f)=>S.autoHorizontalDistanceByElevationModeBetweenPoints(e,f,d));break;case u.ManipulationType.XY_AXIS:this._tooltip.info=new N.TranslateGraphicXYTooltipInfo({tooltipOptions:c});this._updateTranslateTooltipDistance(this._tooltip.info,b,(e,f)=>{e=S.autoHorizontalDistanceByElevationModeBetweenPoints(e,f,d);return J.scale(e,aa.axisConstrainedDragSign(b))});break;case u.ManipulationType.Z:this._tooltip.info=new N.TranslateGraphicZTooltipInfo({tooltipOptions:c}),
this._updateTranslateTooltipDistance(this._tooltip.info,b,ca.verticalSignedDistanceBetweenPoints)}}};h._updateTranslateVertexTooltip=function(a,b,c){const d=this._tooltipOptions;if(d.enabled){var e=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(b){case u.ManipulationType.XY:var f=new N.TranslateVertexTooltipInfo({tooltipOptions:d});this._updateTranslateTooltipDistance(f,c,(g,k)=>S.autoHorizontalDistanceByElevationModeBetweenPoints(g,k,e));this._updateTooltipAreaOrTotalLength(f);
break;case u.ManipulationType.XY_AXIS:f=new N.TranslateVertexXYTooltipInfo({tooltipOptions:d});this._updateTranslateTooltipDistance(f,c,(g,k)=>{g=S.autoHorizontalDistanceByElevationModeBetweenPoints(g,k,e);return J.scale(g,aa.axisConstrainedDragSign(c))});this._updateTooltipAreaOrTotalLength(f);break;case u.ManipulationType.Z:f=new N.TranslateVertexZTooltipInfo({tooltipOptions:d}),this._updateTranslateTooltipDistance(f,c,ca.verticalSignedDistanceBetweenPoints)}a=ca.elevationOfPoint(a.elevationAlignedLocation);
null!=a&&(f.elevation={mode:"absolute-height",...a});this._tooltip.info=f}};h._updateTranslateTooltipDistance=function(a,b,c){if(null!=b&&"end"!==b.action){const {mapStart:d,mapEnd:e}=b;b=c(d,e);a.distance=null!=b?b:J.zeroMeters}};h._updateTooltipAreaOrTotalLength=function(a){const {geometry:b}=this.graphic;if(null!=b){var c=this._graphicState.isDraped?"on-the-ground":"absolute-height";a.area="polygon"===b.type?Ha.autoAreaByElevationMode(b,c):null;a.totalLength="polyline"===b.type?S.autoLengthByElevationMode(b,
c):null}};da._createClass(W,[{key:"inputGeometry",get:function(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null},set:function(a){this._recreateEditGeometryAndManipulators(a)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},
{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"_labelOptions",get:function(){return this.tool.labelOptions}},{key:"_tooltipOptions",get:function(){return this.tool.tooltipOptions}},{key:"canRedo",get:function(){return null!=this._editGeometryOperations&&
this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}},{key:"test",get:function(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}}]);return W}(qa.EventedMixin(ra.HandleOwner));r.__decorate([t.property()],q.ReshapeOperation.prototype,"_editGeometryOperations",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"_segmentLabels",void 0);r.__decorate([t.property({constructOnly:!0})],
q.ReshapeOperation.prototype,"tool",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"_tooltip",void 0);r.__decorate([t.property()],q.ReshapeOperation.prototype,"inputGeometry",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"outputGeometry",void 0);r.__decorate([t.property({readOnly:!0})],q.ReshapeOperation.prototype,"updating",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"manipulators",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,
"view",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"graphic",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableZShape",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableZVertex",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableMoveGraphic",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableMidpoints",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"enableEdgeOffset",null);r.__decorate([t.property()],
q.ReshapeOperation.prototype,"_labelOptions",null);r.__decorate([t.property()],q.ReshapeOperation.prototype,"_tooltipOptions",null);q.ReshapeOperation=r.__decorate([ua.subclass("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],q.ReshapeOperation);const U=fa.makeDehydratedPoint(0,0,void 0,Ja.WGS84),X=ea.create();var G;(function(v){v.Vertex=n.ManipulatorStateCustomFlags.Custom1;v.Edge=n.ManipulatorStateCustomFlags.Custom2})(G||(G={}));var p;(function(v){v[v.NONE=0]="NONE";v[v.MOVING=
1]="MOVING";v[v.RESHAPING=2]="RESHAPING"})(p||(p={}));var O;(function(v){v[v.ALL=0]="ALL";v[v.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"})(O||(O={}));Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});