// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./GrabbingState ./ManipulatorState ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState ../../webgl-engine/lib/Material".split(" "),
function(z,m,H,u,I,J,v,w,K,A,B,L,C,M,D,N,O,P,Q,R){function S(a,d,e,g){const {view:b,graphic:h}=a,f=C.getSettings(b),n=new M.ExtendedLineVisualElement({view:b,extensionType:f.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.RenderOccludedFlag.OccludeAndTransparent});f.visualElements.zVerticalLine.apply(n);const k=new D.LaserlineVisualElement({view:b,intersectsLineInfinite:!0,attached:!1});f.visualElements.pointGraphics.shadowStyle.apply(k);var p=
H.deg2rad(f.visualElements.heightPlaneAngleCutoff);const q=new D.LaserlineVisualElement({view:b,attached:!1,angleCutoff:p});f.visualElements.heightPlane.apply(q);p=A.getGraphicEffectiveElevationInfo(a.graphic);const T=P.ElevationContext.fromElevationInfo(p),U="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,x=new L.ManipulatorState;let E=1,F=1;const t=()=>{x.update(a);var c=y(h),r=U&&(d.isDraped||null==c||!c.hasZ);let G=!0;if(r||null==c)G=!1;else{const V=O.evaluateElevationAlignmentAtPoint(c,
b.elevationProvider,T,b.renderCoordsHelper);I.set(l,c.x,c.y,V);v.projectVectorToVector(l,c.spatialReference,l,b.renderCoordsHelper.spatialReference);n.setStartEndFromWorldDownAtLocation(l);k.intersectsWorldUpAtLocation=l}c=x.grabbingState&B.GrabbingState.Z?f.visualElements.laserlineAlphaMultiplier:1;c!==E&&(E=c,f.visualElements.heightPlane.apply(q,c));c=w.empty(W);!r&&d.displaying&&g.calculateMapBounds(c)&&v.projectVectorToVector(w.getMin(c,l),b.spatialReference,l,b.renderCoordsHelper.spatialReference)?
(q.heightManifoldTarget=l,q.attached=!0):q.attached=!1;c=x.grabbingState&B.GrabbingState.XY?f.visualElements.laserlineAlphaMultiplier:1;c!==F&&(F=c,f.visualElements.pointGraphics.shadowStyle.apply(k,c));r=G&&d.displaying&&!r;k.attached=r;n.attached=r};e.push(u.watch(()=>[d.displaying,d.isDraped],t),d.on("changed",t));a.forEachManipulator(c=>{e.push(c.events.on("grab-changed",t))});e.push(m.destroyHandle(k));e.push(m.destroyHandle(n));e.push(m.destroyHandle(q));t()}function X(a,d,e){const {view:g,
graphic:b}=a,h=new N.PointVisualElement({view:g,geometry:y(b),elevationInfo:A.getGraphicEffectiveElevationInfo(b),attached:!1});Y(a,h,d,e);e.push(m.destroyHandle(h));return h}function y(a){a=a.geometry;return null==a?null:"point"===a.type?a:"mesh"===a.type?a.anchor.clone():null}function Y(a,d,e,g){Z(a,d,e,g);C.getSettings(a.view).visualElements.pointGraphics.outline.apply(d);g.push(u.watch(()=>e.displaying,()=>d.attached=e.displaying,u.initial))}function Z(a,d,e,g){const {view:b,graphic:h}=a;let f=
null;const n=k=>{null!=f&&(f.remove(),f=null);e.isDraped&&null!=k&&(f=aa(b,k,()=>{d.geometry=k}))};a=()=>{const k=y(h);n(k);d.geometry=k};g.push(e.on("changed",a),m.refHandle(()=>f));a()}function aa(a,d,e){v.projectPointToVector(d,l,a.elevationProvider.spatialReference);const g=l[0],b=l[1];return a.elevationProvider.on("elevation-change",h=>{K.containsXY(h.extent,g,b)&&e()})}const l=J.create(),W=w.create();z.createVisualElements=function(a){const {view:d,graphic:e}=a,g=new Q.GraphicState({graphic:e}),
b=[],h=X(a,g,b);S(a,g,b,h);b.push(d.trackGraphicState(g));return{visualElement:h,remove(){m.handlesGroup(b).remove()}}};Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});