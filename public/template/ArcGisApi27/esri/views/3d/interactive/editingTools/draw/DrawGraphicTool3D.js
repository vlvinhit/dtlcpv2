// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../support/elevationInfoUtils ../../../../../symbols/support/ElevationInfo ../../SegmentLabels3D ../../SnappingVisualizer3D ../meshFastUpdateUtils ../settings ../../visualElements/ExtendedLineVisualElement ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement ../../../layers/graphics/elevationAlignmentUtils ../../../layers/graphics/ElevationContext ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/Material ../../../../draw/DrawGraphicTool ../../../../draw/DrawOperation ../../../../draw/drawSurfaces ../../../../support/colorUtils".split(" "),
function(f,n,l,g,p,q,r,P,Q,R,B,C,D,u,E,F,G,H,v,I,J,w,K,L,M,N,x,O,y,m){f.DrawGraphicTool3D=function(z){function t(a){a=z.call(this,a)||this;a._activeVertexVisualElement=null;a._createGraphicState=null;a._outlineVisualElement=null;a._verticesVisualElement=null;a._verticalLineVisualElement=null;a.geometryType=null;a.type="draw-3d";return a}n._inherits(t,z);var e=t.prototype;e.initialize=function(){const {mode:a,offset:b}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new E({mode:a,offset:b})};
e.normalizeCtorArgs=function(a){return a.elevationInfo?a:{...a,elevationInfo:u.getEffectiveElevationInfo(a.hasZ??!0)}};e.initializeGraphic=function(a){const {view:b}=this,c=this._createGraphicState=new M.GraphicState({graphic:a});return g.handlesGroup([b.maskOccludee(a),b.trackGraphicState(c),q.watch(()=>({element:this._outlineVisualElement,isDraped:c.isDraped}),({element:d,isDraped:h})=>{d&&(d.isDraped=h)},q.syncAndInitial),this._setupLoadingIndicator(c),...H.meshTransformFastUpdateHandles(c)])};
e.makeDrawOperation=function(){const {geometryType:a}=this,b="circle"!==a&&"rectangle"!==a;return new O.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:x.geometryTypeToDrawOperationGeometryType(a),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new y.SceneDrawSurface(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new y.ElevationDrawSurface(this.elevationInfo,this.defaultZ,this.view,
this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new G.SnappingVisualizer3D,segmentLabels:b?new F.SegmentLabels3D:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===u.getEffectiveElevationMode(this.hasZ,this.elevationInfo)})};e.onActiveVertexChanged=function(a){const {view:b}=this,c=v.getSettings(b);if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=
[a],this._updateVerticalLineVisualElement(a),null;const d=c.manipulators,h=d.vertex;this._activeVertexVisualElement=new w.VerticesVisualElement({view:b,spatialReference:b.spatialReference,vertices:[a],elevationInfo:this.internalGraphicsLayer.elevationInfo,color:m.unitRGBAFromColor(h.color),size:h.size,outlineColor:m.unitRGBAFromColor(h.outlineColor),outlineSize:h.outlineSize,renderOccluded:h.renderOccluded,attached:!1});this._activeVertexVisualElement.color=m.unitRGBAFromColor(d.selected.color);this._activeVertexVisualElement.attached=
!0;a=c.visualElements.zVerticalLine;this._verticalLineVisualElement=new I.ExtendedLineVisualElement({view:b,extensionType:a.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:N.RenderOccludedFlag.OccludeAndTransparent});a.apply(this._verticalLineVisualElement);return g.makeHandle(()=>{this._activeVertexVisualElement=p.destroyMaybe(this._activeVertexVisualElement);this._verticalLineVisualElement=p.destroyMaybe(this._verticalLineVisualElement)})};e._updateVerticalLineVisualElement=
function(a){const b=this._verticalLineVisualElement;if(b){var {renderCoordsHelper:c,elevationProvider:d}=this.view;C.set(k,a[0],a[1],a[2]);A.setFromElevationInfo(this.elevationInfo);k[2]=K.evaluateElevationAlignmentAtPoint(k,d,A,c);c.toRenderCoords(k,this.view.spatialReference,k)?(b.setStartEndFromWorldDownAtLocation(k),b.attached=!0):b.attached=!1}};e.onOutlineChanged=function(a){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=a,null;const b=this.internalGraphicsLayer.elevationInfo,
{view:c}=this,d=v.getSettings(c);this._outlineVisualElement=new J.OutlineVisualElement({view:c,geometry:a,elevationInfo:b,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===u.getEffectiveElevationMode(this.hasZ,b),attached:!1});d.visualElements.lineGraphics.outline.apply(this._outlineVisualElement);d.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement);this._outlineVisualElement.attached=!0;this._outlineVisualElement.laserlineEnabled=!0;return g.makeHandle(()=>
{this._outlineVisualElement=p.destroyMaybe(this._outlineVisualElement)})};e.onRegularVerticesChanged=function(a){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=a,null;const {view:b}=this,c=v.getSettings(b).manipulators.vertex;this._verticesVisualElement=new w.VerticesVisualElement({view:b,spatialReference:b.spatialReference,vertices:a,elevationInfo:this.internalGraphicsLayer.elevationInfo,color:m.unitRGBAFromColor(c.color),size:c.size,outlineColor:m.unitRGBAFromColor(c.outlineColor),
outlineSize:c.outlineSize,renderOccluded:c.renderOccluded,attached:!1});this._verticesVisualElement.attached=!0;return g.makeHandle(()=>{this._verticesVisualElement=p.destroyMaybe(this._verticesVisualElement)})};e._updateGraphicGeometry=function(a,b){if("mesh"===this.geometryType&&"point"===b?.type){const c=this.geometryToPlace;c&&c.centerAt(b);c&&a.geometry===c?c.vertexSpace.isGeoreferenced?a.notifyGeometryChanged():a.notifyMeshTransformChanged():a.geometry=c}else n._get(n._getPrototypeOf(t.prototype),
"_updateGraphicGeometry",this).call(this,a,b)};e._setupLoadingIndicator=function(a){const {drawOperation:b}=this;if(!this.geometryToPlace)return b.loading=!1,null;b.loading=!0;const c=g.makeHandle(()=>{b.loading=!1});let d=void 0;return g.handlesGroup([q.when(()=>a.displaying,()=>{d&&cancelAnimationFrame(d);d=requestAnimationFrame(()=>c.remove())},{...q.syncAndInitial,once:!0}),g.makeHandle(()=>d&&cancelAnimationFrame(d)),c])};return n._createClass(t)}(x.DrawGraphicTool);l.__decorate([r.property({constructOnly:!0})],
f.DrawGraphicTool3D.prototype,"elevationInfo",void 0);l.__decorate([r.property({constructOnly:!0})],f.DrawGraphicTool3D.prototype,"geometryType",void 0);l.__decorate([r.property()],f.DrawGraphicTool3D.prototype,"type",void 0);l.__decorate([r.property({constructOnly:!0})],f.DrawGraphicTool3D.prototype,"view",void 0);f.DrawGraphicTool3D=l.__decorate([B.subclass("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],f.DrawGraphicTool3D);const A=new L.ElevationContext,k=D.create();Object.defineProperty(f,
Symbol.toStringTag,{value:"Module"})});