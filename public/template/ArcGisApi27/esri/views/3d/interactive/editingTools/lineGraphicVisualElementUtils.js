// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../support/elevationInfoUtils ../Manipulator3D ./GrabbingState ./ManipulatorState ./ManipulatorType ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/OutlineVisualElement ../../layers/graphics/GraphicState ../../webgl-engine/lib/Material".split(" "),function(x,l,D,u,v,E,y,F,
z,G,H,A,I,J,K,L,M){function N(a,c){const {view:d,graphic:e}=a,b=new K.OutlineVisualElement({view:d,geometry:w(e)?e.geometry:null,elevationInfo:y.getGraphicEffectiveElevationInfo(e),attached:!1});a=A.getSettings(d).visualElements.lineGraphics;a.shadowStyle.apply(b);a.outline.apply(b);const h=[u.watch(()=>c.displaying,()=>{b.attached=c.displaying}),u.watch(()=>c.isDraped,g=>{b.isDraped=g}),c.on("changed",()=>b.geometry=w(e)?e.geometry:null),l.destroyHandle(b)];b.attached=c.displaying;return{visualElement:b,
remove:()=>l.handlesGroup(h).remove()}}function O(a,c,d){const {graphic:e,view:b}=a,h=[];var g=y.getGraphicEffectiveElevationInfo(e);const P="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,m=new G.ManipulatorState,k=A.getSettings(b).visualElements,n=new I.ExtendedLineVisualElement({view:b,extensionType:k.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:M.RenderOccludedFlag.OccludeAndTransparent});k.pointGraphics.shadowStyle.apply(n);g=D.deg2rad(k.heightPlaneAngleCutoff);
const r=new J.LaserlineVisualElement({view:b,attached:!1,angleCutoff:g});k.heightPlane.apply(r);let B=1,C=1;const q=()=>{m.update(a);if(d.displaying&&(!P||!d.isDraped&&w(e)&&e.geometry.hasZ)){c.laserlineEnabled=!0;var f=m.grabbingState&z.GrabbingState.XY?k.laserlineAlphaMultiplier:1;f!==B&&(B=f,k.lineGraphics.shadowStyle.apply(c,f),k.pointGraphics.shadowStyle.apply(n,f));f=m.grabbingState&z.GrabbingState.Z?k.laserlineAlphaMultiplier:1;f!==C&&(C=f,k.heightPlane.apply(r,f));f=1===m.numSelected?m.firstSelected:
1<m.numSelected&&null!=m.firstGrabbedXY?m.firstGrabbedXY:null;null!=f?(n.setStartEndFromWorldDownAtLocation(f.renderLocation),n.attached=!0):n.attached=!1;Q(a,c,r,m)}else c.laserlineEnabled=!1,n.attached=!1,r.attached=!1};k.zVerticalLine.apply(n);h.push(d.on("changed",q),u.watch(()=>d.displaying,q),c.events.on("attachment-origin-changed",q),l.destroyHandle(n),l.destroyHandle(r));const t=[];g=()=>{l.handlesGroup(t).remove();t.length=0;a.forEachManipulator(f=>t.push(f.events.on("grab-changed",q)));
a.forEachManipulator(f=>t.push(f.events.on("select-changed",q)));q()};g();h.push(a.onManipulatorsChanged(g),l.refHandle(()=>l.handlesGroup(t)));return l.handlesGroup(h)}function Q(a,c,d,e){if(0<e.numSelected){v.set(p,0,0,0);let b=0;a.forEachManipulator((h,g)=>{g===H.ManipulatorType.TRANSLATE_XY&&h.selected&&h instanceof F.Manipulator3D&&(v.add(p,p,h.renderLocation),b++)});0<b?(d.heightManifoldTarget=v.scale(p,p,1/b),d.attached=!0):d.attached=!1}else c=c.attachmentOrigin,null!=c&&a.view.renderCoordsHelper.toRenderCoords(c,
p)?(d.heightManifoldTarget=p,d.attached=!0):d.attached=!1}function w(a){return null!=a.geometry&&("polygon"===a.geometry.type||"polyline"===a.geometry.type)}const p=E.create();x.createVisualElements=function(a){const {view:c,graphic:d}=a,e=new L.GraphicState({graphic:d}),b=N(a,e);a=O(a,b.visualElement,e);const h=[b,a,c.maskOccludee(d),c.trackGraphicState(e)];return{visualElement:b.visualElement,remove:()=>l.handlesGroup(h).remove()}};Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});