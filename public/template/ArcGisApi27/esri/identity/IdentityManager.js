// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/Evented ../core/events ../core/lang ../core/object ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo ../portal/support/urlUtils".split(" "),
function(F,A,u,D,v,B,K,W,Z,V,R,C,ra,I,X,U,ea,na,la,ma,ba,oa,xa){const pa={},ua=Y=>{const ca=(new I.Url(Y.owningSystemUrl)).host;Y=(new I.Url(Y.server)).host;const p=/.+\.arcgis\.com$/i;return p.test(ca)&&p.test(Y)},sa=(Y,ca)=>!!(ua(Y)&&ca&&ca.some(p=>p.test(Y.server)));let ta=null,va=null;try{ta=window.localStorage,va=window.sessionStorage}catch{}U=function(Y){function ca(){var a=Y.call(this)||this;a._portalConfig=globalThis.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=
[];a._xoReqs=[];a._portals=[];a._defaultOAuthInfo=null;a._defaultTokenValidity=60;a.dialog=null;a.formConstructor=na;a.tokenValidity=null;a.normalizeWebTierAuth=!1;a._appOrigin="null"!==window.origin?window.origin:window.location.origin;a._appUrlObj=I.urlToObject(window.location.href);a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthLocationParams=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;
a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthLocationParams();window.addEventListener("pageshow",b=>{a._pageShowHandler(b)});return a}A._inherits(ca,Y);var p=ca.prototype;p.registerServers=function(a){const b=this.serverInfos;b?(a=a.filter(c=>!this.findServerInfo(c.server)),this.serverInfos=
b.concat(a)):this.serverInfos=a;a.forEach(c=>{c.owningSystemUrl&&this._portals.push(c.owningSystemUrl);c.hasPortal&&this._portals.push(c.server)})};p.registerOAuthInfos=function(a){const b=this.oAuthInfos;if(b){for(const c of a){const d=this.findOAuthInfo(c.portalUrl);d&&b.splice(b.indexOf(d),1)}this.oAuthInfos=b.concat(a)}else this.oAuthInfos=a};p.registerToken=function(a){a={...a};const b=this._sanitizeUrl(a.server),c=this._isServerRsrc(b);let d=this.findServerInfo(b),f=!0,m;d||(d=new oa,d.server=
this._getServerInstanceRoot(b),c?d.hasServer=!0:(d.tokenServiceUrl=this._getTokenSvcUrl(b),d.hasPortal=!0),this.registerServers([d]));(m=this._findCredential(b))?(delete a.server,Object.assign(m,a),f=!1):(m=new F.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:c?"server":"portal"}),m.resources=[b],this.credentials.push(m));m.emitTokenChange(!1);f||m.refreshServerTokens()};p.toJSON=function(){return V.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),
oAuthInfos:this.oAuthInfos.map(a=>a.toJSON()),credentials:this.credentials.map(a=>a.toJSON())})};p.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){const d=[];b.forEach(f=>{f.server&&f.tokenServiceUrl&&d.push(f.declaredClass?f:new oa(f))});d.length&&this.registerServers(d)}if(c){const d=[];c.forEach(f=>{f.appId&&d.push(f.declaredClass?f:new ba(f))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&d.token&&
d.expires&&d.expires>Date.now()&&(d=d.declaredClass?d:new F.Credential(d),d.emitTokenChange(),this.credentials.push(d))})}};p.findServerInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.serverInfos)if(this._hasSameServerInstance(c.server,a)){b=c;break}return b};p.findOAuthInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.oAuthInfos)if(this._hasSameServerInstance(c.portalUrl,a)){b=c;break}return b};p.findCredential=function(a,b){if(a){a=this._sanitizeUrl(a);var c=this._isServerRsrc(a)?
"server":"portal";if(b)for(const f of this.credentials){if(this._hasSameServerInstance(f.server,a)&&b===f.userId&&f.scope===c){var d=f;break}}else for(const f of this.credentials)if(this._hasSameServerInstance(f.server,a)&&-1!==this._getIdenticalSvcIdx(a,f)&&f.scope===c){d=f;break}return d}};p.getCredential=function(a,b){let c=!0;if(b){var d=!!b.token;var f=b.error;c=!1!==b.prompt}b={...b};a=this._sanitizeUrl(a);const m=new AbortController,r=C.createResolver();if(b.signal)C.onAbort(b.signal,()=>{m.abort()});
C.onAbort(m,()=>{r.reject(new K("identity-manager:user-aborted","ABORTED"))});if(C.isAborted(m))return r.promise;b.signal=m.signal;const z=this._isAdminResource(a);if((d=d?this.findCredential(a):null)&&f&&f.details&&498===f.details.httpStatus)d.destroy();else if(d)return a=new K("identity-manager:not-authorized","You are currently signed in as: '"+d.userId+"'. You do not have access to this resource: "+a,{error:f}),r.reject(a),r.promise;if(f=this._findCredential(a,b))return r.resolve(f),r.promise;
let k=this.findServerInfo(a);if(k)!k.hasServer&&this._isServerRsrc(a)&&(k._restInfoPms=this._getTokenSvcUrl(a),k.hasServer=!0);else{f=this._getTokenSvcUrl(a);if(!f)return a=new K("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),r.reject(a),r.promise;k=new oa;k.server=this._getServerInstanceRoot(a);"string"===typeof f?(k.tokenServiceUrl=f,k.hasPortal=!0):(k._restInfoPms=f,k.hasServer=!0);this.registerServers([k])}k.hasPortal&&void 0===k._selfReq&&(c||
I.hasSameOrigin(k.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(q=>q.tokenServiceUrl===k.tokenServiceUrl))&&(k._selfReq={owningTenant:b&&b.owningTenant,selfDfd:this._getPortalSelf(k.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,k,b,r,z)};p.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&
a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};p.generateToken=function(a,b,c){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),f=new I.Url(this._appOrigin);var m=a.shortLivedTokenValidity;let r,z,k,q,J,y,M;b&&(M=this.tokenValidity||m||this._defaultTokenValidity,M>m&&0<m&&(M=m));c&&(r=c.isAdmin,z=c.serverUrl,k=c.token,J=c.signal,y=c.ssl,a.customParameters=c.customParameters);r?m=a.adminTokenServiceUrl:(m=a.tokenServiceUrl,q=new I.Url(m.toLowerCase()),
a.webTierAuth&&c?.serverUrl&&!y&&"http"===f.scheme&&(I.hasSameOrigin(f.uri,m,!0)||"https"===q.scheme&&f.host===q.host&&"7080"===f.port&&"7443"===q.port)&&(m=m.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));c={query:{request:"getToken",username:b?.username,password:b?.password,serverUrl:z,token:k,expiration:M,referer:r||d?this._appOrigin:null,client:r?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,c),signal:J,...c?.ioArgs};d||(c.withCredentials=
!1);return B(m,c).then(N=>{N=N.data;if(!N||!N.token)return new K("identity-manager:authentication-failed","Unable to generate token");const G=a.server;pa[G]||(pa[G]={});b&&(pa[G][b.username]=b.password);N.validity=M;return N})};p.isBusy=function(){return!!this._busy};p.checkSignInStatus=function(a){return this.checkAppAccess(a,"").then(b=>b.credential)};p.checkAppAccess=function(a,b,c){let d=!1;return this.getCredential(a,{prompt:!1}).then(f=>{let m;const r={f:"json"};if("portal"===f.scope)if(b&&
(this._doPortalSignIn(a)||c&&c.force))m=f.server+"/sharing/rest/oauth2/validateAppAccess",r.client_id=b;else if(f.token)m=f.server+"/sharing/rest";else return{credential:f};else if(f.token)m=f.server+"/rest/services";else return{credential:f};f.token&&(r.token=f.token);return B(m,{query:r,authMode:"anonymous"}).then(z=>{if(!1===z.data.valid)throw new K("identity-manager:not-authorized",`You are currently signed in as: '${f.userId}'.`,z.data);d=!!z.data.viewOnlyUserTypeApp;return{credential:f}}).catch(z=>
{if("identity-manager:not-authorized"===z.name)throw z;z=z.details&&z.details.httpStatus;if(498===z)throw f.destroy(),new K("identity-manager:not-authenticated","User is not signed in.");if(400===z)throw new K("identity-manager:invalid-request");return{credential:f}})}).then(f=>({credential:f.credential,viewOnly:d}))};p.setOAuthResponseHash=function(a){a&&("#"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(I.queryToObject(a)))};p.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=
a};p.setProtocolErrorHandler=function(a){this._protocolFunc=a};p.signIn=function(a,b,c={}){const d=C.createResolver(),f=()=>{z?.remove();k?.remove();q?.remove();r?.destroy();this.dialog?.destroy();this.dialog=r=z=k=q=null},m=()=>{f();this._oAuthDfd=null;d.reject(new K("identity-manager:user-aborted","ABORTED"))};if(c.signal)C.onAbort(c.signal,()=>{m()});let r=new this.formConstructor;r.resource=this.getResourceName(a);r.server=b.server;this.dialog=new la;this.dialog.content=r;this.dialog.open=!0;
this.emit("dialog-create");let z=r.on("cancel",m),k=ra.watch(()=>this.dialog.open,m),q=r.on("submit",J=>{this.generateToken(b,J,{isAdmin:c.isAdmin,signal:c.signal}).then(y=>{f();y=new F.Credential({userId:J.username,server:b.server,token:y.token,expires:null!=y.expires?Number(y.expires):null,ssl:!!y.ssl,isAdmin:c.isAdmin,validity:y.validity});d.resolve(y)}).catch(y=>{r.error=y;r.signingIn=!1})});return d.promise};p.oAuthSignIn=function(a,b,c,d){const f=this._oAuthDfd=C.createResolver();if(d?.signal)C.onAbort(d.signal,
()=>{const N=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;N&&!N.closed?N.close():this.dialog&&y()});f.resUrl_=a;f.sinfo_=b;f.oinfo_=c;let m;const r=c._oAuthCred;if(r.storage&&("authorization-code"===c.flowType||"auto"===c.flowType&&!c.popup&&8.4<=b.currentVersion)){let N=crypto.getRandomValues(new Uint8Array(32));m=I.base64UrlEncode(N);r.codeVerifier=m;N=crypto.getRandomValues(new Uint8Array(32));r.stateUID=I.base64UrlEncode(N);r.save()||(r.codeVerifier=m=null)}else r.codeVerifier=null;this._getCodeChallenge(m).then(N=>
{const G=!d||!1!==d.oAuthPopupConfirmation;c.popup&&G?(z=new this.formConstructor,z.oAuthPrompt=!0,z.server=b.server,this.dialog=new la,this.dialog.content=z,this.dialog.open=!0,this.emit("dialog-create"),k=z.on("cancel",y),q=ra.watch(()=>this.dialog.open,y),J=z.on("submit",()=>{M();this._doOAuthSignIn(a,b,c,N)})):this._doOAuthSignIn(a,b,c,N)});let z,k,q,J;const y=()=>{M();this._oAuthDfd=null;f.reject(new K("identity-manager:user-aborted","ABORTED"))},M=()=>{k?.remove();q?.remove();J?.remove();z?.destroy();
this.dialog?.destroy();this.dialog=null};return f.promise};p.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};p.enablePostMessageAuth=function(a="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=Z.on(window,"message",b=>{if((b.origin===this._appOrigin||b.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===b.data?.type){const c=
b.source;this.getCredential(a).then(d=>{c.postMessage({type:"arcgis:auth:credential",credential:{expires:d.expires,server:d.server,ssl:d.ssl,token:d.token,userId:d.userId}},b.origin)}).catch(d=>{c.postMessage({type:"arcgis:auth:error",error:{name:d.name,message:d.message}},b.origin)})}})};p.disablePostMessageAuth=function(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)};p._getOAuthLocationParams=function(){var a=window.location.hash;if(a){"#"===
a.charAt(0)&&(a=a.substring(1));a=I.queryToObject(a);var b=!1;if(a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),a.state.portalUrl&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}b&&(window.location.hash=a.state?.hash||"")}if(a=window.location.search){"?"===
a.charAt(0)&&(a=a.substring(1));a=I.queryToObject(a);b=!1;if(a.code&&a.state)try{a.state=JSON.parse(a.state),a.state.portalUrl&&a.state.uid&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}if(b){const c={...a};"code error error_description message_code persist state".split(" ").forEach(d=>{delete c[d]});b=
I.objectToQuery(c);window.history.replaceState(window.history.state,"",window.location.pathname+(b?`?${b}`:"")+(a.state?.hash||""))}}};p._getOAuthToken=function(a,b,c,d,f){a=a.replace(/^http:/i,"https:");return B(`${a}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:d&&f?{grant_type:"authorization_code",code:b,redirect_uri:d,client_id:c,code_verifier:f}:{grant_type:"refresh_token",refresh_token:b,client_id:c}}).then(m=>m.data)};p._getCodeChallenge=function(a){return a&&globalThis.isSecureContext?
(a=(new TextEncoder).encode(a),crypto.subtle.digest("SHA-256",a).then(b=>I.base64UrlEncode(new Uint8Array(b)))):Promise.resolve(null)};p._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new K("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};p._findCredential=function(a,b){let c=-1,d,f,m;const r=b&&b.token;b=b&&b.resource;const z=this._isServerRsrc(a)?"server":"portal",k=this.credentials.filter(q=>this._hasSameServerInstance(q.server,a)&&
q.scope===z);a=b||a;if(k.length)if(1===k.length)if(b=k[0],m=(d=(f=this.findServerInfo(b.server))&&f.owningSystemUrl)?this.findCredential(d,b.userId):void 0,c=this._getIdenticalSvcIdx(a,b),r)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,m));else return-1===c&&b.resources.push(a),this._addResource(a,m),b;else{let q,J;k.some(y=>{J=this._getIdenticalSvcIdx(a,y);return-1!==J?(q=y,m=(d=(f=this.findServerInfo(q.server))&&f.owningSystemUrl)?this.findCredential(d,q.userId):void 0,c=J,!0):!1});if(r)q&&
(q.resources.splice(c,1),this._removeResource(a,m));else if(q)return this._addResource(a,m),q}};p._findOAuthInfo=function(a){let b=this.findOAuthInfo(a);if(!b)for(const c of this.oAuthInfos)if(this._isIdProvider(c.portalUrl,a)){b=c;break}return b};p._addResource=function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)};p._removeResource=function(a,b){let c=-1;b&&(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))};p._useProxy=function(a,b){return b&&b.isAdmin&&!I.hasSameOrigin(a.adminTokenServiceUrl,
this._appOrigin)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!I.hasSameOrigin(a.tokenServiceUrl,this._appOrigin)};p._getOrigin=function(a){a=new I.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};p._getServerInstanceRoot=function(a){const b=a.toLowerCase();let c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&(c=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1!==c||xa.isSecureProxyService(b)||(c=
b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a};p._hasSameServerInstance=function(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b};p._normalizeAGOLorgDomain=function(a){const b=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,c=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,
d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a};p._sanitizeUrl=function(a){const b=(D.request.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+1));a=I.normalize(a);return I.urlToObject(a).path};p._isRESTService=function(a){return a.includes(this._agsRest)};p._isAdminResource=
function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};p._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};p._isIdenticalService=function(a,b){var c=!1;this._isRESTService(a)&&this._isRESTService(b)?(a=this._getSuffix(a).toLowerCase(),b=this._getSuffix(b).toLowerCase(),c=a===b,c||(c=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi,c=a.replaceAll(c,"$1")===b.replaceAll(c,"$1"))):this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||
this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c};p._isPortalDomain=function(a){const b=new I.Url(a.toLowerCase());a=this._portalConfig;let c=this._gwDomains.some(d=>d.regex.test(b.uri));!c&&a&&(c=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),b.uri));c||D.portalUrl&&(c=I.hasSameOrigin(b,D.portalUrl,!0));c||(c=this._portals.some(d=>this._hasSameServerInstance(d,b.uri)));return c=c||this._agsPortal.test(b.path)};p._isIdProvider=function(a,b){let c=-1,d=-1;this._gwDomains.forEach((m,
r)=>{-1===c&&m.regex.test(a)&&(c=r);-1===d&&m.regex.test(b)&&(d=r)});let f=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)f=!0}else if(1===c){if(1===d||2===d)f=!0}else 2===c?2===d&&(f=!0):3===c&&3===d&&(f=!0);if(!f){const m=this.findServerInfo(b),r=m&&m.owningSystemUrl;r&&ua(m)&&this._isPortalDomain(r)&&this._isIdProvider(a,r)&&(f=!0)}return f};p._getIdenticalSvcIdx=function(a,b){let c=-1;for(let d=0;d<b.resources.length;d++)if(this._isIdenticalService(a,b.resources[d])){c=d;break}return c};p._getSuffix=
function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};p._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var b=this._getServerInstanceRoot(a);var c=b+"/admin/generateToken";a=b+"/rest/info";b=B(a,{query:{f:"json"}}).then(d=>d.data);return{adminUrl:c,promise:b}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(f=>{f.regex.test(a)&&(d=f.tokenServiceUrl);return!!d});d||this._portals.some(f=>{this._hasSameServerInstance(f,a)&&
(d=f+this._gwTokenUrl);return!!d});d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(c=(new I.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===c&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(a.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};p._processOAuthResponseParams=function(a,b,c){const d=b._oAuthCred;if(a.code){var f=d.codeVerifier;
d.codeVerifier=null;d.stateUID=null;d.save();return this._getOAuthToken(c.server,a.code,b.appId,this._getRedirectURI(b,!0),f).then(m=>{const r=new F.Credential({userId:m.username,server:c.server,token:m.access_token,expires:Date.now()+1E3*m.expires_in,ssl:m.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=r.userId;d.storage=m.persist?ta:va;d.refreshToken=m.refresh_token;d.token=null;d.expires=m.refresh_token_expires_in?Date.now()+1E3*m.refresh_token_expires_in:null;d.userId=r.userId;d.ssl=r.ssl;d.save();
return r})}f=new F.Credential({userId:a.username,server:c.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=f.userId;d.storage=a.persist?ta:va;d.refreshToken=null;d.token=f.token;d.expires=f.expires;d.userId=f.userId;d.ssl=f.ssl;d.save();return Promise.resolve(f)};p._processOAuthPopupParams=function(a){const b=this._oAuthDfd;this._oAuthDfd=null;if(b)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),
a.error){const c="access_denied"===a.error;a=new K(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":"OAuth: "+a.error+" - "+a.error_description);b.reject(a)}else this._processOAuthResponseParams(a,b.oinfo_,b.sinfo_).then(c=>{b.resolve(c)}).catch(c=>{b.reject(c)})};p._setOAuthResponseQueryString=function(a){a&&("?"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(I.queryToObject(a)))};p._exchangeToken=function(a,b,c){return B(`${a}/sharing/rest/oauth2/exchangeToken`,
{authMode:"anonymous",method:"post",query:{f:"json",client_id:b,token:c}}).then(d=>d.data.token)};p._getPlatformSelf=function(a,b){a=a.replace(/^http:/i,"https:");return B(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":b,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(c=>c.data)};p._getPortalSelf=function(a,b){let c;this._gwDomains.some(d=>{d.regex.test(a)&&(c=
d.customBaseUrl);return!!c});if(c)return Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:c,portalMode:"multitenant",supportsOAuth:!0});this._appOrigin.startsWith("https:")?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return B(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(d=>d.data)};p._doPortalSignIn=function(a){const b=this._portalConfig,c=window.location.href,d=this.findServerInfo(a);
return(b||this._isPortalDomain(c))&&(d?d.hasPortal||d.owningSystemUrl&&this._isPortalDomain(d.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(c,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),a)||this._isIdProvider(b.restBaseUrl,a))||I.hasSameOrigin(c,a,!0))?!0:!1};p._checkProtocol=function(a,b,c,d){let f=!0;d=d?b.adminTokenServiceUrl:b.tokenServiceUrl;d.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&I.getProxyRule(d)&&
(f=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,f||(a=new K("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return f};p._enqueue=function(a,b,c,d,f,m){d||(d=C.createResolver());d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=f;d.refresh_=m;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):
this._xoReqs.push(d):this._doSignIn(d);return d.promise};p._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const b=k=>{var q=a.options_&&a.options_.resource;const J=a.resUrl_,y=a.refresh_;let M=!1;this.credentials.includes(k)||(y&&this.credentials.includes(y)?(y.userId=k.userId,y.token=k.token,y.expires=k.expires,y.validity=k.validity,y.ssl=k.ssl,y.creationTime=k.creationTime,M=!0,k=y):this.credentials.push(k));k.resources||(k.resources=[]);k.resources.includes(q||J)||k.resources.push(q||
J);k.scope=this._isServerRsrc(J)?"server":"portal";k.emitTokenChange();q=this._soReqs;const N={};this._soReqs=[];q.forEach(G=>{if(!this._isIdenticalService(J,G.resUrl_)){const H=this._getSuffix(G.resUrl_);N[H]||(N[H]=!0,k.resources.push(G.resUrl_))}});a.resolve(k);q.forEach(G=>{this._hasSameServerInstance(this._getServerInstanceRoot(J),G.resUrl_)?G.resolve(k):this._soReqs.push(G)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;M||this.emit("credential-create",{credential:k});this._soReqs.length?this._doSignIn(this._soReqs.shift()):
this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},c=k=>{a.reject(k);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=(k,q,J,y)=>{const M=a.sinfo_,N=!a.options_||!1!==a.options_.prompt,G=M.hasPortal&&this._findOAuthInfo(a.resUrl_);let H,P;if(k)b(new F.Credential({userId:k,server:M.server,token:J||null,expires:null!=y?Number(y):null,ssl:!!q}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&
this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const h=Z.on(window,"message",e=>{e.source===window.parent&&e.data&&("arcgis:auth:credential"===e.data.type?(h.remove(),e.data.credential.expires<Date.now()?c(new K("identity-manager:credential-request-failed","Parent application's token has expired.")):
b(new F.Credential(e.data.credential))):"arcgis:auth:error"===e.data.type&&(h.remove(),"tokenExpiredError"===e.data.error.name?c(new K("identity-manager:credential-request-failed","Parent application's token has expired.")):c(K.fromJSON(e.data.error))))});C.onAbort(a.options_?.signal,()=>{h.remove()})}else if(G){let h=G._oAuthCred;h||(k=new ma(G,ta),q=new ma(G,va),k.isValid()&&q.isValid()?k.expires>q.expires?(h=k,q.destroy()):(h=q,k.destroy()):h=k.isValid()?k:q,G._oAuthCred=h);if(h.isValid()){H=new F.Credential({userId:h.userId,
server:M.server,token:h.token,expires:h.expires,ssl:h.ssl,_oAuthCred:h});const e=G.appId!==h.appId&&this._doPortalSignIn(a.resUrl_);e||h.refreshToken?(a._pendingDfd=h.refreshToken?this._getOAuthToken(M.server,h.refreshToken,h.appId).then(g=>{H.expires=Date.now()+1E3*g.expires_in;H.token=g.access_token;return H}):Promise.resolve(H),a._pendingDfd.then(g=>e?this._exchangeToken(g.server,G.appId,g.token).then(t=>{g.token=t;return g}).catch(()=>g):g).then(g=>{b(g)}).catch(()=>{h?.destroy();d()})):b(H)}else if(this._oAuthLocationParams&&
this._hasSameServerInstance(G.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===h.stateUID&&h.codeVerifier))k=this._oAuthLocationParams,this._oAuthLocationParams=null,a._pendingDfd=this._processOAuthResponseParams(k,G,M).then(e=>{b(e)}).catch(c);else{const e=()=>{N?a._pendingDfd=this.oAuthSignIn(a.resUrl_,M,G,a.options_).then(b,c):(P=new K("identity-manager:not-authenticated","User is not signed in."),
c(P))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(M.server,G.appId).then(g=>{I.hasSameOrigin(g.portalUrl,this._appOrigin,!0)?(H=new F.Credential({userId:g.username,server:M.server,expires:Date.now()+1E3*g.expires_in,token:g.token}),b(H)):e()}).catch(e):e()}}else N?this._checkProtocol(a.resUrl_,M,c,a.admin_)&&(k=a.options_,a.admin_&&(k=k||{},k.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,M,k).then(b,c)):(P=new K("identity-manager:not-authenticated","User is not signed in."),
c(P))},f=()=>{const k=a.sinfo_;var q=k.owningSystemUrl;const J=a.options_;let y,M,N,G;J&&(y=J.token,M=J.error,N=J.prompt);G=this._findCredential(q,{token:y,resource:a.resUrl_});if(!G)for(const H of this.credentials)if(this._isIdProvider(q,H.server)){G=H;break}G?(q=this.findCredential(a.resUrl_,G.userId))?b(q):sa(k,this._legacyFed)?(q=G.toJSON(),q.server=k.server,q.resources=null,b(new F.Credential(q))):(a._pendingDfd=this.generateToken(this.findServerInfo(G.server),null,{serverUrl:a.resUrl_,token:G.token,
signal:a.options_.signal,ssl:G.ssl})).then(H=>{b(new F.Credential({userId:G?.userId,server:k.server,token:H.token,expires:null!=H.expires?Number(H.expires):null,ssl:!!H.ssl,isAdmin:a.admin_,validity:H.validity}))},c):(this._busy=null,y&&(a.options_.token=null),(a._pendingDfd=this.getCredential(q.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:k.owningTenant,signal:a.options_.signal,token:y,error:M,prompt:N})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},H=>{a.resUrl_=
a.sinfo_=a.refresh_=null;a.reject(H)}))};this._errbackFunc=c;const m=a.sinfo_.owningSystemUrl,r=this._isServerRsrc(a.resUrl_),z=a.sinfo_._restInfoPms;z?z.promise.then(k=>{const q=a.sinfo_;q._restInfoPms&&(q.adminTokenServiceUrl=q._restInfoPms.adminUrl,q._restInfoPms=null,q.tokenServiceUrl=(R.getDeepValue("authInfo.tokenServicesUrl",k)||R.getDeepValue("authInfo.tokenServiceUrl",k)||R.getDeepValue("tokenServiceUrl",k))??null,q.shortLivedTokenValidity=R.getDeepValue("authInfo.shortLivedTokenValidity",
k)??null,q.currentVersion=k.currentVersion,q.owningTenant=k.owningTenant,(k=q.owningSystemUrl=k.owningSystemUrl)&&this._portals.push(k));r&&q.owningSystemUrl?f():d()},()=>{a.sinfo_._restInfoPms=null;const k=new K("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");c(k)}):r&&m?f():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(k=>{const q={};let J,y,M,N;k&&(J=k.user&&k.user.username,q.username=J,q.allSSL=k.allSSL,y=k.supportsOAuth,N=parseFloat(k.currentVersion),
"multitenant"===k.portalMode&&(M=k.customBaseUrl),a.sinfo_.currentVersion=N);a.sinfo_.webTierAuth=!!J;return J&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:q.allSSL}).catch(()=>null).then(G=>{q.portalToken=G&&G.token;q.tokenExpiration=G&&G.expires;return q}):!J&&y&&4.4<=N&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:M,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>q):q}).catch(()=>null).then(k=>{a.sinfo_._selfReq=
null;k?d(k.username,k.allSSL,k.portalToken,k.tokenExpiration):d()}):d()};p._generateOAuthInfo=function(a){let b=null,c=a.portalUrl;const d=a.customBaseUrl,f=a.owningTenant;if(a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=window.location.href;let m=b.indexOf("?");-1<m&&(b=b.slice(0,m));m=b.search(/\/(apps|home)\//);b=-1<m?b.slice(0,m):null}a&&b?(this._hasTestedIfAppIsOnPortal=!0,a=B(b+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=
new ba({appId:"arcgisonline",popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this._defaultOAuthInfo)return c=c.replace(/^http:/i,"https:"),B(c+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:f,client_id:this._defaultOAuthInfo.appId,redirect_uri:I.makeAbsolute(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(m=>{if(m.data.valid){const r=this._defaultOAuthInfo.clone();r.portalUrl=m.data.urlKey&&d?"https://"+m.data.urlKey.toLowerCase()+
"."+d:c;r.popup=window!==window.top||!(I.hasSameOrigin(c,this._appOrigin)||this._gwDomains.some(z=>z.regex.test(c)&&z.regex.test(this._appOrigin)));this.oAuthInfos.push(r)}})})};p._doOAuthSignIn=function(a,b,c,d){var f=c._oAuthCred,m={portalUrl:c.portalUrl};!c.popup&&c.preserveUrlHash&&window.location.hash&&(m.hash=window.location.hash);f.stateUID&&(m.uid=f.stateUID);m={client_id:c.appId,response_type:f.codeVerifier?"code":"token",state:JSON.stringify(m),expiration:c.expiration,locale:c.locale,redirect_uri:this._getRedirectURI(c,
!!f.codeVerifier)};c.forceLogin&&(m.force_login=!0);c.forceUserId&&c.userId&&(m.prepopulatedusername=c.userId);!c.popup&&this._doPortalSignIn(a)&&(m.redirectToUserOrgUrl=!0);f.codeVerifier&&(m.code_challenge=d||f.codeVerifier,m.code_challenge_method=d?"S256":"plain");d=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize";f=d+"?"+I.objectToQuery(m);if(c.popup){const r=window.open(f,"esriJSAPIOAuth",c.popupWindowFeatures);r?(r.focus(),this._oAuthDfd.oAuthWin_=r,this._oAuthIntervalId=
setInterval(()=>{if(r.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnPopupHandle.remove();const z=this._oAuthDfd;if(z){const k=new K("identity-manager:user-aborted","ABORTED");z.reject(k)}}},500),this._oAuthOnPopupHandle=Z.on(window,["arcgis:auth:hash","arcgis:auth:location:search"],z=>{"arcgis:auth:hash"===z.type?this.setOAuthResponseHash(z.detail):this._setOAuthResponseQueryString(z.detail)})):(a=new K("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=
!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:m,authorizeUrl:d,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location.href=f};p._getRedirectURI=function(a,b){const c=window.location.href.replace(/#.*$/,"");if(a.popup)return I.makeAbsolute(a.popupCallbackUrl);if(b){const d=I.urlToObject(c);d.query&&"code error error_description message_code persist state".split(" ").forEach(f=>{delete d.query[f]});return I.addQueryParameters(d.path,d.query)}return c};return A._createClass(ca)}(W);
U.prototype.declaredClass="esri.identity.IdentityManagerBase";F.Credential=function(Y){function ca(a){var b=Y.call(this,a)||this;b._oAuthCred=null;b.tokenRefreshBuffer=2;a&&a._oAuthCred&&(b._oAuthCred=a._oAuthCred);return b}A._inherits(ca,Y);var p=ca.prototype;p.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};p.refreshToken=function(){const a=v.id.findServerInfo(this.server),b=a&&a.owningSystemUrl,c=!!b&&"server"===this.scope,d=c&&sa(a,
v.id._legacyFed);var f=a.webTierAuth;const m=f&&v.id.normalizeWebTierAuth;var r=pa[this.server];r=r&&r[this.userId];let z=this.resources&&this.resources[0],k=c?v.id.findServerInfo(b):null,q={username:this.userId,password:r},J;if(!f||m)if(c&&!k&&v.id.serverInfos.some(y=>{v.id._isIdProvider(b,y.server)&&(k=y);return!!k}),f=k?v.id.findCredential(k.server,this.userId):null,!c||f)if(d)f?.refreshToken();else{if(c)J={serverUrl:z,token:f&&f.token,ssl:f&&f.ssl};else if(m)q=null,J={ssl:this.ssl};else if(r)this.isAdmin&&
(J={isAdmin:!0});else{let y;z&&(z=v.id._sanitizeUrl(z),this._enqueued=1,y=v.id._enqueue(z,a,null,null,this.isAdmin,this),y.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return y}return v.id.generateToken(c?k:a,c?null:q,J).then(y=>{this.token=y.token;this.expires=null!=y.expires?Number(y.expires):null;this.creationTime=Date.now();this.validity=y.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>{})}};p.refreshServerTokens=function(){"portal"===
this.scope&&v.id.credentials.forEach(a=>{const b=v.id.findServerInfo(a.server),c=b&&b.owningSystemUrl;a!==this&&a.userId===this.userId&&c&&"server"===a.scope&&(v.id._hasSameServerInstance(this.server,c)||v.id._isIdProvider(c,this.server))&&(sa(b,v.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};p.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var b=this.server&&v.id.findServerInfo(this.server);
const c=(b=b&&b.owningSystemUrl)&&v.id.findServerInfo(b);!1===a||b&&"portal"!==this.scope&&(!c||!c.webTierAuth||v.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};p.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=v.id.credentials.indexOf(this);-1<a&&v.id.credentials.splice(a,1);this.emitTokenChange();
this.emit("destroy")};p.toJSON=function(){const a=V.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a};p._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,b=2**31-1;let c=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();
0>c?c=0:c>b&&(c=b);this._refreshTimer=setTimeout(this.refreshToken.bind(this),c>a?c-a:c)};return A._createClass(ca)}(W.EventedAccessor);u.__decorate([X.property()],F.Credential.prototype,"creationTime",void 0);u.__decorate([X.property()],F.Credential.prototype,"expires",void 0);u.__decorate([X.property()],F.Credential.prototype,"isAdmin",void 0);u.__decorate([X.property()],F.Credential.prototype,"oAuthState",void 0);u.__decorate([X.property()],F.Credential.prototype,"resources",void 0);u.__decorate([X.property()],
F.Credential.prototype,"scope",void 0);u.__decorate([X.property()],F.Credential.prototype,"server",void 0);u.__decorate([X.property()],F.Credential.prototype,"ssl",void 0);u.__decorate([X.property()],F.Credential.prototype,"token",void 0);u.__decorate([X.property()],F.Credential.prototype,"tokenRefreshBuffer",void 0);u.__decorate([X.property()],F.Credential.prototype,"userId",void 0);u.__decorate([X.property()],F.Credential.prototype,"validity",void 0);F.Credential=u.__decorate([ea.subclass("esri.identity.Credential")],
F.Credential);F.IdentityManagerBase=U;Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../intl/substitute ../widgets/Widget ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),
function(F,A,u,D,v,B,K,W,Z,V,R,C){D=function(ra){function I(U,ea){U=ra.call(this,U,ea)||this;U._usernameInputNode=null;U._passwordInputNode=null;U.signingIn=!1;U.server=null;U.resource=null;U.error=null;U.oAuthPrompt=!1;return U}F._inherits(I,ra);var X=I.prototype;X.render=function(){const {error:U,server:ea,resource:na,signingIn:la,oAuthPrompt:ma,messages:ba}=this,oa=C.tsx("div",{class:"esri-identity-form__group"},W.substitute(ma?ba.oAuthInfo:ba.info,{server:ea&&/\.arcgis\.com/i.test(ea)?"ArcGIS Online":
ea,resource:`(${na||ba.lblItem})`})),xa=ma?null:C.tsx("div",{class:"esri-identity-form__group",key:"username"},C.tsx("label",{class:"esri-identity-form__label"},ba.lblUser,C.tsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:V.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),pa=ma?null:C.tsx("div",{class:"esri-identity-form__group",key:"password"},C.tsx("label",{class:"esri-identity-form__label"},ba.lblPwd,C.tsx("input",{value:"",
required:!0,type:"password",bind:this,afterCreate:V.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),ua=C.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},C.tsx("input",{type:"submit",disabled:!!la,value:la?ba.lblSigning:ba.lblOk,class:"esri-button"}),C.tsx("input",{type:"button",value:ba.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),sa=U?C.tsx("div",null,U.details&&U.details.httpStatus?
ba.invalidUser:ba.noAuthService):null;return C.tsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},oa,sa,xa,pa,ua)};X._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};X._submit=function(U){U.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&
this._passwordInputNode.value})};return F._createClass(I)}(Z);A.__decorate([u.property(),R.messageBundle("esri/identity/t9n/identity")],D.prototype,"messages",void 0);A.__decorate([u.property()],D.prototype,"signingIn",void 0);A.__decorate([u.property()],D.prototype,"server",void 0);A.__decorate([u.property()],D.prototype,"resource",void 0);A.__decorate([u.property()],D.prototype,"error",void 0);A.__decorate([u.property()],D.prototype,"oAuthPrompt",void 0);return D=A.__decorate([K.subclass("esri.identity.IdentityForm")],
D)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/handleUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../widgets/Widget ../widgets/support/widget ../widgets/support/jsxFactory ../widgets/support/decorators/messageBundle".split(" "),function(F,A,u,D,v,B,K,W,Z,V,R,C,ra){function I(H,P){var h=Object.keys(H);
if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(H);P&&(e=e.filter(function(g){return Object.getOwnPropertyDescriptor(H,g).enumerable}));h.push.apply(h,e)}return h}function X(H){for(var P=1;P<arguments.length;P++){var h=null!=arguments[P]?arguments[P]:{};P%2?I(Object(h),!0).forEach(function(e){var g=h[e];a:if("object"===typeof e&&null!==e){var t=e[Symbol.toPrimitive];if(void 0!==t){e=t.call(e,"string");if("object"!==typeof e)break a;throw new TypeError("@@toPrimitive must return a primitive value.");
}e=String(e)}e="symbol"===typeof e?e:String(e);e in H?Object.defineProperty(H,e,{value:g,enumerable:!0,configurable:!0,writable:!0}):H[e]=g}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(h)):I(Object(h)).forEach(function(e){Object.defineProperty(H,e,Object.getOwnPropertyDescriptor(h,e))})}return H}B='input:not([inert]) select:not([inert]) textarea:not([inert]) a[href]:not([inert]) button:not([inert]) [tabindex]:not(slot):not([inert]) audio[controls]:not([inert]) video[controls]:not([inert]) [contenteditable]:not([contenteditable\x3d"false"]):not([inert]) details\x3esummary:first-of-type:not([inert]) details:not([inert])'.split(" ");
var U=B.join(","),ea=(K="undefined"===typeof Element)?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,na=!K&&Element.prototype.getRootNode?function(H){var P;return null===H||void 0===H?void 0:null===(P=H.getRootNode)||void 0===P?void 0:P.call(H)}:function(H){return null===H||void 0===H?void 0:H.ownerDocument},la=function e(P,h){var g;void 0===h&&(h=!0);var t=null===P||void 0===P?void 0:null===(g=P.getAttribute)||void 0===g?void 0:
g.call(P,"inert");return""===t||"true"===t||h&&P&&e(P.parentNode)},ma=function(P,h,e){if(la(P))return[];var g=Array.prototype.slice.apply(P.querySelectorAll(U));h&&ea.call(P,U)&&g.unshift(P);return g=g.filter(e)},ba=function t(h,e,g){for(var x=[],w=Array.from(h);w.length;){var E=w.shift();if(!la(E,!1))if("SLOT"===E.tagName){var O=E.assignedElements();O=t(O.length?O:E.children,!0,g);g.flatten?x.push.apply(x,O):x.push({scopeParent:E,candidates:O})}else{ea.call(E,U)&&g.filter(E)&&(e||!h.includes(E))&&
x.push(E);O=E.shadowRoot||"function"===typeof g.getShadowRoot&&g.getShadowRoot(E);var S=!la(O,!1)&&(!g.shadowRootFilter||g.shadowRootFilter(E));O&&S?(O=t(!0===O?E.children:O.children,!0,g),g.flatten?x.push.apply(x,O):x.push({scopeParent:E,candidates:O})):w.unshift.apply(w,E.children)}}return x},oa=function(h,e){if(0>h.tabIndex){if(!(e=e||/^(AUDIO|VIDEO|DETAILS)$/.test(h.tagName))){var g;e=null===h||void 0===h?void 0:null===(g=h.getAttribute)||void 0===g?void 0:g.call(h,"contenteditable");e=""===e||
"true"===e}if(e&&isNaN(parseInt(h.getAttribute("tabindex"),10)))return 0}return h.tabIndex},xa=function(h,e){return h.tabIndex===e.tabIndex?h.documentOrder-e.documentOrder:h.tabIndex-e.tabIndex},pa=function(h){return"DETAILS"===h.tagName&&Array.prototype.slice.apply(h.children).some(function(e){return"SUMMARY"===e.tagName})},ua=function(h,e){for(var g=0;g<h.length;g++)if(h[g].checked&&h[g].form===e)return h[g]},sa=function(h){if(!h.name)return!0;var e=h.form||na(h),g=function(x){return e.querySelectorAll('input[type\x3d"radio"][name\x3d"'+
x+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var t=g(window.CSS.escape(h.name));else try{t=g(h.name)}catch(x){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",x.message),!1}g=ua(t,h.form);return!g||g===h},ta=function(h){h=h.getBoundingClientRect();var e=h.height;return 0===h.width&&0===e},va=function(h,e){var g=e.displayCheck;
e=e.getShadowRoot;if("hidden"===getComputedStyle(h).visibility)return!0;var t=ea.call(h,"details\x3esummary:first-of-type")?h.parentElement:h;if(ea.call(t,"details:not([open]) *"))return!0;if(!g||"full"===g||"legacy-full"===g){if("function"===typeof e){for(t=h;h;){var x=h.parentElement,w=na(h);if(x&&!x.shadowRoot&&!0===e(x))return ta(h);h=h.assignedSlot?h.assignedSlot:x||w===h.ownerDocument?x:w.host}h=t}e=h;var E;t=e&&na(e);x=null===(E=t)||void 0===E?void 0:E.host;E=!1;if(t&&t!==e){var O,S,da;for(E=
!!(null!==(O=x)&&void 0!==O&&null!==(S=O.ownerDocument)&&void 0!==S&&S.contains(x)||null!==e&&void 0!==e&&null!==(da=e.ownerDocument)&&void 0!==da&&da.contains(e));!E&&x;){var ia,aa,fa;t=na(x);x=null===(ia=t)||void 0===ia?void 0:ia.host;E=!(null===(aa=x)||void 0===aa||null===(fa=aa.ownerDocument)||void 0===fa||!fa.contains(x))}}if(E)return!h.getClientRects().length;if("legacy-full"!==g)return!0}else if("non-zero-area"===g)return ta(h);return!1},Y=function(h,e){var g;(g=e.disabled||la(e))||(g="INPUT"===
e.tagName&&"hidden"===e.type);if(!(h=g||va(e,h)||pa(e)))a:{if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(h=e.parentElement;h;){if("FIELDSET"===h.tagName&&h.disabled){for(g=0;g<h.children.length;g++){var t=h.children.item(g);if("LEGEND"===t.tagName){h=ea.call(h,"fieldset[disabled] *")?!0:!t.contains(e);break a}}h=!0;break a}h=h.parentElement}h=!1}return h?!1:!0},ca=function(h,e){return"INPUT"===e.tagName&&"radio"===e.type&&!sa(e)||0>oa(e)||!Y(h,e)?!1:!0},p=function(h){h=parseInt(h.getAttribute("tabindex"),
10);return isNaN(h)||0<=h?!0:!1},a=function g(e){var t=[],x=[];e.forEach(function(w,E){var O=!!w.scopeParent,S=O?w.scopeParent:w,da=oa(S,O),ia=O?g(w.candidates):S;0===da?O?t.push.apply(t,ia):t.push(S):x.push({documentOrder:E,tabIndex:da,item:w,isScope:O,content:ia})});return x.sort(xa).reduce(function(w,E){E.isScope?w.push.apply(w,E.content):w.push(E.content);return w},[]).concat(t)},b=function(e,g){g=g||{};e=g.getShadowRoot?ba([e],g.includeContainer,{filter:ca.bind(null,g),flatten:!1,getShadowRoot:g.getShadowRoot,
shadowRootFilter:p}):ma(e,g.includeContainer,ca.bind(null,g));return a(e)},c=function(e,g){g=g||{};return g.getShadowRoot?ba([e],g.includeContainer,{filter:Y.bind(null,g),flatten:!0,getShadowRoot:g.getShadowRoot}):ma(e,g.includeContainer,Y.bind(null,g))},d=function(e,g){g=g||{};if(!e)throw Error("No node provided");return!1===ea.call(e,U)?!1:ca(g,e)},f=B.concat("iframe").join(","),m=function(e,g){g=g||{};if(!e)throw Error("No node provided");return!1===ea.call(e,f)?!1:Y(g,e)},r={activateTrap:function(e,
g){if(0<e.length){var t=e[e.length-1];t!==g&&t.pause()}t=e.indexOf(g);-1!==t&&e.splice(t,1);e.push(g)},deactivateTrap:function(e,g){g=e.indexOf(g);-1!==g&&e.splice(g,1);0<e.length&&e[e.length-1].unpause()}},z=function(e){return"Tab"===e.key||9===e.keyCode},k=function(e){return z(e)&&!e.shiftKey},q=function(e){return z(e)&&e.shiftKey},J=function(e,g){var t=-1;e.every(function(x,w){return g(x)?(t=w,!1):!0});return t},y=function(e){for(var g=arguments.length,t=Array(1<g?g-1:0),x=1;x<g;x++)t[x-1]=arguments[x];
return"function"===typeof e?e.apply(void 0,t):e},M=function(e){return e.target.shadowRoot&&"function"===typeof e.composedPath?e.composedPath()[0]:e.target},N=[],G=function(e,g){var t=(null===g||void 0===g?void 0:g.document)||document,x=(null===g||void 0===g?void 0:g.trapStack)||N,w=X({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:k,isKeyBackward:q},g),E=[],O=[],S=[],da=null,ia=null,aa=!1,fa=!1,ya=void 0,ka=function(T,l,n){return T&&void 0!==T[l]?T[l]:w[n||l]},za=
function(T,l){var n="function"===typeof(null===l||void 0===l?void 0:l.composedPath)?l.composedPath():void 0;return O.findIndex(function(L){var Q=L.container;L=L.tabbableNodes;return Q.contains(T)||(null===n||void 0===n?void 0:n.includes(Q))||L.find(function(ha){return ha===T})})},Aa=function(T){var l=w[T];if("function"===typeof l){for(var n=arguments.length,L=Array(1<n?n-1:0),Q=1;Q<n;Q++)L[Q-1]=arguments[Q];l=l.apply(void 0,L)}!0===l&&(l=void 0);if(!l){if(void 0===l||!1===l)return l;throw Error("`".concat(T,
"` was specified but was not a node, or did not return a node"));}n=l;if("string"===typeof l&&(n=t.querySelector(l),!n))throw Error("`".concat(T,"` as selector refers to no known node"));return n},Ba=function(){var T=Aa("initialFocus");if(!1===T)return!1;void 0!==T&&m(T,w.tabbableOptions)||(T=0<=za(t.activeElement)?t.activeElement:(T=S[0])&&T.firstTabbableNode||Aa("fallbackFocus"));if(!T)throw Error("Your focus-trap needs to have at least one focusable element");return T},Ca=function(){O=E.map(function(T){var l=
b(T,w.tabbableOptions),n=c(T,w.tabbableOptions);return{container:T,tabbableNodes:l,focusableNodes:n,firstTabbableNode:0<l.length?l[0]:null,lastTabbableNode:0<l.length?l[l.length-1]:null,nextTabbableNode:function(L){var Q=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,ha=n.findIndex(function(ja){return ja===L});if(!(0>ha))return Q?n.slice(ha+1).find(function(ja){return d(ja,w.tabbableOptions)}):n.slice(0,ha).reverse().find(function(ja){return d(ja,w.tabbableOptions)})}}});S=O.filter(function(T){return 0<
T.tabbableNodes.length});if(0>=S.length&&!Aa("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},wa=function n(l){!1!==l&&l!==t.activeElement&&(l&&l.focus?(l.focus({preventScroll:!!w.preventScroll}),ia=l,l.tagName&&"input"===l.tagName.toLowerCase()&&"function"===typeof l.select&&l.select()):n(Ba()))},Ha=function(l){var n=Aa("setReturnFocus",l);return n?n:!1===n?!1:l},Ea=function(l){var n=M(l);0<=za(n,l)||(y(w.clickOutsideDeactivates,
l)?qa.deactivate({returnFocus:w.returnFocusOnDeactivate}):y(w.allowOutsideClick,l)||l.preventDefault())},Ia=function(l){var n=M(l),L=0<=za(n,l);L||n instanceof Document?L&&(ia=n):(l.stopImmediatePropagation(),wa(ia||Ba()))},Na=function(l){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,L=M(l);Ca();var Q=null;if(0<S.length){var ha=za(L,l),ja=0<=ha?O[ha]:void 0;0>ha?Q=n?S[S.length-1].lastTabbableNode:S[0].firstTabbableNode:n?(n=J(S,function(Fa){return L===Fa.firstTabbableNode}),0>n&&
(ja.container===L||m(L,w.tabbableOptions)&&!d(L,w.tabbableOptions)&&!ja.nextTabbableNode(L,!1))&&(n=ha),0<=n?Q=S[0===n?S.length-1:n-1].lastTabbableNode:z(l)||(Q=ja.nextTabbableNode(L,!1))):(n=J(S,function(Fa){return L===Fa.lastTabbableNode}),0>n&&(ja.container===L||m(L,w.tabbableOptions)&&!d(L,w.tabbableOptions)&&!ja.nextTabbableNode(L))&&(n=ha),0<=n?Q=S[n===S.length-1?0:n+1].firstTabbableNode:z(l)||(Q=ja.nextTabbableNode(L)))}else Q=Aa("fallbackFocus");Q&&(z(l)&&l.preventDefault(),wa(Q))},Ja=function(l){"Escape"!==
l.key&&"Esc"!==l.key&&27!==l.keyCode||!1===y(w.escapeDeactivates,l)?(w.isKeyForward(l)||w.isKeyBackward(l))&&Na(l,w.isKeyBackward(l)):(l.preventDefault(),qa.deactivate())},Ka=function(l){var n=M(l);0<=za(n,l)||y(w.clickOutsideDeactivates,l)||y(w.allowOutsideClick,l)||(l.preventDefault(),l.stopImmediatePropagation())},La=function(){if(aa)return r.activateTrap(x,qa),ya=w.delayInitialFocus?setTimeout(function(){wa(Ba())},0):wa(Ba()),t.addEventListener("focusin",Ia,!0),t.addEventListener("mousedown",
Ea,{capture:!0,passive:!1}),t.addEventListener("touchstart",Ea,{capture:!0,passive:!1}),t.addEventListener("click",Ka,{capture:!0,passive:!1}),t.addEventListener("keydown",Ja,{capture:!0,passive:!1}),qa},Ma=function(){if(aa)return t.removeEventListener("focusin",Ia,!0),t.removeEventListener("mousedown",Ea,!0),t.removeEventListener("touchstart",Ea,!0),t.removeEventListener("click",Ka,!0),t.removeEventListener("keydown",Ja,!0),qa};g=function(l){l.some(function(n){return Array.from(n.removedNodes).some(function(L){return L===
ia})})&&wa(Ba())};var Ga="undefined"!==typeof window&&"MutationObserver"in window?new MutationObserver(g):void 0,Da=function(){Ga&&(Ga.disconnect(),aa&&!fa&&E.map(function(l){Ga.observe(l,{subtree:!0,childList:!0})}))};var qa={get active(){return aa},get paused(){return fa},activate:function(l){if(aa)return this;var n=ka(l,"onActivate"),L=ka(l,"onPostActivate"),Q=ka(l,"checkCanFocusTrap");Q||Ca();aa=!0;fa=!1;da=t.activeElement;null===n||void 0===n?void 0:n();l=function(){Q&&Ca();La();Da();null===
L||void 0===L?void 0:L()};if(Q)return Q(E.concat()).then(l,l),this;l();return this},deactivate:function(l){if(!aa)return this;var n=X({onDeactivate:w.onDeactivate,onPostDeactivate:w.onPostDeactivate,checkCanReturnFocus:w.checkCanReturnFocus},l);clearTimeout(ya);ya=void 0;Ma();fa=aa=!1;Da();r.deactivateTrap(x,qa);var L=ka(n,"onDeactivate"),Q=ka(n,"onPostDeactivate");l=ka(n,"checkCanReturnFocus");var ha=ka(n,"returnFocus","returnFocusOnDeactivate");null===L||void 0===L?void 0:L();n=function(){setTimeout(function(){ha&&
wa(Ha(da));null===Q||void 0===Q?void 0:Q()},0)};if(ha&&l)return l(Ha(da)).then(n,n),this;n();return this},pause:function(l){if(fa||!aa)return this;var n=ka(l,"onPause");l=ka(l,"onPostPause");fa=!0;null===n||void 0===n?void 0:n();Ma();Da();null===l||void 0===l?void 0:l();return this},unpause:function(l){if(!fa||!aa)return this;var n=ka(l,"onUnpause");l=ka(l,"onPostUnpause");fa=!1;null===n||void 0===n?void 0:n();Ca();La();Da();null===l||void 0===l?void 0:l();return this},updateContainerElements:function(l){E=
[].concat(l).filter(Boolean).map(function(n){return"string"===typeof n?t.querySelector(n):n});aa&&Ca();Da();return this}};qa.updateContainerElements(e);return qa};V=function(e){function g(x,w){var E=e.call(this,x,w)||this;E.container=document.createElement("div");E.content=null;E.open=!1;E._focusTrap=null;E._close=()=>{E.open=!1};document.body.appendChild(E.container);E.addHandles(D.watch(()=>E.open,()=>E._toggleFocusTrap()));return E}F._inherits(g,e);var t=g.prototype;t.destroy=function(){this._destroyFocusTrap()};
t.render=function(){var x=this.id;const {open:w,content:E,title:O,messages:S}=this;var da=w&&!!E;const ia={["esri-identity-modal--open"]:da,["esri-identity-modal--closed"]:!da},aa=C.tsx("button",{class:"esri-identity-modal__close-button","aria-label":S.close,title:S.close,bind:this,onclick:this._close,type:"button"},C.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),fa=`${x}_title`;x=`${x}_content`;const ya=O?C.tsx("h1",{id:fa,class:"esri-identity-modal__title"},O):null;da=da?C.tsx("div",
{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":fa,"aria-describedby":x,afterCreate:this._createFocusTrap},aa,ya,this._renderContent(x)):null;return C.tsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",ia)},da)};t._destroyFocusTrap=function(){this._focusTrap?.deactivate({onDeactivate:()=>{}});this._focusTrap=null};t._toggleFocusTrap=function(){const {_focusTrap:x,open:w}=this;x&&(w?x.activate():x.deactivate())};t._createFocusTrap=function(x){this._destroyFocusTrap();
const w=requestAnimationFrame(()=>{this._focusTrap=G(x,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.addHandles(u.makeHandle(()=>cancelAnimationFrame(w)))};t._renderContent=function(x){const w=this.content;return"string"===typeof w?C.tsx("div",{class:"esri-identity-modal__content",id:x,innerHTML:w}):R.isWidget(w)?C.tsx("div",{class:"esri-identity-modal__content",id:x},w.render()):w instanceof HTMLElement?C.tsx("div",{class:"esri-identity-modal__content",id:x,bind:w,
afterCreate:this._attachToNode}):null};t._attachToNode=function(x){x.appendChild(this)};F._createClass(g,[{key:"title",get:function(){return this.messages?.auth.signIn}}]);return g}(V);A.__decorate([v.property({readOnly:!0})],V.prototype,"container",void 0);A.__decorate([v.property()],V.prototype,"content",void 0);A.__decorate([v.property()],V.prototype,"open",void 0);A.__decorate([v.property(),ra.messageBundle("esri/t9n/common")],V.prototype,"messages",void 0);A.__decorate([v.property()],V.prototype,
"title",null);return V=A.__decorate([Z.subclass("esri.identity.IdentityModal")],V)})},"esri/identity/OAuthCredential":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(F){let A=function(){function u(v,B){this.userId=this.token=this.stateUID=this.ssl=this.refreshToken=this.expires=this.codeVerifier=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=v;this.storage=B;this._init()}var D=u.prototype;D.isValid=function(){let v=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||
this.token))if(null==this.expires&&this.refreshToken)v=!0;else if(this.expires){const B=Date.now();this.expires>B&&(this.expires-B)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(v=!0)}return v};D.save=function(){if(!this.storage)return!1;const v=this._load(),B=this.oAuthInfo;if(B&&B.authNamespace&&B.portalUrl){let K=v[B.authNamespace];K||(K=v[B.authNamespace]={});this.appId||(this.appId=B.appId);K[B.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,
ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(v))}catch(W){return console.warn(W),!1}return!0}return!1};D.destroy=function(){const v=this._load(),B=this.oAuthInfo;if(B&&B.appId&&B.portalUrl&&(null==this.expires||this.expires>Date.now())&&(this.refreshToken||this.token)){var K=B.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const W=new FormData;W.append("f","json");W.append("auth_token",this.refreshToken||
this.token);W.append("client_id",B.appId);W.append("token_type_hint",this.refreshToken?"refresh_token":"access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(K,W);else{const Z=new XMLHttpRequest;Z.open("POST",K);Z.send(W)}}if(B&&B.authNamespace&&B.portalUrl&&this.storage&&(K=v[B.authNamespace])){delete K[B.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(v))}catch(W){console.log(W)}}B&&(this.oAuthInfo=B._oAuthCred=null)};D._init=function(){var v=this._load();
const B=this.oAuthInfo;B&&B.authNamespace&&B.portalUrl&&(v=v[B.authNamespace])&&(v=v[B.portalUrl])&&(this.appId=v.appId,this.codeVerifier=v.codeVerifier,this.expires=v.expires,this.refreshToken=v.refreshToken,this.ssl=v.ssl,this.stateUID=v.stateUID,this.token=v.token,this.userId=v.userId)};D._load=function(){let v={};if(this.storage){const B=this.storage.getItem("esriJSAPIOAuth");if(B)try{v=JSON.parse(B)}catch(K){console.warn(K)}}return v};return F._createClass(u)}();A.prototype.declaredClass="esri.identity.OAuthCredential";
return A})},"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(F,A,u,D,v,B,K,W){var Z;u=Z=function(V){function R(C){C=V.call(this,C)||this;C._oAuthCred=null;C.appId=null;C.authNamespace="/";C.expiration=20160;C.flowType="auto";C.forceLogin=!1;C.forceUserId=
!1;C.locale=null;C.minTimeUntilExpiration=30;C.popup=!1;C.popupCallbackUrl="oauth-callback.html";C.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";C.portalUrl="https://www.arcgis.com";C.preserveUrlHash=!1;C.userId=null;return C}F._inherits(R,V);R.prototype.clone=function(){return Z.fromJSON(this.toJSON())};return F._createClass(R)}(u.JSONSupport);A.__decorate([D.property({json:{write:!0}})],u.prototype,"appId",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,
"authNamespace",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"expiration",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"flowType",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"forceLogin",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"forceUserId",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"locale",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"minTimeUntilExpiration",void 0);A.__decorate([D.property({json:{write:!0}})],
u.prototype,"popup",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"popupCallbackUrl",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"popupWindowFeatures",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"portalUrl",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"preserveUrlHash",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"userId",void 0);return u=Z=A.__decorate([W.subclass("esri.identity.OAuthInfo")],u)})},
"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(F,A,u,D,v,B,K,W){u=function(Z){function V(R){R=Z.call(this,R)||this;R.adminTokenServiceUrl=null;R.currentVersion=null;R.hasPortal=null;R.hasServer=null;R.owningSystemUrl=null;R.owningTenant=null;R.server=
null;R.shortLivedTokenValidity=null;R.tokenServiceUrl=null;R.webTierAuth=null;return R}F._inherits(V,Z);return F._createClass(V)}(u.JSONSupport);A.__decorate([D.property({json:{write:!0}})],u.prototype,"adminTokenServiceUrl",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"currentVersion",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"hasPortal",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"hasServer",void 0);A.__decorate([D.property({json:{write:!0}})],
u.prototype,"owningSystemUrl",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"owningTenant",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"server",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"shortLivedTokenValidity",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"tokenServiceUrl",void 0);A.__decorate([D.property({json:{write:!0}})],u.prototype,"webTierAuth",void 0);return u=A.__decorate([W.subclass("esri.identity.ServerInfo")],
u)})},"*noref":1}});define(["../chunks/_rollupPluginBabelHelpers","../kernel","./IdentityManagerBase"],function(F,A,u){u=function(D){function v(){return D.apply(this,arguments)||this}F._inherits(v,D);return F._createClass(v)}(u.IdentityManagerBase);u.prototype.declaredClass="esri.identity.IdentityManager";u=new u;A.setId(u);return u});