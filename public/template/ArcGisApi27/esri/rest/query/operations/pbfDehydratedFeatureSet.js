// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/compilerUtils ../../../core/uid ../../../geometry/SpatialReference ../../../geometry/support/zscale ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/featureConversionUtils ../../../layers/support/Field".split(" "),function(m,k,r,t,u,v,n,p,w){function x(f,c){return c}function l(f,c,a,b){switch(a){case 0:return h(f,c+b,0);case 1:return"lowerLeft"===f.originPosition?h(f,c+b,1):y(f,c+b,1)}}function q(f,c,a,b){switch(a){case 2:return h(f,
c,2);default:return l(f,c,a,b)}}function z(f,c,a,b){switch(a){case 2:return h(f,c,3);default:return l(f,c,a,b)}}function A(f,c,a,b){switch(a){case 3:return h(f,c,3);default:return q(f,c,a,b)}}function h({translate:f,scale:c},a,b){return f[b]+a*c[b]}function y({translate:f,scale:c},a,b){return f[b]-a*c[b]}let B=function(){function f(a){this._options=a;this.geometryTypes=["point","multipoint","polyline","polygon"];this._previousCoordinate=[0,0];this._transform=null;this._applyTransform=x;this._lengths=
[];this._vertexDimension=this._toAddInCurrentPath=this._currentLengthIndex=0;this._coordinateBuffer=null;this._coordinateBufferPtr=0;this._attributesConstructor=function(){return k._createClass(function(){})}()}var c=f.prototype;c.createFeatureResult=function(){return new n.DehydratedFeatureSetClass};c.finishFeatureResult=function(a){this._options.applyTransform&&(a.transform=null);this._attributesConstructor=function(){return k._createClass(function(){})}();this._coordinateBuffer=null;this._lengths.length=
0;if(a.hasZ){var b=v.getGeometryZScaler(a.geometryType,this._options.sourceSpatialReference,a.spatialReference);if(null!=b)for(const d of a.features)b(d.geometry)}};c.createSpatialReference=function(){return new u};c.addField=function(a,b){a.fields.push(w.fromJSON(b));const d=a.fields.map(e=>e.name);this._attributesConstructor=function(){for(const e of d)this[e]=null}};c.addFeature=function(a,b){const d=this._options.maxStringAttributeLength??0;if(0<d)for(const e in b.attributes){const g=b.attributes[e];
"string"===typeof g&&g.length>d&&(b.attributes[e]="")}a.features.push(b)};c.addQueryGeometry=function(a,b){const {queryGeometry:d,queryGeometryType:e}=b;b=p.unquantizeOptimizedGeometry(d.clone(),d,!1,!1,this._transform);b=p.convertToGeometry(b,e,!1,!1);let g=null;switch(e){case "esriGeometryPoint":g="point";break;case "esriGeometryPolygon":g="polygon";break;case "esriGeometryPolyline":g="polyline";break;case "esriGeometryMultipoint":g="multipoint"}b.type=g;a.queryGeometryType=e;a.queryGeometry=b};
c.prepareFeatures=function(a){this._transform=a.transform??null;this._options.applyTransform&&a.transform&&(this._applyTransform=this._deriveApplyTransform(a));this._vertexDimension=2;a.hasZ&&this._vertexDimension++;a.hasM&&this._vertexDimension++;switch(a.geometryType){case "point":this.addCoordinate=(b,d,e)=>this.addCoordinatePoint(b,d,e);this.createGeometry=b=>this.createPointGeometry(b);break;case "polygon":this.addCoordinate=(b,d,e)=>this._addCoordinatePolygon(b,d,e);this.createGeometry=b=>this._createPolygonGeometry(b);
break;case "polyline":this.addCoordinate=(b,d,e)=>this._addCoordinatePolyline(b,d,e);this.createGeometry=b=>this._createPolylineGeometry(b);break;case "multipoint":this.addCoordinate=(b,d,e)=>this._addCoordinateMultipoint(b,d,e);this.createGeometry=b=>this._createMultipointGeometry(b);break;case "mesh":case "extent":break;default:r.neverReached(a.geometryType)}};c.createFeature=function(){this._currentLengthIndex=this._lengths.length=0;this._previousCoordinate[0]=0;this._previousCoordinate[1]=0;return new n.DehydratedFeatureClass(t.generateUID(),
null,new this._attributesConstructor)};c.allocateCoordinates=function(){const a=this._lengths.reduce((b,d)=>b+d,0);this._coordinateBuffer=new Float64Array(a*this._vertexDimension);this._coordinateBufferPtr=0};c.addLength=function(a,b){0===this._lengths.length&&(this._toAddInCurrentPath=b);this._lengths.push(b)};c.createPointGeometry=function(a){a={type:"point",x:0,y:0,spatialReference:a.spatialReference,hasZ:!!a.hasZ,hasM:!!a.hasM};a.hasZ&&(a.z=0);a.hasM&&(a.m=0);return a};c.addCoordinatePoint=function(a,
b,d){b=this._transform?this._applyTransform(this._transform,b,d,0):b;if(null!=b)switch(d){case 0:a.x=b;break;case 1:a.y=b;break;case 2:a.hasZ?a.z=b:a.m=b;break;case 3:a.m=b}};c._transformPathLikeValue=function(a,b){let d=0;1>=b&&(d=this._previousCoordinate[b],this._previousCoordinate[b]+=a);return this._transform?this._applyTransform(this._transform,a,b,d):a};c._addCoordinatePolyline=function(a,b,d){this._dehydratedAddPointsCoordinate(a.paths,b,d)};c._addCoordinatePolygon=function(a,b,d){this._dehydratedAddPointsCoordinate(a.rings,
b,d)};c._addCoordinateMultipoint=function(a,b,d){0===d&&a.points.push([]);b=this._transformPathLikeValue(b,d);a.points[a.points.length-1].push(b)};c._createPolygonGeometry=function(a){return{type:"polygon",rings:[[]],spatialReference:a.spatialReference,hasZ:!!a.hasZ,hasM:!!a.hasM}};c._createPolylineGeometry=function(a){return{type:"polyline",paths:[[]],spatialReference:a.spatialReference,hasZ:!!a.hasZ,hasM:!!a.hasM}};c._createMultipointGeometry=function(a){return{type:"multipoint",points:[],spatialReference:a.spatialReference,
hasZ:!!a.hasZ,hasM:!!a.hasM}};c._dehydratedAddPointsCoordinate=function(a,b,d){0===d&&0===this._toAddInCurrentPath--&&(a.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);b=this._transformPathLikeValue(b,d);a=a[a.length-1];const e=this._coordinateBuffer;e&&(0===d&&a.push(new Float64Array(e.buffer,this._coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this._vertexDimension)),e[this._coordinateBufferPtr++]=b)};
c._deriveApplyTransform=function(a){const {hasZ:b,hasM:d}=a;return b&&d?A:b?q:d?z:l};return k._createClass(f)}();m.DehydratedFeatureSetParserContext=B;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});