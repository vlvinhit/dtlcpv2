// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/has ../../core/jsonMap ../../core/JSONSupport ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../utils ../geoprocessor/GPOptions ../geoprocessor/utils ./GPMessage".split(" "),function(y,v,k,p,w,z,e,t,m,F,G,A,B,n,C,q,D){var r;
w=z.strict()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});e=r=function(x){function u(a){a=x.call(this,a)||this;a.jobId=null;a.jobStatus=null;a.messages=null;a.progress=null;a.requestOptions=
null;a.sourceUrl=null;a._timer=void 0;return a}v._inherits(u,x);var g=u.prototype;g.cancelJob=async function(a){const {jobId:b,sourceUrl:d}=this;var {path:c}=n.parseUrl(d);a={...this.requestOptions,...a,query:{f:"json"}};this._clearTimer();({data:c}=await p(`${c}/jobs/${b}/cancel`,a));const {messages:f,jobStatus:l,progress:h}=r.fromJSON(c);this.set({messages:f,jobStatus:l,progress:h});return this};g.destroy=function(){clearInterval(this._timer)};g.checkJobStatus=async function(a){const {path:b}=n.parseUrl(this.sourceUrl);
({data:a}=await p(`${b}/jobs/${this.jobId}`,{...this.requestOptions,...a,query:{f:"json"}}));const {messages:d,jobStatus:c,progress:f}=r.fromJSON(a);this.set({messages:d,jobStatus:c,progress:f});return this};g.fetchResultData=async function(a,b,d){b=C.from(b||{});const {returnFeatureCollection:c,returnM:f,returnZ:l,outSpatialReference:h}=b;({path:b}=n.parseUrl(this.sourceUrl));const E=q.gpEncode({returnFeatureCollection:c,returnM:f,returnZ:l,outSR:h,returnType:"data",f:"json"},null);({data:a}=await p(`${b}/jobs/${this.jobId}/results/${a}`,
{...this.requestOptions,...d,query:E}));return q.decode(a)};g.fetchResultImage=async function(a,b,d){const {path:c}=n.parseUrl(this.sourceUrl);b={...b.toJSON(),f:"json"};b=q.gpEncode(b);({data:a}=await p(`${c}/jobs/${this.jobId}/results/${a}`,{...this.requestOptions,...d,query:b}));return q.decode(a)};g.fetchResultMapImageLayer=async function(){var {path:a}=n.parseUrl(this.sourceUrl);const b=a.indexOf("/GPServer/");a=`${a.substring(0,b)}/MapServer/jobs/${this.jobId}`;return new (await new Promise((d,
c)=>y(["../../layers/MapImageLayer"],f=>d(Object.freeze(Object.defineProperty({__proto__:null,default:f},Symbol.toStringTag,{value:"Module"}))),c))).default({url:a})};g.waitForJobCompletion=async function(a={}){const {interval:b=1E3,signal:d,statusCallback:c}=a;return new Promise((f,l)=>{t.onAbort(d,()=>{this._clearTimer();l(t.createAbortError())});this._clearTimer();this._timer=setInterval(()=>{this._timer||l(t.createAbortError());this.checkJobStatus(this.requestOptions).then(h=>{({jobStatus:h}=
h);this.jobStatus=h;switch(h){case "job-succeeded":this._clearTimer();f(this);break;case "job-submitted":case "job-executing":case "job-waiting":case "job-new":c&&c(this);break;case "job-cancelled":case "job-cancelling":case "job-deleted":case "job-deleting":case "job-timed-out":case "job-failed":this._clearTimer(),l(this)}})},b)})};g._clearTimer=function(){clearInterval(this._timer);this._timer=void 0};return v._createClass(u)}(e.JSONSupport);k.__decorate([m.property()],e.prototype,"jobId",void 0);
k.__decorate([A.enumeration(w,{ignoreUnknown:!1})],e.prototype,"jobStatus",void 0);k.__decorate([m.property({type:[D]})],e.prototype,"messages",void 0);k.__decorate([m.property()],e.prototype,"progress",void 0);k.__decorate([m.property()],e.prototype,"requestOptions",void 0);k.__decorate([m.property({json:{write:!0}})],e.prototype,"sourceUrl",void 0);return e=r=k.__decorate([B.subclass("esri.rest.support.JobInfo")],e)});