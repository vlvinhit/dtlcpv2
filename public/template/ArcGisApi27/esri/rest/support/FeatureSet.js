// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/SpatialReference ../../geometry/support/jsonUtils ../../layers/support/Field".split(" "),function(B,q,F,C,n,
G,H,t,L,D,I,E,x,w,J){var y;const z=new n.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});n=y=function(u){function A(b){b=u.call(this,b)||this;b.displayFieldName=null;b.exceededTransferLimit=!1;b.features=[];b.fields=null;b.geometryType=null;b.hasM=!1;b.hasZ=!1;b.queryGeometry=null;b.spatialReference=null;return b}B._inherits(A,u);var r=A.prototype;r.readFeatures=
function(b,k){k=x.fromJSON(k.spatialReference);const g=[];for(let a=0;a<b.length;a++){var c=b[a];const h=C.fromJSON(c);var f=c.geometry&&c.geometry.spatialReference;null==h.geometry||f||(h.geometry.spatialReference=k);c=c.aggregateGeometries;f=h.aggregateGeometries;if(c&&null!=f)for(const d in f){const e=f[d],l=c[d]?.spatialReference;null==e||l||(e.spatialReference=k)}g.push(h)}return g};r.writeGeometryType=function(b,k,g,c){if(b)z.write(b,k,g,c);else if({features:b}=this,b)for(const f of b)if(f&&
null!=f.geometry){z.write(f.geometry.type,k,g,c);break}};r.readQueryGeometry=function(b,k){if(!b)return null;const g=!!b.spatialReference;(b=w.fromJSON(b))&&!g&&k.spatialReference&&(b.spatialReference=x.fromJSON(k.spatialReference));return b};r.writeSpatialReference=function(b,k){if(b)k.spatialReference=b.toJSON();else if({features:b}=this,b)for(const g of b)if(g&&null!=g.geometry&&g.geometry.spatialReference){k.spatialReference=g.geometry.spatialReference.toJSON();break}};r.clone=function(){return new y(this.cloneProperties())};
r.cloneProperties=function(){return H.clone({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})};r.toJSON=function(b){const k=this.write();if(k.features&&Array.isArray(b)&&0<b.length)for(let g=0;g<k.features.length;g++){const c=k.features[g];if(c.geometry){const f=
b&&b[g];c.geometry=f&&f.toJSON()||c.geometry}}return k};r.quantize=function(b){const {scale:[k,g],translate:[c,f]}=b,a=this.features,h=this._getQuantizationFunction(this.geometryType,d=>Math.round((d-c)/k),d=>Math.round((f-d)/g));for(let d=0,e=a.length;d<e;d++)h?.(a[d].geometry)||(a.splice(d,1),d--,e--);this.transform=b;return this};r.unquantize=function(){const {geometryType:b,features:k,transform:g}=this;if(!g)return this;const {translate:[c,f],scale:[a,h]}=g;var d=null;let e=null;if(this.hasZ&&
null!=g?.scale?.[2]){const {translate:[,,l],scale:[,,m]}=g;d=p=>p*m+l}if(this.hasM&&null!=g?.scale?.[3]){const {translate:[,,,l],scale:[,,,m]}=g;e=p=>null==p?p:p*m+l}d=this._getHydrationFunction(b,l=>l*a+c,l=>f-l*h,d,e);for(const {geometry:l}of k)null!=l&&d&&d(l);this.transform=null;return this};r._quantizePoints=function(b,k,g){let c,f;const a=[];for(let d=0,e=b.length;d<e;d++){var h=b[d];if(0<d){const l=k(h[0]);h=g(h[1]);if(l!==c||h!==f)a.push([l-c,h-f]),c=l,f=h}else c=k(h[0]),f=g(h[1]),a.push([c,
f])}return 0<a.length?a:null};r._getQuantizationFunction=function(b,k,g){return"point"===b?c=>{c.x=k(c.x);c.y=g(c.y);return c}:"polyline"===b||"polygon"===b?c=>{const f=w.isPolygon(c)?c.rings:c.paths,a=[];for(let h=0,d=f.length;h<d;h++){const e=this._quantizePoints(f[h],k,g);e&&a.push(e)}return 0<a.length?(w.isPolygon(c)?c.rings=a:c.paths=a,c):null}:"multipoint"===b?c=>{const f=this._quantizePoints(c.points,k,g);return f&&0<f.length?(c.points=f,c):null}:"extent"===b?c=>c:null};r._getHydrationFunction=
function(b,k,g,c,f){return"point"===b?a=>{a.x=k(a.x);a.y=g(a.y);c&&(a.z=c(a.z))}:"polyline"===b||"polygon"===b?a=>{a=w.isPolygon(a)?a.rings:a.paths;for(let e=0,l=a.length;e<l;e++){const m=a[e];for(let p=0,K=m.length;p<K;p++){const v=m[p];if(0<p)h+=v[0],d+=v[1];else{var h=v[0];var d=v[1]}v[0]=k(h);v[1]=g(d)}}if(c&&f)for(let e=0,l=a.length;e<l;e++){h=a[e];for(let m=0,p=h.length;m<p;m++)d=h[m],d[2]=c(d[2]),d[3]=f(d[3])}else if(c)for(let e=0,l=a.length;e<l;e++){h=a[e];for(let m=0,p=h.length;m<p;m++)d=
h[m],d[2]=c(d[2])}else if(f)for(let e=0,l=a.length;e<l;e++){h=a[e];for(let m=0,p=h.length;m<p;m++)d=h[m],d[2]=f(d[2])}}:"extent"===b?a=>{a.xmin=k(a.xmin);a.ymin=g(a.ymin);a.xmax=k(a.xmax);a.ymax=g(a.ymax);c&&null!=a.zmax&&null!=a.zmin&&(a.zmax=c(a.zmax),a.zmin=c(a.zmin));f&&null!=a.mmax&&null!=a.mmin&&(a.mmax=f(a.mmax),a.mmin=f(a.mmin))}:"multipoint"===b?a=>{a=a.points;let h;for(let e=0,l=a.length;e<l;e++){const m=a[e];if(0<e)d+=m[0],h+=m[1];else{var d=m[0];h=m[1]}m[0]=k(d);m[1]=g(h)}if(c&&f)for(let e=
0,l=a.length;e<l;e++)d=a[e],d[2]=c(d[2]),d[3]=f(d[3]);else if(c)for(let e=0,l=a.length;e<l;e++)d=a[e],d[2]=c(d[2]);else if(f)for(let e=0,l=a.length;e<l;e++)d=a[e],d[2]=f(d[2])}:null};return B._createClass(A)}(G.JSONSupport);q.__decorate([t.property({type:String,json:{write:!0}})],n.prototype,"displayFieldName",void 0);q.__decorate([t.property({type:Boolean,json:{write:{overridePolicy(u){return{enabled:u}}}}})],n.prototype,"exceededTransferLimit",void 0);q.__decorate([t.property({type:[C],json:{write:!0}})],
n.prototype,"features",void 0);q.__decorate([D.reader("features")],n.prototype,"readFeatures",null);q.__decorate([t.property({type:[J],json:{write:!0}})],n.prototype,"fields",void 0);q.__decorate([t.property({type:"point multipoint polyline polygon extent mesh".split(" "),json:{read:{reader:z.read}}})],n.prototype,"geometryType",void 0);q.__decorate([E.writer("geometryType")],n.prototype,"writeGeometryType",null);q.__decorate([t.property({type:Boolean,json:{write:{overridePolicy(u){return{enabled:u}}}}})],
n.prototype,"hasM",void 0);q.__decorate([t.property({type:Boolean,json:{write:{overridePolicy(u){return{enabled:u}}}}})],n.prototype,"hasZ",void 0);q.__decorate([t.property({types:F.geometryTypes,json:{write:!0}})],n.prototype,"queryGeometry",void 0);q.__decorate([D.reader("queryGeometry")],n.prototype,"readQueryGeometry",null);q.__decorate([t.property({type:x,json:{write:!0}})],n.prototype,"spatialReference",void 0);q.__decorate([E.writer("spatialReference")],n.prototype,"writeSpatialReference",
null);q.__decorate([t.property({json:{write:!0}})],n.prototype,"transform",void 0);n=y=q.__decorate([I.subclass("esri.rest.support.FeatureSet")],n);n.prototype.toJSON.isDefaultToJSON=!0;return n});