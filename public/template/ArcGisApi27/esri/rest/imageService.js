// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../geometry ../request ../geometry/support/normalizeUtils ./utils ./support/ImageAngleResult ./support/ImageAreaResult ./support/ImageDistanceResult ./support/ImageHeightResult ./support/ImageIdentifyResult ./support/ImagePixelLocationResult ./support/ImagePointResult ./support/ImageSampleResult ../geometry/SpatialReference".split(" "),function(g,E,k,m,f,v,w,x,y,z,A,B,C,p){function q(b){const a=b?.time;if(a&&(null!=a.start||null!=a.end)){const c=[];null!=a.start&&c.push(a.start);null==
a.end||c.includes(a.end)||c.push(a.end);b.time=c.join(",")}}async function r(b,a,c){b=f.parseUrl(b);var d=await m.normalizeCentralMeridian(a.geometry?[a.geometry]:[]);a=a.toJSON();q(a);d=d&&d[0];null!=d&&(a.geometry=d.toJSON());b=f.encode({...b.query,f:"json",...a});return f.asValidOptions(b,c)}async function n(b,a,c,d){b=f.parseUrl(b);c=await m.normalizeCentralMeridian(c);a=a.toJSON();null!=c[0]&&(a.fromGeometry=JSON.stringify(t(c[0])));null!=c[1]&&(a.toGeometry=JSON.stringify(t(c[1])));a=f.encode({...b.query,
f:"json",...a});d=f.asValidOptions(a,d);({data:d}=await k(b.path+"/measure",d));return d}function t(b){const a=b.toJSON();b.spatialReference?.imageCoordinateSystem&&(a.spatialReference=l(b.spatialReference));return a}function l(b){const {imageCoordinateSystem:a}=b;if(a){const {id:c,referenceServiceName:d}=a;return null!=c?d?{icsid:c,icsns:d}:{icsid:c}:{ics:a}}return b.toJSON()}function u(b,a){b=l(b);const {icsid:c,icsns:d,wkid:e}=b;return null!=c?null==d||a?.toLowerCase().includes("/"+d.toLowerCase()+
"/")?`0:${c}`:JSON.stringify(b):e?e.toString():JSON.stringify(b)}g.computeAngles=async function(b,a,c){var d=a.toJSON();null!=d.angleName&&(d.angleName=d.angleName.join(","));null!=a.point&&a.point.spatialReference?.imageCoordinateSystem&&(d.point.spatialReference=l(a.point.spatialReference));null!=a.spatialReference&&a.spatialReference.imageCoordinateSystem&&(d.spatialReference=u(a.spatialReference));b=f.parseUrl(b);d=f.encode({...b.query,f:"json",...d});c=f.asValidOptions(d,c);({data:c}=await k(`${b.path}/computeAngles`,
c));c.spatialReference=c.spatialReference?null!=c.spatialReference.geodataXform?new p({wkid:0,imageCoordinateSystem:c.spatialReference}):p.fromJSON(c.spatialReference):null;"NaN"===c.north&&(c.north=null);"NaN"===c.up&&(c.up=null);return new v(c)};g.computeHistograms=async function(b,a,c){a=await r(b,a,c);b=f.parseUrl(b);({data:b}=await k(`${b.path}/computeHistograms`,a));return{histograms:b.histograms}};g.computePixelSpaceLocations=async function(b,a,c){var d=a.toJSON();({geometries:a}=a);if(a)for(let e=
0;e<a.length;e++)a[e].spatialReference?.imageCoordinateSystem&&(d.geometries.geometries[e].spatialReference=l(a[e].spatialReference));b=f.parseUrl(b);d=f.encode({...b.query,f:"json",...d});c=f.asValidOptions(d,c);({data:c}=await k(`${b.path}/computePixelLocation`,c));return A.fromJSON(c)};g.computeStatisticsHistograms=async function(b,a,c){a=await r(b,a,c);b=f.parseUrl(b);({data:b}=await k(`${b.path}/computeStatisticsHistograms`,a));({statistics:a}=b);a?.length&&a.forEach(d=>{d.avg=d.mean;d.stddev=
d.standardDeviation});return{statistics:a,histograms:b.histograms}};g.getImageSpatialReferenceJSON=l;g.getImageSpatialReferenceQueryParameter=u;g.getSamples=async function(b,a,c){var d=a.toJSON();q(d);d.outFields?.length&&(d.outFields=d.outFields.join(","));a=(await m.normalizeCentralMeridian(a.geometry))?.[0];null!=a&&(d.geometry=a.toJSON());b=f.parseUrl(b);d=f.encode({...b.query,f:"json",...d});c=f.asValidOptions(d,c);({data:c}=await k(`${b.path}/getSamples`,c));c=c?.samples?.map(e=>{const h="NaN"===
e.value||""===e.value?null:e.value.split(" ").map(D=>Number(D));return{...e,pixelValue:h}});return C.fromJSON({samples:c})};g.identify=async function(b,a,c){const d=f.parseUrl(b);return m.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(e=>{var h=a.toJSON();e=e&&e[0];null!=e&&(h.geometry=JSON.stringify(e.toJSON()));h=f.encode({...d.query,f:"json",...h});h=f.asValidOptions(h,c);return k(d.path+"/identify",h)}).then(e=>z.fromJSON(e.data))};g.measureAreaAndPerimeter=async function(b,a,c){b=
await n(b,a,[a.geometry],c);return w.fromJSON(b)};g.measureDistanceAndAngle=async function(b,a,c){b=await n(b,a,[a.fromGeometry,a.toGeometry],c);return x.fromJSON(b)};g.measureHeight=async function(b,a,c){b=await n(b,a,[a.fromGeometry,a.toGeometry],c);return y.fromJSON(b)};g.measurePointOrCentroid=async function(b,a,c){b=await n(b,a,[a.geometry],c);return B.fromJSON(b)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});