// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","./_commonjsHelpers"],function(G,F){var C={exports:{}};C.exports;(function(H,K){(function(k,g){H.exports=g()})(F.commonjsGlobal,function(){return function(k){function g(m){if(f[m])return f[m].exports;var p=f[m]={exports:{},id:m,loaded:!1};k[m].call(p.exports,p,p.exports,g);p.loaded=!0;return p.exports}var f={};g.m=k;g.c=f;g.p="";return g(0)}([function(k,g,f){function m(n,w){var x=new DataView(n.buffer),t=8,u=void 0,z=void 0,l=void 0;do z=x.getUint32(t),u=t+4,u=Array.prototype.slice.call(n.subarray(u,
u+4)),u=String.fromCharCode.apply(String,u),l=w(u,n,t,z),t+=12+z;while(!1!==l&&"IEND"!=u&&t<n.length)}function p(n,w,x){var t=new Uint8Array(x);t.set(n.subarray(w,w+x));return t}Object.defineProperty(g,"__esModule",{value:!0});g.isNotPNG=function(n){return n===a};g.isNotAPNG=function(n){return n===d};g.default=function(n){var w=new Uint8Array(n);if(Array.prototype.some.call(h,function(v,r){return v!==w[r]}))return a;var x=!1;m(w,function(v){return!(x="acTL"===v)});if(!x)return d;var t=[],u=[],z=null,
l=null,B=0,A=new b.APNG;m(w,function(v,r,q,D){var y=new DataView(r.buffer);switch(v){case "IHDR":z=r.subarray(q+8,q+8+D);A.width=y.getUint32(q+8);A.height=y.getUint32(q+12);break;case "acTL":A.numPlays=y.getUint32(q+8+4);break;case "fcTL":l&&(A.frames.push(l),B++);l=new b.Frame;l.width=y.getUint32(q+8+4);l.height=y.getUint32(q+8+8);l.left=y.getUint32(q+8+12);l.top=y.getUint32(q+8+16);v=y.getUint16(q+8+20);r=y.getUint16(q+8+22);0===r&&(r=100);l.delay=1E3*v/r;10>=l.delay&&(l.delay=100);A.playTime+=
l.delay;l.disposeOp=y.getUint8(q+8+24);l.blendOp=y.getUint8(q+8+25);l.dataParts=[];0===B&&2===l.disposeOp&&(l.disposeOp=1);break;case "fdAT":l&&l.dataParts.push(r.subarray(q+8+4,q+8+D));break;case "IDAT":l&&l.dataParts.push(r.subarray(q+8,q+8+D));break;case "IEND":u.push(p(r,q,12+D));break;default:t.push(p(r,q,12+D))}});l&&A.frames.push(l);if(0==A.frames.length)return d;var I=new Blob(t),J=new Blob(u);A.frames.forEach(function(v){var r=[];r.push(h);z.set(E(v.width),0);z.set(E(v.height),4);r.push(e("IHDR",
z));r.push(I);v.dataParts.forEach(function(q){return r.push(e("IDAT",q))});r.push(J);v.imageData=new Blob(r,{type:"image/png"});delete v.dataParts;r=null});return A};var c=(k=f(1))&&k.__esModule?k:{default:k},b=f(2),a=Error("Not a PNG"),d=Error("Not an animated PNG"),h=new Uint8Array([137,80,78,71,13,10,26,10]),e=function(n,w){var x=n.length+w.length,t=new Uint8Array(x+8),u=new DataView(t.buffer);u.setUint32(0,w.length);for(var z=t.set,l=new Uint8Array(n.length),B=0;B<n.length;B++)l[B]=n.charCodeAt(B);
z.call(t,l,4);t.set(w,8);n=(0,c.default)(t,4,x);u.setUint32(x+4,n);return t},E=function(n){return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,n&255])}},function(k,g){Object.defineProperty(g,"__esModule",{value:!0});g.default=function(p){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,b=-1,a=c;for(c+=2<arguments.length&&void 0!==arguments[2]?arguments[2]:p.length-c;a<c;a++)b=b>>>8^f[(b^p[a])&255];return b^-1};var f=new Uint32Array(256);for(k=0;256>k;k++){g=k;for(var m=0;8>m;m++)g=
0!==(g&1)?3988292384^g>>>1:g>>>1;f[k]=g}},function(k,g,f){function m(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(g,"__esModule",{value:!0});g.Frame=g.APNG=void 0;var p=function(){function b(a,d){for(var h=0;h<d.length;h++){var e=d[h];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,d,h){d&&b(a.prototype,d);h&&b(a,h);return a}}(),c=(k=f(3))&&k.__esModule?k:{default:k};
g.APNG=function(){function b(){m(this,b);this.playTime=this.numPlays=this.height=this.width=0;this.frames=[]}p(b,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(a){return a.createImage()}))}},{key:"getPlayer",value:function(a){var d=this,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;return this.createImages().then(function(){return new c.default(d,a,h)})}}]);return b}();g.Frame=function(){function b(){m(this,b);this.blendOp=this.disposeOp=this.delay=
this.height=this.width=this.top=this.left=0;this.imageElement=this.imageData=null}p(b,[{key:"createImage",value:function(){var a=this;return this.imageElement?Promise.resolve():new Promise(function(d,h){var e=URL.createObjectURL(a.imageData);a.imageElement=document.createElement("img");a.imageElement.onload=function(){URL.revokeObjectURL(e);d()};a.imageElement.onerror=function(){URL.revokeObjectURL(e);a.imageElement=null;h(Error("Image creation error"))};a.imageElement.src=e})}}]);return b}()},function(k,
g,f){function m(c,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);c.prototype=Object.create(b&&b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(c,b):c.__proto__=b)}Object.defineProperty(g,"__esModule",{value:!0});var p=function(){function c(b,a){for(var d=0;d<a.length;d++){var h=a[d];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&
(h.writable=!0);Object.defineProperty(b,h.key,h)}}return function(b,a,d){a&&c(b.prototype,a);d&&c(b,d);return b}}();k=f(4);k=function(c){function b(a,d,h){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var e=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e.playbackRate=1;e._currentFrameNumber=0;e._ended=!1;e._paused=
!0;e._numPlays=0;e._apng=a;e.context=d;e.stop();h&&e.play();return e}m(b,c);p(b,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length;this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._paused=this._ended=!0));this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):
this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var a=this.currentFrame;this._prevFrame=a;this._prevFrameData=null;2==a.disposeOp&&(this._prevFrameData=this.context.getImageData(a.left,a.top,a.width,a.height));0==a.blendOp&&this.context.clearRect(a.left,a.top,a.width,a.height);this.context.drawImage(a.imageElement,a.left,a.top);this.emit("frame",this._currentFrameNumber);this._ended&&this.emit("end")}},{key:"play",
value:function(){var a=this;this.emit("play");this._ended&&this.stop();this._paused=!1;var d=performance.now()+this.currentFrame.delay/this.playbackRate;requestAnimationFrame(function E(e){if(!a._ended&&!a._paused){if(e>=d){for(;e-d>=a._apng.playTime/a.playbackRate;)d+=a._apng.playTime/a.playbackRate,a._numPlays++;do a.renderNextFrame(),d+=a.currentFrame.delay/a.playbackRate;while(!a._ended&&e>d)}requestAnimationFrame(E)}})}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=
!0)}},{key:"stop",value:function(){this.emit("stop");this._numPlays=0;this._ended=!1;this._paused=!0;this._currentFrameNumber=-1;this.context.clearRect(0,0,this._apng.width,this._apng.height);this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]);return b}((k&&k.__esModule?
k:{default:k}).default);g.default=k},function(k,g){function f(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function m(c){return"function"===typeof c}function p(c){return"object"===typeof c&&null!==c}k.exports=f;f.EventEmitter=f;f.prototype._events=void 0;f.prototype._maxListeners=void 0;f.defaultMaxListeners=10;f.prototype.setMaxListeners=function(c){if("number"!==typeof c||0>c||isNaN(c))throw TypeError("n must be a positive number");this._maxListeners=c;return this};
f.prototype.emit=function(c){var b;this._events||(this._events={});if("error"===c&&(!this._events.error||p(this._events.error)&&!this._events.error.length)){var a=arguments[1];if(a instanceof Error)throw a;var d=Error('Uncaught, unspecified "error" event. ('+a+")");d.context=a;throw d;}d=this._events[c];if(void 0===d)return!1;if(m(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,
1),d.apply(this,a)}else if(p(d)){a=Array.prototype.slice.call(arguments,1);var h=d.slice();d=h.length;for(b=0;b<d;b++)h[b].apply(this,a)}return!0};f.prototype.addListener=function(c,b){if(!m(b))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",c,m(b.listener)?b.listener:b);this._events[c]?p(this._events[c])?this._events[c].push(b):this._events[c]=[this._events[c],b]:this._events[c]=b;p(this._events[c])&&!this._events[c].warned&&
(b=void 0!==this._maxListeners?this._maxListeners:f.defaultMaxListeners)&&0<b&&this._events[c].length>b&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),"function"===typeof console.trace&&console.trace());return this};f.prototype.on=f.prototype.addListener;f.prototype.once=function(c,b){function a(){this.removeListener(c,a);d||(d=!0,b.apply(this,arguments))}
if(!m(b))throw TypeError("listener must be a function");var d=!1;a.listener=b;this.on(c,a);return this};f.prototype.removeListener=function(c,b){if(!m(b))throw TypeError("listener must be a function");if(!this._events||!this._events[c])return this;var a=this._events[c];var d=a.length;var h=-1;if(a===b||m(a.listener)&&a.listener===b)delete this._events[c],this._events.removeListener&&this.emit("removeListener",c,b);else if(p(a)){for(;0<d--;)if(a[d]===b||a[d].listener&&a[d].listener===b){h=d;break}if(0>
h)return this;1===a.length?(a.length=0,delete this._events[c]):a.splice(h,1);this._events.removeListener&&this.emit("removeListener",c,b)}return this};f.prototype.removeAllListeners=function(c){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[c]&&delete this._events[c],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);this.removeAllListeners("removeListener");this._events={};return this}var b=
this._events[c];if(m(b))this.removeListener(c,b);else if(b)for(;b.length;)this.removeListener(c,b[b.length-1]);delete this._events[c];return this};f.prototype.listeners=function(c){return this._events&&this._events[c]?m(this._events[c])?[this._events[c]]:this._events[c].slice():[]};f.prototype.listenerCount=function(c){if(this._events){c=this._events[c];if(m(c))return 1;if(c)return c.length}return 0};f.listenerCount=function(c,b){return c.listenerCount(b)}}])})})(C,C.exports);C=F.getDefaultExportFromCjs(C.exports);
G.parseApng3rdParty=C});