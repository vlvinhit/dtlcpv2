// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","./dom"],function(D,r){function M(c,e){var d=Object.keys(c);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(c);e&&(f=f.filter(function(h){return Object.getOwnPropertyDescriptor(c,h).enumerable}));d.push.apply(d,f)}return d}function N(c){for(var e=1;e<arguments.length;e++){var d=null!=arguments[e]?arguments[e]:{};e%2?M(Object(d),!0).forEach(function(f){var h=d[f];a:if("object"===typeof f&&null!==f){var w=f[Symbol.toPrimitive];if(void 0!==w){f=w.call(f,"string");
if("object"!==typeof f)break a;throw new TypeError("@@toPrimitive must return a primitive value.");}f=String(f)}f="symbol"===typeof f?f:String(f);f in c?Object.defineProperty(c,f,{value:h,enumerable:!0,configurable:!0,writable:!0}):c[f]=h}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(d)):M(Object(d)).forEach(function(f){Object.defineProperty(c,f,Object.getOwnPropertyDescriptor(d,f))})}return c}var O={activateTrap:function(c,e){if(0<c.length){var d=c[c.length-
1];d!==e&&d.pause()}d=c.indexOf(e);-1!==d&&c.splice(d,1);c.push(e)},deactivateTrap:function(c,e){e=c.indexOf(e);-1!==e&&c.splice(e,1);0<c.length&&c[c.length-1].unpause()}},x=function(c){return"Tab"===c.key||9===c.keyCode},W=function(c){return x(c)&&!c.shiftKey},X=function(c){return x(c)&&c.shiftKey},P=function(c,e){var d=-1;c.every(function(f,h){return e(f)?(d=h,!1):!0});return d},y=function(c){for(var e=arguments.length,d=Array(1<e?e-1:0),f=1;f<e;f++)d[f-1]=arguments[f];return"function"===typeof c?
c.apply(void 0,d):c},E=function(c){return c.target.shadowRoot&&"function"===typeof c.composedPath?c.composedPath()[0]:c.target},Y=[],aa=function(c,e){var d=(null===e||void 0===e?void 0:e.document)||document,f=(null===e||void 0===e?void 0:e.trapStack)||Y,h=N({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:W,isKeyBackward:X},e),w=[],F=[],n=[],I=null,J=null,t=!1,v=!1,K=void 0,q=function(l,a,b){return l&&void 0!==l[a]?l[a]:h[b||a]},z=function(l,a){var b="function"===
typeof(null===a||void 0===a?void 0:a.composedPath)?a.composedPath():void 0;return F.findIndex(function(g){var k=g.container;g=g.tabbableNodes;return k.contains(l)||(null===b||void 0===b?void 0:b.includes(k))||g.find(function(m){return m===l})})},A=function(l){var a=h[l];if("function"===typeof a){for(var b=arguments.length,g=Array(1<b?b-1:0),k=1;k<b;k++)g[k-1]=arguments[k];a=a.apply(void 0,g)}!0===a&&(a=void 0);if(!a){if(void 0===a||!1===a)return a;throw Error("`".concat(l,"` was specified but was not a node, or did not return a node"));
}b=a;if("string"===typeof a&&(b=d.querySelector(a),!b))throw Error("`".concat(l,"` as selector refers to no known node"));return b},G=function(){var l=A("initialFocus");if(!1===l)return!1;void 0===l&&(l=0<=z(d.activeElement)?d.activeElement:(l=n[0])&&l.firstTabbableNode||A("fallbackFocus"));if(!l)throw Error("Your focus-trap needs to have at least one focusable element");return l},B=function(){F=w.map(function(l){var a=r.tabbable(l,h.tabbableOptions),b=r.focusable(l,h.tabbableOptions);return{container:l,
tabbableNodes:a,focusableNodes:b,firstTabbableNode:0<a.length?a[0]:null,lastTabbableNode:0<a.length?a[a.length-1]:null,nextTabbableNode:function(g){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,m=b.findIndex(function(p){return p===g});if(!(0>m))return k?b.slice(m+1).find(function(p){return r.isTabbable(p,h.tabbableOptions)}):b.slice(0,m).reverse().find(function(p){return r.isTabbable(p,h.tabbableOptions)})}}});n=F.filter(function(l){return 0<l.tabbableNodes.length});if(0>=n.length&&
!A("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},C=function b(a){!1!==a&&a!==d.activeElement&&(a&&a.focus?(a.focus({preventScroll:!!h.preventScroll}),J=a,a.tagName&&"input"===a.tagName.toLowerCase()&&"function"===typeof a.select&&a.select()):b(G()))},Q=function(a){var b=A("setReturnFocus",a);return b?b:!1===b?!1:a},H=function(a){var b=E(a);0<=z(b,a)||(y(h.clickOutsideDeactivates,a)?u.deactivate({returnFocus:h.returnFocusOnDeactivate}):
y(h.allowOutsideClick,a)||a.preventDefault())},R=function(a){var b=E(a),g=0<=z(b,a);g||b instanceof Document?g&&(J=b):(a.stopImmediatePropagation(),C(J||G()))},Z=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,g=E(a);B();var k=null;if(0<n.length){var m=z(g,a),p=0<=m?F[m]:void 0;0>m?k=b?n[n.length-1].lastTabbableNode:n[0].firstTabbableNode:b?(b=P(n,function(L){return g===L.firstTabbableNode}),0>b&&(p.container===g||r.isFocusable(g,h.tabbableOptions)&&!r.isTabbable(g,h.tabbableOptions)&&
!p.nextTabbableNode(g,!1))&&(b=m),0<=b?k=n[0===b?n.length-1:b-1].lastTabbableNode:x(a)||(k=p.nextTabbableNode(g,!1))):(b=P(n,function(L){return g===L.lastTabbableNode}),0>b&&(p.container===g||r.isFocusable(g,h.tabbableOptions)&&!r.isTabbable(g,h.tabbableOptions)&&!p.nextTabbableNode(g))&&(b=m),0<=b?k=n[b===n.length-1?0:b+1].firstTabbableNode:x(a)||(k=p.nextTabbableNode(g)))}else k=A("fallbackFocus");k&&(x(a)&&a.preventDefault(),C(k))},S=function(a){"Escape"!==a.key&&"Esc"!==a.key&&27!==a.keyCode||
!1===y(h.escapeDeactivates,a)?(h.isKeyForward(a)||h.isKeyBackward(a))&&Z(a,h.isKeyBackward(a)):(a.preventDefault(),u.deactivate())},T=function(a){var b=E(a);0<=z(b,a)||y(h.clickOutsideDeactivates,a)||y(h.allowOutsideClick,a)||(a.preventDefault(),a.stopImmediatePropagation())},U=function(){if(t)return O.activateTrap(f,u),K=h.delayInitialFocus?setTimeout(function(){C(G())},0):C(G()),d.addEventListener("focusin",R,!0),d.addEventListener("mousedown",H,{capture:!0,passive:!1}),d.addEventListener("touchstart",
H,{capture:!0,passive:!1}),d.addEventListener("click",T,{capture:!0,passive:!1}),d.addEventListener("keydown",S,{capture:!0,passive:!1}),u},V=function(){if(t)return d.removeEventListener("focusin",R,!0),d.removeEventListener("mousedown",H,!0),d.removeEventListener("touchstart",H,!0),d.removeEventListener("click",T,!0),d.removeEventListener("keydown",S,!0),u};var u={get active(){return t},get paused(){return v},activate:function(a){if(t)return this;var b=q(a,"onActivate"),g=q(a,"onPostActivate"),k=
q(a,"checkCanFocusTrap");k||B();t=!0;v=!1;I=d.activeElement;null===b||void 0===b?void 0:b();a=function(){k&&B();U();null===g||void 0===g?void 0:g()};if(k)return k(w.concat()).then(a,a),this;a();return this},deactivate:function(a){if(!t)return this;var b=N({onDeactivate:h.onDeactivate,onPostDeactivate:h.onPostDeactivate,checkCanReturnFocus:h.checkCanReturnFocus},a);clearTimeout(K);K=void 0;V();v=t=!1;O.deactivateTrap(f,u);var g=q(b,"onDeactivate"),k=q(b,"onPostDeactivate");a=q(b,"checkCanReturnFocus");
var m=q(b,"returnFocus","returnFocusOnDeactivate");null===g||void 0===g?void 0:g();b=function(){setTimeout(function(){m&&C(Q(I));null===k||void 0===k?void 0:k()},0)};if(m&&a)return a(Q(I)).then(b,b),this;b();return this},pause:function(a){if(v||!t)return this;var b=q(a,"onPause");a=q(a,"onPostPause");v=!0;null===b||void 0===b?void 0:b();V();null===a||void 0===a?void 0:a();return this},unpause:function(a){if(!v||!t)return this;var b=q(a,"onUnpause");a=q(a,"onPostUnpause");v=!1;null===b||void 0===b?
void 0:b();B();U();null===a||void 0===a?void 0:a();return this},updateContainerElements:function(a){w=[].concat(a).filter(Boolean).map(function(b){return"string"===typeof b?d.querySelector(b):b});t&&B();return this}};u.updateContainerElements(c);return u};const ba=[];D.activateFocusTrap=function(c,e){c.focusTrapDisabled||c.focusTrap?.activate(e)};D.connectFocusTrap=function(c,e){const {el:d}=c,f=e?.focusTrapEl||d;f&&(c.focusTrap=aa(f,{clickOutsideDeactivates:!0,escapeDeactivates:!1,fallbackFocus:f,
setReturnFocus:h=>{r.focusElement(h);return!1},...e?.focusTrapOptions,document:d.ownerDocument,tabbableOptions:r.tabbableOptions,trapStack:ba}))};D.deactivateFocusTrap=function(c,e){c.focusTrap?.deactivate(e)};D.updateFocusTrapElements=function(c){c.focusTrap?.updateContainerElements(c.el)}});