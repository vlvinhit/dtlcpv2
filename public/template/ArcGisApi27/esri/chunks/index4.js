// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports"],function(z){var r={},w={},n={};Object.defineProperty(n,"__esModule",{value:!0});n.loop=n.conditional=n.parse=void 0;n.parse=function g(c,b){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:f;if(Array.isArray(b))b.forEach(function(a){return g(c,a,f,d)});else if("function"===typeof b)b(c,f,d,g);else{var k=Object.keys(b)[0];Array.isArray(b[k])?(d[k]={},g(c,b[k],f,d[k])):d[k]=b[k](c,f,d,g)}return f};n.conditional=
function(c,b){return function(g,f,d,k){b(g,f,d)&&k(g,c,f,d)}};n.loop=function(c,b){return function(g,f,d,k){for(var a=[],l=g.pos;b(g,f,d);){var h={};k(g,c,f,h);if(g.pos===l)break;l=g.pos;a.push(h)}return a}};var e={};Object.defineProperty(e,"__esModule",{value:!0});e.readBits=e.readArray=e.readUnsigned=e.readString=e.peekBytes=e.readBytes=e.peekByte=e.readByte=e.buildStream=void 0;e.buildStream=function(c){return{data:c,pos:0}};var G=function(){return function(c){return c.data[c.pos++]}};e.readByte=
G;e.peekByte=function(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return function(b){return b.data[b.pos+c]}};var A=function(c){return function(b){return b.data.subarray(b.pos,b.pos+=c)}};e.readBytes=A;e.peekBytes=function(c){return function(b){return b.data.subarray(b.pos,b.pos+c)}};e.readString=function(c){return function(b){return Array.from(A(c)(b)).map(function(g){return String.fromCharCode(g)}).join("")}};e.readUnsigned=function(c){return function(b){b=A(2)(b);return c?
(b[1]<<8)+b[0]:(b[0]<<8)+b[1]}};e.readArray=function(c,b){return function(g,f,d){f="function"===typeof b?b(g,f,d):b;d=A(c);for(var k=Array(f),a=0;a<f;a++)k[a]=d(g);return k}};e.readBits=function(c){return function(b){b=G()(b);for(var g=Array(8),f=0;8>f;f++)g[7-f]=!!(b&1<<f);return Object.keys(c).reduce(function(d,k){var a=c[k];if(a.length){for(var l=a.length,h=0,m=0;m<l;m++)h+=g[a.index+m]&&Math.pow(2,l-m-1);d[k]=h}else d[k]=g[a.index];return d},{})}};(function(c){Object.defineProperty(c,"__esModule",
{value:!0});c["default"]=void 0;var b={blocks:function(a){for(var l=[],h=a.data.length,m=0,p=(0,e.readByte)()(a);0!==p&&p;p=(0,e.readByte)()(a)){if(a.pos+p>=h){h-=a.pos;l.push((0,e.readBytes)(h)(a));m+=h;break}l.push((0,e.readBytes)(p)(a));m+=p}a=new Uint8Array(m);for(h=m=0;h<l.length;h++)a.set(l[h],m),m+=l[h].length;return a}},g=(0,n.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},
transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&249===a[1]}),f=(0,n.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,
length:3}})}]},(0,n.conditional)({lct:(0,e.readArray)(3,function(a,l,h){return Math.pow(2,h.descriptor.lct.size+1)})},function(a,l,h){return h.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},b]}]},function(a){return 44===(0,e.peekByte)()(a)}),d=(0,n.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(a,l,h){return(0,e.readBytes)(h.text.blockSize)(a)}},b]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&1===a[1]}),k=(0,n.conditional)({application:[{codes:(0,e.readBytes)(2)},
{blockSize:(0,e.readByte)()},{id:function(a,l,h){return(0,e.readString)(h.blockSize)(a)}},b]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&255===a[1]});b=(0,n.conditional)({comment:[{codes:(0,e.readBytes)(2)},b]},function(a){a=(0,e.peekBytes)(2)(a);return 33===a[0]&&254===a[1]});g=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},
sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,n.conditional)({gct:(0,e.readArray)(3,function(a,l){return Math.pow(2,l.lsd.gct.size+1)})},function(a,l){return l.lsd.gct.exists}),{frames:(0,n.loop)([g,k,b,f,d],function(a){a=(0,e.peekByte)()(a);return 33===a||44===a})}];c["default"]=g})(w);var B={};Object.defineProperty(B,"__esModule",{value:!0});B.deinterlace=void 0;B.deinterlace=function(c,b){for(var g=Array(c.length),f=c.length/
b,d=[0,4,2,1],k=[8,8,4,2],a=0,l=0;4>l;l++)for(var h=d[l];h<f;h+=k[l]){var m=h,p=c.slice(a*b,(a+1)*b);g.splice.apply(g,[m*b,b].concat(p));a++}return g};var C={};Object.defineProperty(C,"__esModule",{value:!0});C.lzw=void 0;C.lzw=function(c,b,g){var f,d,k,a,l,h,m,p,E=Array(g),F=Array(4096),x=Array(4096),y=Array(4097);var u=1<<c;var I=u+1;var q=u+2;var v=-1;var t=c+1;var D=(1<<t)-1;for(d=0;d<u;d++)F[d]=0,x[d]=d;for(k=a=f=l=h=p=m=0;k<g;){if(0===h){if(f<t){a+=b[m]<<f;f+=8;m++;continue}d=a&D;a>>=t;f-=t;
if(d>q||d==I)break;if(d==u){t=c+1;D=(1<<t)-1;q=u+2;v=-1;continue}if(-1==v){y[h++]=x[d];l=v=d;continue}var J=d;d==q&&(y[h++]=l,d=v);for(;d>u;)y[h++]=x[d],d=F[d];l=x[d]&255;y[h++]=l;4096>q&&(F[q]=v,x[q]=l,q++,0===(q&D)&&4096>q&&(t++,D+=q));v=J}h--;E[p++]=y[h];k++}for(k=p;k<g;k++)E[k]=0;return E};Object.defineProperty(r,"__esModule",{value:!0});z.decompressFrames_1=r.decompressFrames=r.decompressFrame=z.parseGIF_1=r.parseGIF=void 0;var K=w&&w.__esModule?w:{default:w};z.parseGIF_1=r.parseGIF=function(c){c=
new Uint8Array(c);return(0,n.parse)((0,e.buildStream)(c),K["default"])};var H=function(c,b,g){if(c.image){var f=c.image,d=(0,C.lzw)(f.data.minCodeSize,f.data.blocks,f.descriptor.width*f.descriptor.height);f.descriptor.lct.interlaced&&(d=(0,B.deinterlace)(d,f.descriptor.width));d={pixels:d,dims:{top:c.image.descriptor.top,left:c.image.descriptor.left,width:c.image.descriptor.width,height:c.image.descriptor.height}};d.colorTable=f.descriptor.lct&&f.descriptor.lct.exists?f.lct:b;c.gce&&(d.delay=10*(c.gce.delay||
10),d.disposalType=c.gce.extras.disposal,c.gce.extras.transparentColorGiven&&(d.transparentIndex=c.gce.transparentColorIndex));if(g){c=d.pixels.length;b=new Uint8ClampedArray(4*c);for(g=0;g<c;g++){f=4*g;var k=d.pixels[g],a=d.colorTable[k]||[0,0,0];b[f]=a[0];b[f+1]=a[1];b[f+2]=a[2];b[f+3]=k!==d.transparentIndex?255:0}d.patch=b}return d}console.warn("gif frame does not have associated image.")};r.decompressFrame=H;z.decompressFrames_1=r.decompressFrames=function(c,b){return c.frames.filter(function(g){return g.image}).map(function(g){return H(g,
c.gct,b)})}});