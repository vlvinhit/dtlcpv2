// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),function(m,w,x,z,v,r,C,n,A,D){async function k(a,c,f){z.getOrCreateMapValue(a,c,()=>[]).push(...f)}async function t(a,c,f){a=z.getOrCreateMapValue(a,c,()=>new Map);for(const d of f)a.set(d.value,d.color)}function y(a){let c=a.minValue,
f=a.maxValue;const d=a.isFirstBreak?"":u.gt+" ";a="percent-of-total"===a.normalizationType?u.pct:"";c=null==c?"":r.format(c);f=null==f?"":r.format(f);return d+c+a+" "+u.ld+" "+f+a}function q(a,c){return"normalizationField"in a&&a.normalizationField?{type:"normalized-field",field:a.field,normalizationField:a.normalizationField}:"field"in a&&a.field?{type:"field",field:a.field}:"valueExpression"in a&&a.valueExpression?{type:"expression",expression:a.valueExpression,title:a.valueExpressionTitle,returnType:c}:
null}const E=x.getLogger("esri.renderers.support.utils"),u={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},F={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},G={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};x=v.convertDateFormatToIntlOptions("short-date");m.calculateDateFormatInterval=
function(a){a=a.map(e=>new Date(e));const c=a.length;let f=Infinity,d=null;for(let e=0;e<c-1;e++){const g=a[e];let h=Infinity,l=null;for(let p=e+1;p<c;p++){var b=a[p];b=g.getFullYear()!==b.getFullYear()&&"year"||g.getMonth()!==b.getMonth()&&"month"||g.getDate()!==b.getDate()&&"day"||g.getHours()!==b.getHours()&&"hour"||g.getMinutes()!==b.getMinutes()&&"minute"||g.getSeconds()!==b.getSeconds()&&"second"||"millisecond";const B=F[b];B<h&&(h=B,l=b)}h<f&&(f=h,d=l)}return d};m.createClassBreakLabel=y;m.createColorStops=
function(a){const {values:c,colors:f,labelIndexes:d,isDate:b,dateFormatOptions:e}=a;return c.map((g,h)=>{var l=null;if(!d||d.includes(h)){let p;if(p=b?v.formatDate(g,e):r.format(g))l="",0===h?l=u.lt+" ":h===c.length-1&&(l=u.gt+" "),l+=p}return new C({value:g,color:f[h],label:l})})};m.createUniqueValueLabel=function(a){const {value:c,domain:f,fieldInfo:d,dateFormatInterval:b}=a;a=String(c);const e=f&&"codedValues"in f&&f.codedValues?f.getName(c):null;e?a=e:"number"===typeof c&&(a=d&&"date"===d.type?
v.formatDate(c,b&&v.convertDateFormatToIntlOptions(G[b])):r.format(c));return a};m.getAttribute=q;m.getAttributes=function(a,c){const f=[];if("class-breaks"===a.type||"heatmap"===a.type)f.push(q(a,"number"));else if("unique-value"===a.type){var d=a.authoringInfo;if(d&&"relationship"===d.type){if(d.field1&&d.field2){var b=d.field2.field;const e=d.field2.normalizationField;f.push(q({field:d.field1.field,normalizationField:d.field1.normalizationField}));f.push(q({field:b,normalizationField:e}))}}else b=
a.uniqueValueInfos?.[0],d=null,b&&b.value&&(b=typeof a.uniqueValueInfos[0].value,"string"===b||"number"===b)&&(d=b),f.push(q(a,d)),[a.field2,a.field3].forEach(e=>e&&f.push({type:"field",field:e}))}else"attributes"in a&&a.attributes?.forEach(e=>f.push(q(e,"number")));(a=c?c(a):"visualVariables"in a?a.visualVariables:null)&&a.forEach(e=>f.push(q(e,"number")));return w.unique(f.filter(w.isSome),(e,g)=>"field"===e.type&&"field"===g.type?e.field===g.field:"normalized-field"===e.type&&"normalized-field"===
g.type?e.field===g.field&&e.normalizationField===g.normalizationField:"expression"===e.type&&"expression"===g.type?e.expression===g.expression:!1)};m.getColorsForRendererValues=async function(a){const c=new Map;if(!a)return c;if("unique-value"!==a.type||a.authoringInfo?.type)if("class-breaks"===a.type){var f=a.classBreakInfos.map(e=>({value:e.minValue,color:n.getColorFromSymbol(e.symbol,null)})).reverse();const {field:d,valueExpression:b}=a;await t(c,d??b,f)}else"simple"===a.type&&await t(c,"default",
[{value:"default",color:n.getColorFromSymbol(a.symbol,null)}]);else{f=(a.uniqueValueInfos??[]).map(p=>({value:p.value,color:n.getColorFromSymbol(p.symbol,null)}));const {field:d,field2:b,field3:e,valueExpression:g,fieldDelimiter:h}=a,l=[d,b,e].filter(Boolean).join(h||"");(l||g)&&await t(c,l||g,f)}"defaultSymbol"in a&&a.defaultSymbol&&await t(c,"default",[{value:"default",color:n.getColorFromSymbol(a.defaultSymbol,null)}]);if("visualVariables"in a&&a.visualVariables){a=a.visualVariables.filter(d=>
"color"===d.type);for(const d of a)a=await A.getRampStops(d)??[],await t(c,d.field||d.valueExpression,a)}return c};m.getColorsFromRenderer=async function(a){const c=new Map;if(!a)return c;if("visualVariables"in a&&a.visualVariables){var f=a.visualVariables.filter(b=>"color"===b.type);for(var d of f)f=(await A.getRampStops(d)??[]).map(b=>b.color),await k(c,d.field||d.valueExpression,f)}if("heatmap"===a.type)d=D.getHeatmapRampStops(a).map(b=>b.color),await k(c,a.field||a.valueExpression,d);else if("pie-chart"===
a.type){for(const b of a.attributes)await k(c,b.field||b.valueExpression,[b.color]);await k(c,"default",[a?.othersCategory?.color,n.getColorFromSymbol(a.backgroundFillSymbol,null)])}else if("dot-density"===a.type){for(const b of a.attributes)await k(c,b.field||b.valueExpression,[b.color]);await k(c,"default",[a.backgroundColor])}else if("unique-value"===a.type)if("predominance"===a.authoringInfo?.type)for(const b of a.uniqueValueInfos??[])await k(c,b.value.toString(),[n.getColorFromSymbol(b.symbol,
null)]);else{d=(a.uniqueValueInfos??[]).map(l=>n.getColorFromSymbol(l.symbol,null));const {field:b,field2:e,field3:g,valueExpression:h}=a;(b||h)&&await k(c,b||h,d);e&&await k(c,e,d);g&&await k(c,g,d)}else if("class-breaks"===a.type){d=a.classBreakInfos.map(g=>n.getColorFromSymbol(g.symbol,null));const {field:b,valueExpression:e}=a;await k(c,b??e,d)}else"simple"===a.type&&await k(c,"default",[n.getColorFromSymbol(a.symbol,null)]);"defaultSymbol"in a&&a.defaultSymbol&&await k(c,"default",[n.getColorFromSymbol(a.defaultSymbol,
null)]);c.forEach((b,e)=>{b=w.unique(b.filter(Boolean),(g,h)=>JSON.stringify(g)===JSON.stringify(h));c.set(e,b)});return c};m.setLabelsForClassBreaks=function(a){const c=a.classBreakInfos,f=a.normalizationType;let d=[];if(c&&c.length)if("standard-deviation"===a.classificationMethod)E.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");else if(a.round){d.push(c[0].minValue);for(const b of c)d.push(b.maxValue);d=r.round(d);c.forEach((b,e)=>
{b.label=y({minValue:0===e?d[0]:d[e],maxValue:d[e+1],isFirstBreak:0===e,normalizationType:f})})}else c.forEach((b,e)=>{b.label=y({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===e,normalizationType:f})})};m.timelineDateFormatOptions=x;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});