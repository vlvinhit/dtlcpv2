// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../core/Collection ../core/CollectionFlattener ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/commonProperties ./support/KMLSublayer ./support/kmlUtils ../geometry/Extent".split(" "),
function(l,d,c,u,v,w,x,n,y,g,K,L,M,p,z,A,q,B,C,D,E,F,G,H,r,m,I){const J=["kml","xml"];c=function(t){function k(...a){var b=t.call(this,...a)||this;b._visibleFolders=[];b.allSublayers=new v({getCollections:()=>[b.sublayers],getChildrenFunction(e){return e.sublayers}});b.outSpatialReference=q.WGS84;b.path=null;b.legendEnabled=!1;b.operationalLayerType="KML";b.sublayers=null;b.type="kml";b.url=null;return b}l._inherits(k,t);var h=k.prototype;h.initialize=function(){this.addHandles([n.watch(()=>this.sublayers,
(a,b)=>{b&&b.forEach(e=>{e.parent=null;e.layer=null});a&&a.forEach(e=>{e.parent=this;e.layer=this})},n.sync),this.on("sublayer-update",()=>this.notifyChange("fullExtent"))])};h.normalizeCtorArgs=function(a,b){return"string"===typeof a?{url:a,...b}:a};h.readSublayersFromItemOrWebMap=function(a,b){this._visibleFolders=b.visibleFolders};h.readSublayers=function(a,b,e){return m.sublayersFromJSON(r,b,e,this._visibleFolders)};h.writeSublayers=function(a,b){const e=[];for(a=a.toArray();a.length;){const f=
a[0];f.networkLink||(f.visible&&e.push(f.id),f.sublayers&&a.push(...f.sublayers.toArray()));a.shift()}b.visibleFolders=e};h.load=function(a){const b=null!=a?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},a).catch(x.throwIfAbortError).then(()=>this._fetchService(b)));return Promise.resolve(this)};h.destroy=function(){l._get(l._getPrototypeOf(k.prototype),"destroy",this).call(this);this.allSublayers.destroy()};h._fetchService=async function(a){var b=
await Promise.resolve().then(()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:m.fetchService(this.url??"",this.outSpatialReference,this.refreshInterval,a));(b=m.parseKML(b.data))&&this.read(b,{origin:"service"})};h._recomputeFullExtent=function(){let a=null;null!=this.extent&&(a=this.extent.clone());const b=e=>{if(e.sublayers)for(const f of e.sublayers.items)b(f),f.visible&&f.fullExtent&&(null!=a?a.union(f.fullExtent):a=f.fullExtent.clone())};b(this);return a};l._createClass(k,[{key:"title",
get:function(){const a=this._get("title");return a&&"defaults"!==this.originOf("title")?a:this.url?y.getFilename(this.url,J)||"KML":a||""},set:function(a){this._set("title",a)}},{key:"visibleSublayers",get:function(){const a=this.sublayers,b=[],e=f=>{f.visible&&(b.push(f),f.sublayers&&f.sublayers.forEach(e))};a&&a.forEach(e);return b}},{key:"fullExtent",get:function(){return this._recomputeFullExtent()}}]);return k}(C.BlendLayer(F.RefreshableLayer(G.ScaleRangeLayer(D.OperationalLayer(E.PortalLayer(w.MultiOriginJSONMixin(B)))))));
d.__decorate([g.property({readOnly:!0})],c.prototype,"allSublayers",void 0);d.__decorate([g.property({type:q})],c.prototype,"outSpatialReference",void 0);d.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);d.__decorate([g.property({readOnly:!0,json:{read:!1,write:!1}})],c.prototype,"legendEnabled",void 0);d.__decorate([g.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);d.__decorate([g.property({type:["KML"]})],
c.prototype,"operationalLayerType",void 0);d.__decorate([g.property({})],c.prototype,"resourceInfo",void 0);d.__decorate([g.property({type:u.ofType(r),json:{write:{ignoreOrigin:!0}}})],c.prototype,"sublayers",void 0);d.__decorate([p.reader(["web-map","portal-item"],"sublayers",["visibleFolders"])],c.prototype,"readSublayersFromItemOrWebMap",null);d.__decorate([p.reader("service","sublayers",["sublayers"])],c.prototype,"readSublayers",null);d.__decorate([A.writer("sublayers")],c.prototype,"writeSublayers",
null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);d.__decorate([g.property({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],c.prototype,"title",null);d.__decorate([g.property(H.url)],c.prototype,"url",void 0);d.__decorate([g.property({readOnly:!0})],c.prototype,"visibleSublayers",null);d.__decorate([g.property({type:I})],c.prototype,"extent",void 0);d.__decorate([g.property()],c.prototype,"fullExtent",null);return c=d.__decorate([z.subclass("esri.layers.KMLLayer")],
c)});