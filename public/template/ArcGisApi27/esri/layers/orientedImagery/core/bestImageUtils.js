// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/support/Ellipsoid","../../../geometry/support/pointUtils","./ExposurePoint"],function(t,y,z,A){function B(e,a){a.z??(a.z=0);a.elevation??(a.elevation=0);return f=>{var c=f.attributes,k=e?"3D":"2D";c="isOblique"in c?c:new A(c);const {isOblique:C,isSpherical:D,isNadir:E}=c,{hfovWeight:u,vfovWeight:v,distanceWeight:w}=D?{hfovWeight:"2D"===k?0:1,vfovWeight:"2D"===k?0:.6,distanceWeight:"2D"===k?1:.5}:E?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:C?{hfovWeight:1,
vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1};var g=f.attributes;const {cameraHeight:n,cameraHeading:l,cameraPitch:x,farDistance:F,horizontalFieldOfView:G,verticalFieldOfView:H}=g;var b=g.geometry;k=180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI;c=z.distance(a,b);let p=G,q=H;var h=l,m=x;e&&(h=e.heading,m=e.tilt,q=p=180);var d=1;b.spatialReference.isWebMercator&&(d=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*b.y/y.earth.radius))));d=Math.sqrt((Math.sqrt((a.x-b.x)**2+(a.y-
b.y)**2)/d)**2+((a.z??0)-(a.elevation??0)-n)**2);b=90-180*Math.atan2(a.y-b.y,a.x-b.x)/Math.PI;h=(180<Math.abs(b-h)?Math.abs(360-Math.abs(b-h)):Math.abs(b-h))/p;g=180*Math.acos((g.cameraHeight-(a.z??0)+(a.elevation??0))/d)/Math.PI;m=Math.abs(g-m)/q;d/=Math.sqrt(F**2+n**2);d=4*d+1;const r=180<l?l-360:l;return{suitability:u*(4*h+1)+v*(4*m+1)+w*d,trueSuitability:u*(4*(180<Math.abs(b-r)?Math.abs(360-Math.abs(b-r)):Math.abs(b-r)/p)+1)+v*(Math.abs(g-x)/q*4+1)+w*d,feature:f,angle:k,distance:c,vangle:Math.abs(180*
Math.atan(c/n)/Math.PI)}}}t.calculateSuitabilities=function(e){const {camera:a,features:f,selectedPoint:c}=e;if(!f.length)return[];e=B(a,c);return f.map(e)};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});