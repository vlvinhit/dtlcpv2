// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(t,k,l,u,p,v,w,q,x){function r(c,f){if(null==c)return"";const a=f.domain;if(a)if("codedValue"===a.type||"coded-value"===a.type)for(var g of a.codedValues){if(g.code===c)return g.name}else if("range"===a.type){g=+c;const h="range"in a?a.range[1]:a.maxValue;if(("range"in a?a.range[0]:a.minValue)<=g&&g<=h)return a.name}"date"===f.type||
"esriFieldTypeDate"===f.type?c=p.formatDate(c,p.convertDateFormatToIntlOptions("short-date")):w.isNumericField(f)&&(c=v.formatNumber(+c));return c||""}const m=u.getLogger("esri.layers.support.labelFormatUtils"),n={type:"simple",evaluate(){return null}},y={getAttribute(c,f){return c.field(f)}};k.createLabelFunction=async function(c,f,a){if(!c||!c.symbol||!f)return n;const g=c.where,h=q.getLabelExpression(c);c=g?await new Promise((e,d)=>t(["../../core/sql/WhereClause"],e,d)):null;if("arcade"===h.type){const e=
await x.createLabelExpression(h.expression,a,f);if(null==e)return n;a={type:"arcade",evaluate(d){try{const b=e.evaluate({$feature:"attributes"in d?e.repurposeFeature(d):d},e.services);if(null!=b)return b.toString()}catch(b){m.error(new l("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:b,feature:d,expression:h}))}return null},needsHydrationToEvaluate(){return null==q.getSingleFieldArcadeExpression(h.expression)}}}else a={type:"simple",evaluate(e){return h.expression.replaceAll(/{[^}]*}/g,
d=>{var b=d.slice(1,-1);b=f.get(b);if(!b)return d;d=null;"attributes"in e?e&&e.attributes&&(d=e.attributes[b.name]):d=e.field(b.name);return null==d?"":r(d,b)})}};if(g){let e;try{e=c.WhereClause.create(g,f)}catch(b){return m.error(new l("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:g,error:b})),n}const d=a.evaluate;a.evaluate=b=>{const z="attributes"in b?void 0:y;try{if(e.testFeature(b,z))return d(b)}catch(A){m.error(new l("bad-where-clause","Encountered an error when evaluating where clause for feature",
{where:g,feature:b,error:A}))}return null}}return a};k.formatField=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});