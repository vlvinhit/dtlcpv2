// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../assets"],function(R,F,S){function y(c,l,g){g.set(c.slice(l,l+g.length))}function T(c){const {_malloc:l,_free:g,_lerc_getBlobInfo:J,_lerc_getDataRanges:K,_lerc_decode_4D:L,asm:I}=c;let e;const x=Object.values(I).find(a=>a&&"buffer"in a&&a.buffer===c.HEAPU8.buffer),z=a=>{a=a.map(h=>(h>>3<<3)+16);var d=a.reduce((h,m)=>h+m),k=l(d);e=new Uint8Array(x.buffer);d=a[0];a[0]=k;for(k=1;k<a.length;k++){const h=a[k];a[k]=a[k-1]+d;d=h}return a};H.getBlobInfo=a=>{var d=new Uint8Array(48),
k=new Uint8Array(24);const [h,m,u]=z([a.length,d.length,k.length]);e.set(a,h);e.set(d,m);e.set(k,u);var b=J(h,a.length,m,u,12,3);if(b)throw g(h),Error(`lerc-getBlobInfo: error code is ${b}`);e=new Uint8Array(x.buffer);y(e,m,d);y(e,u,k);d=new Uint32Array(d.buffer);var f=new Float64Array(k.buffer);const [p,n,,q,w,r,D,A,B,t,E]=d;k={version:p,depthCount:t,width:q,height:w,validPixelCount:D,bandCount:r,blobSize:A,maskCount:B,dataType:n,minValue:f[0],maxValue:f[1],maxZerror:f[2],statistics:[],bandCountWithNoData:E};
if(E)return k;if(1===t&&1===r)return g(h),k.statistics.push({minValue:f[0],maxValue:f[1]}),k;b=t*r*8;var v=new Uint8Array(b),G=new Uint8Array(b);d=h;var C=f=0;let M=!1;e.byteLength<h+2*b?(g(h),M=!0,[d,f,C]=z([a.length,b,b]),e.set(a,d)):[f,C]=z([b,b]);e.set(v,f);e.set(G,C);if(b=K(d,a.length,t,r,f,C))throw g(d),M||g(f),Error(`lerc-getDataRanges: error code is ${b}`);e=new Uint8Array(x.buffer);y(e,f,v);y(e,C,G);a=new Float64Array(v.buffer);b=new Float64Array(G.buffer);G=k.statistics;for(v=0;v<r;v++)if(1<
t){C=a.slice(v*t,(v+1)*t);const P=b.slice(v*t,(v+1)*t),U=Math.min.apply(null,C),V=Math.max.apply(null,P);G.push({minValue:U,maxValue:V,depthStats:{minValues:C,maxValues:P}})}else G.push({minValue:a[v],maxValue:b[v]});g(d);M||g(f);return k};H.decode=(a,d)=>{const {maskCount:k,depthCount:h,bandCount:m,width:u,height:b,dataType:f,bandCountWithNoData:p}=d;var n=N[f],q=u*b;d=new Uint8Array(q*m);n=new Uint8Array(q*h*m*n.size);q=new Uint8Array(m);var w=new Uint8Array(8*m);const [r,D,A,B,t]=z([a.length,d.length,
n.length,q.length,w.length]);e.set(a,r);e.set(d,D);e.set(n,A);e.set(q,B);e.set(w,t);if(a=L(r,a.length,k,D,h,u,b,m,f,A,B,t))throw g(r),Error(`lerc-decode: error code is ${a}`);e=new Uint8Array(x.buffer);y(e,A,n);y(e,D,d);a=null;if(p){y(e,B,q);y(e,t,w);a=[];w=new Float64Array(w.buffer);for(let E=0;E<q.length;E++)a.push(q[E]?w[E]:null)}g(r);return{data:n,maskData:d,noDataValues:a}}}const N=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},
{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}];let O=null,Q=!1;const H={getBlobInfo:null,decode:null};
F.decode=function(c,l={}){var g=l.inputOffset??0;c=c instanceof Uint8Array?c.subarray(g):new Uint8Array(c,g);g=H.getBlobInfo(c);const {data:J,maskData:K,noDataValues:L}=H.decode(c,g),{width:I,height:e,bandCount:x,depthCount:z,dataType:a,maskCount:d,statistics:k}=g;var h=N[a],m=new h.ctor(J.buffer);c=[];g=[];const u=I*e;var b=u*z;for(var f=0;f<x;f++){var p=m.subarray(f*b,(f+1)*b);if(l.returnInterleaved)c.push(p);else{a:{var n=u,q=z;if(2>q)break a;const w=new h.ctor(n*q);for(let r=0,D=0;r<n;r++)for(let A=
0,B=r;A<q;A++,B+=n)w[B]=p[D++];p=w}c.push(p)}g.push(K.subarray(f*b,(f+1)*b))}m=0===d?null:1===d?g[0]:new Uint8Array(u);if(1<d)for(m.set(g[0]),b=1;b<g.length;b++)for(f=g[b],p=0;p<u;p++)m[p]&=f[p];({noDataValue:l}=l);b=null!=l&&h.range[0]<=l&&h.range[1]>=l;if(0<d&&b)for(b=0;b<x;b++)for(f=c[b],p=g[b]||m,n=0;n<u;n++)0===p[n]&&(f[n]=l);({pixelType:h}=h);return{width:I,height:e,bandCount:x,pixelType:h,depthCount:z,statistics:k,pixels:c,mask:m,bandMasks:d===x&&1<x?g:null,noDataValues:L}};F.getBlobInfo=function(c,
l={}){c=c instanceof Uint8Array?c.subarray(l.inputOffset??0):new Uint8Array(c,l.inputOffset??0);return H.getBlobInfo(c)};F.isLoaded=function(){return Q};F.load=function(){return O?O:O=(new Promise((c,l)=>R(["../../../chunks/lerc-wasm"],c,l))).then(c=>c.lercWasm).then(({default:c})=>c({locateFile:l=>S.getAssetUrl(`esri/layers/support/rasterFormats/${l}`)})).then(c=>{T(c);Q=!0})};F.pixelTypeInfoMap=N;Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});