// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../RasterInfo ./BaseRaster ../rasterFunctions/pixelUtils ../rasterFunctions/stretchUtils ../../../geometry/Extent ../../../geometry/SpatialReference".split(" "),function(p,g,e,
u,v,q,H,I,J,w,x,y,z,A,B,C){e=function(r){function h(){var a=r.apply(this,arguments)||this;a.datasetFormat="MEMORY";a.data=null;return a}p._inherits(h,r);var k=h.prototype;k.open=async function(a){await this.init();var b=this.data;const {pixelBlock:c,statistics:d,histograms:l,name:t,keyProperties:D,nativeExtent:E,transform:F}=this.data,{width:m,height:n,pixelType:G}=c,f=b.extent??new B({xmin:-.5,ymin:.5,xmax:m-.5,ymax:n-.5,spatialReference:new C({wkid:3857})});b=new x({width:m,height:n,pixelType:G,
extent:f,nativeExtent:E,transform:F,pixelSize:{x:f.width/m,y:f.height/n},spatialReference:f.spatialReference,bandCount:c.pixels.length,keyProperties:D||{},statistics:d,isPseudoSpatialReference:b.isPseudoSpatialReference??!b.extent,histograms:l});this.createRemoteDatasetStorageInfo(b,512,512);this._set("rasterInfo",b);this.updateTileInfo();await this._buildInMemoryRaster(c,{width:512,height:512},a);this.datasetName=t;this.url="/InMemory/"+t};k.fetchRawTile=function(a,b,c,d){a=this._pixelBlockTiles.get(`${a}/${b}/${c}`);
return Promise.resolve(a)};k._buildInMemoryRaster=async function(a,b,c){var d=this.rasterInfo.storageInfo.maximumPyramidLevel;const l=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:a,tileSize:b,maximumPyramidLevel:d},c):Promise.resolve(z.split(a,b,d));b=null!=this.rasterInfo.statistics;d=null!=this.rasterInfo.histograms;a=b?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:a},c):Promise.resolve(A.estimateStatisticsHistograms(a));
a=await v.eachAlways([l,a]);if(!a[0].value&&a[1].value)throw new u("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=a[0].value;b||(this.rasterInfo.statistics=a[1].value?.statistics);d||(this.rasterInfo.histograms=a[1].value?.histograms)};return p._createClass(h)}(y);g.__decorate([q.property({type:String,json:{write:!0}})],e.prototype,"datasetFormat",void 0);g.__decorate([q.property()],e.prototype,"data",void 0);return e=g.__decorate([w.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],
e)});