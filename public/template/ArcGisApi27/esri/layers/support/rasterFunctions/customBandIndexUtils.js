// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/has"],function(n,r){const q=new Set("+-*/()".split(""));n.calculateCustomBandIndex=function(k,b,c){c=c.replaceAll(" ","");c.startsWith("-")&&(c="0"+c);c.startsWith("+")&&(c=c.slice(1,c.length));c=c.split("");var f=[],d=[],a="";for(var g=0;g<c.length;g++){const h=c[g];q.has(h)?(""!==a&&d.push(parseFloat(a)),f.push(h),a=""):"b"===h.toLowerCase()?(g++,a=h.concat(c[g]),d.push(b[parseInt(a[1],10)-1]),a=""):(a=a.concat(h),g===c.length-1&&d.push(parseFloat(a)))}let {ops:l,
nums:m}={ops:f,nums:d};if(0===l.length){k=1===m.length?m[0]:b[0];if(k instanceof Float32Array)return[k];var e=new Float32Array(b[0].length);"number"===typeof k?e.fill(k):e.set(k);return[e]}for(;0<l.length;){e=l;if(1===e.length)e={opIndex:0,numIndex:0};else{f=c=0;for(b=0;b<e.length;b++)if("("===e[b])c=b;else if(")"===e[b]){f=b;break}d=0===f?e:e.slice(c+1,f);b=-1;for(a=0;a<d.length;a++)if("*"===d[a]||"/"===d[a]){b=a;break}if(!(-1<b))for(a=0;a<d.length;a++)if("+"===d[a]||"-"===d[a]){b=a;break}0<f&&(b+=
c+1);c=0;for(f=0;f<b;f++)"("===e[f]&&c++;e={opIndex:b,numIndex:b-c}}const {numIndex:h,opIndex:p}=e;f=c=b=void 0;e=k;a=l[p];d=m[h];g=m[h+1];if("number"===typeof d&&"number"===typeof g)e=d+g;else{"number"===typeof d?(b=g,f=b.length,c=new Float32Array(f),c.fill(d)):(f=d.length,c=d,g.constructor===Number?(b=new Float32Array(f),b.fill(g)):b=g);d=new Float32Array(f);switch(a){case "+":for(a=0;a<f;a++)if(null==e||e[a])d[a]=c[a]+b[a];break;case "-":for(a=0;a<f;a++)if(null==e||e[a])d[a]=c[a]-b[a];break;case "*":for(a=
0;a<f;a++)if(null==e||e[a])d[a]=c[a]*b[a];break;case "/":for(a=0;a<f;a++)(null==e||e[a])&&b[a]&&(d[a]=c[a]/b[a]);break;case "(":case ")":throw Error("encountered error with custom band index equation");}e=d}if(1===l.length)break;else{b=l;b.splice(p,1);f=c=0;do{f=c=0;for(d=0;d<b.length;d++)if("("===b[d])c=d;else if(")"===b[d]){f=d;break}f===c+1&&b.splice(c,2)}while(f===c+1);l=b;m.splice(h,2,e)}}return[e]};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});