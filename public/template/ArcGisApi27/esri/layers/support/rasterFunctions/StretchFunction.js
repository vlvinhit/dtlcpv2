// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./BaseRasterFunction ./pixelUtils ./StretchFunctionArguments ./stretchUtils".split(" "),function(t,h,m,d,A,B,w,x,y,z,k){d=function(u){function q(){var a=u.apply(this,arguments)||this;a.functionName="Stretch";a.functionArguments=null;a.rasterArgumentNames=
["raster"];a.lookup=null;a.cutOffs=null;return a}t._inherits(q,u);var r=q.prototype;r._bindSourceRasters=function(){this.cutOffs=this.lookup=null;var a=this.sourceRasterInfos[0];const {pixelType:c}=a;var {functionArguments:b}=this;const {dynamicRangeAdjustment:e,gamma:l,useGamma:p}=b;if(!e&&["u8","u16","s8","s16"].includes(c)){b=k.getStretchCutoff(b.toJSON(),{rasterInfo:a});const f=this._isOutputRoundingNeeded()?"round":"float";this.lookup=k.createStretchLUT({pixelType:c,...b,gamma:p?l:null,rounding:f});
this.cutOffs=b}else e||(this.cutOffs=k.getStretchCutoff(b.toJSON(),{rasterInfo:a}));this.outputPixelType=this._getOutputPixelType(c);a=a.clone();a.pixelType=this.outputPixelType;a.statistics=null;a.histograms=null;a.colormap=null;a.attributeTable=null;"u8"===this.outputPixelType&&(a.keyProperties.DataType="processed");this.rasterInfo=a;return{success:!0,supportsGPU:!e}};r._processPixels=function(a){a=a.pixelBlocks?.[0];if(null==a)return a;var {lookup:c}=this;if(c)return y.lookupPixels(a,{...c,outputPixelType:this.rasterInfo.pixelType});
({functionArguments:c}=this);const b=this.cutOffs||k.getStretchCutoff(c.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:a});return k.stretch(a,{...b,gamma:c.useGamma?c.gamma:null,outputPixelType:this.outputPixelType})};r._getWebGLParameters=function(){const {outputMin:a=0,outputMax:c=255,gamma:b,useGamma:e}=this.functionArguments,l=2<=this.rasterInfo.bandCount?3:1,p=e&&b&&b.length?k.computeGammaCorrection(l,b):[1,1,1],{minCutOff:f,maxCutOff:n}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,
255,255]};1===f.length&&(f[1]=f[2]=f[0],n[1]=n[2]=n[0]);const v=new Float32Array(l);var g;for(g=0;g<l;g++)v[g]=(c-a)/(n[g]-f[g]);g=this._isOutputRoundingNeeded();return{bandCount:l,outMin:a,outMax:c,minCutOff:f,maxCutOff:n,factor:v,useGamma:e,gamma:e&&b?b:[1,1,1],gammaCorrection:e&&p?p:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:g,type:"stretch"}};return t._createClass(q)}(x);h.__decorate([m.property({json:{write:!0,name:"rasterFunction"}})],d.prototype,"functionName",void 0);
h.__decorate([m.property({type:z,json:{write:!0,name:"rasterFunctionArguments"}})],d.prototype,"functionArguments",void 0);h.__decorate([m.property()],d.prototype,"rasterArgumentNames",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"lookup",void 0);h.__decorate([m.property({json:{write:!0}})],d.prototype,"cutOffs",void 0);return d=h.__decorate([w.subclass("esri.layers.support.rasterFunctions.StretchFunction")],d)});