// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/Collection ../../core/Evented ../../core/JSONSupport ../../core/Loadable ../../core/reactiveUtils ../../core/string ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./kmlUtils ../../geometry/Extent".split(" "),function(l,e,b,t,v,w,x,f,y,g,z,
C,D,A,B,m,u){var h;b=h=function(n){function p(...c){var a=n.call(this,...c)||this;a.description=null;a.fullExtent=null;a.id=null;a.networkLink=null;a.parent=null;a.sublayers=null;a.title=null;a.sourceJSON=null;a.layer=null;a.addHandles([f.on(()=>a.sublayers,"after-add",({item:d})=>{d.parent=l._assertThisInitialized(a);d.layer=a.layer},f.sync),f.on(()=>a.sublayers,"after-remove",({item:d})=>{d.layer=d.parent=null},f.sync),f.watch(()=>a.sublayers,(d,q)=>{if(q)for(const k of q)k.layer=k.parent=null;
if(d)for(const k of d)k.parent=l._assertThisInitialized(a),k.layer=a.layer},f.sync),f.watch(()=>a.layer,d=>{if(a.sublayers)for(const q of a.sublayers)q.layer=d},f.sync)]);return a}l._inherits(p,n);var r=p.prototype;r.initialize=function(){f.whenOnce(()=>this.networkLink).then(()=>f.whenOnce(()=>!0===this.visible)).then(()=>this.load())};r.load=function(c){if(this.networkLink&&!this.networkLink.viewFormat)return c=null!=c?c.signal:null,c=this._fetchService(this._get("networkLink")?.href??"",c).then(a=>
{const d=m.computeExtent(a.sublayers);this.fullExtent=u.fromJSON(d);this.sourceJSON=a;a=z.ensureType(t.ofType(h),m.sublayersFromJSON(h,a));this.sublayers?this.sublayers.addMany(a):this.sublayers=a;this.layer?.emit("sublayer-update");this.layer&&this.layer.notifyChange("visibleSublayers")}),this.addResolvingPromise(c),Promise.resolve(this)};r.readVisible=function(c,a){return!!a.visibility};r._fetchService=function(c,a){return m.fetchService(c,this.layer.outSpatialReference,this.layer.refreshInterval,
a).then(d=>m.parseKML(d.data))};l._createClass(p,[{key:"visible",get:function(){return this._get("visible")},set:function(c){this._get("visible")!==c&&(this._set("visible",c),this.layer&&this.layer.notifyChange("visibleSublayers"))}}]);return p}(v.EventedMixin(w.JSONSupportMixin(x)));e.__decorate([g.property()],b.prototype,"description",void 0);e.__decorate([g.property({type:u})],b.prototype,"fullExtent",void 0);e.__decorate([g.property()],b.prototype,"id",void 0);e.__decorate([g.property({readOnly:!0,
value:null})],b.prototype,"networkLink",void 0);e.__decorate([g.property({json:{write:{allowNull:!0}}})],b.prototype,"parent",void 0);e.__decorate([g.property({type:t.ofType(h),json:{write:{allowNull:!0}}})],b.prototype,"sublayers",void 0);e.__decorate([g.property({value:null,json:{read:{source:"name",reader(n){return y.stripHTML(n)}}}})],b.prototype,"title",void 0);e.__decorate([g.property({value:!0})],b.prototype,"visible",null);e.__decorate([A.reader("visible",["visibility"])],b.prototype,"readVisible",
null);e.__decorate([g.property()],b.prototype,"sourceJSON",void 0);e.__decorate([g.property()],b.prototype,"layer",void 0);return b=h=e.__decorate([B.subclass("esri.layers.support.KMLSublayer")],b)});