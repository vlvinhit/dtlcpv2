// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/arrayUtils ../../core/Error ../../core/lang ../../core/typedArrayUtil ../../geometry/support/UintArray".split(" "),function(p,q,r,t,l,u,v,w){function x(a){if(a.service.tileServers?.length){var d=a.service.tileServers;d=`${d&&d.length?d[a.row%d.length]:a.service.url}/tilemap/${a.level}/${a.row}/${a.col}/${a.width}/${a.height}`}else d=`${a.service.url}/tilemap/${a.level}/${a.row}/${a.col}/${a.width}/${a.height}`;(a=a.service.query)&&
(d=`${d}?${a}`);return d}let y=function(){function a(b){this._validateJSON(b);const {location:e,data:k}=b;this.location=Object.freeze(u.clone(e));let m=b=!0;const g=w.newUintArray(Math.ceil(this.location.width*this.location.height/32));let h=0;for(let f=0;f<k.length;f++){const n=f%32;k[f]?(m=!1,g[h]|=1<<n):b=!1;31===n&&++h}m?(this._availability="unavailable",this.byteSize=40):b?(this._availability="available",this.byteSize=40):(this._availability=g,this.byteSize=40+v.estimateSize(g))}var d=a.prototype;
d.getAvailability=function(b,e){if("unavailable"===this._availability||"available"===this._availability)return this._availability;b=(b-this.location.top)*this.location.width+(e-this.location.left);e=b>>5;const k=this._availability;return 0>e||e>k.length?"unknown":k[e]&1<<b%32?"available":"unavailable"};a.fromDefinition=function(b,e){const k=b.service.request||r,{row:m,col:g,width:h,height:f}=b,n={query:{f:"json"}};e=e?{...n,...e}:n;return k(x(b),e).then(c=>c.data).catch(c=>{if(c&&c.details&&422===
c.details.httpStatus)return{location:{top:m,left:g,width:h,height:f},valid:!0,data:t.constant(h*f,0)};throw c;}).then(c=>{if(c.location&&(c.location.top!==m||c.location.left!==g||c.location.width!==h||c.location.height!==f))throw new l("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:m,left:g,width:h,height:f}});return a.fromJSON(c)})};a.fromJSON=function(b){return Object.freeze(new a(b))};d._validateJSON=function(b){if(!b||!b.location)throw new l("tilemap:missing-location",
"Location missing from tilemap response");if(!1===b.valid)throw new l("tilemap:invalid","Tilemap response was marked as invalid");if(!b.data)throw new l("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(b.data))throw new l("tilemap:data-mismatch","Data must be an array of numbers");if(b.data.length!==b.location.width*b.location.height)throw new l("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return q._createClass(a)}();p.Tilemap=
y;p.tilemapDefinitionId=function(a){return`${a.level}/${a.row}/${a.col}/${a.width}/${a.height}`};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});