// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../core/Collection ../../core/has ../../core/promiseUtils ./lazyLayerLoader ../../portal/PortalItem ../../portal/support/featureCollectionUtils ../../portal/support/portalLayers ../../renderers/support/styleUtils".split(" "),function(m,v,L,w,f,x,l,y,z){async function n(a,b,d){if(b){var e=[];for(const c of b)b=A(c,d),"GroupLayer"===c.layerType?e.push(B(b,c,d)):e.push(b);d=await w.eachAlways(e);for(const c of d)c.value&&a.add(c.value)}}async function A(a,b){const d=await C(a,b);return D(d,
a,b)}async function D(a,b,d){a=new a;a.read(b,d.context);"group"===a.type&&p(b)&&await E(a,b,d.context);await z.loadStyleRenderer(a,d.context);return a}async function C(a,b){var d=b.context;let e;switch(d.origin){case "web-scene":switch(d.layerContainerType){case "basemap":e=F;break;case "ground":e=G;break;default:e=H}break;case "link-chart":switch(d.layerContainerType){case "basemap":e=I;break;case "tables":e=J;break;default:e=K}break;default:switch(d.layerContainerType){case "basemap":e=q;break;
case "tables":e=r;break;default:e=t}}let c=a.layerType||a.type;!c&&b&&b.defaultLayerType&&(c=b.defaultLayerType);b=(b=e[c])?f.layerLookupMap[b]:f.layerLookupMap.UnknownLayer;"Feature Collection"===a.type?(d=d?.portal,a.itemId&&(a=new x({id:a.itemId,portal:d}),await a.load(),a=(await y.selectLayerClassPath(a)).className||"UnknownLayer",b=f.layerLookupMap[a])):"ArcGISFeatureLayer"===c?l.isMapNotesLayer(a)||l.isMarkupLayer(a)?b=f.layerLookupMap.MapNotesLayer:l.isRouteLayer(a)?b=f.layerLookupMap.RouteLayer:
p(a)&&(b=f.layerLookupMap.GroupLayer):a.wmtsInfo&&a.wmtsInfo.url&&a.wmtsInfo.layerIdentifier?b=f.layerLookupMap.WMTSLayer:"WFS"===c&&"2.0.0"!==a.wfsInfo?.version&&(b=f.layerLookupMap.UnsupportedLayer);return b()}function p(a){return"ArcGISFeatureLayer"!==a.layerType||"Feature Collection"===a.type?!1:1<(a.featureCollection?.layers?.length??0)}async function B(a,b,d){const e=new v;b=n(e,Array.isArray(b.layers)?b.layers:[],d);try{const c=await a;try{if(await b,"group"===c.type)return c.layers.addMany(e),
c}catch(h){c.destroy();for(const g of e)g.destroy();throw h;}}catch(c){throw c;}}async function E(a,b,d){const e=await (0,f.layerLookupMap.FeatureLayer)();var c=b.featureCollection;const h=c?.showLegend;c=c?.layers?.map((g,u)=>{const k=new e;k.read(g,d);g={...d,ignoreDefaults:!0};k.read({id:`${a.id}-sublayer-${u}`,visibility:b.visibleLayers?.includes(u)??!0},g);null!=h&&k.read({showLegend:h},g);return k});a.layers.addMany(c??[])}const H={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",
ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",
WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},G={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",
WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",DefaultTileLayer:"TileLayer"},t={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",
BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},r={ArcGISFeatureLayer:"FeatureLayer"},q={ArcGISImageServiceLayer:"ImageryLayer",
ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},K={...t,LinkChartLayer:"LinkChartLayer"},J={...r},I={...q};m.populateOperationalLayers=n;Object.defineProperty(m,
Symbol.toStringTag,{value:"Module"})});