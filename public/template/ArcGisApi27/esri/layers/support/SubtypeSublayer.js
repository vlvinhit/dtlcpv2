// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/has ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/object ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/extensions/serializableProperty/reader ../../form/FormTemplate ./commonProperties ./featureLayerUtils ./FeatureTemplate ./fieldProperties ./fieldUtils ./LabelClass ./labelingInfo ../../rest/support/Query ../../support/popupUtils ../../symbols/support/defaults".split(" "),
function(I,d,O,B,ma,na,oa,pa,P,F,Q,qa,ra,C,b,R,w,S,T,U,V,J,g,sa,D,W,X,Y,Z,aa,y,ba,K,E,ca,da,ea,fa,ha,G){function z(h){const l=h.json.write;"object"===typeof l?l.ignoreOrigin=!0:h.json.write={ignoreOrigin:!0};return h}function ia(h){switch(h){case "point":case "multipoint":return G.defaultPointSymbol2D.clone();case "polyline":return G.defaultPolylineSymbol2D.clone();case "polygon":case "multipatch":return G.defaultPolygonSymbol2D.clone();default:return null}}function ja(h,l){return l?"unique-value"===
h?.type&&"string"===typeof h.field&&h.field.toLowerCase()===l.toLowerCase()&&!h.field2&&!h.field3&&!h.valueExpression:!1}function L(h,l){return null==h?null:l.subtypes?.find(k=>k.code===h)}const ka="charts editingEnabled formTemplate labelsVisible labelingInfo legendEnabled minScale maxScale opacity popupEnabled popupTemplate renderer subtypeCode templates title visible".split(" ");B={key:"type",base:P,errorContext:"renderer",typeMap:{simple:F,"unique-value":Q,"class-breaks":B}};E=E.defineFieldProperties();
const M=Z.createTypeReader({types:B});let la=0;b=function(h){function l(a){a=h.call(this,a)||this;a.charts=null;a.editingEnabled=!0;a.fieldOverrides=null;a.fieldsIndex=null;a.formTemplate=null;a.id=`${Date.now().toString(16)}-subtype-sublayer-${la++}`;a.type="subtype-sublayer";a.labelsVisible=!0;a.labelingInfo=null;a.layerType="ArcGISFeatureLayer";a.legendEnabled=!0;a.listMode="show";a.minScale=0;a.maxScale=0;a.opacity=1;a.parent=null;a.popupEnabled=!0;a.popupTemplate=null;a.subtypeCode=null;a.templates=
null;a.title=null;a.visible=!0;return a}I._inherits(l,h);var k=l.prototype;k.writeFieldOverrides=function(a,e,c){const {fields:f,parent:m}=this;let n;if(f){n=[];let q=0;f.forEach(({name:x,alias:A,editable:p,visible:t})=>{if(t&&(t=m?.fields?.find(H=>H.name===x))){var r={name:x},u=!1;A!==t.alias&&(r.alias=A,u=!0);p!==t.editable&&(r.editable=p,u=!0);n.push(r);u&&q++}});0===q&&n.length===f.length&&(n=null)}else n=w.clone(a);n?.length&&V.setDeepValue(c,n,e)};k.readRendererFromService=function(a,e,c){if("Table"===
e.type)return null;c=M(e.drawingInfo?.renderer,e,c);a=void 0;const {subtypeCode:f}=this;null!=f&&ja(c,e.subtypeField)?(e=c.uniqueValueInfos?.find(({value:m})=>{m="number"===typeof m?String(m):m;return m===String(f)}))&&(a=new F({symbol:e.symbol})):"simple"!==c?.type||c.visualVariables?.length||(a=c);return a};k.readRenderer=function(a,e,c){if((a=e?.layerDefinition?.drawingInfo?.renderer)&&!a.visualVariables?.some(f=>"rotationInfo"!==f.type))return M(a,e,c)||void 0};k.readTemplatesFromService=function(a,
e){a=this.subtypeCode;let c=null;switch(e.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":c="point";break;case "esriGeometryPolyline":c="line";break;case "esriGeometryPolygon":case "esriGeometryMultiPatch":c="polygon";break;default:c=null}const f={};var m=L(a,e);if(null!=m){({defaultValues:m}=m);for(const n in m)f[n]=m[n]}f[e.subtypeField]=a;return[new K({name:"New Feature",drawingTool:c,prototype:{attributes:f}})]};k.readTitleFromService=function(a,e){a=L(this.subtypeCode,e);
return null!=a?a.name:null};k.addAttachment=async function(a,e){const {parent:c}=this;if(!c)throw v("addAttachment");if(a.getAttribute(c.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:addAttachment","The feature provided does not belong to this SubtypeSublayer");return c.addAttachment(a,e)};k.updateAttachment=async function(a,e,c){const {parent:f}=this;if(!f)throw v("updateAttachment");if(a.getAttribute(f.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:updateAttachment",
"The feature provided does not belong to this SubtypeSublayer");return f.updateAttachment(a,e,c)};k.deleteAttachments=async function(a,e){const {parent:c}=this;if(!c)throw v("deleteAttachments");if(a.getAttribute(c.subtypeField)!==this.subtypeCode)throw new C("subtype-sublayer:deleteAttachments","The feature provided does not belong to this SubtypeSublayer");return c.deleteAttachments(a,e)};k.applyEdits=async function(a,e){if(!this.parent)throw v("applyEdits");return this.parent.applyEdits(a,e)};
k.createPopupTemplate=function(a){let e=this;const {parent:c,fields:f,title:m}=this;if(c){const {displayField:n,editFieldsInfo:q,objectIdField:x}=c;e={displayField:n,editFieldsInfo:q,fields:f,objectIdField:x,title:m}}return ha.createPopupTemplate(e,a)};k.createQuery=function(){if(!this.parent)throw v("createQuery");const a=ba.createQuery(this.parent);a.where=J.sqlAnd(`${this.parent.subtypeField}=${this.subtypeCode}`,this.parent.definitionExpression);return a};k.getField=function(a){return this.fieldsIndex.get(a)};
k.getFieldDomain=function(a){return this._getLayerDomain(a)};k.hasUserOverrides=function(){return ka.some(a=>this.originIdOf(a)===Y.OriginId.USER)};k.queryAttachments=async function(a,e){const c=await this.load();if(!c.parent)throw v("queryAttachments");const f=a.clone();f.where=N(f.where,c.parent.subtypeField,c.subtypeCode);return c.parent.queryAttachments(a,e)};k.queryFeatures=async function(a,e){const c=await this.load();if(!c.parent)throw v("queryFeatures");const f=fa.from(a)??c.createQuery();
null!=a&&(f.where=N(f.where,c.parent.subtypeField,c.subtypeCode));return c.parent.queryFeatures(f,e)};k._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};I._createClass(l,[{key:"capabilities",get:function(){return this.parent?.capabilities}},{key:"effectiveCapabilities",get:function(){return this.parent?.effectiveCapabilities}},{key:"effectiveEditingEnabled",get:function(){const {parent:a}=this;return a?a.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}},
{key:"elevationInfo",get:function(){return this.parent?.elevationInfo}},{key:"fields",get:function(){const {parent:a,fieldOverrides:e,subtypeCode:c}=this;var f=a?.fields;if(!a||!f?.length)return null;const {subtypes:m,subtypeField:n}=a;var q=m?.find(t=>t.code===c);const x=q?.defaultValues;q=q?.domains;const A=[];for(const t of f){f=t.clone();const {name:r}=f;var p=e?.find(u=>u.name===r);f.visible=!e||!!p;if(p){const {alias:u,editable:H}=p;u&&(f.alias=u);!1===H&&(f.editable=!1)}p=x?.[r]??null;f.defaultValue=
r===n?c:p;p=q?.[r]??null;f.domain=r===n?null:p?"inherited"===p.type?f.domain:p.clone():null;A.push(f)}return A}},{key:"floorInfo",get:function(){return this.parent?.floorInfo}},{key:"geometryType",get:function(){return this.parent?.geometryType}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:e}=this;return{minScale:a,maxScale:e}}},{key:"objectIdField",get:function(){this.parent||T.getLogger("esri.layers.support.SubtypeSublayer").error(v("objectIdField"));return this.parent?.objectIdField}},
{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",get:function(){if(this._isOverridden("renderer"))return this._get("renderer");const {parent:a}=this;return a&&!a.isTable&&"mesh"!==a.geometryType?new F({symbol:ia(a.geometryType)}):null},set:function(a){ca.fixRendererFields(a,this.fieldsIndex);this._override("renderer",a)}},{key:"spatialReference",get:function(){return this.parent?.spatialReference}},{key:"url",get:function(){return this.parent?.url}},{key:"userHasUpdateItemPrivileges",
get:function(){return!!this.parent?.userHasUpdateItemPrivileges}}]);return l}(b.HandleOwnerMixin(U.MultiOriginJSONMixin(R.IdentifiableMixin(S))));d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"capabilities",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"effectiveCapabilities",null);d.__decorate([g.property({json:{write:{ignoreOrigin:!0}}})],b.prototype,"charts",void 0);d.__decorate([g.property({type:Boolean,nonNullable:!0,json:{name:"enableEditing",
write:{ignoreOrigin:!0}}})],b.prototype,"editingEnabled",void 0);d.__decorate([g.property({type:Boolean,readOnly:!0})],b.prototype,"effectiveEditingEnabled",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"elevationInfo",null);d.__decorate([g.property({readOnly:!0,json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],b.prototype,"fieldOverrides",void 0);d.__decorate([X.writer("fieldOverrides")],b.prototype,"writeFieldOverrides",
null);d.__decorate([g.property({...E.fields,readOnly:!0,json:{read:!1}})],b.prototype,"fields",null);d.__decorate([g.property(E.fieldsIndex)],b.prototype,"fieldsIndex",void 0);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"floorInfo",null);d.__decorate([g.property({type:aa,json:{name:"formInfo",write:{ignoreOrigin:!0}}})],b.prototype,"formTemplate",void 0);d.__decorate([g.property({type:String,readOnly:!0,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],b.prototype,
"id",void 0);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"geometryType",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);d.__decorate([g.property(z(w.clone(y.labelsVisible)))],b.prototype,"labelsVisible",void 0);d.__decorate([g.property({type:[da],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:ea.reader},write:{ignoreOrigin:!0}}})],b.prototype,"labelingInfo",void 0);d.__decorate([g.property({type:["ArcGISFeatureLayer"],
readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],b.prototype,"layerType",void 0);d.__decorate([g.property(z(w.clone(y.legendEnabled)))],b.prototype,"legendEnabled",void 0);d.__decorate([g.property({type:["show","hide"]})],b.prototype,"listMode",void 0);d.__decorate([g.property((()=>{const h=w.clone(y.minScale);h.json.origins.service.read=!1;return z(h)})())],b.prototype,"minScale",void 0);d.__decorate([g.property((()=>{const h=w.clone(y.maxScale);h.json.origins.service.read=!1;return z(h)})())],
b.prototype,"maxScale",void 0);d.__decorate([g.property({readOnly:!0})],b.prototype,"effectiveScaleRange",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"objectIdField",null);d.__decorate([g.property({type:Number,range:{min:0,max:1},nonNullable:!0,json:{write:{ignoreOrigin:!0}}})],b.prototype,"opacity",void 0);d.__decorate([g.property()],b.prototype,"parent",void 0);d.__decorate([g.property(z(w.clone(y.popupEnabled)))],b.prototype,"popupEnabled",void 0);d.__decorate([g.property({type:O,
json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],b.prototype,"popupTemplate",void 0);d.__decorate([g.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);d.__decorate([g.property({types:B,json:{write:{target:"layerDefinition.drawingInfo.renderer",ignoreOrigin:!0}}})],b.prototype,"renderer",null);d.__decorate([D.reader("service","renderer",["drawingInfo.renderer","subtypeField","type"])],b.prototype,"readRendererFromService",null);d.__decorate([D.reader("renderer",["layerDefinition.drawingInfo.renderer"])],
b.prototype,"readRenderer",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"spatialReference",null);d.__decorate([g.property({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],b.prototype,"subtypeCode",void 0);d.__decorate([g.property({type:[K],json:{name:"layerDefinition.templates",write:{ignoreOrigin:!0}}})],b.prototype,"templates",void 0);d.__decorate([D.reader("service","templates",["geometryType","subtypeField","subtypes","type"])],b.prototype,
"readTemplatesFromService",null);d.__decorate([g.property({type:String,json:{write:{ignoreOrigin:!0}}})],b.prototype,"title",void 0);d.__decorate([D.reader("service","title",["subtypes"])],b.prototype,"readTitleFromService",null);d.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"url",null);d.__decorate([g.property({readOnly:!0})],b.prototype,"userHasUpdateItemPrivileges",null);d.__decorate([g.property({type:Boolean,nonNullable:!0,json:{name:"visibility",write:{ignoreOrigin:!0}}})],
b.prototype,"visible",void 0);b=d.__decorate([W.subclass("esri.layers.support.SubtypeSublayer")],b);const N=(h,l,k)=>{const a=new RegExp(`${l}\\s*=\\s*\\d+`);l=`${l}=${k}`;h=h??"";return a.test(h)?h.replace(a,l):J.sqlAnd(l,h)},v=h=>new C(`This sublayer must have a parent SubtypeGroupLayer in order to use ${h}`);return b});