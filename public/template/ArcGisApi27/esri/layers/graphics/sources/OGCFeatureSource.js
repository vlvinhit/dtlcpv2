// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/Loadable ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../ogc/ogcFeatureUtils ../../../rest/support/FeatureSet ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),function(g,v,m,L,w,B,n,M,N,O,C,
e,D,x,E){g.OGCFeatureSource=function(y){function p(){var a=y.apply(this,arguments)||this;a.featureDefinition=null;a.type="ogc-feature";return a}v._inherits(p,y);var d=p.prototype;d.load=function(a){this.addResolvingPromise(this._loadOGCServices(this.layer,a));return this.when()};d.getSource=function(){const {featureDefinition:{collection:a,layerDefinition:b,spatialReference:c,supportedCrs:f},layer:{apiKey:q,customParameters:r,effectiveMaxRecordCount:t}}=this;return{type:"ogc-source",collection:a,
layerDefinition:b,maxRecordCount:t,queryParameters:{apiKey:q,customParameters:r},spatialReference:c,supportedCrs:f}};d.queryExtent=function(a,b){return null};d.queryFeatureCount=function(a,b){return null};d.queryFeatures=function(a,b={}){return this.queryFeaturesJSON(a,b).then(c=>D.fromJSON(c))};d.queryFeaturesJSON=function(a,b={}){const c=this.getSource();return this.load(b).then(()=>e.queryFeatureSetJSON(c,a,b))};d.queryObjectIds=function(a,b){return null};d.serviceSupportsSpatialReference=function(a){return a.isWGS84||
a.isWebMercator?!0:!!this.featureDefinition.supportedCrs[a.wkid]};d._conformsToType=function(a,b){const c=new RegExp(`^${b}$`,"i");return a.conformsTo.some(f=>c.test(f))??!1};d._getCapabilities=function(a,b){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:a},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,
supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:b,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,
supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,
supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,
supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1}}};d._getMaxRecordCount=function(a){a=a?.components?.parameters;return a?.limit?.schema?.maximum??a?.limitFeatures?.schema?.maximum};d._getStorageSpatialReference=function(a){a=e.getSpatialReferenceWkid(a.storageCrs??e.crsDefault);return null==a?x.WGS84:new x({wkid:a})};d._getSupportedSpatialReferences=function(a,b){a=a.crs??[e.crsDefault];const c=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return(a.includes("#/crs")?a.filter(f=>"#/crs"!==
f).concat(b.crs??[]):a).filter(f=>!c.test(f))};d._loadOGCServices=async function(a,b){var c=null!=b?b.signal:null;const {apiKey:f,collectionId:q,customParameters:r,fields:t,geometryType:F,hasZ:G,objectIdField:H,timeInfo:I,url:J}=a;b={fields:t?.map(k=>k.toJSON()),geometryType:E.typeKebabDictionary.toJSON(F),hasZ:G??!1,objectIdField:H,timeInfo:I?.toJSON()};c={apiKey:f,customParameters:r,signal:c};var h=await e.getServerLandingPage(J,c);const [z,A]=await Promise.all([e.getServerConformance(h,c),e.getServerCollections(h,
c)]);if(!this._conformsToType(z,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new w("ogc-feature-layer:no-geojson-support","Server does not support geojson");a=A.collections.find(k=>k.id===q);if(!a)throw new w("ogc-feature-layer:collection-not-found","Server does not contain the named collection");h=this._conformsToType(z,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await e.getServerOpenApi(h,c):null;b=await e.getCollectionDefinition(a,b,c);c=this._getMaxRecordCount(h);
c=this._getCapabilities(b.hasZ,c);h=this._getStorageSpatialReference(a).toJSON();var l=this._getSupportedSpatialReferences(a,A);const K=new RegExp(`^${e.crsPrefix}`,"i"),u={};for(const k of l)l=e.getSpatialReferenceWkid(k),null!=l&&(u[l]||(u[l]=k.replace(K,"")));this.featureDefinition={capabilities:c,collection:a,layerDefinition:b,spatialReference:h,supportedCrs:u}};return v._createClass(p)}(B);m.__decorate([n.property()],g.OGCFeatureSource.prototype,"featureDefinition",void 0);m.__decorate([n.property({constructOnly:!0})],
g.OGCFeatureSource.prototype,"layer",void 0);m.__decorate([n.property()],g.OGCFeatureSource.prototype,"type",void 0);g.OGCFeatureSource=m.__decorate([C.subclass("esri.layers.graphics.sources.OGCFeatureSource")],g.OGCFeatureSource);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});