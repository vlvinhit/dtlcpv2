// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["exports","../../../../request","../../../../core/promiseUtils","../../../../core/urlUtils","../../../support/arcgisLayerUrl"],function(t,e,h,a,z){t.uploadItem=async function({data:b,name:d,description:A},u,k){var c=null;try{const f=a.join(u,"uploads"),B=a.join(f,"info"),{data:C}=await e(B,{query:{f:"json"},responseType:"json"});h.throwIfAborted(k);const v=z.isHostedAgolService(u),w=1E6*C.maxUploadFileSize;var g=v?Math.min(2E7,w):2E7;if(b.size>(v?2E9:w))throw Error("Data too large");const D=
a.join(f,"register"),{data:x}=await e(D,{query:{f:"json",itemName:d,description:A},responseType:"json",method:"post"});h.throwIfAborted(k);if(!x.success)throw Error("Registration failed");const {itemID:E}=x.item;c=a.join(f,E);const F=a.join(c,"uploadPart");var l=Math.ceil(b.size/g);const m=[];for(d=0;d<l;++d)m.push(b.slice(d*g,Math.min((d+1)*g,b.size)));const n=m.slice().reverse();b=[];g=async()=>{for(;0!==n.length;){var p=m.length-n.length;const r=n.pop(),q=new FormData;q.append("f","json");q.append("file",
r);q.append("partId",`${p}`);({data:p}=await e(F,{timeout:0,body:q,responseType:"json",method:"post"}));h.throwIfAborted(k);if(!p.success)throw Error("Part upload failed");}};for(l=0;3>l&&0!==n.length;++l)b.push(g());await Promise.all(b);const G=a.join(c,"commit"),{data:y}=await e(G,{query:{f:"json",parts:m.map((p,r)=>r).join(",")},responseType:"json",method:"post"});h.throwIfAborted(k);if(!y.success)throw Error("Commit failed");return y.item}catch(f){throw null!=c&&(c=a.join(c,"delete"),await e(c,
{query:{f:"json"},responseType:"json",method:"post"})),f;}};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});