// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/CollectionFlattener ../core/loadAll ../core/Logger ../core/MultiOriginJSONSupport ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/lazyLayerLoader ../support/collectionUtils ../support/LayersMixin ../support/TablesMixin ../support/tagSymbols ../webdoc/support/writeUtils".split(" "),
function(q,e,r,t,u,c,k,f,J,K,L,v,w,x,y,z,A,B,C,D,E,F,G,H,I){c=function(p){function m(a){var b=p.call(this,a)||this;b.allLayers=new r({getCollections:()=>[b.layers],getChildrenFunction:g=>"layers"in g?g.layers:null});b.allTables=E.createFlattenedTablesCollection(q._assertThisInitialized(b));b.fullExtent=void 0;b.operationalLayerType="GroupLayer";b.spatialReference=void 0;b.type="group";return b}q._inherits(m,p);var d=m.prototype;d.initialize=function(){this._enforceVisibility(this.visibilityMode,this.visible);
this.addHandles([k.watch(()=>{let a=this.parent;for(;a&&"parent"in a&&a.parent;)a=a.parent;return a&&H.WebSceneTag in a},a=>{this.removeHandles("prevent-adding-tables");a&&(this.tables.removeAll(),this.addHandles(k.on(()=>this.tables,"before-add",b=>{b.preventDefault();u.getLogger(this).errorOnce("tables","Tables are not yet supported in a WebScene so they can't be added.")}),"prevent-adding-tables"))},k.syncAndInitial),k.watch(()=>this.visible,this._onVisibilityChange.bind(this),k.sync)])};d.destroy=
function(){this.allLayers.destroy();this.allTables.destroy()};d._writeLayers=function(a,b,g,h){const l=[];if(!a)return l;a.forEach(n=>{n=I.getLayerJSON(n,h.webmap?h.webmap.getLayerJSONFromResourceInfo(n):null,h);null!=n&&n.layerType&&l.push(n)});b.layers=l};d.load=function(a){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"],layerModuleTypeMap:D.layerLookupMap},a));return Promise.resolve(this)};d.loadAll=async function(){return t.loadAll(this,
a=>{a(this.layers,this.tables)})};d.layerAdded=function(a){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);this.hasHandles(a.uid)?console.error(`Layer readded to Grouplayer: uid=${a.uid}`):this.addHandles(k.watch(()=>a.visible,b=>this._onChildVisibilityChange(a,b),k.sync),a.uid)};d.layerRemoved=function(a){this.removeHandles(a.uid);this._enforceVisibility(this.visibilityMode,this.visible)};d._turnOffOtherLayers=function(a){this.layers.forEach(b=>
{b!==a&&(b.visible=!1)})};d._enforceVisibility=function(a,b){if(v.getProperties(this).initialized){var g=this.layers,h=g.find(l=>l.visible);switch(a){case "exclusive":g.length&&!h&&(h=g.at(0),h.visible=!0);this._turnOffOtherLayers(h);break;case "inherited":g.forEach(l=>{l.visible=b})}}};d._onVisibilityChange=function(a){"inherited"===this.visibilityMode&&this.layers.forEach(b=>{b.visible=a})};d._onChildVisibilityChange=function(a,b){switch(this.visibilityMode){case "exclusive":b?this._turnOffOtherLayers(a):
this._isAnyLayerVisible()||(a.visible=!0);break;case "inherited":a.visible=this.visible}};d._isAnyLayerVisible=function(){return this.layers.some(a=>a.visible)};q._createClass(m,[{key:"portalItem",set:function(a){this._set("portalItem",a)}},{key:"visibilityMode",set:function(a){const b=this._get("visibilityMode")!==a;this._set("visibilityMode",a);b&&this._enforceVisibility(a,this.visible)}}]);return m}(z.BlendLayer(C.ScaleRangeLayer(A.OperationalLayer(B.PortalLayer(G.TablesMixin(F.LayersMixin(c.MultiOriginJSONMixin(y))))))));
e.__decorate([f.property({readOnly:!0,dependsOn:[]})],c.prototype,"allLayers",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"allTables",void 0);e.__decorate([f.property()],c.prototype,"fullExtent",void 0);e.__decorate([f.property({json:{read:!0,write:!0}})],c.prototype,"blendMode",void 0);e.__decorate([f.property({json:{read:!1,write:{ignoreOrigin:!0}}})],c.prototype,"layers",void 0);e.__decorate([x.writer("layers")],c.prototype,"_writeLayers",null);e.__decorate([f.property({type:["GroupLayer"]})],
c.prototype,"operationalLayerType",void 0);e.__decorate([f.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"portalItem",null);e.__decorate([f.property()],c.prototype,"spatialReference",void 0);e.__decorate([f.property({json:{read:!1},readOnly:!0,value:"group"})],c.prototype,"type",void 0);e.__decorate([f.property({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(p,m,d)=>{"inherited"!==
p&&(m[d]=p)}}}}})],c.prototype,"visibilityMode",null);return c=e.__decorate([w.subclass("esri.layers.GroupLayer")],c)});