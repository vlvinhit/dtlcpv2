// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),function(w,
r,p,A,G,H,I,B,t,O,P,Q,J,K,d,x,L){function M(f,n){const g=[],h={};if(!f)return g;f.forEach(a=>{const b=new x;b.read(a,n);h[b.id]=b;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=h[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(b)):g.unshift(b)});return g}function y(f,n){f&&f.forEach(g=>{n(g);g.sublayers&&g.sublayers.length&&y(g.sublayers,n)})}const N=I.getLogger("esri.layers.TileLayer"),z=A.ofType(x);w.SublayersOwner=f=>{f=function(n){function g(...a){var b=n.call(this,...a)||this;
b.allSublayers=new G({getCollections:()=>[b.sublayers],getChildrenFunction(c){return c.sublayers}});b.sublayersSourceJSON={[d.OriginId.SERVICE]:{},[d.OriginId.PORTAL_ITEM]:{},[d.OriginId.WEB_SCENE]:{},[d.OriginId.WEB_MAP]:{}};b.addHandles(B.watch(()=>b.sublayers,(c,k)=>b._handleSublayersChange(c,k),B.sync));return b}r._inherits(g,n);var h=g.prototype;h.destroy=function(){this.allSublayers.destroy()};h.readSublayers=function(a,b){if(b&&a){var {sublayersSourceJSON:c}=this,k=d.nameToId(b.origin);if(!(k<
d.OriginId.SERVICE||(c[k]={context:b,visibleLayers:a.visibleLayers||c[k].visibleLayers,layers:a.layers||c[k].layers},k>d.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:m,origin:l}=this.createSublayersForOrigin("web-document");a=J.getProperties(this);a.setDefaultOrigin(l);this._set("sublayers",new z(m));a.setDefaultOrigin("user")}}};h.findSublayerById=function(a){return this.allSublayers.find(b=>b.id===a)};h.createServiceSublayers=
function(){return this.createSublayersForOrigin("service").sublayers};h.createSublayersForOrigin=function(a){const b="web-document"===a?d.nameToId("web-map"):d.nameToId(a);let c=d.OriginId.SERVICE;a=this.sublayersSourceJSON[d.OriginId.SERVICE].layers;let k=this.sublayersSourceJSON[d.OriginId.SERVICE].context,m=null;var l=[d.OriginId.PORTAL_ITEM,d.OriginId.WEB_SCENE,d.OriginId.WEB_MAP].filter(e=>e<=b);for(var u of l)l=this.sublayersSourceJSON[u],L.isSublayerOverhaul(l.layers)&&(c=u,a=l.layers,k=l.context,
l.visibleLayers&&(m={visibleLayers:l.visibleLayers,context:l.context}));u=[d.OriginId.PORTAL_ITEM,d.OriginId.WEB_SCENE,d.OriginId.WEB_MAP].filter(e=>e>c&&e<=b);let q=null;for(var v of u){const {layers:e,visibleLayers:C,context:D}=this.sublayersSourceJSON[v];e&&(q={layers:e,context:D});C&&(m={visibleLayers:C,context:D})}v=M(a,k);const E=new Map,F=new Set;if(q)for(const e of q.layers)E.set(e.id,e);if(m?.visibleLayers)for(const e of m.visibleLayers)F.add(e);y(v,e=>{q&&e.read(E.get(e.id),q.context);m&&
e.read({defaultVisibility:F.has(e.id)},m.context)});return{origin:d.idToName(c),sublayers:new z({items:v})}};h.read=function(a,b){r._get(r._getPrototypeOf(g.prototype),"read",this).call(this,a,b);this.readSublayers(a,b)};h._handleSublayersChange=function(a,b){b&&(b.forEach(c=>{c.parent=null;c.layer=null}),this.removeHandles("sublayers-owner"));a&&(a.forEach(c=>{c.parent=this;c.layer=this}),this.addHandles([a.on("after-add",({item:c})=>{c.parent=this;c.layer=this}),a.on("after-remove",({item:c})=>
{c.parent=null;c.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(a.on("before-changes",c=>{N.error(new H("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));c.preventDefault()}),"sublayers-owner"))};return r._createClass(g)}(f);p.__decorate([t.property({readOnly:!0})],f.prototype,"allSublayers",void 0);p.__decorate([t.property({readOnly:!0,type:A.ofType(x)})],f.prototype,"serviceSublayers",void 0);p.__decorate([t.property({value:null,
type:z,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"sublayers",void 0);p.__decorate([t.property({readOnly:!0})],f.prototype,"sublayersSourceJSON",void 0);return f=p.__decorate([K.subclass("esri.layers.mixins.SublayersOwner")],f)};w.forEachSublayer=y;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});