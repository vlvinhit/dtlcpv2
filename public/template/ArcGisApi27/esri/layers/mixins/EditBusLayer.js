// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/lang ../../core/promiseUtils ../../core/Logger ../../core/accessorSupport/ensureType ../../core/Error ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(f,n,x,y,l,z,F,G,H,I,A){const p=new y.EventEmitter,q=Symbol("esri.layers.mixins.EditBusLayer");f.EditBusLayer=c=>{c=function(g){function e(...B){var a=g.call(this,...B)||this;a[h]=!0;a.when().then(()=>{a.own([p.on("apply-edits",
m=>{const {serviceUrl:C,layerId:r,mayReceiveServiceEdits:D,result:E}=m,t=null!=r&&null!=a.layerId&&r===a.layerId;C===a.url&&(t||D)&&(m=E.then(b=>{if(t&&(b.addedFeatures.length||b.updatedFeatures.length||b.deletedFeatures.length||b.addedAttachments.length||b.updatedAttachments.length||b.deletedAttachments.length))return a.emit("edits",l.clone(b)),b;const u=b.editedFeatures?.find(({layerId:k})=>k===a.layerId);if(u){const {adds:k,updates:v,deletes:w}=u.editedFeatures;b={edits:null,addedAttachments:[],
deletedAttachments:[],updatedAttachments:[],addedFeatures:k?k.map(({attributes:d})=>({objectId:a.objectIdField&&d[a.objectIdField],globalId:a.globalIdField&&d[a.globalIdField]})):[],deletedFeatures:w?w.map(({attributes:d})=>({objectId:a.objectIdField&&d[a.objectIdField],globalId:a.globalIdField&&d[a.globalIdField]})):[],updatedFeatures:v?v.map(({current:{attributes:d}})=>({objectId:a.objectIdField&&d[a.objectIdField],globalId:a.globalIdField&&d[a.globalIdField]})):[],editedFeatures:l.clone(b.editedFeatures),
exceededTransferLimit:!1};a.emit("edits",b);return b}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:l.clone(b.editedFeatures),exceededTransferLimit:!1}}),a.emit("apply-edits",{result:m}))})])},()=>{});return a}n._inherits(e,g);return n._createClass(e)}(c);var h=q;return c=x.__decorate([A.subclass("esri.layers.mixins.EditBusLayer")],c)};f.emitApplyEditsEvent=function(c,h,g=!1){const e=z.createResolver();
p.emit("apply-edits",{serviceUrl:c,layerId:h,mayReceiveServiceEdits:null==h?!0:g,result:e.promise});return e};f.isEditBusLayer=function(c){return null!=c&&"object"===typeof c&&q in c};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});