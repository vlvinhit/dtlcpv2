// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define(["../../chunks/_rollupPluginBabelHelpers","../graphics/featureConversionUtils","../graphics/OptimizedFeature"],function(m,n,k){return function(){function b(){this._featureLookup=new Map}b.getInstance=function(){b.instance||(b.instance=new b);return b.instance};b.resetInstance=function(){b.instance&&(b.instance=null)};var g=b.prototype;g.deleteFromStore=function(e){e.forEach(d=>{this._featureLookup.delete(d)})};g.readFromStoreByList=function(e){const d=[];e.forEach(f=>{(f=this.readFromStoreById(f))&&
d.push(f)});return d};g.readFromStoreById=function(e){return this._featureLookup.get(e)??null};g.writeToStore=function(e,d,f){const l=[];e.forEach(a=>{if(a&&a.id){a.properties||(a.properties=[]);var c=null;f&&(c=a.properties[f]?n.convertFromGeometry(a.properties[f]):null);"originId"in a&&"destinationId"in a&&(a.properties.ESRI__ORIGIN_ID=a.originId,a.properties.ESRI__DESTINATION_ID=a.destinationId);if((a.properties[d]=a.id)&&this._featureLookup.has(a.id)&&this._featureLookup.get(a.id).attributes){const h=
this._featureLookup.get(a.id);c=new k.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):h?.geometry?JSON.parse(JSON.stringify(h.geometry)):null,JSON.parse(JSON.stringify(Object.assign(h.attributes,a.properties))),null,a.properties[d])}else c=new k.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):null,a.properties,null,a.properties[d]);this._featureLookup.set(a.id,c);l.push(c)}});return l};return m._createClass(b)}()});