// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../request ../core/mathUtils ../core/MultiOriginJSONSupport ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Polyline ../geometry/SpatialReference ./Layer ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/ScaleRangeLayer ./support/commonProperties ./support/PlaybackInfo ./support/serviceCapabilitiesUtils ./support/TelemetryData ./support/TelemetryDisplay ./support/VideoFrame ./video/VideoController ./video/videoUtils ../geometry/Polygon ../geometry/Extent".split(" "),
function(m,c,b,q,r,t,h,d,K,L,M,u,v,w,x,y,z,A,B,C,D,E,F,n,G,H,k,I,J){b=function(p){function g(a){a=p.call(this,a)||this;a._trailPoints=[];a.capabilities=null;a.connectionInfo=null;a.controller=new H;a.copyright=null;a.coverage=null;a.description=null;a.frame=null;a.frameCount=null;a.initialExtent=null;a.playbackInfo=null;a.posterUrl=null;a.protocol="hls";a.qualities=null;a.sourceJSON=null;a.spatialReference=x.WGS84;a.telemetryDisplay=null;a.videoTimeExtent=null;a.title=null;a.type="video";a.url=null;
return a}m._inherits(g,p);var e=g.prototype;e.initialize=function(){this.telemetryDisplay=new n({frameCenter:!0,frameOutline:!0,lineOfSight:!0,sensorLocation:!0,sensorTrail:!0});this.addHandles([h.watch(()=>this.metadata,()=>this.notifyChange("telemetry")),h.watch(()=>this.telemetry?.sensorLocation,a=>this._setSensorTrail(a),h.initial)])};e.load=function(a){this.addResolvingPromise(this._fetchService(null!=a?a.signal:null));return Promise.resolve(this)};e.readCapabilitiesFromService=function(a,f){return E.getVideoLayerCapabilities(f)};
e.play=function(){this.controller.play()};e.pause=function(){this.controller.pause()};e.reset=function(){this.controller.reset()};e.setCurrentTime=function(a){this.duration&&(a=r.clamp(a,0,this.duration),this.controller.setCurrentTime(a))};e.getCurrentFrame=function(){};e.toGround=function(a,f){return this.controller?.cameraSensorModel?.metadataSupportsTransforms?this.controller.cameraSensorModel.transformImageToGeo(a,f):null};e.toVideo=function(a){if(!this.controller?.cameraSensorModel?.metadataSupportsTransforms)return null;
a=this.controller.cameraSensorModel.transformGeoToImage(a.x,a.y,a.z);return{x:a[0],y:a[1]}};e._fetchService=async function(a){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:f,ssl:l}=await q(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},signal:a});l&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=f;this.read(f,{origin:"service",url:this.parsedUrl})}};e._setSensorTrail=function(a){if(a){this._trailPoints=
[...k.getSensorTrailPoints(a,this._trailPoints)];var f=this._trailPoints.map(l=>l.toArray());a=new w({hasZ:a.hasZ,paths:[f]});this.telemetry.sensorTrail=a.clone()}};m._createClass(g,[{key:"buffered",get:function(){return this.controller.buffered}},{key:"currentTime",get:function(){return this.controller.currentTime}},{key:"duration",get:function(){return this.controller.duration}},{key:"ended",get:function(){return this.controller.ended}},{key:"loop",get:function(){return this.controller.loop},set:function(a){this.controller.loop=
a}},{key:"metadata",get:function(){return this.controller?.currentMetadata}},{key:"muted",get:function(){return this.controller.muted},set:function(a){this.controller.muted=a}},{key:"playbackRate",get:function(){return this.controller.rate},set:function(a){this.controller.rate=a}},{key:"playbackUrl",get:function(){return this.connectionInfo&&this.protocol?this.connectionInfo[this.protocol]:null}},{key:"sourceUrl",get:function(){return this.controller.sourceUrl??""},set:function(a){this.controller.sourceUrl=
a}},{key:"state",get:function(){return this.controller.state}},{key:"telemetry",get:function(){return k.getTelemetryData(this.metadata)}},{key:"waiting",get:function(){return this.controller.waiting}}]);return g}(z.BlendLayer(B.ScaleRangeLayer(t.MultiOriginJSONMixin(A.CustomParametersMixin(y)))));c.__decorate([d.property({readOnly:!0})],b.prototype,"buffered",null);c.__decorate([d.property({readOnly:!0,json:{read:!1}})],b.prototype,"capabilities",void 0);c.__decorate([u.reader("service","capabilities",
["supportsCoverageQuery","supportsExportClip","supportsMensuration"])],b.prototype,"readCapabilitiesFromService",null);c.__decorate([d.property({readOnly:!0,json:{read:{source:"connectionUrl"}}})],b.prototype,"connectionInfo",void 0);c.__decorate([d.property()],b.prototype,"controller",void 0);c.__decorate([d.property({type:String})],b.prototype,"copyright",void 0);c.__decorate([d.property({type:I})],b.prototype,"coverage",void 0);c.__decorate([d.property({type:Number})],b.prototype,"currentTime",
null);c.__decorate([d.property({type:String})],b.prototype,"description",void 0);c.__decorate([d.property({type:Number})],b.prototype,"duration",null);c.__decorate([d.property({type:Boolean})],b.prototype,"ended",null);c.__decorate([d.property({type:G})],b.prototype,"frame",void 0);c.__decorate([d.property({type:Number})],b.prototype,"frameCount",void 0);c.__decorate([d.property({type:J})],b.prototype,"initialExtent",void 0);c.__decorate([d.property({type:Boolean})],b.prototype,"loop",null);c.__decorate([d.property({readOnly:!0})],
b.prototype,"metadata",null);c.__decorate([d.property({type:Boolean})],b.prototype,"muted",null);c.__decorate([d.property({type:D})],b.prototype,"playbackInfo",void 0);c.__decorate([d.property({type:Number})],b.prototype,"playbackRate",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"playbackUrl",null);c.__decorate([d.property({readOnly:!0,json:{read:{source:"poster"}}})],b.prototype,"posterUrl",void 0);c.__decorate([d.property({type:String})],b.prototype,"protocol",void 0);c.__decorate([d.property({readOnly:!0})],
b.prototype,"qualities",void 0);c.__decorate([d.property()],b.prototype,"sourceJSON",void 0);c.__decorate([d.property({type:String})],b.prototype,"sourceUrl",null);c.__decorate([d.property()],b.prototype,"spatialReference",void 0);c.__decorate([d.property({type:String})],b.prototype,"state",null);c.__decorate([d.property({type:F})],b.prototype,"telemetry",null);c.__decorate([d.property({type:n})],b.prototype,"telemetryDisplay",void 0);c.__decorate([d.property({readOnly:!0,nonNullable:!1,json:{read:{reader:k.readVideoTimeExtent,
source:"time"}}})],b.prototype,"videoTimeExtent",void 0);c.__decorate([d.property({readOnly:!0,json:{read:{source:"name"}}})],b.prototype,"title",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"type",void 0);c.__decorate([d.property(C.url)],b.prototype,"url",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"waiting",null);return b=c.__decorate([v.subclass("esri.layers.VideoLayer")],b)});