// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(u,p){function d(c,n){n=p.getMetersPerUnitForSR(n);return c/(n*p.inchesPerMeter*96)}u.getExtentForScale=function(c,n){const l=c.extent;c=c.width-(c.padding?c.padding.left+c.padding.right:0);n=d(n,l.spatialReference);return l.clone().expand(n*c/l.width)};u.getResolutionForScale=d;u.getResolutionInMetersForScale=function(c){return c/(96*p.inchesPerMeter)};u.getScale=function(c,n){n=n||c.extent;
c=c.width;const l=p.getMetersPerUnitForSR(n&&n.spatialReference);return n&&c?n.width/c*l*p.inchesPerMeter*96:0};u.getScaleForResolution=function(c,n){n=p.getMetersPerUnitForSR(n);return c*n*p.inchesPerMeter*96};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/MapUtils ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../../geometry/Extent ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../../portal/support/portalItemUtils".split(" "),
function(u,p,d,c,n,l,v,H,O,J,na,oa,da,ha,A,Y,R,ba,h,F){u.ArcGISMapService=y=>{y=function(x){function B(){var k=x.apply(this,arguments)||this;k.capabilities=void 0;k.copyright=null;k.fullExtent=null;k.legendEnabled=!0;k.spatialReference=null;k.version=void 0;k._allLayersAndTablesMap=null;return k}p._inherits(B,x);var G=B.prototype;G.readCapabilities=function(k,g){var q=g.capabilities&&g.capabilities.split(",").map(L=>L.toLowerCase().trim());if(!q)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,
supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var r=this.type;k="tile"!==r&&!!g.supportsDynamicLayers;const m=q.includes("query"),Q=q.includes("map"),M=!!g.exportTilesAllowed,ca=q.includes("tilemap");q=q.includes("data");const V="tile"!==r&&(!g.tileInfo||k),S="tile"!==r&&(!g.tileInfo||k);r="tile"!==r;var z=g.cimVersion&&H.Version.parse(g.cimVersion);const aa=z?.since(1,4)??!1;z=z?.since(2,0)??!1;return{operations:{supportsExportMap:Q,supportsExportTiles:M,
supportsIdentify:m,supportsQuery:q,supportsTileMap:ca},exportMap:Q?{supportsArcadeExpressionForLabeling:aa,supportsSublayersChanges:r,supportsDynamicLayers:k,supportsSublayerVisibility:V,supportsSublayerDefinitionExpression:S,supportsCIMSymbols:z}:null,exportTiles:M?{maxExportTilesCount:+g.maxExportTilesCount}:null}};G.readVersion=function(k,g){(k=g.currentVersion)||(k=g.hasOwnProperty("capabilities")||g.hasOwnProperty("tables")?10:g.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return k};
G.fetchRelatedService=async function(k){var g=this.portalItem;if(!g||!F.isHostedLayer(g))return null;this._relatedFeatureServicePromise||(this._relatedFeatureServicePromise=g.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},k).then(q=>q.find(r=>"Feature Service"===r.type)??null,()=>null));g=await this._relatedFeatureServicePromise;l.throwIfAborted(k);return g?{itemId:g.id,url:g.url}:null};G.fetchSublayerInfo=async function(k,g){const {source:q}=k;if(this?.portalItem&&"tile"===
this.type&&"map-layer"===q?.type&&F.isHostedLayer(this.portalItem)&&k.originIdOf("url")<A.OriginId.SERVICE){var r=await this.fetchRelatedService(g);r&&(k.url=v.join(r.url,q.mapLayerId.toString()),k.layerItemId=r.itemId)}({url:r}=k);let m;if("data-layer"===q.type)m=(await c(r,{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey},...g})).data;else if(r&&k.originIdOf("url")>A.OriginId.SERVICE)try{m=(await this._fetchAllLayersAndTablesFromService(r)).get(q.mapLayerId)}catch{}else{k=
k.id;"map-layer"===q?.type&&(k=q.mapLayerId);try{m=(await this.fetchAllLayersAndTables(g)).get(k)}catch{}}return m};G.fetchAllLayersAndTables=async function(k){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,k)};G._fetchAllLayersAndTablesFromService=async function(k,g){await this.load(g);this._allLayersAndTablesMap||(this._allLayersAndTablesMap=new Map);const q=ba.parse(k);k=await n.getOrCreateMapValue(this._allLayersAndTablesMap,q?.url.path,()=>c(v.join(q?.url.path,"/layers"),
{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(r=>{const m=new Map;for(const Q of r.data.layers)m.set(Q.id,Q);return{result:m}},r=>({error:r})));l.throwIfAborted(g);if("result"in k)return k.result;throw k.error;};return p._createClass(B)}(y);d.__decorate([O.property({readOnly:!0})],y.prototype,"capabilities",void 0);d.__decorate([da.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],
y.prototype,"readCapabilities",null);d.__decorate([O.property({json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0);d.__decorate([O.property({type:Y})],y.prototype,"fullExtent",void 0);d.__decorate([O.property(h.id)],y.prototype,"id",void 0);d.__decorate([O.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],y.prototype,"legendEnabled",void 0);d.__decorate([O.property(h.popupEnabled)],y.prototype,"popupEnabled",
void 0);d.__decorate([O.property({type:R})],y.prototype,"spatialReference",void 0);d.__decorate([O.property({readOnly:!0})],y.prototype,"version",void 0);d.__decorate([da.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],y.prototype,"readVersion",null);return y=d.__decorate([ha.subclass("esri.layers.mixins.ArcGISMapService")],y)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(u,p,d,c,n,l,v,H,O,J,na,oa,da,ha,A,Y,R){function ba(x,B){const G=[],k={};if(!x)return G;x.forEach(g=>{const q=new Y;q.read(g,B);k[q.id]=q;null!=g.parentLayerId&&-1!==g.parentLayerId?(g=k[g.parentLayerId],g.sublayers||(g.sublayers=[]),g.sublayers.unshift(q)):G.unshift(q)});return G}function h(x,B){x&&x.forEach(G=>{B(G);G.sublayers&&G.sublayers.length&&h(G.sublayers,B)})}const F=v.getLogger("esri.layers.TileLayer"),y=c.ofType(Y);u.SublayersOwner=x=>{x=function(B){function G(...g){var q=B.call(this,
...g)||this;q.allSublayers=new n({getCollections:()=>[q.sublayers],getChildrenFunction(r){return r.sublayers}});q.sublayersSourceJSON={[A.OriginId.SERVICE]:{},[A.OriginId.PORTAL_ITEM]:{},[A.OriginId.WEB_SCENE]:{},[A.OriginId.WEB_MAP]:{}};q.addHandles(H.watch(()=>q.sublayers,(r,m)=>q._handleSublayersChange(r,m),H.sync));return q}p._inherits(G,B);var k=G.prototype;k.destroy=function(){this.allSublayers.destroy()};k.readSublayers=function(g,q){if(q&&g){var {sublayersSourceJSON:r}=this,m=A.nameToId(q.origin);
if(!(m<A.OriginId.SERVICE||(r[m]={context:q,visibleLayers:g.visibleLayers||r[m].visibleLayers,layers:g.layers||r[m].layers},m>A.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:Q,origin:M}=this.createSublayersForOrigin("web-document");g=da.getProperties(this);g.setDefaultOrigin(M);this._set("sublayers",new y(Q));g.setDefaultOrigin("user")}}};k.findSublayerById=function(g){return this.allSublayers.find(q=>q.id===g)};k.createServiceSublayers=
function(){return this.createSublayersForOrigin("service").sublayers};k.createSublayersForOrigin=function(g){const q="web-document"===g?A.nameToId("web-map"):A.nameToId(g);let r=A.OriginId.SERVICE;g=this.sublayersSourceJSON[A.OriginId.SERVICE].layers;let m=this.sublayersSourceJSON[A.OriginId.SERVICE].context,Q=null;var M=[A.OriginId.PORTAL_ITEM,A.OriginId.WEB_SCENE,A.OriginId.WEB_MAP].filter(L=>L<=q);for(var ca of M)M=this.sublayersSourceJSON[ca],R.isSublayerOverhaul(M.layers)&&(r=ca,g=M.layers,m=
M.context,M.visibleLayers&&(Q={visibleLayers:M.visibleLayers,context:M.context}));ca=[A.OriginId.PORTAL_ITEM,A.OriginId.WEB_SCENE,A.OriginId.WEB_MAP].filter(L=>L>r&&L<=q);let V=null;for(var S of ca){const {layers:L,visibleLayers:ja,context:ka}=this.sublayersSourceJSON[S];L&&(V={layers:L,context:ka});ja&&(Q={visibleLayers:ja,context:ka})}S=ba(g,m);const z=new Map,aa=new Set;if(V)for(const L of V.layers)z.set(L.id,L);if(Q?.visibleLayers)for(const L of Q.visibleLayers)aa.add(L);h(S,L=>{V&&L.read(z.get(L.id),
V.context);Q&&L.read({defaultVisibility:aa.has(L.id)},Q.context)});return{origin:A.idToName(r),sublayers:new y({items:S})}};k.read=function(g,q){p._get(p._getPrototypeOf(G.prototype),"read",this).call(this,g,q);this.readSublayers(g,q)};k._handleSublayersChange=function(g,q){q&&(q.forEach(r=>{r.parent=null;r.layer=null}),this.removeHandles("sublayers-owner"));g&&(g.forEach(r=>{r.parent=this;r.layer=this}),this.addHandles([g.on("after-add",({item:r})=>{r.parent=this;r.layer=this}),g.on("after-remove",
({item:r})=>{r.parent=null;r.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(g.on("before-changes",r=>{F.error(new l("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));r.preventDefault()}),"sublayers-owner"))};return p._createClass(G)}(x);d.__decorate([O.property({readOnly:!0})],x.prototype,"allSublayers",void 0);d.__decorate([O.property({readOnly:!0,type:c.ofType(Y)})],x.prototype,"serviceSublayers",void 0);
d.__decorate([O.property({value:null,type:y,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],x.prototype,"sublayers",void 0);d.__decorate([O.property({readOnly:!0})],x.prototype,"sublayersSourceJSON",void 0);return x=d.__decorate([ha.subclass("esri.layers.mixins.SublayersOwner")],x)};u.forEachSublayer=h;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(u,p,d,c,n,l,v,H,O,J,na,oa,da,ha,A,Y,R,ba,h,F,y,x,B,G,k,g,q,r,m,Q,M,ca,V,S,z,aa,L,ja,ka,pa,W,f,D,K,I,P,T,ea,N,fa,ia){function sa(E){return null!=E&&"esriSMS"===E.type}function ta(E,U,t){E=this.originIdOf(U)>=z.nameToId(t.origin);return{ignoreOrigin:!0,allowNull:E,enabled:t?"map-image"===t.layer?.type&&(t.writeSublayerStructure||E):!1}}function ua(E,U,t){return{enabled:t?"tile"===t.layer?.type&&(t.origin&&this.originIdOf(U)>=z.nameToId(t.origin)||this._isOverridden(U)):!1}}function Z(E,U,t){return{ignoreOrigin:!0,
enabled:t&&t.writeSublayerStructure||!1}}function qa(E,U,t){return{ignoreOrigin:!0,enabled:t?t.writeSublayerStructure||this.originIdOf(U)>=z.nameToId(t.origin):!1}}var ra;let wa=0;const la=new Set;la.add("layer");la.add("parent");la.add("loaded");la.add("loadStatus");la.add("loadError");la.add("loadWarnings");c=ra=function(E){function U(a){a=E.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.geometryType=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.parent=
null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;a._lastParsedUrl=null;return a}p._inherits(U,E);var t=U.prototype;t.load=async function(a){this.addResolvingPromise((async()=>{const {layer:b,url:e}=this;if(!b&&!e)throw new h("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});const w=b?await b.fetchSublayerInfo(this,a):(await Y(e,{responseType:"json",query:{f:"json"},...a})).data;w&&(this.sourceJSON=
w,this.read({layerDefinition:w},{origin:"service"}))})());return this};t.readCapabilities=function(a,b){b=b.layerDefinition||b;const {operations:{supportsQuery:e,supportsQueryAttachments:w},query:{supportsFormatPBF:C},data:{supportsAttachment:X}}=K.getFeatureLayerCapabilities(b,this.url);return{exportMap:{supportsModification:!!b.canModifyLayer},operations:{supportsQuery:e,supportsQueryAttachments:w},data:{supportsAttachment:X},query:{supportsFormatPBF:C}}};t.readGlobalIdFieldFromService=function(a,
b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(const e of b.fields)if("esriFieldTypeGlobalID"===e.type)return e.name};t.writeLabelingInfo=function(a,b,e,w){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(C=>C.write({},w))}})};t.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};t.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};t.readObjectIdFieldFromService=
function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(const e of b.fields)if("esriFieldTypeOID"===e.type)return e.name};t.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*((null!=a?.transparency?a.transparency:a?.drawingInfo?.transparency)??0)};t.writeOpacity=function(a,b,e,w){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};t.writeParent=function(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?S.ensureInteger(this.parent.id):
-1};t.castSublayers=function(a){return S.ensureType(ba.ofType(ra),a)};t.writeSublayers=function(a,b,e){this.sublayers?.length&&(b[e]=this.sublayers.map(w=>w.id).toArray().reverse())};t.readTypeIdField=function(a,b){b=b.layerDefinition||b;let e=b.typeIdField;e&&b.fields&&(e=e.toLowerCase(),a=b.fields.find(w=>w.name.toLowerCase()===e))&&(e=a.name);return e};t.writeVisible=function(a,b,e,w){b[e]=this.getAtOrigin("defaultVisibility","service")||a};t.clone=function(){const {store:a}=aa.getProperties(this),
b=new ra;aa.getProperties(b).store=a.clone(la);this.commitProperty("url");b._lastParsedUrl=this._lastParsedUrl;return b};t.createPopupTemplate=function(a){return N.createPopupTemplate(this,a)};t.createQuery=function(){return new ea({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};t.createFeatureLayer=async function(){if(this.hasOwnProperty("sublayers"))return null;const {layer:a}=this,b=a?.parsedUrl,e=new (await new Promise((w,C)=>u(["../FeatureLayer"],X=>w(Object.freeze(Object.defineProperty({__proto__:null,
default:X},Symbol.toStringTag,{value:"Module"}))),C))).default({url:b?.path});b&&this.source&&("map-layer"===this.source.type?e.layerId=this.source.mapLayerId:e.dynamicDataSource=this.source);null!=a?.refreshInterval&&(e.refreshInterval=a.refreshInterval);this.definitionExpression&&(e.definitionExpression=this.definitionExpression);this.floorInfo&&(e.floorInfo=B.clone(this.floorInfo));this.originIdOf("labelingInfo")>z.OriginId.SERVICE&&(e.labelingInfo=B.clone(this.labelingInfo));this.originIdOf("labelsVisible")>
z.OriginId.DEFAULTS&&(e.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>z.OriginId.DEFAULTS&&(e.legendEnabled=this.legendEnabled);this.originIdOf("visible")>z.OriginId.DEFAULTS&&(e.visible=this.visible);this.originIdOf("minScale")>z.OriginId.DEFAULTS&&(e.minScale=this.minScale);this.originIdOf("maxScale")>z.OriginId.DEFAULTS&&(e.maxScale=this.maxScale);this.originIdOf("opacity")>z.OriginId.DEFAULTS&&(e.opacity=this.opacity);this.originIdOf("popupTemplate")>z.OriginId.DEFAULTS&&
(e.popupTemplate=B.clone(this.popupTemplate));this.originIdOf("renderer")>z.OriginId.SERVICE&&(e.renderer=B.clone(this.renderer));"data-layer"===this.source?.type&&(e.dynamicDataSource=this.source.clone());this.originIdOf("title")>z.OriginId.DEFAULTS&&(e.title=this.title);"map-image"===a?.type&&a.originIdOf("customParameters")>z.OriginId.DEFAULTS&&(e.customParameters=a.customParameters);"tile"===a?.type&&a.originIdOf("customParameters")>z.OriginId.DEFAULTS&&(e.customParameters=a.customParameters);
return e};t.getField=function(a){return this.fieldsIndex.get(a)};t.getFeatureType=function(a){const {typeIdField:b,types:e}=this;if(!b||!a)return null;const w=a.attributes?a.attributes[b]:void 0;if(null==w)return null;let C=null;e?.some(X=>{const {id:ma}=X;if(null==ma)return!1;ma.toString()===w.toString()&&(C=X);return!!C});return C};t.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};t.queryAttachments=
async function(a,b){await this.load();a=T.from(a);const e=this.capabilities;if(!e?.data?.supportsAttachment)throw new h("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:w,objectIds:C,globalIds:X,num:ma,size:xa,start:ya,where:va}=a;if(!e?.operations?.supportsQueryAttachments&&(0<w?.length||0<X?.length||0<xa?.length||ma||ya||va))throw new h("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",
a);if(!(C?.length||X?.length||va))throw new h("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",a);return this.queryTask.executeAttachmentQuery(a,b)};t.queryFeatures=async function(a=this.createQuery(),b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new h("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new h("queryFeatures:not-supported","this layer has no url.");a=await this.queryTask.execute(a,
{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(a?.features)for(const e of a.features)e.sourceLayer=this;return a};t.toExportImageJSON=function(a){const b={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}};a=q.sqlAnd(a,this.definitionExpression);null!=a&&(b.definitionExpression=a);const e=["renderer","labelingInfo","opacity","labelsVisible"].reduce((w,C)=>{w[C]=this.originIdOf(C);return w},{});if(Object.keys(e).some(w=>e[w]>z.OriginId.SERVICE)){a=
b.drawingInfo={};e.renderer>z.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);e.labelsVisible>z.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&e.labelingInfo>z.OriginId.SERVICE){!this.loaded&&this.labelingInfo.some(C=>!C.labelPlacement)&&k.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",
{sublayer:this});let w=this.labelingInfo;null!=this.geometryType&&(w=f.validateLabelingInfo(this.labelingInfo,ia.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.labelingInfo=w.filter(C=>C.labelPlacement).map(C=>C.toJSON({origin:"service",layer:this.layer}));a.showLabels=!0}e.opacity>z.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return b};t._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,b=>{b.color||
"esriSMSX"!==b.style&&"esriSMSCross"!==b.style||(b.color=b.outline&&b.outline.color?b.outline.color:[0,0,0,0])})};t._forEachSimpleMarkerSymbols=function(a,b){if(a){const e=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:null)??[];for(const w of e)sa(w.symbol)&&b(w.symbol);"symbol"in a&&sa(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&sa(a.defaultSymbol)&&b(a.defaultSymbol)}};t._setAndNotifyLayer=function(a,b){const e=this.layer,w=this._get(a);let C,X;switch(a){case "definitionExpression":case "floorInfo":C=
"supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":C="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":C="supportsDynamicLayers",X="supportsModification"}const ma=aa.getProperties(this).getDefaultOrigin();if("service"!==ma){if(C&&!1===this.layer?.capabilities?.exportMap?.[C]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${C}'`);return}if(X&&!1===this.capabilities?.exportMap[X]){this._logLockedError(a,
`capability not available 'capabilities.exportMap.${X}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==ma&&w!==b&&e&&e.emit&&e.emit("sublayer-update",{propertyName:a,target:this}))};t._handleSublayersChange=function(a,b){b&&(b.forEach(e=>{e.parent=null;e.layer=null}),this.handles.removeAll());a&&(a.forEach(e=>{e.parent=this;e.layer=this.layer}),this.handles.add([a.on("after-add",({item:e})=>
{e.parent=this;e.layer=this.layer}),a.on("after-remove",({item:e})=>{e.parent=null;e.layer=null}),a.on("before-changes",e=>{const w=this.layer?.capabilities?.exportMap?.supportsSublayersChanges;null==w||w||(k.getLogger(this).error(new h("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),e.preventDefault())})]))};t._logLockedError=function(a,b){const {layer:e,declaredClass:w}=this;k.getLogger(w).error(new h("sublayer:locked",
`Property '${String(a)}' can't be changed on Sublayer from the layer '${e?.id}'`,{reason:b,sublayer:this,layer:e}))};t._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};p._createClass(U,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:b}=this;return{minScale:a,maxScale:b}}},{key:"fieldsIndex",
get:function(){return new pa(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?wa++:a},set:function(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},
{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(b=>b.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"queryTask",get:function(){if(!this.layer)return null;
const {spatialReference:a}=this.layer,b="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:e,fieldsIndex:w}=this,C=y("featurelayer-pbf")&&e?.query.supportsFormatPBF;return new L({url:this.url,pbfSupported:C,fieldsIndex:w,gdbVersion:b,sourceSpatialReference:a,queryAttachmentsSupported:e?.operations?.supportsQueryAttachments??!1})}},{key:"renderer",set:function(a){if(a)for(const b of a.getSymbols())if(R.isSymbol3D(b)){k.getLogger(this).warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new P.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var b=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===b?.type)return`${a.path}/${b.mapLayerId}`;
b={layer:JSON.stringify({source:this.source})};return`${a.path}/dynamicLayer?${r.objectToQuery(b)}`},set:function(a){this._overrideIfSome("url",a)}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return U}(F.HandleOwnerMixin(g.MultiOriginJSONMixin(x.IdentifiableMixin(G))));c.test={isMapImageLayerOverridePolicy:E=>E===Z||E===ta,isTileImageLayerOverridePolicy:E=>E===ua};d.__decorate([m.property({readOnly:!0})],c.prototype,"capabilities",void 0);d.__decorate([M.reader("service",
"capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],c.prototype,"readCapabilities",null);d.__decorate([m.property()],c.prototype,"defaultPopupTemplate",null);d.__decorate([m.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ta}}})],c.prototype,"definitionExpression",null);d.__decorate([m.property({readOnly:!0})],c.prototype,"effectiveScaleRange",null);d.__decorate([m.property({type:[ka],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],
c.prototype,"fields",void 0);d.__decorate([m.property({readOnly:!0})],c.prototype,"fieldsIndex",null);d.__decorate([m.property({type:D,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:ta},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"floorInfo",null);d.__decorate([m.property({type:fa,json:{read:{source:"layerDefinition.extent"}}})],c.prototype,"fullExtent",void 0);d.__decorate([m.property({type:ia.featureGeometryTypeKebabDictionary.apiValues,
json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:ia.featureGeometryTypeKebabDictionary.read}}}}})],c.prototype,"geometryType",void 0);d.__decorate([m.property({type:String})],c.prototype,"globalIdField",void 0);d.__decorate([M.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],c.prototype,"readGlobalIdFieldFromService",null);d.__decorate([m.property({type:S.Integer,json:{write:{ignoreOrigin:!0}}})],c.prototype,"id",null);d.__decorate([m.property({value:null,
type:[W],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:Z}}})],c.prototype,"labelingInfo",null);d.__decorate([V.writer("labelingInfo")],c.prototype,"writeLabelingInfo",null);d.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:Z}}})],c.prototype,"labelsVisible",null);d.__decorate([m.property({value:null})],
c.prototype,"layer",null);d.__decorate([m.property({type:String,json:{write:{overridePolicy:ua}}})],c.prototype,"layerItemId",void 0);d.__decorate([m.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:qa}}})],c.prototype,"legendEnabled",void 0);d.__decorate([m.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],c.prototype,"listMode",
null);d.__decorate([m.property({type:Number,value:0,json:{write:{overridePolicy:Z}}})],c.prototype,"minScale",null);d.__decorate([M.reader("minScale",["minScale","layerDefinition.minScale"])],c.prototype,"readMinScale",null);d.__decorate([m.property({type:Number,value:0,json:{write:{overridePolicy:Z}}})],c.prototype,"maxScale",null);d.__decorate([M.reader("maxScale",["maxScale","layerDefinition.maxScale"])],c.prototype,"readMaxScale",null);d.__decorate([m.property({type:String})],c.prototype,"objectIdField",
void 0);d.__decorate([M.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],c.prototype,"readObjectIdFieldFromService",null);d.__decorate([m.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:Z}}})],c.prototype,"opacity",null);d.__decorate([M.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],c.prototype,"readOpacity",null);d.__decorate([V.writer("opacity")],
c.prototype,"writeOpacity",null);d.__decorate([m.property({json:{type:S.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:Z}}})],c.prototype,"parent",void 0);d.__decorate([V.writer("parent")],c.prototype,"writeParent",null);d.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(E,U){return!U.disablePopup}},write:{target:"disablePopup",overridePolicy:qa,writer(E,U,t){U[t]=!E}}}})],c.prototype,"popupEnabled",void 0);d.__decorate([m.property({type:n,
json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:qa}}})],c.prototype,"popupTemplate",void 0);d.__decorate([m.property({readOnly:!0})],c.prototype,"queryTask",null);d.__decorate([m.property({types:A.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Z},origins:{"web-scene":{types:A.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Z}}}}})],c.prototype,"renderer",null);d.__decorate([m.property({types:{key:"type",
base:null,typeMap:{"data-layer":I.DataLayerSource,"map-layer":P.MapLayerSource}},cast(E){if(E){if("mapLayerId"in E)return S.ensureClass(P.MapLayerSource,E);if("dataSource"in E)return S.ensureClass(I.DataLayerSource,E)}return E},json:{name:"layerDefinition.source",write:{overridePolicy:Z}}})],c.prototype,"source",null);d.__decorate([m.property()],c.prototype,"sourceJSON",void 0);d.__decorate([m.property({value:null,json:{type:[S.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:Z}}})],
c.prototype,"sublayers",null);d.__decorate([Q.cast("sublayers")],c.prototype,"castSublayers",null);d.__decorate([V.writer("sublayers")],c.prototype,"writeSublayers",null);d.__decorate([m.property({type:String,json:{name:"name",write:{overridePolicy:qa}}})],c.prototype,"title",void 0);d.__decorate([m.property({type:String})],c.prototype,"typeIdField",void 0);d.__decorate([M.reader("typeIdField",["layerDefinition.typeIdField"])],c.prototype,"readTypeIdField",null);d.__decorate([m.property({type:[ja],
json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],c.prototype,"types",void 0);d.__decorate([m.property({type:String,json:{name:"layerUrl",write:{overridePolicy:ua}}})],c.prototype,"url",null);d.__decorate([m.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:Z}}})],c.prototype,"visible",null);d.__decorate([V.writer("visible")],c.prototype,"writeVisible",null);return c=ra=d.__decorate([ca.subclass("esri.layers.support.Sublayer")],
c)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(u,p){function d(c,n){if(!c||!c.length||null==n)return!0;n=n.slice().reverse().flatten(({sublayers:H})=>H&&H.toArray().reverse()).map(H=>H.id).toArray();if(c.length>n.length)return!1;let l=0;const v=n.length;for(const {id:H}of c){for(;l<v&&n[l]!==H;)l++;if(l>=v)return!1}return!0}u.isExportDynamic=function(c,n,l){return c.some(v=>{const H=v.source;return!(!H||"map-layer"===H.type&&
H.mapLayerId===v.id&&(null==H.gdbVersion||H.gdbVersion===l))||v.originIdOf("renderer")>p.OriginId.SERVICE||v.originIdOf("labelingInfo")>p.OriginId.SERVICE||v.originIdOf("opacity")>p.OriginId.SERVICE||v.originIdOf("labelsVisible")>p.OriginId.SERVICE})?!0:!d(c,n)};u.isSublayerOverhaul=function(c){return!!c&&c.some(n=>null!=n.minScale||n.layerDefinition&&null!=n.layerDefinition.minScale)};u.shouldWriteSublayerStructure=function(c,n,l){return n.flatten(({sublayers:v})=>v).length!==c.length||c.some(v=>
v.originIdOf("minScale")>l||v.originIdOf("maxScale")>l||v.originIdOf("renderer")>l||v.originIdOf("labelingInfo")>l||v.originIdOf("opacity")>l||v.originIdOf("labelsVisible")>l||v.originIdOf("source")>l)?!0:!d(c,n)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./commonProperties ./floorFilterUtils ./sublayerUtils".split(" "),
function(u,p,d,c,n,l,v,H,O,J,na,oa,da,ha){const A={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};u.ExportImageParameters=function(Y){function R(h){h=Y.call(this,h)||this;h.floors=null;h.scale=0;return h}p._inherits(R,Y);var ba=R.prototype;ba.destroy=function(){this.layer=null};ba.toJSON=
function(){var h=this.layer;h={dpi:h.dpi,format:h.imageFormat,transparent:h.imageTransparency,gdbVersion:h.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?h.dynamicLayers=this.dynamicLayers:h={...h,layers:this.layers,layerDefs:this.layerDefs};return h};p._createClass(R,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const h=this.visibleSublayers.map(F=>{const y=da.getLayerFloorFilterClause(this.floors,F);return F.toExportImageJSON(y)});return h.length?JSON.stringify(h):
null}},{key:"hasDynamicLayers",get:function(){return this.layer&&ha.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(h){this._get("layer")!==h&&(this._set("layer",h),this.handles.remove("layer"),h&&this.handles.add([h.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),h.on("sublayer-update",F=>this.notifyChange(A[F.propertyName]))],"layer"))}},{key:"layers",get:function(){const h=this.visibleSublayers;return h?h.length?
"show:"+h.map(F=>F.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){const h=!!this.floors?.length,F=this.visibleSublayers.filter(y=>null!=y.definitionExpression||h&&null!=y.floorInfo);return F.length?JSON.stringify(F.reduce((y,x)=>{var B=da.getLayerFloorFilterClause(this.floors,x);B=l.sqlAnd(B,x.definitionExpression);null!=B&&(y[x.id]=B);return y},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");
this.commitProperty("timeExtent");const h=this.layer;h&&(h.commitProperty("dpi"),h.commitProperty("imageFormat"),h.commitProperty("imageTransparency"),h.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const h=[];if(!this.layer)return h;var F=this.layer.sublayers;const y=x=>{const B=this.scale,G=0===x.minScale||B<=x.minScale,k=0===x.maxScale||B>=x.maxScale;x.visible&&(0===B||G&&k)&&(x.sublayers?x.sublayers.forEach(y):h.unshift(x))};F&&F.forEach(y);
F=this._get("visibleSublayers");return!F||F.length!==h.length||F.some((x,B)=>h[B]!==x)?h:F}}]);return R}(n.HandleOwnerMixin(c));d.__decorate([v.property({readOnly:!0})],u.ExportImageParameters.prototype,"dynamicLayers",null);d.__decorate([v.property()],u.ExportImageParameters.prototype,"floors",void 0);d.__decorate([v.property({readOnly:!0})],u.ExportImageParameters.prototype,"hasDynamicLayers",null);d.__decorate([v.property()],u.ExportImageParameters.prototype,"layer",null);d.__decorate([v.property({readOnly:!0})],
u.ExportImageParameters.prototype,"layers",null);d.__decorate([v.property({readOnly:!0})],u.ExportImageParameters.prototype,"layerDefs",null);d.__decorate([v.property({type:Number})],u.ExportImageParameters.prototype,"scale",void 0);d.__decorate([v.property(oa.combinedViewLayerTimeExtentProperty)],u.ExportImageParameters.prototype,"timeExtent",void 0);d.__decorate([v.property({readOnly:!0})],u.ExportImageParameters.prototype,"version",null);d.__decorate([v.property({readOnly:!0})],u.ExportImageParameters.prototype,
"visibleSublayers",null);u.ExportImageParameters=d.__decorate([na.subclass("esri.layers.mixins.ExportImageParameters")],u.ExportImageParameters);Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(u){function p(d,c){if(!d?.length)return null;d=d.filter(n=>""!==n).map(n=>`'${n}'`);d.push("''");return`${c} IN (${d.join(",")}) OR ${c} IS NULL`}u.getFloorFilterClause=function(d){const c=d.layer;return"floorInfo"in
c&&c.floorInfo?.floorField&&"floors"in d.view?p(d.view.floors,c.floorInfo.floorField):null};u.getLayerFloorFilterClause=function(d,c){return"floorInfo"in c&&c.floorInfo?.floorField?p(d,c.floorInfo.floorField):null};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../core/Error","../../core/promiseUtils"],function(u,p,d){u.createBitmap=async function(c,n,l){let v;try{v=await createImageBitmap(c)}catch(H){throw new p("request:server",
`Unable to load ${n}`,{url:n,error:H});}d.throwIfAborted(l);return v};u.createTileBitmap=async function(c,n,l,v,H){let O;try{O=await createImageBitmap(c)}catch(J){throw new p("request:server",`Unable to load tile ${n}/${l}/${v}`,{error:J,level:n,row:l,col:v});}d.throwIfAborted(H);return O};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../TimeExtent ../core/Error ../core/HandleOwner ../core/loadAll ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/imageBitmapUtils ./support/Sublayer ./support/sublayerUtils ./support/versionUtils ../time/TimeReference".split(" "),function(u,
p,d,c,n,l,v,H,O,J,na,oa,da,ha,A,Y,R,ba,h,F,y,x,B,G,k,g,q,r,m,Q,M,ca,V,S,z,aa,L,ja){l=function(ka){function pa(...f){f=ka.call(this,...f)||this;f.dateFieldsTimeReference=null;f.datesInUnknownTimezone=!1;f.dpi=96;f.gdbVersion=null;f.imageFormat="png24";f.imageMaxHeight=2048;f.imageMaxWidth=2048;f.imageTransparency=!0;f.isReference=null;f.labelsVisible=!1;f.operationalLayerType="ArcGISMapServiceLayer";f.preferredTimeReference=null;f.sourceJSON=null;f.sublayers=null;f.type="map-image";f.url=null;return f}
u._inherits(pa,ka);var W=pa.prototype;W.normalizeCtorArgs=function(f,D){return"string"===typeof f?{url:f,...D}:f};W.load=function(f){const D=null!=f?f.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},f).catch(O.throwIfAbortError).then(()=>this._fetchService(D)));return Promise.resolve(this)};W.readImageFormat=function(f,D){return(f=D.supportedImageFormatTypes)&&f.includes("PNG32")?"png32":"png24"};W.writeSublayers=function(f,D,K,I){if(this.loaded&&f){f=f.slice().reverse().flatten(({sublayers:N})=>
N&&N.toArray().reverse()).toArray();K=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){const N=R.nameToId(I.origin);N===R.OriginId.PORTAL_ITEM?(K=this.createSublayersForOrigin("service").sublayers,K=aa.shouldWriteSublayerStructure(f,K,R.OriginId.SERVICE)):N>R.OriginId.PORTAL_ITEM&&(K=this.createSublayersForOrigin("portal-item"),K=aa.shouldWriteSublayerStructure(f,K.sublayers,R.nameToId(K.origin)))}var P=[],T={writeSublayerStructure:K,
...I},ea=K;f.forEach(N=>{const fa=N.write({},T);P.push(fa);ea=ea||"user"===N.originOf("visible")});P.some(N=>1<Object.keys(N).length)&&(D.layers=P);ea&&(D.visibleLayers=f.filter(N=>N.visible).map(N=>N.id))}};W.createExportImageParameters=function(f,D,K,I){var P=I&&I.pixelRatio||1;f&&10<=this.version&&(f=f.clone().shiftCentralMeridian());var T=new V.ExportImageParameters({layer:this,floors:I?.floors,scale:h.getScale({extent:f,width:D})*P});const ea=T.toJSON();T.destroy();T=!I||!I.rotation||10.3>this.version?
{}:{rotation:-I.rotation};var N=f&&f.spatialReference;N=N.wkid||JSON.stringify(N.toJSON());ea.dpi*=P;P={};if(I?.timeExtent){const {start:fa,end:ia}=I.timeExtent.toJSON();P.time=fa&&ia&&fa===ia?""+fa:`${null==fa?"null":fa},${null==ia?"null":ia}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(P.time="null,null");return{bbox:f&&f.xmin+","+f.ymin+","+f.xmax+","+f.ymax,bboxSR:N,imageSR:N,size:D+","+K,...ea,...T,...P}};W.fetchImage=async function(f,D,K,I){({data:f}=await this._fetchImage("image",f,D,
K,I));return f};W.fetchImageBitmap=async function(f,D,K,I){const {data:P,url:T}=await this._fetchImage("blob",f,D,K,I);return S.createBitmap(P,T,I?.signal)};W.fetchRecomputedExtents=async function(f={}){({data:f}=await d(this.url,{...f,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}}));const {extent:D,fullExtent:K,timeExtent:I}=f;f=D||K;return{fullExtent:f&&ba.fromJSON(f),timeExtent:I&&c.fromJSON({start:I[0],end:I[1]})}};W.loadAll=function(){return v.loadAll(this,f=>{f(this.allSublayers)})};
W.serviceSupportsSpatialReference=function(f){return L.serviceSupportsSpatialReference(this,f)};W._fetchImage=async function(f,D,K,I,P){f={responseType:f,signal:P?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(D,K,I,P),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}};D=this.parsedUrl.path+"/export";if(null!=f.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new n("mapimagelayer:dynamiclayer-not-supported",
`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:f.query});try{const {data:T}=await d(D,f);return{data:T,url:D}}catch(T){if(O.isAbortError(T))throw T;throw new n("mapimagelayer:image-fetch-error",`Unable to load image: ${D}`,{error:T});}};W._fetchService=async function(f){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:D,ssl:K}=await d(this.parsedUrl.path,
{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:f});K&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=D;this.read(D,{origin:"service",url:this.parsedUrl})}};return u._createClass(pa)}(G.BlendLayer(M.TemporalLayer(m.ScaleRangeLayer(Q.SublayersOwner(x.ArcGISMapService(B.ArcGISService(g.OperationalLayer(q.PortalLayer(H.MultiOriginJSONMixin(r.RefreshableLayer(y.APIKeyMixin(k.CustomParametersMixin(l.HandleOwnerMixin(F))))))))))))));p.__decorate([J.property({type:ja})],
l.prototype,"dateFieldsTimeReference",void 0);p.__decorate([J.property({type:Boolean})],l.prototype,"datesInUnknownTimezone",void 0);p.__decorate([J.property()],l.prototype,"dpi",void 0);p.__decorate([J.property()],l.prototype,"gdbVersion",void 0);p.__decorate([J.property()],l.prototype,"imageFormat",void 0);p.__decorate([ha.reader("imageFormat",["supportedImageFormatTypes"])],l.prototype,"readImageFormat",null);p.__decorate([J.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],
l.prototype,"imageMaxHeight",void 0);p.__decorate([J.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],l.prototype,"imageMaxWidth",void 0);p.__decorate([J.property()],l.prototype,"imageTransparency",void 0);p.__decorate([J.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],l.prototype,"isReference",void 0);p.__decorate([J.property({json:{read:!1,write:!1}})],l.prototype,"labelsVisible",void 0);p.__decorate([J.property({type:["ArcGISMapServiceLayer"]})],
l.prototype,"operationalLayerType",void 0);p.__decorate([J.property({json:{read:!1,write:!1}})],l.prototype,"popupEnabled",void 0);p.__decorate([J.property({type:ja})],l.prototype,"preferredTimeReference",void 0);p.__decorate([J.property()],l.prototype,"sourceJSON",void 0);p.__decorate([J.property({json:{write:{ignoreOrigin:!0}}})],l.prototype,"sublayers",void 0);p.__decorate([Y.writer("sublayers",{layers:{type:[z]},visibleLayers:{type:[na.Integer]}})],l.prototype,"writeSublayers",null);p.__decorate([J.property({type:["show",
"hide","hide-children"]})],l.prototype,"listMode",void 0);p.__decorate([J.property({json:{read:!1},readOnly:!0,value:"map-image"})],l.prototype,"type",void 0);p.__decorate([J.property(ca.url)],l.prototype,"url",void 0);return l=p.__decorate([A.subclass("esri.layers.MapImageLayer")],l)});