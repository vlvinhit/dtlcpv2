// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Error ../core/handleUtils ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/support/typeUtils ./Layer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/FeatureEffectLayer ./mixins/FeatureReductionLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/featureLayerUtils ./support/Field ./support/fieldProperties ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/PurgeOptions ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../symbols/support/ElevationInfo ../geometry/SpatialReference ../geometry/Extent".split(" "),
function(C,p,c,t,D,ma,na,oa,pa,qa,ra,sa,ta,E,w,F,m,G,H,b,I,d,x,ua,va,y,J,u,K,L,M,N,O,P,Q,R,S,T,U,h,V,W,X,v,Y,Z,z,aa,ba,ca,da,A,ea){function B(k,l){return new m("layer:unsupported",`Layer (${k.title}, ${k.id}) of type '${k.declaredClass}' ${l}`,{layer:k})}t=X.defineFieldProperties();b=function(k){function l(...a){a=k.call(this,...a)||this;a.copyright=null;a.definitionExpression=null;a.displayField=null;a.elevationInfo=null;a.fields=null;a.fieldsIndex=null;a.geometryDefinition=null;a.geometryType=null;
a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.maxReconnectionAttempts=0;a.maxReconnectionInterval=20;a.maxScale=0;a.minScale=0;a.objectIdField=null;a.operationalLayerType="ArcGISStreamLayer";a.popupEnabled=!0;a.popupTemplate=null;a.purgeOptions=new z;a.refreshInterval=0;a.screenSizePerspectiveEnabled=!0;a.sourceJSON=null;a.spatialReference=A.WGS84;a.type="stream";a.url=null;a.updateInterval=300;a.useViewTime=!0;a.webSocketUrl=null;return a}p._inherits(l,k);var f=l.prototype;f.normalizeCtorArgs=
function(a,e){return"string"===typeof a?{url:a,...e}:a};f.load=function(a){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new m("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const e=null!=a?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},a).catch(I.throwIfAbortError).then(()=>this._fetchService(e)));
return Promise.resolve(this)};f.readRenderer=function(a,e,g){e=e.layerDefinition||e;return(a=e.drawingInfo?.renderer)?((a=E.read(a,e,g)||void 0)||H.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:g}),a):V.createDefaultRenderer(e,g)};f.connect=async function(a){const [{createConnection:e}]=await Promise.all([new Promise((n,fa)=>C(["./graphics/sources/connections/createConnection"],n,fa)),this.load()]),g=this.geometryType?u.featureGeometryTypeKebabDictionary.toJSON(this.geometryType):
null,{customParameters:q=null,definitionExpression:ha=null,geometryDefinition:ia=null,maxReconnectionAttempts:ja=0,maxReconnectionInterval:ka=20,spatialReference:la=this.spatialReference}=a||this.createConnectionParameters(),r=e(this.parsedUrl,this.spatialReference,la,g,{geometry:ia,where:ha},ja,ka,q??void 0);a=G.handlesGroup([this.on("send-message-to-socket",n=>r.sendMessageToSocket(n)),this.on("send-message-to-client",n=>r.sendMessageToClient(n))]);r.once("destroy",a.remove);return r};f.createConnectionParameters=
function(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}};f.createPopupTemplate=function(a){return ca.createPopupTemplate(this,a)};f.createQuery=function(){const a=new ba;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};f.getFieldDomain=
function(a,e){if(!this.fields)return null;let g=null;this.fields.some(q=>{q.name===a&&(g=q.domain);return!!g});return g};f.getField=function(a){return this.fieldsIndex.get(a)};f.serviceSupportsSpatialReference=function(a){return!0};f.sendMessageToSocket=function(a){this.emit("send-message-to-socket",a)};f.sendMessageToClient=function(a){this.emit("send-message-to-client",a)};f.write=function(a,e){const g=e?.messages;return this.webSocketUrl?(g?.push(B(this,"using a custom websocket connection cannot be written to web scenes and web maps")),
null):this.parsedUrl?p._get(p._getPrototypeOf(l.prototype),"write",this).call(this,a,e):(g?.push(B(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)};f._fetchService=async function(a){if(!this.webSocketUrl&&this.parsedUrl)this.sourceJSON||({data:a}=await F(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:a}),this.sourceJSON=a);else{if(!this.timeInfo?.trackIdField)throw new m("stream-layer:missing-metadata",
"The stream layer trackIdField must be specified.");if(!this.objectIdField){a=this.fields.find(e=>"oid"===e.type)?.name;if(!a)throw new m("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=a}if(!this.fields)throw new m("stream-layer:missing-metadata","The stream layer fields must be specified.");this.fields.some(e=>e.name===this.objectIdField)||this.fields.push(new W({name:this.objectIdField,alias:this.objectIdField,type:"oid"}));if(!this.geometryType)throw new m("stream-layer:missing-metadata",
"The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl});v.fixRendererFields(this.renderer,this.fieldsIndex);v.fixTimeInfoFields(this.timeInfo,this.fieldsIndex);this.objectIdField||(this.objectIdField="__esri_stream_id__");return aa.loadStyleRenderer(this,{origin:"service"})};p._createClass(l,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"featureReduction",set:function(a){a=this._normalizeFeatureReduction(a);this._set("featureReduction",a)}},{key:"renderer",set:function(a){v.fixRendererFields(a,this.fieldsIndex);this._set("renderer",a)}}]);return l}(P.FeatureReductionLayer(O.FeatureEffectLayer(M.BlendLayer(U.TemporalLayer(T.ScaleRangeLayer(S.RefreshableLayer(L.ArcGISService(Q.OperationalLayer(R.PortalLayer(b.MultiOriginJSONMixin(N.CustomParametersMixin(K))))))))))));c.__decorate([d.property({type:String})],b.prototype,"copyright",
void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);c.__decorate([d.property({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],b.prototype,"definitionExpression",void 0);c.__decorate([d.property({type:String})],b.prototype,"displayField",void 0);c.__decorate([d.property({type:da})],b.prototype,"elevationInfo",void 0);c.__decorate([d.property({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},
"web-scene":{read:!1,write:!1}}}})],b.prototype,"featureReduction",null);c.__decorate([d.property(t.fields)],b.prototype,"fields",void 0);c.__decorate([d.property(t.fieldsIndex)],b.prototype,"fieldsIndex",void 0);c.__decorate([d.property({type:ea,json:{name:"layerDefinition.definitionGeometry",write:!0}})],b.prototype,"geometryDefinition",void 0);c.__decorate([d.property({type:u.featureGeometryTypeKebabDictionary.apiValues,json:{read:{reader:u.featureGeometryTypeKebabDictionary.read}}})],b.prototype,
"geometryType",void 0);c.__decorate([d.property(h.labelsVisible)],b.prototype,"labelsVisible",void 0);c.__decorate([d.property({type:[Y],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Z.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);c.__decorate([d.property(h.legendEnabled)],b.prototype,"legendEnabled",void 0);c.__decorate([d.property({type:["show","hide"]})],b.prototype,"listMode",void 0);c.__decorate([d.property({type:x.Integer})],
b.prototype,"maxReconnectionAttempts",void 0);c.__decorate([d.property({type:x.Integer})],b.prototype,"maxReconnectionInterval",void 0);c.__decorate([d.property(h.maxScale)],b.prototype,"maxScale",void 0);c.__decorate([d.property(h.minScale)],b.prototype,"minScale",void 0);c.__decorate([d.property({type:String})],b.prototype,"objectIdField",void 0);c.__decorate([d.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([d.property(h.popupEnabled)],
b.prototype,"popupEnabled",void 0);c.__decorate([d.property({type:D,json:{name:"popupInfo",write:!0}})],b.prototype,"popupTemplate",void 0);c.__decorate([d.property({type:z})],b.prototype,"purgeOptions",void 0);c.__decorate([d.property({json:{read:!1,write:!1}})],b.prototype,"refreshInterval",void 0);c.__decorate([d.property({types:w.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:w.webSceneRendererTypes,
write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],b.prototype,"renderer",null);c.__decorate([y.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),y.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],b.prototype,"readRenderer",null);c.__decorate([d.property(h.screenSizePerspectiveEnabled)],b.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([d.property()],b.prototype,"sourceJSON",void 0);c.__decorate([d.property({type:A,
json:{origins:{service:{read:{source:"spatialReference"}}}}})],b.prototype,"spatialReference",void 0);c.__decorate([d.property({json:{read:!1}})],b.prototype,"type",void 0);c.__decorate([d.property(h.url)],b.prototype,"url",void 0);c.__decorate([d.property({type:Number})],b.prototype,"updateInterval",void 0);c.__decorate([d.property({json:{read:!1,write:!1}})],b.prototype,"useViewTime",void 0);c.__decorate([d.property({type:String})],b.prototype,"webSocketUrl",void 0);return b=c.__decorate([J.subclass("esri.layers.StreamLayer")],
b)});