// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../Graphic ../symbols ../core/Collection ../core/Error ../core/lang ../core/MultiOriginJSONSupport ../core/object ../core/Warning ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/projection ../geometry/support/aaBoundingRect ../geometry/support/normalizeUtils ../geometry/support/spatialReferenceUtils ./FeatureLayer ./GraphicsLayer ./Layer ./graphics/objectIdUtils ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/Field ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../symbols/TextSymbol ../geometry/SpatialReference ../geometry/Extent".split(" "),
function(w,d,f,L,ha,A,M,B,N,O,E,h,ia,x,F,P,v,n,Q,R,S,T,U,V,W,X,Y,Z,G,aa,ba,H,ca,y,da){function z(p){return"markup"===p.featureCollectionType||p.layers.some(l=>null!=l.layerDefinition.visibilityField||!I(l))}function I({layerDefinition:p,featureSet:l}){const e=p.geometryType??l.geometryType;return C.find(b=>e===b.geometryTypeJSON&&p.drawingInfo?.renderer?.symbol?.type===b.identifyingSymbol.type)}function J(){return new da({xmin:-180,ymin:-90,xmax:180,ymax:90})}const K=new G({name:"OBJECTID",alias:"OBJECTID",
type:"oid",nullable:!1,editable:!1}),ea=new G({name:"title",alias:"Title",type:"string",nullable:!0,editable:!0});let r=function(p){function l(e){e=p.call(this,e)||this;e.visibilityMode="inherited";return e}w._inherits(l,p);l.prototype.initialize=function(){for(const e of this.graphics)e.sourceLayer=this.layer;this.graphics.on("after-add",e=>{e.item.sourceLayer=this.layer});this.graphics.on("after-remove",e=>{e.item.sourceLayer=null})};w._createClass(l,[{key:"fullExtent",get:function(){const e=this.layer?.spatialReference,
b=this.fullBounds;return e?null==b?v.projectOrLoad(J(),e).geometry:n.toExtent(b,e):null}},{key:"fullBounds",get:function(){const e=this.layer?.spatialReference;if(!e)return null;const b=n.empty();this.graphics.forEach(a=>{a=null!=a.geometry?v.projectOrLoad(a.geometry,e).geometry:null;null!=a&&n.expand(b,"point"===a.type?a:a.extent,b)});return n.equals(b,n.NEGATIVE_INFINITY)?null:b}},{key:"sublayers",get:function(){return this.graphics}}]);return l}(T);d.__decorate([h.property({readOnly:!0})],r.prototype,
"fullExtent",null);d.__decorate([h.property({readOnly:!0})],r.prototype,"fullBounds",null);d.__decorate([h.property({readOnly:!0})],r.prototype,"sublayers",null);d.__decorate([h.property()],r.prototype,"layer",void 0);d.__decorate([h.property()],r.prototype,"layerId",void 0);d.__decorate([h.property({readOnly:!0})],r.prototype,"visibilityMode",void 0);r=d.__decorate([F.subclass("esri.layers.MapNotesLayer.MapNotesSublayer")],r);const C=[{geometryType:"polygon",geometryTypeJSON:"esriGeometryPolygon",
id:"polygonLayer",layerId:0,title:"Polygons",identifyingSymbol:(new aa).toJSON()},{geometryType:"polyline",geometryTypeJSON:"esriGeometryPolyline",id:"polylineLayer",layerId:1,title:"Polylines",identifyingSymbol:(new ba).toJSON()},{geometryType:"multipoint",geometryTypeJSON:"esriGeometryMultipoint",id:"multipointLayer",layerId:2,title:"Multipoints",identifyingSymbol:(new H).toJSON()},{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",id:"pointLayer",layerId:3,title:"Points",identifyingSymbol:(new H).toJSON()},
{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",id:"textLayer",layerId:4,title:"Text",identifyingSymbol:(new ca).toJSON()}];f=function(p){function l(b){var a=p.call(this,b)||this;a.capabilities={operations:{supportsMapNotesEditing:!0}};a.featureCollections=null;a.featureCollectionJSON=null;a.featureCollectionType="notes";a.legendEnabled=!1;a.listMode="hide-children";a.minScale=0;a.maxScale=0;a.spatialReference=y.WGS84;a.sublayers=new A(C.map(c=>new r({id:c.id,layerId:c.layerId,title:c.title,
layer:w._assertThisInitialized(a)})));a.title="Map Notes";a.type="map-notes";a.visibilityMode="inherited";return a}w._inherits(l,p);var e=l.prototype;e.readCapabilities=function(b,a,c){return{operations:{supportsMapNotesEditing:!z(a)&&"portal-item"!==c?.origin}}};e.readFeatureCollections=function(b,a,c){if(!z(a))return null;b=a.layers.map(k=>{const g=new S;g.read(k,c);return g});return new A({items:b})};e.readLegacyfeatureCollectionJSON=function(b,a){return z(a)?B.clone(a.featureCollection):null};
e.readMinScale=function(b,a){for(const c of a.layers)if(null!=c.layerDefinition.minScale)return c.layerDefinition.minScale;return 0};e.readMaxScale=function(b,a){for(const c of a.layers)if(null!=c.layerDefinition.maxScale)return c.layerDefinition.maxScale;return 0};e.readSpatialReference=function(b,a){return a.layers.length?y.fromJSON(a.layers[0].layerDefinition.spatialReference):y.WGS84};e.readSublayers=function(b,a,c){if(z(a))return null;b=[];c=a.layers.reduce((k,g)=>Math.max(k,g.layerDefinition.id??
-1),-1)+1;for(const k of a.layers){const {layerDefinition:g,featureSet:m}=k;a=g.id??c++;const t=I(k);null!=t&&(a=new r({id:t.id,title:g.name,layerId:a,layer:this,graphics:m.features.map(({geometry:u,symbol:q,attributes:D,popupInfo:fa})=>L.fromJSON({attributes:D,geometry:u,symbol:q,popupTemplate:fa}))}),b.push(a))}return new A(b)};e.writeSublayers=function(b,a,c,k){const {minScale:g,maxScale:m}=this;if(null!=b)if(c=b.some(q=>0<q.graphics.length),this.capabilities.operations.supportsMapNotesEditing){c=
[];var t=this.spatialReference.toJSON();a:for(var u of b)for(const q of u.graphics)if(null!=q.geometry){t=q.geometry.spatialReference.toJSON();break a}for(const q of C)u=b.find(D=>q.id===D.id),this._writeMapNoteSublayer(c,u,q,g,m,t,k);O.setDeepValue("featureCollection.layers",c,a)}else c&&k?.messages?.push(new M("map-notes-layer:editing-not-supported","New map notes cannot be added to this layer"))};e.load=function(b){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Collection"]},
b));return Promise.resolve(this)};e.read=function(b,a){"featureCollection"in b&&(b=B.clone(b),Object.assign(b,b.featureCollection));w._get(w._getPrototypeOf(l.prototype),"read",this).call(this,b,a)};e.beforeSave=async function(){if(null!=this.sublayers){var b=null,a=[];for(const k of this.sublayers)for(const g of k.graphics)if(null!=g.geometry){const m=g.geometry;b?R.equals(m.spatialReference,b)||(v.canProjectWithoutEngine(m.spatialReference,b)||v.isLoaded()||await v.load(),g.geometry=v.project(m,
b)):b=m.spatialReference;a.push(g)}var c=await Q.normalizeCentralMeridian(a.map(k=>k.geometry));a.forEach((k,g)=>k.geometry=c[g])}};e._findSublayer=function(b){return null==this.sublayers?null:this.sublayers?.find(a=>a.id===b)??null};e._writeMapNoteSublayer=function(b,a,c,k,g,m,t){const u=[];if(null!=a){for(const q of a.graphics)this._writeMapNote(u,q,c.geometryType,t);this._normalizeObjectIds(u,K);b.push({layerDefinition:{name:a.title,drawingInfo:{renderer:{type:"simple",symbol:B.clone(c.identifyingSymbol)}},
id:a.layerId,geometryType:c.geometryTypeJSON,minScale:k,maxScale:g,objectIdField:"OBJECTID",fields:[K.toJSON(),ea.toJSON()],spatialReference:m},featureSet:{features:u,geometryType:c.geometryTypeJSON}})}};e._writeMapNote=function(b,a,c,k){if(null!=a){var {geometry:g,symbol:m,popupTemplate:t}=a;null!=g&&(g.type!==c?k?.messages?.push(new E("map-notes-layer:invalid-geometry-type",`Geometry "${g.type}" cannot be saved in "${c}" layer`,{graphic:a})):null==m?k?.messages?.push(new E("map-notes-layer:no-symbol",
"Skipping map notes with no symbol",{graphic:a})):(a={attributes:{...a.attributes},geometry:g.toJSON(),symbol:m.toJSON()},null!=t&&(a.popupInfo=t.toJSON()),b.push(a)))}};e._normalizeObjectIds=function(b,a){a=a.name;let c=V.findLastObjectIdFromFeatures(a,b)+1;const k=new Set;for(const g of b){g.attributes||(g.attributes={});({attributes:b}=g);if(null==b[a]||k.has(b[a]))b[a]=c++;k.add(b[a])}};w._createClass(l,[{key:"fullExtent",get:function(){const b=this.spatialReference,a=n.empty();null!=this.sublayers?
this.sublayers.forEach(({fullBounds:c})=>null!=c?n.expand(a,c,a):a,a):this.featureCollectionJSON?.layers.some(c=>c.layerDefinition.extent)&&this.featureCollectionJSON.layers.forEach(c=>{c=v.projectOrLoad(c.layerDefinition.extent,b).geometry;null!=c&&n.expand(a,c,a)});return n.equals(a,n.NEGATIVE_INFINITY)?v.projectOrLoad(J(),b).geometry:n.toExtent(a,b)}},{key:"multipointLayer",get:function(){return this._findSublayer("multipointLayer")}},{key:"pointLayer",get:function(){return this._findSublayer("pointLayer")}},
{key:"polygonLayer",get:function(){return this._findSublayer("polygonLayer")}},{key:"polylineLayer",get:function(){return this._findSublayer("polylineLayer")}},{key:"textLayer",get:function(){return this._findSublayer("textLayer")}}]);return l}(W.BlendLayer(Z.ScaleRangeLayer(X.OperationalLayer(Y.PortalLayer(N.MultiOriginJSONMixin(U))))));d.__decorate([h.property({readOnly:!0})],f.prototype,"capabilities",void 0);d.__decorate([x.reader(["portal-item","web-map"],"capabilities",["layers"])],f.prototype,
"readCapabilities",null);d.__decorate([h.property({readOnly:!0})],f.prototype,"featureCollections",void 0);d.__decorate([x.reader(["web-map","portal-item"],"featureCollections",["layers"])],f.prototype,"readFeatureCollections",null);d.__decorate([h.property({readOnly:!0,json:{origins:{"web-map":{write:{enabled:!0,target:"featureCollection"}}}}})],f.prototype,"featureCollectionJSON",void 0);d.__decorate([x.reader(["web-map","portal-item"],"featureCollectionJSON",["featureCollection"])],f.prototype,
"readLegacyfeatureCollectionJSON",null);d.__decorate([h.property({readOnly:!0,json:{read:!0,write:{enabled:!0,ignoreOrigin:!0}}})],f.prototype,"featureCollectionType",void 0);d.__decorate([h.property({readOnly:!0})],f.prototype,"fullExtent",null);d.__decorate([h.property({readOnly:!0,json:{origins:{"web-map":{write:{target:"featureCollection.showLegend",overridePolicy(){return{enabled:null!=this.featureCollectionJSON}}}}}}})],f.prototype,"legendEnabled",void 0);d.__decorate([h.property({type:["show",
"hide","hide-children"]})],f.prototype,"listMode",void 0);d.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!1}})],f.prototype,"minScale",void 0);d.__decorate([x.reader(["web-map","portal-item"],"minScale",["layers"])],f.prototype,"readMinScale",null);d.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!1}})],f.prototype,"maxScale",void 0);d.__decorate([x.reader(["web-map","portal-item"],"maxScale",["layers"])],f.prototype,"readMaxScale",null);d.__decorate([h.property({readOnly:!0})],
f.prototype,"multipointLayer",null);d.__decorate([h.property({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],f.prototype,"operationalLayerType",void 0);d.__decorate([h.property({readOnly:!0})],f.prototype,"pointLayer",null);d.__decorate([h.property({readOnly:!0})],f.prototype,"polygonLayer",null);d.__decorate([h.property({readOnly:!0})],f.prototype,"polylineLayer",null);d.__decorate([h.property({type:y})],f.prototype,"spatialReference",void 0);d.__decorate([x.reader(["web-map","portal-item"],
"spatialReference",["layers"])],f.prototype,"readSpatialReference",null);d.__decorate([h.property({readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],f.prototype,"sublayers",void 0);d.__decorate([x.reader("web-map","sublayers",["layers"])],f.prototype,"readSublayers",null);d.__decorate([P.writer("web-map","sublayers")],f.prototype,"writeSublayers",null);d.__decorate([h.property({readOnly:!0})],f.prototype,"textLayer",null);d.__decorate([h.property()],f.prototype,"title",void 0);d.__decorate([h.property({readOnly:!0,
json:{read:!1}})],f.prototype,"type",void 0);return f=d.__decorate([F.subclass("esri.layers.MapNotesLayer")],f)});