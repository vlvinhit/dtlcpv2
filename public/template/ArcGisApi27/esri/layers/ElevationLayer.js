// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/Error ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/ElevationTileData ./support/LercDecoder".split(" "),
function(p,q,e,r,w,x,b,m,y,g,L,M,N,t,z,A,B,C,D,E,F,G,H,I){b=function(u){function l(...a){a=u.call(this,...a)||this;a.capabilities={operations:{supportsTileMap:!1}};a.copyright=null;a.heightModelInfo=null;a.path=null;a.minScale=void 0;a.maxScale=void 0;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.sourceJSON=null;a.type="elevation";a.url=null;a.version=null;a._lercDecoder=I.acquireDecoder();return a}q._inherits(l,u);var h=l.prototype;h.normalizeCtorArgs=function(a,c){return"string"===
typeof a?{url:a,...c}:a};h.destroy=function(){this._lercDecoder=x.releaseMaybe(this._lercDecoder)};h.readCapabilities=function(a,c){return(a=c.capabilities&&c.capabilities.split(",").map(f=>f.toLowerCase().trim()))?{operations:{supportsTileMap:a.includes("tilemap")}}:{operations:{supportsTileMap:!1}}};h.readVersion=function(a,c){(a=c.currentVersion)||(a=9.3);return a};h.load=function(a){const c=null!=a?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,
validateItem:f=>{for(let d=0;d<f.typeKeywords.length;d++)if("elevation 3d layer"===f.typeKeywords[d].toLowerCase())return!0;throw new w("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},a).catch(m.throwIfAbortError).then(()=>this._fetchImageService(c)));return Promise.resolve(this)};h.fetchTile=function(a,c,f,d){d=d||{signal:null};const k=null!=d.signal?d.signal:d.signal=(new AbortController).signal,
J={responseType:"array-buffer",signal:k},K={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(a,c,f,d)).then(()=>r(this.getTileUrl(a,c,f),J)).then(n=>this._lercDecoder.decode(n.data,K,k)).then(n=>new H.ElevationTileData(n))};h.getTileUrl=function(a,c,f){const d=y.objectToQuery({...this.parsedUrl.query,blankTile:!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile?!1:null});return`${this.parsedUrl.path}/tile/${a}/${c}/${f}${d?"?"+
d:""}`};h.queryElevation=async function(a,c){const {ElevationQuery:f}=await new Promise((d,k)=>p(["./support/ElevationQuery"],d,k));m.throwIfAborted(c);return(new f).query(this,a,c)};h.createElevationSampler=async function(a,c){const {ElevationQuery:f}=await new Promise((d,k)=>p(["./support/ElevationQuery"],d,k));m.throwIfAborted(c);return(new f).createSampler(this,a,c)};h._fetchTileAvailability=function(a,c,f,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,c,f,d):Promise.resolve("unknown")};
h._fetchImageService=async function(a){if(this.sourceJSON)return this.sourceJSON;a=await r(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:a});a.ssl&&(this.url=this.url?.replace(/^http:/i,"https:"));this.sourceJSON=a.data;this.read(a.data,{origin:"service",url:this.parsedUrl})};q._createClass(l,[{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile[v]}}]);return l}(C.ArcGISCachedService(D.ArcGISService(E.OperationalLayer(F.PortalLayer(b.MultiOriginJSONMixin(B))))));
e.__decorate([g.property({readOnly:!0})],b.prototype,"capabilities",void 0);e.__decorate([t.reader("service","capabilities",["capabilities"])],b.prototype,"readCapabilities",null);e.__decorate([g.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);e.__decorate([g.property({readOnly:!0,type:A})],b.prototype,"heightModelInfo",void 0);e.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);e.__decorate([g.property({type:["show",
"hide"]})],b.prototype,"listMode",void 0);e.__decorate([g.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],b.prototype,"minScale",void 0);e.__decorate([g.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],b.prototype,"maxScale",void 0);e.__decorate([g.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,
write:!1}}}})],b.prototype,"opacity",void 0);e.__decorate([g.property({type:["ArcGISTiledElevationServiceLayer"]})],b.prototype,"operationalLayerType",void 0);e.__decorate([g.property()],b.prototype,"sourceJSON",void 0);e.__decorate([g.property({json:{read:!1},value:"elevation",readOnly:!0})],b.prototype,"type",void 0);e.__decorate([g.property(G.url)],b.prototype,"url",void 0);e.__decorate([g.property()],b.prototype,"version",void 0);e.__decorate([t.reader("version",["currentVersion"])],b.prototype,
"readVersion",null);b=e.__decorate([z.subclass("esri.layers.ElevationLayer")],b);const v=Symbol("default-fetch-tile");b.prototype.fetchTile[v]=!0;return b});