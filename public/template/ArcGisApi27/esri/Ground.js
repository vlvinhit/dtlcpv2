// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Color ./core/Collection ./core/collectionUtils ./core/compilerUtils ./core/Error ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./ground/NavigationConstraint ./webdoc/support/opacityUtils".split(" "),function(u,m,n,B,C,
D,E,F,g,w,G,H,x,q,r,y,I,J,K,z){function A(h){return"elevation"===h.type||h&&"createElevationSampler"in h}var v;g=v=function(h){function k(a){var b=h.call(this,a)||this;b.opacity=1;b.surfaceColor=null;b.navigationConstraint=null;b.layers=new C;b.addHandles([b.layers.on("after-add",c=>{c=c.item;c.parent&&c.parent!==m._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=m._assertThisInitialized(b);"elevation"!==c.type&&"base-elevation"!==c.type&&x.getLogger(m._assertThisInitialized(b)).error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)}),
b.layers.on("after-remove",c=>{c.item.parent=null})]);return b}m._inherits(k,h);var d=k.prototype;d.initialize=function(){this.when().catch(a=>{q.isAbortError(a)||x.getLogger(this).error("#load()","Failed to load ground",a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};d.destroy=function(){const a=this.layers.removeAll();for(const b of a)b.destroy();this.layers.destroy()};d.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),
a={...a},delete a.resourceInfo);return a};d.writeLayers=function(a,b,c,e){const l=[];a&&(e={...e,layerContainerType:"ground"},a.forEach(f=>{if("write"in f){const p={};E.typeCast(f)().write(p,e)&&l.push(p)}else e&&e.messages&&e.messages.push(new F("layer:unsupported",`Layers (${f.title}, ${f.id}) of type '${f.declaredClass}' cannot be persisted in the ground`,{layer:f}))}));b.layers=l};d.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};d.loadAll=function(){return H.loadAll(this,
a=>{a(this.layers)})};d.queryElevation=async function(a,b){await this.load({signal:b?.signal});var {ElevationQuery:c}=await new Promise((l,f)=>u(["./layers/support/ElevationQuery"],l,f));q.throwIfAborted(b);c=new c;const e=this.layers.filter(A).toArray();return c.queryAll(e,a,b)};d.createElevationSampler=async function(a,b){await this.load({signal:b?.signal});var {ElevationQuery:c}=await new Promise((l,f)=>u(["./layers/support/ElevationQuery"],l,f));q.throwIfAborted(b);c=new c;const e=this.layers.filter(A).toArray();
return c.createSamplerAll(e,a,b)};d.clone=function(){const a={opacity:this.opacity,surfaceColor:w.clone(this.surfaceColor),navigationConstraint:w.clone(this.navigationConstraint),layers:this.layers.slice()};this.loaded&&(a.loadStatus="loaded");return(new v({resourceInfo:this.resourceInfo})).set(a)};d.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});m._get(m._getPrototypeOf(k.prototype),"read",this).call(this,a,b)};d._loadFromSource=function(a){const b=this.resourceInfo;
return b?this._loadLayersFromJSON(b.data,b.context,a):Promise.resolve()};d._loadLayersFromJSON=function(a,b,c){const e=b&&b.origin||"web-scene",l=b&&b.portal||null,f=b&&b.url||null;return(new Promise((p,t)=>u(["./layers/support/layersCreator"],p,t))).then(({populateOperationalLayers:p})=>{q.throwIfAborted(c);const t=[];a.layers&&Array.isArray(a.layers)&&t.push(p(this.layers,a.layers,{context:{origin:e,url:f,portal:l,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));
return q.eachAlways(t)}).then(()=>{})};m._createClass(k,[{key:"layers",set:function(a){this._set("layers",D.referenceSetter(a,this._get("layers")))}}]);return k}(g.JSONSupportMixin(G));n.__decorate([r.property({json:{read:!1}})],g.prototype,"layers",null);n.__decorate([J.writer("layers")],g.prototype,"writeLayers",null);n.__decorate([r.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);n.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:y.Integer,read:{reader:z.transparencyToOpacity,
source:"transparency"},write:{writer:(h,k)=>{k.transparency=z.opacityToTransparency(h)},target:"transparency"}}})],g.prototype,"opacity",void 0);n.__decorate([r.property({type:B,json:{type:[y.Integer],write:(h,k)=>{k.surfaceColor=h.toJSON().slice(0,3)}}})],g.prototype,"surfaceColor",void 0);n.__decorate([r.property({type:K.NavigationConstraint,json:{write:!0}})],g.prototype,"navigationConstraint",void 0);return g=v=n.__decorate([I.subclass("esri.Ground")],g)});