// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Map ./core/Error ./core/Loadable ./core/loadAll ./core/Logger ./core/MultiOriginJSONSupport ./core/Promise ./core/urlUtils ./core/Version ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/arrayUtils ./core/has ./core/accessorSupport/decorators/subclass ./core/accessorSupport/read ./linkchart/InitialViewProperties ./portal/Portal ./portal/PortalItem ./webmap/initialViewPropertiesUtils".split(" "),
function(x,m,f,c,r,y,z,t,A,B,C,u,g,H,I,J,D,E,p,v,F,G){c=function(w){function n(a){a=w.call(this,a)||this;a.initialViewProperties=new p;a.portalItem=null;return a}m._inherits(n,w);var d=n.prototype;d.load=function(a){this.addResolvingPromise(this._loadFromSource());return Promise.resolve(this)};d.destroy=function(){const a=this.portalItem;this.portalItem=null;a?.destroy()};d.initialize=function(){this.when().catch(a=>{t.getLogger(this).error("#load()","Failed to load link chart",a)});if(this.sourceJSON){let a;
try{a=this._validateJSON(this.sourceJSON)}catch(b){this.addResolvingPromise(Promise.reject(b));return}this.read(a)}};d.loadAll=function(){return z.loadAll(this,a=>{a(this.ground,this.basemap,this.layers,this.tables)})};d.read=function(a,b){b={...b,origin:"link-chart"};E.readLoadable(this,a,e=>m._get(m._getPrototypeOf(n.prototype),"read",this).call(this,a,e),b)};d._loadFromSource=function(){return this.sourceJSON?this._loadFromJSON(this.sourceJSON,{origin:"link-chart"}):this.portalItem&&this.portalItem.id?
this._loadFromItem(this.portalItem):Promise.resolve()};d._loadFromJSON=function(a,b){const e={context:{...b,layerContainerType:"operational-layers"}};this.portalItem&&(e.context.portal=this.portalItem.portal||v.getDefault());return(new Promise((h,k)=>x(["./layers/support/layersCreator"],h,k))).then(({populateOperationalLayers:h})=>{const k=[];var l=a.operationalLayers;l&&l.length&&k.push(h(this.layers,l,e));l={...e,context:{...e.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"};
const q=a.tables;q&&q.length&&k.push(h(this.tables,q,l));return Promise.allSettled(k).then(()=>{})})};d._loadFromItem=async function(a){await a.load().catch(h=>{throw new r("linkchart:load-portal-item","Failed to load portal item",{error:h});});if(a.type!==this.constructor.PORTAL_ITEM_TYPE)throw new r("linkchart:invalid-portal-item",`Invalid portal item type '${a.type}', expected '${this.constructor.PORTAL_ITEM_TYPE}'`,{type:a.type});var b=await a.fetchData();this.sourceJSON=b;const e={origin:"link-chart",
url:C.urlToObject(a.itemUrl),portal:a.portal||v.getDefault(),portalItem:a,readResourcePaths:[]};await this._readAndLoadFromJSON(b,e);if(a=await G.computeInitialViewpoint(this.initialViewProperties,a,t.getLogger(this)))b=this.initialViewProperties?.clone()??new p,b.viewpoint=a,this.initialViewProperties=b};d._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};d._validateJSON=function(a){const b=u.Version.parse(a.version||"","linkchart");this.constructor.VERSION.validate(b);
a.version=`${b.major}.${b.minor}`;return a};return m._createClass(n)}(A.MultiOriginJSONMixin(y.LoadableMixin(B.EsriPromiseMixin(c))));c.PORTAL_ITEM_TYPE="Link Chart";c.VERSION=new u.Version(2,27);f.__decorate([g.property({type:p,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]}}})],c.prototype,"initialViewProperties",void 0);f.__decorate([g.property({json:{read:!1}})],c.prototype,"layers",void 0);f.__decorate([g.property()],c.prototype,"linkChartProperties",
void 0);f.__decorate([g.property({type:F})],c.prototype,"portalItem",void 0);f.__decorate([g.property()],c.prototype,"sourceJSON",void 0);f.__decorate([g.property({json:{read:!1}})],c.prototype,"tables",void 0);return c=f.__decorate([D.subclass("esri.LinkChart")],c)});