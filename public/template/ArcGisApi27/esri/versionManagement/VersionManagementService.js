// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/JSONSupport ../core/Loadable ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../rest/utils ./support/versionManagementUtils".split(" "),function(n,t,m,B,f,C,y,q,J,K,L,D,E,F,G,H){const x=u=>Object.freeze(Object.defineProperty({__proto__:null,
default:u},Symbol.toStringTag,{value:"Module"}));var k;f=k=function(u){function v(a){a=u.call(this,a)||this;a.sourceJSON=null;a.capabilities=null;return a}t._inherits(v,u);var g=v.prototype;g.initialize=function(){k.versionCollection.has(this.url)||k.versionCollection.set(this.url,new Map);const a=(k.versionCollectionCount.get(this.url)??0)+1;k.versionCollectionCount.set(this.url,a)};g.destroy=function(){const a=(k.versionCollectionCount.get(this.url)??1)-1;k.versionCollectionCount.set(this.url,a);
0===a&&k.versionCollection.delete(this.url)};g.read=function(a,b){this.sourceJSON=a;t._get(t._getPrototypeOf(v.prototype),"read",this).call(this,a,b)};g.readDefaultVersionIdentifier=function(a,b){return{name:b.defaultVersionName,guid:b.defaultVersionGuid}};g.writeDefaultVersionIdentifier=function(a,b){b.defaultVersionName=a.name;b.defaultVersionGuid=a.guid};g.load=function(a){this.addResolvingPromise(this._fetchService(this.url,a));return Promise.resolve(this)};g.createVersion=async function(a){const [{createVersion:b},
{default:h}]=await Promise.all([new Promise((e,d)=>n(["../rest/versionManagement/createVersion"],e,d)),new Promise((e,d)=>n(["../rest/versionManagement/support/CreateVersionParameters"],l=>e(x(l)),d))]);a=h.from(a);return b(this.url,a)};g.deleteVersion=async function(a){const [{deleteVersion:b},{default:h}]=await Promise.all([new Promise((d,l)=>n(["../rest/versionManagement/deleteVersion"],d,l)),new Promise((d,l)=>n(["../rest/versionManagement/support/DeleteVersionParameters"],p=>d(x(p)),l))]);let e=
void 0;a.guid&&k.versionCollection.get(this.url)?.has(a.guid)&&(e=H.currentSessionId??void 0);a=new h({versionName:a.name,sessionId:e});return b(this.url,a)};g.getVersionInfoExtended=async function(a){const {getVersion:b}=await new Promise((h,e)=>n(["../rest/versionManagement/getVersion"],h,e));return b(this.url,a.guid)};g.getVersionInfos=async function(a={}){const [{getVersionInfos:b},{default:h}]=await Promise.all([new Promise((e,d)=>n(["../rest/versionManagement/getVersionInfos"],e,d)),new Promise((e,
d)=>n(["../rest/versionManagement/support/GetVersionInfosParameters"],l=>e(x(l)),d))]);a=h.from(a);return b(this.url,a)};g.getLockType=function(a){return k.versionCollection.get(this.url)?.get(a.guid)?.lockType??"none"};g.changeVersion=function(a,b,h){let e;e="layers"in a?a.allTables.concat(a.allLayers):a;a=(new y.Url(this.url)).host;let d=null,l=null,p=null,w=null;const z=c=>!c||c===this.defaultVersionIdentifier.name,I=c=>{const r=k.versionCollection?.get(this.url)?.get(c.guid);p=c.name;w=r?.moment??
null},A=(c,r)=>c||r?c&&r?c.toISOString()===r.toISOString():!1:!0;if("name"in b){if("none"!==this.getLockType(b))return!1;d=b.name;l=null}else d=this.defaultVersionIdentifier.name,l=b;"name"in h?I(h):(p=this.defaultVersionIdentifier.name,w=h);b=z(d);for(const c of e)"feature"===c.type&&(h=(new y.Url(c.url??null)).host,a.toLowerCase()===h.toLowerCase()&&(b&&z(c.gdbVersion)&&A(c.historicMoment,l)?(c.gdbVersion=p,c.historicMoment=w):d===c.gdbVersion&&A(c.historicMoment,l)&&(c.gdbVersion=p,c.historicMoment=
w)));return!0};g._fetchService=async function(a,b){this.sourceJSON?this.read(this.sourceJSON,{origin:"service",url:G.parseUrl(a)}):(a=await B(a,{responseType:"json",query:{f:"json"},...b}),this.read(a.data))};return t._createClass(v)}(f.JSONSupportMixin(C));f.versionCollection=new Map;f.versionCollectionCount=new Map;m.__decorate([q.property()],f.prototype,"url",void 0);m.__decorate([q.property()],f.prototype,"sourceJSON",void 0);m.__decorate([q.property({type:String,json:{write:!0}})],f.prototype,
"name",void 0);m.__decorate([q.property({json:{write:{target:{defaultVersionName:{type:String},defaultVersionGuid:{type:String}}},read:{source:["defaultVersionName","defaultVersionGuid"]}}})],f.prototype,"defaultVersionIdentifier",void 0);m.__decorate([D.reader("defaultVersionIdentifier",["defaultVersionName","defaultVersionGuid"])],f.prototype,"readDefaultVersionIdentifier",null);m.__decorate([F.writer("defaultVersionIdentifier",{defaultVersionName:{type:String},defaultVersionGuid:{type:String}})],
f.prototype,"writeDefaultVersionIdentifier",null);m.__decorate([q.property({json:{write:!0}})],f.prototype,"capabilities",void 0);return f=k=m.__decorate([E.subclass("esri.versionManagement.VersionManagementService")],f)});