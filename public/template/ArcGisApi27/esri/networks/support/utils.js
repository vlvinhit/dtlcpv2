// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../request ../../core/Error ../../layers/support/featureQueryAll ../../portal/PortalItem ../../rest/support/FeatureSet".split(" "),function(n,k,p,q,r,l,t){async function m(a,b){return"Utility Network Layer"===a?({default:a}=await new Promise((e,f)=>n(["../UtilityNetwork"],h=>e(Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"}))),f)),new a({layerUrl:b})):null}k.getFeaturesFromLayers=async function(a){const b=a.layers,e=a.layerInfos,
f=a.returnGeometry||!1,h=a.outSpatialReference;await Promise.all(b.map(c=>c.load()));return(await Promise.all(b.map(async c=>{var d=e.find(u=>u.layerUrl===c.parsedUrl?.path);if(!d||!d.objectIds?.length)return{layer:c,featureSet:void 0};const g=c.createQuery();g.returnGeometry=f;g.outFields=d.outFields||["*"];g.outSpatialReference=h;g.gdbVersion=c.gdbVersion;g.objectIds=d.objectIds;d=t.fromJSON(await r.queryAllJSON(c,g));return{layer:c,featureSet:d}}))).filter(c=>void 0!==c.featureSet)};k.getObjectIdsFromElements=
function(a,b){const e=[],f=new Map;for(const c of b){b=a.getLayerIdBySourceId(c.networkSourceId);if(null==b)continue;let d=f.get(b);void 0===d&&(d=[]);d.push(c.objectId);f.set(b,d)}const h=a.featureServiceUrl;f.forEach((c,d)=>e.push({layerUrl:`${h}/${d}`,objectIds:c}));return e};k.networkFromPortalItem=async function(a){a="portalItem"in a?a:{portalItem:a};!a.portalItem||a.portalItem instanceof l||(a={...a,portalItem:new l(a.portalItem)});a=a.portalItem;await a.load();if("Feature Service"!==a.type)throw new q("portal:unknown-item-type",
"Unknown item type '${type}'",{type:a.type});a=a.url;var b=await p(a,{responseType:"json",query:{f:"json"}});return b.data.type&&b.data.type.includes("Network Layer")?m(b.data.type,a):b.data.layers&&(b=b.data.layers.find(e=>e.type.includes("Network Layer")))?m(b.type,`${a}/${b.id}`):null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});