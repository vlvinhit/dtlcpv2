// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/JSONSupport ../core/Loadable ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./support/typeUtils".split(" "),function(x,p,C,k,D,q,F,G,H,E,n){k=function(y){function u(c){c=y.call(this,c)||this;c.request=C;return c}x._inherits(u,y);var r=u.prototype;r.initialize=function(){};r.load=async function(c){c=this.layer.load(c).then(()=>
this._initializeRulesTable());this.addResolvingPromise(c);return this};r.getFeatureSQL=function(c,b){var e=c.layerId.toString(),a=c.fieldsIndex?.normalizeFieldName("assetGroup");c=c.fieldsIndex?.normalizeFieldName("assetType");a=a?b.attributes[a]:null;b=c?b.attributes[c]:null;if(e=this.rulesHash[e])if(e=e.assetGroupHash[a])return e.assetTypeHash[b]||null;return null};r._initializeRulesTable=async function(){const c={};let b;var e=b||(b={});e[e.from=0]="from";e[e.to=1]="to";e[e.via=2]="via";e=[{networkSourceId:"fromNetworkSource",
assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(const f of this.rules)if(f.ruleType===n.RuleType.RTJunctionJunctionConnectivity||f.ruleType===n.RuleType.RTJunctionEdgeConnectivity||f.ruleType===n.RuleType.RTEdgeJunctionEdgeConnectivity){var a=[[b.from,b.to],[b.to,b.from]];f.ruleType===n.RuleType.RTEdgeJunctionEdgeConnectivity&&
(a=[[b.from,b.via],[b.via,b.from],[b.to,b.via],[b.via,b.to]]);for(const z of a){a=z.shift();var h=z.shift(),g=!1;switch(f.ruleType){case n.RuleType.RTEdgeJunctionEdgeConnectivity:g=a===b.from||a===b.to;break;case n.RuleType.RTJunctionEdgeConnectivity:g=a===b.to}var l=e[a];a=f[l.networkSourceId]?.layerId.toString()??"";const t=f[l.assetGroupId]?.assetGroupCode?.toString();l=f[l.assetTypeId]?.assetTypeCode?.toString();var m=e[h];h=f[m.networkSourceId]?.layerId.toString()??"";const A=f[m.assetGroupId]?.assetGroupCode?.toString();
m=f[m.assetTypeId];const B=m?.assetTypeCode?.toString(),v=c[a]??{assetGroupHash:{}};if(!(t&&l&&A&&B))continue;const w=v.assetGroupHash[t]??{assetTypeHash:{}},d=w.assetTypeHash[l]??{};d[h]=d[h]??{};g&&(d[a]=d[a]??{},g=`(assetgroup = ${t} AND assettype = ${l})`,d[a].anyVertex=d[a].anyVertex?`${d[a].anyVertex}`:`${g}`,"esriNECPEndVertex"===m?.connectivityPolicy&&(d[a].endVertex=d[a]?.endVertex?`${d[a].endVertex}`:`${g}`));g=`(assetgroup = ${A} AND assettype = ${B})`;d[h].anyVertex=d[h]?.anyVertex?`${d[h].anyVertex} OR ${g}`:
`${g}`;"esriNECPEndVertex"===m?.connectivityPolicy&&(d[h].endVertex=d[h]?.endVertex?`${d[h].endVertex} OR ${g}`:`${g}`);w.assetTypeHash[l]=d;v.assetGroupHash[t]=w;c[a]=v}}this.rulesHash=c};return x._createClass(u)}(k.JSONSupportMixin(D));p.__decorate([q.property({constructOnly:!0})],k.prototype,"layer",void 0);p.__decorate([q.property({constructOnly:!0})],k.prototype,"rules",void 0);p.__decorate([q.property()],k.prototype,"rulesHash",void 0);p.__decorate([q.property({constructOnly:!0})],k.prototype,
"request",void 0);return k=p.__decorate([E.subclass("esri.networks.RulesTable")],k)});