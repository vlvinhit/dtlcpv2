// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/Collection ./core/collectionUtils ./core/deprecate ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./webdoc/support/writeUtils".split(" "),
function(E,l,k,u,z,F,f,v,G,H,w,x,y,m,P,I,J,K,A,L,B,C){var r;let M=0;f=r=function(n){function h(a){var b=n.call(this,a)||this;b.id=null;b.portalItem=null;b.spatialReference=null;b.thumbnailUrl=null;b.title="Basemap";b.id=Date.now().toString(16)+"-basemap-"+M++;b.baseLayers=new u;b.referenceLayers=new u;const d=c=>{c.parent&&c.parent!==l._assertThisInitialized(b)&&"remove"in c.parent&&c.parent.remove(c);c.parent=l._assertThisInitialized(b);"elevation"===c.type&&w.getLogger(l._assertThisInitialized(b)).error(`Layer '${c.title}, id:${c.id}' of type '${c.type}' is not supported as a basemap layer and will therefore be ignored.`)};
b.addHandles([b.baseLayers.on("after-add",c=>d(c.item)),b.referenceLayers.on("after-add",c=>d(c.item)),b.baseLayers.on("after-remove",c=>{c.item.parent=null}),b.referenceLayers.on("after-remove",c=>{c.item.parent=null})]);return b}l._inherits(h,n);var e=h.prototype;e.initialize=function(){this.when().catch(a=>{w.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};e.destroy=
function(){var a=this.baseLayers.removeAll();for(const b of a)b.destroy();a=this.referenceLayers.removeAll();for(const b of a)b.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem?.destroy();this.portalItem=null};e.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a={...a},delete a.resourceInfo);return a};e._writeBaseLayers=function(a,b,d){const c=[];a&&(d={...d,layerContainerType:"basemap"},this.baseLayers.forEach(g=>{g=
C.getLayerJSON(g,d.webmap?d.webmap.getLayerJSONFromResourceInfo(g):null,d);null!=g&&c.push(g)}),this.referenceLayers.forEach(g=>{const p=C.getLayerJSON(g,d.webmap?d.webmap.getLayerJSONFromResourceInfo(g):null,d);null!=p&&("scene"!==g.type&&(p.isReference=!0),c.push(p))}));b.baseMapLayers=c};e.writeTitle=function(a,b){b.title=a||"Basemap"};e.load=function(a){this.addResolvingPromise(this._loadFromSource(a));return Promise.resolve(this)};e.loadAll=function(){return H.loadAll(this,a=>{a(this.baseLayers,
this.referenceLayers)})};e.clone=function(){const a={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(b=>v.isClonable(b)?b.clone():b),referenceLayers:this.referenceLayers.map(b=>v.isClonable(b)?b.clone():b)};this.loaded&&(a.loadStatus="loaded");return(new r({resourceInfo:this.resourceInfo})).set(a)};e.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});l._get(l._getPrototypeOf(h.prototype),"read",this).call(this,a,b)};e.write=function(a,
b){a=a||{};b&&b.origin||(b={origin:"web-map",...b});l._get(l._getPrototypeOf(h.prototype),"write",this).call(this,a,b);!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(d=>{d=v.clone(d);d.url&&y.isProtocolRelative(d.url)&&(d.url=`https:${d.url}`);d.templateUrl&&y.isProtocolRelative(d.templateUrl)&&(d.templateUrl=`https:${d.templateUrl}`);return d}));return a};e._loadFromSource=async function(a){const {resourceInfo:b,portalItem:d}=
this;x.throwIfAborted(a);const c=[];b?(c.push(this._loadLayersFromJSON(b.data,b.context?b.context.url:null,a)),b.data.id&&!b.data.title&&c.push(B.getBasemapTitle(b.data.id).then(g=>{g&&this.read({title:g},b.context)}))):d&&c.push(this._loadFromItem(d,a));await Promise.all(c)};e._loadLayersFromJSON=async function(a,b,d){var c=this.resourceInfo&&this.resourceInfo.context;const g=this.portalItem&&this.portalItem.portal||c&&c.portal||null,p=N[c?.origin||""]??"web-map",{populateOperationalLayers:D}=await new Promise((t,
q)=>E(["./layers/support/layersCreator"],t,q));c=[];x.throwIfAborted(d);if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){b={context:{origin:p,url:b,portal:g,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const t=q=>"web-scene"===p&&"ArcGISSceneServiceLayer"===q.layerType||q.isReference;d=D(this.baseLayers,a.baseMapLayers.filter(q=>!t(q)),b);c.push(d);a=D(this.referenceLayers,a.baseMapLayers.filter(t),b);c.push(a)}await x.eachAlways(c)};e._loadFromItem=async function(a,b){const d=
await (await a.load(b)).fetchData("json",b),c=y.urlToObject(a.itemUrl??"");this._set("resourceInfo",{data:d.baseMap??{},context:{origin:O[a.type||""]??"web-map",portal:a.portal||A.getDefault(),url:c}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:d.spatialReference},this.resourceInfo.context);this.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||A.getDefault(),url:c});return this._loadLayersFromJSON(this.resourceInfo.data,
c,b)};h.fromId=function(a){const b=B.esriBasemapDefinitions[a];if(!b)return null;if(b.deprecated){let d=null;"dark-gray"===a?d="dark-gray-vector":"gray"===a?d="gray-vector":"streets"===a?d="streets-vector":"topo"===a&&(d="topo-vector");F.deprecated(w.getLogger("esri.Basemap"),`The ${a} basemap has entered mature support and is no longer being updated.`,{replacement:d,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return r.fromJSON(b)};l._createClass(h,[{key:"baseLayers",set:function(a){this._set("baseLayers",
z.referenceSetter(a,this._get("baseLayers")))}},{key:"referenceLayers",set:function(a){this._set("referenceLayers",z.referenceSetter(a,this._get("referenceLayers")))}}]);return h}(f.JSONSupportMixin(G));k.__decorate([m.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(n,h,e,a){this._writeBaseLayers(n,h,a)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:u}},writer(n,h,e,a){this._writeBaseLayers(n,h,a)}}}}}})],f.prototype,"baseLayers",null);k.__decorate([m.property({type:String,
json:{origins:{"web-scene":{write:!0}}}})],f.prototype,"id",void 0);k.__decorate([m.property({type:L})],f.prototype,"portalItem",void 0);k.__decorate([m.property()],f.prototype,"referenceLayers",null);k.__decorate([m.property({readOnly:!0})],f.prototype,"resourceInfo",void 0);k.__decorate([m.property({type:K})],f.prototype,"spatialReference",void 0);k.__decorate([m.property()],f.prototype,"thumbnailUrl",void 0);k.__decorate([m.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],
f.prototype,"title",void 0);k.__decorate([J.writer("title")],f.prototype,"writeTitle",null);f=r=k.__decorate([I.subclass("esri.Basemap")],f);const O={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},N={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"};return f});