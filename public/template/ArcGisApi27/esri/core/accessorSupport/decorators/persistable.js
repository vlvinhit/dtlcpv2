// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("require exports ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(y,u,z,q,A,B,C,D,r,n){function E(c,d,f){const h=B.getPropertyMetadata(d,f);return{type:String,read:(a,g,e)=>{a=n.read(a,g,e);if(h.type===String)return a;if("function"===typeof h.type)return new h.type({url:a})},write:{writer(a,g,e,b){if(b&&b.resources){var k=null==a?null:"string"===
typeof a?a:a.url;k=n.toJSON(k,{...b,verifyItemRelativeUrls:b&&b.verifyItemRelativeUrls?{writtenUrls:b.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},n.MarkKeep.NO);var p=h.type!==String&&(!z.isMultiOriginJSONMixin(this)||b&&b.origin&&this.originIdOf(f)>C.nameToId(b.origin));a={object:this,propertyName:f,value:a,targetUrl:k,dest:g,targetPropertyName:e,context:b,params:c};if(b&&b.portalItem&&k&&!q.isAbsolute(k))if(p){{const {context:l,targetUrl:m,params:t,value:F,dest:G,targetPropertyName:H}=
a;l.portalItem&&(g=l.portalItem.resourceFromPath(m),e=v(F,m,l),b=r.getResourceContentExtension(e),k=q.getPathExtension(g.path),p=t?.compress??!1,b!==k?w(a):(l.resources&&x({...a,resource:g,content:e,compress:p,updates:l.resources.toUpdate}),G[H]=m))}}else I(a);else b&&b.portalItem&&(null==k||null!=n.itemIdFromResourceUrl(k)||q.isBlobProtocol(k)||p)?w(a):g[e]=k}else g[e]="string"===typeof a?n.toJSON(a,b):a.write({},b)}}}}function w(c){const {targetUrl:d,params:f,value:h,context:a,dest:g,targetPropertyName:e}=
c;if(a.portalItem){var b=n.prefixAndFilenameFromResourceUrl(d),k=b?.filename??A.generateUUID(),p=f?.prefix??b?.prefix;b=v(h,d,a);var l=q.join(p,k);k=`${l}.${r.getResourceContentExtension(b)}`;var m=a.portalItem.resourceFromPath(k);q.isBlobProtocol(d)&&a.resources&&a.resources.pendingOperations.push(J(d).then(t=>{m.path=`${l}.${r.getResourceContentExtension(t)}`;g[e]=m.itemRelativeUrl}).catch(()=>{}));a.resources&&x({...c,resource:m,content:b,compress:f?.compress??!1,updates:a.resources.toAdd});g[e]=
m.itemRelativeUrl}}function I({context:c,targetUrl:d,dest:f,targetPropertyName:h}){c.portalItem&&c.resources&&(c.resources.toKeep.push({resource:c.portalItem.resourceFromPath(d),compress:!1}),f[h]=d)}function x({object:c,propertyName:d,updates:f,resource:h,content:a,compress:g}){f.push({resource:h,content:a,compress:g,finish:e=>{"string"===typeof c[d]?c[d]=e.url:c[d].url=e.url}})}function v(c,d,f){return"string"===typeof c?{url:d}:new Blob([JSON.stringify(c.toJSON(f))],{type:"application/json"})}
async function J(c){const d=(await new Promise((f,h)=>y(["../../../request"],a=>f(Object.freeze(Object.defineProperty({__proto__:null,default:a},Symbol.toStringTag,{value:"Module"}))),h))).default;({data:c}=await d(c,{responseType:"blob"}));return c}u.persistable=function(c){const d=c?.origins??[void 0];return(f,h)=>{a:if("resource"===c?.type)var a=E(c,f,h);else{switch(c?.type??"other"){case "other":a={read:!0,write:!0};break a;case "url":const {read:g,write:e}=n.persistableUrlUtils;a={read:g,write:e};
break a}a=void 0}for(const g of d){const e=D.propertyJSONMeta(f,g,h);for(const b in a)e[b]=a[b]}}};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});