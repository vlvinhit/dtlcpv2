// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.27/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../has ../lang ../Logger ../ObjectPool ./interfaces ./Property ./PropertyOrigin ./Store ./tracking ./tracking/Flags".split(" "),function(r,t,v,n,w,k,u,l,x,p,g){n.getLogger("esri.core.accessorSupport.Properties");t=function(){function h(a){this.host=a;this.propertiesByName=new Map;this.ctorArgs=null;this.destroyed=!1;this.lifecycle=k.Lifecycle.INITIALIZING;this.store=new x.Store;this._origin=l.OriginId.USER;a=this.host.constructor.__accessorMetadata__;
for(const b in a){const c=new u.Property(b,a[b]);this.propertiesByName.set(b,c)}this.metadatas=a}var d=h.prototype;d.initialize=function(){this.lifecycle=k.Lifecycle.CONSTRUCTING};d.constructed=function(){this.lifecycle=k.Lifecycle.CONSTRUCTED};d.destroy=function(){this.destroyed=!0;for(const [a,b]of this.propertiesByName){if(b.metadata.autoDestroy){const c=this.internalGet(a);c&&c&&"function"===typeof c.destroy&&(c.destroy(),~b.observerObject.flags&g.Flags.NonNullable&&this._internalSet(b,null))}b.destroy()}};
d.get=function(a){const b=this.propertiesByName.get(a);if(b.metadata.get)return b.getComputed(this);p.trackAccess(b.observerObject);const c=this.store;return c.has(a)?c.get(a):b.metadata.value};d.originOf=function(a){const b=this.store.originOf(a);return void 0===b&&(a=this.propertiesByName.get(a),void 0!==a&&a.observerObject.flags&g.Flags.HasDefaultValue)?"defaults":l.idToName(b)};d.has=function(a){return this.propertiesByName.has(a)?this.store.has(a):!1};d.keys=function(){return[...this.propertiesByName.keys()]};
d.internalGet=function(a){const b=this.propertiesByName.get(a);if(void 0!==b)return this.store.has(a)?this.store.get(a):b.metadata.value};d.internalSet=function(a,b){a=this.propertiesByName.get(a);void 0!==a&&this._internalSet(a,b)};d.getDependsInfo=function(a,b,c){const f=this.propertiesByName.get(b);if(void 0===f)return"";const e=new Set,y=p.runTracked({onObservableAccessed:m=>e.add(m),onTrackingEnd:()=>{}},()=>f.metadata.get?.call(a)),z=a.declaredClass.split(".").pop();b=`${c}${z}.${b}: ${y}\n`;
if(0===e.size)return b;c+="  ";for(const m of e)m instanceof u.Property&&(b+=`${c}${m.propertyName}: undefined\n`);return b};d.setAtOrigin=function(a,b,c){a=this.propertiesByName.get(a);if(void 0!==a)return this._setAtOrigin(a,b,c)};d.isOverridden=function(a){a=this.propertiesByName.get(a);return void 0!==a&&!!(a.observerObject.flags&g.Flags.Overriden)};d.clearOverride=function(a){a=this.propertiesByName.get(a);const b=a?.observerObject;b&&b.flags&g.Flags.Overriden&&(b.flags&=~g.Flags.Overriden,a.notifyChange())};
d.override=function(a,b){a=this.propertiesByName.get(a);if(!(void 0===a||null==b&&a.observerObject.flags&g.Flags.NonNullable)){var c=a.metadata.cast;if(c){b=this._cast(c,b);const {valid:f,value:e}=b;q.release(b);if(!f)return;b=e}a.observerObject.flags|=g.Flags.Overriden;this._internalSet(a,b)}};d.set=function(a,b){a=this.propertiesByName.get(a);if(!(void 0===a||null==b&&a.observerObject.flags&g.Flags.NonNullable)){var c=a.metadata.cast;if(c){b=this._cast(c,b);const {valid:f,value:e}=b;q.release(b);
if(!f)return;b=e}(c=a.metadata.set)?c.call(this.host,b):this._internalSet(a,b)}};d.setDefaultOrigin=function(a){this._origin=l.nameToId(a)};d.getDefaultOrigin=function(){return l.idToName(this._origin)};d.notifyChange=function(a){a=this.propertiesByName.get(a);void 0!==a&&a.notifyChange()};d.invalidate=function(a){a=this.propertiesByName.get(a);void 0!==a&&a.invalidate()};d.commit=function(a){a=this.propertiesByName.get(a);void 0!==a&&a.commit()};d._internalSet=function(a,b){this._setAtOrigin(a,b,
this.lifecycle!==k.Lifecycle.INITIALIZING?this._origin:l.OriginId.DEFAULTS)};d._setAtOrigin=function(a,b,c){const f=this.store,e=a.propertyName;f.has(e,c)&&v.equals(b,f.get(e))&&~a.observerObject.flags&g.Flags.Overriden&&c===f.originOf(e)||(a.invalidate(),f.set(e,b,c),a.commit(),p.initializeDependencyTracking(this.host,a))};d._cast=function(a,b){const c=q.acquire();c.valid=!0;c.value=b;a&&(c.value=a.call(this.host,b,c));return c};r._createClass(h,[{key:"initialized",get:function(){return this.lifecycle!==
k.Lifecycle.INITIALIZING}}]);return h}();n=function(){function h(){this.value=null;this.valid=!0}var d=h.prototype;d.acquire=function(){this.valid=!0};d.release=function(){this.value=null};return r._createClass(h)}();const q=new w(n);return t});