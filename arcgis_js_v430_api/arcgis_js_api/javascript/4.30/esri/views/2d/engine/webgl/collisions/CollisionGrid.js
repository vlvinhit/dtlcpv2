// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../definitions","../../../layers/features/support/StaticBitSet"],function(h,f,k,l){class m{constructor(a,b,c){this._width=a*c;this._height=b*c;this._pixelRatio=c;a=Math.ceil(this._width/1);b=Math.ceil(this._height/1);this._cols=a;this._rows=b;this._cells=l.StaticBitSet.create(a*b)}insertMetrics(a){this._markMetrics(a)}hasCollision(a){let b=0;for(const {computedX:c,computedY:e,width:d,height:g}of a.bounds)switch(this._collide(c,e,(d+k.labelPlacementOffsetPadding)*
this._pixelRatio,(g+k.labelPlacementOffsetPadding)*this._pixelRatio)){case 2:return 2;case 1:b++}return b===a.bounds.length?1:0}getCellId(a,b){return a+b*this._cols}has(a){return this._cells.has(a)}hasRange(a,b){return this._cells.hasRange(a,b)}set(a){this._cells.set(a)}setRange(a,b){this._cells.setRange(a,b)}_collide(a,b,c,e){a-=c/2;b-=e/2;c=a+c;var d=b+e;if(0>c||0>d||a>this._width||b>this._height)return 1;e=f.clamp(Math.floor(a/1),0,this._cols);var g=f.clamp(Math.floor(b/1),0,this._rows);a=f.clamp(Math.ceil(c/
1),0,this._cols);b=f.clamp(Math.ceil(d/1),0,this._rows);for(c=g;c<=b;c++)for(d=e;d<=a;d++)if(g=this.getCellId(d,c),this.has(g))return 2;return 0}_mark(a,b,c,e,d){a-=c/2;b-=e/2;c=a+c;d=b+e;e=f.clamp(Math.floor(a/1),0,this._cols);b=f.clamp(Math.floor(b/1),0,this._rows);c=f.clamp(Math.ceil(c/1),0,this._cols);for(a=f.clamp(Math.ceil(d/1),0,this._rows);b<=a;b++)for(d=e;d<=c;d++){const g=this.getCellId(d,b);this.set(g)}return!1}_markMetrics(a){for(const {computedX:b,computedY:c,width:e,height:d}of a.bounds)this._mark(b,
c,(e+k.labelPlacementOffsetPadding)*this._pixelRatio,(d+k.labelPlacementOffsetPadding)*this._pixelRatio,a.entityTexel)}}h.CollisionBitsetGrid=m;h.hasCollision=2;h.none=0;h.outsideExtent=1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});