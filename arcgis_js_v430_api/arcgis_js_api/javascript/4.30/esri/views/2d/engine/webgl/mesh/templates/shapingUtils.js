// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(C,v,y,w,I,G,K,A){function B(a,b){a.forEach(c=>w.transformMat2d(c,c,b));return{topLeft:a[0],topRight:a[1],bottomLeft:a[2],bottomRight:a[3]}}const L=Math.PI/180;class H{constructor(a,b,c,
d){this._rotationT=y.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const e=c.rect,h=new Float32Array(8);a*=d;b*=d;const f=c.code?e.width*d:c.metrics.width,g=c.code?e.height*d:c.metrics.height;this.width=f;this.height=g;h[0]=a;h[1]=b;h[2]=a+f;h[3]=b;h[4]=a;h[5]=b+g;h[6]=a+f;h[7]=b+g;this._data=h;this._setTextureCoords(e);this._scale=d;this._mosaic=c;this.x=a;this.y=b;this.maxOffset=Math.max(a+f,b+g)}get mosaic(){return this._mosaic}set angle(a){this._angle=
a;v.fromRotation(this._rotationT,-a);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:e,
width:h}=this._mosaic.metrics;var a=h*this._scale,b=Math.abs(e)*this._scale,c=new Float32Array(8);c[0]=this.x;c[1]=this.y;c[2]=this.x+a;c[3]=this.y;c[4]=this.x;c[5]=this.y+b;c[6]=this.x+a;c[7]=this.y+b;a=v.multiply(y.create(),this._rotationT,this._transform);y.transformMany(c,c,a);b=a=Infinity;let f=0;var d=0;for(let g=0;4>g;g++){const l=c[2*g],m=c[2*g+1];a=Math.min(a,l);b=Math.min(b,m);f=Math.max(f,l);d=Math.max(d,m)}c=f-a;d-=b;this._bounds=new A(a+c/2,b+d/2,c,d)}return this._bounds}setTransform(a){this._transform=
a;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const a=v.multiply(y.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];w.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,a);w.transformMat2d(this._offsets.topRight,this._offsets.topRight,a);w.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,a);w.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,a)}_setTextureCoords({x:a,y:b,width:c,height:d}){this._texcoords={topLeft:[a,b],topRight:[a+c,b],bottomLeft:[a,b+d],bottomRight:[a+c,b+d]}}}class J{constructor(a,b,c){this._rotation=0;this._decorate(a,b,c);this.glyphs=
a;this.bounds=this._createBounds(a);this.isMultiline=1<b.length;this._hasRotation=0!==c.angle;this._transform=this._createGlyphTransform(this.bounds,c);if((this._borderLineSizePx=c.borderLineSizePx)||c.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const d of a)d.setTransform(this._transform)}setRotation(a){if(0!==a||0!==this._rotation){this._rotation=a;var b=this._transform;a=v.fromRotation(y.create(),a);v.multiply(b,a,b);for(const c of this.glyphs)c.setTransform(this._transform)}}_decorate(a,
b,c){if(c.decoration&&"none"!==c.decoration&&a.length){var d=c.scale;c="underline"===c.decoration?26:16;var e=a[0].textureBinding;for(const l of b){const m=l.startX*d,q=l.startY*d;b=a;var h=b.push;var f=(l.width+l.glyphWidthEnd)*d;var g=e;f={code:0,page:0,sdf:!0,rect:new K(0,0,11,8),textureBinding:g,metrics:{advance:0,height:4,width:f,left:0,top:0}};h.call(b,new H(m,q+c*d,f,1))}}}shapeBackground(a){const b=(1.5+(this._borderLineSizePx||0))/2;var c=this._borderLineSizePx?b:0;const {xmin:d,ymin:e,xmax:h,
ymax:f,x:g,y:l,width:m,height:q}=this.bounds,k=[d-8,e-8],n=[h+8,e-8],p=[d-8,f+8],r=[h+8,f+8],D=B([[k[0]-b,k[1]-b],[n[0]+b,n[1]-b],[k[0]+c,k[1]+c],[n[0]-c,n[1]+c]],a),t=B([[p[0]+c,p[1]-c],[r[0]-c,r[1]-c],[p[0]-b,p[1]+b],[r[0]+b,r[1]+b]],a),u=B([[k[0]-b,k[1]-b],[k[0]+c,k[1]+c],[p[0]-b,p[1]+b],[p[0]+c,p[1]-c]],a);c=B([[n[0]-c,n[1]+c],[n[0]+b,n[1]-b],[r[0]-c,r[1]-c],[r[0]+b,r[1]+b]],a);a={main:B([k,n,p,r],a),top:D,bot:t,left:u,right:c};return[new A(g,l,m+2*b,q+2*b),a]}get boundsT(){var a=this.bounds;
const b=w.set(I.create(),a.x,a.y);w.transformMat2d(b,b,this._transform);return this._hasRotation?(a=Math.max(a.width,a.height),new A(b[0],b[1],a,a)):new A(b[0],b[1],a.width,a.height)}_createBounds(a){let b=Infinity,c=Infinity,d=0;var e=0;for(const h of a)b=Math.min(b,h.xTopLeft),c=Math.min(c,h.yTopLeft),d=Math.max(d,h.xBottomRight),e=Math.max(e,h.yBottomRight);a=d-b;e-=c;return new A(b+a/2,c+e/2,a,e)}_createGlyphTransform(a,b){const c=L*b.angle,d=y.create(),e=I.create();v.translate(d,d,w.set(e,b.xOffset,
-b.yOffset));b.useCIMAngleBehavior?v.rotate(d,d,c):(v.translate(d,d,w.set(e,a.x,a.y)),v.rotate(d,d,c),v.translate(d,d,w.set(e,-a.x,-a.y)));return d}}class E{constructor(a,b,c,d,e,h){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(b,c));this.end=Math.max(0,Math.max(b,c));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=e;this.yMax=h}}C.ShapedGlyph=H;C.ShapingInfo=J;C.shapeGlyphs=function(a,b){const c=b.scale,d=[],{glyphs:e,isRightToLeft:h}=
a;a=[];var f=1/b.scale*b.maxLineWidth,g=h?e.length-1:0,l=h?-1:e.length,m=h?-1:1,q=g,k=0,n=0,p=q;let r=p,D=0,t=Infinity,u=0;for(;q!==l;){const {code:z,metrics:x}=e[q];var F=Math.abs(x.top);10!==z&&32!==z&&(t=Math.min(t,F),u=Math.max(u,F+x.height));10===z?(q!==g&&(a.push(new E(e,p,q-m,k,Infinity===t?0:t,u)),t=Infinity,u=0),k=0,p=q+m,r=q+m,n=0):32===z?(r=q+m,n=0,D=x.advance,k+=x.advance):(k>f&&(r!==p?(F=r-2*m,k-=D,a.push(new E(e,p,F,k-n,t,u)),t=Infinity,u=0,p=r,k=n):(a.push(new E(e,p,q-m,k,t,u)),t=Infinity,
u=0,r=p=q,k=0)),k+=x.advance,n+=x.advance);q+=m}f=new E(e,p,q-m,k,t,u);0<=f.start&&f.end<e.length&&a.push(f);if(a.length){f=0;for(g=0;g<a.length;g++)({width:l}=a[g]),f=Math.max(l,f);g=a[0].yMin;f={x:0,y:g,height:a[a.length-1].yMax+b.lineHeight*(a.length-1)+("underline"===b.decoration?4:0)-g,width:f}}else f={x:0,y:0,height:0,width:0};g=f;f=G.getXAnchorDirection(b.horizontalAlignment);l=G.getYAnchorDirection(b.verticalAlignment);m=l===G.VAlign.Baseline?1:0;g=(1-m)*-g.y+g.height/2*(m?0:l-1)+-22*(m?1:
0);for(l=0;l<a.length;l++){const {start:z,end:x,width:M}=a[l];m=M/2*(f+1)*-1-3;q=l*b.lineHeight+g-3;a[l].startX=m;a[l].startY=q;for(k=z;k<=x;k++)n=e[k],10!==n.code&&(p=new H(m+n.metrics.left,q-n.metrics.top,n,c),m+=n.metrics.advance,d.push(p))}return new J(d,a,b)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});