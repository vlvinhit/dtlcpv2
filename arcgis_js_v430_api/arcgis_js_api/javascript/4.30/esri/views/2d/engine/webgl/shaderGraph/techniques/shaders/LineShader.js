// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),function(h,d,e,a,r,w,B,K,L,M,N,O,P,t){function C(b){return a.max((new a.Float(w.thinLineWidthFactor)).multiply(a.step(b,new a.Float(w.thinLineHalfWidth))),new a.Float(1))}function D(b,
c){const {halfWidth:f,normal:l}=b;b=C(f);const p=a.length(l).multiply(f);return a.clamp(b.multiply(f.subtract(p)).divide(c.add(b).subtract(new a.Float(1))),new a.Float(0),new a.Float(1))}function E(b,c){const {id:f,offset:l,pos:p,normal:m,zoomRange:x}=c,{displayViewScreenMat3:y,displayViewMat3:z}=b.view,A=t.getVisualVariableColor(b,f,c.color),u=t.getVisualVariableOpacity(b,f);{const {id:Q,halfWidth:F,referenceHalfWidth:G}=c;t.hasVisualVariableSize(b)?(c=(new a.Float(2)).multiply(G),c=t.getVisualVariableSize(b,
Q,c),c=(new a.Float(.5)).multiply(F.divide(a.max(G,new a.Float(w.epsilon)))).multiply(c)):c=F}var n=(new a.Float(.5)).multiply(b.antialiasingControls.antialiasing);n=a.max(c.add(n),new a.Float(.45)).add((new a.Float(.1)).multiply(n));const H=C(n).multiply(n).multiply(l);var q=z.multiply(new a.Vec3(H,new a.Float(0)));q=y.multiply(new a.Vec3(p,new a.Float(1))).add(q);b=(new a.Float(2)).multiply(a.step(c,new a.Float(0))).add(b.clip(f,x));q=new a.Vec4(q.xy,b,1);b=new a.Vec4(q.xy,b,1);return{color:A,opacity:u,
halfWidth:n,normal:m,scaledOffset:H,scaledHalfWidth:c,glPosition:b}}function I(b,c){const {opacity:f,color:l}=b;b=D(b,c);return f.multiply(l).multiply(b)}class k extends r.FeatureVertexInput{}d.__decorate([e.location(3,a.Vec4)],k.prototype,"color",void 0);d.__decorate([e.location(4,a.Vec2)],k.prototype,"offset",void 0);d.__decorate([e.location(5,a.Vec2)],k.prototype,"normal",void 0);d.__decorate([e.location(6,a.Float)],k.prototype,"halfWidth",void 0);d.__decorate([e.location(7,a.Float)],k.prototype,
"referenceHalfWidth",void 0);d.__decorate([e.location(8,a.Vec2)],k.prototype,"zoomRange",void 0);class J extends r.FeatureFragmentInput{}class v extends e.UniformGroup{}d.__decorate([e.uniform(a.Float)],v.prototype,"antialiasing",void 0);d.__decorate([e.uniform(a.Float)],v.prototype,"blur",void 0);class g extends r.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(b,c){const f=E(this,b);return{...f,...this.maybeRunHittest(b,c,f.halfWidth)}}fragment(b){const c=
I(b,this.antialiasingControls.blur);return this.getFragmentOutput(c,b)}hittest(b,c,f){const {viewMat3:l,tileMat3:p}=this.view;var m=l.multiply(p);b=m.multiply(new a.Vec3(b.pos,1));const x=m.multiply(new a.Vec3(c.nextPos1,1));c=m.multiply(new a.Vec3(c.nextPos2,1));const {distance:y,smallSymbolDistance:z,smallSymbolSizeThreshold:A}=this.hittestRequest;m=a.step(f,A.multiply(.5)).multiply(y.subtract(z));const u=this.hittestRequest.position;return a.min(B.distPointSegment(u,b.xy,x.xy),B.distPointSegment(u,
b.xy,c.xy)).subtract(f).add(m)}}d.__decorate([e.uniform(v)],g.prototype,"antialiasingControls",void 0);d.__decorate([e.option(K.VisualVariableColor)],g.prototype,"visualVariableColor",void 0);d.__decorate([e.option(L.VisualVariableOpacity)],g.prototype,"visualVariableOpacity",void 0);d.__decorate([e.option(M.VisualVariableSizeMinMaxValue)],g.prototype,"visualVariableSizeMinMaxValue",void 0);d.__decorate([e.option(N.VisualVariableSizeScaleStops)],g.prototype,"visualVariableSizeScaleStops",void 0);
d.__decorate([e.option(O.VisualVariableSizeStops)],g.prototype,"visualVariableSizeStops",void 0);d.__decorate([e.option(P.VisualVariableSizeUnitValue)],g.prototype,"visualVariableSizeUnitValue",void 0);d.__decorate([d.__param(0,e.input(k)),d.__param(1,e.input(r.BaseHittestVertexInput))],g.prototype,"vertex",null);d.__decorate([d.__param(0,e.input(J))],g.prototype,"fragment",null);h.AntialiasingControls=v;h.LineFragmentInput=J;h.LineShader=g;h.LineVertexInput=k;h.getLineAntialiasing=D;h.getLineFragmentColor=
I;h.getLineVertexData=E;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});