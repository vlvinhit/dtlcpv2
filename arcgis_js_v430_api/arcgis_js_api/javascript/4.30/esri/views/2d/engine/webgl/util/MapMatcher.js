// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","./Matcher"],function(f,k){class g extends k.FeatureMatcher{constructor(a,b){super();this._defaultSymbolSortKey=0;this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fields=a;this._separator=b||""}static async fromMatcherSchema(a,b){var c=b.expression?[a.storage.createComputedField({expression:b.expression})]:[b.field?a.storage.createComputedField({field:b.field}):null,b.field2?a.storage.createComputedField({field:b.field2}):null,b.field3?a.storage.createComputedField({field:b.field3}):
null];c=(await Promise.all(c)).filter(d=>!!d);const e=new g(c,b.fieldDelimiter);c=await a.createMeshWriters(b.defaultSymbol);e.setDefault(c);c=await a.createMeshWriters(b.backgroundFill);e.setBackgroundFill(c);await Promise.all(b.map.map(async(d,l)=>{const h=await a.createMeshWriters(d.symbol);"\x3cNull\x3e"===d.value?e.setNullResult(h):e.add(d.value,h,l+1)}));return e}setNullResult(a){this._nullResult=a}getSortKey(a,b){a=this._getValueFromFields(a,b);return null==a||""===a||"\x3cNull\x3e"===a?0:
(a=this._resultsMap.get(a.toString()))?a.sortKey:this._defaultSymbolSortKey}add(a,b,c){this._resultsMap.set(a.toString(),{meshWriters:b,sortKey:c});this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,c+1)}size(){return super.size()+this._resultsMap.size}doMatch(a,b){a=this._getValueFromFields(a,b);return null===this._nullResult||null!=a&&""!==a&&"\x3cNull\x3e"!==a?null==a?null:this._resultsMap.get(a.toString())?.meshWriters:this._nullResult}_getValueFromFields(a,b){const c=[];for(const e of this._fields){const d=
e.read(a,b);null==d||""===d?c.push("\x3cNull\x3e"):c.push(d)}return c.join(this._separator)}}f.MapMatcher=g;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});