// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../../highlightReasons ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(k,f,p,e,a,q,r,t,h,u){class l extends e.VertexInput{}f.__decorate([e.location(0,a.Vec3)],l.prototype,"id",void 0);f.__decorate([e.location(1,a.Float)],l.prototype,"bitset",void 0);f.__decorate([e.location(2,a.Vec2)],l.prototype,"pos",void 0);class m extends e.ComputeVertexInput{}f.__decorate([e.location(14,
a.Vec2)],m.prototype,"nextPos1",void 0);f.__decorate([e.location(15,a.Vec2)],m.prototype,"nextPos2",void 0);class v extends e.FragmentInput{}class g extends e.GraphShaderModule{clip(b,c){let d=new a.Float(0);b=this.storage.getFilterFlags(b);d=d.add(a.float(2).multiply(a.float(1).subtract(h.getFilterBit(b,0))));this.inside?d=d.add(a.float(2).multiply(a.float(1).subtract(h.getFilterBit(b,1)))):this.outside?d=d.add(a.float(2).multiply(h.getFilterBit(b,1))):this.highlight&&(d=d.add(a.float(2).multiply(a.float(1).subtract(this._checkHighlight(b)))));
null!=c&&(b=(new a.Float(1)).subtract(a.step(c.x,this.view.currentZoom)),c=a.step(c.y,this.view.currentZoom),d=d.add((new a.Float(2)).multiply(b.add(c))));return d}getFragmentOutput(b,c,d=new a.Float(1/255)){const n=new e.FragmentOutput;n.glFragColor=this._maybeWriteHittest(c)??this._maybeHighlight(b,d)??b;return n}_maybeHighlight(b,c){return this.highlight?new a.Vec4(b.rgb,a.step(c,b.a)):null}_checkHighlight(b){let c=this._checkHighlightBit(b,0);for(let d=1;d<p.highlightReasons.length;d++)c=c.add(this._checkHighlightBit(b,
d));return a.step(new a.Float(.1),c.add(this.highlight.highlightAll))}_checkHighlightBit(b,c){return h.getHighlightBit(b,c).multiply(h.getBit(this.highlight.activeReasons,c))}maybeRunHittest(b,c,d){if(null==this.hittestRequest)return null;c=this.hittest(b,c,d);c=a.ifElse(a.greaterThan(c,this.hittestRequest.distance),new a.Float(2),new a.Float(0));d=this.storage.getAttributeDataCoords(b.id);d=h.uvToClip(d);c=c.add(this.clip(b.id,b.zoomRange));b=new a.Vec4(new a.Float(1/255),0,0,0);return{glPointSize:new a.Float(1),
glPosition:new a.Vec4(d,c,1),color:b}}_maybeWriteHittest(b){return null!=this.hittestRequest?b.color:null}}f.__decorate([e.define],g.prototype,"inside",void 0);f.__decorate([e.define],g.prototype,"outside",void 0);f.__decorate([e.option(r.ShaderHighlight)],g.prototype,"highlight",void 0);f.__decorate([e.uniform(q.EntityStorage)],g.prototype,"storage",void 0);f.__decorate([e.uniform(u.ViewInfo)],g.prototype,"view",void 0);f.__decorate([e.option(t.ShaderHittest)],g.prototype,"hittestRequest",void 0);
k.AFeatureShader=g;k.BaseHittestVertexInput=m;k.FeatureFragmentInput=v;k.FeatureVertexInput=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});