// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/has","../definitions","./Effect","../../../../webgl/enums"],function(h,m,e,n,k){class p extends n.Effect{constructor(){super(...arguments);this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:a},b){if(!b.length)return null;var c=b.shift();b=c.x;const g=c.y;this._outstanding=c;c=m("esri-mobile");return{type:"hittest",distance:(c?e.hittestToleranceMobile:e.hittestToleranceDesktop)*a,smallSymbolDistance:(c?
e.hittestToleranceMobile:e.hittestToleranceSmallSymbol)*a,smallSymbolSizeThreshold:e.hittestSmallSymbolThreshold,position:[b,g]}}bind(a){const {context:b,attributeView:c}=a;c.size&&(a=c.getBlock(e.AttributeDataType.GPGPU),null!=a&&(a=a.getFBO(b),b.setViewport(0,0,c.size,c.size),b.bindFramebuffer(a),b.setColorMask(!0,!0,!0,!0),b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT)))}unbind(){}draw(a){if(null!=this._outstanding){var b=this._outstanding;this._outstanding=null;
this._resolve(a,b.resolvers)}}async _resolve(a,b){const {context:c,attributeView:g}=a;a=g.getBlock(e.AttributeDataType.GPGPU);if(null==a)b.forEach(f=>f.resolve([]));else{var d=a.getFBO(c);a=new Uint8Array(d.width*d.height*4);try{await d.readPixelsAsync(0,0,d.width,d.height,k.PixelFormat.RGBA,k.PixelType.UNSIGNED_BYTE,a)}catch(f){b.forEach(q=>q.resolve([]));return}var l=[];for(d=0;d<a.length;d+=4){const f=d/4;a[d]&&l.push(f)}b.forEach(f=>f.resolve(l))}}}h.HittestEffect=p;Object.defineProperty(h,Symbol.toStringTag,
{value:"Module"})});