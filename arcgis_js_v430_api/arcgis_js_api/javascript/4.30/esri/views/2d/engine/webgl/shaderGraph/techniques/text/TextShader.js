// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(y,d,z,e,a,A,u,E,H,F,I,J,K,L,M,N,O,B){const P=360/254;class n extends A.FeatureVertexInput{}d.__decorate([e.location(3,a.Vec4)],n.prototype,"color",void 0);d.__decorate([e.location(4,a.Vec2)],n.prototype,"offset",void 0);d.__decorate([e.location(5,a.Vec2)],n.prototype,"textureUV",void 0);d.__decorate([e.location(6,a.Float)],n.prototype,"fontSize",void 0);d.__decorate([e.location(7,a.Float)],n.prototype,"referenceSize",void 0);d.__decorate([e.location(8,a.Float)],n.prototype,"haloFontSize",
void 0);d.__decorate([e.location(9,a.Vec4)],n.prototype,"haloColor",void 0);d.__decorate([e.location(10,a.Vec2)],n.prototype,"zoomRange",void 0);d.__decorate([e.location(11,a.Float)],n.prototype,"clipAngle",void 0);d.__decorate([e.location(12,a.Vec4)],n.prototype,"referenceSymbol",void 0);class C extends e.ComputeVertexInput{}d.__decorate([e.location(13,a.Vec2)],C.prototype,"offsetNextVertex1",void 0);d.__decorate([e.location(14,a.Vec2)],C.prototype,"offsetNextVertex2",void 0);class G extends A.FeatureFragmentInput{}
class h extends A.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]};this.isLabel=this.isBackgroundPass=this.isHaloPass=!1}clipLabel(b,c,f){c=c.multiply(P);c=a.abs(this.view.rotation.subtract(c));var g=a.min((new a.Float(360)).subtract(c),c);c=new a.Float(0);const m=a.floor(this.view.currentZoom.multiply(z.minMaxZoomPrecisionFactor)).divide(z.minMaxZoomPrecisionFactor);var q=b.x;b=b.y;q=(new a.Float(1)).subtract(a.step(q,m)).multiply(2);
g=a.step(new a.Float(90),g).multiply(2);b=(new a.Float(2)).multiply((new a.Float(1)).subtract(a.step(m,b)));c=c.add(f.multiply(q));c=c.add(f.multiply(g));return c=c.add(b)}vertex(b,c){var f=F.getBit(b.bitset,u.bitsetTextIsBackground),g=(new a.Float(1)).subtract(f),m=b.fontSize;let q=m.divide(u.sdfFontSize);var r=this.isHaloPass?b.haloColor:this._getVertexColor(b),p=this.isLabel?this.storage.getAnimationValue(b.id):new a.Float(1);r=this.isLabel?r.multiply(p):r;var t=this.view.displayViewScreenMat3.multiply(new a.Vec3(b.pos,
1)),k=b.offset;let v=new a.Float(1),D=a.Mat3.identity();var w=new a.Vec2(0);if(this.isLabel){if(!b.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");var x=b.referenceSymbol;w=x.xy;var l=x.z;x=this._unpackDirection(x.w);l=B.getVisualVariableSize(this,b.id,l).divide(2);l=x.multiply(l.add(z.labelPlacementOffsetPadding));w=w.add(l);k=k.add(w)}else v=B.getVisualVariableSize(this,b.id,b.referenceSize).divide(b.referenceSize),m=m.multiply(v),q=q.multiply(v),
k=k.multiply(v),D=B.getVisualVariableRotation(this,b.id),k=D.multiply(new a.Vec3(k,0)).xy;l=F.getBit(b.bitset,u.bitsetTextIsMapAligned);k=this._getViewRotationMatrix(l).multiply(new a.Vec3(k,0));l=this.isLabel?this.clipLabel(b.zoomRange,b.clipAngle,l):this.clip(b.id,b.zoomRange);l=this.isBackgroundPass?l.add(g.multiply(2)):l.add(f.multiply(2));f=this.isLabel?a.or(a.greaterThan(l,new a.Float(1)),a.equal(p,new a.Float(0))):new a.Bool(!1);g=new a.Vec4(t.xy.add(k.xy),l,1);p=b.textureUV.divide(this.mosaicInfo.size);
t=new a.Float(0);this.isHaloPass&&(t=b.haloFontSize.divide(q).divide(u.maxSdfDistance));m=(new a.Float(.105*u.sdfFontSize)).divide(m).divide(this.view.pixelRatio);return{glPosition:g,color:r,size:q,textureUV:p,antialiasingWidth:m,haloDistanceOffset:t,...this.maybeRunHittest(b,c,{vvSizeAdjustment:v,vvRotation:D,labelOffset:w,labelClipped:f})}}_getViewRotationMatrix(b){const c=this.view.displayViewMat3,f=this.view.displayMat3,g=(new a.Float(1)).subtract(b);return c.multiply(b).add(f.multiply(g))}fragment(b){var c=
new a.Float(.25),f=(new a.Float(1)).subtract(c);c=a.texture2D(this.mosaicInfo.texture,b.textureUV).a;f=f.subtract(b.haloDistanceOffset);this.highlight&&(f=f.divide(2));const g=b.antialiasingWidth;c=a.smoothstep(f.subtract(g),f.add(g),c);return this.getFragmentOutput(b.color.multiply(c),b)}hittest(b,c,{vvSizeAdjustment:f,vvRotation:g,labelOffset:m,labelClipped:q}){if(this.isLabel){var r=new a.Vec3(b.offset.add(m),0);var p=new a.Vec3(c.offsetNextVertex1.add(m),0);c=new a.Vec3(c.offsetNextVertex2.add(m),
0)}else r=g.multiply(new a.Vec3(b.offset.multiply(f),0)),p=g.multiply(new a.Vec3(c.offsetNextVertex1.multiply(f),0)),c=g.multiply(new a.Vec3(c.offsetNextVertex2.multiply(f),0));const {viewMat3:t,tileMat3:k}=this.view;b=t.multiply(k).multiply(new a.Vec3(b.pos,1));r=b.add(k.multiply(r)).xy;p=b.add(k.multiply(p)).xy;b=b.add(k.multiply(c)).xy;p=E.distPointTriangle(this.hittestRequest.position,r.xy,p.xy,b.xy);return this.isLabel?a.ifElse(q,E.failHittest(this.hittestRequest),p):p}_unpackDirection(b){var c=
new a.Int(b);b=a.bitRShift(c,new a.Int(2));c=a.bitAnd(c,new a.Int(3));return new a.Vec2((new a.Float(b)).subtract(1),(new a.Float(c)).subtract(1))}_getVertexColor(b){var c=b.color;this.visualVariableColor&&(c=this.storage.getColorValue(b.id),c=this.visualVariableColor.getColor(c,b.color,new a.Bool(!1)));this.visualVariableOpacity&&(b=this.storage.getOpacityValue(b.id),b=this.visualVariableOpacity.getOpacity(b),c=c.multiply(b));return c}}d.__decorate([e.option(I.VisualVariableColor)],h.prototype,"visualVariableColor",
void 0);d.__decorate([e.option(J.VisualVariableOpacity)],h.prototype,"visualVariableOpacity",void 0);d.__decorate([e.option(K.VisualVariableRotation)],h.prototype,"visualVariableRotation",void 0);d.__decorate([e.option(L.VisualVariableSizeMinMaxValue)],h.prototype,"visualVariableSizeMinMaxValue",void 0);d.__decorate([e.option(M.VisualVariableSizeScaleStops)],h.prototype,"visualVariableSizeScaleStops",void 0);d.__decorate([e.option(N.VisualVariableSizeStops)],h.prototype,"visualVariableSizeStops",
void 0);d.__decorate([e.option(O.VisualVariableSizeUnitValue)],h.prototype,"visualVariableSizeUnitValue",void 0);d.__decorate([e.uniform(H.MosaicInfo)],h.prototype,"mosaicInfo",void 0);d.__decorate([e.define],h.prototype,"isHaloPass",void 0);d.__decorate([e.define],h.prototype,"isBackgroundPass",void 0);d.__decorate([e.define],h.prototype,"isLabel",void 0);d.__decorate([d.__param(0,e.input(n)),d.__param(1,e.input(C))],h.prototype,"vertex",null);d.__decorate([d.__param(0,e.input(G))],h.prototype,"fragment",
null);y.TextFragmentInput=G;y.TextShader=h;y.TextVertexInput=n;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});