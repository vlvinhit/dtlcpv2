// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["../../../../../../core/string","./TechniqueInstance","./mesh/instanceIdUtils"],function(h,e,f){class k{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw Error("InternalError: Found updateEnd call without corresponding updateStart");for(var a of this._instanceById.keys())this._instanceByIdNext.has(a)||
this._instanceById.delete(a);for(const [c,b]of this._instanceByIdNext.entries())(a=this._instanceById.get(c))?a.setInput(b.getInput()):this._instanceById.set(c,b);this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(a,c){if("object"===typeof c&&"optionalAttributes"in c&&"uniforms"in c){var b=`${a.type}${JSON.stringify(c.optionalAttributes)}`;const d=c.uniforms;if("object"===typeof d)for(const g in d)b+=`${g}.${null!=d[g]}`}else b=`${a.type}.${JSON.stringify(c)}`;
b=h.numericHash(b);if(this._instanceByIdNext)return a=new e.FeatureTechniqueInstance(f.castInstanceId(b),a,c),this._instanceByIdNext.set(b,a),a;this._instanceById.has(b)||(a=new e.FeatureTechniqueInstance(f.castInstanceId(b),a,c),this._instanceById.set(b,a));return this._instanceById.get(b)}getInstance(a){return this._instanceById.get(a)}}return k});