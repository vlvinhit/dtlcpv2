// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../3d/webgl-engine/core/shaderTechnique/BindType ../../../../3d/webgl-engine/lib/Util".split(" "),function(k,u,B,v,n,w){function x(a=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${a?"out vec4 fragColor;":""}\n`}class p{constructor(){this._includedModules=new Map}include(a,
c){this._includedModules.has(a)?this._includedModules.get(a):(this._includedModules.set(a,c),a(this.builder,c))}}class y extends p{constructor(){super(...arguments);this.vertex=new q;this.fragment=new q;this.attributes=new z;this.varyings=new A;this.extensions=new l;this.constants=new d}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(a,c=!0){const b=this.extensions.generateSource(a),f=this.attributes.generateSource(a),g=this.varyings.generateSource(a);
var e="vertex"===a?this.vertex:this.fragment;const h=e.uniforms.generateSource(),m=e.code.generateSource();a="vertex"===a?"precision highp float;\nprecision highp sampler2D;":x(c);e=this.constants.generateSource().concat(e.constants.generateSource());return`${c?"#version 300 es":""}\n${b.join("\n")}\n${a}\n${e.join("\n")}\n${h.join("\n")}\n${f.join("\n")}\n${g.join("\n")}\n${m.join("\n")}`}generateBindPass(a){const c=new Map;this.vertex.uniforms.entries.forEach(g=>{const e=g.bind[n.BindType.Pass];
e&&c.set(g.name,e)});this.fragment.uniforms.entries.forEach(g=>{const e=g.bind[n.BindType.Pass];e&&c.set(g.name,e)});const b=Array.from(c.values()),f=b.length;return(g,e)=>{for(let h=0;h<f;++h)b[h](a,g,e)}}generateBindDraw(a){const c=new Map;this.vertex.uniforms.entries.forEach(g=>{const e=g.bind[n.BindType.Draw];e&&c.set(g.name,e)});this.fragment.uniforms.entries.forEach(g=>{const e=g.bind[n.BindType.Draw];e&&c.set(g.name,e)});const b=Array.from(c.values()),f=b.length;return(g,e,h)=>{for(let m=0;m<
f;++m)b[m](a,g,e,h)}}}class r{constructor(){this._entries=new Map}add(...a){for(const c of a)this._add(c)}get(a){return this._entries.get(a)}_add(a){if(null==a)v.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(a.name)&&!this._entries.get(a.name).equals(a))throw new u(`Duplicate uniform name ${a.name} for different uniform type`);this._entries.set(a.name,a)}}generateSource(){return Array.from(this._entries.values()).map(a=>
null!=a.arraySize?`uniform ${a.type} ${a.name}[${a.arraySize}];`:`uniform ${a.type} ${a.name};`)}get entries(){return Array.from(this._entries.values())}}class t{constructor(){this._entries=[]}add(a){this._entries.push(a)}generateSource(){return this._entries}}class q extends p{constructor(){super(...arguments);this.uniforms=new r;this.code=new t;this.constants=new d}get builder(){return this}}class z{constructor(){this._entries=[]}add(a,c){this._entries.push([a,c])}generateSource(a){return"fragment"===
a?[]:this._entries.map(c=>`in ${c[1]} ${c[0]};`)}}class A{constructor(){this._entries=new Map}add(a,c){this._entries.has(a)&&w.assert(this._entries.get(a)===c);this._entries.set(a,c)}generateSource(a){const c=[];this._entries.forEach((b,f)=>c.push("vertex"===a?`out ${b} ${f};`:`in ${b} ${f};`));return c}}class l{constructor(){this._entries=new Set}add(a){this._entries.add(a)}generateSource(a){const c="vertex"===a?l.ALLOWLIST_VERTEX:l.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(b=>c.includes(b)).map(b=>
`#extension ${b} : enable`)}}l.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];l.ALLOWLIST_VERTEX=[];class d{constructor(){this._entries=new Set}add(a,c,b){let f="ERROR_CONSTRUCTOR_STRING";switch(c){case "float":f=d._numberToFloatStr(b);break;case "int":f=d._numberToIntStr(b);break;case "bool":f=b.toString();break;case "vec2":f=`vec2(${d._numberToFloatStr(b[0])},                            ${d._numberToFloatStr(b[1])})`;break;case "vec3":f=`vec3(${d._numberToFloatStr(b[0])},                            ${d._numberToFloatStr(b[1])},                            ${d._numberToFloatStr(b[2])})`;
break;case "vec4":f=`vec4(${d._numberToFloatStr(b[0])},                            ${d._numberToFloatStr(b[1])},                            ${d._numberToFloatStr(b[2])},                            ${d._numberToFloatStr(b[3])})`;break;case "ivec2":f=`ivec2(${d._numberToIntStr(b[0])},                             ${d._numberToIntStr(b[1])})`;break;case "ivec3":f=`ivec3(${d._numberToIntStr(b[0])},                             ${d._numberToIntStr(b[1])},                             ${d._numberToIntStr(b[2])})`;
break;case "ivec4":f=`ivec4(${d._numberToIntStr(b[0])},                             ${d._numberToIntStr(b[1])},                             ${d._numberToIntStr(b[2])},                             ${d._numberToIntStr(b[3])})`;break;case "mat2":case "mat3":case "mat4":f=`${c}(${Array.prototype.map.call(b,g=>d._numberToFloatStr(g)).join(", ")})`}this._entries.add(`const ${c} ${a} = ${f};`);return this}static _numberToIntStr(a){return a.toFixed(0)}static _numberToFloatStr(a){return Number.isInteger(a)?
a.toFixed(1):a.toString()}generateSource(){return Array.from(this._entries)}}k.Code=t;k.Includes=p;k.ShaderBuilder2D=y;k.Stage=q;k.Uniforms=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});