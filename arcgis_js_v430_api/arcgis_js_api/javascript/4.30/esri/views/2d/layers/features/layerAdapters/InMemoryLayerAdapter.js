// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/Error ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(l,n,m,p,f,q,r,t){class u{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const a=this.layer;b=f.getFeatureReductionDeconflictionEnabled(a,b)??f.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:f.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){const a=
this.layer,{capabilities:c,objectIdField:d}=a,e=a.fieldsIndex.toJSON(),g=p.getEffectiveGeometryType(a),h=a.timeInfo?.toJSON(),k=a.spatialReference.toJSON();if(!("openPorts"in a.source))throw new n("source-not-supported");return{type:"memory",source:await a.source.openPorts(),orderByFields:d,outSpatialReference:b.spatialReference.toJSON(),metadata:{fieldsIndex:e,geometryType:g,objectIdField:d,timeInfo:h,spatialReference:k,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,
timeReferenceUnknownClient:null},queryMetadata:{maxRecordCount:c.query.maxRecordCount,supportsCompactGeometry:c.query.supportsCompactGeometry,supportsDefaultSpatialReference:c.query.supportsDefaultSpatialReference,supportsFormatPBF:c.query.supportsFormatPBF,supportsMaxRecordCountFactor:c.query.supportsMaxRecordCountFactor,supportsQuantization:c.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(b,a){const {definitionExpression:c,timeExtent:d}=this.layer;return q.createFeatureSourceSchema({definitionExpression:c,
timeExtent:d,customParameters:null},b,a,null)}createProcessorSchema(b,a,c){const {fields:d,renderer:e,geometryType:g,labelingInfo:h,labelsVisible:k,orderBy:v,objectIdField:w}=this.layer,y={fields:d.map(x=>x.toJSON()),renderer:e?.clone(),featureReduction:m.getEffectiveFeatureReduction(this.layer,a),geometryType:g,labelingInfo:h,labelsVisible:k,objectIdField:w,orderBy:v??"default"};return r.createSimpleProcessorSchema(b,a,y,c)}get hasRequiredSupport(){return t.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(b){const a=
this.layer,{definitionExpression:c,renderer:d}=a,e=this.layer.labelsVisible?this.layer.labelingInfo:null;b=m.getEffectiveFeatureReduction(a,b);return{orderBy:JSON.stringify(a.orderBy),definitionExpression:c,renderer:d,labelingInfo:e,featureReduction:b}}}l.InMemoryLayerAdapter=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});