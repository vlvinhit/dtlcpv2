// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(w,q,z,A,x,B,r,C,t,D,E,F){class G{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const a=this.layer;b=t.getFeatureReductionDeconflictionEnabled(a,b)??t.getLayerDeconflictionEnabled(a);
return[{vvEvaluators:{0:t.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){var a=this.layer;const {capabilities:c,editingInfo:e,objectIdField:f,typeIdField:g,globalIdField:h,datesInUnknownTimezone:k,orderBy:d,subtypeField:l,refreshInterval:n}=a,p=a.fieldsIndex.toJSON(),H=p.fields,I=C.getEffectiveGeometryType(a),J=a.timeInfo?.toJSON(),K=a.spatialReference.toJSON(),L=a.types?.map(u=>u.toJSON()),v=z.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(v.query=
{layer:JSON.stringify({source:this.layer.dynamicDataSource})});let y=this.layer.objectIdField;if(d?.length){var m=!d[0].valueExpression&&d[0].field;m&&(y=m)}m=null==e?.lastEditDate&&0<n;a=(m=q("featurelayer-snapshot-enabled")&&"point"===a.geometryType&&c?.query.supportsPagination&&!c?.operations.supportsEditing&&!m)&&B.exceedsMinimumSnapshotCoverage(b,a.fullExtent);const M=A.isHostedAgolService(v.path);return{type:"feature-service",source:v,isSourceHosted:M,orderByFields:y,outSpatialReference:b.spatialReference.toJSON(),
metadata:{typeIdField:g??void 0,types:L,timeReferenceUnknownClient:k,subtypeField:l,globalIdField:h,fields:H,fieldsIndex:p,geometryType:I,objectIdField:f,timeInfo:J,spatialReference:K,subtypes:this.layer.subtypes?.map(u=>u.toJSON())},queryMetadata:{maxRecordCount:c.query.maxRecordCount,supportsCompactGeometry:c.query.supportsCompactGeometry,supportsDefaultSpatialReference:c.query.supportsDefaultSpatialReference,supportsFormatPBF:c.query.supportsFormatPBF,supportsMaxRecordCountFactor:c.query.supportsMaxRecordCountFactor,
supportsQuantization:c.query.supportsQuantization,lastEditDate:e?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:m,supportsSnapshotMaxThreshold:a,snapshotCountThresholds:{min:q("featurelayer-snapshot-point-min-threshold"),max:q("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(b,a){const {definitionExpression:c,customParameters:e,gdbVersion:f,historicMoment:g,subtypeCode:h,subtypeField:k,timeExtent:d,apiKey:l}=this.layer;return D.createFeatureSourceSchema({definitionExpression:c,
customParameters:e,gdbVersion:f,historicMoment:g,subtypeCode:h,subtypeField:k,timeExtent:d},b,a,l)}createProcessorSchema(b,a,c){const {fields:e,renderer:f,geometryType:g,labelingInfo:h,labelsVisible:k,orderBy:d,objectIdField:l}=this.layer,n={fields:e.map(p=>p.toJSON()),renderer:f?.clone(),featureReduction:x.getEffectiveFeatureReduction(this.layer,a),geometryType:g,labelingInfo:h,labelsVisible:k,objectIdField:l,orderBy:d??"default"};return E.createSimpleProcessorSchema(b,a,n,c)}get hasRequiredSupport(){return F.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(b){return r.hasFloorFilter(this.layer,
b)}addFilters(b,a){return r.addFloorFilter(this.layer,b,a)}getUpdateHashProperties(b){var a=this.layer;const {definitionExpression:c,renderer:e,gdbVersion:f,apiKey:g,subtypeCode:h}=a,k=this.layer.labelsVisible?this.layer.labelingInfo:null,d=a.historicMoment?.getTime()??void 0,l=JSON.stringify(a.customParameters),n=x.getEffectiveFeatureReduction(a,b);a=JSON.stringify(a.orderBy);b=r.hasFloorFilter(this.layer,b)?b.floors:null;return{outFields:this.layer.outFields,apiKey:g,customParameters:l,definitionExpression:c,
featureReduction:n,floors:b,gdbVersion:f,historicMoment:d,labelingInfo:k,orderBy:a,renderer:e,subtypeCode:h}}}w.FeatureLayerAdapter=G;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});