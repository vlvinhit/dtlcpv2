// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/screenUtils":function(){define(["exports"],function(a){function q(g){return g?72*g/96:0}const r=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;a.castRenderScreenPointArray=function(g){return g};a.castRenderScreenPointArray3=function(g){return g};a.castScreenPointArray=function(g){return g};a.createRenderScreenPoint=function(g=0,p=0){return{x:g,y:p}};a.createRenderScreenPointArray=function(g=0,p=0){return[g,p]};a.createRenderScreenPointArray3=function(g=0,p=0,m=0){return[g,p,m]};a.createScreenPoint=
function(g=0,p=0){return{x:g,y:p}};a.createScreenPointArray=function(g=0,p=0){return[g,p]};a.pt2px=function(g){return g?g/72*96:0};a.px2pt=q;a.screenPointArrayToObject=function(g,p){return p?(p.x=g[0],p.y=g[1],p):{x:g[0],y:g[1]}};a.screenPointObjectToArray=function(g,p){return p?(p[0]=g.x,p[1]=g.y,2<p.length&&(p[2]=0),p):[g.x,g.y]};a.toPt=function(g){if("string"===typeof g){var p=g.match(r);if(p){var m=Number(p[1]);p=p[3]&&p[3].toLowerCase();g="-"===g.charAt(0);m="px"===p?q(m):m;return g?-m:m}console.warn("screenUtils.toPt: input not recognized!");
return null}return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x){var y;q=new q.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});r=y=class extends r.JSONSupport{static create(A={}){const {resolutionFactor:k=1,scales:v,size:B=256,spatialReference:z=w.WebMercator,numLODs:E=24}=A;if(!l.isValid(z)){A=[];if(v)for(var K=0;K<v.length;K++){var I=
v[K];A.push(new u({level:K,scale:I,resolution:I}))}else for(K=5E-4,I=E-1;0<=I;I--)A.unshift(new u({level:I,scale:K,resolution:K})),K*=2;return new y({dpi:96,lods:A,origin:new d(0,0,z),size:[B,B],spatialReference:z})}K=l.getInfo(z);A=A.origin?new d({x:A.origin.x,y:A.origin.y,spatialReference:z}):K?new d({x:K.origin[0],y:K.origin[1],spatialReference:z}):new d({x:0,y:0,spatialReference:z});K=1/(39.37*g.getMetersPerUnitForSR(z)*96);I=[];if(v)for(var D=0;D<v.length;D++){var G=v[D];I.push(new u({level:D,
scale:G,resolution:G*K}))}else{var C=l.isGeographic(z)?512/B*5.916575275917094E8:256/B*5.91657527591555E8;D=Math.ceil(E/k);I.push(new u({level:0,scale:C,resolution:C*K}));for(G=1;G<D;G++)C/=2**k,I.push(new u({level:G,scale:C,resolution:C*K}))}return new y({dpi:96,lods:I,origin:A,size:[B,B],spatialReference:z})}constructor(A){super(A);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:A,origin:k}=this;if(A&&k){const v=l.getInfo(A);return A.isWrappable&&
!!v&&Math.abs(v.origin[0]-k.x)<=v.dx}return!1}readOrigin(A,k){return d.fromJSON({spatialReference:k.spatialReference,...A})}set lods(A){const k=[],v=this._levelToLOD={};A&&A.forEach(B=>{k.push(B.scale);v[B.level]=B});this._set("scales",k);this._set("lods",A);this._initializeUpsampleLevels()}readSize(A,k){return[k.cols,k.rows]}writeSize(A,k){k.cols=A[0];k.rows=A[1]}zoomToScale(A){const k=this.scales;if(0>=A)return k[0];if(A>=k.length-1)return k[k.length-1];const v=Math.floor(A);return k[v]/(k[v]/k[v+
1])**(A-v)}scaleToZoom(A){const k=this.scales,v=k.length-1;let B=0;for(;B<v;B++){const z=k[B],E=k[B+1];if(z<=A)break;if(E===A)return B+1;if(z>A&&E<A)return B+Math.log(z/A)/Math.log(z/E)}return B}tileAt(A,k,v,B){var z=this.lodAt(A);if(!z)return null;let E;if("number"===typeof k)E=k,k=v;else{if(l.equals(k.spatialReference,this.spatialReference))E=k.x,k=k.y;else{B=e.project(k,this.spatialReference);if(null==B)return null;E=B.x;k=B.y}B=v}v=z.resolution*this.size[0];z=z.resolution*this.size[1];B||=new x.TileKey(null,
0,0,0,t.create());B.level=A;B.row=Math.floor((this.origin.y-k)/z+.001);B.col=Math.floor((E-this.origin.x)/v+.001);this.updateTileInfo(B);return B}updateTileInfo(A,k=y.ExtrapolateOptions.NONE){var v=this.lodAt(A.level);v||k!==y.ExtrapolateOptions.POWER_OF_TWO||(k=this.lods[this.lods.length-1],k.level<A.level&&(v=k));if(v){var B=A.level-v.level;k=v.resolution*this.size[0]/2**B;v=v.resolution*this.size[1]/2**B;A.id=`${A.level}/${A.row}/${A.col}`;A.extent||(A.extent=t.create());A.extent[0]=this.origin.x+
A.col*k;A.extent[1]=this.origin.y-(A.row+1)*v;A.extent[2]=A.extent[0]+k;A.extent[3]=A.extent[1]+v}}upsampleTile(A){const k=this._upsampleLevels[A.level];if(!k||-1===k.parentLevel)return!1;A.level=k.parentLevel;A.row=Math.floor(A.row/k.factor+.001);A.col=Math.floor(A.col/k.factor+.001);this.updateTileInfo(A);return!0}getTileBounds(A,k){var v=this.lodAt(k.level);if(null==v)return null;var {resolution:B}=v;v=B*this.size[0];B*=this.size[1];A[0]=this.origin.x+k.col*v;A[1]=this.origin.y-(k.row+1)*B;A[2]=
A[0]+v;A[3]=A[1]+B;return A}lodAt(A){return this._levelToLOD?.[A]??null}clone(){return y.fromJSON(this.write({}))}getCompatibleForVTL(A){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===A)return null;const k=(512===this.size[0]&&256===A?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===A&&0===k)return this;const v=[],B=this.lods.length-k;for(let z=0;z<B;z++){const E=z+k,{scale:K,resolution:I}=0<=E?this.lods[E]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};
v.push(new u({level:z,scale:K,resolution:I}))}return new y({size:[A,A],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:v})}_initializeUpsampleLevels(){const A=this.lods;this._upsampleLevels=[];let k=null;for(let v=0;v<A.length;v++){const B=A[v];this._upsampleLevels[B.level]={parentLevel:k?k.level:-1,factor:k?k.resolution/B.resolution:0};k=B}}};a.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,
"compressionQuality",void 0);a.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"dpi",void 0);a.__decorate([p.property({type:String,json:{read:q.read,write:q.write,origins:{"web-scene":{read:!1,write:!1}}}})],r.prototype,"format",void 0);a.__decorate([p.property({readOnly:!0})],r.prototype,"isWrappable",null);a.__decorate([p.property({type:d,json:{write:!0}})],r.prototype,"origin",void 0);a.__decorate([c.reader("origin")],r.prototype,"readOrigin",null);a.__decorate([p.property({type:[u],
value:null,json:{write:!0}})],r.prototype,"lods",null);a.__decorate([p.property({readOnly:!0})],r.prototype,"scales",void 0);a.__decorate([p.property({cast:A=>Array.isArray(A)?A:"number"===typeof A?[A,A]:[256,256]})],r.prototype,"size",void 0);a.__decorate([c.reader("size",["rows","cols"])],r.prototype,"readSize",null);a.__decorate([n.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],r.prototype,"writeSize",null);a.__decorate([p.property({type:w,json:{write:!0}})],r.prototype,"spatialReference",
void 0);r=y=a.__decorate([h.subclass("esri.layers.support.TileInfo")],r);(function(A){A=A.ExtrapolateOptions||(A.ExtrapolateOptions={});A[A.NONE=0]="NONE";A[A.POWER_OF_TWO=1]="POWER_OF_TWO"})(r||={});return r})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,
m,b){var f;q=f=class extends q.JSONSupport{constructor(c){super(c);this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new f({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"cols",void 0);a.__decorate([r.property({type:g.Integer,
json:{write:!0}})],q.prototype,"level",void 0);a.__decorate([r.property({type:String,json:{write:!0}})],q.prototype,"levelValue",void 0);a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"origin",void 0);a.__decorate([r.property({type:Number,json:{write:!0}})],q.prototype,"resolution",void 0);a.__decorate([r.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,
"rows",void 0);a.__decorate([r.property({type:Number,json:{write:!0}})],q.prototype,"scale",void 0);return q=f=a.__decorate([b.subclass("esri.layers.support.LOD")],q)})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class q{constructor(r,g,p,m,b){this.id=r;this.level=g;this.row=p;this.col=m;this.extent=b}}a.TileKey=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils",
"./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,q,r,g,p){const m=new g("0/0/0/0");class b{static create(h,n){h[1]>n[1]&&([h,n]=[n,h]);const [d,w]=h,[t,l]=n;h=t-d;n=l-w;n=0!==n?h/n:0;const e=(Math.ceil(w)-w)*n,u=(Math.floor(w)-w)*n;return new b(d,Math.floor(w),Math.ceil(l),n,0>h?e:u,0>h?u:e,0>h?t:d,0>h?d:t)}constructor(h,n,d,w,t,l,e,u){this.x=h;this.ymin=n;this.ymax=d;this.invM=w;this.leftAdjust=t;this.rightAdjust=l;this.leftBound=e;this.rightBound=u}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+
this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const f=[[0,0],[0,0],[0,0],[0,0]];class c{constructor(h,n=null,d=h.lods[0].level,w=h.lods[h.lods.length-1].level){this.tileInfo=h;this.fullExtent=n;this.scales=[];this._infoByScale={};this._infoByLevel={};const t=h.lods.filter(e=>e.level>=d&&e.level<=w);this.minScale=t[0].scale;this.maxScale=t[t.length-1].scale;const l=this._lodInfos=t.map(e=>q.create(h,e,n));t.forEach((e,u)=>{this._infoByLevel[e.level]=
l[u];this._infoByScale[e.scale]=l[u];this.scales[u]=e.scale},this);this._wrap=h.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(h){return this._infoByLevel["number"===typeof h?h:h.level]}getTileBounds(h,n,d=!1){m.set(n);return(n=this._infoByLevel[m.level])?n.getTileBounds(h,m,d):h}getTileCoords(h,n,d=!1){m.set(n);return(n=this._infoByLevel[m.level])?n.getTileCoords(h,m,d):h}getTileCoverage(h,n=192,d=!0,w="closest"){if(!d&&(h.scale>this.minScale||h.scale<this.maxScale))return null;
d="closest"===w?this.getClosestInfoForScale(h.scale):this.getSmallestInfoForScale(h.scale);w=r.pool.acquire(d);const t=this._wrap;var l=Infinity;let e=-Infinity;const u=w.spans;f[0][0]=f[0][1]=f[1][1]=f[3][0]=-n;f[1][0]=f[2][0]=h.size[0]+n;f[2][1]=f[3][1]=h.size[1]+n;for(x of f)h.toMap(x,x),x[0]=d.getColumnForX(x[0]),x[1]=d.getRowForY(x[1]);h=[];var x=3;for(n=0;4>n;n++)f[n][1]===f[x][1]?x=n:(x=b.create(f[n],f[x]),l=Math.min(x.ymin,l),e=Math.max(x.ymax,e),void 0===h[x.ymin]&&(h[x.ymin]=[]),h[x.ymin].push(x),
x=n);if(null==l||null==e||100<e-l)return null;for(n=[];l<e;){null!=h[l]&&(n=n.concat(h[l]));x=Infinity;var y=-Infinity;for(var A=n.length-1;0<=A;A--){var k=n[A];x=Math.min(x,k.getLeftCol());y=Math.max(y,k.getRightCol())}x=Math.floor(x);y=Math.floor(y);if(l>=d.first[1]&&l<=d.last[1])if(t)if(d.size[0]<d.worldSize[0])for(A=Math.floor(y/d.worldSize[0]),k=Math.floor(x/d.worldSize[0]);k<=A;k++)u.push(new p(l,Math.max(d.getFirstColumnForWorld(k),x),Math.min(d.getLastColumnForWorld(k),y)));else u.push(new p(l,
x,y));else x>d.last[0]||y<d.first[0]||(x=Math.max(x,d.first[0]),y=Math.min(y,d.last[0]),u.push(new p(l,x,y)));l+=1;for(x=n.length-1;0<=x;x--)y=n[x],y.ymax>=l?y.incrRow():n.splice(x,1)}return w}getTileParentId(h){m.set(h);h=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>h)return null;this._getTileIdAtLOD(m,this._lodInfos[h],m);return m.id}getTileResolution(h){return(h=this._infoByLevel["object"===typeof h?h.level:h])?h.resolution:-1}getTileScale(h){return(h=this._infoByLevel[h.level])?h.scale:
-1}intersects(h,n){m.set(n);n=this._infoByLevel[m.level];const d=h.lodInfo;if(d.resolution>n.resolution){this._getTileIdAtLOD(m,d,m);var w=d.denormalizeCol(m.col,m.world);for(var t of h.spans)if(t.row===m.row&&t.colFrom<=w&&t.colTo>=w)return!0}if(d.resolution<n.resolution){const [e,u,x,y]=h.spans.reduce((A,k)=>{A[0]=Math.min(A[0],k.row);A[1]=Math.max(A[1],k.row);A[2]=Math.min(A[2],k.colFrom);A[3]=Math.max(A[3],k.colTo);return A},[Infinity,-Infinity,Infinity,-Infinity]);w=n.denormalizeCol(m.col,m.world);
h=d.getColumnForX(n.getXForColumn(w));t=d.getRowForY(n.getYForRow(m.row));w=d.getColumnForX(n.getXForColumn(w+1))-1;n=d.getRowForY(n.getYForRow(m.row+1))-1;return!(h>y||w<x||t>u||n<e)}const l=d.denormalizeCol(m.col,m.world);return h.spans.some(e=>e.row===m.row&&e.colFrom<=l&&e.colTo>=l)}normalizeBounds(h,n,d){h[0]=n[0];h[1]=n[1];h[2]=n[2];h[3]=n[3];this._wrap&&(n=a.getInfo(this.tileInfo.spatialReference),d=-d*(n.valid[1]-n.valid[0]),h[0]+=d,h[2]+=d);return h}getSmallestInfoForScale(h){const n=this.scales;
if(this._infoByScale[h])return this._infoByScale[h];if(h>n[0])return this._infoByScale[n[0]];for(let d=1;d<n.length-1;d++)if(h>n[d]+1E-6)return this._infoByScale[n[d-1]];return this._infoByScale[n[n.length-1]]}getClosestInfoForScale(h){const n=this.scales;if(this._infoByScale[h])return this._infoByScale[h];h=n.reduce((d,w)=>Math.abs(w-h)<Math.abs(d-h)?w:d,n[0]);return this._infoByScale[h]}scaleToLevel(h){const n=this.scales;if(this._infoByScale[h])return this._infoByScale[h].level;for(let d=n.length-
1;0<=d;d--)if(h<n[d])return d===n.length-1?this._infoByScale[n[n.length-1]].level:this._infoByScale[n[d]].level+(n[d]-h)/(n[d]-n[d+1]);return this._infoByScale[n[0]].level}scaleToZoom(h){return this.tileInfo.scaleToZoom(h)}zoomToScale(h){return this.tileInfo.zoomToScale(h)}_getTileIdAtLOD(h,n,d){const w=this._infoByLevel[d.level];h.set(d);if(n.resolution<w.resolution)return null;if(n.resolution===w.resolution)return h;h.level=n.level;h.col=Math.floor(d.col*w.resolution/n.resolution+.01);h.row=Math.floor(d.row*
w.resolution/n.resolution+.01);return h}}return c})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(a,q){function r(m,b,f){m[0]=b;m[1]=f;return m}const g=new q("0/0/0/0");class p{static create(m,b,f=null){var c=a.getInfo(m.spatialReference);const h=b.origin||[m.origin.x,m.origin.y],n=[m.size[0]*b.resolution,m.size[1]*b.resolution],d=[-Infinity,-Infinity],w=[Infinity,Infinity],t=[Infinity,Infinity];null!=f&&(r(d,Math.max(0,
Math.floor((f.xmin-h[0])/n[0])),Math.max(0,Math.floor((h[1]-f.ymax)/n[1]))),r(w,Math.max(0,Math.floor((f.xmax-h[0])/n[0])),Math.max(0,Math.floor((h[1]-f.ymin)/n[1]))),r(t,w[0]-d[0]+1,w[1]-d[1]+1));const {cols:l,rows:e}=b;!f&&l&&e&&(r(d,l[0],e[0]),r(w,l[1],e[1]),r(t,l[1]-l[0]+1,e[1]-e[0]+1));let u;m.isWrappable?(m=[Math.ceil(Math.round((c.valid[1]-c.valid[0])/b.resolution)/m.size[0]),t[1]],c=[Math.floor((c.origin[0]-h[0])/n[0]),d[1]],f=[m[0]+c[0]-1,w[1]],u=!0):(c=d,f=w,m=t,u=!1);return new p(b.level,
b.resolution,b.scale,h,d,w,t,n,c,f,m,u)}constructor(m,b,f,c,h,n,d,w,t,l,e,u){this.level=m;this.resolution=b;this.scale=f;this.origin=c;this.first=h;this.last=n;this.size=d;this.norm=w;this.worldStart=t;this.worldEnd=l;this.worldSize=e;this.wrap=u}normalizeCol(m){if(!this.wrap)return m;const b=this.worldSize[0];return 0>m?b-1-Math.abs((m+1)%b):m%b}denormalizeCol(m,b){return this.wrap?this.worldSize[0]*b+m:m}getWorldForColumn(m){return this.wrap?Math.floor(m/this.worldSize[0]):0}getFirstColumnForWorld(m){return m*
this.worldSize[0]+this.first[0]}getLastColumnForWorld(m){return m*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(m){return(m-this.origin[0])/this.norm[0]}getXForColumn(m){return this.origin[0]+m*this.norm[0]}getRowForY(m){return(this.origin[1]-m)/this.norm[1]}getYForRow(m){return this.origin[1]-m*this.norm[1]}getTileBounds(m,b,f=!1){g.set(b);var c=f?g.col:this.denormalizeCol(g.col,g.world),h=g.row;b=this.getXForColumn(c);f=this.getYForRow(h+1);c=this.getXForColumn(c+1);h=this.getYForRow(h);
m[0]=b;m[1]=f;m[2]=c;m[3]=h;return m}getTileCoords(m,b,f=!1){g.set(b);b=f?g.col:this.denormalizeCol(g.col,g.world);Array.isArray(m)?r(m,this.getXForColumn(b),this.getYForRow(g.row)):(m.x=this.getXForColumn(b),m.y=this.getYForRow(g.row));return m}}return p})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(a){class q{static getId(r,g,p,m){return"object"===typeof r?`${r.level}/${r.row}/${r.col}/${r.world}`:`${r}/${g}/${p}/${m}`}constructor(r,g,p,m){this.set(r,
g,p,m)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(r){this.set(r)}get hash(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(r,g,p,m){this.set(r,g,p,m)}contains(r){const g=r.level-this.level;return 0<=g&&this.row===r.row>>g&&this.col===r.col>>g&&this.world===r.world}containsChild(r){const g=r.level-this.level;return 0<g&&this.row===r.row>>g&&this.col===r.col>>g&&this.world===r.world}equals(r){return this.level===
r.level&&this.row===r.row&&this.col===r.col&&this.world===r.world}clone(){return new q(this)}release(){this.world=this.col=this.row=this.level=0}set(r,g,p,m){if(null==r)this.world=this.col=this.row=this.level=0;else if("object"===typeof r)this.level=r.level||0,this.row=r.row||0,this.col=r.col||0,this.world=r.world||0;else if("string"===typeof r){const [b,f,c,h]=r.split("/");this.level=parseFloat(b);this.row=parseFloat(f);this.col=parseFloat(c);this.world=parseFloat(h)}else this.level=+r,this.row=
+g,this.col=+p,this.world=+m||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new q(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(r,g){return`${this.level}/${this.row+g}/${this.col+r}/${this.world}`}getChildKeys(){const r=this.level+1,g=this.row<<1,p=this.col<<1,m=this.world;return[new q(r,g,p,m),new q(r,g,p+1,m),new q(r,g+1,p,m),new q(r,g+1,p+1,m)]}compareRowMajor(r){return this.row<r.row?-1:this.row>r.row?
1:this.col<r.col?-1:this.col>r.col?1:0}}q.pool=new a(q,null,null,25,50);return q})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool","./TileKey"],function(a,q){class r{constructor(){this.spans=[]}acquire(g){this.lodInfo=g}release(){this.lodInfo=null;this.spans.length=0}*keys(){const g=this.lodInfo;for(const {row:p,colFrom:m,colTo:b}of this.spans)for(let f=m;f<=b;f++){const c=g.getWorldForColumn(f);yield new q(g.level,p,g.normalizeCol(f),c)}}forEach(g,p){const {spans:m,
lodInfo:b}=this,{level:f}=b;if(0!==m.length)for(const {row:c,colFrom:h,colTo:n}of m)for(let d=h;d<=n;d++)g.call(p,f,c,b.normalizeCol(d),b.getWorldForColumn(d))}}r.pool=new a(r);return r})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(q,r,g){this.row=q;this.colFrom=r;this.colTo=g}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(e,u){e.length=0;u.forEach(x=>e.push(x));return e}const d=new Set,w=[],t=new Map,l=[0,0];q=class extends q{constructor(e){super(e);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:e,process:u,strategy:x}=this;this._queue=new h.QueueProcessor({concurrency:e,process:(y,A)=>{y=this._keyToItem.get(y);return u(y,{signal:A})},peeker:"scale-first"===x?y=>this._peekByScaleFirst(y):y=>this._peekByCenterFirst(y)})}destroy(){this.clear();
this._queue=r.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){this._queue.abort("string"===typeof e?e:e.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(e){return"string"===typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){e="string"===typeof e?e:e.id;return this.has(e)&&this._queue.isOngoing(e)}pause(){this._queue.pause()}push(e){const u=e.key.id;if(this._queue.has(u))return this._queue.get(u);
const x=this._queue.push(u),y=()=>{this._keyToItem.delete(u)};this._keyToItem.set(u,e);x.then(y,y);return x}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const u=this.tileInfoView;let x=Number.NEGATIVE_INFINITY,y=Number.POSITIVE_INFINITY;e.forEach(z=>{z=this._keyToItem.get(z);const E=this.tileInfoView.getTileScale(z.key);t.has(E)||(t.set(E,[]),x=Math.max(E,x),y=Math.min(E,y));t.get(E).push(z.key);d.add(E)});let A=this.state.scale;
t.has(A)||(n(w,d),w.sort((z,E)=>z-E),A=w.reduce((z,E)=>Math.abs(E-A)<Math.abs(z-A)?E:z,w[0]));A=Math.min(A,x);A=Math.max(A,y);e=t.get(A);const k=u.getClosestInfoForScale(A),v=k.getColumnForX(this.state.center[0]),B=k.getRowForY(this.state.center[1]);e.sort((z,E)=>{const K=k.denormalizeCol(z.col,z.world),I=k.denormalizeCol(E.col,E.world);return Math.sqrt((v-K)*(v-K)+(B-z.row)*(B-z.row))-Math.sqrt((v-I)*(v-I)+(B-E.row)*(B-E.row))});d.clear();t.clear();return e[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;
const u=this.tileInfoView,x=this.state.center;let y=Number.POSITIVE_INFINITY,A;e.forEach(k=>{k=this._keyToItem.get(k);u.getTileCoords(l,k.key);const v=c.distance(l,x);v<y&&(y=v,A=k.key)});return A.id}};a.__decorate([g.property({constructOnly:!0})],q.prototype,"concurrency",void 0);a.__decorate([g.property({constructOnly:!0})],q.prototype,"process",void 0);a.__decorate([g.property()],q.prototype,"state",void 0);a.__decorate([g.property({constructOnly:!0})],q.prototype,"strategy",void 0);a.__decorate([g.property({constructOnly:!0})],
q.prototype,"tileInfoView",void 0);return q=a.__decorate([f.subclass("esri.views.2d.tiling.TileQueue")],q)})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(a,q){function r(R,Z){R[0]=Z[0];R[1]=Z[1];return R}function g(R,Z,ea){R[0]=Z;R[1]=ea;return R}function p(R,Z,ea){R[0]=Z[0]+ea[0];R[1]=Z[1]+ea[1];return R}function m(R,Z,ea){R[0]=Z[0]-ea[0];R[1]=Z[1]-ea[1];return R}function b(R,Z,ea){R[0]=Z[0]*ea[0];R[1]=Z[1]*ea[1];return R}function f(R,Z,ea){R[0]=Z[0]/
ea[0];R[1]=Z[1]/ea[1];return R}function c(R,Z){R[0]=Math.ceil(Z[0]);R[1]=Math.ceil(Z[1]);return R}function h(R,Z){R[0]=Math.floor(Z[0]);R[1]=Math.floor(Z[1]);return R}function n(R,Z,ea){R[0]=Math.min(Z[0],ea[0]);R[1]=Math.min(Z[1],ea[1]);return R}function d(R,Z,ea){R[0]=Math.max(Z[0],ea[0]);R[1]=Math.max(Z[1],ea[1]);return R}function w(R,Z){R[0]=Math.round(Z[0]);R[1]=Math.round(Z[1]);return R}function t(R,Z,ea){R[0]=Z[0]*ea;R[1]=Z[1]*ea;return R}function l(R,Z,ea,ma){R[0]=Z[0]+ea[0]*ma;R[1]=Z[1]+
ea[1]*ma;return R}function e(R,Z){const ea=Z[0]-R[0];R=Z[1]-R[1];return Math.sqrt(ea*ea+R*R)}function u(R,Z){const ea=Z[0]-R[0];R=Z[1]-R[1];return ea*ea+R*R}function x(R){const Z=R[0];R=R[1];return Math.sqrt(Z*Z+R*R)}function y(R){const Z=R[0];R=R[1];return Z*Z+R*R}function A(R,Z){R[0]=-Z[0];R[1]=-Z[1];return R}function k(R,Z){R[0]=1/Z[0];R[1]=1/Z[1];return R}function v(R,Z){var ea=Z[0];const ma=Z[1];ea=ea*ea+ma*ma;0<ea&&(ea=1/Math.sqrt(ea),R[0]=Z[0]*ea,R[1]=Z[1]*ea);return R}function B(R,Z){return R[0]*
Z[0]+R[1]*Z[1]}function z(R,Z,ea){Z=Z[0]*ea[1]-Z[1]*ea[0];R[0]=R[1]=0;R[2]=Z;return R}function E(R,Z,ea,ma){const V=Z[0];Z=Z[1];R[0]=V+ma*(ea[0]-V);R[1]=Z+ma*(ea[1]-Z);return R}function K(R,Z){Z=Z||1;const ea=2*q.RANDOM()*Math.PI;R[0]=Math.cos(ea)*Z;R[1]=Math.sin(ea)*Z;return R}function I(R,Z,ea){const ma=Z[0];Z=Z[1];R[0]=ea[0]*ma+ea[2]*Z;R[1]=ea[1]*ma+ea[3]*Z;return R}function D(R,Z,ea){const ma=Z[0];Z=Z[1];R[0]=ea[0]*ma+ea[2]*Z+ea[4];R[1]=ea[1]*ma+ea[3]*Z+ea[5];return R}function G(R,Z,ea){const ma=
Z[0];Z=Z[1];R[0]=ea[0]*ma+ea[3]*Z+ea[6];R[1]=ea[1]*ma+ea[4]*Z+ea[7];return R}function C(R,Z,ea){const ma=Z[0];Z=Z[1];R[0]=ea[0]*ma+ea[4]*Z+ea[12];R[1]=ea[1]*ma+ea[5]*Z+ea[13];return R}function F(R,Z,ea,ma){const V=Z[0]-ea[0];Z=Z[1]-ea[1];const aa=Math.sin(ma);ma=Math.cos(ma);R[0]=V*ma-Z*aa+ea[0];R[1]=V*aa+Z*ma+ea[1];return R}function J(R,Z){var ea=R[0];R=R[1];const ma=Z[0];Z=Z[1];let V=ea*ea+R*R;0<V&&(V=1/Math.sqrt(V));let aa=ma*ma+Z*Z;0<aa&&(aa=1/Math.sqrt(aa));ea=(ea*ma+R*Z)*V*aa;return 1<ea?0:
-1>ea?Math.PI:Math.acos(ea)}function T(R){return"vec2("+R[0]+", "+R[1]+")"}function S(R,Z){return R[0]===Z[0]&&R[1]===Z[1]}function ba(R,Z){const ea=R[0];R=R[1];const ma=Z[0];Z=Z[1];const V=q.getEpsilon();return Math.abs(ea-ma)<=V*Math.max(1,Math.abs(ea),Math.abs(ma))&&Math.abs(R-Z)<=V*Math.max(1,Math.abs(R),Math.abs(Z))}function M(R,Z,ea,ma,V){let aa=Z[0]-ea[0];ea=Z[1]-ea[1];V=(ma[0]*aa+ma[1]*ea)*(V-1);aa=ma[0]*V;ea=ma[1]*V;R[0]=Z[0]+aa;R[1]=Z[1]+ea;return R}const U=Object.freeze(Object.defineProperty({__proto__:null,
add:p,angle:J,ceil:c,copy:r,cross:z,dist:e,distance:e,div:f,divide:f,dot:B,equals:ba,exactEquals:S,floor:h,inverse:k,len:x,length:x,lerp:E,max:d,min:n,mul:b,multiply:b,negate:A,normalize:v,projectAndScale:M,random:K,rotate:F,round:w,scale:t,scaleAndAdd:l,set:g,sqrDist:u,sqrLen:y,squaredDistance:u,squaredLength:y,str:T,sub:m,subtract:m,transformMat2:I,transformMat2d:D,transformMat3:G,transformMat4:C},Symbol.toStringTag,{value:"Module"}));a.add=p;a.angle=J;a.ceil=c;a.copy=r;a.cross=z;a.dist=e;a.distance=
e;a.div=f;a.divide=f;a.dot=B;a.equals=ba;a.exactEquals=S;a.floor=h;a.inverse=k;a.len=x;a.length=x;a.lerp=E;a.max=d;a.min=n;a.mul=b;a.multiply=b;a.negate=A;a.normalize=v;a.projectAndScale=M;a.random=K;a.rotate=F;a.round=w;a.scale=t;a.scaleAndAdd=l;a.set=g;a.sqrDist=u;a.sqrLen=y;a.squaredDistance=u;a.squaredLength=y;a.str=T;a.sub=m;a.subtract=m;a.transformMat2=I;a.transformMat2d=D;a.transformMat3=G;a.transformMat4=C;a.vec2=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),
function(a,q,r,g,p,m,b,f){class c{constructor(n,d){this.item=n;this.controller=d;this.promise=null}}class h{constructor(n){this._task=this._schedule=null;this._deferreds=new m;this._controllers=new m;this._processingItems=new m;this._pausedSignal=f.signal(!1);this.concurrency=1;n.concurrency&&(this.concurrency=n.concurrency);this._queue=new p(n.peeker);this.process=n.process;const d=n.scheduler;n.priority&&d&&(this._task=d.registerTask(n.priority,this))}destroy(){this.clear();this._schedule=r.removeMaybe(this._schedule);
this._task=r.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(n){(n=this._controllers.get(n))&&n.abort()}clear(){this._queue.clear();const n=[];this._controllers.forEach(d=>n.push(d));this._controllers.clear();n.forEach(d=>d.abort());this._processingItems.clear();this._cancelNext()}forEach(n){this._deferreds.forEach((d,w)=>n(w))}get(n){return(n=this._deferreds.get(n))?n.promise:void 0}isOngoing(n){return this._processingItems.has(n)}has(n){return this._deferreds.has(n)}pause(){this._pausedSignal.value||
(this._pausedSignal.value=!0,this._cancelNext())}push(n,d){const w=this.get(n);if(w)return w;const t=new AbortController;let l=null;d&&(l=g.onAbort(d,()=>t.abort()));const e=()=>{u.remove();null!=l&&l.remove();this._removeItem(n);this._queue.remove(n);this._scheduleNext()},u=g.onAbortOrThrow(t.signal,()=>{const y=this._processingItems.get(n);y&&y.controller.abort();e();x.reject(g.createAbortError())}),x=g.createResolver();this._deferreds.set(n,x);this._controllers.set(n,t);x.promise.then(e,e);this._queue.push(n);
this._scheduleNext();return x.promise}last(){return this._queue.last()}lastPromise(){const n=this.last();return n?this.get(n):null}peek(){return this._queue.peek()}popLast(){const n=this._queue.popLast();n&&(this._deferreds.get(n)?.reject(g.createAbortError("Removed from queue")),this._removeItem(n));return n}reset(){const n=[];this._processingItems.forEach(d=>n.push(d));this._processingItems.clear();for(const d of n)this._queue.push(d.item),d.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&
(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const n=[];for(;this._queue.length;)n.push(this._queue.pop());this.clear();return n}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(n){for(;!n.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),n.madeProgress()}_removeItem(n){this._deferreds.delete(n);this._controllers.delete(n);this._processingItems.delete(n)}_scheduleNext(){this._task||
this._pausedSignal.value||this._schedule||(this._schedule=b.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(n,d){this._canProcessFulfillment(n)&&(this._scheduleNext(),this._deferreds.get(n.item).resolve(d))}_processError(n,d){this._canProcessFulfillment(n)&&(this._scheduleNext(),this._deferreds.get(n.item).reject(d))}_canProcessFulfillment(n){return this._deferreds.get(n.item)&&
this._processingItems.get(n.item)===n?!0:!1}_process(n){if(null!=n){var d=new AbortController,w=new c(n,d);this._processingItems.set(n,w);try{var t=this.process(n,d.signal)}catch(l){this._processError(w,l)}g.isPromiseLike(t)?(w.promise=t,t.then(l=>this._processResult(w,l),l=>this._processError(w,l))):this._processResult(w,t)}}get test(){}}a.QueueProcessor=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],
function(a,q){class r{constructor(g=p=>p.values().next().value){this._peeker=g;this._observable=new q.SimpleObservable;this._items=new Set}get length(){a.trackAccess(this._observable);return this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0!==this.length){for(var g of this._items);return g}}peek(){if(0!==this.length)return this._peeker(this._items)}push(g){this.contains(g)||(this._items.add(g),this._observable.notify())}contains(g){a.trackAccess(this._observable);
return this._items.has(g)}pop(){if(0!==this.length){var g=this.peek();this._items.delete(g);this._observable.notify();return g}}popLast(){if(0!==this.length){var g=this.last();this._items.delete(g);this._observable.notify();return g}}remove(g){this.contains(g)&&(this._items.delete(g),this._observable.notify())}filter(g){const p=this.length;this._items.forEach(m=>{g(m)||this._items.delete(m)});p!==this._items.size&&this._observable.notify();return this}*[Symbol.iterator](){a.trackAccess(this._observable);
yield*this._items}}return r})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,q){class r{constructor(g){this._observable=new q.SimpleObservable;this._map=new Map(g)}get size(){a.trackAccess(this._observable);return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(g){(g=this._map.delete(g))&&this._observable.notify();return g}entries(){a.trackAccess(this._observable);return this._map.entries()}forEach(g,
p){a.trackAccess(this._observable);this._map.forEach((m,b)=>g.call(p,m,b,this),p)}get(g){a.trackAccess(this._observable);return this._map.get(g)}has(g){a.trackAccess(this._observable);return this._map.has(g)}keys(){a.trackAccess(this._observable);return this._map.keys()}set(g,p){this._map.set(g,p);this._observable.notify();return this}values(){a.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){a.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}
return r})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,q,r,g){class p{constructor(m,b){this._observable=new g.SimpleObservable;this._value=m;this._equalityFunction=b}get value(){r.trackAccess(this._observable);return this._value}set value(m){this._equalityFunction(m,this._value)||(this._value=m,this._observable.notify())}mutate(m){m(this._value);this._observable.notify()}}a.signal=function(m,b=q.equalsShallow){return new p(m,
b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(a,q,r,g){const p=new g(0,0,0,0),m=new Map,b=[],f=[];class c{constructor(h){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=h.acquireTile;this.releaseTile=
h.releaseTile;this.tileInfoView=h.tileInfoView;null!=h.resampling&&(this.resampling=h.resampling);h.cachePolicy&&(this.cachePolicy=h.cachePolicy);h.coveragePolicy&&(this.coveragePolicy=h.coveragePolicy);null!=h.buffer&&(this.buffer=h.buffer);h.cacheSize&&(this._tileCache=new q(h.cacheSize,this.tileInfoView,n=>{this.releaseTile(n)}))}destroy(){this.tileIndex.clear()}update(h){const {resampling:n,tileIndex:d}=this,{scale:w,center:t,resolution:l}=h.state,{minScale:e,maxScale:u}=this.tileInfoView,x=!h.stationary&&
w>this._previousScale;this._previousScale=w;if(!n&&(w>e||w<u))this.tiles.length=0,this.clear();else if(h=this.tileInfoView.getTileCoverage(h.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:y,lodInfo:A}=h,{level:k}=A;this.tiles.length=0;d.forEach(E=>E.visible=!0);var v=0,B=0;if(0<y.length)for(const {row:E,colFrom:K,colTo:I}of y)for(var z=K;z<=I;z++){v++;const D=p.set(k,E,A.normalizeCol(z),A.getWorldForColumn(z)).id;let G=d.get(D);if(G)G.isReady?(m.set(D,G),B++):x||this._addParentTile(D,
m);else{if(this._tileCache?.has(D)){if(G=this._tileCache.pop(D),this.tileIndex.set(D,G),G.isReady){m.set(D,G);B++;continue}}else G=this.acquireTile(p),this.tileIndex.set(D,G);x||this._addParentTile(D,m)}}v=B===v;for(const [E,K]of d)m.has(E)||(p.set(E),B=this.tileInfoView.intersects(h,p),z="purge"===this.cachePolicy?p.level!==k:p.level>k,!B||!x&&v?!z&&B||b.push(K):K.isReady?z&&"purge"===this.cachePolicy&&this._hasReadyAncestor(p,k)?b.push(K):f.push(K):z&&b.push(K));for(const E of f)E.isReady&&m.set(E.key.id,
E);for(const E of b)this._tileCache?this._tileCache.add(E):this.releaseTile(E),d.delete(E.key.id);for(const E of m.values())this.tiles.push(E);for(const E of d.values())m.has(E.key.id)||(E.visible=!1);this._tileCache?.prune(k,t,l);r.pool.release(h);f.length=0;b.length=0;m.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:h}=this;for(const n of h.values())this.releaseTile(n);h.clear()}refresh(h){for(const n of this.tileIndex.values())this.tiles.includes(n)?h(n):b.push(n);for(const n of b)this.releaseTile(n),
this.tileIndex.delete(n.key.id);this._tileCache?.clear()}updateCacheSize(h){this._tileCache&&(this._tileCache.maxSize=h)}_addParentTile(h,n){let d=null;for(;;){h=this.tileInfoView.getTileParentId(h);if(!h)break;if(this.tileIndex.has(h)){if(d=this.tileIndex.get(h),d?.isReady){n.has(d.key.id)||n.set(d.key.id,d);break}}else if(this._tileCache?.has(h)&&(d=this._tileCache.pop(h),this.tileIndex.set(h,d),d?.isReady)){n.has(d.key.id)||n.set(d.key.id,d);break}}}_hasReadyAncestor(h,n){const d=a.create();this.tileInfoView.getTileBounds(d,
h,!0);for(const w of this.tileIndex.values())if(w.isReady&&w.key.level>=n&&w.key.level<h.level){const t=a.create();this.tileInfoView.getTileBounds(t,w.key,!0);if(a.contains(t,d))return!0}return!1}}return c})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(a){class q{constructor(r,g,p){this.maxSize=r;this._tileInfoView=g;this._removedFunc=p;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=
[]}has(r){return this._tilePerId.has(r)}get(r){return this._tilePerId.get(r)}pop(r){const g=this._tilePerId.get(r);if(g){var p=this._tileKeysPerLevel[g.key.level];this._tilePerId["delete"](r);for(let m=0;m<p.length;m++)if(p[m].id===r){p.splice(m,1);break}g.visible=!0;return g}}add(r){r.visible=!1;const g=r.key,p=g.id;this._tilePerId.has(p)||(this._tilePerId.set(p,r),r=g.level,this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(g))}prune(r,g,p){let m=this._tilePerId.size;
if(!(m<=this.maxSize)){for(var b=this._tileKeysPerLevel.length-1;m>this.maxSize&&0<=b;)b!==r&&(m=this._pruneAroundCenterTile(m,g,p,b)),b--;m>this.maxSize&&(m=this._pruneAroundCenterTile(m,g,p,r))}}_pruneAroundCenterTile(r,g,p,m){m=this._tileKeysPerLevel[m];if(!m||0===m.length)return r;const {size:b,origin:f}=this._tileInfoView.tileInfo,c=p*b[0],h=p*b[1],n=[0,0],d=[0,0];for(m.sort((w,t)=>{n[0]=f.x+c*(w.col+.5);n[1]=f.y-h*(w.row+.5);d[0]=f.x+c*(t.col+.5);d[1]=f.y-h*(t.row+.5);return a.squaredDistance(n,
g)-a.squaredDistance(d,g)});0<m.length&&(p=m.pop(),this._removeTile(p.id),r--,r!==this.maxSize););return r}_removeTile(r){const g=this._tilePerId.get(r);this._removedFunc&&g&&this._removedFunc(g);this._tilePerId["delete"](r)}}return q})},"esri/views/2d/layers/features/PipelineConnectionHandlers":function(){define(["exports","../../../../core/workers/utils"],function(a,q){class r{constructor(g){this._client=g;this.layerView=this._client.createInvokeProxy("");this.container=this._client.createInvokeProxy("container");
this._eventLog=this._client.createInvokeProxy("eventLog")}onEvent(g){q.ignoreConnectionErrors(this._eventLog.onEvent(g))}}a.PipelineConnectionHandlers=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/Processor":function(){define("../../../../core/has ../../../../core/maybe ../../../../core/object ../../../../core/promiseUtils ../../../../core/accessorSupport/diffUtils ../../../../core/workers/utils ../../../../geometry/SpatialReference ../../engine/webgl/mesh/MultiTileMeshData ../../engine/webgl/mesh/factories/FeatureMeshFactory ../../engine/webgl/mesh/factories/ResourceProxy ../../engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry ../../engine/webgl/util/MatcherContext ./ProcessorTileMessageQueue ./processor/BinningStrategy ./processor/ClusterStrategy ./processor/FeatureUpdateStrategy ./support/AttributeStore ./support/ComputedAttributeStorage".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x){class y{constructor(A,k){this._connection=A;this._source=k;this._version=1;this._registry=new n.MeshWriterRegistry;this._proxy=new h.ResourceProxy({fetch:(v,B)=>this._connection.layerView.fetch(v,B),fetchDictionary:(v,B)=>this._connection.layerView.fetchDictionary(v,B)});this._attributeStore=new u.AttributeStore({isLocal:!1,update:v=>m.ignoreConnectionErrors(this._connection.container.updateAttributeView(v))})}destroy(){this._proxy.destroy();this._strategy?.destroy();
this._attributeStore.destroy()}get aggregateQueryEngine(){return this._strategy?.aggregateQueryEngine}getDisplayFeatures(A){return this._strategy?this._strategy.getDisplayFeatures(A):{features:[],aggregates:[]}}getFeatureObjectIdsForAggregate(A){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(A):[]}onSubscribe(A){this._strategy?.onSubscribe(A)}onUnsubscribe(A){this._strategy?.onUnsubscribe(A)}async update(A,k,v,B,z){A=A.processor;var E=r.notDeepEqual(this._schema?.storage,A.storage);
const K=r.notDeepEqual(this._schema?.mesh.properties,A.mesh.properties),I=r.notDeepEqual(this._schema?.mesh.factory,A.mesh.factory),D=r.notDeepEqual(this._schema?.mesh.strategy,A.mesh.strategy),G=K||I||D;if(E||G||B){a("esri-2d-update-debug")&&console.debug(`Version[${this._version}] SymbolProcessor.update`,{changes:p.diff(this._schema,A),schema:A});this._schema=A;E=b.fromJSON(this._source.service.outSpatialReference);var C=new x.ComputedAttributeStorage({fields:this._source.metadata.fieldsIndex,spatialReference:E});
await this._attributeStore.update(A.storage,C,this._source.metadata,E,k);this._strategy?.invalidateAttributeData();if(B||G){(D||K)&&await this._updateStrategy(A.mesh.strategy,E,z,A.mesh.properties.timeZone);this._updateSortKey(C,"sortKey"in A.mesh.properties?A.mesh.properties.sortKey:null);v=new d.MatcherContext(C,this._proxy,v,this._registry);if(I||"dictionary"===A.mesh.factory.symbology.type)this._factory=await c.FeatureMeshFactory.create(v,A.mesh.factory);this._invalidate();this._version=k;return this._connection.container.updateRenderState(this._version)}}}async applyLocalEdit(A){if(this._strategy){A=
this._strategy.applyLocalEdit(A);for await(const k of A)try{await this._process(k)}catch(v){}}}async updateChunks(){await this._doUpdateChunks();this._strategy?.afterUpdateChunks()}async removeChunks(A){this._strategy?.removeChunks(A);this._attributeStore.incrementDisplayIdGeneration()}updateHighlight({highlights:A}){if(this._strategy){var k=this._strategy.displayMap(A,({objectId:v})=>v,(v,{highlightFlags:B},z)=>({objectId:z,displayId:v,highlightFlags:B}));this._attributeStore.setHighlight(k,A)}else this._attributeStore.setHighlight(A.map(({objectId:v,
highlightFlags:B})=>({objectId:v,highlightFlags:B,displayId:-1})),A)}async _doUpdateChunks(){if(this._strategy){var A=this._strategy.updateChunks(),k=[],v=new Map;for await(const B of A)A=v.get(B.id),null==A&&(A=new w.ProcessorTileMessageQueue({concurrency:16,process:z=>this._process(z)}),v.set(B.id,A)),A=A.push(B).catch(z=>g.throwIfNotAbortError(z)),k.push(A);try{await Promise.all(k)}catch(B){}a("esri-2d-update-debug")&&console.log("SendUpdates");this._attributeStore.sendUpdates();a("esri-2d-update-debug")&&
console.log("SendUpdates.await")}}async _updateStrategy(A,k,v,B){this._strategy?.destroy();switch(A.type){case "feature":this._strategy=new e.FeatureUpdateStrategy(this._source,this._attributeStore,B);break;case "binning":this._strategy=await t.BinningStrategy.create(A,k,this._source,this._attributeStore,B);break;case "cluster":this._strategy=await l.ClusterStrategy.create(this._connection,A,k,this._source,this._attributeStore,B)}for(const z of v)this._strategy.onSubscribe(z)}async _updateSortKey(A,
k){this._sortInfo=q.destroyMaybe(this._sortInfo?.computed);null!=k&&(A=k.byRenderer?null:await A.createComputedField(k),this._sortInfo={...k,computed:A})}_invalidate(){this._strategy&&this._strategy.invalidate()}async _process(A){const k=A.subscription;a("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Tile[${k.tile.key.id}, end=${A.end}] Processor._process`);await this._fetchResources(A);g.throwIfAborted(k.signal);var v=await this._write(A,k.tile.createArcadeEvaluationOptions(this._schema?.mesh.properties.timeZone));
const {message:B,transferList:z}=v.serialize(k.tile.tileInfoView.tileInfo.isWrappable);v={objectIdMap:null,inner:A.createMessage(B,this._version,this._attributeStore.epoch)};if(this._schema?.mesh.properties.returnMeshObjectId){v.objectIdMap={};const E=A.reader?.getCursor();if(E)for(;E.next();)v.objectIdMap[E.getDisplayId()]=E.getObjectId()}g.throwIfAborted(k.signal);await this._connection.container.onMessage(v,{signal:k.signal,transferList:z});this._attributeStore.sendUpdates();a("esri-2d-update-debug")&&
console.debug(`Version[${this._version}] Tile[${k.tile.key.id}, end=${A.end}] Processor._process.await`)}async _fetchResources(A){await this._fetchMatcherResources(A);await this._fetchWriterResources(A)}async _fetchMatcherResources(A){if(A.reader)return this._factory.enqueueMatcherRequests(this._proxy,A.reader)}async _fetchWriterResources(A){if(A.reader){var k=A.reader.getCursor();for(A=A.subscription.tile.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);k.next();)this._factory.enqueueWriterRequests(this._proxy,
k,A);await this._proxy.fetchEnqueuedResources()}}async _write(A,k){const v=A.subscription.tile;A=A.reader?.getCursor();var B=A?.getSize()??0;B=new f.MultiTileMeshData(v.key,this._strategy.enablePixelBuffering,v.tileInfoView.tileInfo.isWrappable,B);if(!A)return B;const z=v.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);for(;A.next();){const E=this._getSortKeyValue(A,k);B.entityStart(A.getDisplayId(),E);this._factory.write(B,this._proxy,A,z,v.level);B.entityEnd()}return B}_getSortKeyValue(A,
k){if(!this._sortInfo)return 0;const {computed:v,order:B,byRenderer:z}=this._sortInfo;A=z?this._factory.getSortKey(A,k):v?.read(A,k);return null==A||isNaN(A)?0:A*("asc"===B?-1:1)}}return y})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],function(a,q,r,g){function p(w){return w instanceof r?Object.keys(w.items):w instanceof q?g.getProperties(w).keys():w?Object.keys(w):[]}function m(w,t){return w instanceof r?w.items[t]:w[t]}function b(w,
t){return Array.isArray(w)&&Array.isArray(t)?w.length!==t.length:!1}function f(w){return w?w.declaredClass:null}function c(w,t){const l=w.diff;if(l&&"function"===typeof l)return l(w,t);const e=p(w),u=p(t);if(0!==e.length||0!==u.length){if(!e.length||!u.length||b(w,t))return{type:"complete",oldValue:w,newValue:t};var x=u.filter(k=>!e.includes(k)),y=e.filter(k=>!u.includes(k));y=e.filter(k=>u.includes(k)&&m(w,k)!==m(t,k)).concat(x,y).sort();if((x=f(w))&&d.has(x)&&y.length)return{type:"complete",oldValue:w,
newValue:t};var A;x=w instanceof q&&t instanceof q;for(const k of y){y=m(w,k);const v=m(t,k);if((x||"function"!==typeof y&&"function"!==typeof v)&&y!==v&&(null!=y||null!=v)){if(l&&l[k]&&"function"===typeof l[k])y=l[k]?.(y,v);else if(y instanceof Date&&v instanceof Date){if(y.getTime()===v.getTime())continue;y={type:"complete",oldValue:y,newValue:v}}else y="object"===typeof y&&"object"===typeof v&&f(y)===f(v)?c(y,v):{type:"complete",oldValue:y,newValue:v};null!=y&&(null!=A?A.diff[k]=y:A={type:"partial",
diff:{[k]:y}})}}return A}}function h(w,t){if(null==w)return!1;t=t.split(".");for(const l of t){if("complete"===w.type)break;if("partial"===w.type){if(w=w.diff[l],!w)return!1}else return!1}return!0}function n(w){if(null==w)return!0;switch(w.type){case "complete":return!1;case "collection":for(const t of w.added)if(!n(t))return!1;for(const t of w.removed)if(!n(t))return!1;for(const t of w.changed)if(!n(t))return!1;return!0;case "partial":for(const t in w.diff)if(!n(w.diff[t]))return!1;return!0}}const d=
new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);a.diff=function(w,t){if("function"!==typeof w&&"function"!==typeof t&&(null!=w||null!=t))return null==w||null==t||"object"===typeof w&&"object"===typeof t&&f(w)!==f(t)?{type:"complete",oldValue:w,newValue:t}:c(w,t)};a.hasDiff=h;a.hasDiffAny=function(w,t){for(const l of t)if(h(w,l))return!0;return!1};a.hasRootDiff=function(w,t){return h(w,t)};a.hasRootDiffOnly=
function(w,t){return w?"partial"===w.type?(w=Object.keys(w.diff),1===w.length&&w[0]===t):!1:!1};a.isEmpty=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MultiTileMeshData":function(){define("exports ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ./MeshData ../../../layers/features/support/tileUtils".split(" "),function(a,q,r,g,p,m,b,f){function c(d){switch(d){case 1:case 8:case 32:return-1;
case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function h(d){switch(d){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class n{constructor(d,w,t,l=0){this.tileKey=d;this._bufferingEnabled=w;this._sizeHint=l;this._meshes={self:new b.MeshData(this.id,this._sizeHint),neighbors:[]};this._currentEntityOverlaps=this._currentRecordOverlaps=0;this._copyBufferedDataIntoSelf=t&&this._bufferingEnabled&&0===d.level}get id(){return this.tileKey.id}vertexCount(){return this._meshes.self.vertexCount()}indexCount(){return this._meshes.self.indexCount()}indexEnsureSize(d){this._meshes.self.indexEnsureSize(d)}entityStart(d,
w=d){this._currentEntityOverlaps=0;this._meshes.self.entityStart(d,w)}entityRecordCount(){return this._meshes.self.entityRecordCount()}entityEnd(){this._meshes.self.entityEnd();if(this._bufferingEnabled&&!this._copyBufferedDataIntoSelf)for(let d=0;8>d;d++)this._currentEntityOverlaps&1<<d&&this._meshes.neighbors[d].entityEnd()}recordStart(d,w,t){this._currentRecordOverlaps=0;this._meshes.self.recordStart(d,w,t)}recordEnd(d){return(d=this._meshes.self.recordEnd(this._currentRecordOverlaps))&&0!==this._currentRecordOverlaps?
(this._copyIntoNeighbors(),this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):d}recordBounds(d,w,t,l){this._bufferingEnabled&&this._addOverlap(d,w,t,l)}recordCount(){return this._meshes.self.recordCount()}metricStart(d){this._meshes.self.metricStart(d)}metricBoxWrite(d){this._meshes.self.metricBoxWrite(d)}metricEnd(){this._meshes.self.metricEnd()}vertexWrite(d){this._meshes.self.vertexWrite(d)}vertexWriteF32(d){this._meshes.self.vertexWriteF32(d)}vertexWriteRegion(d){this._meshes.self.vertexWriteRegion(d)}indexWrite(d){this._meshes.self.indexWrite(d)}serialize(d){const w=
{message:[],transferList:[]},t=this._meshes.self.serialize();w.message.push({tileId:this.tileKey.id,...t.message});w.transferList.push(...t.transferList);this._meshes.neighbors.forEach((l,e)=>{l=l.serialize();var u=1<<e;e=c(u);u=h(u);e=f.getPow2NeighborKey(new r(this.tileKey),e,u,d);w.message.push({tileId:e.id,...l.message});w.transferList.push(...l.transferList)});return w}_addOverlap(d,w,t,l){t=Math.min(m.tileSize/2,t);l=Math.min(m.tileSize/2,l);this._currentRecordOverlaps|=255^((d<0+t?148:d>=m.tileSize-
t?41:189)|(w<0+l?224:w>=m.tileSize-l?7:231))}_copyIntoNeighbors(){for(let t=0;8>t;t++){var d=1<<t;if(this._currentRecordOverlaps&d){if(this._copyBufferedDataIntoSelf){var w=-c(d)*m.tileSize;d=-h(d)*m.tileSize;if(0!==d)continue;this._meshes.self.copyLast(w,d);continue}this._meshes.neighbors[t]||(this._meshes.neighbors[t]=new b.MeshData(d,Math.floor(this._sizeHint/16)));w=this._meshes.neighbors[t];const l=-c(d)*m.tileSize;d=-h(d)*m.tileSize;w.copyLastFrom(this._meshes.self,l,d)}}}}a.MultiTileMeshData=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(a,q,r,g,p){class m{constructor(b,f=0){this._id=b;this._sizeHint=f;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=0;this._didEntityStart=!1;this._instanceIdToVertexData=new Map;this._recordVertexCount=this._recordVertexStart=this._recordIndexCount=
this._recordIndexStart=0;this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new p(Uint32Array,this._sizeHint*q.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const b=[],f=[],c=this._entities.buffer();for(const h of this._instanceIdToVertexData.values())f.push(h.serialize(b));return{message:{data:f,entities:c},transferList:b}}vertexCount(){return this._current.writer?.vertexCount??
0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(b){this._current.writer.vertexEnsureSize(b)}indexEnsureSize(b){this._current.writer.indexEnsureSize(b)}vertexWrite(b){this._current.writer.writeVertex(b)}vertexWriteRegion(b){this._current.writer.writeVertexRegion(b)}vertexWriteF32(b){this._current.writer.writeVertexF32(b)}recordBounds(b,f,c,h){}indexWrite(b){this._current.writer.writeIndex(b)}metricStart(b){this._current.metric=b}metricEnd(){this._current.metric.bounds.length&&
this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(b){this._current.metric.bounds.push(b)}entityStart(b,f=b){this._entityIdIndex=this._entities.push(b);this._entitySortKeyIndex=this._entities.writeF32(f);this._entityRecordCountOffset=this._entities.push(0);this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),
this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(b,f,c=0){this._current.writer=this._getVertexWriter(b,f);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=b;this._current.layoutHash=f.hash;this._current.textureKey=c}recordEnd(b=0){const f=this._current.vertexStart,c=this._current.writer.vertexCount-f;if(!c)return!1;const h=this._current.indexStart,
n=this._current.writer.indexCount-h;this._recordIndexStart=h;this._recordIndexCount=n;this._recordVertexStart=f;this._recordVertexCount=c;this._entities.incr(this._entityRecordCountOffset);r.write(this._entities,this._current.instanceId,this._current.textureKey,h,n,f,c,b);return!0}copyLast(b,f){var c=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset);r.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,
this._recordIndexCount,c,this._recordVertexCount,0);var h=this._current.writer.indexWriter;const n=this._current.writer.vertexWriter;var d=this._recordIndexStart+this._recordIndexCount,w=this._recordVertexCount;for(var t=this._recordIndexStart;t!==d;t++){const l=h.getValue(t);h.push(l+w)}h=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;w=this._recordVertexStart*h;for(d=(this._recordVertexStart+this._recordVertexCount)*h;w!==d;w++)t=n.getValue(w),n.push(t);d=this._current.writer.layout.position;
w=d.packPrecisionFactor??1;d=d.offset/Uint32Array.BYTES_PER_ELEMENT;b*=w;f*=w;for(c*=h;c<=n.length;c+=h)n.i1616Add(c+d,b,f)}copyLastFrom(b,f,c){var h=b._entities.getValue(b._entityIdIndex),n=this._entities.getValue(this._entityIdIndex);h!==n&&(n=b._entities.getValueF32(b._entitySortKeyIndex),this.entityStart(h,n));this.recordStart(b._current.instanceId,b._current.writer.layout,b._current.textureKey);h=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;var d=this._current.vertexStart,
w=b._current.vertexStart-d;const t=this._current.writer.indexWriter;n=this._current.writer.vertexWriter;const l=b._current.writer.indexWriter;var e=b._current.writer.vertexWriter;for(let u=b._current.indexStart;u!==l.length;u++){const x=l.getValue(u);t.push(x-w)}for(b=b._current.vertexStart*h;b!==e.length;b++)w=e.getValue(b),n.push(w);b=this._current.writer.layout.position;e=b.packPrecisionFactor??1;b=b.offset/Uint32Array.BYTES_PER_ELEMENT;f*=e;c*=e;for(d*=h;d<=n.length;d+=h)n.i1616Add(d+b,f,c);this.recordEnd()}_getVertexWriter(b,
f){const c=this._instanceIdToVertexData;c.has(b)||c.set(b,new g.VertexDataWriter(b,f,this._sizeHint));return c.get(b)}}a.MeshData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(a,q){class r{constructor(g,p){this.id=g;this.sortKey=p;this.records=[]}serialize(g){g.push(this.id);g.writeF32(this.sortKey);q.serializeList(g,this.records);return g}static deserialize(g){var p=
g.readInt32();const m=g.readF32();p=new r(p,m);p.records=q.deserializeList(g,a)??[];return p}}r.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+a.byteSizeHint;return r})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class a{constructor(q,r,g,p,m,b,f){this.instanceId=q;this.textureKey=r;this.indexStart=g;this.indexCount=p;this.vertexStart=m;this.vertexCount=b;this.overlaps=f}updateBaseOffsets(q){this.vertexStart+=q.vertexFrom;this.indexStart+=q.indexFrom}clone(){return new a(this.instanceId,
this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(q,r,g,p,m,b,f,c){q.push(r);q.push(g);q.push(p);q.push(m);q.push(b);q.push(f);q.push(c)}serialize(q){q.push(this.instanceId);q.push(this.textureKey);q.push(this.indexStart);q.push(this.indexCount);q.push(this.vertexStart);q.push(this.vertexCount);q.push(this.overlaps);return q}static deserialize(q){const r=q.readInt32(),g=q.readInt32(),p=q.readInt32(),m=q.readInt32(),b=q.readInt32(),f=q.readInt32();
q=q.readInt32();return new a(r,g,p,m,b,f,q)}}a.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return a})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(a){a.deserializeList=function(q,r,g){var p=q.readInt32();p=Array(p);for(let m=0;m<p.length;m++)p[m]=r.deserialize(q,g);return p};a.serializeList=function(q,r){if(null===r)q.push(0);else{q.push(r.length);for(const g of r)g.serialize(q);return q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(a,q){class r{constructor(g,p,m=0){const b=6*m*Uint32Array.BYTES_PER_ELEMENT;m=4*m*p.stride;const f=p.stride/4,c=p.attributes.find(h=>"pos"===h.name||"position"===h.name);if(!c)throw Error("InternalError: Unable to find position attribute");this.layout={...p,position:c};this._indices=new q(Uint32Array,b);this._vertices=new q(Uint32Array,m);this._metrics=new q(Uint32Array,0);this._metricCountOffset=
this._metrics.push(0);this._strideInt=f;this._instanceId=g}serialize(g){const p=this._indices.buffer(),m=this._vertices.buffer(),b=this._metrics.length?this._metrics.buffer():null;g.push(p,m);return{instanceId:this._instanceId,layout:this.layout,indices:p,vertices:m,metrics:b}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(g){this._vertices.ensureSize(g)}indexEnsureSize(g){this._indices.ensureSize(g)}writeIndex(g){this._indices.push(g)}writeVertex(g){this._vertices.push(g)}writeVertexRegion(g){this._vertices.writeRegion(g)}writeVertexF32(g){this._vertices.writeF32(g)}writeMetric(g){this._metrics.incr(this._metricCountOffset);
g.serialize(this._metrics)}}a.VertexDataWriter=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class a{get length(){return this._pos}constructor(q,r){this._pos=0;r=r?this._roundToNearest(r,q.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(r);this._buffer=new q(this._array);this._ctor=q;this._i16View=new Int16Array(this._array)}_roundToNearest(q,r){q=Math.round(q);return 1===r?q:q+(r-q%r)}_ensureSize(q){if(this._pos+
q>=this._buffer.length){q=this._roundToNearest(1.25*(this._array.byteLength+q*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);q=new ArrayBuffer(q);const r=new this._ctor(q);r.set(this._buffer,0);this._array=q;this._buffer=r;this._i16View=new Int16Array(this._array)}}ensureSize(q){this._ensureSize(q)}writeF32(q){this._ensureSize(1);const r=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=q;this._pos++;return r}push(q){this._ensureSize(1);const r=this._pos;this._buffer[this._pos++]=
q;return r}writeFixed(q){this._buffer[this._pos++]=q}setValue(q,r){this._buffer[q]=r}i1616Add(q,r,g){this._i16View[2*q]+=r;this._i16View[2*q+1]+=g}getValue(q){return this._buffer[q]}getValueF32(q){return(new Float32Array(this._array,4*q,1))[0]}incr(q){if(this._buffer.length<q)throw Error("Increment index overflows the target buffer");this._buffer[q]++}decr(q){this._buffer[q]--}writeRegion(q){this._ensureSize(q.length);const r=this._pos;this._buffer.set(q,this._pos);this._pos+=q.length;return r}writeManyFrom(q,
r,g){for(this._ensureSize(g-r);r!==g;r++)this.writeFixed(q._buffer[r])}buffer(){const q=this._array.slice(0,4*this._pos);this.destroy();return q}toArray(){return[...this._buffer]}seek(q){this._pos=q}destroy(){this._buffer=this._array=null}}return a})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(a){a.getPow2NeighborKey=function(q,r,g,p){q=q.clone();const m=1<<q.level;r=q.col+r;g=q.row+g;p&&0>r?(q.col=r+m,--q.world):r>=m?(q.col=r-m,q.world+=1):q.col=r;q.row=
g;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/FeatureMeshFactory":function(){define(["exports","./MeshFactory","../../util/createMatcher"],function(a,q,r){class g extends q.AMeshFactory{static async create(p,m){const b=await r.createMatcher(p,m.symbology);p=m.labels?await r.createMatcher(p,m.labels):null;return new g(b,p)}constructor(p,m){super();this._symbology=p;this._labels=m}destroy(){}async enqueueMatcherRequests(p,m){await Promise.all([this._symbology.fetchResources(p,
m),this._labels?.fetchResources(p,m)])}enqueueWriterRequests(p,m,b){var f=this._symbology.match(m,b);if(f){for(const c of f)c.enqueueRequest(p,m,b);if(this._labels&&(f=this._labels.match(m,b)))for(const c of f)c.enqueueRequest(p,m,b)}}write(p,m,b,f,c){const h=this._symbology.match(b,f);if(h){for(var n of h)n.write(p,m,b,f,c);if(1<=p.entityRecordCount()&&this._labels&&(n=this._labels.match(b,f)))for(const d of n)d.setReferences(h),d.write(p,m,b,f,c)}}getSortKey(p,m){return this._symbology.getSortKey(p,
m)}}a.FeatureMeshFactory=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/MeshFactory":function(){define(["exports"],function(a){class q{}a.AMeshFactory=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/createMatcher":function(){define("exports ./DictionaryMatcher ./IntervalMatcher ./LabelMatcher ./MapMatcher ./Matcher".split(" "),function(a,q,r,g,p,m){async function b(h,n){switch(n.type){case "simple":case "heatmap":case "dot-density":case "pie-chart":return m.FeatureMatcher.from(h,
n);case "interval":return r.IntervalMatcher.fromIntervalSchema(h,n);case "dictionary":return q.DictionaryMatcher.fromDictionaryRenderer(h,n);case "label":return g.LabelMatcher.fromLabelSchema(h,n);case "map":return p.MapMatcher.fromMatcherSchema(h,n);case "subtype":return f.fromSubtypes(h,n);case "cluster":return c.fromClusterSchema(h,n);default:throw Error("Impl");}}class f extends m.FeatureMatcher{constructor(h,n){super();this._subMatchers=h;this._subtypeField=n}static async fromSubtypes(h,n){const d=
new Map,w=[];for(const t in n.renderers){const l=parseInt(t,10),e=b(h,n.renderers[t]).then(u=>d.set(l,u));w.push(e)}await Promise.all(w);return new f(d,n.subtypeField)}match(h,n){var d=h.readAttribute(this._subtypeField);return(d=this._subMatchers.get(d))?d.match(h,n):null}}class c extends m.FeatureMatcher{static async fromClusterSchema(h,n){const [d,w]=await Promise.all([b(h,n.feature),b(h,n.cluster)]);return new c(d,w)}constructor(h,n){super();this._featureMatcher=h;this._clusterMatcher=n}match(h,
n){return 1===h.readAttribute("cluster_count")?this._featureMatcher.match(h,n):this._clusterMatcher.match(h,n)}}a.ClusterMatcher=c;a.SubtypeMatcher=f;a.createMatcher=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/DictionaryMatcher":function(){define(["exports","./Matcher"],function(a,q){class r extends q.FeatureMatcher{static async fromDictionaryRenderer(g,p){return new r(g,p)}constructor(g,p){super();this._context=g;this._schema=p;this._hashToGroup=
new Map}get fieldMap(){return this._schema.fieldMap}async fetchResources(g,p){p=p.getCursor();const m=[];for(;p.next();)m.push(this._updateMeshWriterGroup(g,p));await Promise.all(m)}match(g,p){g=g.getAttributeHash();return this._hashToGroup.get(g)}async _updateMeshWriterGroup(g,p){const m=p.readLegacyFeatureForDisplay();p=p.getAttributeHash();!this._hashToGroup.has(p)&&(this._hashToGroup.set(p,null),g=await g.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:m}))&&(g=await this._context.createMeshWriters(g.meshes),
this._hashToGroup.set(p,g))}}a.DictionaryMatcher=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(a){class q{constructor(){this._backgroundFillResult=this._defaultResult=null}static async from(r,g){const p=new q;p.setDefault(await r.createMeshWriters(g.meshes));return p}size(){return 1}getDefault(){return this._defaultResult}setDefault(r){this._defaultResult=r}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(r){this._backgroundFillResult=
r}match(r,g){return(r=this.doMatch(r,g)||this.getDefault())&&0<r.length&&(g=this.getBackgroundFill())?[...g,...r]:r}getSortKey(r,g){return 0}doMatch(r,g){return null}async fetchResources(r,g){}}a.FeatureMatcher=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/IntervalMatcher":function(){define(["exports","./Matcher"],function(a,q){class r extends q.FeatureMatcher{constructor(g,p){super();this._intervals=[];this._isMaxInclusive=p;this._field=g}static async fromIntervalSchema(g,
p){var m=await g.storage.createComputedField(p);const b=new r(m,p.isMaxInclusive);await Promise.all(p.intervals.map(async f=>{const c=await g.createMeshWriters(f.meshes);b.add(f,c)}));m=await g.createMeshWriters(p.defaultSymbol);b.setDefault(m);p=await g.createMeshWriters(p.backgroundFill);b.setBackgroundFill(p);return b}add(g,p){this._intervals.push({interval:g,result:p});this._intervals.sort((m,b)=>m.interval.min-b.interval.min)}size(){return super.size()+this._intervals.length}doMatch(g,p){g=this._field?.read(g,
p);if(null==g||isNaN(g)||Infinity===g||-Infinity===g)return null;for(p=0;p<this._intervals.length;p++){const {interval:m,result:b}=this._intervals[p],f=this._isMaxInclusive?g<=m.max:g<m.max;if(g>=m.min&&f)return b}return null}}a.IntervalMatcher=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/LabelMatcher":function(){define(["exports","./Matcher"],function(a,q){class r extends q.FeatureMatcher{static async fromLabelSchema(g,p){p=p.classes.map(async m=>
{const b=await g.createMeshWriters(m.meshes);return{minScale:m.minScale,maxScale:m.maxScale,meshes:b,expression:null,where:await g.storage.createWhereClause(m.where)}});p=await Promise.all(p);return new r(p)}constructor(g){super();this._labels=g}match(g,p){if(!this._labels.length)return null;p=this._getLabels(p.$view.scale);const m=[];for(const b of p)b.where&&!b.where(g)||m.push(...b.meshes);return m}_getLabels(g){return this._labels.filter(p=>this._validForTileScale(p,g))}_validForTileScale(g,p){return(!g.minScale||
g.minScale>=p-p/4)&&(!g.maxScale||g.maxScale<=p+p/2)}}a.LabelMatcher=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MapMatcher":function(){define(["exports","./Matcher"],function(a,q){class r extends q.FeatureMatcher{constructor(g,p){super();this._defaultSymbolSortKey=0;this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fields=g;this._separator=p||""}static async fromMatcherSchema(g,p){var m=p.expression?[g.storage.createComputedField({expression:p.expression})]:
[p.field?g.storage.createComputedField({field:p.field}):null,p.field2?g.storage.createComputedField({field:p.field2}):null,p.field3?g.storage.createComputedField({field:p.field3}):null];m=(await Promise.all(m)).filter(f=>!!f);const b=new r(m,p.fieldDelimiter);m=await g.createMeshWriters(p.defaultSymbol);b.setDefault(m);m=await g.createMeshWriters(p.backgroundFill);b.setBackgroundFill(m);await Promise.all(p.map.map(async(f,c)=>{const h=await g.createMeshWriters(f.symbol);"\x3cNull\x3e"===f.value?b.setNullResult(h):
b.add(f.value,h,c+1)}));return b}setNullResult(g){this._nullResult=g}getSortKey(g,p){g=this._getValueFromFields(g,p);return null==g||""===g||"\x3cNull\x3e"===g?0:(g=this._resultsMap.get(g.toString()))?g.sortKey:this._defaultSymbolSortKey}add(g,p,m){this._resultsMap.set(g.toString(),{meshWriters:p,sortKey:m});this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,m+1)}size(){return super.size()+this._resultsMap.size}doMatch(g,p){g=this._getValueFromFields(g,p);return null===this._nullResult||
null!=g&&""!==g&&"\x3cNull\x3e"!==g?null==g?null:this._resultsMap.get(g.toString())?.meshWriters:this._nullResult}_getValueFromFields(g,p){const m=[];for(const b of this._fields){const f=b.read(g,p);null==f||""===f?m.push("\x3cNull\x3e"):m.push(f)}return m.join(this._separator)}}a.MapMatcher=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../Utils","../../shaderGraph/techniques/mesh/AResourceProxy"],
function(a,q,r,g){class p extends g.AResourceProxy{constructor(m){super();this._fetcher=m;this._controller=new AbortController;this._pendingIds=new Set;this._pendingRequests=[];this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(m){var b=r.discardUrlIfHasUrlHash(m.resource);b=q.numericHash(JSON.stringify(b));if(this._pendingIds.has(b))return b;this._pendingIds.add(b);this._pendingRequests.push({...m,resourceId:b});
return b}async fetchEnqueuedResources(){const m=this._pendingRequests;this._pendingIds.clear();this._pendingRequests=[];const b=await this._fetcher.fetch(m,this._abortOptions);for(let f=0;f<b.length;f++)this._resourceIdToResource.set(m[f].resourceId,b[f])}async fetchResourceImmediate(m){m=await this._fetcher.fetch([m],this._abortOptions);if(1!==m.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return m[0]}async fetchDictionaryResourceImmediate(m){m=await this._fetcher.fetchDictionary([m],
this._abortOptions);if(1!==m.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return m[0]}getResource(m){return this._resourceIdToResource.get(m)}}a.ResourceProxy=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ../../../../core/RandomLCG ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../chunks/builtins ../../../webgl/GLObjectType ../../../webgl/getDataTypeBytes ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexElementDescriptor".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l){function e(y){const A={};for(const k in y){let v=0;A[k]=y[k].map(B=>{const z=new l.VertexElementDescriptor(B.name,B.count,B.type,v,0,B.normalized||!1);v+=B.count*d.getDataTypeBytes(B.type);return z});A[k]?.forEach(B=>B.stride=v)}return A}const u=()=>r.getLogger("esri.views.2d.engine.webgl.Utils"),x=new Map;a.charCodes=function(y){const A=[];for(let k=0;k<y.length;k++)A.push(y.charCodeAt(k));return A};a.createAttributeLayout=e;a.createProgramDescriptor=(y,A)=>
{if(!x.has(y)){const B=e(A);var k=B;var v={};for(const z in k){const E=k[z];v[z]=E?.length?E[0].stride:0}k=v;v=new Map;for(const z in A)for(const E of A[z])v.set(E.name,E.location);x.set(y,{strides:k,bufferLayouts:B,attributes:v})}return x.get(y)};a.createTexture=function(y,A,k){const v=new t.TextureDescriptor(A.width,A.height);v.dataType=A.dataType;A.depth&&(v.depth=A.depth);A.flipped&&(v.flipped=A.flipped);A.hasMipmap&&(v.hasMipmap=A.hasMipmap);v.internalFormat=A.internalFormat;A.isImmutable&&(v.isImmutable=
A.isImmutable);A.isOpaque&&(v.isOpaque=A.isOpaque);A.maxAnisotropy&&(v.maxAnisotropy=A.maxAnisotropy);v.pixelFormat=A.pixelFormat;A.preMultiplyAlpha&&(v.preMultiplyAlpha=A.preMultiplyAlpha);A.samplingMode&&(v.samplingMode=A.samplingMode);A.target&&(v.target=A.target);v.uniform=A.uniform;A.unpackAlignment&&(v.unpackAlignment=A.unpackAlignment);A.wrapMode&&(v.wrapMode=A.wrapMode);return new w.Texture(y,v,k)};a.discardUrlIfHasUrlHash=function(y){return"url"in y&&"urlHash"in y?{...y,url:""}:y};a.getCapType=
function(y){switch(y){case "butt":return g.CapType.BUTT;case "round":return g.CapType.ROUND;case "square":return g.CapType.SQUARE;default:return u().error(new q("mapview-invalid-type",`Cap type ${y} is not a valid option. Defaulting to round`)),g.CapType.ROUND}};a.getJoinType=function(y){switch(y){case "miter":return g.JoinType.MITER;case "bevel":return g.JoinType.BEVEL;case "round":return g.JoinType.ROUND;default:return u().error(new q("mapview-invalid-type",`Join type ${y} is not a valid option. Defaulting to round`)),
g.JoinType.ROUND}};a.getPixelArrayCtor=function(y){switch(y){case f.PixelType.UNSIGNED_BYTE:return Uint8Array;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case f.PixelType.FLOAT:return Float32Array;default:u().error(new q("webgl-utils",`Unable to handle type ${y}`))}};a.getPixelBytes=function(y){switch(y){case f.PixelType.UNSIGNED_BYTE:return 1;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case f.PixelType.FLOAT:return 4;default:u().error(new q("webgl-utils",`Unable to handle type ${y}`))}};
a.isSVGImage=y=>y.includes("data:image/svg+xml");a.isValidSVG=y=>{if(!y)return!1;y=y.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(y)&&/[\dz]$/i.test(y)&&4<y.length?!0:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,q,r,g){function p(b,f){switch(f){case b.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case b.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case b.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case b.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case b.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case b.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const m=!!r("enable-feature:webgl-debug");a.checkWebGLError=function(b){if(m){var f=b.getError();f&&(b=p(b,f),f=Error().stack,g.getLogger("esri.views.webgl.checkWebGLError").error(new q("webgl-error","WebGL error occurred",{message:b,stack:f})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(l){return null!=l&&"type"in l&&l.type===f.GLObjectType.Texture}function d(l,e){const u=Math.max(l.width,l.height);return u>e?(r.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${l.width}x${l.height} to device limit ${e}`),e/=u,l.width=Math.round(l.width*e),l.height=Math.round(l.height*e),!1):!0}function w(l){return l.descriptor.target===b.TextureType.TEXTURE_CUBE_MAP?b.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:b.TextureType.TEXTURE_2D}
class t{constructor(l,e,u=null){this._context=l;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;l.instanceCounter.increment(b.ResourceType.FramebufferObject,this);l=n(e)?e:new h.Texture(this._context,e);this._colorAttachments.set(b.ColorAttachment.COLOR_ATTACHMENT0,l);this._validateTextureDescriptor(l.descriptor);this._validateColorAttachmentPoint(b.ColorAttachment.COLOR_ATTACHMENT0);null!=u&&(n(u)||null!=u&&"pixelFormat"in
u?(this._depthStencilTexture=n(u)?u:new h.Texture(this._context,u),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=u=null!=u&&"type"in u&&u.type===f.GLObjectType.RenderBuffer?u:new c.Renderbuffer(this._context,u),this._validateRenderBufferDescriptor(u.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var l=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((e,u)=>this.detachColorTexture(u)?.dispose());this.detachDepthStencilBuffer()?.dispose();
this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(l);this._context.instanceCounter.decrement(b.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??
0}get height(){return this._colorAttachments.get(b.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((l,[,e])=>l+e.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(l){return(l=this._colorAttachments.get(l))&&n(l)?l:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(l,e=b.ColorAttachment.COLOR_ATTACHMENT0){l&&(this._validateColorAttachmentPoint(e),this._validateTextureDescriptor(l.descriptor),
this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(l.glName,e)),this._colorAttachments.set(e,l))}detachColorTexture(l=b.ColorAttachment.COLOR_ATTACHMENT0){const e=this._colorAttachments.get(l);if(e){if(this._initialized){const u=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,l);this._context.bindFramebuffer(u)}this._colorAttachments.delete(l);return e}}setColorTextureTarget(l,
e=b.ColorAttachment.COLOR_ATTACHMENT0){const u=this._colorAttachments.get(e);u&&this._framebufferTexture2D(u.glName,e,l)}attachDepthStencil(l){if(l)switch(l.type){case f.GLObjectType.Texture:return this._attachDepthStencilTexture(l);case f.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(l)}}_attachDepthStencilTexture(l){if(null!=l){var e=l.descriptor;e.pixelFormat!==b.PixelFormat.DEPTH_STENCIL&&e.pixelFormat!==b.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
e.dataType!==b.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._validateTextureDescriptor(e);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(l.glName,b.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=l}}detachDepthStencilTexture(){const l=this._depthStencilTexture;if(l&&this._initialized){const e=this._context.getBoundFramebufferObject();
this._context.bindFramebuffer(this);this._framebufferTexture2D(null,b.DepthStencilAttachment);this._context.bindFramebuffer(e)}this._depthStencilTexture=null;return l}_attachDepthStencilBuffer(l){if(null!=l){var e=l.descriptor;this._validateRenderBufferDescriptor(e);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const u=this._context.gl;e=this._getGLAttachmentPoint(e);u.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,e,u.RENDERBUFFER,l.glName)}this._depthStencilBuffer=
l}}detachDepthStencilBuffer(){const l=this._depthStencilBuffer;if(l&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const u=this._context.gl,x=this._getGLAttachmentPoint(l.descriptor);u.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,x,u.RENDERBUFFER,null);this._context.bindFramebuffer(e)}this._depthStencilBuffer=null;return l}copyToTexture(l,e,u,x,y,A,k){(0>l||0>e||0>y||0>A)&&console.error("Offsets cannot be negative!");(0>=u||0>=
x)&&console.error("Copy width and height must be greater than zero!");var v=k.descriptor;k.descriptor.target!==b.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==v?.width||null==v?.height||l+u>this.width||e+x>this.height||y+u>v.width||A+x>v.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");v=this._context;k=v.bindTexture(k,h.Texture.TEXTURE_UNIT_FOR_UPDATES);v.setActiveTexture(h.Texture.TEXTURE_UNIT_FOR_UPDATES);
v.bindFramebuffer(this);v.gl.copyTexSubImage2D(b.TextureType.TEXTURE_2D,0,y,A,l,e,u,x);v.bindTexture(k,h.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(l,e,u,x,y,A,k){(0>=u||0>=x)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(l,e,u,x,y,A,k)}async readPixelsAsync(l,e,u,x,y,A,k){const {gl:v}=this._context,B=p.BufferObject.createPixelPack(this._context,b.Usage.STREAM_READ,
k.byteLength);this._context.bindBuffer(B);this._context.bindFramebuffer(this);v.readPixels(l,e,u,x,y,A,0);this._context.unbindBuffer(b.BufferType.PIXEL_PACK_BUFFER);await B.getSubDataAsync(k);B.dispose()}resize(l,e){if(this.width!==l||this.height!==e){var u={width:l,height:e};d(u,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(x=>x.resize(u.width,u.height));this._depthStencilTexture?.resize(u.width,u.height);this._initialized&&(d(u,this._context.parameters.maxRenderbufferSize),
this._depthStencilBuffer?.resize(u.width,u.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(l=b.FramebufferTarget.FRAMEBUFFER){const e=this._context.gl;if(this._initialized)e.bindFramebuffer(l,this.glName);else{this._glName&&e.deleteFramebuffer(this._glName);var u=e.createFramebuffer();e.bindFramebuffer(l,u);this._colorAttachments.forEach((x,y)=>this._framebufferTexture2D(x.glName,y,w(x),l));if(this._depthStencilBuffer){const x=
this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(l,x,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,e.DEPTH_STENCIL_ATTACHMENT,w(this._depthStencilTexture),l);m.webglDebugEnabled()&&e.checkFramebufferStatus(l)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=u;this._initialized=!0}}_framebufferTexture2D(l,e=b.ColorAttachment.COLOR_ATTACHMENT0,
u=b.TextureType.TEXTURE_2D,x=b.FramebufferTarget.FRAMEBUFFER,y=0){this._context.gl.framebufferTexture2D(x,e,u,l,y)}_disposeDepthStencilAttachments(){const l=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);l.framebufferRenderbuffer(b.FramebufferTarget.FRAMEBUFFER,e,l.RENDERBUFFER,null)}this._depthStencilBuffer=g.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,l.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=g.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(l){l.target!==b.TextureType.TEXTURE_2D&&l.target!==b.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");d(l,this._context.parameters.maxTextureSize);this._validateBufferDimensions(l)}_validateRenderBufferDescriptor(l){d(l,this._context.parameters.maxRenderbufferSize);
this._validateBufferDimensions(l)}_validateBufferDimensions(l){0>=l.width&&(l.width=this.width);0>=l.height&&(l.height=this.height);0<this.width&&0<this.height&&(this.width!==l.width||this.height!==l.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(l){switch(l.internalFormat){case b.RenderbufferFormat.DEPTH_COMPONENT16:case b.RenderbufferFormat.DEPTH_COMPONENT24:case b.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case b.RenderbufferFormat.DEPTH24_STENCIL8:case b.RenderbufferFormat.DEPTH32F_STENCIL8:case b.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;
case b.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(l){if(-1===t._MAX_COLOR_ATTACHMENTS){const {gl:e}=this._context;t._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}l-=b.ColorAttachment.COLOR_ATTACHMENT0;l+1>t._MAX_COLOR_ATTACHMENTS&&r.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${l+1}. Implementation supports up to ${t._MAX_COLOR_ATTACHMENTS} color attachments`)}}
t._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=t;a.ensureAttachmentMaxSize=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/has ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),function(a,q,r,g,p,m,b){class f{static createIndex(c,h,n){return new f(c,b.BufferType.ELEMENT_ARRAY_BUFFER,h,n)}static createVertex(c,h,n){return new f(c,b.BufferType.ARRAY_BUFFER,h,
n)}static createUniform(c,h,n){return new f(c,b.BufferType.UNIFORM_BUFFER,h,n)}static createPixelPack(c,h=b.Usage.STREAM_READ,n){c=new f(c,b.BufferType.PIXEL_PACK_BUFFER,h);n&&c.setSize(n);return c}static createPixelUnpack(c,h=b.Usage.STREAM_DRAW,n){return new f(c,b.BufferType.PIXEL_UNPACK_BUFFER,h,n)}static createTransformFeedback(c,h=b.Usage.STATIC_DRAW,n){c=new f(c,b.BufferType.TRANSFORM_FEEDBACK_BUFFER,h);c.setSize(n);return c}constructor(c,h,n,d){this._context=c;this.bufferType=h;this.usage=
n;this._glName=null;this._size=-1;this._indexType=void 0;c.instanceCounter.increment(b.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();m.checkWebGLError(this._context.gl);d&&this.setData(d)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===b.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===b.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===
b.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===b.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(b.ResourceType.BufferObject,this),this._context=null):this._glName&&g.getLogger("esri.views.webgl.BufferObject").warn("Leaked WebGL buffer object")}setSize(c,h=null){if(this.bufferType===b.BufferType.ELEMENT_ARRAY_BUFFER&&null!=h)switch(this._indexType=h,h){case b.DataType.UNSIGNED_SHORT:c*=
2;break;case b.DataType.UNSIGNED_INT:c*=4}this._setBufferData(c)}setData(c){if(c){var h=c.byteLength;this.bufferType===b.BufferType.ELEMENT_ARRAY_BUFFER&&(p.isUint16Array(c)&&(h/=2,this._indexType=b.DataType.UNSIGNED_SHORT),p.isUint32Array(c)&&(h/=4,this._indexType=b.DataType.UNSIGNED_INT));this._setBufferData(h,c)}}_setBufferData(c,h=null){this._size=c;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const d=this._context.gl;null!=h?
d.bufferData(this.bufferType,h,this.usage):d.bufferData(this.bufferType,c,this.usage);m.checkWebGLError(d);this._isVAOAware&&this._context.bindVAO(n)}setSubData(c,h,n,d){if(c){var w=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:t}=this._context;t.bufferSubData(this.bufferType,h*c.BYTES_PER_ELEMENT,c,n,d-n);m.checkWebGLError(t);this._isVAOAware&&this._context.bindVAO(w)}}getSubData(c,h=0,n,d){if(!(0>n||0>d)){var w=q.isArrayLike(c)?
c.BYTES_PER_ELEMENT:1;w*((n??0)+(d??0))>c.byteLength||(h+w*(d??0)>this.usedMemory&&g.getLogger("esri.views.webgl.BufferObject").warn("Potential problem getting subdata: requested data exceeds buffer size!"),w=this._context.gl,this.bufferType===b.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,b.BufferType.TRANSFORM_FEEDBACK_BUFFER),w.getBufferSubData(b.BufferType.TRANSFORM_FEEDBACK_BUFFER,h,c,n,d),this._context.unbindBuffer(b.BufferType.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,
b.BufferType.COPY_READ_BUFFER),w.getBufferSubData(b.BufferType.COPY_READ_BUFFER,h,c,n,d),this._context.unbindBuffer(b.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(c,h=0,n,d){await this._context.clientWaitAsync();this.getSubData(c,h,n,d)}}a.BufferObject=f;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var q=a.GLObjectType||(a.GLObjectType={});q[q.Texture=0]="Texture";
q[q.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(a,q,r,g){class p{constructor(m,b){this._context=m;this._descriptor=b;this.type=r.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(q.ResourceType.Renderbuffer,this);m=this._context.gl;this.glName=m.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,
height:c,internalFormat:h,multisampled:n}=b;n?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,h,f,c):m.renderbufferStorage(m.RENDERBUFFER,h,f,c);this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const m=this._descriptor.samples,b=this._context.parameters.maxSamples;return m?Math.min(m,b):b}get usedMemory(){return g.estimateMemory(this._descriptor)}resize(m,b){const f=this._descriptor;if(f.width!==m||f.height!==b)f.width=m,f.height=b,m=this._context.gl,
this._context.bindRenderbuffer(this),f.multisampled?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):m.renderbufferStorage(m.RENDERBUFFER,f.internalFormat,f.width,f.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(q.ResourceType.Renderbuffer,this),this._context=null)}}a.Renderbuffer=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(a,q){class r{constructor(g,p,m=p){this.internalFormat=g;this.width=p;this.height=m;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=r;a.estimateMemory=function(g){return 0>=g.width||0>=g.height||null==g.internalFormat?0:g.width*g.height*q.getBytesPerElementFormat(g.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports",
"../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],function(a,q,r,g,p){function m(f){f=f.gl;switch(f.getError()){case f.NO_ERROR:return null;case f.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case f.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case f.INVALID_OPERATION:return"The specified command is not allowed for the current state";case f.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";
case f.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case f.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function b(f){return f[0].stride}a.bindVertexBufferLayout=function(f,c,h,n,d=0){const w=f.gl;f.bindBuffer(h);for(const l of n)if(n=c.get(l.name),void 0===n)console.warn(`There is no location for vertex attribute '${l.name}' defined.`);else{h=d*l.stride;if(4>=l.count)w.vertexAttribPointer(n,l.count,l.type,l.normalized,l.stride,l.offset+h),w.enableVertexAttribArray(n),
0<l.divisor&&f.gl.vertexAttribDivisor(n,l.divisor);else if(9===l.count)for(var t=0;3>t;t++)w.vertexAttribPointer(n+t,3,l.type,l.normalized,l.stride,l.offset+12*t+h),w.enableVertexAttribArray(n+t),0<l.divisor&&f.gl.vertexAttribDivisor(n+t,l.divisor);else if(16===l.count)for(t=0;4>t;t++)w.vertexAttribPointer(n+t,4,l.type,l.normalized,l.stride,l.offset+16*t+h),w.enableVertexAttribArray(n+t),0<l.divisor&&f.gl?.vertexAttribDivisor(n+t,l.divisor);else console.error("Unsupported vertex attribute element count: "+
l.count);if(r.webglDebugEnabled()){n=m(f);t=p.getDataTypeBytes(l.type);const e=l.offset;t=Math.round(t/e)!==t/e?`. Offset not a multiple of stride. DataType requires ${t} bytes, but descriptor has an offset of ${e}`:"";n&&console.error(`Unable to bind vertex attribute "${l.name}" with baseInstanceOffset ${h}${t}:`,n,l)}}};a.getBytesPerElementFormat=function(f){switch(f){case g.PixelFormat.ALPHA:case g.PixelFormat.LUMINANCE:case g.PixelFormat.RED:case g.PixelFormat.RED_INTEGER:case g.SizedPixelFormat.R8:case g.SizedPixelFormat.R8I:case g.SizedPixelFormat.R8UI:case g.SizedPixelFormat.R8_SNORM:case g.RenderbufferFormat.STENCIL_INDEX8:return 1;
case g.PixelFormat.LUMINANCE_ALPHA:case g.PixelFormat.RG:case g.PixelFormat.RG_INTEGER:case g.SizedPixelFormat.RGBA4:case g.SizedPixelFormat.R16F:case g.SizedPixelFormat.R16I:case g.SizedPixelFormat.R16UI:case g.SizedPixelFormat.RG8:case g.SizedPixelFormat.RG8I:case g.SizedPixelFormat.RG8UI:case g.SizedPixelFormat.RG8_SNORM:case g.SizedPixelFormat.RGB565:case g.SizedPixelFormat.RGB5_A1:case g.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case g.PixelFormat.DEPTH_COMPONENT:case g.PixelFormat.RGB:case g.PixelFormat.RGB_INTEGER:case g.SizedPixelFormat.RGB8:case g.SizedPixelFormat.RGB8I:case g.SizedPixelFormat.RGB8UI:case g.SizedPixelFormat.RGB8_SNORM:case g.SizedPixelFormat.SRGB8:case g.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case g.PixelFormat.DEPTH_STENCIL:case g.PixelFormat.DEPTH24_STENCIL8:case g.PixelFormat.RGBA:case g.PixelFormat.RGBA_INTEGER:case g.SizedPixelFormat.RGBA8:case g.SizedPixelFormat.R32F:case g.SizedPixelFormat.R11F_G11F_B10F:case g.SizedPixelFormat.RG16F:case g.SizedPixelFormat.R32I:case g.SizedPixelFormat.R32UI:case g.SizedPixelFormat.RG16I:case g.SizedPixelFormat.RG16UI:case g.SizedPixelFormat.RGBA8I:case g.SizedPixelFormat.RGBA8UI:case g.SizedPixelFormat.RGBA8_SNORM:case g.SizedPixelFormat.SRGB8_ALPHA8:case g.SizedPixelFormat.RGB9_E5:case g.SizedPixelFormat.RGB10_A2UI:case g.SizedPixelFormat.RGB10_A2:case g.RenderbufferFormat.DEPTH_STENCIL:case g.RenderbufferFormat.DEPTH_COMPONENT32F:case g.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case g.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case g.SizedPixelFormat.RGB16F:case g.SizedPixelFormat.RGB16I:case g.SizedPixelFormat.RGB16UI:return 6;case g.SizedPixelFormat.RG32F:case g.SizedPixelFormat.RG32I:case g.SizedPixelFormat.RG32UI:case g.SizedPixelFormat.RGBA16F:case g.SizedPixelFormat.RGBA16I:case g.SizedPixelFormat.RGBA16UI:return 8;case g.SizedPixelFormat.RGB32F:case g.SizedPixelFormat.RGB32I:case g.SizedPixelFormat.RGB32UI:return 12;case g.SizedPixelFormat.RGBA32F:case g.SizedPixelFormat.RGBA32I:case g.SizedPixelFormat.RGBA32UI:return 16;
case g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case g.CompressedTextureFormat.COMPRESSED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case g.CompressedTextureFormat.COMPRESSED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=m;a.getStride=b;a.unbindVertexBufferLayout=function(f,c,h,n){const d=f.gl;f.bindBuffer(h);for(const w of n)if(h=c.get(w.name),4>=w.count)d.disableVertexAttribArray(h),w.divisor&&0<w.divisor&&f.gl?.vertexAttribDivisor(h,0);else if(9===w.count)for(n=
0;3>n;n++)d.disableVertexAttribArray(h+n),w.divisor&&0<w.divisor&&f.gl?.vertexAttribDivisor(h+n,0);else if(16===w.count)for(n=0;4>n;n++)d.disableVertexAttribArray(h+n),w.divisor&&0<w.divisor&&f.gl?.vertexAttribDivisor(h+n,0);else console.error("Unsupported vertex attribute element count: "+w.count);f.unbindBuffer(g.BufferType.ARRAY_BUFFER)};a.vertexCount=function(f,c){return f.vertexBuffers[c].usedMemory/b(f.layout[c])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports",
"./enums"],function(a,q){a.getDataTypeBytes=function(r){switch(r){case q.DataType.BYTE:case q.DataType.UNSIGNED_BYTE:return 1;case q.DataType.SHORT:case q.DataType.UNSIGNED_SHORT:case q.DataType.HALF_FLOAT:return 2;case q.DataType.FLOAT:case q.DataType.INT:case q.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(a,q,r,g,p,m,b,f){function c(u){(null!=u.width&&0>u.width||null!=u.height&&0>u.height||null!=u.depth&&0>u.depth)&&console.error("Negative dimension parameters are not allowed!")}function h(u,x){let y=x.samplingMode,A=x.samplingMode;if(y===p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||y===p.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)y=p.TextureSamplingMode.LINEAR,x.hasMipmap||(A=p.TextureSamplingMode.LINEAR);else if(y===p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||y===p.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)y=
p.TextureSamplingMode.NEAREST,x.hasMipmap||(A=p.TextureSamplingMode.NEAREST);u.texParameteri(x.target,u.TEXTURE_MAG_FILTER,y);u.texParameteri(x.target,u.TEXTURE_MIN_FILTER,A)}function n(u,x){"number"===typeof x.wrapMode?(u.texParameteri(x.target,u.TEXTURE_WRAP_S,x.wrapMode),u.texParameteri(x.target,u.TEXTURE_WRAP_T,x.wrapMode)):(u.texParameteri(x.target,u.TEXTURE_WRAP_S,x.wrapMode.s),u.texParameteri(x.target,u.TEXTURE_WRAP_T,x.wrapMode.t))}function d(u,x){const y=u.capabilities.textureFilterAnisotropic;
y&&u.gl.texParameterf(x.target,y.TEXTURE_MAX_ANISOTROPY,x.maxAnisotropy??1)}function w(u){return null!=u&&"type"in u&&"compressed"===u.type}function t(u){return null!=u&&!w(u)&&!(null!=u&&"byteLength"in u)}function l(u){return u===p.TextureType.TEXTURE_3D||u===p.TextureType.TEXTURE_2D_ARRAY}function e(u,x,y,A=1){x=Math.max(x,y);u===p.TextureType.TEXTURE_3D&&(x=Math.max(x,A));return Math.round(Math.log(x)/Math.LN2)+1}r=class u{constructor(x,y=null,A=null){this.type=m.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in x)this._descriptor=x,A=y;else{x=f.ValidatedTextureDescriptor.validate(x,y);if(!x)throw new q("Texture descriptor invalid");this._descriptor=x}this._descriptor.target===p.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(A):this.setData(A)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return b.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(p.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(x,y){const A=this._descriptor;if(A.width!==x||A.height!==y){if(this._wasImmutablyAllocated)throw new q("Immutable textures can't be resized!");A.width=x;A.height=y;this._descriptor.target===
p.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(x=null){for(let y=p.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;y<=p.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;y++)this._setData(x,y)}setData(x){this._setData(x)}_setData(x,y){if(this._descriptor.context?.gl){var A=this._descriptor.context.gl;g.checkWebGLError(A);this._glName||(this._glName=A.createTexture())&&this._descriptor.context.instanceCounter.increment(p.ResourceType.Texture,this);void 0===x&&(x=null);
var k=this._descriptor,v=y??k.target,B=l(v);null===x&&(k.width=k.width||4,k.height=k.height||4,B&&(k.depth=k.depth??1));y=this._descriptor.context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);c(k);this._configurePixelStorage();g.checkWebGLError(A);var z=this._deriveInternalFormat();if(t(x)){let E="width"in x?x.width:x.codedWidth,K="height"in x?x.height:x.codedHeight;x instanceof HTMLVideoElement&&(E=x.videoWidth,K=x.videoHeight);
k.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(v,z,k.hasMipmap,E,K,1);this._texImage(v,0,z,E,K,1,x);g.checkWebGLError(A);k.hasMipmap&&this.generateMipmap();k.width||(k.width=E);k.height||(k.height=K);B&&!k.depth&&(k.depth=1)}else{const {width:E,height:K,depth:I}=k;if(null==E||null==K)throw new q("Width and height must be specified!");if(B&&null==I)throw new q("Depth must be specified!");k.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(v,z,k.hasMipmap,E,K,I);if(w(x)){const D=
x.levels;x=e(v,E,K,I);x=Math.min(x-1,D.length-1);A.texParameteri(k.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,x);if(!(z in p.CompressedTextureFormat))throw new q("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((G,C,F,J)=>{this._compressedTexImage(v,G,z,C,F,J,D[Math.min(G,D.length-1)])},x)}else this._texImage(v,0,z,E,K,I,x),g.checkWebGLError(A),k.hasMipmap&&this.generateMipmap()}h(A,this._descriptor);n(A,this._descriptor);d(this._descriptor.context,
this._descriptor);g.checkWebGLError(A);this._descriptor.context.bindTexture(y,u.TEXTURE_UNIT_FOR_UPDATES)}}updateData(x,y,A,k,v,B,z=0){B||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var E=this._descriptor;const K=this._deriveInternalFormat(),{context:I,pixelFormat:D,dataType:G,target:C,isImmutable:F}=E;if(F&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");const J=I.bindTexture(this,
u.TEXTURE_UNIT_FOR_UPDATES,!0);(0>y||0>A||y+k>E.width||A+v>E.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:E}=I);z&&E.pixelStorei(E.UNPACK_SKIP_ROWS,z);t(B)?E.texSubImage2D(C,x,y,A,k,v,D,G,B):w(B)?E.compressedTexSubImage2D(C,x,y,A,k,v,K,B.levels[x]):E.texSubImage2D(C,x,y,A,k,v,D,G,B);z&&E.pixelStorei(E.UNPACK_SKIP_ROWS,0);I.bindTexture(J,u.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(x,y,A,k,v,B,z,E){E||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var K=this._descriptor;const I=this._deriveInternalFormat(),{context:D,pixelFormat:G,dataType:C,isImmutable:F,target:J}=K;if(F&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");l(J)||console.warn("Attempting to set 3D texture data on a non-3D texture");const T=D.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);D.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);(0>y||0>A||0>k||y+v>K.width||
A+B>K.height||k+z>K.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:K}=D);w(E)?(E=E.levels[x],K.compressedTexSubImage3D(J,x,y,A,k,v,B,z,I,E)):K.texSubImage3D(J,x,y,A,k,v,B,z,G,C,E);D.bindTexture(T,u.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const x=this._descriptor;if(!x.hasMipmap){if(this._wasImmutablyAllocated)throw new q("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=x.hasMipmap=!0;c(x)}x.samplingMode===
p.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,x.samplingMode=p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):x.samplingMode===p.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,x.samplingMode=p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const y=this._descriptor.context.bindTexture(this,u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(u.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(x.target);this._descriptor.context.bindTexture(y,u.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const x=
this._descriptor;if(x.hasMipmap){if(this._wasImmutablyAllocated)throw new q("Cannot delete mipmaps to immutable texture after allocation");x.hasMipmap=!1;this._samplingModeDirty=!0;c(x)}x.samplingMode===p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,x.samplingMode=p.TextureSamplingMode.LINEAR):x.samplingMode===p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,x.samplingMode=p.TextureSamplingMode.NEAREST)}setSamplingMode(x){x!==this._descriptor.samplingMode&&
(this._descriptor.samplingMode=x,this._samplingModeDirty=!0)}setWrapMode(x){x!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=x,c(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const x=this._descriptor,y=x.context.gl;this._samplingModeDirty&&(h(y,x),this._samplingModeDirty=!1);this._wrapModeDirty&&(n(y,x),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===p.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=
p.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case p.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case p.PixelFormat.RGBA:return this._descriptor.internalFormat=p.SizedPixelFormat.RGBA32F;case p.PixelFormat.RGB:return this._descriptor.internalFormat=p.SizedPixelFormat.RGB32F;default:throw new q("Unable to derive format");}case p.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case p.PixelFormat.RGBA:return this._descriptor.internalFormat=
p.SizedPixelFormat.RGBA8;case p.PixelFormat.RGB:return this._descriptor.internalFormat=p.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===p.PixelFormat.DEPTH_STENCIL?p.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const x=this._descriptor.context.gl,{unpackAlignment:y,flipped:A,preMultiplyAlpha:k}=this._descriptor;x.pixelStorei(x.UNPACK_ALIGNMENT,y);x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,A?1:0);x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
k?1:0)}_texStorage(x,y,A,k,v,B){const {gl:z}=this._descriptor.context;if(!(y in p.SizedPixelFormat))throw new q("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){A=A?e(x,k,v,B):1;if(l(x)){if(null==B)throw new q("Missing depth dimension for 3D texture upload");z.texStorage3D(x,A,y,k,v,B)}else z.texStorage2D(x,A,y,k,v);this._wasImmutablyAllocated=!0}}_texImage(x,y,A,k,v,B,z){const E=this._descriptor.context.gl,K=l(x),{isImmutable:I,pixelFormat:D,dataType:G}=this._descriptor;
if(I){if(null!=z)if(K){if(null==B)throw new q("Missing depth dimension for 3D texture upload");E.texSubImage3D(x,y,0,0,0,k,v,B,D,G,z)}else E.texSubImage2D(x,y,0,0,k,v,D,G,z)}else if(K){if(null==B)throw new q("Missing depth dimension for 3D texture upload");E.texImage3D(x,y,A,k,v,B,0,D,G,z)}else E.texImage2D(x,y,A,k,v,0,D,G,z)}_compressedTexImage(x,y,A,k,v,B,z){const E=this._descriptor.context.gl,K=l(x);if(this._descriptor.isImmutable){if(null!=z)if(K){if(null==B)throw new q("Missing depth dimension for 3D texture upload");
E.compressedTexSubImage3D(x,y,0,0,0,k,v,B,A,z)}else E.compressedTexSubImage2D(x,y,0,0,k,v,A,z)}else if(K){if(null==B)throw new q("Missing depth dimension for 3D texture upload");E.compressedTexImage3D(x,y,A,k,v,B,0,z)}else E.compressedTexImage2D(x,y,A,k,v,0,z)}_forEachMipmapLevel(x,y=Infinity){let {width:A,height:k,depth:v,hasMipmap:B,target:z}=this._descriptor;const E=z===p.TextureType.TEXTURE_3D;if(null==A||null==k||E&&null==v)throw new q("Missing texture dimensions for mipmap calculation");for(let K=
0;;++K){x(K,A,k,v);if(!B||1===A&&1===k&&(!E||1===v)||K>=y)break;A=Math.max(1,A>>1);k=Math.max(1,k>>1);E&&(v=Math.max(1,v>>1))}}};r.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=r;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,q,r){class g{constructor(p=0,m=p){this.width=p;this.height=m;this.target=q.TextureType.TEXTURE_2D;this.pixelFormat=q.PixelFormat.RGBA;this.dataType=q.PixelType.UNSIGNED_BYTE;
this.samplingMode=q.TextureSamplingMode.LINEAR;this.wrapMode=q.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=!1}}a.TextureDescriptor=g;a.estimateMemory=function(p){return 0>=p.width||0>=p.height?0:Math.round(p.width*p.height*(p.hasMipmap?4/3:1)*(null==p.internalFormat?4:r.getBytesPerElementFormat(p.internalFormat)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,q,r){class g extends r.TextureDescriptor{constructor(p,m){super();this.context=p;Object.assign(this,m);switch(this.internalFormat){case q.SizedPixelFormat.R16F:case q.SizedPixelFormat.R16I:case q.SizedPixelFormat.R16UI:case q.SizedPixelFormat.R32F:case q.SizedPixelFormat.R32I:case q.SizedPixelFormat.R32UI:case q.SizedPixelFormat.R8_SNORM:case q.SizedPixelFormat.R8:case q.SizedPixelFormat.R8I:case q.SizedPixelFormat.R8UI:this.pixelFormat=
q.PixelFormat.RED}}static validate(p,m){return new g(p,m)}}a.ValidatedTextureDescriptor=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,q){var r={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(r);
r=q.getDefaultExportFromCjs(r.exports);var g={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(g);g=q.getDefaultExportFromCjs(g.exports);var p={exports:{}};(function(m){(function(b){b=b();void 0!==b&&(m.exports=b)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(p);
q=q.getDefaultExportFromCjs(p.exports);a.builtins=q;a.literals=r;a.operators=g})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(a){class q{}a.AResourceProxy=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../TechniqueType ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ./MeshWriterInputEvaluator ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u){class x{async createMeshWriter(y,A,k,v){const B=this._getMeshWriter(v.techniqueType);y=await l.MeshWriterInputEvaluator.create(y,A,v.inputParams);k=new B(v.id,y,v.optionalAttributes,k);await k.loadDependencies();return k}_getMeshWriter(y){switch(y){case q.TechniqueType.Fill:return m.FillMeshWriter;case q.TechniqueType.DotDensity:return r.DotDensityMeshWriter;case q.TechniqueType.ComplexFill:return g.ComplexFillMeshWriter;case q.TechniqueType.PatternFill:return f.PatternFillMeshWriter;
case q.TechniqueType.OutlineFill:return b.OutlineFillMeshWriter;case q.TechniqueType.PatternOutlineFill:return c.PatternOutlineFillMeshWriter;case q.TechniqueType.ComplexOutlineFill:return p.ComplexOutlineFillMeshWriter;case q.TechniqueType.Marker:return t.MarkerMeshWriter;case q.TechniqueType.PieChart:return e.PieChartMeshWriter;case q.TechniqueType.Text:return u.TextMeshWriter;case q.TechniqueType.Line:return d.LineMeshWriter;case q.TechniqueType.TexturedLine:return w.TexturedLineMeshWriter;case q.TechniqueType.Heatmap:return h.HeatmapMeshWriter;
case q.TechniqueType.Label:return n.LabelMeshWriter;case q.TechniqueType.Test:throw Error("Internal Error: Found invalid mesh writer");}}}a.MeshWriterRegistry=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType":function(){define(["exports"],function(a){a.TechniqueType=void 0;var q=a.TechniqueType||(a.TechniqueType={});q[q.Fill=0]="Fill";q[q.PatternFill=1]="PatternFill";q[q.ComplexFill=2]="ComplexFill";q[q.OutlineFill=
3]="OutlineFill";q[q.PatternOutlineFill=4]="PatternOutlineFill";q[q.ComplexOutlineFill=5]="ComplexOutlineFill";q[q.Marker=6]="Marker";q[q.PieChart=7]="PieChart";q[q.Line=8]="Line";q[q.TexturedLine=9]="TexturedLine";q[q.Text=10]="Text";q[q.Label=11]="Label";q[q.Heatmap=12]="Heatmap";q[q.DotDensity=13]="DotDensity";q[q.Test=14]="Test";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports",
"../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(a,q,r){const g={createComputedParams:m=>m,optionalAttributes:{},attributes:{id:{type:r.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},pos:{type:r.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:r.DataType.FLOAT,count:1,packTessellation:({inverseArea:m})=>m}}};class p extends q.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=g}createTesselationParams(m){return{inverseArea:1/
m.readGeometryArea()}}}a.DotDensityMeshWriter=p;a.dotDensityVertexSpec=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(a,q,r,g,p){const m=q("featurelayer-fast-triangulation-enabled");class b extends p.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),
r.loadLibtess()])}_write(f,c,h){h=h?.asOptimized()??c.readGeometryForDisplay();if(h=this._clip(h))f.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(f,c,h),f.recordEnd()}_clip(f){return f?g.clipMarshall(f,this.hasEffects?256:8):null}_writeGeometry(f,c,h){const n=100<h.maxLength,d=[],w=this.createTesselationParams(c);!n&&m&&g.triangulate(d,h)?d.length&&this._writeVertices(f,c,h.coords,w,d):(h=g.triangulateLibtess(h),this._writeVertices(f,c,h,w))}_writeVertices(f,c,h,n,d){const w=
c.getDisplayId();c=f.vertexCount();const t=this.hasEffects;let l=0;if(d)for(var e of d){d=h[2*e];var u=h[2*e+1];t&&f.recordBounds(d,u,0,0);this._writeVertex(f,w,d,u,n);l++}else for(e=0;e<h.length;e+=2)d=Math.round(h[e]),u=Math.round(h[e+1]),t&&f.recordBounds(d,u,0,0),this._writeVertex(f,w,d,u,n),l++;f.indexEnsureSize(l);for(h=0;h<l;h++)f.indexWrite(h+c)}}a.AFillMeshWriter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(a,q,r,g,p,m,b){function f(d,w,t){let l=0;for(let e=1;e<t;e++)l+=(d[2*(w+e)]-d[2*(w+e-1)])*(d[2*(w+e)+1]+d[2*(w+e-1)+1]);return l}function c(d,w,t,l,e){let u=0;for(;t<l;t+=3){const x=2*(d[t]-e),y=2*(d[t+1]-e),A=2*(d[t+2]-e);u+=Math.abs((w[x]-w[A])*(w[y+1]-w[x+1])-(w[x]-w[y])*(w[A+1]-w[x+1]))}return u}const h=new g.TileClipper(0,0,0,1,0),n=new g.TileClipper(0,0,0,1,0);h.setExtent(m.tileSize);n.setExtent(m.tileSize);a.area=f;a.clipLinesMarshall=function(d,w){n.setPixelMargin(w);const t=-w;w=
m.tileSize+w;let l=[];var e=!1;if(!d.nextPath())return null;let u=!0;for(;u;){d.seekPathStart();const x=[];if(!d.pathSize)return null;n.reset(g.GeometryType.LineString);d.nextPoint();let y=d.x,A=d.y;if(e)n.moveTo(y,A);else{if(y<t||y>w||A<t||A>w){e=!0;continue}x.push({x:y,y:A})}let k=!1;for(;d.nextPoint();)if(y=d.x,A=d.y,e)n.lineTo(y,A);else{if(y<t||y>w||A<t||A>w){k=!0;break}x.push({x:y,y:A})}if(k)e=!0;else{if(e){if(e=n.resultWithStarts())for(const v of e)l.push(v)}else l.push({line:x,start:0});u=
d.nextPath();e=!1}}l=l.filter(x=>1<x.line.length);return 0===l.length?null:l};a.clipMarshall=function(d,w){if(null==d)return null;a:{var t=m.tileSize+128;var l=0;for(var e=0;e<d.lengths.length;e++){var u=d.lengths[e];for(var x=0;x<u;x++){const y=d.coords[2*(x+l)],A=d.coords[2*(x+l)+1];if(-128>y||y>t||-128>A||A>t){t=!0;break a}}l+=u}t=!1}if(!t)return d;h.setPixelMargin(w);h.reset(g.GeometryType.Polygon);w=0;for(t=0;t<d.lengths.length;t++){l=d.lengths[t];e=d.coords[2*(0+w)];u=d.coords[2*(0+w)+1];h.moveTo(e,
u);for(x=1;x<l;x++)e=d.coords[2*(x+w)],u=d.coords[2*(x+w)+1],h.lineTo(e,u);h.close();w+=l}t=h.result(!1);if(!t)return null;d=[];w=[];for(const y of t){t=0;for(const A of y)w.push(A.x),w.push(A.y),t++;d.push(t)}return new p(d,w)};a.triangleAreaArray=c;a.triangulate=function(d,w){const {coords:t,lengths:l,hasIndeterminateRingOrder:e}=w;if(e)return!1;w=0;for(var u=0;u<l.length;){let A=u,k=l[u];u=f(t,w,k);for(var x=[];++A<l.length;){var y=l[A];const v=f(t,w+k,y);if(!(0<v))break;u+=v;x.push(w+k);k+=y}y=
d.length;b.bufcut(d,t,w,w+k,x,2,0);x=c(d,t,y,d.length,0);u=Math.abs(u);if(1E-5<Math.abs((x-u)/Math.max(1E-7,u)))return d.length=0,!1;u=A;w+=k}return!0};a.triangulateEarcut=function(d,w,t){const {coords:l,lengths:e,hasIndeterminateRingOrder:u}=w;if(u)return!1;let x=0;for(var y=0;y<e.length;){let k=y,v=e[y];for(y=[];++k<e.length;){var A=e[k];if(!(0<f(l,x+v,A)))break;y.push(x+v-x);v+=A}A=w.coords.slice(2*x,2*(x+v));y=q.earcut(A,y,2);for(const B of y)d.push(B+t+x);y=k;x+=v}return!0};a.triangulateLibtess=
function(d){const {coords:w,lengths:t}=d;({buffer:d}=r.triangulate(w,t));return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(function(){class a{constructor(q=[],r=[],g=!1){this.lengths=q??[];this.coords=r??[];this.hasIndeterminateRingOrder=g}static fromJSON(q){return new a(q.lengths,q.coords,q.hasIndeterminateRingOrder)}static fromRect(q){const [r,g,p,m]=q;q=p-r;const b=m-g;return new a([5],[r,g,q,0,0,b,-q,0,0,-b])}get isPoint(){return 0===
this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((q,r)=>q+r)}forEachVertex(q){let r=0;this.lengths.length||q(this.coords[0],this.coords[1]);for(let g=0;g<this.lengths.length;g++){const p=this.lengths[g];for(let m=0;m<p;m++)q(this.coords[2*(m+r)],this.coords[2*(m+r)+1]);r+=p}}deltaDecode(){const q=this.clone(),{coords:r,lengths:g}=q;let p=0;for(const m of g){for(let b=1;b<m;b++)r[2*(p+b)]+=r[2*(p+b)-2],r[2*(p+b)+1]+=r[2*(p+b)-1];p+=m}return q}clone(q){if(0===
this.lengths.length)return new a([],[this.coords[0],this.coords[1]]);var r=2*(0===this.lengths.length?1:this.lengths.reduce((g,p)=>g+p));r=this.coords.slice(0,r);return q?(q.set(r),new a(this.lengths,q,this.hasIndeterminateRingOrder)):new a(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}}return a})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports"],function(a){function q(k,v,B,z,E,K,I){let D;B=0;for(let G=z,C=E-K;G<E;G+=K)B+=(k[C+v*K]-k[G+v*K])*(k[G+1+
v*K]+k[C+1+v*K]),C=G;if(I===0<B)for(;z<E;z+=K)D=m(z+v*K,k[z+v*K],k[z+1+v*K],D);else for(E-=K;E>=z;E-=K)D=m(E+v*K,k[E+v*K],k[E+1+v*K],D);D&&l(D,D.next)&&(b(D),D=D.next);return D}function r(k,v=k){if(!k)return k;let B;do if(B=!1,k.steiner||!l(k,k.next)&&0!==h(k.prev,k,k.next))k=k.next;else{b(k);k=v=k.prev;if(k===k.next)break;B=!0}while(B||k!==v);return v}function g(k,v,B,z,E,K,I,D){if(k){!D&&K&&(k=c(k,z,E,K));for(var G=k;k.prev!==k.next;){var C=k.prev,F=k.next;if(K)var J=p(k,z,E,K);else a:{J=k;var T=
J.prev,S=J;const ba=J.next;if(0<=h(T,S,ba)){J=!1;break a}let M=J.next.next;const U=M;let R=0;for(;M!==J.prev&&(0===R||M!==U);){R++;if(d(T.x,T.y,S.x,S.y,ba.x,ba.y,M.x,M.y)&&0<=h(M.prev,M,M.next)){J=!1;break a}M=M.next}J=!0}if(J)v.push(C.index/B+I),v.push(k.index/B+I),v.push(F.index/B+I),b(k),G=k=F.next;else if(k=F,k===G){if(!D)g(r(k),v,B,z,E,K,I,1);else if(1===D){D=v;G=B;C=I;F=k;do J=F.prev,T=F.next.next,!l(J,T)&&n(J,F,F.next,T)&&w(J,T)&&w(T,J)&&(D.push(J.index/G+C),D.push(F.index/G+C),D.push(T.index/
G+C),b(F),b(F.next),F=k=T),F=F.next;while(F!==k);k=F;g(k,v,B,z,E,K,I,2)}else if(2===D)a:{D=k;do{for(G=D.next.next;G!==D.prev;){if(C=D.index!==G.index){J=J=J=void 0;C=D;F=G;if(J=C.next.index!==F.index&&C.prev.index!==F.index){b:{J=C;do{if(J.index!==C.index&&J.next.index!==C.index&&J.index!==F.index&&J.next.index!==F.index&&n(J,J.next,C,F)){J=!0;break b}J=J.next}while(J!==C);J=!1}J=!J}if(J=J&&w(C,F)&&w(F,C)){J=C;T=!1;S=(C.x+F.x)/2;F=(C.y+F.y)/2;do J.y>F!==J.next.y>F&&J.next.y!==J.y&&S<(J.next.x-J.x)*
(F-J.y)/(J.next.y-J.y)+J.x&&(T=!T),J=J.next;while(J!==C);J=T}C=J}if(C){k=u(D,G);D=r(D,D.next);k=r(k,k.next);g(D,v,B,z,E,K,I,0);g(k,v,B,z,E,K,I,0);break a}G=G.next}D=D.next}while(D!==k)}break}}}}function p(k,v,B,z){const E=k.prev,K=k.next;if(0<=h(E,k,K))return!1;const I=E.x>k.x?E.x>K.x?E.x:K.x:k.x>K.x?k.x:K.x,D=E.y>k.y?E.y>K.y?E.y:K.y:k.y>K.y?k.y:K.y,G=t(E.x<k.x?E.x<K.x?E.x:K.x:k.x<K.x?k.x:K.x,E.y<k.y?E.y<K.y?E.y:K.y:k.y<K.y?k.y:K.y,v,B,z);v=t(I,D,v,B,z);B=k.prevZ;for(z=k.nextZ;B&&B.z>=G&&z&&z.z<=
v;){if(B!==k.prev&&B!==k.next&&d(E.x,E.y,k.x,k.y,K.x,K.y,B.x,B.y)&&0<=h(B.prev,B,B.next))return!1;B=B.prevZ;if(z!==k.prev&&z!==k.next&&d(E.x,E.y,k.x,k.y,K.x,K.y,z.x,z.y)&&0<=h(z.prev,z,z.next))return!1;z=z.nextZ}for(;B&&B.z>=G;){if(B!==k.prev&&B!==k.next&&d(E.x,E.y,k.x,k.y,K.x,K.y,B.x,B.y)&&0<=h(B.prev,B,B.next))return!1;B=B.prevZ}for(;z&&z.z<=v;){if(z!==k.prev&&z!==k.next&&d(E.x,E.y,k.x,k.y,K.x,K.y,z.x,z.y)&&0<=h(z.prev,z,z.next))return!1;z=z.nextZ}return!0}function m(k,v,B,z){k=x.create(k,v,B);
z?(k.next=z.next,k.prev=z,z.next.prev=k,z.next=k):(k.prev=k,k.next=k);return k}function b(k){k.next.prev=k.prev;k.prev.next=k.next;k.prevZ&&(k.prevZ.nextZ=k.nextZ);k.nextZ&&(k.nextZ.prevZ=k.prevZ)}function f(k,v){let B=v;const z=k.x,E=k.y;let K=-Infinity,I;do{if(E<=B.y&&E>=B.next.y&&B.next.y!==B.y){var D=B.x+(E-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(D<=z&&D>K){K=D;if(D===z){if(E===B.y)return B;if(E===B.next.y)return B.next}I=B.x<B.next.x?B:B.next}}B=B.next}while(B!==v);if(!I)return null;if(z===K)return I.prev;
v=I;D=I.x;const G=I.y;let C=Infinity,F;for(B=I.next;B!==v;)z>=B.x&&B.x>=D&&z!==B.x&&d(E<G?z:K,E,D,G,E<G?K:z,E,B.x,B.y)&&(F=Math.abs(E-B.y)/(z-B.x),(F<C||F===C&&B.x>I.x)&&w(B,k)&&(I=B,C=F)),B=B.next;return I}function c(k,v,B,z){for(var E;E!==k;E=E.next){E=E||k;null===E.z&&(E.z=t(E.x,E.y,v,B,z));if(E.prev.next!==E||E.next.prev!==E)return E.prev.next=E,E.next.prev=E,c(k,v,B,z);E.prevZ=E.prev;E.nextZ=E.next}k.prevZ.nextZ=null;k.prevZ=null;a:for(B=1;;){z=k;v=k=null;let K=0;for(;z;){K++;E=z;let I=0;for(;I<
B&&E;I++)E=E.nextZ;let D=B;for(;0<I||0<D&&E;){let G;0===I?(G=E,E=E.nextZ,D--):0!==D&&E?z.z<=E.z?(G=z,z=z.nextZ,I--):(G=E,E=E.nextZ,D--):(G=z,z=z.nextZ,I--);v?v.nextZ=G:k=G;G.prevZ=v;v=G}z=E}v.nextZ=null;B*=2;if(2>K)break a}return k}function h(k,v,B){return(v.y-k.y)*(B.x-v.x)-(v.x-k.x)*(B.y-v.y)}function n(k,v,B,z){return l(k,v)&&l(B,z)||l(k,z)&&l(B,v)?!0:0<h(k,v,B)!==0<h(k,v,z)&&0<h(B,z,k)!==0<h(B,z,v)}function d(k,v,B,z,E,K,I,D){return 0<=(E-I)*(v-D)-(k-I)*(K-D)&&0<=(k-I)*(z-D)-(B-I)*(v-D)&&0<=(B-
I)*(K-D)-(E-I)*(z-D)}function w(k,v){return 0>h(k.prev,k,k.next)?0<=h(k,v,k.next)&&0<=h(k,k.prev,v):0>h(k,v,k.prev)||0>h(k,k.next,v)}function t(k,v,B,z,E){k=32767*(k-B)*E;v=32767*(v-z)*E;k=(k|k<<8)&16711935;k=(k|k<<4)&252645135;k=(k|k<<2)&858993459;v=(v|v<<8)&16711935;v=(v|v<<4)&252645135;v=(v|v<<2)&858993459;return(k|k<<1)&1431655765|((v|v<<1)&1431655765)<<1}function l(k,v){return k.x===v.x&&k.y===v.y}function e(k,v){return k.x-v.x}function u(k,v){const B=x.create(k.index,k.x,k.y),z=x.create(v.index,
v.x,v.y),E=k.next,K=v.prev;k.next=v;v.prev=k;B.next=E;E.prev=B;z.next=B;B.prev=z;K.next=z;z.prev=K;return z}class x{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(k,v,B){const z=A<y.length?y[A++]:new x;z.index=k;z.x=v;z.y=B;z.prev=null;z.next=null;z.z=null;z.prevZ=null;z.nextZ=null;z.steiner=!1;return z}}const y=[];let A=0;for(let k=0;8096>k;k++)y.push(new x);a.bufcut=function(k,v,B,z,E,K,I){A=0;var D=(z-B)*K,G=E&&E.length;
const C=G?(E[0]-B)*K:D;var F=q(v,B,z,0,C,K,!0);if(F&&F.next!==F.prev){var J;if(G){const U=[];for(let R=0,Z=E.length;R<Z;R++){const ea=q(v,B,z,E[R]*K,R<Z-1?E[R+1]*K:z*K,K,!1);ea===ea.next&&(ea.steiner=!0);G=U;var T=G.push;let ma=ea,V=ea;do{if(ma.x<V.x||ma.x===V.x&&ma.y<V.y)V=ma;ma=ma.next}while(ma!==ea);T.call(G,V)}U.sort(e);for(var S of U)if(z=S,E=f(z,F))z=u(E,z),r(z,z.next),F=r(E,E.next)}if(D>80*K){var ba=D=v[B*K];var M=J=v[1+B*K];for(S=K;S<C;S+=K)z=v[S+B*K],E=v[S+1+B*K],ba=Math.min(ba,z),M=Math.min(M,
E),D=Math.max(D,z),J=Math.max(J,E);J=Math.max(D-ba,J-M);J=0!==J?1/J:0}g(F,k,K,ba,M,J,I,0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(a,q,r,g,p){class m{constructor(b,f,c,h){this._instanceId=b;this._evaluator=f;this._enabledOptionalAttributes=
c;this._viewParams=h;this._evaluator.evaluator=n=>this.vertexSpec.createComputedParams(n)}get _vertexPack(){if(!this._cachedVertexPack){const b=p.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||b.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=b}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(b){this._references=
b}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var b;a:{if(b=this._evaluator.inputMeshParams.effects?.effectInfos)for(const f of b)switch(f.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":b=!0;break a}b=!1}b&&await g.loadGeometryEngine()}enqueueRequest(b,f,c){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(b,f,c)}write(b,f,c,h,n){this.ensurePacked(f,c,h);if((f=this.evaluatedMeshParams.effects)&&
0!==f.length){if(h=c.readGeometryForDisplay()?.clone()){h=q.GeometryCursor.fromOptimizedCIM(h,c.geometryType);var d=g.getGeometryEngine();h.invertY();for(f=r.CIMEffectHelper.executeEffects(f,h,b.id||"",d);h=f.next();)h.invertY(),this._write(b,c,h,n)}}else this._write(b,c,void 0,n)}ensurePacked(b,f,c){this._evaluator.hasDynamicProperties&&(b=this._evaluator.evaluateMeshParams(b,f,c),this._vertexPack.pack(b,this._viewParams))}_writeVertex(b,f,c,h,n){this._vertexPack.writeVertex(b,f,c,h,this.evaluatedMeshParams,
n)}}a.MeshWriter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(a,q,r,g,p){function m(d){if(g.isPolygon(d))d=[d.rings,"esriGeometryPolygon"];else if(g.isPolyline(d))d=[d.paths,"esriGeometryPolyline"];else if(g.isMultipoint(d))d=[[d.points],"esriGeometryMultipoint"];else if(g.isExtent(d))d=[[[[d.xmin,d.ymin],
[d.xmin,d.ymax],[d.xmax,d.ymax],[d.xmax,d.ymin],[d.xmin,d.ymin]]],"esriGeometryEnvelope"];else if(g.isPoint(d)){const w=[d.x,d.y];d.z&&w.push(d.z);d.m&&w.push(d.m);d=[[[w]],"esriGeometryPoint"]}else d=[[],"esriGeometryPolyline"];return d}class b{static fromOptimized(d,w,t=!1,l=!1,e=1){return(new f).initialize(d,w,t,l,e)}static fromJSON(d,w=!1,t=!1){const [l,e]=m(d);return(new c).initialize(l,e,w,t,1)}static fromOptimizedCIM(d,w,t=!1,l=!1,e=1){return(new h).initialize(d,w,t,l,e)}static fromJSONCIM(d,
w=!1,t=!1,l=1){const [e,u]=m(d);return(new n).initialize(e,u,w,t,l)}static fromFeatureSetReader(d){const w=d.readGeometryForDisplay();d=d.geometryType;return w&&d?this.fromOptimized(w,d):null}static fromFeatureSetReaderCIM(d){const w=d.readGeometryForDisplay();d=d.geometryType;return w&&d?this.fromOptimizedCIM(w,d):null}static createEmptyOptimized(d,w=!1,t=!1,l=1){return(new f).initialize(new p,d,w,t,l)}static createEmptyJSON(d,w=!1,t=!1){return(new c).initialize([],d,w,t,1)}static createEmptyOptimizedCIM(d,
w=!1,t=!1,l=1){return(new h).initialize(new p,d,w,t,l)}static createEmptyJSONCIM(d,w=!1,t=!1,l=1){return(new n).initialize([],d,w,t,l)}asJSON(){const d=r.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:d[0][0][0],ymin:d[0][0][1],xmax:d[0][2][0],ymax:d[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:d.flat()}:"esriGeometryPoint"===this.geometryType?{x:d[0][0][0],y:d[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:d}:{paths:d}}getCurrentRingArea(){if(3>
this.pathSize)return 0;let d=0,w,t;this.seekPathStart();if(!this.nextPoint())return 0;w=this.x;t=this.y;const l=w,e=t;for(;this.nextPoint();)d+=(w-this.x)*(t+this.y),w=this.x,t=this.y;return-.5*(d+(w-l)*(t+e))}invertY(){this.yFactor*=-1}}class f extends b{constructor(){super(...arguments);this._end=-1}initialize(d,w,t,l,e){this.hasZ=t;this.hasM=l;this.geometryType=w;this._stride=2+Number(t)+Number(l);this._geometry=d;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=
-1;this.yFactor=e;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(d){if(0<=d&&d<this.totalSize){if(this._pathIndex<d)for(;this._pathIndex<d&&this.nextPath(););else if(this._pathIndex>d)for(;this._pathIndex>d&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(d){d=this._pathOffset+d*this._stride;return 0<=d&&d<this._end?(this._pointOffset=
d,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=
this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}pathLength(){const d=this._end,w=this._stride,t=this._geometry.coords;let l=0;for(let e=this._pathOffset+w;e<d;e+=w){const u=t[e]-t[e-w],x=t[e+1]-t[e-w+1];l+=Math.sqrt(u*u+x*x)}return l}startPath(){this._geometry.lengths.push(0)}pushPath(d){this.startPath();this.pushPoints(d)}pushPoint(d){for(let w=0;w<this._stride;++w)this._geometry.coords.push(d[w]);this._geometry.lengths[this.totalSize-1]++}pushXY(d,w){this._geometry.coords.push(d,
w);this._geometry.lengths[this.totalSize-1]++}pushPoints(d){for(const w of d)for(let t=0;t<this._stride;++t)this._geometry.coords.push(w[t]);this._geometry.lengths[this.totalSize-1]+=d.length}pushCursor(d){d=d.asOptimized();this._geometry.coords.push(...d.coords);this._geometry.lengths.push(...d.lengths)}asOptimized(){const d=this._geometry.clone();if(1!==this.yFactor)for(let w=1;w<d.coords.length;w+=this._stride)d.coords[w]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(d.lengths.length=
0);return d}isClosed(){const d=this._geometry.coords,w=this._pathOffset,t=this._end-this._stride;for(let l=0;l<this._stride;l++)if(d[w+l]!==d[t+l])return!1;return!0}clone(){return(new f).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((d,w)=>d+w)}get pathSize(){const {lengths:d}=this._geometry;return this._geometry.isPoint?1:0>this._pathIndex||this._pathIndex>d.length-1?0:d[this._pathIndex]}get totalSize(){return this._geometry.isPoint?
1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(d){this._geometry.coords[this._pointOffset]=d}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(d){this._geometry.coords[this._pointOffset+1]=this.yFactor*d}get z(){return this._geometry.coords[this._pointOffset+2]}set z(d){this._geometry.coords[this._pointOffset+2]=d}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(d){this._geometry.coords[this._pointOffset+
3]=d}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class c extends b{initialize(d,w,t,l,e){this._paths=d;this.geometryType=w;this.hasZ=t;this.hasM=l;this._pathIndex=this._pointIndex=-1;this.yFactor=e;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(d){this._pathIndex=d;this._pointIndex=-1;return 0<=d&&d<this.totalSize?(this._currentPath=this._paths[d],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=
this._currentPath.length}seekInPath(d){return 0<=d&&d<this._currentPath.length?(this._pointIndex=d,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<
this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const d=this._currentPath.length,w=this._currentPath;let t=0;for(let e=1;e<d;e++){var l=w[e-1];const u=w[e],x=u[0]-l[0];l=u[1]-l[1];t+=Math.sqrt(x*x+l*l)}return t}startPath(){this._paths.push([])}pushPath(d){this._paths.push(d)}pushPoint(d){this._paths[this.totalSize-1].push(d)}pushXY(d,w){this._paths[this.totalSize-1].push([d,w])}pushPoints(d){this._paths[this.totalSize-1].push(...d)}pushCursor(d){d=
r.collectMultipath(d);for(const w of d)this.pushPath(w)}asOptimized(){const d=new p;if("esriGeometryPoint"===this.geometryType)d.coords.push(...this._paths[0][0]),d.lengths.length=0;else for(const w of this._paths){for(const t of w)d.coords.push(t[0]),d.coords.push(t[1]*this.yFactor),this.hasZ&&d.coords.push(t[2]),this.hasM&&d.coords.push(t[this._mIndex]);d.lengths.push(w.length)}return d}isClosed(){const d=this._currentPath[0],w=this._currentPath[this._currentPath.length-1];for(let t=0;t<d.length;t++)if(d[t]!==
w[t])return!1;return!0}clone(){return(new c).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(d=>d.length).reduce((d,w)=>d+w)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(d){this._currentPoint[0]=d}get y(){return this.yFactor*this._currentPoint[1]}set y(d){this._currentPoint[1]=
this.yFactor*d}get z(){return this._currentPoint[2]}set z(d){this._currentPoint[2]=d}get m(){return this._currentPoint[this._mIndex]}set m(d){this._currentPoint[this._mIndex]=d}get pathIndex(){return this._pathIndex}}class h extends f{initialize(d,w,t,l,e){super.initialize(d,w,t,l,e);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(u=>new Set));return this}startPath(){super.startPath();this._controlPoints.push(new Set)}clone(){const d=(new h).initialize(this._geometry.clone(),
this.geometryType,this.hasZ,this.hasM,this.yFactor);d._controlPoints=this._controlPoints;return d}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(d){this._controlPoints[this.pathIndex].add(d)}getControlPointAt(d){return this._controlPoints[this.pathIndex].has(d)}}class n extends c{initialize(d,w,t,l,e){return super.initialize(d,w,t,l,e)}clone(){return(new n).initialize(q.clone(this._paths),
this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(d){this._paths[this.pathIndex][d][4]=1}getControlPointAt(d){return 1===this._paths[this.pathIndex][d][4]}}a.GeometryCursor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),
function(a,q,r,g,p,m){const b=96/72;class f{static executeEffects(c,h,n,d){const w=m.getEffectsInflateSize(c);h=new g.SimpleEffectCursor(h);for(const t of c)(c=p.getEffectOperator(t))&&(h=c.execute(h,t,b,n,d,w));return h}static applyEffects(c,h,n){if(!c)return h;var d=m.getEffectsInflateSize(c);h=new g.SimpleEffectCursor(q.GeometryCursor.fromJSONCIM(h));for(var w of c)(c=p.getEffectOperator(w))&&(h=c.execute(h,w,1,null,n,d));d=[];for(w=null;n=h.next();)d.push(...r.collectMultipath(n)),w=n.geometryType;
return 0===d.length||null===w?null:"esriGeometryPolygon"===w?{rings:d}:{paths:d}}}a.CIMEffectHelper=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(a,q,r){let g;class p{constructor(m){this._geometry=m}next(){const m=this._geometry;this._geometry=null;return m}}a.SimpleEffectCursor=p;a.clipCursorToTileExtent=function(m,b){g||=new r.TileClipper(0,
0,0,1);var f="esriGeometryPolygon"===m.geometryType;const c=f?3:2;g.reset(f?r.GeometryType.Polygon:r.GeometryType.LineString);g.setPixelMargin(b+1);g.setExtent(512);let h;for(;m.nextPath();)if(!(m.pathSize<c)){m.nextPoint();b=m.x;h=-m.y;for(g.moveTo(b,h);m.nextPoint();)b=m.x,h=-m.y,g.lineTo(b,h);f&&g.close()}if(f=g.result(!1)){m=q.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(const n of f){m.startPath();for(const d of n)m.pushXY(d.x,-d.y)}m.reset();return m}return null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A,k,v){a.getEffectOperator=function(B){if(!B)return null;switch(B.type){case "CIMGeometricEffectAddControlPoints":return q.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return r.EffectArrow.local();case "CIMGeometricEffectBuffer":return g.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return p.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return m.EffectCut.local();case "CIMGeometricEffectDashes":return b.EffectDashes.local();
case "CIMGeometricEffectDonut":return f.EffectDonut.local();case "CIMGeometricEffectJog":return c.EffectJog.local();case "CIMGeometricEffectMove":return h.EffectMove.local();case "CIMGeometricEffectOffset":return n.EffectOffset.local();case "CIMGeometricEffectReverse":return d.EffectReverse.local();case "CIMGeometricEffectRotate":return w.EffectRotate.local();case "CIMGeometricEffectScale":return t.EffectScale.local();case "CIMGeometricEffectWave":return l.EffectWave.local()}return null};a.getPlacementOperator=
function(B){if(!B)return null;switch(B.type){case "CIMMarkerPlacementAlongLineSameSize":return e.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return u.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return x.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return y.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return A.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return k.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return v.PlacementPolygonCenter.local()}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(a){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(g,p,m,b,f){return new r(g,p,m)}}q.instance=null;class r{constructor(g,p,m){this._inputGeometries=g;this._angleTolerance=void 0!==p.angleTolerance?p.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let g=this._inputGeometries.next();for(;g;){if("esriGeometryPolygon"===g.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===g.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===g.geometryType){if(this._maxCosAngle)return g;this._isClosed=!0}else{g=this._inputGeometries.next();continue}for(;g.nextPath();)this._processPath(g);g.reset();return g}return null}_processPath(g){if(g.nextPoint()){const p=
g.x,m=g.y;let b=p,f=m,c=g.pathSize,h=0,n=0,d=0,w=0,t=0,l=0;this._isClosed&&++c;for(let e=1;g.nextPoint()||e<c;++e){let u,x;this._isClosed&&e===c-1?(u=p,x=m):(u=g.x,x=g.y);const y=u-b,A=x-f,k=Math.sqrt(y*y+A*A);1<e&&0<k&&0<d&&(h*y+n*A)/k/d<=this._maxCosAngle&&g.setControlPointAt(e-1);1===e&&(w=y,t=A,l=k);0<k&&(b=u,f=x,h=y,n=A,d=k)}this._isClosed&&0<d&&0<l&&(h*w+n*t)/l/d<=this._maxCosAngle&&g.setControlPointAt(0)}}}a.EffectAddControlPoints=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(a,q,r,g,p,m){const b=m.GeometricEffectArrowType.OpenEnded;class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(h,n,d,w,t){return new c(h,n,d)}}f.instance=null;class c extends g.PathEffectCursor{constructor(h,n,d){super(h,!1,!0);this._curveHelper=new p.CurveHelper;this._width=
(void 0!==n.width?n.width:5)*d;this._arrowType=void 0!==n.geometricEffectArrowType?n.geometricEffectArrowType:void 0!==n.arrowType?n.arrowType:b;this._offsetFlattenError=p.pixelTolerance*d}processPath(h){const n=q.GeometryCursor.createEmptyOptimizedCIM(h.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(n,h,!0);break;case m.GeometricEffectArrowType.Block:this._constructSimpleArrow(n,h,!1);break;case m.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(n,h)}return n}_constructSimpleArrow(h,
n,d){var w=n.pathLength(),t=this._width;w<2*t&&(t=w/2);var l=this._curveHelper.getSubCurve(n,0,w-t);if(l&&l.nextPath()&&(l.seekPathStart(),w=t/2,!this._curveHelper.isEmpty(l)&&(l=r.collectPath(l),t=this._constructOffset(l,-w)))&&(l=this._constructOffset(l,w))){var e=this._constructArrowBasePoint(t,-w/2);e&&(w=this._constructArrowBasePoint(l,w/2))&&(n.seekInPath(n.pathSize-1),n=[n.x,n.y],h.pushPath(l),h.nextPath(),h.nextPoint(),h.setControlPoint(),h.pushPoint(w),h.nextPoint(),h.setControlPoint(),h.pushPoint(n),
h.nextPoint(),h.setControlPoint(),h.pushPoint(e),h.nextPoint(),h.setControlPoint(),h.pushPoints(t.reverse()),h.setControlPoint(),d||(h.setControlPointAt(0),h.setControlPointAt(h.pathSize-1),h.pushPoint(l[0])),h.reset())}}_constructCrossedArrow(h,n){var d=n.pathLength(),w=this._width;d<3.732050807568877*w&&(w=d/3.732050807568877);n.seekPathStart();var t=this._curveHelper.getSubCurve(n,0,d-2.732050807568877*w);if(t){t.nextPath();var l=w/2;if(!this._curveHelper.isEmpty(t)){var e=r.collectPath(t);if(t=
this._constructOffset(e,l))if(e=this._constructOffset(e,-l))if(d=this._curveHelper.getSubCurve(n,0,d-w))if(d.nextPath(),!this._curveHelper.isEmpty(d)&&(d=r.collectPath(d),w=this._constructOffset(d,l))){var u=this._constructOffset(d,-l);if(u&&(d=w[w.length-1],w=this._constructArrowBasePoint(w,l/2))){var x=u[u.length-1];if(l=this._constructArrowBasePoint(u,-l/2))n.seekInPath(n.pathSize-1),n=[n.x,n.y],h.pushPath(t),h.nextPath(),h.nextPoint(),h.setControlPoint(),h.pushPoint(x),h.nextPoint(),h.setControlPoint(),
h.pushPoint(l),h.nextPoint(),h.setControlPoint(),h.pushPoint(n),h.nextPoint(),h.setControlPoint(),h.pushPoint(w),h.nextPoint(),h.setControlPoint(),h.pushPoint(d),h.nextPoint(),h.setControlPoint(),h.pushPoints(e.reverse()),h.nextPoint(),h.setControlPoint(),h.reset()}}}}}_constructOffset(h,n){return this._curveHelper.offset(h,n,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(h,n){if(!h||2>h.length)return null;var d=h[h.length-2];h=h[h.length-1];d=[h[0]-d[0],
h[1]-d[1]];this._curveHelper.normalize(d);return[h[0]+d[1]*n,h[1]-d[0]*n]}}a.EffectArrow=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMEffects","./CIMPlacements"],function(a,q,r){class g{constructor(m,b=!0,f=!0,c=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!b&&"esriGeometryPolygon"===m.geometryType||!f&&"esriGeometryPolyline"===m.geometryType?null:m;this.geomUnitsPerPoint=c;this.iteratePath=this.iterateMultiPath=
!1;this.internalPlacement=new r.Placement}next(){if(!this.geometryCursor)return null;const m=this.processMultiPath(this.geometryCursor);this.iterateMultiPath&&m||(this.geometryCursor=null);return m}processMultiPath(m){for(;this.iteratePath||m.pathIndex<m.totalSize-1;){this.iteratePath||m.nextPath();this.iterateMultiPath=!0;const b=this.processPath(m);if(b)return b}this.iterateMultiPath=!1;return null}}class p{constructor(m,b,f,c=0){this.isClosed=!1;this._tileKey=null;this.inputGeometries=m;this.acceptPolygon=
b;this.acceptPolyline=f;this.geomUnitsPerPoint=c;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var m=this.inputGeometries.next();m&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===m.geometryType||"esriGeometryEnvelope"===m.geometryType,this.multiPathCursor=m);)m=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=q.clipCursorToTileExtent(this.multiPathCursor,
256))}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),m=this.processPath(this.multiPathCursor))return m;this.multiPathCursor=null}}isClippingRequired(m){return!1}}a.PathEffectCursor=p;a.PathTransformationCursor=g;a.getId=function(m){return m[4]};a.setId=function(m,b){m[4]=b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(a){class q{constructor(){this.setIdentity()}getAngle(){if(null==
this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(g,p){this.tx=g;this.ty=p}setTranslateZ(g){this.tz=g}setRotateCS(g,p){this.rz=void 0;this.rzCos=g;this.rzSin=p}setRotate(g){this.rz=g;this.rzSin=this.rzCos=void 0}setRotateY(g){this.ry=g}setScale(g){this.s=g}setMeasure(g){this.m=g}}class r{next(){return null}}a.EmptyPlacementCursor=
r;a.Placement=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(a,q,r){class g{constructor(p,m){}isEmpty(p){if(!p.nextPoint())return!0;let m,b,f,c;m=p.x;for(b=p.y;p.nextPoint();m=b,b=c)if(f=p.x,c=p.y,f!==m||c!==b)return p.seekPathStart(),!1;p.seekPathStart();return!0}normalize(p){const m=Math.sqrt(p[0]*p[0]+p[1]*p[1]);0!==m&&(p[0]/=m,p[1]/=m)}getLength(p,m,b,f){p=b-p;m=f-
m;return Math.sqrt(p*p+m*m)}getSegLength(p){const [[m,b],[f,c]]=p;return this.getLength(m,b,f,c)}getCoord2D(p,m,b,f,c){return[p+(b-p)*c,m+(f-m)*c]}getSegCoord2D(p,m){const [[b,f],[c,h]]=p;return this.getCoord2D(b,f,c,h,m)}getAngle(p,m,b,f,c){return Math.atan2(f-m,b-p)}getAngleCS(p,m,b,f,c){p=b-p;m=f-m;f=Math.sqrt(p*p+m*m);return 0<f?[p/f,m/f]:[1,0]}getSegAngleCS(p,m){const [[b,f],[c,h]]=p;return this.getAngleCS(b,f,c,h,m)}cut(p,m,b,f,c,h){c=0>=c?[p,m]:this.getCoord2D(p,m,b,f,c);p=1<=h?[b,f]:this.getCoord2D(p,
m,b,f,h);return[c,p]}getSubCurve(p,m,b){const f=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(f,p,m,b)?f:null}appendSubCurve(p,m,b,f){p.startPath();m.seekPathStart();let c=0;var h=!0;if(!m.nextPoint())return!1;var n=m.x;let d=m.y;for(;m.nextPoint();){const w=this.getLength(n,d,m.x,m.y);if(0!==w){if(h){if(c+w>b){const t=(b-c)/w;let l=1;h=!1;c+w>=f&&(l=(f-c)/w,h=!0);(n=this.cut(n,d,m.x,m.y,t,l))&&p.pushPoints(n);if(h)break;h=!1}}else{if(c+w>f){(m=this.cut(n,
d,m.x,m.y,0,(f-c)/w))&&p.pushPoint(m[1]);break}p.pushXY(m.x,m.y)}c+=w}n=m.x;d=m.y}return!0}getCIMPointAlong(p,m){if(!p.nextPoint())return null;let b=0,f,c,h,n;f=p.x;for(c=p.y;p.nextPoint();f=h,c=n){h=p.x;n=p.y;const d=this.getLength(f,c,h,n);if(0!==d){if(b+d>m)return this.getCoord2D(f,c,h,n,(m-b)/d);b+=d}}return null}offset(p,m,b,f,c){if(!p||2>p.length)return null;var h=0,n=p[h++];for(c=h;h<p.length;){var d=p[h];if(d[0]!==n[0]||d[1]!==n[1])h!==c&&(p[c]=p[h]),n=p[c++];h++}(h=p[0][0]===p[c-1][0]&&p[0][1]===
p[c-1][1])&&--c;if(c<(h?3:2))return null;d=[];n=h?p[c-1]:null;let w=p[0];for(let x=0;x<c;x++){const y=x===c-1?h?p[0]:null:p[x+1];if(n)if(y){var t=[y[0]-w[0],y[1]-w[1]];this.normalize(t);var l=[w[0]-n[0],w[1]-n[1]];this.normalize(l);var e=l[0]*t[1]-l[1]*t[0],u=l[0]*t[0]+l[1]*t[1];if(0===e&&1===u){w=y;continue}if(0<=e===0>=m)1>u&&(t=[t[0]-l[0],t[1]-l[1]],this.normalize(t),l=Math.sqrt((1+u)/2),l>1/f&&(l=-Math.abs(m)/l,d.push([w[0]-t[0]*l,w[1]-t[1]*l])));else switch(b){case r.GeometricEffectOffsetMethod.Mitered:if(n=
Math.sqrt((1+u)/2),0<n&&1/n<f){t=[t[0]-l[0],t[1]-l[1]];this.normalize(t);l=Math.abs(m)/n;d.push([w[0]-t[0]*l,w[1]-t[1]*l]);break}case r.GeometricEffectOffsetMethod.Bevelled:d.push([w[0]+l[1]*m,w[1]-l[0]*m]);d.push([w[0]+t[1]*m,w[1]-t[0]*m]);break;case r.GeometricEffectOffsetMethod.Rounded:if(1>u){d.push([w[0]+l[1]*m,w[1]-l[0]*m]);n=Math.floor(2.5*(1-u));if(0<n){e=u=1/n;for(let A=1;A<n;A++,e+=u){const k=[l[1]*(1-e)+t[1]*e,-l[0]*(1-e)-t[0]*e];this.normalize(k);d.push([w[0]+k[0]*m,w[1]+k[1]*m])}}d.push([w[0]+
t[1]*m,w[1]-t[0]*m])}break;default:0>e?(d.push([w[0]+(l[1]+l[0])*m,w[1]+(l[1]-l[0])*m]),d.push([w[0]+(t[1]-t[0])*m,w[1]-(t[0]+t[1])*m])):(n=Math.sqrt((1+Math.abs(u))/2),t=[t[0]-l[0],t[1]-l[1]],this.normalize(t),l=m/n,d.push([w[0]-t[0]*l,w[1]-t[1]*l]))}}else t=[w[0]-n[0],w[1]-n[1]],this.normalize(t),d.push([w[0]+t[1]*m,w[1]-t[0]*m]);else t=[y[0]-w[0],y[1]-w[1]],this.normalize(t),d.push([w[0]+t[1]*m,w[1]-t[0]*m]);n=w;w=y}if(d.length<(h?3:2))return null;h&&d.push([d[0][0],d[0][1]]);return d}}a.CurveHelper=
g;a.pixelTolerance=.03;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(a,q,r,g,p,m,b,f){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(n,d,w,t,l,e){return new h(n,d,w,t,l,e)}}c.instance=null;
class h{constructor(n,d,w,t,l,e){this._inputGeometries=n;this._tileKey=t;this._geometryEngine=l;this._curveHelper=new m.CurveHelper;this._size=(void 0!==d.size?d.size:1)*w;this._maxInflateSize=e*w;this._offsetFlattenError=m.pixelTolerance*w}next(){for(var n;n=this._inputGeometries.next();){if(0===this._size)return n;if("esriGeometryEnvelope"===n.geometryType)if(0<this._size){var d=r.GeometryCursor.createEmptyOptimizedCIM(n.geometryType),w=g.collectMultipath(n)[0];if(w=this._curveHelper.offset(w,this._size,
b.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return d.pushPath(w),d}else if(0>this._size&&(d=n.asJSON(),0<Math.min(d.xmax-d.xmin,d.ymax-d.ymin)+2*this._size))return r.GeometryCursor.fromJSONCIM({xmin:d.xmin-this._size,xmax:d.xmax+this._size,ymin:d.ymin-this._size,ymax:d.ymax+this._size});d=this._geometryEngine;if(null==d)break;if(n=this._tileKey?p.clipCursorToTileExtent(n,this._maxInflateSize):n)return(n=d.buffer(f.WebMercator,n.asJSON(),this._size,1))?r.GeometryCursor.fromJSONCIM(n):
null}return null}}a.EffectBuffer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(a,q,r,g,p){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(f,c,h,n,d){return new b(f,c,h)}}m.instance=null;class b{constructor(f,c,h){this._defaultPointSize=20;this._inputGeometries=
f;this._geomUnitsPerPoint=h;this._rule=c.rule??p.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*h}next(){for(var f;f=this._inputGeometries.next();)if(f=this._processGeom(r.collectMultipath(f)),f?.length)return q.GeometryCursor.fromJSONCIM({paths:f});return null}_clone(f){return[f[0],f[1]]}_mid(f,c){return[(f[0]+c[0])/2,(f[1]+c[1])/2]}_mix(f,c,h,n){return[f[0]*c+h[0]*n,f[1]*c+h[1]*n]}_add(f,c){return[f[0]+c[0],f[1]+c[1]]}_add2(f,c,h){return[f[0]+c,f[1]+
h]}_sub(f,c){return[f[0]-c[0],f[1]-c[1]]}_dist(f,c){return Math.sqrt((f[0]-c[0])*(f[0]-c[0])+(f[1]-c[1])*(f[1]-c[1]))}_norm(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}_normalize(f,c=1){c/=this._norm(f);f[0]*=c;f[1]*=c}_leftPerpendicular(f){const c=f[0];f[0]=-f[1];f[1]=c}_leftPerp(f){return[-f[1],f[0]]}_rightPerpendicular(f){const c=-f[0];f[0]=f[1];f[1]=c}_rightPerp(f){return[f[1],-f[0]]}_dotProduct(f,c){return f[0]*c[0]+f[1]*c[1]}_crossProduct(f,c){return f[0]*c[1]-f[1]*c[0]}_rotateDirect(f,c,h){const n=
f[0]*h+f[1]*c;f[0]=f[0]*c-f[1]*h;f[1]=n}_makeCtrlPt(f){f=[f[0],f[1]];g.setId(f,1);return f}_addAngledTicks(f,c,h,n){const d=this._sub(h,c);this._normalize(d);var w=this._crossProduct(d,this._sub(n,c));n=0<w?this._rightPerp(d):this._leftPerp(d);w=Math.abs(w)/2;const t=[];t.push([c[0]+(n[0]-d[0])*w,c[1]+(n[1]-d[1])*w]);t.push(c);t.push(h);t.push([h[0]+(n[0]+d[0])*w,h[1]+(n[1]+d[1])*w]);f.push(t)}_addBezier2(f,c,h,n,d){if(0===d--)f.push(n);else{var w=this._mid(c,h);h=this._mid(h,n);var t=this._mid(w,
h);this._addBezier2(f,c,w,t,d);this._addBezier2(f,t,h,n,d)}}_addBezier3(f,c,h,n,d,w){if(0===w--)f.push(d);else{var t=this._mid(c,h),l=this._mid(h,n);n=this._mid(n,d);h=this._mid(t,l);l=this._mid(l,n);var e=this._mid(h,l);this._addBezier3(f,c,t,h,e,w);this._addBezier3(f,e,l,n,d,w)}}_add90DegArc(f,c,h,n,d){n=d??0<this._crossProduct(this._sub(h,c),this._sub(n,c));d=this._mid(c,h);const w=this._sub(d,c);n?this._leftPerpendicular(w):this._rightPerpendicular(w);d[0]+=w[0];d[1]+=w[1];this._addBezier3(f,
c,this._mix(c,.33333,d,.66667),this._mix(h,.33333,d,.66667),h,4)}_addArrow(f,c,h){var n=c[0],d=c[1],w=c[c.length-1],t=this._sub(n,d),l=this._norm(t);this._normalize(t);const e=Math.abs(this._crossProduct(t,this._sub(w,d)));w=this._dotProduct(t,this._sub(w,d));w<.05*l?w=.05*l:w>.95*l&&(w=.95*l);l=.5*e;var u=this._leftPerp(t);w=[d[0]+t[0]*w,d[1]+t[1]*w];var x=c.length-1;d=[];d.push(h?[-u[0],-u[1]]:u);var y=[-t[0],-t[1]];for(h=1;h<x-1;h++){t=this._sub(c[h+1],c[h]);this._normalize(t);var A=this._dotProduct(t,
y);u=this._crossProduct(t,y);A=Math.sqrt((1+A)/2);y=this._sub(t,y);this._normalize(y);y[0]/=A;y[1]/=A;d.push(0>u?[-y[0],-y[1]]:y);y=t}d.push(this._rightPerp(y));for(x=d.length-1;0<x;x--)f.push([c[x][0]+d[x][0]*l,c[x][1]+d[x][1]*l]);f.push([w[0]+d[0][0]*l,w[1]+d[0][1]*l]);f.push([w[0]+d[0][0]*e,w[1]+d[0][1]*e]);f.push(n);f.push([w[0]-d[0][0]*e,w[1]-d[0][1]*e]);f.push([w[0]-d[0][0]*l,w[1]-d[0][1]*l]);for(n=1;n<d.length;n++)f.push([c[n][0]-d[n][0]*l,c[n][1]-d[n][1]*l])}_cp2(f,c,h){return 2<=f.length?
f[1]:this._add2(f[0],c*this._defaultSize,h*this._defaultSize)}_cp3(f,c,h,n){if(3<=f.length)return f[2];h=this._mix(f[0],1-h,c,h);f=this._sub(c,f[0]);this._normalize(f);this._rightPerpendicular(f);return[h[0]+f[0]*n*this._defaultSize,h[1]+f[1]*n*this._defaultSize]}_arrowPath(f){if(2<f.length)return f;const c=f[0];f=this._cp2(f,-4,0);const h=this._sub(c,f);this._normalize(h);const n=this._rightPerp(h);return[c,f,[c[0]+(n[0]-h[0])*this._defaultSize,c[1]+(n[1]-h[1])*this._defaultSize]]}_arrowLastSeg(f){var c=
f[0];const h=this._cp2(f,-4,0);if(3<=f.length)c=f[f.length-1];else{f=this._sub(c,h);this._normalize(f);const n=this._rightPerp(f);c=[c[0]+(n[0]-f[0])*this._defaultSize,c[1]+(n[1]-f[1])*this._defaultSize]}return[h,c]}_processGeom(f){if(!f)return null;const c=[];for(const h of f){if(!h||0===h.length)continue;const n=h.length;let d=h[0];switch(this._rule){case p.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const w=this._cp2(h,0,-1),t=this._cp3(h,w,.5,4),l=[];l.push(t);l.push(this._mid(d,
w));c.push(l);break;case p.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const e=this._cp2(h,0,-1);c.push([e,d]);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:if(3>h.length)return[];const u=this._cp2(h,-4,1),x=this._cp3(h,u,.882353,-1.94),y=[];y.push(this._mid(u,x));y.push(d);c.push(y);break;case p.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:if(3>h.length)return[];const A=this._cp2(h,-4,1),k=this._cp3(h,A,.882353,-1.94),v=this._sub(k,
A);let B;B=0<this._crossProduct(v,this._sub(d,A))?this._rightPerp(v):this._leftPerp(v);const z=[];z.push([A[0]+(B[0]-v[0])/3,A[1]+(B[1]-v[1])/3]);z.push(A);z.push(k);z.push([k[0]+(B[0]+v[0])/3,k[1]+(B[1]+v[1])/3]);c.push(z);break;case p.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const E=this._cp2(h,0,-1),K=this._cp3(h,E,.5,3),I=this._mid(d,E),D=this._sub(I,K);this._normalize(D);const G=this._crossProduct(D,this._sub(d,K));this._leftPerpendicular(D);const C=[];C.push(d);C.push([K[0]+
D[0]*G,K[1]+D[1]*G]);c.push(C);const F=[];F.push([K[0]-D[0]*G,K[1]-D[1]*G]);F.push(E);c.push(F);break;case p.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const J=this._cp2(h,0,-1),T=this._cp3(h,J,.5,3),S=this._mid(d,J),ba=this._sub(S,T);this._normalize(ba);const M=this._crossProduct(ba,this._sub(d,T));this._leftPerpendicular(ba);const U=[];U.push([T[0]+ba[0]*M,T[1]+ba[1]*M]);U.push([T[0]-ba[0]*M,T[1]-ba[1]*M]);c.push(U);break;case p.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const R=
this._cp2(h,0,-1),Z=this._cp3(h,R,.5,4),ea=this._mid(d,R),ma=this._sub(ea,Z);this._normalize(ma);const V=this._crossProduct(ma,this._sub(d,Z));this._leftPerpendicular(ma);const aa=[];aa.push([Z[0]+ma[0]*V*.8,Z[1]+ma[1]*V*.8]);aa.push([ea[0]+.8*(d[0]-ea[0]),ea[1]+.8*(d[1]-ea[1])]);c.push(aa);c.push([Z,ea]);const ja=[];ja.push([Z[0]-ma[0]*V*.8,Z[1]-ma[1]*V*.8]);ja.push([ea[0]+.8*(R[0]-ea[0]),ea[1]+.8*(R[1]-ea[1])]);c.push(ja);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const oa=
this._cp2(h,0,-1),wa=this._cp3(h,oa,.5,4),ta=this._mid(d,oa);let va=this._sub(oa,d);const xa=Math.cos(Math.PI/18),L=Math.sin(Math.PI/18),P=Math.sqrt((1+xa)/2),fa=Math.sqrt((1-xa)/2),ka=[];let qa;0<this._crossProduct(va,this._sub(wa,d))?(ka.push(d),va=this._sub(d,ta),qa=oa):(ka.push(oa),va=this._sub(oa,ta),qa=d);this._rotateDirect(va,P,fa);va[0]/=P;va[1]/=P;for(let Ja=1;18>=Ja;Ja++)ka.push(this._add(ta,va)),this._rotateDirect(va,xa,L);ka.push(qa);c.push(ka);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const Q=
this._cp2(h,0,-1),X=this._cp3(h,Q,1,-1);let Y=this._sub(d,Q);this._normalize(Y);const ia=this._crossProduct(Y,this._sub(X,Q))/2;this._leftPerpendicular(Y);const na=[Q[0]+Y[0]*ia,Q[1]+Y[1]*ia];Y=this._sub(Q,na);const O=Math.cos(Math.PI/18);let da=Math.sin(Math.PI/18);0<ia&&(da=-da);const la=[Q];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(Y,O,da),la.push(this._add(na,Y));c.push(la);break;case p.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const pa=this._cp2(h,0,-2),za=this._cp3(h,pa,1,-1);
let Aa;if(4<=n)Aa=h[3];else{const Ja=this._sub(d,pa);Aa=this._add(za,Ja)}const Ba=this._dist(pa,za)/2/.75,Ga=this._sub(pa,d);this._normalize(Ga,Ba);const Da=this._sub(za,Aa);this._normalize(Da,Ba);c.push([Aa,za]);const Ha=[this._clone(za)];this._addBezier3(Ha,za,this._add(za,Da),this._add(pa,Ga),pa,4);Ha.push(d);c.push(Ha);break;case p.GeometricEffectControlMeasureLineRule.OpenCircle:const Fa=this._cp2(h,-2,0),Ea=this._sub(Fa,d),Ka=Math.cos(Math.PI/18),Ta=-Math.sin(Math.PI/18),Xa=[Fa];for(let Ja=
1;33>=Ja;Ja++)this._rotateDirect(Ea,Ka,Ta),Xa.push(this._add(d,Ea));c.push(Xa);break;case p.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Sa=this._cp2(h,0,-1);let Ma;if(3<=n)Ma=h[2];else{const Ja=this._sub(Sa,d),Ra=this._leftPerp(Ja);Ma=[d[0]+Ra[0]-.25*Ja[0],d[1]+Ra[1]-.25*Ja[1]]}let Pa;if(4<=n)Pa=h[3];else{const Ja=this._mid(d,Sa),Ra=this._sub(d,Sa);this._normalize(Ra);this._leftPerpendicular(Ra);const Ya=this._crossProduct(Ra,this._sub(Ma,Ja));this._rightPerpendicular(Ra);Pa=
[Ma[0]+Ra[0]*Ya*2,Ma[1]+Ra[1]*Ya*2]}const ua=this._sub(Sa,d);let Qa,bb;Qa=0<this._crossProduct(ua,this._sub(Ma,d))?this._rightPerp(ua):this._leftPerp(ua);bb=[];bb.push(Ma);bb.push(d);bb.push([d[0]+(Qa[0]-ua[0])/3,d[1]+(Qa[1]-ua[1])/3]);c.push(bb);Qa=0<this._crossProduct(ua,this._sub(Pa,Sa))?this._rightPerp(ua):this._leftPerp(ua);bb=[];bb.push([Sa[0]+(Qa[0]+ua[0])/3,Sa[1]+(Qa[1]+ua[1])/3]);bb.push(Sa);bb.push(Pa);c.push(bb);break;case p.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const lb=
this._cp2(h,0,2),H=this._cp3(h,lb,0,1);let Uc;if(4<=n)Uc=h[3];else{const Ja=this._sub(lb,d);Uc=this._add(H,Ja)}this._addAngledTicks(c,d,lb,this._mid(H,Uc));this._addAngledTicks(c,H,Uc,this._mid(d,lb));break;case p.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Vc=this._cp2(h,2,0),vd=this._cp3(h,Vc,0,1);let wd;if(4<=n)wd=h[3];else{const Ja=this._sub(Vc,d);wd=this._add(vd,Ja)}const Wc=[];Wc.push(this._mid(d,vd));Wc.push(this._mid(Vc,wd));c.push(Wc);break;case p.GeometricEffectControlMeasureLineRule.Chevron:const xd=
this._cp2(h,-1,-1);let yd;if(3<=n)yd=h[2];else{const Ja=this._sub(xd,d);this._leftPerpendicular(Ja);yd=this._add(d,Ja)}c.push([xd,this._makeCtrlPt(d),yd]);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Kb=this._cp2(h,0,-2),zd=this._cp3(h,Kb,.5,-1),cb=this._sub(Kb,d),mb=this._norm(cb);cb[0]/=mb;cb[1]/=mb;const vb=this._crossProduct(cb,this._sub(zd,d));let zb=this._dotProduct(cb,this._sub(zd,d));zb<.05*mb?zb=.05*mb:zb>.95*mb&&(zb=.95*mb);const ic=[d[0]+cb[0]*zb,d[1]+cb[1]*
zb];let db=this._leftPerp(cb),Yb=[];Yb.push([ic[0]-db[0]*vb,ic[1]-db[1]*vb]);Yb.push([ic[0]+db[0]*vb,ic[1]+db[1]*vb]);c.push(Yb);if(4<=n){const Ja=h[3];let Ra=this._dotProduct(cb,this._sub(Ja,d));Ra<.1*mb?Ra=.1*mb:Ra>.9*mb&&(Ra=.9*mb);const Ya=[d[0]+cb[0]*Ra,d[1]+cb[1]*Ra],eb=this._crossProduct(cb,this._sub(Ja,d)),Ad=[];Ad.push([Ya[0]-db[0]*eb,Ya[1]-db[1]*eb]);Ad.push([Ya[0]+db[0]*eb,Ya[1]+db[1]*eb]);c.push(Ad)}const de=[Kb[0]+db[0]*vb,Kb[1]+db[1]*vb];db=this._sub(Kb,de);const ee=Math.cos(Math.PI/
18);let Xc=Math.sin(Math.PI/18);0>vb&&(Xc=-Xc);Yb=[d,Kb];for(let Ja=1;9>=Ja;Ja++)this._rotateDirect(db,ee,Xc),Yb.push(this._add(de,db));c.push(Yb);break;case p.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Zb=this._cp2(h,2,0),fe=this._mid(d,Zb),ge=this._sub(Zb,fe),Ye=Math.cos(Math.PI/18),Ze=Math.sin(Math.PI/18),he=[d,Zb];for(let Ja=1;18>=Ja;Ja++)this._rotateDirect(ge,Ye,Ze),he.push(this._add(fe,ge));c.push(he);break;case p.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Lb=
this._cp2(h,0,-2),Bd=this._cp3(h,Lb,1,-2),Mb=this._mid(d,Lb),tb=this._sub(Bd,Lb);this._normalize(tb);const ie=Math.abs(this._crossProduct(tb,this._sub(Mb,Lb)))/2,$b=this._dist(Lb,Bd),je=[Lb,d];je.push([d[0]+tb[0]*$b*.5,d[1]+tb[1]*$b*.5]);c.push(je);const ac=[];ac.push([Mb[0]-tb[0]*ie,Mb[1]-tb[1]*ie]);ac.push([Mb[0]+tb[0]*$b*.375,Mb[1]+tb[1]*$b*.375]);g.setId(ac[ac.length-1],1);ac.push([Mb[0]+tb[0]*$b*.75,Mb[1]+tb[1]*$b*.75]);c.push(ac);c.push([Lb,Bd]);break;case p.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const jc=
this._cp2(h,3,0),Cd=this._cp3(h,jc,.5,-1),kc=this._sub(Cd,jc);this._normalize(kc);const ke=this._crossProduct(kc,this._sub(Cd,d));this._leftPerpendicular(kc);this._addAngledTicks(c,d,jc,Cd);this._addAngledTicks(c,this._mix(d,1,kc,ke),this._mix(jc,1,kc,ke),this._mid(d,jc));break;case p.GeometricEffectControlMeasureLineRule.Parallel:const lc=this._cp2(h,3,0),$e=this._cp3(h,lc,.5,-1),Dd=this._sub(lc,d);this._normalize(Dd);const Yc=this._leftPerp(Dd),Zc=this._crossProduct(Dd,this._sub($e,d));let mc=[d,
lc];c.push(mc);mc=[];mc.push([d[0]+Yc[0]*Zc,d[1]+Yc[1]*Zc]);mc.push([lc[0]+Yc[0]*Zc,lc[1]+Yc[1]*Zc]);c.push(mc);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const Ed=this._cp2(h,3,0),af=this._cp3(h,Ed,.5,-1),$c=this._mid(d,Ed),Nb=this._sub(Ed,d);this._normalize(Nb);const ad=this._crossProduct(Nb,this._sub(af,d));this._leftPerpendicular(Nb);const Fd=[];Fd.push([$c[0]-Nb[0]*ad*.25,$c[1]-Nb[1]*ad*.25]);Fd.push([$c[0]+Nb[0]*ad*1.25,$c[1]+Nb[1]*ad*1.25]);c.push(Fd);break;
case p.GeometricEffectControlMeasureLineRule.ParallelOffset:const bc=this._cp2(h,3,0),bf=this._cp3(h,bc,.5,-1),nb=this._sub(bc,d);this._normalize(nb);const Ab=this._crossProduct(nb,this._sub(bf,d));this._leftPerpendicular(nb);const Gd=[];Gd.push([d[0]-nb[0]*Ab,d[1]-nb[1]*Ab]);Gd.push([bc[0]-nb[0]*Ab,bc[1]-nb[1]*Ab]);c.push(Gd);const Hd=[];Hd.push([d[0]+nb[0]*Ab,d[1]+nb[1]*Ab]);Hd.push([bc[0]+nb[0]*Ab,bc[1]+nb[1]*Ab]);c.push(Hd);break;case p.GeometricEffectControlMeasureLineRule.OffsetOpposite:const bd=
this._cp2(h,3,0),cf=this._cp3(h,bd,.5,-1),Ob=this._sub(bd,d);this._normalize(Ob);const cd=this._crossProduct(Ob,this._sub(cf,d));this._leftPerpendicular(Ob);const Id=[];Id.push([d[0]-Ob[0]*cd,d[1]-Ob[1]*cd]);Id.push([bd[0]-Ob[0]*cd,bd[1]-Ob[1]*cd]);c.push(Id);break;case p.GeometricEffectControlMeasureLineRule.OffsetSame:const dd=this._cp2(h,3,0),df=this._cp3(h,dd,.5,-1),Pb=this._sub(dd,d);this._normalize(Pb);const ed=this._crossProduct(Pb,this._sub(df,d));this._leftPerpendicular(Pb);const Jd=[];Jd.push([d[0]+
Pb[0]*ed,d[1]+Pb[1]*ed]);Jd.push([dd[0]+Pb[0]*ed,dd[1]+Pb[1]*ed]);c.push(Jd);break;case p.GeometricEffectControlMeasureLineRule.CircleWithArc:let Bb=this._cp2(h,3,0);const Kd=this._cp3(h,Bb,.5,-1);let cc,fd;if(4<=n)cc=h[3],fd=0<this._crossProduct(this._sub(cc,Bb),this._sub(Kd,Bb));else{cc=Bb;fd=0<this._crossProduct(this._sub(cc,d),this._sub(Kd,d));const Ja=24*this._geomUnitsPerPoint,Ra=this._sub(cc,d);this._normalize(Ra,Ja);const Ya=Math.sqrt(2)/2;this._rotateDirect(Ra,Ya,fd?Ya:-Ya);Bb=this._add(d,
Ra)}const Ld=this._sub(Bb,d),ef=Math.cos(Math.PI/18),ff=Math.sin(Math.PI/18),dc=[Bb];for(let Ja=1;36>=Ja;Ja++)this._rotateDirect(Ld,ef,ff),dc.push(this._add(d,Ld));this._add90DegArc(dc,Bb,cc,Kd,fd);g.setId(dc[dc.length-8],1);c.push(dc);break;case p.GeometricEffectControlMeasureLineRule.DoubleJog:let Cb=this._cp2(h,-3,1),Db=this._cp3(h,Cb,-1,-.5),wb;if(4<=n)wb=h[3];else{const Ja=d;d=Cb;wb=Db;const Ra=this._dist(d,Ja),Ya=this._dist(wb,Ja);let eb=30*this._geomUnitsPerPoint;.5*Ra<eb&&(eb=.5*Ra);.5*Ya<
eb&&(eb=.5*Ya);Cb=this._mix(d,eb/Ra,Ja,(Ra-eb)/Ra);Db=this._mix(wb,eb/Ya,Ja,(Ya-eb)/Ya)}const le=this._mid(d,Cb),me=this._mid(wb,Db),gf=this._dist(d,Cb),ne=this._dist(Db,wb);let gd=Math.min(gf,ne)/8;gd=Math.min(gd,24*this._geomUnitsPerPoint);const xb=Math.cos(Math.PI/4);let fb=this._sub(d,Cb);this._normalize(fb,gd);0<this._crossProduct(fb,this._sub(wb,Cb))?this._rotateDirect(fb,xb,-xb):this._rotateDirect(fb,xb,xb);let ob=[];ob.push(Cb);ob.push(this._add(le,fb));ob.push(this._sub(le,fb));ob.push(d);
c.push(ob);fb=this._sub(wb,Db);this._normalize(fb,gd);0>this._crossProduct(fb,this._sub(d,Db))?this._rotateDirect(fb,xb,xb):this._rotateDirect(fb,xb,-xb);ob=[];ob.push(Db);ob.push(this._add(me,fb));ob.push(this._sub(me,fb));ob.push(wb);c.push(ob);break;case p.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const hd=this._cp2(h,-4,1),oe=this._cp3(h,hd,.882353,-1.94),nc=this._sub(oe,hd);0<this._crossProduct(nc,this._sub(d,hd))?this._rightPerpendicular(nc):this._leftPerpendicular(nc);const hf=
[nc[0]/8,nc[1]/8],Md=this._sub(this._mid(hd,oe),hf);c.push([Md,d]);break;case p.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const id=this._arrowPath(h),pe=[];let qe=id.length-2;for(;qe--;)pe.push(id[qe]);c.push(pe);break;case p.GeometricEffectControlMeasureLineRule.MultivertexArrow:const jf=this._arrowPath(h),re=[];this._addArrow(re,jf,!1);c.push(re);break;case p.GeometricEffectControlMeasureLineRule.CrossedArrow:const kf=this._arrowPath(h),Nd=[];this._addArrow(Nd,kf,!0);c.push(Nd);
break;case p.GeometricEffectControlMeasureLineRule.ChevronArrow:const [oc,se]=this._arrowLastSeg(h),Qb=10*this._geomUnitsPerPoint,pb=this._sub(d,oc),pc=this._norm(pb);this._normalize(pb);const qc=this._crossProduct(pb,this._sub(se,oc));let ec=this._dotProduct(pb,this._sub(se,oc));ec<.05*pc?ec=.05*pc:ec>.95*pc-Qb&&(ec=.95*pc-Qb);const jd=[oc[0]+pb[0]*ec,oc[1]+pb[1]*ec],kd=this._leftPerp(pb),ld=[];ld.push([jd[0]+kd[0]*qc+pb[0]*Qb,jd[1]+kd[1]*qc+pb[1]*Qb]);ld.push(d);ld.push([jd[0]-kd[0]*qc+pb[0]*Qb,
jd[1]-kd[1]*qc+pb[1]*Qb]);c.push(ld);break;case p.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [rc,te]=this._arrowLastSeg(h),qb=this._sub(d,rc),md=this._norm(qb);this._normalize(qb);const nd=this._crossProduct(qb,this._sub(te,rc));let fc=this._dotProduct(qb,this._sub(te,rc));fc<.05*md?fc=.05*md:fc>.95*md&&(fc=.95*md);const sc=[rc[0]+qb[0]*fc,rc[1]+qb[1]*fc];this._leftPerpendicular(qb);const od=[];od.push([sc[0]+qb[0]*nd*.5,sc[1]+qb[1]*nd*.5]);od.push(this._mid(sc,d));od.push([sc[0]-
qb[0]*nd*.5,sc[1]-qb[1]*nd*.5]);c.push(od);break;case p.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [tc,lf]=this._arrowLastSeg(h),uc=this._sub(d,tc),pd=this._norm(uc);this._normalize(uc);let gc=this._dotProduct(uc,this._sub(lf,tc));gc<.05*pd?gc=.05*pd:gc>.95*pd&&(gc=.95*pd);c.push([tc,[tc[0]+uc[0]*gc,tc[1]+uc[1]*gc]]);break;case p.GeometricEffectControlMeasureLineRule.Arch:const Od=this._cp2(h,0,-1),qd=this._cp3(h,Od,.5,1),ue=this._sub(d,Od),mf=this._mix(qd,1,ue,.55),nf=this._mix(qd,
1,ue,-.55),Pd=[d];this._addBezier2(Pd,d,mf,qd,4);this._addBezier2(Pd,qd,nf,Od,4);c.push(Pd);break;case p.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Eb=this._cp2(h,-4,1),vc=this._cp3(h,Eb,.882353,-1.94),Rb=this._sub(vc,Eb);0<this._crossProduct(Rb,this._sub(d,Eb))?this._rightPerpendicular(Rb):this._leftPerpendicular(Rb);const Qd=[Rb[0]/8,Rb[1]/8],ve=this._sub(this._mid(Eb,vc),Qd),of=this._sub(this._mix(Eb,.75,vc,.25),Qd),pf=this._sub(this._mix(Eb,.25,vc,.75),Qd),rd=[Eb];this._addBezier2(rd,
Eb,of,ve,3);this._addBezier2(rd,ve,pf,vc,3);c.push(rd);for(let Ja=0;8>Ja;Ja++){const Ra=rd[2*Ja+1],Ya=[this._clone(Ra)];Ya.push(this._add(Ra,[Rb[0]/4,Rb[1]/4]));c.push(Ya)}break;case p.GeometricEffectControlMeasureLineRule.Arc90Degrees:const Rd=this._cp2(h,0,-1),qf=this._cp3(h,Rd,.5,1),we=[Rd];this._add90DegArc(we,Rd,d,qf);c.push(we);break;case p.GeometricEffectControlMeasureLineRule.TipWithPerpendicularAndTicks:const [Sd,xe]=this._arrowLastSeg(h),hc=10*this._geomUnitsPerPoint,rb=this._sub(d,Sd),
wc=this._norm(rb);this._normalize(rb);let ub=this._crossProduct(rb,this._sub(xe,Sd)),xc=this._dotProduct(rb,this._sub(xe,Sd));xc<.05*wc?xc=.05*wc:xc>.95*wc-hc&&(xc=.95*wc-hc);const Fb=this._leftPerp(rb),yb=[d[0]-rb[0]*hc,d[1]-rb[1]*hc],Gb=.5*Math.max(wc-xc-hc,hc);ub=Math.abs(ub);const yc=[];yc.push([yb[0]+Fb[0]*(ub+Gb)-rb[0]*Gb,yb[1]+Fb[1]*(ub+Gb)-rb[1]*Gb]);yc.push([yb[0]+Fb[0]*ub,yb[1]+Fb[1]*ub]);yc.push([yb[0]-Fb[0]*ub,yb[1]-Fb[1]*ub]);yc.push([yb[0]-Fb[0]*(ub+Gb)-rb[0]*Gb,yb[1]-Fb[1]*(ub+Gb)-
rb[1]*Gb]);c.push(yc);c.push([yb,d]);break;default:c.push(h)}}return c}}a.EffectControlMeasureLine=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends r.PathEffectCursor{constructor(b,
f,c){super(b,!0,!0);this._curveHelper=new g.CurveHelper;this._beginCut=(void 0!==f.beginCut?f.beginCut:1)*c;this._endCut=(void 0!==f.endCut?f.endCut:1)*c;this._middleCut=(void 0!==f.middleCut?f.middleCut:0)*c;this._invert=void 0!==f.invert?f.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(b){const {_beginCut:f,_endCut:c,_middleCut:h}=this,n=b.pathLength(),d=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(!this._invert)if(0===f&&0===c&&0===h)for(d.startPath();b.nextPoint();)d.pushXY(b.x,b.y);else f+c+h<n&&(0===h?this._curveHelper.appendSubCurve(d,b,f,n-c):(this._curveHelper.appendSubCurve(d,b,f,.5*(n-h)),this._curveHelper.appendSubCurve(d,b,.5*(n+h),n-c)));else if(0!==f||0!==c||0!==h)if(f+c+h>=n)for(d.startPath();b.nextPoint();)d.pushXY(b.x,b.y);else this._curveHelper.appendSubCurve(d,b,0,f),this._curveHelper.appendSubCurve(d,b,.5*(n-h),.5*(n+h)),this._curveHelper.appendSubCurve(d,b,n-c,c);return 0===
d.totalSize?null:d}}a.EffectCut=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/coordsUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),function(a,q,r,g,p,m,b,f){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(n,d,w,t,l){return new h(n,d,w,t)}}c.instance=null;
class h extends p.PathEffectCursor{constructor(n,d,w,t){super(n,!0,!0);this._firstCurve=null;this._walker=new b.GeometryWalker;this._walker.updateTolerance(w);this._endings=d.lineDashEnding;this._customDashPos=-(d.offsetAlongLine??0)*w;this._offsetAtEnd=(d.customEndingOffset??0)*w;this._tileKey=t;n=f.normalizeDashTemplate(d).dashTemplate;null==n&&(n=[]);n.length%2&&(n=[...n,...n]);d=0;for(t=0;t<n.length;t++){let l=Math.abs(n[t]);1E-7>l&&(l=1E-7);d+=l}this._patternLength=d;this._numOfDashesPerPattern=
n.length/2;this._pattern=new b.DashPattern;this._pattern.init(n,!0);this._pattern.scale(w)}processPath(n){if(0===this._pattern.length())return this.iteratePath=!1,n=r.collectPath(n),q.GeometryCursor.fromJSONCIM({paths:[n]});if(!this.iteratePath){var d=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case m.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case m.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());
break;case m.LineDashEnding.NoConstraint:this.isClosed||(d=!1);break;case m.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var w=n.pathLength();if(this._pattern.isEmpty()||w<.1*this._pattern.length()||!this._walker.init(n,this._pattern,d))return n=r.collectPath(n),q.GeometryCursor.fromJSONCIM({paths:[n]})}if(this.iteratePath)n=this._pattern.nextValue();else{switch(this._endings){default:d=.5*this._pattern.firstValue();break;case m.LineDashEnding.HalfGap:d=.5*-this._pattern.lastValue();
break;case m.LineDashEnding.FullGap:d=-this._pattern.lastValue();break;case m.LineDashEnding.FullPattern:d=0;break;case m.LineDashEnding.NoConstraint:case m.LineDashEnding.Custom:d=-this._customDashPos}n=d/this._pattern.length();n-=Math.floor(n);d=n*this._pattern.length();this._pattern.reset();n=this._pattern.nextValue();for(w=!1;d>=n;)d-=n,n=this._pattern.nextValue(),w=!w;n-=d;w?(this._walker.nextPosition(n),n=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(n),
n=this._pattern.nextValue(),this._walker.nextPosition(n),n=this._pattern.nextValue())}if(d=this._walker.nextCurve(n))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)d.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else n=this._pattern.nextValue(),!this._walker.nextPosition(n)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(d.pushCursor(this._firstCurve),this._firstCurve=null)):
this.iteratePath=!0;else this.iteratePath=!1,d=this._firstCurve,this._firstCurve=null;d?.reset();return d}isClippingRequired(n){n=r.collectMultipath(n);let d=0;for(const w of n)d+=g.getPathLength(w);return 1E3<Math.round(d/this._patternLength*this._numOfDashesPerPattern)}}a.EffectDashes=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(a,q,r){class g{constructor(){this._values=
[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(f,c,h=!0){this._setEmpty();if(!f||0===f.length)return!1;for(let n=0;n<f.length;n++){let d=Math.abs(f[n]);h&&1E-7>d&&(d=1E-7);this._values.push(d);this._length+=d}c&&f.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(f){const c=this._values?this._values.length:0;for(let h=0;h<c;++h)this._values[h]*=
f;this._length*=f;this.extPtGap*=f;this.ctrlPtGap*=f}addValue(f){this._length+=f;this._values.push(f)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0}}class p{constructor(){this.pt=
null;this.sa=this.ca=0}}a.EndType=void 0;(function(f){f[f.FAIL=0]="FAIL";f[f.END=1]="END";f[f.CONTINUE=2]="CONTINUE"})(a.EndType||(a.EndType={}));class m{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(f){f.segment=this.segment;f.segmentLength=this.segmentLength;f.abscissa=this.abscissa;f.isPathEnd=this.isPathEnd;f.isPartEnd=this.isPartEnd}}class b extends r.CurveHelper{constructor(f=
0,c=!1){super(f,c);this._tolerance=r.pixelTolerance;this._currentPosition=new m}updateTolerance(f){this._tolerance=r.pixelTolerance*f}init(f,c,h=!0){h?(this._patternLength=c.length(),this._partExtPtGap=c.extPtGap,this._partCtrlPtGap=c.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=f;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(f,c=a.EndType.FAIL){const h=
new m;if(!this._nextPosition(f,h,null,c))return!1;h.copyTo(this._currentPosition);return!0}curPointAndAngle(f){f.pt=this._getPoint(this._currentPosition);const [c,h]=this._getAngleCS(this._currentPosition);f.ca=c;f.sa=h}nextPointAndAngle(f,c,h=a.EndType.FAIL){const n=new m;if(!this._nextPosition(f,n,null,h))return!1;n.copyTo(this._currentPosition);c.pt=this._getPoint(n);const [d,w]=this._getAngleCS(n);c.ca=d;c.sa=w;return!0}nextCurve(f){if(0===f)return null;const c=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
c.startPath();c.nextPath();const h=new m;if(!this._nextPosition(f,h,c,a.EndType.END))return null;h.copyTo(this._currentPosition);return c}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(f){this._pathCursor.seekInPath(f);return[this._pathCursor.x,this._pathCursor.y]}getSeg(f){const c=this.getPt(f);f=this.getPt(f+1);return[c,f]}_nextPosition(f,c,h,n){if(this._currentPosition.isPathEnd)return!1;var d=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(d/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(c);c.abscissa+f*this._partLengthRatio>c.segmentLength+this._tolerance;)if(h&&(0===h.pathSize&&(0===d?(d=c.segment[0],h.pushXY(d[0],d[1])):h.pushPoint(this.getSegCoord2D(c.segment,d))),d=c.segment[1],h.pushXY(d[0],d[1])),d=0,f-=(c.segmentLength-c.abscissa)/this._partLengthRatio,this._partSegCount)c.segment=this._nextSegment(),c.segmentLength=this.getSegLength(c.segment),c.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(n===
a.EndType.FAIL)return!1;c.segmentLength=this.getSegLength(c.segment);c.isPartEnd=!0;n===a.EndType.END?(c.abscissa=c.segmentLength,c.isPathEnd=!0):c.abscissa=c.segmentLength+f;return!0}this._currentPosition.copyTo(c)}c.abscissa+=f*this._partLengthRatio;h&&(0===h.pathSize&&(0===d?h.pushPoint(c.segment[0]):h.pushPoint(this.getSegCoord2D(c.segment,d))),f=c.abscissa/c.segmentLength,1===f?h.pushPoint(c.segment[1]):h.pushPoint(this.getSegCoord2D(c.segment,f)));!this._partSegCount&&Math.abs(c.abscissa-c.segmentLength)<
this._tolerance&&(c.isPathEnd=this._partIsLast,c.isPartEnd=!0);return!0}_getPoint(f){return this.getSegCoord2D(this._currentPosition.segment,0>=f.segmentLength?0:f.abscissa/f.segmentLength)}_getAngleCS(f){return this.getSegAngleCS(this._currentPosition.segment,0>=f.segmentLength?0:f.abscissa/f.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=
0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var f=this._partSegCount;f;)this._previousSegment(),--f;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=
!1;--this._partSegCount;f=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(f);f=f+this._partSegCount+1;f>=this._pathCursor.pathSize&&(f=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(f);if(0<this._patternLength){f=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const c=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let h=Math.round((this._partLength-(f+c))/this._patternLength);0>=h&&(h=0<f+c?0:1);this._partLengthRatio=this._partLength/(f+c+h*
this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}a.DashPattern=g;a.GeometryWalker=b;a.Pos=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require",
"exports","./defaultCIMValues"],function(a,q,r){function g(y){return"function"===typeof y}function p(y){let A=y.length;for(;A--;)if(!" /-,\n".includes(y.charAt(A)))return!1;return!0}function m(y,A){"string"!==typeof y&&(y=String(y));switch(A){case "LowerCase":return y.toLowerCase();case "Allcaps":return y.toUpperCase();default:return y}}function b(y){return y?[y[0],y[1],y[2],y[3]/255]:[0,0,0,0]}function f(y){return null!=y&&("CIMMarkerPlacementAlongLineRandomSize"===y.type||"CIMMarkerPlacementAlongLineSameSize"===
y.type||"CIMMarkerPlacementAlongLineVariableSize"===y.type||"CIMMarkerPlacementAtExtremities"===y.type||"CIMMarkerPlacementAtMeasuredUnits"===y.type||"CIMMarkerPlacementAtRatioPositions"===y.type||"CIMMarkerPlacementOnLine"===y.type||"CIMMarkerPlacementOnVertices"===y.type)}function c(y){if(!y)return null;switch(y.type){case "CIMPolygonSymbol":if(y.symbolLayers)for(const A of y.symbolLayers)if(y=c(A),null!=y)return y;break;case "CIMTextSymbol":return c(y.symbol);case "CIMSolidFill":return y.color}return null}
function h(y){if(y)switch(y.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(y=y.symbolLayers)for(const A of y)if(y=h(A),null!=y)return y;break;case "CIMTextSymbol":return h(y.symbol);case "CIMSolidStroke":return y.color}}function n(y){if(y)switch(y.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(y.symbolLayers)for(const A of y.symbolLayers)if(y=n(A),void 0!==y)return y;break;case "CIMTextSymbol":return n(y.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return y.width}}
function d(y){return y?y.charAt(0).toLowerCase()+y.substring(1):y}function w(y){if(null==y)return!1;if(Array.isArray(y))return y.every(A=>w(A));switch(typeof y){case "string":return!!y;case "number":return!isNaN(y)}}function t(y,A){if("color"===A||"outlinecolor"===A||"backgroundcolor"===A||"borderlinecolor"===A||"tintcolor"===A)return[...r.defaultCIMColor[A]];const k=r.defaultCIMValues[y];if(!k)throw Error(`InternalError: default value for type ${y}.`);return k[A]}function l(y){if(null==y)return"Normal";
switch(y.type){case "CIMTextSymbol":return y.textCase??"Normal";case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var A=y.symbolLayers;if(!A)break;for(var k of A)if("CIMVectorMarker"===k.type)return l(k);break;case "CIMVectorMarker":if(k=y.markerGraphics)for(A of k)if(A.symbol)return l(A.symbol)}return"Normal"}function e(y,A){return null!==A?(A=A.get(y))?A.name:y:y}function u(y,A,k,v,B){return(k=k*Math.PI/180)?(Math.sin(k)*y+Math.cos(k)*A)*v+B:A*v+B}function x(y,A,k,v,B){return(k=
k*Math.PI/180)?(Math.cos(k)*y-Math.sin(k)*A)*v+B:y*v+B}q.adjustTextCase=m;q.analyzeTextParts=function(y,A){const k=[];var v=0;let B=-1;do B=y.indexOf("[",v),B>=v&&(B>v&&(v=y.substr(v,B-v),k.push([v,null,p(v)])),v=B+1,B=y.indexOf("]",v),B>=v&&(B>v&&(v=y.substr(v,B-v),(v=A[v])&&k.push([null,v,!1])),v=B+1));while(-1!==B);v<y.length-1&&(y=y.substr(v),k.push([y,null,p(y)]));return k};q.applyParentTransform=function(y,A,k,v,B,z){const {infos:E}=z;z=1;let K=0;var I=0,D=0;for(const {offsetX:G,offsetY:C,rotation:F,
size:J,frameHeight:T,rotateClockWise:S}of E)I=x(G,C,K,z,I),D=u(G,C,K,z,D),T&&(z*=J/T),K=S?K-F:K+F;I=x(v,B,K,z,I);v=u(v,B,K,z,D);return{size:y*z,rotation:k?K-A:K+A,offsetX:I,offsetY:v}};q.assignTextValuesFromFeature=function(y,A,k,v){let B="",z=null;for(const E of A){const [K,I,D]=E;if(K)D?z=K:(z&&(B+=z,z=null),B+=K);else if(A=I,null!=k&&(A=e(I,k)),A=y.attributes[A])z&&(B+=z,z=null),B+=A}return m(B,v)};q.attributesToFields=function(y){return(y?Object.keys(y):[]).map(A=>({name:A,alias:A,type:"string"===
typeof y[A]?"esriFieldTypeString":"esriFieldTypeDouble"}))};q.colorToArray=function(y){return[y.r,y.g,y.b,y.a]};q.evaluateValueOrFunction=function(y,A,k,v){return g(y)?y(A,k,v):y};q.fromCIMFontDecoration=function(y){return y.underline?"underline":y.strikethrough?"line-through":"none"};q.fromCIMFontStyle=function(y){let A="normal",k="normal";y&&(y=y.toLowerCase(),y.includes("italic")?A="italic":y.includes("oblique")&&(A="oblique"),y.includes("bold")?k="bold":y.includes("light")&&(k="lighter"));return{style:A,
weight:k}};q.fromCIMHorizontalAlignment=function(y){switch(y){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};q.fromCIMVerticalAlignment=function(y){switch(y){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};q.getDefaultCIMValue=t;q.getEnum=(y,A)=>null==y?A:y;q.getFieldName=e;q.getFillColor=c;q.getFontStyle=function(y){if(!y)return"normal";switch(y.toLowerCase()){case "italic":return"italic";
case "oblique":return"oblique";default:return"normal"}};q.getFontWeight=function(y){if(!y)return"normal";switch(y.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};q.getNumericValue=(y,A=0)=>null==y||isNaN(y)?A:y;q.getSize=function(y){if(y)switch(y.type){case "CIMTextSymbol":return y.height;case "CIMPointSymbol":var A=0;if(y.symbolLayers)for(var k of y.symbolLayers)if(k)switch(k.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":y=
k.size??r.defaultCIMValues.CIMVectorMarker.size,y>A&&(A=y)}return A;case "CIMLineSymbol":case "CIMPolygonSymbol":k=0;if(y.symbolLayers)for(A of y.symbolLayers)if(A)switch(A.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":y=A.width;null!=y&&y>k&&(k=y);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":A.markerPlacement&&f(A.markerPlacement)&&(y=A.size??r.defaultCIMValues.CIMVectorMarker.size,y>
k&&(k=y));break;case "CIMPictureFill":y=A.height,null!=y&&y>k&&(k=y)}return k}};q.getStrokeColor=h;q.getStrokeWidth=n;q.getTextCasing=l;q.getTintColor=y=>y.tintColor?b(y.tintColor):[255,255,255,1];q.getValueOrExpression=function(y,A,k){let v=A[d(k)];null==v&&(v=t(A.type,k));null!=A.primitiveName&&(y=y[A.primitiveName],null!=y&&(y=y[k],null!=y&&(v="string"===typeof y||"number"===typeof y||Array.isArray(y)?y:{valueExpressionInfo:y,defaultValue:v})));if(null==v)throw Error(`Failed to derive a value or an expression for "${k}".`);
return v};q.importGeometryEngine=function(){return new Promise((y,A)=>a(["../../geometry/geometryEngineJSON"],y,A))};q.isCIMFill=function(y){return null!=y&&("CIMGradientFill"===y.type||"CIMHatchFill"===y.type||"CIMPictureFill"===y.type||"CIMSolidFill"===y.type||"CIMWaterFill"===y.type)};q.isCIMMarker=function(y){return"CIMVectorMarker"===y.type||"CIMPictureMarker"===y.type||"CIMBarChartMarker"===y.type||"CIMCharacterMarker"===y.type||"CIMPieChartMarker"===y.type||"CIMStackedBarChartMarker"===y.type};
q.isCIMMarkerStrokePlacement=f;q.isCIMStroke=function(y){return"CIMGradientStroke"===y.type||"CIMPictureStroke"===y.type||"CIMSolidStroke"===y.type};q.isFeatureValueFn=g;q.isGeometryEngineRequired=y=>{if(!y)return!1;for(const A of y)switch(A.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};q.isSVGImage=y=>y.includes("data:image/svg+xml");q.isValidCIMValue=w;q.mapCIMSymbolToGeometryType=function(y){if(!y)return null;switch(y.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";
case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};q.normalizeAlpha=b;q.normalizeDashTemplate=function(y){y?.dashTemplate&&"string"===typeof y.dashTemplate&&(y.dashTemplate=y.dashTemplate.split(" ").map(Number));return y};q.normalizePrimitiveOverrideProps=function(y){return y.map(A=>({...A,propertyName:d(A.propertyName)}))};q.resampleHermite=function(y,A,k,v,B,z,E=!0){const K=A/B;k/=z;const I=Math.ceil(K/2),D=Math.ceil(k/2);
for(let F=0;F<z;F++)for(let J=0;J<B;J++){const T=4*(J+(E?z-F-1:F)*B);var G=0;let S=0,ba=0,M=0,U=0,R=0,Z=0;const ea=(F+.5)*k;for(let ma=Math.floor(F*k);ma<(F+1)*k;ma++){var C=Math.abs(ea-(ma+.5))/D;const V=(J+.5)*K;C*=C;for(let aa=Math.floor(J*K);aa<(J+1)*K;aa++){let ja=Math.abs(V-(aa+.5))/I;G=Math.sqrt(C+ja*ja);-1<=G&&1>=G&&(G=2*G*G*G-3*G*G+1,0<G&&(ja=4*(aa+ma*A),Z+=G*y[ja+3],ba+=G,255>y[ja+3]&&(G=G*y[ja+3]/250),M+=G*y[ja],U+=G*y[ja+1],R+=G*y[ja+2],S+=G))}}v[T]=M/S;v[T+1]=U/S;v[T+2]=R/S;v[T+3]=Z/
ba}};q.toCIMSymbolJSON=function(y){return y.data?.symbol??null};q.toLowerCaseProps=function(y){const A={};for(const k in y){const v=y[k];A[d(k)]=v}return A};q.uncapitalize=d;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/defaultCIMValues":function(){define(["exports"],function(a){a.defaultCIMColor={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]};a.defaultCIMValues={CIMVectorMarker:{scalesymbolsproportionally:!1,
respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",
underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",
enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,
length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",
offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,
angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),
function(a,q,r,g,p,m){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(c,h,n,d,w,t){return new f(c,h,n,d,w,t)}}b.instance=null;class f{constructor(c,h,n,d,w,t){this._inputGeometries=c;this._tileKey=d;this._geometryEngine=w;this._maxInflateSize=t*n;this._width=(void 0!==h.width?h.width:2)*n;this._option=h.option}next(){for(var c;c=this._inputGeometries.next();){if("esriGeometryEnvelope"===c.geometryType&&0<this._width){var h=c.asJSON();return 0>Math.min(h.xmax-
h.xmin,h.ymax-h.ymin)-2*this._width?c:r.GeometryCursor.fromJSONCIM({paths:[[[h.xmin+this._width,h.ymin+this._width],[h.xmax-this._width,h.ymin+this._width],[h.xmax-this._width,h.ymax-this._width],[h.xmin+this._width,h.ymax-this._width],[h.xmin+this._width,h.ymin+this._width]],[[h.xmin,h.ymin],[h.xmin,h.ymax],[h.xmax,h.ymax],[h.xmax,h.ymin],[h.xmin,h.ymin]]]})}if("esriGeometryPolygon"===c.geometryType){if(0===this._width)return c.clone();var n=this._geometryEngine;if(null==n)break;if(c=this._tileKey?
g.clipCursorToTileExtent(c,this._maxInflateSize):c.clone()){if(n=n.buffer(m.WebMercator,c.asJSON(),-this._width,1))for(h of n.rings)if(h){c.startPath();for(const d of h.reverse())c.pushXY(d[0],c.yFactor*d[1])}return c}}}return null}}a.EffectDonut=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,q,r,g){class p{static local(){null===p.instance&&
(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends r.PathEffectCursor{constructor(b,f,c){super(b,!1,!0);this._curveHelper=new g.CurveHelper;this._length=(void 0!==f.length?f.length:20)*c;this._angle=void 0!==f.angle?f.angle:225;this._position=void 0!==f.position?f.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(b){const f=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(b))return null;b.seekInPath(0);const c=b.x,h=b.y;b.seekInPath(b.pathSize-1);const n=b.x;b=b.y;this._curveHelper.normalize([n-c,b-h]);const d=c+(n-c)*this._position/100,w=h+(b-h)*this._position/100,t=Math.cos((90-this._angle)/180*Math.PI);let l=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(l=-l);this._mirror=!this._mirror;f.pushPath([[c,h],[d-this._length/2*t,w-this._length/2*l],[d+this._length/2*t,w+this._length/2*l],[n,b]]);return f}}a.EffectJog=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(a){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(g,p,m,b,f){return new r(g,p,m)}}q.instance=null;class r{constructor(g,p,m){this._inputGeometries=g;this._offsetX=void 0!==p.offsetX?p.offsetX*m:0;this._offsetY=void 0!==p.offsetY?p.offsetY*m:0}next(){let g=this._inputGeometries.next();for(;g;){if(0<g.totalSize)return this._move(g.clone(),this._offsetX,
this._offsetY);g=this._inputGeometries.next()}return null}_move(g,p,m){for(;g.nextPath();)for(;g.nextPoint();)g.x+=p,g.y+=m;g.reset();return g}}a.EffectMove=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(a,q,r,g,p,m,b,f,c){class h{static local(){null===h.instance&&(h.instance=new h);return h.instance}execute(d,w,t,l,e,u){return new n(d,w,t,l,e,u)}}h.instance=null;class n{constructor(d,w,t,l,e,u){this._inputGeometries=d;this._tileKey=l;this._geometryEngine=e;this._curveHelper=new b.CurveHelper;this._offset=(w.offset??1)*t;this._method=w.method;this._maxInflateSize=Math.max(Math.abs(u*t),10);this._option=w.option;this._offsetFlattenError=b.pixelTolerance*t}next(){for(var d;d=this._inputGeometries.next();){if(0===
this._offset)return d.clone();if("esriGeometryEnvelope"===d.geometryType){if(this._method===f.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var w=g.collectPath(d);if(w=this._curveHelper.offset(w,-this._offset,this._method,4,this._offsetFlattenError))return d=r.GeometryCursor.createEmptyOptimizedCIM(d.geometryType),d.pushPath(w),d;break}w=d.asJSON();if(p.isExtent(w)&&0<Math.min(w.xmax-w.xmin,w.ymax-w.ymin)+2*this._offset)return r.GeometryCursor.fromJSONCIM({xmin:w.xmin-this._offset,xmax:w.xmax+
this._offset,ymin:w.ymin-this._offset,ymax:w.ymax+this._offset})}w=this._geometryEngine;if(null!=w&&(d=this._tileKey?m.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()))return(d=w.offset(c.WebMercator,d.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?r.GeometryCursor.fromJSONCIM(d):null}return null}}a.EffectOffset=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(a){class q{static local(){null===
q.instance&&(q.instance=new q);return q.instance}execute(g,p,m,b,f){return new r(g,p,m)}}q.instance=null;class r{constructor(g,p,m){this._inputGeometries=g;this._reverse=void 0!==p.reverse?p.reverse:!0}next(){for(var g=this._inputGeometries.next();g;){if(!this._reverse)return g;if("esriGeometryPolyline"===g.geometryType){for(g=g.clone();g.nextPath();)for(let p=0;p<g.pathSize/2;p++){g.seekInPath(p);const m=g.x,b=g.y;g.seekInPath(g.pathSize-p-1);const f=g.x,c=g.y;g.x=m;g.y=b;g.seekInPath(p);g.x=f;g.y=
c}g.reset();return g}g=this._inputGeometries.next()}return null}}a.EffectReverse=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(a,q){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(p,m,b,f,c){return new g(p,m,b)}}r.instance=null;class g{constructor(p,m,b){this._inputGeometries=p;this._rotateAngle=void 0!==m.angle?m.angle*Math.PI/
180:0}next(){let p=this._inputGeometries.next();for(;p;){if(0===this._rotateAngle||"esriGeometryPoint"===p.geometryType)return p;if(0<p.totalSize){var m=q.getCursorBoundsXY(p);const b=(m[2]+m[0])/2;m=(m[3]+m[1])/2;p.reset();return this._rotate(p.clone(),b,m)}p=this._inputGeometries.next()}return null}_rotate(p,m,b){const f=Math.cos(this._rotateAngle),c=Math.sin(this._rotateAngle);for(;p.nextPath();)for(;p.nextPoint();){const h=p.x-m,n=p.y-b;p.x=m+h*f-n*c;p.y=b+h*c+n*f}p.reset();return p}}a.EffectRotate=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(a,q){class r{static local(){null===r.instance&&(r.instance=new r);return r.instance}execute(p,m,b,f,c){return new g(p,m,b)}}r.instance=null;class g{constructor(p,m,b){this._inputGeometries=p;this._xFactor=void 0!==m.xScaleFactor?m.xScaleFactor:1.15;this._yFactor=void 0!==m.yScaleFactor?m.yScaleFactor:1.15}next(){const p=
this._inputGeometries.next();if(p){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===p.geometryType)return p;if(0<p.totalSize){var m=q.getCursorBoundsXY(p);const b=(m[2]+m[0])/2;m=(m[3]+m[1])/2;p.reset();return this._scaleCursor(p.clone(),b,m)}}return null}_scaleCursor(p,m,b){for(;p.nextPath();)for(;p.nextPoint();)p.x=m+(p.x-m)*this._xFactor,p.y=b+(p.y-b)*this._yFactor;p.reset();return p}}a.EffectScale=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports",
"../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m{constructor(b,f,c){this._inputGeometries=b;this._height=(void 0!==f.amplitude?f.amplitude:2)*c;this._period=(void 0!==f.period?f.period:3)*c;this._style=f.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));
this._pattern=new g.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new g.GeometryWalker;this._walker.updateTolerance(c)}next(){for(var b=this._inputGeometries.next();b;){if(0===this._height||0===this._period||(b=this._processGeom(b)))return b;b=this._inputGeometries.next()}return null}_processGeom(b){const f=q.GeometryCursor.createEmptyOptimizedCIM(b.geometryType);for(;b.nextPath();){f.startPath();const c=b.pathLength();if(this._walker.init(b,this._pattern))switch(this._style){default:this._constructCurve(f,
c,!1);break;case r.GeometricEffectWaveform.Square:this._constructSquare(f,c);break;case r.GeometricEffectWaveform.Triangle:this._constructTriangle(f,c);break;case r.GeometricEffectWaveform.Random:this._constructCurve(f,c,!0)}else for(;b.nextPoint();)f.pushXY(b.x,b.y)}return f}_constructCurve(b,f,c){var h=Math.round(f/this._period);0===h&&(h=1);const n=this._period/16,d=1/(16*h+1);f=2*Math.PI*f/(f/h);h=2*Math.PI*Math.random();const w=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),l=.75-Math.random()/
2,e=.75-Math.random()/2,u=new g.Pos;this._walker.curPointAndAngle(u);b.pushPoint(u.pt);let x=0;for(;;)if(this._walker.nextPointAndAngle(n,u)){const y=x;x+=d;let A;if(c){const k=this._height/2*(1+.3*Math.sin(l*f*y+h));A=k*Math.sin(f*y+w);A+=k*Math.sin(e*f*y+t);A/=2}else A=.5*this._height*Math.sin(.5*f*y);b.pushXY(u.pt[0]-A*u.sa,u.pt[1]+A*u.ca)}else{b.pushPoint(this._walker.getPathEnd());break}}_constructSquare(b,f){Math.round(f/this._period);for(f=!0;;){let c=!1;if(this._walker.curPositionIsValid()){const h=
new g.Pos;this._walker.curPointAndAngle(h);const n=new g.Pos;if(this._walker.nextPointAndAngle(this._period,n)){const d=new g.Pos;this._walker.nextPointAndAngle(this._period,d)&&(f?(b.pushPoint(h.pt),f=!1):b.pushPoint(h.pt),b.pushXY(h.pt[0]-this._height/2*h.sa,h.pt[1]+this._height/2*h.ca),b.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),b.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),b.pushXY(d.pt[0]+this._height/2*d.sa,d.pt[1]-this._height/2*d.ca),c=!0)}}if(!c){b.pushPoint(this._walker.getPathEnd());
break}}}_constructTriangle(b,f){Math.round(f/this._period);for(f=!0;;){let c=!1;if(this._walker.curPositionIsValid()){const h=new g.Pos;this._walker.curPointAndAngle(h);const n=new g.Pos;if(this._walker.nextPointAndAngle(this._period/2,n)){const d=new g.Pos;this._walker.nextPointAndAngle(this._period,d)&&(this._walker.nextPosition(this._period/2)&&(f?(b.pushPoint(h.pt),f=!1):b.pushPoint(h.pt),b.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),b.pushXY(d.pt[0]+this._height/2*d.sa,d.pt[1]-
this._height/2*d.ca)),c=!0)}}if(!c){b.pushPoint(this._walker.getPathEnd());break}}}}a.EffectWave=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends q.PathTransformationCursor{constructor(b,
f,c){super(b);this._geometryWalker=new g.GeometryWalker;this._geometryWalker.updateTolerance(c);this._angleToLine=f.angleToLine??!0;this._offset=(f.offset?f.offset:0)*c;this._originalEndings=f.endings;this._offsetAtEnd=(f.customEndingOffset?f.customEndingOffset:0)*c;this._position=-(f.offsetAlongLine?f.offsetAlongLine:0)*c;this._pattern=new g.DashPattern;this._pattern.init(f.placementTemplate,!1);this._pattern.scale(c);this._endings=this._originalEndings}processPath(b){if(this._pattern.isEmpty())return null;
if(this.iteratePath)var f=this._pattern.nextValue();else{this._endings=this._originalEndings===r.PlacementEndings.WithFullGap&&this.isClosed?r.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let c=!0;switch(this._endings){case r.PlacementEndings.NoConstraint:f=-this._position;f=this._adjustPosition(f);c=!1;break;default:f=-this._pattern.lastValue()/2;break;case r.PlacementEndings.WithFullGap:f=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();
break;case r.PlacementEndings.WithMarkers:f=0;break;case r.PlacementEndings.Custom:f=-this._position,f=this._adjustPosition(f),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(b,this._pattern,c))return null;this._pattern.reset();for(b=0;f>b;)f-=b,b=this._pattern.nextValue();f=b-f;this.iteratePath=!0}b=new g.Pos;if(!this._geometryWalker.nextPointAndAngle(f,b)||this._endings===r.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===
r.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(b.pt[0]-this._offset*b.sa,b.pt[1]+this._offset*b.ca);this._angleToLine&&this.internalPlacement.setRotateCS(b.ca,b.sa);return this.internalPlacement}_adjustPosition(b){b/=this._pattern.length();b-=Math.floor(b);return b*this._pattern.length()}}a.PlacementAlongLineSameSize=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends q.PathTransformationCursor{constructor(b,f,c){super(b,!1,!0);this._curveHelper=new r.CurveHelper;this._placePerPart=f.placePerPart??!1;this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*c:0;this._type=f.extremityPlacement;this._position=void 0!==
f.offsetAlongLine?f.offsetAlongLine*c:0;this._beginProcessed=!1}processMultiPath(b){return this._placePerPart?super.processMultiPath(b):this.processPath(b)}processPath(b){let f;switch(this._type){default:this._beginProcessed?(f=this._atExtremities(b,this._position,!1),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!1):(f=this._atExtremities(b,this._position,!0),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!0);break;case g.ExtremityPlacement.JustBegin:f=this._atExtremities(b,
this._position,!0);break;case g.ExtremityPlacement.JustEnd:f=this._atExtremities(b,this._position,!1);case g.ExtremityPlacement.None:}return f}_atExtremities(b,f,c){this._placePerPart||(c?b.seekPath(0):b.seekPath(b.totalSize-1));c||b.seekPathEnd();if(c?b.nextPoint():b.prevPoint()){let h=0,[n,d]=[0,0],[w,t]=[b.x,b.y];for(;c?b.nextPoint():b.prevPoint();){n=w;d=t;w=b.x;t=b.y;const l=this._curveHelper.getLength(n,d,w,t);if(h+l>f){b=(f-h)/l;const [e,u]=this._curveHelper.getAngleCS(n,d,w,t,b);b=this._curveHelper.getCoord2D(n,
d,w,t,b);this.internalPlacement.setTranslate(b[0]-this._offset*u,b[1]+this._offset*e);this._angleToLine&&this.internalPlacement.setRotateCS(-e,-u);return this.internalPlacement}h+=l}}return null}}a.PlacementAtExtremities=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(a,q,r){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(m,
b,f,c,h){return new p(m,b,f)}}g.instance=null;class p extends q.PathTransformationCursor{constructor(m,b,f){super(m);this._walker=new r.GeometryWalker;this._walker.updateTolerance(f);this._angleToLine=void 0!==b.angleToLine?b.angleToLine:!0;this._offset=void 0!==b.offset?b.offset*f:0;this._beginGap=void 0!==b.beginPosition?b.beginPosition*f:0;this._endGap=void 0!==b.endPosition?b.endPosition*f:0;this._flipFirst=void 0!==b.flipFirst?b.flipFirst:!0;this._pattern=new r.DashPattern;this._pattern.init(b.positionArray,
!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(m){if(this._pattern.isEmpty())return null;if(this.iteratePath){m=this._pattern.nextValue()*this._subPathLen;var b=this._beginGap+m;m=b-this._prevPos;this._prevPos=b}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=m.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(m,this._pattern,!1))return null;
this._pattern.reset();m=this._pattern.nextValue()*this._subPathLen;b=this._beginGap+m;m=b-this._prevPos;this._prevPos=b;this.iteratePath=!0}b=new r.Pos;if(!this._walker.nextPointAndAngle(m,b,r.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(b.pt[0]-this._offset*b.sa,b.pt[1]+this._offset*b.ca);m=this._isFirst&&this._flipFirst;let f;this._angleToLine?(f=b.ca,b=b.sa):(f=1,b=0);m&&(f=-f,b=-b);this.internalPlacement.setRotateCS(f,b);this._isFirst=!1;this._posCount--;0===
this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}a.PlacementAtRatioPositions=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements","../enums"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c,h,n)}}p.instance=null;class m{constructor(b,f,c,h,n){this._currentY=
this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(f.stepX??16)*c;this._stepY=Math.abs(f.stepY??16)*c;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=f.gridType??g.PlacementGridType.Fixed;if(this._gridType===g.PlacementGridType.Random)this._randomLCG=new q(1*(f.seed??13)),this._randomness=(f.randomness??
100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=f.gridAngle??0;this._shiftOddRows=f.shiftOddRows??!1;this._offsetX=(f.offsetX??0)*c;this._offsetY=(f.offsetY??0)*c;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=
.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=h){const [d,w,t,l]=h.split("/");f=parseFloat(d);c=parseFloat(w);h=parseFloat(t);this._graphicOriginX=512*-(parseFloat(l)*2**f+h);this._graphicOriginY=512*c;this._testInsidePolygon=!0}this._internalPlacement=new r.Placement;this._calculateMinMax(b);
this._geometryCursor=b}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!m._randValues){m._randValues=[];for(let b=0;24>b;b++)for(let f=0;24>f;f++)m._randValues.push(this._randomLCG.getFloat()),m._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(b){this._yMax=this._yMin=this._xMax=this._xMin=0;let f,c,h,n,d,w,t,l;f=c=t=d=Number.MAX_VALUE;h=n=l=w=-Number.MAX_VALUE;var e=1!==this._cosAngle;for(b.reset();b.nextPath();)for(;b.nextPoint();){var u=b.x;var x=
b.y;var y=u-this._graphicOriginX-this._offsetX;var A=x-this._graphicOriginY-this._offsetY;if(e){var k=this._cosAngle*y-this._sinAngle*A;y=this._sinAngle*y+this._cosAngle*A}else k=y,y=A;f=Math.min(f,k);h=Math.max(h,k);c=Math.min(c,y);n=Math.max(n,y);d=Math.min(d,x);w=Math.max(w,x);t=Math.min(t,u);l=Math.max(l,u)}d=d!==Number.MAX_VALUE?d:-512-this._stepY;w=w!==-Number.MAX_VALUE?w:this._stepY;t=t!==Number.MAX_VALUE?t:-this._stepX;l=l!==-Number.MAX_VALUE?l:512+this._stepX;this._polygonMin=(this._verticalSubdivision=
w-d>=l-t)?d:t;if(this._testInsidePolygon){k=0-this._graphicOriginX-this._offsetX-this._stepX;x=512-this._graphicOriginX-this._offsetX+this._stepX;u=-512-this._graphicOriginY-this._offsetY-this._stepY;y=0-this._graphicOriginY-this._offsetY+this._stepY;if(e){e=[[k,u],[k,y],[x,u],[x,y]];k=u=Number.MAX_VALUE;x=y=-Number.MAX_VALUE;for(const v of e)e=this._cosAngle*v[0]-this._sinAngle*v[1],A=this._sinAngle*v[0]+this._cosAngle*v[1],k=Math.min(k,e),x=Math.max(x,e),u=Math.min(u,A),y=Math.max(y,A)}f=f!==Number.MAX_VALUE?
Math.max(f,k):k;c=c!==Number.MAX_VALUE?Math.max(c,u):u;h=h!==-Number.MAX_VALUE?Math.min(h,x):x;n=n!==-Number.MAX_VALUE?Math.min(n,y):y}this._xMin=Math.round(f/this._stepX);this._xMax=Math.round(h/this._stepX);this._yMin=Math.round(c/this._stepY);this._yMax=Math.round(n/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(b,t,l,d,w)}_buildAccelerationMap(b,f,c,h,n){b.reset();const d=new Map,w=this._verticalSubdivision;c=w?n-h:c-f;n=Math.ceil(c/10);if(!(1>=
n)){c=Math.floor(c/n);n++;this._delta=c;var t,l;if(w){n=-512-2*this._stepY;var e=2*this._stepY;var u=h}else n=-2*this._stepX,e=512+2*this._stepX,u=f;for(;b.nextPath();)if(!(2>b.pathSize)&&b.nextPoint()){var x=b.x;for(t=b.y;b.nextPoint();x=f,t=h){f=b.x;h=b.y;if(w){if(t===h||t<n&&h<n||t>e&&h>e)continue;var y=Math.min(t,h);var A=Math.max(t,h)}else{if(x===f||x<n&&f<n||x>e&&f>e)continue;y=Math.min(x,f);A=Math.max(x,f)}for(;y<A;){var k=l=Math.floor((y-u)/c),v=x,B=t,z=f,E=h,K=d;let I=K.get(k);I||(I=[],K.set(k,
I));I.push([[v,B],[z,E]]);y+=c}y=Math.floor((A-u)/c);y>l&&(A=f,k=h,v=d,B=v.get(y),B||(B=[],v.set(y,B)),B.push([[x,t],[A,k]]))}}this._accelerationMap=d}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var b=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(b+=.5*this._stepX);const f=this._currentY*this._stepY+this._offsetY;this._currentX++;
let c;if(this._gridType===g.PlacementGridType.Random){const h=(this._currentX%24+24)%24,n=(this._currentY%24+24)%24;c=this._graphicOriginX+b+this._stepX*this._randomness*(.5-m._randValues[24*n+h])*2/3;b=this._graphicOriginY+f+this._stepY*this._randomness*(.5-m._randValues[24*n+h+1])*2/3}else c=this._graphicOriginX+this._cosAngle*b+this._sinAngle*f,b=this._graphicOriginY-this._sinAngle*b+this._cosAngle*f;if(!this._testInsidePolygon||this._isInsidePolygon(c,b,this._geometryCursor))return this._internalPlacement.setTranslate(c,
b),this._internalPlacement}}_isInsidePolygon(b,f,c){if(null==this._accelerationMap){var h=0,n;let t;b+=1E-6;f+=1E-6;for(c.reset();c.nextPath();)if(c.nextPoint()){var d=c.x;for(n=c.y;c.nextPoint();d=w,n=t){var w=c.x;t=c.y;n>f!==t>f&&(0<(w-d)*(f-n)-(t-n)*(b-d)?h++:h--)}}return 0!==h}b+=1E-6;f+=1E-6;c=this._verticalSubdivision;n=this._accelerationMap.get(Math.floor(((c?f:b)-this._polygonMin)/this._delta));if(!n)return!1;d=0;for(h of n){n=h[0];w=h[1];if(c){if(n[1]>f===w[1]>f)continue;n=(w[0]-n[0])*(f-
n[1])-(w[1]-n[1])*(b-n[0])}else{if(n[0]>b===w[0]>b)continue;n=(w[1]-n[1])*(b-n[0])-(w[0]-n[0])*(f-n[1])}0<n?d++:d--}return 0!==d}}a.PlacementInsidePolygon=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(a,q,r,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends q.PathTransformationCursor{constructor(b,
f,c){super(b);this._curveHelper=new r.CurveHelper;this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*c:0;this._relativeTo=f.relativeTo;this._position=void 0!==f.startPointOffset?f.startPointOffset*c:0;this._epsilon=.001*c}processPath(b){var f=this._position;if(this._relativeTo===g.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(b.nextPoint()){let [c,h]=[b.x,b.y],[n,d]=[0,0];for(;b.nextPoint();){n=b.x;d=b.y;f=this._curveHelper.getLength(c,
h,n,d);if(f<this._epsilon){c=n;h=d;continue}b=.5+this._position/f;const [w,t]=this._curveHelper.getAngleCS(c,h,n,d,b);b=this._curveHelper.getCoord2D(c,h,n,d,b);this.internalPlacement.setTranslate(b[0]-this._offset*t,b[1]+this._offset*w);this._angleToLine&&this.internalPlacement.setRotateCS(w,t);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(b,f,this._relativeTo===g.PlacementOnLineRelativeTo.LineEnd)}onLine(b,f,c){let h=!1;switch(this._relativeTo){default:b.seekPathStart();
f=b.pathLength()/2+f;break;case g.PlacementOnLineRelativeTo.LineBeginning:break;case g.PlacementOnLineRelativeTo.LineEnd:h=!0}c?b.seekPathEnd():b.seekPathStart();let n=0;if(c?b.prevPoint():b.nextPoint()){let [d,w]=[b.x,b.y],[t,l]=[0,0];for(;c?b.prevPoint():b.nextPoint();){t=b.x;l=b.y;const e=this._curveHelper.getLength(d,w,t,l);if(n+e>f){b=(f-n)/e;const [u,x]=this._curveHelper.getAngleCS(d,w,t,l,b);b=this._curveHelper.getCoord2D(d,w,t,l,b);c=h?-this._offset:this._offset;this.internalPlacement.setTranslate(b[0]-
c*x,b[1]+c*u);this._angleToLine&&(h?this.internalPlacement.setRotateCS(-u,-x):this.internalPlacement.setRotateCS(u,x));return this.internalPlacement}d=t;w=l;n+=e}}return null}}a.PlacementOnLine=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(a,q,r){function g(b,f){const c=Math.PI;for(;Math.abs(f-b)>c+2E-15;)f=f-b>c?f-2*c:f+2*c;return(b+f)/2}class p{static local(){null===
p.instance&&(p.instance=new p);return p.instance}execute(b,f,c,h,n){return new m(b,f,c)}}p.instance=null;class m extends q.PathTransformationCursor{constructor(b,f,c){super(b);this._curveHelper=new r.CurveHelper;this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*c:0;this._endPoints=void 0!==f.placeOnEndPoints?f.placeOnEndPoints:!0;this._controlPoints=void 0!==f.placeOnControlPoints?f.placeOnControlPoints:!0;this._regularVertices=void 0!==f.placeOnRegularVertices?
f.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(b){this.iteratePath||(this._preparePath(b),this.iteratePath=!0);if(this._tagIterator>=this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;b=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(b[2]);let f=b[0],c=b[1];if(0!==this._offset){const h=Math.cos(b[2]);f-=this._offset*Math.sin(b[2]);c+=this._offset*h}this.internalPlacement.setTranslate(f,c);this._tagIterator++;
return this.internalPlacement}_preparePath(b){this._tagIterator=this._tags.length=0;b.seekPathStart();const f=b.isClosed();let c=0,h=!1,n=0,d=0;b.seekPathStart();if(b.nextPoint()){let w=b.x,t=b.y,l=b.getControlPoint(),e=!0,u=b.nextPoint();for(;u;){const x=b.x,y=b.y,A=b.getControlPoint();if(this._angleToLine||0!==this._offset)n=this._curveHelper.getAngle(w,t,x,y,0);e?(e=!1,f?(c=n,h=l):(this._endPoints||this._controlPoints&&l)&&this._tags.push([w,t,n])):l?this._controlPoints&&this._tags.push([w,t,g(d,
n)]):this._regularVertices&&this._tags.push([w,t,g(d,n)]);if(this._angleToLine||0!==this._offset)d=this._curveHelper.getAngle(w,t,x,y,1);(u=b.nextPoint())||(f?A||h?this._controlPoints&&this._tags.push([x,y,g(d,c)]):this._regularVertices&&this._tags.push([x,y,g(d,c)]):(this._endPoints||this._controlPoints&&A)&&this._tags.push([x,y,d]));w=x;t=y;l=A}}this._tagIterator=0}}a.PlacementOnVertices=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(a,q,r,g,p,m){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(c,h,n,d,w){return new f(c,h,n)}}b.instance=null;class f{constructor(c,h,n){this._geometryCursor=c;this._offsetX=void 0!==h.offsetX?h.offsetX*n:0;this._offsetY=void 0!==h.offsetY?h.offsetY*n:0;this._method=void 0!==h.method?h.method:m.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new p.Placement}next(){const c=this._geometryCursor;this._geometryCursor=null;return c?this._polygonCenter(c):
null}_polygonCenter(c){let h=!1;switch(this._method){case m.PlacementPolygonCenterMethod.CenterOfMass:if(c=r.weightedAreaCentroid(c))this._internalPlacement.setTranslate(c[0]+this._offsetX,c[1]+this._offsetY),h=!0;break;case m.PlacementPolygonCenterMethod.BoundingBoxCenter:if(c=q.getCursorBoundsXY(c))this._internalPlacement.setTranslate((c[2]+c[0])/2+this._offsetX,(c[3]+c[1])/2+this._offsetY),h=!0;break;default:c=g.getLabelPoint(c),null!==c&&(this._internalPlacement.setTranslate(c[0]+this._offsetX,
c[1]+this._offsetY),h=!0)}return h?this._internalPlacement:null}}a.PlacementPolygonCenter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(a,q,r,g,p,m,b){function f(l,e){let u=0,x,y,A,k;for(e.reset();e.nextPath()&&e.nextPoint();)for(x=e.x,y=e.y;e.nextPoint();x=A,y=k)A=e.x,k=e.y,y>l[1]!==k>l[1]&&(0<(A-x)*
(l[1]-y)-(k-y)*(l[0]-x)?u++:u--);return 0!==u}function c(l,e,u){if(u&&f(l,e))return{coord:l,distance:0};u=Infinity;let x=0,y=0;var A=[0,0];let k=[0,0];const v=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(2>e.pathSize))for(A[0]=e.x,A[1]=e.y;e.nextPoint();A=k)k=[e.x,e.y],m.projectPointOnLineSeg(v,l,A,k),A=d(l,v),A<u&&(u=A,x=v[0],y=v[1]);return{coord:[x,y],distance:Math.sqrt(u)}}function h(l,e,u,x){u=[e,0];let y=Infinity,A=Infinity,k=!1,v=!1;e=[[e,x[1]-1],[e,x[3]+1]];x=[0,0];const B=[0,0],z=
[0,0],E=[[0,0],[0,0]],K=r.create();for(l.reset();l.nextPath()&&l.nextPoint();)if(!(2>l.pathSize))for(E[0][0]=l.x,E[0][1]=l.y;l.nextPoint();E[0][0]=E[1][0],E[0][1]=E[1][1]){E[1][0]=l.x;E[1][1]=l.y;a:{var I=K;var D=E;if(2>D.length){I=null;break a}I||=r.create();const [C,F]=D[0],[J,T]=D[1];I[0]=Math.min(C,J);I[1]=Math.min(F,T);I[2]=Math.max(C,J);I[3]=Math.max(F,T)}if(null!==I){B[0]=e[0][0];B[1]=e[0][1];z[0]=e[1][0];z[1]=e[1][1];a:{I=K;D=B;var G=z;let C=n(D,I),F=n(G,I);const J=I[0],T=I[1],S=I[2],ba=I[3];
if(C&F){I=0;break a}if(!(C|F)){I=4;break a}const M=(C?1:0)|(F?2:0);do{const U=G[0]-D[0],R=G[1]-D[1];if(U>R)C&3?(C&1?(D[1]+=R*(J-D[0])/U,D[0]=J):(D[1]+=R*(S-D[0])/U,D[0]=S),C=n(D,I)):F&3?(F&1?(G[1]+=R*(J-G[0])/U,G[0]=J):(G[1]+=R*(S-G[0])/U,G[0]=S),F=n(G,I)):C?(C&4?(D[0]+=U*(T-D[1])/R,D[1]=T):(D[0]+=U*(ba-D[1])/R,D[1]=ba),C=n(D,I)):(F&4?(G[0]+=U*(T-G[1])/R,G[1]=T):(G[0]+=U*(ba-G[1])/R,G[1]=ba),F=n(G,I));else if(C&12?(C&4?(D[0]+=U*(T-D[1])/R,D[1]=T):(D[0]+=U*(ba-D[1])/R,D[1]=ba),C=n(D,I)):F&12?(F&4?
(G[0]+=U*(T-G[1])/R,G[1]=T):(G[0]+=U*(ba-G[1])/R,G[1]=ba),F=n(G,I)):C?(C&1?(D[1]+=R*(J-D[0])/U,D[0]=J):(D[1]+=R*(S-D[0])/U,D[0]=S),C=n(D,I)):(F&1?(G[1]+=R*(J-G[0])/U,G[0]=J):(G[1]+=R*(S-G[0])/U,G[0]=S),F=n(G,I)),C&F){I=0;break a}}while(C|F);I=M}0!==I&&b.segmentIntersects(e[0],e[1],E[0],E[1],x)&&(I=x[1],y>A?I<y&&(y=I,k=!0):I<A&&(A=I,v=!0))}}k&&v?u[1]=(y+A)/2:u[0]=u[1]=NaN;return u}function n(l,e){return(l[0]<e[0]?1:0)|(l[0]>e[2]?1:0)<<1|(l[1]<e[1]?1:0)<<2|(l[1]>e[3]?1:0)<<3}function d(l,e){return(l[0]-
e[0])*(l[0]-e[0])+(l[1]-e[1])*(l[1]-e[1])}function w(l,e){if(l<e)return-1;if(l>e)return 1;if(l===e)return 0;l=isNaN(l);e=isNaN(e);return l<e?-1:l>e?1:0}class t{constructor(l,e,u,x){this.x=l;this.y=e;this.cellSize=u;this.distancefromCellCenter=m.distanceFromPointToPolygon(l,e,x);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}a.getLabelPoint=function(l){if(0===l.totalSize)return null;var e=g.getCursorBoundsXY(l);if(!e)return null;var u=8.8818E-14*(Math.abs(e[0])+Math.abs(e[2])+
Math.abs(e[1])+Math.abs(e[3])+1),x=0,y=0;l.reset();for(var A=0;l.nextPath();A++){var k=l.getCurrentRingArea();k>y&&(y=k,x=A)}l.seekPath(x);if(0===l.pathSize)return null;l.seekPathStart();k=g.getCursorPathBounds(l);if(Math.abs(y)<=2*u*u)return[(k[0]+k[2])/2,(k[1]+k[3])/2];l.seekPathStart();var v=p.ringCentroidCursorXY(l,r.create());if(null===v)return null;if(4>l.totalPoints)return v;y=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];x=[NaN,NaN,NaN,NaN];A=[NaN,NaN,NaN,NaN];var B=!1,z=c(v,l,!0);0===z.distance&&
(B=!0,y[0][0]=v[0],y[0][1]=v[1],z=c(v,l,!1));x[0]=z.distance;A[0]=0;var E=[NaN,NaN];let K=!1,I=.25,D=-1;z=NaN;do{z=NaN;var G=k[0];y[1]=h(l,G+(k[2]-G)*I,u,e);isNaN(y[1][0])||isNaN(y[1][1])||(z=c(y[1],l,!1),z=z.distance);if(!isNaN(z)&&z>u&&f(y[1],l))K=!0,x[1]=z,A[1]=d(y[1],v);else if(!isNaN(z)&&z>D&&(D=z,E[0]=y[1][0],E[1]=y[1][1]),I-=.01,.1>I)if(0<=D)K=!0,x[1]=D,y[1][0]=E[0],y[1][1]=E[1],A[1]=d(y[1],v);else break}while(!K);K=!1;I=.5;D=-1;G=.01;let C=1;do{z=NaN;var F=k[0];y[2]=h(l,F+(k[2]-F)*I,u,e);
isNaN(y[2][0])||isNaN(y[2][1])||(z=c(y[2],l,!1),z=z.distance);if(!isNaN(z)&&z>u&&f(y[2],l))K=!0,x[2]=z,A[2]=d(y[2],v);else if(!isNaN(z)&&z>D)D=z,E[0]=y[2][0],E[1]=y[2][1];else if(z>D&&(D=z,E[0]=y[2][0],E[1]=y[2][1]),I=.5+G*C,G+=.01,C*=-1,.3>I||.7<I)if(0<=D)K=!0,x[2]=D,y[2][0]=E[0],y[2][1]=E[1],A[2]=d(y[2],v);else break}while(!K);K=!1;I=.75;D=-1;do if(z=NaN,G=k[0],y[3]=h(l,G+(k[2]-G)*I,u,e),isNaN(y[3][0])||isNaN(y[3][1])||(z=c(y[3],l,!1),z=z.distance),!isNaN(z)&&z>u&&f(y[3],l))K=!0,x[3]=z,A[3]=d(y[3],
v);else if(z>D&&(D=z,E[0]=y[3][0],E[1]=y[3][1]),I+=.01,.9<I)if(0<=D)K=!0,x[3]=D,y[3][0]=E[0],y[3][1]=E[1],A[3]=d(y[3],v);else break;while(!K);l=[0,1,2,3];e=B?0:1;for(k=e;4>k;k++)for(B=e;3>B;B++)v=A[B],E=A[B+1],0<w(v,E)&&(u=l[B],l[B]=l[B+1],l[B+1]=u,A[B]=E,A[B+1]=v);A=e;for(k=u=0;4>e;e++){switch(e){case 0:k=2*x[l[e]];break;case 1:k=1.66666666*x[l[e]];break;case 2:k=1.33333333*x[l[e]];break;case 3:k=x[l[e]]}k>u&&(u=k,A=l[e])}return y[A]};a.getPolylabelPoint=function(l){if(!l.nextPath()||!l.pathSize)return null;
var e=g.getCursorPathBounds(l),u=e[2]-e[0],x=e[3]-e[1];if(0===u||0===x)return[e[0]+u/2,e[1]+x/2];const y=Math.max(Math.min(u,x)/100,1),A=new q((B,z)=>z.maxDistanceToPolygon-B.maxDistanceToPolygon);x=Math.min(u,x);u=x/2;let k=0,v=0;for(k=e[0];k<e[2];k+=x)for(v=e[1];v<e[3];v+=x)A.enqueue(new t(k+u,v+u,u,l));l.reset();l.nextPath();e=p.ringsCentroidCursor(l);if(null===e)return null;for(e=new t(e[0],e[1],0,l);0<A.size;)x=A.dequeue(),x.distancefromCellCenter>e.distancefromCellCenter&&(e=x),x.maxDistanceToPolygon-
e.distancefromCellCenter<=y||(u=x.cellSize/2,A.enqueue(new t(x.x-u,x.y-u,u,l)),A.enqueue(new t(x.x+u,x.y-u,u,l)),A.enqueue(new t(x.x-u,x.y+u,u,l)),A.enqueue(new t(x.x+u,x.y+u,u,l)));return[e.x,e.y]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class a{constructor(r=q){this._data=[];this._compare=r}get size(){return this._data.length}enqueue(r){if(null!=r){var {_data:g,_compare:p}=this;g.push(r);r=g.length-1>>>0;for(var m=g[r];0<
r;){const b=r-1>>1,f=g[b];if(0>=p(f,m))g[b]=m,g[r]=f,r=b;else break}}}dequeue(){const {_data:r,_compare:g}=this,p=r[0];var m=r.pop();if(0===r.length)return p;r[0]=m;m=0;const b=r.length,f=r[0];let c;let h=null;for(;;){var n=2*m+1;const d=2*m+2;h=null;n<b&&(c=r[n],0<g(c,f)&&(h=n));d<b&&(n=r[d],null===h&&0>=g(n,f)||null!==h&&0>=g(n,c))&&(h=d);if(null===h)break;r[m]=r[h];r[h]=f;m=h}return p}}const q=(r,g)=>r<g?-1:r>g?1:0;return a})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A){function k(V,aa,ja){switch(aa.type){case "CIMSymbolReference":return k(V,aa.symbol,ja);case "CIMPointSymbol":null==ja&&(ja={x:0,y:0});V.drawSymbol(aa,ja);break;case "CIMLineSymbol":null==ja&&(ja={paths:[[[0,0],[10,0]]]});V.drawSymbol(aa,ja);break;case "CIMPolygonSymbol":null==ja&&(ja={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});V.drawSymbol(aa,ja);break;case "CIMTextSymbol":V.drawSymbol(aa,{x:0,y:0});break;case "CIMVectorMarker":ja=new n.Placement,
V.drawMarker(aa,ja)}return V.envelope()}function v(V){if(!V)return 0;switch(V.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(V.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(V.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(V.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(V.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(V.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(V.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(V.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function B(V){if(!V)return 0;switch(V.type){case "CIMGeometricEffectArrow":return Math.abs(.5*V.width);case "CIMGeometricEffectBuffer":return Math.abs(V.size);case "CIMGeometricEffectControlMeasureLine":return 500;case "CIMGeometricEffectExtension":return Math.abs(V.length);case "CIMGeometricEffectJog":return Math.abs(.5*V.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(l.getNumericValue(V.offsetX)),
Math.abs(l.getNumericValue(V.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(V.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(V.offset);case "CIMGeometricEffectRadial":return Math.abs(V.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(V.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(V.fromWidth),Math.abs(V.toWidth));case "CIMGeometricEffectWave":return Math.abs(V.amplitude);
case "CIMGeometricEffectDonut":return Math.abs(V.width);default:return 0}}function z(V){if(!V)return 0;let aa=0;for(const ja of V)aa+=B(ja);return aa}function E(V,aa){if(V)switch(V.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(V=V.symbolLayers)for(const ja of V)switch(aa(ja),ja.type){case "CIMVectorMarker":if(V=ja.markerGraphics)for(const oa of V)oa&&(V=oa.symbol)&&E(V,aa)}}}function K(V,aa,ja){V.effects&&null==aa.geometryEngine&&(aa.geometryEnginePromise?ja.push(aa.geometryEnginePromise):
l.isGeometryEngineRequired(V.effects)&&(aa.geometryEnginePromise=l.importGeometryEngine(),ja.push(aa.geometryEnginePromise),aa.geometryEnginePromise.then(oa=>aa.geometryEngine=oa)))}function I(V){if(!V)return null;let aa=null;const {cap:ja,color:oa,join:wa,miterLimit:ta,style:va,width:xa}=V;"solid"!==va&&"none"!==va&&"esriSLSSolid"!==va&&"esriSLSNull"!==va&&(aa=[{type:"CIMGeometricEffectDashes",dashTemplate:ea(va,ja),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",
color:"esriSLSNull"!==va&&"none"!==va?Z(oa):[0,0,0,0],capStyle:ba(ja),joinStyle:M(wa),miterLimit:ta,width:xa,effects:aa}}const D=Math.PI,G=D/2,C=Math.PI/180,F=96/72,J=()=>p.getLogger("esri.symbols.cim.CIMSymbolHelper");class T{static getSymbolInflateSize(V,aa,ja,oa,wa){V||=[0,0,0,0];return aa?this._getInflateSize(V,aa,ja,oa,wa):V}static safeSize(V){const aa=Math.max(Math.abs(V[0]),Math.abs(V[2]));V=Math.max(Math.abs(V[1]),Math.abs(V[3]));return Math.sqrt(aa*aa+V*V)}static _vectorMarkerBounds(V,aa,
ja,oa){let wa=!0;const ta=f.create();if(aa?.markerGraphics)for(const va of aa.markerGraphics)aa=[0,0,0,0],va.geometry&&(c.getBoundsXY(ta,va.geometry),aa[0]=0,aa[1]=0,aa[2]=0,aa[3]=0,this.getSymbolInflateSize(aa,va.symbol,ja,0,oa),ta[0]+=aa[0],ta[1]+=aa[1],ta[2]+=aa[2],ta[3]+=aa[3],wa?(V[0]=ta[0],V[1]=ta[1],V[2]=ta[2],V[3]=ta[3],wa=!1):(V[0]=Math.min(V[0],ta[0]),V[1]=Math.min(V[1],ta[1]),V[2]=Math.max(V[2],ta[2]),V[3]=Math.max(V[3],ta[3])));return V}static _getInflateSize(V,aa,ja,oa,wa){return void 0!==
aa.symbolLayers?(V=this._getLayersInflateSize(V,aa.symbolLayers,ja,oa,wa),aa=z(aa.effects),0<aa&&(V[0]-=aa,V[1]-=aa,V[2]+=aa,V[3]+=aa),V):this._getTextInflatedSize(V,aa,wa)}static _getLayersInflateSize(V,aa,ja,oa,wa){let ta=!0;if(!aa)return V;for(const ka of aa)if(ka){aa=[0,0,0,0];switch(ka.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var va=ka,xa=va.width;null!=xa&&(xa=va.capStyle===t.LineCapStyle.Square||va.joinStyle===t.LineJoinStyle.Miter?xa/1.4142135623730951:
xa/2,aa[0]=-xa,aa[1]=-xa,aa[2]=xa,aa[3]=xa);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":va=ka;if("CIMVectorMarker"===ka.type){if(xa=ka,aa=this._vectorMarkerBounds(aa,xa,ja,wa),xa.frame){var L=(xa.frame.xmin+xa.frame.xmax)/2,P=(xa.frame.ymin+xa.frame.ymax)/2;aa[0]-=L;aa[1]-=P;aa[2]-=L;aa[3]-=P;null!=xa.size&&(xa=xa.size/(xa.frame.ymax-xa.frame.ymin),aa[0]*=xa,aa[1]*=xa,aa[2]*=xa,aa[3]*=xa)}}else"CIMPictureMarker"===ka.type?(xa=ka,P=ja.getResource(xa.url),L=1,null!=
P&&P.height&&(L=P.width/P.height),null!=va.size&&(aa=va.size/2,xa=va.size*L*xa.scaleX/2,aa=[-xa,-aa,xa,aa])):null!=va.size&&(aa=va.size/2,aa=[-aa,-aa,aa,aa]);va.anchorPoint&&("Absolute"===va.anchorPointUnits?(xa=va.anchorPoint.x,L=va.anchorPoint.y):(xa=va.anchorPoint.x*(aa[2]-aa[0]),L=va.anchorPoint.y*(aa[3]-aa[1])),xa=1.25*Math.sqrt(xa*xa+L*L),aa[0]-=xa,aa[1]-=xa,aa[2]+=xa,aa[3]+=xa);xa=l.getNumericValue(va.rotation);va.rotateClockwise&&(xa=-xa);oa&&(xa-=oa);xa&&(L=C*xa,xa=Math.cos(L),L=Math.sin(L),
P=f.create([u.cInfinity,u.cInfinity,-u.cInfinity,-u.cInfinity]),f.expandPointInPlace(P,[aa[0]*xa-aa[1]*L,aa[0]*L+aa[1]*xa]),f.expandPointInPlace(P,[aa[0]*xa-aa[3]*L,aa[0]*L+aa[3]*xa]),f.expandPointInPlace(P,[aa[2]*xa-aa[1]*L,aa[2]*L+aa[1]*xa]),f.expandPointInPlace(P,[aa[2]*xa-aa[3]*L,aa[2]*L+aa[3]*xa]),aa=P);xa=l.getNumericValue(va.offsetX);L=l.getNumericValue(va.offsetY);if(oa){var fa=C*oa;P=Math.cos(fa);fa=Math.sin(fa);const qa=xa*fa+L*P;xa=xa*P-L*fa;L=qa}aa[0]+=xa;aa[1]+=L;aa[2]+=xa;aa[3]+=L;va=
v(va.markerPlacement);0<va&&(aa[0]-=va,aa[1]-=va,aa[2]+=va,aa[3]+=va)}va=z(ka.effects);0<va&&(aa[0]-=va,aa[1]-=va,aa[2]+=va,aa[3]+=va);ta?(V[0]=aa[0],V[1]=aa[1],V[2]=aa[2],V[3]=aa[3],ta=!1):(V[0]=Math.min(V[0],aa[0]),V[1]=Math.min(V[1],aa[1]),V[2]=Math.max(V[2],aa[2]),V[3]=Math.max(V[3],aa[3]))}return V}static _getTextInflatedSize(V,aa,ja){var oa=A.roundPtToWholePixel(aa.height??w.defaultCIMValues.CIMTextSymbol.height);V[0]=-oa/2;V[1]=-oa/2;V[2]=oa/2;V[3]=oa/2;if(!ja)return V;ja=ja.get(aa);if(!ja||
!ja.glyphMosaicItems.glyphs.length)return V;const {lineGapType:wa,lineGap:ta}=aa,va=wa?d.lineGapType2LineHeight(wa,ta??0,oa):0,xa="CIMBackgroundCallout"===aa.callout?.type;aa=y.shapeGlyphs(ja.glyphMosaicItems,{scale:oa/x.glyphSize,angle:l.getNumericValue(aa.angle),xOffset:l.getNumericValue(aa.offsetX),yOffset:l.getNumericValue(aa.offsetY),horizontalAlignment:aa.horizontalAlignment,verticalAlignment:aa.verticalAlignment,maxLineWidth:A.getLineWidth(aa.lineWidth),lineHeight:x.magicLabelLineHeight*Math.max(.25,
Math.min(va||1,4)),decoration:aa.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:xa}).boundsT;oa=Math.sqrt(aa.width*aa.width+aa.height*aa.height);V[0]-=aa.x+oa;V[1]-=aa.y-oa;V[2]+=aa.x+oa;V[3]+=-aa.y+oa;return V}}class S{static getEnvelope(V,aa,ja){if(!V)return null;ja=new d.EnvDrawHelper(ja);if(Array.isArray(V)){let oa;for(const wa of V)oa?oa.union(k(ja,wa,aa)):oa=k(ja,wa,aa);return oa}return k(ja,V,aa)}static getTextureAnchor(V,aa){V=this.getEnvelope(V,null,aa);if(!V)return[0,0,0];
aa=V.height*F+2;return[-((V.x+.5*V.width)*F)/(V.width*F+2),-((V.y+.5*V.height)*F)/aa,aa]}static rasterize(V,aa,ja,oa,wa=!0){var ta=ja||this.getEnvelope(aa,null,oa);if(!ta)return[null,0,0,0,0];const va=(ta.x+.5*ta.width)*F,xa=(ta.y+.5*ta.height)*F;V.width=ta.width*F;V.height=ta.height*F;ja||(V.width+=2,V.height+=2);ja=V.getContext("2d",{willReadFrequently:!0});ta=d.Transformation.createScale(F,-F);ta.translate(.5*V.width-va,.5*V.height+xa);oa=new d.CanvasDrawHelper(ja,oa,ta);switch(aa.type){case "CIMPointSymbol":oa.drawSymbol(aa,
{type:"point",x:0,y:0});break;case "CIMVectorMarker":ta=new n.Placement,oa.drawMarker(aa,ta)}aa=ja.getImageData(0,0,V.width,V.height);aa=new Uint8Array(aa.data);if(wa)for(oa=0;oa<aa.length;oa+=4)wa=aa[oa+3]/255,aa[oa]*=wa,aa[oa+1]*=wa,aa[oa+2]*=wa;return[aa,V.width,V.height,-va/V.width,-xa/V.height]}static fromTextSymbol(V){const {text:aa}=V;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",
frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:S.createCIMTextSymbolfromTextSymbol(V),textString:aa}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(V){const {height:aa,outline:ja,width:oa,xoffset:wa,xscale:ta,yoffset:va,yscale:xa}=V,L=[],P={type:"CIMPolygonSymbol",symbolLayers:L};if(ja){var fa=I(ja);fa&&L.push(fa)}fa=V.url;"esriPFS"===V.type&&V.imageData&&(fa=V.imageData);V=
"angle"in V?V.angle??0:0;L.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:t.TextureFilter.Picture,tintColor:null,url:fa,height:(aa??0)*(xa||1),width:(oa??0)*(ta||1),offsetX:l.getNumericValue(wa),offsetY:l.getNumericValue(va),rotation:l.getNumericValue(-V),colorSubstitutions:null});return P}static fromSimpleFillSymbol(V){const {color:aa,style:ja,outline:oa}=V;V=[];const wa={type:"CIMPolygonSymbol",symbolLayers:V};if(oa){var ta=I(oa);ta&&V.push(ta)}if(ja&&"solid"!==ja&&
"none"!==ja&&"esriSFSSolid"!==ja&&"esriSFSNull"!==ja){ta={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Z(aa),capStyle:t.LineCapStyle.Butt,joinStyle:t.LineJoinStyle.Miter,width:.75}]};let va=0;const xa=b.px2pt("vertical"===ja||"horizontal"===ja||"cross"===ja||"esriSFSCross"===ja||"esriSFSVertical"===ja||"esriSFSHorizontal"===ja?8:10);switch(ja){case "vertical":case "esriSFSVertical":va=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":va=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":va=
45;break;case "cross":case "esriSFSCross":va=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":va=-45}V.push({type:"CIMHatchFill",lineSymbol:ta,offsetX:0,offsetY:0,rotation:va,separation:xa});"cross"===ja||"esriSFSCross"===ja?V.push({type:"CIMHatchFill",lineSymbol:g.clone(ta),offsetX:0,offsetY:0,rotation:90,separation:xa}):("diagonal-cross"===ja||"esriSFSDiagonalCross"===ja)&&V.push({type:"CIMHatchFill",lineSymbol:g.clone(ta),offsetX:0,offsetY:0,rotation:45,separation:xa})}else!ja||"solid"!==
ja&&"esriSFSSolid"!==ja||V.push({type:"CIMSolidFill",enable:!0,color:Z(aa)});return wa}static fromSimpleLineSymbol(V){const {cap:aa,color:ja,join:oa,marker:wa,miterLimit:ta,style:va,width:xa}=V;V=null;"solid"!==va&&"none"!==va&&"esriSLSSolid"!==va&&"esriSLSNull"!==va&&(V=[{type:"CIMGeometricEffectDashes",dashTemplate:ea(va,aa),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const L=[];if(wa){let P;switch(wa.placement){case "begin-end":P=t.ExtremityPlacement.Both;break;case "begin":P=
t.ExtremityPlacement.JustBegin;break;case "end":P=t.ExtremityPlacement.JustEnd;break;default:P=t.ExtremityPlacement.None}const fa=S.fromSimpleMarker(wa,xa,ja).symbolLayers[0];fa.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:P,offsetAlongLine:0};L.push(fa)}L.push({type:"CIMSolidStroke",color:"none"!==va&&"esriSLSNull"!==va?Z(ja):[0,0,0,0],capStyle:ba(aa),joinStyle:M(oa),miterLimit:ta,width:xa,effects:V});return{type:"CIMLineSymbol",
symbolLayers:L}}static fromPictureMarker(V){const {angle:aa,height:ja,width:oa,xoffset:wa,yoffset:ta}=V;let va=V.url;"esriPMS"===V.type&&V.imageData&&(va=V.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:t.TextureFilter.Picture,tintColor:null,url:va,size:ja,width:oa,offsetX:l.getNumericValue(wa),offsetY:l.getNumericValue(ta),rotation:l.getNumericValue(-aa)}]}}static createCIMTextSymbolfromTextSymbol(V){const {angle:aa,
color:ja,font:oa,haloColor:wa,haloSize:ta,horizontalAlignment:va,kerning:xa,lineWidth:L,text:P,verticalAlignment:fa,xoffset:ka,yoffset:qa,backgroundColor:Q,borderLineColor:X,borderLineSize:Y}=V;let ia,na,O;if(oa){var da=oa.family;var la=oa.style;var pa=oa.weight;ia=oa.size;na=oa.decoration}V=!1;P&&(V=q.bidiText(P)[1]);if(Q||Y)O={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Z(Q)},{type:"CIMSolidStroke",color:Z(X),width:Y}]},
accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var za=t.BlockProgression.BTT,Aa=t.FontEffects.Normal,Ba=t.FontEncoding.Unicode;da=da||"Arial";b:{if(pa)switch(pa.toLowerCase()){case "bold":case "bolder":pa="bold";break b}pa=""}b:{if(la)switch(la.toLowerCase()){case "italic":case "oblique":la="italic";break b}la=""}pa=pa&&la?`${pa}-${la}`:`${pa}${la}`;return{type:"CIMTextSymbol",angle:aa,blockProgression:za,depth3D:1,extrapolateBaselines:!0,fontEffects:Aa,fontEncoding:Ba,fontFamilyName:da,
fontStyleName:pa,fontType:t.FontType.Unspecified,haloSize:ta,height:ia,hinting:t.GlyphHinting.Default,horizontalAlignment:U(va??"center"),kerning:xa,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:L,offsetX:l.getNumericValue(ka),offsetY:l.getNumericValue(qa),strikethrough:"line-through"===na,underline:"underline"===na,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Z(ja)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,
color:Z(wa)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:V?t.TextReadingDirection.RTL:t.TextReadingDirection.LTR,verticalAlignment:R(fa??"baseline"),verticalGlyphOrientation:t.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:t.BillBoardMode.FaceNearPlane,callout:O}}static createPictureMarkerRasterizationParam(V){const {angle:aa,height:ja,width:oa,xoffset:wa,yoffset:ta}=V;return(V=V.url??V.source?.url??V.source?.imageData)?{type:"sprite-rasterization-param",
overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:t.TextureFilter.Picture,tintColor:null,url:V,size:ja,width:oa,offsetX:l.getNumericValue(wa),offsetY:l.getNumericValue(ta),rotation:l.getNumericValue(-aa)}}:null}static createPictureFillRasterizationParam(V){const {width:aa,height:ja,xoffset:oa,yoffset:wa,url:ta}=V;return ta?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:t.TextureFilter.Picture,tintColor:null,
url:ta,width:aa,height:ja,offsetX:l.getNumericValue(oa),offsetY:l.getNumericValue(wa),rotation:0}}:null}static fromSimpleMarker(V,aa,ja){var {style:oa}=V;ja=V.color??ja;if("path"===oa||"esriSMSPath"===oa){aa=[];if("outline"in V&&V.outline){var wa=V.outline;aa.push({type:"CIMSolidStroke",enable:!0,width:wa.width,color:Z(wa.color),path:V.path})}aa.push({type:"CIMSolidFill",enable:!0,color:Z(ja),path:V.path});const [P,fa]=ma("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",
enable:!0,rotation:-l.getNumericValue(V.angle),size:l.getNumericValue(V.size||6),offsetX:l.getNumericValue(V.xoffset),offsetY:l.getNumericValue(V.yoffset),scaleSymbolsProportionally:!1,frame:P,markerGraphics:[{type:"CIMMarkerGraphic",geometry:fa,symbol:{type:"CIMPolygonSymbol",symbolLayers:aa}}]}]}}const ta=[];wa=V.size;let va;if("outline"in V&&V.outline&&"none"!==V.outline.style&&"esriSLSNull"!==V.outline.style){const P=V.outline,fa="solid"!==P.style&&"esriSLSSolid"!==P.style;[oa,va]=fa?ma(oa,V.size):
ma(oa);const ka=P.width??e.defaultPolylineSymbol2D.width;if(fa){var xa=ka/V.size,L=(oa.xmax-oa.xmin)*xa/2;xa=(oa.ymax-oa.ymin)*xa/2;oa.xmin-=L;oa.xmax+=L;oa.ymin-=xa;oa.ymax+=xa;wa&&(wa+=ka)}L="cross"!==V.style&&"x"!==V.style||"dot"===V?.outline.style||"short-dot"===V?.outline.style?t.LineDashEnding.HalfGap:t.LineDashEnding.FullPattern;L=fa?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:ea(P.style,null).map(qa=>P.width&&0<P.width?qa*P.width:qa),lineDashEnding:L,
controlPointEnding:t.LineDashEnding.FullPattern}]:void 0;ta.push({type:"CIMSolidStroke",capStyle:fa?t.LineCapStyle.Round:t.LineCapStyle.Butt,enable:!0,width:ka,color:Z(P.color),effects:L})}else!aa||"line-marker"!==V.type||"cross"!==V.style&&"x"!==V.style?[oa,va]=ma(oa):([oa,va]=ma(oa),ta.push({type:"CIMSolidStroke",enable:!0,width:aa,color:Z(ja)}));ta.push({type:"CIMSolidFill",enable:!0,color:Z(ja)});ja={type:"CIMPolygonSymbol",symbolLayers:ta};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",
enable:!0,rotation:l.getNumericValue(-V.angle),size:l.getNumericValue(wa||6*aa),offsetX:l.getNumericValue(V.xoffset),offsetY:l.getNumericValue(V.yoffset),scaleSymbolsProportionally:!1,frame:oa,markerGraphics:[{type:"CIMMarkerGraphic",geometry:va,symbol:ja}]}]}}static fromCIMHatchFill(V,aa){const ja=aa*(V.separation??w.defaultCIMValues.CIMHatchFill.separation),oa=ja/2;V=g.clone(V.lineSymbol);V.symbolLayers?.forEach(ta=>{switch(ta.type){case "CIMSolidStroke":null!=ta.width&&(ta.width*=aa);ta.effects?.forEach(va=>
{"CIMGeometricEffectDashes"===va.type&&(va.dashTemplate=va.dashTemplate?.map(xa=>xa*aa))});break;case "CIMVectorMarker":null!=ta.size&&(ta.size*=aa),ta=ta.markerPlacement,null!=ta&&"placementTemplate"in ta&&(ta.placementTemplate=ta.placementTemplate.map(va=>va*aa))}});for(var wa=this._getLineSymbolPeriod(V)||4;4>wa;)wa*=2;wa/=2;return{type:"CIMVectorMarker",frame:{xmin:-wa,xmax:wa,ymin:-oa,ymax:oa},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-wa,0],[wa,0]]]},symbol:V}],size:ja}}static fetchResources(V,
aa,ja,oa=null){if(!V||!aa)return ja;E(V,wa=>{K(wa,aa,ja);"url"in wa&&wa.url&&ja.push(aa.fetchResource(wa.url,{signal:oa}))});return ja}static fetchFonts(V,aa,ja){if(V&&aa)if("symbolLayers"in V&&V.symbolLayers)for(const ta of V.symbolLayers){if("CIMVectorMarker"===ta.type&&ta.markerGraphics)for(const va of ta.markerGraphics)va?.symbol&&S.fetchFonts(va.symbol,aa,ja)}else if("CIMTextSymbol"===V.type){const {fontFamilyName:ta,fontStyleName:va}=V;if(ta&&"calcitewebcoreicons"!==ta.toLowerCase()){var {style:oa,
weight:wa}=l.fromCIMFontStyle(va);V=l.fromCIMFontDecoration(V);V=new h({family:ta,style:oa,weight:wa,decoration:V});ja.push(aa.loadFont(V).catch(()=>{J().error(`Unsupported font ${ta} in CIM symbol`)}))}}}static _getLineSymbolPeriod(V){if(V){const aa=this._getEffectsRepeat(V.effects);if(aa)return aa;if(V.symbolLayers)for(const ja of V.symbolLayers)if(ja){if(V=this._getEffectsRepeat(ja.effects))return V;switch(ja.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(V=
this._getPlacementRepeat(ja.markerPlacement))return V}}}return 0}static _getEffectsRepeat(V){if(V)for(var aa of V)if(aa)switch(aa.type){case "CIMGeometricEffectDashes":if((V=aa.dashTemplate)&&V.length){aa=0;for(const ja of V)aa+=ja;V.length&1&&(aa*=2);return aa}break;case "CIMGeometricEffectWave":return aa.period;default:J().error(`unsupported geometric effect type ${aa.type}`)}return 0}static _getPlacementRepeat(V){if(V)switch(V.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((V=
V.placementTemplate)&&V.length){let aa=0;for(const ja of V)aa+=+ja;V.length&1&&(aa*=2);return aa}}return 0}static fromCIMInsidePolygon(V){var aa=V.markerPlacement;const ja={...V,markerPlacement:null,anchorPoint:null};V=Math.abs(aa.stepX);const oa=Math.abs(aa.stepY);var wa=(aa.randomness??100)/100;let ta,va;if("Random"===aa.gridType){var xa=b.px2pt(x.randomInsidePolygonTextureSize);const L=Math.max(Math.floor(xa/V),1),P=Math.max(Math.floor(xa/oa),1);xa=L*V/2;ta=P*oa/2;va=2*ta;aa=new m(aa.seed);const fa=
wa*V/1.5,ka=wa*oa/1.5;wa=[];for(let qa=0;qa<L;qa++)for(let Q=0;Q<P;Q++){const X=qa*V-xa+fa*(.5-aa.getFloat()),Y=Q*oa-ta+ka*(.5-aa.getFloat());wa.push({x:X,y:Y});0===qa&&wa.push({x:X+2*xa,y:Y});0===Q&&wa.push({x:X,y:Y+2*ta})}}else!0===aa.shiftOddRows?(xa=V/2,ta=oa,va=2*oa,wa=[{x:-xa,y:0},{x:xa,y:0},{x:0,y:ta},{x:0,y:-ta}]):(xa=V/2,ta=oa/2,va=oa,wa=[{x:-V,y:0},{x:0,y:-oa},{x:-V,y:-oa},{x:0,y:0},{x:V,y:0},{x:0,y:oa},{x:V,y:oa},{x:-V,y:oa},{x:V,y:-oa}]);V=wa.map(L=>({type:"CIMMarkerGraphic",geometry:L,
symbol:{type:"CIMPointSymbol",symbolLayers:[ja]}}));return{type:"CIMVectorMarker",frame:{xmin:-xa,xmax:xa,ymin:-ta,ymax:ta},markerGraphics:V,size:va}}}const ba=V=>{if(!V)return t.LineCapStyle.Butt;switch(V){case "butt":return t.LineCapStyle.Butt;case "square":return t.LineCapStyle.Square;case "round":return t.LineCapStyle.Round}},M=V=>{if(!V)return t.LineJoinStyle.Miter;switch(V){case "miter":return t.LineJoinStyle.Miter;case "round":return t.LineJoinStyle.Round;case "bevel":return t.LineJoinStyle.Bevel}},
U=V=>{if(null==V)return"Center";switch(V){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},R=V=>{if(null==V)return"Center";switch(V){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},Z=V=>{if(!V)return[0,0,0,0];const {r:aa,g:ja,b:oa,a:wa}=V;return[aa,ja,oa,255*wa]},ea=(V,aa)=>{const ja=r("safari")?.001:0;aa="butt"===aa;switch(V){case "dash":case "esriSLSDash":return aa?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return aa?
[4,3,1,3]:[3,4,ja,4];case "dot":case "esriSLSDot":return aa?[1,3]:[ja,4];case "long-dash":case "esriSLSLongDash":return aa?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return aa?[8,3,1,3]:[7,4,ja,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return aa?[8,3,1,3,1,3]:[7,4,ja,4,ja,4];case "short-dash":case "esriSLSShortDash":return aa?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return aa?[4,1,1,1]:[3,2,ja,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return aa?
[4,1,1,1,1,1]:[3,2,ja,2,ja,2];case "short-dot":case "esriSLSShortDot":return aa?[1,1]:[ja,2];case "solid":case "esriSLSSolid":case "none":return J().error("Unexpected: style does not require rasterization"),[0,0];default:return J().error(`Tried to rasterize SLS, but found an unexpected style: ${V}!`),[0,0]}},ma=(V,aa=100)=>{var ja=aa/2,oa;if("circle"===V||"esriSMSCircle"===V){var wa=Math.acos(1-.25/ja);aa=Math.ceil(D/wa/4);0===aa&&(aa=1);wa=G/aa;aa*=4;V=[];V.push([ja,0]);for(oa=1;oa<aa;oa++)V.push([ja*
Math.cos(oa*wa),-ja*Math.sin(oa*wa)]);V.push([ja,0]);wa={rings:[V]};oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja}}else"cross"===V||"esriSMSCross"===V?(wa={paths:[[[0,ja],[0,-ja]],[[ja,0],[-ja,0]]]},oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja}):"diamond"===V||"esriSMSDiamond"===V?(wa={rings:[[[-ja,0],[0,ja],[ja,0],[0,-ja],[-ja,0]]]},oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja}):"square"===V||"esriSMSSquare"===V?(wa={rings:[[[-ja,-ja],[-ja,ja],[ja,ja],[ja,-ja],[-ja,-ja]]]},oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja}):"x"===
V||"esriSMSX"===V?(wa={paths:[[[ja,ja],[-ja,-ja]],[[ja,-ja],[-ja,ja]]]},oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja}):"triangle"===V||"esriSMSTriangle"===V?(ja=.5773502691896257*aa,V=-ja,oa=2/3*aa,aa=oa-aa,wa={rings:[[[V,aa],[0,oa],[ja,aa],[V,aa]]]},oa={xmin:V,ymin:aa,xmax:ja,ymax:oa}):"arrow"===V&&(wa={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},oa={xmin:-ja,ymin:-ja,xmax:ja,ymax:ja});return[oa,wa]};a.CIMSymbolHelper=S;a.CIMSymbolInflatedSizeHelper=T;a.capTypeToEnum=ba;a.getEffectsInflateSize=
z;a.slsDashToTemplateArray=ea;a.symbolToCIM=function(V){let aa;switch(V.type){case "cim":return V.data;case "web-style":return V;case "simple-marker":V=S.fromSimpleMarker(V);if(!V)throw Error("InternalError: Cannot convert symbol to CIM");aa=V;break;case "picture-marker":aa=S.fromPictureMarker(V);break;case "simple-line":aa=S.fromSimpleLineSymbol(V);break;case "simple-fill":aa=S.fromSimpleFillSymbol(V);break;case "picture-fill":aa=S.fromPictureFillSymbol(V);break;case "text":aa=S.fromTextSymbol(V)}return{type:"CIMSymbolReference",
symbol:aa}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(a,q){const r=new q;a.bidiText=function(g){if(null==g)return["",!1];if(!r.hasBidiChar(g))return[g,!1];let p;p="rtl"===r.checkContextual(g)?"IDNNN":"ICNNN";return[r.bidiTransform(g,p,"VLYSN"),!0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/Font":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./support/textUtils".split(" "),
function(a,q,r,g,p,m,b,f,c){var h;q=h=class extends q.JSONSupport{constructor(n){super(n);this.decoration="none";this.family="sans-serif";this.size=9;this.weight=this.style="normal"}castSize(n){return r.toPt(n)}clone(){return new h({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};a.__decorate([g.property({type:c.fontDecorations,json:{default:"none",write:!0}})],
q.prototype,"decoration",void 0);a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"family",void 0);a.__decorate([g.property({type:Number,json:{write:{overridePolicy(n,d,w){return{enabled:!w||!w.textSymbol3D}}}}})],q.prototype,"size",void 0);a.__decorate([p.cast("size")],q.prototype,"castSize",null);a.__decorate([g.property({type:c.fontStyles,json:{default:"normal",write:!0}})],q.prototype,"style",void 0);a.__decorate([g.property({type:c.fontWeights,json:{default:"normal",write:!0}})],
q.prototype,"weight",void 0);return q=h=a.__decorate([f.subclass("esri.symbols.Font")],q)})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],function(a,q,r){const g={type:Number,cast:c=>{c=r.ensureNumber(c);return 0===c?1:q.clamp(c,.1,4)},nonNullable:!0},p=["left","right","center"],m=["baseline","top","middle","bottom"],b={type:p,nonNullable:!0},f={type:m,nonNullable:!0};a.backgroundPadding=8;a.fontDecorations=["none","underline",
"line-through"];a.fontStyles=["normal","italic","oblique"];a.fontWeights=["normal","lighter","bold","bolder"];a.horizontalAlignmentProperty=b;a.horizontalAlignments=p;a.lineHeightProperty=g;a.verticalAlignmentProperty=f;a.verticalAlignments=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A,k,v,B,z,E){function K(M,U,R){for(const ea of U){U=ea.length;for(let ma=1;ma<U;ma++){var Z=ea[ma-1];const V=ea[ma];let aa=(V[0]-Z[0])*(V[0]-Z[0])+(V[1]-Z[1])*(V[1]-Z[1]);if(0!==aa&&(aa=Math.sqrt(aa),Math.abs(((V[0]-Z[0])*(M[1]-Z[1])-(V[1]-Z[1])*(M[0]-Z[0]))/aa)<R&&(Z=((V[0]-Z[0])*(M[0]-Z[0])+(V[1]-Z[1])*(M[1]-Z[1]))/aa,Z>-R&&Z<aa+R)))return!0}}return!1}function I(M,U=1){const R=v.fromCIMFontDecoration(M);var Z=v.fromCIMFontStyle(M.fontStyleName);const ea=
M.fontFamilyName??q.defaultFontFamily,{weight:ma,style:V}=Z;Z=U*(M.height||5);const aa=v.fromCIMHorizontalAlignment(M.horizontalAlignment),ja=v.fromCIMVerticalAlignment(M.verticalAlignment),oa=v.getFillColor(M),wa=v.getFillColor(M.haloSymbol);U=null!=wa?U*(M.haloSize??0):0;var ta="CIMBackgroundCallout"===M.callout?.type?M.callout.backgroundSymbol:null;M=v.getFillColor(ta);const va=v.getStrokeWidth(ta);ta=v.getStrokeColor(ta);return{color:oa,size:Z,horizontalAlignment:aa,verticalAlignment:ja,font:{family:ea,
style:v.getFontStyle(V),weight:v.getFontWeight(ma),decoration:R},halo:{size:U||0,color:wa,style:V},backgroundColor:M,borderLine:null!=va&&null!=ta?{size:va,color:ta}:null,pixelRatio:1,premultiplyColors:!0}}const D=Math.PI/180;class G{constructor(M){this._t=M}static createIdentity(){return new G([1,0,0,0,1,0])}clone(){return new G(this._t.slice())}transform(M){const U=this._t;return[U[0]*M[0]+U[1]*M[1]+U[2],U[3]*M[0]+U[4]*M[1]+U[5]]}static createScale(M,U){return new G([M,0,0,0,U,0])}scale(M,U){const R=
this._t;R[0]*=M;R[1]*=M;R[2]*=M;R[3]*=U;R[4]*=U;R[5]*=U;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(M,U){return new G([0,0,M,0,0,U])}translate(M,U){const R=this._t;R[2]+=M;R[5]+=U;return this}static createRotate(M){const U=Math.cos(M);M=Math.sin(M);return new G([U,-M,0,M,U,0])}rotate(M){return G.multiply(this,G.createRotate(M),this)}angle(){const M=this._t[0],U=this._t[3],R=Math.sqrt(M*M+U*U);return[M/R,U/R]}static multiply(M,U,R){M=
M._t;U=U._t;const Z=M[1]*U[0]+M[4]*U[1],ea=M[2]*U[0]+M[5]*U[1]+U[2],ma=M[0]*U[3]+M[3]*U[4],V=M[1]*U[3]+M[4]*U[4],aa=M[2]*U[3]+M[5]*U[4]+U[5],ja=R._t;ja[0]=M[0]*U[0]+M[3]*U[1];ja[1]=Z;ja[2]=ea;ja[3]=ma;ja[4]=V;ja[5]=aa;return R}invert(){const M=this._t;let U=M[0]*M[4]-M[1]*M[3];if(0===U)return new G([0,0,0,0,0,0]);U=1/U;return new G([M[4]*U,-M[1]*U,(M[1]*M[5]-M[2]*M[4])*U,-M[3]*U,M[0]*U,(M[2]*M[3]-M[0]*M[5])*U])}}class C{constructor(M,U){this._resourceManager=M;this._transfos=[];this._sizeTransfos=
[];this._geomUnitsPerPoint=1;this._placementPool=new m(e.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(U||G.createIdentity());this._sizeTransfos.push(U?U.scaleRatio():1)}setTransform(M,U){this._transfos=[M||G.createIdentity()];this._sizeTransfos=[U||(M?M.scaleRatio():1)]}setGeomUnitsPerPoint(M){this._geomUnitsPerPoint=M}transformPt(M){return this._transfos[this._transfos.length-1].transform(M)}transformSize(M){return M*this._sizeTransfos[this._sizeTransfos.length-
1]}reverseTransformPt(M){return this._transfos[this._transfos.length-1].invert().transform(M)}reverseTransformSize(M){return M/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(M){return M/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<
this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(M,U){U=U?M.scaleRatio():1;G.multiply(M,this.back(),M);this._transfos.push(M);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*U)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(M,U,R){if(M)switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(M,U);break;case "CIMTextSymbol":this.drawTextSymbol(M,U,R)}}drawMultiLayerSymbol(M,
U){if(M&&U){var R=M.symbolLayers;if(R)if((M=M.effects)&&0<M.length){if(U=this.executeEffects(M,U))for(M=U.next();M;)this.drawSymbolLayers(R,M.asJSON()),M=U.next()}else this.drawSymbolLayers(R,U)}}executeEffects(M,U){const R=this._resourceManager.geometryEngine;U=new w.SimpleEffectCursor(f.GeometryCursor.fromJSONCIM(U));for(const Z of M)(M=l.getEffectOperator(Z))&&(U=M.execute(U,Z,this.geomUnitsPerPoint(),null,R));return U}drawSymbolLayers(M,U){let R=M.length;for(;R--;){const ea=M[R];if(ea&&!1!==ea.enable){var Z=
ea.effects;if(Z&&0<Z.length){if(Z=this.executeEffects(Z,U)){let ma=null;for(;(ma=Z.next())&&(this.drawSymbolLayer(ea,ma.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(ea,U);if(this._earlyReturn)break}}}drawSymbolLayer(M,U){switch(M.type){case "CIMSolidFill":this.drawSolidFill(U,M.color);break;case "CIMHatchFill":this.drawHatchFill(U,M);break;case "CIMPictureFill":this.drawPictureFill(U,M);break;case "CIMGradientFill":this.drawGradientFill(U,M);break;case "CIMSolidStroke":this.drawSolidStroke(U,
M.color,M.width,M.capStyle,M.joinStyle,M.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(U,M);break;case "CIMGradientStroke":this.drawGradientStroke(U,M);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(M,U)}}drawHatchFill(M,U){var R=this.geomUnitsPerPoint(),Z=v.getNumericValue(U.separation,u.defaultCIMValues.CIMHatchFill.separation)*R;var ea=v.getNumericValue(U.rotation);if(0===Z)ea=null;else{0>Z&&(Z=-Z);for(var ma=0,V=.5*Z;ma>V;)ma-=
Z;for(;ma<-V;)ma+=Z;var aa=c.create();h.getBoundsXY(aa,M);aa[0]-=V;aa[1]-=V;aa[2]+=V;aa[3]+=V;for(var ja=[[aa[0],aa[1]],[aa[0],aa[3]],[aa[2],aa[3]],[aa[2],aa[1]]];180<ea;)ea-=180;for(;0>ea;)ea+=180;aa=Math.cos(ea*D);var oa=Math.sin(ea*D);ea=-Z*oa;V=Z*aa;ma=v.getNumericValue(U.offsetX)*R;R*=v.getNumericValue(U.offsetY);ma=ma*oa-R*aa;var wa;var ta=R=Number.MAX_VALUE;var va=wa=-Number.MAX_VALUE;for(var xa of ja){var L=xa[0];const P=xa[1];ja=aa*L+oa*P;L=-oa*L+aa*P;ta=Math.min(ta,ja);R=Math.min(R,L);va=
Math.max(va,ja);wa=Math.max(wa,L)}R=Math.floor(R/Z)*Z;xa=aa*ta-oa*R-ea*ma/Z;ta=oa*ta+aa*R-V*ma/Z;ja=aa*va-oa*R-ea*ma/Z;aa=oa*va+aa*R-V*ma/Z;Z=1+Math.round((wa-R)/Z);ma=[];for(oa=0;oa<Z;oa++)xa+=ea,ta+=V,ja+=ea,aa+=V,ma.push([[xa,ta],[ja,aa]]);ea={paths:ma}}ea&&(this.pushClipPath(M),this.drawMultiLayerSymbol(U.lineSymbol,ea),this.popClipPath())}drawPictureFill(M,U){}drawGradientFill(M,U){}drawPictureStroke(M,U){}drawGradientStroke(M,U){}drawMarkerLayer(M,U){var R=M.markerPlacement;if(R){var Z=l.getPlacementOperator(R);
if(Z){var ea="CIMMarkerPlacementInsidePolygon"===R.type||"CIMMarkerPlacementPolygonCenter"===R.type&&R.clipAtBoundary;ea&&this.pushClipPath(U);if(U=Z.execute(f.GeometryCursor.fromJSONCIM(U),R,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(R=null;(R=U.next())&&(this.drawMarker(M,R),!this._earlyReturn););ea&&this.popClipPath()}}else{ea=this._placementPool.acquire();if(d.isPoint(U))ea.tx=U.x,ea.ty=U.y,this.drawMarker(M,ea);else if(d.isPolygon(U)){if(U=n.polygonCentroid(U))[ea.tx,
ea.ty]=U,this.drawMarker(M,ea)}else for(Z of U.points)if(ea.tx=Z[0],ea.ty=Z[1],this.drawMarker(M,ea),this._earlyReturn)break;this._placementPool.release(ea)}}drawMarker(M,U){switch(M.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(M,U);break;case "CIMVectorMarker":this.drawVectorMarker(M,U)}}drawPictureMarker(M,U){if(M){var R=this._resourceManager.getResource(M.url),Z=v.getNumericValue(M.size,u.defaultCIMValues.CIMPictureMarker.size);if(!(null==R||0>=Z)){var ea=R.width;
R=R.height;if(ea&&R){R=ea/R;var ma=v.getNumericValue(M.scaleX,1);ea=G.createIdentity();var V=M.anchorPoint;if(V){var aa=V.x;V=V.y;"Absolute"!==M.anchorPointUnits&&(aa*=Z*R*ma,V*=Z);ea.translate(-aa,-V)}R=v.getNumericValue(M.rotation);M.rotateClockwise&&(R=-R);this._mapRotation&&(R+=this._mapRotation);R&&ea.rotate(R*D);R=v.getNumericValue(M.offsetX);ma=v.getNumericValue(M.offsetY);if(R||ma){if(this._mapRotation){V=D*this._mapRotation;aa=Math.cos(V);V=Math.sin(V);const ja=R*V+ma*aa;R=R*aa-ma*V;ma=ja}ea.translate(R,
ma)}R=this.geomUnitsPerPoint();1!==R&&ea.scale(R,R);(R=U.getAngle())&&ea.rotate(R);ea.translate(U.tx,U.ty);this.push(ea,!1);this.drawImage(M,Z);this.pop()}}}}drawVectorMarker(M,U){if(M){var R=M.markerGraphics;if(R){var Z=v.getNumericValue(M.size,u.defaultCIMValues.CIMVectorMarker.size),ea=M.frame,ma=ea?ea.ymax-ea.ymin:0;ma=Z&&ma?Z/ma:1;Z=G.createIdentity();ea&&Z.translate(.5*-(ea.xmax+ea.xmin),.5*-(ea.ymax+ea.ymin));var V=M.anchorPoint;if(V){var aa=V.x;V=V.y;"Absolute"!==M.anchorPointUnits?ea&&(aa*=
ea.xmax-ea.xmin,V*=ea.ymax-ea.ymin):(aa/=ma,V/=ma);Z.translate(-aa,-V)}1!==ma&&Z.scale(ma,ma);ea=v.getNumericValue(M.rotation);M.rotateClockwise&&(ea=-ea);this._mapRotation&&(ea+=this._mapRotation);ea&&Z.rotate(ea*D);ea=v.getNumericValue(M.offsetX);ma=v.getNumericValue(M.offsetY);if(ea||ma){if(this._mapRotation){V=D*this._mapRotation;aa=Math.cos(V);V=Math.sin(V);const ja=ea*V+ma*aa;ea=ea*aa-ma*V;ma=ja}Z.translate(ea,ma)}ea=this.geomUnitsPerPoint();1!==ea&&Z.scale(ea,ea);(ea=U.getAngle())&&Z.rotate(ea);
Z.translate(U.tx,U.ty);this.push(Z,M.scaleSymbolsProportionally);for(const ja of R)if(ja?.symbol&&ja.geometry||p.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",ja),M=ja.textString,"number"===typeof M&&(M=M.toString()),this.drawSymbol(ja.symbol,ja.geometry,M),this._earlyReturn)break;this.pop()}}}drawTextSymbol(M,U,R){if(M&&d.isPoint(U)&&!(0>=v.getNumericValue(M.height,u.defaultCIMValues.CIMTextSymbol.height))){var Z=G.createIdentity(),ea=v.getNumericValue(M.angle);
(ea=-ea)&&Z.rotate(ea*D);ea=v.getNumericValue(M.offsetX);var ma=v.getNumericValue(M.offsetY);(ea||ma)&&Z.translate(ea,ma);ea=this.geomUnitsPerPoint();1!==ea&&Z.scale(ea,ea);Z.translate(U.x,U.y);this.push(Z,!1);this.drawText(M,R);this.pop()}}}class F extends C{constructor(M,U){super(M,U);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return c.fromValues(this._xmin,
this._ymin,this._xmax,this._ymax)}drawSolidFill(M){!M||0<this._clipCount||(d.isPolygon(M)?this._processPath(M.rings,0):d.isPolyline(M)?this._processPath(M.paths,0):d.isExtent(M)?(M=S(M))&&this._processPath(M.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(M,U,R){!M||0<this._clipCount||null==R||0>=R||(U=Math.max(.5*this.transformSize(v.getNumericValue(R,u.defaultCIMValues.CIMSolidStroke.width)),.25),d.isPolygon(M)?this._processPath(M.rings,U):d.isPolyline(M)?this._processPath(M.paths,
U):d.isExtent(M)?(M=S(M))&&this._processPath(M.rings,U):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(M,U){d.isPolygon(U)&&M.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===M.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===M.markerPlacement.type&&M.markerPlacement.clipAtBoundary)?this._processPath(U.rings,0):super.drawMarkerLayer(M,U)}drawHatchFill(M,U){this.drawSolidFill(M)}drawPictureFill(M,U){this.drawSolidFill(M)}drawGradientFill(M,U){this.drawSolidFill(M)}drawPictureStroke(M,
U){this.drawSolidStroke(M,null,U.width)}drawGradientStroke(M,U){this.drawSolidStroke(M,null,U.width)}pushClipPath(M){this.drawSolidFill(M);this._clipCount++}popClipPath(){this._clipCount--}drawImage(M,U){var {url:R}=M;M=v.getNumericValue(M.scaleX,1);let Z=M*U;var ea=U;R=this._resourceManager.getResource(R);null!=R&&(ea=R.height/R.width,Z=M*(U?1<ea?U:U/ea:R.width),ea=U?1<ea?U*ea:U:R.height);this._merge(this.transformPt([-Z/2,-ea/2]),0);this._merge(this.transformPt([-Z/2,ea/2]),0);this._merge(this.transformPt([Z/
2,-ea/2]),0);this._merge(this.transformPt([Z/2,ea/2]),0)}drawText(M,U){if(U&&0!==U.length){this._textRasterizer||(this._textRasterizer=new k);var R=I(M),[Z,ea]=this._textRasterizer.computeTextSize(U,R);Z=b.px2pt(Z);ea=b.px2pt(ea);U=0;switch(M.horizontalAlignment){case "Left":U=Z/2;break;case "Right":U=-Z/2}R=0;switch(M.verticalAlignment){case "Bottom":R=ea/2;break;case "Top":R=-ea/2;break;case "Baseline":R=ea/6}this._merge(this.transformPt([-Z/2+U,-ea/2+R]),0);this._merge(this.transformPt([-Z/2+U,
ea/2+R]),0);this._merge(this.transformPt([Z/2+U,-ea/2+R]),0);this._merge(this.transformPt([Z/2+U,ea/2+R]),0)}}_processPath(M,U){if(M)for(const R of M)if(M=R?R.length:0,1<M){this._merge(this.transformPt(R[0]),U);for(let Z=1;Z<M;Z++)this._merge(this.transformPt(R[Z]),U)}}_merge(M,U){M[0]-U<this._xmin&&(this._xmin=M[0]-U);M[0]+U>this._xmax&&(this._xmax=M[0]+U);M[1]-U<this._ymin&&(this._ymin=M[1]-U);M[1]+U>this._ymax&&(this._ymax=M[1]+U)}}class J extends C{constructor(){super(...arguments);this._searchPoint=
[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(M,U,R,Z,ea,ma){ma*=b.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(ma);this._searchPoint=[(M[0]+M[2])/2,(M[1]+M[3])/2];this._searchDistPoint=(M[2]-M[0])/2/ma;this._textInfo=Z;this._mapRotation=U&&("CIMPointSymbol"===U.type&&"Map"!==U.angleAlignment||"CIMTextSymbol"===U.type)?ea:0;r("esri-mobile")||(M=b.px2pt(B.hittestToleranceSmallSymbol*window.devicePixelRatio),Z=b.px2pt(B.hittestSmallSymbolThreshold),("CIMLineSymbol"!==U?.type&&
"CIMPolygonSymbol"!==U?.type||!U.symbolLayers?.some(v.isCIMFill))&&"CIMMeshSymbol"!==U?.type&&(v.getSize(U)??0)<Z&&(this._searchDistPoint=M));this._earlyReturn=!1;this.drawSymbol(U,R);return this._earlyReturn}drawSolidFill(M,U){this._hitTestFill(M)}drawHatchFill(M,U){this._hitTestFill(M)}drawPictureFill(M,U){this._hitTestFill(M)}drawGradientFill(M,U){this._hitTestFill(M)}drawSolidStroke(M,U,R,Z,ea,ma){this._hitTestStroke(M,R)}drawPictureStroke(M,U){this._hitTestStroke(M,U.width)}drawGradientStroke(M,
U){this._hitTestStroke(M,U.width)}drawMarkerLayer(M,U){M.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===M.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===M.markerPlacement.type&&M.markerPlacement.clipAtBoundary)?this._hitTestFill(U):super.drawMarkerLayer(M,U)}pushClipPath(M){}popClipPath(){}drawImage(M,U){var {url:R}=M;M=v.getNumericValue(M.scaleX,1);R=this._resourceManager.getResource(R);if(null!=R&&0!==R.height&&0!==U){U*=this.geomUnitsPerPoint();M=R.width/R.height*M*U;R=this.reverseTransformPt(this._searchPoint);
var Z=this._searchDistPoint;Math.abs(R[0])<M/2+Z&&Math.abs(R[1])<U/2+Z&&(this._earlyReturn=!0)}}drawText(M,U){if((U=this._textInfo)&&(U=U.get(M))&&U.glyphMosaicItems.glyphs.length){var R=E.roundPtToWholePixel(v.getNumericValue(M.height,u.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:Z,lineGap:ea}=M,ma=Z?ba(Z,v.getNumericValue(ea),R):0,V="CIMBackgroundCallout"===M.callout?.type;M=z.shapeGlyphs(U.glyphMosaicItems,{scale:R/B.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:M.horizontalAlignment,
verticalAlignment:M.verticalAlignment,maxLineWidth:E.getLineWidth(M.lineWidth),lineHeight:B.magicLabelLineHeight*Math.max(.25,Math.min(ma||1,4)),decoration:M.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:V});R=this.reverseTransformPt(this._searchPoint);U=R[0];R=R[1];for(const aa of M.glyphs)if(U>aa.xTopLeft&&U<aa.xBottomRight&&R>-aa.yBottomRight&&R<-aa.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(M){let U=null;if(d.isExtent(M))U=[[[M.xmin,M.ymin],[M.xmin,M.ymax],[M.xmax,M.ymax],
[M.xmax,M.ymin],[M.xmin,M.ymin]]];else if(d.isPolygon(M))U=M.rings;else if(d.isPolyline(M))U=M.paths;else return;M=this.reverseTransformPt(this._searchPoint);let R=0;for(var Z of U){const ea=Z.length;for(let ma=1;ma<ea;ma++){const V=Z[ma-1],aa=Z[ma];V[1]>M[1]!==aa[1]>M[1]&&(0<(aa[0]-V[0])*(M[1]-V[1])-(aa[1]-V[1])*(M[0]-V[0])?R++:R--)}}0!==R&&(this._earlyReturn=!0);this._earlyReturn||(Z=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),K(M,U,Z)&&(this._earlyReturn=!0))}_hitTestStroke(M,
U){let R=null;if(d.isExtent(M))R=[[[M.xmin,M.ymin],[M.xmin,M.ymax],[M.xmax,M.ymax],[M.xmax,M.ymin],[M.xmin,M.ymin]]];else if(d.isPolygon(M))R=M.rings;else if(d.isPolyline(M))R=M.paths;else return;M=this.reverseTransformPt(this._searchPoint);U=v.getNumericValue(U,u.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const Z=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();K(M,R,U/2+Z)&&(this._earlyReturn=!0)}}class T extends C{constructor(M,U,R,Z){super(U,
R);this._applyAdditionalRenderProps=Z;this._colorSubstitutionHelper=new t;this._ctx=M}drawSolidFill(M,U){if(M){if(d.isPolygon(M))this._buildPath(M.rings,!0);else if(d.isPolyline(M))this._buildPath(M.paths,!0);else if(d.isExtent(M))this._buildPath(S(M).rings,!0);else if(d.isMultipoint(M))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;M=this._ctx;M.fillStyle="string"===typeof U?U:"rgba("+Math.round(U[0])+","+Math.round(U[1])+","+Math.round(U[2])+","+(U[3]??255)/255+")";
M.fill("evenodd")}}drawSolidStroke(M,U,R,Z,ea,ma){if(M&&U&&0!==R){if(d.isPolygon(M))this._buildPath(M.rings,!0);else if(d.isPolyline(M))this._buildPath(M.paths,!1);else if(d.isExtent(M))this._buildPath(S(M).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}M=this._ctx;M.strokeStyle="string"===typeof U?U:"rgba("+Math.round(U[0])+","+Math.round(U[1])+","+Math.round(U[2])+","+(U[3]??255)/255+")";M.lineWidth=Math.max(this.transformSize(R),.5);this._setCapStyle(Z);
this._setJoinStyle(ea);M.miterLimit=ma;M.stroke()}}pushClipPath(M){this._ctx.save();if(d.isPolygon(M))this._buildPath(M.rings,!0);else if(d.isPolyline(M))this._buildPath(M.paths,!0);else if(d.isExtent(M))this._buildPath(S(M).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(M,U){const {colorSubstitutions:R,url:Z,tintColor:ea}=M;M=v.getNumericValue(M.scaleX,1);var ma=this._resourceManager.getResource(Z);if(null!=ma){var V=ma.width/ma.height*U,aa=U;U||(V=ma.width,
aa=ma.height);var ja=v.isSVGImage(Z)||"src"in ma&&v.isSVGImage(ma.src);U="getFrame"in ma?y.getFirstFrame(ma):ma;R&&(U=this._colorSubstitutionHelper.applyColorSubstituition(U,R));this._applyAdditionalRenderProps&&!ja&&ea&&(U=this._colorSubstitutionHelper.tintImageData(U,ea));ma=this.transformPt([0,0]);var [oa,wa]=this.getTransformAngle();ja=this.transformSize(1);var ta=this._ctx;ta.save();ta.setTransform({m11:M*ja*oa,m12:M*ja*wa,m21:-ja*wa,m22:ja*oa,m41:ma[0],m42:ma[1]});ta.drawImage(U,-V/2,-aa/2,
V,aa);ta.restore()}}drawText(M,U){if(U&&0!==U.length&&(this._textRasterizer||(this._textRasterizer=new k),M=I(M),M.size*=this.transformSize(b.px2pt(1)),U=this._textRasterizer.rasterizeText(U,M))){var {size:R,anchorX:Z,anchorY:ea,canvas:ma}=U;U=R[0]*(Z+.5);M=R[1]*(ea-.5);var V=this._ctx,aa=this.transformPt([0,0]),[ja,oa]=this.getTransformAngle();V.save();V.setTransform({m11:1*ja,m12:1*oa,m21:-1*oa,m22:1*ja,m41:aa[0]-1*U,m42:aa[1]+1*M});V.drawImage(ma,0,0);V.restore()}}drawPictureFill(M,U){if(M){var {colorSubstitutions:R,
height:Z,offsetX:ea,offsetY:ma,rotation:V,scaleX:aa,tintColor:ja,url:oa}=U;U=this._resourceManager.getResource(oa);if(null!=U){if(d.isPolygon(M))this._buildPath(M.rings,!0);else if(d.isPolyline(M))this._buildPath(M.paths,!0);else if(d.isExtent(M))this._buildPath(S(M).rings,!0);else if(d.isMultipoint(M))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;M=this._ctx;var wa=v.isSVGImage(oa)||"src"in U&&v.isSVGImage(U.src),ta="getFrame"in U?y.getFirstFrame(U):U;R&&(ta=this._colorSubstitutionHelper.applyColorSubstituition(ta,
R));if(this._applyAdditionalRenderProps){if(wa||ja&&(ta=this._colorSubstitutionHelper.tintImageData(ta,ja)),wa=M.createPattern(ta,"repeat"),ta=this.transformSize(1),V||=0,ea=ea?ta*ea:0,ma=ma?ta*ma:0,Z&&=ta*Z,ta=Z?Z/U.height:1,U=aa&&Z?aa*Z/U.width:1,0!==V||1!==ta||1!==U||0!==ea||0!==ma){const va=new DOMMatrix;va.rotateSelf(0,0,-V).translateSelf(ea,ma).scaleSelf(U,ta,1);wa.setTransform(va)}}else wa=M.createPattern(ta,"repeat");M.save();M.fillStyle=wa;M.fill("evenodd");M.restore()}}}drawPictureStroke(M,
U){if(M){var {colorSubstitutions:R,capStyle:Z,joinStyle:ea,miterLimit:ma,tintColor:V,url:aa,width:ja}=U;U=this._resourceManager.getResource(aa);if(null!=U){if(d.isPolygon(M))var oa=M.rings;else if(d.isPolyline(M))oa=M.paths;else if(d.isExtent(M))oa=S(M).rings;else{d.isMultipoint(M)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}ja||(ja=U.width);M=v.isSVGImage(aa)||"src"in U&&v.isSVGImage(U.src);var wa="getFrame"in U?y.getFirstFrame(U):U;R&&(wa=this._colorSubstitutionHelper.applyColorSubstituition(wa,
R));this._applyAdditionalRenderProps&&(M||V&&(wa=this._colorSubstitutionHelper.tintImageData(wa,V)));U=Math.max(this.transformSize(b.pt2px(ja)),.5);M=U/wa.width;var ta=this._ctx;wa=ta.createPattern(wa,"repeat-y");ta.save();this._setCapStyle(Z);this._setJoinStyle(ea);void 0!==ma&&(ta.miterLimit=ma);ta.lineWidth=U;var va;for(let ka of oa){ka=g.clone(ka);var xa=va=void 0,L=void 0;let qa=xa=void 0;oa=ka;for(var P=oa[0],fa=1;fa<oa.length;)qa=oa[fa][0]-P[0],xa=oa[fa][1]-P[1],xa=0!==qa?xa/qa:Math.PI/2,void 0!==
L&&1E-4>=xa-L?(oa.splice(fa-1,1),P=va):(va=P,P=oa[fa],fa++),L=xa;if(ka&&!(1>=ka.length))for(oa=this.transformPt(ka[0]),L=1;L<ka.length;L++)va=this.transformPt(ka[L]),P=180/Math.PI*Math.atan2(va[1]-oa[1],va[0]-oa[0]),fa=new DOMMatrix,fa.translateSelf(0,oa[1]-U/2).scaleSelf(M,M,1).rotateSelf(0,0,90-P),wa.setTransform(fa),ta.strokeStyle=wa,ta.beginPath(),ta.moveTo(oa[0],oa[1]),ta.lineTo(va[0],va[1]),ta.stroke(),oa=va}ta.restore()}}}_buildPath(M,U){const R=this._ctx;R.beginPath();if(M)for(const Z of M)if(M=
Z?Z.length:0,1<M){let ea=this.transformPt(Z[0]);R.moveTo(ea[0],ea[1]);for(let ma=1;ma<M;ma++)ea=this.transformPt(Z[ma]),R.lineTo(ea[0],ea[1]);U&&R.closePath()}}_setCapStyle(M){switch(M){case x.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case x.LineCapStyle.Round:this._ctx.lineCap="round";break;case x.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(M){switch(M){case x.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case x.LineJoinStyle.Round:this._ctx.lineJoin="round";break;
case x.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const S=M=>M?{spatialReference:M.spatialReference,rings:[[[M.xmin,M.ymin],[M.xmin,M.ymax],[M.xmax,M.ymax],[M.xmax,M.ymin],[M.xmin,M.ymin]]]}:null,ba=(M,U,R)=>{switch(M){case "ExtraLeading":return 1+U/R;case "Multiple":return U;case "Exact":return U/R}};a.CIMSymbolDrawHelper=C;a.CanvasDrawHelper=T;a.EnvDrawHelper=F;a.HittestDrawHelper=J;a.Transformation=G;a.cDegToRad=D;a.lineGapType2LineHeight=ba;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/fontUtils":function(){define(["exports","../config"],function(a,q){function r(n){if(!n)return"arial-unicode-ms";n=n.toLowerCase().split(" ").join("-");switch(n){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return n}}function g(n){const d=m(n)+b(n);return r(n.family)+(0<d.length?d:"-regular")}function p(n){const d=m(n)+b(n);return(n.family||"arial-unicode-ms")+
(0<d.length?d:"-regular")}function m(n){if(!n.weight)return"";switch(n.weight.toLowerCase()){case "bold":case "bolder":return"-bold"}return""}function b(n){if(!n.style)return"";switch(n.style.toLowerCase()){case "italic":case "oblique":return"-italic"}return""}const f=new Map,c=new Set;class h{constructor(n,d){this.fontFace=n;this.promise=d}}a.clearFonts=function(){const n=document.fonts;f.forEach(d=>{n.delete(d.fontFace)});f.clear();c.clear()};a.defaultFontFamily="arial-unicode-ms";a.getFontFamily=
r;a.getFullyQualifiedFontName=g;a.isCachedFontFace=function(n){return c.has(n)};a.loadFont=async function(n){const d=p(n),w=g(n),t=f.get(d);if(t)return t.promise;const l=new FontFace(n.family,`url('${q.fontsUrl}/woff2/${w}.${"woff2"}') format('${"woff2"}')`,{style:n.style,weight:n.weight}),e=document.fonts;if(e.has(l)&&"loading"===l.status)return l.loaded;n=l.load().then(()=>{e.add(l);return l});f.set(d,new h(l,n));c.add(l);return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class a{applyColorSubstituition(q,r){if(!r)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:g,height:p}=q,m=this._rasterizationCanvas,b=m.getContext("2d",{willReadFrequently:!0});q!==m&&(m.width=g,m.height=p,b.drawImage(q,0,0,g,p));q=b.getImageData(0,0,g,p).data;if(r)for(var f of r)if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){const [c,
h,n,d]=f.oldColor,[w,t,l,e]=f.newColor;if(c!==w||h!==t||n!==l||d!==e)for(r=0;r<q.length;r+=4)c===q[r]&&h===q[r+1]&&n===q[r+2]&&d===q[r+3]&&(q[r]=w,q[r+1]=t,q[r+2]=l,q[r+3]=e)}f=new ImageData(q,g,p);b.putImageData(f,0,0);return m}tintImageData(q,r){if(!r||4>r.length)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:g,height:p}=q,m=this._rasterizationCanvas,b=m.getContext("2d",{willReadFrequently:!0});q!==m&&(m.width=g,m.height=p,b.drawImage(q,
0,0,g,p));q=b.getImageData(0,0,g,p);q=new Uint8Array(q.data);r=[r[0]/255,r[1]/255,r[2]/255,r[3]/255];for(let f=0;f<q.length;f+=4)q[f]*=r[0],q[f+1]*=r[1],q[f+2]*=r[2],q[f+3]*=r[3];r=new ImageData(new Uint8ClampedArray(q.buffer),g,p);b.putImageData(r,0,0);return m}}return a})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(a){a.getFirstFrame=function(q){const r=q.getFrame(0);if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement)return r;const g=document.createElement("canvas");
g.width=q.width;g.height=q.height;q=g.getContext("2d");r instanceof ImageData?q.putImageData(r,0,0):q.drawImage(r,0,0);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class a{constructor(q=0,r=0,g=0,p=0){this.x=q;this.y=r;this.width=g;this.height=p}static fromExtent(q){return new a(q.xmin,-q.ymax,q.xmax-q.xmin,q.ymax-q.ymin)}get isEmpty(){return 0>=this.width||0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=
Math.min(this.y,q.y);this.width=Math.max(this.width,q.width);this.height=Math.max(this.height,q.height)}}return a})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(a,q){function r(m){return`rgba(${m.slice(0,3).toString()},${m[3]})`}function g(m,b){var f=b.font;f=`${f.style} ${f.weight} ${a.pt2px(Math.max(b.size,.5)*b.pixelRatio).toFixed(1)}px ${f.family}, sans-serif`;m.font=f;m.textBaseline="top";switch(b.horizontalAlignment){case "left":b=
"left";break;case "right":b="right";break;case "center":b="center";break;default:b="left"}m.textAlign=b}class p{constructor(m){m&&(this._textRasterizationCanvas=m)}rasterizeText(m,b){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const f=this._textRasterizationCanvas;var c=f.getContext("2d",{willReadFrequently:!0});g(c,b);this._parameters=b;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:h,weight:n}=b.font;
this._lineThroughWidthOffset=h&&"line-through"===h?.1*this._lineHeight:0;var d=(m=null!=b.backgroundColor||null!=b.borderLine)?q.backgroundPadding:0,w=this._computeTextWidth(c,b)+2*d,t=this._lineHeight*this._textLines.length+2*d;f.width=w+2*this._lineThroughWidthOffset;f.height=t;if(0===f.width||0===f.height)return f.width=f.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:f};this._renderedLineHeight=Math.round(this._lineHeight*b.pixelRatio);this._renderedHaloSize=
a.pt2px(b.halo.size)*b.pixelRatio;this._renderedWidth=w*b.pixelRatio;this._renderedHeight=t*b.pixelRatio;this._lineThroughWidthOffset*=b.pixelRatio;w=b.halo&&b.halo.color?b.halo.color:[0,0,0,0];this._fillStyle=r(b.color??[0,0,0,0]);this._haloStyle=`rgb(${w.slice(0,3).toString()})`;w=this._renderedLineHeight;var l=this._renderedHaloSize;c.save();c.clearRect(0,0,f.width,f.height);g(c,b);t=d*b.pixelRatio;d=c.textAlign;var e=this._renderedWidth-2*t;d=("center"===d?.5*e:"right"===d?e:0)+l+t;t=l+t;l=0<
l;e=this._lineThroughWidthOffset;let u=0;if(m){c.save();m=b.backgroundColor??[0,0,0,0];const y=b.borderLine?.color??[0,0,0,0],A=2*a.pt2px(b.borderLine?.size??0);c.fillStyle=r(m);c.strokeStyle=r(y);c.lineWidth=A;c.fillRect(0,0,f.width,f.height);c.strokeRect(0,0,f.width,f.height);c.restore()}l&&this._renderHalo(c,d,t,e,u,b);u+=t;e+=d;for(var x of this._textLines)l&&(c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(x,e,u),c.globalCompositeOperation="source-over"),c.fillStyle=
this._fillStyle,c.fillText(x,e,u),h&&"none"!==h&&this._renderDecoration(c,e,u,h,n),u+=w;c.restore();x=this._renderedWidth+2*this._lineThroughWidthOffset;m=this._renderedHeight;c=c.getImageData(0,0,x,m);c=new Uint8Array(c.data);if(b.premultiplyColors)for(d=0;d<c.length;d+=4)w=c[d+3]/255,c[d]*=w,c[d+1]*=w,c[d+2]*=w;switch(b.horizontalAlignment){case "left":w=-.5;break;case "right":w=.5;break;default:w=0}switch(b.verticalAlignment){case "bottom":b=-.5;break;case "top":b=.5;break;case "baseline":b=-1/
6;break;default:b=0}return{size:[x,m],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:w,anchorY:b,canvas:f}}_renderHalo(m,b,f,c,h,n){const d=this._renderedWidth,w=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=d;this._haloRasterizationCanvas.height=w;const t=this._haloRasterizationCanvas,l=t.getContext("2d");l.clearRect(0,0,d,w);g(l,n);const {decoration:e,weight:u}=n.font;l.fillStyle=
this._haloStyle;l.strokeStyle=this._haloStyle;l.lineJoin="round";this._renderHaloNative(l,b,f,e,u);m.globalAlpha=this._parameters.halo.color[3];m.drawImage(t,0,0,d,w,c,h,d,w);m.globalAlpha=1}_renderHaloNative(m,b,f,c,h){const n=this._renderedLineHeight,d=this._renderedHaloSize;for(const w of this._textLines){const t=2*d;for(let l=0;5>l;l++){const e=(.6+.1*l)*t;m.lineWidth=e;m.strokeText(w,b,f);c&&"none"!==c&&this._renderDecoration(m,b,f,c,h,e)}f+=n}}computeTextSize(m,b){this._textRasterizationCanvas||
(this._textRasterizationCanvas=document.createElement("canvas"));const f=this._textRasterizationCanvas;var c=f.getContext("2d");g(c,b);this._parameters=b;this._textLines=m.split(/\r?\n/);this._lineHeight=this._computeLineHeight();m=this._computeTextWidth(c,b);c=this._lineHeight*this._textLines.length;f.width=m;f.height=c;return[m*b.pixelRatio,c*b.pixelRatio]}_computeTextWidth(m,b){let f=0;for(const c of this._textLines)f=Math.max(f,m.measureText(c).width);b=b.font;if("italic"===b.style||"oblique"===
b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)f+=.3*m.measureText("w").width;f+=2*a.pt2px(this._parameters.halo.size);return Math.round(f)}_computeLineHeight(){let m=1.275*this._parameters.size;const b=this._parameters.font.decoration;b&&"underline"===b&&(m*=1.3);return Math.round(m+2*a.pt2px(this._parameters.halo.size))}_renderDecoration(m,b,f,c,h,n){const d=.9*this._lineHeight;switch(m.textAlign){case "center":b-=this._renderedWidth/
2;break;case "right":b-=this._renderedWidth}const w=m.textBaseline;if("underline"===c)switch(w){case "top":f+=d;break;case "middle":f+=d/2}else if("line-through"===c)switch(w){case "top":f+=d/1.5;break;case "middle":f+=d/3}c=n?1.5*n:Math.ceil(d*("bold"===h?.06:"bolder"===h?.09:.04));m.save();m.beginPath();m.strokeStyle=m.fillStyle;m.lineWidth=c;m.moveTo(b-this._lineThroughWidthOffset,f);m.lineTo(b+this._renderedWidth+2*this._lineThroughWidthOffset,f);m.stroke();m.restore()}}return p})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),
function(a,q,r,g,p,m,b,f){function c(t,l){t.forEach(e=>g.transformMat2d(e,e,l));return{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}const h=Math.PI/180;class n{constructor(t,l,e,u){this._rotationT=r.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const x=e.rect,y=new Float32Array(8);t*=u;l*=u;const A=e.code?x.width*u:e.metrics.width,k=e.code?x.height*u:e.metrics.height;this.width=A;this.height=k;y[0]=t;y[1]=l;y[2]=t+A;y[3]=l;y[4]=t;y[5]=l+k;y[6]=
t+A;y[7]=l+k;this._data=y;this._setTextureCoords(x);this._scale=u;this._mosaic=e;this.x=t;this.y=l;this.maxOffset=Math.max(t+A,l+k)}get mosaic(){return this._mosaic}set angle(t){this._angle=t;q.fromRotation(this._rotationT,-t);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:x,width:y}=this._mosaic.metrics;var t=y*this._scale,l=Math.abs(x)*this._scale,e=new Float32Array(8);e[0]=this.x;e[1]=this.y;e[2]=this.x+t;e[3]=this.y;e[4]=this.x;e[5]=this.y+l;e[6]=this.x+t;e[7]=this.y+l;t=q.multiply(r.create(),this._rotationT,this._transform);r.transformMany(e,e,t);l=t=Infinity;let A=0;var u=0;for(let k=
0;4>k;k++){const v=e[2*k],B=e[2*k+1];t=Math.min(t,v);l=Math.min(l,B);A=Math.max(A,v);u=Math.max(u,B)}e=A-t;u-=l;this._bounds=new f(t+e/2,l+u/2,e,u)}return this._bounds}setTransform(t){this._transform=t;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=q.multiply(r.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];
this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=this._data[7];g.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,t);g.transformMat2d(this._offsets.topRight,this._offsets.topRight,t);g.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,t);g.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,
y:l,width:e,height:u}){this._texcoords={topLeft:[t,l],topRight:[t+e,l],bottomLeft:[t,l+u],bottomRight:[t+e,l+u]}}}class d{constructor(t,l,e){this._rotation=0;this._decorate(t,l,e);this.glyphs=t;this.bounds=this._createBounds(t);this.isMultiline=1<l.length;this._hasRotation=0!==e.angle;this._transform=this._createGlyphTransform(this.bounds,e);if((this._borderLineSizePx=e.borderLineSizePx)||e.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const u of t)u.setTransform(this._transform)}setRotation(t){if(0!==
t||0!==this._rotation){this._rotation=t;var l=this._transform;t=q.fromRotation(r.create(),t);q.multiply(l,t,l);for(const e of this.glyphs)e.setTransform(this._transform)}}_decorate(t,l,e){if(e.decoration&&"none"!==e.decoration&&t.length){var u=e.scale;e="underline"===e.decoration?26:16;var x=t[0].textureBinding;for(const v of l){const B=v.startX*u,z=v.startY*u;l=t;var y=l.push;var A=(v.width+v.glyphWidthEnd)*u;var k=x;A={code:0,page:0,sdf:!0,rect:new b(0,0,11,8),textureBinding:k,metrics:{advance:0,
height:4,width:A,left:0,top:0}};y.call(l,new n(B,z+e*u,A,1))}}}shapeBackground(t){const l=(1.5+(this._borderLineSizePx||0))/2;var e=this._borderLineSizePx?l:0;const {xmin:u,ymin:x,xmax:y,ymax:A,x:k,y:v,width:B,height:z}=this.bounds,E=[u-8,x-8],K=[y+8,x-8],I=[u-8,A+8],D=[y+8,A+8],G=c([[E[0]-l,E[1]-l],[K[0]+l,K[1]-l],[E[0]+e,E[1]+e],[K[0]-e,K[1]+e]],t),C=c([[I[0]+e,I[1]-e],[D[0]-e,D[1]-e],[I[0]-l,I[1]+l],[D[0]+l,D[1]+l]],t),F=c([[E[0]-l,E[1]-l],[E[0]+e,E[1]+e],[I[0]-l,I[1]+l],[I[0]+e,I[1]-e]],t);e=
c([[K[0]-e,K[1]+e],[K[0]+l,K[1]-l],[D[0]-e,D[1]-e],[D[0]+l,D[1]+l]],t);t={main:c([E,K,I,D],t),top:G,bot:C,left:F,right:e};return[new f(k,v,B+2*l,z+2*l),t]}get boundsT(){var t=this.bounds;const l=g.set(p.create(),t.x,t.y);g.transformMat2d(l,l,this._transform);return this._hasRotation?(t=Math.max(t.width,t.height),new f(l[0],l[1],t,t)):new f(l[0],l[1],t.width,t.height)}_createBounds(t){let l=Infinity,e=Infinity,u=0;var x=0;for(const y of t)l=Math.min(l,y.xTopLeft),e=Math.min(e,y.yTopLeft),u=Math.max(u,
y.xBottomRight),x=Math.max(x,y.yBottomRight);t=u-l;x-=e;return new f(l+t/2,e+x/2,t,x)}_createGlyphTransform(t,l){const e=h*l.angle,u=r.create(),x=p.create();q.translate(u,u,g.set(x,l.xOffset,-l.yOffset));l.useCIMAngleBehavior?q.rotate(u,u,e):(q.translate(u,u,g.set(x,t.x,t.y)),q.rotate(u,u,e),q.translate(u,u,g.set(x,-t.x,-t.y)));return u}}class w{constructor(t,l,e,u,x,y){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(l,e));this.end=Math.max(0,Math.max(l,e));this.end<t.length&&
(this.glyphWidthEnd=t[this.end].metrics.width);this.width=u;this.yMin=x;this.yMax=y}}a.ShapedGlyph=n;a.ShapingInfo=d;a.shapeGlyphs=function(t,l){const e=l.scale,u=[],{glyphs:x,isRightToLeft:y}=t;t=[];var A=1/l.scale*l.maxLineWidth,k=y?x.length-1:0,v=y?-1:x.length,B=y?-1:1,z=k,E=0,K=0,I=z;let D=I,G=0,C=Infinity,F=0;for(;z!==v;){const {code:T,metrics:S}=x[z];var J=Math.abs(S.top);10!==T&&32!==T&&(C=Math.min(C,J),F=Math.max(F,J+S.height));10===T?(z!==k&&(t.push(new w(x,I,z-B,E,Infinity===C?0:C,F)),C=
Infinity,F=0),E=0,I=z+B,D=z+B,K=0):32===T?(D=z+B,K=0,G=S.advance,E+=S.advance):(E>A&&(D!==I?(J=D-2*B,E-=G,t.push(new w(x,I,J,E-K,C,F)),C=Infinity,F=0,I=D,E=K):(t.push(new w(x,I,z-B,E,C,F)),C=Infinity,F=0,D=I=z,E=0)),E+=S.advance,K+=S.advance);z+=B}A=new w(x,I,z-B,E,C,F);0<=A.start&&A.end<x.length&&t.push(A);if(t.length){A=0;for(k=0;k<t.length;k++)({width:v}=t[k]),A=Math.max(v,A);k=t[0].yMin;A={x:0,y:k,height:t[t.length-1].yMax+l.lineHeight*(t.length-1)+("underline"===l.decoration?4:0)-k,width:A}}else A=
{x:0,y:0,height:0,width:0};k=A;A=m.getXAnchorDirection(l.horizontalAlignment);v=m.getYAnchorDirection(l.verticalAlignment);B=v===m.VAlign.Baseline?1:0;k=(1-B)*-k.y+k.height/2*(B?0:v-1)+-22*(B?1:0);for(v=0;v<t.length;v++){const {start:T,end:S,width:ba}=t[v];B=ba/2*(A+1)*-1-3;z=v*l.lineHeight+k-3;t[v].startX=B;t[v].startY=z;for(E=T;E<=S;E++)K=x[E],10!==K.code&&(I=new n(B+K.metrics.left,z-K.metrics.top,K,e),B+=K.metrics.advance,u.push(I))}return new d(u,t,l)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(a,q){function r(z,E){z[0]=E[0];z[1]=E[1];z[2]=E[2];z[3]=E[3];z[4]=E[4];z[5]=E[5];return z}function g(z){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=0;z[5]=0;return z}function p(z,E,K,I,D,G,C){z[0]=E;z[1]=K;z[2]=I;z[3]=D;z[4]=G;z[5]=C;return z}function m(z,E){const K=E[0],I=E[1],D=E[2],G=E[3],C=E[4];E=E[5];let F=K*G-I*D;if(!F)return null;F=1/F;z[0]=G*F;z[1]=-I*F;z[2]=-D*F;z[3]=K*F;z[4]=(D*E-G*C)*F;z[5]=
(I*C-K*E)*F;return z}function b(z){return z[0]*z[3]-z[1]*z[2]}function f(z,E,K){const I=E[0],D=E[1],G=E[2],C=E[3],F=E[4];E=E[5];const J=K[0],T=K[1],S=K[2],ba=K[3],M=K[4];K=K[5];z[0]=I*J+G*T;z[1]=D*J+C*T;z[2]=I*S+G*ba;z[3]=D*S+C*ba;z[4]=I*M+G*K+F;z[5]=D*M+C*K+E;return z}function c(z,E,K){const I=E[0],D=E[1],G=E[2],C=E[3],F=E[4];E=E[5];const J=Math.sin(K);K=Math.cos(K);z[0]=I*K+G*J;z[1]=D*K+C*J;z[2]=I*-J+G*K;z[3]=D*-J+C*K;z[4]=F;z[5]=E;return z}function h(z,E,K){const I=E[1],D=E[2],G=E[3],C=E[4],F=
E[5],J=K[0];K=K[1];z[0]=E[0]*J;z[1]=I*J;z[2]=D*K;z[3]=G*K;z[4]=C;z[5]=F;return z}function n(z,E,K){const I=E[0],D=E[1],G=E[2],C=E[3],F=E[4];E=E[5];const J=K[0];K=K[1];z[0]=I;z[1]=D;z[2]=G;z[3]=C;z[4]=I*J+G*K+F;z[5]=D*J+C*K+E;return z}function d(z,E){const K=Math.sin(E);E=Math.cos(E);z[0]=E;z[1]=K;z[2]=-K;z[3]=E;z[4]=0;z[5]=0;return z}function w(z,E){z[0]=E[0];z[1]=0;z[2]=0;z[3]=E[1];z[4]=0;z[5]=0;return z}function t(z,E){z[0]=1;z[1]=0;z[2]=0;z[3]=1;z[4]=E[0];z[5]=E[1];return z}function l(z){return"mat2d("+
z[0]+", "+z[1]+", "+z[2]+", "+z[3]+", "+z[4]+", "+z[5]+")"}function e(z){return Math.sqrt(z[0]**2+z[1]**2+z[2]**2+z[3]**2+z[4]**2+z[5]**2+1)}function u(z,E,K){z[0]=E[0]+K[0];z[1]=E[1]+K[1];z[2]=E[2]+K[2];z[3]=E[3]+K[3];z[4]=E[4]+K[4];z[5]=E[5]+K[5];return z}function x(z,E,K){z[0]=E[0]-K[0];z[1]=E[1]-K[1];z[2]=E[2]-K[2];z[3]=E[3]-K[3];z[4]=E[4]-K[4];z[5]=E[5]-K[5];return z}function y(z,E,K){z[0]=E[0]*K;z[1]=E[1]*K;z[2]=E[2]*K;z[3]=E[3]*K;z[4]=E[4]*K;z[5]=E[5]*K;return z}function A(z,E,K,I){z[0]=E[0]+
K[0]*I;z[1]=E[1]+K[1]*I;z[2]=E[2]+K[2]*I;z[3]=E[3]+K[3]*I;z[4]=E[4]+K[4]*I;z[5]=E[5]+K[5]*I;return z}function k(z,E){return z[0]===E[0]&&z[1]===E[1]&&z[2]===E[2]&&z[3]===E[3]&&z[4]===E[4]&&z[5]===E[5]}function v(z,E){const K=z[0],I=z[1],D=z[2],G=z[3],C=z[4];z=z[5];const F=E[0],J=E[1],T=E[2],S=E[3],ba=E[4];E=E[5];const M=q.getEpsilon();return Math.abs(K-F)<=M*Math.max(1,Math.abs(K),Math.abs(F))&&Math.abs(I-J)<=M*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(D-T)<=M*Math.max(1,Math.abs(D),Math.abs(T))&&
Math.abs(G-S)<=M*Math.max(1,Math.abs(G),Math.abs(S))&&Math.abs(C-ba)<=M*Math.max(1,Math.abs(C),Math.abs(ba))&&Math.abs(z-E)<=M*Math.max(1,Math.abs(z),Math.abs(E))}const B=Object.freeze(Object.defineProperty({__proto__:null,add:u,copy:r,determinant:b,equals:v,exactEquals:k,frob:e,fromRotation:d,fromScaling:w,fromTranslation:t,identity:g,invert:m,mul:f,multiply:f,multiplyScalar:y,multiplyScalarAndAdd:A,rotate:c,scale:h,set:p,str:l,sub:x,subtract:x,translate:n},Symbol.toStringTag,{value:"Module"}));
a.add=u;a.copy=r;a.determinant=b;a.equals=v;a.exactEquals=k;a.frob=e;a.fromRotation=d;a.fromScaling=w;a.fromTranslation=t;a.identity=g;a.invert=m;a.mat2d=B;a.mul=f;a.multiply=f;a.multiplyScalar=y;a.multiplyScalarAndAdd=A;a.rotate=c;a.scale=h;a.set=p;a.str=l;a.sub=x;a.subtract=x;a.translate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(a){function q(){const c=new Float32Array(6);c[0]=1;c[3]=1;
return c}function r(c){const h=new Float32Array(6);h[0]=c[0];h[1]=c[1];h[2]=c[2];h[3]=c[3];h[4]=c[4];h[5]=c[5];return h}function g(c,h,n,d,w,t){const l=new Float32Array(6);l[0]=c;l[1]=h;l[2]=n;l[3]=d;l[4]=w;l[5]=t;return l}function p(c,h){return new Float32Array(c,h,6)}function m(c,h,n,d){const w=h[d];h=h[d+1];c[d]=n[0]*w+n[2]*h+n[4];c[d+1]=n[1]*w+n[3]*h+n[5]}function b(c,h,n,d=0,w=0,t=2){for(w=w||h.length/t;d<w;d++)m(c,h,n,d*t)}const f=Object.freeze(Object.defineProperty({__proto__:null,clone:r,
create:q,createView:p,fromValues:g,transform:m,transformMany:b},Symbol.toStringTag,{value:"Module"}));a.clone=r;a.create=q;a.createView=p;a.fromValues=g;a.mat2df32=f;a.transform=m;a.transformMany=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(a){function q(){return new Float32Array(2)}function r(l){const e=new Float32Array(2);e[0]=l[0];e[1]=l[1];return e}function g(l,e){const u=new Float32Array(2);
u[0]=l;u[1]=e;return u}function p(l,e){return new Float32Array(l,e,2)}function m(){return q()}function b(){return g(1,1)}function f(){return g(1,0)}function c(){return g(0,1)}const h=q(),n=b(),d=f(),w=c(),t=Object.freeze(Object.defineProperty({__proto__:null,ONES:n,UNIT_X:d,UNIT_Y:w,ZEROS:h,clone:r,create:q,createView:p,fromValues:g,ones:b,unitX:f,unitY:c,zeros:m},Symbol.toStringTag,{value:"Module"}));a.ONES=n;a.UNIT_X=d;a.UNIT_Y=w;a.ZEROS=h;a.clone=r;a.create=q;a.createView=p;a.fromValues=g;a.ones=
b;a.unitX=f;a.unitY=c;a.vec2f32=t;a.zeros=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(a,q){a.HAlign=void 0;(function(r){r[r.Left=-1]="Left";r[r.Center=0]="Center";r[r.Right=1]="Right"})(a.HAlign||(a.HAlign={}));a.VAlign=void 0;(function(r){r[r.Top=1]="Top";r[r.Center=0]="Center";r[r.Bottom=-1]="Bottom";r[r.Baseline=2]="Baseline"})(a.VAlign||(a.VAlign={}));a.getAlignmentFromPlacement=
function(r){switch(r){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center","bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center",
"middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right","top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center",
"middle"];default:return console.debug(`Found invalid placement type ${r}`),["center","middle"]}};a.getJustification=function(r){switch(r){case "left":return a.HAlign.Left;case "right":return a.HAlign.Right;case "center":return a.HAlign.Center}};a.getXAnchorDirection=function(r){if(!r)return a.HAlign.Center;switch(r){case "Left":case "left":return a.HAlign.Left;case "Right":case "right":return a.HAlign.Right;case "Justify":return q.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
a.HAlign.Center;case "Center":case "center":return a.HAlign.Center}};a.getXDirection=function(r){switch(r){case a.HAlign.Right:case "right":return-1;case a.HAlign.Center:case "center":return 0;case a.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${r}`),0}};a.getYAnchorDirection=function(r){if(!r)return a.VAlign.Center;switch(r){case "Top":case "top":return a.VAlign.Top;case "Center":case "middle":return a.VAlign.Center;case "Baseline":case "baseline":return a.VAlign.Baseline;
case "Bottom":case "bottom":return a.VAlign.Bottom}};a.getYDirection=function(r){switch(r){case a.VAlign.Top:case "top":return 1;case a.VAlign.Center:case "middle":return 0;case a.VAlign.Bottom:case a.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${r}`),0}};a.isMapAligned=function(r){switch(r){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;
default:return!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(a){class q{constructor(r,g,p,m){this.computedY=this.computedX=0;this.center=a.fromValues(r,g);this.centerT=a.create();this.halfWidth=p/2;this.halfHeight=m/2;this.width=p;this.height=m}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+
this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(r){this.center[0]=r}set y(r){this.center[1]=r}clone(){return new q(this.x,this.y,this.width,this.height)}serialize(r){r.writeF32(this.center[0]);r.writeF32(this.center[1]);r.push(this.width);r.push(this.height);return r}findCollisionDelta(r,
g=4){return Math.log2(Math.min((r.halfWidth+this.halfWidth+g)/Math.abs(r.centerT[0]-this.centerT[0]),(r.halfHeight+this.halfHeight+g)/Math.abs(r.centerT[1]-this.centerT[1])))}extend(r){const g=Math.min(this.xmin,r.xmin),p=Math.min(this.ymin,r.ymin),m=Math.max(this.xmax,r.xmax)-g;r=Math.max(this.ymax,r.ymax)-p;this.width=m;this.height=r;this.halfWidth=m/2;this.halfHeight=r/2;this.x=g+m/2;this.y=p+r/2}static deserialize(r){const g=r.readF32(),p=r.readF32(),m=r.readInt32();r=r.readInt32();return new q(g,
p,m,r)}}return q})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions".split(" "),function(a,q,r,g,p,m){a.getLineWidth=function(b){const f=q.px2pt(m.minTextLineWidth),c=q.px2pt(m.maxTextLineWidth);return Math.max(f,Math.min(b||c,c))};a.intersectingInternationalDateline=function(b,f){f=p.getInfo(f);
if(!f)return null;const [c,h]=f.valid;return b[2]>h?[g.create([b[0],b[1],h,b[3]]),g.create([c,b[1],c+b[2]-h,b[3]])]:b[0]<c?[g.create([c,b[1],b[2],b[3]]),g.create([h-(c-b[0]),b[1],h,b[3]])]:null};a.isMarkerSymbol=function(b){return"simple-marker"===b||"picture-marker"===b||"esriSMS"===b||"esriPMS"===b};a.isTextSymbol=function(b){return"text"===b||"esriTS"===b};a.pixelBuffer=50;a.polygonFromExtent=function(b){if(!b)return null;const {xmin:f,ymin:c,xmax:h,ymax:n,spatialReference:d}=b;return new r({rings:[[[f,
c],[f,n],[h,n],[h,c],[f,c]]],spatialReference:d})};a.roundPtToWholePixel=function(b){return q.px2pt(Math.round(q.pt2px(b)))};a.tileSize=512;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults":function(){define("exports ../../core/has ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../TextSymbol ./defaultsJSON".split(" "),function(a,q,r,g,p,m,b){const f=p.fromJSON(b.defaultPointSymbolJSON),c=g.fromJSON(b.defaultPolylineSymbolJSON),h=r.fromJSON(b.defaultPolygonSymbolJSON);
q=m.fromJSON(b.defaultTextSymbolJSON);p=p.fromJSON(b.errorPointSymbolJSON);g=g.fromJSON(b.errorPolylineSymbolJSON);r=r.fromJSON(b.errorPolygonSymbolJSON);a.defaultPointSymbol2D=f;a.defaultPolygonSymbol2D=h;a.defaultPolylineSymbol2D=c;a.defaultTextSymbol2D=q;a.errorPointSymbol2D=p;a.errorPolygonSymbol2D=r;a.errorPolylineSymbol2D=g;a.getDefaultSymbol2D=function(n){if(null==n)return null;switch(n.type){case "point":case "multipoint":return f;case "polyline":return c;case "polygon":case "extent":return h}return null};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleFillSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./FillSymbol ./SimpleLineSymbol".split(" "),function(a,q,r,g,p,m,b,f,c,h,n){var d;r=new r.JSONMap({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",
esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});h=d=class extends h{constructor(...w){super(...w);this.color=new q([0,0,0,.25]);this.outline=new n;this.type="simple-fill";this.style="solid"}normalizeCtorArgs(w,t,l){if(w&&"string"!==typeof w)return w;const e={};w&&(e.style=w);t&&(e.outline=t);l&&(e.color=l);return e}clone(){return new d({color:g.clone(this.color),outline:this.outline&&
this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};a.__decorate([p.property()],h.prototype,"color",void 0);a.__decorate([p.property()],h.prototype,"outline",void 0);a.__decorate([f.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],h.prototype,"type",void 0);a.__decorate([p.property({type:r.apiValues,json:{read:r.read,write:r.write}})],h.prototype,"style",void 0);return h=d=a.__decorate([c.subclass("esri.symbols.SimpleFillSymbol")],
h)})},"esri/core/accessorSupport/decorators/enumeration":function(){define(["exports","../../jsonMap","./property"],function(a,q,r){a.enumeration=function(g,p={}){g=g instanceof q.JSONMap?g:new q.JSONMap(g,p);g={type:p?.ignoreUnknown??!0?g.apiValues:String,json:{type:g.jsonValues,read:p?.readOnly?!1:{reader:g.read},write:{writer:g.write}}};void 0!==p?.readOnly&&(g.readOnly=!!p.readOnly);void 0!==p?.default&&(g.json.default=p.default);void 0!==p?.name&&(g.json.name=p.name);void 0!==p?.nonNullable&&
(g.nonNullable=p.nonNullable);return r.property(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/FillSymbol":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./SimpleLineSymbol ./Symbol".split(" "),function(a,q,r,g,p,m,b,f){r=class extends f{constructor(c){super(c);this.type=this.outline=null}hash(){return`${this.type}.${this.outline?.hash()}`}};
a.__decorate([q.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":b}},json:{default:null,write:!0}})],r.prototype,"outline",void 0);a.__decorate([q.property({type:["simple-fill","picture-fill"],readOnly:!0})],r.prototype,"type",void 0);return r=a.__decorate([m.subclass("esri.symbols.FillSymbol")],r)})},"esri/symbols/SimpleLineSymbol":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./LineSymbol ./LineSymbolMarker".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){var d;q=new q.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});h=d=class extends h{constructor(...w){super(...w);this.type="simple-line";this.style="solid";this.join=
this.cap="round";this.marker=null;this.miterLimit=2}normalizeCtorArgs(w,t,l,e,u,x){if(w&&"string"!==typeof w)return w;const y={};null!=w&&(y.style=w);null!=t&&(y.color=t);null!=l&&(y.width=g.toPt(l));null!=e&&(y.cap=e);null!=u&&(y.join=u);null!=x&&(y.miterLimit=g.toPt(x));return y}clone(){return new d({color:r.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};
a.__decorate([f.enumeration({esriSLS:"simple-line"},{readOnly:!0})],h.prototype,"type",void 0);a.__decorate([p.property({type:q.apiValues,json:{read:q.read,write:q.write}})],h.prototype,"style",void 0);a.__decorate([p.property({type:["butt","round","square"],json:{write:{overridePolicy:(w,t,l)=>({enabled:"round"!==w&&null==l?.origin})}}})],h.prototype,"cap",void 0);a.__decorate([p.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(w,t,l)=>({enabled:"round"!==w&&null==l?.origin})}}})],
h.prototype,"join",void 0);a.__decorate([p.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":n}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],h.prototype,"marker",void 0);a.__decorate([p.property({type:Number,json:{read:!1,write:!1}})],h.prototype,"miterLimit",void 0);return h=d=a.__decorate([c.subclass("esri.symbols.SimpleLineSymbol")],h)})},"esri/symbols/LineSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),
function(a,q,r,g,p,m,b,f,c){g=class extends c{constructor(h){super(h);this.type="simple-line";this.width=.75}hash(){return`${this.type}.${this.width}`}};a.__decorate([b.enumeration({esriSLS:"simple-line"},{readOnly:!0})],g.prototype,"type",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,json:{write:!0}})],g.prototype,"width",void 0);return g=a.__decorate([f.subclass("esri.symbols.LineSymbol")],g)})},"esri/symbols/Symbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f,c,h){r=new r.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let n=0;g=class extends g.JSONSupport{constructor(d){super(d);this.id=`sym${n++}`;this.type=null;this.color=new q([0,
0,0,1])}readColor(d){return null!=d?.[0]?[d[0],d[1],d[2],d[3]/255]:d}async collectRequiredFields(d,w){}hash(){return JSON.stringify(this.toJSON())}clone(){}};a.__decorate([p.property({type:r.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:r.write}}})],g.prototype,"type",void 0);a.__decorate([p.property({type:q,json:{write:{allowNull:!0}}})],g.prototype,"color",void 0);a.__decorate([c.reader("color")],g.prototype,"readColor",null);return g=a.__decorate([h.subclass("esri.symbols.Symbol")],
g)})},"esri/symbols/LineSymbolMarker":function(){define("../chunks/tslib.es6 ../Color ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./support/lineMarkers".split(" "),function(a,q,r,g,p,m,b,f,c,h,n,d){var w;r=w=class extends r.JSONSupport{constructor(t){super(t);this.placement=
"begin-end";this.type="line-marker";this.style="arrow"}writeStyle(t,l,e,u){l[e]="web-map"===u?.origin?"arrow":t}set color(t){this._set("color",t)}readColor(t){return null!=t?.[0]?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,l,e,u){"web-map"!==u?.origin&&(l[e]=t)}clone(){return new w({color:g.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};a.__decorate([p.property({type:["begin","end","begin-end"],json:{write:!0}})],r.prototype,
"placement",void 0);a.__decorate([f.enumeration({"line-marker":"line-marker"},{readOnly:!0}),p.property({json:{origins:{"web-map":{write:!1}}}})],r.prototype,"type",void 0);a.__decorate([p.property({type:d.lineMarkerStyles})],r.prototype,"style",void 0);a.__decorate([n.writer("style")],r.prototype,"writeStyle",null);a.__decorate([p.property({type:q,value:null,json:{write:{allowNull:!0}}})],r.prototype,"color",null);a.__decorate([c.reader("color")],r.prototype,"readColor",null);a.__decorate([n.writer("color")],
r.prototype,"writeColor",null);return r=w=a.__decorate([h.subclass("esri.symbols.LineSymbolMarker")],r)})},"esri/symbols/support/lineMarkers":function(){define(["exports"],function(a){a.lineMarkerPlacements=["begin","end","begin-end"];a.lineMarkerStyles="arrow circle square diamond cross x".split(" ");Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleMarkerSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./MarkerSymbol ./SimpleLineSymbol".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w){var t;r=new r.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});d=t=class extends d{constructor(...l){super(...l);this.color=new q([255,255,255,.25]);this.type="simple-marker";this.size=12;this.style="circle";this.outline=new w}normalizeCtorArgs(l,e,u,x){if(l&&"string"!==typeof l)return l;const y={};l&&(y.style=l);null!=e&&(y.size=p.toPt(e));u&&(y.outline=
u);x&&(y.color=x);return y}writeColor(l,e){l&&"x"!==this.style&&"cross"!==this.style&&(e.color=l.toJSON());null===l&&(e.color=null)}set path(l){this.style="path";this._set("path",l)}clone(){return new t({angle:this.angle,color:g.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};a.__decorate([m.property()],
d.prototype,"color",void 0);a.__decorate([n.writer("color")],d.prototype,"writeColor",null);a.__decorate([c.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],d.prototype,"type",void 0);a.__decorate([m.property()],d.prototype,"size",void 0);a.__decorate([m.property({type:r.apiValues,json:{read:r.read,write:r.write}})],d.prototype,"style",void 0);a.__decorate([m.property({type:String,json:{write:!0}})],d.prototype,"path",null);a.__decorate([m.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",
typeMap:{"simple-line":w}},json:{default:null,write:!0}})],d.prototype,"outline",void 0);return d=t=a.__decorate([h.subclass("esri.symbols.SimpleMarkerSymbol")],d)})},"esri/symbols/MarkerSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),function(a,q,r,g,p,m,b,f){g=class extends f{constructor(c){super(c);this.angle=0;this.type=null;
this.yoffset=this.xoffset=0;this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};a.__decorate([r.property({type:Number,json:{read:c=>c&&-1*c,write:(c,h)=>h.angle=c&&-1*c}})],g.prototype,"angle",void 0);a.__decorate([r.property({type:["simple-marker","picture-marker"],readOnly:!0})],g.prototype,"type",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,json:{write:!0}})],g.prototype,"xoffset",void 0);a.__decorate([r.property({type:Number,cast:q.toPt,
json:{write:!0}})],g.prototype,"yoffset",void 0);a.__decorate([r.property({type:Number,cast:c=>"auto"===c?c:q.toPt(c),json:{write:!0}})],g.prototype,"size",void 0);return g=a.__decorate([b.subclass("esri.symbols.MarkerSymbol")],g)})},"esri/symbols/TextSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Font ./Symbol ./support/textUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d){var w;n=w=class extends n{constructor(...t){super(...t);this.borderLineSize=this.borderLineColor=this.backgroundColor=null;this.font=new h;this.horizontalAlignment="center";this.kerning=!0;this.rightToLeft=this.haloSize=this.haloColor=null;this.rotated=!1;this.text="";this.type="text";this.verticalAlignment="baseline";this.angle=this.yoffset=this.xoffset=0;this.width=null;this.lineWidth=192;this.lineHeight=1}normalizeCtorArgs(t,l,e){if(t&&"string"!==typeof t)return t;
const u={};t&&(u.text=t);l&&(u.font=l);e&&(u.color=e);return u}writeLineWidth(t,l,e,u){u&&"string"!==typeof u||(l[e]=t)}castLineWidth(t){return g.toPt(t)}writeLineHeight(t,l,e,u){u&&"string"!==typeof u||(l[e]=t)}clone(){return new w({angle:this.angle,backgroundColor:r.clone(this.backgroundColor),borderLineColor:r.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:r.clone(this.color),font:this.font&&this.font.clone(),haloColor:r.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,
kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};
a.__decorate([p.property({type:q,json:{write:!0}})],n.prototype,"backgroundColor",void 0);a.__decorate([p.property({type:q,json:{write:!0}})],n.prototype,"borderLineColor",void 0);a.__decorate([p.property({type:Number,json:{write:!0},cast:g.toPt})],n.prototype,"borderLineSize",void 0);a.__decorate([p.property({type:h,json:{write:!0}})],n.prototype,"font",void 0);a.__decorate([p.property({...d.horizontalAlignmentProperty,json:{write:!0}})],n.prototype,"horizontalAlignment",void 0);a.__decorate([p.property({type:Boolean,
json:{write:!0}})],n.prototype,"kerning",void 0);a.__decorate([p.property({type:q,json:{write:!0}})],n.prototype,"haloColor",void 0);a.__decorate([p.property({type:Number,cast:g.toPt,json:{write:!0}})],n.prototype,"haloSize",void 0);a.__decorate([p.property({type:Boolean,json:{write:!0}})],n.prototype,"rightToLeft",void 0);a.__decorate([p.property({type:Boolean,json:{write:!0}})],n.prototype,"rotated",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],n.prototype,"text",void 0);a.__decorate([b.enumeration({esriTS:"text"},
{readOnly:!0})],n.prototype,"type",void 0);a.__decorate([p.property({...d.verticalAlignmentProperty,json:{write:!0}})],n.prototype,"verticalAlignment",void 0);a.__decorate([p.property({type:Number,cast:g.toPt,json:{write:!0}})],n.prototype,"xoffset",void 0);a.__decorate([p.property({type:Number,cast:g.toPt,json:{write:!0}})],n.prototype,"yoffset",void 0);a.__decorate([p.property({type:Number,json:{read:t=>t&&-1*t,write:(t,l)=>l.angle=t&&-1*t}})],n.prototype,"angle",void 0);a.__decorate([p.property({type:Number,
json:{write:!0}})],n.prototype,"width",void 0);a.__decorate([p.property({type:Number})],n.prototype,"lineWidth",void 0);a.__decorate([c.writer("lineWidth")],n.prototype,"writeLineWidth",null);a.__decorate([m.cast("lineWidth")],n.prototype,"castLineWidth",null);a.__decorate([p.property(d.lineHeightProperty)],n.prototype,"lineHeight",void 0);a.__decorate([c.writer("lineHeight")],n.prototype,"writeLineHeight",null);return n=w=a.__decorate([f.subclass("esri.symbols.TextSymbol")],n)})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],
function(a){const q=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:q,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},g={type:"esriSLS",style:"esriSLSSolid",width:.75,color:q};a.defaultColor=q;a.defaultOutlineColor=[153,153,153,255];a.defaultPointSymbolJSON=r;a.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}};a.defaultPolylineSymbolJSON=
g;a.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0};a.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5};a.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null};a.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",
color:[0,0,0,255],width:1.5};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(a,q){let r=null;q.getGeometryEngine=function(){return r};q.loadGeometryEngine=async function(){r=await new Promise((g,p)=>a(["../../../../../../../geometry/geometryEngineJSON"],g,p))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports",
"../../../number","./AlignedVertexSpec","./dataViewUtils"],function(a,q,r,g){class p{static fromVertexSpec(m,b){m=r.AlignedVertexSpec.fromVertexSpec(m,b);return new p(m)}constructor(m){this._spec=m;this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(m,b,f,c,h,n){for(let t=
0;t<this._spec.packVertexCount;t++){const l=t*this._spec.stride;this._packPosition(f,c,l);this._packId(b,l);var d=this._spec.bitset;if(n){if(d.packTessellation){var w=d.packTessellation(n,h);this._pack(w,d,l)}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation)d=e.packTessellation(n,h),this._pack(d,e,l);else if(e.packAlternating?.packTessellation)for(d=e.packAlternating.packTessellation(n,h),w=0;w<this._spec.packVertexCount;w++)this._pack(d[w],e,w*this._spec.stride)}}m.vertexWriteRegion(this._packedU32View)}pack(m,
b){for(const h of this._spec.standardAttributes)if(h.pack&&"string"!==typeof h.pack){var f=h.pack(m,b);for(var c=0;c<this._spec.packVertexCount;c++)this._pack(f,h,c*this._spec.stride)}else if(h.packAlternating?.pack)for(f=h.packAlternating.pack(m,b),c=0;c<this._spec.packVertexCount;c++)this._pack(f[c],h,c*this._spec.stride)}_packPosition(m,b,f){const {offset:c}=this._spec.position,h=this._spec.position.packPrecisionFactor??1;m=q.i1616to32(m*h,b*h);this._dataView.setUint32(f+c,m,!0)}_packId(m,b){m*=
this._spec.id.packPrecisionFactor??1;const f=this._dataView.getUint32(b+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(b+this._spec.id.offset,m|f,!0)}_pack(m,b,f){g.packDataView(this._dataView,m,b,f)}}a.MeshWriterVertexPack=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(a){function q(m,b,f){return Math.round(Math.max(Math.min(m,f),b))}function r(m){g[0]=m;return p[0]}const g=new Float32Array(1),
p=new Uint32Array(g.buffer);a.fromUint16=function(m){let b,f;b=(m>>10&31)-15;f=(m&1023)/1024;-15<b?f+=1:b=-14;return(m>>>15?-1:1)*2**b*f};a.i16=function(m){return q(m,-32768,32767)};a.i1616to32=function(m,b){return 65535&m|b<<16};a.i32=function(m){return q(m,-2147483648,2147483647)};a.i8=function(m){return q(m,-128,127)};a.i8816to32=function(m,b,f){return m&255|(b&255)<<8|f<<16};a.i8888to32=function(m,b,f,c){return m&255|(b&255)<<8|(f&255)<<16|c<<24};a.numTo32=function(m){return m|0};a.toFloat32=
function(m){p[0]=m;return g[0]};a.toUint16=function(m){var b=r(m);m=b>>>31;var f=b&8388607;b=(b>>>23&255)-127;if(15<b)return m<<15|31744;if(-25>b)return 0;-14>b&&(f=(f+8388608)/2**(-14-b),b=-15);var c=f/8192;f=Math.floor(c);c-=f;f=1023>f&&(.5<c||.5===c&&1===f%2)?f+1:f;return m<<15|b+15<<10|f};a.toUint32=r;a.u16=function(m){return q(m,0,65535)};a.u32=function(m){return q(m,0,4294967295)};a.u32to4Xu8=function(m){return[m&255,(m&65280)>>>8,(m&16711680)>>>16,(m&4278190080)>>>24]};a.u4u4to8=function(m,
b){return 15&m|(15&b)<<4};a.u8=function(m){return q(m,0,255)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(a,q,r,g){function p(f){switch(f){case g.DataType.BYTE:case g.DataType.UNSIGNED_BYTE:return 1;case g.DataType.SHORT:case g.DataType.UNSIGNED_SHORT:case g.DataType.HALF_FLOAT:return 2;case g.DataType.FLOAT:case g.DataType.INT:case g.DataType.UNSIGNED_INT:return 4}}
function m(f){const c=[],h=[],n=[];for(const d of f)switch(f=p(d.type)*d.count,f%2||f%4||4){case 4:c.push(d);continue;case 2:h.push(d);continue;case 1:n.push(d);continue;default:throw Error("Found unexpected dataType byte count");}c.push(...h);c.push(...n);return c}class b{static fromVertexSpec(f,c){const {attributes:h,optionalAttributes:n}=f;let d,w,t;f=[];for(var l in h){const x=h[l];"position"===x.pack?d={...x,name:l,offset:0}:"id"===x.pack?w={...x,name:l,offset:4}:"bitset"===l?t={...x,name:l,
offset:7}:f.push({...x,name:l})}for(var e in n)!0===c[e]&&f.push({...n[e],name:e});f=m(f);c=[];l=8;e=1;for(var u of f)c.push({...u,offset:l}),l+=p(u.type)*u.count,u.packAlternating&&(e=Math.max(u.packAlternating.count,e));u=Uint32Array.BYTES_PER_ELEMENT;f=l%u;return new b(d,w,t,c,l+(f?u-f:0),e)}constructor(f,c,h,n,d,w){this.position=f;this.id=c;this.bitset=h;this.standardAttributes=n;this.stride=d;this.packVertexCount=w;n.push(h);this._attributes=[f,c,h,...n]}get attributeLayout(){if(!this._attributeLayout){const f=
r.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(c=>({name:c.name,count:c.count,offset:c.offset,type:c.type,packPrecisionFactor:c.packPrecisionFactor,normalized:c.normalized??!1})),hash:f,stride:this.stride}}return this._attributeLayout}}a.AlignedVertexSpec=b;a.sortByAlignment=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],
function(a,q){function r(g,p,m,b,f,c,h){if(g.primitiveName===p)for(const n in g)if(n===m){p=b?.readWithDefault(f,c,g[n]&&h);"text"===g.type&&(p=p.toString());g[n]=p;return}if("type"in g&&null!=g.type)switch(g.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(g.symbolLayers)for(const n of g.symbolLayers)r(n,p,m,b,f,c,h);break;case "CIMHatchFill":g.lineSymbol&&r(g.lineSymbol,p,m,b,f,c,h);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if("CIMVectorMarker"===
g.type&&g.markerGraphics)for(const n of g.markerGraphics)r(n,p,m,b,f,c,h),r(n.symbol,p,m,b,f,c,h)}}a.applyComputedValue=r;a.getLineClippingMargin=function(g){const p=g.width;return null!=g.effects?400:Math.max(1.25*p,8)};a.vertexLayoutHash=function(g){g=g.map(({name:p,count:m,type:b})=>`${p}.${m}.${b}`).join(",");return q.numericHash(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports",
"../../../number","../../../../../../webgl/enums"],function(a,q,r){a.packDataView=function(g,p,m,b){const f=m.packPrecisionFactor??1;switch(m.type){case r.DataType.BYTE:if(1===m.count)g.setInt8(b+m.offset,p*f);else for(var c=0;c<m.count;c++)g.setInt8(b+m.offset+c*Int8Array.BYTES_PER_ELEMENT,p[c]*f);break;case r.DataType.UNSIGNED_BYTE:if(1===m.count)g.setUint8(b+m.offset,p*f);else for(c=0;c<m.count;c++)g.setUint8(b+m.offset+c*Uint8Array.BYTES_PER_ELEMENT,p[c]*f);break;case r.DataType.SHORT:if(1===
m.count)g.setInt16(b+m.offset,p*f,!0);else for(c=0;c<m.count;c++)g.setInt16(b+m.offset+c*Int16Array.BYTES_PER_ELEMENT,p[c]*f,!0);break;case r.DataType.UNSIGNED_SHORT:if(1===m.count)g.setUint16(b+m.offset,p*f,!0);else for(c=0;c<m.count;c++)g.setUint16(b+m.offset+c*Uint16Array.BYTES_PER_ELEMENT,p[c]*f,!0);break;case r.DataType.INT:if(1===m.count)g.setInt32(b+m.offset,p*f,!0);else for(c=0;c<m.count;c++)g.setInt32(b+m.offset+c*Int32Array.BYTES_PER_ELEMENT,p[c]*f,!0);break;case r.DataType.UNSIGNED_INT:if(1===
m.count)g.setUint32(b+m.offset,p*f,!0);else for(c=0;c<m.count;c++)g.setUint32(b+m.offset+c*Uint32Array.BYTES_PER_ELEMENT,p[c]*f,!0);break;case r.DataType.FLOAT:if(1===m.count)g.setFloat32(b+m.offset,p*f,!0);else for(c=0;c<m.count;c++)g.setFloat32(b+m.offset+c*Float32Array.BYTES_PER_ELEMENT,p[c]*f,!0);break;case r.DataType.HALF_FLOAT:if(1===m.count)g.setUint16(b+m.offset,q.toUint16(p*f),!0);else for(c=0;c<m.count;c++)g.setUint16(b+m.offset+c*Uint16Array.BYTES_PER_ELEMENT,q.toUint16(p[c]*f),!0)}};a.unpackDataView=
function(g,p,m){switch(p.type){case r.DataType.BYTE:if(1===p.count)return g.getInt8(m+p.offset);var b=[];for(var f=0;f<p.count;f++)b.push(g.getInt8(m+p.offset+f*Int8Array.BYTES_PER_ELEMENT));return b;case r.DataType.UNSIGNED_BYTE:if(1===p.count)return g.getUint8(m+p.offset);b=[];for(f=0;f<p.count;f++)b.push(g.getUint8(m+p.offset+f*Uint8Array.BYTES_PER_ELEMENT));return b;case r.DataType.SHORT:if(1===p.count)return g.getInt16(m+p.offset,!0);b=[];for(f=0;f<p.count;f++)b.push(g.getInt16(m+p.offset+f*
Int16Array.BYTES_PER_ELEMENT,!0));return b;case r.DataType.UNSIGNED_SHORT:if(1===p.count)return g.getUint16(m+p.offset,!0);b=[];for(f=0;f<p.count;f++)b.push(g.getUint16(m+p.offset+f*Uint16Array.BYTES_PER_ELEMENT,!0));return b;case r.DataType.INT:if(1===p.count)return g.getInt32(m+p.offset,!0);b=[];for(f=0;f<p.count;f++)b.push(g.getInt32(m+p.offset+f*Int32Array.BYTES_PER_ELEMENT,!0));return b;case r.DataType.UNSIGNED_INT:if(1===p.count)return g.getUint32(m+p.offset,!0);b=[];for(f=0;f<p.count;f++)b.push(g.getUint32(m+
p.offset+f*Uint32Array.BYTES_PER_ELEMENT,!0));return b;case r.DataType.FLOAT:if(1===p.count)return g.getFloat32(m+p.offset,!0);b=[];for(f=0;f<p.count;f++)b.push(g.getFloat32(m+p.offset+f*Float32Array.BYTES_PER_ELEMENT,!0));return b;case r.DataType.HALF_FLOAT:if(1===p.count)return q.fromUint16(g.getUint16(m+p.offset,!0));b=[];for(f=0;f<p.count;f++)b.push(q.fromUint16(g.getUint16(m+p.offset+f*Uint16Array.BYTES_PER_ELEMENT,!0)));return b}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),function(a,q,r,g,p,m,b){function f(d){const {sprite:w,aspectRatio:t,scaleProportionally:l}=d;var e=q.pt2px(d.height);d=0<e?e:w.height;e*=t;0>=e?e=w.width:l&&(e*=w.width/w.height);return{width:e,height:d}}function c(d){const {applyRandomOffset:w,
sampleAlphaOnly:t}=d;return g.packBitset([[m.bitsetFillRandomPatternOffset,w],[m.bitsetGenericConsiderAlphaOnly,t]])}const h={createComputedParams:d=>d,optionalAttributes:p.patternFillVertexSpec.optionalAttributes,attributes:{...p.patternFillVertexSpec.attributes,bitset:{count:1,type:b.DataType.UNSIGNED_BYTE,pack:c},width:{count:1,type:b.DataType.HALF_FLOAT,pack:d=>f(d).width},height:{count:1,type:b.DataType.HALF_FLOAT,pack:d=>f(d).height},offset:{count:2,type:b.DataType.HALF_FLOAT,pack:({offsetX:d,
offsetY:w})=>[q.pt2px(d),-q.pt2px(w)]},scale:{count:2,type:b.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:d,scaleY:w})=>[d,w]},angle:{count:1,type:b.DataType.UNSIGNED_BYTE,pack:({angle:d})=>r.degToByte(d)}}};class n extends p.PatternFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=h}}a.ComplexFillMeshWriter=n;a.complexFillVertexSpec=h;a.getPatternSize=f;a.packComplexFillBitset=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports",
"../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(a,q,r,g,p){a.getBitMask=function(m){return 1<<m};a.getMinMaxZoom=function(m,b){const f=!!m?.minScale&&b.scaleToZoom(m.minScale)||0;m=!!m?.maxScale&&b.scaleToZoom(m.maxScale)||100;return[f,m]};a.packBitset=function(m){let b=0;for(const [f,c]of m)c&&(b|=1<<f);return b};a.packByteSqrt=function(m,b){return Math.round(Math.min(Math.sqrt(m*b),255))};a.packRounded=
function(m,b){return Math.round(m*b)/b};a.processColorInput=function(m){if(!m)return[0,0,0,0];if("string"===typeof m){const n=q.fromString(m);if(!n)return g.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new r("mapview:mesh-processing","Unable to parse string into color",{color:m})),[0,0,0,0];m=n.toArray()}const [b,f,c,h]=m;return[h/255*b,h/255*f,h/255*c,h]};a.processLineCapInput=function(m){switch(m){case "butt":case p.LineCapStyle.Butt:return p.CapType.BUTT;
case "round":case p.LineCapStyle.Round:return p.CapType.ROUND;case "square":case p.LineCapStyle.Square:return p.CapType.SQUARE}};a.processLineJoinInput=function(m){switch(m){case "bevel":case p.LineJoinStyle.Bevel:return p.JoinType.BEVEL;case "miter":case p.LineJoinStyle.Miter:return p.JoinType.MITER;case "round":case p.LineJoinStyle.Round:return p.JoinType.ROUND}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports",
"../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(a,q,r,g){const p={createComputedParams:b=>b,optionalAttributes:r.fillVertexSpec.optionalAttributes,attributes:{...r.fillVertexSpec.attributes,tlbr:{count:4,type:g.DataType.UNSIGNED_SHORT,pack:({sprite:b})=>{const {rect:f,width:c,height:h}=b;b=f.x+q.spritePadding;const n=f.y+q.spritePadding;return[b,n,b+c,n+h]}},inverseRasterizationScale:{count:1,type:g.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:b})=>1/b.rasterizationScale}}};
class m extends r.FillMeshWriter{constructor(){super(...arguments);this.vertexSpec=p}_write(b,f,c){c=c?.asOptimized()??f.readGeometryForDisplay();if(c=this._clip(c))b.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(b,f,c),b.recordEnd()}}a.PatternFillMeshWriter=m;a.patternFillVertexSpec=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports",
"../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(a,q,r,g,p){const m={createComputedParams:f=>f,optionalAttributes:{zoomRange:{type:p.DataType.SHORT,count:2,packPrecisionFactor:q.minMaxZoomPrecisionFactor,pack:({scaleInfo:f},{tileInfo:c})=>g.getMinMaxZoom(f,c)}},attributes:{id:{type:p.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1},pos:{type:p.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
color:{type:p.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:f})=>g.processColorInput(f)}}};class b extends r.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}createTesselationParams(f){return null}}a.FillMeshWriter=b;a.fillVertexSpec=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(a){a.RotationType=void 0;var q=a.RotationType||(a.RotationType=
{});q[q.Geographic=0]="Geographic";q[q.Arithmatic=1]="Arithmatic";a.attrVvColor=1;a.attrVvOpacity=2;a.attrVvRotation=3;a.attrVvSize=0;a.bitsetFillRandomPatternOffset=2;a.bitsetGenericConsiderAlphaOnly=4;a.bitsetGenericLockColor=1;a.bitsetLineIsSdf=3;a.bitsetLineScaleDash=2;a.bitsetMarkerAlignmentMap=0;a.bitsetMarkerOutlineAllowColorOverride=2;a.bitsetMarkerScaleSymbolsProportionally=3;a.bitsetTextIsBackground=0;a.bitsetTextIsMapAligned=3;a.bitsetTypeFillOutline=0;a.c256ToRad=3.14159265359/128;a.cDegToRad=
3.14159265359/180;a.cRadToDeg=57.29577950560105;a.epsilon=1E-5;a.epsilonHitTest=.05;a.extrudeScalePlacementPadding=.25;a.fillPositionPrecision=1;a.maxFilterCount=2;a.maxRepresentableInt=16777216;a.maxSdfDistance=8;a.nanMagicNumber=1E-30;a.offsetPrecision=.125;a.outlineScale=.2;a.placementPadding=8;a.positionPrecision=.125;a.sdfFontSize=24;a.softEdgeRatio=1;a.thinLineHalfWidth=1;a.thinLineWidthFactor=1.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/ComplexOutlineFillShader ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c){const h=g.complexFillVertexSpec,n={createComputedParams:l=>l,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,bitset:{type:c.DataType.UNSIGNED_BYTE,count:1,pack:l=>g.packComplexFillBitset(l)},aux1:{count:1,type:c.DataType.HALF_FLOAT,pack:l=>g.getPatternSize(l).width},aux2:{count:1,type:c.DataType.HALF_FLOAT,pack:l=>g.getPatternSize(l).height},aux3:{count:2,type:c.DataType.HALF_FLOAT,pack:({offsetX:l,offsetY:e})=>[q.pt2px(l),q.pt2px(e)]},aux4:{count:2,
type:c.DataType.UNSIGNED_BYTE,pack:({scaleX:l,scaleY:e})=>[l*b.packPrecision,e*b.packPrecision]}}},d={createComputedParams:l=>l,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,color:m.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:c.DataType.UNSIGNED_BYTE,count:1,pack:l=>p.packBitset([[f.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:c.DataType.HALF_FLOAT,pack:l=>q.pt2px(.5*l.width)},aux2:{count:1,type:c.DataType.HALF_FLOAT,pack:l=>q.pt2px(.5*l.referenceWidth)},aux3:{count:2,
type:c.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:l,extrusionOffsetY:e})=>[l,e]},aux4:{count:2,type:c.DataType.UNSIGNED_BYTE,packTessellation:({normalX:l,normalY:e})=>[l*b.packPrecision+b.signedToUnsignedByte,e*b.packPrecision+b.signedToUnsignedByte]}}};class w extends m.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=d}}class t extends m.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}_createOutlineWriter(l,e,u,x){return new w(l,
e,u,x)}_write(l,e,u){u=u?.asOptimized()??e.readGeometryForDisplay();if(u=this._clip(u))l.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(l,e,u),this._lineMeshWriter.writeLineVertices(l,r.GeometryCursor.fromOptimizedCIM(u,"esriGeometryPolyline"),e),l.recordEnd()}ensurePacked(l,e,u){super.ensurePacked(l,e,u);this._lineMeshWriter.ensurePacked(l,e,u)}enqueueRequest(l,e,u){super.enqueueRequest(l,e,u);this._lineMeshWriter.enqueueRequest(l,
e,u)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}a.ComplexOutlineFillMeshWriter=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../mesh/templates/templateUtils ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../mesh/utils ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c){const h={createComputedParams:t=>t,optionalAttributes:m.LineVertexSpec.optionalAttributes,attributes:{...m.LineVertexSpec.attributes,bitset:{type:c.DataType.UNSIGNED_BYTE,count:1,pack:t=>0},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>p.processColorInput(t)}}},n={createComputedParams:t=>t,optionalAttributes:m.LineVertexSpec.optionalAttributes,attributes:{...m.LineVertexSpec.attributes,bitset:{type:c.DataType.UNSIGNED_BYTE,count:1,pack:t=>
p.packBitset([[f.bitsetTypeFillOutline,!0]])},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>p.processColorInput(t)}}};class d extends m.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}}class w extends g.FillMeshWriter{constructor(t,l,e,u){super(t,l,e,u);this.vertexSpec=h;this._lineMeshWriter=this._createOutlineWriter(t,l,e,u)}_createOutlineWriter(t,l,e,u){return new d(t,l,e,u)}_write(t,l,e){e=e?.asOptimized()??l.readGeometryForDisplay();if(e=
this._clip(e))t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,l,e),this._lineMeshWriter.writeLineVertices(t,q.GeometryCursor.fromOptimizedCIM(e,"esriGeometryPolyline"),l),t.recordEnd()}_clip(t){return t?r.clipMarshall(t,b.getLineClippingMargin(this.evaluatedMeshParams)):null}ensurePacked(t,l,e){super.ensurePacked(t,l,e);this._lineMeshWriter.ensurePacked(t,l,e)}enqueueRequest(t,l,e){super.enqueueRequest(t,l,e);this._lineMeshWriter.enqueueRequest(t,l,e)}async loadDependencies(){await Promise.all([super.loadDependencies(),
this._lineMeshWriter.loadDependencies()])}}a.OutlineFillMeshWriter=w;a.OutlineFillOutlineMeshWriter=d;a.outlineFillVertexSpec_Fill=h;a.outlineFillVertexSpec_Outline=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../mesh/utils ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c,h){class n{constructor(){this.distance=this.directionY=this.directionX=this.normalY=this.normalX=this.extrusionOffsetY=this.extrusionOffsetX=0}}const d={createComputedParams:l=>l,optionalAttributes:{zoomRange:{type:h.DataType.SHORT,count:2,packPrecisionFactor:g.minMaxZoomPrecisionFactor,pack:({scaleInfo:l},{tileInfo:e})=>b.getMinMaxZoom(l,e)}},attributes:{id:{type:h.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:h.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
bitset:{type:h.DataType.UNSIGNED_BYTE,count:1},color:{type:h.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:l})=>b.processColorInput(l)},offset:{type:h.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:l,extrusionOffsetY:e})=>[b.packRounded(l,16),b.packRounded(e,16)]},normal:{type:h.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:l,normalY:e})=>[b.packRounded(l,16),b.packRounded(e,16)]},halfWidth:{type:h.DataType.HALF_FLOAT,count:1,
pack:({width:l})=>q.pt2px(.5*l)},referenceHalfWidth:{type:h.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:l})=>q.pt2px(.5*l)}}};class w{constructor(){this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class t extends f.MeshWriter{constructor(l,e,u,x){super(l,e,u,x);this.vertexSpec=d;this._currentWrite=new w;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};this._tessParams=new n;this._initializeTessellator()}writeLineVertices(l,
e,u){e=this._getLines(e);null!=e&&this._writeVertices(l,u,e)}_initializeTessellator(){this._lineTessellator=new p.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(l,e,u){(u=u??r.GeometryCursor.fromFeatureSetReaderCIM(e))&&this._writeGeometry(l,e,u)}_writeGeometry(l,e,u,x){l.recordStart(this.instanceId,this.attributeLayout,x);this.writeLineVertices(l,u,e);l.recordEnd()}_getLines(l){return m.clipLinesMarshall(l,c.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(l,
e,u){const {_currentWrite:x,_tessellationOptions:y,evaluatedMeshParams:A}=this,{width:k,capType:v,joinType:B,miterLimit:z,hasSizeVV:E}=A,K=q.pt2px(.5*k);y.halfWidth=K;y.capType=b.processLineCapInput(v);y.joinType=b.processLineJoinInput(B);y.miterLimit=z;const I=!E;x.out=l;x.id=e.getDisplayId();x.vertexCount=0;x.indexCount=0;x.vertexFrom=l.vertexCount();x.vertexBounds=I&&K<g.thinLineHalfWidthThreshold?0:1;for(const {line:D,start:G}of u)y.initialDistance=G%65535,this._lineTessellator.tessellate(D,y,
I)}_writeTesselatedVertex(l,e,u,x,y,A,k,v,B,z,E){const {out:K,id:I,vertexBounds:D}=this._currentWrite;this.hasEffects&&K.recordBounds(l,e,D,D);this._tessParams.extrusionOffsetX=k;this._tessParams.extrusionOffsetY=v;this._tessParams.normalX=B;this._tessParams.normalY=z;this._tessParams.directionX=y;this._tessParams.directionY=A;this._tessParams.distance=E;this._writeVertex(K,I,l,e,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(l,e,u){const {out:x}=
this._currentWrite;x.indexEnsureSize(3);x.indexWrite(l);x.indexWrite(e);x.indexWrite(u);this._currentWrite.indexCount+=3}}a.LineMeshWriter=t;a.LineTessellationParams=n;a.LineVertexSpec=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d){class w extends p.FeatureVertexInput{}q.__decorate([r.location(3,g.Vec4)],w.prototype,"color",void 0);q.__decorate([r.location(4,g.Vec4)],w.prototype,"tlbr",void 0);q.__decorate([r.location(5,g.Float)],w.prototype,"angle",void 0);q.__decorate([r.location(6,g.Float)],w.prototype,"aux1",void 0);q.__decorate([r.location(7,g.Float)],w.prototype,"aux2",void 0);q.__decorate([r.location(8,g.Vec2)],w.prototype,"aux3",void 0);q.__decorate([r.location(9,g.Vec2)],w.prototype,
"aux4",void 0);q.__decorate([r.location(10,g.Vec2)],w.prototype,"zoomRange",void 0);class t extends d.PatternOutlineFillFragmentInput{}class l extends n.AOutlineFillShader{vertex(e,u){const {aux1:x,aux2:y,aux3:A,aux4:k}=e;var v={...e,width:x,height:y,offset:A,scale:k.multiply(.0625)},B={...e,halfWidth:x,referenceHalfWidth:y,offset:A,normal:k.subtract(128).multiply(.0625)};B=n.getOutlineFillVertexData(this,B);v=m.getComplexFillVertexData(this,v);const z=g.greaterThan(B.isOutline,new g.Float(.5));return{...B,
...v,...this.maybeRunHittest(e,u,z)}}fragment(e){var {isOutline:u}=e;u=g.greaterThan(u,new g.Float(.5));var x=f.getLineFragmentColor(e,this.antialiasingControls.blur);const y=m.getComplexFillFragmentColor(this,e);x=g.ifElse(u,x,y);u=g.ifElse(u,new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(x,e,u)}hittest(e,u,x){return g.ifElse(x,b.failHittest(this.hittestRequest),b.hittestFill(this,e,u))}}q.__decorate([r.uniform(h.MosaicInfo)],l.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(c.LocalTileOffset)],
l.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(w)),q.__param(1,r.input(p.BaseHittestVertexInput))],l.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(t))],l.prototype,"fragment",null);a.ComplexOutlineFillShader=l;a.ComplexOutlineFillVertexInput=w;a.packPrecision=16;a.signedToUnsignedByte=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/string ./ShaderBuilder2D ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){function d(A,k,v){const B=A.constructor[k]??[];A.constructor.hasOwnProperty(k)||Object.defineProperty(A.constructor,k,{value:B.slice()});A.constructor[k].push(v)}r=A=>(k,v)=>{d(k,"builtins",{builtin:A,propertyKey:v})};const w=(A,k)=>(v,B)=>{v.constructor.builtins.push({builtin:A,propertyKey:B,typeCtor:k})};class t{}t.builtins=[];q.__decorate([w("gl_VertexID",b.Int)],t.prototype,"glVertexID",void 0);class l{}class e{}e.builtins=[];q.__decorate([w("gl_FragCoord",b.Vec4)],
e.prototype,"glFragCoord",void 0);q.__decorate([w("gl_PointCoord",b.Vec2)],e.prototype,"glPointCoord",void 0);class u{}q.__decorate([r("gl_FragColor")],u.prototype,"glFragColor",void 0);class x{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class y{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const A=this._shaderModuleClass.inputs.findLast(k=>"vertex"===k.propertyKey&&0===k.parameterIndex);if(!A)throw Error("Unable to find vertex input parameter");
return A}get computeInput(){return this._shaderModuleClass.inputs.findLast(A=>"vertex"===A.propertyKey&&1===A.parameterIndex)}get fragmentInput(){const A=this._shaderModuleClass.inputs.findLast(k=>"fragment"===k.propertyKey);if(!A)throw Error("Unable to find fragment input parameter");return A}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??[])]}get locationsMap(){const A=
new Map,k=new Set;for(const v of this.locations)k.has(v.index)?g.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${v.propertyKey} to ${v.index}. Index already in use`,{locationsMap:A}):(A.set(v.propertyKey,v.index),k.add(v.index));return A}get locationInfo(){if(!this._locationInfo){const A=this.locationsMap,k=Array.from(A.entries()).map(([v,B])=>`${v}.${B}`).join(".");this._locationInfo={hash:p.numericHash(k),locations:A,
computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const A=new Map;for(const k of this.locations)A.set("a_"+k.propertyKey,k.index);return A}get optionPropertyKeys(){if(!this._optionPropertyKeys){const A=new Set;for(const k of this._options)A.add(k.propertyKey);this._optionPropertyKeys=A}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??
[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(A,k,v,B){try{const {vertex:z,fragment:E,uniformBindings:K}=this._generateShaders(A,k,v,B);return new n.TypedShaderProgram(z,E,this.renamedLocationsMap,this.locationInfo,K,this.transformFeedbackBindings)}catch(z){return new n.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(A){var k=this._options.find(v=>v.propertyKey===A);if(k)return{type:"option",
className:k.typeCtor};k=this._uniforms.find(v=>v.propertyKey===A);if(!k)throw Error(`Unable to find uniform class type for property: ${A}`);return{type:"required",className:k.typeCtor}}getShaderKey(A,k,v,B){const z=Object.keys(A).map(D=>`${D}.${A[D]}`).join("."),E=Object.keys(v).map(D=>`${D}.${v[D]}`).join("."),K=Object.keys(B).map(D=>`${D}.${B[D]}`).join("."),I=Object.keys(k).filter(D=>this.optionPropertyKeys.has(D)&&k[D]).join(".");return`${this.constructor.name}.${z}.${E}.${K}.${I}`}_generateShaders(A,
k,v,B){const z=[];this._setDefines(v);this._setOptionalUniforms(z,k);this._setRequiredUniforms(z);k=this._hydrateVertexInput(B);B=this._injectPackPrecisionFactor(k,A);A=(v=this._hydrateComputeInput())&&this._injectComputePackPrecisionFactor(v,A);const E=this.vertex(B,A);A=this._hydrateFragmentInput(E);B=this.fragment(A);const K=new Set;for(var I in B)h.setReachableUids(K,B[I]);I=this._getVertexInputBuiltins();I=c.ShaderGraphContext.createVertex({...k,...v},E,I,z,this.transformFeedbackBindings,K);
(new f.GlslShaderWriter).write(I);k=this._getFragmentInputBuiltins(B);k.set("glPointCoord","gl_PointCoord");k=c.ShaderGraphContext.createFragment(A,B,k,z,I,this.transformFeedbackBindings);(new f.GlslShaderWriter).write(k);k=this._createShaderBuilder(I,k);I=k.generate("vertex",!1);k=k.generate("fragment",!1);this.logShader&&(console.log(I),console.log(k));return{vertex:I,fragment:k,uniformBindings:z}}_setDefines(A){for(const k in A)this[k]=A[k]}_setOptionalUniforms(A,k){for(const v of this._options)this[v.propertyKey]=
k[v.propertyKey]?this._hydrateUniformGroup(A,v):null}_setRequiredUniforms(A){for(const k of this._uniforms)this[k.propertyKey]=this._hydrateUniformGroup(A,k)}_hydrateUniformGroup(A,k){const v=new k.typeCtor;for(const B of v._uniforms??[]){const z=new B.typeCtor,E=`u_${k.propertyKey}_${B.propertyKey}`,K=z.type,I=[k.propertyKey,B.propertyKey].join(".");if("type"in B.typeCtor&&"array"===B.typeCtor.type){const D=z;A.push({shaderModulePath:I,uniformName:E,uniformType:K,uniformArrayLength:D.size,uniformArrayElementType:D.elementType.type,
uniformHydrated:z})}else A.push({shaderModulePath:I,uniformName:E,uniformType:K,uniformHydrated:z});v[B.propertyKey]=z}return v}_hydrateVertexInput(A){var k=this.vertexInput.inputCtor;const v=k.locations.reduce((B,z)=>!1===A[z.propertyKey]?B:{...B,[z.propertyKey]:new z.typeCtor},{});for(const {propertyKey:B,typeCtor:z}of k.builtins)k=new z,v[B]=k;return v}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((A,k)=>({...A,[k.propertyKey]:new k.typeCtor}),
{})}_injectPackPrecisionFactor(A,k){const v={};for(const B in A){const z=A[B],E=k[B];if(E){if("float"!==z.type&&"vec2"!==z.type&&"vec3"!==z.type&&"vec4"!==z.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${z.type}`);v[B]=z.divide(new b.Float(E))}else v[B]=z}return v}_injectComputePackPrecisionFactor(A,k){const v={},B=new Map;for(var z in this.computeAttributes)for(var E of this.computeAttributes[z]??[])B.set(E,z);for(const K in A)if(z=A[K],E=B.get(K))if(E=k[E]){if("float"!==
z.type&&"vec2"!==z.type&&"vec3"!==z.type&&"vec4"!==z.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${z.type}`);v[K]=z.divide(new b.Float(E))}else v[K]=z;return v}_hydrateFragmentInput(A){const k={};for(const v in A)k[v]=A[v];for(const {propertyKey:v,typeCtor:B}of e.builtins)A=new B,k[v]=A;return k}_getVertexInputBuiltins(){const A=this.vertexInput.inputCtor,k=new Map;for(const {builtin:v,propertyKey:B}of A.builtins)k.set(B,v);return k}_getFragmentInputBuiltins(A){A=
A.constructor;const k=new Map;for(const v of A.builtins??[])k.set(v.propertyKey,v.builtin);return k}_createShaderBuilder(A,k){const v=new m.ShaderBuilder2D;this._insertDebugInfo(v);A.insertVertexShader(v);k.insertFragmentShader(v);return v}_insertDebugInfo(A){A.vertex.code.add("// DEFINES: ");A.vertex.code.add("// --------------------------------------------------------- ");for(const k of this._defines)this[k.propertyKey]?A.vertex.code.add(`//   ${k.propertyKey}: true`):A.vertex.code.add(`//   ${k.propertyKey}: false`);
A.vertex.code.add("");A.vertex.code.add("// OPTIONS: ");A.vertex.code.add("// --------------------------------------------------------- ");for(const k of this._options)this[k.propertyKey]?A.vertex.code.add(`//   ${k.propertyKey}: true`):A.vertex.code.add(`//   ${k.propertyKey}: false`)}}a.ComputeVertexInput=l;a.FragmentInput=e;a.FragmentOutput=u;a.GraphShaderModule=y;a.UniformGroup=x;a.VertexInput=t;a.builtin=r;a.define=(A,k)=>{d(A,"defines",{propertyKey:k})};a.input=A=>(k,v,B)=>{d(k,"inputs",{inputCtor:A,
propertyKey:v,parameterIndex:B})};a.location=function(A,k){return(v,B)=>{d(v,"locations",{typeCtor:k,propertyKey:B,parameterIndex:null,index:A})}};a.option=A=>(k,v)=>{d(k,"options",{typeCtor:A,propertyKey:v})};a.transformFeedback=function(A){return(k,v)=>{d(k,"transformFeedbackBindings",{propertyKey:v,parameterIndex:null,index:A})}};a.uniform=A=>(k,v)=>{d(k,"uniforms",{typeCtor:A,propertyKey:v})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/ShaderBuilder2D":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../3d/webgl-engine/core/shaderTechnique/BindType ../../../../3d/webgl-engine/lib/Util".split(" "),
function(a,q,r,g,p,m){function b(u=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${u?"out vec4 fragColor;":""}\n`}class f{constructor(){this._includedModules=new Map}include(u,x){this._includedModules.has(u)?this._includedModules.get(u):(this._includedModules.set(u,x),u(this.builder,x))}}class c extends f{constructor(){super(...arguments);this.vertex=new d;this.fragment=
new d;this.attributes=new w;this.varyings=new t;this.extensions=new l;this.constants=new e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(u,x=!0){const y=this.extensions.generateSource(u),A=this.attributes.generateSource(u),k=this.varyings.generateSource(u);var v="vertex"===u?this.vertex:this.fragment;const B=v.uniforms.generateSource(),z=v.code.generateSource();u="vertex"===u?"precision highp float;\nprecision highp sampler2D;":b(x);v=this.constants.generateSource().concat(v.constants.generateSource());
return`${x?"#version 300 es":""}\n${y.join("\n")}\n${u}\n${v.join("\n")}\n${B.join("\n")}\n${A.join("\n")}\n${k.join("\n")}\n${z.join("\n")}`}generateBindPass(u){const x=new Map;this.vertex.uniforms.entries.forEach(k=>{const v=k.bind[p.BindType.Pass];v&&x.set(k.name,v)});this.fragment.uniforms.entries.forEach(k=>{const v=k.bind[p.BindType.Pass];v&&x.set(k.name,v)});const y=Array.from(x.values()),A=y.length;return(k,v)=>{for(let B=0;B<A;++B)y[B](u,k,v)}}generateBindDraw(u){const x=new Map;this.vertex.uniforms.entries.forEach(k=>
{const v=k.bind[p.BindType.Draw];v&&x.set(k.name,v)});this.fragment.uniforms.entries.forEach(k=>{const v=k.bind[p.BindType.Draw];v&&x.set(k.name,v)});const y=Array.from(x.values()),A=y.length;return(k,v,B)=>{for(let z=0;z<A;++z)y[z](u,k,v,B)}}}class h{constructor(){this._entries=new Map}add(...u){for(const x of u)this._add(x)}get(u){return this._entries.get(u)}_add(u){if(null==u)g.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(u.name)&&!this._entries.get(u.name).equals(u))throw new q(`Duplicate uniform name ${u.name} for different uniform type`);this._entries.set(u.name,u)}}generateSource(){return Array.from(this._entries.values()).map(u=>null!=u.arraySize?`uniform ${u.type} ${u.name}[${u.arraySize}];`:`uniform ${u.type} ${u.name};`)}get entries(){return Array.from(this._entries.values())}}class n{constructor(){this._entries=[]}add(u){this._entries.push(u)}generateSource(){return this._entries}}
class d extends f{constructor(){super(...arguments);this.uniforms=new h;this.code=new n;this.constants=new e}get builder(){return this}}class w{constructor(){this._entries=[]}add(u,x){this._entries.push([u,x])}generateSource(u){return"fragment"===u?[]:this._entries.map(x=>`in ${x[1]} ${x[0]};`)}}class t{constructor(){this._entries=new Map}add(u,x){this._entries.has(u)&&m.assert(this._entries.get(u)===x);this._entries.set(u,x)}generateSource(u){const x=[];this._entries.forEach((y,A)=>x.push("vertex"===
u?`out ${y} ${A};`:`in ${y} ${A};`));return x}}class l{constructor(){this._entries=new Set}add(u){this._entries.add(u)}generateSource(u){const x="vertex"===u?l.ALLOWLIST_VERTEX:l.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(y=>x.includes(y)).map(y=>`#extension ${y} : enable`)}}l.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];l.ALLOWLIST_VERTEX=[];class e{constructor(){this._entries=new Set}add(u,x,y){let A="ERROR_CONSTRUCTOR_STRING";switch(x){case "float":A=
e._numberToFloatStr(y);break;case "int":A=e._numberToIntStr(y);break;case "bool":A=y.toString();break;case "vec2":A=`vec2(${e._numberToFloatStr(y[0])},                            ${e._numberToFloatStr(y[1])})`;break;case "vec3":A=`vec3(${e._numberToFloatStr(y[0])},                            ${e._numberToFloatStr(y[1])},                            ${e._numberToFloatStr(y[2])})`;break;case "vec4":A=`vec4(${e._numberToFloatStr(y[0])},                            ${e._numberToFloatStr(y[1])},                            ${e._numberToFloatStr(y[2])},                            ${e._numberToFloatStr(y[3])})`;
break;case "ivec2":A=`ivec2(${e._numberToIntStr(y[0])},                             ${e._numberToIntStr(y[1])})`;break;case "ivec3":A=`ivec3(${e._numberToIntStr(y[0])},                             ${e._numberToIntStr(y[1])},                             ${e._numberToIntStr(y[2])})`;break;case "ivec4":A=`ivec4(${e._numberToIntStr(y[0])},                             ${e._numberToIntStr(y[1])},                             ${e._numberToIntStr(y[2])},                             ${e._numberToIntStr(y[3])})`;
break;case "mat2":case "mat3":case "mat4":A=`${x}(${Array.prototype.map.call(y,k=>e._numberToFloatStr(k)).join(", ")})`}this._entries.add(`const ${x} ${u} = ${A};`);return this}static _numberToIntStr(u){return u.toFixed(0)}static _numberToFloatStr(u){return Number.isInteger(u)?u.toFixed(1):u.toString()}generateSource(){return Array.from(this._entries)}}a.Code=n;a.Includes=f;a.ShaderBuilder2D=c;a.Stage=d;a.Uniforms=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var q=a.BindType||(a.BindType={});q[q.Pass=0]="Pass";q[q.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,q,r,g){function p(f,c){if(!f)throw c=c||"Assertion",new b(`${c} at ${Error(c).stack}`);}const m=g.create();class b{constructor(f){this.message=
f}toString(){return`AssertException: ${this.message}`}}a.assert=p;a.isTranslationMatrix=function(f){return 1===f[0]&&0===f[1]&&0===f[2]&&0===f[3]&&0===f[4]&&1===f[5]&&0===f[6]&&0===f[7]&&0===f[8]&&0===f[9]&&1===f[10]&&0===f[11]&&1===f[15]};a.logWithBase=function(f,c){return Math.log(f)/Math.log(c)};a.project=function(f,c,h,n,d){m[0]=f[0];m[1]=f[1];m[2]=f[2];m[3]=1;r.transformMat4(m,m,c);2<d.length&&(d[2]=-m[2]);r.transformMat4(m,m,h);p(0!==m[3]);d[0]=m[0]/m[3];d[1]=m[1]/m[3];d[2]=m[2]/m[3];d[0]=(.5*
d[0]+.5)*n[2]+n[0];d[1]=(.5*d[1]+.5)*n[3]+n[1]};a.rayBoxTest=function(f,c,h,n){let d,w=(h[0]-f[0])/c[0],t=(n[0]-f[0])/c[0];w>t&&(d=w,w=t,t=d);let l=(h[1]-f[1])/c[1],e=(n[1]-f[1])/c[1];l>e&&(d=l,l=e,e=d);if(w>e||l>t)return!1;l>w&&(w=l);e<t&&(t=e);h=(h[2]-f[2])/c[2];f=(n[2]-f[2])/c[2];h>f&&(d=h,h=f,f=d);if(w>f||h>t)return!1;f<t&&(t=f);return 0>t?!1:!0};a.rayRay2D=function(f,c,h,n,d,w=q.create()){const t=(n[d]-h[d])*(c[0]-f[0])-(n[0]-h[0])*(c[d]-f[d]);if(0===t)return!1;h=((n[0]-h[0])*(f[d]-h[d])-(n[d]-
h[d])*(f[0]-h[0]))/t;w[0]=f[0]+h*(c[0]-f[0]);w[1]=f[d]+h*(c[d]-f[d]);return!0};a.setMatrixTranslation3=function(f,c,h,n){f[12]=c;f[13]=h;f[14]=n};a.verify=function(f,c){f||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(a){function q(){return[0,0]}function r(e){return[e[0],e[1]]}function g(e,u){return[e,u]}function p(e,u=[0,0]){const x=
Math.min(2,e.length);for(let y=0;y<x;++y)u[y]=e[y];return u}function m(e,u){return new Float64Array(e,u,2)}function b(){return[0,0]}function f(){return[1,1]}function c(){return[1,0]}function h(){return[0,1]}const n=[0,0],d=[1,1],w=[1,0],t=[0,1],l=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:w,UNIT_Y:t,ZEROS:n,clone:r,create:q,createView:m,fromArray:p,fromValues:g,ones:f,unitX:c,unitY:h,zeros:b},Symbol.toStringTag,{value:"Module"}));a.ONES=d;a.UNIT_X=w;a.UNIT_Y=t;a.ZEROS=n;a.clone=
r;a.create=q;a.createView=m;a.fromArray=p;a.fromValues=g;a.ones=f;a.unitX=c;a.unitY=h;a.vec2f64=l;a.zeros=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(a,q,r){function g(O){switch(O.type){case "uint":return fa;case "uvec2":return a.Vec2;case "uvec3":return a.Vec3;case "uvec4":return a.Vec4;default:throw Error("Found unexpected type");
}}function p(O){switch(O.type){case "float":return a.UInt;case "vec2":return a.UVec2;case "vec3":return a.UVec3;case "vec4":return a.UVec4;default:throw Error("Found unexpected type");}}function m(O){switch(O.type){case "int":return fa;case "ivec2":return a.Vec2;case "ivec3":return a.Vec3;case "ivec4":return a.Vec4;default:throw Error("Found unexpected type");}}function b(O){switch(O.type){case "float":return qa;case "vec2":return a.IVec2;case "vec3":return a.IVec3;case "vec4":return a.IVec4;default:throw Error("Found unexpected type");
}}function f(O){switch(O.type){case "bool":case "float":case "int":case "uint":return ka;case "bvec2":case "vec2":case "ivec2":case "uvec2":return a.BVec2;case "bvec3":case "vec3":case "ivec3":case "uvec3":return a.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return a.BVec4;default:throw Error("Unable to handle type");}}function c(O){switch(O.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;
case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return O.size*c(O.elementType)}}function h(O){const da=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const la of da)if(la.includes(O))return la.map(pa=>ia[pa]);throw Error("Unable to find type family");}function n(O){return new Proxy(O,{get(da,la){if("constructor"===la)return new Proxy(da.constructor,
{construct(pa,za,Aa){pa=new pa(...za);return n(pa)}});if(la in da)return da[la];if("string"===typeof la)return da=h(O.type),l(O,la,da[la.length-1])}})}function d(O){return new Proxy(O,{construct(da,la,pa){da=new da(...la);return n(da)}})}function w(O){return new Proxy(O,{get(da,la){if(la in da)return da[la];if("string"===typeof la&&(da=parseInt(la,10),!isNaN(da)))return l(O,`[${da}]`,O.elementType.constructor)}})}function t(O,da){return"number"===typeof O?new da(O):O}function l(O,da,la){O=new la(new r.ShaderPropertyAccessNode(da,
O,la));O.isImplicit=!0;return O}function e(O,da,la,pa=null){if(pa){const za=new pa;O=new pa(new r.ShaderFunctionNode(O,[da,la],!0,!1,za));O.isImplicit=!0;return O}if("float"===da.type||"int"===da.type||("mat2"===da.type||"mat3"===da.type||"mat4"===da.type)&&"float"!==la.type)return O=new la.constructor(new r.ShaderFunctionNode(O,[da,la],!0,!1,la.constructor)),O.isImplicit=!0,O;O=new da.constructor(new r.ShaderFunctionNode(O,[da,la],!0,!1,da.constructor));O.isImplicit=!0;return O}function u(O,da,la=
da.constructor){O=new la(new r.ShaderFunctionNode(O,[da],!1,!1,la));O.isImplicit=!0;return O}function x(O,da,la,pa=da.constructor){O=new pa(new r.ShaderFunctionNode(O,[da,la],!1,!1,pa));O.isImplicit=!0;return O}function y(O,da,la,pa,za=da.constructor){O=new za(new r.ShaderFunctionNode(O,[da,la,pa],!1,!1,za));O.isImplicit=!0;return O}function A(O){return E(O,na(-1))}function k(O,da,la,pa){return new da(new r.ShaderBlockNode(O,da,la,pa))}function v(O,da,la=0,pa=O.size){la=(new qa(la)).setMutable().setDebugName("FindIndexIterator");
O=O.get(la);da=da(O).setDebugName("FindIndexPredicate");return k({iter:la},qa,da,({out:za,iter:Aa,subgraph:Ba})=>`\n${za} = -1;\n\nfor (; ${Aa} < ${pa}; ${Aa}++) {\n\n${Ba.body}\n\n  if (${Ba.varName}) {\n    ${za} = ${Aa};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}function B(O,da,la=0,pa=O.size){return k({array:O},qa,null,({out:za,array:Aa})=>`\n${za} = -1;\nfor (int i = ${la}; i < ${pa}; i++) {\n  bool condition;\n  ${da({array:Aa,i:"i",out:"condition"})}\n  if (condition) {\n    ${za} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}
function z(O,da,la){da="function"===typeof da?da():da;la="function"===typeof la?la():la;O=new da.constructor(new r.ShaderConditionNode(O,da,la));O.isImplicit=!0;return O}function E(O,da){return e("*",O,da)}function K(O,da){return e("/",O,da)}function I(O,da){return e("+",O,da)}function D(O,da){return e("-",O,da)}function G(...O){return 1>=O.length?O[0]:O.slice(1).reduce((da,la)=>C(da,la),O[0])}function C(O,da){return e("||",O,da,ka)}function F(...O){return 1>=O.length?O[0]:O.slice(1).reduce((da,la)=>
e("\x26\x26",da,la,ka),O[0])}function J(O){return u("all",O,ka)}function T(O){return u("any",O,ka)}function S(O){return u("cos",O)}function ba(O){return u("sin",O)}var M,U,R,Z,ea,ma,V,aa,ja,oa,wa,ta,va,xa;class L extends Error{}a.FixedArray=M=class extends r.ShaderPrimitiveNode{constructor(O,da){super();this.elementType=O;this.size=da;this.children=[];this.type="array"}clone(){const O=new M(this.elementType,this.size);super.cloneInto(O);return O}get(O){return"number"===typeof O?(O=new qa(O),O.isImplicit=
!0,l(this,O,this.elementType.constructor)):l(this,O,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(O,da,la){return v(this,O,da,la)}glslFindIndex(O,da,la){return B(this,O,da,la)}static ofType(O,da){return new Proxy(M,{construct(la,pa){return new M(new O,da)}})}};a.FixedArray.type="array";a.FixedArray=M=q.__decorate([function(O){return new Proxy(O,{construct(da,la,pa){da=new da(...la);return w(da)}})}],a.FixedArray);class P extends r.ShaderPrimitiveNode{constructor(){super(...arguments);
this.type="sampler2D";this.children=[]}clone(){const O=new P;O.children=this.children.map(r.cloneShaderNode);super.cloneInto(O);return O}}P.type="sampler2D";class fa extends r.ShaderPrimitiveNode{constructor(O){super();this.type="float";this.children=[O]}clone(){const O=new fa(r.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}multiply(O){return"number"===typeof O?E(this,t(O,fa)):E(this,O)}divide(O){return"number"===typeof O?K(this,t(O,fa)):K(this,O)}add(O){return"number"===typeof O?
I(this,t(O,fa)):I(this,O)}subtract(O){return"number"===typeof O?D(this,t(O,fa)):D(this,O)}}fa.type="float";a.Vec2=U=class extends r.ShaderPrimitiveNode{constructor(O,da){super();this.type="vec2";this.children=[O,da].filter(la=>null!=la)}clone(){const O=new U(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}get 0(){return l(this,"[0]",fa)}get 1(){return l(this,"[1]",fa)}get 2(){throw new L;}get 3(){throw new L;}multiply(O){return E(this,"number"===
typeof O?t(O,fa):O)}divide(O){return K(this,"number"===typeof O?t(O,fa):O)}add(O){return I(this,"number"===typeof O?t(O,fa):O)}subtract(O){return D(this,"number"===typeof O?t(O,fa):O)}};a.Vec2.type="vec2";a.Vec2=U=q.__decorate([d],a.Vec2);a.Vec3=R=class extends r.ShaderPrimitiveNode{constructor(O,da,la){super();this.type="vec3";this.children=[O,da,la].filter(pa=>null!=pa)}get 0(){return l(this,"[0]",fa)}get 1(){return l(this,"[1]",fa)}get 2(){return l(this,"[2]",fa)}get 3(){throw new L;}clone(){const O=
new R(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}multiply(O){return E(this,"number"===typeof O?t(O,fa):O)}divide(O){return K(this,"number"===typeof O?t(O,fa):O)}add(O){return I(this,"number"===typeof O?t(O,fa):O)}subtract(O){return D(this,"number"===typeof O?t(O,fa):O)}};a.Vec3.type="vec3";a.Vec3=R=q.__decorate([d],a.Vec3);a.Vec4=Z=class extends r.ShaderPrimitiveNode{constructor(O,da,la,pa){super();this.type=
"vec4";this.children=[O,da,la,pa].filter(za=>null!=za)}clone(){const O=new Z(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}get 0(){return l(this,"[0]",fa)}get 1(){return l(this,"[1]",fa)}get 2(){return l(this,"[2]",fa)}get 3(){return l(this,"[3]",fa)}multiply(O){return E(this,"number"===typeof O?t(O,fa):O)}divide(O){return K(this,"number"===typeof O?t(O,fa):O)}add(O){return I(this,
"number"===typeof O?t(O,fa):O)}subtract(O){return D(this,"number"===typeof O?t(O,fa):O)}};a.Vec4.type="vec4";a.Vec4=Z=q.__decorate([d],a.Vec4);a.UInt=ea=class extends r.ShaderPrimitiveNode{constructor(O){super();this.type="uint";this.children=[O]}clone(){const O=new ea(r.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}};a.UInt.type="uint";a.UInt=ea=q.__decorate([d],a.UInt);a.UVec2=ma=class extends r.ShaderPrimitiveNode{constructor(O,da){super();this.type="uvec2";this.children=[O,da].filter(la=>
null!=la)}clone(){const O=new ma(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};a.UVec2.type="uvec2";a.UVec2=ma=q.__decorate([d],a.UVec2);a.UVec3=V=class extends r.ShaderPrimitiveNode{constructor(O,da,la){super();this.type="uvec3";this.children=[O,da,la].filter(pa=>null!=pa)}clone(){const O=new V(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};a.UVec3.type=
"uvec3";a.UVec3=V=q.__decorate([d],a.UVec3);a.UVec4=aa=class extends r.ShaderPrimitiveNode{constructor(O,da,la,pa){super();this.type="uvec4";this.children=[O,da,la,pa].filter(za=>null!=za)}clone(){const O=new aa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};a.UVec4.type="uvec4";a.UVec4=aa=q.__decorate([d],a.UVec4);class ka extends r.ShaderPrimitiveNode{constructor(O){super();
this.type="bool";this.children=[O]}and(O){return F(this,O)}or(O){return G(this,O)}clone(){const O=new ka(r.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}}ka.type="bool";a.BVec2=ja=class extends r.ShaderPrimitiveNode{constructor(O,da){super();this.type="bvec2";this.children=[O,da].filter(la=>null!=la)}all(){return J(this)}any(){return T(this)}clone(){const O=new ja(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};a.BVec2.type="bvec2";
a.BVec2=ja=q.__decorate([d],a.BVec2);a.BVec3=oa=class extends r.ShaderPrimitiveNode{constructor(O,da,la){super();this.type="bvec3";this.children=[O,da,la].filter(pa=>null!=pa)}all(){return J(this)}any(){return T(this)}clone(){const O=new oa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};a.BVec3.type="bvec3";a.BVec3=oa=q.__decorate([d],a.BVec3);a.BVec4=wa=class extends r.ShaderPrimitiveNode{constructor(O,da,
la,pa){super();this.type="bvec4";this.children=[O,da,la,pa].filter(za=>null!=za)}all(){return J(this)}any(){return T(this)}clone(){const O=new wa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};a.BVec4.type="bvec4";a.BVec4=wa=q.__decorate([d],a.BVec4);class qa extends r.ShaderPrimitiveNode{constructor(O){super();this.type="int";this.children=[O]}multiply(O){return E(this,
t(O,qa))}add(O){return I(this,t(O,qa))}subtract(O){return D(this,t(O,qa))}divide(O){return K(this,t(O,qa))}clone(){const O=new qa(r.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}}qa.type="int";a.IVec2=ta=class extends r.ShaderPrimitiveNode{constructor(O,da){super();this.type="ivec2";this.children=[O,da].filter(la=>null!=la)}clone(){const O=new ta(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};a.IVec2.type="ivec2";a.IVec2=ta=
q.__decorate([d],a.IVec2);a.IVec3=va=class extends r.ShaderPrimitiveNode{constructor(O,da,la){super();this.type="ivec3";this.children=[O,da,la].filter(pa=>null!=pa)}clone(){const O=new va(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};a.IVec3.type="ivec3";a.IVec3=va=q.__decorate([d],a.IVec3);a.IVec4=xa=class extends r.ShaderPrimitiveNode{constructor(O,da,la,pa){super();this.type="ivec4";this.children=[O,da,
la,pa].filter(za=>null!=za)}clone(){const O=new xa(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};a.IVec4.type="ivec4";a.IVec4=xa=q.__decorate([d],a.IVec4);class Q extends r.ShaderPrimitiveNode{constructor(O,da,la,pa){super();this.type="mat2";this.children=[O,da,la,pa]}clone(){const O=new Q(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),
r.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}}Q.type="mat2";class X extends r.ShaderPrimitiveNode{static identity(){return new X(1,0,0,0,1,0,0,0,1)}static fromRotation(O){const da=ba(O);O=S(O);return new X(O,da,0,A(da),O,0,0,0,1)}constructor(O,da,la,pa,za,Aa,Ba,Ga,Da){super();this.type="mat3";this.children=[O,da,la,pa,za,Aa,Ba,Ga,Da]}add(O){return I(this,O)}multiply(O){return E(this,O)}clone(){const O=new X(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),
r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]),r.cloneShaderNode(this.children[4]),r.cloneShaderNode(this.children[5]),r.cloneShaderNode(this.children[6]),r.cloneShaderNode(this.children[7]),r.cloneShaderNode(this.children[8]));super.cloneInto(O);return O}}X.type="mat3";class Y extends r.ShaderPrimitiveNode{static identity(){return new Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(O,da,la,pa,za,Aa,Ba,Ga,Da,Ha,Fa,Ea,Ka,Ta,Xa,Sa){super();this.type="mat4";this.children=[O,da,
la,pa,za,Aa,Ba,Ga,Da,Ha,Fa,Ea,Ka,Ta,Xa,Sa]}static fromColumns(O,da,la,pa){return new Y(O.x,O.y,O.z,O.w,da.x,da.y,da.z,da.w,la.x,la.y,la.z,la.w,pa.x,pa.y,pa.z,pa.w)}multiply(O){return E(this,O)}clone(){const O=new Y(r.cloneShaderNode(this.children[0]),r.cloneShaderNode(this.children[1]),r.cloneShaderNode(this.children[2]),r.cloneShaderNode(this.children[3]),r.cloneShaderNode(this.children[4]),r.cloneShaderNode(this.children[5]),r.cloneShaderNode(this.children[6]),r.cloneShaderNode(this.children[7]),
r.cloneShaderNode(this.children[8]),r.cloneShaderNode(this.children[9]),r.cloneShaderNode(this.children[10]),r.cloneShaderNode(this.children[11]),r.cloneShaderNode(this.children[12]),r.cloneShaderNode(this.children[13]),r.cloneShaderNode(this.children[14]),r.cloneShaderNode(this.children[15]));super.cloneInto(O);return O}}Y.type="mat4";const ia={float:fa,vec2:a.Vec2,vec3:a.Vec3,vec4:a.Vec4,int:qa,ivec2:a.IVec2,ivec3:a.IVec3,ivec4:a.IVec4,uint:a.UInt,uvec2:a.UVec2,uvec3:a.UVec3,uvec4:a.UVec4,bool:ka,
bvec2:a.BVec2,bvec3:a.BVec3,bvec4:a.BVec4},na=(...O)=>new fa(...O);a.Bool=ka;a.Float=fa;a.Int=qa;a.Mat2=Q;a.Mat3=X;a.Mat4=Y;a.Sampler2D=P;a._or=C;a.abs=function(O){return u("abs",O)};a.acos=function(O){return u("acos",O)};a.acosh=function(O){return u("acosh",O)};a.add=I;a.all=J;a.and=F;a.any=T;a.asin=function(O){return u("asin",O)};a.asinh=function(O){return u("asinh",O)};a.atan=function(O,da){return null==da?u("atan",O):x("atan",O,da,O.constructor)};a.atanh=function(O){return u("atanh",O)};a.bitAnd=
function(O,da){return e("\x26",O,da)};a.bitOr=function(O,da){return e("|",O,da)};a.bitRShift=function(O,da){return e("\x3e\x3e",O,da)};a.bitShift=function(O,da){return e("\x3c\x3c",O,da)};a.bitXor=function(O,da){return e("^",O,da)};a.block=k;a.ceil=function(O){return u("ceil",O)};a.clamp=function(O,da,la){return y("clamp",O,da,la,O.constructor)};a.cond=function(...O){var da=O.map(([pa,za])=>"function"===typeof za?[pa,za()]:[pa,za]);O=da[0][1].constructor;const la=da.findIndex(pa=>!0===pa[0]);if(-1===
la)throw Error("A cond must have a fallthrough case with `true`/; ");da=da.slice(0,la).reduceRight((pa,za)=>z(za[0],za[1],pa),da[la][1]);O=new O(da);O.isImplicit=!0;return O};a.cos=S;a.cosh=function(O){return u("cosh",O)};a.cross=function(O,da){return x("cross",O,da,O.constructor)};a.dFdx=function(O){return u("dFdX",O)};a.dFdy=function(O){return u("dFdY",O)};a.definePropertyAccess=l;a.degrees=function(O){return u("degrees",O)};a.determinant=function(O){return u("determinant",O,fa)};a.distance=function(O,
da){return x("distance",O,da,fa)};a.divide=K;a.dot=function(O,da){return x("dot",O,da,fa)};a.equal=function(O,da){return e("\x3d\x3d",O,da,ka)};a.equalComponent=function(O,da){return x("equal",O,da,f(O))};a.exp=function(O){return u("exp",O)};a.exp2=function(O){return u("exp2",O)};a.faceforward=function(O,da,la){return y("faceforward",O,da,la)};a.findIndex=v;a.float=na;a.floatBitsToInt=function(O){return u("floatBitsToInt",O,b(O))};a.floatBitsToUint=function(O){return u("floatBitsToUint",O,p(O))};
a.floor=function(O){return u("floor",O)};a.fract=function(O){return u("fract",O)};a.fwidth=function(O){return u("fwidth",O)};a.getTypeElementLengthForType=c;a.glslFindIndex=B;a.greaterThan=function(O,da){return e("\x3e",O,da,ka)};a.greaterThanComponent=function(O,da){return x("greaterThan",O,da,f(O))};a.greaterThanEqual=function(O,da){return e("\x3e\x3d",O,da,ka)};a.greaterThanEqualComponent=function(O,da){return x("greaterThanEqual",O,da,f(O))};a.ifElse=z;a.int=(...O)=>new qa(...O);a.intBitsToFloat=
function(O){return u("intBitsToFloat",O,m(O))};a.inverse=function(O){return u("inverse",O,fa)};a.inversesqrt=function(O){return u("inversesqrt",O)};a.isinf=function(O){return u("isinf",O,f(O))};a.isnan=function(O){return u("isnan",O,f(O))};a.length=function(O){return u("length",O,fa)};a.lessThan=function(O,da){return e("\x3c",O,da,ka)};a.lessThanComponent=function(O,da){return x("lessThan",O,da,f(O))};a.lessThanEqual=function(O,da){return e("\x3c\x3d",O,da,ka)};a.lessThanEqualComponent=function(O,
da){return x("lessThanEqual",O,da,f(O))};a.log=function(O){return u("log",O)};a.log2=function(O){return u("log2",O)};a.mat2=(...O)=>new Q(...O);a.mat3=(...O)=>new X(...O);a.mat4=(...O)=>new Y(...O);a.matrixCompMult=function(O,da){return x("matrixCompMult",O,da)};a.max=function(O,da){return x("max",O,da)};a.min=function(O,da){return x("min",O,da)};a.mix=function(O,da,la){return y("mix",O,da,la)};a.mod=function(O,da){return x("mod",O,da)};a.modf=function(O,da){throw Error("modf not implemented");};
a.multiply=E;a.namedScope=function(O,da){O="function"===typeof O?O():O;da=new O.constructor((new r.ShaderScopeNode(O)).setDebugName(da));da.isImplicit=!0;return da};a.negate=A;a.normalize=function(O){return u("normalize",O)};a.not=function(O){return"bool"===O.type?u("!",O):u("not",O)};a.notEqual=function(O,da){return e("!\x3d",O,da,ka)};a.notEqualComponent=function(O,da){return x("notEqual",O,da,f(O))};a.or=G;a.outerProduct=function(O,da){throw Error("Impl type?");};a.packHalf2x16=function(O){return u("packHalf2x16",
O,a.UInt)};a.packSnorm2x16=function(O){return u("packSnorm2x16",O,a.UInt)};a.packUnorm2x16=function(O){return u("packUnorm2x16",O,a.UInt)};a.pow=function(O,da){return x("pow",O,da)};a.radians=function(O){return u("radians",O)};a.reflect=function(O,da){return x("reflect",O,da)};a.refract=function(O,da,la){return y("refract",O,da,la)};a.round=function(O){return u("round",O)};a.roundEven=function(O){return u("roundEven",O)};a.sign=function(O){return u("sign",O)};a.sin=ba;a.sinh=function(O){return u("sinh",
O)};a.smoothstep=function(O,da,la){return y("smoothstep",O,da,la)};a.sqrt=function(O){return u("sqrt",O)};a.step=function(O,da){return x("step",O,da,da.constructor)};a.subtract=D;a.tan=function(O){return u("tan",O)};a.tanh=function(O){return u("tanh",O)};a.texelFetch=function(O,da,la){throw Error("Impl type");};a.texelFetchOffset=function(O,da,la,pa){throw Error("Impl type");};a.texture=function(O,da,la){throw Error("Impl type");};a.texture2D=function(O,da){return x("texture2D",O,da,a.Vec4)};a.textureGrad=
function(O,da,la,pa){throw Error("Impl type");};a.textureGradOffset=function(O,da,la,pa,za){throw Error("Impl type");};a.textureLod=function(O,da,la){throw Error("Impl type");};a.textureLodOffset=function(O,da,la,pa){throw Error("Impl type");};a.textureOffset=function(O,da,la,pa){throw Error("Impl type");};a.textureProj=function(O,da,la){throw Error("Impl type");};a.textureProjGrad=function(O,da,la,pa){throw Error("Impl type");};a.textureProjGradOffset=function(O,da,la,pa,za){throw Error("Impl type");
};a.textureProjLod=function(O,da,la){throw Error("Impl type");};a.textureProjLodOffset=function(O,da,la,pa){throw Error("Impl type");};a.textureProjOffset=function(O,da,la,pa){throw Error("Impl type");};a.textureSize=function(O,da){throw Error("Impl type");};a.transformFloatToInt=b;a.transformFloatToUInt=p;a.transformIntToFloat=m;a.transformTypeToBooleanType=f;a.transformUIntToFloat=g;a.transpose=function(O){return u("transpose",O)};a.trunc=function(O){return u("trunc",O)};a.uintBitsToFloat=function(O){return u("uintBitsToFloat",
O,g(O))};a.unpackHalf2x16=function(O){return u("unpackHalf2x16",O,a.Vec2)};a.unpackSnorm2x16=function(O){return u("unpackSnorm2x16",O,a.Vec2)};a.unpackUnorm2x16=function(O){return u("unpackUnorm2x16",O,a.Vec2)};a.vec2=(...O)=>new a.Vec2(...O);a.vec3=(...O)=>new a.Vec3(...O);a.vec4=(...O)=>new a.Vec4(...O);a.when=function(O,da){O=new da.constructor(new r.ShaderConditionNode(O,da,null));O.isImplicit=!0;return O};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],
function(a){function q(d){return d.split(" ").map((w,t)=>0<t?w.charAt(0).toUpperCase()+w.slice(1):w).join("")}function r(d){return"object"===typeof d?d.clone():d}class g{constructor(){this.uid=g.NodeCount++;this._debugName=null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(d){this._debugName=d=q(d);this.isImplicit&&this.children[0]instanceof g&&this.children[0].setDebugName(d);return this}get debugInfo(){return{name:this._debugName??
""}}cloneInto(d){d._debugName=this._debugName;d._isMutable=this._isMutable;d.isImplicit=this.isImplicit;d.uid=this.uid}}g.NodeCount=0;class p extends g{constructor(){super(...arguments);this.shaderType="primitive-node"}}class m extends g{constructor(d){super();this.child=d;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const d=new m(r(this.child));this.cloneInto(d);return d}}class b extends g{constructor(d){super();this.text=d;this.shaderType="text-node"}get children(){return[]}clone(){const d=
new b(this.text);this.cloneInto(d);return d}}class f extends g{constructor(d,w,t){super();this.property=d;this.target=w;this.returnType=t;this.shaderType="property-access-node"}get children(){const d=[this.target];"string"!==typeof this.property&&d.push(this.property);return d}clone(){const d=new f(this.property,r(this.target),this.returnType);this.cloneInto(d);return d}}class c extends g{constructor(d,w,t){super();this.condition=d;this.ifTrue=w;this.ifFalse=t;this.shaderType="condition-node"}get children(){return[this.condition,
this.ifTrue,this.ifFalse]}clone(){var d=r(this.ifTrue);const w=this.ifFalse?r(this.ifFalse):null;d=new c(this.condition,d,w);this.cloneInto(d);return d}}class h extends g{constructor(d,w,t,l){super();this.captureList=d;this.returnType=w;this.generator=l;this.shaderType="block-node";t&&(this.subgraph=new m(t))}get children(){return Object.keys(this.captureList).map(d=>this.captureList[d]).concat(this.subgraph??[])}clone(){var d={};for(const w in this.captureList)d[w]=r(this.captureList[w]);d=new h(d,
this.returnType,this.subgraph?r(this.subgraph.child):this.subgraph,this.generator);this.cloneInto(d);return d}}class n extends g{constructor(d,w,t,l,e,u=!1){super();this.token=d;this._children=w;this.isInfix=t;this.isPropertyAccess=l;this.returnType=e;this.isTernary=u;this.shaderType="function-node"}get children(){return this._children}clone(){const d=new n(this.token,this._children.map(r),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);this.cloneInto(d);return d}}a.ShaderBlockNode=
h;a.ShaderConditionNode=c;a.ShaderFunctionNode=n;a.ShaderNode=g;a.ShaderPrimitiveNode=p;a.ShaderPropertyAccessNode=f;a.ShaderScopeNode=m;a.ShaderTextNode=b;a.cloneShaderNode=r;a.setReachableUids=function(d,w){const t=[];for(t.push(w);t.length;)if(w=t.pop(),"object"===typeof w&&!d.has(w.uid)){d.add(w.uid);for(const l of w.children)t.push(l)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],
function(a){function q(g,p,m){p=p.split("\n");for(const b of p)if(b.trim().length){p="";const f=m??"000";null!=m&&(p+=`/*id:${f}*/   `);g.body+=p.padEnd(14);g.body+=" ".repeat(g.indent)+b+"\n"}}class r{write(g){for(const p of g.rootOutputNodes())g.shouldPruneOutputNode(p)||(p.variableName=this._write(g,p.node));return g}_createVarName(g,p){let m="";"boolean"!==typeof p&&"number"!==typeof p&&p.debugInfo.name&&(m=`${p.debugInfo.name}_`);return`${m}v${g.varCount++}`}_write(g,p,m=!1){if("number"===typeof p||
"boolean"===typeof p)return p.toString();let b=g.getEmit(p);if(b)return b;switch(p.shaderType){case "scope-node":b=this._writeScopeNode(g,p);break;case "primitive-node":b=this._writePrimitiveNode(g,p,m);break;case "function-node":b=this._writeFunctionNode(g,p);break;case "property-access-node":b=this._writePropertyAccessNode(g,p);break;case "text-node":b=p.text;break;case "block-node":b=this._writeBlockNode(g,p);break;case "condition-node":b=this._writeConditionNode(g,p)}g.setEmit(p,b);return b}_writeScopeNode(g,
p){var m=new p.child.constructor;m.setDebugName(p.debugInfo.name);m=this._write(g,m,!0);q(g,`{ /*ScopeStart: ${p.uid} ${p.debugInfo.name}*/`);g.indent+=2;const b=this._write(g,p.child);q(g,`${m} = ${b};`);g.indent-=2;q(g,`} /*ScopeEnd: ${p.uid} ${p.debugInfo.name}*/`);return m}_writeConditionNode(g,p){var m=new p.ifTrue.constructor;m=this._write(g,m,!0);var b=this._write(g,p.condition);q(g,`if (${b}) {`);g.indent+=2;b=g.createSubgraphContext();const f=this._write(b,p.ifTrue);g.body+=b.body;f&&q(g,
`${m} = ${f};`);g.indent-=2;q(g,"}");p.ifFalse&&(q(g,"else {"),g.indent+=2,b=g.createSubgraphContext(),p=this._write(b,p.ifFalse),g.body+=b.body,p&&q(g,`${m} = ${p};`),g.indent-=2,q(g,"}"));return m}_writeBlockNode(g,p){const {captureList:m,generator:b,returnType:f}=p;var c={};for(var h in m)if(m[h]){var n=this._write(g,m[h]);c[h]=n}h=new f;h=this._write(g,h,!0);c.out=h;p.subgraph&&(n=g.createSubgraphContext(),p=this._write(n,p.subgraph.child),c.subgraph={varName:p,body:n.body});c=b(c);q(g,"{\n");
g.indent+=2;q(g,c);g.indent-=2;q(g,"}\n");return h}_writePropertyAccessNode(g,p){const m=this._write(g,p.target);return"string"===typeof p.property&&p.property.includes("[")?`${m}${p.property}`:"string"!==typeof p.property?(g=this._write(g,p.property),`${m}[${g}]`):`${m}.${p.property}`}_writeFunctionNode(g,p){const m=p.returnType.type;if(p.isInfix){const [c,h]=p.children.map(n=>this._write(g,n));var b=this._createVarName(g,p);q(g,`${m.padEnd(5)} ${b} = ${c} ${p.token} ${h};`,p.uid);return b}b=p.children.map(c=>
this._write(g,c)).join(", ");const f=this._createVarName(g,p);q(g,`${m.padEnd(5)} ${f} = ${p.token}(${b});`,p.uid);return f}_writePrimitiveNode(g,p,m=!1){var b=g.getInput(p);if(b)return b.isUsed=!0,b.variableName;b=1===p.children.length&&p.children[0]?.type===p.type;if(p.isImplicit||b)return this._write(g,p.children[0]);b=this._createVarName(g,p);if(m)return q(g,`${p.type.padEnd(5)} ${b};`,p.uid),b;if((m=!p.debugInfo.name&&!p.isMutable)&&"float"===p.type&&"number"===typeof p.children[0])return Number.isInteger(p.children[0])?
p.children[0].toFixed(1):p.children[0].toString();if(m&&"int"===p.type&&"number"===typeof p.children[0]&&Number.isInteger(p.children[0]))return p.children[0].toString();const f=p.children.map(c=>this._write(g,c)).join(", ");if("array"===p.type)return q(g,`${p.type.padEnd(5)} ${b} = [${f}];`,p.uid),b;if(m)return`${p.type}(${f})`;q(g,`${p.type.padEnd(5)} ${b} = ${p.type}(${f});`,p.uid);return b}}a.GlslShaderWriter=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports",
"./ShaderGraphNode"],function(a,q){class r{constructor(m,b,f){this.variableName=m;this.variableInputType=b;this.node=f;this.type="shader-input";this.isUsed=!1}clone(){return new r(this.variableName,this.variableInputType,q.cloneShaderNode(this.node))}}class g{constructor(m,b,f){this.outVariableName=m;this.outVariableType=b;this.node=f;this.type="shader-output"}clone(){const m=new g(this.outVariableName,this.outVariableType,q.cloneShaderNode(this.node));m.variableName=this.variableName;return m}}class p{static createVertex(m,
b,f,c,h,n){const d=[];for(const w in m){const t=m[w],l=f.get(w);l?d.push(new r(l,"builtin",t)):d.push(new r("a_"+w,"attribute",t))}for(const w of c)d.push(new r(w.uniformName,"uniform",w.uniformHydrated));m=[];for(const w in b)f=b[w],"glPosition"===w?m.push(new g("gl_Position","builtin",f)):"glPointSize"===w?m.push(new g("gl_PointSize","builtin",f)):m.push(new g("v_"+w,"varying",f));return new p(d,m,h,n)}static createFragment(m,b,f,c,h,n){const d=[];h=Array.from(h.rootOutputNodes());for(var w in m){const l=
m[w];var t=f.get(w);t?d.push(new r(t,"builtin",l)):(t=h.find(e=>e.node===l))&&d.push(new r(t.outVariableName,t.outVariableType,l))}for(const l of c)d.push(new r(l.uniformName,"uniform",l.uniformHydrated));m=[];for(const l in b)if(c=b[l],w=f.get(l),"discard"===l)m.push(new g(null,"discard",c));else if(w)m.push(new g(w,"builtin",c));else throw Error(`Member ${l} in shader fragment output shoule be tagged as builtin`);return new p(d,m,n)}constructor(m,b,f,c){this.type="shader-graph-context";this.indent=
0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;this._nodeEmitMap=new Map;for(const h of m)this._inputShaderTypesByNodeUid.set(h.node.uid,h);this._outputShaderTypes=b;this._transformFeedbackBindings=f;this._transformFeedbackNames=new Set(f.map(h=>"v_"+h.propertyKey));this._usedInFragmentShader=c}shouldPruneOutputNode(m){return!this._usedInFragmentShader||"builtin"===m.outVariableType||this._transformFeedbackNames.has(m.outVariableName)?!1:!this._usedInFragmentShader.has(m.node.uid)}setEmit(m,
b){this._nodeEmitMap.set(m.uid,b)}getEmit(m){return this._nodeEmitMap.get(m.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(m){return this._inputShaderTypesByNodeUid.get(m.uid)}*rootOutputNodes(){for(const m of this._outputShaderTypes)yield m}*nodes(){const m=[];for(var b of this._outputShaderTypes.values())m.push(b.node);for(;m.length;)b=m.pop(),"number"!==typeof b&&"boolean"!==typeof b&&m.push(...b.children.filter(Boolean)),yield b}*nodesOfTypeOrFunction(){for(const m of this.nodes())"number"!==
typeof m&&"boolean"!==typeof m&&(yield m)}createSubgraphContext(){const m=this.clone();m.body="";m.indent=this.indent+2;m._nodeEmitMap=new Map(this._nodeEmitMap);return m}clone(){const m=new p([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);m._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;m.indent=this.indent;m.body=this.body;m.varCount=this.varCount;m._nodeEmitMap=this._nodeEmitMap;return m}insertVertexShader(m){m.vertex.code.add("");this._insertInputs(m,
"vertex");m.vertex.code.add("");m.vertex.code.add("// OUTPUTS: ");m.vertex.code.add("// --------------------------------------------------------- ");for(const b of this.rootOutputNodes()){const f="builtin"===b.outVariableType;this.shouldPruneOutputNode(b)||(f?m.vertex.code.add(`// ${b.outVariableType.padEnd(7)} ${b.node.type.padEnd(9)} ${b.outVariableName};`):m.vertex.code.add(`${b.outVariableType.padEnd(10)} ${b.node.type.padEnd(9)} ${b.outVariableName};`))}m.vertex.code.add("");m.vertex.code.add("void main() {");
m.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const b of this.rootOutputNodes())this.shouldPruneOutputNode(b)||m.vertex.code.add("  "+`${b.outVariableName} = ${b.variableName};`);m.vertex.code.add("}")}insertFragmentShader(m){this._insertInputs(m,"fragment");m.fragment.code.add("");m.fragment.code.add("void main() {");m.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const b of this.rootOutputNodes())"discard"===b.outVariableType?(m.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),
m.fragment.code.add("  "+`if (${b.variableName}) {`),m.fragment.code.add("    discard;"),m.fragment.code.add("  }"),m.fragment.code.add("  ")):m.fragment.code.add("  "+`${b.outVariableName} = ${b.variableName};`);m.fragment.code.add("}")}_insertInputs(m,b){m[b].code.add("// INPUTS: ");m[b].code.add("// --------------------------------------------------------- ");for(const f of this.inputs())f.isUsed&&"builtin"!==f.variableInputType&&("array"===f.node.type?m[b].code.add(`${f.variableInputType.padEnd(10)} ${f.node.elementType.type.padEnd(9)} ${f.variableName}[${f.node.size}];`):
m[b].code.add(`${f.variableInputType.padEnd(10)} ${f.node.type.padEnd(9)} ${f.variableName};`))}}a.ShaderGraphContext=p;a.ShaderInput=r;a.ShaderOutput=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/RandomLCG ../../../../../../core/has ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../Utils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w){function t(e,u,x){const y=u.length;y!==x&&(e=new q("Invalid Uniform",`Invalid length, expected ${x} but got ${y}`,{uniformName:e,values:u}),r.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(e))}class l{constructor(e,u,x,y,A,k){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=e;this.fragmentShader=u;this._locations=x;this._locationInfo=y;this._uniformBindings=A;this._transformFeedbackBindings=k}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(const e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){const u=this._uniforms;if(!this._program){var x=new Map;for(const [A,k]of this._locations)x.set(A,k);var y=[];for(const A of this._transformFeedbackBindings??[]){const {index:k,propertyKey:v}=A;y[k]=`v_${v}`}this._program=
new h.Program(e,this.vertexShader,this.fragmentShader,x,new Map,y)}x=this._program;e.useProgram(x);for(const A of this._uniformBindings){const {shaderModulePath:k,uniformName:v,uniformType:B,uniformArrayLength:z}=A;y=g.getDeepValue(k,u);if(null==y){if("sampler2D"===B)continue;throw Error(`Failed to find uniform value for ${k}`);}switch("array"===B?A.uniformArrayElementType:B){case "sampler2D":const {unit:E,texture:K}=y;x.setUniform1i(v,E);"type"in K?e.bindTexture(K,E):(y=w.createTexture(e,K.descriptor,
K.data),e.bindTexture(y,E));break;case "int":if(!z){x.setUniform1i(v,y);break}t(A.uniformName,y,z);x.setUniform1iv(v,y);break;case "float":if(!z){x.setUniform1f(v,y);break}t(A.uniformName,y,z);x.setUniform1fv(v,y);break;case "vec2":if(!z){x.setUniform2f(v,y[0],y[1]);break}t(A.uniformName,y,z);x.setUniform2fv(v,y.flat());break;case "vec3":if(!z){x.setUniform3f(v,y[0],y[1],y[2]);break}t(A.uniformName,y,z);x.setUniform3fv(v,y.flat());break;case "vec4":if(!z){x.setUniform4f(v,y[0],y[1],y[2],y[3]);break}t(A.uniformName,
y,z);x.setUniform4fv(v,y.flat());break;case "mat3":x.setUniformMatrix3fv(v,y.flat());break;case "mat4":x.setUniformMatrix4fv(v,y.flat());break;default:throw Error(`Unable to set uniform for type ${B}`);}}}}a.TypedShaderProgram=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(a,q,r,g,p){function m(n,d,w){n=n.gl;const t=n.createShader(d);n.shaderSource(t,
w);n.compileShader(t);r.webglValidateShadersEnabled()&&!n.getShaderParameter(t,n.COMPILE_STATUS)&&(console.error("Compile error in ".concat(d===g.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(n.getShaderInfoLog(t)),console.error(b(w)));return t}function b(n){let d=2;return n.replaceAll("\n",()=>{var w=d++;w=1E3<=w?w.toString():("  "+w).slice(-3);return"\n"+w+":"})}function f(n,d,w){const t=n.get(d);if(!t)return n.set(d,Array.from(w)),!0;const l=w.length;if(t.length!==l)return n.set(d,
Array.from(w)),!0;for(n=0;n<l;++n)if(d=w[n],t[n]!==d){for(t[n]=d;n<l;++n)t[n]=w[n];return!0}return!1}class c{constructor(n,d,w,t,l=new Map,e=[]){this._context=n;this._locations=t;this._uniformBlockBindings=l;this._transformFeedbackVaryings=e;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=
new Map;this._nameToUniformMatrix4=new Map;n||console.error("RenderingContext isn't initialized!");0===d.length&&console.error("Shaders source should not be empty!");d=p.transpileShader(d,g.ShaderType.VERTEX_SHADER);w=p.transpileShader(w,g.ShaderType.FRAGMENT_SHADER);this._vShader=m(this._context,g.ShaderType.VERTEX_SHADER,d);this._fShader=m(this._context,g.ShaderType.FRAGMENT_SHADER,w);h.enabled&&(this._linesOfCode=d.match(/\n/g).length+w.match(/\n/g).length+2,this._context.instanceCounter.increment(g.ResourceType.LinesOfCode,
this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(g.ResourceType.Shader,this);r.webglValidateShadersEnabled()&&(this.vertexShader=d,this.fragmentShader=w);this.usedMemory=d.length+w.length;const u=this._context.gl,x=u.createProgram();u.attachShader(x,this._vShader);u.attachShader(x,this._fShader);this._locations.forEach((y,A)=>u.bindAttribLocation(x,y,A));this._transformFeedbackVaryings?.length&&u.transformFeedbackVaryings(x,
this._transformFeedbackVaryings,u.SEPARATE_ATTRIBS);u.linkProgram(x);r.webglValidateShadersEnabled()&&!u.getProgramParameter(x,u.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${u.getProgramParameter(x,u.VALIDATE_STATUS)}`+`, gl error ${u.getError()}`+`, vertex: ${u.getShaderParameter(this._vShader,u.COMPILE_STATUS)}`+`, fragment: ${u.getShaderParameter(this._fShader,u.COMPILE_STATUS)}`+`, info log: ${u.getProgramInfoLog(x)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);
for(const [y,A]of this._uniformBlockBindings)n=u.getUniformBlockIndex(x,y),4294967295>n&&u.uniformBlockBinding(x,n,A);this._glName=x;this._context.instanceCounter.increment(g.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const n=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==n||null==this.glName?
this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,n.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var n=this._context.gl,d=this._context.instanceCounter;this._nameToUniformLocation.forEach(w=>w&&d.decrement(g.ResourceType.Uniform,w));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(d.decrement(g.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),n.deleteShader(this._vShader),this._vShader=null,d.decrement(g.ResourceType.Shader,
this));this._fShader&&(n.deleteShader(this._fShader),this._fShader=null);this._glName&&(n.deleteProgram(this._glName),this._glName=null,d.decrement(g.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(n){var d=this._nameToUniformLocation.get(n);return void 0!==d?d:this.glName?(d=this._context.gl.getUniformLocation(this.glName,n),this._nameToUniformLocation.set(n,d),d&&this._context.instanceCounter.increment(g.ResourceType.Uniform,d),d):null}hasUniform(n){return null!=this._getUniformLocation(n)}setUniform1i(n,
d){const w=this._nameToUniform1.get(n);if(void 0===w||d!==w)this._context.gl.uniform1i(this._getUniformLocation(n),d),this._nameToUniform1.set(n,d)}setUniform1iv(n,d){f(this._nameToUniform1v,n,d)&&this._context.gl.uniform1iv(this._getUniformLocation(n),d)}setUniform2iv(n,d){f(this._nameToUniform2,n,d)&&this._context.gl.uniform2iv(this._getUniformLocation(n),d)}setUniform3iv(n,d){f(this._nameToUniform3,n,d)&&this._context.gl.uniform3iv(this._getUniformLocation(n),d)}setUniform4iv(n,d){f(this._nameToUniform4,
n,d)&&this._context.gl.uniform4iv(this._getUniformLocation(n),d)}setUniform1f(n,d){const w=this._nameToUniform1.get(n);if(void 0===w||d!==w)this._context.gl.uniform1f(this._getUniformLocation(n),d),this._nameToUniform1.set(n,d)}setUniform1fv(n,d){f(this._nameToUniform1v,n,d)&&this._context.gl.uniform1fv(this._getUniformLocation(n),d)}setUniform2f(n,d,w){const t=this._nameToUniform2.get(n);if(void 0===t)this._context.gl.uniform2f(this._getUniformLocation(n),d,w),this._nameToUniform2.set(n,[d,w]);else if(d!==
t[0]||w!==t[1])this._context.gl.uniform2f(this._getUniformLocation(n),d,w),t[0]=d,t[1]=w}setUniform2fv(n,d){f(this._nameToUniform2,n,d)&&this._context.gl.uniform2fv(this._getUniformLocation(n),d)}setUniform3f(n,d,w,t){const l=this._nameToUniform3.get(n);if(void 0===l)this._context.gl.uniform3f(this._getUniformLocation(n),d,w,t),this._nameToUniform3.set(n,[d,w,t]);else if(d!==l[0]||w!==l[1]||t!==l[2])this._context.gl.uniform3f(this._getUniformLocation(n),d,w,t),l[0]=d,l[1]=w,l[2]=t}setUniform3fv(n,
d){const w=this._getUniformLocation(n);null!=w&&f(this._nameToUniform3,n,d)&&this._context.gl.uniform3fv(w,d)}setUniform4f(n,d,w,t,l){const e=this._nameToUniform4.get(n);if(void 0===e)this._context.gl.uniform4f(this._getUniformLocation(n),d,w,t,l),this._nameToUniform4.set(n,[d,w,t,l]);else if(void 0===e||d!==e[0]||w!==e[1]||t!==e[2]||l!==e[3])this._context.gl.uniform4f(this._getUniformLocation(n),d,w,t,l),e[0]=d,e[1]=w,e[2]=t,e[3]=l}setUniform4fv(n,d){const w=this._getUniformLocation(n);null!=w&&
f(this._nameToUniform4,n,d)&&this._context.gl.uniform4fv(w,d)}setUniformMatrix3fv(n,d,w=!1){const t=this._getUniformLocation(n);null!=t&&f(this._nameToUniformMatrix3,n,d)&&this._context.gl.uniformMatrix3fv(t,w,d)}setUniformMatrix4fv(n,d,w=!1){const t=this._getUniformLocation(n);null!=t&&f(this._nameToUniformMatrix4,n,d)&&this._context.gl.uniformMatrix4fv(t,w,d)}stop(){}}const h={enabled:!1};a.Program=c;a.test=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),
function(a,q,r,g,p,m){function b(){function u(R){R.length&&C.push({type:t[K],data:R,position:T,line:F,column:J})}function x(){G=G.length?[]:G;if("/"===D&&"*"===I)return T=E+z-1,K=0,D=I,z+1;if("/"===D&&"/"===I)return T=E+z-1,K=1,D=I,z+1;if("#"===I)return K=2,T=E+z,z;if(/\s/.test(I))return K=9,T=E+z,z;S=/\d/.test(I);ba=/[^\w_]/.test(I);T=E+z;K=S?4:ba?3:9999;return z}function y(){if(("\r"===I||"\n"===I)&&"\\"!==D)return u(G.join("")),K=999,z;G.push(I);D=I;return z+1}function A(){if("."===D&&/\d/.test(I))return K=
5,z;if("/"===D&&"*"===I)return K=0,z;if("/"===D&&"/"===I)return K=1,z;if("."===I&&G.length){for(;k(G););K=5;return z}if(";"===I||")"===I||"("===I){if(G.length)for(;k(G););u(I);K=999;return z+1}var R=2===G.length&&"\x3d"!==I;if(/[\w_\d\s]/.test(I)||R){for(;k(G););K=999;return z}G.push(I);D=I;return z+1}function k(R){var Z=0;do{var ea=m.operators.indexOf(R.slice(0,R.length+Z).join(""));var ma=m.operators[ea];if(-1===ea){if(0<Z--+R.length)continue;ma=R.slice(0,1).join("")}u(ma);T+=ma.length;G=G.slice(ma.length);
return G.length}while(1)}function v(){if("."===I||/[eE]/.test(I))return G.push(I),K=5,D=I,z+1;if("x"===I&&1===G.length&&"0"===G[0])return K=11,G.push(I),D=I,z+1;if(/[^\d]/.test(I))return u(G.join("")),K=999,z;G.push(I);D=I;return z+1}function B(){"f"===I&&(G.push(I),D=I,z+=1);if(/[eE]/.test(I)||"-"===I&&/[eE]/.test(D))return G.push(I),D=I,z+1;if(/[^\d]/.test(I))return u(G.join("")),K=999,z;G.push(I);D=I;return z+1}var z=0,E=0,K=999,I,D,G=[],C=[],F=1,J=0,T=0,S=!1,ba=!1,M="",U;return function(R){C=
[];if(null!==R){R=R.replace?R.replace(/\r\n/g,"\n"):R;z=0;M+=R;for(U=M.length;I=M[z],z<U;){R=z;switch(K){case 0:"/"===I&&"*"===D?(G.push(I),u(G.join("")),K=999):(G.push(I),D=I);z+=1;break;case 1:z=y();break;case 2:z=y();break;case 3:z=A();break;case 4:z=v();break;case 11:/[^a-fA-F0-9]/.test(I)?(u(G.join("")),K=999):(G.push(I),D=I,z+=1);break;case 5:z=B();break;case 9999:if(/[^\d\w_]/.test(I)){var Z=G.join("");K=-1<m.literals.indexOf(Z)?8:-1<m.builtins.indexOf(Z)?7:6;u(G.join(""));K=999}else G.push(I),
D=I,z+=1;break;case 9:/[^\s]/g.test(I)?(u(G.join("")),K=999):(G.push(I),D=I,z+=1);break;case 999:z=x()}if(R!==z)switch(M[R]){case "\n":J=0;++F;break;default:++J}}E+=z;M=M.slice(z);return C}G.length&&u(G.join(""));K=10;u("(eof)");return C}}function f(u){return u.map(x=>"eof"!==x.type?x.data:"").join("")}function c(u,x="100",y="300 es"){const A=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const k of u)if("preprocessor"===k.type){const v=A.exec(k.data);if(v){u=v[1].replaceAll(/\s{2,}/g," ");if(u===
y)return u;if(u===x)return k.data="#version "+y,x;throw Error("unknown glsl version: "+u);}}u.splice(0,0,{type:"preprocessor",data:"#version "+y},{type:"whitespace",data:"\n"});return null}function h(u,x,y,A){A=A||y;for(const k of u)if("ident"===k.type&&k.data===y)return A in x?x[A]++:x[A]=0,h(u,x,A+"_"+x[A],A);return y}function n(u,x,y="afterVersion"){const A={data:"\n",type:"whitespace"},k=B=>B<u.length?/[^\r\n]$/.test(u[B].data):!1;let v=function(B){let z=-1,E=0,K=-1;for(let D=0;D<B.length;D++){var I=
B[D];"preprocessor"===I.type&&(/#(if|ifdef|ifndef)\s+.+/.test(I.data)?++E:/#endif\s*.*/.test(I.data)&&--E);("afterVersion"===y||"afterPrecision"===y)&&"preprocessor"===I.type&&I.data.startsWith("#version")&&(K=Math.max(K,D));if("afterPrecision"===y&&"keyword"===I.type&&"precision"===I.data){a:{for(I=D;I<B.length;I++){const G=B[I];if("operator"===G.type&&";"===G.data)break a}I=null}if(null===I)throw Error("precision statement not followed by any semicolons!");K=Math.max(K,I)}z<K&&0===E&&(z=D)}return z+
1}(u);k(v-1)&&u.splice(v++,0,A);for(const B of x)u.splice(v++,0,B);k(v-1)&&k(v)&&u.splice(v,0,A)}function d(u,x,y,A="lowp"){n(u,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:x},{type:"operator",data:";"}],"afterPrecision")}function w(u,x,y,A,k="lowp"){n(u,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",
data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:A.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:k},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:x},{type:"operator",data:";"}],"afterPrecision")}var t="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");
const l=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),e=new Map;a.transpileShader=function(u,x){if(u.startsWith("#version 300"))return u;var y=p.shaderTranspiler.enableCache?e.get(u):null;if(null!=y)return y;y=b();var A=[];A=A.concat(y(u));y=A=A.concat(y(null));if("300 es"===c(y,"100","300 es"))return u;var k=A=null;const v={},B={};for(let I=0;I<y.length;++I){const D=y[I];switch(D.type){case "keyword":x===r.ShaderType.VERTEX_SHADER&&
"attribute"===D.data?D.data="in":"varying"===D.data&&(D.data=x===r.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(D.data.trim())&&(D.data=D.data.replaceAll(/(2D|Cube|EXT)/g,""));x===r.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===D.data&&(A||(A=h(y,v,"fragColor"),d(y,A,"vec4")),D.data=A);if(x===r.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===D.data){var z=void 0;let G=void 0;var E=y,K=I+1;let C=-1;for(;K<E.length;K++){const F=E[K];if("operator"===
F.type&&("["===F.data&&(G=K),"]"===F.data)){z=K;break}"integer"===F.type&&(C=parseInt(F.data,10))}G&&z&&E.splice(G,z-G+1);E=C;z=h(y,v,"fragData");w(y,z,"vec4",E,"mediump");D.data=z}else x===r.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===D.data&&(k||=h(y,v,"gl_FragDepth"),D.data=k);break;case "ident":if(g.includes(D.data)){if(E=x===r.ShaderType.VERTEX_SHADER)a:{for(E=I-1;0<=E;E--)if(z=y[E],"whitespace"!==z.type&&"block-comment"!==z.type)if("keyword"===z.type){if("attribute"===z.data||"in"===z.data){E=
!0;break a}}else break;E=!1}if(E)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");D.data in B||(B[D.data]=h(y,v,D.data));D.data=B[D.data]}}}for(x=y.length-1;0<=x;--x)A=y[x],"preprocessor"===A.type&&(k=A.data.match(/#extension\s+(.*):/),k?.[1]&&l.has(k[1].trim())&&(k=y[x+1],y.splice(x,k&&"whitespace"===k.type?2:1)),k=A.data.match(/#ifdef\s+(.*)/),k?.[1]&&l.has(k[1].trim())&&(A.data="#if 1"),k=A.data.match(/#ifndef\s+(.*)/),k?.[1]&&l.has(k[1].trim())&&(A.data=
"#if 0"));y=f(y);p.shaderTranspiler.enableCache&&e.set(u,y);return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../highlightReasons ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(a,q,r,g,p,m,b,f,c,h){class n extends g.VertexInput{}
q.__decorate([g.location(0,p.Vec3)],n.prototype,"id",void 0);q.__decorate([g.location(1,p.Float)],n.prototype,"bitset",void 0);q.__decorate([g.location(2,p.Vec2)],n.prototype,"pos",void 0);class d extends g.ComputeVertexInput{}q.__decorate([g.location(14,p.Vec2)],d.prototype,"nextPos1",void 0);q.__decorate([g.location(15,p.Vec2)],d.prototype,"nextPos2",void 0);class w extends g.FragmentInput{}class t extends g.GraphShaderModule{clip(l,e){let u=new p.Float(0);l=this.storage.getFilterFlags(l);u=u.add(p.float(2).multiply(p.float(1).subtract(c.getFilterBit(l,
0))));this.inside?u=u.add(p.float(2).multiply(p.float(1).subtract(c.getFilterBit(l,1)))):this.outside?u=u.add(p.float(2).multiply(c.getFilterBit(l,1))):this.highlight&&(u=u.add(p.float(2).multiply(p.float(1).subtract(this._checkHighlight(l)))));null!=e&&(l=(new p.Float(1)).subtract(p.step(e.x,this.view.currentZoom)),e=p.step(e.y,this.view.currentZoom),u=u.add((new p.Float(2)).multiply(l.add(e))));return u}getFragmentOutput(l,e,u=new p.Float(1/255)){const x=new g.FragmentOutput;x.glFragColor=this._maybeWriteHittest(e)??
this._maybeHighlight(l,u)??l;return x}_maybeHighlight(l,e){return this.highlight?new p.Vec4(l.rgb,p.step(e,l.a)):null}_checkHighlight(l){let e=this._checkHighlightBit(l,0);for(let u=1;u<r.highlightReasons.length;u++)e=e.add(this._checkHighlightBit(l,u));return p.step(new p.Float(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(l,e){return c.getHighlightBit(l,e).multiply(c.getBit(this.highlight.activeReasons,e))}maybeRunHittest(l,e,u){if(null==this.hittestRequest)return null;e=this.hittest(l,
e,u);e=p.ifElse(p.greaterThan(e,this.hittestRequest.distance),new p.Float(2),new p.Float(0));u=this.storage.getAttributeDataCoords(l.id);u=c.uvToClip(u);e=e.add(this.clip(l.id,l.zoomRange));l=new p.Vec4(new p.Float(1/255),0,0,0);return{glPointSize:new p.Float(1),glPosition:new p.Vec4(u,e,1),color:l}}_maybeWriteHittest(l){return null!=this.hittestRequest?l.color:null}}q.__decorate([g.define],t.prototype,"inside",void 0);q.__decorate([g.define],t.prototype,"outside",void 0);q.__decorate([g.option(b.ShaderHighlight)],
t.prototype,"highlight",void 0);q.__decorate([g.uniform(m.EntityStorage)],t.prototype,"storage",void 0);q.__decorate([g.uniform(h.ViewInfo)],t.prototype,"view",void 0);q.__decorate([g.option(f.ShaderHittest)],t.prototype,"hittestRequest",void 0);a.AFeatureShader=t;a.BaseHittestVertexInput=d;a.FeatureFragmentInput=w;a.FeatureVertexInput=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/highlightReasons":function(){define(["exports","../../../Color","../support/HighlightOptions"],
function(a,q,r){const g={selection(m){return new r({color:new q([m.color.r/2,m.color.g/2,m.color.b/2,m.color.a])})},highlight(m){return m},popup(m){return new r({color:new q([m.color.g,m.color.b,m.color.r,m.color.a])})}},p=Object.keys(g);a.getHighlightBits=function(m){if(!m)return 0;let b=1;for(const f in g){if(f===m)break;b<<=1}return b};a.highlightConfigurator=g;a.highlightReasons=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f){r=class extends r{constructor(){super(...arguments);this.color=new q([0,255,255]);this.haloOpacity=1;this.fillOpacity=.25;this.multiHighlightEnabled=!1}equals(c){return this.color.equals(c.color)&&(this.haloColor||this.color).equals(c.haloColor||c.color)&&this.haloOpacity===c.haloOpacity&&this.fillOpacity===c.fillOpacity&&this.multiHighlightEnabled===c.multiHighlightEnabled}};a.__decorate([g.property({type:q})],r.prototype,"color",void 0);a.__decorate([g.property({type:q})],
r.prototype,"haloColor",void 0);a.__decorate([g.property()],r.prototype,"haloOpacity",void 0);a.__decorate([g.property()],r.prototype,"fillOpacity",void 0);a.__decorate([g.property()],r.prototype,"multiHighlightEnabled",void 0);return r=a.__decorate([f.subclass("esri.views.2d.support.HighlightOptions")],r)})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),
function(a,q,r,g,p,m){class b extends g.UniformGroup{getVisualVariableData(f){this._vvData||(f=this.getAttributeDataCoords(f),this._vvData=p.texture2D(this.visualVariableData,f).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(f){if(!this._uv){var c=m.unpackDisplayIdTexel(f);f=this.size;var h=p.int(c.x),n=p.int(c.y).multiply(p.int(256));c=p.int(c.z).multiply(p.int(256)).multiply(p.int(256));n=p.float(h.add(n).add(c));h=p.mod(n,f);n=n.subtract(h).divide(f);this._uv=(new p.Vec2(h,
n)).add(.5).divide(f)}return this._uv}getFilterData(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.filterFlags,f).setDebugName("storage0")}getAnimationData(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.animation,f).setDebugName("storage1")}getVVData(f){return this.getVisualVariableData(f)}getDataDrivenData0(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.dataDriven0,f).setDebugName("storage30")}getDataDrivenData1(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.dataDriven1,
f).setDebugName("storage31")}getDataDrivenData2(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.dataDriven2,f).setDebugName("storage32")}getGPGPUData(f){f=this.getAttributeDataCoords(f);return p.texture2D(this.gpgpu,f).setDebugName("storage4")}getFilterFlags(f){return r("webgl-ignores-sampler-precision")?p.ceil(this.getFilterData(f).x.multiply(p.float(255))):this.getFilterData(f).x.multiply(p.float(255))}getAnimationValue(f){return this.getAnimationData(f).x}getSizeValue(f){return this.getVisualVariableData(f).x}getColorValue(f){return this.getVisualVariableData(f).y}getOpacityValue(f){return this.getVisualVariableData(f).z}getRotationValue(f){return this.getVisualVariableData(f).w}}
q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"filterFlags",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"animation",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"gpgpu",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"visualVariableData",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"dataDriven0",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"dataDriven1",void 0);q.__decorate([g.uniform(p.Sampler2D)],b.prototype,"dataDriven2",void 0);
q.__decorate([g.uniform(p.Float)],b.prototype,"size",void 0);a.EntityStorage=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../../highlightReasons","../../graph/glsl","./constants"],function(a,q,r,g){function p(m,b){b=r.float(2**b);return r.mod(r.floor(m.divide(b)),r.float(2))}a.cross2=function(m,b){return m.x.multiply(b.y).subtract(b.x.multiply(m.y))};a.getBit=p;a.getBitBool=function(m,
b){return r.greaterThan(p(m,b),r.float(.5))};a.getFilterBit=function(m,b){return p(m,b+q.highlightReasons.length)};a.getHighlightBit=function(m,b){return p(m,b)};a.isNan=function(m){return r.equal(m,r.float(g.nanMagicNumber))};a.max4=function(m){return r.max(r.max(r.max(m.x,m.y),m.z),m.w)};a.norm=function(m){return r.divide(m,r.float(255))};a.rand=function(m){const b=r.float(12.9898),f=r.float(78.233),c=r.float(43758.5453);m=r.dot(m,r.vec2(b,f));m=r.mod(m,r.float(3.14));return r.fract(r.sin(m).multiply(c))};
a.rgba2float=function(m){const b=r.vec4(.99609375,255/65536,255/16777216,255/4294967296);return r.dot(m,b)};a.unpackDisplayIdTexel=function(m){const b=p(m.z,7),f=r.float(1).subtract(b),c=m.xyz.subtract(r.vec3(0,0,r.float(128)));return f.multiply(m).add(b.multiply(c))};a.uvToClip=function(m){return m.multiply(2).subtract(1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl"],function(a,q,r,g){class p extends r.UniformGroup{}q.__decorate([r.uniform(g.Float)],p.prototype,"activeReasons",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"highlightAll",void 0);a.ShaderHighlight=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],
function(a,q,r,g){class p extends r.UniformGroup{}q.__decorate([r.uniform(g.Vec2)],p.prototype,"position",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"distance",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"smallSymbolDistance",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"smallSymbolSizeThreshold",void 0);a.ShaderHittest=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,g){class p extends r.UniformGroup{}q.__decorate([r.uniform(g.Mat3)],p.prototype,"displayViewScreenMat3",void 0);q.__decorate([r.uniform(g.Mat3)],p.prototype,"displayViewMat3",void 0);q.__decorate([r.uniform(g.Mat3)],p.prototype,"displayMat3",void 0);q.__decorate([r.uniform(g.Mat3)],p.prototype,"viewMat3",void 0);q.__decorate([r.uniform(g.Mat3)],p.prototype,"tileMat3",void 0);q.__decorate([r.uniform(g.Float)],
p.prototype,"displayZoomFactor",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"requiredZoomFactor",void 0);q.__decorate([r.uniform(g.Vec2)],p.prototype,"tileOffset",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"currentScale",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"currentZoom",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"metersPerSRUnit",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,"rotation",void 0);q.__decorate([r.uniform(g.Float)],p.prototype,
"pixelRatio",void 0);a.ViewInfo=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),function(a,q,r,g,p,m,b,f,c,h){function n(e,u){var x=e.view.requiredZoomFactor,y=new g.Vec2(u.width,u.height),A=y.multiply(u.scale).multiply(x),
k=u.angle.multiply(m.c256ToRad);const v=g.sin(k);k=g.cos(k);var B=u.id;var z=g.equal(h.getBit(u.bitset,m.bitsetFillRandomPatternOffset),g.float(1));B=h.rgba2float(new g.Vec4(B,0));z=g.ifElse(z,g.mat3(k.divide(A.x),v.divide(A.y),0,g.negate(v.divide(A.x)),k.divide(A.y),0,h.rand(g.vec2(B,0)),h.rand(g.vec2(0,B)),1),g.mat3(k.divide(A.x),v.divide(A.y),0,g.negate(v.divide(A.x)),k.divide(A.y),0,0,0,1));y=e.localTileOffset.getPatternOffsetAtTileOrigin(y,v,k);x=x.multiply(u.scale).multiply(u.offset.subtract(y)).divide(A);
A=new g.Vec3(u.pos,1);x=z.multiply(A).xy.subtract(x);A=u.tlbr.divide(e.mosaicInfo.size.xyxy);y=h.getBit(u.bitset,m.bitsetGenericConsiderAlphaOnly);null!=e.visualVariableColor&&(y=g.ifElse(h.isNan(e.storage.getColorValue(u.id)),new g.Float(0),y));return{tileTextureCoord:x,tlbr:A,sampleAlphaOnly:y}}function d(e,u){var x=g.mod(u.tileTextureCoord,new g.Float(1));x=g.mix(u.tlbr.xy,u.tlbr.zw,x);e=g.texture2D(e.mosaicInfo.texture,x);e=g.ifElse(g.greaterThan(u.sampleAlphaOnly,new g.Float(.5)),e.aaaa,e);return u.color.multiply(e)}
class w extends b.FillVertexInput{}q.__decorate([r.location(5,g.Vec4)],w.prototype,"tlbr",void 0);q.__decorate([r.location(6,g.Float)],w.prototype,"width",void 0);q.__decorate([r.location(7,g.Float)],w.prototype,"height",void 0);q.__decorate([r.location(8,g.Vec2)],w.prototype,"offset",void 0);q.__decorate([r.location(9,g.Vec2)],w.prototype,"scale",void 0);q.__decorate([r.location(10,g.Float)],w.prototype,"angle",void 0);class t extends p.FeatureFragmentInput{}class l extends b.FillShader{vertex(e,
u){return{...super.vertex(e,u),...n(this,e)}}fragment(e){const u=d(this,e);return this.getFragmentOutput(u,e,new g.Float(0))}}q.__decorate([r.uniform(c.MosaicInfo)],l.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(f.LocalTileOffset)],l.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(w)),q.__param(1,r.input(p.BaseHittestVertexInput))],l.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(t))],l.prototype,"fragment",null);a.ComplexFillFragmentInput=t;a.ComplexFillShader=
l;a.ComplexFillVertexInput=w;a.getComplexFillFragmentColor=d;a.getComplexFillVertexData=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),function(a,q,r,g,p,m,b,f,c){class h extends p.FeatureVertexInput{}q.__decorate([r.location(3,
g.Vec4)],h.prototype,"color",void 0);q.__decorate([r.location(4,g.Vec2)],h.prototype,"zoomRange",void 0);class n extends p.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(d,w){var t=c.getVisualVariableOpacity(this,d.id);t=c.getVisualVariableColor(this,d.id,d.color).multiply(t);const l=this.view.displayViewScreenMat3.multiply(new g.Vec3(d.pos.xy,1)),e=this.clip(d.id,d.zoomRange);return{glPosition:new g.Vec4(l.xy,e,1),color:t,...this.maybeRunHittest(d,
w,null)}}fragment(d){return this.getFragmentOutput(d.color,d,new g.Float(0))}hittest(d,w){return m.hittestFill(this,d,w)}}q.__decorate([r.option(b.VisualVariableColor)],n.prototype,"visualVariableColor",void 0);q.__decorate([r.option(f.VisualVariableOpacity)],n.prototype,"visualVariableOpacity",void 0);q.__decorate([q.__param(0,r.input(h)),q.__param(1,r.input(p.BaseHittestVertexInput))],n.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(p.FeatureFragmentInput))],n.prototype,"fragment",null);
a.FillShader=n;a.FillVertexInput=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports","../../graph/glsl","./constants","./utils"],function(a,q,r,g){function p(h,n){return q.dot(h,q.normalize(n))}function m(h,n,d){var w=d.subtract(n),t=h.subtract(n);t=p(t,w);w=q.clamp(t.divide(q.length(w)),new q.Float(0),new q.Float(1));return q.distance(h,n.add(w.multiply(d.subtract(n))))}function b(h){h=
q.abs(h);return q.step(h.x.add(h.y).add(h.z),new q.Float(1.05))}function f(h,n,d,w){const t=new q.Mat3(d.x.multiply(w.y).subtract(w.x.multiply(d.y)),w.x.multiply(n.y).subtract(n.x.multiply(w.y)),n.x.multiply(d.y).subtract(d.x.multiply(n.y)),d.y.subtract(w.y),w.y.subtract(n.y),n.y.subtract(d.y),w.x.subtract(d.x),n.x.subtract(w.x),d.x.subtract(n.x));var l=n.x.multiply(d.y.subtract(w.y));const e=d.x.multiply(w.y.subtract(n.y));n=w.x.multiply(n.y.subtract(d.y));l=l.add(e).add(n);return(new q.Float(1)).divide(l).multiply(t.multiply(new q.Vec3(1,
h)))}function c(h,n,d,w){var t=d.subtract(n);const l=w.subtract(n);t=g.cross2(t,l);t=q.and(q.lessThan(t,new q.Float(r.epsilonHitTest)),q.greaterThan(t,new q.Float(-r.epsilonHitTest)));return q.cond([q.and(q.not(t),q.equal(b(f(h.xy,n,d,w)),new q.Float(1))),new q.Float(-1)],[!0,()=>{const e=m(h,n,d),u=m(h,d,w),x=m(h,w,n);return q.min(q.min(e,u),x)}])}a.distPointSegment=m;a.distPointTriangle=c;a.failHittest=function(h){return h.distance.add(1)};a.hittestFill=function(h,n,d){const {viewMat3:w,tileMat3:t}=
h.view,l=w.multiply(t);n=l.multiply(new q.Vec3(n.pos,1));const e=l.multiply(new q.Vec3(d.nextPos1,1));d=l.multiply(new q.Vec3(d.nextPos2,1));return c(h.hittestRequest.position,n.xy,e.xy,d.xy)};a.hittestMarker=function(h,n,d){return q.distance(h,d).subtract(n)};a.inTriangle=b;a.projectScalar=p;a.xyToBarycentric=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,g,p){class m extends r.UniformGroup{getColor(b,f,c){return g.cond([g.or(p.isNan(b),c),f],[g.lessThanEqual(b,this.values.first()),this.colors.first()],[g.greaterThanEqual(b,this.values.last()),this.colors.last()],[!0,()=>{const h=this.values.findIndex(t=>g.greaterThan(t,b));var n=this.values.get(h);const d=h.subtract(1),w=this.values.get(d);n=b.subtract(w).divide(n.subtract(w));return g.mix(this.colors.get(d),this.colors.get(h),
n)}])}}q.__decorate([r.uniform(g.FixedArray.ofType(g.Vec4,8))],m.prototype,"colors",void 0);q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],m.prototype,"values",void 0);a.VisualVariableColor=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,g,p){class m extends r.UniformGroup{getOpacity(b){return g.cond([p.isNan(b),
new g.Float(1)],[g.lessThanEqual(b,this.opacityValues.first()),this.opacities.first()],[g.greaterThanEqual(b,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const f=this.opacityValues.findIndex(d=>g.greaterThan(d,b));var c=this.opacityValues.get(f);const h=f.subtract(1),n=this.opacityValues.get(h);c=b.subtract(n).divide(c.subtract(n));return g.mix(this.opacities.get(h),this.opacities.get(f),c)}])}}q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],m.prototype,"opacities",void 0);
q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],m.prototype,"opacityValues",void 0);a.VisualVariableOpacity=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(a,q){function r(g){return null!=g.visualVariableSizeMinMaxValue||null!=g.visualVariableSizeScaleStops||null!=g.visualVariableSizeStops||null!=g.visualVariableSizeUnitValue}a.getVisualVariableColor=
function(g,p,m,b=new q.Bool(!1)){if(null==g.visualVariableColor)return m;p=g.storage.getColorValue(p);return g.visualVariableColor.getColor(p,m,b)};a.getVisualVariableOpacity=function(g,p){if(null==g.visualVariableOpacity)return new q.Float(1);p=g.storage.getOpacityValue(p);return g.visualVariableOpacity.getOpacity(p)};a.getVisualVariableRotation=function(g,p){if(null==g.visualVariableRotation)return q.Mat3.identity();p=g.storage.getRotationValue(p);return g.visualVariableRotation.getVVRotationMat3(p)};
a.getVisualVariableSize=function(g,p,m){return r(g)?(p=g.storage.getSizeValue(p),g.visualVariableSizeMinMaxValue?.getSize(p,m)??g.visualVariableSizeScaleStops?.getSizeForViewScale(g.view.currentScale)??g.visualVariableSizeStops?.getSize(p,m)??g.visualVariableSizeUnitValue?.getSize(p,m)):m};a.hasVisualVariableSize=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl","./constants"],function(a,q,r,g,p){class m extends r.UniformGroup{getPatternOffsetAtTileOrigin(b,f=new g.Float(0),c=new g.Float(1)){var h=(new g.Vec2(p.maxRepresentableInt)).divide(b);h=b.multiply(g.fract(this.maxIntsToLocalOrigin.multiply(h))).add(this.tileOffsetFromLocalOrigin).subtract((new g.Float(.5)).multiply(b));h=new g.Vec2(h.x.multiply(c).subtract(h.y.multiply(f)),h.x.multiply(f).add(h.y.multiply(c)));return g.mod(h,b)}}q.__decorate([r.uniform(g.Vec2)],
m.prototype,"tileOffsetFromLocalOrigin",void 0);q.__decorate([r.uniform(g.Vec2)],m.prototype,"maxIntsToLocalOrigin",void 0);a.LocalTileOffset=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,g){class p extends r.UniformGroup{}q.__decorate([r.uniform(g.Vec2)],p.prototype,"size",void 0);
q.__decorate([r.uniform(g.Sampler2D)],p.prototype,"texture",void 0);a.MosaicInfo=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t){function l(B){return g.max((new g.Float(m.thinLineWidthFactor)).multiply(g.step(B,new g.Float(m.thinLineHalfWidth))),new g.Float(1))}function e(B,z){const {halfWidth:E,normal:K}=B;B=l(E);const I=g.length(K).multiply(E);return g.clamp(B.multiply(E.subtract(I)).divide(z.add(B).subtract(new g.Float(1))),new g.Float(0),new g.Float(1))}function u(B,z){const {id:E,offset:K,pos:I,normal:D,zoomRange:G}=z,{displayViewScreenMat3:C,displayViewMat3:F}=B.view,J=t.getVisualVariableColor(B,
E,z.color),T=t.getVisualVariableOpacity(B,E);{const {id:U,halfWidth:R,referenceHalfWidth:Z}=z;t.hasVisualVariableSize(B)?(z=(new g.Float(2)).multiply(Z),z=t.getVisualVariableSize(B,U,z),z=(new g.Float(.5)).multiply(R.divide(g.max(Z,new g.Float(m.epsilon)))).multiply(z)):z=R}var S=(new g.Float(.5)).multiply(B.antialiasingControls.antialiasing);S=g.max(z.add(S),new g.Float(.45)).add((new g.Float(.1)).multiply(S));const ba=l(S).multiply(S).multiply(K);var M=F.multiply(new g.Vec3(ba,new g.Float(0)));
M=C.multiply(new g.Vec3(I,new g.Float(1))).add(M);B=(new g.Float(2)).multiply(g.step(z,new g.Float(0))).add(B.clip(E,G));M=new g.Vec4(M.xy,B,1);B=new g.Vec4(M.xy,B,1);return{color:J,opacity:T,halfWidth:S,normal:D,scaledOffset:ba,scaledHalfWidth:z,glPosition:B}}function x(B,z){const {opacity:E,color:K}=B;B=e(B,z);return E.multiply(K).multiply(B)}class y extends p.FeatureVertexInput{}q.__decorate([r.location(3,g.Vec4)],y.prototype,"color",void 0);q.__decorate([r.location(4,g.Vec2)],y.prototype,"offset",
void 0);q.__decorate([r.location(5,g.Vec2)],y.prototype,"normal",void 0);q.__decorate([r.location(6,g.Float)],y.prototype,"halfWidth",void 0);q.__decorate([r.location(7,g.Float)],y.prototype,"referenceHalfWidth",void 0);q.__decorate([r.location(8,g.Vec2)],y.prototype,"zoomRange",void 0);class A extends p.FeatureFragmentInput{}class k extends r.UniformGroup{}q.__decorate([r.uniform(g.Float)],k.prototype,"antialiasing",void 0);q.__decorate([r.uniform(g.Float)],k.prototype,"blur",void 0);class v extends p.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(B,z){const E=u(this,B);return{...E,...this.maybeRunHittest(B,z,E.halfWidth)}}fragment(B){const z=x(B,this.antialiasingControls.blur);return this.getFragmentOutput(z,B)}hittest(B,z,E){const {viewMat3:K,tileMat3:I}=this.view;var D=K.multiply(I);B=D.multiply(new g.Vec3(B.pos,1));const G=D.multiply(new g.Vec3(z.nextPos1,1));z=D.multiply(new g.Vec3(z.nextPos2,1));const {distance:C,smallSymbolDistance:F,smallSymbolSizeThreshold:J}=this.hittestRequest;
D=g.step(E,J.multiply(.5)).multiply(C.subtract(F));const T=this.hittestRequest.position;return g.min(b.distPointSegment(T,B.xy,G.xy),b.distPointSegment(T,B.xy,z.xy)).subtract(E).add(D)}}q.__decorate([r.uniform(k)],v.prototype,"antialiasingControls",void 0);q.__decorate([r.option(f.VisualVariableColor)],v.prototype,"visualVariableColor",void 0);q.__decorate([r.option(c.VisualVariableOpacity)],v.prototype,"visualVariableOpacity",void 0);q.__decorate([r.option(h.VisualVariableSizeMinMaxValue)],v.prototype,
"visualVariableSizeMinMaxValue",void 0);q.__decorate([r.option(n.VisualVariableSizeScaleStops)],v.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([r.option(d.VisualVariableSizeStops)],v.prototype,"visualVariableSizeStops",void 0);q.__decorate([r.option(w.VisualVariableSizeUnitValue)],v.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([q.__param(0,r.input(y)),q.__param(1,r.input(p.BaseHittestVertexInput))],v.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(A))],
v.prototype,"fragment",null);a.AntialiasingControls=k;a.LineFragmentInput=A;a.LineShader=v;a.LineVertexInput=y;a.getLineAntialiasing=e;a.getLineFragmentColor=x;a.getLineVertexData=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,g,p){class m extends r.UniformGroup{getSize(b,
f){const c=this.minMaxValueAndSize.xy,h=this.minMaxValueAndSize.zw;return g.ifElse(p.isNan(b),f,()=>{var n=b.subtract(c.x).divide(c.y.subtract(c.x));n=g.clamp(n,new g.Float(0),new g.Float(1));return h.x.add(n.multiply(h.y.subtract(h.x)))})}}q.__decorate([r.uniform(g.Vec4)],m.prototype,"minMaxValueAndSize",void 0);a.VisualVariableSizeMinMaxValue=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(a,q,r,g){class p extends r.UniformGroup{getSizeForViewScale(m){return g.cond([g.lessThanEqual(m,this.values.first()),this.sizes.first()],[g.greaterThanEqual(m,this.values.last()),this.sizes.last()],[!0,()=>{const b=this.values.findIndex(n=>g.greaterThan(n,m));var f=this.values.get(b);const c=b.subtract(1),h=this.values.get(c);f=m.subtract(h).divide(f.subtract(h));return g.mix(this.sizes.get(c),this.sizes.get(b),
f)}])}}q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],p.prototype,"sizes",void 0);q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],p.prototype,"values",void 0);a.VisualVariableSizeScaleStops=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,g,
p){class m extends r.UniformGroup{getSize(b,f){const c=g.cond([p.isNan(b),f],[g.lessThanEqual(b,this.values.first()),this.sizes.first()],[g.greaterThanEqual(b,this.values.last()),this.sizes.last()],[!0,()=>{const h=this.values.findIndex(t=>g.greaterThan(t,b));var n=this.values.get(h);const d=h.subtract(1),w=this.values.get(d);n=b.subtract(w).divide(n.subtract(w));return g.mix(this.sizes.get(d),this.sizes.get(h),n)}]);return g.ifElse(p.isNan(c),f,c)}}q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,
8))],m.prototype,"sizes",void 0);q.__decorate([r.uniform(g.FixedArray.ofType(g.Float,8))],m.prototype,"values",void 0);a.VisualVariableSizeStops=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(a,q,r,g,p){class m extends r.UniformGroup{getSize(b,f){return g.ifElse(p.isNan(b),
f,b.multiply(this.unitValueToPixelsRatio))}}q.__decorate([r.uniform(g.Float)],m.prototype,"unitValueToPixelsRatio",void 0);a.VisualVariableSizeUnitValue=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e){function u(v,B,z){const {id:E,bitset:K}=B,I=c.getBit(K,m.bitsetTypeFillOutline),D=g.greaterThan(I,new g.Float(.5)),G=f.getLineVertexData(v,B),C=g.ifElse(D,G.halfWidth,new g.Float(0));var F=e.getVisualVariableOpacity(v,E),J=e.getVisualVariableColor(v,E,B.color);F=g.ifElse(D,B.color,J.multiply(F));J=v.view.displayViewScreenMat3.multiply(new g.Vec3(B.pos.xy,1));const T=v.clip(B.id);J=new g.Vec4(J.xy,T,1);J=g.ifElse(D,G.glPosition,J);v=z&&v.maybeRunHittest(B,
z,D);return{isOutline:I,color:F,opacity:new g.Float(1),halfWidth:C,normal:G.normal,glPosition:J,...v}}class x extends p.FeatureVertexInput{}q.__decorate([r.location(3,g.Vec2)],x.prototype,"offset",void 0);q.__decorate([r.location(4,g.Vec4)],x.prototype,"color",void 0);q.__decorate([r.location(5,g.Vec2)],x.prototype,"normal",void 0);q.__decorate([r.location(6,g.Float)],x.prototype,"halfWidth",void 0);q.__decorate([r.location(7,g.Float)],x.prototype,"referenceHalfWidth",void 0);q.__decorate([r.location(8,
g.Vec2)],x.prototype,"zoomRange",void 0);class y extends f.LineFragmentInput{}class A extends p.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}q.__decorate([r.uniform(f.AntialiasingControls)],A.prototype,"antialiasingControls",void 0);q.__decorate([r.option(h.VisualVariableColor)],A.prototype,"visualVariableColor",void 0);q.__decorate([r.option(n.VisualVariableOpacity)],A.prototype,"visualVariableOpacity",void 0);q.__decorate([r.option(d.VisualVariableSizeMinMaxValue)],
A.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([r.option(w.VisualVariableSizeScaleStops)],A.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([r.option(t.VisualVariableSizeStops)],A.prototype,"visualVariableSizeStops",void 0);q.__decorate([r.option(l.VisualVariableSizeUnitValue)],A.prototype,"visualVariableSizeUnitValue",void 0);class k extends A{vertex(v,B){return u(this,v,B)}fragment(v){const {color:B,isOutline:z}=v;var E=g.greaterThan(z,new g.Float(.5)),K=f.getLineFragmentColor(v,
this.antialiasingControls.blur);K=g.ifElse(E,K,B);E=g.ifElse(E,new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(K,v,E)}hittest(v,B,z){return g.ifElse(z,b.failHittest(this.hittestRequest),b.hittestFill(this,v,B))}}q.__decorate([q.__param(0,r.input(x)),q.__param(1,r.input(p.BaseHittestVertexInput))],k.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(y))],k.prototype,"fragment",null);a.AOutlineFillShader=A;a.OutlineFillFragmentInput=y;a.OutlineFillShader=k;a.OutlineFillVertexInput=
x;a.getOutlineFillVertexData=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(a,q,r,g,p,m,b,f,c,h){class n extends c.OutlineFillVertexInput{}q.__decorate([r.location(9,g.Vec4)],
n.prototype,"tlbr",void 0);q.__decorate([r.location(10,g.Float)],n.prototype,"inverseRasterizationScale",void 0);class d extends c.OutlineFillFragmentInput{}class w extends c.OutlineFillShader{vertex(t,l){return{...c.getOutlineFillVertexData(this,t,l),...h.getPatternFillVertexData(this,t)}}fragment(t){var {isOutline:l}=t;l=g.greaterThan(l,new g.Float(.5));var e=m.getLineFragmentColor(t,this.antialiasingControls.blur);const u=h.getPatternFillFragmentColor(t,this.mosaicInfo);e=g.ifElse(l,e,u);l=g.ifElse(l,
new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(e,t,l)}}q.__decorate([r.uniform(f.MosaicInfo)],w.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(b.LocalTileOffset)],w.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,r.input(n)),q.__param(1,r.input(p.BaseHittestVertexInput))],w.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(d))],w.prototype,"fragment",null);a.PatternOutlineFillFragmentInput=d;a.PatternOutlineFillShader=w;a.PatternOutlineFillVertexInput=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(a,q,r,g,p,m,b,f){function c(t,l){var e=l.tlbr.xy,u=l.tlbr.zw,x=u.x.subtract(e.x);e=e.y.subtract(u.y);x=(new g.Vec2(x,e)).multiply(l.inverseRasterizationScale);e=x.multiply(t.view.requiredZoomFactor);
u=new g.Float(1);const y=new g.Float(0);u=new g.Mat3(u.divide(e.x),y.divide(e.y),0,g.negate(y.divide(e.x)),u.divide(e.y),0,0,0,1);x=t.localTileOffset.getPatternOffsetAtTileOrigin(x).divide(e);e=new g.Vec3(l.pos,1);x=u.multiply(e).xy.subtract(x);t=l.tlbr.divide(t.mosaicInfo.size.xyxy);return{tileTextureCoord:x,tlbr:t}}function h(t,l){var e=g.mod(t.tileTextureCoord,new g.Float(1));e=g.mix(t.tlbr.xy,t.tlbr.zw,e);l=g.texture2D(l.texture,e);return t.color.multiply(l)}class n extends m.FillVertexInput{}
q.__decorate([r.location(5,g.Vec4)],n.prototype,"tlbr",void 0);q.__decorate([r.location(6,g.Float)],n.prototype,"inverseRasterizationScale",void 0);class d extends p.FeatureFragmentInput{}class w extends m.FillShader{vertex(t,l){return{...super.vertex(t,l),...c(this,t)}}fragment(t){const l=h(t,this.mosaicInfo);return this.getFragmentOutput(l,t,new g.Float(0))}}q.__decorate([r.uniform(f.MosaicInfo)],w.prototype,"mosaicInfo",void 0);q.__decorate([r.uniform(b.LocalTileOffset)],w.prototype,"localTileOffset",
void 0);q.__decorate([q.__param(0,r.input(n)),q.__param(1,r.input(p.BaseHittestVertexInput))],w.prototype,"vertex",null);q.__decorate([q.__param(0,r.input(d))],w.prototype,"fragment",null);a.PatternFillFragmentInput=d;a.PatternFillShader=w;a.PatternFillVertexInput=n;a.getPatternFillFragmentColor=h;a.getPatternFillVertexData=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports",
"../../../../../../../geometry/GeometryCursor","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(a,q,r,g){const p={optionalAttributes:g.patternFillVertexSpec.optionalAttributes,createComputedParams:c=>c,attributes:{...g.patternFillVertexSpec.attributes,...r.outlineFillVertexSpec_Fill.attributes}},m={optionalAttributes:g.patternFillVertexSpec.optionalAttributes,createComputedParams:c=>c,attributes:{...g.patternFillVertexSpec.attributes,...r.outlineFillVertexSpec_Outline.attributes}};class b extends r.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);
this.vertexSpec=m}}class f extends r.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=p}_createOutlineWriter(c,h,n,d){return new b(c,h,n,d)}_write(c,h,n){n=n?.asOptimized()??h.readGeometryForDisplay();if(n=this._clip(n))c.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(c,h,n),this._lineMeshWriter.writeLineVertices(c,q.GeometryCursor.fromOptimizedCIM(n,"esriGeometryPolyline"),h),c.recordEnd()}ensurePacked(c,
h,n){super.ensurePacked(c,h,n);this._lineMeshWriter.ensurePacked(c,h,n)}enqueueRequest(c,h,n){super.enqueueRequest(c,h,n);this._lineMeshWriter.enqueueRequest(c,h,n)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}a.PatternOutlineFillMeshWriter=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter",
"../../../../../../webgl/enums"],function(a,q,r){const g={createComputedParams:m=>m,optionalAttributes:{},attributes:{pos:{type:r.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:r.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},offset:{type:r.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class p extends q.MeshWriter{constructor(){super(...arguments);this.vertexSpec=g}_write(m,b){m.recordStart(this.instanceId,
this.attributeLayout);const f=b.getDisplayId();if("esriGeometryPoint"===b.geometryType){const c=b.readXForDisplay();b=b.readYForDisplay();this._writeQuad(m,f,c,b)}else"esriGeometryMultipoint"===b.geometryType&&b.readGeometryForDisplay()?.forEachVertex((c,h)=>{0<=c&&512>=c&&0<=h&&512>=h&&this._writeQuad(m,f,c,h)});m.recordEnd()}_writeQuad(m,b,f,c){const h=m.vertexCount();this._writeVertex(m,b,f,c);m.indexWrite(h+0);m.indexWrite(h+1);m.indexWrite(h+2);m.indexWrite(h+1);m.indexWrite(h+3);m.indexWrite(h+
2)}}a.HeatmapMeshWriter=p;a.heatmapVertexSpec=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/graphics/OptimizedGeometry ../../../alignmentUtils ../../../DisplayId ../../../collisions/BoundingBox ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u){function x(k,v,B){const {coords:z,lengths:E}=v;v=f.create();const K=f.create(),I=f.create(),D=f.create(),G=f.create(),C=f.create();let F=0;for(let T=0;T<E.length;T++){const S=E[T];for(let ba=0;ba<S;ba++){var J=2*(ba+F-1);const M=2*(ba+F),U=2*(ba+F+1);0<ba?m.set(v,z[J],z[J+1]):m.set(v,0,0);m.set(K,z[M],z[M+1]);ba<S-1?m.set(I,z[U],z[U+1]):m.set(I,0,0);0===ba?m.set(D,0,0):(m.sub(D,K,v),m.normalize(D,D),m.set(D,D[1],-D[0]));ba===S-1?m.set(G,0,0):(m.sub(G,I,
K),m.normalize(G,G),m.set(G,G[1],-G[0]));m.add(C,D,G);m.normalize(C,C);J=C[0]*G[0]+C[1]*G[1];0!==J&&m.scale(C,C,J);m.scale(C,C,B);k.coords.push(K[0]+C[0],K[1]+C[1])}k.lengths.push(S);F+=S}return k}const y=q.memoize(k=>{let v=0;if(0===k)return Infinity;for(;!(k%2);)v++,k/=2;return v});class A extends u.TextMeshWriter{constructor(){super(...arguments);this._zoomLevel=0}_write(k,v,B,z){this._zoomLevel=z||0;if(null!=B)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(v.geometryType){case "esriGeometryPoint":return B=
v.readXForDisplay(),z=v.readYForDisplay(),this._writePoint(k,B,z,v);case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":B=v.readCentroidForDisplay();if(!B)break;const [E,K]=B.coords;return this._writePoint(k,E,K,v);case "esriGeometryPolyline":this._writeLines(k,v)}}_writePoint(k,v,B,z){const E=this._getShaping();if(E){var K=this._getPointReferenceBounds();K||={offsetX:0,offsetY:0,size:0};var I=E.boundsT,D=n.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),
G=n.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),C=this.evaluatedMeshParams.scaleInfo?.maxScale??0,F=this.evaluatedMeshParams.scaleInfo?.minScale??0,J=d.getDisplayIdTexel(z.getDisplayId());k.metricStart(new t.LabelMetric(J,v,B,D,G,C,F,K));k.metricBoxWrite(I);this._writeGlyphs(k,z.getDisplayId(),v,B,E,0,K);k.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const k of this._references){const v=k.getBoundsInfo();if(v)return v}return null}_writeLines(k,v){const {scaleInfo:B,
verticalAlignment:z}=this.evaluatedMeshParams;var E=this.evaluatedMeshParams.repeatLabelDistance||128;const K=this._getShaping("middle");if(K){var I=(D,G,C,F)=>this._placeSubdivGlyphs(D,G,C,F);E=(K.bounds.width+E)/2;this._current={out:k,id:v.getDisplayId(),shaping:K,zoomRange:e.getMinMaxZoom(B,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null};(this._verticalPlacement="bottom"===z?"above":"top"===z?"below":null)?this._writeAboveAndBelowAlong(v,
I,E):this._writeCenterAlong(v,I,E)}}_writeAboveAndBelowAlong(k,v,B){const {repeatLabel:z,fontSize:E}=this.evaluatedMeshParams;var {shaping:K}=this._current,I=r.pt2px(E);if(k=k.readGeometryForDisplay()){var D=new h;c.generalizeOptimizedGeometry(D,k,!1,!1,"esriGeometryPolyline",1);k=x(new h,D,I);I=x(new h,D,-I);I=c.convertToGeometry(I,"esriGeometryPolyline",!1,!1);k=c.convertToGeometry(k,"esriGeometryPolyline",!1,!1);k=l.smoothPaths(k.paths,K.bounds.width);K=l.smoothPaths(I.paths,K.bounds.width);this._current.offsetDirection=
"above";for(const G of k)l.pathDivide(G,B,v,!!z);this._current.offsetDirection="below";for(const G of K)l.pathDivide(G,B,v,!!z)}}_writeCenterAlong(k,v,B){const {repeatLabel:z}=this.evaluatedMeshParams,{shaping:E}=this._current;k=l.smoothPaths(k.readLegacyGeometryForDisplay().paths,E.bounds.width);for(const K of k)l.pathDivide(K,B,v,!!z)}_placeSubdivGlyphs(k,v,B,z){const {allowOverrun:E,labelPosition:K,repeatLabelDistance:I}=this.evaluatedMeshParams,D=this._current.zoomRange[0];var G=y(v),C=this._current.shaping.bounds.width/
2,F=Math.sqrt(I||128)/2;B=Math.min(B,z-B);C=this._current.shaping.isMultiline?u.maxLabelZoom:Math.log2(B/(F+C/2));G=Math.max(D,this._zoomLevel+1-(0===v?C:Math.min(G,C)));C=this._zoomLevel-G;F=this._current.shaping.bounds.width/2*2**C;this._current.shaping.isMultiline?0===v&&this._placeStraight(k,G):E&&0>C?this._placeStraightAlong(k,D):"parallel"===K?this._placeStraightAlong(k,G):"curved"===K&&this._placeCurved(k,G,F)}_placeStraight(k,v){const {out:B,id:z,shaping:E,referenceBounds:K}=this._current,
{x:I,y:D}=k;var G=d.getDisplayIdTexel(z);B.metricStart(new t.LabelMetric(G,k.x,k.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));B.metricBoxWrite(E.boundsT);G=(180/Math.PI*k.angle+180)%360;this._writeGlyphs(B,z,I,D,E,0,K,{clipAngle:180/Math.PI*k.angle%360,mapAligned:!0,isLineLabel:!0,minZoom:v});this._writeGlyphs(B,z,I,D,E,0,K,{clipAngle:G,mapAligned:!0,isLineLabel:!0,minZoom:v});B.metricEnd()}_placeCurved(k,v,B){const {out:z,id:E}=this._current,
K=k.clone(),I=180/Math.PI*k.angle%360,D=(180/Math.PI*k.angle+180)%360,G=d.getDisplayIdTexel(E);z.metricStart(new t.LabelMetric(G,k.x,k.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(K,v,1,I),this._placeBack(k,K,v,B,1,I),this._placeForward(k,K,v,B,1,I));this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(K,
v,0,D),this._placeBack(k,K,v,B,0,D),this._placeForward(k,K,v,B,0,D));z.metricEnd()}_placeStraightAlong(k,v){const {out:B,id:z,shaping:E,zoomRange:K,referenceBounds:I}=this._current,{boxBorderLineColor:D,boxBackgroundColor:G}=this.evaluatedMeshParams,C=k.clone(),F=180/Math.PI*k.angle%360,J=(180/Math.PI*k.angle+180)%360;if(0<E.glyphs.length&&(D||G)){var T=Math.max(v,K[0],0),S=Math.min(u.maxLabelZoom,K[1]),ba=g.fromRotation(p.create(),-k.angle);T={minZoom:T,maxZoom:S,clipAngle:F,mapAligned:!0,isLineLabel:!0};
S=r.pt2px(this.evaluatedMeshParams.offsetX);const U=r.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){var M=b.fromValues(S,-1*U);const [R,Z]=E.shapeBackground(g.translate(p.create(),ba,M));B.recordStart(this.instanceId,this.attributeLayout,E.glyphs[0].textureBinding);M=2*Math.max(R.width,R.height);B.recordBounds(k.x+R.x,k.y+R.y,M,M);this._writeTextBox(B,z,k.x,k.y,Z,I,T);B.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==
this._current.offsetDirection){S=b.fromValues(S,U);const [R,Z]=E.shapeBackground(g.translate(p.create(),ba,S));T.clipAngle=J;B.recordStart(this.instanceId,this.attributeLayout,E.glyphs[0].textureBinding);ba=2*Math.max(R.width,R.height);B.recordBounds(k.x+R.x,k.y+R.y,ba,ba);this._writeTextBox(B,z,k.x,k.y,Z,I,T);B.recordEnd()}}ba=d.getDisplayIdTexel(z);B.metricStart(new t.LabelMetric(ba,k.x,k.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));
this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(C,v,1,F,!0);this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(C,v,0,J,!0);B.metricEnd()}_placeBack(k,v,B,z,E,K){const I=k.clone();for(k=k.backwardLength+0;I.prev()&&!(k>=z);)this._placeOnSegment(I,v,k,B,-1,E,K),k+=I.length+0}_placeForward(k,v,B,z,E,K){const I=k.clone();for(k=k.remainingLength+0;I.next()&&!(k>=z);)this._placeOnSegment(I,v,k,B,1,E,K),k+=
I.length+0}_placeFirst(k,v,B,z,E=!1){const {out:K,id:I,shaping:D,zoomRange:G,referenceBounds:C}=this._current;var F=D.glyphs;for(const J of F)F=J.x>D.bounds.x?B:1-B,F=Math.max(0,this._zoomLevel+Math.log2(Math.abs(J.x+J.width/2-D.bounds.x)/(F*k.remainingLength+(1-F)*k.backwardLength))),F=Math.max(v,E?0:F),J.maxZoom=Math.min(G[1],u.maxLabelZoom),J.angle=k.angle+(1-B)*Math.PI,J.minZoom=Math.max(G[0],F),this._writeLineGlyph(K,I,k.x,k.y,D.bounds,J,z,C,!0),B&&this._isVisible(J.minZoom,J.maxZoom)&&K.metricBoxWrite(J.bounds)}_placeOnSegment(k,
v,B,z,E,K,I){const {out:D,id:G,shaping:C,referenceBounds:F}=this._current;var J=C.glyphs,T=k.x+k.dx/k.length*-E*B,S=k.y+k.dy/k.length*-E*B;for(const M of J)if((J=M.x>C.bounds.x?K:1-K)&&1===E||!J&&-1===E){var ba=Math.abs(M.x+M.width/2-C.bounds.x);J=Math.max(0,this._zoomLevel+Math.log2(ba/B)-.1);ba=Math.max(z,this._zoomLevel+Math.log2(ba/(B+k.length+0)));0!==J&&(M.angle=k.angle+(1-K)*Math.PI,M.minZoom=ba,M.maxZoom=J,this._writeLineGlyph(D,G,T,S,C.bounds,M,I,F,!0),K&&this._isVisible(M.minZoom,M.maxZoom)&&
(J=M.bounds,J=new w(J.center[0]+(k.x-v.x),J.center[1]+(k.y-v.y),J.width,J.height),D.metricBoxWrite(J)))}}_writeLineGlyph(k,v,B,z,E,K,I,D,G){const C=B+E.x,F=z+E.y;E=2*Math.max(E.width,E.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1);k.recordStart(this.instanceId,this.attributeLayout,K.textureBinding);k.recordBounds(C,F,E,E);const {texcoords:J,offsets:T}=K;this._writeQuad(k,v,B,z,{texcoords:J,offsets:T,fontSize:this._textMeshTransformProps.fontSize,
color:e.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:D,minZoom:Math.max(this._current.zoomRange[0],K.minZoom),maxZoom:Math.min(this._current.zoomRange[1],K.maxZoom),clipAngle:I,mapAligned:G,isLineLabel:!0});k.recordEnd()}_isVisible(k,v){const B=this._zoomLevel;return k<=B&&B<=v}}a.LabelMeshWriter=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/maybe ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(Q,X){return Q?X?4:3:X?3:2}function d(Q,X,Y,ia){if(Q){if(Y)return X&&ia?P:xa;if(X&&ia)return L}else if(X&&ia)return xa;return va}function w({scale:Q,translate:X},Y){return Math.round((Y-X[0])/Q[0])}function t({scale:Q,translate:X},Y){return Math.round((X[1]-Y)/Q[1])}function l({scale:Q,translate:X},Y,ia){return Y*Q[ia]+X[ia]}function e(Q){Q=Q.coords;return{x:Q[0],y:Q[1]}}function u(Q,X){Q.coords[0]=X.x;Q.coords[1]=X.y;return Q}function x(Q){Q=Q.coords;return{x:Q[0],
y:Q[1],z:Q[2]}}function y(Q,X){Q.coords[0]=X.x;Q.coords[1]=X.y;Q.coords[2]=X.z;return Q}function A(Q){Q=Q.coords;return{x:Q[0],y:Q[1],m:Q[2]}}function k(Q,X){Q.coords[0]=X.x;Q.coords[1]=X.y;Q.coords[2]=X.m;return Q}function v(Q){Q=Q.coords;return{x:Q[0],y:Q[1],z:Q[2],m:Q[3]}}function B(Q,X){Q.coords[0]=X.x;Q.coords[1]=X.y;Q.coords[2]=X.z;Q.coords[3]=X.m;return Q}function z(Q,X){return Q&&X?B:Q?y:X?k:u}function E(Q,X,Y,ia,na){Y=z(Y,ia);for(const {geometry:O,attributes:da}of X)X=null!=O?Y(new h,O):
null,Q.push(new f.OptimizedFeature(X,da,null,na?da[na]:void 0));return Q}function K(Q,X,Y=z(null!=X.z,null!=X.m)){return Y(Q,X)}function I(Q,X,Y,ia){for(const {geometry:na,attributes:O}of X)Q.push({attributes:O,geometry:null!=na?D(na,Y,ia):null});return Q}function D(Q,X,Y){if(null==Q)return null;const ia=n(X,Y),na=[];for(let O=0;O<Q.coords.length;O+=ia){const da=[];for(let la=0;la<ia;la++)da.push(Q.coords[O+la]);na.push(da)}return X?Y?{points:na,hasZ:X,hasM:Y}:{points:na,hasZ:X}:Y?{points:na,hasM:Y}:
{points:na}}function G(Q,X,Y,ia,na){Y=n(Y,ia);for(const {geometry:O,attributes:da}of X)X=null!=O?C(new h,O,Y):null,Q.push(new f.OptimizedFeature(X,da,null,na?da[na]:void 0));return Q}function C(Q,X,Y=n(X.hasZ,X.hasM)){Q.lengths[0]=X.points.length;const ia=Q.coords;let na=0;for(const O of X.points)for(X=0;X<Y;X++)ia[na++]=O[X];return Q}function F(Q,X,Y){if(!Q)return null;const ia=n(X,Y),{coords:na,lengths:O}=Q;Q=[];let da=0;for(const la of O){const pa=[];for(let za=0;za<la;za++){const Aa=[];for(let Ba=
0;Ba<ia;Ba++)Aa.push(na[da++]);pa.push(Aa)}Q.push(pa)}return X?Y?{paths:Q,hasZ:X,hasM:Y}:{paths:Q,hasZ:X}:Y?{paths:Q,hasM:Y}:{paths:Q}}function J(Q,X,Y,ia,na){Y=n(Y,ia);for(const {geometry:O,attributes:da,centroid:la}of X)X=null!=O?T(new h,O,Y):null,ia=null!=la?K(new h,la):null,Q.push(new f.OptimizedFeature(X,da,ia,na?da[na]:void 0));return Q}function T(Q,X,Y=n(X.hasZ,X.hasM)){const {lengths:ia,coords:na}=Q;let O=0;for(const da of X.paths){for(const la of da)for(X=0;X<Y;X++)na[O++]=la[X];ia.push(da.length)}return Q}
function S(Q,X,Y){if(!Q)return null;const ia=n(X,Y),{coords:na,lengths:O}=Q;Q=[];let da=0;for(const la of O){const pa=[];for(let za=0;za<la;za++){const Aa=[];for(let Ba=0;Ba<ia;Ba++)Aa.push(na[da++]);pa.push(Aa)}Q.push(pa)}return X?Y?{rings:Q,hasZ:X,hasM:Y}:{rings:Q,hasZ:X}:Y?{rings:Q,hasM:Y}:{rings:Q}}function ba(Q,X,Y=X.hasZ,ia=X.hasM){return M(Q,X.rings,Y,ia)}function M(Q,X,Y,ia){Y=n(Y,ia);const {lengths:na,coords:O}=Q;ia=0;ja(Q);for(const da of X){for(const la of da)for(X=0;X<Y;X++)O[ia++]=la[X];
na.push(da.length)}return Q}function U(Q,X,Y,ia,na,O){oa(Q);if(!Y){for(const da of X)Q.push(new f.OptimizedFeature(null,da.attributes,null,O?da.attributes[O]:void 0));return Q}switch(Y){case "esriGeometryPoint":return E(Q,X,ia,na,O);case "esriGeometryMultipoint":return G(Q,X,ia,na,O);case "esriGeometryPolyline":return J(Q,X,ia,na,O);case "esriGeometryPolygon":for(const {geometry:da,centroid:la,attributes:pa}of X)X=null!=da?ba(new h,da,ia,na):null,Y=O?pa[O]:void 0,null!=la?Q.push(new f.OptimizedFeature(X,
pa,u(new h,la),Y)):Q.push(new f.OptimizedFeature(X,pa,null,Y));break;default:wa().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${Y}'`)),oa(Q)}return Q}function R(Q,X,Y,ia){Q=Q&&("coords"in Q?Q:Q.geometry);if(null==Q)return null;switch(X){case "esriGeometryPoint":return X=e,Y&&ia?X=v:Y?X=x:ia&&(X=A),X(Q);case "esriGeometryMultipoint":return D(Q,Y,ia);case "esriGeometryPolyline":return F(Q,Y,ia);case "esriGeometryPolygon":return S(Q,Y,ia);default:return wa().error("convertToGeometry:unknown-geometry",
new q(`Unable to parse unknown geometry type '${X}'`)),null}}function Z(Q,X,Y,ia,na){oa(Q);if(null==Y){for(const da of X)Q.push({attributes:da.attributes});return Q}switch(Y){case "esriGeometryPoint":Y=e;ia&&na?Y=v:ia?Y=x:na&&(Y=A);for(var O of X){const {geometry:da,attributes:la}=O;ia=null!=da?Y(da):null;Q.push({attributes:la,geometry:ia})}break;case "esriGeometryMultipoint":return I(Q,X,ia,na);case "esriGeometryPolyline":for(const {geometry:da,attributes:la}of X)Q.push({attributes:la,geometry:null!=
da?F(da,ia,na):null});break;case "esriGeometryPolygon":for(const {geometry:da,attributes:la,centroid:pa}of X)O=null!=da?S(da,ia,na):null,null!=pa?(X=e(pa),Q.push({attributes:la,centroid:X,geometry:O})):Q.push({attributes:la,geometry:O});break;default:wa().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${Y}'`))}return Q}function ea(Q,X,Y,ia,na,O,da=Y,la=ia){ja(Q);if(!X?.coords.length)return null;na=ta[na];const {coords:pa,lengths:za}=X;X=n(Y,ia);const Aa=
n(Y&&da,ia&&la);Y=d(Y,ia,da,la);if(!za.length)return Y(Q.coords,pa,0,0,w(O,pa[0]),t(O,pa[1])),ja(Q,X,0),Q;let Ba,Ga=0,Da,Ha=0;for(const Fa of za){if(Fa<na)continue;let Ea=0;Da=Ha;la=ia=w(O,pa[Ga]);Ba=da=t(O,pa[Ga+1]);Y(Q.coords,pa,Da,Ga,la,Ba);Ea++;Ga+=X;Da+=Aa;for(let Ka=1;Ka<Fa;Ka++,Ga+=X)if(la=w(O,pa[Ga]),Ba=t(O,pa[Ga+1]),la!==ia||Ba!==da)Y(Q.coords,pa,Da,Ga,la-ia,Ba-da),Da+=Aa,Ea++,ia=la,da=Ba;Ea>=na&&(Q.lengths.push(Ea),Ha=Da)}oa(Q.coords,Ha);return Q.coords.length?Q:null}function ma(Q,X,Y,ia,
na,O,da){let la=ia,pa=0;for(let Aa=O+Y;Aa<da;Aa+=Y){var za=X[Aa];const Ba=X[Aa+1],Ga=X[da],Da=X[da+1];let Ha=X[O],Fa=X[O+1],Ea=Ga-Ha,Ka=Da-Fa;if(0!==Ea||0!==Ka){const Ta=((za-Ha)*Ea+(Ba-Fa)*Ka)/(Ea*Ea+Ka*Ka);1<Ta?(Ha=Ga,Fa=Da):0<Ta&&(Ha+=Ea*Ta,Fa+=Ka*Ta)}Ea=za-Ha;Ka=Ba-Fa;za=Ea*Ea+Ka*Ka;za>la&&(pa=Aa,la=za)}la>ia&&(pa-O>Y&&ma(Q,X,Y,ia,na,O,pa),na(Q,X,Q.length,pa,X[pa],X[pa+1]),da-pa>Y&&ma(Q,X,Y,ia,na,pa,da))}function V(Q,X,Y,ia,na){const {coords:O,lengths:da}=X;Y=n(Y,ia);if(!O.length)return Q!==X&&
ja(Q),Q;g.assertIsSome(na);const {originPosition:la,scale:pa,translate:za}=na;na=qa;na.originPosition=la;ia=na.scale;ia[0]=pa[0]??1;ia[1]=-(pa[1]??1);ia[2]=pa[2]??1;ia[3]=pa[3]??1;var Aa=na.translate;Aa[0]=za[0]??0;Aa[1]=za[1]??0;Aa[2]=za[2]??0;Aa[3]=za[3]??0;if(!da.length){for(ia=0;ia<Y;++ia)Q.coords[ia]=l(na,O[ia],ia);Q!==X&&ja(Q,Y,0);return Q}Aa=0;for(let Ga=0;Ga<da.length;Ga++){const Da=da[Ga];Q.lengths[Ga]=Da;for(var Ba=0;Ba<Y;++Ba)Q.coords[Aa+Ba]=l(na,O[Aa+Ba],Ba);Ba=Q.coords[Aa];let Ha=Q.coords[Aa+
1];Aa+=Y;for(let Fa=1;Fa<Da;Fa++,Aa+=Y){Ba+=O[Aa]*ia[0];Ha+=O[Aa+1]*ia[1];Q.coords[Aa]=Ba;Q.coords[Aa+1]=Ha;for(let Ea=2;Ea<Y;++Ea)Q.coords[Aa+Ea]=l(na,O[Aa+Ea],Ea)}}Q!==X&&ja(Q,O.length,da.length);return Q}function aa(Q,X,Y,ia){let na=0,O=Q[ia*X],da=Q[ia*(X+1)];for(let la=1;la<Y;la++){const pa=O+Q[ia*(X+la)],za=da+Q[ia*(X+la)+1],Aa=(pa-O)*(za+da);O=pa;da=za;na+=Aa}return.5*na}function ja(Q,X=0,Y=0){oa(Q.lengths,Y);oa(Q.coords,X)}function oa(Q,X=0){Q.length!==X&&(Q.length=X)}const wa=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),
ta={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},va=(Q,X,Y,ia,na,O)=>{Q[Y]=na;Q[Y+1]=O},xa=(Q,X,Y,ia,na,O)=>{Q[Y]=na;Q[Y+1]=O;Q[Y+2]=X[ia+2]},L=(Q,X,Y,ia,na,O)=>{Q[Y]=na;Q[Y+1]=O;Q[Y+2]=X[ia+3]},P=(Q,X,Y,ia,na,O)=>{Q[Y]=na;Q[Y+1]=O;Q[Y+2]=X[ia+2];Q[Y+3]=X[ia+3]},fa=[],ka=[],qa={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};a.convertFromFeature=function(Q,X,Y,ia,na){fa[0]=Q;[Q]=U(ka,fa,X,Y,ia,na);oa(fa);oa(ka);return Q};
a.convertFromFeatureSet=function(Q,X){const Y=new c,{hasM:ia,hasZ:na,features:O,objectIdFieldName:da,spatialReference:la,geometryType:pa,exceededTransferLimit:za,transform:Aa,fields:Ba}=Q;Ba&&(Y.fields=Ba);Y.geometryType=pa??null;Y.objectIdFieldName=da??X??null;Y.spatialReference=la??null;if(!Y.objectIdFieldName)return wa().error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),Y;O&&U(Y.features,O,pa,na,ia,Y.objectIdFieldName);za&&(Y.exceededTransferLimit=za);
ia&&(Y.hasM=ia);na&&(Y.hasZ=na);Aa&&(Y.transform=Aa);return Y};a.convertFromFeatures=U;a.convertFromGeometry=function(Q,X,Y){if(null==Q)return null;const ia=new h;"hasZ"in Q&&null==X&&(X=Q.hasZ);"hasM"in Q&&null==Y&&(Y=Q.hasM);if(b.isPoint(Q))return z(null!=X?X:null!=Q.z,null!=Y?Y:null!=Q.m)(ia,Q);if(b.isPolygon(Q))return ba(ia,Q,X,Y);if(b.isPolyline(Q))return T(ia,Q,n(X,Y));if(b.isMultipoint(Q))return C(ia,Q,n(X,Y));wa().error("convertFromGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${Q}'`))};
a.convertFromMultipoint=C;a.convertFromMultipointFeatures=G;a.convertFromNestedArray=M;a.convertFromPoint=K;a.convertFromPointFeatures=E;a.convertFromPolygon=ba;a.convertFromPolyline=T;a.convertFromPolylineFeatures=J;a.convertToFeature=function(Q,X,Y,ia){ka[0]=Q;Z(fa,ka,X,Y,ia);Q=fa[0];oa(fa);oa(ka);return Q};a.convertToFeatureSet=function(Q){const {objectIdFieldName:X,spatialReference:Y,transform:ia,fields:na,hasM:O,hasZ:da,features:la,geometryType:pa,exceededTransferLimit:za,uniqueIdField:Aa,queryGeometry:Ba,
queryGeometryType:Ga}=Q;Q=Z([],la,pa,da,O);const Da=R(Ba,Ga,!1,!1);Q={features:Q,fields:na,geometryType:pa,objectIdFieldName:X,spatialReference:Y,uniqueIdField:Aa,queryGeometry:Da};ia&&(Q.transform=ia);za&&(Q.exceededTransferLimit=za);O&&(Q.hasM=O);da&&(Q.hasZ=da);return Q};a.convertToFeatures=Z;a.convertToGeometry=R;a.convertToMultipoint=D;a.convertToMultipointFeatures=I;a.convertToPoint=function(Q,X,Y){return Q?X?Y?v(Q):x(Q):Y?A(Q):e(Q):null};a.convertToPolygon=S;a.convertToPolyline=F;a.generalizeOptimizedGeometry=
function(Q,X,Y,ia,na,O,da=Y,la=ia){ja(Q);if(!X?.coords.length)return null;na=ta[na];const {coords:pa,lengths:za}=X;X=n(Y,ia);const Aa=n(Y&&da,ia&&la);Y=d(Y,ia,da,la);if(!za.length)return Y(Q.coords,pa,0,0,pa[0],pa[1]),ja(Q,X,0),Q;ia=0;O*=O;for(const Ba of za){if(Ba<na){ia+=Ba*X;continue}da=Q.coords.length/Aa;la=ia;const Ga=ia+(Ba-1)*X;Y(Q.coords,pa,Q.coords.length,la,pa[la],pa[la+1]);ma(Q.coords,pa,X,O,Y,la,Ga);Y(Q.coords,pa,Q.coords.length,Ga,pa[Ga],pa[Ga+1]);la=Q.coords.length/Aa-da;la>=na?Q.lengths.push(la):
oa(Q.coords,da*Aa);ia+=Ba*X}return Q.coords.length?Q:null};a.getBoundsOptimizedGeometry=function(Q,X,Y,ia){if(!X?.coords?.length)return null;Y=n(Y,ia);let na=ia=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY,da=Number.NEGATIVE_INFINITY;if(X&&X.coords){X=X.coords;for(let la=0;la<X.length;la+=Y){const pa=X[la],za=X[la+1];ia=Math.min(ia,pa);O=Math.max(O,pa);na=Math.min(na,za);da=Math.max(da,za)}}p.is(Q)?p.fromRectValues(Q,ia,na,O,da):m.fromValues(ia,na,O,da,Q);return Q};a.getQuantizedArea=function(Q,
X){const {coords:Y,lengths:ia}=Q;let na=Q=0;for(let O=0;O<ia.length;O++){const da=ia[O];na+=aa(Y,Q,da,X);Q+=da}return Math.abs(na)};a.getQuantizedBoundsOptimizedGeometry=function(Q,X,Y,ia){Y=n(Y,ia);const {lengths:na,coords:O}=X;ia=X=Number.POSITIVE_INFINITY;let da=Number.NEGATIVE_INFINITY,la=Number.NEGATIVE_INFINITY,pa=0;for(const za of na){let Aa=O[pa],Ba=O[pa+1];X=Math.min(Aa,X);ia=Math.min(Ba,ia);da=Math.max(Aa,da);la=Math.max(Ba,la);pa+=Y;for(let Ga=1;Ga<za;Ga++,pa+=Y){const Da=O[pa],Ha=O[pa+
1];Aa+=Da;Ba+=Ha;0>Da&&(X=Math.min(X,Aa));0<Da&&(da=Math.max(da,Aa));0>Ha?ia=Math.min(ia,Ba):0<Ha&&(la=Math.max(la,Ba))}}Q[0]=X;Q[1]=ia;Q[2]=da;Q[3]=la;return Q};a.getSignedQuantizedRingArea=aa;a.quantizeOptimizedFeatureSet=function(Q,X){const {geometryType:Y,features:ia,hasM:na,hasZ:O}=X;if(!Q)return X;for(let da=0;da<ia.length;da++){const la=ia[da],pa=la.weakClone();pa.geometry=new h;ea(pa.geometry,la.geometry,na,O,Y,Q);la.centroid&&(pa.centroid=new h,ea(pa.centroid,la.centroid,na,O,"esriGeometryPoint",
Q));ia[da]=pa}X.transform=Q;return X};a.quantizeOptimizedGeometry=ea;a.quantizeX=w;a.quantizeY=t;a.removeCollinearVertices=function(Q,X,Y,ia,na){if(!X?.coords?.length)return null;Y=ta[Y];const {coords:O,lengths:da}=X;X=d(ia,na,ia,na);ia=n(ia,na);let la=na=0,pa=0,za=0;for(const Ga of da){la=za;X(Q.coords,O,la,na,O[na],O[na+1]);na+=ia;var Aa=O[na];let Da=O[na+1],Ha=Aa,Fa=Da;var Ba=Da/Aa;la+=ia;X(Q.coords,O,la,na,Ha,Fa);na+=ia;for(let Ea=2;Ea<Ga;Ea++){Aa=O[na];Da=O[na+1];const Ka=Da/Aa,Ta=Ba===Ka||!isFinite(Ba)&&
!isFinite(Ka);Ba=Ta&&isFinite(Ka)?0<=Ba&&0<=Ka||0>=Ba&&0>=Ka:0<=Fa&&0<=Da||0>=Fa&&0>=Da;Ta&&Ba?(Ha+=Aa,Fa+=Da):(Ha=Aa,Fa=Da,la+=ia);X(Q.coords,O,la,na,Ha,Fa);na+=ia;Ba=Ka}la+=ia;Aa=(la-za)/ia;Aa>=Y&&(Q.lengths[pa]=Aa,za=la,pa++)}Q.coords.length>za&&(Q.coords.length=za);Q.lengths.length>pa&&(Q.lengths.length=pa);return Q.coords.length&&Q.lengths.length?Q:null};a.removeZMValues=function(Q,X,Y,ia,na,O){ja(Q);Q.lengths.push(...X.lengths);if(Y===na&&ia===O)for(var da=0;da<X.coords.length;da++)Q.coords.push(X.coords[da]);
else for(da=n(Y,ia),Y=d(Y,ia,na,O),X=X.coords,ia=0;ia<X.length;ia+=da)Y(Q.coords,X,Q.coords.length,ia,X[ia],X[ia+1]);return Q};a.unquantizeOptimizedFeatureSet=function(Q){const {transform:X,features:Y,hasM:ia,hasZ:na}=Q;if(!X)return Q;for(const O of Y)null!=O.geometry&&V(O.geometry,O.geometry,ia,na,X),null!=O.centroid&&V(O.centroid,O.centroid,ia,na,X);Q.transform=null;return Q};a.unquantizeOptimizedGeometry=V;a.unquantizeValue=l;a.unquantizeX=function(Q,X){return l(Q,X,0)};a.unquantizeY=function(Q,
X){return l(Q,-X,1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect"],function(a,q,r){function g(l=w){return[l[0],l[1],l[2],l[3],l[4],l[5]]}function p(l,e,u,x,y,A,k=g()){k[0]=l;k[1]=e;k[2]=u;k[3]=x;k[4]=y;k[5]=A;return k}function m(l){return l[0]>=l[3]?0:l[3]-l[0]}function b(l){return l[1]>=l[4]?0:l[4]-l[1]}function f(l){return l[2]>=l[5]?0:l[5]-l[2]}function c(l,e){return Math.max(e[0],
l[0])<=Math.min(e[3],l[3])&&Math.max(e[1],l[1])<=Math.min(e[4],l[4])&&Math.max(e[2],l[2])<=Math.min(e[5],l[5])}function h(l,e){l[0]=e[0];l[1]=e[1];l[2]=e[2];l[3]=e[3];l[4]=e[4];l[5]=e[5];return l}function n(l){return 6===l.length}const d=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],w=[0,0,0,0,0,0],t=g();a.allFinite=function(l){for(let e=0;6>e;e++)if(!isFinite(l[e]))return!1;return!0};a.center=function(l,e=[0,0,0]){e[0]=l[0]+m(l)/2;e[1]=l[1]+b(l)/2;e[2]=l[2]+f(l)/2;return e};a.contains=
function(l,e){return e[0]>=l[0]&&e[1]>=l[1]&&e[2]>=l[2]&&e[3]<=l[3]&&e[4]<=l[4]&&e[5]<=l[5]};a.containsPoint=function(l,e){return e[0]>=l[0]&&e[1]>=l[1]&&e[2]>=l[2]&&e[0]<=l[3]&&e[1]<=l[4]&&e[2]<=l[5]};a.containsPointWithMargin=function(l,e,u){return e[0]>=l[0]-u&&e[1]>=l[1]-u&&e[2]>=l[2]-u&&e[0]<=l[3]+u&&e[1]<=l[4]+u&&e[2]<=l[5]+u};a.create=g;a.depth=b;a.diameter=function(l){const e=m(l),u=f(l);l=b(l);return Math.sqrt(e*e+u*u+l*l)};a.empty=function(l){return l?h(l,d):g(d)};a.equals=function(l,e,
u){if(null==l||null==e)return l===e;if(!n(l)||!n(e))return!1;if(u)for(let x=0;x<l.length;x++){if(!u(l[x],e[x]))return!1}else for(u=0;u<l.length;u++)if(l[u]!==e[u])return!1;return!0};a.expandWithAABB=function(l,e){l[0]=Math.min(l[0],e[0]);l[1]=Math.min(l[1],e[1]);l[2]=Math.min(l[2],e[2]);l[3]=Math.max(l[3],e[3]);l[4]=Math.max(l[4],e[4]);l[5]=Math.max(l[5],e[5])};a.expandWithBuffer=function(l,e,u=0,x=e.length/3){let y=l[0],A=l[1],k=l[2],v=l[3],B=l[4],z=l[5];for(let E=0;E<x;E++)y=Math.min(y,e[u+3*E]),
A=Math.min(A,e[u+3*E+1]),k=Math.min(k,e[u+3*E+2]),v=Math.max(v,e[u+3*E]),B=Math.max(B,e[u+3*E+1]),z=Math.max(z,e[u+3*E+2]);l[0]=y;l[1]=A;l[2]=k;l[3]=v;l[4]=B;l[5]=z};a.expandWithNestedArray=function(l,e,u){const x=e.length;let y=l[0],A=l[1],k=l[2],v=l[3],B=l[4],z=l[5];if(u)for(u=0;u<x;u++){var E=e[u];y=Math.min(y,E[0]);A=Math.min(A,E[1]);k=Math.min(k,E[2]);v=Math.max(v,E[0]);B=Math.max(B,E[1]);z=Math.max(z,E[2])}else for(u=0;u<x;u++)E=e[u],y=Math.min(y,E[0]),A=Math.min(A,E[1]),v=Math.max(v,E[0]),
B=Math.max(B,E[1]);l[0]=y;l[1]=A;l[2]=k;l[3]=v;l[4]=B;l[5]=z};a.expandWithOffset=function(l,e,u,x){l[0]=Math.min(l[0],l[0]+e);l[3]=Math.max(l[3],l[3]+e);l[1]=Math.min(l[1],l[1]+u);l[4]=Math.max(l[4],l[4]+u);l[2]=Math.min(l[2],l[2]+x);l[5]=Math.max(l[5],l[5]+x)};a.expandWithRect=function(l,e){l[0]=Math.min(l[0],e[0]);l[1]=Math.min(l[1],e[1]);l[3]=Math.max(l[3],e[2]);l[4]=Math.max(l[4],e[3])};a.expandWithVec3=function(l,e){l[0]=Math.min(l[0],e[0]);l[1]=Math.min(l[1],e[1]);l[2]=Math.min(l[2],e[2]);l[3]=
Math.max(l[3],e[0]);l[4]=Math.max(l[4],e[1]);l[5]=Math.max(l[5],e[2])};a.fromExtent=function(l,e=g()){e[0]=l.xmin;e[1]=l.ymin;e[2]=l.hasZ?l.zmin:-Infinity;e[3]=l.xmax;e[4]=l.ymax;e[5]=l.hasZ?l.zmax:Infinity;return e};a.fromMinMax=function(l,e,u=g()){u[0]=l[0];u[1]=l[1];u[2]=l[2];u[3]=e[0];u[4]=e[1];u[5]=e[2];return u};a.fromRect=function(l,e){l[0]=e[0];l[1]=e[1];l[2]=Number.NEGATIVE_INFINITY;l[3]=e[2];l[4]=e[3];l[5]=Number.POSITIVE_INFINITY;return l};a.fromRectValues=function(l,e,u,x,y){l[0]=e;l[1]=
u;l[2]=Number.NEGATIVE_INFINITY;l[3]=x;l[4]=y;l[5]=Number.POSITIVE_INFINITY;return l};a.fromValues=p;a.getMax=function(l,e){e[0]=l[3];e[1]=l[4];e[2]=l[5];return e};a.getMin=function(l,e){e[0]=l[0];e[1]=l[1];e[2]=l[2];return e};a.height=f;a.intersects=c;a.intersectsClippingArea=function(l,e){return null==e?!0:c(l,e)};a.is=n;a.isPoint=function(l){return 0===m(l)&&0===b(l)&&0===f(l)};a.maximumDimension=function(l){return Math.max(m(l),f(l),b(l))};a.negativeInfinity=d;a.offset=function(l,e,u,x,y=l){y[0]=
l[0]+e;y[1]=l[1]+u;y[2]=l[2]+x;y[3]=l[3]+e;y[4]=l[4]+u;y[5]=l[5]+x;return y};a.positiveInfinity=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];a.scale=function(l,e,u=l){const x=l[0]+m(l)/2,y=l[1]+b(l)/2,A=l[2]+f(l)/2;u[0]=x+(l[0]-x)*e;u[1]=y+(l[1]-y)*e;u[2]=A+(l[2]-A)*e;u[3]=x+(l[3]-x)*e;u[4]=y+(l[4]-y)*e;u[5]=A+(l[5]-A)*e;return u};a.set=h;a.setMax=function(l,e,u=l){u[3]=e[0];u[4]=e[1];u[5]=e[2];u!==l&&(u[0]=l[0],u[1]=l[1],u[2]=l[2]);return l};a.setMin=function(l,e,u=l){u[0]=e[0];u[1]=
e[1];u[2]=e[2];u!==l&&(u[3]=l[3],u[4]=l[4],u[5]=l[5]);return u};a.size=function(l,e=[0,0,0]){e[0]=m(l);e[1]=b(l);e[2]=f(l);return e};a.toExtent=function(l,e){return isFinite(l[2])||isFinite(l[5])?new q({xmin:l[0],xmax:l[3],ymin:l[1],ymax:l[4],zmin:l[2],zmax:l[5],spatialReference:e}):new q({xmin:l[0],xmax:l[3],ymin:l[1],ymax:l[4],spatialReference:e})};a.toRect=function(l,e){e||=r.create();e[0]=l[0];e[1]=l[1];e[2]=l[3];e[3]=l[4];return e};a.width=m;a.wrap=function(l,e,u,x,y,A){return p(l,e,u,x,y,A,
t)};a.zero=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","./OptimizedGeometry"],function(a,q){class r{constructor(p=null,m={},b,f){this.geometry=p;this.attributes=m;this.centroid=b;this.objectId=f;this.geohashY=this.geohashX=this.displayId=0}static fromJSON(p,m){const b=p.geometry?q.fromJSON(p.geometry):null,f=p.centroid?q.fromJSON(p.centroid):null;return new r(b,p.attributes,f,p.attributes[m])}weakClone(){const p=
new r(this.geometry,this.attributes,this.centroid,this.objectId);p.displayId=this.displayId;p.geohashX=this.geohashX;p.geohashY=this.geohashY;return p}clone(){var p=this.geometry?.clone();p=new r(p,{...this.attributes},this.centroid?.clone(),this.objectId);p.displayId=this.displayId;p.geohashX=this.geohashX;p.geohashY=this.geohashY;return p}}class g extends r{}a.OptimizedFeature=r;a.OptimizedFeatureWithGeometry=g;a.hasGeometry=function(p){return!!p.geometry?.coords?.length};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){class a{constructor(){this.spatialReference=this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1;this.queryGeometry=this.queryGeometryType=this.uniqueIdField=null}weakClone(){const q=new a;q.objectIdFieldName=this.objectIdFieldName;
q.globalIdFieldName=this.globalIdFieldName;q.geohashFieldName=this.geohashFieldName;q.geometryProperties=this.geometryProperties;q.geometryType=this.geometryType;q.spatialReference=this.spatialReference;q.hasZ=this.hasZ;q.hasM=this.hasM;q.features=this.features;q.fields=this.fields;q.transform=this.transform;q.exceededTransferLimit=this.exceededTransferLimit;q.uniqueIdField=this.uniqueIdField;q.queryGeometry=this.queryGeometry;q.queryGeometryType=this.queryGeometryType;return q}}return a})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],
function(a){a.aggregateValidFiltersMask=254;a.createDisplayId=function(q,r){return((r?8388608:0)|q)>>>0};a.displayIdTexelMask=8388607;a.displayIdTypeAggregate=1;a.displayIdTypeFeature=0;a.displayIdTypeMask=8388608;a.getDisplayIdFilterMask=q=>1===(q&8388608)>>>23?254:255;a.getDisplayIdTexel=q=>q&8388607;a.getDisplayIdType=q=>(q&8388608)>>>23;a.isAggregateId=function(q){return 1===(q&8388608)>>>23};a.nonAggregateValidFiltersMask=255;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports",
"./BoundingBox","../util/serializationUtils"],function(a,q,r){class g{constructor(p,m,b,f,c,h,n,d,w=[]){this.entityTexel=p;this.anchorX=m;this.anchorY=b;this.directionX=f;this.directionY=c;this.maxScale=h;this.minScale=n;this.referenceBounds=d;this.bounds=w}serialize(p){p.push(this.entityTexel);p.writeF32(this.anchorX);p.writeF32(this.anchorY);p.writeF32(this.directionX);p.writeF32(this.directionY);p.writeF32(this.maxScale);p.writeF32(this.minScale);null===this.referenceBounds?(p.writeF32(0),p.writeF32(0),
p.writeF32(0)):(p.writeF32(this.referenceBounds.size),p.writeF32(this.referenceBounds.offsetX),p.writeF32(this.referenceBounds.offsetY));r.serializeList(p,this.bounds)}static deserialize(p){const m=p.readInt32(),b=p.readF32(),f=p.readF32(),c=p.readF32(),h=p.readF32(),n=p.readF32(),d=p.readF32(),w=p.readF32(),t=p.readF32(),l=p.readF32();p=r.deserializeList(p,q)??[];return new g(m,b,f,c,h,n,d,{size:w,offsetX:t,offsetY:l},p)}}a.LabelMetric=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../../../../../symbols/cim/constants"],function(a,q){function r(h,n,d){h[0]=n[0]-d[0];h[1]=n[1]-d[1];return h}function g(h){var n=h[0];var d=h[1];n=Math.sqrt(n*n+d*d);h[0]/=n;h[1]/=n}function p(h){return h.length-1}function m(h){let n=0;for(let d=0;d<p(h);d++)n+=b(h,d);return n}function b(h,n,d=1){let [w,t]=h[n+1];[w,t]=[Math.round(w),Math.round(t)];return Math.sqrt(w*w+t*t)*d}function f(h,n,d,w,t){if(!(d<n)){var l=
w.clone().seek(d/2);null!=l&&(h(l.clone(),d,t),d=(d-n)/2,l=l.seek(n/2),f(h,n,d,w,t+1),f(h,n,d,l,t+1))}}class c{constructor(h,n,d,w,t){this._segments=h;this._index=n;this._distance=d;this._xStart=w;this._yStart=t;this._done=!1}static create(h){return new c(h,0,0,h[0][0],h[0][1])}clone(){return new c(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(h){return this._index===h._index||h._index===this._index-1&&(0===this._distance||1===h._distance)||h._index===this._index+1&&(1===
this._distance||0===h._distance)}leq(h){return this._index<h._index||this._index===h._index&&this._distance<=h._distance}geq(h){return this._index>h._index||this._index===h._index&&this._distance>=h._distance}get _segment(){return this._segments[this._index+1]}get angle(){const h=this.dy;let n=Math.acos((0*h+-1*-this.dx)/(1*this.length));0<h&&(n=2*Math.PI-n);return n}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+
this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:h,dy:n}=this;return Math.sqrt(h*h+n*n)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=
this._index-1}hasNext(){return this._index+1<p(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(h,n){var d=this.backwardLength;if(h<=d)return this._distance=(d-h)/this.length,this;for(d=this.backwardLength;this.prev();){if(d+this.length>h)return this._seekBackwards(h-
d);d+=this.length}this._distance=0;return n?this:null}seek(h,n=!1){if(0>h)return this._seekBackwards(Math.abs(h),n);if(h<=this.remainingLength)return this._distance=(this.backwardLength+h)/this.length,this;let d=this.remainingLength;for(;this.next();){if(d+this.length>h)return this.seek(h-d,n);d+=this.length}this._distance=1;return n?this:null}}a.SegmentCursor=c;a.pathDivide=function(h,n,d,w=!0){const t=m(h);h=c.create(h);const l=t/2;if(w){w=Math.floor(Math.max((t-n)/2,0)/n);h.seek(l-w*n);for(let e=
-w;e<=w;e++)Math.abs(h.x)<q.maxTileCoordValue&&Math.abs(h.y)<q.maxTileCoordValue&&d(h.clone(),e,l+e*n,t),h.seek(n)}else h.seek(l),Math.abs(h.x)<q.maxTileCoordValue&&Math.abs(h.y)<q.maxTileCoordValue&&d(h.clone(),0,l+0*n,t)};a.pathLength=m;a.pathSubdivide=function(h,n,d){f(d,n,m(h),c.create(h),0)};a.segmentAt=function(h,n){return h[n+1]};a.segmentCount=p;a.segmentLength=b;a.smoothPaths=function(h,n){for(let G=0;G<h.length;G++){let C=h[G];a:{var d=C,w=n;if(0>=w)break a;const F=d.length;if(3>F)break a;
const J=[];var t=0;J.push(0);for(var l=1;l<F;l++){var e=d[l],u=d[l-1],x=e[0]-u[0];e=e[1]-u[1];t+=Math.sqrt(x*x+e*e);J.push(t)}w=Math.min(w,.2*t);x=[];x.push(d[0][0]);x.push(d[0][1]);t=d[F-1][0];l=d[F-1][1];e=r([0,0],d[0],d[1]);g(e);d[0][0]+=w*e[0];d[0][1]+=w*e[1];r(e,d[F-1],d[F-2]);g(e);d[F-1][0]+=w*e[0];d[F-1][1]+=w*e[1];for(e=1;e<F;e++)J[e]+=w;J[F-1]+=w;e=.5*w;for(u=1;u<F-1;u++){let T=0,S=0,ba=0;for(var y=u-1;0<=y&&!(J[y+1]<J[u]-e);y--){var A=e+J[y+1]-J[u],k=J[y+1]-J[y],v=J[u]-J[y]<e?1:A/k;if(1E-6>
Math.abs(v))break;var B=v*v,z=v*A-.5*B*k,E=v*k/w,K=d[y+1],I=d[y][0]-K[0],D=d[y][1]-K[1];T+=E/z*(K[0]*v*A+.5*B*(A*I-k*K[0])-B*v*k*I/3);S+=E/z*(K[1]*v*A+.5*B*(A*D-k*K[1])-B*v*k*D/3);ba+=E}for(y=u+1;y<F&&!(J[y-1]>J[u]+e);y++){A=e-J[y-1]+J[u];k=J[y]-J[y-1];v=J[y]-J[u]<e?1:A/k;if(1E-6>Math.abs(v))break;B=v*v;z=v*A-.5*B*k;E=v*k/w;K=d[y-1];I=d[y][0]-K[0];D=d[y][1]-K[1];T+=E/z*(K[0]*v*A+.5*B*(A*I-k*K[0])-B*v*k*I/3);S+=E/z*(K[1]*v*A+.5*B*(A*D-k*K[1])-B*v*k*D/3);ba+=E}x.push(T/ba);x.push(S/ba)}x.push(t);x.push(l);
for(let T=0,S=0;T<F;T++)d[T][0]=x[S++],d[T][1]=x[S++]}d=[];d.push(C[0]);for(w=1;w<C.length;w++){const [F,J]=C[w-1],[T,S]=C[w];d.push([T-F,S-J])}C=h[G]=d}return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(a){a.dashRadius=15.5;a.maxTileCoordValue=1024;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t){const l=[4,4];var e=[16,4];const u={topLeft:e,topRight:e,bottomLeft:e,bottomRight:e};e=[4,2];const x=[4,6],y={topLeft:e,topRight:e,bottomLeft:x,bottomRight:x},A={topLeft:e,topRight:x,bottomLeft:e,bottomRight:x},k={topLeft:x,topRight:x,bottomLeft:l,bottomRight:l},v={topLeft:l,topRight:l,bottomLeft:x,bottomRight:x},B={topLeft:x,topRight:l,bottomLeft:x,bottomRight:l},z={topLeft:l,topRight:x,bottomLeft:l,bottomRight:x},E={createComputedParams:I=>I,optionalAttributes:{zoomRange:{type:t.DataType.UNSIGNED_SHORT,
count:2,packPrecisionFactor:b.minMaxZoomPrecisionFactor,packTessellation:({minZoom:I,maxZoom:D})=>[I||0,D||28]},clipAngle:{type:t.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:I})=>Math.round(254/360*(I||0))},referenceSymbol:{type:t.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(I,D)=>{if(!I.referenceBounds)return[0,0,0,0];const G=m.getXDirection(D.horizontalAlignment);D=m.getYDirection(D.verticalAlignment);const {offsetX:C,offsetY:F,size:J}=I.referenceBounds;return[r.pt2px(C),
-r.pt2px(F),r.pt2px(J),G+1<<2|D+1]}}},attributes:{pos:{type:t.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:t.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:t.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:I,mapAligned:D})=>c.packBitset([[d.bitsetTextIsBackground,I],[d.bitsetTextIsMapAligned,!!D]])},offset:{type:t.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:I})=>{const {bottomLeft:D,bottomRight:G,
topLeft:C,topRight:F}=I;return[C,F,D,G]}}},textureUV:{type:t.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:I})=>{const {bottomLeft:D,bottomRight:G,topLeft:C,topRight:F}=I;return[C,F,D,G]}}},color:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:I})=>I},fontSize:{type:t.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:I})=>r.pt2px(I)},referenceSize:{type:t.DataType.UNSIGNED_BYTE,count:1,
packPrecisionFactor:4,packTessellation:({fontSize:I},{referenceSize:D})=>r.pt2px(D??I)},haloColor:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:I})=>c.processColorInput(I)},haloFontSize:{type:t.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:I})=>r.pt2px(I)}}};class K extends n.MeshWriter{constructor(){super(...arguments);this.vertexSpec=E;this._textMeshParamsPropsInitialized=!1}ensurePacked(I,D,G){super.ensurePacked(I,D,G);if(!this._textMeshParamsPropsInitialized||
this._evaluator.hasDynamicProperties)this._textMeshTransformProps=new w.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(I,D,G){const C=this._getShaping();if(C){var F=D.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(I,D,C,G);if(G?.nextPath())return G.nextPoint(),this._writeGlyphs(I,F,G.x,G.y,C,0);if("esriGeometryPolygon"===D.geometryType){D=D.readCentroidForDisplay();if(!D)return;const [J,T]=D.coords;return this._writeGlyphs(I,
F,J,T,C,0)}if("esriGeometryMultipoint"===D.geometryType)D.readGeometryForDisplay()?.forEachVertex((J,T)=>this._writeGlyphs(I,F,J,T,C,0));else return G=D.readXForDisplay(),D=D.readYForDisplay(),this._writeGlyphs(I,F,G,D,C,0)}}_writePlacedTextMarkers(I,D,G,C){if(C=C??g.GeometryCursor.fromFeatureSetReaderCIM(D))if(C=p.CIMMarkerPlacementHelper.getPlacement(C,-1,this.evaluatedMeshParams.placement,r.pt2px(1),I.id,h.getGeometryEngine())){D=D.getDisplayId();for(var F=C.next();null!=F;){const J=F.tx,T=-F.ty;
F=-F.getAngle();this._writeGlyphs(I,D,J,T,G,F);F=C.next()}}}_getShaping(I){const D=this._textMeshTransformProps,G=this.evaluatedMeshParams;if(!G.glyphs?.glyphs.length)return null;const C=Math.round(r.pt2px(D.fontSize)),F=r.pt2px(D.offsetX),J=r.pt2px(D.offsetY),T=q.clamp(r.pt2px(G.lineWidth),b.minTextLineWidth,b.maxTextLineWidth),S=b.magicLabelLineHeight*q.clamp(G.lineHeightRatio,.25,4);return f.shapeGlyphs(G.glyphs,{scale:C/b.glyphSize,angle:D.postAngle,xOffset:F,yOffset:J,horizontalAlignment:G.horizontalAlignment,
verticalAlignment:I||G.verticalAlignment,maxLineWidth:T,lineHeight:S,decoration:G.decoration,borderLineSizePx:r.pt2px(G.boxBorderLineSize),hasBackground:!!G.boxBackgroundColor,useCIMAngleBehavior:G.useCIMAngleBehavior})}_writeGlyphs(I,D,G,C,F,J,T,S){const ba=this.evaluatedMeshParams;var M=this._textMeshTransformProps;const U=M.fontSize;var R=r.pt2px(M.offsetX),Z=r.pt2px(M.offsetY);const [ea,ma]=c.getMinMaxZoom(ba.scaleInfo,this.getTileInfo());0!==J&&F.setRotation(J);M=F.bounds;R=G+M.x+R;Z=C+M.y-Z;
M=2*Math.max(M.width,M.height)*(ba.minPixelBuffer?ba.minPixelBuffer/U:1);F.textBox&&(I.recordStart(this.instanceId,this.attributeLayout,F.glyphs[0].textureBinding),I.recordBounds(R,Z,M,M),this._writeTextBox(I,D,G,C,F.textBox,T,S),I.recordEnd());for(const V of F.glyphs){I.recordStart(this.instanceId,this.attributeLayout,V.textureBinding);I.recordBounds(R,Z,M,M);const {texcoords:aa,offsets:ja}=V;this._writeQuad(I,D,G,C,{texcoords:aa,offsets:ja,fontSize:U,color:c.processColorInput(ba.color),isBackground:!1,
referenceBounds:T,minZoom:ea,maxZoom:ma,...S});I.recordEnd()}0!==J&&F.setRotation(-J)}_writeTextBox(I,D,G,C,F,J,T){const S=this.evaluatedMeshParams,{fontSize:ba}=this._textMeshTransformProps,{boxBackgroundColor:M,boxBorderLineColor:U}=S;J={isBackground:!0,fontSize:ba,referenceBounds:J,...T};M&&(this._writeQuad(I,D,G,C,{texcoords:u,offsets:F.main,color:c.processColorInput(M),...J}),U||(this._writeQuad(I,D,G,C,{texcoords:k,offsets:F.top,color:c.processColorInput(M),...J}),this._writeQuad(I,D,G,C,{texcoords:v,
offsets:F.bot,color:c.processColorInput(M),...J}),this._writeQuad(I,D,G,C,{texcoords:B,offsets:F.left,color:c.processColorInput(M),...J}),this._writeQuad(I,D,G,C,{texcoords:z,offsets:F.right,color:c.processColorInput(M),...J})));U&&(this._writeQuad(I,D,G,C,{texcoords:y,offsets:F.top,color:c.processColorInput(U),...J}),this._writeQuad(I,D,G,C,{texcoords:y,offsets:F.bot,color:c.processColorInput(U),...J}),this._writeQuad(I,D,G,C,{texcoords:A,offsets:F.left,color:c.processColorInput(U),...J}),this._writeQuad(I,
D,G,C,{texcoords:A,offsets:F.right,color:c.processColorInput(U),...J}))}_writeQuad(I,D,G,C,F){const J=I.vertexCount();this._writeVertex(I,D,G,C,F);I.indexWrite(J+0);I.indexWrite(J+1);I.indexWrite(J+2);I.indexWrite(J+1);I.indexWrite(J+3);I.indexWrite(J+2)}}a.TextMeshWriter=K;a.TextVertexSpec=E;a.maxLabelZoom=28;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(a,q){class r{static getPlacement(g,
p,m,b,f,c){const h=q.getPlacementOperator(m);if(!h)return null;-1===p&&g.invertY();return h.execute(g,m,b,f,c)}}a.CIMMarkerPlacementHelper=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(a,q){class r{constructor(g){const {offsetX:p,offsetY:m,postAngle:b,fontSize:f,scaleFactor:c,transforms:h}=g;this.offsetX=p;this.offsetY=m;this.postAngle=
b;this.fontSize=Math.min(f,96);(this.transforms=h)&&1<h.infos.length&&(g=q.applyParentTransform(f,b,!1,p,m,h),this.fontSize=Math.min(g.size,96),this.postAngle=g.rotation,this.offsetX=g.offsetX,this.offsetY=g.offsetY);c&&(this.fontSize*=c,this.offsetX*=c,this.offsetY*=c)}}a.TextMeshTransformProps=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b){const f={createComputedParams:h=>h,optionalAttributes:p.LineVertexSpec.optionalAttributes,attributes:{...p.LineVertexSpec.attributes,bitset:{type:b.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:h,shouldScaleDash:n,isSDF:d})=>g.packBitset([[m.bitsetGenericConsiderAlphaOnly,h],[m.bitsetLineScaleDash,n],[m.bitsetLineIsSdf,d]])},tlbr:{type:b.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:h})=>{const {rect:n,width:d,height:w}=h;h=n.x+r.spritePadding;const t=n.y+r.spritePadding;
return[h,t,h+d,t+w]}},accumulatedDistance:{type:b.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:h})=>h},segmentDirection:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:h,directionY:n})=>[h,n]}}};class c extends p.LineMeshWriter{constructor(h,n,d,w){super(h,n,d,w);this.vertexSpec=f;this._tessellationOptions.textured=!0}_write(h,n,d){if(d=d??q.GeometryCursor.fromFeatureSetReaderCIM(n)){var {sprite:w}=this.evaluatedMeshParams;this._writeGeometry(h,n,
d,w?.textureBinding)}}}a.TexturedLineMeshWriter=c;a.texturedLineVertexSpec=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/constants ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e){function u(v,B,z,E,K=!1){v=g.create();K=K?1:-1;r.identity(v);(B||z)&&r.translate(v,v,[B,-z]);E&&r.rotate(v,v,K*x*-E);return v}const x=3.14159265359/180,y=128/Math.PI,A={createComputedParams:v=>d.ComputedMarkerParams.from(v),optionalAttributes:{zoomRange:{type:e.DataType.SHORT,count:2,packPrecisionFactor:h.minMaxZoomPrecisionFactor,pack:({scaleInfo:v},{tileInfo:B})=>n.getMinMaxZoom(v,B)}},attributes:{pos:{type:e.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
id:{type:e.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:e.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:v,alignment:B,scaleSymbolsProportionally:z,overrideOutlineColor:E,colorLocked:K})=>{let I=0;v.sdf&&(I|=n.getBitMask(w.MarkerConstants.bitset.isSDF));B===f.Alignment.MAP&&(I|=n.getBitMask(w.MarkerConstants.bitset.isMapAligned));z&&(I|=n.getBitMask(w.MarkerConstants.bitset.scaleSymbolsProportionally));E&&(I|=n.getBitMask(w.MarkerConstants.bitset.overrideOutlineColor));K&&(I|=n.getBitMask(w.MarkerConstants.bitset.colorLocked));
return I}},offset:{type:e.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:v,computedWidth:B,computedHeight:z,anchorX:E,anchorY:K,offsetX:I,offsetY:D,rotateClockwise:G})=>{v=u(0,I,D,-v,G);E=-(.5+E)*B;G=-(.5-K)*z;K=[E,G];I=[E+B,G];D=[E,G+z];B=[E+B,G+z];p.transformMat2d(K,K,v);p.transformMat2d(I,I,v);p.transformMat2d(D,D,v);p.transformMat2d(B,B,v);return[K,I,D,B]}}},textureUV:{type:e.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:v,
texXmin:B,texYmax:z,texYmin:E})=>[[B,E],[v,E],[B,z],[v,z]]}},color:{type:e.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:v})=>n.processColorInput(v)},outlineColor:{type:e.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:v})=>n.processColorInput(v)},sizing:{type:e.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:v,rawHeight:B,outlineSize:z,referenceSize:E})=>[n.packByteSqrt(Math.max(v,B),128),n.packByteSqrt(z,128),n.packByteSqrt(E,128),0]},placementAngle:{type:e.DataType.UNSIGNED_BYTE,
count:1,packTessellation:({placementAngle:v})=>{v*=y;v%=256;return Math.abs(0<=v?v:v+256)}},sizeRatio:{type:e.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:v})=>v}}};class k extends l.MeshWriter{constructor(){super(...arguments);this.vertexSpec=A}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(v,B,z){var E=this.evaluatedMeshParams.sprite?.textureBinding;const K=B.getDisplayId();v.recordStart(this.instanceId,this.attributeLayout,E);E=this.evaluatedMeshParams.minPixelBuffer;
const I=Math.max(this.evaluatedMeshParams.computedWidth,E),D=Math.max(this.evaluatedMeshParams.computedHeight,E),G=this.evaluatedMeshParams.offsetX,C=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(v,B,z,I,D);else if(z?.nextPath())z.nextPoint(),B=z.x,z=z.y,v.recordBounds(B+G,z+C,I,D),this._writeQuad(v,K,B,z);else if("esriGeometryPolygon"===B.geometryType){B=B.readCentroidForDisplay();if(!B)return;const [F,J]=B.coords;v.recordBounds(F+G,J+C,I,
D);this._writeQuad(v,K,F,J)}else"esriGeometryPoint"===B.geometryType?(z=B.readXForDisplay(),B=B.readYForDisplay(),v.recordBounds(z+G,B+C,I,D),this._writeQuad(v,K,z,B)):B.readGeometryForDisplay()?.forEachVertex((F,J)=>{v.recordBounds(F+G,J+C,I,D);Math.abs(F)>b.maxTileCoordValue||Math.abs(J)>b.maxTileCoordValue||this._writeQuad(v,K,F,J)});v.recordEnd()}_writePlacedMarkers(v,B,z,E,K){if(z=z??m.GeometryCursor.fromFeatureSetReaderCIM(B)?.clone())if(z=c.CIMMarkerPlacementHelper.getPlacement(z,-1,this.evaluatedMeshParams.placement,
q.pt2px(1),v.id,t.getGeometryEngine())){B=B.getDisplayId();for(var I=z.next(),D=this.evaluatedMeshParams.offsetX,G=-this.evaluatedMeshParams.offsetY;null!=I;){const C=I.tx,F=-I.ty;Math.abs(C)>b.maxTileCoordValue||Math.abs(F)>b.maxTileCoordValue?I=z.next():(I=-I.getAngle(),v.recordBounds(C+D,F+G,E,K),this._writeQuad(v,B,C,F,I),I=z.next())}}}_writeQuad(v,B,z,E,K){const I=v.vertexCount();this._writeVertex(v,B,z,E,null==K?null:{placementAngle:K});v.indexWrite(I+0);v.indexWrite(I+1);v.indexWrite(I+2);
v.indexWrite(I+1);v.indexWrite(I+3);v.indexWrite(I+2)}}a.MarkerMeshWriter=k;a.MarkerVertexSpec=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils","../../../definitions"],function(a,q,r,g,p){class m{static from(b){return"width"in b?this.fromSimpleMeshParams(b):
this.fromComplexMeshParams(b)}static fromSimpleMeshParams(b){const f=new m(b.sprite,b.color,b.outlineColor,b.minPixelBuffer,b.placement,b.scaleInfo,b.effects),{type:c,width:h,height:n,angle:d,alignment:w,outlineSize:t,referenceSize:l,sprite:e,overrideOutlineColor:u}=b;f.rawWidth=q.pt2px(h);f.rawHeight=q.pt2px(n);f.angle=d;f.alignment=w;f.outlineSize=q.pt2px(t);f.referenceSize=q.pt2px(l);f.overrideOutlineColor=u;f.offsetX=q.pt2px(b.offsetX);f.offsetY=q.pt2px(b.offsetY);"simple"!==c||e.sdf||(f.rawWidth=
e.width,f.rawHeight=e.height);f.sizeRatio=e.sdf?2:1;f._computeSize(b,!1);return f}static fromComplexMeshParams(b){const f=new m(b.sprite,b.color,b.outlineColor,b.minPixelBuffer,b.placement,b.scaleInfo,b.effects);let {alignment:c,transforms:h,size:n,scaleX:d,anchorX:w,anchorY:t,angle:l,colorLocked:e,frameHeight:u,widthRatio:x,offsetX:y,offsetY:A,outlineSize:k,referenceSize:v,scaleFactor:B,sizeRatio:z,isAbsoluteAnchorPoint:E,rotateClockwise:K,scaleSymbolsProportionally:I,sprite:D}=b;if(h&&0<h.infos.length){var G=
g.applyParentTransform(n,l,K,y,A,h);n=G.size;l=G.rotation;y=G.offsetX;A=G.offsetY;K=!1}B&&(n*=B,y*=B,A*=B);G=D.width/D.height*d;f.alignment=c;f.rawHeight=q.pt2px(n);f.rawWidth=f.rawHeight*G;f.referenceSize=q.pt2px(v);f.sizeRatio=z;f.angle=l;f.rotateClockwise=K;f.anchorX=w;f.anchorY=t;f.offsetX=q.pt2px(y);f.offsetY=q.pt2px(A);E&&n&&(f.anchorX=D.sdf?w/(n*x):w/(n*G),f.anchorY=t/n);G=I&&u?n/u:1;f.outlineSize=0===k||isNaN(k)?0:q.pt2px(k)*G;f.scaleSymbolsProportionally=I;f.colorLocked=e;f._computeSize(b,
!0);return f}constructor(b,f,c,h,n,d,w){this.sprite=b;this.color=f;this.outlineColor=c;this.minPixelBuffer=h;this.placement=n;this.scaleInfo=d;this.effects=w;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=0;this.sizeRatio=1;this.alignment=r.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=this.scaleSymbolsProportionally=!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=
0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(b,f){const {sprite:c,hasSizeVV:h}=b;var n=!!c.sdf;const {rawWidth:d,rawHeight:w,sizeRatio:t,outlineSize:l}=this;b=d*t;const e=w*t;if(n&&!h){var u=l+2;this.computedWidth=Math.min((f&&d>w?b:d)+u,b);this.computedHeight=Math.min(w+u,e)}else this.computedWidth=b,this.computedHeight=e;f=n?Math.max(c.width,c.height)/Math.max(b,e):1;u=.5*(b-this.computedWidth)*
f;var x=.5*(e-this.computedHeight)*f;f=c.rect.x+p.spritePadding+u;n=c.rect.y+p.spritePadding+x;u=f+c.width-2*u;x=n+c.height-2*x;this.texXmin=Math.floor(f);this.texYmin=Math.floor(n);this.texXmax=Math.ceil(u);this.texYmax=Math.ceil(x);this.computedWidth*=(this.texXmax-this.texXmin)/(u-f);this.computedHeight*=(this.texYmax-this.texYmin)/(x-n);this.anchorX*=b/this.computedWidth;this.anchorY*=e/this.computedHeight}}a.ComputedMarkerParams=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(a){a.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../grouping ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),
function(a,q,r,g,p,m,b,f){async function c(t,l,e=!1){const {defaultValue:u,valueExpressionInfo:x,value:y}=l;if(x){const {expression:A}=x;return(t=await t.createComputedField({expression:A},e))?{...l,computed:t,defaultValue:u}:null}return{...l,computed:new f.DictionaryValue(y),defaultValue:u}}async function h(t,l){const {defaultValue:e,valueExpressionInfo:u}=l,{expression:x}=u;return(t=await t.createComputedField({expression:x}))?{...l,computed:t,defaultValue:e}:null}const n=t=>"boolean"!==typeof t&&
"number"!==typeof t&&"valueExpressionInfo"in t,d=t=>t.some(l=>{for(const e in l)if(n(l[e]))return!0;return!1});class w{static async create(t,l,e){const u={},x=new Map,y=new Map,A=new Map,k=new Map,v=new Map;for(const z in e){const E=e[z];if(null==E||"object"!==typeof E)u[z]=E;else if(Array.isArray(E)){if("object"===typeof E[0])throw Error(`InternalError: Cannot handle ${z}. Nested array params are not supported`);u[z]=E}else if("valueExpressionInfo"in E)if(E.value)u[z]=E.value;else{var B=await h(t,
E);B?(x.set(z,B),u[z]=null):u[z]=E.defaultValue}else switch(E.type){case "cim-effect-infos":if(E.effectInfos.some(K=>K.overrides.length)){y.set(z,{effects:await Promise.all(E.effectInfos.map(async K=>{const I=K.overrides.map(D=>c(t,D));return{effect:K.effect,compiledOverrides:(await Promise.all(I)).filter(q.isSome)}}))});break}u[z]=E.effectInfos.map(K=>K.effect);break;case "cim-marker-placement-param":E.overrides.length&&A.set(z,{placementInfo:E,compiledOverrides:(await Promise.all(E.overrides.map(K=>
c(t,K)))).filter(q.isSome)});u[z]=E.placement;break;case "text-rasterization-param":if(E.overrides.length){B=E.overrides.map(K=>c(t,K,E.useLegacyLabelEvaluationRules));k.set(z,{compiledOverrides:(await Promise.all(B)).filter(q.isSome),rasterizationParam:E,objectIdToResourceId:new Map});continue}u[z]=await l.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "sprite-rasterization-param":if(E.overrides.length){B=E.overrides.map(K=>c(t,K));k.set(z,{compiledOverrides:(await Promise.all(B)).filter(q.isSome),
rasterizationParam:E,objectIdToResourceId:new Map});continue}if("animated"===E.resource.type){k.set(z,{compiledOverrides:[],rasterizationParam:E,objectIdToResourceId:new Map});continue}u[z]=await l.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "cim-marker-transform-param":({params:B}=E);if(d(B)){const K={compiledMarkerInfos:[]};await Promise.all(B.map(async I=>{const D={props:{}};for(const G in I)if(n(I[G])){const C=await h(t,I[G]);D.compiledExpressionMap||
(D.compiledExpressionMap=new Map);const F=D.compiledExpressionMap;C&&F.set(G,C)}else D.props[G]=I[G];K.compiledMarkerInfos.push(D)}));v.set(z,K)}else u[z]={type:"cim-marker-transform-info",infos:B};break;default:u[z]=E}}return new w(e,u,x,y,A,k,v)}constructor(t,l,e,u,x,y,A){this.inputMeshParams=t;this._resolvedMeshParams=l;this._dynamicProperties=e;this._dynamicEffectProperties=u;this._dynamicPlacementProperties=x;this._dynamicAsyncProperties=y;this._dynamicTransformProperties=A;this.evaluator=k=>
k}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(t,l,e){for(const x of this._dynamicAsyncProperties.values()){var u=g.clone(x.rasterizationParam.resource);"animated"===
x.rasterizationParam.resource.type&&x.rasterizationParam.resource.randomizeStartTime&&(u.primitiveName="__RESERVED__PRIMITIVE__NAME__",u.startGroup=m.getStartGroup(l.getObjectId()||0));for(const {primitiveName:y,propertyName:A,computed:k,defaultValue:v,valueExpressionInfo:B}of x.compiledOverrides)try{b.applyComputedValue(u,"animated"===x.rasterizationParam.resource.type?u.primitiveName:y,A,k,l,e,v)}catch(z){p.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new r("invalid-arcade-expression",
`Encountered an error when evaluating the arcade expression '${B?.expression}' (primitive: '${y}', property: '${A}')`,z))}u=t.enqueueRequest({type:"cim-rasterization-info",resource:u});x.objectIdToResourceId.set(l.getObjectId(),u)}}evaluateMeshParams(t,l,e){for(const [y,A]of this._dynamicProperties.entries())this._resolvedMeshParams[y]=A.computed.readWithDefault(l,e,A.defaultValue);for(const [y,A]of this._dynamicPlacementProperties.entries())for(const {computed:k,defaultValue:v,propertyName:B}of A.compiledOverrides){var u=
k.readWithDefault(l,e,v);A.placementInfo.placement[B]=u;this._resolvedMeshParams[y]=A.placementInfo.placement}for(const [y,A]of this._dynamicEffectProperties.entries())for(var x of A.effects){for(const {computed:k,defaultValue:v,propertyName:B}of x.compiledOverrides)u=k.readWithDefault(l,e,v),x.effect[B]=u;this._resolvedMeshParams[y]=A.effects.map(k=>k.effect)}for(const [y,A]of this._dynamicTransformProperties.entries()){x={type:"cim-marker-transform-info",infos:[]};for(const k of A.compiledMarkerInfos){u=
{...k.props};if(k.compiledExpressionMap)for(const [v,B]of k.compiledExpressionMap){const z=B.computed.readWithDefault(l,e,B.defaultValue);u[v]="number"===typeof z||"boolean"===typeof z?z:B.defaultValue}x.infos.push(u)}this._resolvedMeshParams[y]=x}for(const [y,A]of this._dynamicAsyncProperties.entries())e=A.objectIdToResourceId.get(l.getObjectId()),null!=e&&(e=t.getResource(e),this._resolvedMeshParams[y]=e);this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}}
a.MeshWriterInputEvaluator=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(a,q){function r(g,p){if("string"===typeof g)g=q.numericHash(g+`-seed(${p})`);else{let m=12;g^=p;do g=107*(g>>8^g)+m|0;while(0!==--m)}return(1+g/-2147483648)/2}a.getRandomValue=r;a.getStartGroup=function(g){return Math.floor(10*r(g,53290320))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(g){super();this._value=g}resize(g){}read(g,p){return this._value}readWithDefault(g,p,m){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}a.DictionaryValue=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(a){class q{destroy(){}}
a.AComputedField=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(a,q,r,g,p){const m={createComputedParams:f=>f,optionalAttributes:{},attributes:{pos:{type:p.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:p.DataType.UNSIGNED_BYTE,
count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1,pack:f=>0},offset:{type:p.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:f})=>{f=q.pt2px(f);const c=-f/2,h=-f/2;return[[c,h],[c+f,h],[c,h+f],[c+f,h+f]]}}},texCoords:{type:p.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:p.DataType.UNSIGNED_BYTE,count:2,pack:({size:f})=>[f,f]},referenceSize:{type:p.DataType.UNSIGNED_BYTE,count:1,
pack:({size:f})=>q.pt2px(f)},zoomRange:{type:p.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:f},{tileInfo:c})=>r.getMinMaxZoom(f,c)}}};class b extends g.MeshWriter{constructor(){super(...arguments);this.vertexSpec=m}_write(f,c){const h=c.getDisplayId();var n=this.evaluatedMeshParams.minPixelBuffer,d=Math.max(q.pt2px(this.evaluatedMeshParams.size),n);if("esriGeometryPoint"===c.geometryType)n=c.readXForDisplay(),c=c.readYForDisplay();else{c=c.readCentroidForDisplay();if(!c)return;n=c?.coords[0];c=
c?.coords[1]}f.recordStart(this.instanceId,this.attributeLayout);f.recordBounds(n,c,d,d);d=f.vertexCount();this._writeVertex(f,h,n,c);f.indexWrite(d+0);f.indexWrite(d+1);f.indexWrite(d+2);f.indexWrite(d+1);f.indexWrite(d+3);f.indexWrite(d+2);f.recordEnd()}}a.PieChartMeshWriter=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MatcherContext":function(){define(["exports"],function(a){class q{constructor(r,g,p,m){this.storage=r;this.proxy=g;this.viewParams=
p;this.registry=m}async createMeshWriters(r){r=r.map(g=>this.registry.createMeshWriter(this.storage,this.proxy,this.viewParams,g));return Promise.all(r)}}a.MatcherContext=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/ProcessorTileMessageQueue":function(){define(["exports","../../../support/QueueProcessor"],function(a,q){class r{constructor(g){this._outstandingMessages=[];this._queue=new q.QueueProcessor({concurrency:g.concurrency,process:p=>g.process(p)})}async push(g){if(g.end)await Promise.all(this._outstandingMessages),
await this._queue.push(g),this._outstandingMessages=[];else return g=this._queue.push(g),this._outstandingMessages.push(g),g}}a.ProcessorTileMessageQueue=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/BinningStrategy":function(){define("exports ../../../../../geometry ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/data/projectionSupport ../aggregation/ComputedAggregateField ./AAggregateStrategy ./AProcessorStrategy ../sources/FeatureSourceMessage ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../../tiling/TileKey ../../../../../geometry/SpatialReference".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l){class e extends f.ASendState{constructor(x,y){super(x);this.bins=new Map;this.featureCache=new Map;this.done=!1;this._store=y}reset(){this.destroy();this.done=!1}destroy(){const x=this.subscription.tile.key.level;for(const y of this.featureCache.keys())this._store.releaseDisplayIdForObjectId(`${y}.${x}`);this.bins.clear();this.featureCache.clear();this.handledChunks.clear()}get tile(){return this.subscription.tile}*featuresWorldSpace(){for(const x of this.featureCache.values()){const y=
x.clone();y.geometry&&r.unquantizeOptimizedGeometry(y.geometry,y.geometry,!1,!1,this.subscription.tile.transform);yield y}}}class u extends b.AAggregateStrategy{static async create(x,y,A,k,v){const B=new h.ComputedAttributeStorage({spatialReference:y}),z=await Promise.all(x.fields.map(async K=>m.ComputedAggregateField.create(B,K))),E=x.featureFilter?await n.create({geometryType:A.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:A.metadata.timeInfo,fieldsIndex:A.metadata.fieldsIndex,spatialReference:y,
filterJSON:x.featureFilter}):null;"geohash"===x.index.type&&await p.checkProjectionSupport(y,l.WGS84);return new u(x,E,v,z,y,A,k)}constructor(x,y,A,k,v,B,z){super(B,z,v,k);this._schema=x;this._featureFilter=y;this._timeZone=A;this._metadata=new d.FeatureMetadata({geometryType:"esriGeometryPolygon",objectIdField:"aggregateId",fields:x.fields,globalIdField:null,spatialReference:B.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,
types:null})}createState(x){return new e(x,this._attributeStore)}async *applyLocalEdit(x){for(const y of this._sendStates.values())y.reset(),yield new c.FeatureTileAppendMessage(y.subscription,w.FeatureSetReaderJSON.empty(this._source.metadata),!0,!1,{})}displayMap(x,y,A){x=new Map(x.map(B=>[y(B),B]));const k=[];for(const B of this._sendStates.values())for(const z of B.featuresWorldSpace()){const {objectId:E,displayId:K}=z;var v=x.get(E);null!=v&&(v=A(K,v,E),k.push(v),x.delete(E))}return k}getDisplayFeatures(x){x=
new Set(x);const y=new Set,A=[];for(const k of this._sendStates.values())for(const v of k.featuresWorldSpace())x.has(v.displayId)&&!y.has(v.objectId)&&(v.geometry&&A.push({...r.convertToFeature(v,this._metadata.geometryType,!1,!1),displayId:v.displayId}),y.add(v.objectId));return{features:[],aggregates:A}}getFeatureObjectIdsForAggregate(x){for(const y of this._sendStates.values())for(const A of y.bins.values())if(A.id===x)return Array.from(A.containedObjectIds);return[]}async *updateChunks(){if(this._source.chunks().length)for(const x of this._sendStates.values())yield*this._update(x,
this._source)}forEachAggregateWorldSpace(x){for(const y of this._sendStates.values())for(const A of y.featuresWorldSpace())x(A)}_createIndexOptions(x){switch(this._schema.index.type){case "geohash":return{type:"geohash",fields:this.aggregateFields,featureFilter:this._featureFilter,geohashLevel:this._schema.index.fixBinLevel,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:x.scale};case "grid":const y=this._schema.index.fixedBinLevel;x=null!=y?x.tileInfoView.getLODInfoAt(y).scale:
x.scale;return{type:"grid",fields:this.aggregateFields,cellSize:this._schema.index.size,featureFilter:this._featureFilter,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:x}}}async *_update(x,y){const {handledChunks:A,subscription:k,bins:v,featureCache:B}=x;var z=k.tile;if(!x.done){for(var E of y.chunks())if(!A.has(E.chunkId)){A.add(E.chunkId);var K=E.queryInfo;if("tileId"in K&&(K=new t(K.tileId),K.level!==z.level||K.world!==z.key.world))continue;E.getAggregateIndex(this._createIndexOptions(x.tile)).putBounded(v,
x.tile.extent,x.tile.resolution)}z=[];E=k.tile.transform;K=k.tile.key.level;for(var I of v.values()){let D=B.get(I.id);if(D)D.attributes=I.getAttributes();else{const G=I.getGeometry(this.spatialReference,E);D=new g.OptimizedFeature(G,I.getAttributes(),null);G||(D.centroid=I.getGeometricCentroid(this.spatialReference,E));D.objectId=I.id;D.displayId=this._attributeStore.createDisplayIdForObjectId(`${D.objectId}.${K}`);B.set(I.id,D)}z.push(D)}this.events.emit("changed");x.done=!y.updateTracking.updating;
y=w.FeatureSetReaderJSON.fromOptimizedFeatures(z,this._metadata,E);I=y.getCursor();for(z=x.subscription.tile.createArcadeEvaluationOptions(this._timeZone);I.next();)this._attributeStore.setAttributeData(I.getDisplayId(),I,z);yield new c.FeatureTileUpdateMessage(x.subscription,y,[],x.done,{})}}}a.BinningState=e;a.BinningStrategy=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,q,r,g,p,m,b){function f(e,u){if(!u)return null;if("x"in u){var x={x:0,y:0};[x.x,x.y]=e(u.x,u.y,n);null!=u.z&&(x.z=u.z);null!=u.m&&(x.m=u.m);return x}return"xmin"in u?(x={xmin:0,ymin:0,xmax:0,ymax:0},[x.xmin,x.ymin]=e(u.xmin,u.ymin,n),[x.xmax,x.ymax]=e(u.xmax,u.ymax,n),u.hasZ&&(x.zmin=u.zmin,x.zmax=u.zmax,x.hasZ=!0),u.hasM&&(x.mmin=u.mmin,x.mmax=u.mmax,x.hasM=!0),x):"rings"in u?{rings:c(u.rings,e),hasM:u.hasM,hasZ:u.hasZ}:"paths"in u?{paths:c(u.paths,e),hasM:u.hasM,hasZ:u.hasZ}:"points"in
u?{points:h(u.points,e),hasM:u.hasM,hasZ:u.hasZ}:null}function c(e,u){const x=[];for(const y of e)x.push(h(y,u));return x}function h(e,u){const x=[];for(const y of e)e=u(y[0],y[1],[0,0]),x.push(e),2<y.length&&e.push(y[2]),3<y.length&&e.push(y[3]);return x}const n=[0,0],d=f.bind(null,b.lngLatToXY),w=f.bind(null,b.xyToLngLat);class t{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(e,u,x,y){if(!e?.length||!u||!x||m.equals(u,x))return e;e={geometries:e,inSpatialReference:u,
outSpatialReference:x,geographicTransformation:y,resolve:r.createResolver()};this._jobs.push(e);this._timer??(this._timer=setTimeout(this._process,10));return e.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(e){var {geometries:u,inSpatialReference:x,outSpatialReference:y,resolve:A,geographicTransformation:k}=e;b.canProject(x,y)?m.isWebMercator(y)?A(u.map(d)):A(u.map(w)):A(g.projectMany(p.jsonAdapter,u,x,y,k,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const l=new t;a.checkProjectionSupport=async function(e,u){e&&u&&(e=Array.isArray(e)?e.map(x=>null!=x.geometry?x.geometry.spatialReference:null).filter(q.isSome):[e],await g.initializeProjection(e.map(x=>({source:x,dest:u}))))};a.project=function(e,u,x,y){if(!e)return e;x||(x=u,u=e.spatialReference);return m.isValid(u)&&m.isValid(x)&&!m.equals(u,x)?b.canProject(u,x)?(e=m.isWebMercator(x)?d(e):w(e),e.spatialReference=x,e):g.projectMany(p.jsonAdapter,[e],u,x,null,y)[0]:e};a.projectMany=function(e,
u,x,y){return l.push(e,u,x,y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class q{constructor(b,f,c){this.x=b;this.y=f;this.spatialReference=c;this.m=this.z=void 0}}class r{constructor(b,f,c,h){this.rings=b;this.spatialReference=f;this.hasM=this.hasZ=void 0;c&&(this.hasZ=c);h&&(this.hasM=h)}}class g{constructor(b,f,c,h){this.paths=b;this.spatialReference=f;this.hasM=this.hasZ=void 0;c&&(this.hasZ=
c);h&&(this.hasM=h)}}class p{constructor(b,f,c,h){this.points=b;this.spatialReference=f;this.hasM=this.hasZ=void 0;c&&(this.hasZ=c);h&&(this.hasM=h)}}class m{constructor(b,f,c,h,n){this.xmin=b;this.ymin=f;this.xmax=c;this.ymax=h;this.spatialReference=n;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(b,f){return null==f?null:b.convertJSONToGeometry(f)},exportPoint:function(b,f,c){c=new q(b.getPointX(f),b.getPointY(f),c);const h=b.hasZ(f),n=b.hasM(f);h&&(c.z=
b.getPointZ(f));n&&(c.m=b.getPointM(f));return c},exportPolygon:function(b,f,c){return new r(b.exportPaths(f),c,b.hasZ(f),b.hasM(f))},exportPolyline:function(b,f,c){return new g(b.exportPaths(f),c,b.hasZ(f),b.hasM(f))},exportMultipoint:function(b,f,c){return new p(b.exportPoints(f),c,b.hasZ(f),b.hasM(f))},exportExtent:function(b,f,c){var h=b.hasZ(f);const n=b.hasM(f);c=new m(b.getXMin(f),b.getYMin(f),b.getXMax(f),b.getYMax(f),c);h&&(h=b.getZExtent(f),c.zmin=h.vmin,c.zmax=h.vmax);n&&(b=b.getMExtent(f),
c.mmin=b.vmin,c.mmax=b.vmax);return c}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/ComputedAggregateField":function(){define(["exports","../support/DictionaryValue"],function(a,q){class r{static async create(g,p){if("count"===p.statisticType)return g=new q.DictionaryValue(1),new r(p.name,p.alias,p.type,p.statisticType,g);g=await g.createComputedField({expression:p.onStatisticExpression?.expression,field:p.onStatisticField});return new r(p.name,
p.alias,p.type,p.statisticType,g)}constructor(g,p,m,b,f){this.name=g;this.alias=p;this.type=m;this.statisticType=b;this.computed=f}}a.ComputedAggregateField=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AAggregateStrategy":function(){define("exports ../../../../../core/Evented ../../../../../geometry/support/aaBoundingBox ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../../../../layers/graphics/data/QueryEngine ./AProcessorStrategy".split(" "),
function(a,q,r,g,p,m,b){class f extends b.AProcessorStrategy{constructor(c,h,n,d){super(c,h);this.spatialReference=n;this.aggregateFields=d;this.events=new q;this.featureAdapter=p.optimizedFeatureQueryEngineAdapter}get aggregateQueryEngine(){this._aggregateQueryEngine||(this._aggregateQueryEngine=new m.QueryEngine({featureStore:this,fieldsIndex:this._metadata.fieldsIndex,geometryType:this._metadata.geometryType,objectIdField:this._metadata.objectIdField,spatialReference:this.spatialReference}));return this._aggregateQueryEngine}removeChunks(c){}forEach(c){return this.forEachAggregateWorldSpace(c)}forEachInBounds(c,
h){}forEachBounds(c,h){const n=r.create();for(const d of c)(c=g.getBoundsOptimizedGeometry(n,d.geometry,!1,!1))&&h(c)}}a.AAggregateStrategy=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,q,r,g){a.optimizedFeatureQueryEngineAdapter={getObjectId(p){return p.objectId},getAttributes(p){return p.attributes},getAttribute(p,
m){return p.attributes[m]},cloneWithGeometry(p,m){return new r.OptimizedFeature(m,p.attributes,null,p.objectId)},getGeometry(p){return p.geometry},getCentroid(p,m){null==p.centroid&&(p.centroid=q.getCentroidOptimizedGeometry(new g,p.geometry,m.hasZ,m.hasM));return p.centroid}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function q(g,p,m,b,f,c){c=f?c?4:3:c?3:2;let h=m,n=m+c,d=0,w=0,t=m=0,l=0;for(let e=0,u=
b-1;e<u;e++,h+=c,n+=c){b=p[h];const x=p[h+1],y=p[h+2],A=p[n],k=p[n+1],v=p[n+2];let B=b*k-A*x;t+=B;d+=(b+A)*B;w+=(x+k)*B;f&&(B=b*v-A*y,m+=(y+v)*B,l+=B);b<g[0]&&(g[0]=b);b>g[1]&&(g[1]=b);x<g[2]&&(g[2]=x);x>g[3]&&(g[3]=x);f&&(y<g[4]&&(g[4]=y),y>g[5]&&(g[5]=y))}0<t&&(t*=-1);0<l&&(l*=-1);if(!t)return null;g=[d,w,.5*t];f&&(g[3]=m,g[4]=.5*l);return g}function r(g,p,m,b,f){f=b?f?4:3:f?3:2;let c=p,h=p+f,n=0,d=0,w=0,t=0;for(let x=0,y=m-1;x<y;x++,c+=f,h+=f){var l=g[c];const A=g[c+1],k=g[c+2],v=g[h],B=g[h+1],
z=g[h+2];if(b){var e=v-l;var u=B-A;const E=z-k;e=Math.sqrt(e*e+u*u+E*E)}else e=v-l,u=B-A,e=Math.sqrt(e*e+u*u);e&&(n+=e,b?(l=[l+.5*(v-l),A+.5*(B-A),k+.5*(z-k)],d+=e*l[0],w+=e*l[1],t+=e*l[2]):(l=[l+.5*(v-l),A+.5*(B-A)],d+=e*l[0],w+=e*l[1]))}return 0<n?b?[d/n,w/n,t/n]:[d/n,w/n]:0<m?b?[g[p],g[p+1],g[p+2]]:[g[p],g[p+1]]:null}a.getCentroidOptimizedGeometry=function(g,p,m,b){if(!p?.lengths.length)return null;g.lengths.length&&(g.lengths.length=0);g.coords.length&&(g.coords.length=0);const f=g.coords,c=[],
h=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:n,coords:d}=p;var w=m?b?4:3:b?3:2;let t=0;for(const l of n){const e=q(h,d,t,l,m,b);e&&c.push(e);t+=l*w}c.sort((l,e)=>{let u=l[2]-e[2];0===u&&m&&(u=l[4]-e[4]);return u});c.length&&(w=6*c[0][2],f[0]=c[0][0]/w,f[1]=c[0][1]/w,m&&(w=6*c[0][4],
f[2]=0!==w?c[0][3]/w:0),f[0]<h[0]||f[0]>h[1]||f[1]<h[2]||f[1]>h[3]||m&&(f[2]<h[4]||f[2]>h[5]))&&(f.length=0);if(!f.length)if(p=p.lengths[0]?r(d,0,n[0],m,b):null)f[0]=p[0],f[1]=p[1],m&&2<p.length&&(f[2]=p[2]);else return null;return g};a.lineCentroid=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A,k,v,B,z,E,K,I,D){function G(S){if(E.canQueryWithRBush(S)){if(t.isExtent(S))return[d.fromValues(Math.min(S.xmin,S.xmax),Math.min(S.ymin,S.ymax),Math.max(S.xmin,S.xmax),Math.max(S.ymin,S.ymax))];if(t.isPolygon(S))return S.rings.map(ba=>d.fromValues(Math.min(ba[0][0],ba[2][0]),Math.min(ba[0][1],ba[2][1]),Math.max(ba[0][0],ba[2][0]),Math.max(ba[0][1],ba[2][1])))}return[w.getBoundsXY(d.create(),S)]}class C{constructor(S,ba=null,M,U,R){this.attributes=S;
this.geometry=M;this.centroid=U;this.filterFlags=R;this.groupId=-1;this.displayId=ba}}const F=new b.MemCacheStorage(2E6);let J=0;class T{constructor(S){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:k.queryCapabilities};this.geometryType=S.geometryType;this.hasM=!!S.hasM;this.hasZ=!!S.hasZ;this.objectIdField=S.objectIdField;this.spatialReference=S.spatialReference;this.definitionExpression=S.definitionExpression;this.featureStore=S.featureStore;this.aggregateAdapter=S.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=S.timeInfo;S.cacheSpatialQueries&&(this._geometryQueryCache=new b.MemCache(J++ +"$$",F));this.fieldsIndex=g.isSerializable(S.fieldsIndex)?S.fieldsIndex:I.fromJSON(S.fieldsIndex);this.availableFields=!S.availableFields||1===S.availableFields.length&&"*"===S.availableFields[0]?new Set(this.fieldsIndex.fields.map(ba=>ba.name)):new Set(S.availableFields.map(ba=>this.fieldsIndex.get(ba)?.name).filter(ba=>null!=
ba));S.scheduler&&S.priority&&(this._frameTask=S.scheduler.registerTask(S.priority))}destroy(){this._frameTask=m.removeMaybe(this._frameTask);this.clearCache();m.destroyMaybe(this._geometryQueryCache);this._changeHandle=m.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(S,ba){ba=f.signalFromSignalOrOptions(ba);try{return(await this._executeQuery(S,
{},ba)).createQueryResponse()}catch(M){if(M!==B.queryEngineEmptyResult)throw M;return(new v.QueryEngineResult([],S,this)).createQueryResponse()}}async executeQueryForCount(S={},ba){ba=f.signalFromSignalOrOptions(ba);try{return(await this._executeQuery(S,{returnGeometry:!1,returnCentroid:!1,outSR:null},ba)).createQueryResponseForCount()}catch(M){if(M!==B.queryEngineEmptyResult)throw M;return 0}}async executeQueryForExtent(S,ba){ba=f.signalFromSignalOrOptions(ba);const M=S.outSR;try{const U=await this._executeQuery(S,
{returnGeometry:!0,returnCentroid:!1,outSR:null},ba),R=U.size;if(!R)return{count:0,extent:null};const Z=await this._getBounds(U.items,U.spatialReference,M||this.spatialReference);return{count:R,extent:Z}}catch(U){if(U===B.queryEngineEmptyResult)return{count:0,extent:null};throw U;}}async executeQueryForIds(S,ba){return this.executeQueryForIdSet(S,ba).then(M=>Array.from(M))}async executeQueryForIdSet(S,ba){ba=f.signalFromSignalOrOptions(ba);try{const M=await this._executeQuery(S,{returnGeometry:!0,
returnCentroid:!1,outSR:null},ba),U=M.items,R=new Set;await this._reschedule(()=>{for(const Z of U)R.add(M.featureAdapter.getObjectId(Z))},ba);return R}catch(M){if(M===B.queryEngineEmptyResult)return new Set;throw M;}}async executeQueryForSnapping(S,ba){const M=f.signalFromSignalOrOptions(ba),{point:U,distance:R,returnEdge:Z,vertexMode:ea}=S;if(!Z&&"none"===ea)return{candidates:[]};let ma=p.clone(S.query);ma=await this._schedule(()=>B.normalizeQueryLike(ma,this.definitionExpression,this.spatialReference),
M);ma=await this._reschedule(()=>z.validateQuery(ma,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);(ba=!e.equals(U.spatialReference,this.spatialReference))&&await A.checkProjectionSupport(U.spatialReference,this.spatialReference);var V="number"===typeof R?R:R.x,aa="number"===typeof R?R:R.y;V={xmin:U.x-V,xmax:U.x+V,ymin:U.y-aa,ymax:U.y+aa,spatialReference:U.spatialReference};V=ba?A.project(V,this.spatialReference):
V;if(!V)return{candidates:[]};aa=(await l.normalizeCentralMeridian(t.fromJSON(U),null,{signal:M}))[0];const ja=(await l.normalizeCentralMeridian(t.fromJSON(V),null,{signal:M}))[0];if(null==aa||null==ja)return{candidates:[]};const oa=new v.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(G(ja.toJSON())),M),ma,this);await this._reschedule(()=>this._executeObjectIdsQuery(oa),M);await this._reschedule(()=>this._executeTimeQuery(oa),M);await this._reschedule(()=>this._executeAttributesQuery(oa),
M);await this._reschedule(()=>this._executeGeometryQueryForSnapping(oa,M),M);aa=aa.toJSON();aa=ba?A.project(aa,this.spatialReference):aa;return oa.createSnappingResponse({...S,point:aa,distance:ba?Math.max(V.xmax-V.xmin,V.ymax-V.ymin)/2:R},U.spatialReference)}async executeQueryForLatestObservations(S,ba){ba=f.signalFromSignalOrOptions(ba);if(!this.timeInfo?.trackIdField)throw new r("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:S,timeInfo:this.timeInfo});try{const M=await this._executeQuery(S,
{},ba);await this._reschedule(()=>this._filterLatest(M),ba);return M.createQueryResponse()}catch(M){if(M!==B.queryEngineEmptyResult)throw M;return(new v.QueryEngineResult([],S,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(S={},ba,M){M=f.signalFromSignalOrOptions(M);const {field:U,normalizationField:R,valueExpression:Z}=ba;return(await this._executeQueryForStatistics(S,{field:U,normalizationField:R,valueExpression:Z},M)).createSummaryStatisticsResponse(ba)}async executeQueryForUniqueValues(S=
{},ba,M){M=f.signalFromSignalOrOptions(M);const {field:U,field2:R,field3:Z,valueExpression:ea}=ba;return(await this._executeQueryForStatistics(S,{field:U,field2:R,field3:Z,valueExpression:ea},M)).createUniqueValuesResponse(ba)}async executeQueryForClassBreaks(S={},ba,M){M=f.signalFromSignalOrOptions(M);const {field:U,normalizationField:R,valueExpression:Z}=ba;return(await this._executeQueryForStatistics(S,{field:U,normalizationField:R,valueExpression:Z},M)).createClassBreaksResponse(ba)}async executeQueryForHistogram(S=
{},ba,M){M=f.signalFromSignalOrOptions(M);const {field:U,normalizationField:R,valueExpression:Z}=ba;return(await this._executeQueryForStatistics(S,{field:U,normalizationField:R,valueExpression:Z},M)).createHistogramResponse(ba)}async fetchRecomputedExtents(S){S=f.signalFromSignalOrOptions(S);this._timeExtentPromise||(this._timeExtentPromise=K.getTimeExtent(this.timeInfo,this.featureStore));const [ba,M]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);f.throwIfAborted(S);return{fullExtent:ba,
timeExtent:M}}async _getBounds(S,ba,M){const U=n.set(n.create(),n.negativeInfinity);await this.featureStore.forEachBounds(S,R=>n.expandWithAABB(U,R));S={xmin:U[0],ymin:U[1],xmax:U[3],ymax:U[4],spatialReference:y.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(U[2])&&isFinite(U[5])&&(S.zmin=U[2],S.zmax=U[5],S.hasZ=!0);ba=A.project(S,ba,M);ba.spatialReference=y.cleanFromGeometryEngine(M);0===ba.xmax-ba.xmin&&(M=c.getMetersPerUnitForSR(ba.spatialReference),ba.xmin-=M,ba.xmax+=M);
0===ba.ymax-ba.ymin&&(M=c.getMetersPerUnitForSR(ba.spatialReference),ba.ymin-=M,ba.ymax+=M);this.hasZ&&null!=ba.zmin&&null!=ba.zmax&&0===ba.zmax-ba.zmin&&(M=c.getMetersPerUnitForSR(ba.spatialReference),ba.zmin-=M,ba.zmax+=M);return ba}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(S=>this._getBounds(S,this.spatialReference,
this.spatialReference)));return this._fullExtentPromise}async _schedule(S,ba){return null!=this._frameTask?this._frameTask.schedule(S,ba):S(D.noBudget)}async _reschedule(S,ba){return null!=this._frameTask?this._frameTask.reschedule(S,ba):S(D.noBudget)}async _getAllFeaturesQueryEngineResult(S){return new v.QueryEngineResult(await this._getAllFeatures(),S,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const M=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(U=>
M.push(U))})().then(()=>M)}const S=this._allFeaturesPromise,ba=await S;return S===this._allFeaturesPromise?ba.slice():this._getAllFeatures()}async _executeQuery(S,ba,M){S=p.clone(S);S=await this._schedule(()=>B.normalizeQuery(S,this.definitionExpression,this.spatialReference),M);S=await this._reschedule(()=>z.validateQuery(S,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);S={...S,...ba};const U=await this._reschedule(()=>
this._executeSceneFilterQuery(S,M),M),R=await this._reschedule(()=>this._executeGeometryQuery(S,U,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(R),M);await this._reschedule(()=>this._executeObjectIdsQuery(R),M);await this._reschedule(()=>this._executeTimeQuery(R),M);await this._reschedule(()=>this._executeAttributesQuery(R),M);return R}async _executeSceneFilterQuery(S,ba){if(null==S.sceneFilter)return null;const {outSR:M,returnGeometry:U,returnCentroid:R}=S;var Z=this.featureStore.featureSpatialReference,
ea=S.sceneFilter.geometry;const ma=null==Z||e.equals(Z,ea.spatialReference)?ea:A.project(ea,Z);if(!ma)return null;Z=U||R;Z=e.isValid(M)&&!e.equals(this.spatialReference,M)&&Z?async oa=>this._project(oa,M):oa=>oa;const V=this.featureAdapter;ea=await this._reschedule(()=>this._searchFeatures(G(ma)),ba);if("disjoint"===S.sceneFilter.spatialRelationship){if(!ea.length)return null;const oa=new Set;for(var aa of ea)oa.add(V.getObjectId(aa));const wa=await this._reschedule(()=>this._getAllFeatures(),ba);
aa=await this._reschedule(async()=>{const ta=await E.getSpatialQueryOperator("esriSpatialRelDisjoint",ma,this.geometryType,this.hasZ,this.hasM),va=await this._runSpatialFilter(wa,xa=>!oa.has(V.getObjectId(xa))||ta(V.getGeometry(xa)),ba);return new v.QueryEngineResult(va,S,this)},ba);return Z(aa)}if(!ea.length)return new v.QueryEngineResult([],S,this);if(this._canExecuteSinglePass(ma,S))return Z(new v.QueryEngineResult(ea,S,this));const ja=await E.getSpatialQueryOperator("esriSpatialRelContains",ma,
this.geometryType,this.hasZ,this.hasM);aa=await this._runSpatialFilter(ea,oa=>ja(V.getGeometry(oa)),ba);return Z(new v.QueryEngineResult(aa,S,this))}async _executeGeometryQuery(S,ba,M){if(null!=ba&&0===ba.items.length)return ba;S=null!=ba?ba.query:S;const {geometry:U,outSR:R,spatialRel:Z,returnGeometry:ea,returnCentroid:ma}=S;var V=this.featureStore.featureSpatialReference;const aa=!U||null==V||e.equals(V,U.spatialReference)?U:A.project(U,V),ja=ea||ma,oa=e.isValid(R)&&!e.equals(this.spatialReference,
R),wa=this._geometryQueryCache&&null==ba?oa&&ja?JSON.stringify({originalFilterGeometry:U,spatialRelationship:Z,outSpatialReference:R}):JSON.stringify({originalFilterGeometry:U,spatialRelationship:Z}):null;V=wa?this._geometryQueryCache.get(wa):null;if(null!=V)return new v.QueryEngineResult(V,S,this);V=async P=>{oa&&ja&&await this._project(P,R);wa&&this._geometryQueryCache.put(wa,P.items,P.items.length+1);return P};if(!aa)return V(null!=ba?ba:await this._getAllFeaturesQueryEngineResult(S));const ta=
this.featureAdapter;let va=await this._reschedule(()=>this._searchFeatures(G(U)),M);if("esriSpatialRelDisjoint"===Z){if(!va.length)return V(null!=ba?ba:await this._getAllFeaturesQueryEngineResult(S));const P=new Set;for(var xa of va)P.add(ta.getObjectId(xa));const fa=null!=ba?ba.items:await this._reschedule(()=>this._getAllFeatures(),M);xa=await this._reschedule(async()=>{const ka=await E.getSpatialQueryOperator(Z,aa,this.geometryType,this.hasZ,this.hasM),qa=await this._runSpatialFilter(fa,Q=>!P.has(ta.getObjectId(Q))||
ka(ta.getGeometry(Q)),M);return new v.QueryEngineResult(qa,S,this)},M);return V(xa)}if(null!=ba){const P=new q.PositionHint;va=va.filter(fa=>0<=q.indexOf(ba.items,fa,ba.items.length,P))}if(!va.length)return V=new v.QueryEngineResult([],S,this),wa&&this._geometryQueryCache.put(wa,V.items,1),V;if(this._canExecuteSinglePass(aa,S))return V(new v.QueryEngineResult(va,S,this));const L=await E.getSpatialQueryOperator(Z,aa,this.geometryType,this.hasZ,this.hasM);xa=await this._runSpatialFilter(va,P=>L(ta.getGeometry(P)),
M);return V(new v.QueryEngineResult(xa,S,this))}async _executeGeometryQueryForSnapping(S,ba){const {query:M}=S,{spatialRel:U}=M;if(S?.items?.length&&M.geometry&&U){var R=await E.getSpatialQueryOperator(U,M.geometry,this.geometryType,this.hasZ,this.hasM);ba=await this._runSpatialFilter(S.items,Z=>R(Z.geometry),ba);S.items=ba}}_executeAggregateIdsQuery(S){if(0!==S.items.length&&S.query.aggregateIds?.length&&null!=this.aggregateAdapter){var ba=new Set;for(const U of S.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(U).forEach(R=>
ba.add(R));var M=this.featureAdapter.getObjectId;S.items=S.items.filter(U=>ba.has(M(U)))}}_executeObjectIdsQuery(S){if(0!==S.items.length&&S.query.objectIds?.length){var ba=new Set(S.query.objectIds),M=this.featureAdapter.getObjectId;S.items=S.items.filter(U=>ba.has(M(U)))}}_executeTimeQuery(S){if(0!==S.items.length){var ba=K.getTimeOperator(this.timeInfo,S.query.timeExtent,this.featureAdapter);null!=ba&&(S.items=S.items.filter(ba))}}_executeAttributesQuery(S){if(0!==S.items.length){var ba=x.getWhereClause(S.query.where,
this.fieldsIndex);if(ba){if(!ba.isStandardized)throw new TypeError("Where clause is not standardized");S.items=S.items.filter(M=>ba.testFeature(M,this.featureAdapter))}}}async _runSpatialFilter(S,ba,M){if(!ba)return S;if(null==this._frameTask)return S.filter(ea=>ba(ea));let U=0;const R=[],Z=async ea=>{for(;U<S.length;){const ma=S[U++];ba(ma)&&(R.push(ma),ea.madeProgress());ea.done&&await this._reschedule(V=>Z(V),M)}};return this._reschedule(ea=>Z(ea),M).then(()=>R)}_filterLatest(S){const {trackIdField:ba,
startTimeField:M,endTimeField:U}=this.timeInfo,R=U||M,Z=new Map,ea=this.featureAdapter.getAttribute;for(const ma of S.items){const V=ea(ma,ba),aa=ea(ma,R),ja=Z.get(V);(!ja||aa>ea(ja,R))&&Z.set(V,ma)}S.items=Array.from(Z.values())}_canExecuteSinglePass(S,ba){({spatialRel:ba}=ba);return E.canQueryWithRBush(S)&&("esriSpatialRelEnvelopeIntersects"===ba||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===ba||"esriSpatialRelContains"===ba))}async _project(S,ba){if(!ba||e.equals(this.spatialReference,
ba))return S;const M=this.featureAdapter;let U=void 0;try{const R=await this._getFullExtent();U=h.getTransformation(this.spatialReference,ba,R)}catch{}ba=await A.projectMany(S.items.map(R=>y.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(R))),this.spatialReference,ba,U);S.items=ba.map((R,Z)=>M.cloneWithGeometry(S.items[Z],u.convertFromGeometry(R,this.hasZ,this.hasM)));return S}async _searchFeatures(S){const ba=new Set;await Promise.all(S.map(M=>this.featureStore.forEachInBounds(M,
U=>ba.add(U))));S=Array.from(ba.values());ba.clear();return S}async _executeQueryForStatistics(S,ba,M){S=p.clone(S);try{S=await this._schedule(()=>B.normalizeQuery(S,this.definitionExpression,this.spatialReference),M);S=await this._reschedule(()=>z.validateStatisticsQuery(S,ba,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);const U=await this._reschedule(()=>this._executeSceneFilterQuery(S,M),M),R=await this._reschedule(()=>
this._executeGeometryQuery(S,U,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(R),M);await this._reschedule(()=>this._executeObjectIdsQuery(R),M);await this._reschedule(()=>this._executeTimeQuery(R),M);await this._reschedule(()=>this._executeAttributesQuery(R),M);return R}catch(U){if(U!==B.queryEngineEmptyResult)throw U;return new v.QueryEngineResult([],S,this)}}}a.Feature=C;a.QueryEngine=T;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports",
"./PooledArray"],function(a,q){a.RemoveMode=void 0;(function(b){b[b.ALL=0]="ALL";b[b.SOME=1]="SOME"})(a.RemoveMode||(a.RemoveMode={}));class r{constructor(b,f,c){this.name=b;this._storage=f;this.id=`${p++}:`;this.size=0;this.maxSize=-1;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);c&&(this._storage.registerRemoveFunc(this.id,c),this._removeFunc=!0)}destroy(){this._storage.clear(this);this._removeFunc&&this._storage.deregisterRemoveFunc(this.id);this._storage.deregister(this);
this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(b){return this._storage.getSize(this,b)}resetHitRate(){this._hit=this._miss=0}put(b,f,c,h=0){this._storage.put(this,b,f,c,h)}pop(b){b=this._storage.pop(this,b);void 0===b?++this._miss:++this._hit;return b}get(b){b=this._storage.get(this,b);void 0===b?++this._miss:++this._hit;return b}peek(b){return this._storage.peek(this,b)}updateSize(b,f,c){this._storage.updateSize(this,b,
f,c)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class g{get size(){return this._size}constructor(b=10485760){this._maxSize=b;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=new q;this._users=new q}destroy(){this.clearAll();this._removeFuncs.clear();this._users.clear();this._db=null}register(b){this._users.push(b)}deregister(b){this._users.removeUnordered(b)}registerRemoveFunc(b,
f){this._removeFuncs.push([b,f])}deregisterRemoveFunc(b){this._removeFuncs.filterInPlace(f=>f[0]!==b)}get maxSize(){return this._maxSize}set maxSize(b){this._maxSize=Math.max(b,-1);this._checkSize()}getSize(b,f){return this._db.get(b.id+f)?.size??0}put(b,f,c,h,n){f=b.id+f;const d=this._db.get(f);d&&(this._size-=d.size,b.size-=d.size,this._db.delete(f),d.entry!==c&&this._notifyRemove(f,d.entry,d.size,a.RemoveMode.ALL));h>this._maxSize?this._notifyRemove(f,c,h,a.RemoveMode.ALL):void 0===c?console.warn("Refusing to cache undefined entry "):
!h||0>h?(console.warn(`Refusing to cache entry with size ${h} for key ${f}`),this._notifyRemove(f,c,0,a.RemoveMode.ALL)):(this._db.set(f,new m(c,h,1+Math.max(n,-4)- -3)),this._size+=h,b.size+=h,this._checkSize())}updateSize(b,f,c,h){f=b.id+f;const n=this._db.get(f);if(n&&n.entry===c){this._size-=n.size;for(b.size-=n.size;h>this._maxSize;)if(h=this._notifyRemove(f,c,h,a.RemoveMode.SOME),!(null!=h&&0<h)){this._db.delete(f);return}n.size=h;this._size+=h;b.size+=h;this._checkSize()}}pop(b,f){f=b.id+f;
const c=this._db.get(f);if(c)return this._size-=c.size,b.size-=c.size,this._db.delete(f),++this._hit,c.entry;++this._miss}get(b,f){f=b.id+f;b=this._db.get(f);if(void 0===b)++this._miss;else return this._db.delete(f),b.lives=b.lifetime,this._db.set(f,b),++this._hit,b.entry}peek(b,f){(b=this._db.get(b.id+f))?++this._hit:++this._miss;return b?.entry}get performanceInfo(){const b={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+
"%",Entries:this._db.size.toString()},f={},c=[];this._db.forEach((d,w)=>{const t=d.lifetime;c[t]=(c[t]||0)+d.size;this._users.forAll(l=>{const {id:e,name:u}=l;w.startsWith(e)&&(f[u]=(f[u]||0)+d.size)})});const h={};this._users.forAll(d=>{const w=d.name;"hitRate"in d&&"number"===typeof d.hitRate&&!isNaN(d.hitRate)&&0<d.hitRate?(f[w]=f[w]||0,h[w]=Math.round(100*d.hitRate)+"%"):h[w]="0%"});var n=Object.keys(f);n.sort((d,w)=>f[w]-f[d]);n.forEach(d=>b[d]=Math.round(f[d]/2**20)+"MB / "+h[d]);for(n=c.length-
1;0<=n;--n){const d=c[n];d&&(b["Priority "+(n+-3-1)]=Math.round(d/this._size*100)+"%")}return b}resetStats(){this._hit=this._miss=0;this._users.forAll(b=>b.resetHitRate())}clear(b){const f=b.id;this._db.forEach((c,h)=>{h.startsWith(f)&&(this._size-=c.size,this._db.delete(h),this._notifyRemove(h,c.entry,c.size,a.RemoveMode.ALL))});b.size=0}clearAll(){this._db.forEach((b,f)=>this._notifyRemove(f,b.entry,b.size,a.RemoveMode.ALL));this._users.forAll(b=>b.size=0);this._size=0;this._db.clear()}_getHitRate(){return this._hit/
(this._hit+this._miss)}_notifyRemove(b,f,c,h){let n;this._removeFuncs.some(d=>b.startsWith(d[0])?(d=d[1](f,h,c),"number"===typeof d&&(n=d),!0):!1);return n}_checkSize(){this._users.forAll(b=>this._checkSizeLimits(b));this._checkSizeLimits()}_checkSizeLimits(b){const f=b??this;if(!(0>f.maxSize||f.size<=f.maxSize)){for(var c=b?.id,h=!0;h;){h=!1;for(const [n,d]of this._db)if(0===d.lifetime&&(!c||n.startsWith(c))){this._purgeItem(n,d,b);if(f.size<=.9*f.maxSize)return;h||=this._db.has(n)}}for(const [n,
d]of this._db)if(!c||n.startsWith(c))if(this._purgeItem(n,d,b),f.size<=.9*f.maxSize)break}}_purgeItem(b,f,c=this._users.find(h=>b.startsWith(h.id))){this._db.delete(b);if(1>=f.lives){this._size-=f.size;c&&(c.size-=f.size);const h=this._notifyRemove(b,f.entry,f.size,a.RemoveMode.SOME);null!=h&&0<h&&(this._size+=h,c&&(c.size+=h),f.lives=f.lifetime,f.size=h,this._db.set(b,f))}else--f.lives,this._db.set(b,f)}}let p=0;class m{constructor(b,f,c){this.entry=b;this.size=f;this.lives=this.lifetime=c}}a.MemCache=
r;a.MemCacheStorage=g;a.MinPriority=-3;a.NoPriority=-4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define("exports ../../config ../../core/Error ../../core/Logger ../Polygon ../Polyline ./normalizeUtilsCommon ./spatialReferenceUtils ./webMercatorUtils ../../rest/geometryService/cut ../../rest/geometryService/simplify".split(" "),function(a,q,r,g,p,m,b,f,c,h,n){function d(y){const A=[];let k=0,v=0;for(let B=0;B<y.length;B++){const z=
y[B];let E=null;for(let K=0;K<z.length;K++)E=z[K],A.push(E),0===K?v=k=E[0]:(k=Math.min(k,E[0]),v=Math.max(v,E[0]));E&&A.push([(k+v)/2,0])}return A}function w(y,A){if(!(y instanceof m||y instanceof p))throw x().error("straightLineDensify: the input geometry is neither polyline nor polygon"),new r("straightLineDensify: the input geometry is neither polyline nor polygon");var k=b.getGeometryParts(y);const v=[];for(const z of k){k=[];v.push(k);k.push([z[0][0],z[0][1]]);for(let E=0;E<z.length-1;E++){const K=
z[E][0],I=z[E][1],D=z[E+1][0],G=z[E+1][1];var B=Math.sqrt((D-K)*(D-K)+(G-I)*(G-I));const C=(G-I)/B,F=(D-K)/B,J=B/A;if(1<J){for(let T=1;T<=J-1;T++){const S=T*A;k.push([F*S+K,C*S+I])}B=(B+Math.floor(J-1)*A)/2;k.push([F*B+K,C*B+I])}k.push([D,G])}}return"polygon"===y.type?new p({rings:v,spatialReference:y.spatialReference}):new m({paths:v,spatialReference:y.spatialReference})}function t(y,A,k){A&&(y=w(y,1E6),y=c.webMercatorToGeographic(y,!0));k&&(y=b.updatePolyGeometry(y,k));return y}function l(y,A,k){if(Array.isArray(y)){var v=
y[0];v>A?(k=b.offsetMagnitude(v,A),y[0]=v+-2*k*A):v<k&&(A=b.offsetMagnitude(v,k),y[0]=v+-2*A*k)}else v=y.x,v>A?(k=b.offsetMagnitude(v,A),y=y.clone().offset(-2*k*A,0)):v<k&&(A=b.offsetMagnitude(v,k),y=y.clone().offset(-2*A*k,0));return y}function e(y,A){let k=-1;for(let v=0;v<A.cutIndexes.length;v++){const B=A.cutIndexes[v],z=A.geometries[v],E=b.getGeometryParts(z);for(let K=0;K<E.length;K++){const I=E[K];I.some(D=>{if(180>D[0])return!0;D=0;for(var G=0;G<I.length;G++){var C=I[G][0];D=C>D?C:D}D=Number(D.toFixed(9));
D=-360*b.offsetMagnitude(D,180);for(G=0;G<I.length;G++)C=z.getPoint(K,G),z.setPoint(K,G,C.clone().offset(D,0));return!0})}if(B===k)if("polygon"===y[0].type)for(const K of b.getGeometryParts(z))y[B]=y[B].addRing(K);else{if("polyline"===y[0].type)for(const K of b.getGeometryParts(z))y[B]=y[B].addPath(K)}else k=B,y[B]=z}return y}async function u(y,A,k){if(!Array.isArray(y))return u([y],A);A&&"string"!==typeof A&&x().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");
var v="string"===typeof A?A:A?.url??q.geometryServiceUrl;let B,z,E;let K=0;var I=[];A=[];for(var D of y)if(null==D)A.push(D);else{if(!G){var G=D.spatialReference;var C=f.getInfo(G);var F=(B=G.isWebMercator)?102100:4326;z=b.cutParams[F].maxX;E=b.cutParams[F].minX;var J=b.cutParams[F].plus180Line;F=b.cutParams[F].minus180Line}if(C)if("mesh"===D.type)A.push(D);else if("point"===D.type)A.push(l(D.clone(),z,E));else if("multipoint"===D.type){var T=D.clone();T.points=T.points.map(S=>l(S,z,E));A.push(T)}else if("extent"===
D.type)T=D.clone()._normalize(!1,!1,C),A.push(T.rings?new p(T):T);else if(D.extent){T=D.extent;const S=2*b.offsetMagnitude(T.xmin,E)*z;let ba=0===S?D.clone():b.updatePolyGeometry(D.clone(),S);T.offset(S,0);let {xmin:M,xmax:U}=T;M=Number(M.toFixed(9));U=Number(U.toFixed(9));T.intersects(J)&&U!==z?(K=U>K?U:K,ba=t(ba,B),I.push(ba),A.push("cut")):T.intersects(F)&&M!==E?(K=2*U*z>K?2*U*z:K,ba=t(ba,B,360),I.push(ba),A.push("cut")):A.push(ba)}else A.push(D.clone());else A.push(D)}G=b.offsetMagnitude(K,z);
C=-90;J=G;for(D=new m;0<G;)F=-180+360*G,D.addPath([[F,C],[F,-1*C]]),C*=-1,G--;if(0<I.length&&0<J){G=await h.cut(v,I,D,k);G=e(I,G);C=[];I=[];for(J=0;J<A.length;J++)D=A[J],"cut"!==D?I.push(D):(D=G.shift(),F=y[J],null!=F&&"polygon"===F.type&&F.rings&&1<F.rings.length&&D.rings.length>=F.rings.length?(C.push(D),I.push("simplify")):I.push(B?c.geographicToWebMercator(D):D));if(!C.length)return I;A=await n.simplify(v,C,k);y=[];for(k=0;k<I.length;k++)v=I[k],"simplify"!==v?y.push(v):y.push(B?c.geographicToWebMercator(A.shift()):
A.shift());return y}y=[];for(k=0;k<A.length;k++)v=A[k],"cut"!==v?y.push(v):(v=I.shift(),y.push(!0===B?c.geographicToWebMercator(v):v));return y}const x=()=>g.getLogger("esri.geometry.support.normalizeUtils");a.getClosestDenormalizedXToReference=function(y,A,k){k=f.getInfo(k);if(null==k)return y;const [v,B]=k.valid;k=2*B;let z=0,E=0;A>B?z=Math.ceil(Math.abs(A-B)/k):A<v&&(z=-Math.ceil(Math.abs(A-v)/k));y>B?E=Math.ceil(Math.abs(y-B)/k):y<v&&(E=-Math.ceil(Math.abs(y-v)/k));y+=(z-E)*k;A=y-A;A>B?y-=k:A<
v&&(y+=k);return y};a.getDenormalizedExtent=function(y){if(!y)return null;const A=y.extent;if(!A)return null;var k=y.spatialReference&&f.getInfo(y.spatialReference);if(!k)return A;const [v,B]=k.valid;({width:k}=A);let {xmin:z,xmax:E}=A;[z,E]=[E,z];if("extent"===y.type||0===k||k<=B||k>2*B||z<v||E>B)return A;let K;switch(y.type){case "polygon":if(1<y.rings.length)K=d(y.rings);else return A;break;case "polyline":if(1<y.paths.length)K=d(y.paths);else return A;break;case "multipoint":K=y.points}y=A.clone();
for(let I=0;I<K.length;I++){let D=K[I][0];0>D?(D+=B,E=Math.max(D,E)):(D-=B,z=Math.min(D,z))}y.xmin=z;y.xmax=E;return y.width<k?(y.xmin-=B,y.xmax-=B,y):A};a.normalizeCentralMeridian=u;a.normalizeMapX=function(y,A){if(A=f.getInfo(A)){const [k,v]=A.valid;A=v-k;if(y<k)for(;y<k;)y+=A;if(y>v)for(;y>v;)y-=A}return y};a.straightLineDensify=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference",
"./jsonUtils"],function(a,q,r,g){function p(m){return g.isPolygon(m)?m.rings:m.paths}q={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new q({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:r.WebMercator}),minus180Line:new q({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new q({paths:[[[180,
-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new q({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};a.cutParams=q;a.getGeometryParts=p;a.offsetMagnitude=function(m,b){return Math.ceil((m-b)/(2*b))};a.updatePolyGeometry=function(m,b){const f=p(m);for(const c of f)for(const h of c)h[0]+=b;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define("exports ../../geometry ../../request ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ../utils".split(" "),
function(a,q,r,g,p,m){a.cut=async function(b,f,c,h){b=m.parseUrl(b);const n=f[0].spatialReference;f={...h,responseType:"json",query:{...b.query,f:"json",sr:p.srToRESTValue(n),target:JSON.stringify({geometryType:g.getJsonType(f[0]),geometries:f}),cutter:JSON.stringify(c)}};f=await r(b.path+"/cut",f);const {cutIndexes:d,geometries:w=[]}=f.data;return{cutIndexes:d,geometries:w.map(t=>{t=g.fromJSON(t);t.spatialReference=n;return t})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define("exports ../config ../kernel ../core/lang ../core/urlUtils ../support/apiKeyUtils".split(" "),
function(a,q,r,g,p,m){function b(f,c,h){const n={};for(const w in f)if("declaredClass"!==w){var d=f[w];null!=d&&"function"!==typeof d&&(Array.isArray(d)?n[w]=d.map(t=>b(t)):"object"===typeof d?d.toJSON?(d=d.toJSON(h?.[w]),n[w]=c?d:JSON.stringify(d)):n[w]=c?d:JSON.stringify(d):n[w]=d)}return n}a.asValidOptions=function(f,c){return c?{...c,query:{...(f??{}),...c.query}}:{query:f}};a.encode=b;a.getToken=function(f,c){return f?m.supportsApiKey(f)&&(c||q.apiKey)?c||q.apiKey:r.id?.findCredential(f)?.token:
null};a.parseUrl=function(f){return"string"===typeof f?p.urlToObject(f):g.clone(f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define("exports ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ./utils".split(" "),function(a,q,r,g,p,m){a.simplify=async function(b,f,c){const h="string"===typeof b?r.urlToObject(b):b;b=f[0].spatialReference;const n=g.getJsonType(f[0]);f={...c,
query:{...h.query,f:"json",sr:p.srToRESTValue(b),geometries:JSON.stringify(m.encodeGeometries(f))}};({data:f}=await q(h.path+"/simplify",f));return m.decodeGeometries(f.geometries,n,b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(a,q){a.decodeGeometries=function(r,g,p){const m=q.getGeometryType(g);return r.map(b=>{b=m.fromJSON(b);b.spatialReference=p;return b})};a.encodeGeometries=
function(r){return{geometryType:q.getJsonType(r[0]),geometries:r.map(g=>g.toJSON())}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,q,r,g){function p(t,l,e={}){const u=m(l,t);if(!u)throw e=n.getError(l,t),new q("unsupported-query","invalid SQL expression",{expression:l,error:e});t=e.expressionName||"expression";
if(e.validateStandardized&&!u.isStandardized)throw new q("unsupported-query",`${t} is not standard`,{expression:l});if(e.validateAggregate&&!u.isAggregate)throw new q("unsupported-query",`${t} does not contain a valid aggregate function`,{expression:l});return u.fieldNames}function m(t,l){return t?n.get(t,l):null}function b(t){return/\((.*?)\)/.test(t)?t:t.split(" as ")[0]}function f(t,l,e,u={}){const x=new Map;c(x,t,l,u.allowedFieldTypes??w,e);if(x.size)throw new q("unsupported-query",`${u.expressionName??
"expression"} contains invalid or missing fields`,{errors:Array.from(x.values()),query:u.query});}function c(t,l,e,u,x){x=x.includes("*")?[...e,...x.filter(y=>"*"!==y)]:x;for(const y of x)if(l.get(y))h(t,l,e,u,y);else try{const A=b(y),k=p(l,A,{validateStandardized:!0});for(const v of k)h(t,l,e,u,v)}catch(A){t.set(y,{type:"expression-error",expression:y,error:A})}}function h(t,l,e,u,x){(l=l.get(x))?e.has(l.name)?"all"!==u&&!1===u?.has(l.type)&&t.set(x,{type:"invalid-type",fieldName:l.name,fieldType:g.kebabDict.fromJSON(l.type),
allowedFieldTypes:Array.from(u,y=>g.kebabDict.fromJSON(y))}):t.set(x,{type:"missing-field",fieldName:l.name}):t.set(x,{type:"invalid-field",fieldName:x})}const n=new r.WhereClauseCache(50,500);r=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const d=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),w=new Set(["esriFieldTypeString",
"esriFieldTypeGUID","esriFieldTypeGlobalID",...r,...d]);a.allDateAndTimeFieldTypes=d;a.getAliasFromFieldName=function(t){return t.split(" as ")[1]};a.getExpressionFromFieldName=b;a.getWhereClause=m;a.numericFieldTypes=r;a.validateFields=f;a.validateHaving=function(t,l,e,u,x){if(!e)return!0;const y=p(t,e,{validateAggregate:!0,expressionName:"having clause"});f(t,l,y,{expressionName:"having clause",query:x});if(!m(e,t)?.getExpressions().every(A=>{const {aggregateType:k,field:v}=A,B=t.get(v)?.name;return u.some(z=>
{const {onStatisticField:E,statisticType:K}=z;return t.get(E)?.name===B&&K.toLowerCase().trim()===k})}))throw new q("unsupported-query","expressions in having clause should also exist in outStatistics",{having:e});return!0};a.validateWhere=function(t,l,e,u){if(!e)return!0;e=p(t,e,{validateStandardized:!0,expressionName:"where clause"});f(t,l,e,{expressionName:"where clause",query:u});return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports",
"../LRUCache","./WhereClause"],function(a,q,r){class g{constructor(p,m){this._cache=new q.LRUCache(p);this._invalidCache=new q.LRUCache(m)}get(p,m){const b=`${m.uid}:${p}`,f=this._cache.get(b);if(f)return f;if(null!=this._invalidCache.get(b))return null;try{const c=r.WhereClause.create(p,m);this._cache.put(b,c);return c}catch(c){return this._invalidCache.put(b,c),null}}getError(p,m){return this._invalidCache.get(`${m.uid}:${p}`)??null}}a.WhereClauseCache=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(a,q){class r{constructor(g,p){this._storage=new q.MemCacheStorage;this.name=this.id="";this.size=0;this._storage.maxSize=g;this._storage.register(this);p&&this._storage.registerRemoveFunc("",p)}destroy(){this._storage.deregister(this);this._storage.destroy()}put(g,p,m=1){this._storage.put(this,g,p,m,1)}pop(g){return this._storage.pop(this,g)}get(g){return this._storage.get(this,g)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(g){this._storage.maxSize=
g}resetHitRate(){}}a.LRUCache=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l){function e(D){return Array.isArray(D)?
D:[D]}function u(D){return null!==D?!0!==D:null}function x(D,G){return null!=D&&null!=G?!0===D&&!0===G:!1===D||!1===G?!1:null}function y(D,G){return null!=D&&null!=G?!0===D||!0===G:!0===D||!0===G?!0:null}function A(D,G,C){if(null==D)return null;C=!1;for(const F of G)if(null==F)C=null;else if(D===F){C=!0;break}else if(f.isDateOrTimeValue(D)&&f.isDateOrTimeValue(F)&&(C=f.sqlCompare(D,F,"\x3d")))break;return C}function k(D,G,C){if(null==D)return null;let F="",J=K.Normal;for(let T=0;T<G.length;T++){const S=
G.charAt(T);switch(J){case K.Normal:S===C?J=K.Escaped:F="-[]/{}()*+?.\\^$|".includes(S)?F+("\\"+S):"%"===S?F+".*":"_"===S?F+".":F+S;break;case K.Escaped:F="-[]/{}()*+?.\\^$|".includes(S)?F+("\\"+S):F+S,J=K.Normal}}return(new RegExp("^"+F+"$","m")).test(D)}function v(D,G,C,F){D=F.getAttribute(D,G);G=C?.get(G);return null==D||"esriFieldTypeDate"!==G?.type&&"date"!==G?.type?null==D||"esriFieldTypeDateOnly"!==G?.type&&"date-only"!==G?.type?null==D||"esriFieldTypeTimeOnly"!==G?.type&&"time-only"!==G?.type?
null==D||"esriFieldTypeTimestampOffset"!==G?.type&&"timestamp-offset"!==G?.type?D:new n.SqlTimeStampOffset(D):w.TimeOnly.fromReader(D):m.DateOnly.fromReader(D):c.convertToExecutingTimeZone(new Date(D),C?.getLuxonTimeZone(G.name)??l.FixedOffsetZone.utcInstance)}const B=new Set(["current_timestamp","current_date","current_time"]);class z{static makeBool(D){return!0===D}static featureValue(D,G,C,F){return v(D,G,C,F)}static equalsNull(D){return null===D}static applyLike(D,G,C){return k(D,G,C)}static ensureArray(D){return e(D)}static applyIn(D,
G,C){return A(D,G)}static currentDate(D){return m.DateOnly.fromNow(D)}static makeSqlInterval(D,G,C){return h.SqlInterval.createFromValueAndQualifier(D,G,C)}static convertInterval(D){return D instanceof h.SqlInterval?D.valueInMilliseconds():D}static currentTimestamp(D){return c.convertToExecutingTimeZone(new Date,D)}static compare(D,G,C,F){return f.sqlCompare(G,C,D)}static calculate(D,G,C,F){return b.sqlCalculateFunction(D,G,C,F)}static evaluateTime(D){return c.parseTime(D)}static evaluateTimestamp(D,
G,C){return c.parseTimestamp(D,G,C)}static evaluateDate(D,G){return c.parseDate(D,G)}static evaluateFunction(D,G,C){return d.evaluateFunction(D,G,C)}static lookup(D,G){D=G[D];return void 0===D?null:D}static between(D,G,C){return null==D||null==G[0]||null==G[1]?null:f.sqlCompare(D,G[0],"\x3e\x3d")&&f.sqlCompare(D,G[1],"\x3c\x3d")}static notbetween(D,G,C){return null==D||null==G[0]||null==G[1]?null:f.sqlCompare(D,G[0],"\x3c")||f.sqlCompare(D,G[1],"\x3e")}static ternaryNot(D){return u(D)}static ternaryAnd(D,
G){return x(D,G)}static ternaryOr(D,G){return y(D,G)}}class E{constructor(D,G,C="UTC"){this.fieldsIndex=G;this.timeZone=C;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=t.WhereGrammar.parse(D);const {isStandardized:F,isAggregate:J,referencedFieldNames:T}=this._extractExpressionInfo(G);this._referencedFieldNames=T;this.isStandardized=F;this.isAggregate=J}static convertValueToStorageFormat(D,G=null){if(null===G)return c.isDate(D)?D.getTime():c.isDateTime(D)?D.toMillis():c.isTimestampOffset(D)?
D.toStorageFormat():c.isTimeOnly(D)?D.toStorageString():c.isDateOnly(D)?D.toStorageFormat():D;switch(G){case "date":if(c.isDate(D))return D.getTime();if(c.isDateTime(D))return D.toMillis();if(c.isTimestampOffset(D))return D.toMilliseconds();if(c.isDateOnly(D))return D.toNumber();break;case "date-only":if(c.isDate(D))return m.DateOnly.fromDateJS(D).toString();if(c.isTimestampOffset(D))return m.DateOnly.fromSqlTimeStampOffset(D).toString();if(c.isDateTime(D))return m.DateOnly.fromDateTime(D).toString();
break;case "time-only":if(c.isDate(D))return w.TimeOnly.fromDateJS(D).toStorageString();if(c.isDateTime(D))return w.TimeOnly.fromDateTime(D).toStorageString();if(c.isTimestampOffset(D))return w.TimeOnly.fromSqlTimeStampOffset(D).toStorageString();if(c.isTimeOnly(D))return D.toStorageString();break;case "timestamp-offset":if(c.isDate(D))return n.SqlTimeStampOffset.fromJSDate(D).toStorageFormat();if(c.isDateTime(D))return n.SqlTimeStampOffset.fromDateTime(D).toStorageFormat();if(c.isTimestampOffset(D))return D.toStorageFormat()}return D}static create(D,
G,C="UTC"){return new E(D,G,C)}get fieldNames(){return this._referencedFieldNames}testSet(D,G=I){return!!this._evaluateNode(this.parseTree,null,G,D)}calculateValue(D,G=I){D=this._evaluateNode(this.parseTree,D,G,null);return D instanceof h.SqlInterval?D.valueInMilliseconds()/864E5:D}calculateValueCompiled(D,G=I){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(D,this.parameters,G,this.fieldsIndex,this.timeZone);if(g("esri-csp-restrictions"))return this.calculateValue(D,
G);this._compileMe();return this.parseTree._compiledVersion(D,this.parameters,G,this.fieldsIndex,this.timeZone)}testFeature(D,G=I){return!!this._evaluateNode(this.parseTree,D,G,null)}testFeatureCompiled(D,G=I){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(D,this.parameters,G,this.fieldsIndex,this.timeZone);if(g("esri-csp-restrictions"))return this.testFeature(D,G);this._compileMe();return!!this.parseTree._compiledVersion(D,this.parameters,G,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=
this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,D=>{"current-time"===D.type?this._hasDateFunctions=!0:"function"===D.type&&(this._hasDateFunctions=this._hasDateFunctions||B.has(D.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const D=new Set;this._visitAll(this.parseTree,G=>{"function"===G.type&&D.add(G.name.toLowerCase())});return Array.from(D)}getExpressions(){const D=new Map;this._visitAll(this.parseTree,G=>{if("function"===
G.type){const C=G.name.toLowerCase();G=G.args.value[0];if("column-reference"===G.type){G=G.column;const F=`${C}-${G}`;D.has(F)||D.set(F,{aggregateType:C,field:G})}}});return[...D.values()]}getVariables(){const D=new Set;this._visitAll(this.parseTree,G=>{"parameter"===G.type&&D.add(G.value.toLowerCase())});return Array.from(D)}_compileMe(){const D="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter",
"fieldsIndex","timeZone",D)).bind(z)}_extractExpressionInfo(D){const G=[],C=new Set;let F=!0,J=!1;this._visitAll(this.parseTree,T=>{switch(T.type){case "column-reference":var S=D?.get(T.column);let ba;S?S=ba=S.name??"":(ba=T.column,S=ba.toLowerCase());C.has(S)||(C.add(S),G.push(ba));T.column=ba;break;case "function":const {name:M,args:U}=T;T=U.value.length;F&&=d.isStandardized(M,T);!1===J&&(J=p.isAggregate(M,T))}});return{referencedFieldNames:Array.from(G),isStandardized:F,isAggregate:J}}_visitAll(D,
G){if(null!=D)switch(G(D),D.type){case "when-clause":this._visitAll(D.operand,G);this._visitAll(D.value,G);break;case "case-expression":for(const C of D.clauses)this._visitAll(C,G);"simple"===D.format&&this._visitAll(D.operand,G);null!==D.else&&this._visitAll(D.else,G);break;case "expression-list":for(const C of D.value)this._visitAll(C,G);break;case "unary-expression":this._visitAll(D.expr,G);break;case "binary-expression":this._visitAll(D.left,G);this._visitAll(D.right,G);break;case "function":this._visitAll(D.args,
G)}}evaluateNodeToJavaScript(D){switch(D.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(D.value)+", "+JSON.stringify(D.qualifier)+","+JSON.stringify(D.op)+")";case "case-expression":var G="";if("simple"===D.format){var C=this.evaluateNodeToJavaScript(D.operand);G="( ";for(let F=0;F<D.clauses.length;F++)G+=" (this.compare('\x3d',"+C+","+this.evaluateNodeToJavaScript(D.clauses[F].operand)+") ? ("+this.evaluateNodeToJavaScript(D.clauses[F].value)+") : "}else for(G=
"( ",C=0;C<D.clauses.length;C++)G+=" this.makeBool("+this.evaluateNodeToJavaScript(D.clauses[C].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(D.clauses[C].value)+") : ";G=null!==D.else?G+this.evaluateNodeToJavaScript(D.else):G+"null";return G+" )";case "parameter":return"this.lookup("+JSON.stringify(D.value.toLowerCase())+",lookups)";case "expression-list":G="[";for(C of D.value)"["!==G&&(G+=","),G+=this.evaluateNodeToJavaScript(C);return G+"]";case "unary-expression":return"this.ternaryNot("+
this.evaluateNodeToJavaScript(D.expr)+")";case "binary-expression":switch(D.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+" )";case "IS":if("null"!==D.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(D.left)+")";case "ISNOT":if("null"!==
D.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(D.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(D.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(D.right)+"), timeZone)";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(D.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(D.right)+"), timeZone))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(D.left)+
","+this.evaluateNodeToJavaScript(D.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+","+JSON.stringify(D.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+","+JSON.stringify(D.escape)+
"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(D.operator)+","+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(D.operator)+","+this.evaluateNodeToJavaScript(D.left)+","+this.evaluateNodeToJavaScript(D.right)+", timeZone)"}throw new r.SqlError(r.SqlErrorCodes.UnsupportedOperator,{operator:D.operator});
case "null":case "boolean":case "string":case "number":return JSON.stringify(D.value);case "time":return"this.evaluateTime("+JSON.stringify(D.value)+")";case "date":return"this.evaluateDate("+JSON.stringify(D.value)+", 'unknown')";case "timestamp":return"this.evaluateTimestamp("+JSON.stringify(D.value)+", 'unknown')";case "current-time":return"date"===D.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(D.column)+
",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(D.name)+","+this.evaluateNodeToJavaScript(D.args)+", timeZone)"}throw new r.SqlError(r.SqlErrorCodes.UnsupportedSyntax,{node:D.type});}_evaluateNode(D,G,C,F){switch(D.type){case "interval":return C=this._evaluateNode(D.value,G,C,F),h.SqlInterval.createFromValueAndQualifier(C,D.qualifier,D.op);case "case-expression":if("simple"===D.format){var J=this._evaluateNode(D.operand,G,C,F);for(var T=0;T<D.clauses.length;T++)if(f.sqlCompare(J,
this._evaluateNode(D.clauses[T].operand,G,C,F),"\x3d",this.timeZone))return this._evaluateNode(D.clauses[T].value,G,C,F)}else for(J=0;J<D.clauses.length;J++)if(!0===this._evaluateNode(D.clauses[J].operand,G,C,F))return this._evaluateNode(D.clauses[J].value,G,C,F);return null!==D.else?this._evaluateNode(D.else,G,C,F):null;case "parameter":return D=this.parameters[D.value.toLowerCase()],c.isDate(D)?l.DateTime.fromJSDate(D):D instanceof q.ArcadeDate?D.toDateTime():D;case "expression-list":J=[];for(var S of D.value)J.push(this._evaluateNode(S,
G,C,F));return J;case "unary-expression":return u(this._evaluateNode(D.expr,G,C,F));case "binary-expression":switch(D.operator){case "AND":return x(this._evaluateNode(D.left,G,C,F),this._evaluateNode(D.right,G,C,F));case "OR":return y(this._evaluateNode(D.left,G,C,F),this._evaluateNode(D.right,G,C,F));case "IS":if("null"!==D.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(D.left,G,C,F);case "ISNOT":if("null"!==D.right.type)throw new r.SqlError(r.SqlErrorCodes.UnsupportedIsRhs);
return null!==this._evaluateNode(D.left,G,C,F);case "IN":return J=e(this._evaluateNode(D.right,G,C,F)),A(this._evaluateNode(D.left,G,C,F),J,this.timeZone);case "NOT IN":return J=e(this._evaluateNode(D.right,G,C,F)),u(A(this._evaluateNode(D.left,G,C,F),J,this.timeZone));case "BETWEEN":return J=this._evaluateNode(D.left,G,C,F),D=this._evaluateNode(D.right,G,C,F),null==J||null==D[0]||null==D[1]?null:f.sqlCompare(J,D[0],"\x3e\x3d",this.timeZone)&&f.sqlCompare(J,D[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return J=
this._evaluateNode(D.left,G,C,F),D=this._evaluateNode(D.right,G,C,F),null==J||null==D[0]||null==D[1]?null:f.sqlCompare(J,D[0],"\x3c",this.timeZone)||f.sqlCompare(J,D[1],"\x3e",this.timeZone);case "LIKE":return k(this._evaluateNode(D.left,G,C,F),this._evaluateNode(D.right,G,C,F),D.escape);case "NOT LIKE":return u(k(this._evaluateNode(D.left,G,C,F),this._evaluateNode(D.right,G,C,F),D.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return f.sqlCompare(this._evaluateNode(D.left,
G,C,F),this._evaluateNode(D.right,G,C,F),D.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return b.sqlCalculateFunction(D.operator,this._evaluateNode(D.left,G,C,F),this._evaluateNode(D.right,G,C,F),this.timeZone)}case "null":case "boolean":case "string":case "number":return D.value;case "date":return D.parsedValue??(D.parsedValue=c.parseDate(D.value,"unknown")),D.parsedValue;case "timestamp":return D.parsedValue??(D.parsedValue=c.parseTimestamp(D.value,"unknown")),D.parsedValue;
case "time":return c.parseTime(D.value);case "current-time":return"date"===D.mode?m.DateOnly.fromNow(this.timeZone):c.convertToExecutingTimeZone(new Date,this.timeZone);case "column-reference":return v(G,D.column,this.fieldsIndex,C);case "data-type":return D.value;case "function":if(this.isAggregate&&p.isAggregate(D.name,D.args.value.length)){G=[];for(J of D.args?.value||[]){S=[];for(T of F||[])S.push(this._evaluateNode(J,T,C,null));G.push(S)}return p.aggregateFunction(D.name,G)}C=this._evaluateNode(D.args,
G,C,F);return d.evaluateFunction(D.name,C,this.timeZone)}throw new r.SqlError(r.SqlErrorCodes.UnsupportedSyntax,{node:D.type});}}var K;(function(D){D[D.Normal=0]="Normal";D[D.Escaped=1]="Escaped"})(K||={});const I={getAttribute(D,G){return(D&&"object"===typeof D.attributes?D.attributes:D)[G]}};a.WhereClause=E;a.defaultAttributeAdapter=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone",
"../chunks/datetime"],function(a,q,r,g){function p(h,n,d){return h<n?h-n:h>d?h-d:0}function m(h,n=!0){if(h instanceof g.Zone)return h;if("system"===h.toLowerCase())return"system";if("utc"===h.toLowerCase())return"UTC";if("unknown"===h.toLowerCase())return r.UnknownTimeZone.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(h)){const d=g.FixedOffsetZone.parseSpecifier("UTC"+(h.startsWith("+")||h.startsWith("-")?"":"+")+h);if(d)return d}h=g.IANAZone.create(h);if(!h.isValid){if(n)throw new f(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);
return null}return h}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const b={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class f extends Error{constructor(h,n){super(q.replace(b[h],n));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,f)}}class c{constructor(h){this._date=h;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(h=
0,n=1,d=1,w=0,t=0,l=0,e=0,u){if(isNaN(h)||isNaN(n)||isNaN(d)||isNaN(w)||isNaN(t)||isNaN(l)||isNaN(e))return null;const x=g.DateTime.local(h,n).daysInMonth;h=g.DateTime.fromObject({day:1>d?1:d>x?x:d,year:h,month:1>n?1:12<n?12:n,hour:0>w?0:23<w?23:w,minute:0>t?0:59<t?59:t,second:0>l?0:59<l?59:l,millisecond:0>e?0:999<e?999:e},{zone:m(u)});h=h.plus({months:p(n,1,12),days:p(d,1,x),hours:p(w,0,23),minutes:p(t,0,59),seconds:p(l,0,59),milliseconds:p(e,0,999)});return new c(h)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??
"system"}static arcadeDateAndZoneToArcadeDate(h,n){n=m(n);return h.isUnknownTimeZone||n===r.UnknownTimeZone.instance?c.fromParts(h.year,h.monthJS+1,h.day,h.hour,h.minute,h.second,h.millisecond,n):new c(h._date.setZone(n))}static dateJSToArcadeDate(h){return new c(g.DateTime.fromJSDate(h,{zone:"system"}))}static dateJSAndZoneToArcadeDate(h,n="system"){n=m(n);return new c(g.DateTime.fromJSDate(h,{zone:n}))}static unknownEpochToArcadeDate(h){return new c(g.DateTime.fromMillis(h,{zone:r.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(h){return new c(g.DateTime.fromMillis(h.getTime(),
{zone:r.UnknownTimeZone.instance}))}static epochToArcadeDate(h,n="system"){n=m(n);return new c(g.DateTime.fromMillis(h,{zone:n}))}static dateTimeToArcadeDate(h){return new c(h)}clone(){return new c(this._date)}changeTimeZone(h){h=m(h);return c.dateTimeToArcadeDate(this._date.setZone(h))}static dateTimeAndZoneToArcadeDate(h,n){n=m(n);return h.zone===r.UnknownTimeZone.instance||n===r.UnknownTimeZone.instance?c.fromParts(h.year,h.month,h.day,h.hour,h.minute,h.second,h.millisecond,n):new c(h.setZone(n))}static nowToArcadeDate(h){h=
m(h);return new c(g.DateTime.fromJSDate(new Date,{zone:h}))}static nowUTCToArcadeDate(){return new c(g.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===c.systemTimeZoneCanonicalName}equals(h){return this.isSystem&&h.isSystem?this.toNumber()===h.toNumber():this.isUnknownTimeZone!==h.isUnknownTimeZone?!1:this._date.equals(h._date)}get isUnknownTimeZone(){return this._date.zone===r.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let h=
this._date.weekday;6<h&&(h=0);return h}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const h=this.zone;return"fixed"===h.type?0===h.fixed?"UTC":h.formatOffset(0,"short"):h.name}stringify(){return JSON.stringify(this.toJSDate())}plus(h){return new c(this._date.plus(h))}diff(h,n="milliseconds"){return this._date.diff(h._date,n)[n]}toISODate(){return this._date.toISODate()}toISOString(h){return h?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(h,n){return this._date.toISOTime({suppressMilliseconds:h,
includeOffset:n&&!this.isUnknownTimeZone})}toFormat(h,n){this.isUnknownTimeZone&&(h=h.replaceAll("Z",""));return this._date.toFormat(h,n)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new c(this._date.toUTC())}toLocal(){return new c(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(h){if(!h)return null;
h=g.DateTime.fromISO(h,{setZone:!0});return new c(h)}}a.ArcadeDate=c;a.ArcadeDateError=f;a.arcadeDateErrorMessages=b;a.createDateTimeZone=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/UnknownTimeZone":function(){define(["exports","../../chunks/datetime"],function(a,q){function r(p){return p instanceof q.Zone?p===g.instance?!0:!1:"unknown"===p?.toString().toLowerCase()?!0:!1}class g{}g.instance=new q.IANAZone("Etc/UTC");a.UnknownTimeZone=g;a.adoptTimeZone=function(p,
m){return q.DateTime.fromObject({day:p.day,year:p.year,month:p.month,hour:p.hour,minute:p.minute,second:p.second,millisecond:p.millisecond},{zone:m})};a.isUnknownTimeZone=r;a.substituteUnknownTimezone=function(p){return r(p)?g.instance:p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(a,q){a.SqlErrorCodes=void 0;(function(b){b.InvalidFunctionParameters="InvalidFunctionParameters";
b.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";b.UnsupportedSqlFunction="UnsupportedSqlFunction";b.UnsupportedOperator="UnsupportedOperator";b.UnsupportedSyntax="UnsupportedSyntax";b.UnsupportedIsRhs="UnsupportedIsRhs";b.UnsupportedIsLhs="UnsupportedIsLhs";b.InvalidDataType="InvalidDataType";b.CannotCastValue="CannotCastValue";b.FunctionNotRecognized="FunctionNotRecognized";b.InvalidTime="InvalidTime";b.InvalidParameterCount="InvalidParameterCount";b.InvalidTimeStamp="InvalidTimeStamp";
b.InvalidDate="InvalidDate";b.InvalidOperator="InvalidOperator";b.IllegalInterval="IllegalInterval";b.YearMonthIntervals="YearMonthIntervals";b.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";b.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const r={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",
[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",
[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",
[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};class g extends Error{constructor(b,f){super(q.replace(r[b],f));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,g)}}a.FeatureSetErrorCodes=void 0;(function(b){b.NeverReach="NeverReach";b.NotImplemented="NotImplemented";b.Cancelled="Cancelled";b.InvalidStatResponse="InvalidStatResponse";b.InvalidRequest="InvalidRequest";b.RequestFailed="RequestFailed";
b.MissingFeatures="MissingFeatures";b.AggregationFieldNotFound="AggregationFieldNotFound";b.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const p={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",
[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class m extends Error{constructor(b,f){super(q.replace(p[b],f));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,m)}}a.FeatureSetError=
m;a.SqlError=g;a.featureSetErrorMessages=p;a.sqlErrorMessages=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,q,r,g,p,m){function b(n){if(null===n)return null;let d=0,w=0;for(let t=0;t<n.length;t++){const l=n[t];if(null!==l){if("number"!==typeof l)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);
w++;d+=l}}return 0===w?null:d/n.length}function f(n,d){if(null===n)return null;let w=null,t=null;for(const l of n)n=l,n=l instanceof r.DateOnly?l.toNumber():l instanceof p.TimeOnly?l.toNumber():l instanceof m.DateTime?l.toMillis():l instanceof g.SqlTimeStampOffset?l.toMilliseconds():l,null===w?(w=l,t=n):"max"===d&&null!==t&&null!==n&&t<=n?(w=l,t=n):"min"===d&&null!==t&&null!==n&&t>=n&&(w=l,t=n);return w}function c(n){if(null===n)return null;n=n.filter(t=>null!==t);if(0===n.length)return null;const d=
b(n);if(null===d)return null;let w=0;for(const t of n){if("number"!==typeof t)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);w+=(d-t)**2}return w/(n.length-1)}const h={min:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"min")},max:{minParams:1,maxParams:1,evaluate:n=>f(n[0],"max")},avg:{minParams:1,maxParams:1,evaluate:n=>b(n[0])},sum:{minParams:1,maxParams:1,evaluate:n=>{n=n[0];if(null===n)n=null;else{var d=0;for(let w=0;w<n.length;w++){const t=n[w];if(null!==t){if("number"!==
typeof t)throw new q.SqlError(q.SqlErrorCodes.InvalidValueForAggregateFunction);d+=t}}n=d}return n}},stddev:{minParams:1,maxParams:1,evaluate:n=>{n=n[0];null===n?n=null:(n=c(n),n=null===n?null:Math.sqrt(n));return n}},count:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].length},var:{minParams:1,maxParams:1,evaluate:n=>c(n[0])}};a.aggregateFunction=function(n,d){const w=h[n.toLowerCase()];if(null==w)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(d.length<w.minParams||d.length>
w.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:n.toUpperCase()});return w.evaluate(d)};a.isAggregate=function(n,d){n=h[n.toLowerCase()];return null!=n&&d>=n.minParams&&d<=n.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,q,r,g){function p(b){b=b.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let f="";const c=
/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const h of b.match(c)||[])switch(h){case "D":f+="d";break;case "DD":f+="dd";break;case "DDD":f+="o";break;case "d":f+="c";break;case "ddd":f+="ccc";break;case "dddd":f+="cccc";break;case "M":f+="L";break;case "MM":f+="LL";break;case "MMM":f+="LLL";break;case "MMMM":f+="LLLL";break;case "YY":f+="yy";
break;case "Y":case "YYYY":f+="yyyy";break;case "Q":f+="q";break;case "X":case "x":f+=h;break;default:f=2<=h.length&&"["===h.slice(0,1)&&"]"===h.slice(-1)?f+`'${h.slice(1,-1)}'`:f+`'${h}'`}return f}class m{constructor(b,f,c){this._year=b;this._month=f;this._day=c;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(b){return b instanceof
m&&b.day===this.day&&b.month===this.month&&b.year===this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(b){return g.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(b)})}toDateTimeLuxon(b){return g.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(b)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(b=
null,f=!0){if(null===b||""===b)return this.toString();f&&(b=p(b));if(!b)return"";f=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(f).toFormat(b,{locale:r.getLocale(),numberingSystem:"latn"})}toArcadeDate(){const b=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(b)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",
!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(b,f){return m.fromDateTime(this.toUTCDateTime().plus({[b]:f}))}toUTCDateTime(){return g.DateTime.utc(this.year,this.month,this.day,0,0,0,0)}difference(b,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(b.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?
this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(b.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(b.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(b.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(b.toUTCDateTime(),
"years").years;default:return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(b){b=g.DateTime.fromMillis(b,{zone:g.FixedOffsetZone.utcInstance});return b.isValid?m.fromParts(b.year,b.month,b.day):null}static fromSeconds(b){b=g.DateTime.fromSeconds(b,{zone:g.FixedOffsetZone.utcInstance});return b.isValid?m.fromParts(b.year,b.month,b.day):null}static fromReader(b){if(!b)return null;b=b.split("-");return 3!==b.length?null:new m(parseInt(b[0],10),parseInt(b[1],
10),parseInt(b[2],10))}static fromParts(b,f,c){b=new m(b,f,c);return!1===b.isValid?null:b}static fromDateJS(b){return m.fromParts(b.getFullYear(),b.getMonth()+1,b.getDay())}static fromDateTime(b){return m.fromParts(b.year,b.month,b.day)}static fromSqlTimeStampOffset(b){return this.fromDateTime(b.toDateTime())}static fromString(b,f=null){if(""===b||null===b)return null;var c=[];if(f)(f=p(f))&&c.push(f);else if(null===f||""===f)return b=g.DateTime.fromISO(b,{setZone:!0}),b.isValid?m.fromParts(b.year,
b.month,b.day):null;for(const h of c)if(c=g.DateTime.fromFormat(b,f??h),c.isValid)return new m(c.year,c.month,c.day);return null}static fromNow(b="system"){b=g.DateTime.fromJSDate(new Date).setZone(q.createDateTimeZone(b));return new m(b.year,b.month,b.day)}}a.DateOnly=m;a.standardizeDateOnlyFormat=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(a,q){function r(p){return Number.isNaN(p)||
0===p?p:Math.trunc(p)}class g{constructor(p){this._timeStampOffset=p;this._date=null}toDateTime(){this._date??(this._date=q.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return r(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return r(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return g.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(p){return new g(q.DateTime.fromJSDate(p).toISO({includeOffset:!0}))}static fromDateTime(p){return new g(p.toISO({includeOffset:!0}))}static fromParts(p,
m,b=0,f=0,c=0,h=0,n=0,d=!1,w=0,t=0){p=`${p.toString().padStart(4,"0")}-${m.toString().padStart(2,"0")}-${b.toString().padStart(2,"0")}`;m="";10>h&&(m="0");f=`${f.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}:${m+h.toString()}`;0!==n&&(f+="."+n.toString().padStart(3,"0"));n=`${d?"-":"+"}${w.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;return new g(p+"T"+f+n)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let p=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});p&&=p.replace(".000","");return p}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(p){p=this.toDateTime().plus(p);return g.fromDateTime(p)}}a.SqlTimeStampOffset=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,q,r,g){function p(b){if(!b)return"";const f=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let c="";for(const h of b.match(f)||
[])switch(h){case "SSS":c+=h;break;case "A":case "a":c+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":c+=h;break;default:c+=`'${h}'`}return c}class m{constructor(b,f,c,h){this._hour=b;this._minute=f;this._second=c;this._millisecond=h;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(b){return b instanceof m&&b.hour===
this.hour&&b.minute===this.minute&&b.second===this.second&&b.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return q.isInteger(this.hour)&&q.isInteger(this.minute)&&q.isInteger(this.second)&&q.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(b=null){return null===b||""===b?this.toString():(b=p(b))?g.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(b,{locale:r.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(b,f,c,h){b=new m(b,f,c,h);return b.isValid()?b:null}static fromReader(b){if(!b)return null;b=b.split(":");return 3!==b.length?null:new m(parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],
10),0)}static fromMilliseconds(b){return 864E5<b||0>b?null:new m(Math.floor(b/36E5%24),Math.floor(b/6E4%60),Math.floor(b/1E3%60),Math.floor(b%1E3))}static fromDateJS(b){return new m(b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds())}static fromDateTime(b){return new m(b.hour,b.minute,b.second,b.millisecond)}static fromSqlTimeStampOffset(b){return this.fromDateTime(b.toDateTime())}static fromString(b,f=null){if(""===b||null===b)return null;const c=[];if(f)(f=p(f))&&c.push(f);else if(null===
f||""===f)c.push("HH:mm:ss"),c.push("HH:mm:ss.SSS"),c.push("hh:mm:ss a"),c.push("hh:mm:ss.SSS a"),c.push("HH:mm"),c.push("hh:mm a"),c.push("H:mm"),c.push("h:mm a"),c.push("H:mm:ss"),c.push("h:mm:ss a"),c.push("H:mm:ss.SSS"),c.push("h:mm:ss.SSS a");for(const h of c)if(f=g.DateTime.fromFormat(b,h),f.isValid)return new m(f.hour,f.minute,f.second,f.millisecond);return null}plus(b,f){switch(b){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[b]:f}))}return null}toUTCDateTime(){return g.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(b,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(b.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?this.toUTCDateTime().diff(b.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(b.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(b.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(b.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(b.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(b.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=m;a.standardizeTimeFormat=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,q){a.cloneGeometry=function(r){if(null==r)return null;const g=r.clone();void 0!==r.cache._geVersion&&(g.cache._geVersion=r.cache._geVersion);return g};a.convertLinearUnitsToCode=function(r){if(null==r)return null;if("number"===typeof r)return r;r=r.toLowerCase();r=r.replaceAll(/\s/g,"");r=r.replaceAll("-","");switch(r){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(r){if(null==r)return null;if("number"===typeof r)return r;r=r.toLowerCase();r=r.replaceAll(/\s/g,"");r=r.replaceAll("-","");switch(r){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(r){return"number"===typeof r&&isFinite(r)&&Math.floor(r)===r};a.sameGeomType=function(r,g){return r===g||"point"===r&&"esriGeometryPoint"===g||"polyline"===r&&"esriGeometryPolyline"===
g||"polygon"===r&&"esriGeometryPolygon"===g||"extent"===r&&"esriGeometryEnvelope"===g||"multipoint"===r&&"esriGeometryMultipoint"===g||"point"===g&&"esriGeometryPoint"===r||"polyline"===g&&"esriGeometryPolyline"===r||"polygon"===g&&"esriGeometryPolygon"===r||"extent"===g&&"esriGeometryEnvelope"===r||"multipoint"===g&&"esriGeometryMultipoint"===r?!0:!1};a.shapeExtent=function(r){if(null==r)return null;switch(r.type){case "polygon":case "multipoint":case "polyline":return r.extent;case "point":return new q({xmin:r.x,
ymin:r.y,xmax:r.x,ymax:r.y,spatialReference:r.spatialReference});case "extent":return r}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,q,r,g,p){function m(Q,X,Y){switch(Y){case "+":return Q+X;case "-":return Q-X;case "*":return Q*X;case "/":return Q/X}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function b(Q,X,Y){switch(Y){case "+":return X.plus({milliseconds:Q.valueInMilliseconds()});case "-":return Q.valueInMilliseconds()-X.toMillis()}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function f(Q,X,Y){switch(Y){case "+":return X.plus("milliseconds",Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function c(Q,X,Y){switch(Y){case "+":return X.plus("milliseconds",Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function h(Q,
X,Y){switch(Y){case "+":return Q.plus("milliseconds",X.valueInMilliseconds());case "-":return Q.plus("milliseconds",-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function n(Q,X,Y){switch(Y){case "+":return X.addMilliseconds(Q.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function d(Q,X,Y){switch(Y){case "+":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()+X.valueInMilliseconds());case "-":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()-
X.valueInMilliseconds());case "*":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()*X.valueInMilliseconds());case "/":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()/X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function w(Q,X,Y){switch(Y){case "+":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()+X);case "-":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()-X);case "*":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()*
X);case "/":return g.SqlInterval.createFromMilliseconds(Q.valueInMilliseconds()/X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function t(Q,X,Y){switch(Y){case "+":return g.SqlInterval.createFromMilliseconds(Q+X.valueInMilliseconds());case "-":return g.SqlInterval.createFromMilliseconds(Q-X.valueInMilliseconds());case "*":return g.SqlInterval.createFromMilliseconds(Q*X.valueInMilliseconds());case "/":return g.SqlInterval.createFromMilliseconds(Q/X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function l(Q,X,Y){switch(Y){case "+":return Q.plus("milliseconds",X.valueInMilliseconds());case "-":return Q.plus("milliseconds",-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function e(Q,X,Y){switch(Y){case "+":return Q.plus({milliseconds:X.valueInMilliseconds()});case "-":return Q.minus({milliseconds:X.valueInMilliseconds()})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function u(Q,X,Y){switch(Y){case "+":return Q.addMilliseconds(X.valueInMilliseconds());
case "-":return Q.addMilliseconds(-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function x(Q,X,Y){X*=864E5;switch(Y){case "+":return Q.plus({milliseconds:X});case "-":return Q.minus({milliseconds:X})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function y(Q,X,Y){X*=864E5;switch(Y){case "+":return Q.plus("milliseconds",X);case "-":return Q.plus("milliseconds",-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function A(Q,X,Y){X*=864E5;switch(Y){case "+":return Q.plus("milliseconds",
X);case "-":return Q.plus("milliseconds",-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function k(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function v(Q,X,Y){X*=864E5;switch(Y){case "+":return Q.addMilliseconds(X);case "-":return Q.addMilliseconds(-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function B(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function z(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function E(Q,
X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function K(Q,X,Y){X=parseFloat(X);if(isNaN(X))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return m(Q,X,Y)}function I(Q,X,Y){Q=parseFloat(Q);if(isNaN(Q))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return m(Q,X,Y)}function D(Q,X,Y){switch(Y){case "+":return Q+X}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function G(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function C(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function F(Q,X,Y){switch(Y){case "-":return Q.toDateTimeLuxon(X.zone).diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function J(Q,X,Y){switch(Y){case "-":return Q.toDateTimeLuxon(X.toDateTime().zone).diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function T(Q,X,Y){switch(Y){case "-":return Q.toDateTimeLuxon("UTC").diff(X.toDateTimeLuxon("UTC")).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function S(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function ba(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function M(Q,X,Y){switch(Y){case "-":return Q.toDateTime().diff(X.toDateTimeLuxon(Q.toDateTime().zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function U(Q,X,Y){switch(Y){case "-":return Q.toDateTime().diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function R(Q,X,Y){switch(Y){case "-":return Q.toDateTime().diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function Z(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ea(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ma(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function V(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function aa(Q,X,Y){switch(Y){case "-":return Q.diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ja(Q,X,Y){switch(Y){case "-":return Q.diff(X.toDateTimeLuxon(Q.zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function oa(Q,X,Y){switch(Y){case "-":return Q.diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function wa(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ta(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function va(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function xa(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function L(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function P(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function fa(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ka(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function qa(Q,X,Y){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=T;a.calculateDateOnlyAndDateTime=F;a.calculateDateOnlyAndNumber=y;a.calculateDateOnlyAndSqlInterval=l;a.calculateDateOnlyAndString=ta;a.calculateDateOnlyAndTimeOnly=S;a.calculateDateOnlyAndTimestamp=
J;a.calculateDateTimeAndDateOnly=ja;a.calculateDateTimeAndDateTime=aa;a.calculateDateTimeAndNumber=x;a.calculateDateTimeAndSqlInterval=e;a.calculateDateTimeAndString=xa;a.calculateDateTimeAndTimeOnly=wa;a.calculateDateTimeAndTimestamp=oa;a.calculateNumberAndDateOnly=E;a.calculateNumberAndDateTime=k;a.calculateNumberAndNumber=m;a.calculateNumberAndSqlInterval=t;a.calculateNumberAndString=K;a.calculateNumberAndTimeOnly=z;a.calculateNumberAndTimestamp=B;a.calculateSqlIntervalAndDateOnly=c;a.calculateSqlIntervalAndDateTime=
b;a.calculateSqlIntervalAndNumber=w;a.calculateSqlIntervalAndSqlInterval=d;a.calculateSqlIntervalAndString=G;a.calculateSqlIntervalAndTimeOnly=f;a.calculateSqlIntervalAndTimestamp=n;a.calculateStringAndDateOnly=fa;a.calculateStringAndDateTime=ka;a.calculateStringAndNumber=I;a.calculateStringAndSqlInterval=C;a.calculateStringAndString=D;a.calculateStringAndTimeOnly=P;a.calculateStringAndTimestamp=qa;a.calculateTimeOnlyAndDateOnly=ea;a.calculateTimeOnlyAndDateTime=Z;a.calculateTimeOnlyAndNumber=A;a.calculateTimeOnlyAndSqlInterval=
h;a.calculateTimeOnlyAndString=va;a.calculateTimeOnlyAndTimeOnly=V;a.calculateTimeOnlyAndTimestamp=ma;a.calculateTimestampAndDateOnly=M;a.calculateTimestampAndDateTime=U;a.calculateTimestampAndNumber=v;a.calculateTimestampAndSqlInterval=u;a.calculateTimestampAndString=L;a.calculateTimestampAndTimeOnly=ba;a.calculateTimestampAndTimestamp=R;a.sqlCalculateFunction=function(Q,X,Y,ia){if("||"===Q)return p.evaluateFunction("concat",[X,Y],ia);if(null===X||null===Y)return null;if(r.isNumber(X)){if(r.isNumber(Y))return m(X,
Y,Q);if(r.isSqlInterval(Y))return t(X,Y,Q);if(r.isTimeOnly(Y))return z();if(r.isDateOnly(Y))return E();if(r.isTimestampOffset(Y))return B();if(r.isDateTime(Y))return k();if(r.isString(Y))return K(X,Y,Q)}else if(r.isDateOnly(X)){if(r.isNumber(Y))return y(X,Y,Q);if(r.isSqlInterval(Y))return l(X,Y,Q);if(r.isTimeOnly(Y))return S();if(r.isDateOnly(Y))return T(X,Y,Q);if(r.isTimestampOffset(Y))return J(X,Y,Q);if(r.isDateTime(Y))return F(X,Y,Q);if(r.isString(Y))return ta()}else if(r.isTimeOnly(X)){if(r.isNumber(Y))return A(X,
Y,Q);if(r.isSqlInterval(Y))return h(X,Y,Q);if(r.isTimeOnly(Y))return V();if(r.isDateOnly(Y))return ea();if(r.isTimestampOffset(Y))return ma();if(r.isDateTime(Y))return Z();if(r.isString(Y))return va()}else if(r.isSqlInterval(X)){if(r.isNumber(Y))return w(X,Y,Q);if(r.isSqlInterval(Y))return d(X,Y,Q);if(r.isTimeOnly(Y))return f(X,Y,Q);if(r.isDateOnly(Y))return c(X,Y,Q);if(r.isTimestampOffset(Y))return n(X,Y,Q);if(r.isDateTime(Y))return b(X,Y,Q);if(r.isString(Y))return G()}else if(r.isDateTime(X)){if(r.isNumber(Y))return x(X,
Y,Q);if(r.isSqlInterval(Y))return e(X,Y,Q);if(r.isTimeOnly(Y))return wa();if(r.isDateOnly(Y))return ja(X,Y,Q);if(r.isTimestampOffset(Y))return oa(X,Y,Q);if(r.isDateTime(Y))return aa(X,Y,Q);if(r.isString(Y))return xa()}else if(r.isTimestampOffset(X)){if(r.isNumber(Y))return v(X,Y,Q);if(r.isSqlInterval(Y))return u(X,Y,Q);if(r.isTimeOnly(Y))return ba();if(r.isDateOnly(Y))return M(X,Y,Q);if(r.isTimestampOffset(Y))return R(X,Y,Q);if(r.isDateTime(Y))return U(X,Y,Q);if(r.isString(Y))return L()}else if(r.isString(X)){if(r.isNumber(Y))return I(X,
Y,Q);if(r.isSqlInterval(Y))return C();if(r.isTimeOnly(Y))return P();if(r.isDateOnly(Y))return fa();if(r.isTimestampOffset(Y))return qa();if(r.isDateTime(Y))return ka();if(r.isString(Y))return D(X,Y,Q)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,q,r,g,p,m,b,f){function c(x,y,A){A=t.exec(x);if(null!==A){const [,k,v,B,z,E,K,I]=A;x=f.DateTime.fromObject({year:parseInt(k,10),month:parseInt(v,10),day:parseInt(B,10),hour:parseInt(z,10),minute:parseInt(E,10),second:parseInt(K,10),millisecond:I?parseInt(I.replace(".",""),10):0},{zone:b.substituteUnknownTimezone(y)});if(!1===x.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return x}A=l.exec(x);if(null!==A){const [,k,v,B,z,E,K,I,D,G,C]=A;x=p.SqlTimeStampOffset.fromParts(parseInt(k,
10),parseInt(v,10),parseInt(B,10),parseInt(z,10),parseInt(E,10),parseInt(K,10),I?parseInt(I.replace(".",""),10):0,"-"===D,parseInt(G,10),parseInt(C,10));if(!1===x.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return x}A=e.exec(x);if(null!==A){const [,k,v,B,z,E,K,I,D]=A;x=p.SqlTimeStampOffset.fromParts(parseInt(k,10),parseInt(v,10),parseInt(B,10),parseInt(z,10),parseInt(E,10),0,0,"-"===K,parseInt(I,10),parseInt(D,10));if(!1===x.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);
return x}A=u.exec(x);if(null!==A){const [,k,v,B,z,E]=A;x=f.DateTime.fromObject({year:parseInt(k,10),month:parseInt(v,10),day:parseInt(B,10),hour:parseInt(z,10),minute:parseInt(E,10),second:0},{zone:b.substituteUnknownTimezone(y)});if(!1===x.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return x}A=w.exec(x);if(null!==A){const [,k,v,B]=A;x=f.DateTime.fromObject({year:parseInt(k,10),month:parseInt(v,10),day:parseInt(B,10),hour:0,minute:0,second:0},{zone:b.substituteUnknownTimezone(y)});
if(!1===x.isValid)throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);return x}throw new q.SqlError(q.SqlErrorCodes.InvalidTimeStamp);}const h=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,n=/^(\d{1,2}):(\d{1,2})$/,d=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,l=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,e=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,
u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(x,y){if(y instanceof f.Zone)return y===b.UnknownTimeZone.instance?f.DateTime.fromMillis(x.getTime(),{zone:b.UnknownTimeZone.instance}):f.DateTime.fromJSDate(x,{zone:y});switch(y){case "system":case "local":case null:return f.DateTime.fromJSDate(x);default:return"unknown"===y?.toLowerCase()?f.DateTime.fromMillis(x.getTime(),{zone:b.UnknownTimeZone.instance}):f.DateTime.fromJSDate(x,{zone:y})}};a.isDate=function(x){return x instanceof
Date};a.isDateOnly=function(x){return x instanceof r.DateOnly};a.isDateTime=function(x){return x instanceof f.DateTime};a.isNumber=function(x){return"number"===typeof x};a.isSqlInterval=function(x){return x instanceof g.SqlInterval};a.isString=function(x){return"string"===typeof x||x instanceof String};a.isTimeOnly=function(x){return x instanceof m.TimeOnly};a.isTimestampOffset=function(x){return x instanceof p.SqlTimeStampOffset};a.parseDate=function(x,y){const A=w.exec(x);if(null===A)try{return c(x,
y)}catch{throw new q.SqlError(q.SqlErrorCodes.InvalidDate);}const [,k,v,B]=A;x=r.DateOnly.fromParts(parseInt(k,10),parseInt(v,10),parseInt(B,10));if(null===x)throw new q.SqlError(q.SqlErrorCodes.InvalidDate);return x};a.parseTime=function(x){let y=h.exec(x);if(null!==y){const [,A,k,v]=y;x=m.TimeOnly.fromParts(parseInt(A,10),parseInt(k,10),parseInt(v,10),0);if(null!==x)return x;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}y=n.exec(x);if(null!==y){const [,A,k]=y;x=m.TimeOnly.fromParts(parseInt(A,
10),parseInt(k,10),0,0);if(null!==x)return x;throw new q.SqlError(q.SqlErrorCodes.InvalidTime);}y=d.exec(x);if(null!==y){const [,A,k,v,B]=y;x=m.TimeOnly.fromParts(parseInt(A,10),parseInt(k,10),parseInt(v,10),parseInt(B,10));if(null!==x)return x}throw new q.SqlError(q.SqlErrorCodes.InvalidTime);};a.parseTimestamp=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(a,q){class r{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(g){if(null!==g.precision||null!==g.secondary)throw new q.SqlError(q.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(g,p){p.includes(".")?(p=p.split("."),g.second=parseFloat(p[0]),g.millis=parseInt(p[1],10)):g.second=parseFloat(p)}static createFromMilliseconds(g){const p=new r;p.second=g/1E3;return p}static createFromValueAndQualifier(g,p,m){let b=null;const f=new r;f.op="-"===
m?"-":"+";if("interval-period"===p.type){r._fixDefaults(p);m=RegExp("^[0-9]{1,}$");if("year"===p.period||"month"===p.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);if("second"===p.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(g))r._parseSecondsComponent(f,g);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);else if(m.test(g))f[p.period]=parseFloat(g);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}else{r._fixDefaults(p.start);r._fixDefaults(p.end);if("year"===
p.start.period||"month"===p.start.period||"year"===p.end.period||"month"===p.end.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);switch(p.start.period){case "day":switch(p.end.period){case "hour":b=RegExp("^[0-9]{1,} [0-9]{1,}$");if(b.test(g))f[p.start.period]=parseFloat(g.split(" ")[0]),f[p.end.period]=parseFloat(g.split(" ")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "minute":b=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(b.test(g))f[p.start.period]=
parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":b=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(g))f[p.start.period]=parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]),r._parseSecondsComponent(f,g[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(p.end.period){case "minute":b=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(b.test(g))f.hour=parseFloat(g.split(":")[0]),f.minute=parseFloat(g.split(":")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":b=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(g))g=g.split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]),r._parseSecondsComponent(f,g[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(p.end.period){case "second":b=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(b.test(g))g=g.split(":"),f.minute=parseFloat(g[0]),r._parseSecondsComponent(f,g[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}}return f}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(a,q,r,g,p,m,b,f){function c(e){return"string"===typeof e||e instanceof String}function h(e){return m.isDate(e)||m.isDateOnly(e)||
m.isDateTime(e)||m.isTimeOnly(e)||m.isTimestampOffset(e)?!1:!0}function n(e){return m.isDateOnly(e)||m.isTimeOnly(e)?e.toString():m.isTimestampOffset(e)?e.toSQLValue():m.isDateTime(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):m.isDate(e)?n(f.DateTime.fromJSDate(e)):e.toString()}function d(e){if(m.isDate(e))return g.DateOnly.fromDateJS(e);if(m.isDateTime(e))return g.DateOnly.fromParts(e.year,e.month,e.day);if(m.isDateOnly(e))return e;if(m.isTimeOnly(e))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(m.isTimestampOffset(e)&&null===g.DateOnly.fromParts(e.year,e.month,e.day))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(c(e)&&(e=g.DateOnly.fromReader(e),null!==e&&e.isValid))return e;throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function w(e,u,x){if(m.isDate(e))return m.convertToExecutingTimeZone(e,u);if(m.isDateTime(e))return e;if(m.isDateOnly(e))return e.toDateTimeLuxon("unknown");if(m.isTimeOnly(e))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(m.isTimestampOffset(e))return e;
if(c(e))return m.parseTimestamp(e,"unknown",x);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}function t(e){if(m.isDate(e))return b.TimeOnly.fromDateJS(e);if(m.isDateTime(e))return b.TimeOnly.fromDateTime(e);if(m.isDateOnly(e))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);if(m.isTimeOnly(e))return e;if(m.isTimestampOffset(e))return b.TimeOnly.fromSqlTimeStampOffset(e);if(c(e))return m.parseTime(e);throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);}const l={extract:{minParams:2,
maxParams:2,evaluate:([e,u])=>{if(null==u)return null;if(m.isDate(u))switch(e.toUpperCase()){case "SECOND":return u.getSeconds();case "MINUTE":return u.getMinutes();case "HOUR":return u.getHours();case "DAY":return u.getDate();case "MONTH":return u.getMonth()+1;case "YEAR":return u.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(m.isDateTime(u))switch(e.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour;case "DAY":return u.day;
case "MONTH":return u.month;case "YEAR":return u.year}else if(m.isDateOnly(u))switch(e.toUpperCase()){case "DAY":return u.day;case "MONTH":return u.month;case "YEAR":return u.year}else if(m.isTimeOnly(u))switch(e.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour}else if(m.isTimestampOffset(u))switch(e.toUpperCase()){case "SECOND":return u.second;case "MINUTE":return u.minute;case "HOUR":return u.hour;case "DAY":return u.day;case "MONTH":return u.month;
case "YEAR":return u.year;case "TIMEZONE_HOUR":return u.timezoneOffsetHour;case "TIMEZONE_MINUTE":return u.timezoneOffsetMinutes}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const [u,x]=e;return null==u||null==x?null:u.toString().substring(x-1)}if(3===e.length){const [u,x,y]=e;return null==u||null==x||null==y?null:0>=y?"":u.toString().substring(x-1,x+y-1)}}},position:{minParams:2,maxParams:2,
evaluate:([e,u])=>null==e||null==u?null:u.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{var u=3===e.length,x=u?e[1]:" ";u=u?e[2]:e[1];if(null==x||null==u)return null;x=`(${r.escapeRegExpString(x)})`;switch(e[0]){case "BOTH":return u.replaceAll(new RegExp(`^${x}*|${x}*$`,"g"),"");case "LEADING":return u.replaceAll(new RegExp(`^${x}*`,"g"),"");case "TRAILING":return u.replaceAll(new RegExp(`${x}*$`,"g"),"")}throw new q.SqlError(q.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>
null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:0<e[0]?1:0>e[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,
maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const u=e[0];e=2===e.length?10**e[1]:1;return null==u?null:Math.round(u*e)/e}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>c(e[0])?e[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:e=>{let u="";for(let x=0;x<e.length;x++){if(null==e[x])return null;
u+=e[x].toString()}return u}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:e=>{for(const u of e)if(null!==u)return u;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>
null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:(e,u)=>p.sqlCompare(e[0],e[1],"\x3d")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,u)=>{const x=e[0];e=e[1];if(null===x)return null;switch(e.type){case "integer":if(!h(x))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseInt(x,10);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "smallint":if(!h(x))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseInt(x,10);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);
if(32767<u||-32767>u)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "float":case "real":if(!h(x))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);u=parseFloat(x);if(isNaN(u))throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;case "time":return t(x);case "date":return d(x);case "timestamp":return w(x,u,!0===e.withtimezone);case "varchar":u=n(x);if(u.length>e.size)throw new q.SqlError(q.SqlErrorCodes.CannotCastValue);return u;default:throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);
}}}};a.evaluateFunction=function(e,u,x){const y=l[e.toLowerCase()];if(null==y)throw new q.SqlError(q.SqlErrorCodes.FunctionNotRecognized);if(u.length<y.minParams||u.length>y.maxParams)throw new q.SqlError(q.SqlErrorCodes.InvalidParameterCount,{name:e.toUpperCase()});return y.evaluate(u,x)};a.isStandardized=function(e,u){e=l[e.toLowerCase()];return null!=e&&u>=e.minParams&&u<=e.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,q,r,g,p,m){function b(e){return r.isDateTime(e)||r.isTimestampOffset(e)?!0:!1}function f(e){return r.isDateTime(e)||r.isDateOnly(e)||r.isTimestampOffset(e)||r.isTimeOnly(e)?!0:!1}function c(e){if(r.isDateTime(e))return e.toMillis();if(r.isDateOnly(e))return e.toNumber();if(r.isTimestampOffset(e))return e.toMilliseconds();throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);}function h(e,u,x){switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<
u;case "\x3e\x3d":return e>=u;case "\x3c\x3d":return e<=u}}function n(e,u,x){const y=parseFloat(u);if(!isNaN(y))return h(e,y,x);e=e.toString();switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<u;case "\x3e\x3d":return e>=u;case "\x3c\x3d":return e<=u}}function d(e,u,x){const y=parseFloat(e);if(!isNaN(y))return h(y,u,x);u=u.toString();switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<
u;case "\x3e\x3d":return e>=u;case "\x3c\x3d":return e<=u}}function w(e,u,x){switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<u;case "\x3e\x3d":return e>=u;case "\x3c\x3d":return e<=u}}function t(e,u,x){e instanceof g.SqlTimeStampOffset&&(e=e.toDateTime());u instanceof g.SqlTimeStampOffset&&(u=u.toDateTime());e=l(e);u=l(u);switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<u;case "\x3e\x3d":return e>=
u;case "\x3c\x3d":return e<=u}}function l(e){return 321408E5*e.year+26784E5*e.month+864E5*e.day+36E5*e.hour+6E4*e.minute+1E3*e.second+e.millisecond}a.dateValueInMilliseconds=c;a.isDateOrTimeValue=f;a.isDateTimeComparableValue=b;a.sqlCompare=function(e,u,x,y){if(null==e||null==u)return null;if(r.isNumber(e)){if(r.isNumber(u))return h(e,u,x);if(r.isString(u))return n(e,u,x);if(f(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}else if(r.isString(e)){if(r.isNumber(u))return d(e,u,x);if(r.isString(u))return w(e,u,x);if(r.isDateTime(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isTimestampOffset(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isDateTime(e)){if(b(u)){if(e instanceof m.DateTime&&p.isUnknownTimeZone(e.zone)){if(u instanceof m.DateTime&&
!1===p.isUnknownTimeZone(u.zone)||u instanceof g.SqlTimeStampOffset)return t(e,u,x)}else if(u instanceof m.DateTime&&p.isUnknownTimeZone(u.zone)&&(e instanceof m.DateTime&&!1===p.isUnknownTimeZone(e.zone)||e instanceof g.SqlTimeStampOffset))return t(e,u,x);return h(c(e),c(u),x)}if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return u=u.toDateTimeLuxon(e.zone),e=e.startOf("day"),h(e.toMillis(),u.toMillis(),x);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isDateOnly(e)){if(r.isTimestampOffset(u))return e=e.toDateTimeLuxon(u.toDateTime().zone),u=u.startOfDay(),h(e.toMillis(),u.toMilliseconds(),x);if(r.isDateTime(u))return e=e.toDateTimeLuxon(u.zone),u=u.startOf("day"),h(e.toMillis(),u.toMillis(),x);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return h(e.toNumber(),u.toNumber(),x);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isTimeOnly(e)){if(r.isTimeOnly(u))return h(e.toNumber(),u.toNumber(),x);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(b(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(r.isTimestampOffset(e)){if(b(u))return u instanceof m.DateTime&&
p.isUnknownTimeZone(u.zone)?t(e,u,x):h(c(e),c(u),x);if(r.isString(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isDateOnly(u))return u=u.toDateTimeLuxon(e.toDateTime().zone),e=e.startOfDay(),h(e.toMilliseconds(),u.toMillis(),x);if(r.isTimeOnly(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(r.isNumber(u))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}switch(x){case "\x3c\x3e":return e!==u;case "\x3d":return e===u;case "\x3e":return e>u;case "\x3c":return e<u;case "\x3e\x3d":return e>=
u;case "\x3c\x3d":return e<=u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,q){var r={exports:{}};(function(m){(function(b,f){m.exports&&(m.exports=f())})(q.commonjsGlobal,function(){function b(c,h,n,d){c=Error.call(this,c);Object.setPrototypeOf&&Object.setPrototypeOf(c,b.prototype);c.expected=h;c.found=n;c.location=d;c.name="SyntaxError";return c}function f(c,h,n){n=n||" ";if(c.length>
h)return c;h-=c.length;n+=n.repeat(h);return c+n.slice(0,h)}(function(c,h){function n(){this.constructor=c}n.prototype=h.prototype;c.prototype=new n})(b,Error);b.prototype.format=function(c){var h="Error: "+this.message;if(this.location){var n=null,d;for(d=0;d<c.length;d++)if(c[d].source===this.location.source){n=c[d].text.split(/\r\n|\n|\r/g);break}c=this.location.start;d=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(c):c;var w=this.location.source+
":"+d.line+":"+d.column;if(n){var t=this.location.end,l=f("",d.line.toString().length," ");n=n[c.line-1];t=(c.line===t.line?t.column:n.length+1)-c.column||1;h+="\n --\x3e "+w+"\n"+l+" |\n"+d.line+" | "+n+"\n"+l+" | "+f("",c.column-1," ")+f("",t,"^")}else h+="\n at "+w}return h};b.buildMessage=function(c,h){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function d(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function w(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+n(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+n(u)})}function t(e){return l[e.type](e)}var l={literal:function(e){return'"'+
d(e.text)+'"'},class:function(e){var u=e.parts.map(function(x){return Array.isArray(x)?w(x[0])+"-"+w(x[1]):w(x)});return"["+(e.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){e=e.map(t);var u,x;e.sort();if(0<e.length){for(x=u=1;u<e.length;u++)e[u-1]!==e[u]&&(e[x]=e[u],x++);e.length=x}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,
-1).join(", ")+", or "+e[e.length-1]}}(c)+" but "+(h?'"'+d(h)+'"':"end of input")+" found."};return{SyntaxError:b,parse:function(c,h){function n(W,ca){ca=void 0!==ca?ca:l(ya,N);throw new b(W,null,null,ca);}function d(W,ca){return{type:"literal",text:W,ignoreCase:ca}}function w(W,ca,ha){return{type:"class",parts:W,inverted:ca,ignoreCase:ha}}function t(W){var ca=ye[W],ha;if(!ca){for(ha=W-1;!ye[ha];)ha--;ca=ye[ha];for(ca={line:ca.line,column:ca.column};ha<W;)10===c.charCodeAt(ha)?(ca.line++,ca.column=
1):ca.column++,ha++;ye[W]=ca}return ca}function l(W,ca,ha){ha=t(W);var ra=t(ca);return{source:Uc,start:{offset:W,line:ha.line,column:ha.column},end:{offset:ca,line:ra.line,column:ra.column}}}function e(W){N<Hb||(N>Hb&&(Hb=N,rf=[]),rf.push(W))}function u(){var W=N;ua();var ca=y();ca!==H?(ua(),ya=W,W=ca):(N=W,W=H);return W}function x(){var W=N;var ca=y();if(ca!==H){var ha=[];var ra=N;var Ca=ua();var Ia=Sa();if(Ia!==H){var La=ua();var Na=y();Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)}else N=ra,ra=H;for(;ra!==
H;)ha.push(ra),ra=N,Ca=ua(),Ia=Sa(),Ia!==H?(La=ua(),Na=y(),Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)):(N=ra,ra=H);ya=W;W={type:"expression-list"};ca=[ca];for(ra=0;ra<ha.length;ra++)ca.push(ha[ra][3]);W.value=ca}else N=W,W=H;return W}function y(){var W=N;var ca=A();if(ca!==H){var ha=[];var ra=N;var Ca=ua();var Ia=Y();if(Ia!==H){var La=ua();var Na=A();Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)}else N=ra,ra=H;for(;ra!==H;)ha.push(ra),ra=N,Ca=ua(),Ia=Y(),Ia!==H?(La=ua(),Na=A(),Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=
ra,ra=H)):(N=ra,ra=H);ya=W;W=lb(ca,ha)}else N=W,W=H;return W}function A(){var W=N;var ca=k();if(ca!==H){var ha=[];var ra=N;var Ca=ua();var Ia=X();if(Ia!==H){var La=ua();var Na=k();Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)}else N=ra,ra=H;for(;ra!==H;)ha.push(ra),ra=N,Ca=ua(),Ia=X(),Ia!==H?(La=ua(),Na=k(),Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)):(N=ra,ra=H);ya=W;W=lb(ca,ha)}else N=W,W=H;return W}function k(){var W=N;var ca=Q();if(ca===H){ca=N;if(33===c.charCodeAt(N)){var ha=wd;N++}else ha=H,0===sa&&e(gd);
if(ha!==H){var ra=N;sa++;if(61===c.charCodeAt(N)){var Ca=Wc;N++}else Ca=H,0===sa&&e(xb);sa--;Ca===H?ra=void 0:(N=ra,ra=H);ra!==H?ca=ha=[ha,ra]:(N=ca,ca=H)}else N=ca,ca=H}ca!==H?(ha=ua(),ra=k(),ra!==H?(ya=W,W={type:"unary-expression",operator:"NOT",expr:ra}):(N=W,W=H)):(N=W,W=H);if(W===H){ca=N;W=E();if(W!==H){ua();ha=N;ra=[];Ca=N;var Ia=ua();var La=v();if(La!==H){var Na=ua();var zc=E();zc!==H?Ca=Ia=[Ia,La,Na,zc]:(N=Ca,Ca=H)}else N=Ca,Ca=H;if(Ca!==H)for(;Ca!==H;)ra.push(Ca),Ca=N,Ia=ua(),La=v(),La!==
H?(Na=ua(),zc=E(),zc!==H?Ca=Ia=[Ia,La,Na,zc]:(N=Ca,Ca=H)):(N=Ca,Ca=H);else ra=H;ra!==H&&(ya=ha,ra={type:"arithmetic",tail:ra});ha=ra;ha===H&&(ha=N,ra=z(),ra!==H?(ua(),Ca=Ma(),Ca!==H?(ua(),Ca=x(),Ca!==H?(ua(),Ia=Pa(),Ia!==H?(ya=ha,ha={op:ra,right:Ca}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=z(),ra!==H?(ua(),Ca=Ma(),Ca!==H?(ua(),Ca=Pa(),Ca!==H?(ya=ha,ha={op:ra,right:{type:"expression-list",value:[]}}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=z(),ra!==H?(ua(),
Ca=M(),Ca!==H?(ya=ha,ha={op:ra,right:Ca}):(N=ha,ha=H)):(N=ha,ha=H))),ha===H&&(ha=N,Ia=Q(),Ia!==H?(ua(),ra=ia(),ra!==H?(ua(),Ca=E(),Ca!==H?(ua(),La=X(),La!==H?(ua(),Ia=E(),Ia!==H?(ya=ha,ha={op:"NOT"+ra,right:{type:"expression-list",value:[Ca,Ia]}}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,Ia=ia(),Ia!==H?(ua(),ra=E(),ra!==H?(ua(),Ca=X(),Ca!==H?(ua(),La=E(),La!==H?(ya=ha,ha={op:Ia,right:{type:"expression-list",value:[ra,La]}}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):
(N=ha,ha=H)),ha===H&&(ha=N,ra=ka(),ra!==H?(ua(),Ca=Q(),Ca!==H?(ua(),Ca=E(),Ca!==H?(ya=ha,ha={op:ra+"NOT",right:Ca}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=ka(),ra!==H?(ua(),Ca=E(),Ca!==H?(ya=ha,ha={op:ra,right:Ca}):(N=ha,ha=H)):(N=ha,ha=H)),ha===H&&(ha=N,ra=B(),ra!==H?(ua(),Ca=V(),Ca!==H?(ua(),Ia=N,c.substr(N,6).toLowerCase()===Mb?(La=c.substr(N,6),N+=6):(La=H,0===sa&&e(sc)),La!==H?(La=N,sa++,Na=J(),sa--,Na===H?La=void 0:(N=La,La=H),La!==H?(ya=Ia,Ia="ESCAPE"):(N=Ia,Ia=H)):(N=Ia,Ia=
H),Ia!==H?(ua(),Ia=aa(),Ia!==H?(ya=ha,ha={op:ra,right:Ca,escape:Ia.value}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=B(),ra!==H?(ua(),Ca=V(),Ca!==H?(ya=ha,ha={op:ra,right:Ca,escape:""}):(N=ha,ha=H)):(N=ha,ha=H))))));ha===H&&(ha=null);ya=ca;ca=ha;""==ca||void 0==ca||null==ca?ca=W:(ha=null,ca=ha="arithmetic"==ca.type?lb(W,ca.tail):bb(ca.op,W,ca.right,ca.escape))}else N=ca,ca=H;W=ca}return W}function v(){if(c.substr(N,2)===xd){var W=xd;N+=2}else W=H,0===sa&&e(fb);W===H&&(62===
c.charCodeAt(N)?(W=yd,N++):(W=H,0===sa&&e(ob)),W===H&&(c.substr(N,2)===Kb?(W=Kb,N+=2):(W=H,0===sa&&e(hd)),W===H&&(c.substr(N,2)===zd?(W=zd,N+=2):(W=H,0===sa&&e(oe)),W===H&&(60===c.charCodeAt(N)?(W=cb,N++):(W=H,0===sa&&e(nc)),W===H&&(61===c.charCodeAt(N)?(W=Wc,N++):(W=H,0===sa&&e(xb)),W===H&&(c.substr(N,2)===mb?(W=mb,N+=2):(W=H,0===sa&&e(hf))))))));return W}function B(){var W;var ca=W=N;var ha=Q();if(ha!==H){var ra=ua();var Ca=qa();Ca!==H?ca=ha=[ha,ra,Ca]:(N=ca,ca=H)}else N=ca,ca=H;ca!==H&&(ya=W,ca=
ca[0]+" "+ca[2]);W=ca;W===H&&(W=qa());return W}function z(){var W;var ca=W=N;var ha=Q();if(ha!==H){var ra=ua();var Ca=fa();Ca!==H?ca=ha=[ha,ra,Ca]:(N=ca,ca=H)}else N=ca,ca=H;ca!==H&&(ya=W,ca=ca[0]+" "+ca[2]);W=ca;W===H&&(W=fa());return W}function E(){var W=N;var ca=I();if(ca!==H){var ha=[];var ra=N;var Ca=ua();var Ia=K();if(Ia!==H){var La=ua();var Na=I();Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)}else N=ra,ra=H;for(;ra!==H;)ha.push(ra),ra=N,Ca=ua(),Ia=K(),Ia!==H?(La=ua(),Na=I(),Na!==H?ra=Ca=[Ca,Ia,La,
Na]:(N=ra,ra=H)):(N=ra,ra=H);ya=W;W=lb(ca,ha)}else N=W,W=H;return W}function K(){if(43===c.charCodeAt(N)){var W=vb;N++}else W=H,0===sa&&e(Md);W===H&&(45===c.charCodeAt(N)?(W=zb,N++):(W=H,0===sa&&e(id)),W===H&&(c.substr(N,2)===ic?(W=ic,N+=2):(W=H,0===sa&&e(pe))));return W}function I(){var W=N;var ca=G();if(ca!==H){var ha=[];var ra=N;var Ca=ua();var Ia=D();if(Ia!==H){var La=ua();var Na=G();Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)}else N=ra,ra=H;for(;ra!==H;)ha.push(ra),ra=N,Ca=ua(),Ia=D(),Ia!==H?(La=
ua(),Na=G(),Na!==H?ra=Ca=[Ca,Ia,La,Na]:(N=ra,ra=H)):(N=ra,ra=H);ya=W;W=lb(ca,ha)}else N=W,W=H;return W}function D(){if(42===c.charCodeAt(N)){var W=db;N++}else W=H,0===sa&&e(qe);W===H&&(47===c.charCodeAt(N)?(W=Yb,N++):(W=H,0===sa&&e(jf)));return W}function G(){var W=aa();if(W===H){var ca=N;var ha=N;var ra=ta();if(ra!==H){var Ca=va();if(Ca!==H){var Ia=xa();Ia!==H?(ya=ha,ha=parseFloat(ra+Ca+Ia)):(N=ha,ha=H)}else N=ha,ha=H}else N=ha,ha=H;ha===H&&(ha=N,ra=ta(),ra!==H?(Ca=va(),Ca!==H?(ya=ha,ha=parseFloat(ra+
Ca)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=ta(),ra!==H?(Ca=xa(),Ca!==H?(ya=ha,ha=parseFloat(ra+Ca)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=ta(),ra!==H&&(ya=ha,ra=parseFloat(ra)),ha=ra)));var La=ha;if(La!==H){var Na=N;sa++;var zc=F();sa--;zc===H?Na=void 0:(N=Na,Na=H);Na!==H?(ya=ca,ca={type:"number",value:La}):(N=ca,ca=H)}else N=ca,ca=H;W=ca;if(W===H){var Ac=N;var sd=N;if(c.substr(N,4).toLowerCase()===Ye){var ze=c.substr(N,4);N+=4}else ze=H,0===sa&&e(te);if(ze!==H){var Td=N;sa++;var ig=J();sa--;
ig===H?Td=void 0:(N=Td,Td=H);Td!==H?sd=ze=[ze,Td]:(N=sd,sd=H)}else N=sd,sd=H;var Bc=sd;Bc!==H&&(ya=Ac,Bc={type:"boolean",value:!0});Ac=Bc;if(Ac===H){Ac=N;var td=N;if(c.substr(N,5).toLowerCase()===Ze){var Ae=c.substr(N,5);N+=5}else Ae=H,0===sa&&e(qb);if(Ae!==H){var Ud=N;sa++;var jg=J();sa--;jg===H?Ud=void 0:(N=Ud,Ud=H);Ud!==H?td=Ae=[Ae,Ud]:(N=td,td=H)}else N=td,td=H;Bc=td;Bc!==H&&(ya=Ac,Bc={type:"boolean",value:!1});Ac=Bc}W=Ac;if(W===H){var kg=N;var ud=N;if(c.substr(N,4).toLowerCase()===ge){var Be=
c.substr(N,4);N+=4}else Be=H,0===sa&&e(rc);if(Be!==H){var Vd=N;sa++;var lg=J();sa--;lg===H?Vd=void 0:(N=Vd,Vd=H);Vd!==H?ud=Be=[Be,Vd]:(N=ud,ud=H)}else N=ud,ud=H;var sf=ud;sf!==H&&(ya=kg,sf={type:"null",value:null});W=sf;if(W===H){var Cc=N;if(la()!==H){ua();var Ce=V();Ce!==H?(ya=Cc,"string"===Ce.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Ce.value)&&
n("Date literal is invalid"),Cc={type:"date",value:Ce.value}):(N=Cc,Cc=H)}else N=Cc,Cc=H;W=Cc;if(W===H){var Dc=N;if(da()!==H){ua();var De=V();De!==H?(ya=Dc,"string"===De.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(De.value)&&
n("Timestamp literal is invalid"),Dc={type:"timestamp",value:De.value}):(N=Dc,Dc=H)}else N=Dc,Dc=H;W=Dc;if(W===H){var Za=N;var tf=za();if(tf!==H){ua();if(45===c.charCodeAt(N)){var Sb=zb;N++}else Sb=H,0===sa&&e(id);Sb===H&&(43===c.charCodeAt(N)?(Sb=vb,N++):(Sb=H,0===sa&&e(Md)));if(Sb!==H){ua();var Wd=V();if(Wd!==H){ua();var Gf=R();Gf!==H?(ya=Za,Za={type:"interval",value:Wd,qualifier:Gf,op:Sb}):(N=Za,Za=H)}else N=Za,Za=H}else N=Za,Za=H}else N=Za,Za=H;Za===H&&(Za=N,tf=za(),tf!==H?(ua(),Sb=V(),Sb!==H?
(ua(),Wd=R(),Wd!==H?(ya=Za,Za={type:"interval",value:Sb,qualifier:Wd,op:""}):(N=Za,Za=H)):(N=Za,Za=H)):(N=Za,Za=H));W=Za;if(W===H){var Ec=N;if(pa()!==H){ua();var Ee=V();Ee!==H?(ya=Ec,"string"===Ee.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(Ee.value)&&n("Time literal is invalid"),Ec={type:"time",value:Ee.value}):(N=Ec,Ec=H)}else N=Ec,Ec=H;W=Ec}}}}}}}var Ua=W;if(Ua===H){var gb=N;var Fc=N;if(c.substr(N,7).toLowerCase()===kc){var Hf=
c.substr(N,7);N+=7}else Hf=H,0===sa&&e(qd);if(Hf!==H){var Fe=N;sa++;var mg=J();sa--;mg===H?Fe=void 0:(N=Fe,Fe=H);Fe!==H?(ya=Fc,Fc="EXTRACT"):(N=Fc,Fc=H)}else N=Fc,Fc=H;if(Fc!==H){ua();var ng=Ma();if(ng!==H){ua();var hb=Aa();if(hb===H&&(hb=Ba(),hb===H&&(hb=Ga(),hb===H&&(hb=Da(),hb===H&&(hb=Ha(),hb===H&&(hb=Fa(),hb===H)))))){var Gc=N;if(c.substr(N,13).toLowerCase()===Hd){var If=c.substr(N,13);N+=13}else If=H,0===sa&&e(rb);if(If!==H){var Ge=N;sa++;var og=J();sa--;og===H?Ge=void 0:(N=Ge,Ge=H);Ge!==H?
(ya=Gc,Gc="TIMEZONE_HOUR"):(N=Gc,Gc=H)}else N=Gc,Gc=H;hb=Gc;if(hb===H){var Hc=N;if(c.substr(N,15).toLowerCase()===bd){var Jf=c.substr(N,15);N+=15}else Jf=H,0===sa&&e(wc);if(Jf!==H){var He=N;sa++;var pg=J();sa--;pg===H?He=void 0:(N=He,He=H);He!==H?(ya=Hc,Hc="TIMEZONE_MINUTE"):(N=Hc,Hc=H)}else N=Hc,Hc=H;hb=Hc}}var Kf=hb;if(Kf!==H){ua();var qg=na();if(qg!==H){ua();var Lf=y();if(Lf!==H){ua();var rg=Pa();rg!==H?(ya=gb,gb={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",
value:Kf},Lf]}}):(N=gb,gb=H)}else N=gb,gb=H}else N=gb,gb=H}else N=gb,gb=H}else N=gb,gb=H}else N=gb,gb=H;Ua=gb;if(Ua===H){var ib=N;var Ic=N;if(c.substr(N,9).toLowerCase()===Cd){var Mf=c.substr(N,9);N+=9}else Mf=H,0===sa&&e(Od);if(Mf!==H){var Ie=N;sa++;var sg=J();sa--;sg===H?Ie=void 0:(N=Ie,Ie=H);Ie!==H?(ya=Ic,Ic="SUBSTRING"):(N=Ic,Ic=H)}else N=Ic,Ic=H;if(Ic!==H){ua();var tg=Ma();if(tg!==H){ua();var uf=y();if(uf!==H){ua();var ug=na();if(ug!==H){ua();var vf=y();if(vf!==H){ua();var Tb=N;var Jc=N;if(c.substr(N,
3).toLowerCase()===jc){var Nf=c.substr(N,3);N+=3}else Nf=H,0===sa&&e(gc);if(Nf!==H){var Je=N;sa++;var vg=J();sa--;vg===H?Je=void 0:(N=Je,Je=H);Je!==H?(ya=Jc,Jc="FOR"):(N=Jc,Jc=H)}else N=Jc,Jc=H;var Xd=Jc;if(Xd!==H){var wg=ua();var Of=y();if(Of!==H){var xg=ua();Tb=Xd=[Xd,wg,Of,xg]}else N=Tb,Tb=H}else N=Tb,Tb=H;Tb===H&&(Tb=null);Xd=Pa();Xd!==H?(ya=ib,ib={type:"function",name:"substring",args:{type:"expression-list",value:Tb?[uf,vf,Tb[2]]:[uf,vf]}}):(N=ib,ib=H)}else N=ib,ib=H}else N=ib,ib=H}else N=ib,
ib=H}else N=ib,ib=H}else N=ib,ib=H;Ua=ib;if(Ua===H){var Wa=N;var wf=O();if(wf!==H){ua();var xf=Ma();if(xf!==H){ua();var Ub=U();Ub===H&&(Ub=null);ua();var Yd=y();if(Yd!==H){ua();var yf=na();if(yf!==H){ua();var Pf=y();if(Pf!==H){ua();var yg=Pa();yg!==H?(ya=Wa,Wa={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ub?"BOTH":Ub},Yd,Pf]}}):(N=Wa,Wa=H)}else N=Wa,Wa=H}else N=Wa,Wa=H}else N=Wa,Wa=H}else N=Wa,Wa=H}else N=Wa,Wa=H;Wa===H&&(Wa=N,wf=O(),wf!==H?(ua(),xf=
Ma(),xf!==H?(ua(),Ub=U(),Ub===H&&(Ub=null),ua(),Yd=y(),Yd!==H?(ua(),yf=Pa(),yf!==H?(ya=Wa,Wa={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ub?"BOTH":Ub},Yd]}}):(N=Wa,Wa=H)):(N=Wa,Wa=H)):(N=Wa,Wa=H)):(N=Wa,Wa=H));Ua=Wa;if(Ua===H){var jb=N;var Kc=N;if(c.substr(N,8).toLowerCase()===lc){var Qf=c.substr(N,8);N+=8}else Qf=H,0===sa&&e(mf);if(Qf!==H){var Ke=N;sa++;var zg=J();sa--;zg===H?Ke=void 0:(N=Ke,Ke=H);Ke!==H?(ya=Kc,Kc="POSITION"):(N=Kc,Kc=H)}else N=Kc,
Kc=H;if(Kc!==H){ua();var Ag=Ma();if(Ag!==H){ua();var Rf=y();if(Rf!==H){ua();var Bg=fa();if(Bg!==H){ua();var Sf=y();if(Sf!==H){ua();var Cg=Pa();Cg!==H?(ya=jb,jb={type:"function",name:"position",args:{type:"expression-list",value:[Rf,Sf]}}):(N=jb,jb=H)}else N=jb,jb=H}else N=jb,jb=H}else N=jb,jb=H}else N=jb,jb=H}else N=jb,jb=H;Ua=jb;if(Ua===H){var kb=N;var Lc=N;if(c.substr(N,4).toLowerCase()===af){var Tf=c.substr(N,4);N+=4}else Tf=H,0===sa&&e(ve);if(Tf!==H){var Le=N;sa++;var Dg=J();sa--;Dg===H?Le=void 0:
(N=Le,Le=H);Le!==H?(ya=Lc,Lc="CAST"):(N=Lc,Lc=H)}else N=Lc,Lc=H;if(Lc!==H){ua();var Eg=Ma();if(Eg!==H){ua();var Uf=y();if(Uf!==H){ua();var Mc=N;if(c.substr(N,2).toLowerCase()===$c){var Vf=c.substr(N,2);N+=2}else Vf=H,0===sa&&e(of);if(Vf!==H){var Me=N;sa++;var Fg=J();sa--;Fg===H?Me=void 0:(N=Me,Me=H);Me!==H?(ya=Mc,Mc="AS"):(N=Mc,Mc=H)}else N=Mc,Mc=H;var Gg=Mc;if(Gg!==H){ua();var Oa=N;var Nc=N;if(c.substr(N,7).toLowerCase()===Nb){var Wf=c.substr(N,7);N+=7}else Wf=H,0===sa&&e(pf);if(Wf!==H){var Ne=N;
sa++;var Hg=J();sa--;Hg===H?Ne=void 0:(N=Ne,Ne=H);Ne!==H?(ya=Nc,Nc="INTEGER"):(N=Nc,Nc=H)}else N=Nc,Nc=H;var Va=Nc;Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"integer"}});Oa=Va;if(Oa===H){Oa=N;var Oc=N;if(c.substr(N,8).toLowerCase()===ad){var Xf=c.substr(N,8);N+=8}else Xf=H,0===sa&&e(rd);if(Xf!==H){var Oe=N;sa++;var Ig=J();sa--;Ig===H?Oe=void 0:(N=Oe,Oe=H);Oe!==H?(ya=Oc,Oc="SMALLINT"):(N=Oc,Oc=H)}else N=Oc,Oc=H;Va=Oc;Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"smallint"}});Oa=Va;if(Oa===
H){Oa=N;var Pc=N;if(c.substr(N,5).toLowerCase()===Fd){var Yf=c.substr(N,5);N+=5}else Yf=H,0===sa&&e(Rd);if(Yf!==H){var Pe=N;sa++;var Jg=J();sa--;Jg===H?Pe=void 0:(N=Pe,Pe=H);Pe!==H?(ya=Pc,Pc="FLOAT"):(N=Pc,Pc=H)}else N=Pc,Pc=H;Va=Pc;Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"float"}});Oa=Va;if(Oa===H){Oa=N;var Qc=N;if(c.substr(N,4).toLowerCase()===bc){var Zf=c.substr(N,4);N+=4}else Zf=H,0===sa&&e(qf);if(Zf!==H){var Qe=N;sa++;var Kg=J();sa--;Kg===H?Qe=void 0:(N=Qe,Qe=H);Qe!==H?(ya=Qc,Qc="REAL"):
(N=Qc,Qc=H)}else N=Qc,Qc=H;Va=Qc;Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"real"}});Oa=Va;if(Oa===H&&(Oa=N,Va=la(),Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"date"}}),Oa=Va,Oa===H&&(Oa=N,Va=da(),Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"timestamp"}}),Oa=Va,Oa===H&&(Oa=N,Va=pa(),Va!==H&&(ya=Oa,Va={type:"data-type",value:{type:"time"}}),Oa=Va,Oa===H)))){Oa=N;var Rc=N;if(c.substr(N,7).toLowerCase()===bf){var $f=c.substr(N,7);N+=7}else $f=H,0===sa&&e(we);if($f!==H){var Re=N;sa++;var Lg=
J();sa--;Lg===H?Re=void 0:(N=Re,Re=H);Re!==H?(ya=Rc,Rc="VARCHAR"):(N=Rc,Rc=H)}else N=Rc,Rc=H;Va=Rc;if(Va!==H){ua();var Mg=Ma();if(Mg!==H){ua();var ag=L();if(ag!==H){ua();var Ng=Pa();Ng!==H?(ya=Oa,Oa={type:"data-type",value:{type:"varchar",size:parseInt(ag)}}):(N=Oa,Oa=H)}else N=Oa,Oa=H}else N=Oa,Oa=H}else N=Oa,Oa=H}}}}var bg=Oa;if(bg!==H){ua();var Og=Pa();Og!==H?(ya=kb,kb={type:"function",name:"cast",args:{type:"expression-list",value:[Uf,bg]}}):(N=kb,kb=H)}else N=kb,kb=H}else N=kb,kb=H}else N=kb,
kb=H}else N=kb,kb=H}else N=kb,kb=H;Ua=kb;if(Ua===H){var Vb=N;var sb=N;var Zd=C();Zd!==H&&(ya=sb);sb=Zd;if(sb===H)if(sb=N,96===c.charCodeAt(N)?(Zd=Ld,N++):(Zd=H,0===sa&&e(cg)),Zd!==H){var Se=[];if(ne.test(c.charAt(N))){var Wb=c.charAt(N);N++}else Wb=H,0===sa&&e(dg);if(Wb!==H)for(;Wb!==H;)Se.push(Wb),ne.test(c.charAt(N))?(Wb=c.charAt(N),N++):(Wb=H,0===sa&&e(dg));else Se=H;Se!==H?(96===c.charCodeAt(N)?(Wb=Ld,N++):(Wb=H,0===sa&&e(cg)),Wb!==H?(ya=sb,sb=Se.join("")):(N=sb,sb=H)):(N=sb,sb=H)}else N=sb,sb=
H;var eg=sb;if(eg!==H){ua();var Pg=Ma();if(Pg!==H){ua();var Te=x();Te===H&&(Te=null);ua();var Qg=Pa();Qg!==H?(ya=Vb,Vb={type:"function",name:eg,args:Te?Te:{type:"expression-list",value:[]}}):(N=Vb,Vb=H)}else N=Vb,Vb=H}else N=Vb,Vb=H;Ua=Vb;if(Ua===H){var Ib;var $a=N;var zf=Ea();if(zf!==H){ua();var $d=y();if($d!==H){ua();var ae=[];for(Ib=oa();Ib!==H;)ae.push(Ib),Ib=oa();Ib=ua();var Ue=Ka();Ue!==H?(ya=$a,$a={type:"case-expression",format:"simple",operand:$d,clauses:ae,else:null}):(N=$a,$a=H)}else N=
$a,$a=H}else N=$a,$a=H;if($a===H)if($a=N,zf=Ea(),zf!==H)if(ua(),$d=y(),$d!==H){ua();ae=[];for(Ib=oa();Ib!==H;)ae.push(Ib),Ib=oa();Ib=ua();Ue=wa();if(Ue!==H){ua();var Rg=Ka();Rg!==H?(ya=$a,$a={type:"case-expression",format:"simple",operand:$d,clauses:ae,else:Ue.value}):(N=$a,$a=H)}else N=$a,$a=H}else N=$a,$a=H;else N=$a,$a=H;var Af=$a;if(Af===H){var Jb;var ab=N;var Bf=Ea();if(Bf!==H){ua();var be=[];for(Jb=ja();Jb!==H;)be.push(Jb),Jb=ja();Jb=ua();var Ve=Ka();Ve!==H?(ya=ab,ab={type:"case-expression",
format:"searched",clauses:be,else:null}):(N=ab,ab=H)}else N=ab,ab=H;if(ab===H)if(ab=N,Bf=Ea(),Bf!==H){ua();be=[];for(Jb=ja();Jb!==H;)be.push(Jb),Jb=ja();Jb=ua();Ve=wa();if(Ve!==H){ua();var Sg=Ka();Sg!==H?(ya=ab,ab={type:"case-expression",format:"searched",clauses:be,else:Ve.value}):(N=ab,ab=H)}else N=ab,ab=H}else N=ab,ab=H;Af=ab}Ua=Af;if(Ua===H){var Sc=N;var Tg=N;var We;var ce=N;var fg=F();if(fg!==H){var gg=[];for(We=T();We!==H;)gg.push(We),We=T();ya=ce;ce=fg+gg.join("")}else N=ce,ce=H;var hg=ce;
hg!==H&&(ya=Tg);var Xb=hg;if(Xb!==H){ya=Sc;var Cf=Xb;Xb=/^CURRENT_DATE$/i.test(Cf)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Cf)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Cf}}Sc=Xb;if(Sc===H){Sc=N;var Tc=N;if(ba()!==H){var Xe;var Ug=N;var Df=[];for(Xe=S();Xe!==H;)Df.push(Xe),Xe=S();ya=Ug;var Vg=Df=Df.join("");var Wg=ba();Wg!==H?(ya=Tc,Tc=Vg):(N=Tc,Tc=H)}else N=Tc,Tc=H;Xb=Tc;Xb!==H&&(ya=Sc,Xb={type:"column-reference",table:"",column:Xb,delimited:!0});
Sc=Xb}Ua=Sc;if(Ua===H&&(Ua=M(),Ua===H)){Ua=N;var Xg=Ma();if(Xg!==H){ua();var Ef=y();if(Ef!==H){ua();var Yg=Pa();Yg!==H?(ya=Ua,Ef.paren=!0,Ua=Ef):(N=Ua,Ua=H)}else N=Ua,Ua=H}else N=Ua,Ua=H}}}}}}}}}return Ua}function C(){var W;var ca=N;var ha=F();if(ha!==H){var ra=[];for(W=J();W!==H;)ra.push(W),W=J();ya=ca;ca=ha+ra.join("")}else N=ca,ca=H;return ca}function F(){if(ef.test(c.charAt(N))){var W=c.charAt(N);N++}else W=H,0===sa&&e(re);return W}function J(){if(ff.test(c.charAt(N))){var W=c.charAt(N);N++}else W=
H,0===sa&&e(kf);return W}function T(){if(dc.test(c.charAt(N))){var W=c.charAt(N);N++}else W=H,0===sa&&e(Nd);return W}function S(){if(dc.test(c.charAt(N))){var W=c.charAt(N);N++}else W=H,0===sa&&e(Nd);if(W===H)if(W=N,ba()!==H){var ca=ba();ca!==H?(ya=W,W='"'):(N=W,W=H)}else N=W,W=H;return W}function ba(){if(Cb.test(c.charAt(N))){var W=c.charAt(N);N++}else W=H,0===sa&&e(oc);return W}function M(){var W;var ca=W=N;if(64===c.charCodeAt(N)){var ha=de;N++}else ha=H,0===sa&&e(se);if(ha!==H){var ra=C();ra!==
H?ca=ha=[ha,ra]:(N=ca,ca=H)}else N=ca,ca=H;ca!==H&&(ya=W,ca={type:"parameter",value:ca[1]});return ca}function U(){var W=N;if(c.substr(N,7).toLowerCase()===Zc){var ca=c.substr(N,7);N+=7}else ca=H,0===sa&&e(vc);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="LEADING"):(N=W,W=H)}else N=W,W=H;W===H&&(W=N,c.substr(N,8).toLowerCase()===mc?(ca=c.substr(N,8),N+=8):(ca=H,0===sa&&e(Rb)),ca!==H?(ca=N,sa++,ha=J(),sa--,ha===H?ca=void 0:(N=ca,ca=H),ca!==H?(ya=W,W="TRAILING"):
(N=W,W=H)):(N=W,W=H),W===H&&(W=N,c.substr(N,4).toLowerCase()===Ed?(ca=c.substr(N,4),N+=4):(ca=H,0===sa&&e(Qd)),ca!==H?(ca=N,sa++,ha=J(),sa--,ha===H?ca=void 0:(N=ca,ca=H),ca!==H?(ya=W,W="BOTH"):(N=W,W=H)):(N=W,W=H)));return W}function R(){var W=N;var ca=N;var ha=Z();if(ha!==H){ua();var ra=Ma();if(ra!==H)if(ua(),ra=ma(),ra!==H){ua();var Ca=Pa();Ca!==H?(ya=ca,ca={type:"interval-period",period:ha.value,precision:ra,secondary:null}):(N=ca,ca=H)}else N=ca,ca=H;else N=ca,ca=H}else N=ca,ca=H;ca===H&&(ca=
N,ha=Z(),ha!==H&&(ya=ca,ha={type:"interval-period",period:ha.value,precision:null,secondary:null}),ca=ha);if(ca!==H)if(ua(),ha=N,c.substr(N,2).toLowerCase()===nb?(ra=c.substr(N,2),N+=2):(ra=H,0===sa&&e(Sd)),ra!==H?(ra=N,sa++,Ca=J(),sa--,Ca===H?ra=void 0:(N=ra,ra=H),ra!==H?(ya=ha,ha="TO"):(N=ha,ha=H)):(N=ha,ha=H),ha!==H){ua();ha=N;ra=Z();ra!==H&&(ya=ha,ra={type:"interval-period",period:ra.value,precision:null,secondary:null});ha=ra;if(ha===H){ha=N;ra=Fa();if(ra!==H)if(ua(),ra=Ma(),ra!==H)if(ua(),ra=
ma(),ra!==H)if(ua(),Ca=Sa(),Ca!==H)if(ua(),Ca=ea(),Ca!==H){ua();var Ia=Pa();Ia!==H?(ya=ha,ha={type:"interval-period",period:"second",precision:ra,secondary:Ca}):(N=ha,ha=H)}else N=ha,ha=H;else N=ha,ha=H;else N=ha,ha=H;else N=ha,ha=H;else N=ha,ha=H;ha===H&&(ha=N,ra=Fa(),ra!==H?(ua(),ra=Ma(),ra!==H?(ua(),ra=ma(),ra!==H?(ua(),Ca=Pa(),Ca!==H?(ya=ha,ha={type:"interval-period",period:"second",precision:ra,secondary:null}):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H)):(N=ha,ha=H),ha===H&&(ha=N,ra=Fa(),ra!==H&&
(ya=ha,ra={type:"interval-period",period:"second",precision:null,secondary:null}),ha=ra))}ha!==H?(ya=W,W={type:"interval-qualifier",start:ca,end:ha}):(N=W,W=H)}else N=W,W=H;else N=W,W=H;W===H&&(W=N,ha=Z(),ha!==H?(ua(),ca=Ma(),ca!==H?(ua(),ca=ea(),ca!==H?(ua(),ra=Pa(),ra!==H?(ya=W,W={type:"interval-period",period:ha.value,precision:ca,secondary:null}):(N=W,W=H)):(N=W,W=H)):(N=W,W=H)):(N=W,W=H),W===H&&(W=N,ha=Z(),ha!==H&&(ya=W,ha={type:"interval-period",period:ha.value,precision:null,secondary:null}),
W=ha,W===H&&(W=N,ha=Fa(),ha!==H?(ua(),ca=Ma(),ca!==H?(ua(),ca=ma(),ca!==H?(ua(),ra=Sa(),ra!==H?(ua(),ha=ea(),ha!==H?(ua(),ra=Pa(),ra!==H?(ya=W,W={type:"interval-period",period:"second",precision:ca,secondary:ha}):(N=W,W=H)):(N=W,W=H)):(N=W,W=H)):(N=W,W=H)):(N=W,W=H)):(N=W,W=H),W===H&&(W=N,ha=Fa(),ha!==H?(ua(),ca=Ma(),ca!==H?(ua(),ca=ea(),ca!==H?(ua(),ra=Pa(),ra!==H?(ya=W,W={type:"interval-period",period:"second",precision:ca,secondary:null}):(N=W,W=H)):(N=W,W=H)):(N=W,W=H)):(N=W,W=H),W===H&&(W=N,
ha=Fa(),ha!==H&&(ya=W,ha={type:"interval-period",period:"second",precision:null,secondary:null}),W=ha)))));return W}function Z(){var W=N;var ca=Ga();ca!==H&&(ya=W,ca={type:"string",value:"day"});W=ca;W===H&&(W=N,ca=Da(),ca!==H&&(ya=W,ca={type:"string",value:"hour"}),W=ca,W===H&&(W=N,ca=Ha(),ca!==H&&(ya=W,ca={type:"string",value:"minute"}),W=ca,W===H&&(W=N,ca=Ba(),ca!==H&&(ya=W,ca={type:"string",value:"month"}),W=ca,W===H&&(W=N,ca=Aa(),ca!==H&&(ya=W,ca={type:"string",value:"year"}),W=ca))));return W}
function ea(){var W=N;var ca=L();ca!==H&&(ya=W,ca=parseFloat(ca));return ca}function ma(){var W=N;var ca=L();ca!==H&&(ya=W,ca=parseFloat(ca));return ca}function V(){var W=aa();W===H&&(W=M());return W}function aa(){var W=N;if(39===c.charCodeAt(N)){var ca=ee;N++}else ca=H,0===sa&&e(Qb);ca===H&&(c.substr(N,2)===Xc?(ca=Xc,N+=2):(ca=H,0===sa&&e(pb)));if(ca!==H){ca=[];var ha=N;if(c.substr(N,2)===Zb){var ra=Zb;N+=2}else ra=H,0===sa&&e(pc);ra!==H&&(ya=ha,ra="'");ha=ra;ha===H&&(Db.test(c.charAt(N))?(ha=c.charAt(N),
N++):(ha=H,0===sa&&e(qc)));for(;ha!==H;)ca.push(ha),ha=N,c.substr(N,2)===Zb?(ra=Zb,N+=2):(ra=H,0===sa&&e(pc)),ra!==H&&(ya=ha,ra="'"),ha=ra,ha===H&&(Db.test(c.charAt(N))?(ha=c.charAt(N),N++):(ha=H,0===sa&&e(qc)));39===c.charCodeAt(N)?(ha=ee,N++):(ha=H,0===sa&&e(Qb));ha!==H?(ya=W,W={type:"string",value:ca.join("")}):(N=W,W=H)}else N=W,W=H;return W}function ja(){var W=N;if(Ta()!==H){ua();var ca=y();if(ca!==H){ua();var ha=Xa();ha!==H?(ua(),ha=y(),ha!==H?(ya=W,W={type:"when-clause",operand:ca,value:ha}):
(N=W,W=H)):(N=W,W=H)}else N=W,W=H}else N=W,W=H;return W}function oa(){var W=N;if(Ta()!==H){ua();var ca=y();if(ca!==H){ua();var ha=Xa();ha!==H?(ua(),ha=y(),ha!==H?(ya=W,W={type:"when-clause",operand:ca,value:ha}):(N=W,W=H)):(N=W,W=H)}else N=W,W=H}else N=W,W=H;return W}function wa(){var W=N;var ca=N;if(c.substr(N,4).toLowerCase()===Bb){var ha=c.substr(N,4);N+=4}else ha=H,0===sa&&e(eb);if(ha!==H){ha=N;sa++;var ra=J();sa--;ra===H?ha=void 0:(N=ha,ha=H);ha!==H?(ya=ca,ca="ELSE"):(N=ca,ca=H)}else N=ca,ca=
H;ca!==H?(ua(),ca=y(),ca!==H?(ya=W,W={type:"else-clause",value:ca}):(N=W,W=H)):(N=W,W=H);return W}function ta(){var W=L();if(W===H){W=N;if(45===c.charCodeAt(N)){var ca=zb;N++}else ca=H,0===sa&&e(id);ca===H&&(43===c.charCodeAt(N)?(ca=vb,N++):(ca=H,0===sa&&e(Md)));if(ca!==H){var ha=L();ha!==H?(ya=W,W=ca[0]+ha):(N=W,W=H)}else N=W,W=H}return W}function va(){var W=N;if(46===c.charCodeAt(N)){var ca=fe;N++}else ca=H,0===sa&&e(ec);ca!==H?(ca=L(),ca===H&&(ca=null),ya=W,W="."+(null!=ca?ca:"")):(N=W,W=H);return W}
function xa(){var W;var ca=W=N;if(le.test(c.charAt(N))){var ha=c.charAt(N);N++}else ha=H,0===sa&&e(kd);ha!==H?(me.test(c.charAt(N))?(ha=c.charAt(N),N++):(ha=H,0===sa&&e(ld)),ha===H&&(ha=null),ya=ca,ca="e"+(null===ha?"":ha)):(N=ca,ca=H);ca!==H?(ha=L(),ha!==H?(ya=W,W=ca+ha):(N=W,W=H)):(N=W,W=H);return W}function L(){var W=N;var ca=[];var ha=P();if(ha!==H)for(;ha!==H;)ca.push(ha),ha=P();else ca=H;ca!==H&&(ya=W,ca=ca.join(""));return ca}function P(){if(wb.test(c.charAt(N))){var W=c.charAt(N);N++}else W=
H,0===sa&&e(jd);return W}function fa(){var W=N;if(c.substr(N,2).toLowerCase()===he){var ca=c.substr(N,2);N+=2}else ca=H,0===sa&&e(md);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="IN"):(N=W,W=H)}else N=W,W=H;return W}function ka(){var W=N;if(c.substr(N,2).toLowerCase()===Lb){var ca=c.substr(N,2);N+=2}else ca=H,0===sa&&e(nd);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="IS"):(N=W,W=H)}else N=W,W=H;return W}function qa(){var W=
N;if(c.substr(N,4).toLowerCase()===Bd){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(fc);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="LIKE"):(N=W,W=H)}else N=W,W=H;return W}function Q(){var W=N;if(c.substr(N,3).toLowerCase()===tb){var ca=c.substr(N,3);N+=3}else ca=H,0===sa&&e(od);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="NOT"):(N=W,W=H)}else N=W,W=H;return W}function X(){var W=N;if(c.substr(N,3).toLowerCase()===ie){var ca=
c.substr(N,3);N+=3}else ca=H,0===sa&&e(tc);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="AND"):(N=W,W=H)}else N=W,W=H;return W}function Y(){var W=N;if(c.substr(N,2).toLowerCase()===$b){var ca=c.substr(N,2);N+=2}else ca=H,0===sa&&e(lf);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="OR"):(N=W,W=H)}else N=W,W=H;return W}function ia(){var W=N;if(c.substr(N,7).toLowerCase()===je){var ca=c.substr(N,7);N+=7}else ca=H,0===sa&&e(uc);if(ca!==
H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="BETWEEN"):(N=W,W=H)}else N=W,W=H;return W}function na(){var W=N;if(c.substr(N,4).toLowerCase()===ac){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(pd);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="FROM"):(N=W,W=H)}else N=W,W=H;return W}function O(){var W=N;if(c.substr(N,4).toLowerCase()===ke){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(ue);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=
void 0:(N=ca,ca=H);ca!==H?(ya=W,W="TRIM"):(N=W,W=H)}else N=W,W=H;return W}function da(){var W=N;if(c.substr(N,9).toLowerCase()===$e){var ca=c.substr(N,9);N+=9}else ca=H,0===sa&&e(nf);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="TIMESTAMP"):(N=W,W=H)}else N=W,W=H;return W}function la(){var W=N;if(c.substr(N,4).toLowerCase()===Dd){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(Pd);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="DATE"):
(N=W,W=H)}else N=W,W=H;return W}function pa(){var W=N;if(c.substr(N,4).toLowerCase()===Yc){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(Eb);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="TIME"):(N=W,W=H)}else N=W,W=H;return W}function za(){var W=N;if(c.substr(N,8).toLowerCase()===Ab){var ca=c.substr(N,8);N+=8}else ca=H,0===sa&&e(xe);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="INTERVAL"):(N=W,W=H)}else N=W,W=H;return W}function Aa(){var W=
N;if(c.substr(N,4).toLowerCase()===Gd){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(hc);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="YEAR"):(N=W,W=H)}else N=W,W=H;return W}function Ba(){var W=N;if(c.substr(N,5).toLowerCase()===cf){var ca=c.substr(N,5);N+=5}else ca=H,0===sa&&e(ub);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="MONTH"):(N=W,W=H)}else N=W,W=H;return W}function Ga(){var W=N;if(c.substr(N,3).toLowerCase()===Ob){var ca=
c.substr(N,3);N+=3}else ca=H,0===sa&&e(xc);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="DAY"):(N=W,W=H)}else N=W,W=H;return W}function Da(){var W=N;if(c.substr(N,4).toLowerCase()===cd){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(Fb);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="HOUR"):(N=W,W=H)}else N=W,W=H;return W}function Ha(){var W=N;if(c.substr(N,6).toLowerCase()===Id){var ca=c.substr(N,6);N+=6}else ca=H,0===sa&&e(yb);
if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="MINUTE"):(N=W,W=H)}else N=W,W=H;return W}function Fa(){var W=N;if(c.substr(N,6).toLowerCase()===dd){var ca=c.substr(N,6);N+=6}else ca=H,0===sa&&e(Gb);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="SECOND"):(N=W,W=H)}else N=W,W=H;return W}function Ea(){var W=N;if(c.substr(N,4).toLowerCase()===df){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(yc);if(ca!==H){ca=N;sa++;var ha=J();sa--;
ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="CASE"):(N=W,W=H)}else N=W,W=H;return W}function Ka(){var W=N;if(c.substr(N,3).toLowerCase()===Pb){var ca=c.substr(N,3);N+=3}else ca=H,0===sa&&e(Ja);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="END"):(N=W,W=H)}else N=W,W=H;return W}function Ta(){var W=N;if(c.substr(N,4).toLowerCase()===ed){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(Ra);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,
W="WHEN"):(N=W,W=H)}else N=W,W=H;return W}function Xa(){var W=N;if(c.substr(N,4).toLowerCase()===Jd){var ca=c.substr(N,4);N+=4}else ca=H,0===sa&&e(Ya);if(ca!==H){ca=N;sa++;var ha=J();sa--;ha===H?ca=void 0:(N=ca,ca=H);ca!==H?(ya=W,W="THEN"):(N=W,W=H)}else N=W,W=H;return W}function Sa(){if(44===c.charCodeAt(N)){var W=Kd;N++}else W=H,0===sa&&e(Ad);return W}function Ma(){if(40===c.charCodeAt(N)){var W=cc;N++}else W=H,0===sa&&e(Zg);return W}function Pa(){if(41===c.charCodeAt(N)){var W=fd;N++}else W=H,
0===sa&&e($g);return W}function ua(){var W;var ca=[];for(W=Qa();W!==H;)ca.push(W),W=Qa();return ca}function Qa(){if(gf.test(c.charAt(N))){var W=c.charAt(N);N++}else W=H,0===sa&&e(ah);return W}function bb(W,ca,ha,ra){W={type:"binary-expression",operator:W,left:ca,right:ha};void 0!==ra&&(W.escape=ra);return W}function lb(W,ca){for(var ha=0;ha<ca.length;ha++)W=bb(ca[ha][1],W,ca[ha][3]);return W}h=void 0!==h?h:{};var H={},Uc=h.grammarSource,Vc={start:u},vd=u,wd="!",Wc="\x3d",xd="\x3e\x3d",yd="\x3e",Kb=
"\x3c\x3d",zd="\x3c\x3e",cb="\x3c",mb="!\x3d",vb="+",zb="-",ic="||",db="*",Yb="/",de="@",ee="'",Xc="N'",Zb="''",fe=".",ge="null",Ye="true",Ze="false",he="in",Lb="is",Bd="like",Mb="escape",tb="not",ie="and",$b="or",je="between",ac="from",jc="for",Cd="substring",kc="extract",ke="trim",lc="position",$e="timestamp",Dd="date",Yc="time",Zc="leading",mc="trailing",Ed="both",af="cast",$c="as",Nb="integer",ad="smallint",Fd="float",bc="real",bf="varchar",nb="to",Ab="interval",Gd="year",Hd="timezone_hour",bd=
"timezone_minute",cf="month",Ob="day",cd="hour",Id="minute",dd="second",df="case",Pb="end",ed="when",Jd="then",Bb="else",Kd=",",cc="(",fd=")",Ld="`",ef=/^[A-Za-z_\x80-\uFFFF]/,ff=/^[A-Za-z0-9_]/,dc=/^[A-Za-z0-9_.\x80-\uFFFF]/,Cb=/^["]/,Db=/^[^']/,wb=/^[0-9]/,le=/^[eE]/,me=/^[+\-]/,gf=/^[ \t\n\r]/,ne=/^[^`]/,gd=d("!",!1),xb=d("\x3d",!1),fb=d("\x3e\x3d",!1),ob=d("\x3e",!1),hd=d("\x3c\x3d",!1),oe=d("\x3c\x3e",!1),nc=d("\x3c",!1),hf=d("!\x3d",!1),Md=d("+",!1),id=d("-",!1),pe=d("||",!1),qe=d("*",!1),jf=
d("/",!1),re=w([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),kf=w([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Nd=w([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),oc=w(['"'],!1,!1),se=d("@",!1),Qb=d("'",!1),pb=d("N'",!1),pc=d("''",!1),qc=w(["'"],!0,!1),ec=d(".",!1),jd=w([["0","9"]],!1,!1),kd=w(["e","E"],!1,!1),ld=w(["+","-"],!1,!1),rc=d("NULL",!0),te=d("TRUE",!0),qb=d("FALSE",!0),md=d("IN",!0),nd=d("IS",!0),fc=d("LIKE",!0),sc=d("ESCAPE",!0),od=d("NOT",!0),tc=d("AND",!0),lf=
d("OR",!0),uc=d("BETWEEN",!0),pd=d("FROM",!0),gc=d("FOR",!0),Od=d("SUBSTRING",!0),qd=d("EXTRACT",!0),ue=d("TRIM",!0),mf=d("POSITION",!0),nf=d("TIMESTAMP",!0),Pd=d("DATE",!0),Eb=d("TIME",!0),vc=d("LEADING",!0),Rb=d("TRAILING",!0),Qd=d("BOTH",!0),ve=d("CAST",!0),of=d("AS",!0),pf=d("INTEGER",!0),rd=d("SMALLINT",!0),Rd=d("FLOAT",!0),qf=d("REAL",!0),we=d("VARCHAR",!0),Sd=d("TO",!0),xe=d("INTERVAL",!0),hc=d("YEAR",!0),rb=d("TIMEZONE_HOUR",!0),wc=d("TIMEZONE_MINUTE",!0),ub=d("MONTH",!0),xc=d("DAY",!0),Fb=
d("HOUR",!0),yb=d("MINUTE",!0),Gb=d("SECOND",!0),yc=d("CASE",!0),Ja=d("END",!0),Ra=d("WHEN",!0),Ya=d("THEN",!0),eb=d("ELSE",!0),Ad=d(",",!1),Zg=d("(",!1),$g=d(")",!1),ah=w([" ","\t","\n","\r"],!1,!1),cg=d("`",!1),dg=w(["`"],!0,!1),N=0,ya=0,ye=[{line:1,column:1}],Hb=0,rf=[],sa=0;if("startRule"in h){if(!(h.startRule in Vc))throw Error("Can't start parsing from rule \""+h.startRule+'".');vd=Vc[h.startRule]}var Ff=vd();if(Ff!==H&&N===c.length)return Ff;Ff!==H&&N<c.length&&e({type:"end"});throw function(W,
ca,ha){return new b(b.buildMessage(W,ca),W,ca,ha)}(rf,Hb<c.length?c.charAt(Hb):null,Hb<c.length?l(Hb,Hb+1):l(Hb,Hb));}}})})(r);var g=r.exports;class p{static parse(m){return g.parse(m)}}a.WhereGrammar=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/fieldType":function(){define(["exports","../../core/jsonMap"],function(a,q){q=new q.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",
esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});a.kebabDict=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,q,r){const g=new r,p=new r,m=new r,b={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,esriGeometryPolygon:q.convertToPolygon,esriGeometryMultipoint:q.convertToMultipoint},f=(c,h)=>"_geVersion"!==c?h:void 0;a.cleanFromGeometryEngine=function(c){return c&&"_geVersion"in c?JSON.parse(JSON.stringify(c,f)):c};a.getGeometry=function(c,h,n,d,w,
t,l=h,e=n){const u=h&&l,x=n&&e;d=null!=d?"coords"in d?d:d.geometry:null;if(null==d)return null;if(w)return h=q.generalizeOptimizedGeometry(p,d,h,n,c,w,l,e),t&&(h=q.quantizeOptimizedGeometry(m,h,u,x,c,t)),b[c]?.(h,u,x)??null;if(t)return t=q.quantizeOptimizedGeometry(m,d,h,n,c,t,l,e),b[c]?.(t,u,x)??null;q.removeZMValues(g,d,h,n,l,e);return b[c]?.(g,u,x)??null};a.transformCentroid=function(c,h,n,d=c.hasZ,w=c.hasM){if(null==h)return null;const t=c.hasZ&&d,l=c.hasM&&w;return n?(c=q.quantizeOptimizedGeometry(m,
h,c.hasZ,c.hasM,"esriGeometryPoint",n,d,w),q.convertToPoint(c,t,l)):q.convertToPoint(h,t,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(a){a.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,
supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,
supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w){function t(x,y,A,k){const v=k.x-A.x;k=k.y-A.y;y=Math.min(1,Math.max(0,((y.x-A.x)*v+(y.y-A.y)*k)/(v*v+k*k)));x.x=A.x+v*y;x.y=A.y+k*y}function l(x,y){return x?y?4:3:y?3:2}class e{constructor(x,y,A){this.items=x;this.query=y;this.geometryType=A.geometryType;this.hasM=A.hasM;this.hasZ=A.hasZ;this.fieldsIndex=A.fieldsIndex;this.objectIdField=A.objectIdField;this.spatialReference=A.spatialReference;this.featureAdapter=A.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const x=
new f(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return x.countDistinctValues(this.items);const {groupByFieldsForStatistics:y,having:A,outStatistics:k}=this.query;if(!y?.length)return 1;const v=new Map,B=new Map,z=new Set;for(const I of k){var {statisticType:E}=I;E="exceedslimit"!==E?I.onStatisticField:void 0;if(!B.has(E)){var K=[];for(const D of y){const G=this._getAttributeValues(x,D,v);K.push(G)}B.set(E,this._calculateUniqueValues(K,x.returnDistinctValues))}E=
B.get(E);for(const D in E){const {data:G,items:C}=E[D];K=G.join(",");A&&!x.validateItems(C,A)||z.add(K)}}return z.size}async createQueryResponse(){let x;x=this.query.outStatistics?this.query.outStatistics.some(y=>"exceedslimit"===y.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const y=this.query.geometry;b.isValid(this.query.outSR)&&!b.equals(y.spatialReference,
this.query.outSR)?x.queryGeometry=c.cleanFromGeometryEngine({spatialReference:this.query.outSR,...h.project(y,y.spatialReference,this.query.outSR)}):x.queryGeometry=c.cleanFromGeometryEngine({spatialReference:this.query.outSR,...y})}return x}createSnappingResponse(x,y){const A=this.featureAdapter,k=l(this.hasZ,this.hasM),{point:v,mode:B}=x,z="number"===typeof x.distance?x.distance:x.distance.x,E="number"===typeof x.distance?x.distance:x.distance.y,K={candidates:[]},I="esriGeometryPolygon"===this.geometryType;
y=this._getPointCreator(B,this.spatialReference,y);const D=new u(null,0),G=new u(null,0),C={x:0,y:0,z:0};for(const U of this.items){var F=A.getGeometry(U);if(null==F)continue;const {coords:R,lengths:Z}=F;D.coords=R;G.coords=R;if(x.returnEdge){F=0;for(var J=0;J<Z.length;J++){var T=Z[J];for(var S=0;S<T;S++,F+=k){var ba=D;ba.coordsIndex=F;if(S!==T-1){const ea=G;ea.coordsIndex=F+k;const ma=C;t(C,v,ba,ea);var M=(v.x-ma.x)/z;const V=(v.y-ma.y)/E;M=M*M+V*V;1>=M&&K.candidates.push(n.makeEdgeCandidate(A.getObjectId(U),
y(ma),Math.sqrt(M),y(ba),y(ea)))}}}}if("none"!==x.vertexMode)if(F=I?R.length-k:R.length,"all"===x.vertexMode)for(J=0;J<F;J+=k)T=D,T.coordsIndex=J,S=(v.x-T.x)/z,ba=(v.y-T.y)/E,S=S*S+ba*ba,1>=S&&K.candidates.push(n.makeVertexCandidate(A.getObjectId(U),y(T),Math.sqrt(S)));else if("ends"===x.vertexMode){F=[0];I||F.push(R.length-k);for(const ea of F)F=D,F.coordsIndex=ea,J=(v.x-F.x)/z,T=(v.y-F.y)/E,J=J*J+T*T,1>=J&&K.candidates.push(n.makeVertexCandidate(A.getObjectId(U),y(F),Math.sqrt(J)))}}K.candidates.sort((U,
R)=>U.distance-R.distance);return K}_getPointCreator(x,y,A){const k=null==A||b.equals(y,A)?B=>B:B=>h.project(B,y,A),{hasZ:v}=this;return"3d"===x?v?({x:B,y:z,z:E})=>k({x:B,y:z,z:E}):({x:B,y:z})=>k({x:B,y:z,z:0}):({x:B,y:z})=>k({x:B,y:z})}async createSummaryStatisticsResponse(x){const {field:y,valueExpression:A,normalizationField:k,normalizationType:v,normalizationTotal:B,minValue:z,maxValue:E,scale:K,timeZone:I}=x;var D=this.fieldsIndex.get(y);x=d.isDateField(D)||d.isDateOnlyField(D)||d.isTimestampOffsetField(D);
const G=await this._getDataValues({field:y,valueExpression:A,normalizationField:k,normalizationType:v,normalizationTotal:B,scale:K,timeZone:I}),C=w.isNullCountSupported({normalizationType:v,normalizationField:k,minValue:z,maxValue:E}),F={value:.5,fieldType:D?.type};D=d.isStringField(D)?w.calculateStringStatistics({values:G,supportsNullCount:C,percentileParams:F}):w.calculateStatistics({values:G,minValue:z,maxValue:E,useSampleStdDev:!v,supportsNullCount:C,percentileParams:F});return w.processSummaryStatisticsResult(D,
x)}async createUniqueValuesResponse(x){const {field:y,valueExpression:A,domains:k,returnAllCodedValues:v,scale:B,timeZone:z}=x;var E=await this._getDataValues({field:y,field2:x.field2,field3:x.field3,fieldDelimiter:x.fieldDelimiter,valueExpression:A,scale:B,timeZone:z},!1);E=w.calculateUniqueValuesCount(E);return w.createUVResult(E,k,v,x.fieldDelimiter)}async createClassBreaksResponse(x){const {field:y,valueExpression:A,normalizationField:k,normalizationType:v,normalizationTotal:B,classificationMethod:z,
standardDeviationInterval:E,minValue:K,maxValue:I,numClasses:D,scale:G,timeZone:C}=x;x=await this._getDataValues({field:y,valueExpression:A,normalizationField:k,normalizationType:v,normalizationTotal:B,scale:G,timeZone:C});x=w.calculateClassBreaks(x,{field:y,normalizationField:k,normalizationType:v,normalizationTotal:B,classificationMethod:z,standardDeviationInterval:E,minValue:K,maxValue:I,numClasses:D});return w.resolveCBResult(x,z)}async createHistogramResponse(x){const {field:y,valueExpression:A,
normalizationField:k,normalizationType:v,normalizationTotal:B,classificationMethod:z,standardDeviationInterval:E,minValue:K,maxValue:I,numBins:D,scale:G,timeZone:C}=x;x=await this._getDataValues({field:y,valueExpression:A,normalizationField:k,normalizationType:v,normalizationTotal:B,scale:G,timeZone:C});return w.calculateHistogram(x,{field:y,normalizationField:k,normalizationType:v,normalizationTotal:B,classificationMethod:z,standardDeviationInterval:E,minValue:K,maxValue:I,numBins:D})}_sortFeatures(x,
y,A){if(1<x.length&&y?.length)for(const k of y.reverse()){y=k.split(" ");const v=y[0],B=this.fieldsIndex.get(v);y=y[1]?"desc"===y[1].toLowerCase():!1;const z=w.getAttributeComparator(B?.type,y);x.sort((E,K)=>{E=A(E,v,B);K=A(K,v,B);return z(E,K)})}}_createFeatureQueryResponse(x){const y=this.items,{geometryType:A,hasM:k,hasZ:v,objectIdField:B,spatialReference:z}=this,{outFields:E,outSR:K,quantizationParameters:I,resultRecordCount:D,resultOffset:G,returnZ:C,returnM:F}=x,J=null!=D?y.length>(G||0)+D:
!1,T=E&&(E.includes("*")?[...this.fieldsIndex.fields]:E.map(S=>this.fieldsIndex.get(S)));return{exceededTransferLimit:J,features:this._createFeatures(x,y),fields:T,geometryType:A,hasM:k&&F,hasZ:v&&C,objectIdFieldName:B,spatialReference:c.cleanFromGeometryEngine(K||z),transform:I&&m.toQuantizationTransform(I)||null}}_createFeatures(x,y){const A=new f(x,this.featureAdapter,this.fieldsIndex),{hasM:k,hasZ:v}=this,{orderByFields:B,quantizationParameters:z,returnGeometry:E,returnCentroid:K,maxAllowableOffset:I,
resultOffset:D,resultRecordCount:G,returnZ:C=!1,returnM:F=!1}=x,J=v&&C,T=k&&F;x=[];var S=0;const ba=[...y];this._sortFeatures(ba,B,(ea,ma,V)=>A.getFieldValue(ea,ma,V));if(this.geometryType&&(E||K)){var M=m.toQuantizationTransform(z)??void 0;y="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(E&&!K)for(var U of ba){var R=this.featureAdapter.getGeometry(U),Z={attributes:A.getAttributes(U),geometry:c.getGeometry(this.geometryType,this.hasZ,this.hasM,R,I,M,J,T)};
y&&R&&!Z.geometry&&(Z.centroid=c.transformCentroid(this,this.featureAdapter.getCentroid(U,this),M));x[S++]=Z}else if(!E&&K)for(R of ba)x[S++]={attributes:A.getAttributes(R),centroid:c.transformCentroid(this,this.featureAdapter.getCentroid(R,this),M)};else for(Z of ba)x[S++]={attributes:A.getAttributes(Z),centroid:c.transformCentroid(this,this.featureAdapter.getCentroid(Z,this),M),geometry:c.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Z),I,M,J,T)}}else for(M of ba)(U=
A.getAttributes(M))&&(x[S++]={attributes:U});S=D||0;null!=G&&(x=x.slice(S,Math.min(x.length,S+G)));return x}_createExceedsLimitQueryResponse(x){var y=!1;let A=Number.POSITIVE_INFINITY,k=Number.POSITIVE_INFINITY;y=Number.POSITIVE_INFINITY;for(const v of x.outStatistics??[])if("exceedslimit"===v.statisticType){A=null!=v.maxPointCount?v.maxPointCount:Number.POSITIVE_INFINITY;k=null!=v.maxRecordCount?v.maxRecordCount:Number.POSITIVE_INFINITY;y=null!=v.maxVertexCount?v.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)y=this.items.length>A;else if(this.items.length>k)y=!0;else{x=l(this.hasZ,this.hasM);const v=this.featureAdapter;y=this.items.reduce((B,z)=>{z=v.getGeometry(z);return B+(null!=z&&z.coords.length||0)},0)/x>y}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(y)}}]}}async _createStatisticsQueryResponse(x){var y={attributes:{}};
const A=[],k=new Map,v=new Map,B=new Map,z=new Map,E=new f(x,this.featureAdapter,this.fieldsIndex);var K=x.outStatistics;const {groupByFieldsForStatistics:I,having:D,orderByFields:G,resultRecordCount:C}=x;x=I?.length;const F=!!x,J=F?I[0]:null,T=F&&!this.fieldsIndex.get(J);for(const R of K??[]){const {outStatisticFieldName:Z,statisticType:ea}=R;K=R;const ma="exceedslimit"!==ea?R.onStatisticField:void 0,V="percentile_disc"===ea||"percentile_cont"===ea;var S="EnvelopeAggregate"===ea||"CentroidAggregate"===
ea||"ConvexHullAggregate"===ea;const aa=F&&1===x&&(ma===J||T)&&"count"===ea;if(F){if(!B.has(ma)){var ba=[];for(const ja of I){var M=this._getAttributeValues(E,ja,k);ba.push(M)}B.set(ma,this._calculateUniqueValues(ba,S?!1:E.returnDistinctValues))}ba=B.get(ma);if(!ba)continue;M=Object.keys(ba);for(const ja of M){const {count:oa,data:wa,items:ta,itemPositions:va}=ba[ja];M=wa.join(",");if(!D||E.validateItems(ta,D)){const xa=z.get(M)||{attributes:{}};if(S){xa.aggregateGeometries||(xa.aggregateGeometries=
{});const {aggregateGeometries:P,outStatisticFieldName:fa}=await this._getAggregateGeometry(K,ta);xa.aggregateGeometries[fa]=P}else{var U=null;if(aa)U=oa;else{const P=this._getAttributeValues(E,ma,k);U=va.map(fa=>P[fa]);U=V&&"statisticParameters"in K?this._getPercentileValue(K,U):this._getStatisticValue(K,U,null,E.returnDistinctValues)}xa.attributes[Z]=U}let L=0;I.forEach((P,fa)=>xa.attributes[this.fieldsIndex.get(P)?P:`EXPR_${++L}`]=wa[fa]);z.set(M,xa)}}}else if(S){y.aggregateGeometries||(y.aggregateGeometries=
{});const {aggregateGeometries:ja,outStatisticFieldName:oa}=await this._getAggregateGeometry(K,this.items);y.aggregateGeometries[oa]=ja}else S=this._getAttributeValues(E,ma,k),y.attributes[Z]=V&&"statisticParameters"in K?this._getPercentileValue(K,S):this._getStatisticValue(K,S,v,E.returnDistinctValues);K="min"!==ea&&"max"!==ea||!d.isStringField(this.fieldsIndex.get(ma))&&!this._isAnyDateField(ma)?null:this.fieldsIndex.get(ma)?.type;A.push({name:Z,alias:Z,type:K||"esriFieldTypeDouble"})}y=F?Array.from(z.values()):
[y];this._sortFeatures(y,G,(R,Z)=>R.attributes[Z]);C&&(y.length=Math.min(C,y.length));return{fields:A,features:y}}_isAnyDateField(x){x=this.fieldsIndex.get(x);return d.isDateField(x)||d.isDateOnlyField(x)||d.isTimestampOffsetField(x)||d.isTimeOnlyField(x)}async _getAggregateGeometry(x,y){const {convexHull:A,union:k}=await new Promise((C,F)=>a(["../../../geometry/geometryEngineJSON"],C,F)),{statisticType:v,outStatisticFieldName:B}=x,{featureAdapter:z,spatialReference:E,geometryType:K,hasZ:I,hasM:D}=
this;y=y.map(C=>c.getGeometry(K,I,D,z.getGeometry(C)));const G=A(E,y,!0)[0];x={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===v?(y=G?p.getPolygonExtent(G):p.getGeometryExtent(k(E,y)),x.aggregateGeometries={...y,spatialReference:E},x.outStatisticFieldName=B||"extent"):"CentroidAggregate"===v?(y=G?g.polygonCentroid(G):g.extentCentroid(p.getGeometryExtent(k(E,y))),x.aggregateGeometries={x:y[0],y:y[1],spatialReference:E},x.outStatisticFieldName=B||"centroid"):"ConvexHullAggregate"===
v&&(x.aggregateGeometries=G,x.outStatisticFieldName=B||"convexHull");return x}_getStatisticValue(x,y,A,k){const {onStatisticField:v,statisticType:B}=x;x=null;x=A?.has(v)?A.get(v):d.isStringField(this.fieldsIndex.get(v))||this._isAnyDateField(v)?w.calculateStringStatistics({values:y,returnDistinct:k}):w.calculateStatistics({values:k?[...(new Set(y))]:y,minValue:null,maxValue:null,useSampleStdDev:!0});A&&A.set(v,x);return x["var"===B?"variance":B]}_getPercentileValue(x,y){const {onStatisticField:A,
statisticParameters:k,statisticType:v}=x,{value:B,orderBy:z}=k;x=this.fieldsIndex.get(A);return w.calculatePercentile(y,{value:B,orderBy:z,fieldType:x?.type,isDiscrete:"percentile_disc"===v})}_getAttributeValues(x,y,A){if(A.has(y))return A.get(y);const k=this.fieldsIndex.get(y),v=this.items.map(B=>x.getFieldValue(B,y,k));A.set(y,v);return v}_calculateUniqueValues(x,y){const A={},k=this.items,v=k.length;for(let B=0;B<v;B++){const z=k[B],E=[];for(const I of x)E.push(I[B]);const K=E.join(",");null==
A[K]?A[K]={count:1,data:E,items:[z],itemPositions:[B]}:(y||A[K].count++,A[K].items.push(z),A[K].itemPositions.push(B))}return A}async _getDataValues(x,y=!0){const A=new f(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:k,scale:v,timeZone:B}=x;return k?A.getExpressionValues(this.items,k,{viewingMode:"map",scale:v,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},B):A.getDataValues(this.items,r.clone(x),y)}}class u{constructor(x,
y){this.coords=x;this.coordsIndex=y}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}q.QueryEngineResult=e;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,q){function r(C){if("lowerLeft"===C.originPosition&&4===C.scale.length&&4===C.translate.length)return C;const {originPosition:F,scale:J,translate:T}=
C;C=J[1]??1;return{originPosition:"lowerLeft",scale:[J[0]??1,"lowerLeft"===F?C:-C,J[2]??1,J[3]??1],translate:[T[0]??0,T[1]??0,T[2]??0,T[3]??0]}}function g({scale:C,translate:F},J){return Math.round((J-F[0])/C[0])}function p({scale:C,translate:F},J){return Math.round((J-F[1])/C[1])}function m({scale:C,translate:F},J){return Math.round(((J??0)-F[2])/C[2])}function b({scale:C,translate:F},J){return J?Math.round((J-F[3])/C[3]):0}function f(C,F){return C&&F?E:C&&!F?B:!C&&F?z:v}function c({scale:C,translate:F},
J){return J*C[0]+F[0]}function h({scale:C,translate:F},J){return J*C[1]+F[1]}function n({scale:C,translate:F},J){return(J??0)*C[2]+F[2]}function d({scale:C,translate:F},J){return J?J*C[3]+F[3]:0}function w(C,F){return C&&F?G:C&&!F?I:!C&&F?D:K}function t(C,F,J){const T=Array(J.length);for(let S=0;S<J.length;S++)T[S]=F(C,J[S]);return T}function l(C,F,J){let [T,S]=J[0],ba=Math.min(T,F[0]),M=Math.min(S,F[1]),U=Math.max(T,F[2]);F=Math.max(S,F[3]);for(let R=1;R<J.length;R++){const [Z,ea]=J[R];T+=Z;S+=ea;
0>Z&&(ba=Math.min(ba,T));0<Z&&(U=Math.max(U,T));0>ea?M=Math.min(M,S):0<ea&&(F=Math.max(F,S))}C[0]=ba;C[1]=M;C[2]=U;C[3]=F;return C}function e(C,F){if(!F.length)return null;C[0]=C[1]=Number.POSITIVE_INFINITY;C[2]=C[3]=Number.NEGATIVE_INFINITY;for(let J=0;J<F.length;J++)l(C,C,F[J]);return C}function u(C,F,J){C=r(C);F.xmin=g(C,J.xmin);F.ymin=p(C,J.ymin);F.xmax=g(C,J.xmax);F.ymax=p(C,J.ymax);J.hasZ&&(F.zmin=m(C,J.zmin),F.zmax=m(C,J.zmax));J.hasM&&(F.mmin=b(C,J.mmin),F.mmax=b(C,J.mmax));F.hasZ=J.hasZ??
!1;F.hasM=J.hasM??!1;return F}function x(C,F,J){C=r(C);F.points=f(J.hasZ,J.hasM)(C,J.points)??[];F.hasZ=J.hasZ??!1;F.hasM=J.hasM??!1;return F}function y(C,F,J){C=r(C);F.x=g(C,J.x);F.y=p(C,J.y);null!=J.z&&(F.z=m(C,J.z));null!=J.m&&(F.m=b(C,J.m));return F}function A(C,F,J){{C=r(C);var T=J.rings;const S=[],ba=f(J.hasZ,J.hasM);for(let M=0;M<T.length;M++){const U=ba(C,T[M]);U&&3<=U.length&&S.push(U)}C=S.length?S:null}if(!C)return null;F.rings=C;F.hasZ=J.hasZ??!1;F.hasM=J.hasM??!1;return F}function k(C,
F,J){{C=r(C);var T=J.paths;const S=[],ba=f(J.hasZ,J.hasM);for(let M=0;M<T.length;M++){const U=ba(C,T[M]);U&&2<=U.length&&S.push(U)}C=S.length?S:null}if(!C)return null;F.paths=C;F.hasZ=J.hasZ??!1;F.hasM=J.hasM??!1;return F}const v=(C,F)=>{const J=[];if(!F.length)return null;var T=F[0];let S=g(C,T[0]);T=p(C,T[1]);J.push([S,T]);for(let ba=1;ba<F.length;ba++){const [M,U]=F[ba],R=g(C,M),Z=p(C,U);R===S&&Z===T||J.push([R-S,Z-T]);S=R;T=Z}return J},B=(C,F)=>{const J=[];if(!F.length)return null;var T=F[0];
let S=g(C,T[0]),ba=p(C,T[1]);T=m(C,T[2]);J.push([S,ba,T]);for(let M=1;M<F.length;M++){const [U,R,Z]=F[M],ea=g(C,U),ma=p(C,R),V=m(C,Z);ea===S&&ma===ba&&V===T||J.push([ea-S,ma-ba,V]);S=ea;ba=ma;T=V}return J},z=(C,F)=>{const J=[];if(!F.length)return null;var T=F[0];let S=g(C,T[0]),ba=p(C,T[1]);T=b(C,T[2]);J.push([S,ba,T]);for(let M=1;M<F.length;M++){const [U,R,Z]=F[M],ea=g(C,U),ma=p(C,R),V=b(C,Z);ea===S&&ma===ba&&V===T||J.push([ea-S,ma-ba,V]);S=ea;ba=ma;T=V}return J},E=(C,F)=>{const J=[];if(!F.length)return null;
var T=F[0];let S=g(C,T[0]),ba=p(C,T[1]),M=m(C,T[2]);T=b(C,T[3]);J.push([S,ba,M,T]);for(let U=1;U<F.length;U++){const [R,Z,ea,ma]=F[U],V=g(C,R),aa=p(C,Z),ja=m(C,ea),oa=b(C,ma);V===S&&aa===ba&&ja===M&&oa===T||J.push([V-S,aa-ba,ja,oa]);S=V;ba=aa;M=ja;T=oa}return J},K=(C,F)=>{const J=Array(F.length);if(!F.length)return J;var T=F[0];let S=c(C,T[0]);T=h(C,T[1]);J[0]=[S,T];const {scale:ba,originPosition:M}=C;C=ba[0];const U="lowerLeft"===M?ba[1]:-ba[1];for(let R=1;R<F.length;R++){const [Z,ea]=F[R];S+=C*
Z;T+=U*ea;J[R]=[S,T]}return J},I=(C,F)=>{const J=Array(F.length);if(!F.length)return J;var T=F[0];let S=c(C,T[0]),ba=h(C,T[1]);J[0]=[S,ba,n(C,T[2])];const {scale:M,originPosition:U}=C;T=M[0];const R="lowerLeft"===U?M[1]:-M[1];for(let Z=1;Z<F.length;Z++){const [ea,ma,V]=F[Z];S+=T*ea;ba+=R*ma;J[Z]=[S,ba,n(C,V)]}return J},D=(C,F)=>{const J=Array(F.length);if(!F.length)return J;var T=F[0];let S=c(C,T[0]),ba=h(C,T[1]);J[0]=[S,ba,d(C,T[2])];const {scale:M,originPosition:U}=C;T=M[0];const R="lowerLeft"===
U?M[1]:-M[1];for(let Z=1;Z<F.length;Z++){const [ea,ma,V]=F[Z];S+=T*ea;ba+=R*ma;J[Z]=[S,ba,d(C,V)]}return J},G=(C,F)=>{const J=Array(F.length);if(!F.length)return J;var T=F[0];let S=c(C,T[0]),ba=h(C,T[1]);J[0]=[S,ba,n(C,T[2]),d(C,T[3])];const {scale:M,originPosition:U}=C;T=M[0];const R="lowerLeft"===U?M[1]:-M[1];for(let Z=1;Z<F.length;Z++){const [ea,ma,V,aa]=F[Z];S+=T*ea;ba+=R*ma;J[Z]=[S,ba,n(C,V),d(C,aa)]}return J};a.getQuantizedBoundsCoordsArray=l;a.getQuantizedBoundsCoordsArrayArray=e;a.getQuantizedBoundsPaths=
function(C){return e([0,0,0,0],C)};a.getQuantizedBoundsPoints=function(C){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return l(F,F,C)};a.getQuantizedBoundsRings=function(C){return e([0,0,0,0],C)};a.normalizeTransform=r;a.quantizeBounds=function(C,F,J){C=r(C);F[0]=g(C,J[0]);F[3]=p(C,J[1]);F[2]=g(C,J[2]);F[1]=p(C,J[3]);return F};a.quantizeCoordsArrayXY=v;a.quantizeCoordsArrayXYM=z;a.quantizeCoordsArrayXYZ=B;a.quantizeCoordsArrayXYZM=
E;a.quantizeExtent=u;a.quantizeGeometry=function(C,F){return C&&F?q.isPoint(F)?y(C,{},F):q.isPolyline(F)?k(C,{},F):q.isPolygon(F)?A(C,{},F):q.isMultipoint(F)?x(C,{},F):q.isExtent(F)?u(C,{},F):null:null};a.quantizeM=b;a.quantizeMultipoint=x;a.quantizePoint=y;a.quantizePolygon=A;a.quantizePolyline=k;a.quantizeX=g;a.quantizeY=p;a.quantizeZ=m;a.toQuantizationTransform=function(C){return C?{originPosition:"upper-left"===C.originPosition?"upperLeft":"lower-left"===C.originPosition?"lowerLeft":C.originPosition,
scale:C.tolerance?[C.tolerance,C.tolerance,1,1]:[1,1,1,1],translate:null!=C.extent?[C.extent.xmin,C.extent.ymax,C.extent.zmin??0,C.extent.mmin??0]:[0,0,0,0]}:null};a.unquantizeBounds=function(C,F,J){C=r(C);return J?(F[0]=c(C,J[0]),F[1]=h(C,J[3]),F[2]=c(C,J[2]),F[3]=h(C,J[1]),F):[c(C,F[0]),h(C,F[3]),c(C,F[2]),h(C,F[1])]};a.unquantizeCoordsArrayArray=t;a.unquantizeCoordsArrayXY=K;a.unquantizeCoordsArrayXYM=D;a.unquantizeCoordsArrayXYZ=I;a.unquantizeCoordsArrayXYZM=G;a.unquantizeExtent=function(C,F,
J,T=J.hasZ??!1,S=J.hasM??!1){C=r(C);F.xmin=c(C,J.xmin);F.xmax=c(C,J.xmax);F.ymin=h(C,J.ymin);F.ymax=h(C,J.ymax);T&&(F.zmin=n(C,J.zmin),F.zmax=n(C,J.zmax));S&&(F.mmin=d(C,J.mmin),F.mmax=d(C,J.mmax));F.hasZ=T;F.hasM=S;return F};a.unquantizeM=d;a.unquantizeMultipoint=function(C,F,J,T=J?.hasZ??!1,S=J?.hasM??!1){null!=J&&(C=r(C),F.points=w(T,S)(C,J.points),F.hasZ=T,F.hasM=S);return F};a.unquantizePoint=function(C,F,J,T=null!=J?.z,S=null!=J?.m){if(null==J)return F;C=r(C);F.x=c(C,J.x);F.y=h(C,J.y);T&&(F.z=
n(C,J.z));S&&(F.m=d(C,J.m));return F};a.unquantizePolygon=function(C,F,J,T=J?.hasZ??!1,S=J?.hasM??!1){null!=J&&(C=r(C),F.rings=t(C,w(T,S),J.rings),F.hasZ=T,F.hasM=S);return F};a.unquantizePolyline=function(C,F,J,T=J?.hasZ??!1,S=J?.hasM??!1){null!=J&&(C=r(C),F.paths=t(C,w(T,S),J.paths),F.hasZ=T,F.hasM=S);return F};a.unquantizeX=c;a.unquantizeY=h;a.unquantizeZ=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,q,r,g,p,m){class b{constructor(f,c,h){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=f.returnDistinctValues??!1;this.fieldsIndex=h;this.featureAdapter=c;if((c=f.outFields)&&!c.includes("*")){this.outFields=c;f=0;for(const d of c){var n=a.getExpressionFromFieldName(d);n=(c=this.fieldsIndex.get(n))?null:a.getWhereClause(n,h);c=c?c.name:a.getAliasFromFieldName(d)||`FIELD_EXP_${f++}`;this._fieldDataCache.set(d,{alias:c,clause:n})}}}countDistinctValues(f){if(!this.returnDistinctValues)return f.length;
f.forEach(c=>this.getAttributes(c));return this._returnDistinctMap.size}getAttributes(f){f=this._processAttributesForOutFields(f);return this._processAttributesForDistinctValues(f)}getFieldValue(f,c,h){const n=h?h.name:c;let d=null;this._fieldDataCache.has(n)?d=this._fieldDataCache.get(n)?.clause:h||(d=a.getWhereClause(c,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:d}));return h?this.featureAdapter.getAttribute(f,n):d?.calculateValue(f,this.featureAdapter)}getDataValues(f,c,h=!0){const n=
c.normalizationType,d=c.normalizationTotal,w=this.fieldsIndex.get(c.field),t=r.isDateOnlyField(w)||r.isTimestampOffsetField(w),l=r.isTimeOnlyField(w);return f.map(e=>{let u=c.field&&this.getFieldValue(e,c.field,this.fieldsIndex.get(c.field));c.field2?(u=`${p.processNullValue(u)}${c.fieldDelimiter}${p.processNullValue(this.getFieldValue(e,c.field2,this.fieldsIndex.get(c.field2)))}`,c.field3&&(u=`${u}${c.fieldDelimiter}${p.processNullValue(this.getFieldValue(e,c.field3,this.fieldsIndex.get(c.field3)))}`)):
"string"===typeof u&&h&&(t?u=u?(new Date(u)).getTime():null:l&&(u=u?g.timeOnlyToMilliseconds(u):null));n&&Number.isFinite(u)&&(e="field"===n&&c.normalizationField?this.getFieldValue(e,c.normalizationField,this.fieldsIndex.get(c.normalizationField)):null,u=p.getNormalizedValue(u,n,e,d));return u})}async getExpressionValues(f,c,h,n,d){const {arcadeUtils:w}=await m.loadArcade(),t=w.hasGeometryOperations(c);t&&await w.enableGeometryOperations();const l=w.createFunction(c),e=w.getViewInfo(h),u={fields:this.fieldsIndex.fields};
return f.map(x=>{x={attributes:this.featureAdapter.getAttributes(x),layer:u,geometry:t?{...q.getGeometry(n.geometryType,n.hasZ,n.hasM,this.featureAdapter.getGeometry(x)),spatialReference:h?.spatialReference}:null};x=w.createExecContext(x,e,d);return w.executeFunction(l,x)})}validateItem(f,c){this._fieldDataCache.has(c)||this._fieldDataCache.set(c,{alias:c,clause:a.getWhereClause(c,this.fieldsIndex)});return this._fieldDataCache.get(c)?.clause?.testFeature(f,this.featureAdapter)??!1}validateItems(f,
c){this._fieldDataCache.has(c)||this._fieldDataCache.set(c,{alias:c,clause:a.getWhereClause(c,this.fieldsIndex)});return this._fieldDataCache.get(c)?.clause?.testSet(f,this.featureAdapter)??!1}_processAttributesForOutFields(f){const c=this.outFields;if(!c?.length)return this.featureAdapter.getAttributes(f);const h={};for(const n of c){const {alias:d,clause:w}=this._fieldDataCache.get(n);h[d]=w?w.calculateValue(f,this.featureAdapter):this.featureAdapter.getAttribute(f,d)}return h}_processAttributesForDistinctValues(f){if(null==
f||!this.returnDistinctValues)return f;var c=this.outFields,h=[];if(c)for(const d of c){var {alias:n}=this._fieldDataCache.get(d);h.push(f[n])}else for(n in f)h.push(f[n]);c=`${(c||["*"]).join(",")}=${h.join(",")}`;h=this._returnDistinctMap.get(c)||0;this._returnDistinctMap.set(c,++h);return 1<h?null:f}}return b})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t){function l(k){k=A.exec(k);if(!k)return null;const {hh:v,mm:B,ss:z,ms:E}=k.groups;return Number(v)*p.millisecondsPerTimeUnit.hours+Number(B)*p.millisecondsPerTimeUnit.minutes+Number(z)*p.millisecondsPerTimeUnit.seconds+Number(E||0)}function e(k,v){k=null!=k?k:"";null!=v&&v&&(k=k?"("+k+") AND ("+v+")":v);return k}function u(k){const v=k.layer;return k.fields.filter(B=>!v.getField(B))}function x(k){const v=k.layer;return k.fields.filter(B=>{B=v.getFieldUsageInfo(B);
return!B||!B.supportsStatistics})}let y=null;const A=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(k,v=18,B,z,E){const K=new Float64Array(z*E);v=Math.round(g.pt2px(v));let I=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;B=h.createValueFunction(B);for(const {geometry:F,attributes:J}of k){const {x:T,y:S}=F;k=Math.max(0,T-v);var G=Math.max(0,S-v);const ba=Math.min(E,S+v),M=Math.min(z,T+v),U=+B(J);for(;G<ba;G++)for(let R=
k;R<M;R++){var C=G*z+R;const Z=h.evaluateDensityKernel(R-T,G-S,v)*U;C=K[C]+=Z;I=Math.min(I,C);D=Math.max(D,C)}}return{min:I,max:D}};a.getDataValues=async function(k,v,B=!0){if(!v)return[];const {field:z,field2:E,field3:K,fieldDelimiter:I,fieldInfos:D,timeZone:G}=k;var C=z&&D?.find(ma=>ma.name.toLowerCase()===z.toLowerCase());const F=C?c.isTimeOnlyField(C):!1,J=C?n.isAnyDateField(C):!1,T=k.valueExpression,S=k.normalizationType,ba=k.normalizationField,M=k.normalizationTotal,U=[];C=k.viewInfoParams;
let R=null,Z=null;if(T){if(!y){const {arcadeUtils:ma}=await w.loadArcade();y=ma}y.hasGeometryOperations(T)&&await y.enableGeometryOperations();R=y.createFunction(T);Z=C?y.getViewInfo({viewingMode:C.viewingMode,scale:C.scale,spatialReference:new m(C.spatialReference)}):null}k=k.fieldInfos;const ea=v[0]&&"declaredClass"in v[0]&&"esri.Graphic"===v[0].declaredClass||!k?null:{fields:k};v.forEach(ma=>{var V=ma.attributes;if(T){var aa=y.createExecContext(ea?{...ma,layer:ea}:ma,Z,G);aa=y.executeFunction(R,
aa)}else V&&(aa=V[z],E?(aa=`${d.processNullValue(aa)}${I}${d.processNullValue(V[E])}`,K&&(aa=`${aa}${I}${d.processNullValue(V[K])}`)):"string"===typeof aa&&B&&(J?aa=aa?(new Date(aa)).getTime():null:F&&(aa=aa?l(aa):null)));S&&"number"===typeof aa&&isFinite(aa)&&(V=V&&parseFloat(V[ba]),aa=d.getNormalizedValue(aa,S,V,M));U.push(aa)});return U};a.getRangeExpr=function(k,v,B){v=null!=v?k+" \x3e\x3d "+v:"";k=null!=B?k+" \x3c\x3d "+B:"";B="";return(B=v&&k?e(v,k):v||k)?"("+B+")":""};a.getSQLFilterForNormalization=
function(k){const v=k.field,B=k.normalizationType;k=k.normalizationField;let z;if("field"===B)z="(NOT "+k+" \x3d 0)";else if("log"===B||"natural-log"===B||"square-root"===B)z=`(${v} > 0)`;return z};a.getSumOfAttributesExpr=function(k,v,B){const z=[],E=[],K=[],I=[],D=[];k.forEach((F,J)=>{const T=F.field?"field":"expression",S=F.field||F.valueExpression;F.field?(D.push(S),E.push(`var ${T}${J} = Number($feature["${S}"]);`)):(z.push(`function getValueForExpr${J}() {\n  ${S} \n}`),E.push(`var ${T}${J} = Number(getValueForExpr${J}());`));
B||K.push(`${T}${J} = IIf(${T}${J} < 0, 0, ${T}${J});`);I.push(`${T}${J}`)});k="return sum;";const G=z.length?null:D.reduce((F,J)=>`${F} + ${J}`);let C=null;v||B?v?B||(k="return IIf(sum \x3e\x3d 0, sum, null);",G&&(C=`(( ${G} ) >= 0)`)):(k="return IIf(sum !\x3d 0, sum, null);",G&&(C=`(( ${G} ) <> 0)`)):(k="return IIf(sum \x3e 0, sum, null);",G&&(C=`(( ${G} ) > 0)`));return{valueExpression:[z.length?z.join("\n"):"",E.join("\n"),K.join("\n"),`var sum = ${I.join(" + ")};`,k].filter(Boolean).join("\n\n"),
sqlExpression:G,sqlWhere:C}};a.mergeWhereClauses=e;a.quantizeFeatures=function(k,v,B,z){const E=f.isWrappable(B)?f.getInfo(B):null,K=E?Math.round((E.valid[1]-E.valid[0])/v.scale[0]):null;return k.map(I=>{const D=new t(I.geometry);b.quantizePoint(v,D,D);if(E){var G=K??0,C=z[0];0>D.x?D.x+=G:D.x>C&&(D.x-=G)}I.geometry=D;return I})};a.timeOnlyToMilliseconds=l;a.verifyBasicFieldValidity=function(k,v,B){const z=u({layer:k,fields:v});if(z.length)return new r(B,"Unknown fields: "+z.join(", ")+". You can only use fields defined in the layer schema");
k=x({layer:k,fields:v});if(k.length)return new r(B,"Unsupported fields: "+k.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(k,v,B,z){let E;v?v.name!==k.objectIdField&&z.includes(v.type)||(E=new r(B,"'field' should be one of these types: "+z.join(","))):E=new r(B,"'field' is not defined in the layer schema");return E};a.verifyFilterValidty=function(k,v){if(k&&"intersects"!==k.spatialRelationship)return new r(v,
"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=function(k,v,B){let z;v?v.name!==k.objectIdField&&c.isNumericField(v)||(z=new r(B,"'field' should be one of these numeric types: "+c.numericTypes.join(","))):z=new r(B,"'field' is not defined in the layer schema");return z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/timeUtils":function(){define(["exports","../intl/date","../time/timeZoneUtils","../chunks/datetime"],function(a,
q,r,g){function p(f,c,h){return 0===f?0:f*b[c]/b[h]}function m(f){switch(f){case "milliseconds":return"millisecond";case "seconds":return"second";case "minutes":return"minute";case "hours":return"hour";case "days":return"day";case "weeks":return"week";case "months":return"month";case "years":return"year"}}const b={milliseconds:1,seconds:1E3,minutes:6E4,hours:36E5,days:864E5,weeks:6048E5,months:26784E5,years:31536E6,decades:31536E7,centuries:31536E8};a.convertTime=p;a.isValidDate=function(f){return f instanceof
Date&&!isNaN(f.getTime())};a.makeUTCTime=function(f,c,h="milliseconds"){c=new Date(p(c,h,"milliseconds"));c.setUTCFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate());return c};a.mergeTimeExtents=function(f,c){return f&&c?f.intersection(c):f||c};a.millisecondsPerTimeUnit=b;a.offsetDate=function(f,c,h,n=r.system){n=new g.IANAZone(q.resolveTimeZone(n));f=g.DateTime.fromJSDate(f,{zone:n});n="decades"===h||"centuries"===h?"year":m(h);"decades"===h&&(c*=10);"centuries"===h&&(c*=100);return f.plus({[n]:c}).toJSDate()};
a.offsetDateUTC=function(f,c,h="milliseconds"){f=f.getTime();c=p(c,h,"milliseconds");return new Date(f+c)};a.resetUTCDate=function(f,c){f=new Date(f.getTime());f.setUTCFullYear(c.getFullYear(),c.getMonth(),c.getDate());return f};a.timeSinceUTCMidnight=function(f,c="milliseconds"){const h=p(f.getUTCHours(),"hours","milliseconds"),n=p(f.getUTCMinutes(),"minutes","milliseconds"),d=p(f.getUTCSeconds(),"seconds","milliseconds");f=f.getUTCMilliseconds();return p(h+n+d+f,"milliseconds",c)};a.truncateDate=
function(f,c,h=r.system){h=new g.IANAZone(q.resolveTimeZone(h));f=g.DateTime.fromJSDate(f,{zone:h});if("decades"===c||"centuries"===c)return f=f.startOf("year"),{year:h}=f,f.set({year:h-h%("decades"===c?10:100)}).toJSDate();c=m(c);return f.startOf(c).toJSDate()};a.truncateLocalTime=function(f){const c=new Date(0);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);c.setFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate());return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,q,r,g,p){function m(b,f,c,h){let {color:n,ratio:d}=f,{color:w,ratio:t}=c;t===d&&(1===t?d-=1E-6:t+=1E-6);f=q.clamp((h-d)/(t-d),0,1);g.lerp(b,n.toArray(),w.toArray(),f)}a.createValueFunction=function(b){return"function"===typeof b?b:b?f=>+f[b]:()=>1};a.evaluateDensityKernel=function(b,f,c){b=Math.sqrt(b**2+
f**2)/c;return 1<b?0:3/(Math.PI*c**2)*(1-b**2)**2};a.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(b){return r.px2pt(2.4*b)};a.generateGradient=function(b){const f=new Uint8ClampedArray(2048);b=b.filter(({ratio:w})=>0<=w&&1>=w).sort((w,t)=>w.ratio-t.ratio).map(({color:w,ratio:t})=>({color:w,ratio:Math.max(t,.001)}));if(1>b.length)return f;let c=b[0],h=b[0],n=1;const d=p.create();for(let w=0;512>w;w++){const t=(w+.5)/512;for(;t>h.ratio&&n<b.length;)c=h,h=b[n++];m(d,c,h,t);f.set(d,4*w)}return f};
a.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(b){return r.pt2px(b)/2.4};a.magicKernelDensityRadiusInflationFactor=2.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(a,q,r,g,p,m){function b(t){return String(t).padStart(2,"0")}function f(t,l,e){if("date"===l||"number"===
l){"number"===l&&(t=new Date(t));l=e?t.getFullYear():t.getUTCFullYear();const u=b((e?t.getMonth():t.getUTCMonth())+1),x=b(e?t.getDate():t.getUTCDate()),y=b(e?t.getHours():t.getUTCHours()),A=b(e?t.getMinutes():t.getUTCMinutes());t=b(e?t.getSeconds():t.getUTCSeconds());t=`TIMESTAMP'${l}-${u}-${x} ${y}:${A}:${t}'`}return t}function c(t,l){if(l instanceof Date)return"date";if("number"===typeof l)return"number";if("string"===typeof l&&(t=t.getField(l),"\x3cnow\x3e"!==l.toLowerCase()&&r.isDateField(t)))return"field"}
const h={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},n={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},d=new Set(["integer","small-integer"]);let w=null;a.castIntegerFieldToFloat=function(t){return`cast(${t} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=h;a.fieldDelimiter=",";a.formatAnyDate=function(t,l){const {format:e,timeZoneOptions:u,fieldType:x}=l??{};let y;u&&({timeZone:A,timeZoneName:y}=m.getTimeZoneFormattingOptions(u.layerTimeZone,u.datesInUnknownTimezone,u.viewTimeZone,q.convertDateFormatToIntlOptions(e||"short-date-short-time"),x));if("string"===typeof t&&isNaN(Date.parse("time-only"===x?`1970-01-01T${t}Z`:t)))return t;switch(x){case "date-only":var A=q.convertDateFormatToIntlOptions(e||
"short-date");return"string"===typeof t?q.formatDateOnly(t,{...A}):q.formatDate(t,{...A,timeZone:m.utc});case "time-only":return A=q.convertDateFormatToIntlOptions(e||"short-time"),"string"===typeof t?q.formatTimeOnly(t,A):q.formatDate(t,{...A,timeZone:m.utc});case "timestamp-offset":if(!A&&"string"===typeof t&&(new Date(t)).toISOString()!==t)return t;A=(l=e||u?q.convertDateFormatToIntlOptions(e||"short-date-short-time"):void 0)?{...l,timeZone:A,timeZoneName:y}:void 0;return"string"===typeof t?q.formatTimestamp(t,
A):q.formatDate(t,A);default:return l=e||u?q.convertDateFormatToIntlOptions(e||"short-date-short-time"):void 0,q.formatDate("string"===typeof t?new Date(t):t,l?{...l,timeZone:A,timeZoneName:y}:void 0)}};a.getBasemapGroup=function(t,l=h){for(const e in l)if(l[e].includes(t))return e};a.getBasemapId=function(t,l,e=!0){let u=null;t&&("string"===typeof t?l.includes(t)&&(u=t):u=p.getWellKnownBasemapId(t));return e?u||"gray":u};a.getDateDiffSQL=function(t,l,e,u){const {hasQueryEngine:x}=t;e=f(e,c(t,e),
x);t=f(l,c(t,l),x);t=`(${e} - ${t})`;u=n[u];l="/";1>u&&(u=1/u,l="*");return{sqlExpression:1===u?t:`(${t} ${l} ${u})`,sqlWhere:null}};a.getDateType=c;a.getFieldsList=async function(t){const {field:l,field2:e,field3:u,normalizationField:x,valueExpression:y}=t;t=[];y&&(w||({arcadeUtils:t}=await g.loadArcade(),w=t),t=w.extractFieldNames(y));l&&t.push(l);e&&t.push(e);u&&t.push(u);x&&t.push(x);return t};a.getNormalizationType=function(t){let l=t.normalizationType;l||(t.normalizationField?l="field":null!=
t.normalizationTotal&&(l="percent-of-total"));return l??void 0};a.isAnyDateField=function(t){return r.isDateField(t)||r.isDateOnlyField(t)||r.isTimestampOffsetField(t)};a.isIntegerField=function(t,l){t=l&&t.getField(l);return!!t&&d.has(t.type)};a.unitValueInDays=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define("exports ../Basemap ../config ../core/Collection ../core/Logger ../core/maybe ../core/urlUtils ../core/accessorSupport/ensureType ../layers/effects/utils ./basemapDefinitions".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(G,C){let F;if("string"===typeof G){const J=G in h.esriBasemapDefinitions,T=!J&&G.includes("/");if(!J&&!T)return C=Object.entries(h.esriBasemapDefinitions).filter(([,S])=>r.apiKey&&!S.classic||!r.apiKey&&(S.classic||S.is3d)).map(([S])=>`"${S}"`).sort().join(", "),p.getLogger("esri.support.basemapUtils").warn(`Unable to find basemap definition for: ${G}. Try one of these: ${C}`),null;C&&(F=C[G]);F||(F=J?q.fromId(G):new q({style:{id:G}}),C&&(C[G]=F))}else F=f.ensureType(q,
G);F?.destroyed&&(p.getLogger("esri.support.basemapUtils").warn("The provided basemap is already destroyed",{basemap:F}),F=null);return F}function d(G){if(I)return I(G);let C=null;G=e(G);const F=!G?.baseLayers.length;for(const T in h.esriBasemapDefinitions){var J=A(h.esriBasemapDefinitions[T]);J=v(G,J,{mustMatchReferences:F});if("equal"===J){C=T;break}"base-layers-equal"===J&&(C=T)}return C}function w(G,C){const F=new g;G.forEach(J=>{const T=C.find(S=>"scene"!==S.type&&z(x(J),x(S)))||J;F.includes(T)?
F.push(J):F.push(T)});return F}function t(G){if(l(G.url))return!0;if("vector-tile"===G.type)for(const C in G.sourceNameToSource)if(l(G.sourceNameToSource[C]?.sourceUrl))return!0;return!1}function l(G){if(!G)return!1;G=new b.Url(b.makeAbsolute(G));return!!G.authority&&D.test(G.authority)}function e(G){return G?!G.loaded&&G.resourceInfo?A(G.resourceInfo.data):{baseLayers:u(G.baseLayers),referenceLayers:u(G.referenceLayers)}:null}function u(G){return(g.isCollection(G)?G.toArray():G).map(x)}function x(G){return{type:G.type,
effect:"effect"in G?G.effect:void 0,url:E("urlTemplate"in G&&G.urlTemplate||G.url||"styleUrl"in G&&G.styleUrl||""),minScale:"minScale"in G&&null!=G.minScale?G.minScale:0,maxScale:"maxScale"in G&&null!=G.maxScale?G.maxScale:0,opacity:null!=G.opacity?G.opacity:1,visible:null!=G.visible?!!G.visible:!0,sublayers:"map-image"!==G.type&&"wms"!==G.type||null==G.sublayers?void 0:G.sublayers?.map(C=>({id:C.id,visible:C.visible})),activeLayerId:"wmts"===G.type?G.activeLayer?.id:void 0}}function y(G){return G.isReference||
"ArcGISSceneServiceLayer"===G.layerType}function A(G){return G?{baseLayers:k((G.baseMapLayers??[]).filter(C=>!y(C))),referenceLayers:k((G.baseMapLayers??[]).filter(C=>y(C)))}:null}function k(G){return G.map(C=>{let F;switch(C.layerType){case "VectorTileLayer":F="vector-tile";break;case "ArcGISTiledMapServiceLayer":F="tile";break;case "ArcGISSceneServiceLayer":F="scene";break;default:F="unknown"}return{type:F,effect:C.effect,url:E(C.templateUrl||C.urlTemplate||C.styleUrl||C.url),minScale:C.minScale??
0,maxScale:C.maxScale??0,opacity:C.opacity??1,visible:null!=C.visibility?!!C.visibility:!0,sublayers:void 0,activeLayerId:void 0}})}function v(G,C,F){return null!=G!==(null!=C)?"not-equal":G&&C?B(G.baseLayers,C.baseLayers)?B(G.referenceLayers,C.referenceLayers)?"equal":F.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function B(G,C){if(G.length!==C.length)return!1;for(let F=0;F<G.length;F++)if(!z(G[F],C[F]))return!1;return!0}function z(G,C){if(G.type!==C.type||G.url!==C.url||
G.minScale!==C.minScale||G.maxScale!==C.maxScale||G.visible!==C.visible||G.opacity!==C.opacity||!c.effectEquals(G.effect,C.effect))return!1;if(null!=G.activeLayerId||null!=C.activeLayerId)return G.activeLayerId===C.activeLayerId;if(null!=G.sublayers||null!=C.sublayers){if(null==G.sublayers||null==C.sublayers||G.sublayers.length!==C.sublayers.length)return!1;for(let F=0;F<G.sublayers.length;F++){const J=G.sublayers.at(F),T=C.sublayers.at(F);if(J?.id!==T?.id||J?.visible!==T?.visible)return!1}}return!0}
function E(G){return G?b.normalize(G).replace(/^\s*https?:/i,"").toLowerCase():""}function K(G){return"portalItem"in G?G.portalItem?.thumbnailUrl:void 0}let I;const D=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;a.clonePreservingTiledLayers=function(G,C=null){G=n(G);if(!G)return null;G=G.clone();C&&(G.baseLayers=w(G.baseLayers,C.baseLayers),G.referenceLayers=w(G.referenceLayers,C.referenceLayers));return G};a.contentEquals=function(G,C){if(G===C||null!=G?.portalItem?.id&&G.portalItem.id===C?.portalItem?.id)return!0;
G=e(G);C=e(C);return"equal"===v(G,C,{mustMatchReferences:!0})};a.createCache=function(){return{}};a.destroyCache=function(G){for(const C in G)m.destroyMaybe(G[C]),delete G[C]};a.ensureType=n;a.findSpatialReference=function(G,C){if(null==C||null==G)return{spatialReference:null,updating:!1};if("not-loaded"===C.loadStatus)return C.load(),{spatialReference:null,updating:!0};if(C.spatialReference)return{spatialReference:C.spatialReference,updating:!1};if(0===C.baseLayers.length)return{spatialReference:null,
updating:!1};C=C.baseLayers.at(0);switch(C.loadStatus){case "not-loaded":C.load();case "loading":return{spatialReference:null,updating:!0};case "failed":return{spatialReference:null,updating:!1}}C=(("supportedSpatialReferences"in C?C.supportedSpatialReferences:null)||["tileInfo"in C?C.tileInfo?.spatialReference:C.spatialReference]).filter(Boolean);const F=G.spatialReference;return F?{spatialReference:C.find(J=>F.equals(J))??C[0]??null,updating:!1}:{spatialReference:C[0],updating:!1}};a.getBasemapThumbnailUrl=
function(G){if(!G)return null;var {thumbnailUrl:C}=G;return C?C:(C=d(G))?h.esriBasemapDefinitions[C].thumbnailUrl:m.mappedFind(G.baseLayers,K)};a.getWellKnownBasemapId=d;a.hasDeveloperBasemapLayer=function(G){return!!G?.baseLayers.concat(G.referenceLayers).some(t)};a.isBasemap3D=function(G){return"Web Scene"===G.portalItem?.type||G.referenceLayers.some(C=>"scene"===C.type)};a.isBasemapInBeta=function(G){return!!G?.portalItem?.tags?.some(C=>"beta"===C.toLowerCase())};a.isBasemapLayer=function(G,C){return G.basemap?.referenceLayers?.some(F=>
F.uid===C)||G.basemap?.baseLayers?.some(F=>F.uid===C)};a.isDeveloperBasemapLayer=t;a.overrideGetWellKnownBasemapId=function(G){I=G};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/Basemap":function(){define("require ./chunks/tslib.es6 ./request ./core/Collection ./core/collectionUtils ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/has ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./support/BasemapStyle ./webdoc/support/writeUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A,k,v,B){var z;let E=0;m=z=class extends m.JSONSupportMixin(f){constructor(D){super(D);this.thumbnailUrl=this.style=this.spatialReference=this.portalItem=this.id=null;this.title="Basemap";this.id=Date.now().toString(16)+"-basemap-"+E++;this.baseLayers=new g;this.referenceLayers=new g;const G=C=>{C.parent&&C.parent!==this&&"remove"in C.parent&&C.parent.remove(C);C.parent=this;"elevation"===C.type&&h.getLogger(this).error(`Layer '${C.title}, id:${C.id}' of type '${C.type}' is not supported as a basemap layer and will therefore be ignored.`)};
this.addHandles([this.baseLayers.on("after-add",C=>G(C.item)),this.referenceLayers.on("after-add",C=>G(C.item)),this.baseLayers.on("after-remove",C=>{C.item.parent=null}),this.referenceLayers.on("after-remove",C=>{C.item.parent=null})])}initialize(){this.when().catch(D=>{h.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,D)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var D=this.baseLayers.toArray();for(const G of D)G.destroy();
D=this.referenceLayers.toArray();for(const G of D)G.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem=n.destroyMaybe(this.portalItem)}normalizeCtorArgs(D){D&&"resourceInfo"in D&&(this._set("resourceInfo",D.resourceInfo),D={...D},delete D.resourceInfo);return D}set baseLayers(D){this._set("baseLayers",p.referenceSetter(D,this._get("baseLayers")))}_writeBaseLayers(D,G,C){const F=[];D&&(C={...C,layerContainerType:"basemap"},this.baseLayers.forEach(J=>{J=B.getLayerJSON(J,
C.webmap?C.webmap.getLayerJSONFromResourceInfo(J):null,C);null!=J&&F.push(J)}),this.referenceLayers.forEach(J=>{const T=B.getLayerJSON(J,C.webmap?C.webmap.getLayerJSONFromResourceInfo(J):null,C);null!=T&&("scene"!==J.type&&(T.isReference=!0),F.push(T))}));G.baseMapLayers=F}set referenceLayers(D){this._set("referenceLayers",p.referenceSetter(D,this._get("referenceLayers")))}writeTitle(D,G){G.title=D||"Basemap"}load(D){this.addResolvingPromise(this._loadFromSource(D));return Promise.resolve(this)}loadAll(){return c.loadAll(this,
D=>{D(this.baseLayers,this.referenceLayers)})}clone(){const D={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(G=>b.isClonable(G)?G.clone():G),referenceLayers:this.referenceLayers.map(G=>b.isClonable(G)?G.clone():G)};this.loaded&&(D.loadStatus="loaded");return(new z({resourceInfo:this.resourceInfo})).set(D)}read(D,G){this.resourceInfo||this._set("resourceInfo",{data:D,context:G});super.read(D,G)}write(D,G){D=D||{};G?.origin||(G={origin:"web-map",...G});super.write(D,
G);!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(D.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(C=>{C=b.clone(C);C.url&&w.isProtocolRelative(C.url)&&(C.url=`https:${C.url}`);C.templateUrl&&w.isProtocolRelative(C.templateUrl)&&(C.templateUrl=`https:${C.templateUrl}`);return C}));return D}async _loadFromSource(D){const {resourceInfo:G,portalItem:C,style:F}=this;d.throwIfAborted(D);const J=[];G?(J.push(this._loadLayersFromJSON(G.data,G.context?G.context.url:null,D)),G.data.id&&!G.data.title&&
J.push(k.getBasemapTitle(G.data.id).then(T=>{T&&this.read({title:T},G.context)}))):C?J.push(this._loadFromItem(C,D)):F&&J.push(this._loadFromStylesService(F,D));await Promise.all(J)}async _loadLayersFromJSON(D,G,C){const F=this.resourceInfo?.context,J=this.portalItem?.portal||F?.portal||null,T=I[F?.origin||""]??"web-map",{populateOperationalLayers:S}=await new Promise((M,U)=>a(["./layers/support/layersCreator"],M,U)),ba=[];d.throwIfAborted(C);if(D.baseMapLayers&&Array.isArray(D.baseMapLayers)){G=
{context:{...F,origin:T,url:G,portal:J,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const M=U=>"web-scene"===T&&"ArcGISSceneServiceLayer"===U.layerType||U.isReference;C=S(this.baseLayers,D.baseMapLayers.filter(U=>!M(U)),G);ba.push(C);D=S(this.referenceLayers,D.baseMapLayers.filter(M),G);ba.push(D)}await Promise.allSettled(ba)}async _loadFromItem(D,G){const C=await (await D.load(G)).fetchData("json",G),F=w.urlToObject(D.itemUrl??"");this._set("resourceInfo",{data:C.baseMap??{},
context:{origin:K[D.type||""]??"web-map",portal:D.portal||y.getDefault(),url:F}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:C.spatialReference},this.resourceInfo.context);this.read({title:D.title,thumbnailUrl:D.thumbnailUrl},{origin:"portal-item",portal:D.portal||y.getDefault(),url:F});return this._loadLayersFromJSON(this.resourceInfo.data,F,G)}async _loadFromStylesService(D,G){var C=`${D.serviceUrl}/${D.id}`;D=(await r(C,{query:{language:D.getLanguageParamValue(),
places:D.places,worldview:D.worldview},signal:G?.signal})).data;C=w.urlToObject(C);this._set("resourceInfo",{data:D.baseMap??{},context:{origin:"web-map",url:C}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:D.spatialReference},this.resourceInfo.context);return this._loadLayersFromJSON(this.resourceInfo.data,C,G)}static fromId(D){return(D=k.esriBasemapDefinitions[D])?D.itemId?new z({portalItem:{id:D.itemId,portal:{url:"https://www.arcgis.com"}}}):z.fromJSON(D,
{origin:D.is3d?"web-scene":"web-map"}):null}};q.__decorate([t.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(D,G,C,F){this._writeBaseLayers(D,G,F)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:g}},writer(D,G,C,F){this._writeBaseLayers(D,G,F)}}}}}})],m.prototype,"baseLayers",null);q.__decorate([t.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],m.prototype,"id",void 0);q.__decorate([t.property({type:A})],m.prototype,"portalItem",void 0);
q.__decorate([t.property()],m.prototype,"referenceLayers",null);q.__decorate([t.property({readOnly:!0})],m.prototype,"resourceInfo",void 0);q.__decorate([t.property({type:x})],m.prototype,"spatialReference",void 0);q.__decorate([t.property({type:v})],m.prototype,"style",void 0);q.__decorate([t.property()],m.prototype,"thumbnailUrl",void 0);q.__decorate([t.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],m.prototype,"title",void 0);q.__decorate([u.writer("title")],m.prototype,
"writeTitle",null);m=z=q.__decorate([e.subclass("esri.Basemap")],m);const K={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},I={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"};return m})},"esri/core/collectionUtils":function(){define(["exports","./Collection"],function(a,q){a.castForReferenceSetter=function(r){return r};a.referenceSetter=function(r,g,p=q){g||=new p;if(g===r)return g;g.removeAll();r&&(Array.isArray(r)||"items"in r&&Array.isArray(r.items))?
g.addMany(r):r&&g.add(r);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Loadable":function(){define("../chunks/tslib.es6 ./Error ./maybe ./Promise ./promiseUtils ./Warning ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f){const c=h=>{h=class extends h{constructor(...n){super(...n);this.loadError=this._loadController=null;this.loadStatus="not-loaded";this._set("loadWarnings",[]);this.addResolvingPromise(new Promise(d=>
{const w=this.load.bind(this);this.load=t=>{const l=new Promise((e,u)=>{const x=p.onAbortOrThrow(t,u);this.destroyed&&u(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this}));this.when(e,u).finally(()=>{x&&x.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;w({signal:e.signal})}d();return l}}));this.when(()=>{this._set("loadStatus","loaded");
this._loadController=null},d=>{this._set("loadStatus","failed");this._set("loadError",d);this._loadController=null})}destroy(){this._loadController&&(this._loadController=r.abortMaybe(this._loadController),this._promiseProps.abort());this._set("loadError",null);this._set("loadWarnings",[])}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){if(this.isFulfilled())return this;this._set("loadError",new q("load:cancelled","Cancelled"));
this._loadController?.abort();this._promiseProps.abort();return this}};a.__decorate([b.property({readOnly:!0})],h.prototype,"loaded",null);a.__decorate([b.property({readOnly:!0})],h.prototype,"loadError",void 0);a.__decorate([b.property({clonable:!1})],h.prototype,"loadStatus",void 0);a.__decorate([b.property({type:[m],readOnly:!0})],h.prototype,"loadWarnings",null);return h=a.__decorate([f.subclass("esri.core.Loadable")],h)};g=class extends c(g.EsriPromise){};g=a.__decorate([f.subclass("esri.core.Loadable")],
g);(function(h){h.LoadableMixin=c;h.isLoadable=function(n){return!(!n||!n.load)}})(g||={});return g})},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],function(a,q,r,g,p){var m;(function(c){c[c.PENDING=0]="PENDING";c[c.RESOLVED=1]="RESOLVED";c[c.REJECTED=2]="REJECTED"})(m||={});class b{constructor(){this._resolver=g.createResolver();this._status=m.PENDING;this._resolvingPromises=[];this._resolver.promise.then(()=>
{this._status=m.RESOLVED;this._cleanUp()},()=>{this._status=m.REJECTED;this._cleanUp()});this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(c){this._resolvingPromises.push(c);this._tryResolve()}isResolved(){return this._status===m.RESOLVED}isRejected(){return this._status===m.REJECTED}isFulfilled(){return this._status!==m.PENDING}abort(){this._resolver.reject(g.createAbortError())}_cleanUp(){this._resolvingPromises=this._allPromise=null}_tryResolve(){if(!this.isFulfilled()){var c=
g.createResolver(),h=[...this._resolvingPromises,c.promise],n=this._allPromise=Promise.all(h);n.then(()=>{this.isFulfilled()||this._allPromise!==n||this._resolver.resolve()},d=>{this.isFulfilled()||this._allPromise!==n||g.isAbortError(d)||this._resolver.reject(d)});c.resolve()}}}const f=c=>{c=class extends c{constructor(...h){super(...h);this._promiseProps=new b;this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(h,
n){return this._promiseProps.promise.then(()=>this).then(h,n)}catch(h){return this.when(null,h)}addResolvingPromise(h){h&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in h?h.when():h)}};return c=q.__decorate([p.subclass("esri.core.Promise")],c)};a.EsriPromise=class extends f(r){};a.EsriPromise=q.__decorate([p.subclass("esri.core.Promise")],a.EsriPromise);a.EsriPromiseMixin=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/loadAll":function(){define(["exports",
"./asyncUtils","./Collection","./Loadable"],function(a,q,r,g){async function p(m,b){const f=[],c=(...n)=>{for(const d of n)null!=d&&(Array.isArray(d)?c(...d):r.isCollection(d)?d.forEach(w=>c(w)):g.isLoadable(d)&&f.push(d))};b(c);let h=null;await q.map(f,async n=>{n=await q.result("loadAll"in n&&"function"===typeof n.loadAll?n.loadAll():n.load());!1!==n.ok||h||(h=n)});if(h)throw h.error;return m}a.loadAll=async function(m,b){await m.load();return p(m,b)};a.loadAllChildren=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/portal/Portal":function(){define("require ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/JSONSupport ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ../intl/locale ./portalDefault ./PortalGroup ./PortalQueryParams ./PortalQueryResult ./PortalUser ../support/apiKeyUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A,k,v,B,z){function E(F){const J=g.id;return()=>{const T=F.deref();T&&J.findCredential(T.restUrl)&&T.signIn().catch(()=>{})}}const K=F=>Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));var I;let D;const G={PortalGroup:()=>Promise.resolve({default:A}),PortalItem:()=>new Promise((F,J)=>a(["./PortalItem"],T=>F(K(T)),J)),PortalUser:()=>Promise.resolve({default:B})};b=I=class extends b.JSONSupportMixin(f){constructor(F){super(F);
this.access=this._esriIdCredentialCreateHandle=null;this.allSSL=!1;this.authMode="auto";this.bingKey=this.basemapGalleryGroupQuery3D=this.basemapGalleryGroupQuery=this.authorizedCrossOriginDomains=null;this.canProvisionDirectPurchase=this.canListPreProvisionedItems=this.canListData=this.canListApps=!1;this.canSearchPublic=!0;this.canSignInIDP=this.canSignInArcGIS=this.canSharePublic=this.canShareBingPublic=!1;this.colorSetsGroupQuery=null;this.commentsEnabled=!1;this.livingAtlasGroupQuery=this.layoutGroupQuery=
this.galleryTemplatesGroupQuery=this.featuredItemsGroupQuery=this.featuredGroups=this.eueiEnabled=this.devBasemapGalleryGroupQuery=this.description=this.defaultVectorBasemap=this.defaultExtent=this.defaultDevBasemap=this.defaultBasemap=this.customBaseUrl=this.culture=this.created=null;this.hasCategorySchema=!1;this.ipCntryCode=this.id=this.httpsPort=this.httpPort=this.homePageFeaturedContentCount=this.homePageFeaturedContent=this.helperServices=null;this.isReadOnly=this.isPortal=!1;this.region=this.portalProperties=
this.portalMode=this.portalHostname=this.name=this.modified=this.maxTokenExpirationMinutes=this.layerTemplatesGroupQuery=null;this.recycleBinEnabled=!1;this.rotatorPanels=null;this.showHomePageDescription=!1;this.sourceJSON=null;this.supportsHostedServices=!1;this.units=this.templatesGroupQuery=this.symbolSetsGroupQuery=null;this.url=r.portalUrl;this.user=this.urlKey=null;this.use3dBasemaps=!0;this.useVectorBasemaps=this.useStandardizedQuery=!1;this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(F){return"string"===
typeof F?{url:F}:F}destroy(){C.unregister(this);this.defaultBasemap=c.destroyMaybe(this.defaultBasemap);this.defaultDevBasemap=c.destroyMaybe(this.defaultDevBasemap);this.defaultVectorBasemap=c.destroyMaybe(this.defaultVectorBasemap);this._esriIdCredentialCreateHandle=c.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(F){if(F)for(const J of F)r.request.trustedServers.includes(J)||r.request.trustedServers.push(J);return F}readDefaultBasemap(F){return this._readBasemap(F)}readDefaultDevBasemap(F){return this._readBasemap(F)}readDefaultVectorBasemap(F){return this._readBasemap(F)}get extraQuery(){const F=
!this.user?.orgId||this.canSearchPublic;return this.id&&!F?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let F=this.url;if(F){const J=F.indexOf("/sharing");F=0<J?F.substring(0,J):this.url.replace(/\/+$/,"");F+="/sharing/rest"}return F}get thumbnailUrl(){const F=this.restUrl,J=this.thumbnail;return F&&J?this._normalizeSSL(F+"/portals/self/resources/"+J):null}readUrlKey(F){return F?F.toLowerCase():
F}readUser(F){let J=null;F&&(J=B.fromJSON(F),J.portal=this);return J}load(F){const J=(new Promise((T,S)=>a(["../Basemap"],ba=>T(K(ba)),S))).then(({default:T})=>{h.throwIfAborted(F);D=T}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,F)).then(T=>{if(g.id){const S=g.id;this.credential=S.findCredential(this.restUrl);this.credential||this.authMode!==I.AUTH_MODE_AUTO&&this.authMode!==I.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=
S.on("credential-create",E(new WeakRef(this))),C.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=T;this.read(T)});this.addResolvingPromise(J);return Promise.resolve(this)}async createElevationLayers(){await this.load();const F=this._getHelperService("defaultElevationLayers"),J=(await new Promise((T,S)=>a(["../layers/ElevationLayer"],ba=>T(K(ba)),S))).default;return F?F.map(T=>new J({id:T.id,url:T.url})):[]}async fetchBasemaps(F,J){const T=await this._fetchBasemaps(F,J);!0===
J?.include3d&&!1!==this.use3dBasemaps&&(F=await this._fetchBasemaps3D(F,J),T.unshift(...F));return T}fetchCategorySchema(F){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",F).then(J=>J.categorySchema):h.isAborted(F)?Promise.reject(h.createAbortError()):Promise.resolve([])}fetchFeaturedGroups(F){const J=this.featuredGroups,T=new k({num:100,sortField:"title"});if(J?.length){const S=[];for(const ba of J)S.push(`(title:"${ba.title}" AND owner:${ba.owner})`);T.query=
S.join(" OR ");return this.queryGroups(T,F).then(ba=>ba.results)}return h.isAborted(F)?Promise.reject(h.createAbortError()):Promise.resolve([])}fetchRegions(F){const J=this.user?.culture||this.culture||x.getLocale();return this.request(this.restUrl+"/portals/regions",{...F,query:{culture:J}})}fetchSettings(F){const J=this.user?.culture||this.culture||x.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...F,query:{culture:J}})}static getDefault(){return y.ensureDefaultPortalInstance(()=>
new I)}queryGroups(F,J){return this.queryPortal("/community/groups",F,"PortalGroup",J)}queryItems(F,J){return this.queryPortal("/search",F,"PortalItem",J)}queryUsers(F,J){F.sortField||(F.sortField="username");return this.queryPortal("/community/users",F,"PortalUser",J)}fetchSelf(F=this.authMode,J=!1,T){const S=this.restUrl+"/portals/self";F={authMode:F,query:{culture:x.getLocale().toLowerCase()},withCredentials:!0,...T};"auto"===F.authMode&&(F.authMode="no-prompt");J&&(F.query.default=!0);return this.request(S,
F)}queryPortal(F,J,T,S){const ba=d.ensureType(k,J),M=U=>this.request(this.restUrl+F,{...ba.toRequestOptions(this),...S}).then(R=>{const Z=ba.clone();Z.start=R.nextStart;return new v({nextQueryParams:Z,queryParams:ba,total:R.total,results:I._resultsToTypedArray(U,{portal:this},R,S)})}).then(R=>Promise.all(R.results.map(Z=>"function"===typeof Z.when?Z.when():R)).then(()=>R,Z=>{h.throwIfAbortError(Z);return R}));return T&&G[T]?G[T]().then(({default:U})=>{h.throwIfAborted(S);return M(U)}):M()}signIn(){if(this.authMode===
I.AUTH_MODE_ANONYMOUS||this.authMode===I.AUTH_MODE_NO_PROMPT&&!g.id)return Promise.reject(new m("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const F=J=>Promise.resolve().then(()=>{if("not-loaded"===this.loadStatus)return J||(this.authMode="immediate"),this.load().then(()=>null);if("loading"===this.loadStatus)return this.load().then(()=>{if(this.credential)return null;this.credential=J;return this.fetchSelf("immediate")});
if(this.user&&this.credential===J)return null;this.credential=J;return this.fetchSelf("immediate")}).then(T=>{T&&(this.sourceJSON=T,this.read(T))});return g.id?g.id.getCredential(this.restUrl,{prompt:this.authMode!==I.AUTH_MODE_NO_PROMPT}).then(J=>F(J)):F(this.credential)}normalizeUrl(F){const J=this.credential?.token;return this._normalizeSSL(J?F+(F.includes("?")?"\x26":"?")+"token\x3d"+J:F)}requestToTypedArray(F,J,T){return this.request(F,J).then(S=>{const ba=I._resultsToTypedArray(T,{portal:this},
S);return Promise.all(ba.map(M=>"function"===typeof M.when?M.when():S)).then(()=>ba,()=>ba)})}request(F,J={}){var T={f:"json",...J.query};const {authMode:S=this.authMode===I.AUTH_MODE_ANONYMOUS||this.authMode===I.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:ba=null,cacheBust:M=!1,method:U="auto",responseType:R="json",signal:Z}=J;T={authMode:S,body:ba,cacheBust:M,method:U,query:T,responseType:R,timeout:0,signal:Z};J.withCredentials&&(T.withCredentials=!0);return p(this._normalizeSSL(F),T).then(ea=>
ea.data)}toJSON(){throw new m("internal:not-yet-implemented","Portal.toJSON is not yet implemented");}static fromJSON(F){if(!F)return null;if(F.declaredClass)throw Error("JSON object is already hydrated");return new I({sourceJSON:F})}_getHelperService(F){const J=this.helperServices&&this.helperServices[F];if(!J)throw new m("portal:service-not-found",`The \`helperServices\` do not include an entry named "${F}"`);return J}async _fetchBasemaps(F,J){const T=new k;T.query=F||(r.apiKey&&z.supportsApiKey(this.url)?
this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);T.disableExtraQuery=!0;F=await this.queryGroups(T,J);if(!F.total)return[];F=F.results[0];T.num=100;T.query='type:"Web Map" -type:"Web Application"';T.sortField=F.sortField||"name";T.sortOrder=F.sortOrder||"desc";J=await F.queryItems(T,J);return J.total?J.results.filter(S=>"Web Map"===S.type).map(S=>new D({portalItem:S})):[]}async _fetchBasemaps3D(F,J){F=F||this.basemapGalleryGroupQuery3D;
if(!F)return[];F=new k({query:F,disableExtraQuery:!0});var T=await this.queryGroups(F,J);if(!T.total)return[];T=T.results[0];F.num=100;F.query='type:"Web Scene"';F.sortField=T.sortField||"name";F.sortOrder=T.sortOrder||"desc";J=await T.queryItems(F,J);return J.total?J.results.filter(S=>"Web Scene"===S.type).map(S=>new D({portalItem:S})):[]}_normalizeSSL(F){return F.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(F){return F?(F=D.fromJSON(F),F.portalItem={portal:this},F):null}static _resultsToTypedArray(F,
J,T,S){if(T){const ba=null!=S?S.signal:null;T=T.listings||T.notifications||T.userInvitations||T.tags||T.items||T.groups||T.comments||T.provisions||T.results||T.relatedItems||T;if(F||J)T=T.map(M=>{M=Object.assign(F?F.fromJSON(M):M,J);"function"===typeof M.load&&M.load(ba);return M})}else T=[];return T}};b.AUTH_MODE_ANONYMOUS="anonymous";b.AUTH_MODE_AUTO="auto";b.AUTH_MODE_IMMEDIATE="immediate";b.AUTH_MODE_NO_PROMPT="no-prompt";q.__decorate([n.property()],b.prototype,"access",void 0);q.__decorate([n.property()],
b.prototype,"allSSL",void 0);q.__decorate([n.property()],b.prototype,"authMode",void 0);q.__decorate([n.property()],b.prototype,"authorizedCrossOriginDomains",void 0);q.__decorate([l.reader("authorizedCrossOriginDomains")],b.prototype,"readAuthorizedCrossOriginDomains",null);q.__decorate([n.property()],b.prototype,"basemapGalleryGroupQuery",void 0);q.__decorate([n.property({json:{name:"3DBasemapGalleryGroupQuery"}})],b.prototype,"basemapGalleryGroupQuery3D",void 0);q.__decorate([n.property()],b.prototype,
"bingKey",void 0);q.__decorate([n.property()],b.prototype,"canListApps",void 0);q.__decorate([n.property()],b.prototype,"canListData",void 0);q.__decorate([n.property()],b.prototype,"canListPreProvisionedItems",void 0);q.__decorate([n.property()],b.prototype,"canProvisionDirectPurchase",void 0);q.__decorate([n.property()],b.prototype,"canSearchPublic",void 0);q.__decorate([n.property()],b.prototype,"canShareBingPublic",void 0);q.__decorate([n.property()],b.prototype,"canSharePublic",void 0);q.__decorate([n.property()],
b.prototype,"canSignInArcGIS",void 0);q.__decorate([n.property()],b.prototype,"canSignInIDP",void 0);q.__decorate([n.property()],b.prototype,"colorSetsGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"commentsEnabled",void 0);q.__decorate([n.property({type:Date})],b.prototype,"created",void 0);q.__decorate([n.property()],b.prototype,"credential",void 0);q.__decorate([n.property()],b.prototype,"culture",void 0);q.__decorate([n.property()],b.prototype,"currentVersion",void 0);q.__decorate([n.property()],
b.prototype,"customBaseUrl",void 0);q.__decorate([n.property()],b.prototype,"defaultBasemap",void 0);q.__decorate([l.reader("defaultBasemap")],b.prototype,"readDefaultBasemap",null);q.__decorate([n.property()],b.prototype,"defaultDevBasemap",void 0);q.__decorate([l.reader("defaultDevBasemap")],b.prototype,"readDefaultDevBasemap",null);q.__decorate([n.property({type:u})],b.prototype,"defaultExtent",void 0);q.__decorate([n.property()],b.prototype,"defaultVectorBasemap",void 0);q.__decorate([l.reader("defaultVectorBasemap")],
b.prototype,"readDefaultVectorBasemap",null);q.__decorate([n.property()],b.prototype,"description",void 0);q.__decorate([n.property()],b.prototype,"devBasemapGalleryGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"eueiEnabled",void 0);q.__decorate([n.property({readOnly:!0})],b.prototype,"extraQuery",null);q.__decorate([n.property()],b.prototype,"featuredGroups",void 0);q.__decorate([n.property()],b.prototype,"featuredItemsGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"galleryTemplatesGroupQuery",
void 0);q.__decorate([n.property()],b.prototype,"layoutGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"livingAtlasGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"hasCategorySchema",void 0);q.__decorate([n.property()],b.prototype,"helpBase",void 0);q.__decorate([n.property()],b.prototype,"helperServices",void 0);q.__decorate([n.property()],b.prototype,"helpMap",void 0);q.__decorate([n.property()],b.prototype,"homePageFeaturedContent",void 0);q.__decorate([n.property()],b.prototype,
"homePageFeaturedContentCount",void 0);q.__decorate([n.property()],b.prototype,"httpPort",void 0);q.__decorate([n.property()],b.prototype,"httpsPort",void 0);q.__decorate([n.property()],b.prototype,"id",void 0);q.__decorate([n.property()],b.prototype,"ipCntryCode",void 0);q.__decorate([n.property({readOnly:!0})],b.prototype,"isOrganization",null);q.__decorate([n.property()],b.prototype,"isPortal",void 0);q.__decorate([n.property()],b.prototype,"isReadOnly",void 0);q.__decorate([n.property({readOnly:!0})],
b.prototype,"itemPageUrl",null);q.__decorate([n.property()],b.prototype,"layerTemplatesGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"maxTokenExpirationMinutes",void 0);q.__decorate([n.property({type:Date})],b.prototype,"modified",void 0);q.__decorate([n.property()],b.prototype,"name",void 0);q.__decorate([n.property()],b.prototype,"portalHostname",void 0);q.__decorate([n.property()],b.prototype,"portalMode",void 0);q.__decorate([n.property()],b.prototype,"portalProperties",void 0);
q.__decorate([n.property()],b.prototype,"region",void 0);q.__decorate([n.property()],b.prototype,"recycleBinEnabled",void 0);q.__decorate([n.property({readOnly:!0})],b.prototype,"restUrl",null);q.__decorate([n.property()],b.prototype,"rotatorPanels",void 0);q.__decorate([n.property()],b.prototype,"showHomePageDescription",void 0);q.__decorate([n.property()],b.prototype,"sourceJSON",void 0);q.__decorate([n.property()],b.prototype,"staticImagesUrl",void 0);q.__decorate([n.property({json:{name:"2DStylesGroupQuery"}})],
b.prototype,"stylesGroupQuery2d",void 0);q.__decorate([n.property({json:{name:"stylesGroupQuery"}})],b.prototype,"stylesGroupQuery3d",void 0);q.__decorate([n.property()],b.prototype,"supportsHostedServices",void 0);q.__decorate([n.property()],b.prototype,"symbolSetsGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"templatesGroupQuery",void 0);q.__decorate([n.property()],b.prototype,"thumbnail",void 0);q.__decorate([n.property({readOnly:!0})],b.prototype,"thumbnailUrl",null);q.__decorate([n.property()],
b.prototype,"units",void 0);q.__decorate([n.property()],b.prototype,"url",void 0);q.__decorate([n.property()],b.prototype,"urlKey",void 0);q.__decorate([l.reader("urlKey")],b.prototype,"readUrlKey",null);q.__decorate([n.property()],b.prototype,"user",void 0);q.__decorate([l.reader("user")],b.prototype,"readUser",null);q.__decorate([n.property()],b.prototype,"use3dBasemaps",void 0);q.__decorate([n.property()],b.prototype,"useStandardizedQuery",void 0);q.__decorate([n.property()],b.prototype,"useVectorBasemaps",
void 0);q.__decorate([n.property()],b.prototype,"vectorBasemapGalleryGroupQuery",void 0);q=b=I=q.__decorate([e.subclass("esri.portal.Portal")],b);const C=new FinalizationRegistry(F=>{F.remove()});return q})},"esri/portal/portalDefault":function(){define(["exports"],function(a){let q;a.clearDefaultPortalInstance=function(){q=void 0};a.ensureDefaultPortalInstance=function(r){if(!q||q.destroyed)q=r();return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/PortalGroup":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./PortalQueryParams".split(" "),
function(a,q,r,g,p,m,b,f,c){var h;r=h=class extends r.JSONSupport{constructor(n){super(n);this.id=this.description=this.created=this.access=null;this.isInvitationOnly=!1;this.title=this.tags=this.sourceJSON=this.sortOrder=this.sortField=this.snippet=this.portal=this.owner=this.modified=null}get thumbnailUrl(){const n=this.url,d=this.thumbnail;return n&&d&&this.portal?this.portal?.normalizeUrl(`${n}/info/${d}?f=json`):null}get url(){const n=this.portal?.restUrl;return n?n+"/community/groups/"+this.id:
null}fetchCategorySchema(n){return this.portal.request(this.url+"/categorySchema",n).then(d=>{d=d.categorySchema||[];return d.some(w=>"contentCategorySetsGroupQuery.LivingAtlas"===w.source)?this._fetchCategorySchemaSet("LivingAtlas",n):d})}fetchMembers(n){return this.portal.request(this.url+"/users",n)}getThumbnailUrl(n){let d=this.thumbnailUrl;d&&n&&(d+=`&w=${n}`);return d}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");}static fromJSON(n){if(!n)return null;
if(n.declaredClass)throw Error("JSON object is already hydrated");const d=new h({sourceJSON:n});d.read(n);return d}queryItems(n,d){n=p.ensureType(c,n);const w=this.portal;if(5<parseFloat(w.currentVersion))return n=n||new c,w.queryPortal(`/content/groups/${this.id}/search`,n,"PortalItem",d);n=n?n.clone():new c;n.query="group:"+this.id+(n.query?" "+n.query:"");return w.queryItems(n,d)}_fetchCategorySchemaSet(n,d){const w=this.portal;return w.fetchSelf(w.authMode,!0,d).then(t=>{if(t=t.contentCategorySetsGroupQuery)return t=
new c({disableExtraQuery:!0,num:1,query:t}),w.queryGroups(t,d);throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found");}).then(t=>{if(t.total){t=t.results[0];const l=new c({num:1,query:`typekeywords:"${n}"`});return t.queryItems(l,d)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found");}).then(t=>t.total?t.results[0].fetchData("json",d).then(l=>{l=l?.categorySchema;return l?.length?l:[]}):[])}};a.__decorate([g.property()],
r.prototype,"access",void 0);a.__decorate([g.property({type:Date})],r.prototype,"created",void 0);a.__decorate([g.property()],r.prototype,"description",void 0);a.__decorate([g.property()],r.prototype,"id",void 0);a.__decorate([g.property()],r.prototype,"isInvitationOnly",void 0);a.__decorate([g.property({type:Date})],r.prototype,"modified",void 0);a.__decorate([g.property()],r.prototype,"owner",void 0);a.__decorate([g.property()],r.prototype,"portal",void 0);a.__decorate([g.property()],r.prototype,
"snippet",void 0);a.__decorate([g.property()],r.prototype,"sortField",void 0);a.__decorate([g.property()],r.prototype,"sortOrder",void 0);a.__decorate([g.property()],r.prototype,"sourceJSON",void 0);a.__decorate([g.property()],r.prototype,"tags",void 0);a.__decorate([g.property()],r.prototype,"thumbnail",void 0);a.__decorate([g.property({readOnly:!0})],r.prototype,"thumbnailUrl",null);a.__decorate([g.property()],r.prototype,"title",void 0);a.__decorate([g.property({readOnly:!0})],r.prototype,"url",
null);return r=h=a.__decorate([f.subclass("esri.portal.PortalGroup")],r)})},"esri/portal/PortalQueryParams":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils".split(" "),function(a,q,r,g,p,m,b,f,c,h,n){var d;const w=new r.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",
numComments:"num-comments",numViews:"num-views"});q=d=class extends q{constructor(t){super(t);this.categories=null;this.disableExtraQuery=!1;this.filter=this.extent=null;this.num=10;this.sortField=this.query=null;this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){"asc"!==t&&"desc"!==t||this._set("sortOrder",t)}clone(){return new d({categories:this.categories?g.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():
null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,l){let e=[];this.categories&&(e=this.categories.map(y=>Array.isArray(y)?JSON.stringify(y):y));let u="";if(this.extent){var x=n.project(this.extent,h.WGS84);null!=x&&(u=`${x.xmin},${x.ymin},${x.xmax},${x.ymax}`)}x=this.query;!this.disableExtraQuery&&t.extraQuery&&(x="("+x+")"+t.extraQuery);t={categories:e,bbox:u,q:x,filter:this.filter,num:this.num,sortField:null,
sortOrder:null,start:this.start};this.sortField&&(t.sortField=this.sortField.split(",").map(y=>w.toJSON(y.trim())).join(","),t.sortOrder=this.sortOrder);return{query:{...l,...t}}}};a.__decorate([p.property()],q.prototype,"categories",void 0);a.__decorate([p.property()],q.prototype,"disableExtraQuery",void 0);a.__decorate([p.property({type:c})],q.prototype,"extent",void 0);a.__decorate([p.property()],q.prototype,"filter",void 0);a.__decorate([p.property()],q.prototype,"num",void 0);a.__decorate([p.property()],
q.prototype,"query",void 0);a.__decorate([p.property()],q.prototype,"sortField",void 0);a.__decorate([p.property()],q.prototype,"sortOrder",null);a.__decorate([p.property()],q.prototype,"start",void 0);return q=d=a.__decorate([f.subclass("esri.portal.PortalQueryParams")],q)})},"esri/portal/PortalQueryResult":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b){q=class extends q{constructor(f){super(f);this.total=this.results=this.queryParams=this.nextQueryParams=null}};a.__decorate([r.property()],q.prototype,"nextQueryParams",void 0);a.__decorate([r.property()],q.prototype,"queryParams",void 0);a.__decorate([r.property()],q.prototype,"results",void 0);a.__decorate([r.property()],q.prototype,"total",void 0);return q=a.__decorate([b.subclass("esri.portal.PortalQueryResult")],q)})},"esri/portal/PortalUser":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){var d;g=d=class extends g.JSONSupport{constructor(w){super(w);this.userType=this.userLicenseTypeId=this.username=this.units=this.sourceJSON=this.roleId=this.role=this.region=this.privileges=this.preferredView=this.portal=this.orgId=this.modified=this.fullName=this.email=this.description=this.culture=this.created=this.access=null}get thumbnailUrl(){const w=this.url,t=this.thumbnail;return w&&t?this.portal.normalizeUrl(`${w}/info/${t}?f=json`):null}get userContentUrl(){const w=
this.portal?.restUrl;return w?`${w}/content/users/${this.username}`:null}get url(){const w=this.portal?.restUrl;return w?`${w}/community/users/${this.username}`:null}addItem(w){const t=w&&w.item;var l=w?.data;w=w?.folder;const e={method:"post"};t&&(e.query=t.createPostQuery(),null!=l&&("string"===typeof l?e.query.text=l:"object"===typeof l&&(e.query.text=JSON.stringify(l))));l=this.userContentUrl;w&&(l+="/"+("string"===typeof w?w:w.id));return this.portal.request(l+"/addItem",e).then(u=>{t.id=u.id;
t.portal=this.portal;return t.loaded?t.reload():t.load()})}async deleteItem(w,t=!1){let l=this.userContentUrl;w.ownerFolder&&(l+="/"+w.ownerFolder);await this.portal.request(l+`/items/${w.id}/delete`,{method:"post",query:t?{permanentDelete:!0}:{}});w.id=null;w.portal=null}async deleteItems(w,t=!1){w=w.concat();var l=this.userContentUrl+"/deleteItems";const e=[];var u=w.map(x=>x.id);if(u.length){t={method:"post",query:{items:u.join(","),permanentDelete:t}};l=await this.portal.request(l,t);for(const x of l.results)l=
w.find(y=>x.itemId===y.id),t=x.success,u=null,t?(l.id=null,l.portal=null):x.error&&(u=new r("portal:delete-item-failed",x.error.message,x.error)),e.push({item:l,success:t,error:u})}return e}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then(w=>w&&w.folders?w.folders.map(t=>{t=h.fromJSON(t);t.portal=this.portal;return t}):[])}fetchGroups(){return this.portal.request(this.url??"").then(w=>w&&w.groups?w.groups.map(t=>{t=n.fromJSON(t);t.portal=this.portal;return t}):
[])}async fetchItems(w){w??={};var t=this.userContentUrl??"";w.folder&&(t+="/"+w.folder.id);const {default:l}=await new Promise((e,u)=>a(["./PortalItem"],x=>e(Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}))),u));w=await this.portal.request(t,{query:{folders:!1,inRecycleBin:w.inRecycleBin?!0:null,foldersContent:!w.folder&&w.includeSubfolderItems?!0:null,num:w.num||10,start:w.start||1,sortField:w.sortField||"created",sortOrder:w.sortOrder||"asc"}});
return w?.items?(t=w.items.map(e=>{e=l.fromJSON(e);e.portal=this.portal;return e}),await Promise.all(t.map(e=>e.load())),{items:t,nextStart:w.nextStart,total:w.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(w=>w.tags)}getThumbnailUrl(w){let t=this.thumbnailUrl;t&&w&&(t+=`&w=${w}`);return t}queryFavorites(w){return this.favGroupId?(this._favGroup||(this._favGroup=new n({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(w)):Promise.reject(new r("internal:unknown",
"Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(w,t){await this.portal.request(this.userContentUrl+`/items/${w.id}/restore`,{method:"post",query:t?{folderID:"string"===typeof t?t:t.id}:null})}toJSON(){throw new r("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented");}static fromJSON(w){if(!w)return null;if(w.declaredClass)throw Error("JSON object is already hydrated");const t=new d({sourceJSON:w});t.read(w);return t}};q.__decorate([p.property()],
g.prototype,"access",void 0);q.__decorate([p.property({type:Date})],g.prototype,"created",void 0);q.__decorate([p.property()],g.prototype,"culture",void 0);q.__decorate([p.property()],g.prototype,"description",void 0);q.__decorate([p.property()],g.prototype,"email",void 0);q.__decorate([p.property()],g.prototype,"favGroupId",void 0);q.__decorate([p.property()],g.prototype,"fullName",void 0);q.__decorate([p.property({type:Date})],g.prototype,"modified",void 0);q.__decorate([p.property()],g.prototype,
"orgId",void 0);q.__decorate([p.property()],g.prototype,"portal",void 0);q.__decorate([p.property()],g.prototype,"preferredView",void 0);q.__decorate([p.property()],g.prototype,"privileges",void 0);q.__decorate([p.property()],g.prototype,"region",void 0);q.__decorate([p.property()],g.prototype,"role",void 0);q.__decorate([p.property()],g.prototype,"roleId",void 0);q.__decorate([p.property()],g.prototype,"sourceJSON",void 0);q.__decorate([p.property()],g.prototype,"thumbnail",void 0);q.__decorate([p.property({readOnly:!0})],
g.prototype,"thumbnailUrl",null);q.__decorate([p.property()],g.prototype,"units",void 0);q.__decorate([p.property({readOnly:!0})],g.prototype,"userContentUrl",null);q.__decorate([p.property({readOnly:!0})],g.prototype,"url",null);q.__decorate([p.property()],g.prototype,"username",void 0);q.__decorate([p.property()],g.prototype,"userLicenseTypeId",void 0);q.__decorate([p.property()],g.prototype,"userType",void 0);return g=d=q.__decorate([c.subclass("esri.portal.PortalUser")],g)})},"esri/portal/PortalFolder":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f){r=class extends r.JSONSupport{constructor(c){super(c);this.username=this.title=this.portal=this.id=this.created=null}get url(){const c=this.portal?.restUrl;return c?`${c}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented");}};a.__decorate([g.property({type:Date})],r.prototype,"created",void 0);a.__decorate([g.property()],r.prototype,"id",void 0);a.__decorate([g.property()],r.prototype,
"portal",void 0);a.__decorate([g.property()],r.prototype,"title",void 0);a.__decorate([g.property({readOnly:!0})],r.prototype,"url",null);a.__decorate([g.property()],r.prototype,"username",void 0);return r=a.__decorate([f.subclass("esri.portal.PortalFolder")],r)})},"esri/portal/PortalItem":function(){define("require ../chunks/tslib.es6 ../assets ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ./Portal ./PortalItemResource ./PortalRating ../chunks/persistableUrlUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u){var x;const y=new Set("3DTiles Service;CSV;Feature Collection;Feature Service;Feed;GeoJson;Group Layer;Image Service;KML;Map Service;Media Layer;Scene Service;Stream Service;Vector Tile Service;WFS;WMS;WMTS".split(";")),A=new Set(["KML","GeoJson","CSV"]);p=x=class extends p.JSONSupportMixin(b){static from(k){return h.ensureClass(x,k)}constructor(k){super(k);this.id=this.groupCategories=this.extent=this.description=this.culture=this.created=this.categories=
this.avgRating=this.applicationProxies=this.apiKey=this.accessInformation=this.access=null;this.isOrgItem=!1;this.url=this.typeKeywords=this.type=this.title=this.tags=this.spatialReference=this.sourceUrl=this.sourceJSON=this.snippet=this.size=this.screenshots=this.portal=this.ownerFolder=this.owner=this.numViews=this.numRatings=this.numComments=this.name=this.modified=this.licenseInfo=this.itemControl=null}destroy(){this.portal=null}get displayName(){const k=this.type,v=this.typeKeywords||[];let B=
k;"Feature Service"===k||"Feature Collection"===k?B=v.includes("Table")?"Table":v.includes("Route Layer")?"Route Layer":v.includes("Markup")?"Markup":"Feature Layer":"Image Service"===k?B=v.includes("Elevation 3D Layer")?"Elevation Layer":v.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===k?B="Scene Layer":"Video Service"===k?B="Video Layer":"Scene Package"===k?B="Scene Layer Package":"Stream Service"===k?B="Feature Layer":"Geoprocessing Service"===k?B=v.includes("Web Tool")?
"Tool":"Geoprocessing Service":"Geoenrichment Service"===k?B="GeoEnrichment Service":"Geocoding Service"===k?B="Locator":"Microsoft Powerpoint"===k?B="Microsoft PowerPoint":"GeoJson"===k?B="GeoJSON":"Globe Service"===k?B="Globe Layer":"Vector Tile Service"===k?B="Tile Layer":"netCDF"===k?B="NetCDF":"Map Service"===k?B=v.includes("Spatiotemporal")||!v.includes("Hosted Service")&&!v.includes("Tiled")||v.includes("Relational")?"Map Image Layer":"Tile Layer":k?.toLowerCase().includes("add in")?B=k.replaceAll(/(add in)/gi,
"Add-In"):"datastore catalog service"===k?B="Big Data File Share":"Compact Tile Package"===k?B="Tile Package (tpkx)":"Raster function template"===k?B="Raster Function Template":"OGCFeatureServer"===k?B="OGC Feature Layer":"web mapping application"===k&&v.includes("configurableApp")?B="Instant App":"Insights Page"===k?B="Insights Report":"Excalibur Imagery Project"===k?B="Excalibur Project":"3DTiles Service"===k?B="3D tiles layer":"3DTiles Package"===k&&(B="3D tiles package");return B}readExtent(k){return k&&
k.length?new w(k[0][0],k[0][1],k[1][0],k[1][1]):null}get iconUrl(){var k=this.type?.toLowerCase()||"";const v=this.typeKeywords||[];var B=!1,z=!1;let E=!1,K=!1,I=!1,D=!1;B=z=!1;0<k.indexOf("service")||"feature collection"===k||"kml"===k||"wms"===k||"wmts"===k||"wfs"===k?(B=v.includes("Hosted Service"),"feature service"===k||"feature collection"===k||"kml"===k||"wfs"===k?(z=v.includes("Table"),E=v.includes("Route Layer"),K=v.includes("Markup"),I=v.includes("Spatiotemporal"),D=v.includes("UtilityNetwork"),
k=I&&z?"spatiotemporaltable":z?"table":E?"routelayer":K?"markup":I?"spatiotemporal":D?"utilitynetwork":B?"featureshosted":"features"):"map service"===k||"wms"===k||"wmts"===k?(I=v.includes("Spatiotemporal"),z=v.includes("Relational"),k=I||z?"mapimages":B||v.includes("Tiled")||"wmts"===k?"maptiles":"mapimages"):k="scene service"===k?v.includes("Line")?"sceneweblayerline":v.includes("3DObject")?"sceneweblayermultipatch":v.includes("Point")?"sceneweblayerpoint":v.includes("IntegratedMesh")?"sceneweblayermesh":
v.includes("PointCloud")?"sceneweblayerpointcloud":v.includes("Polygon")?"sceneweblayerpolygon":v.includes("Building")?"sceneweblayerbuilding":v.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===k?v.includes("Elevation 3D Layer")?"elevationlayer":v.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===k?"streamlayer":"vector tile service"===k?"vectortile":"datastore catalog service"===k?"datastorecollection":"geocoding service"===k?"geocodeservice":"video service"===
k?v.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===k?v.includes("Web Tool")?"tool":"layers":"geodata service"===k?"geodataservice":"3dtiles service"===k?v.includes("3DObject")?"3dobjecttileslayer":v.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):k="web map"===k||"cityengine web scene"===k?"maps":"web scene"===k?v.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===k&&v.includes("configurableApp")?
"instantapps":"web mapping application"===k||"mobile application"===k||"application"===k||"operation view"===k||"desktop application"===k?"apps":"map document"===k||"map package"===k||"published map"===k||"scene document"===k||"globe document"===k||"basemap package"===k||"mobile basemap package"===k||"mobile map package"===k||"project package"===k||"project template"===k||"pro map"===k||"layout"===k||"layer"===k&&v.includes("ArcGIS Pro")||"explorer map"===k&&v.indexOf("Explorer Document")?"mapsgray":
"service definition"===k||"shapefile"===k||"cad drawing"===k||"geojson"===k||"netcdf"===k||"administrative report"===k?"datafiles":"360 vr experience"===k?"360vr":"explorer add in"===k||"desktop add in"===k||"windows viewer add in"===k||"windows viewer configuration"===k?"appsgray":"arcgis pro add in"===k||"arcgis pro configuration"===k?"addindesktop":"pdf"===k?"pdf":"microsoft word"===k?"word":"microsoft excel"===k?"excel":"microsoft powerpoint"===k?"ppt":"rule package"===k||"file geodatabase"===
k||"sqlite geodatabase"===k||"csv collection"===k||"kml collection"===k||"windows mobile package"===k||"map template"===k||"desktop application template"===k||"gml"===k||"arcpad package"===k||"code sample"===k||"document link"===k||"earth configuration"===k||"operations dashboard add in"===k||"rules package"===k||"workflow manager package"===k||"explorer map"===k&&v.includes("Explorer Mapping Application")||v.includes("Document")?"datafilesgray":"network analysis service"===k||"geoprocessing service"===
k||"geodata service"===k||"geometry service"===k||"geoprocessing package"===k||"locator package"===k||"geoprocessing sample"===k||"workflow manager service"===k?"toolsgray":"layer"===k||"layer package"===k||"explorer layer"===k?"layersgray":"analysis model"===k?"analysismodel":"scene package"===k?"scenepackage":"3dtiles package"===k?"3dtileslayerpackage":"3dtiles service"===k?"3dtileslayer":"mobile scene package"===k?"mobilescenepackage":"tile package"===k||"compact tile package"===k?"tilepackage":
"task file"===k?"taskfile":"report template"===k?"report-template":"statistical data collection"===k?"statisticaldatacollection":"insights workbook"===k?"workbook":"insights model"===k?"insightsmodel":"insights page"===k?"insightspage":"insights theme"===k?"insightstheme":"hub initiative"===k?"hubinitiative":"hub page"===k?"hubpage":"hub site application"===k?"hubsite":"hub event"===k?"hubevent":"hub project"===k?"hubproject":"relational database connection"===k?"relationaldatabaseconnection":"big data file share"===
k?"datastorecollection":"image collection"===k?"imagecollection":"desktop style"===k?"desktopstyle":"style"===k?v.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===k?"dashboard":"raster function template"===k?"rasterprocessingtemplate":"vector tile package"===k?"vectortilepackage":"ortho mapping project"===k?"orthomappingproject":"ortho mapping template"===k?"orthomappingtemplate":"solution"===k?"solutions":"geopackage"===k?"geopackage":"deep learning package"===k?"deeplearningpackage":
"real time analytic"===k?"realtimeanalytics":"big data analytic"===k?"bigdataanalytics":"feed"===k?"feed":"excalibur imagery project"===k?"excaliburimageryproject":"notebook"===k?"notebook":"storymap"===k?"storymap":"survey123 add in"===k?"survey123addin":"mission"===k?"mission":"mission report"===k?"missionreport":"mission template"===k?"missiontemplate":"quickcapture project"===k?"quickcaptureproject":"pro report"===k?"proreport":"pro report template"===k?"proreporttemplate":"urban model"===k?"urbanmodel":
"web experience"===k?"experiencebuilder":"web experience template"===k?"webexperiencetemplate":"experience builder widget"===k?"experiencebuilderwidget":"experience builder widget package"===k?"experiencebuilderwidgetpackage":"workflow"===k?"workflow":"kernel gateway connection"===k?"kernelgatewayconnection":"insights script"===k?"insightsscript":"hub initiative template"===k?"hubinitiativetemplate":"storymap theme"===k?"storymaptheme":"knowledge graph"===k?"knowledgegraph":"knowledge graph layer"===
k?"knowledgegraphlayer":"knowledge studio project"===k?"knowledgestudio":"native application"===k?"nativeapp":"native application installer"===k?"nativeappinstaller":"web link chart"===k?"linkchart":"knowledge graph web investigation"===k?"investigation":"ogcfeatureserver"===k?"features":"pro project"===k?"proproject":"insights workbook package"===k?"insightsworkbookpackage":"apache parquet"===k?"apacheparquet":"notebook code snippet library"===k?"notebookcodesnippets":"suitability model"===k?"suitabilitymodel":
"esri classifier definition"===k?"classifierdefinition":"esri classification schema"===k?"classificationschema":"insights data engineering workbook"===k?"dataengineeringworkbook":"insights data engineering model"===k?"dataengineeringmodel":"deep learning studio project"===k?"deeplearningproject":"discussion"===k?"discussion":"allsource project"===k?"allsourceproject":"api key"===k?"apikey":"data pipeline"===k?"datapipelines":"group layer"===k?(B=v.includes("Map"))?"layergroup2d":"layergroup":"media layer"===
k?"onlinemedialayer":"form"===k?v.includes("Survey123")?"survey":"datafilesgray":"csv"===k?"csv":"image"===k?"image":"maps";return k?r.getAssetUrl("esri/images/portal/"+k+"16.png"):null}get isLayer(){return null!=this.type&&y.has(this.type)}get itemCdnUrl(){return u.toCDNUrl(this.itemUrl)}get itemPageUrl(){const k=this.portal?.itemPageUrl;return k&&this.id?`${k}?id=${this.id}`:null}get itemUrl(){const k=this.portal?.restUrl;return k&&this.id?`${k}/content/items/${this.id}`:null}get thumbnailUrl(){const k=
this.itemUrl,v=this.thumbnail;return k&&v?this.portal?.normalizeUrl(`${k}/info/${v}?f=json`)??null:null}get userItemUrl(){const k=this.portal?.restUrl;if(!k)return null;const v=this.owner||this.portal?.user?.username;return v?`${k}/content/users/${this.ownerFolder?`${v}/${this.ownerFolder}`:v}/items/${this.id}`:null}load(k){const v=this.portal??(this.portal=t.getDefault()),B=v.load(k).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?v.request(this.itemUrl,{signal:null!=k?k.signal:null,
query:{token:this.apiKey}}):{}).then(z=>{this.sourceJSON=z;this.read(z)});this.addResolvingPromise(B);return Promise.resolve(this)}async addRating(k){const v={method:"post",query:{}};k instanceof e&&(k=k.rating);null==k||isNaN(k)||"number"!==typeof k||(v.query.rating=k);if(!this.portal)return null;await this.portal.request(this.itemUrl+"/addRating",v);return new e({rating:k,created:new Date})}clone(){var k={access:this.access,accessInformation:this.accessInformation,applicationProxies:m.clone(this.applicationProxies),
avgRating:this.avgRating,categories:m.clone(this.categories),created:m.clone(this.created),culture:this.culture,description:this.description,extent:m.clone(this.extent),groupCategories:m.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:m.clone(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:m.clone(this.screenshots),
size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};this.loaded&&(k.loadStatus="loaded");k=(new x({sourceJSON:this.sourceJSON})).set(k);k._set("isOrgItem",this.isOrgItem);return k}createPostQuery(){const k=this.toJSON();for(var v of["tags","typeKeywords","categories"])k[v]=k[v]?.join(", ");({extent:v}=k);v&&(k.extent=
JSON.stringify(v));return k}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(k="json",v){return this.portal.request(this.itemUrl+"/data",{responseType:k,...v,query:{token:this.apiKey}})}async fetchRating(k){k=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...k});return null!=k.rating?(k.created=new Date(k.created),new e(k)):null}fetchRelatedItems(k,v){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",
{query:{...k,token:this.apiKey},...v},x)}getThumbnailUrl(k){let v=this.thumbnailUrl;v&&k&&(v+=`&w=${k}`);return v}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(k=>{this.sourceJSON=k;this.read(k);return this})}update(k){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const v=k?.data,B={method:"post"};B.query=this.createPostQuery();for(const z in B.query)null===B.query[z]&&(B.query[z]="");B.query.clearEmptyFields=!0;null!=v&&
("string"===typeof v?B.query.text=v:"object"===typeof v&&(B.query.text=JSON.stringify(v)));return this.portal.request(`${this.userItemUrl}/update`,B).then(()=>this.reload())}):Promise.reject(new g("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(k){if(!this.id)throw new g("portal:item-does-not-exist","The item does not exist yet");await this.load();const {portal:v,itemUrl:B}=this;await v.signIn();const {copyResources:z,folder:E,tags:K,title:I}=k||{};k=
{method:"post",query:{copyPrivateResources:"all"===z,folder:"string"===typeof E?E:E?.id,includeResources:!!z,tags:K?.join(","),title:I}};({itemId:k}=await v.request(`${B}/copy`,k));return new x({id:k,portal:v})}updateThumbnail(k){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const v=k.thumbnail,B=k.filename,z={method:"post"};if("string"===typeof v)f.isDataProtocol(v)?z.query={data:v}:z.query={url:f.makeAbsolute(v)},null!=B&&(z.query.filename=B);else{const E=new FormData;null!=
B?E.append("file",v,B):E.append("file",v);z.body=E}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,z).then(()=>this.reload())}):Promise.reject(new g("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(k={},v){const {fetchResources:B}=await new Promise((z,E)=>a(["./support/resourceUtils"],z,E));return B(this,k,v)}async addResource(k,v,B){const {addOrUpdateResources:z}=await new Promise((E,K)=>a(["./support/resourceUtils"],E,K));k.portalItem=
this;await z(this,[{resource:k,content:v,compress:B?.compress,access:B?.access}],"add",B);return k}async removeResource(k,v){const {removeResource:B}=await new Promise((z,E)=>a(["./support/resourceUtils"],z,E));if(k.portalItem&&k.portalItem.itemUrl!==this.itemUrl)throw new g("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return B(this,k,v)}async removeAllResources(k){const {removeAllResources:v}=await new Promise((B,z)=>a(["./support/resourceUtils"],
B,z));return v(this,k)}resourceFromPath(k){return new l({portalItem:this,path:k})}toJSON(){var k=this.extent;k={accessInformation:this.accessInformation,categories:m.clone(this.categories),created:this.created?.getTime(),description:this.description,extent:k&&[[k.xmin,k.ymin],[k.xmax,k.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,
tags:m.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:m.clone(this.typeKeywords),url:this.url};return m.fixJson(k)}static fromJSON(k){if(!k)return null;if(k.declaredClass)throw Error("JSON object is already hydrated");return new x({sourceJSON:k})}_getPostQuery(){const k=this.toJSON();for(const v in k)"tags"===v&&null!==k[v]&&(k[v]=k[v].join(", ")),"typeKeywords"===v&&null!==k[v]&&(k[v]=k[v].join(", ")),"extent"===v&&k[v]&&(k[v]=JSON.stringify(k[v]));return k}};
q.__decorate([c.property({type:["private","shared","org","public"]})],p.prototype,"access",void 0);q.__decorate([c.property()],p.prototype,"accessInformation",void 0);q.__decorate([c.property({type:String})],p.prototype,"apiKey",void 0);q.__decorate([c.property({json:{read:{source:"appProxies"}}})],p.prototype,"applicationProxies",void 0);q.__decorate([c.property()],p.prototype,"avgRating",void 0);q.__decorate([c.property()],p.prototype,"categories",void 0);q.__decorate([c.property({type:Date})],
p.prototype,"created",void 0);q.__decorate([c.property()],p.prototype,"culture",void 0);q.__decorate([c.property()],p.prototype,"description",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"displayName",null);q.__decorate([c.property({type:w})],p.prototype,"extent",void 0);q.__decorate([n.reader("extent")],p.prototype,"readExtent",null);q.__decorate([c.property()],p.prototype,"groupCategories",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"iconUrl",null);q.__decorate([c.property()],
p.prototype,"id",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"isLayer",null);q.__decorate([c.property({type:Boolean,readOnly:!0})],p.prototype,"isOrgItem",void 0);q.__decorate([c.property()],p.prototype,"itemControl",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"itemPageUrl",null);q.__decorate([c.property({readOnly:!0})],p.prototype,"itemUrl",null);q.__decorate([c.property()],p.prototype,"licenseInfo",void 0);q.__decorate([c.property({type:Date})],p.prototype,"modified",
void 0);q.__decorate([c.property()],p.prototype,"name",void 0);q.__decorate([c.property()],p.prototype,"numComments",void 0);q.__decorate([c.property()],p.prototype,"numRatings",void 0);q.__decorate([c.property()],p.prototype,"numViews",void 0);q.__decorate([c.property()],p.prototype,"owner",void 0);q.__decorate([c.property()],p.prototype,"ownerFolder",void 0);q.__decorate([c.property({type:t})],p.prototype,"portal",void 0);q.__decorate([c.property()],p.prototype,"screenshots",void 0);q.__decorate([c.property()],
p.prototype,"size",void 0);q.__decorate([c.property()],p.prototype,"snippet",void 0);q.__decorate([c.property()],p.prototype,"sourceJSON",void 0);q.__decorate([c.property({type:String})],p.prototype,"sourceUrl",void 0);q.__decorate([c.property({type:String})],p.prototype,"spatialReference",void 0);q.__decorate([c.property()],p.prototype,"tags",void 0);q.__decorate([c.property()],p.prototype,"thumbnail",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"thumbnailUrl",null);q.__decorate([c.property()],
p.prototype,"title",void 0);q.__decorate([c.property()],p.prototype,"type",void 0);q.__decorate([c.property()],p.prototype,"typeKeywords",void 0);q.__decorate([c.property({type:String,json:{read(k,v){A.has(v.type)&&(v=this.portal?.restUrl,k||=v&&this.id?`${v}/content/items/${this.id}/data`:null);return k}}})],p.prototype,"url",void 0);q.__decorate([c.property({readOnly:!0})],p.prototype,"userItemUrl",null);return p=x=q.__decorate([d.subclass("esri.portal.PortalItem")],p)})},"esri/portal/PortalItemResource":function(){define("require ../chunks/tslib.es6 ../core/Accessor ../core/Error ../core/Logger ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){function d(w,t){if(null==w)return w;w=w.replace(/^\/+/,"");null!=t&&m.isAbsolute(w)&&(w=m.makeRelative(w,t.itemUrl));return w?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,"")}r=class extends r{constructor(w){super(w);this.portalItem=null}normalizeCtorArgs(w){return w?.portalItem&&w.path?{...w,path:d(w.path,w.portalItem)}:w}set path(w){null!=w&&m.isAbsolute(w)?p.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):
this._set("path",w)}_castPath(w){return d(w,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(w="json",t){const l=this.cdnUrl;if(null==l)throw new g("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");
return this.portalItem.portal.request(l,{responseType:w,query:{token:this.portalItem.apiKey},signal:t?.signal})}async update(w,t){const {addOrUpdateResources:l}=await new Promise((e,u)=>a(["./support/resourceUtils"],e,u));await l(this.portalItem,[{resource:this,content:w,compress:t?.compress,access:t?.access}],"update",t);return this}hasPath(){return null!=this.path}};q.__decorate([b.property()],r.prototype,"portalItem",void 0);q.__decorate([b.property({type:String,value:null})],r.prototype,"path",
null);q.__decorate([f.cast("path")],r.prototype,"_castPath",null);q.__decorate([b.property({type:String,readOnly:!0})],r.prototype,"url",null);q.__decorate([b.property({type:String,readOnly:!0})],r.prototype,"cdnUrl",null);q.__decorate([b.property({type:String,readOnly:!0})],r.prototype,"itemRelativeUrl",null);return r=q.__decorate([n.subclass("esri.portal.PortalItemResource")],r)})},"esri/portal/PortalRating":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b){q=class extends q{constructor(f){super(f);this.rating=this.created=null}};a.__decorate([r.property()],q.prototype,"created",void 0);a.__decorate([r.property()],q.prototype,"rating",void 0);return q=a.__decorate([b.subclass("esri.portal.PortalRating")],q)})},"esri/chunks/persistableUrlUtils":function(){define(["exports","../kernel","../core/urlUtils","../portal/support/urlUtils"],function(a,q,r,g){function p(x,y){var A=y?.url?.path;x&&A&&(x=r.makeAbsolute(x,A,{preserveProtocolRelative:!0}),
y.portalItem&&y.readResourcePaths&&(A=r.makeRelative(x,y.portalItem.itemUrl),null!=A&&e.test(A)&&y.readResourcePaths.push(y.portalItem.resourceFromPath(A).path)));return(x=d(x,y?.portal))&&l.test(x)?w(x):x}function m(x,y,A=a.MarkKeep.YES){x=x&&l.test(x)?t(x):x;if(null==x)return x;!r.isAbsolute(x)&&y?.blockedRelativeUrls&&y.blockedRelativeUrls.push(x);let k=r.makeAbsolute(x);if(y){var v=y.verifyItemRelativeUrls?.rootPath||y.url?.path;if(v){v=d(v,y.portal);const B=d(k,y.portal);k=r.makeRelative(B,v,
v);null!=k&&k!==B&&k!==x&&y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.writtenUrls.push(k)}}k=n(k,y?.portal);r.isAbsolute(k)&&(k=r.normalize(k));y?.resources&&y?.portalItem&&!r.isAbsolute(k)&&!r.isDataProtocol(k)&&A===a.MarkKeep.YES&&y.resources.toKeep.push({resource:y.portalItem.resourceFromPath(k),compress:!1});return k}function b(x,y,A){return p(x,A)}function f(x,y,A,k){x=m(x,k);void 0!==x&&(y[A]=x)}function c(x){return(x?.match(l)??null)?.[1]??null}function h(x){x=x?.match(l)??null;if(null==
x)return null;x=x[2];const y=x.lastIndexOf("/");if(-1===y){const {path:v,extension:B}=r.splitPathExtension(x);return{prefix:null,filename:v,extension:B}}const {path:A,extension:k}=r.splitPathExtension(x.slice(y+1));return{prefix:x.slice(0,y),filename:A,extension:k}}function n(x,y){return y&&!y.isPortal&&y.urlKey&&y.customBaseUrl?r.changeDomain(x,`${y.urlKey}.${y.customBaseUrl}`,y.portalHostname):x}function d(x,y){if(!y||y.isPortal||!y.urlKey||!y.customBaseUrl)return x;const A=`${y.urlKey}.${y.customBaseUrl}`,
k=r.getAppUrl();return r.hasSameOrigin(k,`${k.scheme}://${A}`)?r.changeDomain(x,y.portalHostname,A):r.changeDomain(x,A,y.portalHostname)}function w(x){if(!x)return x||null;x&&q.id&&!q.id.findCredential(x)&&(x=g.normalizeArcGISOnlineOrgDomain(x),x=x.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),x=x.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),x=x.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com"));return x}function t(x){if(!x)return x||
null;x=x.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com");x=x.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com");(x=x.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"))&&q.id&&!q.id.findCredential(x)&&(x=g.normalizeArcGISOnlineOrgDomain(x));return x}const l=/\/items\/([^/]+)\/resources\/(.*)/,e=/^\.\/resources\//;a.MarkKeep=void 0;(function(x){x[x.YES=0]="YES";x[x.NO=1]="NO"})(a.MarkKeep||(a.MarkKeep={}));const u=Object.freeze(Object.defineProperty({__proto__:null,
get MarkKeep(){return a.MarkKeep},ensureMainOnlineDomain:n,fromCDNUrl:t,fromJSON:p,itemIdFromResourceUrl:c,prefixAndFilenameFromResourceUrl:h,read:b,toCDNUrl:w,toJSON:m,write:f},Symbol.toStringTag,{value:"Module"}));a.ensureMainOnlineDomain=n;a.fromCDNUrl=t;a.fromJSON=p;a.itemIdFromResourceUrl=c;a.persistableUrlUtils=u;a.prefixAndFilenameFromResourceUrl=h;a.read=b;a.toCDNUrl=w;a.toJSON=m;a.write=f})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(a,
q,r){a.esriBasemapDefinitions={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",
url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/terrain.jpg")},
baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",
isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get "dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},
baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],
id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-vector.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},
"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",
styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",
layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",
layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},
{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",
title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",
itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},
{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",
title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},
"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",
layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",
baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",
title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",
title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",
title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},
"arcgis-topographic":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},
title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",
title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},
"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},
"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",
title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",
title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",
showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",
title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",
title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};a.getBasemapTitle=async function(g){if(g){var p=g.includes("-vector")?g.slice(0,g.indexOf("-vector")):
g.includes("-3d")?g.slice(0,g.indexOf("-3d")):g,m=await r.fetchMessageBundle("esri/t9n/basemaps");return m[g]||m[p]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/BasemapStyle":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../intl/locale".split(" "),function(a,q,r,g,p,m,b,f){const c=new Set("ar bs ca hr cs da nl en et fi fr de el he hu id it ja ko lv lt nb pl ro ru sr es sv th tr uk vi".split(" "));
q=class extends q{constructor(h){super(h);this.places=this.language=this.id=null;this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps";this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;var h=f.getLocale().toLowerCase();switch(h){case "pt-br":return"pt-BR";case "pt-pt":return"pt-PT";case "zh-cn":return"zh-CN";case "zh-hk":return"zh-HK";case "zh-tw":return"zh-TW"}h=f.getLanguage(h);return"pt"===h?"pt-BR":h&&c.has(h)?h:"global"}};
a.__decorate([r.property()],q.prototype,"id",void 0);a.__decorate([r.property()],q.prototype,"language",void 0);a.__decorate([r.property()],q.prototype,"places",void 0);a.__decorate([r.property()],q.prototype,"serviceUrl",void 0);a.__decorate([r.property()],q.prototype,"worldview",void 0);return q=a.__decorate([b.subclass("esri.support.BasemapStyle")],q)})},"esri/webdoc/support/writeUtils":function(){define("exports ../../core/Error ../../core/lang ../../core/object ../../core/accessorSupport/extensions/serializableProperty/writer ../../layers/support/layerUtils".split(" "),
function(a,q,r,g,p,m){function b(h,n){"maxScale"in h&&(n.maxScale=p.numberToJSON(h.maxScale)??void 0);"minScale"in h&&(n.minScale=p.numberToJSON(h.minScale)??void 0)}const f=new Set("bing-maps imagery imagery-tile map-image open-street-map tile unknown unsupported vector-tile web-tile wms wmts".split(" ")),c=new Set("catalog csv feature geo-rss geojson group imagery imagery-tile kml knowledge-graph map-image map-notes media ogc-feature oriented-imagery route stream subtype-group tile unknown unsupported vector-tile web-tile wfs wms wmts".split(" "));
a.disableRestrictedWriting=function(h){f.add(h);c.add(h)};a.enableRestrictedWriting=function(h){f.delete(h);c.delete(h)};a.getLayerJSON=function(h,n,d){if(!h.persistenceEnabled)return null;if(!("write"in h&&h.write))return d?.messages&&d.messages.push(new q("layer:unsupported",`Layers (${h.title}, ${h.id}) of type '${h.declaredClass}' cannot be persisted`,{layer:h})),null;if(m.isFeatureCollectionLayer(h)&&!h.isTable)n=h.resourceInfo;else{if(d.restrictedWebMapWriting){var w="basemap"===d.layerContainerType?
f:"operational-layers"===d.layerContainerType?c:null;w=null!=w?w.has(h.type)&&!m.isFeatureCollectionLayer(h):!0}else w=!0;if(w)return n={},h.write(n,d)?n:null}if(null!=n){n=r.clone(n);if(d=n)m.isFeatureCollectionLayer(h)?(w=g.getDeepValue("featureCollection.layers",d)?.[0]?.layerDefinition)&&b(h,w):"group"!==h.type&&b(h,d);if(d&&(d.id=h.id,"blendMode"in h&&(d.blendMode=h.blendMode,"normal"===d.blendMode&&delete d.blendMode),d.opacity=p.numberToJSON(h.opacity)??void 0,d.title=h.title||"Layer",d.visibility=
h.visible,"legendEnabled"in h&&"wmts"!==h.type))if(m.isFeatureCollectionLayer(h)){if(d=d.featureCollection)d.showLegend=h.legendEnabled}else d.showLegend=h.legendEnabled}return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request"],function(a,q,r){function g(m){return"scene"===m?.type}function p(m){m=m?.type;return"imagery-tile"===m||"tile"===m||"open-street-map"===m||"vector-tile"===m||"web-tile"===
m||"wmts"===m}a.getEffectiveEditingEnabled=function(m){a:if("editingEnabled"in m)switch(m.type){case "csv":case "feature":case "geojson":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":var b=!0;break a;default:b=!1}else b=!1;return b?"effectiveEditingEnabled"in m?m.effectiveEditingEnabled:m.editingEnabled:!1};a.getEffectiveLayerCapabilities=function(m){a:if("capabilities"in m)switch(m.type){case "catalog":case "catalog-footprint":case "csv":case "feature":case "geojson":case "imagery":case "knowledge-graph-sublayer":case "ogc-feature":case "oriented-imagery":case "scene":case "sublayer":case "subtype-group":case "subtype-sublayer":case "wfs":var b=
!0;break a;default:b=!1}else b=!1;return b?"effectiveCapabilities"in m?m.effectiveCapabilities:m.capabilities:null};a.getOwningPortalUrl=async function(m,b){var f=q.id?.findServerInfo(m);if(null!=f?.currentVersion)return f.owningSystemUrl||null;f=m.toLowerCase().indexOf("/rest/services");if(-1===f)return null;m=`${m.substring(0,f)}/rest/info`;({data:b}=await r(m,{query:{f:"json"},responseType:"json",signal:null!=b?b.signal:null}));return b?.owningSystemUrl||null};a.getTileMaxtrixSetFromActiveLayer=
function(m){if(m.activeLayer){const b=m.activeLayer.tileMatrixSet;if(b)return b;if(m=m.activeLayer.tileMatrixSets)return m}return null};a.isBaseLayer=function(m){return null!=m?.parent&&"declaredClass"in m.parent&&"esri.Basemap"===m.parent.declaredClass&&m.parent.baseLayers.includes(m)};a.isBasemap3DSupportedLayer=function(m){return p(m)||g(m)};a.isBasemapSupportedTiledLayer=p;a.isFeatureCollectionLayer=function(m){return"feature"===m?.type&&!m.url&&"memory"===m.source?.type};a.isFeatureLayer=function(m){return null!=
m&&"object"===typeof m&&"type"in m&&"feature"===m.type};a.isFeatureServiceLayer=function(m){return"feature"===m?.type&&"feature-layer"===m.source?.type};a.isGraphicsLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"graphics"===m.type};a.isGroupLayer=function(m){return null!=m&&"type"in m&&"group"===m.type};a.isImageryTileLayer=function(m){return"imagery-tile"===m?.type};a.isIntegratedMeshLayer=function(m){return"integrated-mesh"===m||"integrated-mesh-3dtiles"===m};a.isIntegratedMeshOperationalLayer=
function(m){return"IntegratedMeshLayer"===m||"IntegratedMesh3DTilesLayer"===m};a.isKnowledgeGraphLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"knowledge-graph"===m.type&&"layers"in m};a.isLayerWithFeatureLayerSource=function(m){return("feature"===m?.type||"subtype-group"===m?.type)&&"feature-layer"===m.source?.type};a.isLinkChartLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"link-chart"===m.type&&"layers"in m};a.isMapNotesLayer=function(m){return null!=m&&
"object"===typeof m&&"type"in m&&"map-notes"===m.type&&"sublayers"in m};a.isSceneLayer=g;a.isSceneServiceLayer=function(m){m=m?.type;return"building-scene"===m||"integrated-mesh"===m||"point-cloud"===m||"scene"===m};a.isSubtypeGroupLayer=function(m){return null!=m&&"object"===typeof m&&"type"in m&&"subtype-group"===m.type&&"sublayers"in m};a.isSubtypeSublayer=function(m){return"subtype-sublayer"===m?.type};a.isTable=function(m){return null!=m&&"object"===typeof m&&"isTable"in m&&!!m.isTable};a.isTiledLayer=
function(m){m=m?.type;return"base-tile"===m||"tile"===m||"elevation"===m||"imagery-tile"===m||"base-elevation"===m||"open-street-map"===m||"wcs"===m||"web-tile"===m||"wmts"===m||"vector-tile"===m};a.isVoxelLayer=function(m){return"voxel"===m?.type};a.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};a.serializeLayerDefinitions=function(m){const b=/[:;]/,f=[];let c=!1;if(m&&(m.forEach((h,
n)=>{f.push([n,h]);!c&&b.test(h)&&(c=!0)}),0<f.length)){if(c){const h={};f.forEach(n=>{h[n[0]]=n[1]});m=JSON.stringify(h)}else{const h=[];f.forEach(n=>{h.push(n[0]+":"+n[1])});m=h.join(";")}return m}return null};a.serializeTimeOptions=function(m){if(m){var b=[];m.forEach((f,c)=>{b.push('"'+c+'":'+JSON.stringify(f))});if(b.length)return"{"+b.join(",")+"}"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(a,
q){a.canInterpolateEffects=function(r,g){const p=r.length>g.length?r:g;return(r.length>g.length?g:r).every((m,b)=>m.type===p[b].type)};a.effectEquals=function(r,g){r=JSON.stringify(r??null);g=JSON.stringify(g??null);return r===g};a.isEffectFunctions=function(r){return(r=r[0])?"type"in r:!1};a.normalizeEffects=function(r,g){const p=r.length>g.length?r:g;r=r.length>g.length?g:r;for(g=r.length;g<p.length;g++)r.push(q.createEffectWithInitialValues(p[g]))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(a,q,r,g,p){function m(t,l,e){return t+(l-t)*e}function b(t){return Math.round(1E3*r.px2pt(t))/1E3}class f{constructor(t,l,e){this.strength=t;this.radius=l;this.threshold=e;this.type="bloom"}interpolate(t,l,e){this.strength=m(t.strength,l.strength,e);this.radius=m(t.radius,l.radius,e);this.threshold=m(t.threshold,l.threshold,
e)}clone(){return new f(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:b(this.radius),strength:this.strength,threshold:this.threshold}}}class c{constructor(t){this.radius=t;this.type="blur"}interpolate(t,l,e){this.radius=Math.round(m(t.radius,l.radius,e))}clone(){return new c(this.radius)}toJSON(){return{type:"blur",radius:b(this.radius)}}}class h{constructor(t,l){this.type=t;this.amount=l;if("invert"===this.type||"grayscale"===this.type||"sepia"===this.type)this.amount=
Math.min(this.amount,1)}get colorMatrix(){this._colorMatrix||this._updateMatrix();return this._colorMatrix}interpolate(t,l,e){this.amount=m(t.amount,l.amount,e);this._updateMatrix()}clone(){return new h(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||g.create();switch(this.type){case "brightness":this._colorMatrix=p.brightness(t,this.amount);break;case "contrast":this._colorMatrix=p.contrast(t,this.amount);break;case "grayscale":this._colorMatrix=
p.grayscale(t,this.amount);break;case "invert":this._colorMatrix=p.invert(t,this.amount);break;case "saturate":this._colorMatrix=p.saturate(t,this.amount);break;case "sepia":this._colorMatrix=p.sepia(t,this.amount)}}}class n{constructor(t,l,e,u){this.offsetX=t;this.offsetY=l;this.blurRadius=e;this.color=u;this.type="drop-shadow"}interpolate(t,l,e){this.offsetX=m(t.offsetX,l.offsetX,e);this.offsetY=m(t.offsetY,l.offsetY,e);this.blurRadius=m(t.blurRadius,l.blurRadius,e);this.color[0]=Math.round(m(t.color[0],
l.color[0],e));this.color[1]=Math.round(m(t.color[1],l.color[1],e));this.color[2]=Math.round(m(t.color[2],l.color[2],e));this.color[3]=m(t.color[3],l.color[3],e)}clone(){return new n(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];t[3]*=255;return{type:"drop-shadow",xoffset:b(this.offsetX),yoffset:b(this.offsetY),blurRadius:b(this.blurRadius),color:t}}}class d{constructor(t){this.angle=t;this.type="hue-rotate"}get colorMatrix(){this._colorMatrix||this._updateMatrix();
return this._colorMatrix}interpolate(t,l,e){this.angle=m(t.angle,l.angle,e);this._updateMatrix()}clone(){return new d(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||g.create();this._colorMatrix=p.rotateHue(t,this.angle)}}class w{constructor(t){this.amount=t;this.type="opacity";this.amount=Math.min(this.amount,1)}interpolate(t,l,e){this.amount=m(t.amount,l.amount,e)}clone(){return new w(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}
a.BloomEffect=f;a.BlurEffect=c;a.ColorMatrixEffect=h;a.DropShadowEffect=n;a.HueRotateEffect=d;a.OpacityEffect=w;a.createEffectWithInitialValues=function(t){switch(t.type){case "grayscale":case "sepia":case "invert":return new h(t.type,0);case "saturate":case "brightness":case "contrast":return new h(t.type,1);case "opacity":return new w(1);case "hue-rotate":return new d(0);case "blur":return new c(0);case "drop-shadow":return new n(0,0,0,[...q.getNamedColor("transparent")]);case "bloom":return new f(0,
0,1)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(a){function q(){const f=new Float32Array(16);f[0]=1;f[5]=1;f[10]=1;f[15]=1;return f}function r(f){const c=new Float32Array(16);c[0]=f[0];c[1]=f[1];c[2]=f[2];c[3]=f[3];c[4]=f[4];c[5]=f[5];c[6]=f[6];c[7]=f[7];c[8]=f[8];c[9]=f[9];c[10]=f[10];c[11]=f[11];c[12]=f[12];c[13]=f[13];c[14]=f[14];c[15]=f[15];return c}function g(f,c,h,n,d,w,t,l,e,u,x,y,A,
k,v,B){const z=new Float32Array(16);z[0]=f;z[1]=c;z[2]=h;z[3]=n;z[4]=d;z[5]=w;z[6]=t;z[7]=l;z[8]=e;z[9]=u;z[10]=x;z[11]=y;z[12]=A;z[13]=k;z[14]=v;z[15]=B;return z}function p(f,c){return new Float32Array(f,c,16)}const m=q(),b=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:r,create:q,createView:p,fromValues:g},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=r;a.create=q;a.createView=p;a.fromValues=g;a.mat4f32=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(a,q){a.brightness=(r,g)=>{r=q.set(r,g,0,0,0,0,g,0,0,0,0,g,0,0,0,0,1);return q.transpose(r,r)};a.contrast=(r,g)=>{r=q.set(r,g,0,0,.5-.5*g,0,g,0,.5-.5*g,0,0,g,.5-.5*g,0,0,0,1);return q.transpose(r,r)};a.grayscale=(r,g)=>{g=1-g;r=q.set(r,.2126+.7874*g,.7152-.7152*g,.0722-.0722*g,0,.2126-.2126*g,.7152+.2848*g,.0722-.0722*g,0,.2126-.2126*g,.7152-.7152*g,.0722+.9278*g,0,0,0,0,1);return q.transpose(r,
r)};a.invert=(r,g)=>{const p=1-2*g;r=q.set(r,p,0,0,g,0,p,0,g,0,0,p,g,0,0,0,1);return q.transpose(r,r)};a.rotateHue=(r,g)=>{const p=Math.sin(g*Math.PI/180);g=Math.cos(g*Math.PI/180);r=q.set(r,.213+.787*g-.213*p,.715-.715*g-.715*p,.072-.072*g+.928*p,0,.213-.213*g+.143*p,.715+.285*g+.14*p,.072-.072*g-.283*p,0,.213-.213*g-.787*p,.715-.715*g+.715*p,.072+.928*g+.072*p,0,0,0,0,1);return q.transpose(r,r)};a.saturate=(r,g)=>{r=q.set(r,.213+.787*g,.715-.715*g,.072-.072*g,0,.213-.213*g,.715+.285*g,.072-.072*
g,0,.213-.213*g,.715-.715*g,.072+.928*g,0,0,0,0,1);return q.transpose(r,r)};a.sepia=(r,g)=>{g=1-g;r=q.set(r,.393+.607*g,.769-.769*g,.189-.189*g,0,.349-.349*g,.686+.314*g,.168-.168*g,0,.272-.272*g,.534-.534*g,.131+.869*g,0,0,0,0,1);return q.transpose(r,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(a,q,r){function g(L,P){L[0]=P[0];L[1]=P[1];L[2]=P[2];L[3]=P[3];L[4]=P[4];
L[5]=P[5];L[6]=P[6];L[7]=P[7];L[8]=P[8];L[9]=P[9];L[10]=P[10];L[11]=P[11];L[12]=P[12];L[13]=P[13];L[14]=P[14];L[15]=P[15];return L}function p(L,P,fa,ka,qa,Q,X,Y,ia,na,O,da,la,pa,za,Aa,Ba){L[0]=P;L[1]=fa;L[2]=ka;L[3]=qa;L[4]=Q;L[5]=X;L[6]=Y;L[7]=ia;L[8]=na;L[9]=O;L[10]=da;L[11]=la;L[12]=pa;L[13]=za;L[14]=Aa;L[15]=Ba;return L}function m(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function b(L,P){if(L===P){const fa=
P[1],ka=P[2],qa=P[3],Q=P[6],X=P[7],Y=P[11];L[1]=P[4];L[2]=P[8];L[3]=P[12];L[4]=fa;L[6]=P[9];L[7]=P[13];L[8]=ka;L[9]=Q;L[11]=P[14];L[12]=qa;L[13]=X;L[14]=Y}else L[0]=P[0],L[1]=P[4],L[2]=P[8],L[3]=P[12],L[4]=P[1],L[5]=P[5],L[6]=P[9],L[7]=P[13],L[8]=P[2],L[9]=P[6],L[10]=P[10],L[11]=P[14],L[12]=P[3],L[13]=P[7],L[14]=P[11],L[15]=P[15];return L}function f(L,P){c(L,P)||m(L);return L}function c(L,P){const fa=P[0],ka=P[1],qa=P[2],Q=P[3],X=P[4],Y=P[5],ia=P[6],na=P[7],O=P[8],da=P[9],la=P[10],pa=P[11],za=P[12],
Aa=P[13],Ba=P[14];P=P[15];const Ga=fa*Y-ka*X,Da=fa*ia-qa*X,Ha=fa*na-Q*X,Fa=ka*ia-qa*Y,Ea=ka*na-Q*Y,Ka=qa*na-Q*ia,Ta=O*Aa-da*za,Xa=O*Ba-la*za,Sa=O*P-pa*za,Ma=da*Ba-la*Aa,Pa=da*P-pa*Aa,ua=la*P-pa*Ba;let Qa=Ga*ua-Da*Pa+Ha*Ma+Fa*Sa-Ea*Xa+Ka*Ta;if(!Qa)return null;Qa=1/Qa;L[0]=(Y*ua-ia*Pa+na*Ma)*Qa;L[1]=(qa*Pa-ka*ua-Q*Ma)*Qa;L[2]=(Aa*Ka-Ba*Ea+P*Fa)*Qa;L[3]=(la*Ea-da*Ka-pa*Fa)*Qa;L[4]=(ia*Sa-X*ua-na*Xa)*Qa;L[5]=(fa*ua-qa*Sa+Q*Xa)*Qa;L[6]=(Ba*Ha-za*Ka-P*Da)*Qa;L[7]=(O*Ka-la*Ha+pa*Da)*Qa;L[8]=(X*Pa-Y*Sa+na*
Ta)*Qa;L[9]=(ka*Sa-fa*Pa-Q*Ta)*Qa;L[10]=(za*Ea-Aa*Ha+P*Ga)*Qa;L[11]=(da*Ha-O*Ea-pa*Ga)*Qa;L[12]=(Y*Xa-X*Ma-ia*Ta)*Qa;L[13]=(fa*Ma-ka*Xa+qa*Ta)*Qa;L[14]=(Aa*Da-za*Fa-Ba*Ga)*Qa;L[15]=(O*Fa-da*Da+la*Ga)*Qa;return L}function h(L,P){const fa=P[0],ka=P[1],qa=P[2],Q=P[3],X=P[4],Y=P[5],ia=P[6],na=P[7],O=P[8],da=P[9],la=P[10],pa=P[11],za=P[12],Aa=P[13],Ba=P[14];P=P[15];L[0]=Y*(la*P-pa*Ba)-da*(ia*P-na*Ba)+Aa*(ia*pa-na*la);L[1]=-(ka*(la*P-pa*Ba)-da*(qa*P-Q*Ba)+Aa*(qa*pa-Q*la));L[2]=ka*(ia*P-na*Ba)-Y*(qa*P-Q*
Ba)+Aa*(qa*na-Q*ia);L[3]=-(ka*(ia*pa-na*la)-Y*(qa*pa-Q*la)+da*(qa*na-Q*ia));L[4]=-(X*(la*P-pa*Ba)-O*(ia*P-na*Ba)+za*(ia*pa-na*la));L[5]=fa*(la*P-pa*Ba)-O*(qa*P-Q*Ba)+za*(qa*pa-Q*la);L[6]=-(fa*(ia*P-na*Ba)-X*(qa*P-Q*Ba)+za*(qa*na-Q*ia));L[7]=fa*(ia*pa-na*la)-X*(qa*pa-Q*la)+O*(qa*na-Q*ia);L[8]=X*(da*P-pa*Aa)-O*(Y*P-na*Aa)+za*(Y*pa-na*da);L[9]=-(fa*(da*P-pa*Aa)-O*(ka*P-Q*Aa)+za*(ka*pa-Q*da));L[10]=fa*(Y*P-na*Aa)-X*(ka*P-Q*Aa)+za*(ka*na-Q*Y);L[11]=-(fa*(Y*pa-na*da)-X*(ka*pa-Q*da)+O*(ka*na-Q*Y));L[12]=
-(X*(da*Ba-la*Aa)-O*(Y*Ba-ia*Aa)+za*(Y*la-ia*da));L[13]=fa*(da*Ba-la*Aa)-O*(ka*Ba-qa*Aa)+za*(ka*la-qa*da);L[14]=-(fa*(Y*Ba-ia*Aa)-X*(ka*Ba-qa*Aa)+za*(ka*ia-qa*Y));L[15]=fa*(Y*la-ia*da)-X*(ka*la-qa*da)+O*(ka*ia-qa*Y);return L}function n(L){const P=L[0],fa=L[1],ka=L[2],qa=L[3],Q=L[4],X=L[5],Y=L[6],ia=L[7],na=L[8],O=L[9],da=L[10],la=L[11],pa=L[12],za=L[13],Aa=L[14];L=L[15];return(P*X-fa*Q)*(da*L-la*Aa)-(P*Y-ka*Q)*(O*L-la*za)+(P*ia-qa*Q)*(O*Aa-da*za)+(fa*Y-ka*X)*(na*L-la*pa)-(fa*ia-qa*X)*(na*Aa-da*pa)+
(ka*ia-qa*Y)*(na*za-O*pa)}function d(L,P,fa){const ka=P[0],qa=P[1],Q=P[2],X=P[3],Y=P[4],ia=P[5],na=P[6],O=P[7],da=P[8],la=P[9],pa=P[10],za=P[11],Aa=P[12],Ba=P[13],Ga=P[14];P=P[15];let Da=fa[0],Ha=fa[1],Fa=fa[2],Ea=fa[3];L[0]=Da*ka+Ha*Y+Fa*da+Ea*Aa;L[1]=Da*qa+Ha*ia+Fa*la+Ea*Ba;L[2]=Da*Q+Ha*na+Fa*pa+Ea*Ga;L[3]=Da*X+Ha*O+Fa*za+Ea*P;Da=fa[4];Ha=fa[5];Fa=fa[6];Ea=fa[7];L[4]=Da*ka+Ha*Y+Fa*da+Ea*Aa;L[5]=Da*qa+Ha*ia+Fa*la+Ea*Ba;L[6]=Da*Q+Ha*na+Fa*pa+Ea*Ga;L[7]=Da*X+Ha*O+Fa*za+Ea*P;Da=fa[8];Ha=fa[9];Fa=fa[10];
Ea=fa[11];L[8]=Da*ka+Ha*Y+Fa*da+Ea*Aa;L[9]=Da*qa+Ha*ia+Fa*la+Ea*Ba;L[10]=Da*Q+Ha*na+Fa*pa+Ea*Ga;L[11]=Da*X+Ha*O+Fa*za+Ea*P;Da=fa[12];Ha=fa[13];Fa=fa[14];Ea=fa[15];L[12]=Da*ka+Ha*Y+Fa*da+Ea*Aa;L[13]=Da*qa+Ha*ia+Fa*la+Ea*Ba;L[14]=Da*Q+Ha*na+Fa*pa+Ea*Ga;L[15]=Da*X+Ha*O+Fa*za+Ea*P;return L}function w(L,P,fa){const ka=fa[0],qa=fa[1];fa=fa[2];if(P===L)L[12]=P[0]*ka+P[4]*qa+P[8]*fa+P[12],L[13]=P[1]*ka+P[5]*qa+P[9]*fa+P[13],L[14]=P[2]*ka+P[6]*qa+P[10]*fa+P[14],L[15]=P[3]*ka+P[7]*qa+P[11]*fa+P[15];else{const Q=
P[0],X=P[1],Y=P[2],ia=P[3],na=P[4],O=P[5],da=P[6],la=P[7],pa=P[8],za=P[9],Aa=P[10],Ba=P[11];L[0]=Q;L[1]=X;L[2]=Y;L[3]=ia;L[4]=na;L[5]=O;L[6]=da;L[7]=la;L[8]=pa;L[9]=za;L[10]=Aa;L[11]=Ba;L[12]=Q*ka+na*qa+pa*fa+P[12];L[13]=X*ka+O*qa+za*fa+P[13];L[14]=Y*ka+da*qa+Aa*fa+P[14];L[15]=ia*ka+la*qa+Ba*fa+P[15]}return L}function t(L,P,fa){const ka=fa[0],qa=fa[1];fa=fa[2];L[0]=P[0]*ka;L[1]=P[1]*ka;L[2]=P[2]*ka;L[3]=P[3]*ka;L[4]=P[4]*qa;L[5]=P[5]*qa;L[6]=P[6]*qa;L[7]=P[7]*qa;L[8]=P[8]*fa;L[9]=P[9]*fa;L[10]=P[10]*
fa;L[11]=P[11]*fa;L[12]=P[12];L[13]=P[13];L[14]=P[14];L[15]=P[15];return L}function l(L,P,fa,ka){let qa=ka[0],Q=ka[1];ka=ka[2];let X=Math.sqrt(qa*qa+Q*Q+ka*ka);var Y=void 0,ia=void 0;let na=void 0,O=void 0,da=void 0,la=void 0,pa=void 0,za=void 0,Aa=void 0,Ba=void 0,Ga=void 0,Da=void 0,Ha=void 0,Fa=void 0,Ea=void 0,Ka=void 0,Ta=void 0,Xa=void 0,Sa=void 0,Ma=void 0,Pa=void 0,ua=void 0;ia=Y=void 0;if(X<r.getEpsilon())return null;X=1/X;qa*=X;Q*=X;ka*=X;Y=Math.sin(fa);ia=Math.cos(fa);na=1-ia;O=P[0];da=
P[1];la=P[2];pa=P[3];za=P[4];Aa=P[5];Ba=P[6];Ga=P[7];Da=P[8];Ha=P[9];Fa=P[10];Ea=P[11];Ka=qa*qa*na+ia;Ta=Q*qa*na+ka*Y;Xa=ka*qa*na-Q*Y;Sa=qa*Q*na-ka*Y;Ma=Q*Q*na+ia;Pa=ka*Q*na+qa*Y;ua=qa*ka*na+Q*Y;Y=Q*ka*na-qa*Y;ia=ka*ka*na+ia;L[0]=O*Ka+za*Ta+Da*Xa;L[1]=da*Ka+Aa*Ta+Ha*Xa;L[2]=la*Ka+Ba*Ta+Fa*Xa;L[3]=pa*Ka+Ga*Ta+Ea*Xa;L[4]=O*Sa+za*Ma+Da*Pa;L[5]=da*Sa+Aa*Ma+Ha*Pa;L[6]=la*Sa+Ba*Ma+Fa*Pa;L[7]=pa*Sa+Ga*Ma+Ea*Pa;L[8]=O*ua+za*Y+Da*ia;L[9]=da*ua+Aa*Y+Ha*ia;L[10]=la*ua+Ba*Y+Fa*ia;L[11]=pa*ua+Ga*Y+Ea*ia;P!==L&&
(L[12]=P[12],L[13]=P[13],L[14]=P[14],L[15]=P[15]);return L}function e(L,P,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=P[4],Q=P[5],X=P[6],Y=P[7],ia=P[8],na=P[9],O=P[10],da=P[11];P!==L&&(L[0]=P[0],L[1]=P[1],L[2]=P[2],L[3]=P[3],L[12]=P[12],L[13]=P[13],L[14]=P[14],L[15]=P[15]);L[4]=qa*fa+ia*ka;L[5]=Q*fa+na*ka;L[6]=X*fa+O*ka;L[7]=Y*fa+da*ka;L[8]=ia*fa-qa*ka;L[9]=na*fa-Q*ka;L[10]=O*fa-X*ka;L[11]=da*fa-Y*ka;return L}function u(L,P,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=P[0],Q=P[1],X=P[2],
Y=P[3],ia=P[8],na=P[9],O=P[10],da=P[11];P!==L&&(L[4]=P[4],L[5]=P[5],L[6]=P[6],L[7]=P[7],L[12]=P[12],L[13]=P[13],L[14]=P[14],L[15]=P[15]);L[0]=qa*fa-ia*ka;L[1]=Q*fa-na*ka;L[2]=X*fa-O*ka;L[3]=Y*fa-da*ka;L[8]=qa*ka+ia*fa;L[9]=Q*ka+na*fa;L[10]=X*ka+O*fa;L[11]=Y*ka+da*fa;return L}function x(L,P,fa){const ka=Math.sin(fa);fa=Math.cos(fa);const qa=P[0],Q=P[1],X=P[2],Y=P[3],ia=P[4],na=P[5],O=P[6],da=P[7];P!==L&&(L[8]=P[8],L[9]=P[9],L[10]=P[10],L[11]=P[11],L[12]=P[12],L[13]=P[13],L[14]=P[14],L[15]=P[15]);L[0]=
qa*fa+ia*ka;L[1]=Q*fa+na*ka;L[2]=X*fa+O*ka;L[3]=Y*fa+da*ka;L[4]=ia*fa-qa*ka;L[5]=na*fa-Q*ka;L[6]=O*fa-X*ka;L[7]=da*fa-Y*ka;return L}function y(L,P){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=P[0];L[13]=P[1];L[14]=P[2];L[15]=1;return L}function A(L,P){L[0]=P[0];L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=P[1];L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=P[2];L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function k(L,P,fa){if(0===P)return m(L);let ka=fa[0],qa=fa[1];fa=
fa[2];let Q=Math.sqrt(ka*ka+qa*qa+fa*fa),X=void 0,Y=void 0,ia=void 0;if(Q<r.getEpsilon())return null;Q=1/Q;ka*=Q;qa*=Q;fa*=Q;X=Math.sin(P);Y=Math.cos(P);ia=1-Y;L[0]=ka*ka*ia+Y;L[1]=qa*ka*ia+fa*X;L[2]=fa*ka*ia-qa*X;L[3]=0;L[4]=ka*qa*ia-fa*X;L[5]=qa*qa*ia+Y;L[6]=fa*qa*ia+ka*X;L[7]=0;L[8]=ka*fa*ia+qa*X;L[9]=qa*fa*ia-ka*X;L[10]=fa*fa*ia+Y;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function v(L,P){const fa=Math.sin(P);P=Math.cos(P);L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=P;L[6]=fa;L[7]=0;L[8]=0;
L[9]=-fa;L[10]=P;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function B(L,P){const fa=Math.sin(P);P=Math.cos(P);L[0]=P;L[1]=0;L[2]=-fa;L[3]=0;L[4]=0;L[5]=1;L[6]=0;L[7]=0;L[8]=fa;L[9]=0;L[10]=P;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function z(L,P){const fa=Math.sin(P);P=Math.cos(P);L[0]=P;L[1]=fa;L[2]=0;L[3]=0;L[4]=-fa;L[5]=P;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=1;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function E(L,P,fa){var ka=P[0],qa=P[1],Q=P[2],X=P[3],Y=ka+ka,ia=qa+qa;const na=
Q+Q;P=ka*Y;const O=ka*ia;ka*=na;const da=qa*ia;qa*=na;Q*=na;Y*=X;ia*=X;X*=na;L[0]=1-(da+Q);L[1]=O+X;L[2]=ka-ia;L[3]=0;L[4]=O-X;L[5]=1-(P+Q);L[6]=qa+Y;L[7]=0;L[8]=ka+ia;L[9]=qa-Y;L[10]=1-(P+da);L[11]=0;L[12]=fa[0];L[13]=fa[1];L[14]=fa[2];L[15]=1;return L}function K(L,P){const fa=xa,ka=-P[0],qa=-P[1],Q=-P[2],X=P[3],Y=P[4],ia=P[5],na=P[6],O=P[7],da=ka*ka+qa*qa+Q*Q+X*X;0<da?(fa[0]=2*(Y*X+O*ka+ia*Q-na*qa)/da,fa[1]=2*(ia*X+O*qa+na*ka-Y*Q)/da,fa[2]=2*(na*X+O*Q+Y*qa-ia*ka)/da):(fa[0]=2*(Y*X+O*ka+ia*Q-na*
qa),fa[1]=2*(ia*X+O*qa+na*ka-Y*Q),fa[2]=2*(na*X+O*Q+Y*qa-ia*ka));E(L,P,fa);return L}function I(L,P){L[0]=P[12];L[1]=P[13];L[2]=P[14];return L}function D(L,P){const fa=P[0],ka=P[1],qa=P[2],Q=P[4],X=P[5],Y=P[6],ia=P[8],na=P[9];P=P[10];L[0]=Math.sqrt(fa*fa+ka*ka+qa*qa);L[1]=Math.sqrt(Q*Q+X*X+Y*Y);L[2]=Math.sqrt(ia*ia+na*na+P*P);return L}function G(L,P){const fa=P[0]+P[5]+P[10];let ka=0;0<fa?(ka=2*Math.sqrt(fa+1),L[3]=.25*ka,L[0]=(P[6]-P[9])/ka,L[1]=(P[8]-P[2])/ka,L[2]=(P[1]-P[4])/ka):P[0]>P[5]&&P[0]>
P[10]?(ka=2*Math.sqrt(1+P[0]-P[5]-P[10]),L[3]=(P[6]-P[9])/ka,L[0]=.25*ka,L[1]=(P[1]+P[4])/ka,L[2]=(P[8]+P[2])/ka):P[5]>P[10]?(ka=2*Math.sqrt(1+P[5]-P[0]-P[10]),L[3]=(P[8]-P[2])/ka,L[0]=(P[1]+P[4])/ka,L[1]=.25*ka,L[2]=(P[6]+P[9])/ka):(ka=2*Math.sqrt(1+P[10]-P[0]-P[5]),L[3]=(P[1]-P[4])/ka,L[0]=(P[8]+P[2])/ka,L[1]=(P[6]+P[9])/ka,L[2]=.25*ka);return L}function C(L,P,fa,ka){var qa=P[0],Q=P[1],X=P[2],Y=P[3],ia=qa+qa,na=Q+Q,O=X+X;P=qa*ia;const da=qa*na;qa*=O;const la=Q*na;Q*=O;X*=O;ia*=Y;na*=Y;Y*=O;O=ka[0];
const pa=ka[1];ka=ka[2];L[0]=(1-(la+X))*O;L[1]=(da+Y)*O;L[2]=(qa-na)*O;L[3]=0;L[4]=(da-Y)*pa;L[5]=(1-(P+X))*pa;L[6]=(Q+ia)*pa;L[7]=0;L[8]=(qa+na)*ka;L[9]=(Q-ia)*ka;L[10]=(1-(P+la))*ka;L[11]=0;L[12]=fa[0];L[13]=fa[1];L[14]=fa[2];L[15]=1;return L}function F(L,P,fa,ka,qa){var Q=P[0],X=P[1],Y=P[2],ia=P[3],na=Q+Q,O=X+X,da=Y+Y;P=Q*na;var la=Q*O,pa=Q*da;Q=X*O;X*=da;var za=Y*da;Y=ia*na;O*=ia;const Aa=ia*da;var Ba=ka[0],Ga=ka[1];da=ka[2];ka=qa[0];ia=qa[1];qa=qa[2];na=(1-(Q+za))*Ba;const Da=(la+Aa)*Ba;Ba*=
pa-O;la=(la-Aa)*Ga;za=(1-(P+za))*Ga;Ga*=X+Y;pa=(pa+O)*da;X=(X-Y)*da;P=(1-(P+Q))*da;L[0]=na;L[1]=Da;L[2]=Ba;L[3]=0;L[4]=la;L[5]=za;L[6]=Ga;L[7]=0;L[8]=pa;L[9]=X;L[10]=P;L[11]=0;L[12]=fa[0]+ka-(na*ka+la*ia+pa*qa);L[13]=fa[1]+ia-(Da*ka+za*ia+X*qa);L[14]=fa[2]+qa-(Ba*ka+Ga*ia+P*qa);L[15]=1;return L}function J(L,P){var fa=P[0],ka=P[1],qa=P[2];P=P[3];var Q=fa+fa,X=ka+ka;const Y=qa+qa;fa*=Q;const ia=ka*Q;ka*=X;const na=qa*Q,O=qa*X;qa*=Y;Q*=P;X*=P;P*=Y;L[0]=1-ka-qa;L[1]=ia+P;L[2]=na-X;L[3]=0;L[4]=ia-P;L[5]=
1-fa-qa;L[6]=O+Q;L[7]=0;L[8]=na+X;L[9]=O-Q;L[10]=1-fa-ka;L[11]=0;L[12]=0;L[13]=0;L[14]=0;L[15]=1;return L}function T(L,P,fa,ka,qa,Q,X){const Y=1/(fa-P),ia=1/(qa-ka),na=1/(Q-X);L[0]=2*Q*Y;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=2*Q*ia;L[6]=0;L[7]=0;L[8]=(fa+P)*Y;L[9]=(qa+ka)*ia;L[10]=(X+Q)*na;L[11]=-1;L[12]=0;L[13]=0;L[14]=X*Q*2*na;L[15]=0;return L}function S(L,P,fa,ka,qa){P=1/Math.tan(P/2);let Q=void 0;L[0]=P/fa;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=P;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[11]=-1;L[12]=0;L[13]=0;L[15]=
0;null!=qa&&Infinity!==qa?(Q=1/(ka-qa),L[10]=(qa+ka)*Q,L[14]=2*qa*ka*Q):(L[10]=-1,L[14]=-2*ka);return L}function ba(L,P,fa,ka){const qa=Math.tan(P.upDegrees*Math.PI/180),Q=Math.tan(P.downDegrees*Math.PI/180),X=Math.tan(P.leftDegrees*Math.PI/180);P=Math.tan(P.rightDegrees*Math.PI/180);const Y=2/(X+P),ia=2/(qa+Q);L[0]=Y;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=ia;L[6]=0;L[7]=0;L[8]=-((X-P)*Y*.5);L[9]=(qa-Q)*ia*.5;L[10]=ka/(fa-ka);L[11]=-1;L[12]=0;L[13]=0;L[14]=ka*fa/(fa-ka);L[15]=0;return L}function M(L,P,
fa,ka,qa,Q,X){const Y=1/(P-fa),ia=1/(ka-qa),na=1/(Q-X);L[0]=-2*Y;L[1]=0;L[2]=0;L[3]=0;L[4]=0;L[5]=-2*ia;L[6]=0;L[7]=0;L[8]=0;L[9]=0;L[10]=2*na;L[11]=0;L[12]=(P+fa)*Y;L[13]=(qa+ka)*ia;L[14]=(X+Q)*na;L[15]=1;return L}function U(L,P,fa,ka){const qa=P[0],Q=P[1];P=P[2];let X=qa-fa[0],Y=Q-fa[1];fa=P-fa[2];var ia=r.getEpsilon();if(Math.abs(X)<ia&&Math.abs(Y)<ia&&Math.abs(fa)<ia)m(L);else{var na=1/Math.sqrt(X*X+Y*Y+fa*fa);X*=na;Y*=na;fa*=na;na=ka[0];var O=ka[1];ia=ka[2];ka=O*fa-ia*Y;ia=ia*X-na*fa;O=na*Y-
O*X;(na=Math.sqrt(ka*ka+ia*ia+O*O))?(na=1/na,ka*=na,ia*=na,O*=na):O=ia=ka=0;var da=Y*O-fa*ia,la=fa*ka-X*O,pa=X*ia-Y*ka;(na=Math.sqrt(da*da+la*la+pa*pa))?(na=1/na,da*=na,la*=na,pa*=na):pa=la=da=0;L[0]=ka;L[1]=da;L[2]=X;L[3]=0;L[4]=ia;L[5]=la;L[6]=Y;L[7]=0;L[8]=O;L[9]=pa;L[10]=fa;L[11]=0;L[12]=-(ka*qa+ia*Q+O*P);L[13]=-(da*qa+la*Q+pa*P);L[14]=-(X*qa+Y*Q+fa*P);L[15]=1}}function R(L,P,fa,ka){const qa=P[0],Q=P[1];P=P[2];var X=ka[0];const Y=ka[1];var ia=ka[2];ka=qa-fa[0];let na=Q-fa[1];fa=P-fa[2];let O=
ka*ka+na*na+fa*fa;0<O&&(O=1/Math.sqrt(O),ka*=O,na*=O,fa*=O);let da=Y*fa-ia*na;ia=ia*ka-X*fa;X=X*na-Y*ka;O=da*da+ia*ia+X*X;0<O&&(O=1/Math.sqrt(O),da*=O,ia*=O,X*=O);L[0]=da;L[1]=ia;L[2]=X;L[3]=0;L[4]=na*X-fa*ia;L[5]=fa*da-ka*X;L[6]=ka*ia-na*da;L[7]=0;L[8]=ka;L[9]=na;L[10]=fa;L[11]=0;L[12]=qa;L[13]=Q;L[14]=P;L[15]=1;return L}function Z(L){return"mat4("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+", "+L[9]+", "+L[10]+", "+L[11]+", "+L[12]+", "+L[13]+", "+L[14]+
", "+L[15]+")"}function ea(L){return Math.sqrt(L[0]**2+L[1]**2+L[2]**2+L[3]**2+L[4]**2+L[5]**2+L[6]**2+L[7]**2+L[8]**2+L[9]**2+L[10]**2+L[11]**2+L[12]**2+L[13]**2+L[14]**2+L[15]**2)}function ma(L,P,fa){L[0]=P[0]+fa[0];L[1]=P[1]+fa[1];L[2]=P[2]+fa[2];L[3]=P[3]+fa[3];L[4]=P[4]+fa[4];L[5]=P[5]+fa[5];L[6]=P[6]+fa[6];L[7]=P[7]+fa[7];L[8]=P[8]+fa[8];L[9]=P[9]+fa[9];L[10]=P[10]+fa[10];L[11]=P[11]+fa[11];L[12]=P[12]+fa[12];L[13]=P[13]+fa[13];L[14]=P[14]+fa[14];L[15]=P[15]+fa[15];return L}function V(L,P,fa){L[0]=
P[0]-fa[0];L[1]=P[1]-fa[1];L[2]=P[2]-fa[2];L[3]=P[3]-fa[3];L[4]=P[4]-fa[4];L[5]=P[5]-fa[5];L[6]=P[6]-fa[6];L[7]=P[7]-fa[7];L[8]=P[8]-fa[8];L[9]=P[9]-fa[9];L[10]=P[10]-fa[10];L[11]=P[11]-fa[11];L[12]=P[12]-fa[12];L[13]=P[13]-fa[13];L[14]=P[14]-fa[14];L[15]=P[15]-fa[15];return L}function aa(L,P,fa){L[0]=P[0]*fa;L[1]=P[1]*fa;L[2]=P[2]*fa;L[3]=P[3]*fa;L[4]=P[4]*fa;L[5]=P[5]*fa;L[6]=P[6]*fa;L[7]=P[7]*fa;L[8]=P[8]*fa;L[9]=P[9]*fa;L[10]=P[10]*fa;L[11]=P[11]*fa;L[12]=P[12]*fa;L[13]=P[13]*fa;L[14]=P[14]*fa;
L[15]=P[15]*fa;return L}function ja(L,P,fa,ka){L[0]=P[0]+fa[0]*ka;L[1]=P[1]+fa[1]*ka;L[2]=P[2]+fa[2]*ka;L[3]=P[3]+fa[3]*ka;L[4]=P[4]+fa[4]*ka;L[5]=P[5]+fa[5]*ka;L[6]=P[6]+fa[6]*ka;L[7]=P[7]+fa[7]*ka;L[8]=P[8]+fa[8]*ka;L[9]=P[9]+fa[9]*ka;L[10]=P[10]+fa[10]*ka;L[11]=P[11]+fa[11]*ka;L[12]=P[12]+fa[12]*ka;L[13]=P[13]+fa[13]*ka;L[14]=P[14]+fa[14]*ka;L[15]=P[15]+fa[15]*ka;return L}function oa(L,P){return L[0]===P[0]&&L[1]===P[1]&&L[2]===P[2]&&L[3]===P[3]&&L[4]===P[4]&&L[5]===P[5]&&L[6]===P[6]&&L[7]===P[7]&&
L[8]===P[8]&&L[9]===P[9]&&L[10]===P[10]&&L[11]===P[11]&&L[12]===P[12]&&L[13]===P[13]&&L[14]===P[14]&&L[15]===P[15]}function wa(L,P){if(L===P)return!0;const fa=L[0],ka=L[1],qa=L[2],Q=L[3],X=L[4],Y=L[5],ia=L[6],na=L[7],O=L[8],da=L[9],la=L[10],pa=L[11],za=L[12],Aa=L[13],Ba=L[14];L=L[15];const Ga=P[0],Da=P[1],Ha=P[2],Fa=P[3],Ea=P[4],Ka=P[5],Ta=P[6],Xa=P[7],Sa=P[8],Ma=P[9],Pa=P[10],ua=P[11],Qa=P[12],bb=P[13],lb=P[14];P=P[15];const H=r.getEpsilon();return Math.abs(fa-Ga)<=H*Math.max(1,Math.abs(fa),Math.abs(Ga))&&
Math.abs(ka-Da)<=H*Math.max(1,Math.abs(ka),Math.abs(Da))&&Math.abs(qa-Ha)<=H*Math.max(1,Math.abs(qa),Math.abs(Ha))&&Math.abs(Q-Fa)<=H*Math.max(1,Math.abs(Q),Math.abs(Fa))&&Math.abs(X-Ea)<=H*Math.max(1,Math.abs(X),Math.abs(Ea))&&Math.abs(Y-Ka)<=H*Math.max(1,Math.abs(Y),Math.abs(Ka))&&Math.abs(ia-Ta)<=H*Math.max(1,Math.abs(ia),Math.abs(Ta))&&Math.abs(na-Xa)<=H*Math.max(1,Math.abs(na),Math.abs(Xa))&&Math.abs(O-Sa)<=H*Math.max(1,Math.abs(O),Math.abs(Sa))&&Math.abs(da-Ma)<=H*Math.max(1,Math.abs(da),Math.abs(Ma))&&
Math.abs(la-Pa)<=H*Math.max(1,Math.abs(la),Math.abs(Pa))&&Math.abs(pa-ua)<=H*Math.max(1,Math.abs(pa),Math.abs(ua))&&Math.abs(za-Qa)<=H*Math.max(1,Math.abs(za),Math.abs(Qa))&&Math.abs(Aa-bb)<=H*Math.max(1,Math.abs(Aa),Math.abs(bb))&&Math.abs(Ba-lb)<=H*Math.max(1,Math.abs(Ba),Math.abs(lb))&&Math.abs(L-P)<=H*Math.max(1,Math.abs(L),Math.abs(P))}function ta(L){const P=r.getEpsilon(),fa=L[0],ka=L[1],qa=L[2],Q=L[4],X=L[5],Y=L[6],ia=L[8],na=L[9];L=L[10];return Math.abs(1-(fa*fa+Q*Q+ia*ia))<=P&&Math.abs(1-
(ka*ka+X*X+na*na))<=P&&Math.abs(1-(qa*qa+Y*Y+L*L))<=P}function va(L){return 1===L[0]&&0===L[1]&&0===L[2]&&0===L[4]&&1===L[5]&&0===L[6]&&0===L[8]&&0===L[9]&&1===L[10]}const xa=q.create();q=Object.freeze(Object.defineProperty({__proto__:null,add:ma,adjoint:h,copy:g,determinant:n,equals:wa,exactEquals:oa,frob:ea,fromQuat:J,fromQuat2:K,fromRotation:k,fromRotationTranslation:E,fromRotationTranslationScale:C,fromRotationTranslationScaleOrigin:F,fromScaling:A,fromTranslation:y,fromXRotation:v,fromYRotation:B,
fromZRotation:z,frustum:T,getRotation:G,getScaling:D,getTranslation:I,hasIdentityRotation:va,identity:m,invert:c,invertOrIdentity:f,isOrthoNormal:ta,lookAt:U,mul:d,multiply:d,multiplyScalar:aa,multiplyScalarAndAdd:ja,ortho:M,perspective:S,perspectiveFromFieldOfView:ba,rotate:l,rotateX:e,rotateY:u,rotateZ:x,scale:t,set:p,str:Z,sub:V,subtract:V,targetTo:R,translate:w,transpose:b},Symbol.toStringTag,{value:"Module"}));a.add=ma;a.adjoint=h;a.copy=g;a.determinant=n;a.equals=wa;a.exactEquals=oa;a.frob=
ea;a.fromQuat=J;a.fromQuat2=K;a.fromRotation=k;a.fromRotationTranslation=E;a.fromRotationTranslationScale=C;a.fromRotationTranslationScaleOrigin=F;a.fromScaling=A;a.fromTranslation=y;a.fromXRotation=v;a.fromYRotation=B;a.fromZRotation=z;a.frustum=T;a.getRotation=G;a.getScaling=D;a.getTranslation=I;a.hasIdentityRotation=va;a.identity=m;a.invert=c;a.invertOrIdentity=f;a.isOrthoNormal=ta;a.lookAt=U;a.mat4=q;a.mul=d;a.multiply=d;a.multiplyScalar=aa;a.multiplyScalarAndAdd=ja;a.ortho=M;a.perspective=S;
a.perspectiveFromFieldOfView=ba;a.rotate=l;a.rotateX=e;a.rotateY=u;a.rotateZ=x;a.scale=t;a.set=p;a.str=Z;a.sub=V;a.subtract=V;a.targetTo=R;a.translate=w;a.transpose=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,q,r){function g(C){return null==C||"string"===typeof C&&!C?"\x3cNull\x3e":C}function p(C){const F=null!=C.minValue||null!=C.maxValue,
J=!!C.sqlExpression&&C.supportsSQLExpression;return!(null!=C.normalizationField||null!=C.normalizationType)&&!F&&!J}function m(C){const {values:F,useSampleStdDev:J,supportsNullCount:T}=C;var S=Number.POSITIVE_INFINITY;let ba=Number.NEGATIVE_INFINITY,M=null,U=null;var R=null;let Z=null,ea=0;const ma=null==C.minValue?-Infinity:C.minValue,V=null==C.maxValue?Infinity:C.maxValue;for(const aa of F)Number.isFinite(aa)?aa>=ma&&aa<=V&&(M=null===M?aa:M+aa,S=Math.min(S,aa),ba=Math.max(ba,aa),ea++):"string"===
typeof aa&&ea++;if(ea&&null!=M){U=M/ea;R=0;for(const aa of F)Number.isFinite(aa)&&aa>=ma&&aa<=V&&(R+=(aa-U)**2);Z=J?1<ea?R/(ea-1):0:0<ea?R/ea:0;R=Math.sqrt(Z)}else ba=S=null;S={avg:U,count:ea,max:ba,min:S,stddev:R,sum:M,variance:Z};T&&(S.nullcount=F.length-ea);C.percentileParams&&(S.median=b(F,C.percentileParams));return S}function b(C,F){const {fieldType:J,value:T,orderBy:S,isDiscrete:ba}=F,M=f(J,"desc"===S);C=[...C].filter(ea=>null!=ea).sort((ea,ma)=>M(ea,ma));if(0===C.length)return null;if(0>=
T)return C[0];if(1<=T)return C[C.length-1];var U=(C.length-1)*T,R=Math.floor(U);F=R+1;U%=1;R=C[R];const Z=C[F];return F>=C.length||ba||"string"===typeof R||"string"===typeof Z?R:R*(1-U)+Z*U}function f(C,F){if(C){if(y.has(C))return F?D:G;if(A.has(C))return c(F,!1);if("esriFieldTypeTimestampOffset"===C)return F?E:z;const ba=c(F,!0);if("esriFieldTypeString"===C)return ba;if("esriFieldTypeGUID"===C||"esriFieldTypeGlobalID"===C)return(M,U)=>ba(h(M),h(U))}const J=F?1:-1,T=F?D:G,S=c(F,!0);return(ba,M)=>
"number"===typeof ba&&"number"===typeof M?T(ba,M):"string"===typeof ba&&"string"===typeof M?S(ba,M):J}function c(C,F){if(!F)return C?I:K;const J=C?v:B;return C?(T,S)=>{const ba=J(T,S);if(null!=ba)return ba;T=T.toUpperCase();S=S.toUpperCase();return T>S?-1:T<S?1:0}:(T,S)=>{const ba=J(T,S);if(null!=ba)return ba;T=T.toUpperCase();S=S.toUpperCase();return T<S?-1:T>S?1:0}}function h(C){return C.substr(24,12)+C.substr(19,4)+C.substr(16,2)+C.substr(14,2)+C.substr(11,2)+C.substr(9,2)+C.substr(6,2)+C.substr(4,
2)+C.substr(2,2)+C.substr(0,2)}function n(C){return"coded-value"!==C?.type?[]:C.codedValues.map(F=>F.code)}function d(C,F){const J=t({field:F.field,normalizationType:F.normalizationType,normalizationField:F.normalizationField,classificationMethod:F.classificationMethod,standardDeviationInterval:F.standardDeviationInterval,breakCount:F.numClasses||5});C=w(C,F.minValue,F.maxValue);return r.createGenerateRendererClassBreaks({definition:J,values:C,normalizationTotal:F.normalizationTotal})}function w(C,
F,J){const T=null==F?-Infinity:F,S=null==J?Infinity:J;return C.filter(ba=>Number.isFinite(ba)&&ba>=T&&ba<=S)}function t(C){const {breakCount:F,field:J,normalizationField:T,normalizationType:S}=C,ba=C.classificationMethod||"equal-interval";return new q({breakCount:F,classificationField:J,classificationMethod:ba,normalizationField:"field"===S?T:void 0,normalizationType:S,standardDeviationInterval:"standard-deviation"===ba?C.standardDeviationInterval||1:void 0})}function l(C,F){const {field:J,classificationMethod:T,
standardDeviationInterval:S,normalizationType:ba,normalizationField:M,normalizationTotal:U,minValue:R,maxValue:Z}=F,ea=F.numBins||10;let ma=F=null,V=null;T&&"equal-interval"!==T||ba?({classBreaks:C}=d(C,{field:J,normalizationType:ba,normalizationField:M,normalizationTotal:U,classificationMethod:T,standardDeviationInterval:S,minValue:R,maxValue:Z,numClasses:ea}),F=C[0].minValue,ma=C[C.length-1].maxValue,V=C.map(aa=>[aa.minValue,aa.maxValue])):(null!=R&&null!=Z?(F=R,ma=Z):(C=m({values:C,minValue:R,
maxValue:Z,useSampleStdDev:!ba,supportsNullCount:p({normalizationType:ba,normalizationField:M,minValue:R,maxValue:Z})}),F=C.min??null,ma=C.max??null),V=u(F??0,ma??0,ea));return{min:F,max:ma,intervals:V}}function e(C,F){let J=-1;for(let T=C.length-1;0<=T;T--)if(F>=C[T][0]){J=T;break}return J}function u(C,F,J){const T=(F-C)/J,S=[];let ba;for(let M=1;M<=J;M++)ba=C+T,ba=Number(ba.toFixed(16)),S.push([C,M===J?F:ba]),C=ba;return S}const x=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,y=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
A=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),k="min max avg stddev count sum variance nullcount median".split(" "),v=(C,F)=>null==C?null==F?0:1:null==F?-1:null,B=(C,F)=>null==C?null==F?0:-1:null==F?1:null,z=(C,F)=>B(C,F)??(C===F?0:(new Date(C)).getTime()-(new Date(F)).getTime()),E=(C,F)=>v(C,F)??(C===F?0:(new Date(F)).getTime()-(new Date(C)).getTime()),K=(C,F)=>B(C,F)??(C===F?0:C<F?-1:1),I=(C,F)=>v(C,F)??(C===F?0:C<F?1:-1),D=(C,F)=>v(C,F)??F-C,G=(C,F)=>B(C,F)??C-F;a.calculateClassBreaks=
d;a.calculateHistogram=function(C,F){var J=l(C,F);if(null==J.min&&null==J.max)return{bins:[],minValue:J.min,maxValue:J.max,normalizationTotal:F.normalizationTotal};const T=J.intervals,S=J.min??0;J=J.max??0;const ba=T.map((M,U)=>({minValue:T[U][0],maxValue:T[U][1],count:0}));for(const M of C)null!=M&&M>=S&&M<=J&&(C=e(T,M),-1<C&&ba[C].count++);return{bins:ba,minValue:S,maxValue:J,normalizationTotal:F.normalizationTotal}};a.calculatePercentile=b;a.calculateStatistics=m;a.calculateStringStatistics=function(C){const F=
C.returnDistinct?[...(new Set(C.values))]:C.values;var J=F.filter(S=>null!=S).sort();const T=J.length;J={count:T,min:J[0],max:J[T-1]};C.supportsNullCount&&(J.nullcount=F.length-T);C.percentileParams&&(J.median=b(F,C.percentileParams));return J};a.calculateUniqueValuesCount=function(C){const F={};for(let J of C){if(null==J||"string"===typeof J&&""===J.trim())J=null;null==F[J]?F[J]={count:1,data:J}:F[J].count++}return{count:F}};a.createClassBreaksDefinition=t;a.createUVResult=function(C,F,J,T){C=C.count;
const S=[];if(J&&F){J=[];var ba=n(F[0]);for(const M of ba)if(F[1]){ba=n(F[1]);for(const U of ba)if(F[2]){ba=n(F[2]);for(const R of ba)J.push(`${g(M)}${T}${g(U)}${T}${g(R)}`)}else J.push(`${g(M)}${T}${g(U)}`)}else J.push(M);for(const M of J)C.hasOwnProperty(M)||(C[M]={data:M,count:0})}for(const M in C)F=C[M],S.push({value:F.data,count:F.count,label:F.label});return{uniqueValueInfos:S}};a.getAttributeComparator=f;a.getEqualIntervalBins=u;a.getNormalizedValue=function(C,F,J,T){let S=null;switch(F){case "log":0!==
C&&(S=Math.log(C)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(T)&&0!==T&&(S=C/T*100);break;case "field":Number.isFinite(J)&&0!==J&&(S=C/J);break;case "natural-log":0<C&&(S=Math.log(C));break;case "square-root":0<C&&(S=C**.5)}return S};a.isNullCountSupported=p;a.processNullValue=g;a.processSummaryStatisticsResult=function(C,F){let J;for(J in C)k.includes(J)&&(Number.isFinite(C[J])||(C[J]=null));if(!F)return C;["avg","stddev","variance"].forEach(T=>{null!=C[T]&&(C[T]=Math.ceil(C[T]??
0))});return C};a.resolveCBResult=function(C,F){let J=C.classBreaks;const T=J[0]?.minValue,S=J[J.length-1]?.maxValue,ba="standard-deviation"===F;J=J.map(M=>{const U=M.label;M={minValue:M.minValue,maxValue:M.maxValue,label:U};if(ba&&U){const R=U.match(x)?.map(Z=>+Z.trim())??[];2===R.length?(M.minStdDev=R[0],M.maxStdDev=R[1],0>R[0]&&0<R[1]&&(M.hasAvg=!0)):1===R.length&&(U.includes("\x3c")?(M.minStdDev=null,M.maxStdDev=R[0]):U.includes("\x3e")&&(M.minStdDev=R[0],M.maxStdDev=null))}return M});return{minValue:T,
maxValue:S,classBreakInfos:J,normalizationTotal:C.normalizationTotal}};a.statisticTypes=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
q,r,g,p,m,b,f,c){p=new q.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});q=new q.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});r=class extends r.JSONSupport{constructor(h){super(h);this.type="class-breaks-definition";this.normalizationType=
this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(h){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",h)}set definedInterval(h){"defined-interval"===this.classificationMethod&&this._set("definedInterval",h)}};a.__decorate([f.enumeration({classBreaksDef:"class-breaks-definition"})],r.prototype,"type",void 0);a.__decorate([g.property({json:{write:!0}})],r.prototype,"breakCount",void 0);
a.__decorate([g.property({json:{write:!0}})],r.prototype,"classificationField",void 0);a.__decorate([g.property({type:String,json:{read:p.read,write:p.write}})],r.prototype,"classificationMethod",void 0);a.__decorate([g.property({json:{write:!0}})],r.prototype,"normalizationField",void 0);a.__decorate([g.property({json:{read:q.read,write:q.write}})],r.prototype,"normalizationType",void 0);a.__decorate([g.property({value:null,json:{write:!0}})],r.prototype,"standardDeviationInterval",null);a.__decorate([g.property({value:null,
json:{write:!0}})],r.prototype,"definedInterval",null);return r=a.__decorate([c.subclass("esri.rest.support.ClassBreaksDefinition")],r)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,q){function r(d){var w=d.definition;const {classificationMethod:t,normalizationType:l,definedInterval:e}=w;w=w.breakCount??1;const u=[];var x=d.values;if(0===x.length)return[];x=x.sort((z,E)=>z-E);var y=x[0],A=x[x.length-1];if("equal-interval"===t)if(x.length>=
w){x=(A-y)/w;d=y;for(var k=1;k<w;k++){var v=Number((y+k*x).toFixed(6));u.push({minValue:d,maxValue:v,label:g(d,v,l)});d=v}u.push({minValue:d,maxValue:A,label:g(d,A,l)})}else x.forEach(z=>{u.push({minValue:z,maxValue:z,label:g(z,z,l)})});else if("natural-breaks"===t){x=p(x);d=m(x.uniqueValues,d.valueFrequency||x.valueFrequency,w);for(k=1;k<w;k++)x.uniqueValues.length>k&&(v=Number(x.uniqueValues[d[k]].toFixed(6)),u.push({minValue:y,maxValue:v,label:g(y,v,l)}),y=v);u.push({minValue:y,maxValue:A,label:g(y,
A,l)})}else if("quantile"===t)if(x.length>=w&&y!==A){d=Math.ceil(x.length/w);k=0;for(v=1;v<w;v++){var B=d+k-1;B>x.length&&(B=x.length-1);0>B&&(B=0);u.push({minValue:y,maxValue:x[B],label:g(y,x[B],l)});y=x[B];k+=d;d=Math.ceil((x.length-k)/(w-v))}u.push({minValue:y,maxValue:A,label:g(y,A,l)})}else for(w=-1,A=0;A<x.length;A++)y=x[A],y!==w&&(w=y,u.push({minValue:w,maxValue:y,label:g(w,y,l)}),w=y);else if("standard-deviation"===t)if(d=c(x),k=h(x,d),0===k)u.push({minValue:x[0],maxValue:x[0],label:g(x[0],
x[0],l)});else{x=f(y,A,w,d,k)*k;k=0;for(v=w;1<=v;v--)B=Number((d-(v-.5)*x).toFixed(6)),u.push({minValue:y,maxValue:B,label:g(y,B,l)}),y=B,k++;v=Number((d+.5*x).toFixed(6));u.push({minValue:y,maxValue:v,label:g(y,v,l)});y=v;k++;for(B=1;B<=w;B++)v=k===2*w?A:Number((d+(B+.5)*x).toFixed(6)),u.push({minValue:y,maxValue:v,label:g(y,v,l)}),y=v,k++}else if("defined-interval"===t){if(!e)return u;w=x[0];A=x[x.length-1];x=Math.ceil((A-w)/e);y=w;for(d=1;d<x;d++)k=Number((w+d*e).toFixed(6)),u.push({minValue:y,
maxValue:k,label:g(y,k,l)}),y=k;u.push({minValue:y,maxValue:A,label:g(y,A,l)})}return u}function g(d,w,t){let l=null;return l=d===w?t&&"percent-of-total"===t?d+"%":d.toString():t&&"percent-of-total"===t?d+"% - "+w+"%":d+" - "+w}function p(d){const w=[],t=[];let l=Number.MIN_VALUE,e=1,u=-1;for(let x=0;x<d.length;x++){const y=d[x];y===l?(e++,t[u]=e):null!==y&&(w.push(y),l=y,e=1,t.push(e),u++)}return{uniqueValues:w,valueFrequency:t}}function m(d,w,t){var l=d.length;const e=[];t>l&&(t=l);for(var u=0;u<
t;u++)e.push(Math.round(u*l/t-1));e.push(l-1);u=b(e,d,w,t);l=u.mean;u=u.sdcm;var x=t,y=0,A=0;let k=0,v=0,B=!0;for(let E=0;2>E&&B;E++){0===E&&(B=!1);for(var z=0;z<x-1;z++)for(;e[z+1]+1!==e[z+2];)if(e[z+1]+=1,y=n(z,e,d,w),k=y.sbMean,y=y.sbSdcm,A=n(z+1,e,d,w),v=A.sbMean,A=A.sbSdcm,y+A<u[z]+u[z+1])u[z]=y,u[z+1]=A,l[z]=k,l[z+1]=v,B=!0;else{--e[z+1];break}for(z=x-1;0<z;z--)for(;e[z]!==e[z-1]+1;)if(--e[z],y=n(z-1,e,d,w),k=y.sbMean,y=y.sbSdcm,A=n(z,e,d,w),v=A.sbMean,A=A.sbSdcm,y+A<u[z-1]+u[z])u[z-1]=y,u[z]=
A,l[z-1]=k,l[z]=v,B=!0;else{e[z]+=1;break}}B&&(u=b(e,d,w,t));return e}function b(d,w,t,l){let e=[];var u=[],x=[];let y=0;const A=[],k=[];for(var v=0;v<l;v++){var B=n(v,d,w,t);A.push(B.sbMean);k.push(B.sbSdcm);y+=k[v]}B=y;for(v=!0;v||y<B;){v=!1;e=[];for(u=0;u<l;u++)e.push(d[u]);for(x=0;x<l;x++)for(B=d[x]+1;B<=d[x+1];B++)if(u=w[B],0<x&&B!==d[x+1]&&Math.abs(u-A[x])>Math.abs(u-A[x-1]))d[x]=B;else if(x<l-1&&d[x]!==B-1&&Math.abs(u-A[x])>Math.abs(u-A[x+1])){d[x+1]=B-1;break}B=y;y=0;u=[];x=[];for(let z=0;z<
l;z++){u.push(A[z]);x.push(k[z]);const E=n(z,d,w,t);A[z]=E.sbMean;k[z]=E.sbSdcm;y+=k[z]}}if(y>B){for(w=0;w<l;w++)d[w]=e[w],A[w]=u[w],k[w]=x[w];y=B}return{mean:A,sdcm:k}}function f(d,w,t,l,e){d=Math.max(l-d,w-l)/e/t;return 1<=d?1:.5<=d?.5:.25}function c(d){let w=0;for(let t=0;t<d.length;t++)w+=d[t];return w/=d.length}function h(d,w){let t=0;for(let l=0;l<d.length;l++){const e=d[l];t+=(e-w)*(e-w)}t/=d.length;return Math.sqrt(t)}function n(d,w,t,l){var e=0,u=0;for(var x=w[d]+1;x<=w[d+1];x++){const y=
l[x];e+=t[x]*y;u+=y}0>=u&&q.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");e/=u;u=0;for(x=w[d]+1;x<=w[d+1];x++)u+=l[x]*(t[x]-e)**2;return{sbMean:e,sbSdcm:u}}a.createGenerateRendererClassBreaks=function(d){const {normalizationTotal:w}=d;return{classBreaks:r(d),normalizationTotal:w}};a.createGenerateRendererUniqueValues=function(d){d=p(d);const w=[],t=d.uniqueValues.length;for(let l=0;l<t;l++){const e=d.uniqueValues[l];w.push({value:e,count:d.valueFrequency[l],
label:e.toString()})}return{uniqueValues:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(q,r,g,p,m,b=!1){return{objectId:q,target:r,distance:g,type:"edge",start:p,end:m,draped:b}};a.makeVertexCandidate=function(q,r,g){return{objectId:q,target:r,distance:g,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(a,q,r,g,p,m,b,f,c,h){async function n(u,x,y){if(!u)return null;var {where:A}=u;u.where=A=A?.trim();if(!A||/^1 *= *1$/.test(A)||x&&x===A)u.where=null;if(!u.geometry)return u;x=await w(u);u.distance=0;u.units=null;"esriSpatialRelEnvelopeIntersects"===u.spatialRel&&({spatialReference:A}=u.geometry,x=m.getGeometryExtent(x),x.spatialReference=A);if(x){await h.checkProjectionSupport(x.spatialReference,y);A=x.spatialReference;x=d(x,y)&&b.isExtent(x)?{spatialReference:A,rings:[[[x.xmin,x.ymin],[x.xmin,
x.ymax],[x.xmax,x.ymax],[x.xmax,x.ymin],[x.xmin,x.ymin]]]}:x;A=(await f.normalizeCentralMeridian(b.fromJSON(x)))[0];if(null==A)throw e;const k="quantizationParameters"in u&&u.quantizationParameters?.tolerance||"maxAllowableOffset"in u&&u.maxAllowableOffset||0;x=k&&d(x,y)?{densificationStep:8*k}:void 0;A=A.toJSON();x=h.project(A,A.spatialReference,y,x);if(!x)throw e;x.spatialReference=y;u.geometry=x}return u}function d(u,x){if(!u)return!1;const y=u.spatialReference;return(b.isExtent(u)||b.isPolygon(u)||
b.isPolyline(u))&&!c.equals(y,x)&&!p.canProjectWithoutEngine(y,x)}async function w(u){const {distance:x,units:y}=u,A=u.geometry;if(null==x||"vertexAttributes"in A)return A;var k=A.spatialReference;u=y?l.fromJSON(y):g.getUnitString(k);k=k&&(c.isGeographic(k)||c.isWebMercator(k))?A:await h.checkProjectionSupport(k,c.wgs84).then(()=>h.project(A,c.wgs84));return(await t())(k.spatialReference,k,x,u)}async function t(){return(await new Promise((u,x)=>a(["../../../geometry/geometryEngineJSON"],u,x))).geodesicBuffer}
const l=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),e=Object.freeze({});q.normalizeQuery=async function(u,x,y){const {outFields:A,orderByFields:k,groupByFieldsForStatistics:v,outStatistics:B}=u;if(A)for(var z=0;z<A.length;z++)A[z]=A[z].trim();if(k)for(z=0;z<k.length;z++)k[z]=k[z].trim();if(v)for(z=0;z<v.length;z++)v[z]=v[z].trim();
if(B)for(z=0;z<B.length;z++)B[z].onStatisticField&&(B[z].onStatisticField=B[z].onStatisticField.trim());u.geometry&&!u.outSR&&(u.outSR=u.geometry.spatialReference);return n(u,x,y)};q.normalizeQueryLike=n;q.queryEngineEmptyResult=e;q.unitsKebabDict=l;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),
function(a,q,r,g,p,m){function b(d,w,t){const {outFields:l,orderByFields:e,returnDistinctValues:u,outStatistics:x}=t,y=x?x.map(A=>A.outStatisticFieldName&&A.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(e&&0<e.length){const A=e.map(k=>{const v=k.toLowerCase();return v.includes(" asc")?v.split(" asc")[0]:v.includes(" desc")?v.split(" desc")[0]:k}).filter(k=>!y.includes(k));r.validateFields(d,w,A,{expressionName:"orderByFields",query:t})}if(l&&0<l.length)r.validateFields(d,w,l,{expressionName:"outFields",
query:t,allowedFieldTypes:"all"});else if(u)throw new q("unsupported-query","outFields should be specified for returnDistinctValues",{query:t});r.validateWhere(d,w,t.where,t)}function f(d,w,t){const {outStatistics:l,groupByFieldsForStatistics:e,having:u}=t;var x=e?.length,y=l?.length;if(u){if(!x||!y)throw new q("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});r.validateHaving(d,w,u,l,t)}if(y&&h(l)){y=l.map(A=>A.onStatisticField).filter(Boolean);
r.validateFields(d,w,y,{expressionName:"onStatisticFields",query:t});x&&r.validateFields(d,w,e,{expressionName:"groupByFieldsForStatistics",query:t});for(const A of l){const {onStatisticField:k,statisticType:v}=A;if(("percentile_disc"===v||"percentile_cont"===v)&&"statisticParameters"in A){if({statisticParameters:x}=A,!x)throw new q("unsupported-query","statisticParameters should be set for percentile type",{definition:A,query:t});}else d.get(k)&&"count"!==v&&"min"!==v&&"max"!==v&&r.validateFields(d,
w,[k],{expressionName:`outStatistics with '${v}' statistic type`,allowedFieldTypes:n,query:t})}}}async function c(d,w,t,l){var e=[];t.valueExpression&&({arcadeUtils:e}=await m.loadArcade(),e=e.extractFieldNames(t.valueExpression));t.field&&e.push(t.field);t.field2&&e.push(t.field2);t.field3&&e.push(t.field3);t.normalizationField&&e.push(t.normalizationField);if(!e.length&&!t.valueExpression)throw new q("unsupported-query","field or valueExpression is required",{params:t});r.validateFields(d,w,e,{expressionName:"statistics",
query:l})}function h(d){return null!=d&&d.every(w=>"exceedslimit"!==w.statisticType)}const n=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);a.validateQuery=async function(d,{fieldsIndex:w,geometryType:t,spatialReference:l,availableFields:e}){if(0>(d.distance??0)||null!=d.geometryPrecision||d.multipatchOption&&"xyFootprint"!==d.multipatchOption||d.pixelSize||d.relationParam||d.text)throw new q("unsupported-query","Unsupported query options",{query:d});b(w,e,d);f(w,e,d);return Promise.all([p.checkSpatialQuerySupport(d,
t,l),g.checkProjectionSupport(l,d.outSR)]).then(()=>d)};a.validateStatisticsQuery=async function(d,w,{fieldsIndex:t,geometryType:l,spatialReference:e,availableFields:u}){if(0>(d.distance??0)||null!=d.geometryPrecision||d.multipatchOption||d.pixelSize||d.relationParam||d.text||d.outStatistics||d.groupByFieldsForStatistics||d.having||d.orderByFields)throw new q("unsupported-query","Unsupported query options",{query:d});b(t,u,d);return Promise.all([c(t,u,w,d),p.checkSpatialQuerySupport(d,l,e),g.checkProjectionSupport(e,
d.outSR)]).then(()=>d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,q,r,g,p,m,b,f,c,h,n,d){function w(){return new Promise((x,
y)=>a(["../../../geometry/geometryEngineJSON"],x,y))}const t={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var l={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,
esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},e={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},u={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};q.canQueryWithRBush=function(x){if(m.isExtent(x))return!0;if(m.isPolygon(x)){for(const y of x.rings)if(5!==
y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};q.checkSpatialQuerySupport=async function(x,y,A){const {spatialRel:k,geometry:v}=x;if(v){if(null==k||!0!==l[k])throw new r("unsupported-query","Unsupported query spatial relationship",{query:x});if(b.isValid(v.spatialReference)&&b.isValid(A)){if(null==v||!0!==e[m.getJsonType(v)])throw new r("unsupported-query","Unsupported query geometry type",{query:x});
if(null==y||!0!==u[y])throw new r("unsupported-query","Unsupported layer geometry type",{query:x});if(x.outSR)return d.checkProjectionSupport(x.geometry?.spatialReference,x.outSR)}}};q.getSpatialQueryOperator=function(x,y,A,k,v){if(m.isPolygon(y)&&"esriGeometryPoint"===A&&("esriSpatialRelIntersects"===x||"esriSpatialRelContains"===x)){const B=c.convertFromPolygon(new h,y,!1,!1);return Promise.resolve(z=>f.polygonContainsPoint(B,!1,!1,z))}if(m.isPolygon(y)&&"esriGeometryMultipoint"===A){const B=c.convertFromPolygon(new h,
y,!1,!1);if("esriSpatialRelContains"===x)return Promise.resolve(z=>f.polygonContainsMultipoint(B,!1,!1,z,k,v))}if(m.isExtent(y)&&"esriGeometryPoint"===A&&("esriSpatialRelIntersects"===x||"esriSpatialRelContains"===x))return Promise.resolve(B=>g.extentContainsPoint(y,n.getGeometry(A,k,v,B)));if(m.isExtent(y)&&"esriGeometryMultipoint"===A&&"esriSpatialRelContains"===x)return Promise.resolve(B=>g.extentContainsMultipoint(y,n.getGeometry(A,k,v,B)));if(m.isExtent(y)&&"esriSpatialRelIntersects"===x){const B=
p.getExtentIntersector(A);return Promise.resolve(z=>B(y,n.getGeometry(A,k,v,z)))}return w().then(B=>{const z=B[t[x]].bind(null,y.spatialReference,y);return E=>z(n.getGeometry(A,k,v,E))})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,q){a.extentIntersectsExtent=q.extentIntersectsExtent;a.extentIntersectsMultipoint=q.extentIntersectsMultipoint;a.extentIntersectsPoint=q.extentIntersectsPoint;
a.extentIntersectsPolygon=q.extentIntersectsPolygon;a.extentIntersectsPolyline=q.extentIntersectsPolyline;a.getFeatureExtentIntersector=q.getFeatureExtentIntersector;a.isSelfIntersecting=q.isSelfIntersecting;a.segmentIntersects=q.segmentIntersects;a.getExtentIntersector=function(r){return"mesh"===r?q.extentIntersectsExtent:q.getFeatureExtentIntersector(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function q(r,
g,p,m,b){if(!r)return!1;g=g?p?4:3:p?3:2;const {coords:f,lengths:c}=r;p=!1;r=0;for(const n of c){var h=r;for(let d=r,w=r+n*g;d<w;d+=g){h=d+g;h===w&&(h=r);const t=f[d],l=f[d+1],e=f[h];h=f[h+1];(l<b&&h>=b||h<b&&l>=b)&&t+(b-l)/(h-l)*(e-t)<m&&(p=!p)}r+=n*g}return p}a.polygonContainsCoords=q;a.polygonContainsMultipoint=function(r,g,p,m,b,f){b=b?f?4:3:f?3:2;const {coords:c,lengths:h}=m;if(!h)return!1;for(let n=0,d=0;n<h.length;n++,d+=b)if(!q(r,g,p,c[d],c[d+1]))return!1;return!0};a.polygonContainsPoint=function(r,
g,p,m){return q(r,g,p,m.coords[0],m.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function q(p,m,b,f,c){if(null!=f&&null!=c)return h=>{const n=p(h,m);h=p(h,b);return(null==n||n<=c)&&(null==h||h>=f)};if(null!=f)return h=>{h=p(h,b);return null==h||h>=f};if(null!=c)return h=>{h=p(h,m);return null==h||h<=c}}function r(p,m,b,f){if(null!=b&&null!=f&&b===f)return c=>p(c,m)===b;if(null!=b&&null!=
f)return c=>{c=p(c,m);return null!=c&&c>=b&&c<=f};if(null!=b)return c=>{c=p(c,m);return null!=c&&c>=b};if(null!=f)return c=>{c=p(c,m);return null!=c&&c<=f}}function g(){return()=>!1}a.getTimeExtent=async function(p,m){if(!p)return null;const b=m.featureAdapter,{startTimeField:f,endTimeField:c}=p;let h=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(f&&c)await m.forEach(d=>{const w=b.getAttribute(d,f);d=b.getAttribute(d,c);null==w||isNaN(w)||(h=Math.min(h,w));null==d||isNaN(d)||(n=Math.max(n,
d))});else{const d=f||c;await m.forEach(w=>{w=b.getAttribute(w,d);null==w||isNaN(w)||(h=Math.min(h,w),n=Math.max(n,w))})}return{start:h,end:n}};a.getTimeOperator=function(p,m,b){if(!m||!p)return null;const {startTimeField:f,endTimeField:c}=p;if(!f&&!c)return null;const {start:h,end:n}=m;if(null===h&&null===n)return null;if(void 0===h&&void 0===n)return g();p=b.getAttributeAsTimestamp?.bind(b)??b.getAttribute.bind(b);return f&&c?q(p,f,c,h,n):r(p,f||c,h,n)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define("../../core/Error ../../core/JSONSupport ../../core/Logger ../../core/MapUtils ../../core/sql/UnknownTimeZone ./fieldUtils ../../time/timeZoneUtils ../../chunks/datetime".split(" "),function(a,q,r,g,p,m,b,f){function c(t){return t.trim().toLowerCase()}function h(t){const l=new Map;if(!t.fields)return l;const e=!0===t.datesInUnknownTimezone,{timeInfo:u,editFieldsInfo:x}=t;var y=(u?"startField"in u?u.startField:u.startTimeField:
"")??"";const A=(u?"endField"in u?u.endField:u.endTimeField:"")??"",k="dateFieldsTimeZone"in t?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?b.fromTimeReference(t.dateFieldsTimeReference):null,v=x?"timeZone"in x?x.timeZone??k:x.dateFieldsTimeReference?b.fromTimeReference(x.dateFieldsTimeReference):k??b.utc:null,B=u?"timeZone"in u?u.timeZone??k:u.timeReference?b.fromTimeReference(u.timeReference):k:null;y=new Map([[c(x?.creationDateField??""),v],[c(x?.editDateField??""),v],[c(y),B],[c(A),B]]);
for(const {name:z,type:E}of t.fields)w.has(E)?l.set(z,b.unknown):"date"!==E&&"esriFieldTypeDate"!==E?l.set(z,null):e?l.set(z,b.unknown):(t=y.get(c(z??""))??k,l.set(z,t));return l}const n=new Map;class d{static fromJSON(t){return new d(t.fields,t.timeZoneByFieldName)}static fromLayer(t){return new d(t.fields??[],h(t))}static fromLayerJSON(t){return new d(t.fields??[],h(t))}constructor(t=[],l){this._fieldsMap=new Map;this._normalizedFieldsMap=new Map;this._dateFieldsSet=new Set;this._numericFieldsSet=
new Set;this._requiredFields=null;this.dateFields=[];this.numericFields=[];this.fields=t||[];this._timeZoneByFieldName=l?new Map(l):null;t=[];for(const e of this.fields){l=e?.name;const u=m.normalizeFieldName(l)?.toLowerCase()??"";if(l&&u){const x=c(l);this._fieldsMap.set(l,e);this._fieldsMap.set(x,e);this._normalizedFieldsMap.set(u,e);t.push(`${x}:${e.type}:${this._timeZoneByFieldName?.get(l)}`);m.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):m.isNumericField(e)&&(this._numericFieldsSet.add(e),
this.numericFields.push(e));m.isObjectIDField(e)||m.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}t.sort();this.uid=t.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)m.isObjectIDField(t)||m.isGlobalIDField(t)||t.nullable||void 0!==m.getFieldDefaultValue(t)||this._requiredFields.push(t)}return this._requiredFields}equals(t){return this.uid===t?.uid}has(t){return null!=this.get(t)}get(t){if(t){var l=
this._fieldsMap.get(t);if(l)return l;(l=this._fieldsMap.get(c(t))??this._normalizedFieldsMap.get(m.normalizeFieldName(t)?.toLowerCase()??""))&&this._fieldsMap.set(t,l);return l}}getTimeZone(t){t=this.get(t&&"string"!==typeof t?t.name:t);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(r.getLogger("esri.layers.support.FieldsIndex").error(new a("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),
b.utc):w.has(t.type)?b.unknown:null:null}getLuxonTimeZone(t){const l=this.getTimeZone(t);return l?l===b.unknown?p.UnknownTimeZone.instance:l===b.utc?f.FixedOffsetZone.utcInstance:g.getOrCreateMapValue(n,l,()=>f.IANAZone.create(l)):null}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isTimeOnlyField(t){return m.isTimeOnlyField(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){return this.get(t)?.name??void 0}toJSON(){return{fields:this.fields.map(t=>
q.isSerializable(t)?t.toJSON():t),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}const w=new Set("time-only date-only timestamp-offset esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "));return d})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l){function e(I){return u.has(I)?u.get(I):"number"===typeof I?I:1}a.TaskPriority=void 0;(function(I){I.RESOURCE_CONTROLLER_IMMEDIATE="immediate";I.RESOURCE_CONTROLLER="schedule";I.SLIDE="slide";I.STREAM_DATA_LOADER="stream loader";I.ELEVATION_QUERY="elevation query";I.TERRAIN_SURFACE="terrain";I.SURFACE_GEOMETRY_UPDATES="surface geometry updates";I.LOD_RENDERER="LoD renderer";I.GRAPHICS_CORE="Graphics3D";I.I3S_CONTROLLER="I3S";I.POINT_CLOUD_LAYER="point cloud";
I.FEATURE_TILE_FETCHER="feature fetcher";I.OVERLAY="overlay";I.STAGE="stage";I.GRAPHICS_DECONFLICTOR="graphics deconflictor";I.FILTER_VISIBILITY="Graphics3D filter visibility";I.SCALE_VISIBILITY="Graphics3D scale visibility";I.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";I.POINT_OF_INTEREST_FREQUENT="POI frequent";I.POINT_OF_INTEREST_INFREQUENT="POI infrequent";I.LABELER="labeler";I.FEATURE_QUERY_ENGINE="feature query";I.FEATURE_TILE_TREE="feature tile tree";I.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";
I.ELEVATION_ALIGNMENT="elevation alignment";I.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";I.TEXT_TEXTURE_ATLAS="text texture atlas";I.TEXTURE_UNLOAD="texture unload";I.LINE_OF_SIGHT_TOOL="line of sight tool";I.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";I.ELEVATION_PROFILE="elevation profile";I.SNAPPING="snapping";I.SHADOW_ACCUMULATOR="shadow accumulator";I.CLOUDS_GENERATOR="clouds generator";I[I.NONE=0]="NONE";I[I.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority=
{}));const u=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,
4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.CLOUDS_GENERATOR,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.ELEVATION_ALIGNMENT_SCENE,
14],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),x=n.Milliseconds(6.5),y=n.Milliseconds(1),A=n.Milliseconds(30),k=n.Milliseconds(1E3/30),v=n.Milliseconds(100);var B;(function(I){class D{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(F=>F.needsUpdate)}constructor(){this._updating=
h.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new m("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new C;this._state=t.RenderState.INTERACTING;this._tasks=new b;this._runQueue=new b;this._load=0;this._idleStateCallbacks=new b;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=c.watch(()=>w.SCHEDULER_LOG_SLOW_TASKS,F=>this._debug=F,c.initial);for(const F of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[F],
new m(a.TaskPriority[F]))}destroy(){this._tasks.toArray().forEach(F=>F.remove());this._tasks.clear();p.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(F){this._updatingChanged();F&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(F,J){J=new G(this,F,J);this._tasks.push(J);this._updatingChanged();
this.performanceInfo.tasks.has(F)||this.performanceInfo.tasks.set(F,new m(F));return J}registerIdleStateCallbacks(F,J){const T={idleBegin:F,idleEnd:J};this._idleStateCallbacks.push(T);this.state===t.RenderState.IDLE&&this._idleUpdatesStartFired&&T.idleBegin();const S=this;return{remove:()=>this._removeIdleStateCallbacks(T),set idleBegin(ba){S._idleUpdatesStartFired&&(T.idleEnd(),S._state===t.RenderState.IDLE&&ba());T.idleBegin=ba},set idleEnd(ba){T.idleEnd=ba}}}get load(){return this._load}set state(F){this._state!==
F&&(this._state=F,this.state!==t.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(J=>J.idleEnd())))}get state(){return this._state}updateBudget(F){++this._frameNumber;let J=x,T=F.frameDuration,S=y;switch(this.state){case t.RenderState.IDLE:J=n.Milliseconds(0);T=n.Milliseconds(Math.max(v,F.frameDuration));S=A;break;case t.RenderState.INTERACTING:T=n.Milliseconds(Math.max(k,F.frameDuration))}T=n.Milliseconds(T-F.elapsedFrameTime-J);if(this.state!==
t.RenderState.IDLE&&T<y&&!this._forceTask)return this._forceTask=!0,!1;T=n.Milliseconds(Math.max(T,S));this._budget.reset(T,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case t.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(F=>F.idleBegin()));this._runIdle();break;case t.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(n.Milliseconds(0),
this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(F){this._idleUpdatesStartFired&&F.idleEnd();this._idleStateCallbacks.removeUnordered(F)}removeTask(F){this._tasks.removeUnordered(F);this._runQueue.removeUnordered(F);this._updatingChanged()}_updateTask(F){this._tasks.forAll(J=>{J.name===F&&J.setPriority(F)})}_getState(F){if(this._runQueue.some(T=>T.name===F))return a.TaskState.SCHEDULED;let J=a.TaskState.IDLE;this._tasks.forAll(T=>{T.name===F&&T.needsUpdate&&(1>=T.schedulePriority?
J=a.TaskState.READY:J!==a.TaskState.READY&&(J=a.TaskState.WAITING))});return J}_getRuntime(F){let J=0;this._tasks.forAll(T=>{T.name===F&&(J+=T.runtime)});return J}_resetRuntimes(){this._tasks.forAll(F=>F.runtime=0)}_getRunning(){const F=new Map;this._tasks.forAll(T=>{T.needsUpdate&&F.set(T.name,(F.get(T.name)||0)+1)});if(0===F.size)return null;let J="";F.forEach((T,S)=>{J=1<T?J+` ${T}x ${S}`:J+` ${S}`});return J}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const F=
this._tasks.reduce((J,T)=>T.needsUpdate?++J:J,0);this._load=.9*this._load+F*(1-.9)}_schedule(){this._runQueue.filterInPlace(F=>{if(F.needsUpdate)return!0;F.schedulePriority=F.basePriority;return!1});for(this._tasks.forAll(F=>{0===F.basePriority&&F.needsUpdate&&!this._runQueue.includes(F)&&F.blockFrame!==this._frameNumber&&this._runQueue.unshift(F)});0===this._runQueue.length;){let F=!1;this._tasks.forAll(J=>{if(J.needsUpdate&&0!==J.schedulePriority&&0!==J.basePriority&&J.blockFrame!==this._frameNumber)switch(F=
!0,J.schedulePriority){case 1:J.schedulePriority=0;this._runQueue.push(J);break;default:--J.schedulePriority}});if(!F)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const F=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var J=this._budget.now();const T=this._runQueue.pop();this._budget.resetProgress();try{T.task.runTask(this._budget)===l.Yield&&(T.blockFrame=this._frameNumber)}catch(S){g.getLogger("esri.views.support.Scheduler").error(`Exception in task "${T.name}"`,
S),T.blockFrame=this._frameNumber}!this._budget.hasProgressed&&T.blockFrame!==this._frameNumber&&T.needsUpdate&&(T.blockFrame=this._frameNumber);T.schedulePriority=T.basePriority;J=this._budget.now()-J;T.runtime+=J;this._frameTaskTimes.set(T.priority,this._frameTaskTimes.get(T.priority)+J);if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-F);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-F)}_startFrameTaskTimes(){for(const F of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[F],
0)}_recordFrameTaskTimes(F){this._frameTaskTimes.forEach((J,T)=>this.performanceInfo.tasks.get(T).record(J));this.performanceInfo.total.record(F)}get test(){}}I.Scheduler=D;class G{get task(){return this._task.value}get updating(){return this._queue.running}constructor(F,J,T){this._scheduler=F;this.name=J;this.runtime=this.blockFrame=0;this._queue=new d.PromiseQueue;this._handles=new q;this.schedulePriority=this._basePriority=e(J);this._task=h.signal(null!=T?T:this._queue);this._handles.add(c.when(()=>
this.task.running,S=>F.taskRunningChanged(S)))}remove(){this.processQueue(z);this._scheduler.removeTask(this);this.schedule=K.schedule;this.reschedule=K.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(F){if(this.name!==F){this.name=F;F=e(F);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=F;this._basePriority=F}}get priority(){return this.name}set priority(F){this.setPriority(F)}get needsUpdate(){return this.updating||this.task.running}schedule(F,
J,T){return this._queue.push(F,J,T)}reschedule(F,J,T){return this._queue.unshift(F,J,T)}processQueue(F){return this._queue.runTask(F)}}class C{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=t.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(F){if(this.done)return!1;!0===F()&&this.madeProgress();return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=
this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(F){this._enabled=F}reset(F,J){this._begin=this.now();this._budget=F;this._state=J;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._done=this._progressed=!1}get hasProgressed(){return this._progressed}}I.Budget=C})(B||={});a.TaskState=void 0;(function(I){I.SCHEDULED=
"s";I.READY="r";I.WAITING="w";I.IDLE="i"})(a.TaskState||(a.TaskState={}));const z=(()=>{const I=new B.Budget;I.enabled=!1;return I})();class E{remove(){}processQueue(){}schedule(I,D,G){try{if(f.isAborted(D)){const C=f.createAbortError();return G?Promise.resolve(G(C)):Promise.reject(C)}return f.when(I(z))}catch(C){return Promise.reject(C)}}reschedule(I,D,G){return this.schedule(I,D,G)}}const K=new E;a.ImmediateTask=K;a.getTaskPriority=e;a.newScheduler=function(){return new B.Scheduler};a.noBudget=
z;a.taskPriorities=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(a,q,r,g){class p{constructor(){this._tasks=[];this._runningTasks=r.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(b){if(0===this.length)return g.Yield;for(;!b.done&&this._process(b);)b.madeProgress()}push(b,
f,c){++this._runningTasks.value;return(new Promise((h,n)=>this._tasks.push(new m(h,n,b,f,c)))).finally(()=>--this._runningTasks.value)}unshift(b,f,c){++this._runningTasks.value;return(new Promise((h,n)=>this._tasks.unshift(new m(h,n,b,f,c)))).finally(()=>--this._runningTasks.value)}_process(b){if(0===this._tasks.length)return!1;const f=this._tasks.shift();try{const c=q.isAborted(f.signal);if(c&&!f.abortCallback)f.reject(q.createAbortError());else{const h=c?f.abortCallback?.(q.createAbortError()):
f.callback(b);q.isPromiseLike(h)?h.then(f.resolve,f.reject):f.resolve(h)}}catch(c){f.reject(c)}return!0}cancelAll(){const b=q.createAbortError();for(const f of this._tasks)if(f.abortCallback){const c=f.abortCallback(b);f.resolve(c)}else f.reject(b);this._tasks.length=0}}class m{constructor(b,f,c,h,n){this.resolve=b;this.reject=f;this.callback=c;this.signal=h;this.abortCallback=n}}a.PromiseQueue=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],
function(a){const q=Symbol("Yield");a.Yield=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b){q=class extends q{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=
!1}};a.__decorate([r.property()],q.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([r.property()],q.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);q=a.__decorate([b.subclass("esri.views.support.debugFlags")],q);return new q})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=void 0;var q=a.RenderState||(a.RenderState={});q[q.ANIMATING=0]="ANIMATING";q[q.INTERACTING=1]="INTERACTING";q[q.IDLE=2]="IDLE";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AProcessorStrategy":function(){define(["exports"],function(a){class q{constructor(g){this.subscription=g;this.handledChunks=new Set}destroy(){}}class r{constructor(g,p){this._source=g;this._attributeStore=p;this._sendStates=new Map}destroy(){}get enablePixelBuffering(){return!0}onSubscribe(g){const p=this.createState(g);this._sendStates.set(g.key.id,p);this.updateChunks()}onUnsubscribe(g){this._sendStates.get(g.key.id)?.destroy();
this._sendStates.delete(g.key.id)}invalidate(){const g=Array.from(this._sendStates.values());this._sendStates.clear();for(const p of g)p.destroy(),this.onSubscribe(p.subscription)}invalidateAttributeData(){}getFeatureObjectIdsForAggregate(g){throw Error("InternalError: AggregateId lookup not supported");}getDisplayIds(g){return this.displayMap(g,p=>p,p=>p)}getDisplayAndObjectIds(g){return this.displayMap(g,p=>p,(p,m,b)=>[p,b])}afterUpdateChunks(){}}a.AProcessorStrategy=r;a.ASendState=q;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceMessage":function(){define(["exports"],function(a){class q{constructor(g,p,m,b,f){this.subscription=g;this.reader=p;this.clear=m;this.end=b;this.debugInfo=f;this.type="append"}get id(){return this.subscription.tile.id}createMessage(g,p,m){return{type:"append",clear:this.clear,id:this.id,append:g,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:p,attributeEpoch:m}}}
class r{constructor(g,p,m,b,f){this.subscription=g;this.reader=p;this.remove=m;this.end=b;this.debugInfo=f;this.type="update"}get id(){return this.subscription.tile.id}createMessage(g,p,m){return{type:"update",id:this.id,modify:g,debugInfo:this.debugInfo,remove:this.remove,version:p,subscriptionVesrion:this.subscription.version,end:this.end,attributeEpoch:m}}}a.FeatureTileAppendMessage=q;a.FeatureTileUpdateMessage=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./ComputedLegacyLabelExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){function d(l,e,u){if(!(l.length>e))for(;l.length<=e;)l.push(u)}const w=()=>r.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");class t{constructor(l){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=l}createBitset(){const l=this._bitsets.length;this._bitsets.push(h.StaticBitSet.create(this._allocatedSize,
p.displayIdTexelMask));return l+1}async createComputedField(l,e=!1){if(l.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");return e?f.ComputedLegacyLabelExpression.create(l.expression,this.compilationOptions):await b.ComputedExpression.create(l.expression,this.compilationOptions)}catch(u){return l=new q("featurelayer","Failed to compile arcade expression",{error:u,expression:l.expression}),w().error(l),null}if(l.normalizationType||l.normalizationField)return new c.NormalizedField(l.field,
l);if(l.field)return new m.CachedField(l.field);l=new q("featurelayer","Unable to create computed field. No expression or field found",{info:l});w().error(l);return null}async createWhereClause(l){return l?n.createWhereClause(l,this.compilationOptions.fields):null}getBitset(l){return this._bitsets[l-1]}getComputedNumeric(l,e){return this.getComputedNumericAtIndex(l&p.displayIdTexelMask,0)}setComputedNumeric(l,e,u){return this.setComputedNumericAtIndex(l&p.displayIdTexelMask,u,0)}getComputedString(l,
e){return this.getComputedStringAtIndex(l&p.displayIdTexelMask,0)}setComputedString(l,e,u){return this.setComputedStringAtIndex(l&p.displayIdTexelMask,0,u)}getComputedNumericAtIndex(l,e){l&=p.displayIdTexelMask;this._ensureNumeric(e,l);return this._numerics[e][l]}setComputedNumericAtIndex(l,e,u){l&=p.displayIdTexelMask;this._ensureNumeric(e,l);this._numerics[e][l]=u}getPackedChunkId(l){l&=p.displayIdTexelMask;this._ensureInstanceId(l);return this._instanceIds[l]}setPackedChunkId(l,e){l&=p.displayIdTexelMask;
this._ensureInstanceId(l);this._instanceIds[l]=e}getComputedStringAtIndex(l,e){l&=p.displayIdTexelMask;this._ensureString(e,l);return this._strings[e][l]}setComputedStringAtIndex(l,e,u){l&=p.displayIdTexelMask;this._ensureString(e,l);this._strings[e][l]=u}getXMin(l){return this._bounds[4*(l&p.displayIdTexelMask)]}getYMin(l){return this._bounds[4*(l&p.displayIdTexelMask)+1]}getXMax(l){return this._bounds[4*(l&p.displayIdTexelMask)+2]}getYMax(l){return this._bounds[4*(l&p.displayIdTexelMask)+3]}setBounds(l,
e,u=!1){const x=l&p.displayIdTexelMask;if(!u&&!this._dirtyBitset.has(l))return 4294967295!==this._bounds[4*x];this._dirtyBitset.unset(l);l=e.readGeometryWorldSpace();d(this._bounds,4*x+4,0);if(!l||!l.coords.length)return this._bounds[4*x]=4294967295,this._bounds[4*x+1]=4294967295,this._bounds[4*x+2]=4294967295,this._bounds[4*x+3]=4294967295,!1;let y=Infinity,A=Infinity,k=-Infinity,v=-Infinity;l.forEachVertex((B,z)=>{y=Math.min(y,B);A=Math.min(A,z);k=Math.max(k,B);v=Math.max(v,z)});this._bounds[4*
x]=y;this._bounds[4*x+1]=A;this._bounds[4*x+2]=k;this._bounds[4*x+3]=v;return!0}getBounds(l,e){const u=this.getXMin(e),x=this.getYMin(e),y=this.getXMax(e);e=this.getYMax(e);g.fromRectValues(l,u,x,y,e);return 4294967295!==u}_ensureNumeric(l,e){this._numerics[l]||(this._numerics[l]=[]);d(this._numerics[l],e,0)}_ensureInstanceId(l){d(this._instanceIds,l,0)}_ensureString(l,e){this._strings[l]||(this._strings[l]=[]);d(this._strings[l],e,null)}}a.ComputedAttributeStorage=t;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(g){super();this._field=g}resize(g){throw Error("Method not implemented.");}read(g,p){return g.readAttribute(this._field)}readWithDefault(g,p){return g.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}a.CachedField=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports",
"../../../../../core/string","../../../../../support/arcadeOnDemand","../../../arcade/callExpressionWithCursor","./AComputedField"],function(a,q,r,g,p){class m extends p.AComputedField{static async create(b,f){f=await r.createRendererExpression(b,f.spatialReference,f.fields);b=q.numericHash(b);return new m(f,b)}constructor(b,f){super();this._compiled=b;this._cacheKey=f}resize(b){}read(b,f){return this.referencesScale()||"system"!==f.$view.timeZone?g.callExpressionWithCursor(this._compiled,b,f):this._readCached(b,
f)}readWithDefault(b,f,c){return this.referencesScale()||"system"!==f.$view.timeZone?g.callExpressionWithCursorWithDefault(this._compiled,b,f,c):this._readWithDefaultCached(b,f,c)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(b,f){b.setCache(this._cacheKey);if(b.hasCachedValue())return b.getCachedValue();f=g.callExpressionWithCursor(this._compiled,b,f);b.setCachedValue(f);return f}_readWithDefaultCached(b,
f,c){b.setCache(this._cacheKey);if(b.hasCachedValue())return b.getCachedValue();f=g.callExpressionWithCursorWithDefault(this._compiled,b,f,c);b.setCachedValue(f);return f}}a.ComputedExpression=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(a,q,r){function g(p){return null==p||Infinity===p||-Infinity===p||"number"===typeof p&&isNaN(p)}a.callExpressionWithCursor=
function(p,m,b){if(null==p)return null;const f=m.readArcadeFeature();m.contextTimeZone=b.$view?.timeZone;try{return p.evaluate({...b,$feature:f},p.services)}catch(c){return r.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}};a.callExpressionWithCursorWithDefault=function(p,m,b,f){if(null==p)return null!=f?f:null;const c=m.readArcadeFeature();m.contextTimeZone=b.$view?.timeZone;p=p.evaluate({...b,$feature:c},p.services);return g(p)?null!=f?f:null:
p};a.isBadArcadeResult=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(a,q,r,g,p){class m extends p.AComputedField{static async create(b,f){const c=r.sqlToTemplateString(b);return new m(h=>c.replaceAll(/{[^}]*}/g,n=>{const d=
n.slice(1,-1),w=h.metadata.fieldsIndex.get(d);if(null==w)return n;n=h.readAttribute(d);return null==n?"":q.formatField(n,w)}))}constructor(b){super();this._evaluator=b}resize(b){}read(b,f){return this._evaluator(b)}readWithDefault(b,f,c){b=this._evaluator(b);return g.isBadArcadeResult(b)?c:b}referencesScale(){return!1}referencesGeometry(){return!1}}a.ComputedLegacyLabelExpression=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(l,e){if(null==l)return"";const u=e.domain;if(u)if("codedValue"===u.type||"coded-value"===u.type)for(var x of u.codedValues){if(x.code===l)return x.name}else if("range"===u.type){const {max:y,min:A}=b.getDomainRange(e);x=+l;if(null!=A&&null!=y&&A<=x&&x<=y)return u.name}f.isDateField(e)?l=p.formatDate(l,p.convertDateFormatToIntlOptions("short-date")):f.isNumericField(e)&&(l=m.formatNumber(+l));return l||""}const d=()=>r.getLogger("esri.layers.support.labelFormatUtils"),
w={type:"simple",evaluate(){return null}},t={getAttribute(l,e){return l.field(e)}};a.createLabelFunction=async function(l,e,u){if(!l||!l.symbol||!e)return w;const x=l.where,y=c.getLabelExpression(l);if("arcade"===y.type){const A=await h.createLabelExpression(y.expression,u,e);if(null==A)return w;l={type:"arcade",evaluate(k,v){try{const B="attributes"in k?A.repurposeFeature(k):k;B.contextTimeZone=v??null;const z=A.evaluate({$view:{timeZone:v},$feature:B},A.services);if(null!=z)return z.toString()}catch(B){d().error(new q("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:B,feature:k,expression:y}))}return null},needsHydrationToEvaluate(){return null==c.getSingleFieldArcadeExpression(y.expression)}}}else l={type:"simple",evaluate(A){return y.expression.replaceAll(/{[^}]*}/g,k=>{var v=k.slice(1,-1);v=e.get(v);if(!v)return k;k=null;"attributes"in A?A&&A.attributes&&(k=A.attributes[v.name]):k=A.field(v.name);return null==k?"":n(k,v)})}};if(x){let A;try{A=await g.parseWhereClause(x,e)}catch(v){return d().error(new q("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:x,error:v})),w}const k=l.evaluate;l.evaluate=(v,B)=>{const z="attributes"in v?void 0:t;try{if(A.testFeature(v,z))return k(v,B)}catch(E){d().error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:x,feature:v,error:E}))}return null}}return l};a.formatField=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelUtils":function(){define(["exports","../../core/string"],
function(a,q){function r(e){return e.replaceAll(RegExp("\\[","g"),"{").replaceAll(RegExp("\\]","g"),"}")}function g(e){const u={expression:"",type:"none"};e.labelExpressionInfo?e.labelExpressionInfo.value?(u.expression=e.labelExpressionInfo.value,u.type="conventional"):e.labelExpressionInfo.expression&&(u.expression=e.labelExpressionInfo.expression,u.type="arcade"):null!=e.labelExpression&&(u.expression=r(e.labelExpression),u.type="conventional");return u}function p(e){e?(e=q.replace(e,u=>'__begin__$feature["'+
u+'"]__end__'),e=h.test(e)?e.replace(h,""):'"'+e,e=n.test(e)?e.replace(n,""):e+'"',e=e.replaceAll(f,'" + ').replaceAll(c,' + "')):e='""';return e}function m(e){return e?.match(d)?.[1].trim()||null}function b(e){if(!e)return null;let u=w.exec(e)||t.exec(e);return u?u[1]||u[3]:(u=l.exec(e))?u[2]:null}const f=RegExp("__begin__","ig"),c=RegExp("__end__","ig"),h=RegExp("^__begin__","i"),n=RegExp("__end__$","i"),d=/^\s*\{([^}]+)\}\s*$/i,w=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,
t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,l=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;a.convertTemplatedStringToArcade=p;a.getLabelExpression=g;a.getLabelExpressionArcade=function(e){e=g(e);if(!e)return null;switch(e.type){case "conventional":return p(e.expression);case "arcade":return e.expression}return null};a.getLabelExpressionSingleField=function(e){e=g(e);if(!e)return null;switch(e.type){case "conventional":return m(e.expression);
case "arcade":return b(e.expression)}return null};a.getSingleFieldArcadeExpression=b;a.getSingleFieldTemplatedString=m;a.sqlToTemplateString=r;a.templateStringToSql=function(e){return e.replaceAll(RegExp("\\{","g"),"[").replaceAll(RegExp("\\}","g"),"]")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(a,q){class r extends q.AComputedField{constructor(g,p){super();this._field=
g;this._normalizationInfo=p}resize(g){throw Error("Method not implemented.");}read(g,p){return this._readNormalized(g)}readWithDefault(g,p){return this._readNormalized(g)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(g){const p=g.readAttribute(this._field);if(null==p)return null;const {normalizationField:m,normalizationTotal:b,normalizationType:f}=this._normalizationInfo;g=g.readAttribute(m);switch(f??"esriNormalizeByField"){case "esriNormalizeByField":return g?(g||void 0)&&
p/g:null;case "esriNormalizeByLog":return Math.log(p)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return b?p/b*100:null}}}a.NormalizedField=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(a){class q{static fromBuffer(r,g){return new q(r,g)}static create(r,g=4294967295){r=new Uint32Array(Math.ceil(r/32));return new q(r,g)}constructor(r,g){this._mask=0;this._buf=r;this._mask=g}_getIndex(r){return Math.floor(r/
32)}has(r){r&=this._mask;return!!(this._buf[this._getIndex(r)]&1<<r%32)}hasRange(r,g){for(;r%32&&r!==g;){if(this.has(r))return!0;r++}for(;g%32&&r!==g;){if(this.has(r))return!0;g--}if(r===g)return!1;for(r/=32;r!==g/32;r++)if(this._buf[r])return!0;return!1}set(r){r&=this._mask;const g=this._getIndex(r);this._buf[g]|=1<<r%32}setRange(r,g){for(;r%32&&r!==g;)this.set(r++);for(;g%32&&r!==g;)this.set(g--);if(r!==g)for(r/=32;r!==g/32;r++)this._buf[r]=4294967295}unset(r){r&=this._mask;const g=this._getIndex(r);
this._buf[g]&=4294967295^1<<r%32}resize(r){const g=this._buf;r=new Uint32Array(Math.ceil(r/32));r.set(g);this._buf=r}or(r){for(let g=0;g<this._buf.length;g++)this._buf[g]|=r._buf[g];return this}and(r){for(let g=0;g<this._buf.length;g++)this._buf[g]&=r._buf[g];return this}xor(r){for(let g=0;g<this._buf.length;g++)this._buf[g]^=r._buf[g];return this}ior(r){for(let g=0;g<this._buf.length;g++)this._buf[g]|=~r._buf[g];return this}iand(r){for(let g=0;g<this._buf.length;g++)this._buf[g]&=~r._buf[g];return this}ixor(r){for(let g=
0;g<this._buf.length;g++)this._buf[g]^=~r._buf[g];return this}any(){for(let r=0;r<this._buf.length;r++)if(this._buf[r])return!0;return!1}copy(r){for(let g=0;g<this._buf.length;g++)this._buf[g]=r._buf[g];return this}clone(){return new q(this._buf.slice(),this._mask)}clear(){for(let r=0;r<this._buf.length;r++)this._buf[r]=0;return this}forEachSet(r){for(let g=0;g<this._buf.length;g++){let p=this._buf[g],m=32*g;if(p)for(;p;)p&1&&r(m),p>>>=1,m++}}countSet(){let r=0;this.forEachSet(g=>{r++});return r}}
a.StaticBitSet=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(a,q,r,g){const p=()=>r.getLogger("esri.views.2d.layers.features.support.whereUtils"),m={getAttribute(b,f){return b.readAttribute(f)}};a.createWhereClause=async function(b,f){try{const c=await g.parseWhereClause(b,f);if(!c.isStandardized){const h=new q("mapview - bad input",
"Unable to apply filter's definition expression, as expression is not standardized.",c);p().error(h)}return h=>{h=h.readArcadeFeature();try{return c.testFeature(h,m)}catch(n){return p().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",b),!0}}}catch(c){return p().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",b),h=>!0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilter":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h){class n{constructor(d){this._geometryBounds=r.create();this._idToVisibility=new Map;this._serviceInfo=d}static async create(d){const w=new n(d);await w.update(d.filterJSON,d.spatialReference);return w}get hash(){return this._hash}check(d){return this._applyFilter(d)}clear(){const d=this._resetAllHiddenIds();this.update();return{show:d,hide:[]}}invalidate(){this._idToVisibility.forEach((d,w)=>{this._idToVisibility.set(w,0)})}setKnownIds(d){for(const w of d)this._idToVisibility.set(w,
1)}setTrue(d){const w=[],t=[],l=new Set(d);this._idToVisibility.forEach((e,u)=>{e=!!(this._idToVisibility.get(u)&1);const x=l.has(u);!e&&x?w.push(u):e&&!x&&t.push(u);this._idToVisibility.set(u,x?3:0)});return{show:w,hide:t}}createQuery(){const {geometry:d,spatialRel:w,where:t,timeExtent:l,objectIds:e}=this;return f.fromJSON({geometry:d,spatialRel:w,where:t,timeExtent:l,objectIds:e})}async update(d,w){this._hash=JSON.stringify(d);d=await p.normalizeQueryLike(d,null,w);await Promise.all([this._setGeometryFilter(d),
this._setIdFilter(d),this._setAttributeFilter(d),this._setTimeFilter(d)])}async _setAttributeFilter(d){d?.where?(this._clause=await h.createWhereClause(d.where,this._serviceInfo.fieldsIndex),this.where=d.where):this.where=this._clause=null}_setIdFilter(d){this._idsToShow=d?.objectIds&&new Set(d.objectIds);this._idsToHide=d?.hiddenIds&&new Set(d.hiddenIds);this.objectIds=d?.objectIds}async _setGeometryFilter(d){if(d?.geometry){var w=d.geometry;d=d.spatialRel||"esriSpatialRelIntersects";var t=await m.getSpatialQueryOperator(d,
w,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);g.getBoundsXY(this._geometryBounds,w);this._spatialQueryOperator=t;this.geometry=w;this.spatialRel=d}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(d){this.timeExtent=this._timeOperator=null;d?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=d.timeExtent,this._timeOperator=b.getTimeOperator(this._serviceInfo.timeInfo,d.timeExtent,c.FeatureStoreQueryAdapter.Shared)):(d=new a("feature-layer-view:time-filter-not-available",
"Unable to apply time filter, as layer doesn't have time metadata.",d.timeExtent),q.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(d)))}_applyFilter(d){return this._filterByGeometry(d)&&this._filterById(d)&&this._filterByTime(d)&&this._filterByExpression(d)}_filterByExpression(d){return this.where?this._clause(d):!0}_filterById(d){return(!this._idsToHide?.size||!this._idsToHide.has(d.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(d.getObjectId()))}_filterByGeometry(d){return this.geometry?
(d=d.readGeometryWorldSpace())?this._spatialQueryOperator(d):!1:!0}_filterByTime(d){return null==this._timeOperator?!0:this._timeOperator(d)}_resetAllHiddenIds(){const d=[];this._idToVisibility.forEach((w,t)=>{w&1||(this._idToVisibility.set(t,1),d.push(t))});return d}}return n})},"esri/rest/support/Query":function(){define("../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../../layers/support/source/DataLayerSource ./FullTextSearch ./QuantizationParameters ./spatialRelationships ./StatisticDefinition ../../geometry/SpatialReference ../../geometry/Point".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A){var k;g=new g.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let v=k=class extends p.JSONSupport{static from(B){return d.ensureClass(k,B)}constructor(B){super(B);this.aggregateIds=null;this.cacheHint=void 0;this.compactGeometryEnabled=!1;this.datumTransformation=null;this.defaultSpatialReferenceEnabled=
!1;this.dynamicDataSource=this.distance=void 0;this.geometry=this.gdbVersion=this.fullText=this.formatOf3DObjects=null;this.geometryPrecision=void 0;this.historicMoment=this.having=this.groupByFieldsForStatistics=null;this.maxAllowableOffset=void 0;this.maxRecordCountFactor=1;this.multipatchOption=null;this.num=void 0;this.resultType=this.relationParameter=this.rangeValues=this.quantizationParameters=this.pixelSize=this.parameterValues=this.outStatistics=this.outSpatialReference=this.outFields=this.orderByFields=
this.objectIds=null;this.returnDistinctValues=this.returnCentroid=!1;this.returnExceededLimitFeatures=!0;this.returnQueryGeometry=this.returnGeometry=!1;this.returnZ=this.returnM=void 0;this.sourceSpatialReference=null;this.spatialRelationship="intersects";this.start=void 0;this.timeExtent=this.text=this.sqlFormat=null;this.timeReferenceUnknownClient=!1;this.where=this.units=null}castDatumTransformation(B){return"number"===typeof B||"object"===typeof B?B:null}writeHistoricMoment(B,z){z.historicMoment=
B&&B.getTime()}writeParameterValues(B,z){if(B){const E={};for(const K in B){const I=B[K];Array.isArray(I)?E[K]=I.map(D=>D instanceof Date?D.getTime():D):E[K]=I instanceof Date?I.getTime():I}z.parameterValues=E}}writeStart(B,z){z.resultOffset=this.start;z.resultRecordCount=this.num||10;z.where="1\x3d1"}writeWhere(B,z){z.where=B||"1\x3d1"}clone(){return new k(m.clone({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,
defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,
num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,
returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};v.MAX_MAX_RECORD_COUNT_FACTOR=5;a.__decorate([b.property({json:{write:!0}})],
v.prototype,"aggregateIds",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],v.prototype,"cacheHint",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"compactGeometryEnabled",void 0);a.__decorate([b.property({json:{write:!0}})],v.prototype,"datumTransformation",void 0);a.__decorate([f.cast("datumTransformation")],v.prototype,"castDatumTransformation",null);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"defaultSpatialReferenceEnabled",
void 0);a.__decorate([b.property({type:Number,json:{write:{overridePolicy(B){return{enabled:0<B}}}}})],v.prototype,"distance",void 0);a.__decorate([b.property({type:t.DataLayerSource,json:{write:!0}})],v.prototype,"dynamicDataSource",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"formatOf3DObjects",void 0);a.__decorate([b.property({type:[l],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&0<this.fullText.length}}}}})],v.prototype,"fullText",
void 0);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"gdbVersion",void 0);a.__decorate([b.property({types:q.geometryTypes,json:{read:w.fromJSON,write:!0}})],v.prototype,"geometry",void 0);a.__decorate([b.property({type:Number,json:{write:!0}})],v.prototype,"geometryPrecision",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],v.prototype,"groupByFieldsForStatistics",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"having",void 0);
a.__decorate([b.property({type:Date})],v.prototype,"historicMoment",void 0);a.__decorate([n.writer("historicMoment")],v.prototype,"writeHistoricMoment",null);a.__decorate([b.property({type:Number,json:{write:!0}})],v.prototype,"maxAllowableOffset",void 0);a.__decorate([b.property({type:Number,cast(B){return 1>B?1:B>v.MAX_MAX_RECORD_COUNT_FACTOR?v.MAX_MAX_RECORD_COUNT_FACTOR:B},json:{write:{overridePolicy(B){return{enabled:1<B}}}}})],v.prototype,"maxRecordCountFactor",void 0);a.__decorate([b.property({type:["xyFootprint"],
json:{write:!0}})],v.prototype,"multipatchOption",void 0);a.__decorate([b.property({type:Number,json:{read:{source:"resultRecordCount"}}})],v.prototype,"num",void 0);a.__decorate([b.property({json:{write:!0}})],v.prototype,"objectIds",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],v.prototype,"orderByFields",void 0);a.__decorate([b.property({type:[String],json:{write:!0}})],v.prototype,"outFields",void 0);a.__decorate([b.property({type:y,json:{name:"outSR",write:!0}})],v.prototype,
"outSpatialReference",void 0);a.__decorate([b.property({type:[x],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&0<this.outStatistics.length}}}}})],v.prototype,"outStatistics",void 0);a.__decorate([b.property({json:{write:!0}})],v.prototype,"parameterValues",void 0);a.__decorate([n.writer("parameterValues")],v.prototype,"writeParameterValues",null);a.__decorate([b.property({type:A,json:{write:!0}})],v.prototype,"pixelSize",void 0);a.__decorate([b.property({type:e,
json:{write:!0}})],v.prototype,"quantizationParameters",void 0);a.__decorate([b.property({type:[Object],json:{write:!0}})],v.prototype,"rangeValues",void 0);a.__decorate([b.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],v.prototype,"relationParameter",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"resultType",void 0);a.__decorate([b.property({type:Boolean,
json:{default:!1,write:!0}})],v.prototype,"returnCentroid",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnDistinctValues",void 0);a.__decorate([b.property({type:Boolean,json:{default:!0,write:!0}})],v.prototype,"returnExceededLimitFeatures",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],v.prototype,"returnGeometry",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnQueryGeometry",void 0);
a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnM",void 0);a.__decorate([b.property({type:Boolean,json:{write:{overridePolicy(B){return{enabled:B}}}}})],v.prototype,"returnZ",void 0);a.__decorate([b.property({type:y,json:{write:!0}})],v.prototype,"sourceSpatialReference",void 0);a.__decorate([c.enumeration(u.spatialRelKebabDict,{ignoreUnknown:!1,name:"spatialRel"})],v.prototype,"spatialRelationship",void 0);a.__decorate([b.property({type:Number,json:{read:{source:"resultOffset"}}})],
v.prototype,"start",void 0);a.__decorate([n.writer("start"),n.writer("num")],v.prototype,"writeStart",null);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"sqlFormat",void 0);a.__decorate([b.property({type:String,json:{write:!0}})],v.prototype,"text",void 0);a.__decorate([b.property({type:r,json:{write:!0}})],v.prototype,"timeExtent",void 0);a.__decorate([b.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"timeReferenceUnknownClient",void 0);a.__decorate([c.enumeration(g,
{ignoreUnknown:!1}),b.property({json:{write:{overridePolicy(B){return{enabled:!!B&&null!=this.distance&&0<this.distance}}}}})],v.prototype,"units",void 0);a.__decorate([b.property({type:String,json:{write:{overridePolicy(B){return{enabled:null!=B||null!=this.start&&0<this.start}}}}})],v.prototype,"where",void 0);a.__decorate([n.writer("where")],v.prototype,"writeWhere",null);return v=k=a.__decorate([h.subclass("esri.rest.support.Query")],v)})},"esri/TimeExtent":function(){define("./chunks/tslib.es6 ./core/JSONSupport ./core/timeUtils ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./time/timeZoneUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){var d;q=d=class extends q.JSONSupport{static get allTime(){return w}static get empty(){return t}static fromArray(l){return new d({start:null!=l[0]?new Date(l[0]):l[0],end:null!=l[1]?new Date(l[1]):l[1]})}constructor(l){super(l);this.start=this.end=null}readEnd(l,e){return null!=e.end?new Date(e.end):null}writeEnd(l,e){e.end=l?.getTime()??null}get isAllTime(){return this.equals(d.allTime)}get isEmpty(){return this.equals(d.empty)}readStart(l,e){return null!=e.start?
new Date(e.start):null}writeStart(l,e){e.start=l?.getTime()??null}clone(){return new d({end:this.end,start:this.start})}equals(l){if(!l)return!1;const e=this.start?.getTime()??this.start,u=this.end?.getTime()??this.end,x=l.start?.getTime()??l.start;l=l.end?.getTime()??l.end;return e===x&&u===l}expandTo(l,e=n.system){if(this.isEmpty||this.isAllTime)return this.clone();let u=this.start;u&&=r.truncateDate(u,l,e);let x=this.end;if(x){const y=r.truncateDate(x,l,e);x=x.getTime()===y.getTime()?y:r.offsetDate(y,
1,l,e)}return new d({start:u,end:x})}intersection(l){if(!l)return this.clone();if(this.isEmpty||l.isEmpty)return d.empty;if(this.isAllTime)return l.clone();if(l.isAllTime)return this.clone();const e=this.start?.getTime()??-Infinity,u=this.end?.getTime()??Infinity,x=l.start?.getTime()??-Infinity;l=l.end?.getTime()??Infinity;let y,A;x>=e&&x<=u?y=x:e>=x&&e<=l&&(y=e);u>=x&&u<=l?A=u:l>=e&&l<=u&&(A=l);return null==y||null==A||isNaN(y)||isNaN(A)?d.empty:new d({start:-Infinity===y?null:new Date(y),end:Infinity===
A?null:new Date(A)})}offset(l,e,u=n.system){if(this.isEmpty||this.isAllTime)return this.clone();const x=new d,{start:y,end:A}=this;null!=y&&(x.start=r.offsetDate(y,l,e,u));null!=A&&(x.end=r.offsetDate(A,l,e,u));return x}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(l){if(!l||l.isEmpty)return this.clone();if(this.isEmpty)return l.clone();if(this.isAllTime||l.isAllTime)return w.clone();const e=null!=this.start&&null!=l.start?new Date(Math.min(this.start.getTime(),
l.start.getTime())):null;l=null!=this.end&&null!=l.end?new Date(Math.max(this.end.getTime(),l.end.getTime())):null;return new d({start:e,end:l})}};a.__decorate([g.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"end",void 0);a.__decorate([f.reader("end")],q.prototype,"readEnd",null);a.__decorate([h.writer("end")],q.prototype,"writeEnd",null);a.__decorate([g.property({readOnly:!0,json:{read:!1}})],q.prototype,"isAllTime",null);a.__decorate([g.property({readOnly:!0,json:{read:!1}})],
q.prototype,"isEmpty",null);a.__decorate([g.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"start",void 0);a.__decorate([f.reader("start")],q.prototype,"readStart",null);a.__decorate([h.writer("start")],q.prototype,"writeStart",null);q=d=a.__decorate([c.subclass("esri.TimeExtent")],q);const w=new q,t=new q({start:void 0,end:void 0});return q})},"esri/layers/support/source/DataLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/extensions/serializableProperty/reader ../Field ./MapLayerSource ./QueryTableDataSource ./RasterDataSource ./TableDataSource".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e){function u(){k||=n.createTypeReader({types:x()});return k}function x(){v||={key:"type",base:null,typeMap:{"data-layer":a.DataLayerSource,"map-layer":w.MapLayerSource}};return v}var y,A;r=r.strict()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});a.JoinTableDataSource=y=class extends g.JSONSupport{constructor(B){super(B);this.type="join-table"}readLeftTableSource(B,z,E){return u()(B,z,E)}castLeftTableSource(B){return h.ensureOneOfType(x(),
B)}readRightTableSource(B,z,E){return u()(B,z,E)}castRightTableSource(B){return h.ensureOneOfType(x(),B)}clone(){const {leftTableKey:B,rightTableKey:z,leftTableSource:E,rightTableSource:K,joinType:I}=this,D={leftTableKey:B,rightTableKey:z,leftTableSource:E?.clone()??void 0,rightTableSource:K?.clone()??void 0,joinType:I};return new y(D)}};q.__decorate([b.enumeration({joinTable:"join-table"})],a.JoinTableDataSource.prototype,"type",void 0);q.__decorate([p.property({type:String,json:{write:!0}})],a.JoinTableDataSource.prototype,
"leftTableKey",void 0);q.__decorate([p.property({type:String,json:{write:!0}})],a.JoinTableDataSource.prototype,"rightTableKey",void 0);q.__decorate([p.property({json:{write:!0}})],a.JoinTableDataSource.prototype,"leftTableSource",void 0);q.__decorate([f.reader("leftTableSource")],a.JoinTableDataSource.prototype,"readLeftTableSource",null);q.__decorate([m.cast("leftTableSource")],a.JoinTableDataSource.prototype,"castLeftTableSource",null);q.__decorate([p.property({json:{write:!0}})],a.JoinTableDataSource.prototype,
"rightTableSource",void 0);q.__decorate([f.reader("rightTableSource")],a.JoinTableDataSource.prototype,"readRightTableSource",null);q.__decorate([m.cast("rightTableSource")],a.JoinTableDataSource.prototype,"castRightTableSource",null);q.__decorate([b.enumeration(r)],a.JoinTableDataSource.prototype,"joinType",void 0);a.JoinTableDataSource=y=q.__decorate([c.subclass("esri.layers.support.source.JoinTableDataSource")],a.JoinTableDataSource);let k=null,v=null;m={key:"type",base:null,typeMap:{"join-table":a.JoinTableDataSource,
"query-table":t.QueryTableDataSource,raster:l.RasterDataSource,table:e.TableDataSource}};a.DataLayerSource=A=class extends g.JSONSupport{constructor(B){super(B);this.type="data-layer"}clone(){const {fields:B,dataSource:z}=this;return new A({fields:B,dataSource:z})}};q.__decorate([b.enumeration({dataLayer:"data-layer"})],a.DataLayerSource.prototype,"type",void 0);q.__decorate([p.property({type:[d],json:{write:!0}})],a.DataLayerSource.prototype,"fields",void 0);q.__decorate([p.property({types:m,json:{write:!0}})],
a.DataLayerSource.prototype,"dataSource",void 0);a.DataLayerSource=A=q.__decorate([c.subclass("esri.layers.support.source.DataLayerSource")],a.DataLayerSource);a.DataLayerSource.from=h.ensureType(a.DataLayerSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Field":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./domains ./fieldType".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d){var w;const t=new q.JSONMap({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});q=w=class extends r.JSONSupport{constructor(l){super(l);
this.alias=null;this.defaultValue=void 0;this.domain=this.description=null;this.editable=!0;this.length=void 0;this.name=null;this.nullable=!0;this.valueType=this.type=null;this.visible=!0}readDescription(l,{description:e}){l=null;try{l=e?JSON.parse(e):null}catch(u){}return l?.value??null}readValueType(l,{description:e}){l=null;try{l=e?JSON.parse(e):null}catch(u){}return l?t.fromJSON(l.fieldValueType):null}clone(){return new w({alias:this.alias,defaultValue:this.defaultValue,description:this.description,
domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"alias",void 0);a.__decorate([g.property({type:[String,Number],json:{write:{allowNull:!0}}})],q.prototype,"defaultValue",void 0);a.__decorate([g.property()],q.prototype,"description",void 0);a.__decorate([c.reader("description")],q.prototype,"readDescription",
null);a.__decorate([g.property({types:n.types,json:{read:{reader:n.fromJSON},write:!0}})],q.prototype,"domain",void 0);a.__decorate([g.property({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0);a.__decorate([g.property({type:p.Integer,json:{write:{overridePolicy(l){return{enabled:Number.isFinite(l)}}}}})],q.prototype,"length",void 0);a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"name",void 0);a.__decorate([g.property({type:Boolean,json:{write:!0}})],q.prototype,
"nullable",void 0);a.__decorate([f.enumeration(d.kebabDict)],q.prototype,"type",void 0);a.__decorate([g.property()],q.prototype,"valueType",void 0);a.__decorate([c.reader("valueType",["description"])],q.prototype,"readValueType",null);a.__decorate([g.property({type:Boolean,json:{read:!1}})],q.prototype,"visible",void 0);return q=w=a.__decorate([h.subclass("esri.layers.support.Field")],q)})},"esri/layers/support/domains":function(){define("exports ../../core/has ./CodedValueDomain ./Domain ./InheritedDomain ./RangeDomain".split(" "),
function(a,q,r,g,p,m){q={key:"type",base:g,typeMap:{range:m,"coded-value":r,inherited:p}};a.CodedValueDomain=r;a.DomainBase=g;a.InheritedDomain=p;a.RangeDomain=m;a.fromJSON=function(b){if(!b?.type)return null;switch(b.type){case "range":return m.fromJSON(b);case "codedValue":return r.fromJSON(b);case "inherited":return p.fromJSON(b)}return null};a.types=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CodedValueDomain":function(){define("../../chunks/tslib.es6 ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./CodedValue ./Domain".split(" "),
function(a,q,r,g,p,m,b,f,c){var h;g=h=class extends c{constructor(n){super(n);this.codedValues=null;this.type="coded-value"}getName(n){let d=null;if(this.codedValues){const w=String(n);this.codedValues.some(t=>{String(t.code)===w&&(d=t.name);return!!d})}return d}clone(){return new h({codedValues:q.clone(this.codedValues),name:this.name})}};a.__decorate([r.property({type:[f.CodedValue],json:{write:!0}})],g.prototype,"codedValues",void 0);a.__decorate([m.enumeration({codedValue:"coded-value"})],g.prototype,
"type",void 0);return g=h=a.__decorate([b.subclass("esri.layers.support.CodedValueDomain")],g)})},"esri/layers/support/CodedValue":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f){var c;a.CodedValue=c=class extends r.JSONSupport{constructor(h){super(h);this.code=this.name=null}clone(){return new c({name:this.name,
code:this.code})}};q.__decorate([g.property({type:String,json:{write:!0}})],a.CodedValue.prototype,"name",void 0);q.__decorate([g.property({type:[String,Number],json:{write:!0}})],a.CodedValue.prototype,"code",void 0);a.CodedValue=c=q.__decorate([f.subclass("esri.layers.support.CodedValue")],a.CodedValue);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Domain":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f,c){q=new q.JSONMap({inherited:"inherited",codedValue:"coded-value",range:"range"});r=class extends r.JSONSupport{constructor(h){super(h);this.type=this.name=null}};a.__decorate([g.property({type:String,json:{write:!0}})],r.prototype,"name",void 0);a.__decorate([f.enumeration(q)],r.prototype,"type",void 0);return r=a.__decorate([c.subclass("esri.layers.support.Domain")],r)})},"esri/layers/support/InheritedDomain":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(a,q,r,g,p,m,b,f){var c;q=c=class extends f{constructor(h){super(h);this.type="inherited"}clone(){return new c}};a.__decorate([m.enumeration({inherited:"inherited"})],q.prototype,"type",void 0);return q=c=a.__decorate([b.subclass("esri.layers.support.InheritedDomain")],q)})},"esri/layers/support/RangeDomain":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(a,q,r,g,p,m,b,f){var c;r=c=class extends f{constructor(h){super(h);this.minValue=this.maxValue=null;this.type="range"}clone(){return new c({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};a.__decorate([q.property({json:{type:[Number],read:{source:"range",reader(h,n){return n.range?.[1]}},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(h,n,d){n[d]=[this.minValue||0,h]}}}})],r.prototype,"maxValue",void 0);a.__decorate([q.property({json:{type:[Number],
read:{source:"range",reader(h,n){return n.range?.[0]}},write:{target:"range",writer(h,n,d){n[d]=[h,this.maxValue||0]}}}})],r.prototype,"minValue",void 0);a.__decorate([m.enumeration({range:"range"})],r.prototype,"type",void 0);return r=c=a.__decorate([b.subclass("esri.layers.support.RangeDomain")],r)})},"esri/layers/support/source/MapLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f,c){var h;a.MapLayerSource=h=class extends r.JSONSupport{constructor(n){super(n);this.type="map-layer"}clone(){const {mapLayerId:n,gdbVersion:d}=this;return new h({mapLayerId:n,gdbVersion:d})}};q.__decorate([f.enumeration({mapLayer:"map-layer"})],a.MapLayerSource.prototype,"type",void 0);q.__decorate([g.property({type:p.Integer,json:{write:!0}})],a.MapLayerSource.prototype,"mapLayerId",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],a.MapLayerSource.prototype,
"gdbVersion",void 0);a.MapLayerSource=h=q.__decorate([c.subclass("esri.layers.support.source.MapLayerSource")],a.MapLayerSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/QueryTableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../geometry ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d){var w;a.QueryTableDataSource=w=class extends g.JSONSupport{constructor(t){super(t);this.type="query-table"}clone(){const {workspaceId:t,query:l,oidFields:e,spatialReference:u,geometryType:x}=this,y={workspaceId:t,query:l,oidFields:e,spatialReference:u?.clone()??void 0,geometryType:x};return new w(y)}};q.__decorate([c.enumeration({queryTable:"query-table"})],a.QueryTableDataSource.prototype,"type",void 0);q.__decorate([p.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,
"workspaceId",void 0);q.__decorate([p.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,"query",void 0);q.__decorate([p.property({type:String,json:{write:!0}})],a.QueryTableDataSource.prototype,"oidFields",void 0);q.__decorate([p.property({type:n,json:{write:!0}})],a.QueryTableDataSource.prototype,"spatialReference",void 0);q.__decorate([c.enumeration(d.featureGeometryTypeKebabDictionary)],a.QueryTableDataSource.prototype,"geometryType",void 0);a.QueryTableDataSource=w=q.__decorate([h.subclass("esri.layers.support.source.QueryTableDataSource")],
a.QueryTableDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/RasterDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f,c){var h;a.RasterDataSource=h=class extends r.JSONSupport{constructor(n){super(n);
this.type="raster"}clone(){const {workspaceId:n,dataSourceName:d}=this;return new h({workspaceId:n,dataSourceName:d})}};q.__decorate([f.enumeration({raster:"raster"})],a.RasterDataSource.prototype,"type",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],a.RasterDataSource.prototype,"dataSourceName",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],a.RasterDataSource.prototype,"workspaceId",void 0);a.RasterDataSource=h=q.__decorate([c.subclass("esri.layers.support.source.RasterDataSource")],
a.RasterDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/TableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f,c){var h;a.TableDataSource=h=class extends r.JSONSupport{constructor(n){super(n);
this.type="table"}clone(){const {workspaceId:n,gdbVersion:d,dataSourceName:w}=this;return new h({workspaceId:n,gdbVersion:d,dataSourceName:w})}};q.__decorate([f.enumeration({table:"table"})],a.TableDataSource.prototype,"type",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],a.TableDataSource.prototype,"workspaceId",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],a.TableDataSource.prototype,"gdbVersion",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],
a.TableDataSource.prototype,"dataSourceName",void 0);a.TableDataSource=h=q.__decorate([c.subclass("esri.layers.support.source.TableDataSource")],a.TableDataSource);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FullTextSearch":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f){q=class extends q.ClonableMixin(r.JSONSupport){constructor(c){super(c);this.searchType=this.searchTerm=this.operator=this.onFields=null}};a.__decorate([g.property({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&0<this.onFields.length}}}}})],q.prototype,"onFields",void 0);a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"operator",void 0);a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"searchTerm",
void 0);a.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"searchType",void 0);return q=a.__decorate([f.subclass("esri.rest.support.FullTextSearch")],q)})},"esri/core/Clonable":function(){define("exports ../chunks/tslib.es6 ./Accessor ./has ./lang ./Logger ./maybe ./accessorSupport/PropertyOrigin ./accessorSupport/utils ./accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f,c,h){g=n=>{n=class extends n{clone(){var d=c.getProperties(this);b.assertIsSome(d,"unable to clone instance of non-accessor class");
var w=d.metadata;const t=d.store,l={};d=new Map;for(var e in w){var u=w[e];const x=t?.originOf(e),y=u.clonable;if(u.readOnly||!1===y||x!==f.OriginId.USER&&x!==f.OriginId.DEFAULTS&&x!==f.OriginId.WEB_MAP&&x!==f.OriginId.WEB_SCENE)continue;u=this[e];let A=null;A="function"===typeof y?y(u):"reference"===y?u:p.tryClone(u);if(null==u||null!=A)x===f.OriginId.DEFAULTS?d.set(e,A):l[e]=A}w=new (Object.getPrototypeOf(this).constructor)(l);if(d.size&&(e=c.getProperties(w)?.store))for(const [x,y]of d)e.set(x,
y,f.OriginId.DEFAULTS);return w}};return n=q.__decorate([h.subclass("esri.core.Clonable")],n)};a.Clonable=class extends g(r){};a.Clonable=q.__decorate([h.subclass("esri.core.Clonable")],a.Clonable);a.ClonableMixin=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/QuantizationParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/Extent".split(" "),
function(a,q,r,g,p,m,b,f,c,h){var n;q=new r.JSONMap({upperLeft:"upper-left",lowerLeft:"lower-left"});g=n=class extends g.JSONSupport{constructor(d){super(d);this.extent=null;this.mode="view";this.originPosition="upper-left";this.tolerance=1}clone(){return new n(p.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};a.__decorate([m.property({type:h,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],g.prototype,"extent",void 0);
a.__decorate([m.property({type:["view","edit"],json:{write:!0}})],g.prototype,"mode",void 0);a.__decorate([m.property({type:String,json:{read:q.read,write:q.write}})],g.prototype,"originPosition",void 0);a.__decorate([m.property({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],g.prototype,"tolerance",void 0);return g=n=a.__decorate([c.subclass("esri.rest.support.QuantizationParameters")],g)})},"esri/rest/support/spatialRelationships":function(){define(["exports",
"../../core/jsonMap"],function(a,q){q=new q.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});a.spatialRelKebabDict=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/rest/support/StatisticDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer".split(" "),function(a,q,r,g,p,m,b,f,c){var h;q=new q.JSONMap({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",
percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});r=h=class extends r.JSONSupport{constructor(n){super(n);this.maxVertexCount=this.maxRecordCount=this.maxPointCount=void 0;this.statisticParameters=this.statisticType=this.outStatisticFieldName=this.onStatisticField=null}writeStatisticParameters(n,d){if("percentile-continuous"===this.statisticType||"percentile-discrete"===this.statisticType)d.statisticParameters=
g.clone(n)}clone(){return new h({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:g.clone(this.statisticParameters)})}};a.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"maxPointCount",void 0);a.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"maxRecordCount",void 0);
a.__decorate([p.property({type:Number,json:{write:!0}})],r.prototype,"maxVertexCount",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],r.prototype,"onStatisticField",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],r.prototype,"outStatisticFieldName",void 0);a.__decorate([p.property({type:String,json:{read:{source:"statisticType",reader:q.read},write:{target:"statisticType",writer:q.write}}})],r.prototype,"statisticType",void 0);a.__decorate([p.property({type:Object})],
r.prototype,"statisticParameters",void 0);a.__decorate([c.writer("statisticParameters")],r.prototype,"writeStatisticParameters",null);return r=h=a.__decorate([f.subclass("esri.rest.support.StatisticDefinition")],r)})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports"],function(a){class q{getObjectId(r){return r.getObjectId()}getAttributes(r){return r.readAttributes()}getAttribute(r,g){return r.readAttribute(g)}getAttributeAsTimestamp(r,g){return r.readAttributeAsTimestamp(g)}cloneWithGeometry(r,
g){return r}getGeometry(r){return r.readGeometryWorldSpace()}getCentroid(r,g){return r.readCentroidForDisplay()}}q.Shared=new q;a.FeatureStoreQueryAdapter=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(a,q,r){class g{static minimal(m,b,f=[]){return new g({geometryType:m,fields:f,objectIdField:b,subtypes:null,
subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}constructor(m){this._options=m;this._fieldsIndex="fieldsIndex"in m?r.fromJSON(m.fieldsIndex):new r(m.fields);m.spatialReference&&(this._spatialReference=q.fromJSON(m.spatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,
spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}
class p extends g{static create(m){return new p({fields:[],objectIdField:"uid",geometryType:null,spatialReference:m,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}a.FeatureMetadata=g;a.GraphicsMetadata=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature",
"../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(a,q,r,g,p){class m extends p.FeatureSetReader{static fromFeatures(b,f){const {objectIdField:c,geometryType:h}=f,n=q.convertFromFeatures([],b,h,!1,!1,c);for(let d=0;d<n.length;d++)n[d].displayId=b[d].displayId;return m.fromOptimizedFeatures(n,f)}static fromFeatureSet(b,f){b=q.convertFromFeatureSet(b,f.objectIdField);return m.fromOptimizedFeatureSet(b,f)}static fromOptimizedFeatureSet(b,f){f=m.fromOptimizedFeatures(b.features,
f);f._exceededTransferLimit=b.exceededTransferLimit;f._transform=b.transform;f._fieldsIndex=new g(b.fields);return f}static fromOptimizedFeatures(b,f,c){b=new m(b,f);b._fieldsIndex=f.fieldsIndex;b._transform=c;return b}static empty(b){return new m([],b)}constructor(b,f){super(f);this._exceededTransferLimit=!1;this._featureIndex=-1;this._fieldsIndex=null;this._geometryType=f.geometryType;this._features=b}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+
1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}removeIds(b){const f=new Set(b);this._features=this._features.filter(c=>!(null!=c.objectId&&f.has(c.objectId)))}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let b="";for(const f in this._current.attributes)b+=this._current.attributes[f];
return b}getIndex(){return this._featureIndex}setIndex(b){this._featureIndex=b}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(b){this._current.displayId=b}copy(){const b=new m(this._features,this.metadata);this.copyInto(b);return b}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return r.hasGeometry(this._current)?q.getQuantizedArea(this._current.geometry,
2):0}_readX(){return r.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return r.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return r.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(b,f){if(this._fieldsIndex){var c=this._fieldsIndex.get(b);if(c){c=this._current.attributes[c.name];if(null==c)return c;"esriFieldTypeTimestampOffset"===this.fields.get(b)?.type&&(c=this.parseTimestampOffset(c));
return f&&this.fields.isDateField(b)?new Date(c):c}}else{f=this._current.attributes[b];if(void 0!==f)return f;b=b.toLowerCase();for(c in this._current.attributes)if(c.toLowerCase()===b)return this._current.attributes[c]}}_readAttributes(){return this._current.attributes}copyInto(b){super.copyInto(b);b._featureIndex=this._featureIndex;b._transform=this._transform;b._fieldsIndex=this._fieldsIndex}}a.FeatureSetReaderJSON=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./FeatureSetCache ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x){function y(C,F,J){if(!(C.length>F))for(;C.length<=F;)C.push(J)}q=g("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const A=q[0],k=q[1],v=q[2],B=q[3];q=g("featurelayer-simplify-payload-size-factors")??[1,2,4];const z=q[0],E=q[1],K=q[2],I=g("featurelayer-simplify-mobile-factor")??2,D=g("esri-mobile");class G{constructor(C){this.metadata=C;this.type="FeatureSetReader";this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];
this._caches=new Map;this.arcadeDeclaredClass="esri.arcade.Feature";this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(C,F){let J=1;const T=D?I:1;4E6<F?J=K*T:1E6<F?J=E*T:5E5<F?J=z*T:1E5<F&&(J=T);F=0;4E3<C?F=B*J:2E3<C?F=v*J:100<C?F=k:15<C&&(F=A);return F}parseTimestampOffset(C){return C}getBounds(C){y(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var F=
this.readGeometryWorldSpace();if(!F)return this.setBoundsXMin(4294967295),!1;let ba=Infinity,M=Infinity,U=-Infinity,R=-Infinity;F.forEachVertex((Z,ea)=>{ba=Math.min(ba,Z);M=Math.min(M,ea);U=Math.max(U,Z);R=Math.max(R,ea)});this.setBoundsXMin(ba);this.setBoundsYMin(M);this.setBoundsXMax(U);this.setBoundsYMax(R);c.fromRectValues(C,ba,M,U,R);return!0}F=this.getBoundsXMin();const J=this.getBoundsYMin(),T=this.getBoundsXMax(),S=this.getBoundsYMax();c.fromRectValues(C,F,J,T,S);return!0}getBoundsXMin(){return this._boundsBuffer[4*
this.getIndex()]}setBoundsXMin(C){this._boundsBuffer[4*this.getIndex()]=C}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(C){this._boundsBuffer[4*this.getIndex()+1]=C}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(C){this._boundsBuffer[4*this.getIndex()+2]=C}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(C){this._boundsBuffer[4*this.getIndex()+3]=C}readAttributeAsTimestamp(C){C=this.readAttribute(C);return"string"===
typeof C?(new Date(C)).getTime():"number"===typeof C||null==C?C:null}readAttribute(C,F=!1){var J=this._readAttribute(C,F);if(void 0!==J)return J;for(const T of this._joined)if(T.setIndex(this.getIndex()),J=T._readAttribute(C,F),void 0!==J)return J}readAttributes(){const C=this._readAttributes();for(const F of this._joined){F.setIndex(this.getIndex());const J=F._readAttributes();for(const T of Object.keys(J))C[T]=J[T]}return C}joinAttributes(C){this._joined.push(C)}removeIds(C){if(null==this._objectIdToIndex){var F=
new Map;const J=this.getCursor();for(;J.next();){const T=J.getObjectId();p.assertIsSome(T);F.set(T,J.getIndex())}this._objectIdToIndex=F}F=this._objectIdToIndex;for(const J of C.values())F.has(J)&&this._removeAtIndex(F.get(J))}readOptimizedFeatureWorldSpace(){var C=this.readGeometryWorldSpace();const F=this.readAttributes(),J=this.readCentroidWorldSpace();C=new w.OptimizedFeature(C,F,J);C.objectId=this.getObjectId();C.displayId=this.getDisplayId();return C}readLegacyFeatureForDisplay(){const C=this.readCentroidForDisplay();
return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(C&&{x:C.coords[0],y:C.coords[1]})??null}}readLegacyFeatureWorldSpace(){const C=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(C&&{x:C.coords[0],y:C.coords[1]})??null}}readLegacyGeometryForDisplay(){const C=this.readGeometryForDisplay();return d.convertToGeometry(C,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const C=
this._readX(),F=this.getInTransform();return null==F?C:C*F.scale[0]+F.translate[0]}readYWorldSpace(){const C=this._readY(),F=this.getInTransform();return null==F?C:F.translate[1]-C*F.scale[1]}readGeometryForDisplay(){var C=this._readGeometryDeltaDecoded(!0);return C?C:(C=this._createGeometryFromServerCentroid())?C.deltaDecode():null}readGeometryWorldSpace(){var C=this._readGeometry();C||=this._createGeometryFromServerCentroid();if(!C)return null;C=C.clone();const F=this.getInTransform();null!=F&&
d.unquantizeOptimizedGeometry(C,C,this.hasZ,this.hasM,F);return C}readCentroidForDisplay(){const C=this.readGeometryForDisplay();return C?this._computeDisplayCentroid(C):this._readServerCentroid()}readCentroidWorldSpace(){var C=this.readGeometryForDisplay();C=C?this._computeDisplayCentroid(C):this._readServerCentroid();if(!C)return null;C=C.clone();const F=this.getInTransform();null!=F&&d.unquantizeOptimizedGeometry(C,C,this.hasZ,this.hasM,F);return C}setCache(C){let F=this._caches.get(C);null==F&&
(F=new e.FeatureSetCache(this.getSize()),this._caches.set(C,F));this._activeCache=F}setCachedValue(C){this._activeCache.set(this.getIndex(),C)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(C){C=this._readGeometry(C);return"esriGeometryPoint"!==this.geometryType&&C&&this.getInTransform()?C.deltaDecode():C}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(C){this._contextTimeZone=
C}readArcadeFeature(){return this}hasField(C){return this.fields.has(C)||this._joined.some(F=>F.hasField(C))}geometry(){var C=this.readGeometryWorldSpace();C=d.convertToGeometry(C,this.geometryType,this.hasZ,this.hasM);if(C=x.fromJSON(C)){if(!this.metadata.spatialReference)throw Error("InternalError: Expected spatial reference to be defined");C.spatialReference=this.metadata.spatialReference}return C}autocastArcadeDate(C,F){return F&&F instanceof Date?this.isUnknownDateTimeField(C)?r.ArcadeDate.unknownDateJSToArcadeDate(F):
r.ArcadeDate.dateJSAndZoneToArcadeDate(F,this.contextTimeZone??l.system):F}isUnknownDateTimeField(C){return this.metadata.fieldsIndex.getTimeZone(C)===l.unknown}field(C){let F=this.fields.get(C);if(F)switch(F.type){case "date-only":case "esriFieldTypeDateOnly":return m.DateOnly.fromReader(this.readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return b.TimeOnly.fromReader(this.readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,this.readAttribute(C,!0));default:return this.readAttribute(C,!1)}for(const J of this._joined)if(J.setIndex(this.getIndex()),F=J.fields.get(C))switch(F.type){case "date-only":case "esriFieldTypeDateOnly":return m.DateOnly.fromReader(J._readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return b.TimeOnly.fromReader(J._readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return r.ArcadeDate.fromReaderAsTimeStampOffset(J._readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,J._readAttribute(C,!0));default:return this.readAttribute(C,!1)}throw Error(`Field ${C} does not exist`);}setField(C,F){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(C=>C.name)}castToText(C=!1){if(!C)return JSON.stringify(this.readLegacyFeatureForDisplay());C=this.readLegacyFeatureForDisplay();if(!C)return JSON.stringify(null);C={geometry:C.geometry,attributes:{...(C.attributes??
{})}};for(const F in C.attributes){const J=C.attributes[F];J instanceof Date&&(C.attributes[F]=J.getTime())}return JSON.stringify(C)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(C=null){return{attributes:this._readAttributes(),geometry:!0===C?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(C,F=null){return Promise.resolve(this.castAsJson(F))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(C){if(null==
this.getInTransform())return n.getCentroidOptimizedGeometry(new t,C,this.hasM,this.hasZ);C=f.GeometryCursor.fromOptimized(C,this.geometryType);C.yFactor*=-1;return(C=h.getLabelPoint(C))?(C[1]*=-1,new t([],C)):null}copyInto(C){C._joined=this._joined;C._deleted=this._deleted;C._objectIdToIndex=this._objectIdToIndex;C._boundsBuffer=this._boundsBuffer;C._activeCache=this._activeCache;C._caches=this._caches;C._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const C=this.readGeometryWorldSpace();
return d.convertToGeometry(C,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const C=this._readServerCentroid();if(!C)return null;const [F,J]=C.coords;return this._createQuantizedExtrudedGeometry(F,J)}_createQuantizedExtrudedGeometry(C,F){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(C,F):this._createQuantizedExtrudedQuad(C,F)}_createQuantizedExtrudedQuad(C,F){return new t([5],[C-1,F,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(C,F){return new t([2],
[C-1,F+1,1,-1])}_removeAtIndex(C){null==this._deleted&&(this._deleted=u.StaticBitSet.create(this.getSize()));this._deleted.set(C)}}a.FeatureSetReader=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(a,q){class r{constructor(g){this._valid=q.StaticBitSet.create(g);this._data=Array(g)}has(g){return this._valid.has(g)}set(g,p){this._valid.set(g);this._data[g]=p}get(g){return this._data[g]}}
a.FeatureSetCache=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/ClusterStrategy":function(){define("exports ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../engine/webgl/definitions ../aggregation/ComputedAggregateField ../aggregation/GridCell ../aggregation/GridSpatialIndex ./AAggregateStrategy ./AProcessorStrategy ./support/WithDisplayId ../sources/FeatureSourceMessage ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../../tiling/TileKey".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u){class x extends h.ASendState{constructor(k){super(k);this.done=this.didSend=!1}}class y{constructor(k,v,B,z,E){this._level=k;this._scale=v;this._indexOptions=B;this._clusterRadius=z;this._store=E;this._cells=new Map;this._handledChunks=new Set;this._statistics=new Map;this._clusters=new Map}destroy(){this._clearClusters()}_clearClusters(){for(const k of this._clusters.values())this._store.releaseDisplayIdForObjectId(k.inner.id);this._clusters.clear()}*aggregatesWorldSpace(){for(const v of this._clusters.values()){var k=
v.inner.getCentroid(null);k=new r.OptimizedFeature(k,v.inner.getAttributes(),null);k.objectId=v.inner.id;k.displayId=v.displayId;yield k}}clusters(){return this._clusters.values()}updateChunks(k,v){let B=!1;for(var z of k)k=z.queryInfo,"tileId"in k&&(new u(k.tileId)).level!==this._level||this._handledChunks.has(z.normalizedChunkId)||(this._handledChunks.add(z.normalizedChunkId),B=!0,z.getAggregateIndex({...this._indexOptions,scale:this._scale}).put(this._cells));z={xMin:Infinity,yMin:Infinity,xMax:-Infinity,
yMax:-Infinity};k=f.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale);const E=this._indexOptions.cellSize;for(const {subscription:K}of v){v=K.tile.bounds;const I=Math.floor(v[1]*k/E),D=Math.ceil(v[2]*k/E),G=Math.ceil(v[3]*k/E);z.xMin=Math.min(z.xMin,Math.floor(v[0]*k/E));z.yMin=Math.min(z.yMin,I);z.xMax=Math.max(z.xMax,D);z.yMax=Math.max(z.yMax,G)}if(null==this._lastCellBounds||z.xMin!==this._lastCellBounds.xMin||z.yMin!==this._lastCellBounds.yMin||z.yMin!==this._lastCellBounds.yMin||
z.yMax!==this._lastCellBounds.yMax)B=!0,this._lastCellBounds=z;B&&this._clusterCells(z);return B}async updateStatistics(k){var v=!1;for(const B of this._clusters.values())1<B.inner.count&&(v=this._updateAggregateStatistics(this._statistics,B.inner)||v);v&&(v=Array.from(this._statistics.entries()).map(([B,z])=>({fieldName:B,minValue:z.minValue,maxValue:z.maxValue})),await k.container.updateStatistics(this._level,v))}createAggregateFeatures(k,v){k=k.subscription;const B=[],z=k.tile.transform;for(const D of this._clusters.values()){var E=
D.inner.getCentroidX(z);const G=D.inner.getCentroidY(z);var K=k.tile.lod,I=K.wrap?K.worldSize[0]:null;K=1===D.inner.count?D.inner.firstObjectId:D.inner.id;const C=D.displayId;null!=I&&(1===I?(I=new g([],[E,G]),I=new r.OptimizedFeature(I,D.inner.getAttributes(),null),I.geometry.coords[0]-=p.tileSize,I.objectId=K,I.displayId=C,B.push(I),I=new g([],[E,G]),I=new r.OptimizedFeature(I,D.inner.getAttributes(),null),I.geometry.coords[0]+=p.tileSize,I.objectId=K,I.displayId=C,B.push(I)):E>p.tileSize+p.tileSize/
2?E-=I*p.tileSize:E<-(p.tileSize/2)&&(E+=I*p.tileSize));E<p.tileSize+128&&-128<=E&&G<p.tileSize+128&&-128<=G&&(E=new g([],[E,G]),E=new r.OptimizedFeature(E,D.inner.getAttributes(),null),E.objectId=K,E.displayId=C,B.push(E))}return e.FeatureSetReaderJSON.fromOptimizedFeatures(B,v,k.tile.transform)}_clusterCells(k){var v=Array.from(this._cells.values());v=v.sort((I,D)=>D.count-I.count);const B=[];for(var z of this._clusters.values())B.push(z.inner.id);this._clusters.clear();z=this._clusterRadius*(1/
f.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale));const E=1+this._clusterRadius/this._indexOptions.cellSize,K=new Set;for(const I of v){if(K.has(I.id))continue;if(I.gridX<k.xMin||I.gridX>k.xMax||I.gridY<k.yMin||I.gridY>k.yMax)continue;v=this._store.createDisplayIdForObjectId(I.id);v=new n.WithDisplayId(I.clone(),v);K.add(I.id);this._clusters.set(I.id,v);const D=I.centroidXWorld,G=I.centroidYWorld;for(let C=I.gridY-E;C<=I.gridY+E;C++)for(let F=I.gridX-E;F<=I.gridX+E;F++){if(C===
I.gridY&&F===I.gridX)continue;const J=this._cells.get(b.GridCell.createId(F,C));if(!J||K.has(J.id))continue;const T=Math.abs(J.centroidYWorld-G);Math.abs(J.centroidXWorld-D)<z&&T<z&&(v.inner.merge(J),K.add(J.id))}}for(const I of B)this._store.releaseDisplayIdForObjectId(I)}_updateAggregateStatistics(k,v){let B=!1;for(const K of v.statistics.values())if("esriFieldTypeString"!==K.field.type){var z=K.value,E=K.field;if(v=k.get(E.name)){const {minValue:I,maxValue:D}=v;E=Math.min(v.minValue,z);z=Math.max(v.maxValue,
z);if(I!==E||D!==z)v.minValue=E,v.maxValue=z,B=!0}else k.set(E.name,{minValue:z,maxValue:z}),B=!0}return B}}class A extends c.AAggregateStrategy{static async create(k,v,B,z,E,K){const I=new w.ComputedAttributeStorage({spatialReference:B}),D=await Promise.all(v.fields.map(async C=>m.ComputedAggregateField.create(I,C))),G=v.featureFilter?await t.create({geometryType:z.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:z.metadata.timeInfo,fieldsIndex:z.metadata.fieldsIndex,spatialReference:B,filterJSON:v.featureFilter}):
null;return new A(k,v.clusterRadius,{type:"grid",fields:D,spatialReference:B,featureFilter:G,cellSize:v.clusterRadius/4,timeZone:K},v.fields,z,E)}constructor(k,v,B,z,E,K){super(E,K,B.spatialReference,B.fields);this._connection=k;this._clusterRadius=v;this._indexOptions=B;this._cellsPerScale=new Map;this._metadata=new l.FeatureMetadata({geometryType:"esriGeometryPoint",objectIdField:"aggregateId",fields:[...z,...this._source.metadata.fieldsIndex.fields,{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}],
globalIdField:null,spatialReference:E.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null})}get enablePixelBuffering(){return!1}invalidate(){super.invalidate();for(const k of this._cellsPerScale.values())k.destroy();this._cellsPerScale.clear()}onSubscribe(k){super.onSubscribe(k);this._requiredLevel=k.tile.level;this._requiredScale=k.tile.scale}createState(k){return new x(k)}async *applyLocalEdit(k){for(const v of this._cellsPerScale.values())v.destroy();
this._cellsPerScale.clear();for(const v of this._sendStates.values())v.done=!1}displayMap(k,v,B){k=new Map(k.map(K=>[v(K),K]));const z=[];var E=this._getClusterState(this._requiredLevel,this._requiredScale);for(const K of E.clusters())E=k.get(K.inner.id),null!=E?(E=B(K.displayId,E,K.inner.id),z.push(E),k.delete(K.inner.id)):1===K.inner.count&&(E=k.get(K.inner.firstObjectId),null!=E&&(E=B(K.displayId,E,K.inner.firstObjectId),z.push(E),k.delete(K.inner.firstObjectId)));return z}getDisplayFeatures(k){k=
new Set(k);const v=new Set,B=[],z=[];var E=this._getClusterState(this._requiredLevel,this._requiredScale);for(const K of E.aggregatesWorldSpace())k.has(K.displayId)&&!v.has(K.displayId)&&(E=q.convertToFeature(K,this._metadata.geometryType,!1,!1),v.add(K.displayId),1===E.attributes.cluster_count?B.push({...E,displayId:K.displayId}):z.push({...E,displayId:K.displayId}));return{features:B,aggregates:z}}getFeatureObjectIdsForAggregate(k){const v=this._getClusterState(this._requiredLevel,this._requiredScale);
for(const B of v.clusters())if(B.inner.id===k)return Array.from(B.inner.containedObjectIds);return[]}async *updateChunks(){var k=this._source.chunks();if(k.length){var v=this._getClusterState(this._requiredLevel,this._requiredScale),B=Array.from(this._sendStates.values()).filter(E=>E.subscription.tile.level===this._requiredLevel);if(v.updateChunks(k,B)||!this._source.updateTracking.updating)for(const E of B)E.subscription.tile.level===this._requiredLevel&&(E.didSend=!1,E.done=!1);k=Array.from(this._sendStates.values()).filter(E=>
E.done).map(E=>E.subscription.tile.key);var z=new Set(k);for(const E of this._sendStates.values()){if(this._source.updateTracking.updating){if(k.some(K=>K.containsChild(E.subscription.tile.key)))continue;if(E.subscription.tile.key.getChildKeys().every(K=>z.has(K)))continue}E.didSend||E.subscription.tile.level!==this._requiredLevel||(E.didSend=!0,yield*this._update(E,v,this._source))}await v.updateStatistics(this._connection)}}forEachAggregateWorldSpace(k){if(null!=this._requiredLevel&&null!=this._requiredScale){var v=
this._getClusterState(this._requiredLevel,this._requiredScale);for(const B of v.aggregatesWorldSpace())k(B)}}_getClusterState(k,v){if(null==k||null==v)throw Error("InternalError: Level and scale must be defined");let B=this._cellsPerScale.get(v);B||(B=new y(k,v,this._indexOptions,this._clusterRadius,this._attributeStore),this._cellsPerScale.set(v,B));return B}async *_update(k,v,B){if(!k.done){v=v.createAggregateFeatures(k,this._metadata);this.events.emit("changed");k.done=!B.updateTracking.updating;
B=v.getCursor();for(var z=k.subscription.tile.createArcadeEvaluationOptions(this._indexOptions.timeZone);B.next();)this._attributeStore.setAttributeData(B.getDisplayId(),B,z);yield new d.FeatureTileAppendMessage(k.subscription,v,!0,k.done,{})}}}a.ClusterState=x;a.ClusterStrategy=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridCell":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry",
"./AAggregateCell","./AccumulatedStatistics"],function(a,q,r,g,p){class m extends g.AAggregateCell{static createId(b,f){return`${b}.${f}`}static create(b,f,c,h){return new m(b,f,p.AccumulatedStatistics.create(c),h)}constructor(b,f,c,h){super(c);this.gridX=b;this.gridY=f;this._worldUnitsPerCell=h;this._yWorldTotal=this._xWorldTotal=this._count=0;this._objectIds=new Set}get id(){return m.createId(this.gridX,this.gridY)}get containedObjectIds(){return this._objectIds}get count(){return this._count}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/
this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const b=new m(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);b._count=this._count;b._xWorldTotal=this._xWorldTotal;b._yWorldTotal=this._yWorldTotal;b._firstFeatureAttributes=this._firstFeatureAttributes;b._objectIds=new Set(this._objectIds);return b}insert(b,f,c,h){this._firstFeatureAttributes=0===this._count?b.readAttributes():null;this._count+=1;this._xWorldTotal+=c;this._yWorldTotal+=h;this._statistics.insert(b,
f);this._objectIds.add(b.getObjectId())}merge(b){if(0!==b._count){this._count+=b._count;this._firstFeatureAttributes=b._firstFeatureAttributes;this._xWorldTotal+=b._xWorldTotal;this._yWorldTotal+=b._yWorldTotal;this._statistics.merge(b._statistics);for(const f of b._objectIds.values())this._objectIds.add(f)}}getCentroidX(b){return null==b?this.centroidXWorld:q.quantizeX(b,this.centroidXWorld)}getCentroidY(b){return null==b?this.centroidYWorld:q.quantizeY(b,this.centroidYWorld)}getGeometry(b,f){b=
this.gridX*this._worldUnitsPerCell;var c=this.gridY*this._worldUnitsPerCell;b=new r([4],[b,c,b+this._worldUnitsPerCell,c,b+this._worldUnitsPerCell,c+this._worldUnitsPerCell,b,c+this._worldUnitsPerCell]);return null!=f?(c=new r,q.quantizeOptimizedGeometry(c,b,!1,!1,"esriGeometryPolygon",f)):b}getCentroid(b){const f=new r([],[this.centroidXWorld,this.centroidYWorld]);if(null!=b){const c=new r;return q.quantizeOptimizedGeometry(c,f,!1,!1,"esriGeometryPoint",b)}return f}getGeometricCentroid(b,f){b=new r([],
[this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell]);if(null!=f){const c=new r;return q.quantizeOptimizedGeometry(c,b,!1,!1,"esriGeometryPoint",f)}return b}getAttributes(){const b={aggregateId:this.id};for(const f of this._statistics.values())b[f.field.name]=f.value;return null!=this._firstFeatureAttributes?{...b,...this._firstFeatureAttributes}:b}}a.GridCell=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/aggregation/AAggregateCell":function(){define(["exports"],function(a){class q{constructor(r){this._statistics=r}get statistics(){return this._statistics}}a.AAggregateCell=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AccumulatedStatistics":function(){define(["exports","../../../arcade/callExpressionWithCursor"],function(a,q){function r(w){switch(w.statisticType){case "min":return new b(w);case "max":return new f(w);
case "avg":return new h(w);case "avg_angle":return new n(w);case "sum":return new c(w);case "mode":return new d(w);case "count":return new c(w)}}const g=Math.PI/180;class p{static create(w){return new p(w.map(t=>r(t)))}constructor(w){this._statistics=w}values(){return this._statistics.values()}insert(w,t){for(const l of this._statistics)l.insert(w,t)}merge(w){for(let t=0;t<this._statistics.length;t++){const l=this._statistics[t],e=w._statistics[t];if(l.field.name!==e.field.name)throw Error("InternalError: Tried to merge incompatible statistics");
l.merge(e)}}clone(){return new p(this._statistics.map(w=>w.clone()))}}class m{constructor(w){this.field=w}insert(w,t){this.field.computed&&(w=this.field.computed.read(w,t),q.isBadArcadeResult(w)||this._insertValue(w))}}class b extends m{constructor(){super(...arguments);this.type="min";this.value=Number.MAX_VALUE}_insertValue(w){this.value=Math.min(this.value,w)}merge(w){this.value=Math.min(this.value,w.value)}clone(){const w=new b(this.field);w.value=this.value;return w}}class f extends m{constructor(){super(...arguments);
this.type="max";this.value=Number.MIN_VALUE}_insertValue(w){this.value=Math.max(this.value,w)}merge(w){this.value=Math.max(this.value,w.value)}clone(){const w=new f(this.field);w.value=this.value;return w}}class c extends m{constructor(){super(...arguments);this.type="sum";this.value=0}_insertValue(w){this.value+=w}merge(w){this.value+=w.value}clone(){const w=new c(this.field);w.value=this.value;return w}}class h extends m{constructor(){super(...arguments);this.type="avg";this._count=this._total=
0}get value(){return this._total/this._count}_insertValue(w){this._total+=w;this._count+=1}merge(w){this._total+=w._total;this._count+=w._count}clone(){const w=new h(this.field);w._total=this._total;w._count=this._count;return w}}class n extends m{constructor(){super(...arguments);this.type="avg_angle";this._count=this._y=this._x=0}get value(){return 180/Math.PI*Math.atan2(this._y/this._count,this._x/this._count)}_insertValue(w){this._x+=Math.cos(w*g);this._y+=Math.sin(w*g);this._count+=1}merge(w){this._x+=
w._x;this._y+=w._y;this._count+=w._count}clone(){const w=new n(this.field);w._x=this._x;w._y=this._y;w._count=this._count;return w}}class d extends m{constructor(){super(...arguments);this._frequencies=new Map}get value(){let w=0,t;for(const [l,e]of this._frequencies.entries())e>w&&(w=e,t=l);return t}_insertValue(w){const t=this._frequencies.get(w);null==t?this._frequencies.set(w,1):this._frequencies.set(w,t+1)}merge(w){for(const [t,l]of w._frequencies.entries())w=this._frequencies.get(t),null==w?
this._frequencies.set(t,l):this._frequencies.set(t,w+l)}clone(){const w=new d(this.field);w._frequencies=new Map(this._frequencies);return w}}a.AccumulatedStatistics=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridSpatialIndex":function(){define(["exports","../../../../../core/unitUtils","./AAggregateSpatialIndex","./GridCell"],function(a,q,r,g){function p(b,f){return q.getMetersPerUnitForSR(b)*q.inchesPerMeter*96/f}class m extends r.AAggregateSpatialIndex{constructor(b){super(b);
this._cells=new Map;this._pixelsPerMapUnit=p(b.spatialReference,b.scale)}put(b){for(const f of this._cells.values()){const c=b.get(f.id);c?c.merge(f):b.set(f.id,f.clone())}}putBounded(b,f,c){const [h,n,d,w]=[f.xmin,f.ymin,f.xmax,f.ymax];f=Math.floor(h*this._pixelsPerMapUnit/this._options.cellSize);var t=Math.floor(n*this._pixelsPerMapUnit/this._options.cellSize);c=Math.ceil(d*this._pixelsPerMapUnit/this._options.cellSize);const l=Math.ceil(w*this._pixelsPerMapUnit/this._options.cellSize);for(;t<=
l;t++)for(let e=f;e<=c;e++){const u=this._cells.get(`${e}.${t}`);if(!u)continue;const x=b.get(u.id);x?u&&!b.has(u.id)&&x.merge(u):b.set(u.id,u.clone())}}_insert(b,f,c,h){this._getCellOrCreate(Math.floor(f*this._pixelsPerMapUnit/this._options.cellSize),Math.floor(c*this._pixelsPerMapUnit/this._options.cellSize)).insert(b,h,f,c)}_getCellOrCreate(b,f){const c=g.GridCell.createId(b,f);let h=this._cells.get(c);h||(h=g.GridCell.create(b,f,this._options.fields,1*this._options.cellSize/this._pixelsPerMapUnit),
this._cells.set(c,h));return h}}a.GridSpatialIndex=m;a.pixelsPerMapUnit=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AAggregateSpatialIndex":function(){define(["exports","../../../engine/webgl/definitions"],function(a,q){class r{constructor(g){this._options=g}insert(g,p){g=g.getCursor();const m={$view:{scale:this._options.scale,timeZone:this._options.timeZone}};for(;g.next();)this._insertFeature(g,m,p)}_insertFeature(g,p,m){var {featureFilter:b}=
this._options;if(null===b||b.check(g)){var f=b=0;if("esriGeometryPoint"===g.geometryType)b=g.readXWorldSpace(),f=g.readYWorldSpace();else{if(m){m=g.readCentroidForDisplay();if(null==m)return;const [c,h]=m.coords;if(0>c||c>q.tileSize||0>h||h>q.tileSize)return}m=g.readCentroidWorldSpace();if(null==m)return;b=m.coords[0];f=m.coords[1]}this._insert(g,b,f,p)}}}a.AAggregateSpatialIndex=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/support/WithDisplayId":function(){define(["exports"],
function(a){class q{constructor(r,g){this.inner=r;this.displayId=g}}a.WithDisplayId=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/FeatureUpdateStrategy":function(){define(["exports","./AProcessorStrategy","../sources/FeatureSourceMessage","../sources/strategies/chunks/OverrideChunk"],function(a,q,r,g){class p extends q.ASendState{}class m extends q.AProcessorStrategy{constructor(b,f,c){super(b,f);this._timeZone=c;this.handledChunks=new Set;
this.handledChunksForIdCreation=new Set;this.handledChunksForAttributeData=new Set;this._streamLayerDeferredObjectIdsToRemove=[]}destroy(){super.destroy();for(const b of this._source.chunks())this._cleanupChunkIds(b)}invalidateAttributeData(){this.handledChunksForAttributeData.clear()}onSubscribe(b){super.onSubscribe(b);this._evalOptions=b.tile.createArcadeEvaluationOptions(this._timeZone)}createState(b){return new p(b)}get aggregateQueryEngine(){return null}displayMap(b,f,c){b=new Map(b.map(d=>[f(d),
d]));const h=[];for(const d of this._source.chunks()){const w=d.reader.getCursor();for(;w.next();){const t=w.getObjectId();var n=w.getDisplayId();const l=b.get(t);null!=l&&(n=c(n,l,t),h.push(n),b.delete(t))}}return h}getDisplayFeatures(b){b=new Set(b);const f=new Set,c=[];for(const h of this._source.chunks()){const n=h.reader.getCursor();for(;n.next();){const d=n.getObjectId(),w=n.getDisplayId();b.has(w)&&!f.has(d)&&(c.push({...n.readLegacyFeatureWorldSpace(),displayId:w}),f.add(d))}}return{features:c,
aggregates:[]}}async *applyLocalEdit(b){for(var f=[],c=b.reader.getCursor();c.next();){var h=c.getObjectId();f.push(h);h=this._attributeStore.createDisplayIdForObjectId(h);c.setDisplayId(h);this._attributeStore.setAttributeData(h,c,this._evalOptions)}h=this.getDisplayIds(f);f=this.getDisplayIds(b.removed);c=new g.OverrideChunk(this._source.metadata,"localEdit");c.applyOverrides(b);this.handledChunks.add(c.chunkId);this.handledChunksForAttributeData.add(c.chunkId);this.handledChunksForIdCreation.add(c.chunkId);
for(var n of this._sendStates.values())n.handledChunks.add(c.chunkId),yield new r.FeatureTileUpdateMessage(n.subscription,null,h,!1,c.queryInfo);for(const d of this._sendStates.values())n=c.getTileReader(d.subscription.tile),yield new r.FeatureTileUpdateMessage(d.subscription,n,f,!1,c.queryInfo);for(const d of b.removed)this._attributeStore.releaseDisplayIdForObjectId(d)}async *updateChunks(){if(this._source.chunks().length){await this._updateAttributeData();for(const b of this._sendStates.values())yield*this._update(b)}}removeChunks(b){for(const f of b)this.handledChunks.delete(f.chunkId),
this.handledChunksForAttributeData.delete(f.chunkId),this._cleanupChunkIds(f)}afterUpdateChunks(){for(const b of this._streamLayerDeferredObjectIdsToRemove)this._attributeStore.releaseDisplayIdForObjectId(b);this._streamLayerDeferredObjectIdsToRemove=[]}_cleanupChunkIds(b){if(this.handledChunksForIdCreation.has(b.chunkId)){const f=b.reader.getCursor();for(;f.next();){const c=f.getObjectId();this._source.isStream?this._streamLayerDeferredObjectIdsToRemove.push(c):this._attributeStore.releaseDisplayIdForObjectId(c)}this.handledChunksForIdCreation.delete(b.chunkId)}}async _updateAttributeData(){for(var b of this._source.chunks()){const {chunkId:c,
reader:h}=b;if(!this.handledChunksForIdCreation.has(c)){this.handledChunksForIdCreation.add(c);for(var f=h.getCursor();f.next();){const n=this._attributeStore.createDisplayIdForObjectId(f.getObjectId());f.setDisplayId(n)}}}for(const c of this._source.chunks())if(!this.handledChunksForAttributeData.has(c.chunkId))for(this.handledChunksForAttributeData.add(c.chunkId),b=c.reader.getCursor();b.next();)f=b.getDisplayId(),this._attributeStore.setAttributeData(f,b,this._evalOptions)}*_update(b){const {subscription:f,
handledChunks:c}=b;for(const n of this._source.chunks()){var {chunkId:h}=n;c.has(h)||(c.add(h),(h=n.getTileReader(f.tile))&&(yield new r.FeatureTileAppendMessage(b.subscription,h,!1,n.end,n.queryInfo)))}}}a.DefaultSendState=p;a.FeatureUpdateStrategy=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/OverrideChunk":function(){define(["exports","./ASourceChunk","../../../support/FeatureSetReaderJSON"],function(a,q,r){class g extends q.ASourceChunk{constructor(p,
m){super();this.metadata=p;this.removed=new Set;this.overriddenIds=new Set;this._features=[];this.normalizedChunkId=this.chunkId=m}get reader(){return r.FeatureSetReaderJSON.fromOptimizedFeatures(this._features,this.metadata)}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}applyOverrides(p){super.invalidate();const {reader:m,removed:b}=p;p=[];const f=new Set;var c=m.getCursor();const h=new Set(b);for(this.overriddenIds.clear();c.next();){const n=c.readOptimizedFeatureWorldSpace(),
d=n.objectId;p.push(n);f.add(d);this.overriddenIds.add(d);this.removed.delete(d)}for(const n of this._features)c=n.objectId,h.has(c)||f.has(c)||(p.push(n),this.overriddenIds.add(c));this._features=p;for(const n of f.values())this.removed.delete(n);for(const n of b)this.removed.add(n),this.overriddenIds.add(n)}removeOverrides(p){this.invalidate();p=p.reader.getCursor();const m=new Set;for(;p.next();){const b=p.getObjectId();this.overriddenIds.has(b)&&(m.add(b),this.overriddenIds.delete(b))}this._features=
this._features.filter(b=>!m.has(b.objectId))}getTileReader(p){if(!this._features.length)return null;const m=this.queryFeaturesInBounds(p.bounds);m.setTransformForDisplay(p.transform);return m}}a.OverrideChunk=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/ASourceChunk":function(){define(["exports","../../../FeatureSpatialIndex","../../../aggregation/GeohashSpatialIndex","../../../aggregation/GridSpatialIndex","../../../support/FeatureSetReaderIndirect"],
function(a,q,r,g,p){class m{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._spatialIndex=this._aggregateIndexHash=this._aggregateIndex=null}queryFeaturesInBounds(b){b=this._getSpatialIndex().search(b);return p.FeatureSetReaderIndirect.from(this.reader,b)}getAggregateIndex(b){const f=JSON.stringify(b);if(f!==this._aggregateIndexHash){this._aggregateIndexHash=f;switch(b.type){case "grid":this._aggregateIndex=new g.GridSpatialIndex(b);break;case "geohash":this._aggregateIndex=
new r.GeohashSpatialIndex(b)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}_getSpatialIndex(){this._spatialIndex||(this._spatialIndex=q.FeatureSpatialIndex.fromReader(this.reader));return this._spatialIndex}}a.ASourceChunk=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSpatialIndex":function(){define(["exports","../../../../chunks/rbush","../../../../geometry/support/aaBoundingBox"],function(a,q,r){class g{static fromReader(p){const m=
[],b=p.copy();for(p=r.create();b.next();)b.getBounds(p)&&m.push(b.getIndex());p=q.rbush(9,f=>{b.setIndex(f);return{minX:b.getBoundsXMin(),minY:b.getBoundsYMin(),maxX:b.getBoundsXMax(),maxY:b.getBoundsYMax()}});p.load(m);return new g(p)}constructor(p){this._index=p}search(p){return this._index.search({minX:p[0],minY:p[1],maxX:p[2],maxY:p[3]})}}a.FeatureSpatialIndex=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/rbush":function(){define(["exports","./quickselect"],function(a,
q){function r(l,e){if(!(this instanceof r))return new r(l,e);this._maxEntries=Math.max(4,l||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));e&&("function"===typeof e?this.toBBox=e:this._initFormat(e));this.clear()}function g(l,e){p(l,0,l.children.length,e,l)}function p(l,e,u,x,y){y||=w(null);y.minX=Infinity;y.minY=Infinity;y.maxX=-Infinity;y.maxY=-Infinity;for(var A;e<u;e++)A=l.children[e],m(y,l.leaf?x(A):A);return y}function m(l,e){l.minX=Math.min(l.minX,e.minX);l.minY=Math.min(l.minY,
e.minY);l.maxX=Math.max(l.maxX,e.maxX);l.maxY=Math.max(l.maxY,e.maxY);return l}function b(l,e){return l.minX-e.minX}function f(l,e){return l.minY-e.minY}function c(l){return(l.maxX-l.minX)*(l.maxY-l.minY)}function h(l){return l.maxX-l.minX+(l.maxY-l.minY)}function n(l,e){return l.minX<=e.minX&&l.minY<=e.minY&&e.maxX<=l.maxX&&e.maxY<=l.maxY}function d(l,e){return e.minX<=l.maxX&&e.minY<=l.maxY&&e.maxX>=l.minX&&e.maxY>=l.minY}function w(l){return{children:l,height:1,leaf:!0,minX:Infinity,minY:Infinity,
maxX:-Infinity,maxY:-Infinity}}function t(l,e,u,x,y){for(var A=[e,u],k;A.length;)u=A.pop(),e=A.pop(),u-e<=x||(k=e+Math.ceil((u-e)/x/2)*x,q.quickselect(l,k,e,u,y),A.push(e,k,k,u))}r.prototype={all:function(){return this._all(this.data,[])},search:function(l){var e=this.data,u=[],x=this.toBBox;if(!d(l,e))return u;for(var y=[],A,k,v,B;e;){A=0;for(k=e.children.length;A<k;A++)v=e.children[A],B=e.leaf?x(v):v,d(l,B)&&(e.leaf?u.push(v):n(l,B)?this._all(v,u):y.push(v));e=y.pop()}return u},collides:function(l){var e=
this.data,u=this.toBBox;if(!d(l,e))return!1;for(var x=[],y,A,k,v;e;){y=0;for(A=e.children.length;y<A;y++)if(k=e.children[y],v=e.leaf?u(k):k,d(l,v)){if(e.leaf||n(l,v))return!0;x.push(k)}e=x.pop()}return!1},load:function(l){if(!l||!l.length)return this;if(l.length<this._minEntries){for(var e=0,u=l.length;e<u;e++)this.insert(l[e]);return this}l=this._build(l.slice(),0,l.length-1,0);this.data.children.length?this.data.height===l.height?this._splitRoot(this.data,l):(this.data.height<l.height&&(e=this.data,
this.data=l,l=e),this._insert(l,this.data.height-l.height-1,!0)):this.data=l;return this},insert:function(l){null!=l&&this._insert(l,this.data.height-1);return this},clear:function(){this.data=w([]);return this},remove:function(l,e){if(null==l)return this;for(var u=this.data,x=this.toBBox(l),y=[],A=[],k,v,B,z;u||y.length;){u||(u=y.pop(),v=y[y.length-1],k=A.pop(),z=!0);if(u.leaf){a:{B=l;var E=u.children,K=e;if(K){for(var I=0;I<E.length;I++)if(K(B,E[I])){B=I;break a}B=-1}else B=E.indexOf(B)}if(-1!==
B){u.children.splice(B,1);y.push(u);this._condense(y);break}}z||u.leaf||!n(u,x)?v?(k++,u=v.children[k],z=!1):u=null:(y.push(u),A.push(k),k=0,v=u,u=u.children[0])}return this},toBBox:function(l){return l},compareMinX:b,compareMinY:f,toJSON:function(){return this.data},fromJSON:function(l){this.data=l;return this},_all:function(l,e){for(var u=[];l;)l.leaf?e.push.apply(e,l.children):u.push.apply(u,l.children),l=u.pop();return e},_build:function(l,e,u,x){var y=u-e+1,A=this._maxEntries;if(y<=A){var k=
w(l.slice(e,u+1));g(k,this.toBBox);return k}x||(x=Math.ceil(Math.log(y)/Math.log(A)),A=Math.ceil(y/Math.pow(A,x-1)));k=w([]);k.leaf=!1;k.height=x;y=Math.ceil(y/A);A=y*Math.ceil(Math.sqrt(A));var v;for(t(l,e,u,A,this.compareMinX);e<=u;e+=A){var B=Math.min(e+A-1,u);t(l,e,B,y,this.compareMinY);for(v=e;v<=B;v+=y){var z=Math.min(v+y-1,B);k.children.push(this._build(l,v,z,x-1))}}g(k,this.toBBox);return k},_chooseSubtree:function(l,e,u,x){for(var y,A,k,v,B,z,E,K;;){x.push(e);if(e.leaf||x.length-1===u)break;
E=K=Infinity;y=0;for(A=e.children.length;y<A;y++)k=e.children[y],B=c(k),z=(Math.max(k.maxX,l.maxX)-Math.min(k.minX,l.minX))*(Math.max(k.maxY,l.maxY)-Math.min(k.minY,l.minY))-B,z<K?(K=z,E=B<E?B:E,v=k):z===K&&B<E&&(E=B,v=k);e=v||e.children[0]}return e},_insert:function(l,e,u){var x=this.toBBox;u=u?l:x(l);x=[];var y=this._chooseSubtree(u,this.data,e,x);y.children.push(l);for(m(y,u);0<=e;)if(x[e].children.length>this._maxEntries)this._split(x,e),e--;else break;this._adjustParentBBoxes(u,x,e)},_split:function(l,
e){var u=l[e],x=u.children.length,y=this._minEntries;this._chooseSplitAxis(u,y,x);x=this._chooseSplitIndex(u,y,x);x=w(u.children.splice(x,u.children.length-x));x.height=u.height;x.leaf=u.leaf;g(u,this.toBBox);g(x,this.toBBox);e?l[e-1].children.push(x):this._splitRoot(u,x)},_splitRoot:function(l,e){this.data=w([l,e]);this.data.height=l.height+1;this.data.leaf=!1;g(this.data,this.toBBox)},_chooseSplitIndex:function(l,e,u){var x,y;var A=y=Infinity;for(x=e;x<=u-e;x++){var k=p(l,0,x,this.toBBox);var v=
p(l,x,u,this.toBBox);var B=Math.max(0,Math.min(k.maxX,v.maxX)-Math.max(k.minX,v.minX))*Math.max(0,Math.min(k.maxY,v.maxY)-Math.max(k.minY,v.minY));k=c(k)+c(v);if(B<A){A=B;var z=x;y=k<y?k:y}else B===A&&k<y&&(y=k,z=x)}return z},_chooseSplitAxis:function(l,e,u){var x=l.leaf?this.compareMinX:b,y=l.leaf?this.compareMinY:f,A=this._allDistMargin(l,e,u,x);e=this._allDistMargin(l,e,u,y);A<e&&l.children.sort(x)},_allDistMargin:function(l,e,u,x){l.children.sort(x);x=this.toBBox;var y=p(l,0,e,x),A=p(l,u-e,u,
x),k=h(y)+h(A),v;for(v=e;v<u-e;v++){var B=l.children[v];m(y,l.leaf?x(B):B);k+=h(y)}for(v=u-e-1;v>=e;v--)B=l.children[v],m(A,l.leaf?x(B):B),k+=h(A);return k},_adjustParentBBoxes:function(l,e,u){for(;0<=u;u--)m(e[u],l)},_condense:function(l){for(var e=l.length-1,u;0<=e;e--)0===l[e].children.length?0<e?(u=l[e-1].children,u.splice(u.indexOf(l[e]),1)):this.clear():g(l[e],this.toBBox)},_initFormat:function(l){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(l[0]));this.compareMinY=
new Function("a","b",e.join(l[1]));this.toBBox=new Function("a","return {minX: a"+l[0]+", minY: a"+l[1]+", maxX: a"+l[2]+", maxY: a"+l[3]+"};")}};a.rbush=r})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,q){var r={exports:{}};(function(g){(function(p){p=p();void 0!==p&&(g.exports=p)})(function(){function p(f,c,h,n,d){for(;n>h;){if(600<n-h){var w=n-h+1,t=c-h+1,l=Math.log(w),e=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*e*(w-e)/w)*(0>t-w/2?-1:1);p(f,c,Math.max(h,Math.floor(c-
t*e/w+l)),Math.min(n,Math.floor(c+(w-t)*e/w+l)),d)}w=f[c];t=h;e=n;m(f,h,c);for(0<d(f[n],w)&&m(f,h,n);t<e;){m(f,t,e);t++;for(e--;0>d(f[t],w);)t++;for(;0<d(f[e],w);)e--}0===d(f[h],w)?m(f,h,e):(e++,m(f,e,n));e<=c&&(h=e+1);c<=e&&(n=e-1)}}function m(f,c,h){var n=f[c];f[c]=f[h];f[h]=n}function b(f,c){return f<c?-1:f>c?1:0}return function(f,c,h,n,d){p(f,c,h||0,n||f.length-1,d||b)}})})(r);q=q.getDefaultExportFromCjs(r.exports);a.quickselect=q})},"esri/views/2d/layers/features/aggregation/GeohashSpatialIndex":function(){define(["exports",
"../../../../../geohash/GeohashTree","../../../../../geohash/geohashUtils","./AAggregateSpatialIndex"],function(a,q,r,g){class p extends g.AAggregateSpatialIndex{constructor(m){super(m);this._tree=new q.GeohashTree(this._options.fields)}put(m){throw Error("Geohash tree does not support put");}putBounded(m,b,f){const {geohashLevel:c,spatialReference:h}=this._options;b=r.getGeohashBounds(b,f,c,h);null!=b&&this._tree.putBins(m,b)}_insert(m,b,f,c){const {geohashLevel:h,spatialReference:n}=this._options,
d=r.getGeohash(b,f,h,n);d&&this._tree.insert(m,b,f,d[0],d[1],h,c)}}a.GeohashSpatialIndex=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashTree":function(){define(["exports","./GeohashCell"],function(a,q){class r{constructor(g){this._fields=g;this._depth=this._size=0;this._root=q.GeohashCell.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}find(g,p,m){return this._root.find(g,p,m,0,0,0)}insert(g,p,m,b,f,c,h){let n=
this._root,d=0,w=0,t=0;for(;null!==n;){n.insert(g,p,m,b,f,h);if(d>=c)break;var l=Math.ceil((d+1)/2),e=Math.floor((d+1)/2);const x=1-d%2;var u=30-(3*l+2*e);l=30-(2*l+3*e);u=(b&7*x+3*(1-x)<<u)>>u;l=(f&3*x+7*(1-x)<<l)>>l;e=u+l*(8*x+4*(1-x));const y=2*x+3*(1-x);w=w<<3*x+2*(1-x)|u;t=t<<y|l;null==n.children[e]&&(n.children[e]=q.GeohashCell.create(this._fields,w,t,d+1),this._depth=Math.max(this._depth,d+1),this._size+=1);d+=1;n=n.children[e]}}putBins(g,p){for(const m of this.getNodes(p))(p=g.get(m.id))?
p.merge(m):g.set(m.id,m.clone())}getNodes(g){const p=[],{geohashBounds:m,level:b}=g;for(g=this._root;null!==g;){var f=g.depth,c=g.xNode,h=g.yNode;if(f>=b)p.push(g),g=g.next;else{var n=Math.ceil((f+1)/2),d=Math.floor((f+1)/2);f=1-f%2;var w=30-(3*n+2*d),t=30-(2*n+3*d),l=~((1<<w)-1),e=~((1<<t)-1);c<<=3*f+2*(1-f);h<<=2*f+3*(1-f);n=Math.max(c,(m.xLL&l)>>w);d=Math.max(h,(m.yLL&e)>>t);w=Math.min(c+8*f+4*(1-f),(m.xTR&l)>>w);t=Math.min(h+4*f+8*(1-f),(m.yTR&e)>>t);for(l=e=null;d<=t;d++)for(let u=n;u<=w;u++){const x=
g.children[u-c+(d-h)*(8*f+4*(1-f))];x&&(e||(e=x,e.next=g.next),l&&(l.next=x),l=x,x.next=g.next)}g=e||g.next}}return p}}a.GeohashTree=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashCell":function(){define("exports ./geohashUtils ../geometry/SpatialReference ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport ../views/2d/layers/features/aggregation/AAggregateCell ../views/2d/layers/features/aggregation/AccumulatedStatistics".split(" "),
function(a,q,r,g,p,m,b,f){class c extends b.AAggregateCell{static create(h,n,d,w){h=f.AccumulatedStatistics.create(h);const t=Array(32);for(let l=0;l<t.length;l++)t[l]=null;return new c(h,n,d,w,t)}constructor(h,n,d,w,t){super(h);this.xNode=n;this.yNode=d;this.depth=w;this.children=t;this._objectIds=new Set;this._yGeohashTotal=this._xGeohashTotal=this._yWorldTotal=this._xWorldTotal=this._count=0;this.next=null}get id(){return`${this.xNode}.${this.yNode}`}get containedObjectIds(){return this._objectIds}get count(){return this._count}clone(){const h=
new c(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);h._count=this._count;h._xWorldTotal=this._xWorldTotal;h._yWorldTotal=this._yWorldTotal;h._xGeohashTotal=this._xGeohashTotal;h._yGeohashTotal=this._yGeohashTotal;h.next=this.next;h._objectIds=new Set(this._objectIds);return h}insert(h,n,d,w,t,l){this._count+=1;this._xWorldTotal+=n;this._yWorldTotal+=d;this._xGeohashTotal+=w;this._yGeohashTotal+=t;this._statistics.insert(h,l);this._objectIds.add(h.getObjectId())}merge(h){if(0!==
h._count){this._count+=h._count;this._xWorldTotal+=h._xWorldTotal;this._yWorldTotal+=h._yWorldTotal;this._xGeohashTotal+=h._xWorldTotal;this._yGeohashTotal+=h._yWorldTotal;this._statistics.merge(h._statistics);for(const n of h._objectIds.values())this._objectIds.add(n)}}getCentroid(h){throw Error("getCentroid not supported for GeohashNode");}getGeometry(h,n){const d=this._getLngLatBounds(),[w,t,l,e]=d;h=m.project({rings:[[[w,t],[w,e],[l,e],[l,t],[w,t]]]},r.WGS84,h);h=g.convertFromPolygon(new p,h,
!1,!1);return null!=n?g.quantizeOptimizedGeometry(new p,h,!1,!1,"esriGeometryPolygon",n,!1,!1):h}getGeometricCentroid(h,n){const d=this._getLngLatBounds(),[w,t,l,e]=d;h=m.project({x:(w+l)/2,y:(t+e)/2},r.WGS84,h);h=g.convertFromPoint(new p,h);return null!=n?g.quantizeOptimizedGeometry(new p,h,!1,!1,"esriGeometryPoint",n,!1,!1):h}getAttributes(){const h={aggregateId:this.id};for(const n of this._statistics.values())h[n.field.name]=n.value;h.aggregateCount=this._count;return h}find(h,n,d,w,t,l){if(w>=
d)return this;var e=1-w%2;const u=3*e+2*(1-e),x=2*e+3*(1-e),y=30-t-u,A=30-l-x;e=this.children[((h&7*e+3*(1-e)<<y)>>y)+((n&3*e+7*(1-e)<<A)>>A)*(8*e+4*(1-e))];return null==e?null:e.find(h,n,d,w+1,t+u,l+x)}_getLngLatBounds(){var h=this.depth;const n=Math.ceil(h/2);h=Math.floor(h/2);return q.decodeGeohashXY({geohashX:this.xNode<<30-(3*n+2*h),geohashY:this.yNode<<30-(2*n+3*h)},this.depth)}}a.GeohashCell=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/geohashUtils":function(){define("exports ../core/has ../core/mathUtils ../geometry/Extent ../geometry/Polygon ../geometry/SpatialReference ../geometry/support/Ellipsoid ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(v,B,z,E){if(E.isWebMercator)return v=r.rad2deg(v/b.earth.radius),v-=360*Math.floor((v+180)/360),B=r.rad2deg(Math.PI/2-2*Math.atan(Math.exp(-B/b.earth.radius))),E=[0,0],e(E,0,B,v,z),E;B=h.project({x:v,y:B},E,m.WGS84);if(!B)return null;v=[0,0];e(v,0,B.y,B.x,z);return v}function d(v){return 57>=v?v-48:104>=v?v-88:107>=v?v-89:110>=v?v-90:v-91}function w(v,B,z){v[0]=B;v[1]=z;return v}function t(v,B){const z=(v[0]+v[1])/2,E=!B;v[0]=E*v[0]+B*z;v[1]=E*z+B*v[1]}function l(v,
B){B=B>(v[0]+v[1])/2;t(v,B);return B}function e(v,B,z,E,K){K%2&&(K+=1);let I=0,D=0,G=-90,C=90,F=-180,J=180;for(let M=0;M<K/2;M++){for(var T=0;5>T;T++){var S=(F+J)/2,ba=E>S?1:0;I|=ba<<29-(T+5*M);F=(1-ba)*F+ba*S;J=(1-ba)*S+ba*J}for(T=0;5>T;T++)S=(G+C)/2,ba=z>S?1:0,D|=ba<<29-(T+5*M),G=(1-ba)*G+ba*S,C=(1-ba)*S+ba*C}v[2*B]=I;v[2*B+1]=D}function u(v,B){return B?1&v|(4&v)>>1|(16&v)>>2:(2&v)>>1|(8&v)>>2}function x(v,B){return B?(2&v)>>1|(8&v)>>2:1&v|(4&v)>>1|(16&v)>>2}function y(v,B,z){var E=!((v.length-
1)%2);const K=v.substring(0,v.length-1);var I=d(v.charCodeAt(v.length-1)),D=0,G=0;let C=0;var F=0;E?(D=8,G=4,C=1&I|(4&I)>>1|(16&I)>>2,F=(2&I)>>1|(8&I)>>2):(D=4,G=8,F=1&I|(4&I)>>1|(16&I)>>2,C=(2&I)>>1|(8&I)>>2);B=C+B;I=F+z;z=Math.floor(B/D);F=Math.floor(I/G);D=B-z*D;G=I-F*G;E="0123456789bcdefghjkmnpqrstuvwxyz"[E?D&1|(G&1)<<1|(D&2)<<1|(G&2)<<2|(D&4)<<2:G&1|(D&1)<<1|(G&2)<<1|(D&2)<<2|(G&4)<<2];return 1<v.length&&(z||F)?y(K,z,F)+E:K+E}const A=new Float64Array(2),k=new Float64Array(2);a.convertGeohash32ToXY=
function(v,B){let z=v=0,E=30,K=30;for(let G=0;G<B.length;G++){var I=B.charCodeAt(G),D=d(I);I=0===G%2;const C=u(D,I);D=x(D,I);E-=I?3:2;K-=I?2:3;v|=C<<E;z|=D<<K}return{geohashX:v,geohashY:z}};a.decodeBase32Char=d;a.decodeGeohash=function(v,B){const z=w(A,-90,90),E=w(k,-180,180);for(let I=0;I<B.length;I++){var K=B.charCodeAt(I);K=d(K);0===I%2?(t(E,!!(16&K)),t(E,!!(4&K)),t(E,!!(1&K)),t(z,!!(8&K)),t(z,!!(2&K))):(t(z,!!(16&K)),t(z,!!(4&K)),t(z,!!(1&K)),t(E,!!(8&K)),t(E,!!(2&K)))}v[0]=(z[0]+z[1])/2;v[1]=
(E[0]+E[1])/2;return v};a.decodeGeohashXY=function(v,B){let z=-90,E=90,K=-180,I=180;for(let T=0;T<B;T++){var D=Math.ceil((T+1)/2),G=Math.floor((T+1)/2),C=1-T%2,F=30-(3*D+2*G),J=30-(2*D+3*G);G=3*C+2*(1-C);D=2*C+3*(1-C);F=(7*C+3*(1-C)<<F&v.geohashX)>>F;C=(3*C+7*(1-C)<<J&v.geohashY)>>J;for(--G;0<=G;G--){J=(K+I)/2;const S=F&1<<G?1:0;K=(1-S)*K+S*J;I=(1-S)*J+S*I}for(--D;0<=D;D--)F=(z+E)/2,G=C&1<<D?1:0,z=(1-G)*z+G*F,E=(1-G)*F+G*E}return[K,z,I,E]};a.encodeBase32Char=function(v){return"0123456789bcdefghjkmnpqrstuvwxyz"[v]};
a.encodeGeohash=function(v,B,z){let E="";const K=w(A,-90,90),I=w(k,-180,180);for(let D=0;D<z;D++){let G=0;D%2?(G|=l(K,v)<<4,G|=l(I,B)<<3,G|=l(K,v)<<2,G|=l(I,B)<<1,G|=l(K,v)<<0):(G|=l(I,B)<<4,G|=l(K,v)<<3,G|=l(I,B)<<2,G|=l(K,v)<<1,G|=l(I,B)<<0);E+="0123456789bcdefghjkmnpqrstuvwxyz"[G]}return E};a.getGeohash=n;a.getGeohashBounds=function(v,B,z,E){v=[v.xmin,v.ymin,v.xmax,v.ymax];var K=p.fromExtent(g.fromBounds(v,E));B=h.project(K,E,m.WGS84,{densificationStep:64*B});if(!B)return null;B=f.convertFromPolygon(new c,
B,!1,!1);K=B.coords.filter((D,G)=>!(G%2));var I=B.coords.filter((D,G)=>G%2);B=Math.min(...K);E=Math.min(...I);K=Math.max(...K);I=Math.max(...I);B=n(B,E,z,m.WGS84);E=n(K,I,z,m.WGS84);return B&&E?{bounds:v,geohashBounds:{xLL:B[0],yLL:B[1],xTR:E[0],yTR:E[1]},level:z}:null};a.getRelativeGeohash=y;a.setGeohashBuf=e;a.setGeohashXY=function(v,B,z,E){E%2&&(E+=1);let K=0,I=0,D=-90,G=90,C=-180,F=180;for(let ba=0;ba<E/2;ba++){for(var J=0;5>J;J++){var T=(C+F)/2,S=z>T?1:0;K|=S<<29-(J+5*ba);C=(1-S)*C+S*T;F=(1-
S)*T+S*F}for(J=0;5>J;J++)T=(D+G)/2,S=B>T?1:0,I|=S<<29-(J+5*ba),D=(1-S)*D+S*T,G=(1-S)*T+S*G}v.geohashX=K;v.geohashY=I};a.unpackXBits=u;a.unpackYBits=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderIndirect":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetReader"],function(a,q,r,g){class p extends g.FeatureSetReader{static from(m,
b){return new p(m.copy(),b)}constructor(m,b){super(m.metadata);this._currentIndex=-1;this._displayTranslationY=this._displayTranslationX=0;this._displayScaleY=this._displayScaleX=1;this._reader=m;this._indices=b;this._isPoint="esriGeometryPoint"===m.geometryType}setTransformForDisplay(m){const b=this._reader.getInTransform();if(null==b){const [e,u]=m.scale,[x,y]=m.translate;this._displayTranslationX=-x/e;this._displayScaleX=1/e;this._displayTranslationY=y/u;this._displayScaleY=1/-u}else{var [f,c]=
b.scale,[h,n]=b.translate,[d,w]=m.scale,[t,l]=m.translate;this._displayScaleX=f/d;this._displayTranslationX=(h-t)/d;this._displayScaleY=c/w;this._displayTranslationY=(-n+l)/w;if(!this._isPoint&&b)throw Error("InternalError: Relative transformations not supported for non-point features");}this._displayTransform=m}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const m=
new p(this._reader.copy(),this._indices);m._currentIndex=this._currentIndex;m._displayTransform=this._displayTransform;m._displayTranslationX=this._displayTranslationX;m._displayTranslationY=this._displayTranslationY;m._displayScaleX=this._displayScaleX;m._displayScaleY=this._displayScaleY;return m}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(m){this._reader.contextTimeZone=m}_nextIndex(){return++this._currentIndex<this._indices.length?(this._reader.setIndex(this._indices[this._currentIndex]),
!0):!1}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}readYForDisplay(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}readGeometryForDisplay(){const m=this._reader.readGeometryForDisplay();if(!this._displayTransform)return m;const b=new r;q.quantizeOptimizedGeometry(b,m,this.hasZ,this.hasM,this.geometryType,
this._displayTransform);return b.deltaDecode()}readCentroidForDisplay(){const m=this._reader.readCentroidForDisplay()?.clone();if(m){const [b,f]=m.coords;m.coords[0]=b*this._displayScaleX+this._displayTranslationX;m.coords[1]=f*this._displayScaleY+this._displayTranslationY}return m}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(m,
b=!1){return this._reader.readAttribute(m,b)}readAttributes(){return this._reader.readAttributes()}joinAttributes(m){return this._reader.joinAttributes(m)}getBounds(m){return this._reader.getBounds(m)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(m){return this._reader.setDisplayId(m)}setIndex(m){return this._reader.setIndex(m)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){const m=
this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(m&&{x:m.coords[0],y:m.coords[1]})??null}}readLegacyGeometryForDisplay(){const m=this.readGeometryForDisplay();return q.convertToGeometry(m,this.geometryType,!1,!1)}readGeometryArea(){return this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(m,b){throw Error("Error: Should not be called. Underlying _reader should be used instead");
}_readAttributes(){throw Error("Error: Should not be called. Underlying _reader should be used instead");}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(m){return this._reader.field(m)}hasField(m){return this._reader.hasField(m)}setField(m,b){return this._reader.setField(m,b)}keys(){return this._reader.keys()}castToText(m=!1){return this._reader.castToText(m)}}a.FeatureSetReaderIndirect=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../engine/highlightReasons ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./DisplayIdGenerator ./FeatureFilter ../../../../webgl/enums".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t){function l(k,v){if(!k||!v)return k;switch(v){case "radius":case "distance":return 2*k;case "area":return Math.sqrt(k)}return k}const e=()=>g.getLogger("esri.views.layers.2d.features.support.AttributeStore"),u=n.createDebugLogger(n.DEBUG_ATTR_UPDATES,e());var x=r("esri-shared-array-buffer");r("esri-atomics");class y{constructor(k,v,B){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:z,layout:E,textureOnly:K}=v;this.textureOnly=K||!1;
this.pixelType=z;this.layout=E;this._resetRange();this.size=k;this.isLocal=B;K||(this.data=this._initData(z,k))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(k,v){const B=this.data;for(let z=0;z<this.size*this.size;z++)B[z*this.texelSize+k]&=~v;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(k,v){const B=this.data;for(let z=0;z<this.size*this.size;z++)B[z*this.texelSize+k]|=255&v;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(k,v,B){const z=
this.data;for(const E of B)z[E*this.texelSize+k]|=v,this.dirtyStart=Math.min(this.dirtyStart,E),this.dirtyEnd=Math.max(this.dirtyEnd,E)}setComponentTexel(k,v,B){this.data[B*this.texelSize+k]|=v;this.dirtyStart=Math.min(this.dirtyStart,B);this.dirtyEnd=Math.max(this.dirtyEnd,B)}unsetComponentTexel(k,v,B){this.data[B*this.texelSize+k]&=~v;this.dirtyStart=Math.min(this.dirtyStart,B);this.dirtyEnd=Math.max(this.dirtyEnd,B)}getData(k,v){k=f.getDisplayIdTexel(k);return this.data[k*this.texelSize+v]}setData(k,
v,B){k=f.getDisplayIdTexel(k);0===(this.layout&1<<v)?e().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[k*this.texelSize+v]=B,this.dirtyStart=Math.min(this.dirtyStart,k),this.dirtyEnd=Math.max(this.dirtyEnd,k))}expand(k){this.size=k;this.textureOnly||(k=this._initData(this.pixelType,k),k.set(this.data),this.data=k)}toMessage(){const k=this.dirtyStart,v=this.dirtyEnd;var B=this.texelSize;if(k>v)return null;this._resetRange();const z=
this.pixelType,E=this.layout,K=this.data;B=!this.isLocal&&K.slice(k*B,(v+1)*B)||null;return{start:k,end:v,data:B,pixelType:z,layout:E}}_initData(k,v){var B=ArrayBuffer;k=c.getPixelArrayCtor(k);v=new k(new B(v*v*4*k.BYTES_PER_ELEMENT));for(B=0;B<v.length;B+=4)v[B+1]=255;return v}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class A{constructor(k){this._client=k;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=b.attributeStoreInitialSize;
this._idsToHighlight=new Map;this._initialized=this._referencesGeometry=this._referencesScale=!1;this.version=0;this._idGenerator=new d.DisplayIdGenerator;this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null==this._blockDescriptors){var k=t.PixelType.FLOAT;u(`Creating AttributeStore ${x?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:t.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:t.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:t.PixelType.UNSIGNED_BYTE,
layout:15,textureOnly:!0},{pixelType:k,layout:15},{pixelType:k,layout:15},{pixelType:k,layout:15},{pixelType:k,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return 0<this._idsToHighlight.size}createDisplayIdForObjectId(k){return this._idGenerator.createIdForObjectId(k)}releaseDisplayIdForObjectId(k){return this._idGenerator.releaseIdForObjectId(k)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(k,
v,B,z,E=0){const K=p.diff(this._schema,k);this.version=E;if(K&&(r("esri-2d-update-debug")&&console.debug(`Version[${E}] AttributeStore.update`,{changed:K}),this._schema=k,this._attributeComputeInfo=null,this._initialize(),null!=k))if(B&&(this._filters=await Promise.all(k.filters.map(I=>I?w.create({geometryType:B.geometryType,hasM:!1,hasZ:!1,timeInfo:B.timeInfo,fieldsIndex:B.fieldsIndex,spatialReference:z??B.spatialReference,filterJSON:I}):null))),"subtype"===k.type){this._attributeComputeInfo={isSubtype:!0,
subtypeField:k.subtypeField,map:new Map};this._referencesGeometry=this._referencesScale=!1;for(const I in k.bindings)await Promise.all(k.bindings[I].map(async D=>{D=await this._bind(v,D,parseInt(I,10));this._referencesGeometry=this._referencesGeometry||(D?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(D?.referencesScale()??!1)}))}else this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(k.bindings.map(async I=>{I=await this._bind(v,I);this._referencesGeometry=
this._referencesGeometry||(I?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(I?.referencesScale()??!1)}))}setHighlight(k,v){const B=this._getBlock(0);B.unsetComponentAllTexels(0,(1<<m.highlightReasons.length)-1);for(const {displayId:z,highlightFlags:E}of k){if(null==z)continue;const K=f.getDisplayIdTexel(z);B.setComponent(0,E,[K])}this._idsToHighlight.clear();for(const {objectId:z,highlightFlags:E}of k)this._idsToHighlight.set(z,E);for(const {objectId:z,highlightFlags:E}of v)this._idsToHighlight.set(z,
E)}setData(k,v,B,z){const E=f.getDisplayIdTexel(k);this._ensureSizeForTexel(E);this._getBlock(v).setData(k,B,z)}getData(k,v,B){return this._getBlock(v).getData(k,B)}getHighlightFlags(k){return this._idsToHighlight.get(k)||0}unsetAttributeData(k){k=f.getDisplayIdTexel(k);this._getBlock(0).setData(k,0,0)}setAttributeData(k,v,B){const z=f.getDisplayIdTexel(k);this._ensureSizeForTexel(z);this._getBlock(0).setData(z,0,this.getFilterFlags(v));k=this._attributeComputeInfo;let E=null;k&&(E=k.isSubtype?k.map.get(v.readAttribute(k.subtypeField)):
k.map,E?.size&&E.forEach((K,I)=>{const D=1*I%4;I=this._getBlock(Math.floor(1*I/4)+b.AttributeDataType.VV);let G=K.field?.read(v,B);K.valueRepresentation&&(G=l(G,K.valueRepresentation));if(null===G||isNaN(G)||Infinity===G||-Infinity===G)G=h.nanMagicNumber;I.setData(z,D,G)}))}get epoch(){return this._epoch}sendUpdates(){const k=this._blocks.map(B=>null!=B?B.toMessage():null),v=this._getInitArgs();r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start");this._client.update({initArgs:v,
blockData:k,version:this.version,sendUpdateEpoch:this._epoch});this._epoch+=1;r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(k){for(;k>=this._size*this._size&&!this._expand(););}async _bind(k,v,B){k=await k.createComputedField(v);const {valueRepresentation:z}=v,E=this._attributeComputeInfo;if(E.isSubtype){const K=E.map.get(B)??new Map;K.set(v.binding,{field:k,valueRepresentation:z});E.map.set(B,K)}else E.map.set(v.binding,{field:k,valueRepresentation:z});
return k}_getInitArgs(){if(this._initialized)return null;this._initialized=!0;this._getBlock(b.AttributeDataType.Animation);this._getBlock(b.AttributeDataType.GPGPU);return{blockSize:this._size,blockDescriptors:this._blocks.map(k=>null!=k?{textureOnly:k.textureOnly,buffer:k.buffer,pixelType:k.pixelType}:null)}}_getBlock(k){var v=this._blocks[k];if(null!=v)return v;u(`Initializing AttributeBlock at index ${k}`);v=new y(this._size,this._blockDescriptors[k],this._client.isLocal);this._blocks[k]=v;this._initialized=
!1;return v}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const k=this._size<<=1;u("Expanding block size to",k,this._blocks);for(const v of this._blocks)v?.expand(k);this._initialized=!1;this._size=k;return 0}e().error(new q("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}isVisible(k){return!!(this._getBlock(0).getData(k,0)&1<<m.highlightReasons.length)}getFilterFlags(k){let v=0;for(var B=0;B<this._filters.length;B++){var z=this._filters[B];z=!(1<<
B)||null==z||z.check(k);v|=(z?1:0)<<B}B=0;this._idsToHighlight.size&&(k=k.getObjectId(),B=this.getHighlightFlags(k));return v<<m.highlightReasons.length|B}}a.AttributeStore=A;a.getVisualVariableSizeValueRepresentationRatio=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(a){a.DEBUG_ATTR_UPDATES=!1;a.createDebugLogger=(q,r)=>q&&((...g)=>r.warn("DEBUG:",...g))||(()=>null);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(a,q){class r{constructor(p){this.data=p;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){--this._referenceCount}empty(){return 0===this._referenceCount}}class g{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;this._objectIdToDisplayId=new Map}createIdForObjectId(p){let m=
this._objectIdToDisplayId.get(p);m?m.increment():(m=new r(q.createDisplayId(this._getFreeId(),!1)),m.increment(),this._objectIdToDisplayId.set(p,m));return m.data}releaseIdForObjectId(p){const m=this._objectIdToDisplayId.get(p);m&&(m.decrement(),m.empty()&&(this._objectIdToDisplayId.delete(p),this._freeIds.push(m.data)))}releaseAll(){for(const p of this._objectIdToDisplayId.values())this._freeIds.push(p.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?
this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}a.DisplayIdGenerator=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSource":function(){define("exports ../../../../../request ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/data/QueryEngine ../../../../../rest/query/operations/query ../FeatureStoreStatistics ./FeatureSourceQueryInfo ./StreamMessenger ./strategies/DrillDownTileLoadStrategy ./strategies/PagedTileLoadStrategy ./strategies/SnapshotLoadStrategy ./strategies/StreamLoadStrategy ./strategies/chunks/SourceChunkStore ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../support/UpdateTracking2D".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y){class A{constructor(k,v,B,z,E){this.service=k;this._aggregateAdapter=v;this._subscriptions=B;this._onChange=z;this._connection=E;this._updateTracking=new y.UpdateTracking2D({debugName:"FeatureSource"});this._didInvalidateData=!1;this._store=new e.FeatureSourceChunkStore(this._onChange);this._metadata=new u.FeatureMetadata(k.metadata)}destroy(){this._strategy?.destroy();this._store.destroy();this._streamMessenger?.destroy();"memory"===this.service.type&&
this.service.source.map(k=>k.close())}get metadata(){if(!this._metadata)throw Error("InternalError: Metadata not defined. Was update called?");return this._metadata}get store(){return this._store}get streamMessenger(){null==this._streamMessenger&&this._initStreamMessenger();return this._streamMessenger}get statistics(){return c.FeatureStoreStatistics.from(this._store)}get updateTracking(){return this._updateTracking}get queryEngine(){if(!this._queryEngine){if(!this._schema)return null;const {dataFilter:k}=
this._schema.mutable,v=this._metadata;this._queryEngine=new b.QueryEngine({featureStore:this._store,fieldsIndex:v.fieldsIndex,geometryType:v.geometryType,objectIdField:v.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.service.outSpatialReference,cacheSpatialQueries:!0,aggregateAdapter:this._aggregateAdapter,timeInfo:v.timeInfo,definitionExpression:k.definitionExpression,availableFields:this._schema.mutable.availableFields})}return this._queryEngine}get isStream(){return"stream"===this._schema.type}chunks(){return Array.from(this._store.chunks())}cleanupRemovedChunks(){return this._store.cleanupRemovedChunks()}onSubscribe(k){this._connection.onEvent({type:"subscribe",
tile:k.tile.id});const v=this._strategy?.load(k);v&&(v.then(()=>this._connection.onEvent({type:"loaded",tile:k.tile.id})).catch(B=>this._connection.onEvent({type:"error",tile:k.tile.id,error:B})),this._updateTracking.addPromise(v))}onResume(k){this._updateTracking.addPromise(g.ignoreAbortErrors(this._strategy?.load(k)))}onUnsubscribe(k){this._connection.onEvent({type:"unsubscribe",tile:k.tile.id});this._strategy?.unload(k)}getLocalEdit(k){return this._updateTracking.addPromise(this._getGetLocalEdit(k))}applyLocalEdit(k){this._didInvalidateData=
!0;this._store.applyLocalEdit(k,this.metadata)}async update(k,v){k=k.source;const B=p.diff(this._schema?.mutable,k.mutable);if(!B)return!1;r("esri-2d-update-debug")&&console.debug(`Version[${v}] FeatureSource.update`,{changes:B});this._schema=k;this._queryEngine?.destroy();this._queryEngine=null;"feature-service"===this.service.type&&null!=this.service.queryMetadata.lastEditDate&&(this._lastEditDate=this.service.queryMetadata.lastEditDate);null==this._streamMessenger&&"stream"===this._schema.type&&
this._initStreamMessenger();if(p.hasRootDiffOnly(B,"sourceRefreshVersion")&&this._strategy?.refresh)return await this._strategy.refresh(),!0;if("feature"===k.type&&p.hasRootDiffOnly(B,"availableFields")){if(await this._queryLastEditDateChanged()||this._didInvalidateData)this._didInvalidateData=!1,await this._updateStrategy(v);else{this._connection.onEvent({type:"updateFieldsStart"});try{await this._strategy.updateFields(k.mutable.availableFields),this._connection.onEvent({type:"updateFieldsEnd"})}catch(z){this._connection.onEvent({type:"updateFieldsError",
error:z})}}return!1}return p.hasRootDiff(B,"dataFilter")||p.hasRootDiff(B,"sourceRefreshVersion")?(await this._updateStrategy(v),!0):!1}_initStreamMessenger(){null==this._streamMessenger&&(this._streamMessenger=new n.StreamMessenger(this._connection))}async _getGetLocalEdit(k){k.historicMoment&&"feature"===this._schema.type&&(this._schema.mutable.dataFilter.historicMoment=k.historicMoment,this._strategy.unsafeSetQueryHistoricMoment(new Date(k.historicMoment)));if("edit-by-feature"===k.type){var v=
[...k.added,...k.updated].map(B=>m.OptimizedFeature.fromJSON(B,this.metadata.objectIdField));v=x.FeatureSetReaderJSON.fromOptimizedFeatures(v,this.metadata);k=this._resolveIdentifiers(k.removed);return{reader:v,removed:k}}v=this._resolveIdentifiers(k.removed);if(!k.updated.length&&!k.added.length)return{reader:x.FeatureSetReaderJSON.empty(this.metadata),removed:v};k=this._resolveIdentifiers([...k.added,...k.updated]);return{reader:await this._strategy.queryByObjectId(k),removed:v}}_resolveIdentifiers(k){const v=
[],B=[];for(const z of k)null==z.objectId||-1===z.objectId?v.push(z.globalId):B.push(z.objectId);if(v.length){const z=new Set(v),E=this.metadata.globalIdField;if(null==E)throw Error("InternalError: Recieved an edit with globalIds, but not supported by the service");this._store.forEachUnsafe(K=>{const I=K.readAttribute(E);z.has(I)&&B.push(K.getObjectId())})}return B}async _queryLastEditDateChanged(){if(null==this._lastEditDate)return!1;var k=this.service.source;k=(await q(k.path,{query:{...k.query,
f:"json"},responseType:"json"})).data.editingInfo.lastEditDate;if(k===this._lastEditDate)return!1;this._lastEditDate=k;return!0}async _createStrategy(){var k="isSourceHosted"in this.service&&this.service.isSourceHosted,v=Array.isArray(this.service.source),B=this.service.source&&"collection"in this.service.source;k=k||v||B;if("stream"===this._schema.type)return k=new l.StreamLoadStrategy(this.service,this._schema.mutable.dataFilter,this._store,{outSR:this.service.outSpatialReference},this.metadata),
this._streamMessenger.strategy=k;v=this.service;B=h.FeatureSourceQueryInfo.fromSchema(v,this._schema,this._metadata);const z=await this._supportSnapshotMode(v,B);return z?new t.SnapshotLoadStrategy(v,B,this._store,z.featureCount,this.metadata,this._connection):k?new w.PagedTileLoadStrategy(v,B,this._store,this.metadata,this._connection):new d.DrillDownTileLoadStrategy(v,B,this._store,this.metadata,this._connection)}async _updateStrategy(k){const v=await this._createStrategy();this._connection.onEvent({type:"updateStrategyStart",
about:v.about});const B=!!this._strategy;this._store.clear();this._strategy?.destroy();this._strategy=v;r("esri-2d-update-debug")&&console.debug(`Version[${k}] FeatureSource.updateStrategy`,{strategy:v});var z=Array.from(this._subscriptions.values());if(z.length){z=Promise.all(z.map(E=>this._strategy.load(E).then(()=>this._connection.onEvent({type:"loaded",tile:E.tile.id})).catch(K=>this._connection.onEvent({type:"error",tile:E.tile.id,error:K}))));this._updateTracking.addPromise(z);try{B&&await z}catch(E){g.throwIfNotAbortError(E)}this._connection.onEvent({type:"updateStrategyEnd"});
r("esri-2d-update-debug")&&console.debug(`Version[${k}] FeatureSource.updateStrategyEnd`,{strategy:v})}else this._connection.onEvent({type:"updateStrategyEnd"})}async _supportSnapshotMode(k,v){var {queryMetadata:B}=k;B=B.snapshotInfo;if(!B||!B.supportsSnapshotMinThreshold||!B.snapshotCountThresholds)return null;k=k.source;v=v.createQuery();v.inner.orderByFields=[];v.inner.returnGeometry=!1;v=(await f.executeQueryForCount(k,v.inner,{query:v.customParameters})).data.count;const {min:z,max:E}=B.snapshotCountThresholds;
return v<=z||B.supportsSnapshotMaxThreshold&&v<E?{featureCount:v}:null}}a.FeatureSource=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define("exports ../../../request ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../operations/urlUtils ./pbfQueryUtils ./queryZScale".split(" "),function(a,q,r,g,p,m,b,f,c){function h(t,l){if(l&&"extent"===
t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(l&&"point"===t.type)return`${t.x},${t.y}`;t=t.toJSON();delete t.spatialReference;return JSON.stringify(t)}function n(t,l){const e=t.geometry,u=t.toJSON();delete u.compactGeometryEnabled;delete u.defaultSpatialReferenceEnabled;let x,y,A;null!=e&&(y=e.spatialReference,A=m.srToRESTValue(y),u.geometryType=g.getJsonType(e),u.geometry=h(e,t.compactGeometryEnabled),u.inSR=A);u.groupByFieldsForStatistics&&(u.groupByFieldsForStatistics=u.groupByFieldsForStatistics.join(","));
u.objectIds&&(u.objectIds=u.objectIds.join(","));u.orderByFields&&(u.orderByFields=u.orderByFields.join(","));!u.outFields||!u.returnDistinctValues&&(l?.returnCountOnly||l?.returnExtentOnly||l?.returnIdsOnly)?delete u.outFields:u.outFields.includes("*")?u.outFields="*":u.outFields=u.outFields.join(",");u.outSR?(u.outSR=m.srToRESTValue(u.outSR),x=t.outSpatialReference):e&&(u.returnGeometry||u.returnCentroid)&&(u.outSR=u.inSR,x=y);u.returnGeometry&&delete u.returnGeometry;u.outStatistics&&(u.outStatistics=
JSON.stringify(u.outStatistics));u.fullText&&(u.fullText=JSON.stringify(u.fullText));u.pixelSize&&(u.pixelSize=JSON.stringify(u.pixelSize));u.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=y&&null!=t.quantizationParameters?.extent&&y.equals(t.quantizationParameters.extent.spatialReference)&&delete u.quantizationParameters.extent.spatialReference,u.quantizationParameters=JSON.stringify(u.quantizationParameters));u.parameterValues&&(u.parameterValues=JSON.stringify(u.parameterValues));
u.rangeValues&&(u.rangeValues=JSON.stringify(u.rangeValues));u.dynamicDataSource&&(u.layer=JSON.stringify({source:u.dynamicDataSource}),delete u.dynamicDataSource);if(u.timeExtent){const {start:k,end:v}=u.timeExtent;if(null!=k||null!=v)u.time=k===v?k:`${null==k?"null":k},${null==v?"null":v}`;delete u.timeExtent}t.defaultSpatialReferenceEnabled&&null!=y&&null!=x&&y.equals(x)&&(u.defaultSR=u.inSR,delete u.inSR,delete u.outSR);return u}function d(t,l,e){return w(t,l,"pbf",e)}async function w(t,l,e,u=
{},x={}){t="string"===typeof t?r.urlToObject(t):t;var y=(await p.normalizeCentralMeridian(l.geometry?[l.geometry]:[],null,{signal:u.signal}))?.[0];null!=y&&(l=l.clone(),l.geometry=y);y=b.mapParameters({...t.query,f:e,...x,...n(l,x)});return q(r.join(t.path,null==l.formatOf3DObjects||x.returnCountOnly||x.returnExtentOnly||x.returnIdsOnly?"query":"query3d"),{...u,responseType:"pbf"===e?"array-buffer":"json",query:{...y,...u.query}})}a.encodeGeometry=h;a.executeQuery=async function(t,l,e,u){t=null!=
l.timeExtent&&l.timeExtent.isEmpty?{data:{features:[]}}:await w(t,l,"json",u);c.applyFeatureSetZUnitScaling(l,e,t.data);return t};a.executeQueryForCount=function(t,l,e){return null!=l.timeExtent&&l.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):w(t,l,"json",e,{returnIdsOnly:!0,returnCountOnly:!0})};a.executeQueryForExtent=async function(t,l,e){if(null!=l.timeExtent&&l.timeExtent.isEmpty)return{data:{count:0,extent:null}};t=await w(t,l,"json",e,{returnExtentOnly:!0,returnCountOnly:!0});l=t.data;
if(l.hasOwnProperty("extent"))return t;if(l.features)throw Error("Layer does not support extent calculation.");if(l.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");return t};a.executeQueryForIds=function(t,l,e){return null!=l.timeExtent&&l.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):w(t,l,"json",e,{returnIdsOnly:!0})};a.executeQueryPBF=async function(t,l,e,u){if(null!=l.timeExtent&&l.timeExtent.isEmpty)return{data:e.createFeatureResult()};t=await d(t,
l,u);t.data=f.parsePBFFeatureQuery(t.data,e);return t};a.executeQueryPBFBuffer=d;a.queryToQueryStringParameters=n;a.runQuery=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(a){function q(r){const g={};for(const p in r){if("declaredClass"===p)continue;const m=r[p];if(null!=m&&"function"!==typeof m)if(Array.isArray(m)){g[p]=[];for(let b=0;b<m.length;b++)g[p][b]=q(m[b])}else"object"===typeof m?m.toJSON&&(g[p]=JSON.stringify(m)):
g[p]=m}return g}a.mapParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(a,q){a.parsePBFFeatureQuery=function(r,g){var p=q.parseFeatureQuery(r,g);r=p.queryResult.featureResult;g=p.queryResult.queryGeometry;p=p.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const m=r.objectIdFieldName;for(const b of r.features)b.attributes&&
(b.objectId=b.attributes[m])}r&&(r.queryGeometry=g,r.queryGeometryType=p);return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(a,q,r,g,p){function m(z){return z>=k.length?null:k[z]}function b(z,E,K){z=z.asUnsafe();for(K=E.createPointGeometry(K);z.next();)switch(z.tag()){case 3:var I=
z.getUInt32();I=z.pos()+I;let D=0;for(;z.pos()<I;)E.addCoordinatePoint(K,z.getSInt64(),D++);break;default:z.skip()}return K}function f(z,E,K){z=z.asUnsafe();const I=E.createGeometry(K);for(K=2+(K.hasZ?1:0)+(K.hasM?1:0);z.next();)switch(z.tag()){case 2:var D=z.getUInt32();D=z.pos()+D;for(var G=0;z.pos()<D;)E.addLength(I,z.getUInt32(),G++);break;case 3:D=z.getUInt32();D=z.pos()+D;G=0;for(E.allocateCoordinates(I);z.pos()<D;)E.addCoordinate(I,z.getSInt64(),G),G++,G===K&&(G=0);break;default:z.skip()}return I}
function c(z){z=z.asUnsafe();const E=new g;let K="esriGeometryPoint";for(;z.next();)switch(z.tag()){case 2:var I=z.getUInt32();for(I=z.pos()+I;z.pos()<I;)E.lengths.push(z.getUInt32());break;case 3:I=z.getUInt32();for(I=z.pos()+I;z.pos()<I;)E.coords.push(z.getSInt64());break;case 1:K=p.optimizedGeometryTypes[z.getEnum()];break;default:z.skip()}return{queryGeometry:E,queryGeometryType:K}}function h(z){for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();
case 3:return z.getDouble();case 4:return z.getSInt32();case 5:return z.getUInt32();case 6:return z.getInt64();case 7:return z.getUInt64();case 8:return z.getSInt64();case 9:return z.getBool();default:return z.skip(),null}return null}function n(z){z=z.asUnsafe();const E={type:m(0)};for(;z.next();)switch(z.tag()){case 1:E.name=z.getString();break;case 2:E.type=m(z.getEnum());break;case 3:E.alias=z.getString();break;case 4:var K=z.getEnum();K=K>=v.length?null:v[K];E.sqlType=K;break;case 5:z.skip();
break;case 6:E.defaultValue=z.getString();break;default:z.skip()}return E}function d(z){const E={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:E.name=z.getString();break;case 2:E.isSystemMaintained=z.getBool();break;default:z.skip()}return E}function w(z,E,K,I){const D=E.createFeature(K);let G=0;for(;z.next();)switch(z.tag()){case 1:const C=I[G++].name;D.attributes[C]=z.processMessage(h);break;case 2:D.geometry=z.processMessageWithArgs(f,E,K);break;case 4:D.centroid=z.processMessageWithArgs(b,
E,K);break;default:z.skip()}return D}function t(z){const E=[1,1,1,1];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:E[0]=z.getDouble();break;case 2:E[1]=z.getDouble();break;case 4:E[2]=z.getDouble();break;case 3:E[3]=z.getDouble();break;default:z.skip()}return E}function l(z){const E=[0,0,0,0];for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:E[0]=z.getDouble();break;case 2:E[1]=z.getDouble();break;case 4:E[2]=z.getDouble();break;case 3:E[3]=z.getDouble();break;default:z.skip()}return E}function e(z){const E=
{originPosition:0>=B.length?null:B[0]};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:var K=z.getEnum();E.originPosition=K>=B.length?null:B[K];break;case 2:E.scale=z.processMessage(t);break;case 3:E.translate=z.processMessage(l);break;default:z.skip()}return E}function u(z){const E={};for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:E.shapeAreaFieldName=z.getString();break;case 2:E.shapeLengthFieldName=z.getString();break;case 3:E.units=z.getString();break;default:z.skip()}return E}function x(z,
E){for(E=E.createSpatialReference();z.next();)switch(z.tag()){case 1:E.wkid=z.getUInt32();break;case 5:E.wkt=z.getString();break;case 2:E.latestWkid=z.getUInt32();break;case 3:E.vcsWkid=z.getUInt32();break;case 4:E.latestVcsWkid=z.getUInt32();break;default:z.skip()}return E}function y(z,E){const K=E.createFeatureResult();z=z.asUnsafe();K.geometryType=0>=E.geometryTypes.length?null:E.geometryTypes[0];let I=!1;for(;z.next();)switch(z.tag()){case 1:K.objectIdFieldName=z.getString();break;case 3:K.globalIdFieldName=
z.getString();break;case 4:K.geohashFieldName=z.getString();break;case 5:K.geometryProperties=z.processMessage(u);break;case 7:var D=z.getEnum();K.geometryType=D>=E.geometryTypes.length?null:E.geometryTypes[D];break;case 8:K.spatialReference=z.processMessageWithArgs(x,E);break;case 10:K.hasZ=z.getBool();break;case 11:K.hasM=z.getBool();break;case 12:K.transform=z.processMessage(e);break;case 9:K.exceededTransferLimit=z.getBool();break;case 13:E.addField(K,z.processMessage(n));break;case 15:I||(E.prepareFeatures(K),
I=!0);E.addFeature(K,z.processMessageWithArgs(w,E,K,K.fields));break;case 2:K.uniqueIdField=z.processMessage(d);break;default:z.skip()}E.finishFeatureResult(K);return K}function A(z,E){const K={};let I=null;for(;z.next();)switch(z.tag()){case 4:I=z.processMessageWithArgs(c);break;case 1:K.featureResult=z.processMessageWithArgs(y,E);break;default:z.skip()}null!=I&&K.featureResult&&E.addQueryGeometry(K,I);return K}const k="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeBigInteger esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "),
v="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),B=["upperLeft","lowerLeft"];a.parseFeatureQuery=function(z,E){try{const K=new r(new Uint8Array(z),new DataView(z));
for(z={};K.next();)switch(K.tag()){case 2:z.queryResult=K.processMessageWithArgs(A,E);break;default:K.skip()}return z}catch(K){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:K});}};a.parseField=n;a.parseFieldType=m;a.parseTransform=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define("exports ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/OptimizedFeature ../../../layers/graphics/OptimizedFeatureSet ../../../layers/graphics/OptimizedGeometry".split(" "),
function(a,q,r,g,p,m){const b=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class f{constructor(c){this._options=c;this.geometryTypes=b;this._vertexDimension=this._coordinatePtr=0}createFeatureResult(){return new p}prepareFeatures(c){this._vertexDimension=2;c.hasZ&&this._vertexDimension++;c.hasM&&this._vertexDimension++}finishFeatureResult(c){if(c?.features&&c.hasZ&&this._options.sourceSpatialReference&&c.spatialReference&&!r.equals(c.spatialReference,
this._options.sourceSpatialReference)&&!c.spatialReference.vcsWkid){var h=q.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference),n=q.getMetersPerVerticalUnitForSR(c.spatialReference);h/=n;if(1!==h)for(const d of c.features)if(g.hasGeometry(d))for(c=d.geometry.coords,n=2;n<c.length;n+=3)c[n]*=h}}addFeature(c,h){c.features.push(h)}createFeature(){return new g.OptimizedFeature}createSpatialReference(){return{wkid:0}}createGeometry(){return new m}addField(c,h){c.fields.push(h)}allocateCoordinates(c){c.coords.length=
c.lengths.reduce((h,n)=>h+n,0)*this._vertexDimension;this._coordinatePtr=0}addCoordinate(c,h){c.coords[this._coordinatePtr++]=h}addCoordinatePoint(c,h){c.coords.push(h)}addLength(c,h){c.lengths.push(h)}addQueryGeometry(c,h){c.queryGeometry=h.queryGeometry;c.queryGeometryType=h.queryGeometryType}createPointGeometry(){return new m}}a.OptimizedFeatureSetParserContext=f;a.optimizedGeometryTypes=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports",
"../../../geometry/support/zscale"],function(a,q){a.applyFeatureSetZUnitScaling=function(r,g,p){if(p?.features&&p.hasZ&&(r=q.getGeometryZScaler(p.geometryType,g,r.outSpatialReference),null!=r))for(const m of p.features)r(m.geometry)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreStatistics":function(){define(["exports"],function(a){class q{static from(r){let g=0,p=0,m=0;r.forEach(b=>{if(b=b._readGeometry())p+=b.isPoint?1:b.lengths.reduce((f,
c)=>f+c,0),m+=b.isPoint?1:b.lengths.length,g+=1});return new q(g,p,m)}constructor(r,g,p){this.featureCount=r;this.vertexCount=g;this.ringCount=p}toJSON(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}a.FeatureStoreStatistics=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceQueryInfo":function(){define("exports ../../../../../TimeExtent ../../../../../core/has ../../../../../core/sql ../../../../../geometry/SpatialReference ../../../../../layers/support/arcgisLayerUrl ../../../../../rest/support/Query".split(" "),
function(a,q,r,g,p,m,b){class f{static fromSchema(c,h,n){const d="feature"===h.type?h.mutable.dataFilter.queryScaleRanges:[];{var w=c.orderByFields??n.objectIdField+" ASC";const t=c.source;w={returnCentroid:!(null!==t&&"object"===typeof t&&"path"in t&&m.isHostedAgolService(t.path))&&"esriGeometryPolygon"===n.geometryType,returnGeometry:!0,timeReferenceUnknownClient:n.timeReferenceUnknownClient??void 0,outSpatialReference:p.fromJSON(c.outSpatialReference),orderByFields:[w],where:h.mutable.dataFilter.definitionExpression??
"1\x3d1",outFields:h.mutable.availableFields};if("feature"===h.type){const {gdbVersion:l,historicMoment:e,timeExtent:u}=h.mutable.dataFilter;w={...w,gdbVersion:l,historicMoment:e?new Date(e):null,timeExtent:u?q.fromJSON(u):null,outFields:h.mutable.availableFields}}}return new f(w,d,n.subtypeField,h.mutable.dataFilter.customParameters,n.geometryType,c.queryMetadata)}constructor(c,h,n,d,w,t){this._queryParams=c;this._queryScaleRanges=h;this._subtypeField=n;this._customParameters=d;this._geometryType=
w;this._queryMetadata=t}get pageSize(){if(null==this._queryMetadata)throw Error("InternalError: Service does not support paged queries");return Math.min(8E3,(this._queryMetadata.maxRecordCount??8E3)*((this._queryMetadata.supportsMaxRecordCountFactor?4:null)??1))}updateHistoricMoment(c){this._queryParams.historicMoment=c}updateFields(c){this._queryParams.outFields=c}createPatchFieldsQuery(c,h){if(!h.getSize())return null;c=c.clone();if("*"===this._queryParams.outFields[0]){if("*"===(c.outFields??[])[0])return null;
c.outFields=this._queryParams.outFields}else{const n=new Set(this._queryParams.outFields),d=[];for(const w of n)h.hasField(w)||d.push(w);if(0===d.length)return null;c.outFields=d}c.returnGeometry=!1;c.returnCentroid=!1;c.quantizationParameters=null;c.cacheHint=!0;return{inner:c,customParameters:this._customParameters}}createQuery(c={}){if(!this._queryParams)throw Error("InternalError: queryInfo should be defined");return{inner:new b({...this._queryParams,...c}),customParameters:this._customParameters}}createTileQuery(c,
h){if(null==this._queryMetadata)throw Error("InternalError: Service does not support tile queries");const n=this.createQuery(h),d=n.inner;if(this._queryScaleRanges.length){const w=this._queryScaleRanges.filter(t=>(!t.minScale||t.minScale>=c.maxScale)&&(!t.maxScale||t.maxScale<=c.minScale)).map(t=>t.subtypeCode);w.length&&(d.where=g.sqlAnd(d.where,`${this._subtypeField} IN (${w})`))}d.quantizationParameters=h.quantizationParameters??c.getQuantizationParameters();d.resultType="tile";d.geometry=c.extent;
if(this._queryMetadata.supportsQuantization)"esriGeometryPolyline"===this._geometryType&&(d.maxAllowableOffset=c.resolution*r("feature-polyline-generalization-factor"));else if("esriGeometryPolyline"===this._geometryType||"esriGeometryPolygon"===this._geometryType)d.maxAllowableOffset=c.resolution,"esriGeometryPolyline"===this._geometryType&&(d.maxAllowableOffset*=r("feature-polyline-generalization-factor"));d.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference;d.compactGeometryEnabled=
this._queryMetadata.supportsCompactGeometry;this._queryMetadata.supportsMaxRecordCountFactor&&(d.maxRecordCountFactor=4);r("esri-tiles-debug")&&(h=c.id.replaceAll("/","."),n.customParameters=n.customParameters?{...n.customParameters,tileId:h}:{tileId:h});return n}createPagedTileQuery(c,h){const n=this.pageSize;return this.createTileQuery(c,{start:n*h,num:n,returnExceededLimitFeatures:!0})}createPagedQuery(c){const h=this.pageSize;return this.createQuery({start:h*c,num:h,returnExceededLimitFeatures:!0,
maxRecordCountFactor:4})}}a.FeatureSourceQueryInfo=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/arcgisLayerUrl":function(){define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],function(a,q,r){function g(d){if(null==d)return null;d=q.urlToObject(d);d=d?.path.match(c)||d?.path.match(h);if(!d)return null;const [,w,t,l,e]=d;d=t.indexOf("/");return{title:m(-1!==d?t.slice(d+1):t),serverType:b[l.toLowerCase()],sublayer:null!=e&&""!==e?parseInt(e,
10):null,url:{path:w}}}function p(d){return(d=q.urlToObject(d).path.match(n))?{serviceUrl:d[1],sublayerId:Number(d[2])}:null}function m(d){d=d.replaceAll(/\s*[/_]+\s*/g," ");return d[0].toUpperCase()+d.slice(1)}const b={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},f=Object.values(b),
c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${f.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),h=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${f.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),n=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;a.cleanTitle=m;a.isArcGISUrl=function(d){return c.test(d)};a.isHostedAgolService=function(d){d=q.getOrigin(d,!0);if(!d)return!1;d=d.toLowerCase();return d.endsWith(".arcgis.com")&&(d.startsWith("services")||d.startsWith("tiles")||d.startsWith("features"))};
a.isServerOrServicesAGOLUrl=function(d){if(!d)return!1;d=(new q.Url(q.makeAbsolute(d))).authority?.toLowerCase();return"server.arcgisonline.com"===d||"services.arcgisonline.com"===d};a.isWmsServer=function(d){if(!d)return!1;var w=d.toLowerCase();d=w.includes("/services/");const t=w.includes("/mapserver/wmsserver"),l=w.includes("/imageserver/wmsserver");w=w.includes("/wmsserver");return d&&(t||l||w)};a.parse=g;a.parseNonStandardSublayerUrl=p;a.sanitizeUrl=function(d,w){return d?q.removeTrailingSlash(q.removeQueryParameters(d,
w)):d};a.sanitizeUrlWithLayerId=function(d){let {url:w}=d;if(!w)return{url:w};w=q.removeQueryParameters(w,d.logger);const t=q.urlToObject(w),l=g(t.path);let e=void 0;null!=l?(null!=l.sublayer&&null==d.layer.layerId&&(e=l.sublayer),w=l.url.path):d.nonStandardUrlAllowed&&(d=p(t.path),null!=d&&(w=d.serviceUrl,e=d.sublayerId));return{url:q.removeTrailingSlash(w),layerId:e}};a.serverTypes=f;a.titleFromUrlAndName=function(d,w){const t=[];d&&(d=g(d),null!=d&&d.title&&t.push(d.title));w&&(w=m(w),t.push(w));
if(2===t.length){if(t[0].toLowerCase().includes(t[1].toLowerCase()))return t[0];if(t[1].toLowerCase().includes(t[0].toLowerCase()))return t[1]}return t.join(" - ")};a.writeUrlWithLayerId=function(d,w,t,l,e){r.write(w,l,"url",e);l.url&&null!=d.layerId&&(l.url=q.join(l.url,t,d.layerId.toString()))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamMessenger":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f,c){a.StreamMessenger=class extends r{constructor(h){super();this._connection=h;this._enabledEventTypes=new Set;this._updateInfo={websocket:0,client:0};this._lastTime=performance.now();this._queuedCommands=[];this.addHandles([g.watch(()=>this._strategy?.connectionStatus??"disconnected",n=>{this._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:n})},{initial:!0}),g.watch(()=>this._strategy?.errorString||null,n=>this._layerView.setProperty({propertyName:"pipelineErrorString",
value:n}),{initial:!0})])}destroy(){this._strategy=null;this.removeAllHandles()}get _layerView(){return this._connection.layerView}set strategy(h){null==this._strategy&&this._resetUpdateInfo(performance.now());this.removeHandles("event-handles");null!=h&&(this.addHandles([h.events.on("data-received",n=>this._onFeature(n)),h.events.on("message-received",n=>this._onWebSocketMessage(n)),h.events.on("features-updated",n=>this._onUpdate(n)),h.events.on("tick",()=>this._onTick())],"event-handles"),this._queuedCommands.forEach(n=>
n(h)),this._queuedCommands=[]);this._strategy=h}updateCustomParameters(h){null!=h&&this._callOrEnqueue(n=>n.updateCustomParameters(h))}sendMessageToSocket(h){this._callOrEnqueue(n=>n.sendMessageToSocket(h))}sendMessageToClient(h){this._callOrEnqueue(n=>n.sendMessageToClient(h))}enableEvent(h,n){n?this._enabledEventTypes.add(h):this._enabledEventTypes.delete(h)}disconnect(){this._strategy?.disconnect()}connect(){this._strategy?.connect()}clear(){this._strategy?.clear()}_onWebSocketMessage(h){this._enabledEventTypes.has("message-received")&&
this._layerView.emitEvent({name:"message-received",event:h})}_onFeature(h){this._updateInfo.websocket++;this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:h.attributes,centroid:h.centroid,geometry:h.geometry}})}_onUpdate(h){this._updateInfo.client+=h}_onTick(){const h=performance.now();var n=h-this._lastTime;if(2500<n){const d=Math.round(this._updateInfo.client/(n/1E3));n=Math.round(this._updateInfo.websocket/(n/1E3));this._resetUpdateInfo(h);
this._layerView.emitEvent({name:"update-rate",event:{client:d,websocket:n}})}}_resetUpdateInfo(h){this._lastTime=h;this._updateInfo.client=0;this._updateInfo.websocket=0}_callOrEnqueue(h){null!=this._strategy?h(this._strategy):this._queuedCommands.push(h)}};q.__decorate([p.property()],a.StreamMessenger.prototype,"_strategy",void 0);a.StreamMessenger=q.__decorate([c.subclass("esri.views.2d.layers.features.sources.StreamMessenger")],a.StreamMessenger);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/sources/strategies/DrillDownTileLoadStrategy":function(){define("exports ../../../../../../core/handleUtils ../../../../../../core/has ../../../../../../core/promiseUtils ./ATileLoadStrategy ./chunks/DrillDownTileSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(a,q,r,g,p,m,b){class f{constructor(h,n){this.subscription=h;this._tileIdToResult=new Map;this._controller=new AbortController;this._handles=q.handlesGroup([g.onAbort(h.signal,()=>this._controller.abort()),
g.onAbort(n,()=>this._controller.abort())])}destroy(){this._controller.abort();this._handles.remove()}get(h){return this._tileIdToResult.get(h)}set(h,n){this._tileIdToResult.set(h,n)}get options(){return{signal:this._controller.signal}}}class c extends p.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}destroy(){super.destroy();for(const h of this._loadStates.values())h.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(h){this._loadStates.has(h.key.id)||
this._loadStates.set(h.key.id,new f(h,this._options));const n=this._loadStates.get(h.key.id);let d;try{for await(const w of this._fetchChunkInfos(n,h.tile,0)){const {queryJSON:t,reader:l,sourceTile:e,sourceTileDepth:u,tile:x}=w,y=new m.DrillDownTileSourceChunk(l,t,x,e,u,!1);g.throwIfAborted(n.options);this._addChunk(y)}}catch(w){d=w}h=new m.DrillDownTileSourceChunk(b.FeatureSetReaderJSON.empty(this._metadata),null,h.tile,null,-1,!0);this._addChunk(h);if(d)throw d;}unload(h){super.unload(h);this._loadStates.get(h.key.id)?.destroy();
this._loadStates.delete(h.key.id)}async *_fetchChunkInfos(h,n,d){let w=h.get(n.id);const t=!!w;w||(w=await this._fetchChunkInfo(h,n,d),h.set(n.id,w));if(w.reader.exceededTransferLimit&&d<r("featurelayer-query-max-depth"))for(const l of n.createChildTiles())yield*this._fetchChunkInfos(h,l,d+1);else t||(yield w)}async _fetchChunkInfo(h,n,d){var w=h.subscription.tile.getQuantizationParameters();w=this._queryInfo.createTileQuery(n,{returnExceededLimitFeatures:!1,quantizationParameters:w});return{reader:await this._fetch(w,
h.options),queryJSON:w.inner.toJSON(),tile:h.subscription.tile,sourceTile:n,sourceTileDepth:d}}}a.DrillDownTileLoadStrategy=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ATileLoadStrategy":function(){define(["exports","../../../../../../core/has","./AFetchLoadStrategy"],function(a,q,r){class g extends r.AFetchLoadStrategy{constructor(){super(...arguments);this._chunksById=new Map}unload(p){this._removeChunks(p.tile)}_addChunk(p){const m=
p.tile.id;this._chunksById.has(m)||this._chunksById.set(m,[]);const b=p.size();if(b||p.first||p.end)q("esri-2d-update-debug")&&console.debug(`Chunk[${p.chunkId}] ATileLoadStrategy.addChunk [count=${b}]`),this._chunksById.get(m).push(p),this._store.insert(p)}_removeChunks(p){const m=this._chunksById.get(p.key.id)??[];for(const b of m)q("esri-2d-update-debug")&&console.debug(`Tile[${p.key.id}] Chunk[${b.chunkId}] ATileLoadStrategy.removeChunk`),this._store.remove(b);this._chunksById.delete(p.key.id)}}
a.ATileLoadStrategy=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/AFetchLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../rest/support/Query ./ALoadStrategy ./support/queryAdapters ../../support/FeatureSetReaderJSON ../../../../../support/QueueProcessor".split(" "),function(a,q,r,g,p,m,b){class f extends g.ALoadStrategy{constructor(c,h,n,d,w){super(n);this._serviceInfo=c;this._queryInfo=h;this._metadata=
d;this._connection=w;this._queue=new b.QueueProcessor({concurrency:16,process:async t=>this._adapter.executeQuery(t.query.inner,{signal:t.options?.signal,query:t.query.customParameters})});this._adapter=p.createQueryAdapter(c,d)}unsafeSetQueryHistoricMoment(c){this._queryInfo.updateHistoricMoment(c)}async updateFields(c){this._queryInfo.updateFields(c);c=Array.from(this._store.chunks()).map(async h=>{const n=r.fromJSON(h.queryInfo.queryJSON);if(n)try{return await this._tryUpdateFields(h.reader,n),
null}catch(d){return d}});c=(await Promise.all(c)).filter(h=>h);if(c.length)throw new q("featurelayer-query","Encountered errors when downloading fields",{errors:c});}async queryByObjectId(c){if(0===c.length)return m.FeatureSetReaderJSON.empty(this._metadata);c=this._queryInfo.createQuery({objectIds:c});return this._fetch(c)}async _fetch(c,h){h=await this._enqueue(c,h);await this._tryUpdateFields(h,c.inner);return h}async _tryUpdateFields(c,h){if(h=this._queryInfo.createPatchFieldsQuery(h,c))h=await this._enqueue(h,
this._options),c.joinAttributes(h)}async _enqueue(c,h){this._connection.onEvent({type:"fetchStart"});return this._queue.push({query:c,options:h}).finally(()=>{this._connection.onEvent({type:"fetchEnd",done:0===this._queue.length})})}}a.AFetchLoadStrategy=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ALoadStrategy":function(){define(["exports"],function(a){class q{constructor(r){this._store=r;this._controller=new AbortController}destroy(){this._controller.abort()}get _options(){return{signal:this._controller.signal}}unsafeSetQueryHistoricMoment(r){throw Error("InternalError: LoadStrategy does not support query info");
}async queryOverride(r){throw Error("InternalError: LoadStrategy does not support fetching");}async queryByObjectId(r){throw Error("InternalError: LoadStrategy does not support fetching");}}a.ALoadStrategy=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/support/queryAdapters":function(){define("exports ../../../../../../../core/has ../../../../../../../core/workers/Connection ../../../../../../../geometry/support/quantizationUtils ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../../rest/query/operations/query ../../../support/FeatureSetReaderJSON ../../../support/FeatureSetReaderPBF".split(" "),
function(a,q,r,g,p,m,b,f,c){async function h(e){const u=new r;await u.open(e,{});return u}class n{constructor(e,u){this.service=e;this._metadata=u}destroy(){}}class d extends n{constructor(e,u){super(e,u);this._portsOpen=h(e.source).then(x=>this.client=x)}destroy(){this.client.close();this.client=null}async executeQuery(e,u){await this._portsOpen;e=await this.client.invoke("queryFeatures",e.toJSON(),u);return f.FeatureSetReaderJSON.fromFeatureSet(e,this._metadata)}}class w extends n{async executeQuery(e,
u){({data:u}=await b.executeQueryPBFBuffer(this.service.source,e,u));return c.FeatureSetReaderPBF.fromBuffer(u,this._metadata,!e.quantizationParameters)}}class t extends n{async executeQuery(e,u){const {source:x,queryMetadata:y}=this.service;if(null!=e.quantizationParameters&&!y.supportsQuantization){const A=e.clone();e=g.toQuantizationTransform(A.quantizationParameters);A.quantizationParameters=null;({data:u}=await b.executeQuery(x,A,this._metadata.spatialReference,u));u=p.convertFromFeatureSet(u,
this._metadata.objectIdField);p.quantizeOptimizedFeatureSet(e,u);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(u,this._metadata)}({data:e}=await b.executeQuery(x,e,this._metadata.spatialReference,u));"esriGeometryPoint"===this._metadata.geometryType&&(e.features=e.features?.filter(A=>null!=A.geometry?(A=A.geometry,Number.isFinite(A.x)&&Number.isFinite(A.y)):!0));return f.FeatureSetReaderJSON.fromFeatureSet(e,this._metadata)}}class l extends n{async executeQuery(e,u){if(e.quantizationParameters&&
!this.service.queryMetadata.supportsQuantization){const y=e.clone();var x=g.toQuantizationTransform(y.quantizationParameters);y.quantizationParameters=null;e=await m.queryOptimizedFeatureSet(this.service.source,e,u);p.quantizeOptimizedFeatureSet(x,e);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(e,this._metadata)}x=await m.queryOptimizedFeatureSet(this.service.source,e,u);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(x,this._metadata)}}a.SourceAdapter=n;a.createQueryAdapter=function(e,
u){switch(e.type){case "memory":return new d(e,u);case "ogc":return new l(e,u);case "feature-service":return e.queryMetadata.supportsFormatPBF&&q("featurelayer-pbf")?new w(e,u):new t(e,u)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define("../handleUtils ../has ../promiseUtils ../Queue ./connectionRegistry ./InvokeHandler ./RemoteClient".split(" "),function(a,q,r,g,p,m,b){class f{constructor(){this._inUseClients=[];this._clients=[];this._clientPromises=
[];this._ongoingJobsQueue=new g}destroy(){this.close()}get closed(){return!this._clients?.length}open(c,h){return new Promise((n,d)=>{let w=!0;const t=l=>{r.throwIfAborted(h.signal);w&&(w=!1,l())};this._clients.length=c.length;this._clientPromises.length=c.length;this._inUseClients.length=c.length;for(let l=0;l<c.length;++l){const e=c[l];r.isPromiseLike(e)?this._clientPromises[l]=e.then(u=>{this._clients[l]=new b(u,h,this._ongoingJobsQueue);t(n);return this._clients[l]},()=>{t(d);return null}):(this._clients[l]=
new b(e,h,this._ongoingJobsQueue),this._clientPromises[l]=Promise.resolve(this._clients[l]),t(n))}})}broadcast(c,h,n){const d=Array(this._clientPromises.length);for(let w=0;w<this._clientPromises.length;++w)d[w]=this._clientPromises[w].then(t=>t?.invoke(c,h,n));return d}close(){let c;for(;c=this._ongoingJobsQueue.pop();)c.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${c.methodName}'`));for(const h of this._clientPromises)h.then(n=>n?.close());this._clients.length=0;this._clientPromises.length=
0;this._inUseClients.length=0;p.unregister(this)}invoke(c,h,n){return this.apply(c,[h],n)}apply(c,h,n){const d=r.createResolver();this._ongoingJobsQueue.push({methodName:c,data:h,invokeOptions:n,resolver:d});for(c=0;c<this._clientPromises.length;c++)(h=this._clients[c])?h.jobAdded():this._clientPromises[c].then(w=>w?.jobAdded());return d.promise}createInvokeProxy(c){return m.createInvokeProxy(this,c)}on(c,h){return Promise.all(this._clientPromises).then(()=>a.handlesGroup(this._clients.map(n=>n.on(c,
h))))}openPorts(){return new Promise(c=>{const h=Array(this._clientPromises.length);let n=h.length;for(let d=0;d<this._clientPromises.length;++d)this._clientPromises[d].then(w=>{w&&(h[d]=w.openPort());0===--n&&c(h)})})}get test(){}}return f})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(a){const q=new FinalizationRegistry(r=>{r.close()});a.register=function(r,g){q.register(r,g,g)};a.unregister=function(r){q.unregister(r)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/ogc/ogcFeatureUtils":function(){define("exports ../../geometry ../../request ../../core/Error ../../core/Logger ../../core/urlUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../graphics/featureConversionUtils ../graphics/OptimizedFeatureSet ../graphics/sources/geojson/geojson ../graphics/sources/support/clientSideDefaults ../graphics/sources/support/sourceUtils ../support/FieldsIndex ../support/fieldType ../../time/timeZoneUtils ../../geometry/SpatialReference".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u){async function x(I,D,G){const {collection:{links:C,landingPage:{url:F}},layerDefinition:J,maxRecordCount:T,queryParameters:{apiKey:S,customParameters:ba},spatialReference:M,supportedCrs:U}=I;var R=v(C,"items",K.geojson)||v(C,"http://www.opengis.net/def/rel/ogc/1.0/items",K.geojson);if(null==R)throw new g("ogc-feature-layer:missing-items-page","Missing items url");const {geometry:Z,num:ea,start:ma,timeExtent:V,where:aa}=D;if(D.objectIds)throw new g("ogc-feature-layer:query-by-objectids-not-supported",
"Queries with object ids are not supported");I=u.fromJSON(M);D=D.outSpatialReference??I;I=D.isWGS84?null:y(D,U);if(null==Z||"extent"!==Z.type)var ja=null;else if({spatialReference:ja}=Z,!ja||ja.isWGS84)ja={bbox:A(Z)};else{var oa=y(ja,U);ja=null!=oa?{bbox:A(Z),"bbox-crs":oa}:ja.isWebMercator?{bbox:A(f.project(Z,u.WGS84))}:null}oa=ja;if(null==V)ja=null;else{var {start:wa,end:ta}=V;ja=`${null!=wa?wa.toISOString():".."}/${null!=ta?ta.toISOString():".."}`}const va=ja;var xa=null!=aa&&aa&&"1\x3d1"!==aa?
aa:null;ja=ea??(null==ma?T:10);const L=0===ma?void 0:ma,{fields:P,geometryType:fa,hasZ:ka,objectIdField:qa,paginationParameter:Q}=J;R=m.makeAbsolute(R.href,F);({data:R}=await r(R,{...G,query:{...ba,...oa,crs:I,datetime:va,query:xa,limit:ja,[Q]:L,token:S},headers:{accept:K.geojson}}));G=n.createOptimizedFeatures(R,{geometryType:fa,hasZ:ka,objectIdField:qa});R=G.length===ja&&!!v(R.links??[],"next",K.geojson);ja=new t(P);for(var X of G)oa={},w.mixAttributes(ja,oa,X.attributes),oa[qa]=X.attributes[qa],
X.attributes=oa;if(!I&&D.isWebMercator)for(var Y of G)null!=Y.geometry&&null!=fa&&(X=c.convertToGeometry(Y.geometry,fa,ka,!1),X.spatialReference=u.WGS84,Y.geometry=c.convertFromGeometry(f.project(X,D)));for(var ia of G)ia.objectId=ia.attributes[qa];Y=I||!I&&D.isWebMercator?D.toJSON():b.wgs84;ia=new h;ia.exceededTransferLimit=R;ia.features=G;ia.fields=P;ia.geometryType=fa;ia.hasZ=ka;ia.objectIdFieldName=qa;ia.spatialReference=Y;return ia}function y(I,D){const {isWebMercator:G,wkid:C}=I;return C?(I=
G?D[3857]??D[102100]??D[102113]??D[900913]:D[I.wkid])?`${"http://www.opengis.net/def/crs/"}${I}`:null:null}function A(I){if(null==I)return"";const {xmin:D,ymin:G,xmax:C,ymax:F}=I;return`${D},${G},${C},${F}`}function k(I){I=I.extent?.spatial;if(!I)return null;var D=I.bbox[0],G=4===D.length;const [C,F]=D;I=G?void 0:D[2];const J=G?D[2]:D[3],T=G?D[3]:D[4];D=G?void 0:D[5];G=u.WGS84.toJSON();return{xmin:C,ymin:F,xmax:J,ymax:T,zmin:I,zmax:D,spatialReference:G}}function v(I,D,G){return I.find(({rel:C,type:F})=>
C===D&&F===G)??I.find(({rel:C,type:F})=>C===D&&!F)}function B(I,D,G){if(G&&(G=v(G,"next",K.geojson),G=m.urlToObject(G?.href)?.query)){I=m.urlToObject(I).query;var C=Object.keys(I??{});return Object.entries(G).filter(([F])=>!C.includes(F)).find(([F,J])=>E.has(F.toLowerCase())&&Number.parseInt(J,10)===D)?.[0]}}const z=()=>p.getLogger("esri.layers.ogc.ogcFeatureUtils"),E=new Set(["startindex","offset"]);var K;(function(I){I.json="application/json";I.geojson="application/geo+json";I.openapi="application/vnd.oai.openapi+json;version\x3d3.0"})(K||=
{});a.crsDefault="http://www.opengis.net/def/crs/OGC/1.3/CRS84";a.crsPrefix="http://www.opengis.net/def/crs/";a.getCollectionDefinition=async function(I,D,G={},C=5){var {links:F}=I;F=v(F,"items",K.geojson)||v(F,"http://www.opengis.net/def/rel/ogc/1.0/items",K.geojson);if(null==F)throw new g("ogc-feature-layer:missing-items-page","Missing items url");const {apiKey:J,customParameters:T,signal:S}=G;G=m.makeAbsolute(F.href,I.landingPage.url);F=m.addQueryParameters(G,{limit:C,...T,token:J});({data:G}=
await r(F,{signal:S,headers:{accept:K.geojson}}));C=B(F,C,G.links)??"startindex";n.validateGeoJSON(G);const ba=n.inferLayerProperties(G,{geometryType:D.geometryType});G=D.fields||ba.fields||[];F=null!=D.hasZ?D.hasZ:ba.hasZ;const M=ba.geometryType,U=D.objectIdField||ba.objectIdFieldName||"OBJECTID";D=D.timeInfo;var R=G.find(({name:ma})=>ma===U);if(R)R.editable=!1,R.nullable=!1;else{if(!ba.objectIdFieldType)throw new g("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");
G.unshift({name:U,alias:U,type:"number"===ba.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}U!==ba.objectIdFieldName&&(R=G.find(({name:ma})=>ma===ba.objectIdFieldName))&&(R.type="esriFieldTypeInteger");G===ba.fields&&0<ba.unknownFields.length&&z().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:ba.unknownFields}});for(var Z of G){null==Z.name&&(Z.name=
Z.alias);null==Z.alias&&(Z.alias=Z.name);"esriFieldTypeOID"!==Z.type&&"esriFieldTypeGlobalID"!==Z.type&&(Z.editable=null==Z.editable||!!Z.editable,Z.nullable=null==Z.nullable||!!Z.nullable);if(!Z.name)throw new g("ogc-feature-layer:invalid-field-name","field name is missing",{field:Z});if(!l.kebabDict.jsonValues.includes(Z.type))throw new g("ogc-feature-layer:invalid-field-type",`invalid type for field "${Z.name}"`,{field:Z});}if(D){Z=new t(G);D.startTimeField&&((R=Z.get(D.startTimeField))?(D.startTimeField=
R.name,R.type="esriFieldTypeDate"):D.startTimeField=null);D.endTimeField&&((R=Z.get(D.endTimeField))?(D.endTimeField=R.name,R.type="esriFieldTypeDate"):D.endTimeField=null);D.trackIdField&&((Z=Z.get(D.trackIdField))?D.trackIdField=Z.name:(D.trackIdField=null,z().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:D}})));var ea;(ea=D).timeReference||(ea.timeReference={timeZoneIANA:e.utc});D.startTimeField||D.endTimeField||(z().warn({name:"ogc-feature-layer:invalid-timeInfo",
message:"startTimeField and endTimeField are missing",details:{timeInfo:D}}),D=void 0)}ea=M?d.createDrawingInfo(M):null;I=k(I);return{drawingInfo:ea,extent:I,geometryType:M,fields:G,hasZ:!!F,objectIdField:U,paginationParameter:C,timeInfo:D}};a.getServerCollections=async function(I,D={}){const {links:G,url:C}=I,F=v(G,"data",K.json)||v(G,"http://www.opengis.net/def/rel/ogc/1.0/data",K.json);if(null==F)throw new g("ogc-feature-layer:missing-collections-page","Missing collections url");const {apiKey:J,
customParameters:T,signal:S}=D;D=m.makeAbsolute(F.href,C);({data:D}=await r(D,{signal:S,headers:{accept:K.json},query:{...T,token:J}}));for(const ba of D.collections)ba.landingPage=I;return D};a.getServerConformance=async function(I,D={}){const {links:G,url:C}=I;I=v(G,"conformance",K.json)||v(G,"http://www.opengis.net/def/rel/ogc/1.0/conformance",K.json);if(null==I)throw new g("ogc-feature-layer:missing-conformance-page","Missing conformance url");const {apiKey:F,customParameters:J,signal:T}=D;D=
m.makeAbsolute(I.href,C);({data:D}=await r(D,{signal:T,headers:{accept:K.json},query:{...J,token:F}}));return D};a.getServerLandingPage=async function(I,D={}){const {apiKey:G,customParameters:C,signal:F}=D;({data:D}=await r(I,{signal:F,headers:{accept:K.json},query:{...C,token:G}}));D.url=I;return D};a.getServerOpenApi=async function(I,D={}){const {links:G,url:C}=I;I=v(G,"service-desc",K.openapi);if(null==I)return z().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),
null;const {apiKey:F,customParameters:J,signal:T}=D;D=m.makeAbsolute(I.href,C);({data:D}=await r(D,{signal:T,headers:{accept:K.openapi},query:{...J,token:F}}));return D};a.getSpatialReferenceWkid=function(I){I=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(I)?.groups;if(!I)return null;const {authority:D,code:G}=I;switch(D.toLowerCase()){case "ogc":switch(G.toLowerCase()){case "crs27":return u.GCS_NAD_1927.wkid;case "crs83":return 4269;case "crs84":case "crs84h":return u.WGS84.wkid;
default:return null}case "esri":case "epsg":return I=Number.parseInt(G,10),Number.isNaN(I)?null:I;default:return null}};a.queryFeatureSetJSON=async function(I,D,G){I=await x(I,D,G);return c.convertToFeatureSet(I)};a.queryOptimizedFeatureSet=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define("exports ../../../../core/date ../../../../core/Error ../../../../geometry/support/spatialReferenceUtils ../../OptimizedFeature ../../OptimizedGeometry ../../../support/fieldUtils".split(" "),
function(a,q,r,g,p,m,b){function*f(k){switch(k.type){case "Feature":yield k;break;case "FeatureCollection":for(const v of k.features)v&&(yield v)}}function*c(k){if(k)switch(k.type){case "Point":yield k.coordinates;break;case "LineString":case "MultiPoint":yield*k.coordinates;break;case "MultiLineString":case "Polygon":for(const v of k.coordinates)yield*v;break;case "MultiPolygon":for(const v of k.coordinates)for(const B of v)yield*B}}function*h(k,v={}){const {geometryType:B,objectIdField:z}=v;for(const E of k){const {geometry:K,
properties:I,id:D}=E;if(K&&A[K.type]!==B)continue;k=I||{};let G=void 0;z&&(G=k[z],null==D||G||(k[z]=G=D));yield new p.OptimizedFeature(K?t(new m,K,v):null,k,null,G??void 0)}}function n(k){for(const v of k)if(2<v.length)return!0;return!1}function d(k){let v=0;for(let B=0;B<k.length;B++){const z=k[B],E=k[(B+1)%k.length];v+=z[0]*E[1]-E[0]*z[1]}return 0>=v}function w(k){const v=k[0],B=k[k.length-1];v[0]===B[0]&&v[1]===B[1]&&v[2]===B[2]||k.push(v);return k}function t(k,v,B){switch(v.type){case "LineString":return u(k,
v.coordinates,B),k;case "MultiLineString":for(const E of v.coordinates)u(k,E,B);return k;case "MultiPoint":return u(k,v.coordinates,B),k;case "MultiPolygon":for(var z of v.coordinates)for(l(k,z[0],B),v=1;v<z.length;v++)e(k,z[v],B);return k;case "Point":return y(k,v.coordinates,B),k;case "Polygon":z=v.coordinates;l(k,z[0],B);for(v=1;v<z.length;v++)e(k,z[v],B);return k}}function l(k,v,B){v=w(v);d(v)?u(k,v,B):x(k,v,B)}function e(k,v,B){v=w(v);d(v)?x(k,v,B):u(k,v,B)}function u(k,v,B){for(const z of v)y(k,
z,B);k.lengths.push(v.length)}function x(k,v,B){for(let z=v.length-1;0<=z;z--)y(k,v[z],B);k.lengths.push(v.length)}function y(k,v,B){const [z,E,K]=v;k.coords.push(z,E);B.hasZ&&k.coords.push(K||0)}const A={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};a.createOptimizedFeatures=function(k,v){return Array.from(h(f(k),v))};a.getGeometryType=function(k){return A[k]};
a.inferLayerProperties=function(k,v={}){const B=[];var z=new Set;const E=new Set;var K=!1;let I=null,D=!1,G=void 0;({geometryType:v=null}=v);var C=!1;for(const F of f(k)){const {geometry:J,properties:T,id:S}=F;if(J&&(v||=A[J.type],A[J.type]!==v))continue;K||(K=c(J),K=n(K));!D&&(D=null!=S)&&(G=typeof S,T&&(I=Object.keys(T).filter(ba=>T[ba]===S)));T&&I&&D&&null!=S&&(1<I.length?I=I.filter(ba=>T[ba]===S):1===I.length&&(I=T[I[0]]===S?I:[]));if(!C&&T){k=!0;for(const ba in T){if(z.has(ba))continue;C=T[ba];
if(null==C){k=!1;E.add(ba);continue}a:switch(typeof C){case "string":C=q.isISO8601Date(C)?"esriFieldTypeDate":"esriFieldTypeString";break a;case "number":C="esriFieldTypeDouble";break a;default:C="unknown"}if("unknown"===C){E.add(ba);continue}E.delete(ba);z.add(ba);const M=b.normalizeFieldName(ba);M&&B.push({name:M,alias:ba,type:C})}C=k}}if(z=b.normalizeFieldName(1===I?.length&&I[0]||null)??void 0)for(const F of B)if(F.name===z&&b.isNumericField(F)){F.type="esriFieldTypeOID";break}return{fields:B,
geometryType:v,hasZ:K,objectIdFieldName:z,objectIdFieldType:G,unknownFields:Array.from(E)}};a.validateGeoJSON=function(k,v=4326){if(!k)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==k.type&&"FeatureCollection"!==k.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:k});({crs:k}=k);if(k){var B="string"===typeof k?k:"name"===k.type?k.properties.name:"EPSG"===k.type?k.properties.code:null;v=g.isWGS84({wkid:v})?RegExp(".*(CRS84H?|4326)$",
"i"):new RegExp(`.*(${v})$`,"i");if(!B||!v.test(B))throw new r("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:k});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(a){function q(b){const f=new Date(b);if(Number.isNaN(f.getTime()))b=!1;else{var c=!0;if(m&&/\d+\W*$/.test(b)&&(b=b.match(/[a-zA-Z]{2,}/))){c=!1;let h=0;for(;!c&&h<=b.length;)c=!p.test(b[h]),h++;c=!c}b=c}return b?Number.isNaN(f.getTime())?null:f.getTime()-
6E4*f.getTimezoneOffset():null}function r(b){b=g.exec(b);if(!b?.groups)return null;b=b.groups;const f=+b.year,c=+b.month-1,h=+b.day,n=+(b.hours??0),d=+(b.minutes??0),w=+(b.seconds??0);if(23<n||59<d||59<w)return null;var t=b.ms??"0";t=t?+t.padEnd(3,"0").substring(0,3):0;b=b.isUTC||!b.offsetSign?Date.UTC(f,c,h,n,d,w,t):6E4*("+"===b.offsetSign?-1:1)*(60*+b.offsetHours+ +b.offsetMinutes)+Date.UTC(f,c,h,n,d,w,t);return Number.isNaN(b)?null:b}const g=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,
p=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,m=!Number.isNaN((new Date("technology 10")).getTime());a.isDateString=function(b){return null!=r(b)||null!=q(b)};a.isISO8601Date=function(b){return g.test(b)};a.parseDate=function(b){return r(b)??q(b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define(["exports",
"../../../../core/has","../../../../core/lang","../../data/QueryEngineCapabilities","../../../../symbols/support/defaultsJSON"],function(a,q,r,g,p){function m(c){return b.test(c)?`.${c}`:`["${c}"]`}const b=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let f=1;a.createCapabilities=function(c,h){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:c},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,
supportsValidateSql:!1,supportsAdd:h,supportsDelete:h,supportsEditing:h,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:h,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:g.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:h,
supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}};a.createDefaultAttributesFunction=function(c,h){if(q("esri-csp-restrictions"))return()=>({[h]:null,...c});try{let n=`this${m(h)} = null;`;for(const w in c){const t=m(w);n+=`this${t} = ${JSON.stringify(c[w])};`}const d=
(new Function(`\n      return class AttributesClass$${f++} {\n        constructor() {\n          ${n};\n        }\n      }\n    `))();return()=>new d}catch(n){return()=>({[h]:null,...c})}};a.createDefaultTemplate=function(c={}){return[{name:"New Feature",description:"",prototype:{attributes:r.clone(c)}}]};a.createDrawingInfo=function(c){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===c||"esriGeometryMultipoint"===c?p.defaultPointSymbolJSON:"esriGeometryPolyline"===c?p.defaultPolylineSymbolJSON:
p.defaultPolygonSymbolJSON}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../../core/date","../../../../geometry/support/spatialReferenceUtils","../../../support/fieldUtils"],function(a,q,r,g,p){function m(w){return new c(w)}async function b(){null==d&&(d=await new Promise((w,t)=>a(["../../../../geometry/geometryEngineJSON"],w,t)));return d}class f{constructor(){this.description=this.code=
null}}class c{constructor(w){this.error=new f;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=w}}class h{constructor(w){this.globalId=null;this.success=!0;this.objectId=this.uniqueId=w}}const n=new Set;let d;q.createFeatureEditErrorResult=m;q.createFeatureEditSuccessResult=function(w){return new h(w)};q.loadGeometryEngineForSimplify=async function(w,t){!g.isValid(w)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await b()};q.mixAttributes=function(w,
t,l,e=!1){n.clear();for(const y in l){const A=w.get(y);if(!A)continue;var u=A,x=l[y];let k=x;p.isNumericField(u)&&"string"===typeof x?k=parseFloat(x):p.isStringField(u)&&null!=x&&"string"!==typeof x?k=String(x):p.isDateField(u)&&"string"===typeof x&&(k=r.parseDate(x));u=p.sanitizeNullFieldValue(k);n.add(A.name);if(A&&(e||A.editable)){if(x=p.validateFieldValue(A,u))return m(p.validationErrorToString(x,A,u));t[A.name]=u}}for(const y of w?.requiredFields??[])if(!n.has(y.name))return m(`missing required field "${y.name}"`);
return null};q.simplify=function(w,t){if(!w||!g.isValid(t))return w;if("rings"in w||"paths"in w){if(null==d)throw new TypeError("geometry engine not loaded");return d.simplify(t,w)}return w};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBF":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/pbf ../../../../../layers/graphics/OptimizedGeometry ./FeatureSetCache ./FeatureSetReader ./FeatureSetReaderPBFHeader".split(" "),
function(a,q,r,g,p,m,b,f,c,h){function n(e){if(e<=t.small.delta.length)return t.small;if(e<=t.large.delta.length)return t.large;t.large.delta=new Int32Array(Math.round(1.25*e));t.large.decoded=new Int32Array(Math.round(1.25*e));return t.large}function d(e){var u=e.getLength();for(u=e.pos()+u;e.pos()<u&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();
case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function w(e,u,x,y){return 0===e*y-x*u&&0<e*x+u*y}const t={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(128E3),decoded:new Int32Array(128E3)}};class l extends c.FeatureSetReader{static fromBuffer(e,u,x=!1){const y=u.geometryType;a:{try{const v=new m(new Uint8Array(e),new DataView(e));for(;v.next();)switch(v.tag()){case 2:b:{for(var A=v.getMessage();A.next();)switch(A.tag()){case 1:var k=
A.getMessage();break b;default:A.skip()}k=null}break a;default:v.skip()}}catch(v){e=new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:v}),g.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(e)}k=null}e=k;x=h.parseHeader(e,"esriGeometryPoint"===y,x);return new l(e,x,u)}constructor(e,u,x){super(x);this._isPoints=this._hasNext=!1;this._featureIndex=-1;this._featureOffset=0;this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,
legacyFeature:void 0,optFeature:void 0};this._parseCaches=[];this._geometryType=x.geometryType;this._reader=e;this._header=u;this._hasNext=u.hasFeatures;this._isPoints="esriGeometryPoint"===x.geometryType}get _size(){return this._header.featureCount}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get hasZ(){return!1}get hasM(){return!1}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getInTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=
0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;this._cache.optFeature=void 0;this._featureIndex=e}getAttributeHash(){let e="";for(const u of this._header.fields.fields)e+=this._readAttributeAtIndex(u.index)+".";return e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=
e}readGeometryArea(){this._cache.area||this._readGeometry(!0);return this._cache.area}copy(){var e=this._reader.clone();e=new l(e,this._header,this.metadata);this.copyInto(e);return e}next(){this._cache.area=0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;for(this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readX(){return this._header.centroid[2*this._featureIndex]}_readY(){return this._header.centroid[2*
this._featureIndex+1]}_readServerCentroid(){const e=this._header.centroid[2*this._featureIndex];return 268435455===e?null:new b([],[e,this._header.centroid[2*this._featureIndex+1]])}_readGeometry(e=!1){if(void 0===this._cache.geometry){let u=null;if(this._isPoints){if(268435455===this._header.centroid[2*this._featureIndex])return null;u=new b([],[this._header.centroid[2*this._featureIndex],this._header.centroid[2*this._featureIndex+1]])}else{const x=this._header.offsets.geometry[this._featureIndex],
y=this._reader;if(0===x)return null;y.move(x);try{u=e?this._parseGeometryForDisplay(y):this._parseGeometry(y)}catch(A){return null}}0===u?.coords.length&&(u=null);return this._cache.geometry=u}return this._cache.geometry}_readAttribute(e,u){const x=this._header.fields.get(e);if(null!=x){var y=this._readAttributeAtIndex(x.index);"esriFieldTypeTimestampOffset"===this.fields.get(e)?.type&&(y=this.parseTimestampOffset(y));e=this._header.fields.isDateField(x.name);return u&&null!=y?e?new Date(y):y:y}}_readAttributes(){const e=
{};for(const u of this._header.fields.fields)e[u.name]=this._readAttributeAtIndex(u.index);return e}copyInto(e){super.copyInto(e);e._featureIndex=this._featureIndex;e._featureOffset=this._featureOffset;e._hasNext=this._hasNext;e._parseCaches=this._parseCaches}_readAttributeAtIndex(e){let u=this._parseCaches[e];u||(u=new f.FeatureSetCache(this.getSize()),this._parseCaches[e]=u);if(u.has(this._featureIndex))return u.get(this._featureIndex);const x=this._reader;x.move(this._header.offsets.attributes[this._featureIndex*
this._header.fieldCount+e]);e=d(x);u.set(this._featureIndex,e);return e}_readGeometryDeltaDecoded(e=!1){if(void 0===this._cache.unquantGeometry){e=this._readGeometry(e);if(!e)return this._cache.unquantGeometry=void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=e;var u=n(e.coords.length).decoded;e=e.clone(u);u=e.coords;let x=0;for(const y of e.lengths){for(let A=1;A<y;A++){const k=2*(x+A),v=2*(x+A-1);u[k]+=u[v];u[k+1]+=u[v+1]}x+=y}return this._cache.unquantGeometry=e}return this._cache.unquantGeometry}_parseGeometry(e){e=
e.asUnsafe();var u=e.getLength();u=e.pos()+u;const x=[],y=[];for(;e.pos()<u&&e.next();)switch(e.tag()){case 2:var A=e.getUInt32();for(A=e.pos()+A;e.pos()<A;)y.push(e.getUInt32());break;case 3:A=e.getUInt32();A=e.pos()+A;x.push(e.getSInt64());x.push(e.getSInt64());this.hasZ&&e.getSInt64();for(this.hasM&&e.getSInt64();e.pos()<A;)x.push(e.getSInt64()),x.push(e.getSInt64()),this.hasZ&&e.getSInt64(),this.hasM&&e.getSInt64();break;default:e.skip()}return new b(y,x)}_parseGeometryForDisplay(e){e=e.asUnsafe();
var u=e.getLength();u=e.pos()+u;const x=[],y=[];let A=0,k=0;var v=null;let B=0;const z="esriGeometryPolygon"===this.geometryType;for(;e.pos()<u&&e.next();)switch(e.tag()){case 2:v=e.getUInt32();for(v=e.pos()+v;e.pos()<v;){var E=e.getUInt32();x.push(E);A+=E}v=n(2*A).delta;break;case 3:e.getUInt32();E=2+(this.hasZ?1:0)+(this.hasM?1:0);p.assertIsSome(v);for(const S of x)if(k+E*S>v.length)for(var K=0;K<S;K++)e.getSInt32(),e.getSInt32(),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();else if(z){K=this.getAreaSimplificationThreshold(S,
this._header.vertexCount);var I=2,D=1,G=e.getSInt32(),C=e.getSInt32();v[k++]=G;v[k++]=C;this.hasZ&&e.getSInt32();this.hasM&&e.getSInt32();var F=e.getSInt32(),J=e.getSInt32();this.hasZ&&e.getSInt32();for(this.hasM&&e.getSInt32();I<S;){var T=e.getSInt32();let ba=e.getSInt32();this.hasZ&&e.getSInt32();this.hasM&&e.getSInt32();const M=G+F,U=C+J,R=M+T,Z=U+ba;.5*Math.abs(G*U+M*Z+R*C-G*Z-M*C-R*U)>=K?(B+=-.5*(M-G)*(U+C),1<D&&w(v[k-2],v[k-1],F,J)?(v[k-2]+=F,v[k-1]+=J):(v[k++]=F,v[k++]=J,D++),G=M,C=U):(T+=
F,ba+=J);F=T;J=ba;I++}3>D?k-=2*D:(B+=-.5*(G+F-G)*(C+J+C),w(v[k-2],v[k-1],F,J)?(v[k-2]+=F,v[k-1]+=J,y.push(D)):(v[k++]=F,v[k++]=J,y.push(++D)))}else{K=0;I=e.getSInt32();D=e.getSInt32();this.hasZ&&e.getSInt32();this.hasM&&e.getSInt32();v[k++]=I;v[k++]=D;K+=1;for(G=1;G<S;G++)C=e.getSInt32(),F=e.getSInt32(),J=I+C,T=D+F,B+=-.5*(J-I)*(T+D),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32(),2<G&&w(v[k-2],v[k-1],C,F)?(v[k-2]+=C,v[k-1]+=F):(v[k++]=C,v[k++]=F,K+=1),I=J,D=T;y.push(K)}break;default:e.skip()}this._cache.area=
B;return y.length?new b(y,v):null!=v?this._createQuantizedExtrudedGeometry(v[0],v[1]):null}}a.FeatureSetReaderPBF=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFHeader":function(){define(["exports","../../../../../core/Error","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(a,q,r,g){class p{constructor(){this.exceededTransferLimit=this.hasFeatures=!1;this.vertexCount=
this.objectIdFieldIndex=this.featureCount=this.fieldCount=0;this.offsets={attributes:[],geometry:[]};this.centroid=[]}}a.FeatureSetHeader=p;a.parseHeader=function(m,b,f=!1){m=m.asUnsafe();const c=m.pos(),h=new p;let n=0,d=0,w=null,t=null,l=null,e=!1;const u=[];for(;m.next();)switch(m.tag()){case 1:w=m.getString();break;case 3:t=m.getString();break;case 12:l=m.processMessage(g.parseTransform);break;case 9:h.exceededTransferLimit=m.getBool();if(h.exceededTransferLimit){h.offsets.geometry=f?new Float64Array(8E3):
new Int32Array(8E3);h.centroid=f?new Float64Array(16E3):new Int32Array(16E3);for(var x=0;x<h.centroid.length;x++)h.centroid[x]=268435455}break;case 13:x=m.processMessage(g.parseField);x.index=n++;u.push(x);break;case 15:x=m.getLength();x=m.pos()+x;if(!h.exceededTransferLimit){var y=h.centroid;h.offsets.geometry.push(0);y.push(268435455);y.push(268435455)}!e&&h.exceededTransferLimit&&(e=!0,h.offsets.attributes=f?new Float64Array(8E3*n):new Uint32Array(8E3*n));for(y=d*n;m.pos()<x&&m.next();)switch(m.tag()){case 1:e?
h.offsets.attributes[y++]=m.pos():h.offsets.attributes.push(m.pos());var A=m.getLength();m.skipLen(A);break;case 2:if(b)for(A=m.getLength(),A=m.pos()+A;m.pos()<A&&m.next();)switch(m.tag()){case 3:m.getUInt32();var k=m.getSInt64(),v=m.getSInt64();h.centroid[2*d]=k;h.centroid[2*d+1]=v;break;default:m.skip()}else h.offsets.geometry[d]=m.pos(),A=m.getLength(),h.vertexCount+=A,m.skipLen(A);break;case 4:A=m.getLength();for(A=m.pos()+A;m.pos()<A&&m.next();)switch(m.tag()){case 3:m.getUInt32();k=m.getSInt64();
v=m.getSInt64();h.centroid[2*d]=k;h.centroid[2*d+1]=v;break;default:m.skip()}break;default:m.skip()}d++;h.hasFeatures=!0;break;default:m.skip()}b=w||t;if(!b)throw new q("FeatureSet has no objectId or globalId field name");h.fields=new r(u);h.featureCount=d;h.fieldCount=n;h.objectIdFieldIndex=h.fields.get(b)?.index;h.transform=l;h.displayIds=new Uint32Array(h.featureCount);h.groupIds=new Uint16Array(h.featureCount);m.move(c);return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/sources/strategies/chunks/DrillDownTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(g,p,m,b,f,c){super();this._reader=g;this._queryJSON=p;this._tile=m;this._sourceTile=b;this._sourceTileDepth=f;this._end=c;this.chunkId=`${this._tile.key.id}.${this._sourceTile?.key.id}${this._end?"e":""}`;this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._sourceTile?.key.normalizedId}${this._end?"e":""}`}get queryInfo(){return{type:"drill-down-tile",
chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:this._sourceTile?.key.id,size:this.size(),end:this.end}}get first(){return 0===this._sourceTileDepth}get reader(){return this._reader}get end(){return this._end}get tile(){return this._tile}get isTiled(){return!0}getTileReader(g){return this._tile.key.id===g.key.id?this.reader:null}}a.DrillDownTileSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/PagedTileLoadStrategy":function(){define("exports ../../../../../../core/handleUtils ../../../../../../core/promiseUtils ./ATileLoadStrategy ./chunks/PagedTileSourceChunk ../../support/FeatureSetReaderJSON".split(" "),
function(a,q,r,g,p,m){class b{constructor(c,h){this.subscription=c;this._pages=new Set;this._controller=new AbortController;this._done=!1;this._handles=q.handlesGroup([r.onAbort(c.signal,()=>this._controller.abort()),r.onAbort(h,()=>this._controller.abort())])}destroy(){this._controller.abort();this._handles.remove()}get pageStart(){let c=-1;for(const h of this._pages.values())c=Math.max(c,h);return c+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(c,h){this._pages.add(c);
this._done=this._done||h}}class f extends g.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}destroy(){super.destroy();for(const c of this._loadStates.values())c.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(c){this._loadStates.has(c.key.id)||this._loadStates.set(c.key.id,new b(c,this._options));const h=this._loadStates.get(c.key.id);let n;try{await this._fetchPages(h)}catch(d){n=d}c=new p.PagedTileSourceChunk(m.FeatureSetReaderJSON.empty(this._metadata),
null,c.tile,-1,!0);r.isAborted(h.options)||this._addChunk(c);if(n)throw n;}unload(c){super.unload(c);this._loadStates.get(c.key.id)?.destroy();this._loadStates.delete(c.key.id)}async _fetchPages(c){let h=0,n=c.pageStart,d=1;for(;20>h&&!c.done;){var w=[];for(let t=0;t<d;t++)w.push(this._fetchChunk(c,n++));w=await Promise.all(w);for(const t of w)if(0!==t.size()||t.first)c.add(t.page,!t.reader.exceededTransferLimit),r.throwIfAborted(c.options),this._addChunk(t);h++;d=Math.min(d+1,4)}}async _fetchChunk(c,
h){const n=c.subscription.tile,d=this._queryInfo.createPagedTileQuery(n,h);c=await this._fetch(d,c.options);return new p.PagedTileSourceChunk(c,d.inner.toJSON(),n,h,!1)}}a.PagedTileLoadStrategy=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/PagedTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(g,p,m,b,f){super();this._reader=g;this._queryJSON=p;this._tile=
m;this._page=b;this._end=f;this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`;this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._page}${this.end?"e":""}`}get queryInfo(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get page(){return this._page}get tile(){return this._tile}get isTiled(){return!0}getTileReader(g){return this._tile.key.id===
g.key.id?this.reader:null}}a.PagedTileSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/SnapshotLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../core/promiseUtils ../../../../../../core/RandomLCG ./AFetchLoadStrategy ./chunks/FeatureSnapshotSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(a,q,r,g,p,m,b){class f extends p.AFetchLoadStrategy{constructor(c,h,n,d,w,t){super(c,
h,n,w,t);this._random=new g(1E3);this._featureCount=d}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(c){null==this._promise&&(this._promise=this._downloadPages(this._featureCount));return this._promise}unload(c){}async _downloadPages(c){c=Array.from({length:Math.ceil(c/this._queryInfo.pageSize)},(n,d)=>d).sort((n,d)=>this._random.getInt()-this._random.getInt());c=await Promise.all(c.map(n=>this._downloadPage(n)));const h=new m.FeatureSnapshotSourceChunk(b.FeatureSetReaderJSON.empty(this._metadata),
null,-1,!0);this._store.insert(h);c=c.filter(n=>n);if(c.length)throw new q("featurelayer-query","Encountered errors when downloading data",{errors:c});}async _downloadPage(c){try{const h=this._queryInfo.createPagedQuery(c),n=await this._fetch(h,this._options),d=new m.FeatureSnapshotSourceChunk(n,h.inner.toJSON(),c,!1);r.throwIfAborted(this._options);this._store.insert(d);return null}catch(h){return h}}}a.SnapshotLoadStrategy=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/FeatureSnapshotSourceChunk":function(){define(["exports",
"./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(g,p,m,b){super();this._reader=g;this._queryJSON=p;this._page=m;this._end=b;this.normalizedChunkId=this.chunkId=`${this._page}${this.end?"e":""}`}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(g){const p=this.queryFeaturesInBounds(g.bounds);
p.setTransformForDisplay(g.transform);return p}}a.FeatureSnapshotSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/StreamLoadStrategy":function(){define("exports ../../../../../../core/Evented ../../../../../../core/handleUtils ../../../../../../core/has ../../../../../../core/maybe ../../../../../../layers/graphics/data/StreamFeatureManager ../../../../../../layers/graphics/sources/connections/createConnection ../StreamConnectionState ../StreamFeatureStore ./ALoadStrategy ./chunks/StreamSourceChunk".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){class d extends h.ALoadStrategy{constructor(w,t,l,e,u){super(l);this._service=w;this._dataFilter=t;this._streamOptions=e;this._metadata=u;this._connectionState=new f.StreamConnectionState;this._forceRefresh=!1;this.events=new q;const {objectIdField:x,timeInfo:y}=this._metadata;({purgeOptions:w}=t);this._stagingStore=new c.StreamFeatureStore(this._metadata,A=>this.events.emit("features-updated",A));this._manager=new m.StreamFeatureManager(this._stagingStore,x,y,w);this.connect()}destroy(){super.destroy();
this.disconnect()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState?.errorString}async refresh(){const w=null!=this._chunk;if(this._manager.checkForUpdates()||!w||this._forceRefresh)this._chunk&&this._store.remove(this._chunk),this._forceRefresh=!1,this._chunk=new n.StreamSourceChunk(this._stagingStore.reader),this._store.insert(this._chunk);this.events.emit("tick")}async updateFields(w){throw Error("Updating available fields not supported for StreamLayer");
}async load(w){}unload(w){}disconnect(){this._connection=p.destroyMaybe(this._connection);this._connectionState.connection=null;this._handlesGroup?.remove()}connect(){if(null==this._connection){var {geometryType:w,spatialReference:t}=this._metadata,{maxReconnectionAttempts:l,maxReconnectionInterval:e,geometryDefinition:u,definitionExpression:x,customParameters:y}=this._dataFilter;this._connection=b.createConnection(this._service.source,t,this._streamOptions.outSR,w,x,u,l,e,y);this._handlesGroup=r.handlesGroup([this._connection.on("data-received",
A=>this._onFeature(A)),this._connection.on("message-received",A=>this._onWebSocketMessage(A))]);this._connectionState.connection=this._connection}}clear(){this._manager.checkForUpdates();this._stagingStore.clear();this._forceRefresh=!0}updateCustomParameters(w){this._connection?.updateCustomParameters(w)}sendMessageToSocket(w){this._connection?.sendMessageToSocket(w)}sendMessageToClient(w){this._connection?.sendMessageToClient(w)}_onWebSocketMessage(w){if("type"in w)switch(w.type){case "delete":if(w.objectIds)for(const t of w.objectIds)this._manager.removeById(t);
if(w.trackIds)for(const t of w.trackIds)this._manager.removeByTrackId(t);break;case "clear":this.clear()}this.events.emit("message-received",w)}_onFeature(w){try{this._manager.add(w),this.events.emit("data-received",w)}catch(t){}}}a.StreamLoadStrategy=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/StreamFeatureManager":function(){define(["exports","../../../core/CircularArray","../../../core/mathUtils"],function(a,q,r){class g{constructor(p,m,b,f,c=128){this._trackIdToObservations=
new Map;this._idCounter=0;this._lastPurge=performance.now();this._addOrUpdated=new Map;this._removed=[];this._maxAge=0;this._timeInfo=b;this._purgeOptions=f;this.store=p;this.objectIdField=m;this.purgeInterval=c;this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(p){this._removed.push(p)}removeByTrackId(p){if(p=this._trackIdToObservations.get(p))for(const m of p.entries)this._removed.push(m)}add(p){if(this._useGeneratedIds){var m=this._nextId();p.attributes[this.objectIdField]=
m;p.objectId=m}else p.objectId=p.attributes[this.objectIdField];m=p.objectId;this._addOrUpdated.set(m,p);this._maxAge=Math.max(this._maxAge,p.attributes[this._timeInfo.startTimeField]);if(this._timeInfo.trackIdField){p=p.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(p)){const b=r.clamp(null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1E3,0,1E3);this._trackIdToObservations.set(p,new q(b))}m=this._trackIdToObservations.get(p)?.enqueue(m);null!=
m&&(this._addOrUpdated.has(m)?this._addOrUpdated.delete(m):this._removed.push(m))}else null==this._trackIdLessObservations&&(this._trackIdLessObservations=new q(1E5)),this._trackIdLessObservations.enqueue(m)}checkForUpdates(){const p=this._getToAdd();var m=this._getToRemove();const b=performance.now();b-this._lastPurge>=this.purgeInterval&&(this._purge(b),this._lastPurge=b);const f=[];if(null!=m)for(var c of m){const h=this.store.removeById(c);null!=h&&f.push(h)}c=[];if(null!=p){m=new Set(m??[]);
for(const h of p)m.has(h.objectId)||(h.attributes.__esri_timestamp__=b,this.store.add(h),c.push(h))}return c.length||f?.length?(this.store.update(c,f),!0):!1}_getToAdd(){if(!this._addOrUpdated.size)return null;const p=Array(this._addOrUpdated.size);let m=0;this._addOrUpdated.forEach(b=>p[m++]=b);this._addOrUpdated.clear();return p}_getToRemove(){const p=this._removed;if(!this._removed.length)return null;this._removed=[];return p}_nextId(){const p=this._idCounter;this._idCounter=(this._idCounter+1)%
4294967294+1;return p}_purge(p){const m=this._purgeOptions;null!=m&&(this._purgeSomeByDisplayCount(m),this._purgeByAge(m),this._purgeByAgeReceived(p,m),this._purgeTracks())}_purgeSomeByDisplayCount(p){if(p.displayCount){var m=this.store.size;if(m>p.displayCount){if(this._timeInfo.trackIdField)for(const b of this._trackIdToObservations.values())if(m>p.displayCount&&b.size){const f=b.dequeue();this._removed.push(f);m--}if(null!=this._trackIdLessObservations)for(p=m-p.displayCount;0<p--;)m=this._trackIdLessObservations.dequeue(),
null!=m&&this._removed.push(m)}}}_purgeByAge(p){const m=this._timeInfo?.startTimeField;if(p.age&&m){var b=this._maxAge-6E4*p.age;this.store.forEach(f=>{f.attributes[m]<b&&this._removed.push(f.objectId)})}}_purgeByAgeReceived(p,m){if(m.ageReceived){var b=p-6E4*m.ageReceived;this.store.forEach(f=>{f.attributes.__esri_timestamp__<b&&this._removed.push(f.objectId)})}}_purgeTracks(){this._trackIdToObservations.forEach((p,m)=>{0===p.size&&this._trackIdToObservations.delete(m)})}}a.StreamFeatureManager=
g;a.defaultStreamIdField="__esri_stream_id__";a.esriTimestamp="__esri_timestamp__";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class a{constructor(q){this._start=this.size=0;this.maxSize=q;this._buffer=Array(q)}get entries(){return this._buffer}enqueue(q){if(this.size===this.maxSize){const r=this._buffer[this._start];this._buffer[this._start]=q;this._start=(this._start+1)%this.maxSize;return r}this._buffer[(this._start+this.size++)%
this.maxSize]=q;return null}dequeue(){if(0===this.size)return null;const q=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return q}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(q){if(0===this.size)return null;for(const r of this._buffer)if(null!=r&&q(r))return r;return null}clear(q){let r=this.dequeue();for(;null!=r;)q&&q(r),r=
this.dequeue()}}return a})},"esri/layers/graphics/sources/connections/createConnection":function(){define(["exports","./GeoEventConnection","./WebSocketConnection","../../../support/ClientSideConnection"],function(a,q,r,g){a.createConnection=function(p,m,b,f,c,h,n,d,w){if(null==c&&null==h)c=null;else{var t={};null!=h&&(t.geometry=h);null!=c&&(t.where=c);c=t}m={source:p,sourceSpatialReference:m,spatialReference:b,geometryType:f,filter:c,maxReconnectionAttempts:n,maxReconnectionInterval:d,customParameters:w};
return p?p.path.startsWith("wss://")||p.path.startsWith("ws://")?new r.WebSocketConnection(m):new q(m):new g.ClientSideConnection(m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/GeoEventConnection":function(){define("require ../../../../chunks/tslib.es6 ../../../../geometry ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./WebSocketConnection ../../../../rest/query/operations/query ../../../../rest/support/Query ../../../../geometry/support/jsonUtils ../../../../geometry/SpatialReference".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n,d,w,t,l,e){const u={maxQueryDepth:5,maxRecordCountFactor:3};r=class extends d.WebSocketConnection{constructor(x){super({...u,...x});this._relatedFeatures=this._buddyServicesQuery=null}async _open(){var x=await this._fetchServiceDefinition(this._config.source);x.timeInfo.trackIdField||m.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");
x=this._fetchWebSocketUrl(x.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices());await this._buddyServicesQuery;await this._tryCreateWebSocket(x);const {filter:y,outFields:A}=this._config;this.destroyed||this._setFilter(y,A)}_onMessage(x){if("attributes"in x){let y;try{y=this._enrich(x),null!=this._featureZScaler&&this._featureZScaler(y.geometry)}catch(A){m.getLogger(this).error(new p("geoevent-connection","Failed to parse message",
A));return}this.onFeature(y)}else this.onMessage(x)}async _fetchServiceDefinition(x){return this._serviceDefinition=x=(await g(x.path,{query:{f:"json",...this._config.customParameters},responseType:"json"})).data}_fetchWebSocketUrl(x,y){const {urls:A,token:k}=x[0];x=this._inferWebSocketBaseUrl(A);return f.addQueryParameters(`${x}/subscribe`,{outSR:""+y.wkid,token:k})}_inferWebSocketBaseUrl(x){if(1===x.length)return x[0];for(const y of x)if(y.includes("wss"))return y;m.getLogger(this).error(new p("geoevent-connection",
"Unable to infer WebSocket url",x));return null}async _setFilter(x,y){const A=this._websocket;if(null!=A&&(null!=x||null!=y)){x=JSON.stringify({filter:this._serializeFilter(x,y)});var k=!1,v=b.createResolver();A.onmessage=B=>{B=JSON.parse(B.data);B.filter&&(B.error&&(m.getLogger(this).error(new p("geoevent-connection","Failed to set service filter",B.error)),this._set("errorString",`Could not set service filter - ${B.error}`),v.reject(B.error)),this._setWebSocketJSONParseHandler(A),k=!0,v.resolve())};
A.send(x);setTimeout(()=>{k||(this.destroyed||this._websocket!==A||m.getLogger(this).error(new p("geoevent-connection","Server timed out when setting filter")),v.reject())},1E4);return v.promise}}_serializeFilter(x,y){const A={};if(null==x&&null==y)return A;if(x?.geometry)try{const k=l.fromJSON(x.geometry);if("extent"!==k.type)throw new p(`Expected extent but found type ${k.type}`);A.geometry=JSON.stringify(k.shiftCentralMeridian())}catch(k){m.getLogger(this).error(new p("geoevent-connection","Encountered an error when setting connection geometryDefinition",
k))}x?.where&&"1 \x3d 1"!==x.where&&"1\x3d1"!==x.where&&(A.where=x.where);null!=y&&(A.outFields=y.join(","));return A}_enrich(x){if(!this._relatedFeatures)return x;const y=this._relatedFeatures.get(x.attributes[this._serviceDefinition.relatedFeatures.joinField]);if(!y)return m.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",x),x;const {attributes:A,geometry:k}=y;for(const v in A)x.attributes[v]=A[v];k&&(x.geometry=k);x.geometry||x.centroid||
m.getLogger(this).error(new p("geoevent-connection","Found malformed feature - no geometry found",x));return x}async _queryBuddyServices(){try{const {relatedFeatures:x,keepLatestArchive:y}=this._serviceDefinition,A=this._queryRelatedFeatures(x),k=this._queryArchive(y);await A;const v=await k;if(v)for(const B of v.features)this.onFeature(this._enrich(B))}catch(x){m.getLogger(this).error(new p("geoevent-connection","Encountered an error when querying buddy services",{error:x}))}}async _queryRelatedFeatures(x){x&&
(x=await this._queryBuddy(x.featuresUrl),this._addRelatedFeatures(x))}async _queryArchive(x){if(x)return this._queryBuddy(x.featuresUrl)}async _queryBuddy(x){const y=new (await new Promise((K,I)=>a(["../../../FeatureLayer"],D=>K(Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}))),I))).default({url:x});var {capabilities:A}=await y.load();const k=A.query.supportsMaxRecordCountFactor,v=A.query.supportsPagination;A=A.query.supportsCentroid;const B=this._config.maxRecordCountFactor;
var z=y.capabilities.query.maxRecordCount;z=k?z*B:z;const E=new t;E.outFields=this._config.outFields??["*"];E.where=this._config.filter?.where??"1\x3d1";E.returnGeometry=!0;E.returnExceededLimitFeatures=!0;E.outSpatialReference=e.fromJSON(this._config.spatialReference);A&&(E.returnCentroid=!0);k&&(E.maxRecordCountFactor=B);if(v)return E.num=z,y.destroy(),this._queryPages(x,E);x=await w.executeQuery(x,E,this._config.sourceSpatialReference);y.destroy();return x.data}async _queryPages(x,y,A=[],k=0){y.start=
null!=y.num?k*y.num:null;const {data:v}=await w.executeQuery(x,y,this._config.sourceSpatialReference);if(v.exceededTransferLimit&&k<(this._config.maxQueryDepth??0))return v.features.forEach(B=>A.push(B)),this._queryPages(x,y,A,k+1);A.forEach(B=>v.features.push(B));return v}_addRelatedFeatures(x){const y=new Map;x=x.features;const A=this._serviceDefinition.relatedFeatures.joinField;for(const k of x)y.set(k.attributes[A],k);this._relatedFeatures=y}};return r=q.__decorate([n.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],
r)})},"esri/layers/graphics/sources/connections/WebSocketConnection":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/zscale ../../../support/StreamConnection".split(" "),function(a,q,r,g,p,m,b,f,c,h,n,d){var w;
(function(t){t[t.CONNECTING=0]="CONNECTING";t[t.OPEN=1]="OPEN";t[t.CLOSING=2]="CLOSING";t[t.CLOSED=3]="CLOSED"})(w||={});a.WebSocketConnection=class extends d{constructor(t){super({});this._outstandingMessages=[];this.errorString=null;const {geometryType:l,spatialReference:e,sourceSpatialReference:u}=t;this._config=t;this._featureZScaler=n.getGeometryZScaler(l,u,e);this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket();this.destroyed||await this._handshake()}destroy(){super.destroy();
null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close());this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case w.CONNECTING:case w.OPEN:return"connected";case w.CLOSING:case w.CLOSED:return"disconnected"}}sendMessageToSocket(t){null==this._websocket?this._outstandingMessages.push(t):this._websocket.send(JSON.stringify(t))}sendMessageToClient(t){this._onMessage(t)}updateCustomParameters(t){this._config.customParameters=
t;null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(t=this._config.source.path,l=1E3,e=0){try{if(!this.destroyed){var u=m.addQueryParameters(t,this._config.customParameters??{});this._websocket=await this._createWebSocket(u);this.notifyChange("connectionStatus")}}catch(x){if(u=l/1E3,this._config.maxReconnectionAttempts&&e>=this._config.maxReconnectionAttempts)g.getLogger(this).error(new r("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),
this.destroy();else return g.getLogger(this).error(new r("websocket-connection",`Failed to connect. Attempting to reconnect in ${u}s`,x)),await p.after(l),this._tryCreateWebSocket(t,Math.min(1.5*l,1E3*this._config.maxReconnectionInterval),e+1)}}_setWebSocketJSONParseHandler(t){t.onmessage=l=>{try{const e=JSON.parse(l.data);this._onMessage(e)}catch(e){g.getLogger(this).error(new r("websocket-connection","Failed to parse message, invalid JSON",{error:e}))}}}_createWebSocket(t){return new Promise((l,
e)=>{const u=new WebSocket(t);u.onopen=()=>{u.onopen=null;this.destroyed?(u.onclose=null,u.close()):(u.onclose=x=>this._onClose(x),u.onerror=x=>this._onError(x),this._setWebSocketJSONParseHandler(u),l(u))};u.onclose=x=>{u.onopen=u.onclose=null;e(x)}})}async _handshake(t=1E4){const l=this._websocket;if(null!=l){var e=p.createResolver(),u=l.onmessage,{filter:x,outFields:y,spatialReference:A}=this._config;e.timeout(t);l.onmessage=k=>{let v=null;try{v=JSON.parse(k.data)}catch(B){}v&&"object"===typeof v||
(g.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - malformed message",k.data)),e.reject(),this.destroy());v.spatialReference?.wkid!==A?.wkid&&(g.getLogger(this).error(new r("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${A.wkid}`,k.data)),e.reject(),this.destroy());"json"!==v.format&&(g.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - format is not set",k.data)),e.reject(),this.destroy());
x&&v.filter!==x&&g.getLogger(this).error(new r("websocket-connection","Tried to set filter, but server doesn't support it"));y&&v.outFields!==y&&g.getLogger(this).error(new r("websocket-connection","Tried to set outFields, but server doesn't support it"));l.onmessage=u;for(const B of this._outstandingMessages)l.send(JSON.stringify(B));this._outstandingMessages=[];e.resolve()};l.send(JSON.stringify({filter:x,outFields:y,format:"json",spatialReference:{wkid:A.wkid}}));return e.promise}}_onMessage(t){this.onMessage(t);
if("type"in t)switch(t.type){case "features":case "featureResult":for(const l of t.features)null!=this._featureZScaler&&this._featureZScaler(l.geometry),this.onFeature(l)}}_onError(t){this._set("errorString","Encountered an error over WebSocket connection");g.getLogger(this).error("websocket-connection","Encountered an error over WebSocket connection")}_onClose(t){this._websocket=null;this.notifyChange("connectionStatus");1E3!==t.code&&g.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${t.code}`);
this.destroyed||this._open()}};q.__decorate([b.property()],a.WebSocketConnection.prototype,"connectionStatus",null);q.__decorate([b.property()],a.WebSocketConnection.prototype,"errorString",void 0);a.WebSocketConnection=q.__decorate([h.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],a.WebSocketConnection);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/StreamConnection":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,q,r,g,p,m,b,f){r=class extends r.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new q("stream-connection",this.errorString):null}onFeature(c){this.emit("data-received",c)}onMessage(c){this.emit("message-received",c)}};a.__decorate([g.property({readOnly:!0})],r.prototype,"connectionError",null);return r=a.__decorate([f.subclass("esri.layers.support.StreamConnection")],r)})},"esri/layers/support/ClientSideConnection":function(){define("exports ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/zscale ./StreamConnection".split(" "),
function(a,q,r,g,p,m,b,f,c){a.ClientSideConnection=class extends c{constructor(h){super({});this.connectionStatus="connected";this.errorString=null;const {geometryType:n,spatialReference:d,sourceSpatialReference:w}=h;this._featureZScaler=f.getGeometryZScaler(n,w,d)}normalizeCtorArgs(){return{}}updateCustomParameters(h){}sendMessageToSocket(h){}sendMessageToClient(h){if("type"in h)switch(h.type){case "features":case "featureResult":for(const n of h.features)null!=this._featureZScaler&&this._featureZScaler(n.geometry),
this.onFeature(n)}this.onMessage(h)}};q.__decorate([r.property()],a.ClientSideConnection.prototype,"connectionStatus",void 0);q.__decorate([r.property()],a.ClientSideConnection.prototype,"errorString",void 0);a.ClientSideConnection=q.__decorate([b.subclass("esri.layers.support.ClientSideConnection")],a.ClientSideConnection);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamConnectionState":function(){define(["exports","../../../../../chunks/tslib.es6",
"../../../../../core/Accessor","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass"],function(a,q,r,g,p){a.StreamConnectionState=class extends r{constructor(m){super(m)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}};q.__decorate([g.property()],a.StreamConnectionState.prototype,"connection",void 0);q.__decorate([g.property()],a.StreamConnectionState.prototype,"connectionStatus",
null);q.__decorate([g.property()],a.StreamConnectionState.prototype,"errorString",null);a.StreamConnectionState=q.__decorate([p.subclass("esri.views.2d.layers.features.sources.StreamConnectionState")],a.StreamConnectionState);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamFeatureStore":function(){define(["exports","../support/FeatureSetReaderJSON"],function(a,q){class r{constructor(g,p){this._metadata=g;this._onUpdate=p;this._objectIdToFeature=
new Map}get size(){return this._objectIdToFeature.size}get reader(){return q.FeatureSetReaderJSON.fromFeatures([...this._objectIdToFeature.values()],this._metadata)}add(g){this._objectIdToFeature.set(g.objectId,g)}forEach(g){this._objectIdToFeature.forEach(g)}removeById(g){const p=this._objectIdToFeature.get(g);return p?(this._objectIdToFeature.delete(g),p):null}clear(){this._objectIdToFeature=new Map}update(g,p){this._onUpdate(g?.length??0)}}a.StreamFeatureStore=r;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/StreamSourceChunk":function(){define(["exports","./ASourceChunk"],function(a,q){class r extends q.ASourceChunk{constructor(g){super();this._reader=g;this.normalizedChunkId=this.chunkId="stream-chunk"}get reader(){return this._reader}get first(){return!0}get end(){return!0}get queryInfo(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(g){const p=this.queryFeaturesInBounds(g.bounds);
p.setTransformForDisplay(g.transform);return p}}a.StreamSourceChunk=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/SourceChunkStore":function(){define("exports ../../../../../../../core/Evented ../../../../../../../core/has ../../../../../../../geometry/support/aaBoundingBox ../../../FeatureStoreQueryAdapter ./OverrideChunk".split(" "),function(a,q,r,g,p,m){class b{constructor(f){this._onChange=f;this._chunks=new Map;this._chunksToRemove=
[];this.events=new q;this.featureAdapter=new p.FeatureStoreQueryAdapter}destroy(){this.clear()}clear(){for(const f of this._chunks.values())this._chunksToRemove.push(f);this._chunks.clear();null!=this._localEditChunk&&this._chunksToRemove.push(this._localEditChunk);this._localEditChunk=null}*chunks(){this._localEditChunk&&(yield this._localEditChunk);this._localOverridesChunk&&(yield this._localOverridesChunk);yield*this._chunks.values()}insert(f){r("esri-2d-update-debug")&&console.debug(`Chunk[${f.chunkId}] SourceChunkStore.insert`);
this._localOverridesChunk?.overriddenIds.size&&(f.reader.removeIds(this._localOverridesChunk.overriddenIds),f.invalidate());this._localEditChunk?.overriddenIds.size&&this._localEditChunk.removeOverrides(f);this._chunks.set(f.chunkId,f);this.events.emit("changed");this._onChange()}remove(f){r("esri-2d-update-debug")&&console.debug(`Chunk[${f.chunkId}] SourceChunkStore.remove`);this._chunks.delete(f.chunkId);this._chunksToRemove.push(f)}cleanupRemovedChunks(){const f=this._chunksToRemove;this._chunksToRemove=
[];return f}applyLocalOverrides(f,c){null==this._localOverridesChunk&&(this._localOverridesChunk=new m.OverrideChunk(c,"localOverride"));this._localOverridesChunk.applyOverrides(f);for(const h of this._chunks.values())h.reader.removeIds(this._localOverridesChunk.overriddenIds),h.invalidate()}applyLocalEdit(f,c){null==this._localEditChunk&&(this._localEditChunk=new m.OverrideChunk(c,"localEdit"));this._localEditChunk.applyOverrides(f);for(const h of this._chunks.values())h.reader.removeIds(this._localEditChunk.overriddenIds),
h.invalidate()}forEach(f){const c=new Set;for(const h of this.chunks()){const n=h.reader.getCursor();for(;n.next();){const d=n.getObjectId();c.has(d)||(f(n.copy()),c.add(d))}}}forEachUnsafe(f){const c=new Set;for(const h of this.chunks()){const n=h.reader.getCursor();for(;n.next();){const d=n.getObjectId();c.has(d)||(f(n),c.add(d))}}}forEachInBounds(f,c){const h=new Set;for(const n of this.chunks()){const d=n.queryFeaturesInBounds(f);for(;d.next();){const w=d.getObjectId();h.has(w)||(c(d.copy()),
h.add(w))}}}forEachBounds(f,c){const h=g.create();for(const n of f)n.getBounds(h)&&c(h)}}a.FeatureSourceChunkStore=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(a,q,r,g,p,m,b,f,c,h,n){a.UpdateTracking2D=class extends r{constructor(d){super(d);this.debugName="";this._updatingHandles=new n.UpdatingHandles;this._idToUpdatingState=new p}get updating(){const d=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(w=>w);if(g("esri-2d-log-updating")){const w=Array.from(this._idToUpdatingState.entries()).map(([t,l])=>`-> ${t}: ${l}`).join("\n");console.log(`${this.debugName}: Updating: ${d}\n-> Handles: ${this._updatingHandles.updating}\n${w}`)}return d}addUpdateTracking(d,
w){const t=m.watch(()=>w.updating,l=>this._idToUpdatingState.set(d,l),{sync:!0});this.addHandles(t)}addPromise(d){return this._updatingHandles.addPromise(d)}};q.__decorate([b.property({constructOnly:!0})],a.UpdateTracking2D.prototype,"debugName",void 0);q.__decorate([b.property({readOnly:!0})],a.UpdateTracking2D.prototype,"updating",null);a.UpdateTracking2D=q.__decorate([h.subclass("esri.views.2d.layers.support.UpdateTracking2D")],a.UpdateTracking2D);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/support/UpdatingHandles":function(){define("exports ../../chunks/tslib.es6 ../Accessor ../handleUtils ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),function(a,q,r,g,p,m,b,f){a.UpdatingHandles=class extends r{constructor(){super(...arguments);this.updating=!1;this._scheduleHandleId=this._handleId=0;this._pendingPromises=new Set}destroy(){this.removeAll()}add(c,h,n={}){return this._installWatch(c,h,n,p.watch)}addWhen(c,
h,n={}){return this._installWatch(c,h,n,p.when)}addOnCollectionChange(c,h,{initial:n=!1,final:d=!1}={}){const w=++this._handleId;this.addHandles([p.on(c,"after-changes",this._createSyncUpdatingCallback(),p.sync),p.on(c,"change",h,{onListenerAdd:n?t=>h({added:t.toArray(),removed:[]}):void 0,onListenerRemove:d?t=>h({added:[],removed:t.toArray()}):void 0})],w);return g.makeHandle(()=>this.removeHandles(w))}addPromise(c){if(null==c)return c;const h=++this._handleId;this.addHandles(g.makeHandle(()=>{this._pendingPromises.delete(c)&&
(0!==this._pendingPromises.size||this.hasHandles(-42)||this._set("updating",!1))}),h);this._pendingPromises.add(c);this._set("updating",!0);const n=()=>this.removeHandles(h);c.then(n,n);return c}removeAll(){this._pendingPromises.clear();this.removeAllHandles();this._set("updating",!1)}_installWatch(c,h,n={},d){const w=++this._handleId;n.sync||this._installSyncUpdatingWatch(c,w);c=d(c,h,n);this.addHandles(c,w);return g.makeHandle(()=>this.removeHandles(w))}_installSyncUpdatingWatch(c,h){const n=this._createSyncUpdatingCallback();
c=p.watch(c,n,{sync:!0,equals:()=>!1});this.addHandles(c,h);return c}_createSyncUpdatingCallback(){return()=>{this.removeHandles(-42);++this._scheduleHandleId;const c=this._scheduleHandleId;this._get("updating")||this._set("updating",!0);this.addHandles(m.schedule(()=>{c===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this.removeHandles(-42))}),-42)}}};q.__decorate([b.property({readOnly:!0})],a.UpdatingHandles.prototype,"updating",void 0);a.UpdatingHandles=q.__decorate([f.subclass("esri.core.support.UpdatingHandles")],
a.UpdatingHandles);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureTileSubscription":function(){define(["exports"],function(a){class q{constructor(r,g){this.tile=r;this.version=g;this._abortController=new AbortController}get key(){return this.tile.key}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}}a.FeatureTileSubscription=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/Tile":function(){define("exports ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../rest/support/QuantizationParameters ../../../tiling/TileKey".split(" "),
function(a,q,r,g,p,m){class b{constructor(f,c){this.key=new m(0,0,0,0);this.bounds=g.create();this.objectIds=new Set;this.key.set(c);c=f.getLODInfoAt(this.key);this.tileInfoView=f;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=c.resolution;this.level=c.level;this.scale=c.scale;this.minScale=f.zoomToScale(c.level-1);this.maxScale=f.zoomToScale(c.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return r.fromBounds(this.bounds,
this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(f){return{$view:{scale:this.scale,timeZone:f}}}createChildTiles(){const f=this.key.getChildKeys(),c=q.acquire();for(let h=0;h<f.length;h++)c[h]=new b(this.tileInfoView,f[h]);return c}getQuantizationParameters(){return p.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,
extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}a.Tile=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../../core/Error ../../../../core/handleUtils ../../../../core/has ../../../../core/nextTick ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/workers/utils ../../../../layers/support/TileInfo ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ./PipelineConnectionHandlers ./Processor ./sources/FeatureSource ./sources/FeatureTileSubscription ./support/Tile".split(" "),function(a,
q,r,g,p,m,b,f,c,h,n,d,w,t,l,e,u,x,y,A){class k{constructor(B){this.inner=B;this.resolver=p.createResolver()}}class v{constructor(){this._aggregateAdapter={getFeatureObjectIds:B=>this._processor.getFeatureObjectIdsForAggregate(B)};this._subscriptions=new Map;this._updateRequested=!1;this._updateSubscriptionRequests=[];this._updateHighlightRequests=[]}destroy(){this._subscriptions.clear();this._processor.destroy();this._source.destroy();this._handles.remove();this._tileInfoView=this._updateLocalEditsRequest=
null}onAttach(B){r("esri-2d-update-debug")&&console.debug("Pipeline.onAttach");const z=this._connection,E=h.fromJSON(B.tileInfoJSON);this._tileInfoView=new n(E);this._source=new x.FeatureSource(B.service,this._aggregateAdapter,this._subscriptions,()=>this._requestUpdate(),z);this._processor=new u(z,this._source);this._handles=q.handlesGroup([b.watch(()=>this._source.updateTracking.updating,()=>{this._requestUpdate();p.ignoreAbortErrors(this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,
pipeline:!0}))})])}onDetach(){r("esri-2d-update-debug")&&console.debug("Pipeline.onDetach");this.destroy()}set remoteClient(B){this._connection=new e.PipelineConnectionHandlers(B)}get features(){const B=this._source?.queryEngine;if(!B)throw new a("no-queryEngine","No query engine defined");return B}get aggregates(){const B=this._processor?.aggregateQueryEngine;if(!B)throw new a("no-queryEngine","No aggregate query engine defined");return B}get processor(){return this._processor}get streamMessenger(){return this._source.streamMessenger}getDisplayFeatures(B){return this._processor.getDisplayFeatures(B)}async updateSchema(B,
z){r("esri-2d-update-debug")&&this._updateSchemaRequest&&console.error("InternalError: Schema already updating");this._updateSchemaRequest=new k({schema:B,version:z});this._requestUpdate();return this._updateSchemaRequest.resolver.promise}updateSubscriptions(B){B=new k(B);this._updateSubscriptionRequests.push(B);this._requestUpdate();return B.resolver.promise}updateHighlight(B){B=new k(B);this._updateHighlightRequests.push(B);this._requestUpdate();return B.resolver.promise}async onEdits(B){if(null!=
this._updateLocalEditsRequest)throw new a("InternalError - Already processing an edit");this._updateLocalEditsRequest=new k(B);B=this._updateLocalEditsRequest.resolver.promise;this._requestUpdate();return B}queryStatistics(){return this._source.statistics.toJSON()}async queryVisibleFeatures(B,z){return this.features.executeQuery(B,z)}async queryHeatmapStatistics(B){var z=Math.round(f.pt2px(B.radius));let E=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY;const I="string"===typeof B.fieldOffset,
D=B.fieldOffset??0;var G=Array.from(this._subscriptions.values());const C=this._source.chunks(),F=z**2,J=3/(Math.PI*F);z*=2;const T=Math.ceil(l.tileSize/z);for(const R of G){var S=R.tile;G=new Float64Array(T*T);for(const Z of C){var ba=Z.getTileReader(S);if(ba)for(ba=ba.getCursor();ba.next();){var M=1;null!=B.field&&(M=ba.readAttribute(B.field),M=I?-1*+M:+M+D);var U=ba.readXForDisplay()/z;const ea=ba.readYForDisplay()/z,ma=Math.floor(U),V=Math.floor(ea);0>ma||0>V||ma>=T||V>=T||(U=((.5+ma-U)*z)**2+
((.5+V-ea)*z)**2,U>F||(G[V+ma*T]+=M*J*(1-U/F)**2))}}for(S=0;S<G.length;S++)E=Math.min(E,G[S]),K=Math.max(K,G[S])}return{max:K,min:E}}async getSampleFeatures(B){const z=this._source.chunks();if(z.reduce((J,T)=>J+T.size(),0)<=B.minFeatureCount){if(!this._source.updateTracking.updating){const J=[];this._source.store.forEachUnsafe(T=>J.push(T.readLegacyFeatureWorldSpace()));return J}return null}const E=new Set,K=[],I=z.map(J=>J.reader.getCursor()),D=new m,G=3*B.sampleSize;for(let J=0;J<G&&K.length<B.sampleSize;J++){var C=
D.getIntRange(0,z.length-1);C=I[C];if(0!==C.getSize()){var F=D.getIntRange(0,C.getSize()-1);C.setIndex(F);F=C.getObjectId();E.has(F)||(E.add(F),K.push(C.readLegacyFeatureWorldSpace()))}}return K.length>=B.sampleSize?K:null}_requestUpdate(){this._updateRequested||(this._updateRequested=!0,g.nextTick(()=>this._scheduleNextUpdate()))}_scheduleNextUpdate(){this._updateRequested&&!this._ongoingUpdate&&(this._ongoingUpdate=c.ignoreConnectionErrors(this._doUpdate()).finally(()=>{this._ongoingUpdate=null;
this._scheduleNextUpdate()}),this._updateRequested=!1)}_subscribe(B){const z=B.tileId;if(!this._subscriptions.has(z)){r("esri-2d-update-debug")&&console.debug(`Tile[${z}] Pipeline.subscribe`);var E=new A.Tile(this._tileInfoView,z);B=new y.FeatureTileSubscription(E,B.version);this._subscriptions.set(z,B);this._source.onSubscribe(B);this._processor.onSubscribe(B)}}_unsubscribe(B){const z=this._subscriptions.get(B);z&&(r("esri-2d-update-debug")&&console.debug(`Tile[${B}] Pipeline.unsubscribe`),z.abort(),
this._source.onUnsubscribe(z),this._processor.onUnsubscribe(z),this._subscriptions.delete(z.key.id))}async _doUpdate(){r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateStart");await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0});if(this._updateSubscriptionRequests.length){var B=this._updateSubscriptionRequests;this._updateSubscriptionRequests=[];for(var z of B)this._doUpdateSubscriptions(z.inner),z.resolver.resolve()}B=this._updateSchemaRequest;
this._updateSchemaRequest=null;if(null!=B){const {schema:I,version:D}=B.inner;await this._doUpdateSchema(I,D)}z=this._updateLocalEditsRequest;this._updateLocalEditsRequest=null;if(null!=z){r("esri-2d-update-debug")&&console.debug("Pipeline.applyEditOverride",z.inner);var E=await this._source.getLocalEdit(z.inner);await this._processor.applyLocalEdit(E);this._source.applyLocalEdit(E);r("esri-2d-update-debug")&&console.debug("Pipeline.endEditOverride",z.inner)}if(this._updateHighlightRequests.length){E=
this._updateHighlightRequests;this._updateHighlightRequests=[];for(var K of E)this._processor.updateHighlight(K.inner),K.resolver.resolve()}K=this._source.cleanupRemovedChunks();this._processor.removeChunks(K);try{this._subscriptions.size&&(r("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksStart"),await this._processor.updateChunks(),r("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksEnd"))}catch(I){p.throwIfNotAbortError(I)}null!=z&&z.resolver.resolve();null!=B&&B.resolver.resolve();
this._updateRequested?(r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested\x3dtrue]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0})):(r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested\x3dfalse, After flush]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:this._updateRequested}))}async _doUpdateSchema(B,z){r("esri-2d-update-debug")&&
console.debug(`Version[${z}] Pipeline.updateStart`,{schema:B});const E={tileInfo:this._tileInfoView?.tileInfo},K=await this._source.update(B,z),I=Array.from(this._subscriptions.values());await this._processor.update(B,z,E,K,I);r("esri-2d-update-debug")&&console.debug(`Version[${z}] Pipeline.updateEnd`)}_doUpdateSubscriptions(B){r("esri-2d-update-debug")&&console.debug("Pipeline.updateSubscriptions",B);for(const z of B.subscribe)this._subscribe(z);for(const z of B.unsubscribe)this._unsubscribe(z)}}
return v});