// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/defaultCIMValues ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../VisualVariablesSchema ./utils".split(" "),function(n,I,J,u,y,K){function A(b){return b.minScale||b.maxScale?{minScale:b.minScale??0,maxScale:b.maxScale??0}:null}function m(b){if(null==b)return null;if(Array.isArray(b)){const [a,e,k,h]=b;return[a,e,k,255*h]}return"string"===typeof b?b:{...b,defaultValue:m(b?.defaultValue)}}
function B(b,a,e,{scaleInfo:k,scaleExpression:h}){const f=K.hasSizeVVUniform(e);return[b.createMeshInfo({size:a.size,scaleX:a.scaleX,anchorX:a.anchorPoint.x,anchorY:a.anchorPoint.y,angle:a.rotation,color:m(a.color)??[0,0,0,0],colorLocked:a.colorLocked,frameHeight:a.frameHeight,widthRatio:a.widthRatio,scaleInfo:k,offsetX:a.offsetX,offsetY:a.offsetY,outlineColor:m(a.outlineColor)??[0,0,0,0],outlineSize:a.outlineWidth,referenceSize:a.referenceSize||J.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:a.rotateClockwise,
scaleFactor:h??1,sizeRatio:a.sizeRatio,alignment:a.alignment,isAbsoluteAnchorPoint:a.isAbsoluteAnchorPoint,scaleSymbolsProportionally:a.scaleSymbolsProportionally,sprite:a.spriteRasterizationParam,hasSizeVV:f,placement:a.markerPlacement,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,transforms:a.transform,minPixelBuffer:y.getMaxSizeVVSize(e)})]}function C(b,a,{scaleInfo:e}){return[b.createMeshInfo({color:m(a.color)??[0,0,0,0],scaleInfo:e,effects:a.effects?{type:"cim-effect-infos",
effectInfos:a.effects}:null})]}function D(b,a,e,{scaleInfo:k}){if(!a.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");e=!!a.hasUnresolvedReplacementColor&&(!e||a.colorLocked);e=a.sampleAlphaOnly&&!e;const h=a.spriteRasterizationParam;return[b.createMeshInfo({color:m(a.color)??[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:e,scaleProportionally:"CIMHatchFill"===
h.resource.type,sprite:h,scaleInfo:k,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function E(b,a,{scaleInfo:e}){return{color:m(b.color)??[0,0,0,0],width:b.width,referenceWidth:b.referenceWidth,capType:b.cap,joinType:b.join,miterLimit:b.miterLimit,scaleInfo:e,hasSizeVV:a,effects:b.effects?{type:"cim-effect-infos",effectInfos:b.effects}:null}}function F(b,a,e,k){if(a.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");a=E(a,e,k);return[b.createMeshInfo(a)]}
function G(b,a,e,k){const {spriteRasterizationParam:h,scaleDash:f,sampleAlphaOnly:r}=a;if(!h)throw Error("InternalError: Sprite should be defined");return[b.createMeshInfo({...E(a,e,k),shouldScaleDash:f??!1,shouldSampleAlphaOnly:r,isSDF:"CIMPictureStroke"!==h.resource.type,sprite:h})]}function H(b,a,e,{scaleInfo:k,scaleExpression:h}){return[b.createMeshInfo({boxBackgroundColor:m(a.backgroundColor),boxBorderLineColor:m(a.borderLineColor),boxBorderLineSize:a.borderLineWidth??0,color:m(a.color)??[0,
0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:m(a.outlineColor)??[0,0,0,0],haloFontSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:k,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,
transforms:a.transform,scaleFactor:h??1,minPixelBuffer:y.getMaxSizeVVSize(e),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}n.createComplexFillMeshInfos=D;n.createComplexMarkerMeshInfos=B;n.createComplexSimpleFillMeshInfos=C;n.createComplexSimpleLineMeshInfos=F;n.createComplexSymbolInstances=async function(b,a){const {cimResourceManager:e,cimAnalyzer:k,scaleExpression:h}=a.schemaOptions;await Promise.all(I.CIMSymbolHelper.fetchResources(b.symbol,e,
[]));var f=k.analyzeSymbolReference(b,!1);b={scaleInfo:A(b),scaleExpression:h};const r=[];for(const w of f)switch(w.type){case "marker":f=r;var t=f.push;var d=w;var g=b;const {uniforms:p,schemaOptions:L}=a;var {store:c}=L;c=c.ensureInstance(u.Techniques.marker,{uniforms:d.isOutline?{...y.noVisualVariables,visualVariableSizeScaleStops:p.visualVariableSizeOutlineScaleStops}:{visualVariableColor:p.visualVariableColor,visualVariableOpacity:p.visualVariableOpacity,visualVariableSizeMinMaxValue:p.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:p.visualVariableSizeScaleStops,visualVariableSizeStops:p.visualVariableSizeStops,visualVariableSizeUnitValue:p.visualVariableSizeUnitValue,visualVariableRotation:p.visualVariableRotation},optionalAttributes:{zoomRange:!!g.scaleInfo}});d=B(c,d,p,g);t.call(f,...d);break;case "fill":f=r;t=f.push;a:{g=w;c=a;d=b;if(!g.spriteRasterizationParam){const {uniforms:x,schemaOptions:M}=c;({store:c}=M);c=c.ensureInstance(u.Techniques.fill,{uniforms:{visualVariableColor:g.colorLocked?
null:x.visualVariableColor,visualVariableOpacity:x.visualVariableOpacity},optionalAttributes:{zoomRange:!!d.scaleInfo}});d=C(c,g,d);break a}const {uniforms:l,schemaOptions:z}=c;({store:c}=z);c=c.ensureInstance(u.Techniques.complexFill,{uniforms:{visualVariableColor:g.colorLocked?null:l.visualVariableColor,visualVariableOpacity:l.visualVariableOpacity},optionalAttributes:{zoomRange:!!d.scaleInfo}});d=D(c,g,null!=l.visualVariableColor,d)}t.call(f,...d);break;case "line":f=r;t=f.push;{d=w;g=b;const {uniforms:l,
schemaOptions:z}=a;var {store:v}=z;c=d.isOutline?{...y.noVisualVariables,visualVariableSizeScaleStops:l.visualVariableSizeOutlineScaleStops}:{visualVariableColor:d.colorLocked?null:l.visualVariableColor,visualVariableOpacity:l.visualVariableOpacity,visualVariableSizeMinMaxValue:l.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:l.visualVariableSizeScaleStops,visualVariableSizeStops:l.visualVariableSizeStops,visualVariableSizeUnitValue:l.visualVariableSizeUnitValue};const x={uniforms:c,optionalAttributes:{zoomRange:!!g.scaleInfo}};
c=!!(c.visualVariableSizeMinMaxValue||c.visualVariableSizeScaleStops||c.visualVariableSizeStops||c.visualVariableSizeUnitValue);d.spriteRasterizationParam?(v=v.ensureInstance(u.Techniques.texturedLine,x),d=G(v,d,c,g)):(v=v.ensureInstance(u.Techniques.line,x),d=F(v,d,c,g))}t.call(f,...d);break;case "text":f=r;t=f.push;d=w;g=b;const {uniforms:q,schemaOptions:N}=a;({store:c}=N);c=c.ensureInstance(u.Techniques.text,{uniforms:{visualVariableColor:d.colorLocked?null:q.visualVariableColor,visualVariableOpacity:q.visualVariableOpacity,
visualVariableRotation:q.visualVariableRotation,visualVariableSizeMinMaxValue:q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:q.visualVariableSizeScaleStops,visualVariableSizeStops:q.visualVariableSizeStops,visualVariableSizeUnitValue:q.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!g.scaleInfo,referenceSymbol:!1,clipAngle:!1}});d=H(c,d,q,g);t.call(f,...d)}return r};n.createComplexTextMeshInfos=H;n.createComplexTexturedLineMeshInfos=G;n.getScaleInfo=A;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})});