// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/CircularArray ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(b,d,f,g,h,k,e,m,n,p,l){b.FeatureSourceEventLog=class extends f{constructor(){super(...arguments);this.events=new h;this._updatingStrategy=!0;this._tileToEvent=
new k;this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(a){switch(a.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(a);break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,
outstanding:0};this._strategyInfo=a.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",a);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),a.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&
this._hasAllTileData()}_hasAllTileData(){for(const a of this._tileToEvent.values())if("loaded"!==a.peekLast()?.type)return!1;return!0}_handleTileEvent(a){switch(a.type){case "subscribe":var c=new g(10);c.enqueue(a);this._tileToEvent.set(a.tile,c);break;case "unsubscribe":this._tileToEvent.delete(a.tile);break;case "loaded":c=this._tileToEvent.get(a.tile);if(!c)break;c.enqueue(a);this._tileToEvent.set(a.tile,c);break;case "error":if(c=this._tileToEvent.get(a.tile))c.enqueue(a),this._tileToEvent.set(a.tile,
c),this.events.emit("error",a)}}};d.__decorate([e.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasAllFeatures",null);d.__decorate([e.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);d.__decorate([e.property({readOnly:!0})],b.FeatureSourceEventLog.prototype,"hasFullGeometries",null);d.__decorate([e.property()],b.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0);d.__decorate([e.property()],b.FeatureSourceEventLog.prototype,"_strategyInfo",
void 0);d.__decorate([e.property()],b.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);b.FeatureSourceEventLog=d.__decorate([l.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],b.FeatureSourceEventLog);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});