// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/unitUtils","./AAggregateSpatialIndex","./GridCell"],function(f,k,p,l){function m(b,a){return k.getMetersPerUnitForSR(b)*k.inchesPerMeter*96/a}class q extends p.AAggregateSpatialIndex{constructor(b){super(b);this._cells=new Map;this._pixelsPerMapUnit=m(b.spatialReference,b.scale)}put(b){for(const a of this._cells.values()){const c=b.get(a.id);c?c.merge(a):b.set(a.id,a.clone())}}putBounded(b,a,c){const [d,r,t,u]=[a.xmin,a.ymin,a.xmax,a.ymax];a=Math.floor(d*this._pixelsPerMapUnit/
this._options.cellSize);var g=Math.floor(r*this._pixelsPerMapUnit/this._options.cellSize);c=Math.ceil(t*this._pixelsPerMapUnit/this._options.cellSize);const v=Math.ceil(u*this._pixelsPerMapUnit/this._options.cellSize);for(;g<=v;g++)for(let h=a;h<=c;h++){const e=this._cells.get(`${h}.${g}`);if(!e)continue;const n=b.get(e.id);n?e&&!b.has(e.id)&&n.merge(e):b.set(e.id,e.clone())}}_insert(b,a,c,d){this._getCellOrCreate(Math.floor(a*this._pixelsPerMapUnit/this._options.cellSize),Math.floor(c*this._pixelsPerMapUnit/
this._options.cellSize)).insert(b,d,a,c)}_getCellOrCreate(b,a){const c=l.GridCell.createId(b,a);let d=this._cells.get(c);d||(d=l.GridCell.create(b,a,this._options.fields,1*this._options.cellSize/this._pixelsPerMapUnit),this._cells.set(c,d));return d}}f.GridSpatialIndex=q;f.pixelsPerMapUnit=m;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});