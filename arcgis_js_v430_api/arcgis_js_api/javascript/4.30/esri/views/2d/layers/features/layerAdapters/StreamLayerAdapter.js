// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(h,k,l,f,m,n){class p{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const a=this.layer;b=f.getFeatureReductionDeconflictionEnabled(a,b)??f.getLayerDeconflictionEnabled(a);return[{vvEvaluators:{0:f.createLabelVVEvaluator(a.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){var a=this.layer;const {objectIdField:c}=
a,d=l.getEffectiveGeometryType(a),e=a.timeInfo?.toJSON()||null;a=a.spatialReference?a.spatialReference.toJSON():null;return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:b.spatialReference.toJSON(),metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:d,objectIdField:c,timeInfo:e,timeReferenceUnknownClient:null,spatialReference:a,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(b,a){const {definitionExpression:c,geometryDefinition:d,
customParameters:e}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:a,availableFields:b.availableFields,dataFilter:{geometryDefinition:d?.toJSON(),definitionExpression:c,customParameters:e??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(b,a,c){const {fields:d,renderer:e,geometryType:g,labelingInfo:q,labelsVisible:r,objectIdField:t}=this.layer,
v={fields:d.map(u=>u.toJSON()),renderer:e?.clone(),featureReduction:k.getEffectiveFeatureReduction(this.layer,a),geometryType:g,labelingInfo:q,labelsVisible:r,objectIdField:t,orderBy:"default"};return m.createSimpleProcessorSchema(b,a,v,c)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(b){const a=this.layer,{definitionExpression:c,renderer:d}=a,e=this.layer.labelsVisible?this.layer.labelingInfo:null,g=JSON.stringify(a.customParameters);
b=k.getEffectiveFeatureReduction(a,b);return{definitionExpression:c,renderer:d,labelingInfo:e,featureReduction:b,customParameters:g,geometryDefinition:a.geometryDefinition,definitionExpressoin:a.definitionExpression}}}h.StreamLayerAdapter=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});