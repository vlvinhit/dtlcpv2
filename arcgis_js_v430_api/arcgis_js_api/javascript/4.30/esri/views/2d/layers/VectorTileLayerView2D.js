// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),function(y,z,C,c,g,h,b,e,d){function l(r){return()=>r.abort()}class k{constructor(r,m,p,q){this._layer=r;this._styleRepository=m;this.devicePixelRatio=p;this._sourceDataMaxLOD=q;this._inputSignalEventListener=this._startOptionsInputSignal=
this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=z.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=
this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(r){this._requestSprite(r);var m=this._layer.currentStyleInfo.glyphsUrl;m=new b(m?c.addQueryParameters(m,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new h(1024,1024,m);this._broadcastPromise=g.open("WorkerTileHandler",{client:this,schedule:r.schedule,signal:r.signal}).then(p=>{this._layer&&
(this._connection?.close(),this._connection=p,this._layer&&!this._connection.closed&&(p=p.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},r),Promise.all(p).catch(q=>C.throwIfNotAbortError(q))))})}_requestSprite(r){this._spriteSourceAbortController?.abort();const m=new AbortController;this._spriteSourceAbortController=m;const p=r?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);
this._startOptionsInputSignal=null;p&&(this._inputSignalEventListener=l(m),p.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:q}=m;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...r,signal:q});this._spriteSourcePromise.then(A=>{C.throwIfAbortError(q);this._spriteMosaic=new e(1024,1024,250);this._spriteMosaic.setSpriteSource(A)})}async updateStyle(r){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",
r))}setSpriteSource(r){const m=new e(1024,1024,250);m.setSpriteSource(r);this._spriteMosaic=m;this._spriteSourcePromise=Promise.resolve(r);this._spriteSourceAbortController=null;return m}async setStyle(r,m,p){await this._broadcastPromise;this._styleRepository=r;this._sourceDataMaxLOD=p;this._requestSprite();r=new b(this._layer.currentStyleInfo.glyphsUrl?c.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new h(1024,
1024,r);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:m,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(r,m){r=await this._getRefKeys(r,m);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),r,m)}async fetchTilePBFs(r){const m=Object.keys(this._layer.sourceNameToSource),p={};r=await this._getRefKeys(r,p);const q=[],A=[];for(let F=0;F<r.length;F++)if(null==r[F].value||null==m[F])A.push(null);else{const x=r[F].value,D=this._getTilePayload(x,
m[F],p);D.then(E=>{q.push({...E,key:x})});A.push(D)}return Promise.all(A).then(()=>q)}async parseTileData(r,m){const p=r&&r.data;if(!p)return null;const {sourceName2DataAndRefKey:q,transferList:A}=p;return 0===Object.keys(q).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:r.key.id,sourceName2DataAndRefKey:q,styleLayerUIDs:r.styleLayerUIDs},{...m,transferList:A}))}async getSprites(r){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(r)}getGlyphs(r){return this._glyphMosaic.getGlyphItems(r.font,
r.codePoints)}async _getTilePayload(r,m,p){r=d.pool.acquire(r.id);const q=this._layer.sourceNameToSource[m],{level:A,row:F,col:x}=r;d.pool.release(r);try{return{protobuff:await q.requestTile(A,F,x,p),sourceName:m}}catch(D){if(C.isAbortError(D))throw D;return{protobuff:null,sourceName:m}}}async _getRefKeys(r,m){const p=this._layer.sourceNameToSource,q=[];for(const A in p){const F=p[A].getRefKey(r,m);q.push(F)}return C.eachAlways(q)}_getSourcesData(r,m,p){const q=[];for(let A=0;A<m.length;A++)if(null==
m[A].value||null==r[A])q.push(null);else{const F=this._getTilePayload(m[A].value,r[A],p);q.push(F)}return C.eachAlways(q).then(A=>{const F={},x=[];for(let D=0;D<A.length;D++){const E=A[D].value;E&&E.protobuff&&0<E.protobuff.byteLength&&(F[E.sourceName]={refKey:m[D].value.id,protobuff:E.protobuff},x.push(E.protobuff))}return{sourceName2DataAndRefKey:F,transferList:x}})}}y.TileHandler=k;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack",
"../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(y,z,C,c,g){class h{constructor(b,e,d){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=b;this.height=e;this._glyphSource=d;this._binPack=new y(b-4,e-4);this._glyphData.push(new Uint8Array(b*e));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(b,e){const d=[],l=this._glyphSource,
k=new Set,r=1/256;for(const p of e)k.add(Math.floor(p*r));const m=[];k.forEach(p=>{const q=b+p;this._rangePromises.has(q)?m.push(this._rangePromises.get(q)):(p=l.getRange(b,p).then(()=>{this._rangePromises["delete"](q)},()=>{this._rangePromises["delete"](q)}),this._rangePromises.set(q,p),m.push(p))});return Promise.all(m).then(()=>{let p=this._glyphIndex[b];p||(p={},this._glyphIndex[b]=p);for(const D of e){var q=p[D];if(q){d[D]={sdf:!0,rect:q.rect,metrics:q.metrics,page:q.page,code:D};continue}var A=
l.getGlyph(b,D);if(!A?.metrics)continue;q=A.metrics;let E;if(0===q.width)E=new z(0,0,0,0);else{const I=q.width+6,L=q.height+6;var F=I%4?4-I%4:4,x=L%4?4-L%4:4;1===F&&(F=5);1===x&&(x=5);E=this._binPack.allocate(I+F,L+x);E.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new y(this.width-4,this.height-
4),E=this._binPack.allocate(I+F,L+x));F=this._glyphData[this._currentPage];A=A.bitmap;let O;if(A)for(let u=0;u<L;u++){x=I*u;O=this.width*(E.y+u+1)+E.x;for(let B=0;B<I;B++)F[O+B+1]=A.at(x+B)}}p[D]={rect:E,metrics:q,tileIDs:null,page:this._currentPage};d[D]={sdf:!0,rect:E,metrics:q,page:this._currentPage,code:D};this._dirties[this._currentPage]=!0}return d})}removeGlyphs(b){for(const e in this._glyphIndex){const d=this._glyphIndex[e];if(!d)continue;let l;for(const k in d)if(l=d[k],l.tileIDs["delete"](b),
0===l.tileIDs.size){const r=this._glyphData[l.page],m=l.rect;let p,q;for(let A=0;A<m.height;A++)for(p=this.width*(m.y+A)+m.x,q=0;q<m.width;q++)r[p+q]=0;delete d[k];this._dirties[l.page]=!0}}}bind(b,e,d,l=0){if(!this._textures[d]){var k=new g.TextureDescriptor;k.pixelFormat=C.PixelFormat.ALPHA;k.wrapMode=C.TextureWrapMode.CLAMP_TO_EDGE;k.width=this.width;k.height=this.height;this._textures[d]=new c.Texture(b,k,new Uint8Array(this.width*this.height))}k=this._textures[d];k.setSamplingMode(e);this._dirties[d]&&
k.setData(this._glyphData[d]);b.bindTexture(k,l);this._dirties[d]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const b of this._textures)b&&b.dispose();this._textures.length=0}}return h})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(y){class z{constructor(C,c){this._height=this._width=0;this._free=[];this._width=C;this._height=c;this._free.push(new y(0,0,C,c))}get width(){return this._width}get height(){return this._height}allocate(C,
c){if(C>this._width||c>this._height)return new y;let g=null,h=-1;for(let b=0;b<this._free.length;++b){const e=this._free[b];C<=e.width&&c<=e.height&&(null===g||e.y<=g.y&&e.x<=g.x)&&(g=e,h=b)}if(null===g)return new y;this._free.splice(h,1);g.width<g.height?(g.width>C&&this._free.push(new y(g.x+C,g.y,g.width-C,c)),g.height>c&&this._free.push(new y(g.x,g.y+c,g.width,g.height-c))):(g.width>C&&this._free.push(new y(g.x+C,g.y,g.width-C,g.height)),g.height>c&&this._free.push(new y(g.x,g.y+c,C,g.height-c)));
return new y(g.x,g.y,C,c)}release(C){for(let c=0;c<this._free.length;++c){const g=this._free[c];if(g.y===C.y&&g.height===C.height&&g.x+g.width===C.x)g.width+=C.width;else if(g.x===C.x&&g.width===C.width&&g.y+g.height===C.y)g.height+=C.height;else if(C.y===g.y&&C.height===g.height&&C.x+C.width===g.x)g.x=C.x,g.width+=C.width;else if(C.x===g.x&&C.width===g.width&&C.y+C.height===g.y)g.y=C.y,g.height+=C.height;else continue;this._free.splice(c,1);this.release(C)}this._free.push(C)}}return z})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request",
"../../../../core/pbf"],function(y,z){class C{constructor(b){this._metrics=[];if(b){for(var e=new Map,d=0;b.next();)switch(b.tag()){case 1:const k=b.getMessage();for(;k.next();)switch(k.tag()){case 3:var l=k.getMessage();let r,m,p,q,A,F,x;for(;l.next();)switch(l.tag()){case 1:r=l.getUInt32();break;case 2:m=l.getBytes();break;case 3:p=l.getUInt32();break;case 4:q=l.getUInt32();break;case 5:A=l.getSInt32();break;case 6:F=l.getSInt32();break;case 7:x=l.getUInt32();break;default:l.skip()}l.release();
r&&(l=m?.length??0,this._metrics[r]={width:p,height:q,left:A,top:F,advance:x,startOffset:d,length:l},e.set(r,m),d+=l);break;default:k.skip()}k.release();break;default:b.skip()}b=new Uint8Array(d);d=this._metrics;for(const [k,r]of e){const {startOffset:m,length:p}=d[k];if(r)for(e=0;e<p;++e)b[m+e]=r[e]}this._allBitmaps=b}else this._allBitmaps=null}getMetrics(b){return this._metrics[b]}getBitmap(b){if(this._allBitmaps&&(b=this._metrics[b],void 0!==b)){var {startOffset:e,length:d}=b;if(0!==d)return new h(this._allBitmaps,
e,d)}}}class c{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(b){return this._ranges[b]}addRange(b,e){this._ranges[b]=e}}class g{constructor(b){this._glyphInfo={};this._baseURL=b}getRange(b,e){const d=this._getFontStack(b);if(d.getRange(e))return Promise.resolve();const l=256*e,k=l+255;if(this._baseURL)return b=this._baseURL.replace("{fontstack}",b).replace("{range}",l+"-"+k),y(b,{responseType:"array-buffer"}).then(r=>{d.addRange(e,new C(new z(new Uint8Array(r.data),new DataView(r.data))))}).catch(()=>
{d.addRange(e,new C)});d.addRange(e,new C);return Promise.resolve()}getGlyph(b,e){if(b=this._getFontStack(b))if(b=b.getRange(Math.floor(e/256)))return{metrics:b.getMetrics(e),bitmap:b.getBitmap(e)}}_getFontStack(b){let e=this._glyphInfo[b];e||=this._glyphInfo[b]=new c;return e}}class h{constructor(b,e,d){this._array=b;this._start=e;this.length=d}at(b){return 0<=b&&b<this.length?this._array[this._start+b]:void 0}}return g})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../core/has ../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(y,z,C,c,g,h,b){class e{constructor(d,l,k=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;0>=l&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=d;this._pageHeight=l;0<k&&(this._maxItemSize=k);this._binPack=new C(d-4,l-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const d of this._textures)d&&d.dispose();this._textures.length=0}getWidth(d){return d>=this._size.length?-1:this._size[d][0]}getHeight(d){return d>=this._size.length?-1:this._size[d][1]}getPageSize(d){return d>=this._size.length?null:this._size[d]}setSpriteSource(d){this.dispose();this.pixelRatio=d.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new C(this._pageWidth-4,this._pageHeight-4);const l=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=l;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=d}getSpriteItem(d,l=!1){var k=this._mosaicRects[d];if(k)return k;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let r;d&&d.startsWith("dasharray-")?([k,r]=this._rasterizeDash(d),l=!0):k=this._sprites.getSpriteInfo(d);if(!k?.width||!k.height||0>k.width||0>k.height)return null;const m=k.width,p=k.height,[q,A,F]=this._allocateImage(m,p);if(0>=
q.width)return null;this._copy(q,k,A,F,l,r);k={type:"sprite",rect:q,width:m,height:p,sdf:k.sdf,simplePattern:!1,rasterizationScale:k.pixelRatio,page:A};return this._mosaicRects[d]=k}getSpriteItems(d){const l={};for(const k of d)l[k.name]=this.getSpriteItem(k.name,k.repeat);return l}getMosaicItemPosition(d,l){d=this.getSpriteItem(d,l);l=d?.rect;if(!l)return null;l.width=d.width;l.height=d.height;return{tl:[l.x+2,l.y+2],br:[l.x+2+d.width,l.y+2+d.height],page:d.page}}bind(d,l,k=0,r=0){if(!(k>=this._size.length||
k>=this._mosaicsData.length)){if(!this._textures[k]){var m=new b.TextureDescriptor;m.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;m.width=this._size[k][0];m.height=this._size[k][1];this._textures[k]=new h.Texture(d,m,new Uint8Array(this._mosaicsData[k].buffer))}m=this._textures[k];m.setSamplingMode(l);this._dirties[k]&&m.setData(new Uint8Array(this._mosaicsData[k].buffer));d.bindTexture(m,r);this._dirties[k]=!1}}static _copyBits(d,l,k,r,m,p,q,A,F,x,D){let E=r*l+k;q=A*p+q;if(D)for(q-=p,D=-1;D<=x;D++,E=
((D+x)%x+r)*l+k,q+=p)for(A=-1;A<=F;A++)m[q+A]=d[E+(A+F)%F];else for(k=0;k<x;k++){for(r=0;r<F;r++)m[q+r]=d[E+r];E+=l;q+=p}}_copy(d,l,k,r,m,p){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(k>=this._mosaicsData.length)){var q=new Uint32Array(p?p.buffer:this._sprites.image.buffer);e._copyBits(q,p?l.width:this._sprites.width,l.x,l.y,this._mosaicsData[k],r[0],d.x+2,d.y+2,l.width,l.height,m);this._dirties[k]=!0}}_allocateImage(d,l){d+=2;l+=2;var k=Math.max(d,l);if(this._maxItemSize&&this._maxItemSize<
k)return k=new c(0,0,d,l),this._mosaicsData.push(new Uint32Array(d*l)),this._dirties.push(!0),this._size.push([d,l]),this._textures.push(void 0),[k,this._mosaicsData.length-1,[d,l]];k=d%4?4-d%4:4;let r=l%4?4-l%4:4;1===k&&(k=5);1===r&&(r=5);k=this._binPack.allocate(d+k,l+r);return 0>=k.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),
this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new C(this._pageWidth-4,this._pageHeight-4),this._allocateImage(d,l)):[k,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(d){var l=d.match(/\[(.*?)\]/);if(!l)return null;l=l[1].split(",").map(Number);d=d.slice(d.lastIndexOf("-")+1);const [k,r,m]=z.rasterizeDash(l,d);d=new Uint8Array(k.buffer);return[{x:0,y:0,width:r,height:m,sdf:!0,pixelRatio:1},d]}}return e})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports",
"../../../../core/LRUCache","../../../../geometry/support/aaBoundingRect","../../tiling/TileCoverage","../../tiling/TileKey"],function(y,z,C,c,g){const h=(e,d)=>e+1/(1<<2*d);class b{constructor(e,d){this._tiles=new Map;this._tileCache=new z.LRUCache(40,l=>l.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=e.acquireTile;this.releaseTile=e.releaseTile;this.tileInfoView=e.tileInfoView;this._container=d}destroy(){for(const [,e]of this._tiles)e.dispose();this._tiles=null;this._tileCache.clear();
this._tileCache=null}update(e){this._updateCacheSize(e);const d=this.tileInfoView;e=d.getTileCoverage(e.state,0,!0,"smallest");if(!e)return!0;const {spans:l,lodInfo:k}=e,{level:r}=k,m=this._tiles,p=new Set,q=new Set;for(const {row:F,colFrom:x,colTo:D}of l)for(let E=x;E<=D;E++){const I=g.getId(r,F,k.normalizeCol(E),k.getWorldForColumn(E)),L=this._getOrAcquireTile(I);p.add(I);L.processed()?this._addToContainer(L):q.add(new g(I))}for(const [F,x]of m)x.isCoverage=p.has(F);for(var A of q)this._findPlaceholdersForMissingTiles(A,
p);A=!1;for(const [F,x]of m)x.neededForCoverage=p.has(F),x.neededForCoverage||x.isHoldingForFade&&d.intersects(e,x.key)&&p.add(F),x.isFading&&(A=!0);for(const [F]of this._tiles)p.has(F)||this._releaseTile(F);c.pool.release(e);return!A}clear(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(e,d,l,k,r){const m=[0,0],p=[0,0];k.toMap(m,e-l,d+l);k.toMap(p,e+l,d-l);d=C.fromValues(Math.min(m[0],p[0]),Math.min(m[1],p[1]),Math.max(m[0],
p[0]),Math.max(m[1],p[1]));l=C.create();e=[];for(const [,q]of this._visibleTiles)this.tileInfoView.getTileBounds(l,q.key),C.intersects(d,l)&&e.push(q);if(null!=r&&0<r.length){const q=new Set(e.map(A=>A.id));r=r.filter(A=>!q.has(A.tileKey.id)).map(A=>this._visibleTiles.get(A.tileKey.id)).filter(A=>void 0!==A);e.push(...r)}return e}_findPlaceholdersForMissingTiles(e,d){var l=[];for(const [,k]of this._tiles)this._addPlaceholderChild(l,k,e,d);l=l.reduce(h,0);1E-6>Math.abs(1-l)||this._addPlaceholderParent(e.id,
d)}_addPlaceholderChild(e,d,l,k){if(!(d.key.level<=l.level)&&d.hasData()){var r=d.key,m=r.level-l.level;l.row===r.row>>m&&l.col===r.col>>m&&l.world===r.world&&(this._addToContainer(d),k.add(d.id),e.push(d.key.level-l.level))}}_addPlaceholderParent(e,d){const l=this._tiles;for(;;){{const [r,m,p,q]=e.split("/");e=parseInt(r,10);e=0===e?null:`${e-1}/${parseInt(m,10)>>1}/${parseInt(p,10)>>1}/${parseInt(q,10)}`}if(!e||d.has(e))break;const k=l.get(e);if(k?.hasData()){this._addToContainer(k);d.add(k.id);
break}}}_getOrAcquireTile(e){let d=this._tiles.get(e);if(d)return d;(d=this._tileCache.pop(e))||(d=this.acquireTile(new g(e)));this._tiles.set(e,d);return d}_releaseTile(e){const d=this._tiles.get(e);this.releaseTile(d);this._removeFromContainer(d);this._tiles.delete(e);d.hasData()?this._tileCache.put(e,d,1):d.dispose()}_addToContainer(e){let d;const l=[],k=this._container;if(!k.contains(e)){var r=this._visibleTiles;for(const [,m]of r)this._canConnectDirectly(e,m)&&l.push(m),null==d&&this._canConnectDirectly(m,
e)&&(d=m);if(null!=d){for(const m of l)d.childrenTiles.delete(m),e.childrenTiles.add(m),m.parentTile=e;d.childrenTiles.add(e);e.parentTile=d}else for(const m of l)e.childrenTiles.add(m),m.parentTile=e;r.set(e.id,e);k.addChild(e)}}_removeFromContainer(e){this._visibleTiles.delete(e.id);this._container.removeChild(e);if(null!=e.parentTile){e.parentTile.childrenTiles.delete(e);for(const d of e.childrenTiles)null!=e.parentTile&&e.parentTile.childrenTiles.add(d)}for(const d of e.childrenTiles)d.parentTile=
e.parentTile;e.parentTile=null;e.childrenTiles.clear()}_canConnectDirectly(e,d){e=e.key;let {level:l,row:k,col:r,world:m}=d.key;for(d=this._visibleTiles;0<l;){l--;k>>=1;r>>=1;if(e.level===l&&e.row===k&&e.col===r&&e.world===m)return!0;if(d.has(`${l}/${k}/${r}/${m}`))break}return!1}_updateCacheSize(e){e=e.state.size;if(e[0]!==this._viewSize[0]||e[1]!==this._viewSize[1]){var d=Math.ceil(e[0]/512)+1,l=Math.ceil(e[1]/512)+1;this._viewSize[0]=e[0];this._viewSize[1]=e[1];this._tileCache.maxSize=5*d*l}}}
y.TileManager=b;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(y,z,C,c,g,h,b,e){class d extends e.TiledDisplayObject{constructor(k,r,m,p,q,A,F,x=null){super(k,r,m,p,q,A,4096,4096);this.styleRepository=
F;this._memCache=x;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=0;this._processed=!1;this._referenced=1;this.id=k.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&
performance.now()-this.lastOpacityUpdate<b.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(k){this.changeDataImpl(k);this.requestRender();this.ready();this._processed=!0}deleteLayerData(k){let r=!1;for(const m of k)if(k=this.layerData.get(m))this._memoryUsedByLayerData-=k.memoryUsed,k.type===
g.BucketType.SYMBOL&&this.symbols.delete(m)&&(r=!0),k.destroy(),this.layerData.delete(m);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);r&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,l.delete(this),d._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),
this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(k){this.featureIndex?.clear();let r=!1;if(k){const {bucketsWithData:m,emptyBuckets:p}=k;k=this._createRenderBuckets(m);if(p&&0<p.byteLength){const q=new Uint32Array(p);for(const A of q)this._deleteLayerData(A)}for(const [q,A]of k)this._deleteLayerData(q),A.type===
g.BucketType.SYMBOL&&(this.symbols.set(q,A.symbols),r=!0),this._memoryUsedByLayerData+=A.memoryUsed,this.layerData.set(q,A);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const [,m]of this.layerData)m.type===g.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(k){this.stage={context:k,trashDisplayObject(r){r.processDetach()},untrashDisplayObject(){return!1}}}setTransform(k){super.setTransform(k);var r=this.resolution/
(k.resolution*k.pixelRatio);const m=this.width/this.rangeX*r;r*=this.height/this.rangeY;const p=[0,0];k.toScreen(p,[this.x,this.y]);const q=this.transforms.tileUnitsToPixels;C.identity(q);C.translate(q,q,p);C.rotate(q,q,Math.PI*k.rotation/180);C.scale(q,q,[m,r,1])}_createTransforms(){return{displayViewScreenMat3:c.create(),tileMat3:c.create(),tileUnitsToPixels:c.create()}}static _destroyRenderBuckets(k){if(k){var r=new Set;for(const m of k.values())r.has(m)||(m.destroy(),r.add(m));k.clear()}}_createRenderBuckets(k){const r=
new Map,m=new Map;for(const p of k){k=this._deserializeBucket(p,m);for(const q of k.layerUIDs)r.set(q,k)}return r}_deserializeBucket(k,r){let m=r.get(k);if(m)return m;switch((new Uint32Array(k))[0]){case g.BucketType.FILL:m=new h.FillRenderBucket(k,this.styleRepository);break;case g.BucketType.LINE:m=new h.LineRenderBucket(k,this.styleRepository);break;case g.BucketType.SYMBOL:m=new h.SymbolRenderBucket(k,this.styleRepository,this);break;case g.BucketType.CIRCLE:m=new h.CircleRenderBucket(k,this.styleRepository)}r.set(k,
m);return m}_deleteLayerData(k){if(this.layerData.has(k)){var r=this.layerData.get(k);this._memoryUsedByLayerData-=r.memoryUsed;r.destroy();this.layerData.delete(k)}}}const l=new Map;y.VectorTile=d;y.printAllocations=function(){l.forEach((k,r)=>{console.log(`\n${r.key}:`);k[0].forEach(m=>console.log(m));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");k[1].forEach(m=>console.log(m))})};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(y,z,C,c,g,h,b,e,d,l,k,r){class m{constructor(x,D){this.layerUIDs=[];this.isDestroyed=!1;this._data=x;let E=1;x=new Uint32Array(x);this.layerUIDs=[];const I=x[E++];for(let L=0;L<I;L++)this.layerUIDs[L]=x[E++];this.bufferDataOffset=E;D&&(this.layer=D.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(x){null!=
this._data&&(this.doPrepareForRendering(x,this._data,this.bufferDataOffset),this._data=null)}}class p extends m{constructor(x,D){super(x,D);this.type=e.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;x=new Uint32Array(x);D=this.bufferDataOffset;this.lineIndexStart=x[D++];this.lineIndexCount=x[D++];const E=x[D++];if(0<E){this.patternMap=new Map;for(let I=0;I<E;I++){const L=x[D++],O=x[D++],u=x[D++];this.patternMap.set(L,[O,u])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??
0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(x,D,E){var I=new Uint32Array(D);D=new Int32Array(I.buffer);var L=I[E++];D=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,L));E+=L;L=I[E++];I=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,L));E+=L;E=this.layer.lineMaterial;this.vao=new r.VertexArrayObject(x,
E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},I)}}class q extends m{constructor(x,D){super(x,D);this.type=e.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;x=new Uint32Array(x);D=this.bufferDataOffset;this.fillIndexStart=x[D++];this.fillIndexCount=x[D++];this.outlineIndexStart=x[D++];this.outlineIndexCount=x[D++];const E=x[D++];if(0<E){this.patternMap=new Map;for(let I=0;I<E;I++){const L=x[D++],O=x[D++],u=x[D++];this.patternMap.set(L,
[O,u])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=z.disposeMaybe(this.fillVAO);this.outlineVAO=z.disposeMaybe(this.outlineVAO)}doPrepareForRendering(x,D,E){var I=new Uint32Array(D),L=new Int32Array(I.buffer),O=I[E++];D=l.BufferObject.createVertex(x,
k.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,O));E+=O;var u=I[E++];O=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,u));E+=u;u=I[E++];L=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,u));E+=u;u=I[E++];I=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,u));E+=u;u=this.layer;E=u.fillMaterial;u=u.outlineMaterial;this.fillVAO=new r.VertexArrayObject(x,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},
O);this.outlineVAO=new r.VertexArrayObject(x,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:L},I)}}class A extends m{constructor(x,D,E){super(x,D);this.type=e.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];D=new Uint32Array(x);const I=new Int32Array(x);x=new Float32Array(x);let L=this.bufferDataOffset;this.isIconSDF=!!D[L++];var O=D[L++],u=D[L++],
B=D[L++];O=new g(O,u,B,0);u=D[L++];for(B=0;B<u;B++){var f=D[L++],n=D[L++],v=D[L++];this.iconPerPageElementsMap.set(f,[n,v])}u=D[L++];for(B=0;B<u;B++)f=D[L++],n=D[L++],v=D[L++],this.glyphPerPageElementsMap.set(f,[n,v]);u=D[L++];B=D[L++];this.iconOpacity=new Int32Array(u);this.textOpacity=new Int32Array(B);this.bufferDataOffset=L=d.deserializeSymbols(D,I,x,L,this.symbols,E,O)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+C.estimateSize(this.iconOpacity)+
C.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let x=0;for(const [,D]of this.iconPerPageElementsMap)x+=D[1];for(const [,D]of this.glyphPerPageElementsMap)x+=D[1];return x/3}doDestroy(){this.iconVAO=z.disposeMaybe(this.iconVAO);this.textVAO=z.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var x=this.iconOpacity,D=this.iconVAO.vertexBuffers.opacity;0<x.length&&x.byteLength===
D.usedMemory&&D.setSubData(x,0,0,x.length);x=this.textOpacity;D=this.textVAO.vertexBuffers.opacity;0<x.length&&x.byteLength===D.usedMemory&&D.setSubData(x,0,0,x.length)}}doPrepareForRendering(x,D,E){var I=new Uint32Array(D),L=new Int32Array(I.buffer),O=I[E++];D=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,new Int32Array(L.buffer,4*E,O));E+=O;var u=I[E++];O=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,u));E+=u;u=I[E++];L=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,
new Int32Array(L.buffer,4*E,u));E+=u;u=I[E++];I=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,u));E+=u;E=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,this.iconOpacity.buffer);u=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,this.textOpacity.buffer);var B=this.layer;const f=B.iconMaterial;B=B.textMaterial;this.iconVAO=new r.VertexArrayObject(x,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:D,opacity:E},O);this.textVAO=new r.VertexArrayObject(x,B.getAttributeLocations(),
B.getLayoutInfo(),{geometry:L,opacity:u},I)}}class F extends m{constructor(x,D){super(x,D);this.type=e.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;x=new Uint32Array(x);D=this.bufferDataOffset;this.circleIndexStart=x[D++];this.circleIndexCount=x[D++];this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(x,
D,E){var I=new Uint32Array(D);D=new Int32Array(I.buffer);var L=I[E++];D=l.BufferObject.createVertex(x,k.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,L));E+=L;L=I[E++];I=l.BufferObject.createIndex(x,k.Usage.STATIC_DRAW,new Uint32Array(I.buffer,4*E,L));E+=L;E=this.layer.circleMaterial;this.vao=new r.VertexArrayObject(x,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},I)}}y.CircleRenderBucket=F;y.FillRenderBucket=q;y.LineRenderBucket=p;y.RenderBucketBase=m;y.SymbolRenderBucket=A;Object.defineProperty(y,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","../GeometryUtils","./core"],function(y,z,C,c){class g{constructor(h,b,e){this._rows=Math.ceil(b/e);this._columns=Math.ceil(h/e);this._cellSize=e;this.cells=Array(this._rows);for(h=0;h<this._rows;h++)for(this.cells[h]=Array(this._columns),b=0;b<this._columns;b++)this.cells[h][b]=[]}getCell(h,b){b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._rows-1);h=Math.min(Math.max(Math.floor(h/
this._cellSize),0),this._columns-1);return this.cells[b]&&this.cells[b][h]||null}getCellSpan(h,b,e,d){return[Math.min(Math.max(Math.floor(h/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}y.GridIndex=g;y.deserializeSymbols=
function(h,b,e,d,l,k,r){const m=b[d++];for(let A=0;A<m;A++){const F=new c.VTLSymbol(k,r);F.xTile=b[d++];F.yTile=b[d++];F.hash=b[d++];F.priority=b[d++];F.featureIndex=b[d++];var p=b[d++];for(var q=0;q<p;q++){const x=b[d++],D=b[d++],E=b[d++],I=b[d++],L=!!b[d++],O=b[d++],u=e[d++],B=e[d++],f=b[d++],n=b[d++];F.colliders.push({xTile:x,yTile:D,dxPixels:E,dyPixels:I,hard:L,partIndex:O,width:f,height:n,minLod:u,maxLod:B})}p=h[d++];for(q=0;q<p;q++)F.textVertexRanges.push([h[d++],h[d++]]);p=h[d++];for(q=0;q<
p;q++)F.iconVertexRanges.push([h[d++],h[d++]]);l.push(F)}return d};y.isSearchCircleOverlapingSymbol=function(h,b,e,d){var l=h.colliders;let k,r,m;for(const p of l)if(h.unique.show&&h.unique.parts[p.partIndex].show&&(l=p.xScreen-d[0]+p.dxScreen,k=p.yScreen-d[1]+p.dyScreen,r=l+p.width,m=k+p.height,C.isCircleOverlapingRect(e,b.x,b.y,l,k,r,m)))return!0;return!1};y.tileCoordChange=function(h,b,e,d,l,k){e-=l;if(0<=e)return(b>>e)+(d-(k<<e))*(h>>e);e=-e;return b-(k-(d<<e))*(h>>e)<<e};y.writeOpacityToBuffers=
function(h,b,e){for(const [q,A]of h.symbols){{var d=h,l=b,k=e,r=A;const F=d.layerData.get(q);if(F.type===z.BucketType.SYMBOL){for(const x of r){r=x.unique;var m=void 0;if(x.selectedForRendering){var p=r.parts[0];m=p.startOpacity;p=p.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===p;m=k?Math.floor(127*m)|p<<7:p?255:0;m|=m<<24|m<<16|m<<8}else m=0;for(const [D,E]of x.iconVertexRanges)for(p=D;p<D+E;p+=4)F.iconOpacity[p/4]=m;x.selectedForRendering?(m=r.parts[1],r=m.startOpacity,m=m.targetOpacity,
d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===m,r=k?Math.floor(127*r)|m<<7:m?255:0,m=r<<24|r<<16|r<<8|r):m=0;for(const [D,E]of x.textVertexRanges)for(r=D;r<D+E;r+=4)F.textOpacity[r/4]=m}F.lastOpacityUpdate=l;F.opacityChanged=!0}}}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){class z{constructor(c,g){this.sourceTile=g;this.hash=this.yTile=this.xTile=0;this.priority=1;this.featureIndex=
0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=c}}class C{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}y.VTLSymbol=z;y.VTLUniqueSymbol=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../../../layers/support/TileInfo ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(y,z,C,c,g,h,b,e,d,l,k){function r(p,q){if(p){const A=p.getLayoutProperty("visibility");if(!A||A.getValue()!==g.Visibility.NONE&&(void 0===p.minzoom||p.minzoom<q+1E-6)&&(void 0===p.maxzoom||p.maxzoom>=q-1E-6))return!0}return!1}class m extends e{constructor(p){super(p);this._backgroundTiles=[];this._computeDisplayInfoView(p)}destroy(){this.removeAllChildren();this._spriteMosaic?.dispose();this._spriteMosaic=null;this._glyphMosaic?.dispose();this._glyphMosaic=null;null!=this._symbolFader&&(this._symbolFader.clear(),
this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(p,q,A,F){this._spriteMosaic=p;this._glyphMosaic=q;this._styleRepository=A;this._tileInfoView=F;this._computeDisplayInfoView(F);null==this._symbolFader&&(this._symbolFader=new c.SymbolFader(this._styleRepository,this.children));this._symbolFader.styleRepository=
A}setSpriteMosaic(p){this._spriteMosaic?.dispose();this._spriteMosaic=p}deleteStyleLayers(p){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(p)}createRenderParams(p){return{...super.createRenderParams(p),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(p){!this.visible||p.drawPhase!==h.WGLDrawPhase.MAP&&p.drawPhase!==h.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||super.doRender(p)}addChild(p){super.addChild(p);
null!=this._symbolFader?this._symbolFader.addTile(p):p.decluttered=!0;this.requestRender();return p}removeChild(p){null!=this._symbolFader&&this._symbolFader.removeTile(p);this.requestRender();return super.removeChild(p)}renderChildren(p){const {drawPhase:q}=p;q===h.WGLDrawPhase.DEBUG?super.renderChildren(p):this._doRender(p)}removeAllChildren(){for(let p=0;p<this.children.length;p++){const q=this.children[p];null!=this._symbolFader&&this._symbolFader.removeTile(q);q.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(p=>
p.neededForCoverage&&p.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(p){const {context:q,state:A}=p;var F=this._styleRepository;if(F){var x=F.layers,D=this._displayInfo.scaleToZoom(A.scale);0<F.backgroundBucketIds.length&&(p.renderPass="background",this._renderBackgroundLayers(p,F.backgroundBucketIds,D));super.renderChildren(p);p.drawPhase===h.WGLDrawPhase.MAP&&this._fade(D,A);if((F=this.children.filter(I=>I.visible&&I.hasData()))&&0!==F.length){for(var E of F)E.triangleCount=
0;q.setStencilWriteMask(0);q.setColorMask(!0,!0,!0,!0);q.setStencilOp(k.StencilOperation.KEEP,k.StencilOperation.KEEP,k.StencilOperation.REPLACE);q.setStencilTestEnabled(!0);q.setBlendingEnabled(!1);q.setDepthTestEnabled(!0);q.setDepthWriteEnabled(!0);q.setDepthFunction(k.CompareFunction.LEQUAL);q.setClearDepth(1);q.clear(q.gl.DEPTH_BUFFER_BIT);p.renderPass="opaque";for(E=x.length-1;0<=E;E--)this._renderStyleLayer(x[E],p,F);q.setDepthWriteEnabled(!1);q.setBlendingEnabled(!0);q.setBlendFunctionSeparate(k.BlendFactor.ONE,
k.BlendFactor.ONE_MINUS_SRC_ALPHA,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);p.renderPass="translucent";for(E=0;E<x.length;E++)this._renderStyleLayer(x[E],p,F);q.bindVAO();q.setStencilTestEnabled(!0);q.setBlendingEnabled(!0);for(const I of F)I.debugInfo.display.triangleCount=I.triangleCount}else q.bindVAO(),q.setStencilTestEnabled(!0),q.setBlendingEnabled(!0)}}_fade(p,q){null!=this._symbolFader&&(this._symbolFader.update(p,q)||this.requestRender())}_renderStyleLayer(p,q,A){const {displayLevel:F,
painter:x,renderPass:D}=q;if(void 0!==p){var E=p.getLayoutProperty("visibility");if(!E||E.getValue()!==g.Visibility.NONE){switch(p.type){case g.StyleLayerType.BACKGROUND:return;case g.StyleLayerType.FILL:if("opaque"!==D&&"translucent"!==q.renderPass)return;var I="vtlFill";break;case g.StyleLayerType.LINE:if("translucent"!==D)return;I="vtlLine";break;case g.StyleLayerType.CIRCLE:if("translucent"!==D)return;I="vtlCircle";break;case g.StyleLayerType.SYMBOL:if("translucent"!==D)return;I="vtlSymbol"}A=
p.type===g.StyleLayerType.SYMBOL?A.filter(L=>L.decluttered):A.filter(L=>L.neededForCoverage);if("vtlSymbol"===I||!(0===A.length||void 0!==p.minzoom&&p.minzoom>=F+1E-6||void 0!==p.maxzoom&&p.maxzoom<F-1E-6)){E=p.uid;q.styleLayerUID=E;q.styleLayer=p;for(const L of A)if(L.layerData.has(E)){x.renderObjects(q,A,I);break}}}}}_renderBackgroundLayers(p,q,A){const {context:F,painter:x,state:D}=p,E=this._styleRepository;var I=!1;for(var L of q)if(E.getLayerById(L).type===g.StyleLayerType.BACKGROUND&&r(E.getLayerById(L),
A)){I=!0;break}if(I){var O=this._tileInfoView;I=O.getTileCoverage(p.state,0,!0,"smallest");var {spans:u,lodInfo:B}=I,{level:f}=B,n=z.create();L=[];if(this._renderPasses){var v=this._renderPasses[0];null!=this._clippingInfos&&(v.brushes[0].prepareState(p),v.brushes[0].drawMany(p,this._clippingInfos))}v=this._backgroundTiles;var H=0;for(const {row:M,colFrom:J,colTo:P}of u)for(let R=J;R<=P;R++){if(H<v.length){var K=v[H];K.key.set(f,M,B.normalizeCol(R),B.getWorldForColumn(R));O.getTileBounds(n,K.key,
!1);K.x=n[0];K.y=n[3];K.resolution=O.getTileResolution(f)}else{K=new l(f,M,B.normalizeCol(R),B.getWorldForColumn(R));const U=O.getTileBounds(z.create(),K),Z=O.getTileResolution(f);K=new b.RenderableTile(K,Z,U[0],U[3],512,512,4096,4096);v.push(K)}K.setTransform(D);L.push(K);H++}F.setStencilWriteMask(0);F.setColorMask(!0,!0,!0,!0);F.setStencilOp(k.StencilOperation.KEEP,k.StencilOperation.KEEP,k.StencilOperation.REPLACE);F.setStencilFunction(k.CompareFunction.EQUAL,0,255);F.setStencilTestEnabled(!0);
for(const M of q)q=E.getLayerById(M),q.type===g.StyleLayerType.BACKGROUND&&r(q,A)&&(p.styleLayerUID=q.uid,p.styleLayer=q,x.renderObjects(p,L,"vtlBackground"));d.pool.release(I)}}_computeDisplayInfoView(p){let q=p.tileInfo.lods[0].scale;const A=Math.max(25,p.tileInfo.lods.length),F=[];for(let x=0;x<=A;x++)F.push(q),q/=2;this._displayInfo=C.create({scales:F,size:512,spatialReference:p.spatialReference,numLODs:A})}}y.VectorTileContainer=m;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../core/signal ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),function(y,z,C,c,g,h,b,e,d){class l{constructor(k,r){this.styleRepository=k;this._tileToHandle=new Map;this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._offsetFromScreenCenter=[0,0];this._completed=
!1;this._fading=z.signal(!1);this._symbolRepository=new b.SymbolRepository(4096,r,()=>new c.VTLUniqueSymbol);this._symbolDeclutterer=new h.SymbolDeclutterer(r,this._symbolRepository,(m,p,q)=>this._createCollisionJob(m,p,q),(m,p)=>{m.allSymbolsFadingOut=!0;m.lastOpacityUpdate=p;e.writeOpacityToBuffers(m,p,!0);m.decluttered=!0;m.requestRender()},(m,p)=>this.styleRepository.getStyleLayerByUID(m.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(p.styleLayerUID).z,m=>{m=this.styleRepository.getStyleLayerByUID(m);
return this._zoom+1E-6<m.minzoom||this._zoom-1E-6>=m.maxzoom?!1:(m=m.getLayoutProperty("visibility"))&&m.getValue()===d.Visibility.NONE?!1:!0})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(k,r,m){this.updateDecluttererViewState();return new g.CollisionJob(k,r,m,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(k){k.decluttered=!1;this._tileToHandle.set(k,k.on("symbols-changed",
()=>{this._symbolRepository.add(k);this.restartDeclutter()}));this._symbolRepository.add(k);this.restartDeclutter()}removeTile(k){const r=this._tileToHandle.get(k);r&&(this._symbolRepository.removeTile(k),this.restartDeclutter(),r.remove(),this._tileToHandle.delete(k))}update(k,r){this._zoom=k;this._viewState={scale:r.scale,rotation:r.rotation,center:[r.center[0],r.center[1]],size:[r.size[0],r.size[1]]};k=[0,0];r.toScreen(k,r.center);const m=[0,0];r.toScreen(m,this._declutterViewState.center);this._offsetFromScreenCenter[0]=
k[0]-m[0];this._offsetFromScreenCenter[1]=k[1]-m[1];this._continueDeclutter();return this._completed}restartDeclutter(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()}clear(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(k=>k.remove());this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||
this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(k){this._symbolRepository.deleteStyleLayers(k)}_continueDeclutter(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(C.declutterBudget))&&this._scheduleNotifyStable()}_scheduleNotifyStable(){null!=
this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this._fading.value=!1},1.5*C.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom;this._declutterViewState.center[0]=this._viewState.center[0];this._declutterViewState.center[1]=
this._viewState.center[1];this._declutterViewState.rotation=this._viewState.rotation;this._declutterViewState.scale=this._viewState.scale;this._declutterViewState.size[0]=this._viewState.size[0];this._declutterViewState.size[1]=this._viewState.size[1];this._offsetFromScreenCenter[0]=0;this._offsetFromScreenCenter[1]=0}}y.SymbolFader=l;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32",
"./config","./util","../style/StyleDefinition"],function(y,z,C,c,g){class h{constructor(b,e,d,l,k,r){this._symbols=b;this._styleRepository=l;this._zoom=k;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new c.GridIndex(e,d,C.collisionGridCellSize);this._si=Math.sin(Math.PI*r/180);this._co=Math.cos(Math.PI*r/180);for(const m of b)for(const p of m.symbols)this._allNeededMatrices.has(p.tile)||this._allNeededMatrices.set(p.tile,
z.clone(p.tile.transforms.tileUnitsToPixels))}work(b){const e=this._gridIndex,d=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const E=this._symbols[this._currentLayerCursor],I=this._getProperties(E.styleLayerUID);for(;this._currentSymbolCursor<E.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-d>b)return!1;var l=E.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;
var k=l,r=this._si,m=this._co,p=this._allNeededMatrices.get(l.tile),q=this._zoom;const {iconRotationAlignment:L,textRotationAlignment:O,iconTranslate:u,iconTranslateAnchor:B,textTranslate:f,textTranslateAnchor:n}=I;var A=0;for(const J of k.colliders){const [P,R]=0===J.partIndex?u:f;var F=0===J.partIndex?B:n,x=J.minLod<=q&&q<=J.maxLod;A+=x?0:1;J.enabled=x;J.xScreen=J.xTile*p[0]+J.yTile*p[3]+p[6];J.yScreen=J.xTile*p[1]+J.yTile*p[4]+p[7];F===g.TranslateAnchor.MAP?(J.xScreen+=m*P-r*R,J.yScreen+=r*P+m*
R):(J.xScreen+=P,J.yScreen+=R);g.RotationAlignment.VIEWPORT===(0===J.partIndex?L:O)?(J.dxScreen=J.dxPixels,J.dyScreen=J.dyPixels):(J.dxScreen=m*(J.dxPixels+J.width/2)-r*(J.dyPixels+J.height/2)-J.width/2,J.dyScreen=r*(J.dxPixels+J.width/2)+m*(J.dyPixels+J.height/2)-J.height/2)}0<k.colliders.length&&A===k.colliders.length&&(k.unique.show=!1);k=l.unique;if(!k.show)continue;const {iconAllowOverlap:v,iconIgnorePlacement:H,textAllowOverlap:K,textIgnorePlacement:M}=I;for(const J of l.colliders)if(J.enabled&&
(r=k.parts[J.partIndex],r.show)){if(m=!(J.partIndex?K:v))a:{m=J.xScreen+J.dxScreen;p=J.yScreen+J.dyScreen;q=m+J.width;A=p+J.height;const [P,R,U,Z]=e.getCellSpan(m,p,q,A);for(F=R;F<=Z;F++)for(x=P;x<=U;x++){var D=e.cells[F][x];for(const W of D){D=W.xScreen+W.dxScreen;const Y=W.yScreen+W.dyScreen,ca=D+W.width,X=Y+W.height;if(!(q<D||m>ca||A<Y||p>X)){m=!0;break a}}}m=!1}m&&(J.hard?k.show=!1:r.show=!1)}if(k.show)for(const J of l.colliders){if(!J.enabled)continue;if(J.partIndex?M:H)continue;if(!k.parts[J.partIndex].show)continue;
l=J.xScreen+J.dxScreen;r=J.yScreen+J.dyScreen;const [P,R,U,Z]=this._gridIndex.getCellSpan(l,r,l+J.width,r+J.height);for(l=R;l<=Z;l++)for(r=P;r<=U;r++)this._gridIndex.cells[l][r].push(J)}}}return!0}_getProperties(b){var e=this._styleProps.get(b);if(e)return e;e=this._zoom;const d=this._styleRepository.getStyleLayerByUID(b);var l=d.getLayoutValue("symbol-placement",e)!==g.SymbolPlacement.POINT;let k=d.getLayoutValue("icon-rotation-alignment",e);k===g.RotationAlignment.AUTO&&(k=l?g.RotationAlignment.MAP:
g.RotationAlignment.VIEWPORT);let r=d.getLayoutValue("text-rotation-alignment",e);r===g.RotationAlignment.AUTO&&(r=l?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);l=d.getPaintValue("icon-translate",e);const m=d.getPaintValue("icon-translate-anchor",e),p=d.getPaintValue("text-translate",e),q=d.getPaintValue("text-translate-anchor",e);e={iconAllowOverlap:d.getLayoutValue("icon-allow-overlap",e),iconIgnorePlacement:d.getLayoutValue("icon-ignore-placement",e),textAllowOverlap:d.getLayoutValue("text-allow-overlap",
e),textIgnorePlacement:d.getLayoutValue("text-ignore-placement",e),iconRotationAlignment:k,textRotationAlignment:r,iconTranslateAnchor:m,iconTranslate:l,textTranslateAnchor:q,textTranslate:p};this._styleProps.set(b,e);return e}}y.CollisionJob=h;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(y,z){function C(g,h){if(g.priority-h.priority)return g.priority-h.priority;const b=
g.tile.key,e=h.tile.key;return b.world-e.world?b.world-e.world:b.level-e.level?b.level-e.level:b.row-e.row?b.row-e.row:b.col-e.col?b.col-e.col:g.xTile-h.xTile?g.xTile-h.xTile:g.yTile-h.yTile}class c{get running(){return this._running}constructor(g,h,b,e,d,l){this._visibleTiles=g;this._symbolRepository=h;this._createCollisionJob=b;this._assignTileSymbolsOpacity=e;this._symbolLayerSorter=d;this._isLayerVisible=l;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=
!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(g,h){this._screenWidth===g&&this._screenHeight===h||this.restart();this._screenWidth=g;this._screenHeight=h}restart(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(g){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var h=performance.now();
if(!this._selectionJob.work(g))return!1;this._selectionJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){h=performance.now();if(!this._collisionJob.work(g))return!1;this._collisionJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());
if(!this._opacityJobCompleted){h=performance.now();if(!this._opacityJob.work(g))return!1;this._opacityJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._running=!1;return!0}_createSelectionJob(){const g=this._symbolRepository.uniqueSymbols;for(let k=0;k<g.length;k++){const r=g[k];for(let m=0;m<r.uniqueSymbols.length;m++){const p=r.uniqueSymbols[m];for(const q of p.tileSymbols)q.selectedForRendering=!1}}const h=[];let b=0,e=0;const d=this._isLayerVisible,l=this._symbolLayerSorter;
return{work:function(k){const r=performance.now();for(;e<g.length;e++,b=0){const p=g[e];var m=p.styleLayerUID;if(!d(m)){h[e]||(h[e]={styleLayerUID:m,symbols:[]});continue}h[e]=h[e]||{styleLayerUID:m,symbols:[]};const q=h[e];for(;b<p.uniqueSymbols.length;b++){m=p.uniqueSymbols[b];if(99===b%100&&performance.now()-r>k)return!1;let A=null,F=!1,x=!1;for(const D of m.tileSymbols)if(!x||!F){const E=D.tile;if(!A||E.isCoverage||E.neededForCoverage&&!F){A=D;if(E.neededForCoverage||E.isCoverage)x=!0;E.isCoverage&&
(F=!0)}}A.selectedForRendering=!0;if(x){q.symbols.push(A);m.show=!0;for(const D of m.parts)D.show=!0}else m.show=!1}}for(const p of h)p.symbols.sort(C);return!0},get sortedSymbols(){return h.sort(l)}}}_createOpacityJob(){function g(d,l){var k=d.symbols;for(const [,m]of k){var r=m;k=l;for(const p of r){r=p.unique;for(const q of r.parts)q.startOpacity+=(k-q.startTime)/z.fadeDuration*(.5<q.targetOpacity?1:-1),q.startOpacity=Math.min(Math.max(q.startOpacity,0),1),q.startTime=k,q.targetOpacity=r.show&&
q.show?1:0}}h(d,l);for(const m of d.childrenTiles)g(m,l)}const h=this._assignTileSymbolsOpacity,b=this._visibleTiles;let e=0;return{work(d){const l=performance.now();for(;e<b.length;e++){if(performance.now()-l>d)return!1;const k=b[e];if(null!=k.parentTile)continue;const r=performance.now();g(k,r)}return!0}}}}y.SymbolDeclutterer=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(y,
z){class C{constructor(c,g,h){this.tileCoordRange=c;this._visibleTiles=g;this._createUnique=h;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(c,g){this._uniqueSymbolLayerArray=null;let h=this._tiles.get(c.id);h||(h={symbols:new Map},this._tiles.set(c.id,h));var b=
new Map;if(g)for(var e of g)h.symbols.has(e)&&(b.set(e,h.symbols.get(e)),h.symbols.delete(e));else for(var [d]of c.layerData)h.symbols.has(d)&&(b.set(d,h.symbols.get(d)),h.symbols.delete(d));this._removeSymbols(b);g=c.symbols;b=new Map;for(const [l,k]of g)if(e=k.length,32<=e){d=this.tileCoordRange;do d/=2,e/=4;while(8<e&&64<d);e=new z.GridIndex(this.tileCoordRange,this.tileCoordRange,d);b.set(l,{flat:k,index:e});h.symbols.set(l,{flat:k,index:e});for(const r of k)e.getCell(r.xTile,r.yTile).push(r)}else b.set(l,
{flat:k}),h.symbols.set(l,{flat:k});this._addSymbols(c.key,g)}deleteStyleLayers(c){this._uniqueSymbolLayerArray=null;for(const [g,h]of this._tiles){const b=new Map;for(const e of c)h.symbols.has(e)&&(b.set(e,h.symbols.get(e)),h.symbols.delete(e));this._removeSymbols(b);0===h.symbols.size&&this._tiles.delete(g)}}removeTile(c){this._uniqueSymbolLayerArray=null;const g=this._tiles.get(c.id);if(g){var h=new Map;for(const [b]of c.symbols)g.symbols.has(b)&&(h.set(b,g.symbols.get(b)),g.symbols.delete(b));
this._removeSymbols(h);0===g.symbols.size&&this._tiles.delete(c.id)}}querySymbols(c,g,h,b){b=[];var e=this.uniqueSymbols;for(const l of e){e=l.styleLayerUID;var d=l.uniqueSymbols;for(const k of d)(d=k.tileSymbols.find(r=>r.selectedForRendering))&&z.isSearchCircleOverlapingSymbol(d,c,g*(window.devicePixelRatio||1),h)&&b.push({vtlSymbol:d,styleLayerUID:e,tileKey:d.tile.key})}return b}_removeSymbols(c){for(const [h,{flat:b}]of c)for(const e of b){c=e.unique;var g=c.tileSymbols;const d=g.length-1;for(let l=
0;l<d;l++)if(g[l]===e){g[l]=g[d];break}g.length=d;0===d&&(g=this._uniqueSymbolsReferences.get(h),g.delete(c),0===g.size&&this._uniqueSymbolsReferences.delete(h));e.unique=null}}_addSymbols(c,g){if(0!==g.size){var h=this._visibleTiles;for(const b of h)b.parentTile||b.key.world!==c.world||b.key.level===c.level&&!b.key.equals(c)||this._matchSymbols(b,c,g);for(const [b,e]of g)for(const d of e)null==d.unique&&(c=this._createUnique(),d.unique=c,c.tileSymbols.push(d),g=this._uniqueSymbolsReferences.get(b),
g||(g=new Set,this._uniqueSymbolsReferences.set(b,g)),g.add(c))}}_matchSymbols(c,g,h){if(c.key.level>g.level){var b=c.key.level-g.level;if(c.key.row>>b!==g.row||c.key.col>>b!==g.col)return}if(g.level>c.key.level&&(b=g.level-c.key.level,g.row>>b!==c.key.row||g.col>>b!==c.key.col))return;if(g.equals(c.key))for(var e of c.childrenTiles)this._matchSymbols(e,g,h);else{e=new Map;for(const [k,r]of h){var d=[];for(const p of r)h=z.tileCoordChange(this.tileCoordRange,p.xTile,g.level,g.col,c.key.level,c.key.col),
b=z.tileCoordChange(this.tileCoordRange,p.yTile,g.level,g.row,c.key.level,c.key.row),0<=h&&h<this.tileCoordRange&&0<=b&&b<this.tileCoordRange&&d.push({symbol:p,xTransformed:h,yTransformed:b});h=[];b=(c.key.level<g.level?1:1<<c.key.level-g.level)+20;const m=this._tiles.get(c.id).symbols.get(k);if(m){const p=m.flat;for(const q of d){var l=!1;let A;const F=q.xTransformed,x=q.yTransformed;A=null!=m.index?m.index.getCell(F,x):p;d=q.symbol;const D=d.hash;for(const E of A)if(D===E.hash&&Math.abs(F-E.xTile)<=
b&&Math.abs(x-E.yTile)<=b){l=E.unique;d.unique=l;l.tileSymbols.push(d);l=!0;break}l||h.push(d)}}0<h.length&&e.set(k,h)}for(const k of c.childrenTiles)this._matchSymbols(k,g,e)}}_createUniqueSymbolLayerArray(){var c=this._uniqueSymbolsReferences;const g=Array(c.size);let h=0;for(const [b,e]of c){const d=Array(e.size);c=0;for(const l of e)d[c++]=l;g[h]={styleLayerUID:b,uniqueSymbols:d};h++}return g}}y.SymbolRepository=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(y,z,C){class c extends C.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:z.create(),tileMat3:z.create()}}}y.RenderableTile=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileFeatureIndex":function(){define("../../../../Graphic ../../../../core/MapUtils ../../../../core/pbf ../../../../core/libs/rbush/PooledRBush ./enums ./Feature ./GeometryUtils ./SourceLayerData ./style/StyleLayer".split(" "),
function(y,z,C,c,g,h,b,e,d){const l=(m,p)=>{const q=m.vtlSymbol.sourceTile,A=p.vtlSymbol.sourceTile;return q.level!==A.level?q.level-A.level:q.row!==A.row?q.row-A.row:q.col!==A.col?q.col-A.col:m.styleLayerUID-p.styleLayerUID};class k{constructor(m,p,q,A,F){this.tileKey=m;this._tileHandler=this._styleRepository=this._index=null;this._tileKeyToPBF=new Map;this._tileLayerData=p;this._styleRepository=q;this._tileHandler=A;this._parentLayer=F}static create(m,p,q,A,F){return new k(m,p,q,A,F)}clear(){this._index?.clear();
this._tileKeyToPBF.clear()}async queryAttributes(m,p,q,A,F){if(0===this._tileLayerData.size||!this._styleRepository||!this._tileHandler)return[];null===this._index&&(this._index=new c.PooledRBush(100,r),await this._indexLayers());const x=[];this._queryIndex(x,m,p,q,this.tileKey.level,A);F&&0<F?.length&&await this._getSymbolsAttributes(x,F);return x}async _indexLayers(){const m=this.tileKey,p=this._styleRepository.layers,q=await this._getTilePayload(m);for(const [F,x]of this._tileLayerData){const D=
p[F];var A=q.find(L=>L.sourceName===D.source);if(!A)continue;const {protobuff:E,key:I}=A;x.type!==g.BucketType.SYMBOL&&(A=1<<m.level-I.level,this._indexLayer(D,E,m.level,A,m.row-I.row*A,m.col-I.col*A))}}_indexLayer(m,p,q,A,F,x){const D=m.sourceLayer,E=m.getFeatureFilter(),I=q+1,L=b.getTileMargins(q);for(p=new C(new Uint8Array(p),new DataView(p));p.next();)switch(p.tag()){case 3:var O=p.getMessage();const n=new e(O);O.release();if(n.name!==D)continue;O=n.getData();var u=n.extent/A;const v=u*x-L,H=
u*F-L,K=v+u+2*L,M=H+u+2*L,J=u/512,P=4096/u,R=u*x;for(u*=F;O.nextTag(2);){var B=O.getMessage();const U=new h(B,n);B.release();if(!E||E.filter(U,q)){var f=U.values||{};B=f._minzoom;f=f._maxzoom;B&&B>=10*I||f&&f<=10*q||(B=m.getFeatureInflatedBounds(U,q,n.extent,J),null==B||B[0]>K||B[1]>M||B[2]<v||B[3]<H||(B[0]=(B[0]-R)*P,B[1]=(B[1]-u)*P,B[2]=(B[2]-R)*P,B[3]=(B[3]-u)*P,this._index.insert(new d.IndexItem(m,U,B,P,R,u))))}}break;default:p.skip()}}async _getSymbolsAttributes(m,p){if(!p||0===p.length)return m;
var q=[];p.sort(l);let A=p[0].styleLayerUID;var F=0;for(var x=0;x<p.length;x++)A!==p[x].styleLayerUID&&(q.push({from:F,to:x,styleLayerUID:A,sourceTileKey:p[x].vtlSymbol.sourceTile}),F=x,A=p[x].styleLayerUID);q.push({from:F,to:p.length,styleLayerUID:A,sourceTileKey:p[p.length-1].vtlSymbol.sourceTile});F=this._styleRepository.layers;x=null;let D;for(const E of q)q=await this._getTilePayload(E.sourceTileKey),D=F[E.styleLayerUID],(x=!!D&&q.find(I=>I.sourceName===D.source))&&this._addSymbolsAttributes(m,
p.slice(E.from,E.to).map(I=>I.vtlSymbol),A,x);return m}_addSymbolsAttributes(m,p,q,A){const F=this._styleRepository.layers,x=A.key,D=this.tileKey,E=1<<D.level-x.level;this._getSymbolAttributes(A.protobuff,p,q,E,D.row-x.row*E,D.col-x.col*E).forEach(I=>{const {attributes:L,tilePoint:O}=I;m.push({layerId:F[q].id,layerIndex:q,graphic:new y({attributes:L,origin:{type:"vector-tile",layerId:F[q].id,layerIndex:q,layer:this._parentLayer}}),tilePoint:O})})}_getSymbolAttributes(m,p,q,A,F,x){const D=[],E=this._styleRepository.layers;
let I=0;p.sort((B,f)=>B.featureIndex-f.featureIndex);for(m=new C(new Uint8Array(m),new DataView(m));m.next();)switch(m.tag()){case 3:var L=m.getMessage();const B=new e(L);L.release();if(B.name!==E[q].sourceLayer)continue;L=B.getData();var O=B.extent/A;const f=4096/O,n=O*x;O*=F;let v=0;for(;L.nextTag(2);){const H=L.getMessage();if(v++===p[I].featureIndex){var u=new h(H,B);const K=u.values;u=u.getGeometry();D.push({attributes:K,tilePoint:null!=u?[f*(u[0][0].x-n),f*(u[0][0].y-O)]:null});I++}H.release();
if(I===p.length)return D}break;default:m.skip()}return D}_queryIndex(m,p,q,A,F,x){const D=8*A*(window.devicePixelRatio||1);this._index?.search({minX:p-D,minY:q-D,maxX:p+D,maxY:q+D},E=>{const {layer:I,feature:L}=E;I.isIntersectingFeature(p,q,A,L,F,x,E)&&m.push({layerId:I.id,layerIndex:I.uid,tilePoint:null,graphic:new y({attributes:L.values,origin:{type:"vector-tile",layerId:E.layer.id,layerIndex:E.layer.uid,layer:this._parentLayer}})})});return m}async _getTilePayload(m){return z.getOrCreateMapValue(this._tileKeyToPBF,
m.id,()=>this._tileHandler.fetchTilePBFs(m)).then(p=>p)}}const r=m=>({minX:m.bounds[0],minY:m.bounds[1],maxX:m.bounds[2],maxY:m.bounds[3]});return k})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(y,z,C,c,g){function h(f,n){for(D.clear();f;){if(!0===f.leaf)for(const v of f.children)n(v);else D.pushArray(f.children);f=D.pop()??null}}function b(f,n){e(f,0,f.children.length,n,f)}function e(f,
n,v,H,K){K||=new u([]);K.minX=Infinity;K.minY=Infinity;K.maxX=-Infinity;K.maxY=-Infinity;for(let M=n,J;M<v;M++)J=f.children[M],d(K,f.leaf?H(J):J);return K}function d(f,n){f.minX=Math.min(f.minX,n.minX);f.minY=Math.min(f.minY,n.minY);f.maxX=Math.max(f.maxX,n.maxX);f.maxY=Math.max(f.maxY,n.maxY)}function l(f,n){return f.minX-n.minX}function k(f,n){return f.minY-n.minY}function r(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function m(f){return f.maxX-f.minX+(f.maxY-f.minY)}function p(f,n){return f.minX<=
n.minX&&f.minY<=n.minY&&n.maxX<=f.maxX&&n.maxY<=f.maxY}function q(f,n){return n.minX<=f.maxX&&n.minY<=f.maxY&&n.maxX>=f.minX&&n.maxY>=f.minY}function A(f,n,v,H,K){for(n=[n,v];n.length;){v=n.pop();const M=n.pop();if(v-M<=H)continue;const J=M+Math.ceil((v-M)/H/2)*H;g.quickselect(f,J,M,v,K);n.push(M,J,J,v)}}class F{constructor(f=9,n){this._compareMinX=l;this._compareMinY=k;this._toBBox=v=>v;this._maxEntries=Math.max(4,f||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));n&&("function"===
typeof n?this._toBBox=n:this._initFormat(n));this.clear()}destroy(){this.clear();x.prune();D.prune();E.prune();I.prune()}all(f){h(this._data,f)}search(f,n){let v=this._data;const H=this._toBBox;if(q(f,v))for(x.clear();v;){for(let K=0,M=v.children.length;K<M;K++){const J=v.children[K],P=v.leaf?H(J):J;q(f,P)&&(v.leaf?n(J):p(f,P)?h(J,n):x.push(J))}v=x.pop()}}collides(f){let n=this._data;const v=this._toBBox;if(!q(f,n))return!1;for(x.clear();n;){for(let H=0,K=n.children.length;H<K;H++){const M=n.children[H],
J=n.leaf?v(M):M;if(q(f,J)){if(n.leaf||p(f,J))return!0;x.push(M)}}n=x.pop()}return!1}load(f){if(!f.length)return this;if(f.length<this._minEntries){for(let n=0,v=f.length;n<v;n++)this.insert(f[n]);return this}f=this._build(f.slice(0,f.length),0,f.length-1,0);if(this._data.children.length)if(this._data.height===f.height)this._splitRoot(this._data,f);else{if(this._data.height<f.height){const n=this._data;this._data=f;f=n}this._insert(f,this._data.height-f.height-1,!0)}else this._data=f;return this}insert(f){f&&
this._insert(f,this._data.height-1);return this}clear(){this._data=new u([]);return this}remove(f){if(!f)return this;let n=this._data,v=null,H=0,K=!1,M;const J=this._toBBox(f);E.clear();for(I.clear();n||0<E.length;){n||(n=E.pop(),v=E.data[E.length-1],H=I.pop()??0,K=!0);if(n.leaf&&(M=z.indexOf(n.children,f,n.children.length,n.indexHint),-1!==M)){n.children.splice(M,1);E.push(n);this._condense(E);break}K||n.leaf||!p(n,J)?v?(H++,n=v.children[H],K=!1):n=null:(E.push(n),I.push(H),H=0,v=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(f){this._data=
f;return this}_build(f,n,v,H){var K=v-n+1,M=this._maxEntries;if(K<=M)return f=new u(f.slice(n,v+1)),b(f,this._toBBox),f;H||(H=Math.ceil(Math.log(K)/Math.log(M)),M=Math.ceil(K/M**(H-1)));const J=new B([]);J.height=H;K=Math.ceil(K/M);M=K*Math.ceil(Math.sqrt(M));for(A(f,n,v,M,this._compareMinX);n<=v;n+=M){const P=Math.min(n+M-1,v);A(f,n,P,K,this._compareMinY);for(let R=n;R<=P;R+=K)J.children.push(this._build(f,R,Math.min(R+K-1,P),H-1))}b(J,this._toBBox);return J}_insert(f,n,v){var H=this._toBBox;v=v?
f:H(f);E.clear();H=this._data;for(var K=n,M=E;;){M.push(H);if(!0===H.leaf||M.length-1===K)break;let J=Infinity,P=Infinity,R=void 0;for(let U=0,Z=H.children.length;U<Z;U++){const W=H.children[U],Y=r(W),ca=(Math.max(W.maxX,v.maxX)-Math.min(W.minX,v.minX))*(Math.max(W.maxY,v.maxY)-Math.min(W.minY,v.minY))-Y;ca<P?(P=ca,J=Y<J?Y:J,R=W):ca===P&&Y<J&&(J=Y,R=W)}H=R||H.children[0]}H.children.push(f);for(d(H,v);0<=n;)if(E.data[n].children.length>this._maxEntries)this._split(E,n),n--;else break;for(f=E;0<=n;n--)d(f.data[n],
v)}_split(f,n){const v=f.data[n];var H=v.children.length;const K=this._minEntries;this._chooseSplitAxis(v,K,H);if(H=this._chooseSplitIndex(v,K,H))H=v.children.splice(H,v.children.length-H),H=v.leaf?new u(H):new B(H),H.height=v.height,b(v,this._toBBox),b(H,this._toBBox),n?f.data[n-1].children.push(H):this._splitRoot(v,H)}_splitRoot(f,n){this._data=new B([f,n]);this._data.height=f.height+1;b(this._data,this._toBBox)}_chooseSplitIndex(f,n,v){let H,K,M=void 0;H=K=Infinity;for(let P=n;P<=v-n;P++){var J=
e(f,0,P,this._toBBox);const R=e(f,P,v,this._toBBox),U=Math.max(0,Math.min(J.maxX,R.maxX)-Math.max(J.minX,R.minX))*Math.max(0,Math.min(J.maxY,R.maxY)-Math.max(J.minY,R.minY));J=r(J)+r(R);U<H?(H=U,M=P,K=J<K?J:K):U===H&&J<K&&(K=J,M=P)}return M}_chooseSplitAxis(f,n,v){const H=f.leaf?this._compareMinX:l,K=f.leaf?this._compareMinY:k,M=this._allDistMargin(f,n,v,H);n=this._allDistMargin(f,n,v,K);M<n&&f.children.sort(H)}_allDistMargin(f,n,v,H){f.children.sort(H);H=this._toBBox;var K=e(f,0,n,H);const M=e(f,
v-n,v,H);let J=m(K)+m(M);for(let P=n;P<v-n;P++){const R=f.children[P];d(K,f.leaf?H(R):R);J+=m(K)}for(v=v-n-1;v>=n;v--)K=f.children[v],d(M,f.leaf?H(K):K),J+=m(M);return J}_condense(f){for(let n=f.length-1;0<=n;n--){const v=f.data[n];if(0===v.children.length)if(0<n){const H=f.data[n-1],K=H.children;K.splice(z.indexOf(K,v,K.length,H.indexHint),1)}else this.clear();else b(v,this._toBBox)}}_initFormat(f){const n=["return a"," - b",";"];this._compareMinX=new Function("a","b",n.join(f[0]));this._compareMinY=
new Function("a","b",n.join(f[1]));this._toBBox=new Function("a","return {minX: a"+f[0]+", minY: a"+f[1]+", maxX: a"+f[2]+", maxY: a"+f[3]+"};")}}const x=new c,D=new c,E=new c,I=new c({deallocator:void 0});class L{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class O extends L{constructor(){super(...arguments);this.height=1;this.indexHint=new z.PositionHint}}class u extends O{constructor(f){super();this.children=f;this.leaf=!0}}class B extends O{constructor(f){super();
this.children=f;this.leaf=!1}}y.BBox=L;y.PooledRBush=F;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/Feature":function(){define(["../../../../geometry/support/TileClipper"],function(y){var z;(function(c){c[c.moveTo=1]="moveTo";c[c.lineTo=2]="lineTo";c[c.close=7]="close"})(z||={});class C{constructor(c,g,h=0){this.values={};this._geometry=void 0;this._pbfGeometry=null;this.featureIndex=h;h=g.keys;g=g.values;for(c=c.asUnsafe();c.next();)switch(c.tag()){case 1:this.id=
c.getUInt64();break;case 2:const b=c.getMessage().asUnsafe(),e=this.values;for(;!b.empty();){const d=b.getUInt32(),l=b.getUInt32();e[h[d]]=g[l]}b.release();break;case 3:this.type=c.getUInt32();break;case 4:this._pbfGeometry=c.getMessage();break;default:c.skip()}}getGeometry(c){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const g=this._pbfGeometry.asUnsafe();this._pbfGeometry=null;let h,b;c?c.reset(this.type):h=[];let e=z.moveTo;var d=0;let l=0,k=0;for(;!g.empty();)switch(0===
d&&(d=g.getUInt32(),e=d&7,d>>=3),d--,e){case z.moveTo:l+=g.getSInt32();k+=g.getSInt32();c?c.moveTo(l,k):h&&(b&&h.push(b),b=[],b.push(new y.Point(l,k)));break;case z.lineTo:l+=g.getSInt32();k+=g.getSInt32();c?c.lineTo(l,k):b&&b.push(new y.Point(l,k));break;case z.close:c?c.close():b&&!b[0].equals(l,k)&&b.push(b[0].clone());break;default:throw g.release(),Error("Invalid path operation");}let r;c?r=c.result():h&&(b&&h.push(b),r=h);g.release();return this._geometry=r}}return C})},"esri/views/2d/engine/vectorTiles/SourceLayerData":function(){define(function(){class y{constructor(z){this.extent=
4096;this.keys=[];this.values=[];this._pbfLayer=z.clone();for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:this.name=z.getString();break;case 3:this.keys.push(z.getString());break;case 4:this.values.push(z.processMessage(y._parseValue));break;case 5:this.extent=z.getUInt32();break;default:z.skip()}}getData(){return this._pbfLayer}static _parseValue(z){for(;z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();case 3:return z.getDouble();case 4:return z.getInt64();case 5:return z.getUInt64();
case 6:return z.getSInt64();case 7:return z.getBool();default:z.skip()}return null}}return y})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(y,z,C,c,g,h,b,e,d,l,
k,r,m){function p(u){u=u?.getGeometry();if(null==u)return null;let B=Infinity,f=Infinity,n=-Infinity,v=-Infinity;for(const H of u)if(H)for(const K of H)B=Math.min(B,K.x),f=Math.min(f,K.y),n=Math.max(n,K.x),v=Math.max(v,K.y);return z.fromValues(B,f,n,v)}y.CapType=void 0;(function(u){u[u.BUTT=0]="BUTT";u[u.ROUND=1]="ROUND";u[u.SQUARE=2]="SQUARE";u[u.UNKNOWN=4]="UNKNOWN"})(y.CapType||(y.CapType={}));class q{constructor(u,B,f,n,v,H){this.layer=u;this.feature=B;this.bounds=f;this.normalizationRatio=n;
this.normalizationOffsetX=v;this.normalizationOffsetY=H}}class A{constructor(u,B,f,n){this.type=u;this.typeName=B.type;this.id=B.id;this.source=B.source;this.sourceLayer=B["source-layer"];this.minzoom=B.minzoom;this.maxzoom=B.maxzoom;this.filter=B.filter;this.layout=B.layout;this.paint=B.paint;this.z=f;this.uid=n;switch(u){case k.StyleLayerType.BACKGROUND:this._layoutDefinition=k.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=k.StyleDefinition.backgroundPaintDefinition;break;case k.StyleLayerType.FILL:this._layoutDefinition=
k.StyleDefinition.fillLayoutDefinition;this._paintDefinition=k.StyleDefinition.fillPaintDefinition;break;case k.StyleLayerType.LINE:this._layoutDefinition=k.StyleDefinition.lineLayoutDefinition;this._paintDefinition=k.StyleDefinition.linePaintDefinition;break;case k.StyleLayerType.SYMBOL:this._layoutDefinition=k.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=k.StyleDefinition.symbolPaintDefinition;break;case k.StyleLayerType.CIRCLE:this._layoutDefinition=k.StyleDefinition.circleLayoutDefinition,
this._paintDefinition=k.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=l.createFilter(this.filter)}getLayoutProperty(u){return this._layoutProperties[u]}getPaintProperty(u){return this._paintProperties[u]}getLayoutValue(u,B,f){let n;const v=this._layoutProperties[u];v&&(n=v.getValue(B,f));void 0===n&&(n=this._layoutDefinition[u]["default"]);
return n}getPaintValue(u,B,f){let n;const v=this._paintProperties[u];v&&(n=v.getValue(B,f));void 0===n&&(n=this._paintDefinition[u]["default"]);return n}isPainterDataDriven(){const u=this._paintProperties;if(u)for(const B in u)if(u[B].isDataDriven)return!0;return!1}isIntersectingFeature(u,B,f,n,v,H,K){return!1}getFeatureInflatedBounds(u,B,f,n){return null}_parseLayout(u){const B={};for(const f in u){const n=this._layoutDefinition[f];n&&(B[f]=new r(n,u[f]))}return B}_parsePaint(u){const B={};for(const f in u){const n=
this._paintDefinition[f];n&&(B[f]=new r(n,u[f]))}return B}computeAttributesKey(u,B,f,n){let v=0,H=0;for(const K of B){B=3;if(!K||K!==n){const {isLayout:M,isOptional:J}=f[K];B=M?this.getLayoutProperty(K):this.getPaintProperty(K);B=B?.interpolator?2:B?.isDataDriven?1:J&&!B?3:0}H|=B<<v;v+=2}return H<<3|u}}class F extends A{constructor(u,B,f,n){super(u,B,f,n);this.backgroundMaterial=new g.VTLBackgroundMaterial(this.computeAttributesKey(C.ShaderProgramType.BACKGROUND,g.VTLBackgroundMaterial.ATTRIBUTES,
g.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class x extends A{constructor(u,B,f,n){super(u,B,f,n);u=this.getPaintProperty("fill-color");B=this.getPaintProperty("fill-opacity");f=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=u?.isDataDriven;this.hasDataDrivenOpacity=B?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||f?.isDataDriven;B=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!B;this.hasDataDrivenOutlineColor=B?.isDataDriven;
this.hasDataDrivenOutline=B?B.isDataDriven:u?u.isDataDriven:!1;this.hasDataDrivenOutline=(B?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new b.VTLFillMaterial(this.computeAttributesKey(C.ShaderProgramType.FILL,b.VTLFillMaterial.ATTRIBUTES,b.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new b.VTLOutlineMaterial(this.computeAttributesKey(C.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?b.VTLOutlineMaterial.ATTRIBUTES_FILL:b.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,
this.outlineUsesFillColor?b.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:b.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(u,B,f,n){f=p(u);if(!f)return null;u=this.getPaintValue("fill-translate",B,u);n*=Math.max(u[0],u[1]);f[0]-=n;f[2]-=n;f[1]+=n;f[3]+=n;return f}isIntersectingFeature(u,B,f,n,v,H,K){const M=n.getGeometry();if(!M)return!1;const J=8/K.normalizationRatio;u=u/K.normalizationRatio+K.normalizationOffsetX;B=B/K.normalizationRatio+K.normalizationOffsetY;
n=c.translateAnchor(this.getPaintValue("fill-translate",v,n),this.getPaintValue("fill-translate-anchor",v,n),H,8);u-=J*n.x;B-=J*n.y;return c.pointInPolygon(u,B,M)?!0:c.distanceFromToPolylineWithinThreshold(u,B,M,J*f)}}class D extends A{constructor(u,B,f,n){super(u,B,f,n);u=this.getPaintProperty("line-pattern");this.lineMaterial=new e.VTLLineMaterial(this.computeAttributesKey(C.ShaderProgramType.LINE,e.VTLLineMaterial.ATTRIBUTES,e.VTLLineMaterial.ATTRIBUTES_INFO,u?"line-dasharray":""));this.hasDataDrivenLine=
this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&
(u=this.getPaintProperty("line-width"),!u||"number"===typeof u&&.5*u<m.thinLineHalfWidthThreshold)&&(u=this.getPaintProperty("line-offset"),!u||"number"===typeof u&&0===u)&&(this.canUseThinTessellation=!0)}getDashKey(u,B){switch(B){case y.CapType.BUTT:B="Butt";break;case y.CapType.ROUND:B="Round";break;case y.CapType.SQUARE:B="Square";break;default:B="Butt"}return`dasharray-[${u.toString()}]-${B}`}getFeatureInflatedBounds(u,B,f,n){f=p(u);if(!f)return null;var v=this.getPaintValue("line-translate",
B,u);v=n*Math.max(v[0],v[1]);f[0]-=v;f[2]-=v;f[1]+=v;f[3]+=v;v=n*Math.abs(this.getPaintValue("line-offset",B,u)||0);u=this.getPaintValue("line-width",B,u);n*=u/2;f[0]-=v+n;f[1]-=v+n;f[2]+=v+n;f[3]+=v+n;return f}isIntersectingFeature(u,B,f,n,v,H,K){let M=n.getGeometry();if(!M)return!1;const J=8/K.normalizationRatio;u=u/K.normalizationRatio+K.normalizationOffsetX;B=B/K.normalizationRatio+K.normalizationOffsetY;H=c.translateAnchor(this.getPaintValue("line-translate",v,n),this.getPaintValue("line-translate-anchor",
v,n),H,8);u-=J*H.x;B-=J*H.y;H=J*this.getPaintValue("line-offset",v,n)||0;0!==H&&(M=c.offsetLine(M,-H));n=this.getPaintValue("line-width",v,n);return c.distanceFromToPolylineWithinThreshold(u,B,M,J*(f+n/2))}}class E extends A{constructor(u,B,f,n){super(u,B,f,n);this.iconMaterial=new d.VTLIconMaterial(this.computeAttributesKey(C.ShaderProgramType.ICON,d.VTLIconMaterial.ATTRIBUTES,d.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new d.VTLTextMaterial(this.computeAttributesKey(C.ShaderProgramType.TEXT,
d.VTLTextMaterial.ATTRIBUTES,d.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class I extends A{constructor(u,B,f,n){super(u,B,f,n);this.circleMaterial=new h.VTLCircleMaterial(this.computeAttributesKey(C.ShaderProgramType.CIRCLE,h.VTLCircleMaterial.ATTRIBUTES,h.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(u,B,f,n){f=p(u);if(!f)return null;var v=
this.getPaintValue("circle-translate",B,u);v=Math.max(v[0],v[1]);f[0]-=v;f[2]-=v;f[1]+=v;f[3]+=v;u=8*(this.getPaintValue("circle-radius",B,u)+this.getPaintValue("circle-stroke-width",B,u));n*=u/2;f[0]-=n;f[1]-=n;f[2]+=n;f[3]+=n;return f}isIntersectingFeature(u,B,f,n,v,H,K){var M=n.getGeometry();if(!M)return!1;const J=8/K.normalizationRatio;u=u/K.normalizationRatio+K.normalizationOffsetX;B=B/K.normalizationRatio+K.normalizationOffsetY;f*=J;H=c.translateAnchor(this.getPaintValue("circle-translate",
v,n),this.getPaintValue("circle-translate-anchor",v,n),H,J);n=J*(this.getPaintValue("circle-radius",v,n)+this.getPaintValue("circle-stroke-width",v,n));for(const P of M)if(P)for(const R of P)if(M=R.x+H.x,v=R.y+H.y,Math.sqrt((u-M)*(u-M)+(B-v)*(B-v))-f<=n)return!0;return!1}}class L{constructor(u,B,f){this.allowOverlap=u.getLayoutValue("icon-allow-overlap",B);this.ignorePlacement=u.getLayoutValue("icon-ignore-placement",B);this.keepUpright=u.getLayoutValue("icon-keep-upright",B);this.optional=u.getLayoutValue("icon-optional",
B);this.rotationAlignment=u.getLayoutValue("icon-rotation-alignment",B);this.rotationAlignment===k.RotationAlignment.AUTO&&(this.rotationAlignment=f?k.RotationAlignment.MAP:k.RotationAlignment.VIEWPORT);f=u.getLayoutProperty("icon-anchor");f?.isDataDriven?this._anchorProp=f:this.anchor=u.getLayoutValue("icon-anchor",B);f=u.getLayoutProperty("icon-offset");f?.isDataDriven?this._offsetProp=f:this.offset=u.getLayoutValue("icon-offset",B);f=u.getLayoutProperty("icon-padding");f?.isDataDriven?this._paddingProp=
f:this.padding=u.getLayoutValue("icon-padding",B);f=u.getLayoutProperty("icon-rotate");f?.isDataDriven?this._rotateProp=f:this.rotate=u.getLayoutValue("icon-rotate",B);f=u.getLayoutProperty("icon-size");f?.isDataDriven?this._sizeProp=f:this.size=u.getLayoutValue("icon-size",B)}update(u,B){this._anchorProp&&(this.anchor=this._anchorProp.getValue(u,B));this._offsetProp&&(this.offset=this._offsetProp.getValue(u,B));this._paddingProp&&(this.padding=this._paddingProp.getValue(u,B));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(u,B));this._sizeProp&&(this.size=this._sizeProp.getValue(u,B))}}class O{constructor(u,B,f){this.allowOverlap=u.getLayoutValue("text-allow-overlap",B);this.ignorePlacement=u.getLayoutValue("text-ignore-placement",B);this.keepUpright=u.getLayoutValue("text-keep-upright",B);this.optional=u.getLayoutValue("text-optional",B);this.rotationAlignment=u.getLayoutValue("text-rotation-alignment",B);this.rotationAlignment===k.RotationAlignment.AUTO&&(this.rotationAlignment=f?k.RotationAlignment.MAP:
k.RotationAlignment.VIEWPORT);f=u.getLayoutProperty("text-anchor");f?.isDataDriven?this._anchorProp=f:this.anchor=u.getLayoutValue("text-anchor",B);f=u.getLayoutProperty("text-justify");f?.isDataDriven?this._justifyProp=f:this.justify=u.getLayoutValue("text-justify",B);f=u.getLayoutProperty("text-letter-spacing");f?.isDataDriven?this._letterSpacingProp=f:this.letterSpacing=u.getLayoutValue("text-letter-spacing",B);f=u.getLayoutProperty("text-line-height");f?.isDataDriven?this._lineHeightProp=f:this.lineHeight=
u.getLayoutValue("text-line-height",B);f=u.getLayoutProperty("text-max-angle");f?.isDataDriven?this._maxAngleProp=f:this.maxAngle=u.getLayoutValue("text-max-angle",B);f=u.getLayoutProperty("text-max-width");f?.isDataDriven?this._maxWidthProp=f:this.maxWidth=u.getLayoutValue("text-max-width",B);f=u.getLayoutProperty("text-offset");f?.isDataDriven?this._offsetProp=f:this.offset=u.getLayoutValue("text-offset",B);f=u.getLayoutProperty("text-padding");f?.isDataDriven?this._paddingProp=f:this.padding=u.getLayoutValue("text-padding",
B);f=u.getLayoutProperty("text-rotate");f?.isDataDriven?this._rotateProp=f:this.rotate=u.getLayoutValue("text-rotate",B);f=u.getLayoutProperty("text-size");f?.isDataDriven?this._sizeProp=f:this.size=u.getLayoutValue("text-size",B);f=u.getLayoutProperty("text-writing-mode");f?.isDataDriven?this._writingModeProp=f:this.writingMode=u.getLayoutValue("text-writing-mode",B)}update(u,B){this._anchorProp&&(this.anchor=this._anchorProp.getValue(u,B));this._justifyProp&&(this.justify=this._justifyProp.getValue(u,
B));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(u,B));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(u,B));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(u,B));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(u,B));this._offsetProp&&(this.offset=this._offsetProp.getValue(u,B));this._paddingProp&&(this.padding=this._paddingProp.getValue(u,B));this._rotateProp&&(this.rotate=this._rotateProp.getValue(u,B));this._sizeProp&&
(this.size=this._sizeProp.getValue(u,B));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(u,B))}}y.BackgroundStyleLayer=F;y.CircleStyleLayer=I;y.FillStyleLayer=x;y.IconLayout=L;y.IndexItem=q;y.LineStyleLayer=D;y.StyleLayer=A;y.SymbolStyleLayer=E;y.TextLayout=O;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(y,z,C,c){class g extends z.VTLMaterial{constructor(h){super(h)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES=[];g.GEOMETRY_LAYOUT=[new c.VertexElementDescriptor("a_pos",2,C.DataType.BYTE,0,2)];g.ATTRIBUTES_INFO={};y.VTLBackgroundMaterial=g;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,c,g){class h{constructor(d){this._locations=new Map;this._key=d}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(d,l,k,r,m){var p=this.getUniforms();for(const q of p){const {name:A,type:F,getValue:x}=q;p=x(k,l,r,m);if(null!==p)switch(F){case "float":d.setUniform1f(A,p);break;case "vec2":d.setUniform2fv(A,
p);break;case "vec4":d.setUniform4fv(A,p)}}}encodeAttributes(d,l,k,r){const m=this.attributesInfo(),p=this.getEncodingInfos(),q=[];let A=0,F=0;for(const D of Object.keys(p)){var x=p[D];const {type:E,precisionFactor:I,isLayout:L}=m[D],O=L?k.getLayoutProperty(D):k.getPaintProperty(D),u=O.interpolator?.getInterpolationRange(l);let B=0;for(const f of x){const {offset:n,bufferElementsToAdd:v}=f;if(0<v){for(x=0;x<v;x++)q.push(0);A+=F;F=f.bufferElementsToAdd}x=r??O.getValue(u?u[B]:l,d);switch(E){case C.EncodingType.R8_SIGNED:case C.EncodingType.R8_UNSIGNED:q[A]|=
this._encodeByte(x*(I||1),8*n);break;case C.EncodingType.R16_SIGNED:case C.EncodingType.R16_UNSIGNED:q[A]|=this._encodeShort(x*(I||1),8*n);break;case C.EncodingType.R8G8_SIGNED:case C.EncodingType.R8G8_UNSIGNED:q[A]|=this._encodeByte(x*(I||1),8*n);q[A]|=this._encodeByte(x*(I||1),8*n+8);break;case C.EncodingType.R16G16_SIGNED:case C.EncodingType.R16G16_UNSIGNED:q[A]|=this._encodeShort(x*(I||1),8*n);q[A]|=this._encodeShort(x*(I||1),8*n+16);break;case C.EncodingType.R8G8B8A8_SIGNED:case C.EncodingType.R8G8B8A8_UNSIGNED:q[A]|=
this._encodeByte(x*(I||1),8*n);q[A]|=this._encodeByte(x*(I||1),8*n+8);q[A]|=this._encodeByte(x*(I||1),8*n+16);q[A]|=this._encodeByte(x*(I||1),8*n+24);break;case C.EncodingType.R8G8B8A8_COLOR:q[A]=this._encodeColor(x);break;case C.EncodingType.R16G16B16A16_DASHARRAY:case C.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(A,q,x);break;default:throw Error("Unsupported encoding type");}B++}}return q}getAtributeState(d){const l=3+2*d;d=0|this._bit(l);return d|=this._bit(l+1)<<1}_buildAttributesInfo(){const d=
[],l={};var k={},r=-1;const m=this.attributesInfo();var p=this.attributes();let q=-1;for(const D of p){q++;p=this.getAtributeState(q);if(p===C.AttributeStatus.UNIFORM||p===C.AttributeStatus.UNUSED)continue;var A=m[D];const E=[];l[D]=E;A=A.type;for(let I=0;I<p;I++){const {dataType:L,bytesPerElement:O,count:u,normalized:B}=h._encodingInfo[A],f=O*u;var F=`${L}-${!0===B}`;let n=k[F],v=0;!n||4<n.count+u?(r++,n={dataIndex:r,count:0,offset:0},4!==u&&(k[F]=n),d.push({location:-1,name:"a_data_"+r,count:u,
type:L,normalized:B}),v=Math.ceil(Math.max(f/4,1))):(F=d[n.dataIndex],F.count+=u,v=Math.ceil(Math.max(F.count*O/4,1))-Math.ceil(Math.max(n.offset/4,1)));E.push({dataIndex:n.dataIndex,offset:n.offset,bufferElementsToAdd:v});n.offset+=f;n.count+=u}}for(const D of d)switch(D.type){case c.DataType.BYTE:case c.DataType.UNSIGNED_BYTE:D.count=4;break;case c.DataType.SHORT:case c.DataType.UNSIGNED_SHORT:D.count+=D.count%2}this._buildVertexBufferLayout(d);k=0;r=this._layoutInfo.geometry;for(var x of r)this._locations.set(x.name,
k++);if(x=this._layoutInfo.opacity)for(const D of x)this._locations.set(D.name,k++);this._buildShaderInfo(d,l);this._propertyEncodingInfo=l}_buildVertexBufferLayout(d){const l={},k=this.geometryInfo();let r=k[0].stride;if(0===d.length)l.geometry=k;else{const m=[];let p=r;for(const q of d)r+=b(q.type)*q.count;for(const q of k)m.push(new g.VertexElementDescriptor(q.name,q.count,q.type,q.offset,r,q.normalized));for(const q of d)m.push(new g.VertexElementDescriptor(q.name,q.count,q.type,p,r,q.normalized)),
p+=b(q.type)*q.count;l.geometry=m}this.opacityInfo()&&(l.opacity=this.opacityInfo());this._layoutInfo=l;this._stride=r}_buildShaderInfo(d,l){let k="\n",r="\n";const m=[];for(var p of d)k+=`attribute ${this._getType(p.count)} ${p.name};\n`;var q=this.attributes();d=this.attributesInfo();p=-1;for(const x of q){p++;const {name:D,type:E,precisionFactor:I,isLayout:L}=d[x];q=I&&1!==I?` * ${1/I}`:"";const {bytesPerElement:O,count:u}=h._encodingInfo[E];var A=B=>`a_data_${B.dataIndex}${e(u,B.offset,O)}`;switch(this.getAtributeState(p)){case C.AttributeStatus.UNIFORM:q=
this._getType(u);var F=`u_${D}`;m.push({name:F,type:q,getValue:(f,n,v,H)=>{v=L?f.getLayoutValue(x,n):f.getPaintValue(x,n);if(E===C.EncodingType.R16G16B16A16_DASHARRAY){f=f.getDashKey(v,f.getLayoutValue("line-cap",n));H=H.getMosaicItemPosition(f,!1);if(null==H)return null;const {tl:K,br:M}=H;return[K[0],M[1],M[0],K[1]]}if(E===C.EncodingType.R16G16B16A16_PATTERN){H=H.getMosaicItemPosition(v,!x.includes("line-"));if(null==H)return null;const {tl:K,br:M}=H;return[K[0],M[1],M[0],K[1]]}return E===C.EncodingType.R8G8B8A8_COLOR?
(H=v[3],[H*v[0],H*v[1],H*v[2],H]):v}});k+=`uniform ${q} ${F};\n`;r+=`${q} ${D} = ${F};\n`;break;case C.AttributeStatus.DATA_DRIVEN:F=A(l[x][0]);r+=`${this._getType(u)} ${D} = ${F}${q};\n`;break;case C.AttributeStatus.INTERPOLATED_DATA_DRIVEN:F=`u_t_${D}`;m.push({name:F,type:"float",getValue:(f,n,v,H)=>(L?f.getLayoutProperty(x):f.getPaintProperty(x)).interpolator.interpolationUniformValue(v,n)});k+=`uniform float ${F};\n`;const B=A(l[x][0]);A=A(l[x][1]);r+=`${this._getType(u)} ${D} = mix(${B}${q}, ${A}${q}, ${F});\n`}}this._shaderHeader=
k;this._shaderMain=r;this._uniforms=m}_bit(d){return(this._key&1<<d)>>d}_getType(d){switch(d){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(d){const l=255*d[3];return z.i8888to32(d[0]*l,d[1]*l,d[2]*l,l)}_encodePattern(d,l,k){if(k?.rect){var r=k.rect,m=k.width;k=k.height;l[d]=this._encodeShort(r.x+2,0);l[d]|=this._encodeShort(r.y+2+k,16);l[d+1]=this._encodeShort(r.x+2+m,0);l[d+1]|=this._encodeShort(r.y+2,16)}}_encodeByte(d,
l){return(d&255)<<l}_encodeShort(d,l){return(d&65535)<<l}}h._encodingInfo={[C.EncodingType.R8_SIGNED]:{dataType:c.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[C.EncodingType.R8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[C.EncodingType.R16_SIGNED]:{dataType:c.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[C.EncodingType.R16_UNSIGNED]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[C.EncodingType.R8G8_SIGNED]:{dataType:c.DataType.BYTE,
bytesPerElement:1,count:2,normalized:!1},[C.EncodingType.R8G8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[C.EncodingType.R16G16_SIGNED]:{dataType:c.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[C.EncodingType.R16G16_UNSIGNED]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[C.EncodingType.R8G8B8A8_SIGNED]:{dataType:c.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[C.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[C.EncodingType.R8G8B8A8_COLOR]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[C.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[C.EncodingType.R16G16B16A16_PATTERN]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const b=d=>{switch(d){case c.DataType.FLOAT:case c.DataType.INT:case c.DataType.UNSIGNED_INT:return 4;case c.DataType.SHORT:case c.DataType.UNSIGNED_SHORT:case c.DataType.HALF_FLOAT:return 2;
case c.DataType.BYTE:case c.DataType.UNSIGNED_BYTE:return 1}},e=(d,l,k)=>{l/=k;if(1===d)switch(l){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===d)switch(l){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===d)switch(l){case 0:return".xyz";case 1:return".yzw"}return""};y.VTLMaterial=h;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(y){class z{constructor(C){this._array=
[];this._stride=C}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(C,c){return 65535&C|c<<16}static i8888to32(C,c,g,h){return C&255|(c&255)<<8|(g&255)<<16|h<<24}static i8816to32(C,c,g){return C&255|(c&255)<<8|g<<16}}return z})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(y){y.EncodingType=void 0;(function(z){z[z.R8_SIGNED=0]="R8_SIGNED";z[z.R8_UNSIGNED=1]="R8_UNSIGNED";z[z.R16_SIGNED=2]="R16_SIGNED";z[z.R16_UNSIGNED=3]="R16_UNSIGNED";z[z.R8G8_SIGNED=4]="R8G8_SIGNED";z[z.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";z[z.R16G16_SIGNED=6]="R16G16_SIGNED";z[z.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";z[z.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";z[z.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";z[z.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";z[z.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
z[z.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(y.EncodingType||(y.EncodingType={}));y.AttributeStatus=void 0;(function(z){z[z.UNIFORM=0]="UNIFORM";z[z.DATA_DRIVEN=1]="DATA_DRIVEN";z[z.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";z[z.UNUSED=3]="UNUSED"})(y.AttributeStatus||(y.AttributeStatus={}));Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(y,z,C,c,g){class h extends C.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:z.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:z.EncodingType.R8_UNSIGNED,precisionFactor:32}};y.VTLCircleMaterial=h;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,c,g){class h extends C.VTLMaterial{constructor(e){super(e)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}
h.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class b extends C.VTLMaterial{constructor(e,d){super(e);this._usefillColor=d}geometryInfo(){return b.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
b.ATTRIBUTES_FILL:b.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?b.ATTRIBUTES_INFO_FILL:b.ATTRIBUTES_INFO_OUTLINE}}b.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];b.ATTRIBUTES_FILL=["fill-color","fill-opacity"];b.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,8),new g.VertexElementDescriptor("a_offset",2,c.DataType.BYTE,4,8),new g.VertexElementDescriptor("a_xnormal",2,c.DataType.BYTE,6,8)];b.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};b.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};y.VTLFillMaterial=h;y.VTLOutlineMaterial=b;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,c,g){class h extends C.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,16),new g.VertexElementDescriptor("a_extrude_offset",
4,c.DataType.BYTE,4,16),new g.VertexElementDescriptor("a_dir_normal",4,c.DataType.BYTE,8,16),new g.VertexElementDescriptor("a_accumulatedDistance",2,c.DataType.UNSIGNED_SHORT,12,16)];h.ATTRIBUTES_INFO={"line-width":{name:"width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:z.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:z.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};y.VTLLineMaterial=h;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,c,g){const h=[new g.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,16),new g.VertexElementDescriptor("a_vertexOffset",2,c.DataType.SHORT,4,16),new g.VertexElementDescriptor("a_texAngleRange",4,c.DataType.UNSIGNED_BYTE,8,16),new g.VertexElementDescriptor("a_levelInfo",4,c.DataType.UNSIGNED_BYTE,12,16)],b=[new g.VertexElementDescriptor("a_opacityInfo",1,c.DataType.UNSIGNED_BYTE,0,1)];
class e extends C.VTLMaterial{constructor(l){super(l)}geometryInfo(){return h}opacityInfo(){return b}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");e.ATTRIBUTES_INFO={"icon-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class d extends C.VTLMaterial{constructor(l){super(l)}geometryInfo(){return h}opacityInfo(){return b}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}d.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
d.ATTRIBUTES_INFO={"text-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,isLayout:!0}};y.VTLIconMaterial=
e;y.VTLTextMaterial=d;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(y,z){class C{constructor(c){this._expression=c}filter(c,g){if(!this._expression)return!0;try{return this._expression.evaluate(c,g)}catch(h){return console.log(h.message),!0}}static createFilter(c){if(!c)return null;this.isLegacyFilter(c)&&(c=this.convertLegacyFilter(c));try{const g=y.createExpression(c,
null,z.booleanType);return new C(g)}catch(g){return console.log(g.message),null}}static isLegacyFilter(c){if(!Array.isArray(c)||0===c.length)return!0;switch(c[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===c.length&&"string"===typeof c[1]&&!Array.isArray(c[2]);case "in":return 3<=c.length&&"string"===typeof c[1]&&!Array.isArray(c[2]);case "!in":return!0;case "any":case "all":for(let g=1;g<c.length;g++)if(this.isLegacyFilter(c[g]))return!0;return!1;
case "none":return!0;case "has":return 2===c.length&&("$id"===c[1]||"$type"===c[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(c){if(!Array.isArray(c)||0===c.length)return!0;const g=c[0];if(1===c.length)return"any"!==g;switch(g){case "\x3d\x3d":return C.convertComparison("\x3d\x3d",c[1],c[2]);case "!\x3d":return C.negate(C.convertComparison("\x3d\x3d",c[1],c[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return C.convertComparison(g,c[1],c[2]);case "in":return C.convertIn(c[1],
c.slice(2));case "!in":return C.negate(C.convertIn(c[1],c.slice(2)));case "any":case "all":case "none":return C.convertCombining(g,c.slice(1));case "has":return C.convertHas(c[1]);case "!has":return C.negate(C.convertHas(c[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(c,g,h){switch(g){case "$type":return[c,["geometry-type"],h];case "$id":return[c,["id"],h];default:return[c,["get",g],h]}}static convertIn(c,g){switch(c){case "$type":return["in",["geometry-type"],["literal",
g]];case "$id":return["in",["id"],["literal",g]];default:return["in",["get",c],["literal",g]]}}static convertHas(c){switch(c){case "$type":return!0;case "$id":return["has-id"];default:return["has",c]}}static convertCombining(c,g){return[c].concat(g.map(this.convertLegacyFilter))}static negate(c){return["!",c]}}return C})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(y,z,C,c,g,h,b){function e(a,t,w){var G=typeof a;if("string"===G||"boolean"===G||"number"===G||null===a){if(w)switch(w.kind){case "string":"string"!==G&&(a=aa.toString(a));break;case "number":"number"!==G&&(a=aa.toNumber(a));break;case "color":a=aa.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");G=a[0];if("string"!==typeof G)throw Error("First element of expression must be a string");const N=na[G];if(void 0===N)throw Error(`Invalid expression operator "${G}"`);
if(!N)throw Error(`Unimplemented expression operator "${G}"`);return N.parse(a,t,w)}class d{constructor(a){this._parent=a;this._vars={}}add(a,t){this._vars[a]=t}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class l{constructor(){this.type=b.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new l}evaluate(a,t){return a?.id}}class k{constructor(){this.type=b.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new k}evaluate(a,t){if(!a)return null;switch(a.type){case c.GeometryType.Point:return"Point";case c.GeometryType.LineString:return"LineString";case c.GeometryType.Polygon:return"Polygon";default:return null}}}class r{constructor(){this.type=b.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new r}evaluate(a,t){return a?.values}}class m{constructor(){this.type=b.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new m}evaluate(a,t){return t}}class p{constructor(a,t,w){this._lhs=a;this._rhs=t;this._compare=w;this.type=b.booleanType}static parse(a,t,w){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new p(e(a[1],t),e(a[2],t),w)}evaluate(a,t){return this._compare(this._lhs.evaluate(a,t),this._rhs.evaluate(a,t))}}class q extends p{static parse(a,t){return p.parse(a,t,(w,G)=>w===G)}}class A extends p{static parse(a,
t){return p.parse(a,t,(w,G)=>w!==G)}}class F extends p{static parse(a,t){return p.parse(a,t,(w,G)=>w<G)}}class x extends p{static parse(a,t){return p.parse(a,t,(w,G)=>w<=G)}}class D extends p{static parse(a,t){return p.parse(a,t,(w,G)=>w>G)}}class E extends p{static parse(a,t){return p.parse(a,t,(w,G)=>w>=G)}}class I{constructor(a){this._arg=a;this.type=b.booleanType}static parse(a,t){if(2!==a.length)throw Error('"!" expects 1 argument');return new I(e(a[1],t))}evaluate(a,t){return!this._arg.evaluate(a,
t)}}class L{constructor(a){this._args=a;this.type=b.booleanType}static parse(a,t){const w=[];for(let G=1;G<a.length;G++)w.push(e(a[G],t));return new L(w)}evaluate(a,t){for(const w of this._args)if(!w.evaluate(a,t))return!1;return!0}}class O{constructor(a){this._args=a;this.type=b.booleanType}static parse(a,t){const w=[];for(let G=1;G<a.length;G++)w.push(e(a[G],t));return new O(w)}evaluate(a,t){for(const w of this._args)if(w.evaluate(a,t))return!0;return!1}}class u{constructor(a){this._args=a;this.type=
b.booleanType}static parse(a,t){const w=[];for(let G=1;G<a.length;G++)w.push(e(a[G],t));return new u(w)}evaluate(a,t){for(const w of this._args)if(w.evaluate(a,t))return!1;return!0}}class B{constructor(a,t,w){this.type=a;this._args=t;this._fallback=w}static parse(a,t,w){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let G;const N=[];for(let Q=1;Q<a.length-1;Q+=2){const T=e(a[Q],t),S=e(a[Q+1],t,w);G||(G=S.type);
N.push({condition:T,output:S})}a=e(a[a.length-1],t,w);G||(G=a.type);return new B(G,N,a)}evaluate(a,t){for(const w of this._args)if(w.condition.evaluate(a,t))return w.output.evaluate(a,t);return this._fallback.evaluate(a,t)}}class f{constructor(a,t){this.type=a;this._args=t}static parse(a,t){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let w;const G=[];for(let N=1;N<a.length;N++){const Q=e(a[N],t);w||(w=Q.type);G.push(Q)}return new f(w,G)}evaluate(a,t){for(const w of this._args){const G=
w.evaluate(a,t);if(null!==G)return G}return null}}class n{constructor(a,t,w,G,N){this.type=a;this._input=t;this._labels=w;this._outputs=G;this._fallback=N}static parse(a,t){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let w;const G=e(a[1],t),N=[],Q={};let T;for(let ba=2;ba<a.length-1;ba+=2){var S=a[ba];Array.isArray(S)||(S=[S]);for(const fa of S){S=typeof fa;if("string"!==S&&"number"!==S)throw Error('"match" requires string or number literal as labels');
if(!T)T=S;else if(S!==T)throw Error('"match" requires labels to have the same type');Q[fa]=N.length}S=e(a[ba+1],t);w||(w=S.type);N.push(S)}return new n(w,G,Q,N,e(a[a.length-1],t))}evaluate(a,t){const w=this._input.evaluate(a,t);return(this._outputs[this._labels[w]]||this._fallback).evaluate(a,t)}}class v{constructor(a,t,w,G,N){this._operator=a;this.type=t;this.interpolation=w;this.input=G;this._stops=N}static parse(a,t,w){const G=a[0];if(5>a.length)throw Error(`"${G}" expects at least 4 arguments`);
const N=a[1];if(!Array.isArray(N)||0===N.length)throw Error(`"${N}" is not a valid interpolation`);switch(N[0]){case "linear":if(1!==N.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==N.length||"number"!==typeof N[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==N.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var Q=1;5>Q;Q++){var T=
N[Q];if("number"!==typeof T||0>T||1<T)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${N[0]}"`);}if(1!==a.length%2)throw Error(`"${G}" expects an even number of arguments`);Q=e(a[2],t,b.numberType);let S;"interpolate-hcl"===G||"interpolate-lab"===G?S=b.colorType:w&&"value"!==w.kind&&(S=w);w=[];for(T=3;T<a.length;T+=2){const ba=a[T];if("number"!==typeof ba)throw Error(`"${G}" requires stop inputs as literal numbers`);
if(w.length&&w[w.length-1][0]>=ba)throw Error(`"${G}" requires strictly ascending stop inputs`);const fa=e(a[T+1],t,S);S||(S=fa.type);w.push([ba,fa])}if(S&&S!==b.colorType&&S!==b.numberType&&("array"!==S.kind||S.itemType!==b.numberType))throw Error(`"${G}" cannot interpolate type ${b.typeToString(S)}`);return new v(G,S,N,Q,w)}evaluate(a,t){var w=this._stops;if(1===w.length)return w[0][1].evaluate(a,t);var G=this.input.evaluate(a,t);if(G<=w[0][0])return w[0][1].evaluate(a,t);if(G>=w[w.length-1][0])return w[w.length-
1][1].evaluate(a,t);let N=0;for(;++N<w.length&&!(G<w[N][0]););const Q=v.interpolationRatio(this.interpolation,G,w[N-1][0],w[N][0]);G=w[N-1][1].evaluate(a,t);const T=w[N][1].evaluate(a,t);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(G)&&Array.isArray(T))return G.map((S,ba)=>h.interpolate(S,T[ba],Q));if("color"===this.type.kind&&G instanceof z&&T instanceof z)return G=new z(G),a=new z(T),new z([h.interpolate(G.r,a.r,Q),h.interpolate(G.g,a.g,Q),h.interpolate(G.b,a.b,
Q),h.interpolate(G.a,a.a,Q)]);if("number"===this.type.kind&&"number"===typeof G&&"number"===typeof T)return h.interpolate(G,T,Q);throw Error(`"${this._operator}" cannot interpolate type ${b.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=C.toLCH(G),t=C.toLCH(T),w=t.h-a.h,a=C.toRGB({h:a.h+Q*(180<w||-180>w?w-360*Math.round(w/360):w),c:h.interpolate(a.c,t.c,Q),l:h.interpolate(a.l,t.l,Q)}),new z({a:h.interpolate(G.a,T.a,Q),...a});if("interpolate-lab"===this._operator)return a=
C.toLAB(G),t=C.toLAB(T),a=C.toRGB({l:h.interpolate(a.l,t.l,Q),a:h.interpolate(a.a,t.a,Q),b:h.interpolate(a.b,t.b,Q)}),new z({a:h.interpolate(G.a,T.a,Q),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,t){const w=this._stops;if(1===w.length||a>=w[w.length-1][0])return 0;let G=0;for(;++G<w.length&&!(a<w[G][0]););return v.interpolationRatio(this.interpolation,t,w[G-1][0],w[G][0])}getInterpolationRange(a){const t=this._stops;if(1===t.length)return a=t[0][0],[a,
a];var w=t[t.length-1][0];if(a>=w)return[w,w];for(w=0;++w<t.length&&!(a<t[w][0]););return[t[w-1][0],t[w][0]]}static interpolationRatio(a,t,w,G){let N=0;"linear"===a[0]?N=v._exponentialInterpolationRatio(t,1,w,G):"exponential"===a[0]?N=v._exponentialInterpolationRatio(t,a[1],w,G):"cubic-bezier"===a[0]&&(N=g.unitBezier(a[1],a[2],a[3],a[4])(v._exponentialInterpolationRatio(t,1,w,G),1E-5));0>N?N=0:1<N&&(N=1);return N}static _exponentialInterpolationRatio(a,t,w,G){G-=w;if(0===G)return 0;a-=w;return 1===
t?a/G:(t**a-1)/(t**G-1)}}class H{constructor(a,t,w){this.type=a;this._input=t;this._stops=w}static parse(a,t){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const w=e(a[1],t,b.numberType);let G;const N=[];N.push([-Infinity,e(a[2],t)]);for(let Q=3;Q<a.length;Q+=2){const T=a[Q];if("number"!==typeof T)throw Error('"step" requires stop inputs as literal numbers');if(N.length&&N[N.length-1][0]>=T)throw Error('"step" requires strictly ascending stop inputs');
const S=e(a[Q+1],t);G||(G=S.type);N.push([T,S])}return new H(G,w,N)}evaluate(a,t){const w=this._stops;if(1===w.length)return w[0][1].evaluate(a,t);const G=this._input.evaluate(a,t);let N=0;for(;++N<w.length&&!(G<w[N][0]););return this._stops[N-1][1].evaluate(a,t)}}class K{constructor(a,t){this.type=a;this._output=t}static parse(a,t,w){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const G=new d(t);for(let N=
1;N<a.length-1;N+=2){const Q=a[N];if("string"!==typeof Q)throw Error(`"let" requires a string to define variable names - found ${Q}`);G.add(Q,e(a[N+1],t))}a=e(a[a.length-1],G,w);return new K(a.type,a)}evaluate(a,t){return this._output.evaluate(a,t)}}class M{constructor(a,t){this.type=a;this.output=t}static parse(a,t,w){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');t=t.get(a[1]);if(!t)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new M(w||b.valueType,t)}evaluate(a,t){return this.output.evaluate(a,t)}}class J{constructor(a,t,w){this.type=a;this._index=t;this._array=w}static parse(a,t){if(3!==a.length)throw Error('"at" expects 2 arguments');const w=e(a[1],t,b.numberType);a=e(a[2],t);return new J(a.type.itemType,w,a)}evaluate(a,t){const w=this._index.evaluate(a,t);a=this._array.evaluate(a,t);if(0>w||w>=a.length)throw Error('"at" index out of bounds');if(w!==Math.floor(w))throw Error('"at" index must be an integer');return a[w]}}
class P{constructor(a,t){this._key=a;this._obj=t;this.type=b.valueType}static parse(a,t){let w;switch(a.length){case 2:return w=e(a[1],t),new P(w);case 3:return w=e(a[1],t),a=e(a[2],t),new P(w,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,t){const w=this._key.evaluate(a,t);return this._obj?this._obj.evaluate(a,t)[w]:a?.values[w]}}class R{constructor(a,t){this._key=a;this._obj=t;this.type=b.booleanType}static parse(a,t){let w;switch(a.length){case 2:return w=e(a[1],t),new R(w);
case 3:return w=e(a[1],t),a=e(a[2],t),new R(w,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,t){const w=this._key.evaluate(a,t);return this._obj?(a=this._obj.evaluate(a,t),w in a):!!a?.values[w]}}class U{constructor(a,t){this._key=a;this._vals=t;this.type=b.booleanType}static parse(a,t){if(3!==a.length)throw Error('"in" expects 2 arguments');return new U(e(a[1],t),e(a[2],t))}evaluate(a,t){const w=this._key.evaluate(a,t);return this._vals.evaluate(a,t).includes(w)}}class Z{constructor(a,
t,w){this._item=a;this._array=t;this._from=w;this.type=b.numberType}static parse(a,t){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const w=e(a[1],t),G=e(a[2],t);return 4===a.length?(a=e(a[3],t,b.numberType),new Z(w,G,a)):new Z(w,G)}evaluate(a,t){const w=this._item.evaluate(a,t),G=this._array.evaluate(a,t);if(this._from){a=this._from.evaluate(a,t);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return G.indexOf(w,a)}return G.indexOf(w)}}class W{constructor(a){this._arg=
a;this.type=b.numberType}static parse(a,t){if(2!==a.length)throw Error('"length" expects 2 arguments');a=e(a[1],t);return new W(a)}evaluate(a,t){a=this._arg.evaluate(a,t);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class Y{constructor(a,t,w,G){this.type=a;this._array=t;this._from=w;this._to=G}static parse(a,t){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const w=e(a[1],t),G=e(a[2],t,b.numberType);if(G.type!==
b.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=e(a[3],t,b.numberType);if(a.type!==b.numberType)throw Error('"slice" index must return a number');return new Y(w.type,w,G,a)}return new Y(w.type,w,G)}evaluate(a,t){const w=this._array.evaluate(a,t);if(!Array.isArray(w)&&"string"!==typeof w)throw Error('"slice" input must be an array or a string');const G=this._from.evaluate(a,t);if(0>G||G>=w.length)throw Error('"slice" index out of bounds');if(G!==Math.floor(G))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,t);if(0>a||a>=w.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return w.slice(G,a)}return w.slice(G)}}class ca{constructor(){this.type=b.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new ca}evaluate(a,t){return void 0!==a?.id}}class X{constructor(a,t){this._args=a;this._calculate=t;this.type=b.numberType}static parse(a,t,w){a=a.slice(1).map(G=>
e(G,t));return new X(a,w)}evaluate(a,t){let w;this._args&&(w=this._args.map(G=>G.evaluate(a,t)));return this._calculate(w)}}class oa extends X{static parse(a,t){switch(a.length){case 2:return X.parse(a,t,w=>-w[0]);case 3:return X.parse(a,t,w=>w[0]-w[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends X{static parse(a,t){return X.parse(a,t,w=>{let G=1;for(const N of w)G*=N;return G})}}class qa extends X{static parse(a,t){if(3===a.length)return X.parse(a,t,w=>w[0]/w[1]);throw Error('"/" expects 2 arguments');
}}class ra extends X{static parse(a,t){if(3===a.length)return X.parse(a,t,w=>w[0]%w[1]);throw Error('"%" expects 2 arguments');}}class sa extends X{static parse(a,t){if(3===a.length)return X.parse(a,t,w=>w[0]**w[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends X{static parse(a,t){return X.parse(a,t,w=>{let G=0;for(const N of w)G+=N;return G})}}class V{constructor(a,t){this._args=a;this._calculate=t;this.type=b.numberType}static parse(a,t){const w=a.slice(1).map(G=>e(G,t));return new V(w,
V.ops[a[0]])}evaluate(a,t){let w;this._args&&(w=this._args.map(G=>G.evaluate(a,t)));return this._calculate(w)}}V.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=b.stringType}static parse(a,t){return new ha(a.slice(1).map(w=>e(w,t)))}evaluate(a,t){return this._args.map(w=>w.evaluate(a,t)).join("")}}class ea{constructor(a,t){this._arg=a;this._calculate=t;this.type=b.stringType}static parse(a,t){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);t=e(a[1],t);return new ea(t,ea.ops[a[0]])}evaluate(a,t){return this._calculate(this._arg.evaluate(a,t))}}ea.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=b.colorType}static parse(a,t){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(w=>e(w,t));return new ia(a)}evaluate(a,t){const w=this._validate(this._args[0].evaluate(a,t)),G=this._validate(this._args[1].evaluate(a,t));a=this._validate(this._args[2].evaluate(a,t));return new z({r:w,g:G,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=b.colorType}static parse(a,t){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(w=>e(w,t));return new ja(a)}evaluate(a,t){const w=this._validate(this._args[0].evaluate(a,t)),G=this._validate(this._args[1].evaluate(a,t)),N=this._validate(this._args[2].evaluate(a,t));a=this._validateAlpha(this._args[3].evaluate(a,t));return new z({r:w,g:G,b:N,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=b.arrayType(b.numberType,4)}static parse(a,t){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=e(a[1],t);return new ka(a)}evaluate(a,t){return(new z(this._color.evaluate(a,t))).toRgba()}}class da{constructor(a,t){this.type=a;this._args=t}static parse(a,t){var w=a[0];if(2>a.length)throw Error(`${w} expects at least one argument`);
let G=1,N;if("array"===w){if(2<a.length){switch(a[1]){case "string":N=b.stringType;break;case "number":N=b.numberType;break;case "boolean":N=b.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}G++}else N=b.valueType;if(3<a.length){var Q=a[2];if(null!==Q&&("number"!==typeof Q||0>Q||Q!==Math.floor(Q)))throw Error('"array" length argument must be a positive integer literal');G++}N=b.arrayType(N,Q)}else switch(w){case "string":N=b.stringType;break;case "number":N=
b.numberType;break;case "boolean":N=b.booleanType;break;case "object":N=b.objectType}for(w=[];G<a.length;G++)Q=e(a[G],t),w.push(Q);return new da(N,w)}evaluate(a,t){let w;for(const G of this._args){const N=G.evaluate(a,t);w=b.getType(N);if(b.matchType(w,this.type))return N}throw Error(`Expected ${b.typeToString(this.type)} but got ${b.typeToString(w)}`);}}class aa{constructor(a,t){this.type=a;this._args=t}static parse(a,t){var w=a[0];const G=aa.types[w];if(G===b.booleanType||G===b.stringType){if(2!==
a.length)throw Error(`${w} expects one argument`);}else if(2>a.length)throw Error(`${w} expects at least one argument`);w=[];for(let N=1;N<a.length;N++){const Q=e(a[N],t);w.push(Q)}return new aa(G,w)}evaluate(a,t){if(this.type===b.booleanType)return!!this._args[0].evaluate(a,t);if(this.type===b.stringType)return b.valueToString(this._args[0].evaluate(a,t));if(this.type===b.numberType){for(const G of this._args){var w=Number(G.evaluate(a,t));if(!isNaN(w))return w}return null}if(this.type===b.colorType){for(w of this._args)try{const G=
aa.toColor(w.evaluate(a,t));if(G instanceof z)return G}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return b.valueToString(a)}static toNumber(a){const t=Number(a);if(isNaN(t))throw Error(`"${a}" is not a number`);return t}static toColor(a){if(a instanceof z)return a;if("string"===typeof a){const t=z.fromString(a);if(t)return t;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return z.fromArray(a);throw Error(`"${a}" is not a color`);}}aa.types={"to-boolean":b.booleanType,
"to-color":b.colorType,"to-number":b.numberType,"to-string":b.stringType};class la{constructor(a){this._val=a;this.type=b.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,t){return this._val}}class ma{constructor(a){this._arg=a;this.type=b.stringType}static parse(a,t){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(e(a[1],t))}evaluate(a,t){return b.typeToString(b.getType(this._arg.evaluate(a,t)))}}const na=
{array:da,boolean:da,collator:null,format:null,image:null,literal:la,number:da,"number-format":null,object:da,string:da,"to-boolean":aa,"to-color":aa,"to-number":aa,"to-string":aa,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":k,id:l,"line-progress":null,properties:r,at:J,get:P,has:R,in:U,"index-of":Z,length:W,slice:Y,"!":I,"!\x3d":A,"\x3c":F,"\x3c\x3d":x,"\x3d\x3d":q,"\x3e":D,"\x3e\x3d":E,all:L,any:O,case:B,coalesce:f,match:n,within:null,interpolate:v,"interpolate-hcl":v,"interpolate-lab":v,
step:H,let:K,var:M,concat:ha,downcase:ea,"is-supported-script":null,"resolved-locale":null,upcase:ea,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:V,acos:V,asin:V,atan:V,ceil:V,cos:V,e:V,floor:V,ln:V,ln2:V,log10:V,log2:V,max:V,min:V,pi:V,round:V,sin:V,sqrt:V,tan:V,zoom:m,"heatmap-density":null,"has-id":ca,none:u};y.ALL=L;y.ANY=O;y.Add=ta;y.Assert=da;y.At=J;y.Calculate=V;y.Case=B;y.Coalesce=f;y.Coerce=aa;y.Concat=ha;y.Div=qa;y.EQ=q;y.GE=E;y.GT=D;y.GeomType=k;y.Get=P;y.Has=
R;y.HasID=ca;y.ID=l;y.In=U;y.IndexOf=Z;y.Interpolate=v;y.LE=x;y.LT=F;y.Length=W;y.Let=K;y.Literal=la;y.Match=n;y.Mod=ra;y.Mul=pa;y.NE=A;y.NONE=u;y.NOT=I;y.Pow=sa;y.Properties=r;y.Rgb=ia;y.Rgba=ja;y.Slice=Y;y.Step=H;y.String=ea;y.Sub=oa;y.ToRgba=ka;y.TypeOf=ma;y.Var=M;y.Zoom=m;y.createExpression=e;y.ops=na;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(y,z){function C(q,
A){return{kind:"array",itemType:q,n:A}}function c(q){if("array"===q.kind){const A=c(q.itemType);return"number"===typeof q.n?`array<${A}, ${q.n}>`:"value"===q.itemType.kind?"array":`array<${A}>`}return q.kind}function g(q){if(null===q)return b;if("string"===typeof q)return d;if("boolean"===typeof q)return l;if("number"===typeof q)return e;if(q instanceof z)return k;if(Array.isArray(q)){let A;for(const F of q){const x=g(F);if(!A)A=x;else if(A!==x){A=m;break}}return C(A||m,q.length)}return"object"===
typeof q?r:m}function h(q,A){if("array"===A.kind)return"array"===q.kind&&(0===q.n&&"value"===q.itemType.kind||h(q.itemType,A.itemType))&&("number"!==typeof A.n||A.n===q.n);if("value"===A.kind)for(const F of p)if(h(q,F))return!0;return A.kind===q.kind}const b={kind:"null"},e={kind:"number"},d={kind:"string"},l={kind:"boolean"},k={kind:"color"},r={kind:"object"},m={kind:"value"},p=[b,e,d,l,k,r,C(m)];y.arrayType=C;y.booleanType=l;y.colorType=k;y.getType=g;y.matchType=h;y.nullType=b;y.numberType=e;y.objectType=
r;y.stringType=d;y.typeToString=c;y.valueToString=function(q){if(null===q)return"";const A=typeof q;return"string"===A?q:"number"===A||"boolean"===A?String(q):q instanceof z?q.toString():JSON.stringify(q)};y.valueType=m;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(y,z,C,c){class g{constructor(h,b){this.isDataDriven=
!1;this.interpolator=null;switch(h.type){case "number":var e=!0;break;case "color":e=!0;break;case "array":e="number"===h.value;break;default:e=!1}null==b&&(b=h.default);if(Array.isArray(b)&&0<b.length&&C.ops[b[0]]){e={number:c.numberType,color:c.colorType,string:c.stringType,boolean:c.booleanType,enum:c.stringType};try{var d="array"===h.type?c.arrayType(e[h.value]||c.valueType,h.length):e[h.type];const l=C.createExpression(b,null,d);this.getValue=this._buildExpression(l,h);this.isDataDriven=!0;l instanceof
C.Interpolate&&l.input instanceof C.Zoom&&(this.interpolator=l)}catch(l){console.log(l.message),this.getValue=this._buildSimple(h.default)}}else{e&&"interval"===b.type&&(e=!1);if(d=b?.stops&&0<b.stops.length)for(const l of b.stops)l[1]=this._validate(l[1],h);if(this.isDataDriven=b?!!b.property:!1)if(void 0!==b.default&&(b.default=this._validate(b.default,h)),d)switch(b.type){case "identity":this.getValue=this._buildIdentity(b,h);break;case "categorical":this.getValue=this._buildCategorical(b,h);break;
default:this.getValue=e?this._buildInterpolate(b,h):this._buildInterval(b,h)}else this.getValue=this._buildIdentity(b,h);else d?this.getValue=e?this._buildZoomInterpolate(b):this._buildZoomInterval(b):(b=this._validate(b,h),this.getValue=this._buildSimple(b))}}_validate(h,b){if("number"===b.type){if(null!=b.minimum&&h<b.minimum)return b.minimum;if(null!=b.maximum&&h>b.maximum)return b.maximum}else"color"===b.type?h=g._parseColor(h):"enum"===b.type?"string"===typeof h&&(h=b.values.indexOf(h)):"array"===
b.type&&"enum"===b.value?h=h.map(e=>"string"===typeof e?b.values.indexOf(e):e):"string"===b.type&&(h=c.valueToString(h));return h}_buildSimple(h){return()=>h}_buildExpression(h,b){return(e,d)=>{try{const l=h.evaluate(d,e);return void 0===l?b.default:this._validate(l,b)}catch(l){return console.log(l.message),b.default}}}_buildIdentity(h,b){return(e,d)=>{let l;d&&(l=d.values[h.property]);void 0!==l&&(l=this._validate(l,b));return null!=l?l:void 0!==h.default?h.default:b.default}}_buildCategorical(h,
b){return(e,d)=>{let l;d&&(l=d.values[h.property]);l=this._categorical(l,h.stops);return void 0!==l?l:void 0!==h.default?h.default:b.default}}_buildInterval(h,b){return(e,d)=>{let l;d&&(l=d.values[h.property]);return"number"===typeof l?this._interval(l,h.stops):void 0!==h.default?h.default:b.default}}_buildInterpolate(h,b){return(e,d)=>{let l;d&&(l=d.values[h.property]);return"number"===typeof l?this._interpolate(l,h.stops,h.base||1):void 0!==h.default?h.default:b.default}}_buildZoomInterpolate(h){return b=>
this._interpolate(b,h.stops,h.base||1)}_buildZoomInterval(h){return b=>this._interval(b,h.stops)}_categorical(h,b){const e=b.length;for(let d=0;d<e;d++)if(b[d][0]===h)return b[d][1]}_interval(h,b){const e=b.length;let d=0;for(let l=0;l<e;l++)if(b[l][0]<=h)d=l;else break;return b[d][1]}_interpolate(h,b,e){const d=b.length;for(let r=0;r<d;r++){const m=b[r];if(m[0]<=h)var l=m;else{var k=m;break}}if(l&&k){b=k[0]-l[0];h-=l[0];e=1===e?h/b:(e**h-1)/(e**b-1);if(Array.isArray(l[1])){l=l[1];k=k[1];h=[];for(b=
0;b<l.length;b++)h.push(z.interpolate(l[b],k[b],e));return h}return z.interpolate(l[1],k[1],e)}if(l)return l[1];if(k)return k[1]}static _isEmpty(h){for(const b in h)if(h.hasOwnProperty(b))return!1;return!0}static _parseColor(h){if(Array.isArray(h))return h;"string"===typeof h&&(h=new y(h));if(h instanceof y&&!this._isEmpty(h))return y.toUnitRGBA(h)}}return g})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(y,z){class C{constructor(c){this._style=
c;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;c.layers||(c.layers=[]);this.version=parseFloat(c.version);if(this.layers=c.layers.map((g,h,b)=>this._create(g,h,b)).filter(g=>!!g))for(c=0;c<this.layers.length;c++){const g=this.layers[c];this._layerByName[g.id]=g;this._uidToLayer.set(g.uid,g);g.type===y.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(g.id)}this._identifyRefLayers()}isPainterDataDriven(c){return(c=this._layerByName[c])?c.isPainterDataDriven():
!1}getStyleLayerId(c){return c>=this.layers.length?null:this.layers[c].id}getStyleLayerByUID(c){return this._uidToLayer.get(c)??null}getStyleLayerIndex(c){return(c=this._layerByName[c])?this.layers.indexOf(c):-1}setStyleLayer(c,g){if(c?.id){var h=this._style;null!=g&&g>=this.layers.length&&(g=this.layers.length-1);var b=!0,e;if(e=this._layerByName[c.id]){const d=this.layers.indexOf(e);g||=d;g===d?(b=!1,e=C._recreateLayer(c,e),this.layers[g]=e,h.layers[g]=c):(this.layers.splice(d,1),h.layers.splice(d,
1),e=this._create(c,g,this.layers),this.layers.splice(g,0,e),h.layers.splice(g,0,c))}else e=this._create(c,g,this.layers),!g||g>=this.layers.length?(this.layers.push(e),h.layers.push(c)):(this.layers.splice(g,0,e),h.layers.splice(g,0,c));this._layerByName[c.id]=e;this._uidToLayer.set(e.uid,e);b&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(c){return(c=this._layerByName[c])?{type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,
filter:c.filter,layout:c.layout,paint:c.paint}:null}deleteStyleLayer(c){const g=this._layerByName[c];g&&(delete this._layerByName[c],this._uidToLayer.delete(g.uid),c=this.layers.indexOf(g),this.layers.splice(c,1),this._style.layers.splice(c,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(c){return this._layerByName[c]}getLayoutProperties(c){return(c=this._layerByName[c])?c.layout:null}getPaintProperties(c){return(c=this._layerByName[c])?c.paint:null}setPaintProperties(c,g){if(c=
this._layerByName[c]){var h=C._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:c.layout,paint:g},c),b=this.layers.indexOf(c);this.layers[b]=h;this._style.layers[b].paint=g;this._layerByName[c.id]=h;this._uidToLayer.set(c.uid,h)}}setLayoutProperties(c,g){if(c=this._layerByName[c]){var h=C._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,
filter:c.filter,layout:g,paint:c.paint},c),b=this.layers.indexOf(c);this.layers[b]=h;this._style.layers[b].layout=g;this._layerByName[c.id]=h;this._uidToLayer.set(c.uid,h)}}setStyleLayerVisibility(c,g){if(c=this._layerByName[c]){var h=c.layout||{};h.visibility=g;g=C._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:h,paint:c.paint},c);var b=this.layers.indexOf(c);this.layers[b]=g;this._style.layers[b].layout=
h;this._layerByName[c.id]=g;this._uidToLayer.set(c.uid,g)}}getStyleLayerVisibility(c){return(c=this._layerByName[c])?c.layout?.visibility??"visible":"none"}_recomputeZValues(){const c=this.layers,g=1/(c.length+1);for(let h=0;h<c.length;h++)c[h].z=1-(1+h)*g}_identifyRefLayers(){const c=[],g=[];let h=0;for(const d of this.layers){const l=d.layout;if(d.type===y.StyleLayerType.FILL){var b=d,e=d.source+"|"+d.sourceLayer;e+="|"+(l?.visibility??"");e+="|"+d.minzoom;e+="|"+d.maxzoom;e+="|"+JSON.stringify(d.filter);
if(b.hasDataDrivenFill||b.hasDataDrivenOutline)e+="|"+h;c.push({key:e,layer:d})}else if(d.type===y.StyleLayerType.LINE){b=d;e=d.paint;e=null!=e&&(null!=e["line-pattern"]||null!=e["line-dasharray"]);let k=d.source+"|"+d.sourceLayer;k+="|"+(l?.visibility??"");k+="|"+d.minzoom;k+="|"+d.maxzoom;k+="|"+JSON.stringify(d.filter);k+="|"+(void 0!==l?l["line-cap"]:"");k+="|"+(void 0!==l?l["line-join"]:"");if(b.hasDataDrivenLine||e)k+="|"+h;g.push({key:k,layer:d})}++h}this._assignRefLayers(c);this._assignRefLayers(g)}_assignRefLayers(c){c.sort((l,
k)=>l.key<k.key?-1:l.key>k.key?1:0);let g,h;const b=c.length;for(let l=0;l<b;l++){const k=c[l];if(k.key===g)k.layer.refLayerId=h;else if(g=k.key,h=k.layer.id,k.layer.type===y.StyleLayerType.FILL){if(!k.layer.getPaintProperty("fill-outline-color"))for(var e=l+1;e<b;e++){var d=c[e];if(d.key===g){if(d.layer.getPaintProperty("fill-outline-color")){c[l]=d;c[e]=k;h=d.layer.id;break}}else break}}else if(k.layer.type===y.StyleLayerType.LINE)for(e=k.layer,d=l+1;d<b;d++){const r=c[d];if(r.key!==g)break;const m=
r.layer;if(e.canUseThinTessellation&&!m.canUseThinTessellation||!e.canUseThinTessellation&&(m.getPaintProperty("line-pattern")||m.getPaintProperty("line-dasharray")))e=m,c[l]=r,c[d]=k,h=r.layer.id}}}_create(c,g,h){g=1-1/(h.length+1)*(1+g);h=this._runningId++;switch(c.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,c,g,h);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,c,g,h);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,c,g,h);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
c,g,h);case "raster":console.warn(`Unsupported vector tile raster layer ${c.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,c,g,h)}return null}static _recreateLayer(c,g){switch(c.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,c,g.z,g.uid);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,c,g.z,g.uid);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,c,g.z,g.uid);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
c,g.z,g.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${c.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,c,g.z,g.uid)}return null}}return C})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(y,z,C,c,g,h,b,e,d,l,k,r,m,p,q,A,F){const x=C.ofType({key:"type",base:null,typeMap:{rect:p,path:A,geometry:q}});y.LayerView2DMixin=D=>{D=class extends D{constructor(){super(...arguments);this.attached=!1;this.clips=new x;this.highlightOptions=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const E=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&E&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new g("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new r.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([h.watch(()=>this.suspended,I=>{this.container&&(this.container.visible=!I)},h.syncAndInitial),h.watch(()=>this.updateSuspended,I=>{this.view&&!I&&this.updateRequested&&this.view.requestUpdate()},h.syncAndInitial),h.watch(()=>this.layer?.opacity??
1,I=>{this.container&&(this.container.opacity=I)},h.syncAndInitial),h.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",I=>{this.container&&(this.container.blendMode=I)},h.syncAndInitial),h.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,I=>{this.container&&(this.container.effect=I)},h.syncAndInitial),h.watch(()=>this.highlightOptions,I=>this.container.highlightOptions=I,h.syncAndInitial),h.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},h.syncAndInitial),h.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:I,scaleRange:L})=>{I=F.isInEffectiveScaleRange(L,I);I!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=I)},h.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(I=>{I===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const E=this.view?.spatialReference;return null==E||this.supportsSpatialReference(E)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,
this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(E){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",E),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(E)))}hitTest(E,I){return Promise.resolve(null)}supportsSpatialReference(E){return!0}canResume(){return this.spatialReferenceSupported?
super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const E=super.getSuspendInfo(),I=!this.spatialReferenceSupported;I&&(E.spatialReferenceNotSupported=I);return E}addAttachHandles(E){this.addHandles(E,"attach")}};z.__decorate([b.property()],D.prototype,"attached",void 0);z.__decorate([b.property({type:x,set(E){E=c.referenceSetter(E,this._get("clips"),x);this._set("clips",E)}})],D.prototype,"clips",void 0);z.__decorate([b.property()],D.prototype,"container",void 0);z.__decorate([b.property({type:m})],
D.prototype,"highlightOptions",void 0);z.__decorate([b.property()],D.prototype,"moving",void 0);z.__decorate([b.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);z.__decorate([b.property({readOnly:!0})],D.prototype,"updateParameters",void 0);z.__decorate([b.property()],D.prototype,"updateRequested",void 0);z.__decorate([b.property()],D.prototype,"updating",null);z.__decorate([b.property()],D.prototype,"view",void 0);z.__decorate([b.property()],D.prototype,"_visibleAtCurrentScale",
void 0);z.__decorate([b.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",null);return D=z.__decorate([k.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(y,
z,C,c,g,h,b){var e;C=e=class extends b{constructor(d){super(d);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new e({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"left",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],
C.prototype,"right",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"top",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"bottom",void 0);return C=e=y.__decorate([h.subclass("esri.views.layers.support.ClipRect")],C)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(y,z,C,c,g,h,b){z=class extends z.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};y.__decorate([C.property({readOnly:!0})],z.prototype,"version",null);return z=y.__decorate([b.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(y,z,C,c,g,h,b,e,d,l,k,r){var m;z={base:e,key:"type",typeMap:{extent:k,polygon:r}};l=m=class extends l{constructor(p){super(p);this.type="geometry";this.geometry=null}clone(){return new m({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};y.__decorate([C.property({types:z,json:{read:d.fromJSON,write:!0}})],l.prototype,"geometry",void 0);return l=m=y.__decorate([b.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,C,c,g,h,b){C=class extends b{constructor(e){super(e);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};y.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0);return C=y.__decorate([h.subclass("esri.views.layers.support.Path")],C)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(y,z,C){class c extends z{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(g){g=C.pool.acquire(g);const h=0===g.level?null:C.getId(g.level-1,g.row>>1,g.col>>1,g.world);C.pool.release(g);return h}getTileCoverage(g,h,b=!0,e){g=super.getTileCoverage(g,h,b,e);if(!g)return g;const d=1<<g.lodInfo.level;g.spans=g.spans.filter(l=>0<=l.row&&l.row<d);return g}scaleToLevel(g){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[g])return this._levelByScale[g];var h=this._fullCacheLodInfos;
if(g>h[0].scale)return h[0].level;let b;for(let e=0;e<h.length-1;e++)if(b=h[e+1],g>b.scale)return h=h[e],h.level+(h.scale-g)/(h.scale-b.scale);return h[h.length-1].level}_initializeFullCacheLODs(g){g=0===g[0].level?g.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale})):y.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale}));for(let h=0;h<g.length;h++)this._levelByScale[g[h].scale]=g[h].level;
this._fullCacheLodInfos=g}}return c})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileFeatureIndex ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(y,
z,C,c,g,h,b,e,d,l,k,r,m,p,q,A,F,x,D,E,I,L,O,u){function B(f){if(null==f)return 0;switch(f.type){case "partial":return Object.keys(f.diff).length;case "complete":return Math.max(Object.keys(f.oldValue).length,Object.keys(f.newValue).length);case "collection":return Object.keys(f.added).length+Object.keys(f.changed).length+Object.keys(f.removed).length}}b=class extends I.LayerView2DMixin(u){constructor(){super(...arguments);this._styleChanges=[];this._tileHandlerPromise=this._parseQueue=this._fetchQueue=
null;this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}async hitTest(f,n){var v=this._tileHandlerPromise,H=this._vectorTileContainer?.symbolFader;if(v&&this._isTileHandlerReady&&H){await v;v=null;var K=this._vectorTileContainer?.symbolRepository;K&&(v=K.querySymbols(n,2,H.decluttererOffset,{}));n=this._tileManager.getIntersectingTiles(n.x,n.y,2,this.view.state,v);if((!n||0===n.length)&&0===v?.length)return null;f=f.clone().normalize();H=[];K=[];for(const M of n)H.push(this._queryTile(K,
f,2,this.view.state.rotation,M,v?.filter(J=>J.tileKey.id===M.id)));await Promise.all(H);return K}}update(f){this._tileHandlerPromise&&this._isTileHandlerReady&&(f.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=f.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=f.state,this._parseQueue.state=f.state,this._tileManager.update(f)||this.requestUpdate(),
this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const {style:f}=this.layer.currentStyleInfo;this._styleRepository=new E(f);this._tileInfoView=new L(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new F.VectorTileContainer(this._tileInfoView);this._tileHandler=new p.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1);this.container.addChild(this._vectorTileContainer);this._start();this.addAttachHandles([this.layer.on("paint-change",
n=>{if(n.isDataDriven)this._styleChanges.push({type:m.StyleUpdateType.PAINTER_CHANGED,data:n}),this.requestUpdate();else{const H=this._styleRepository;var v=H.getLayerById(n.layer);v&&(v=v.type===D.StyleLayerType.SYMBOL,H.setPaintProperties(n.layer,n.paint),v&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}}),this.layer.on("layout-change",n=>{const v=this._styleRepository,H=v.getLayerById(n.layer);if(H){var K=d.diff(H.layout,n.layout);null!=K&&(d.hasDiff(K,
"visibility")&&1===B(K)?(v.setLayoutProperties(n.layer,n.layout),H.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()):(this._styleChanges.push({type:m.StyleUpdateType.LAYOUT_CHANGED,data:n}),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",n=>{const v=this._styleRepository,H=v.getLayerById(n.layer);H&&(v.setStyleLayerVisibility(n.layer,n.visibility),H.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),
this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",n=>{this._styleChanges.push({type:m.StyleUpdateType.LAYER_CHANGED,data:n});this.requestUpdate()}),this.layer.on("delete-style-layer",n=>{this._styleChanges.push({type:m.StyleUpdateType.LAYER_REMOVED,data:n});this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",n=>{this._styleChanges.push({type:m.StyleUpdateType.SPRITES_CHANGED,data:n});n=this._styleRepository.layers;
for(const v of n)switch(v.type){case D.StyleLayerType.SYMBOL:v.getLayoutProperty("icon-image")&&this._styleChanges.push({type:m.StyleUpdateType.LAYOUT_CHANGED,data:{layer:v.id,layout:v.layout}});break;case D.StyleLayerType.LINE:v.getPaintProperty("line-pattern")&&this._styleChanges.push({type:m.StyleUpdateType.PAINTER_CHANGED,data:{layer:v.id,paint:v.paint,isDataDriven:v.isPainterDataDriven()}});break;case D.StyleLayerType.FILL:v.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:m.StyleUpdateType.PAINTER_CHANGED,
data:{layer:v.id,paint:v.paint,isDataDriven:v.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop();this.container.removeAllChildren();this._vectorTileContainer=c.destroyMaybe(this._vectorTileContainer);this._tileHandler=c.destroyMaybe(this._tileHandler)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(f){return r.equals(this.layer.tileInfo?.spatialReference,f)}canResume(){let f=super.canResume();const {currentStyleInfo:n}=this.layer;if(f&&
n?.layerDefinition){const v=this.view.scale,{minScale:H,maxScale:K}=n.layerDefinition;n?.layerDefinition&&(H&&H<v&&(f=!1),K&&K>v&&(f=!1))}return f}isUpdating(){return this.fading}acquireTile(f){const n=this._createVectorTile(f);this._updatingHandles.addPromise(this._fetchQueue.push(n.key).then(v=>this._parseQueue.push({key:n.key,data:v})).then(v=>{n.once("attach",()=>this.requestUpdate());n.setData(v);this.requestUpdate()}).catch(v=>{g.isAbortError(v)||C.getLogger(this).error(v)}));return n}releaseTile(f){f=
f.key.id;this._fetchQueue.abort(f);this._parseQueue.abort(f);this.requestUpdate()}_start(){this._stop();this._tileManager=new q.TileManager({acquireTile:v=>this.acquireTile(v),releaseTile:v=>this.releaseTile(v),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var f=new AbortController,n=this._tileHandler.start({signal:f.signal}).then(()=>{this._fetchQueue=new O({tileInfoView:this._tileInfoView,process:(v,H)=>this._getTileData(v,H),concurrency:15});this._parseQueue=
new O({tileInfoView:this._tileInfoView,process:(v,H)=>this._parseTileData(v,H),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(v=>{this._vectorTileContainer.setStyleResources(v,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView);this.requestUpdate()});this._tileHandlerAbortController=f;this._tileHandlerPromise=n}}_stop(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var f=this._tileHandlerAbortController;
f&&f.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue=c.destroyMaybe(this._fetchQueue);this._parseQueue=c.destroyMaybe(this._parseQueue);this._tileManager=c.destroyMaybe(this._tileManager);this._vectorTileContainer.removeAllChildren()}}async _getTileData(f,n){return this._tileHandler.fetchTileData(f,n)}async _parseTileData(f,n){return this._tileHandler.parseTileData(f,n)}async _applyStyleChanges(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();
this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var f=this._styleChanges;try{await this._tileHandler.updateStyle(f)}catch(M){C.getLogger(this).error("error applying vector-tiles style update",M.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const n=this._styleRepository,v=new Set;f.forEach(M=>{M.type===m.StyleUpdateType.LAYER_REMOVED&&(M=n.getLayerById(M.data.layer))&&v.add(M.uid)});const H=new Set;f.forEach(M=>{let J;switch(M.type){case m.StyleUpdateType.PAINTER_CHANGED:n.setPaintProperties(M.data.layer,
M.data.paint);J=M.data.layer;break;case m.StyleUpdateType.LAYOUT_CHANGED:n.setLayoutProperties(M.data.layer,M.data.layout);J=M.data.layer;break;case m.StyleUpdateType.LAYER_REMOVED:n.deleteStyleLayer(M.data.layer);return;case m.StyleUpdateType.LAYER_CHANGED:n.setStyleLayer(M.data.layer,M.data.index);J=M.data.layer.id;break;case m.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(M.data.spriteSource))}J&&(M=n.getLayerById(J))&&H.add(M.uid)});
f=this._vectorTileContainer.children;if(0<v.size){const M=Array.from(v);this._vectorTileContainer.deleteStyleLayers(M);for(var K of f)K.deleteLayerData(M)}this._fetchQueue.resume();this._parseQueue.resume();if(0<H.size){const M=Array.from(H);K=[];for(const J of f)f=this._updatingHandles.addPromise(this._fetchQueue.push(J.key).then(P=>this._parseQueue.push({key:J.key,data:P,styleLayerUIDs:M})).then(P=>J.setData(P))),K.push(f);await Promise.all(K)}this._styleChanges=[];this._isTileHandlerReady=!0;this.requestUpdate()}async _loadStyle(){var {style:f}=
this.layer.currentStyleInfo;f=z.clone(f);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._styleRepository=new E(f);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;var {signal:n}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,f,this.layer.tileInfo.lods.length-
1),await this._tileHandlerPromise}catch(v){if(!g.isAbortError(v))throw v;}n.aborted||(f=await this._tileHandler.spriteMosaic,n=this._vectorTileContainer,this._tileInfoView=new L(this.layer.tileInfo,this.layer.fullExtent),n.setStyleResources(f,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new q.TileManager({acquireTile:v=>this.acquireTile(v),releaseTile:v=>this.releaseTile(v),tileInfoView:this._tileInfoView},this._vectorTileContainer));this._fetchQueue.resume();
this._parseQueue.resume();this._isTileHandlerReady=!0;this.requestUpdate()}_createVectorTile(f){const n=this._tileInfoView.getTileBounds(k.create(),f),v=this._tileInfoView.getTileResolution(f.level);return new A.VectorTile(f,v,n[0],n[3],512,512,this._styleRepository)}async _queryTile(f,n,v,H,K,M){if(0!==K.layerData.size){var J=this._ensureTileIndex(K),P=this._tileInfoView.getTileBounds(k.create(),K.key,!0);v=await J.queryAttributes((n.x-P[0])/(P[2]-P[0])*4096,4096*(1-(n.y-P[1])/(P[3]-P[1])),v,H,M);
for(const R of v)R.graphic.geometry=this._tileToMapPoint(R.tilePoint,K.transforms.tileUnitsToPixels),f.push({type:"graphic",layer:this.layer,graphic:R.graphic,mapPoint:n.clone()});f.sort((R,U)=>U.graphic.origin.layerIndex-R.graphic.origin.layerIndex)}}_tileToMapPoint(f,n){if(!f)return null;const v=this.view.state,H=[0,0];v.toMap(H,[f[0]*n[0]+f[1]*n[3]+n[6],f[0]*n[1]+f[1]*n[4]+n[7]]);return new l({x:H[0],y:H[1],spatialReference:v.spatialReference})}_ensureTileIndex(f){let n=f.featureIndex;n||(n=x.create(f.key,
f.layerData,this._styleRepository,this._tileHandler,this.layer),f.featureIndex=n);return n}};y.__decorate([h.property()],b.prototype,"_isTileHandlerReady",void 0);return b=y.__decorate([e.subclass("esri.views.2d.layers.VectorTileLayerView2D")],b)});