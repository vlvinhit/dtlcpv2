// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/screenUtils ../../../../../../layers/support/OrderByInfo ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema".split(" "),function(l,r,t,g,h,m,n){async function u(a,d){var b=d.renderer;const f=n.createVisualVariableUniforms(b);b=await h.createMatcherSchema(a,b);a=await g.createLabelMatcherSchema(a,d,f);return{symbology:b,labels:a}}function p(a,d){return a.fields.map(b=>({...b.toJSON(),type:v(b,d)}))}function v(a,d){const {onStatisticExpression:b,
onStatisticField:f,statisticType:c}=a;switch(c){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":return b?({returnType:a}=b,a?"string"===a?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"):(a=d.find(e=>e.name===f))?a.type:"esriFieldTypeString"}}async function w(a,d,b,f,c){f=p(a,f.fields);var e=a.renderer;const q=await h.createMatcherSchema(d,e),k=m.createStorageSchema(e,[null,null]);e=n.createVisualVariableUniforms(e);
d=await g.createLabelMatcherSchema(d,{geometryType:"polygon",labelingInfo:a.labelingInfo,labelsVisible:a.labelsVisible},e);a="geohash"===a.binType?{type:"geohash",fixBinLevel:a.fixedBinLevel??3}:{type:"grid",size:r.pt2px(a.size),fixedBinLevel:a.fixedBinLevel};return{storage:k,mesh:{properties:{sortKey:null,timeZone:b.timeZone,returnMeshObjectId:!1,displayRefreshVersion:c},strategy:{type:"binning",fields:f,index:a,featureFilter:b.filters[0]},factory:{labels:d,symbology:q}}}}async function x(a,d,b,
f,c){const e=p(a,f.fields),q={type:"cluster",feature:await h.createMatcherSchema(d,a.effectiveFeatureRenderer),cluster:await h.createMatcherSchema(d,a.effectiveClusterRenderer)},k=n.createVisualVariableUniforms(a.effectiveFeatureRenderer);d={type:"cluster",feature:await g.createLabelMatcherSchema(d,f,k),cluster:await g.createLabelMatcherSchema(d,{geometryType:"point",labelingInfo:a.labelingInfo,labelsVisible:a.labelsVisible},k)};return{storage:m.createStorageSchema(a.effectiveFeatureRenderer,[null,
null]),mesh:{properties:{sortKey:null,timeZone:b.timeZone,displayRefreshVersion:c,returnMeshObjectId:!1},strategy:{type:"cluster",fields:e,featureFilter:b.filters[0],clusterRadius:r.pt2px(a.clusterRadius/2)},factory:{labels:d,symbology:q}}}}l.createSimpleProcessorSchema=async function(a,d,b,f){var c=b.featureReduction;if(c)switch(c.type){case "binning":return w(c,a,d,b,f);case "cluster":return x(c,a,d,b,f)}c=b.orderBy;var e=b.renderer;e=null!=e&&"unique-value"===e.type&&e.orderByClassesEnabled;"default"!==
c||e||(c=[new t({field:b.objectIdField,order:"descending"})]);"default"!==c&&c.length?(c=c[0],e="ascending"===c.order?"asc":"desc",c=c.field?{field:c.field,order:e}:c.valueExpression?{expression:c.valueExpression,order:e}:null):c=e?{byRenderer:!0,order:"asc"}:null;e=m.createStorageSchema(b.renderer,d.filters);a=await u(a,b);return{storage:e,mesh:{properties:{sortKey:c,timeZone:d.timeZone,returnMeshObjectId:!1,displayRefreshVersion:f},strategy:{type:"feature"},factory:a}}};l.getAggregateFields=p;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})});