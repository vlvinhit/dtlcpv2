// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/subclass".split(" "),function(l,n,t,q,y,w,h){n=class extends n{constructor(){super(...arguments);this.isAggregate=!0}getEffectivePopupTemplate(A){return this.popupTemplate?this.popupTemplate:(A=this.sourceLayer?.featureReduction)&&"popupTemplate"in A&&A.popupEnabled?A.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};
l.__decorate([t.property({type:Boolean})],n.prototype,"isAggregate",void 0);return n=l.__decorate([h.subclass("esri.AggregateGraphic")],n)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(l,n,t,q,y,w,h,A){n=class extends n{constructor(k){super(k);this._filter=null;
this.duration=t("mapview-transitions-duration");this._excludedEffectView=new A.EffectView(k);this._includedEffectView=new A.EffectView(k)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(k){this._get("featureEffect")!==k&&this._transitionTo(k)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(k){this._set("scale",
k);this._excludedEffectView.scale=k;this._includedEffectView.scale=k}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(k,g){this._set("scale",g);this.transitioning?(this._includedEffectView.transitionStep(k,g),this._excludedEffectView.transitionStep(k,g),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=g,this._includedEffectView.scale=g)}endTransitions(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();
this._filter=null}_transitionTo(k){const g=this._get("featureEffect"),d=k?.includedEffect,m=k?.excludedEffect,c=this._includedEffectView.canTransitionTo(d)&&this._excludedEffectView.canTransitionTo(m);this._includedEffectView.effect=d;this._excludedEffectView.effect=m;this._set("featureEffect",k);this._filter=k?.filter||g?.filter||null;c||this.endTransitions()}};l.__decorate([q.property()],n.prototype,"_filter",void 0);l.__decorate([q.property()],n.prototype,"_excludedEffectView",void 0);l.__decorate([q.property()],
n.prototype,"_includedEffectView",void 0);l.__decorate([q.property()],n.prototype,"duration",void 0);l.__decorate([q.property()],n.prototype,"excludedEffects",null);l.__decorate([q.property()],n.prototype,"featureEffect",null);l.__decorate([q.property()],n.prototype,"filter",null);l.__decorate([q.property()],n.prototype,"hasEffects",null);l.__decorate([q.property()],n.prototype,"includedEffects",null);l.__decorate([q.property({value:0})],n.prototype,"scale",null);l.__decorate([q.property()],n.prototype,
"transitioning",null);return n=l.__decorate([h.subclass("esri.layers.effects.FeatureEffectView")],n)})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(l,n){l.combineTimeExtent=function(t,q,y){if(null==t?.timeInfo)return null;const {datesInUnknownTimezone:w=!1,timeOffset:h,useViewTime:A}=t;t=t.timeExtent;w&&(t=n.toLocalTimeExtent(t));q=A?q&&t?q.intersection(t):q||t:t;if(!q||q.isEmpty||q.isAllTime)return q;h&&(q=q.offset(-h.value,h.unit));w&&(q=n.toUTCTimeExtent(q));
return q.equals(y)?y:q};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define("exports ../TimeExtent ../core/arrayUtils ../core/deprecate ../core/lang ../core/Logger ../core/timeUtils ../webmap/utils ../webscene/utils".split(" "),function(l,n,t,q,y,w,h,A,k){function g(b){return void 0!==b.timeInfo}async function d(b,u){return b.widgets?.timeSlider?.fullTimeExtent??m(b.allLayers,u)}async function m(b,u){if(0===b.length)return n.allTime;await Promise.all(b.map(x=>
x.load({signal:u})));var r=b.filter(g),f=b.filter(x=>!g(x)&&null!=x.visibilityTimeExtent);if(0===r.length&&0===f.length)return n.allTime;b=[];const v=[];for(const x of r)"feature"!==x?.type&&"map-image"!==x?.type||!x.timeInfo?.hasLiveData?v.push(x):b.push(x);r=x=>null==x||x.isAllTime;f=[...v.map(x=>{const B=x.timeInfo?.fullTimeExtent;({visibilityTimeExtent:x}=x);return B?.intersection(x)??x}),...f.map(x=>x.visibilityTimeExtent)];if(f.some(r))return n.allTime;b=b.map(async x=>{const B=(await x.fetchRecomputedExtents({signal:u}))?.timeExtent??
x.timeInfo?.fullTimeExtent;({visibilityTimeExtent:x}=x);return B?.intersection(x)??x});b=(await Promise.allSettled(b)).map(x=>"fulfilled"===x.status?x.value:null);if(b.some(r))return n.allTime;b=[...b,...f].filter(t.isSome);return 0===b.length?n.allTime:b.reduce((x,B)=>x.union(B))}function c(b,u){b=b.currentTimeExtent;if(!b)return null;const {start:r,end:f}=b;b=r??f??null;switch(u){case "time-window":return new n({start:r,end:f});case "cumulative-from-start":return new n({start:null,end:b});case "cumulative-from-end":return new n({start:b,
end:null});case "instant":return new n({start:b,end:b})}}async function a(b,u){if(!A.isWebMap(b)&&!k.isWebScene(b))return null;await b.load({signal:u});var r=b?.widgets?.timeSlider;if(!r)return null;b=await d(b,u);u=r.loop;var f=r.numThumbs??2;var v=r.currentTimeExtent;if(v){const {start:B,end:I}=v;f=null!=B&&null!=I&&B.getTime()===I.getTime()?"instant":2===f?"time-window":null==B||0===B.getTime()?"cumulative-from-start":"cumulative-from-end"}else f=2===f?"time-window":"cumulative-from-start";v=r.stopDelay??
2E3;{const {numStops:B,stopInterval:I,stops:J}=r;var x=J?{dates:y.clone(J)}:I?{interval:I.clone()}:{count:B??5}}r=c(r,f);return{fullTimeExtent:b,loop:u,mode:f,playRate:v,stops:x,timeExtent:r}}l.getTimeExtentFromLayers=m;l.getTimeSliderSettingsFromWebDocument=a;l.getTimeSliderSettingsFromWebMap=async function(b,u){q.deprecatedFunction(w.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",
{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0});return null!=b&&A.isWebMap(b)?await a(b,u):null};l.toLocalTimeExtent=function(b){if(!b)return b;const {start:u,end:r}=b;return new n({start:null!=u?h.offsetDate(u,u.getTimezoneOffset(),"minutes"):u,end:null!=r?h.offsetDate(r,r.getTimezoneOffset(),"minutes"):r})};l.toUTCTimeExtent=
function(b){if(!b)return b;const {start:u,end:r}=b;return new n({start:null!=u?h.offsetDate(u,-u.getTimezoneOffset(),"minutes"):u,end:null!=r?h.offsetDate(r,-r.getTimezoneOffset(),"minutes"):r})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],function(l,n){l.isWebScene=function(t){return null!=t&&"object"===typeof t&&n.WebSceneTag in t};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],
function(l){const n=Symbol("WebScene");l.WebSceneTag=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(l,n,
t,q,y,w,h,A,k,g,d){t=class extends g{constructor(){super(...arguments);this.features=[]}readFeatures(m,c){c=d.fromJSON(c.spatialReference);const a=[];for(let r=0;r<m.length;r++){var b=m[r];const f=n.fromJSON(b);var u=b.geometry?.spatialReference;null==f.geometry||u||(f.geometry.spatialReference=c);b=b.aggregateGeometries;u=f.aggregateGeometries;if(b&&null!=u)for(const v in u){const x=u[v],B=b[v]?.spatialReference;null==x||B||(x.spatialReference=c)}a.push(f)}return a}};l.__decorate([q.property({type:[n],
json:{write:!0}})],t.prototype,"features",void 0);l.__decorate([A.reader("features")],t.prototype,"readFeatures",null);return t=l.__decorate([k.subclass("esri.rest.support.AggregateFeatureSet")],t)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m,c,a,b,u,r){const f=t.ofType({key:"type",base:null,typeMap:{rect:a,path:u,geometry:b}});l.LayerView2DMixin=v=>{v=class extends v{constructor(){super(...arguments);this.attached=!1;this.clips=new f;this.highlightOptions=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const x=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&x&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new y("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new m.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([w.watch(()=>this.suspended,B=>{this.container&&(this.container.visible=!B)},w.syncAndInitial),w.watch(()=>this.updateSuspended,B=>{this.view&&!B&&this.updateRequested&&this.view.requestUpdate()},w.syncAndInitial),w.watch(()=>this.layer?.opacity??
1,B=>{this.container&&(this.container.opacity=B)},w.syncAndInitial),w.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",B=>{this.container&&(this.container.blendMode=B)},w.syncAndInitial),w.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,B=>{this.container&&(this.container.effect=B)},w.syncAndInitial),w.watch(()=>this.highlightOptions,B=>this.container.highlightOptions=B,w.syncAndInitial),w.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},w.syncAndInitial),w.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:B,scaleRange:I})=>{B=r.isInEffectiveScaleRange(I,B);B!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=B)},w.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(B=>{B===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const x=this.view?.spatialReference;return null==x||this.supportsSpatialReference(x)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,
this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(x){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",x),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(x)))}hitTest(x,B){return Promise.resolve(null)}supportsSpatialReference(x){return!0}canResume(){return this.spatialReferenceSupported?
super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const x=super.getSuspendInfo(),B=!this.spatialReferenceSupported;B&&(x.spatialReferenceNotSupported=B);return x}addAttachHandles(x){this.addHandles(x,"attach")}};n.__decorate([h.property()],v.prototype,"attached",void 0);n.__decorate([h.property({type:f,set(x){x=q.referenceSetter(x,this._get("clips"),f);this._set("clips",x)}})],v.prototype,"clips",void 0);n.__decorate([h.property()],v.prototype,"container",void 0);n.__decorate([h.property({type:c})],
v.prototype,"highlightOptions",void 0);n.__decorate([h.property()],v.prototype,"moving",void 0);n.__decorate([h.property({readOnly:!0})],v.prototype,"spatialReferenceSupported",null);n.__decorate([h.property({readOnly:!0})],v.prototype,"updateParameters",void 0);n.__decorate([h.property()],v.prototype,"updateRequested",void 0);n.__decorate([h.property()],v.prototype,"updating",null);n.__decorate([h.property()],v.prototype,"view",void 0);n.__decorate([h.property()],v.prototype,"_visibleAtCurrentScale",
void 0);n.__decorate([h.property({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null);return v=n.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],v)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(l,
n,t,q,y,w,h){var A;t=A=class extends h{constructor(k){super(k);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new A({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};l.__decorate([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0);l.__decorate([n.property({type:[Number,String],json:{write:!0}})],
t.prototype,"right",void 0);l.__decorate([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0);l.__decorate([n.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0);return t=A=l.__decorate([w.subclass("esri.views.layers.support.ClipRect")],t)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(l,n,t,q,y,w,h){n=class extends n.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};l.__decorate([t.property({readOnly:!0})],n.prototype,"version",null);return n=l.__decorate([h.subclass("esri.views.layers.support.ClipArea")],n)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m){var c;n={base:A,key:"type",typeMap:{extent:d,polygon:m}};g=c=class extends g{constructor(a){super(a);this.type="geometry";this.geometry=null}clone(){return new c({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};l.__decorate([t.property({types:n,json:{read:k.fromJSON,write:!0}})],g.prototype,"geometry",void 0);return g=c=l.__decorate([h.subclass("esri.views.layers.support.Geometry")],g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(l,n,t,q,y,w,h){t=class extends h{constructor(A){super(A);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};l.__decorate([n.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0);return t=l.__decorate([w.subclass("esri.views.layers.support.Path")],t)})},"esri/views/2d/layers/features/FeatureContainer":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/support/UpdatingHandles ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/FeatureInstanceStore ./RenderState ../support/util".split(" "),
function(l,n,t,q,y,w,h,A,k,g){class d{constructor(c,a){this.id=c;this.version=a;this._resolver=q.createResolver();this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve();this._done=!0}destroy(){this._resolver.reject()}}class m extends w.AFeatureContainer{constructor(c){super(c.view.featuresTilingScheme);this.updatingHandles=new y.UpdatingHandles;this._hitTestsRequests=[];this._store=new A;this._visibleTiles=new Set;this._subscriptions=
new Map;this._updateStatisticsRequests=[];this._lockStatisticUpdates=!1;this._layerView=c}renderChildren(c){this.attributeView.update();this._renderState?.update(this.attributeView.currentEpoch);if(this._renderState){const a=Array.from(this._renderState.tiles()).filter(b=>b.needsUpload);a.length&&(a[Math.floor(Math.random()*a.length)].upload(),2<=a.length&&this.requestRender());for(const b of this._renderState.tiles())b.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(b.key.id)?.end(),
this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const a of this.children)a.setTransform(c.state);this.hasAnimation&&c.painter.effects.integrate.draw(c,c.attributeView);super.renderChildren(c);switch(c.drawPhase){case h.WGLDrawPhase.MAP:return this._renderMapPhase(c);case h.WGLDrawPhase.HIGHLIGHT:return this._renderHighlightPhase(c);case h.WGLDrawPhase.LABEL:return this._renderLabelPhase(c)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return 0<
this._layerView.labelingCollisionInfos.length}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance({drawPhase:c}){if(null==this._instanceStore)return null;let a=0,b=null;for(const u of this._instanceStore.values())u.techniqueRef.drawPhase&c&&(a++,u.techniqueRef.postProcessingEnabled&&(b=u));return 1<a?null:b}_getOverrideStencilRef({drawPhase:c}){if(null==this._instanceStore)return null;let a=null;for(const b of this._instanceStore.values()){if(!(b.techniqueRef.drawPhase&
c))continue;const {overrideStencilRef:u}=b.techniqueRef;if(null==a)a=u;else if(a!==u){a=null;break}}return a}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(c=>this._visibleTiles.has(c.key.id)):[]}updateAttributeView(c){this.requestRender();this.attributeView.requestUpdate(c);this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(c){for(const {tileId:a,version:b}of c.subscribe)if(this._subscriptions.has(a))this._subscriptions.get(a).version=
b;else{const u=new d(a,b);this._subscriptions.set(a,u);this.updatingHandles.addPromise(u.promise)}for(const a of c.unsubscribe)this._subscriptions.get(a)?.destroy(),this._subscriptions.delete(a),this.removeTile(a)}isDone(c){return this._renderState?this._renderState.isTileDone(c):!1}async updateRenderState(c){n("esri-2d-update-debug")&&console.debug(`Version[${c}] FeatureContainer.updateRenderState`);this._renderStateNext=new k.RenderState(()=>this._stage,c,this._tileInfoView)}getDisplayStatistics(c,
a){return(c=this._statisticsByLevel.get(c))?c.get(a):null}updateStatistics(c,a){if(this._lockStatisticUpdates)this._updateStatisticsRequests.push({level:c,statistics:a});else{var b=this._statisticsByLevel.get(c);b||(b=new Map,this._statisticsByLevel.set(c,b));for(const u of a)b.set(u.fieldName,{minValue:u.minValue,maxValue:u.maxValue})}}editStart(){this._renderState?.lockUploads();this.attributeView.lockTextureUploads();this._lockStatisticUpdates=!0}editEnd(){this._renderState?.unlockUploads();this.attributeView.unlockTextureUploads();
this._lockStatisticUpdates=!1;for(const c of this._updateStatisticsRequests)this.updateStatistics(c.level,c.statistics);this._updateStatisticsRequests=[];this.requestRender()}swapRenderState(){this._renderStateNext&&(n("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null);this._renderState&&this._renderState.flush();this.requestRender()}setVisibleTiles(c){this._visibleTiles=
c}async onMessage(c,a){q.throwIfAborted(a);c=c.inner;if(this._subscriptions.has(c.id))if(a=this._subscriptions.get(c.id),a.version!==c.subscriptionVesrion)n("esri-2d-update-debug")&&console.debug(`Version[${`${c.subscriptionVesrion} != ${a.version}`}] Tile[${c.id}] FeatureContainer - Dropping message, outdated version]`,c);else{a=this._renderStateNext??this._renderState;if(!a)throw Error("InternalError: No renderState defined");a.version!==c.version&&console.error(`InternalError: Version mismatch. [renderState: ${a.version}, message: ${c.version}]`);
a.enqueueUpdate(c);this.requestRender();this._layerView.view.labelManager.requestUpdate();this._layerView.requestUpdate()}}removeTile(c){if(this._renderState||this._renderStateNext)this._renderState&&this._renderState.removeTile(c),this._renderStateNext&&this._renderStateNext.removeTile(c)}hitTest(c){let a=this._hitTestsRequests.find(({x:u,y:r})=>u===c.x&&r===c.y);const b=q.createResolver();a?a.resolvers.push(b):(a={x:c.x,y:c.y,resolvers:[b]},this._hitTestsRequests.push(a));this.requestRender();return b.promise}getSortKeys(c){c=
new Set(c);const a=new Map;for(const b of this.children)if(b.getSortKeys(c).forEach((u,r)=>a.set(r,u)),a.size===c.size)break;return a}get hasAnimation(){return this.hasLabels}updateTransitionProperties(c,a){super.updateTransitionProperties(c,a);this._layerView.featureEffectView.transitionStep(c,a);this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(c){const {minScale:a,maxScale:b}=this._layer.effectiveScaleRange,u=c.state.scale;u<=(a||Infinity)&&u>=b&&super.doRender(c)}afterRender(c){super.afterRender(c);
this._hitTestsRequests.length&&this.requestRender()}setStencilReference(c){const a=this._getOverrideStencilRef(c);if(null!=a)for(const b of this.children)b.stencilRef=a(b);else super.setStencilReference(c)}_renderMapPhase(c){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(c),this._renderInsideEffect(c)):this._renderFeatures(c,h.FeatureSelection.All);0<this._hitTestsRequests.length&&this._renderHittest(c)}_renderHighlightPhase(c){this.hasHighlight&&g.renderHighlight(c,!1,a=>
{this._renderFeatures(a,h.FeatureSelection.Highlight)})}_renderLabelPhase(c){this._renderFeatures(c,h.FeatureSelection.All)}_renderInsideEffect(c){const a=c.painter.effects.insideEffect;a.bind(c);this._renderFeatures(c,h.FeatureSelection.InsideEffect);a.draw(c,this._layerView.featureEffectView.includedEffects);a.unbind()}_renderOutsideEffect(c){const a=c.painter.effects.outsideEffect;a.bind(c);this._renderFeatures(c,h.FeatureSelection.OutsideEffect);a.draw(c,this._layerView.featureEffectView.excludedEffects);
a.unbind()}_renderHittest(c){const {context:a}=c,b=c.painter.effects.hittest,u=a.getBoundFramebufferObject(),r=a.getViewport(),f=c.passOptions,v=c.drawPhase;b.bind(c);c.passOptions=b.createOptions(c,this._hitTestsRequests);c.drawPhase=h.WGLDrawPhase.HITTEST;const {distance:x,smallSymbolDistance:B}=c.passOptions,I=Math.max(x,B);for(const J of this.children)J.visible&&J.containsScreenPoint(c.state,c.passOptions.position,2*I)&&this._renderTile(J,c,h.FeatureSelection.All);b.draw(c);b.unbind();a.bindFramebuffer(u);
a.restoreViewport(r);c.passOptions=f;c.drawPhase=v}_renderFeatures(c,a){for(const b of this.children)b.visible&&this._renderTile(b,c,a);a=this._getExclusivePostprocessingInstance(c);null!=a&&a.techniqueRef.postProcess(c,a)}_renderTile(c,a,b){const u=n("featurelayer-force-marker-text-draw-order")?h.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT:h.FeatureBatchingStrategy.BATCHING;c=c.getDisplayList(this._instanceStore,u);a.selection=b;c?.render(a)}}l.FeatureContainer=m;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureInstanceStore":function(){define(["../../../../../../core/string","./TechniqueInstance","./mesh/instanceIdUtils"],function(l,n,t){class q{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw Error("InternalError: Found updateEnd call without corresponding updateStart");
for(var y of this._instanceById.keys())this._instanceByIdNext.has(y)||this._instanceById.delete(y);for(const [w,h]of this._instanceByIdNext.entries())(y=this._instanceById.get(w))?y.setInput(h.getInput()):this._instanceById.set(w,h);this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(y,w){if("object"===typeof w&&"optionalAttributes"in w&&"uniforms"in w){var h=`${y.type}${JSON.stringify(w.optionalAttributes)}`;const A=w.uniforms;if("object"===typeof A)for(const k in A)h+=
`${k}.${null!=A[k]}`}else h=`${y.type}.${JSON.stringify(w)}`;h=l.numericHash(h);if(this._instanceByIdNext)return y=new n.FeatureTechniqueInstance(t.castInstanceId(h),y,w),this._instanceByIdNext.set(h,y),y;this._instanceById.has(h)||(y=new n.FeatureTechniqueInstance(t.castInstanceId(h),y,w),this._instanceById.set(h,y));return this._instanceById.get(h)}getInstance(y){return this._instanceById.get(y)}}return q})},"esri/views/2d/layers/features/RenderState":function(){define("exports ../../../../core/CircularArray ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../geometry/support/aaBoundingRect ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/FeatureTile ./support/tileUtils".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m){class c{constructor(a,b,u){this.getStage=a;this.version=b;this._tileInfoView=u;this._pendingUpdates=new n(1E3);this._locked=!1;this._tiles=new Map}destroy(){for(const a of this.tiles())a.destroy();this._pendingUpdates.clear();this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(a){this._tiles.clear();for(const b of a)this._tiles.set(b.key.id,b)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1;this.flush()}enqueueUpdate(a){this._pendingUpdates.enqueue(a)}update(a){if(!this._locked)for(;this._pendingUpdates.size;){const b=
this._pendingUpdates.peek();if(null==b||b.attributeEpoch>a)break;this._updateTile(b);this._pendingUpdates.dequeue()}}removeTile(a){const b=this._tiles.get(a);q("esri-2d-update-debug")&&console.debug(`Tile[${a}] RenderState.removeTile`);b?.destroy();this._tiles.delete(a)}isTileDone(a){return(a=this._tiles.get(a.id))?a.isReady:!1}flush(){for(;this._pendingUpdates.size;){const a=this._pendingUpdates.dequeue();null!=a&&this._updateTile(a)}for(const a of this._tiles.values())a.upload()}_updateTile(a){q("esri-2d-update-debug")&&
console.debug(`Version[${a.version}] Tile[${a.id}] Chunk[${a.debugInfo?.chunkId??"\x3cEnsureEnd\x3e"}] RenderState.updateTile [${a.type}]`,a);const b=this._ensureTile(a.id);if("update"===a.type){const [v,...x]=a.modify;b.onMessage({type:"update",modify:v,remove:a.remove,end:a.end,attributeEpoch:a.attributeEpoch});for(const B of x){var u=this._tiles.get(B.tileId);if(u)u.onMessage({type:"update",modify:B,remove:a.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}else if(null==a.append)b.onMessage({type:"append",
clear:a.clear,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch});else{var [r,...f]=a.append;b.onMessage({type:"append",clear:a.clear,append:r,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch});for(u of f)if(a=this._tiles.get(u.tileId))a.onMessage({type:"update",modify:u,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}_ensureTile(a){if(!this._tiles.has(a)){const b=this._createTile(a);this._copyPixelBufferedEntitiesInto(b);this._tiles.set(a,b)}return this._tiles.get(a)}_createTile(a){q("esri-2d-update-debug")&&
console.debug(`Version[${this.version}] Tile[${a}] RenderState.createTile`);a=new A(a);var b=this._tileInfoView.getTileBounds(w.create(),a);const u=this._tileInfoView.getTileResolution(a.level);a=new d.FeatureTile(a,u,b[0],b[3],!0);a.stage=this.getStage();a.stage||(b=new t("featurelayerview:webgl","Cannot create tile with empty stage"),y.getLogger("esri.views.2d.layers.features.RenderState").error(b));return a}_copyPixelBufferedEntitiesInto(a){let b=7;for(let r=-1;1>=r;r++)for(let f=-1;1>=f;f++)if(0!==
r||0!==f){var u=m.getPow2NeighborKey(a.key,f,r,this._tileInfoView.tileInfo.isWrappable).id;u=this._tiles.get(u);null!=u&&a.copyPixelBufferedEntitesFrom(u,1<<b,f,r);b--}}}l.RenderState=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(l){l.getPow2NeighborKey=function(n,t,q,y){n=n.clone();const w=1<<n.level;t=n.col+t;q=n.row+q;y&&0>t?(n.col=t+w,--n.world):t>=w?(n.col=t-w,n.world+=1):n.col=t;n.row=
q;return n};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports","../../../../core/workers/workers"],function(l,n){class t{constructor(q){this._connection=q;this.pipeline=this._connection.createInvokeProxy();this.features=this._connection.createInvokeProxy("features");this.aggregates=this._connection.createInvokeProxy("aggregates");this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}
l.FeaturePipelineWorkerProxy=t;l.createFeaturePipelineWorkerProxy=async function(q){q=await n.open("FeaturePipelineWorker",{client:q,strategy:"dedicated"});return new t(q)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/CircularArray ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d){l.FeatureSourceEventLog=class extends t{constructor(){super(...arguments);this.events=new y;this._updatingStrategy=!0;this._tileToEvent=new w;this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(m){switch(m.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(m);
break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,outstanding:0};this._strategyInfo=m.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",m);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),
m.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const m of this._tileToEvent.values())if("loaded"!==m.peekLast()?.type)return!1;return!0}_handleTileEvent(m){switch(m.type){case "subscribe":var c=new q(10);c.enqueue(m);this._tileToEvent.set(m.tile,c);break;case "unsubscribe":this._tileToEvent.delete(m.tile);break;case "loaded":c=this._tileToEvent.get(m.tile);if(!c)break;c.enqueue(m);this._tileToEvent.set(m.tile,
c);break;case "error":if(c=this._tileToEvent.get(m.tile))c.enqueue(m),this._tileToEvent.set(m.tile,c),this.events.emit("error",m)}}};n.__decorate([h.property({readOnly:!0})],l.FeatureSourceEventLog.prototype,"hasAllFeatures",null);n.__decorate([h.property({readOnly:!0})],l.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);n.__decorate([h.property({readOnly:!0})],l.FeatureSourceEventLog.prototype,"hasFullGeometries",null);n.__decorate([h.property()],l.FeatureSourceEventLog.prototype,"_updatingStrategy",
void 0);n.__decorate([h.property()],l.FeatureSourceEventLog.prototype,"_strategyInfo",void 0);n.__decorate([h.property()],l.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);l.FeatureSourceEventLog=n.__decorate([d.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],l.FeatureSourceEventLog);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(l,n,t,q,y,w,h,A){class k{constructor(g){this.layer=g}getLabelingDeconflictionInfo(g){g=this.layer;const d=y.getLayerDeconflictionEnabled(g);return[{vvEvaluators:{0:y.createLabelVVEvaluator(g.renderer)},deconflictionEnabled:d}]}async createServiceOptions(g){var d=this.layer;const {capabilities:m,editingInfo:c,objectIdField:a,globalIdField:b,datesInUnknownTimezone:u,orderBy:r,parsedUrl:f}=d,v=d.fieldsIndex.toJSON(),x=q.getEffectiveGeometryType(d),B=d.timeInfo?.toJSON();d=d.spatialReference.toJSON();
const I=n.clone(f);let J=a;if(r?.length){var L=!r[0].valueExpression&&r[0].field;L&&(J=L)}L=t.isHostedAgolService(I.path);return{type:"feature-service",source:I,isSourceHosted:L,orderByFields:J,outSpatialReference:g.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:u,globalIdField:b,fieldsIndex:v,geometryType:x,objectIdField:a,timeInfo:B,spatialReference:d,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:m.query.maxRecordCount,supportsCompactGeometry:m.query.supportsCompactGeometry,
supportsDefaultSpatialReference:m.query.supportsDefaultSpatialReference,supportsFormatPBF:m.query.supportsFormatPBF,supportsMaxRecordCountFactor:m.query.supportsMaxRecordCountFactor,supportsQuantization:m.query.supportsQuantization,lastEditDate:c?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(g,d){const {definitionExpression:m,customParameters:c,timeExtent:a,apiKey:b}=this.layer;return w.createFeatureSourceSchema({definitionExpression:m,customParameters:c,timeExtent:a},g,d,b)}createProcessorSchema(g,
d,m){const {fields:c,geometryType:a,orderBy:b,objectIdField:u,renderer:r,labelingInfo:f,labelsVisible:v}=this.layer,x={featureReduction:null,fields:c.map(B=>B.toJSON()),geometryType:a,labelingInfo:f,labelsVisible:v,objectIdField:u,orderBy:b??"default",renderer:r?.clone()};return h.createSimpleProcessorSchema(g,d,x,m)}get hasRequiredSupport(){return A.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(g){var d=this.layer;const {definitionExpression:m,
apiKey:c,renderer:a}=d;g=this.layer.labelsVisible?this.layer.labelingInfo:null;const b=JSON.stringify(d.customParameters);d=JSON.stringify(d.orderBy);return{outFields:this.layer.outFields,apiKey:c,customParameters:b,definitionExpression:m,labelingInfo:g,orderBy:d,renderer:a}}setGraphicOrigin(g){g.origin={type:"catalog",layer:this.layer}}}l.CatalogFootprintLayerAdapter=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],
function(l){l.getEffectiveGeometryType=function(n){switch(n.geometryType){case "point":return"esriGeometryPoint";case "polyline":return"esriGeometryPolyline";case "polygon":return"esriGeometryPolygon";case "multipatch":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";default:return null}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils",
"./featureReductionUtils","../../support/visualVariableSimpleUtils"],function(l,n,t,q){function y(w){return h=>n.pt2px(q.getSizeForValueSimple(h,w))}l.createLabelVVEvaluator=function(w){w=null!=w&&"visualVariables"in w&&w.visualVariables;if(!w)return null;for(const h of w)if("size"===h.type)return y(h);return null};l.getFeatureReductionDeconflictionEnabled=function(w,h){w=t.getEffectiveFeatureReduction(w,h);if(w?.labelsVisible&&w.labelingInfo?.length)return w.labelingInfo.every(A=>"none"!==A.deconflictionStrategy)};
l.getLayerDeconflictionEnabled=function(w){return(w.labelsVisible&&w.labelingInfo?.every(h=>"none"!==h.deconflictionStrategy))??!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],function(l){l.getEffectiveFeatureReduction=function(n,t){return(n=n.featureReduction)&&"selection"!==n.type?!("maxScale"in n&&n.maxScale)||n.maxScale<t.scale?n:null:null};Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],function(l,n,t,q){function y(k,g){switch(g.transformationType){case q.TransformationType.Additive:var d=w(g.minSize,k);return k+(d||g.minDataValue);case q.TransformationType.Constant:return d=g.stops,d=d?.length&&d[0].size,null==d&&(d=g.minSize),w(d,k);case q.TransformationType.ClampedLinear:d=
g.minDataValue;var m=g.maxDataValue,c=(k-d)/(m-d),a=w(g.minSize,k);g=w(g.maxSize,k);k=k<=d?a:k>=m?g:a+c*(g-a);return k;case q.TransformationType.Proportional:return d=k/g.minDataValue,m=w(g.minSize,k),k=w(g.maxSize,k),n.clamp(d*m,m,k);case q.TransformationType.Stops:{const [b,u,r]=h(k,g.cache.ipData);b===u?k=w(g.stops[b].size,k):(d=w(g.stops[b].size,k),k=w(g.stops[u].size,k),k=d+(k-d)*r)}return k;case q.TransformationType.RealWorldSize:return d=t.meterIn[g.valueUnit],m=w(g.minSize,k),c=w(g.maxSize,
k),{valueRepresentation:g}=g,a=null,a="area"===g?2*Math.sqrt(k/A)/d:"radius"===g||"distance"===g?2*k/d:k/d,n.clamp(a,m,c);case q.TransformationType.Identity:return k;case q.TransformationType.Unknown:return null}}function w(k,g){return"number"===typeof k?k:y(g,k)}function h(k,g){if(g){var d=0,m=g.length-1;g.some((c,a)=>{if(k<c)return m=a,!0;d=a;return!1});return[d,m,(k-g[d])/(g[m]-g[d])]}}const A=Math.PI;l.getSizeForValueSimple=y;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports",
"../../../../../core/sql"],function(l,n){l.createFeatureSourceSchema=function(t,q,y,w){const h=n.sqlAnd(t.definitionExpression,null!=t.subtypeCode?`${t.subtypeField} = ${t.subtypeCode}`:null),A=t.customParameters??{};w&&(A.token=w);return{type:"feature",mutable:{sourceRefreshVersion:y,availableFields:q.availableFields,dataFilter:{queryScaleRanges:t.queryScaleRanges??[],definitionExpression:h,gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?.getTime(),timeExtent:t.timeExtent?.toJSON(),customParameters:A}}}};
Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define("exports ../../../../../../core/screenUtils ../../../../../../layers/support/OrderByInfo ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema".split(" "),function(l,n,t,q,y,w,h){async function A(c,a){var b=a.renderer;const u=h.createVisualVariableUniforms(b);b=await y.createMatcherSchema(c,b);c=await q.createLabelMatcherSchema(c,
a,u);return{symbology:b,labels:c}}function k(c,a){return c.fields.map(b=>({...b.toJSON(),type:g(b,a)}))}function g(c,a){const {onStatisticExpression:b,onStatisticField:u,statisticType:r}=c;switch(r){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":return b?({returnType:c}=b,c?"string"===c?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"):(c=a.find(f=>f.name===u))?c.type:"esriFieldTypeString"}}async function d(c,a,b,
u,r){u=k(c,u.fields);var f=c.renderer;const v=await y.createMatcherSchema(a,f),x=w.createStorageSchema(f,[null,null]);f=h.createVisualVariableUniforms(f);a=await q.createLabelMatcherSchema(a,{geometryType:"polygon",labelingInfo:c.labelingInfo,labelsVisible:c.labelsVisible},f);c="geohash"===c.binType?{type:"geohash",fixBinLevel:c.fixedBinLevel??3}:{type:"grid",size:n.pt2px(c.size),fixedBinLevel:c.fixedBinLevel};return{storage:x,mesh:{properties:{sortKey:null,timeZone:b.timeZone,returnMeshObjectId:!1,
displayRefreshVersion:r},strategy:{type:"binning",fields:u,index:c,featureFilter:b.filters[0]},factory:{labels:a,symbology:v}}}}async function m(c,a,b,u,r){const f=k(c,u.fields),v={type:"cluster",feature:await y.createMatcherSchema(a,c.effectiveFeatureRenderer),cluster:await y.createMatcherSchema(a,c.effectiveClusterRenderer)},x=h.createVisualVariableUniforms(c.effectiveFeatureRenderer);a={type:"cluster",feature:await q.createLabelMatcherSchema(a,u,x),cluster:await q.createLabelMatcherSchema(a,{geometryType:"point",
labelingInfo:c.labelingInfo,labelsVisible:c.labelsVisible},x)};return{storage:w.createStorageSchema(c.effectiveFeatureRenderer,[null,null]),mesh:{properties:{sortKey:null,timeZone:b.timeZone,displayRefreshVersion:r,returnMeshObjectId:!1},strategy:{type:"cluster",fields:f,featureFilter:b.filters[0],clusterRadius:n.pt2px(c.clusterRadius/2)},factory:{labels:a,symbology:v}}}}l.createSimpleProcessorSchema=async function(c,a,b,u){var r=b.featureReduction;if(r)switch(r.type){case "binning":return d(r,c,
a,b,u);case "cluster":return m(r,c,a,b,u)}r=b.orderBy;var f=b.renderer;f=null!=f&&"unique-value"===f.type&&f.orderByClassesEnabled;"default"!==r||f||(r=[new t({field:b.objectIdField,order:"descending"})]);"default"!==r&&r.length?(r=r[0],f="ascending"===r.order?"asc":"desc",r=r.field?{field:r.field,order:f}:r.valueExpression?{expression:r.valueExpression,order:f}:null):r=f?{byRenderer:!0,order:"asc"}:null;f=w.createStorageSchema(b.renderer,a.filters);c=await A(c,b);return{storage:f,mesh:{properties:{sortKey:r,
timeZone:a.timeZone,returnMeshObjectId:!1,displayRefreshVersion:u},strategy:{type:"feature"},factory:c}}};l.getAggregateFields=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],function(l,n,t,q){async function y(w,h,A,k){w=await q.createSymbolMeshSchemas(h,{path:`${A}`,schemaOptions:w,
uniforms:k});return{maxScale:h.maxScale,minScale:h.minScale,expression:h.labelExpressionInfo?.expression??h.labelExpression,where:h.where,meshes:w}}l.createLabelMatcherSchema=async function(w,h,A){var k=h.labelsVisible&&h.labelingInfo||[];h=t.getEffectiveGeometryType(h);k=n.validateLabelingInfo(k,h);return{type:"label",classes:await Promise.all(k.map((g,d)=>y(w,g,d,A)))}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define("exports ../../../../../../../symbols ../../../../../../../core/Logger ../../../../../../../core/screenUtils ../../../../../../../renderers/support/heatmapUtils ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/SDFHelper ../../../../../engine/webgl/alignmentUtils ../../../../../engine/webgl/color ../../../../../engine/webgl/definitions ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../schemaUtils ../VisualVariablesSchema ./ComplexSymbolSchema ./utils ../../../../../../../symbols/SimpleFillSymbol ../../../../../../../symbols/SimpleMarkerSymbol ../../../../../../../symbols/SimpleLineSymbol".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m,c,a,b,u,r,f,v){async function x(p,C){if(!p)return[];switch(p.type){case "simple-fill":return L(p,C);case "picture-fill":{var {outline:D}=p;const {uniforms:S,schemaOptions:da}=C;var {store:M}=da,K=[];const fa=w.CIMSymbolHelper.createPictureFillRasterizationParam(p);if(fa){var {width:F,height:O,xoffset:T,yoffset:U,xscale:V,yscale:W}=p;p={color:[255,255,255,255],sprite:fa,height:O,aspectRatio:F/O,offsetX:T,offsetY:U,scaleX:V,scaleY:W,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,
scaleProportionally:!1,effects:null,scaleInfo:null};"solid"===D?.style?p=[M.ensureInstance(m.Techniques.complexOutlineFill,{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity,visualVariableSizeScaleStops:S.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...p,...J(D,!!S.visualVariableSizeOutlineScaleStops)})]:(M=M.ensureInstance(m.Techniques.complexFill,
{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}),K.push(M.createMeshInfo(p)),D&&K.push(...G(D,C,!0)),p=K)}else p=[]}return p;case "simple-marker":return I(p,C);case "picture-marker":{const {uniforms:S,schemaOptions:da}=C;({store:C}=da);C=C.ensureInstance(m.Techniques.marker,{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity,visualVariableSizeMinMaxValue:S.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:S.visualVariableSizeScaleStops,visualVariableSizeStops:S.visualVariableSizeStops,visualVariableSizeUnitValue:S.visualVariableSizeUnitValue,visualVariableRotation:S.visualVariableRotation},optionalAttributes:{zoomRange:!1}});p=(D=w.CIMSymbolHelper.createPictureMarkerRasterizationParam(p))?[C.createMeshInfo({type:"picture",color:[255,255,255,255],height:p.height,width:p.width,offsetX:p.xoffset,offsetY:p.yoffset,angle:p.angle,alignment:u.hasRotationVVUniform(S)?h.Alignment.MAP:
h.Alignment.SCREEN,outlineColor:null,outlineSize:0,referenceSize:p.height,sprite:D,overrideOutlineColor:!1,hasSizeVV:u.hasSizeVVUniform(S),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(S)})]:[]}return p;case "simple-line":return G(p,C,!1);case "text":const {uniforms:Q,schemaOptions:ea}=C;({store:C}=ea);return[C.ensureInstance(m.Techniques.text,{uniforms:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableRotation:Q.visualVariableRotation,
visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:p.backgroundColor?.toArray(),boxBorderLineColor:p.borderLineColor?.toArray(),boxBorderLineSize:p.borderLineSize??0,color:p.color?.toArray()??[0,0,0,0],offsetX:p.xoffset,
offsetY:p.yoffset,postAngle:p.angle,fontSize:p.font.size,decoration:p.font.decoration,haloColor:p.haloColor?.toArray()??[0,0,0,0],haloFontSize:p.haloSize??0,lineWidth:p.lineWidth,lineHeightRatio:p.lineHeight,horizontalAlignment:p.horizontalAlignment,verticalAlignment:p.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:p.font.toJSON(),textString:p.text,symbol:w.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(p)},overrides:[]},referenceSize:null,
effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:a.getMaxSizeVVSize(Q),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})];case "label":const {schemaOptions:aa,uniforms:Y}=C;({store:K}=aa);C=p.symbol;const {allowOverrun:ca,repeatLabel:R,repeatLabelDistance:ha}=p;D={maxScale:p.maxScale??0,minScale:p.minScale??0};K=K.ensureInstance(m.Techniques.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:Y.visualVariableRotation,
visualVariableSizeMinMaxValue:Y.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Y.visualVariableSizeScaleStops,visualVariableSizeStops:Y.visualVariableSizeStops,visualVariableSizeUnitValue:Y.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}});const [ia,ja]=k.getAlignmentFromPlacement(p.labelPlacement);return[K.createMeshInfo({boxBackgroundColor:C.backgroundColor?.toArray(),boxBorderLineColor:C.borderLineColor?.toArray(),boxBorderLineSize:C.borderLineSize??
0,color:C.color?.toArray()??[0,0,0,0],offsetX:C.xoffset,offsetY:C.yoffset,postAngle:C.angle,fontSize:C.font.size,decoration:C.font.decoration,haloColor:C.haloColor?.toArray()??[0,0,0,0],haloFontSize:C.haloSize??0,lineWidth:C.lineWidth,lineHeightRatio:C.lineHeight,horizontalAlignment:ia,verticalAlignment:ja,repeatLabel:R,repeatLabelDistance:q.pt2px(ha),allowOverrun:ca,labelPosition:p.labelPosition,scaleInfo:D,minPixelBuffer:a.getMaxSizeVVSize(Y),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",
resource:{type:"text",font:C.font.toJSON(),textString:C.text,symbol:w.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(C),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==p.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:p.labelExpressionInfo?.expression??p.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,
placement:null,transforms:null,scaleFactor:1,isLineLabel:!1})];case "cim":return b.createComplexSymbolInstances(p.data,C);case "web-style":return p=await p.fetchCIMSymbol(),b.createComplexSymbolInstances(p.data,C);case "line-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${p.type}" unsupported in MapView. Defaulting to simple-line`),G(new v,C,!1);case "point-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",
`Symbol of type "${p.type}" unsupported in MapView. Defaulting to simple-marker`),I(new f,C);case "polygon-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${p.type}" unsupported in MapView. Defaulting to simple-fill`),L(new r,C);case "mesh-3d":case "label-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${p.type}" unsupported in MapView. Ignoring`),[];case "CIMSymbolReference":throw Error("InternalError: CIMSymbolReference should already be resolved");
}}function B(p){if("path"===p.style){if(null==p.path)throw Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:p.path,asFill:!0}}}const C=w.CIMSymbolHelper.fromSimpleMarker(p);if("outline"in p&&p.outline&&"none"!==p.outline.style&&"solid"!==p.outline.style){if(!C||!C.symbolLayers)throw Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:C.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",
resource:A.getSDFInfo(C),overrides:[]}}async function I(p,C){const {uniforms:D,schemaOptions:M}=C;var {store:K}=M;if("path"===p.style||p.outline&&"solid"!==p.outline.style&&"none"!==p.outline.style){K=w.CIMSymbolHelper.fromSimpleMarker(p);if(!K||!K.symbolLayers)throw Error("Error handling marker! ");D.visualVariableRotation&&(K.angleAlignment="Map");if("path"!==p.style){var F=K.symbolLayers[0];if(u.hasSizeVVUniform(C.uniforms)){var O=a.getMaxSizeVVSize(C.uniforms,0,1);O>F.size&&(p=O/F.size,F.size=
O,F=F.markerGraphics?.[0].symbol,(F.symbolLayers&&F.symbolLayers[0]).width*=p)}}return b.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:K},C)}C=K.ensureInstance(m.Techniques.marker,{uniforms:{visualVariableColor:D.visualVariableColor,visualVariableOpacity:D.visualVariableOpacity,visualVariableSizeMinMaxValue:D.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:D.visualVariableSizeScaleStops,visualVariableSizeStops:D.visualVariableSizeStops,visualVariableSizeUnitValue:D.visualVariableSizeUnitValue,
visualVariableRotation:D.visualVariableRotation},optionalAttributes:{zoomRange:!1}});K=B(p);F=p.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===K.resource.type&&(F=[255,255,255,255]);O=p.size;const T=null!=D.visualVariableColor&&("cross"===p.style||"x"===p.style);return[C.createMeshInfo({type:"simple",color:F,height:O,width:O*("triangle"===p.style?124/116:1),offsetX:p.xoffset,offsetY:p.yoffset,angle:p.angle,alignment:u.hasRotationVVUniform(D)?h.Alignment.MAP:h.Alignment.SCREEN,outlineColor:p.outline?.color?.toArray()??
[0,0,0,0],outlineSize:p.outline?.width??1,referenceSize:O,sprite:K,overrideOutlineColor:T,hasSizeVV:u.hasSizeVVUniform(D),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(D)})]}function J(p,C){const D=p.width;return{outlineColor:p.color?.toArray()||[0,0,0,1],width:D,referenceWidth:D,capType:p.cap??"round",joinType:p.join??"round",miterLimit:p.miterLimit,hasSizeVV:C}}function L(p,C){var {style:D}=p;if(D&&"none"!==D&&"solid"!==D){{const {uniforms:F,schemaOptions:O}=
C;var {store:M}=O;D=p.color?.toArray()??[0,0,0,0];var K={type:"sprite-rasterization-param",resource:{type:"fill-style",style:p.style},overrides:[]};"solid"===p.outline?.style?p=[M.ensureInstance(m.Techniques.patternOutlineFill,{uniforms:{visualVariableColor:F.visualVariableColor,visualVariableOpacity:F.visualVariableOpacity,visualVariableSizeScaleStops:F.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:D,
...J(p.outline,!!F.visualVariableSizeOutlineScaleStops),sprite:K,scaleInfo:null,effects:null})]:(D=[],M=M.ensureInstance(m.Techniques.patternFill,{uniforms:{visualVariableColor:F.visualVariableColor,visualVariableOpacity:F.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:p.color?.toArray()??[0,0,0,0],sprite:K,scaleInfo:null,effects:null}),D.push(M),p.outline&&D.push(...G(p.outline,C,!0)),p=D)}return p}{const {uniforms:F,schemaOptions:O}=C;({store:M}=O);K=p.color?.toArray()??
[0,0,0,0];"none"!==p.style&&"solid"===p.outline?.style?p=[M.ensureInstance(m.Techniques.outlineFill,{uniforms:{visualVariableColor:F.visualVariableColor,visualVariableOpacity:F.visualVariableOpacity,visualVariableSizeScaleStops:F.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:K,...J(p.outline,!!F.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})]:
(D=[],"none"!==p.style&&(M=M.ensureInstance(m.Techniques.fill,{uniforms:{visualVariableColor:F.visualVariableColor,visualVariableOpacity:F.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:K,scaleInfo:null,effects:null}),D.push(M)),p.outline&&D.push(...G(p.outline,C,!0)),p=D)}return p}function G(p,C,D){const {color:M,style:K,width:F,cap:O,join:T}=p;var {schemaOptions:U}=C,{store:V}=U;U=[];var W=D?{...a.noVisualVariables,visualVariableSizeScaleStops:C.uniforms.visualVariableSizeOutlineScaleStops}:
C.uniforms;D={uniforms:{visualVariableColor:W.visualVariableColor,visualVariableOpacity:W.visualVariableOpacity,visualVariableSizeMinMaxValue:W.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:W.visualVariableSizeScaleStops,visualVariableSizeStops:W.visualVariableSizeStops,visualVariableSizeUnitValue:W.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}};W={color:M?.toArray()??[0,0,0,0],width:F,referenceWidth:F,capType:O,joinType:T,miterLimit:p.miterLimit,hasSizeVV:u.hasSizeVVUniform(W),
effects:null,scaleInfo:null};null==K||"solid"===K?(V=V.ensureInstance(m.Techniques.line,D).createMeshInfo(W),U.push(V)):"none"!==K&&(V=V.ensureInstance(m.Techniques.texturedLine,D).createMeshInfo({...W,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:w.slsDashToTemplateArray(K,O),capStyle:w.capTypeToEnum(O)},overrides:[]}}),U.push(V));if(null!=p.marker){V=U.push;D=p.marker;const {uniforms:Q,schemaOptions:ea}=C;({store:C}=
ea);C=C.ensureInstance(m.Techniques.marker,{uniforms:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue,visualVariableRotation:Q.visualVariableRotation},optionalAttributes:{zoomRange:!1}});W=B(D);const aa=6*p.width,Y=D.color?.toArray()??
p.color?.toArray()??[0,0,0,0],ca="cross"===D.style||"x"===D.style;switch(D.placement){case "begin-end":D=h.ExtremityPlacement.Both;break;case "begin":D=h.ExtremityPlacement.JustBegin;break;case "end":D=h.ExtremityPlacement.JustEnd;break;default:D=h.ExtremityPlacement.None}D={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:D,offsetAlongLine:0},overrides:[]};p=[C.createMeshInfo({type:"simple",color:Y,height:aa,width:aa,offsetX:0,
offsetY:0,angle:0,alignment:u.hasRotationVVUniform(Q)?h.Alignment.MAP:h.Alignment.SCREEN,outlineColor:Y,outlineSize:ca?p.width:0,referenceSize:aa/6,sprite:W,overrideOutlineColor:ca&&null!=Q.visualVariableColor,hasSizeVV:u.hasSizeVVUniform(Q),placement:D,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(Q)})];V.call(U,...p)}return U}l.createDotDensityMeshSchemas=async function(p,C){var {schemaOptions:D}=C;({store:D}=D);var M=Array(d.dotDensityMaxFields),K=Array(d.dotDensityMaxFields/
4);for(var F=0;F<d.dotDensityMaxFields;F++){const O=F<p.attributes.length?p.attributes[F].color:null;M[F]=[0,0,0,0];g.writeColor(M[F],O)}for(F=0;F<d.dotDensityMaxFields/4;F++)K[F]=[0,0,0,0],K[F][0]=4*F<p.attributes.length?1:0,K[F][1]=4*F+1<p.attributes.length?1:0,K[F][2]=4*F+2<p.attributes.length?1:0,K[F][3]=4*F+3<p.attributes.length?1:0;M=D.ensureInstance(m.Techniques.dotDensity,{uniforms:{isActive:K,colors:M,dotValue:p.dotValue,dotScale:p.referenceScale,blending:p.dotBlendingEnabled,dotSize:p.dotSize,
seed:p.seed},optionalAttributes:{}}).createMeshInfo({effects:null});D=[];p.backgroundColor&&(K=new r({color:p.backgroundColor,outline:null}),K=await x(K,C),D.push(...K));D.push(M);p.outline&&(p=G(p.outline,C,!0),D.push(...p));return D};l.createHeatmapMeshSchemas=async function(p,C){({store:C}=C);const {radius:D,minDensity:M,maxDensity:K,referenceScale:F,field:O,valueExpression:T,colorStops:U}=p;p=y.generateGradient(U);return[C.ensureInstance(m.Techniques.heatmap,{uniforms:{radius:q.pt2px(D),minDensity:M,
maxDensity:K,referenceScale:F,isFieldActive:!(!O&&!T),gradient:p,gradientHash:p.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]};l.createLineInstance=G;l.createPieChartMeshSchemas=function(p,C){var {store:D}=C;const M=p.outline?.width||0,K=a.createVisualVariableUniforms(p);D=D.ensureInstance(m.Techniques.pieChart,{uniforms:{shader:{outlineWidth:Math.round(q.pt2px(M)),defaultColor:c.premultiplyColor(p.defaultColor),outlineColor:c.premultiplyColor(p.outline?.color),othersColor:c.premultiplyColor(p.othersCategory?.color),
donutRatio:p.holePercentage,sectorThreshold:p.othersCategory?.threshold||0,colors:p.attributes.map(F=>c.premultiplyColor(F.color)),visualVariableOpacity:K.visualVariableOpacity,visualVariableSizeMinMaxValue:K.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:K.visualVariableSizeScaleStops,visualVariableSizeStops:K.visualVariableSizeStops,visualVariableSizeUnitValue:K.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:p.attributes.length},optionalAttributes:{}}).createMeshInfo({size:p.size,
outlineWidth:M,effects:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(K)});return[...(p.backgroundFillSymbol?L(p.backgroundFillSymbol,{schemaOptions:C,path:"",uniforms:a.noVisualVariables}):[]),D]};l.createSymbolMeshSchemas=x;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],function(l,n,t){async function q(g,d){var m=d.getSymbols();m=
m.length?m[0]:null;d=n.createVisualVariableUniforms(d);return{type:"simple",meshes:await t.createSymbolMeshSchemas(m,{schemaOptions:g,uniforms:d,path:"renderer.symbol"})}}async function y(g,d){const m=n.createVisualVariableUniforms(d);return{type:"dot-density",meshes:await t.createDotDensityMeshSchemas(d,{schemaOptions:g,uniforms:m,path:"renderer.symbol"})}}async function w(g,d){const m=n.createVisualVariableUniforms(d);var c=d.backgroundFillSymbol,a=d.normalizationType;a="log"===a?"esriNormalizeByLog":
"percent-of-total"===a?"esriNormalizeByPercentOfTotal":"field"===a?"esriNormalizeByField":null;var b=d.classBreakInfos.map(async r=>({meshes:await t.createSymbolMeshSchemas(r.symbol,{path:`renderer-stop-${r.minValue}-${r.maxValue}`,schemaOptions:g,uniforms:m}),min:r.minValue,max:r.maxValue}));b=(await Promise.all(b)).sort((r,f)=>r.min-f.min);c=await t.createSymbolMeshSchemas(c,{schemaOptions:g,path:"renderer.backgroundFill",uniforms:{...n.noVisualVariables,visualVariableSizeOutlineScaleStops:m.visualVariableSizeOutlineScaleStops}});
const u=await t.createSymbolMeshSchemas(d.defaultSymbol,{schemaOptions:g,path:"renderer.defaultSymbol",uniforms:m});return{type:"interval",field:d.field,expression:d.valueExpression,backgroundFill:c,defaultSymbol:u,intervals:b,normalizationField:d.normalizationField,normalizationTotal:d.normalizationTotal,normalizationType:a,isMaxInclusive:d.isMaxInclusive}}async function h(g,d){const m=[],c=n.createVisualVariableUniforms(d),a=await t.createSymbolMeshSchemas(d.backgroundFillSymbol,{schemaOptions:g,
path:"renderer.backgroundFill",uniforms:{...n.noVisualVariables,visualVariableSizeOutlineScaleStops:c.visualVariableSizeOutlineScaleStops}}),b=await t.createSymbolMeshSchemas(d.defaultSymbol,{schemaOptions:g,path:"renderer.defaultSymbol",uniforms:c});for(const u of d.uniqueValueInfos??[]){const r=await t.createSymbolMeshSchemas(u.symbol,{path:`renderer-unique-value-${u.value}`,schemaOptions:g,uniforms:c});m.push({value:""+u.value,symbol:r})}return{type:"map",field:d.field,expression:d.valueExpression,
field2:d.field2,field3:d.field3,fieldDelimiter:d.fieldDelimiter,backgroundFill:a,defaultSymbol:b,map:m}}async function A(g,d){return{type:"heatmap",meshes:await t.createHeatmapMeshSchemas(d,g)}}async function k(g,d){return{type:"pie-chart",meshes:t.createPieChartMeshSchemas(d,g)}}l.createMatcherSchema=async function(g,d){if(!d)return{type:"simple",meshes:[]};switch(d.type){case "simple":return q(g,d);case "dot-density":return y(g,d);case "class-breaks":return w(g,d);case "unique-value":return h(g,
d);case "dictionary":g=n.createVisualVariableUniforms(d);const m=d.scaleExpression;return{type:"dictionary",fieldMap:d.fieldMap,scaleExpression:null!=m&&"1"!==m?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:d.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:g};case "heatmap":return A(g,d);case "pie-chart":return k(g,d)}};l.createSimpleMatcherSchemaFromSymbol=async function(g,d,m){return{type:"simple",meshes:await t.createSymbolMeshSchemas(d,{schemaOptions:g,
path:m,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m){class c{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=k.getFeatureReductionDeconflictionEnabled(b,a)??k.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:k.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;const {capabilities:u,editingInfo:r,objectIdField:f,typeIdField:v,globalIdField:x,datesInUnknownTimezone:B,orderBy:I,subtypeField:J,refreshInterval:L}=b,G=b.fieldsIndex.toJSON(),
p=G.fields,C=A.getEffectiveGeometryType(b),D=b.timeInfo?.toJSON(),M=b.spatialReference.toJSON(),K=b.types?.map(V=>V.toJSON()),F=t.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(F.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let O=this.layer.objectIdField;if(I?.length){var T=!I[0].valueExpression&&I[0].field;T&&(O=T)}T=null==r?.lastEditDate&&0<L;b=(T=n("featurelayer-snapshot-enabled")&&"point"===b.geometryType&&u?.query.supportsPagination&&!u?.operations.supportsEditing&&
!T)&&w.exceedsMinimumSnapshotCoverage(a,b.fullExtent);const U=q.isHostedAgolService(F.path);return{type:"feature-service",source:F,isSourceHosted:U,orderByFields:O,outSpatialReference:a.spatialReference.toJSON(),metadata:{typeIdField:v??void 0,types:K,timeReferenceUnknownClient:B,subtypeField:J,globalIdField:x,fields:p,fieldsIndex:G,geometryType:C,objectIdField:f,timeInfo:D,spatialReference:M,subtypes:this.layer.subtypes?.map(V=>V.toJSON())},queryMetadata:{maxRecordCount:u.query.maxRecordCount,supportsCompactGeometry:u.query.supportsCompactGeometry,
supportsDefaultSpatialReference:u.query.supportsDefaultSpatialReference,supportsFormatPBF:u.query.supportsFormatPBF,supportsMaxRecordCountFactor:u.query.supportsMaxRecordCountFactor,supportsQuantization:u.query.supportsQuantization,lastEditDate:r?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:T,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(a,b){const {definitionExpression:u,
customParameters:r,gdbVersion:f,historicMoment:v,subtypeCode:x,subtypeField:B,timeExtent:I,apiKey:J}=this.layer;return g.createFeatureSourceSchema({definitionExpression:u,customParameters:r,gdbVersion:f,historicMoment:v,subtypeCode:x,subtypeField:B,timeExtent:I},a,b,J)}createProcessorSchema(a,b,u){const {fields:r,renderer:f,geometryType:v,labelingInfo:x,labelsVisible:B,orderBy:I,objectIdField:J}=this.layer,L={fields:r.map(G=>G.toJSON()),renderer:f?.clone(),featureReduction:y.getEffectiveFeatureReduction(this.layer,
b),geometryType:v,labelingInfo:x,labelsVisible:B,objectIdField:J,orderBy:I??"default"};return d.createSimpleProcessorSchema(a,b,L,u)}get hasRequiredSupport(){return m.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(a){return h.hasFloorFilter(this.layer,a)}addFilters(a,b){return h.addFloorFilter(this.layer,a,b)}getUpdateHashProperties(a){var b=this.layer;const {definitionExpression:u,renderer:r,gdbVersion:f,apiKey:v,subtypeCode:x}=b,B=this.layer.labelsVisible?
this.layer.labelingInfo:null,I=b.historicMoment?.getTime()??void 0,J=JSON.stringify(b.customParameters),L=y.getEffectiveFeatureReduction(b,a);b=JSON.stringify(b.orderBy);a=h.hasFloorFilter(this.layer,a)?a.floors:null;return{outFields:this.layer.outFields,apiKey:v,customParameters:J,definitionExpression:u,featureReduction:L,floors:a,gdbVersion:f,historicMoment:I,labelingInfo:B,orderBy:b,renderer:r,subtypeCode:x}}}l.FeatureLayerAdapter=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],function(l,n){l.exceedsMinimumSnapshotCoverage=function(t,q){t=t.extent;t=q?.clone().intersection(t);t=null!=t?t.width*t.height:0;q=q?q.width*q.height:0;q=0===q?0:t/q;t=n("featurelayer-snapshot-point-coverage");return!isNaN(q)&&q>=t};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports",
"../../../../../core/sql","../../../../../layers/support/FeatureFilter"],function(l,n,t){function q(y,w,h){if(null==y.floorInfo||!h.floors?.length)return w;h=h.floors;const {floorField:A,viewAllLevelIds:k}=y.floorInfo;k.length&&(h=k);y=h.filter(g=>""!==g).map(g=>"'"+g+"'");y.push("''");w?.includes(A)&&(h=new RegExp("AND \\("+A+".*NULL\\)","g"),w=w.replace(h,""),h=new RegExp("\\("+A+".*NULL\\)","g"),w=w.replace(h,""),w=w.replaceAll(/\s+/g," ").trim());y=("("+A+" IN ({ids}) OR "+A+" IS NULL)").replace("{ids}",
y.join(", "));return n.sqlAnd(w,y)}l.addFloorFilter=function(y,w,h){y=q(y,w?.where,h);if(!y)return w;w??=new t;w.where=y;return w};l.hasFloorFilter=function(y,w){return null!=y.floorInfo&&(0<y.floorInfo.viewAllLevelIds.length||0<w.floors.length)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define("exports ../../../../../core/Error ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(l,n,t,q,y,w,h,A){class k{constructor(g){this.layer=g}getLabelingDeconflictionInfo(g){const d=this.layer;g=y.getFeatureReductionDeconflictionEnabled(d,g)??y.getLayerDeconflictionEnabled(d);return[{vvEvaluators:{0:y.createLabelVVEvaluator(d.renderer)},deconflictionEnabled:g}]}async createServiceOptions(g){const d=this.layer,{capabilities:m,objectIdField:c}=d,a=d.fieldsIndex.toJSON(),b=q.getEffectiveGeometryType(d),u=d.timeInfo?.toJSON(),r=d.spatialReference.toJSON();if(!("openPorts"in d.source))throw new n("source-not-supported");
return{type:"memory",source:await d.source.openPorts(),orderByFields:c,outSpatialReference:g.spatialReference.toJSON(),metadata:{fieldsIndex:a,geometryType:b,objectIdField:c,timeInfo:u,spatialReference:r,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{maxRecordCount:m.query.maxRecordCount,supportsCompactGeometry:m.query.supportsCompactGeometry,supportsDefaultSpatialReference:m.query.supportsDefaultSpatialReference,supportsFormatPBF:m.query.supportsFormatPBF,
supportsMaxRecordCountFactor:m.query.supportsMaxRecordCountFactor,supportsQuantization:m.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(g,d){const {definitionExpression:m,timeExtent:c}=this.layer;return w.createFeatureSourceSchema({definitionExpression:m,timeExtent:c,customParameters:null},g,d,null)}createProcessorSchema(g,d,m){const {fields:c,renderer:a,geometryType:b,labelingInfo:u,labelsVisible:r,orderBy:f,objectIdField:v}=this.layer,x={fields:c.map(B=>B.toJSON()),
renderer:a?.clone(),featureReduction:t.getEffectiveFeatureReduction(this.layer,d),geometryType:b,labelingInfo:u,labelsVisible:r,objectIdField:v,orderBy:f??"default"};return h.createSimpleProcessorSchema(g,d,x,m)}get hasRequiredSupport(){return A.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(g){const d=this.layer,{definitionExpression:m,renderer:c}=d,a=this.layer.labelsVisible?this.layer.labelingInfo:null;g=t.getEffectiveFeatureReduction(d,g);
return{orderBy:JSON.stringify(d.orderBy),definitionExpression:m,renderer:c,labelingInfo:a,featureReduction:g}}}l.InMemoryLayerAdapter=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(l,n,t,q,y,w,h){class A{constructor(k){this.layer=
k;this.timeOptions=null}getLabelingDeconflictionInfo(k){const g=this.layer;k=q.getFeatureReductionDeconflictionEnabled(g,k)??q.getLayerDeconflictionEnabled(g);return[{vvEvaluators:{0:q.createLabelVVEvaluator(g.renderer)},deconflictionEnabled:k}]}async createServiceOptions(k){const g=this.layer,{capabilities:d,objectIdField:m}=g,c=g.fieldsIndex.toJSON(),a=t.getEffectiveGeometryType(g),b=g.spatialReference.toJSON();return{type:"memory",source:await g.source.openPorts(),orderByFields:m,outSpatialReference:k.spatialReference.toJSON(),
metadata:{fieldsIndex:c,geometryType:a,objectIdField:m,spatialReference:b,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,
lastEditDate:null,snapshotInfo:null}}}createSourceSchema(k,g){const {definitionExpression:d}=this.layer;return y.createFeatureSourceSchema({definitionExpression:d,customParameters:null},k,g,null)}createProcessorSchema(k,g,d){const {fields:m,renderer:c,geometryType:a,labelingInfo:b,labelsVisible:u,objectIdField:r}=this.layer,f={fields:m.map(v=>v.toJSON()),renderer:c?.clone(),featureReduction:n.getEffectiveFeatureReduction(this.layer,g),geometryType:a,labelingInfo:b,labelsVisible:u,objectIdField:r,
orderBy:"default"};return w.createSimpleProcessorSchema(k,g,f,d)}get hasRequiredSupport(){return h.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(k){const g=this.layer,{definitionExpression:d,renderer:m}=g,c=this.layer.labelsVisible?this.layer.labelingInfo:null;k=n.getEffectiveFeatureReduction(g,k);return{definitionExpression:d,renderer:m,labelingInfo:c,featureReduction:k}}}l.KnowledgeGraphSublayerAdapter=A;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define("exports ../../../../../core/lang ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(l,n,t,q,y,w,h,A){class k{constructor(g){this.layer=g}getLabelingDeconflictionInfo(g){const d=this.layer;g=y.getFeatureReductionDeconflictionEnabled(d,g)??y.getLayerDeconflictionEnabled(d);return[{vvEvaluators:{0:y.createLabelVVEvaluator(d.renderer)},deconflictionEnabled:g}]}async createServiceOptions(g){var d=this.layer;const {capabilities:m,objectIdField:c}=d,a=d.fieldsIndex.toJSON(),b=q.getEffectiveGeometryType(d),u=d.timeInfo?.toJSON(),r=d.spatialReference.toJSON();d=d.source.getSource();
const f=this.layer.objectIdField,v=n.clone(m);v.query.maxRecordCount=d.maxRecordCount;return{type:"ogc",source:d,orderByFields:f,outSpatialReference:g.spatialReference.toJSON(),metadata:{fieldsIndex:a,geometryType:b,objectIdField:c,timeInfo:u,spatialReference:r,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:v.query.maxRecordCount,supportsCompactGeometry:v.query.supportsCompactGeometry,supportsDefaultSpatialReference:v.query.supportsDefaultSpatialReference,
supportsFormatPBF:v.query.supportsFormatPBF,supportsMaxRecordCountFactor:v.query.supportsMaxRecordCountFactor,supportsQuantization:v.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(g,d){const {customParameters:m,timeExtent:c,apiKey:a}=this.layer;return w.createFeatureSourceSchema({customParameters:m,timeExtent:c},g,d,a)}createProcessorSchema(g,d,m){const {fields:c,renderer:a,geometryType:b,labelingInfo:u,labelsVisible:r,orderBy:f,objectIdField:v}=this.layer,x={fields:c.map(B=>
B.toJSON()),renderer:a?.clone(),featureReduction:t.getEffectiveFeatureReduction(this.layer,d),geometryType:b,labelingInfo:u,labelsVisible:r,objectIdField:v,orderBy:f??"default"};return h.createSimpleProcessorSchema(g,d,x,m)}get hasRequiredSupport(){return A.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(g){var d=this.layer;const {renderer:m,apiKey:c}=d,a=this.layer.labelsVisible?this.layer.labelingInfo:null,b=JSON.stringify(d.customParameters);
g=t.getEffectiveFeatureReduction(d,g);d=JSON.stringify(d.orderBy);return{apiKey:c,customParameters:b,featureReduction:g,labelingInfo:a,orderBy:d,renderer:m}}}l.OGCFeatureLayerAdapter=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m){class c{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=k.getFeatureReductionDeconflictionEnabled(b,a)??k.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:k.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;const {capabilities:u,objectIdField:r,globalIdField:f,orderBy:v,refreshInterval:x}=b,B=b.fieldsIndex.toJSON(),I=B.fields,J=A.getEffectiveGeometryType(b),L=b.timeInfo?.toJSON(),
G=b.spatialReference.toJSON(),p=t.clone(this.layer.parsedUrl);let C=this.layer.objectIdField;if(v?.length){var D=!v[0].valueExpression&&v[0].field;D&&(C=D)}D=0<x;b=(D=n("featurelayer-snapshot-enabled")&&"point"===b.geometryType&&u?.query.supportsPagination&&!u?.operations.supportsEditing&&!D)&&w.exceedsMinimumSnapshotCoverage(a,b.fullExtent);const M=q.isHostedAgolService(p.path);return{type:"feature-service",source:p,isSourceHosted:M,orderByFields:C,outSpatialReference:a.spatialReference.toJSON(),
metadata:{globalIdField:f,fields:I,fieldsIndex:B,geometryType:J,objectIdField:r,timeInfo:L,spatialReference:G,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:u.query.maxRecordCount,supportsCompactGeometry:u.query.supportsCompactGeometry,supportsDefaultSpatialReference:u.query.supportsDefaultSpatialReference,supportsFormatPBF:u.query.supportsFormatPBF,supportsMaxRecordCountFactor:u.query.supportsMaxRecordCountFactor,supportsQuantization:u.query.supportsQuantization,
lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:D,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(a,b){const {definitionExpression:u,customParameters:r,timeExtent:f}=this.layer;return g.createFeatureSourceSchema({definitionExpression:u,customParameters:r,timeExtent:f},a,b,null)}createProcessorSchema(a,b,u){const {fields:r,renderer:f,geometryType:v,labelingInfo:x,
labelsVisible:B,orderBy:I,objectIdField:J}=this.layer,L={fields:r.map(G=>G.toJSON()),renderer:f?.clone(),featureReduction:y.getEffectiveFeatureReduction(this.layer,b),geometryType:v,labelingInfo:x,labelsVisible:B,objectIdField:J,orderBy:I??"default"};return d.createSimpleProcessorSchema(a,b,L,u)}get hasRequiredSupport(){return m.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(a){return h.hasFloorFilter(this.layer,a)}addFilters(a,b){return h.addFloorFilter(this.layer,
a,b)}getUpdateHashProperties(a){var b=this.layer;const {definitionExpression:u,renderer:r,outFields:f}=b,v=this.layer.labelsVisible?this.layer.labelingInfo:null,x=JSON.stringify(b.customParameters),B=y.getEffectiveFeatureReduction(b,a);b=JSON.stringify(b.orderBy);a=h.hasFloorFilter(this.layer,a)?a.floors:null;return{outFields:f,orderBy:b,definitionExpression:u,renderer:r,labelingInfo:v,featureReduction:B,customParameters:x,floors:a}}}l.OrientedImageryLayerAdapter=c;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(l,n,t,q,y,w){class h{constructor(A){this.layer=A}getLabelingDeconflictionInfo(A){const k=this.layer;A=q.getFeatureReductionDeconflictionEnabled(k,A)??q.getLayerDeconflictionEnabled(k);return[{vvEvaluators:{0:q.createLabelVVEvaluator(k.renderer)},
deconflictionEnabled:A}]}async createServiceOptions(A){var k=this.layer;const {objectIdField:g}=k,d=t.getEffectiveGeometryType(k),m=k.timeInfo?.toJSON()||null;k=k.spatialReference?k.spatialReference.toJSON():null;return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:A.spatialReference.toJSON(),metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:d,objectIdField:g,timeInfo:m,timeReferenceUnknownClient:null,spatialReference:k,subtypeField:null,subtypes:null,globalIdField:null,
typeIdField:null,types:null}}}createSourceSchema(A,k){const {definitionExpression:g,geometryDefinition:d,customParameters:m}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:k,availableFields:A.availableFields,dataFilter:{geometryDefinition:d?.toJSON(),definitionExpression:g,customParameters:m??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(A,
k,g){const {fields:d,renderer:m,geometryType:c,labelingInfo:a,labelsVisible:b,objectIdField:u}=this.layer,r={fields:d.map(f=>f.toJSON()),renderer:m?.clone(),featureReduction:n.getEffectiveFeatureReduction(this.layer,k),geometryType:c,labelingInfo:a,labelsVisible:b,objectIdField:u,orderBy:"default"};return y.createSimpleProcessorSchema(A,k,r,g)}get hasRequiredSupport(){return w.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(A){const k=this.layer,
{definitionExpression:g,renderer:d}=k,m=this.layer.labelsVisible?this.layer.labelingInfo:null,c=JSON.stringify(k.customParameters);A=n.getEffectiveFeatureReduction(k,A);return{definitionExpression:g,renderer:d,labelingInfo:m,featureReduction:A,customParameters:c,geometryDefinition:k.geometryDefinition,definitionExpressoin:k.definitionExpression}}}l.StreamLayerAdapter=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../core/mathUtils ../../../../../core/sql ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/FeatureFilter ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SubtypeProcessorSchema".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m,c){function a(r,f){return r.sublayers.some(v=>!b(v,f))}function b(r,f){return r.visible&&(0===r.minScale||q.floatEqualAbsolute(f.scale,r.minScale)||f.scale<r.minScale)&&(0===r.maxScale||q.floatEqualAbsolute(f.scale,r.maxScale)||f.scale>r.maxScale)}class u{constructor(r){this.layer=r}getLabelingDeconflictionInfo(r){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(f=>d.getLayerDeconflictionEnabled(f))}]}async createServiceOptions(r){var f=this.layer;
const {capabilities:v,datesInUnknownTimezone:x,editingInfo:B,globalIdField:I,objectIdField:J,refreshInterval:L,subtypeField:G}=f,p=f.fieldsIndex.toJSON(),C=g.getEffectiveGeometryType(f),D=f.timeInfo?.toJSON(),M=f.spatialReference.toJSON(),K=t.clone(this.layer.parsedUrl);var F=null==B?.lastEditDate&&0<L;f=(F=n("featurelayer-snapshot-enabled")&&"point"===f.geometryType&&v?.query.supportsPagination&&!v?.operations.supportsEditing&&!F)&&A.exceedsMinimumSnapshotCoverage(r,f.fullExtent);const O=w.isHostedAgolService(K.path);
return{type:"feature-service",source:K,isSourceHosted:O,orderByFields:J,outSpatialReference:r.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:x,subtypeField:G,globalIdField:I,fieldsIndex:p,geometryType:C,objectIdField:J,timeInfo:D,spatialReference:M,subtypes:this.layer.subtypes?.map(T=>T.toJSON()),typeIdField:null,types:null},queryMetadata:{maxRecordCount:v.query.maxRecordCount,supportsCompactGeometry:v.query.supportsCompactGeometry,supportsDefaultSpatialReference:v.query.supportsDefaultSpatialReference,
supportsFormatPBF:v.query.supportsFormatPBF,supportsMaxRecordCountFactor:v.query.supportsMaxRecordCountFactor,supportsQuantization:v.query.supportsQuantization,lastEditDate:B?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:F,supportsSnapshotMaxThreshold:f,snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(r,f){const {definitionExpression:v,customParameters:x,gdbVersion:B,historicMoment:I,
subtypeField:J,timeExtent:L,apiKey:G}=this.layer,p={queryScaleRanges:this.layer.sublayers.items.map(C=>({subtypeCode:C.subtypeCode,minScale:C.minScale,maxScale:C.maxScale})),definitionExpression:v,customParameters:x,gdbVersion:B,historicMoment:I,subtypeField:J,timeExtent:L};return m.createFeatureSourceSchema(p,r,f,G)}createProcessorSchema(r,f,v){const x={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,B=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:B.labelingInfo,
labelsVisible:B.labelsVisible,renderer:B.renderer,subtypeCode:B.subtypeCode,orderBy:null}))};return c.createSubtypeProcessorSchema(r,f,x,v)}hasFilters(r){return k.hasFloorFilter(this.layer,r)||a(this.layer,r)}addFilters(r,f){r=k.addFloorFilter(this.layer,r,f);var v=this.layer.sublayers.filter(x=>!b(x,f)).map(x=>x.subtypeCode);if(!v.length)return r;r??=new h;v=`NOT ${this.layer.subtypeField} IN (${v.join(",")})`;r.where=y.sqlAnd(r.where,v);return r}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(r){var f=
this.layer;const {definitionExpression:v,gdbVersion:x,apiKey:B}=f,I=f.historicMoment?.getTime()??void 0;f=JSON.stringify(f.customParameters);r=k.hasFloorFilter(this.layer,r)?r.floors:null;const J=this.layer.sublayers.map(({renderer:L,labelsVisible:G,labelingInfo:p,visible:C})=>({renderer:L,labelsVisible:G,labelingInfo:p,visible:C}));return{outFields:this.layer.outFields,gdbVersion:x,definitionExpression:v,historicMoment:I,customParameters:f,apiKey:B,sublayers:J,floors:r}}setGraphicOrigin(r){var f=
this.layer.fieldsIndex.get(this.layer.subtypeField);const v=r.attributes[f.name];f=this.layer.sublayers.find(x=>x.subtypeCode===v);r.layer=r.sourceLayer=f}}l.SubtypeGroupLayerAdapter=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define("exports ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema ../../../../../webgl/capabilities".split(" "),function(l,n,t,q,y,w){async function h(g,
{subtypeField:d,sublayers:m}){const c=await Promise.all(m.map(({renderer:a})=>t.createMatcherSchema(g,a)));return{type:"subtype",subtypeField:d,renderers:m.reduce((a,{subtypeCode:b},u)=>({...a,[b]:c[u]}),{})}}function A(g,d){const m=w.getWebGLCapabilities();return{type:"subtype",filters:g.filters,capabilities:{maxTextureSize:m.maxTextureSize},subtypeField:d.subtypeField,target:"feature",bindings:d.sublayers.reduce((c,{renderer:a,subtypeCode:b})=>{a=q.createVVBindings(a);return{...c,[b]:a}},{})}}async function k(g,
{subtypeField:d,sublayers:m}){const c=await Promise.all(m.map(a=>{const b=y.createVisualVariableUniforms(a.renderer);return n.createLabelMatcherSchema(g,{...a,geometryType:a.geometryType??null},b)}));return{type:"subtype",subtypeField:d,renderers:m.reduce((a,{subtypeCode:b},u)=>({...a,[b]:c[u]}),{})}}l.createSubtypeProcessorSchema=async function(g,d,m,c){return{storage:A(d,m),mesh:{properties:{timeZone:d.timeZone,displayRefreshVersion:c,returnMeshObjectId:!1,sortKey:null},strategy:{type:"feature"},
factory:{symbology:await h(g,m),labels:await k(g,m)}}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/handleNoEngineError":function(){define(["exports"],function(l){l.handleNoEngineError=async function(n,t){try{return await n}catch(q){if("no-queryEngine"!==q.name)throw q;return t}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../engine/highlightReasons"],
function(l,n){class t{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(q,y){for(const w of q)q=this._idToCounters.get(w),q||(q=new Map,this._idToCounters.set(w,q)),q.set(y,(q.get(y)||0)+1)}deleteReason(q,y){for(const w of q){q=this._idToCounters.get(w);if(!q)continue;let h=q.get(y);if(null==h)break;h--;0<h?q.set(y,h):q.delete(y);0===q.size&&this._idToCounters.delete(w)}}getHighlightReason(q){q=this._idToCounters.get(q);if(!q)return null;let y=null;
for(const w of n.highlightReasons)q.get(w)&&(y=w);return y?y:null}ids(){return this._idToCounters.keys()}}l.HighlightCounter=t;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports","./TileKey"],function(l,n){function t(h,A){const k=new Set;for(const g of h instanceof Set?h.values():h.keys())A.has(g)||k.add(g);return k}class q{constructor(h,A,k){k=k?h.getTileCoverage(k,0,!0,"closest"):null;h=h.getTileCoverage(A,
0,!0,"closest");this._tileKeys=new Map;if(k)for(const g of k.keys())this._tileKeys.set(g.id,g);if(h)for(const g of h.keys())this._tileKeys.set(g.id,g)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class y{constructor(h){this.version=h}}class w{constructor(h){this._subscriptions=new Map;this._visible=new Set;this._paused=new Set;this._version=0;this._config=h}destroy(){}get _coverageSet(){return this._coverage?.coverageSet??new Set}suspend(){this._suspendedOverage=
this._coverage;this._coverage=null;this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(h,A){this._version=(this._version+1)%Number.MAX_SAFE_INTEGER;this._updateCoverage(h,A);this._updateSubscriptions();return new Set(this._visible)}_updateCoverage(h,A){this._coverage=new q(this._config.tileInfoView,h,A)}_updateSubscriptions(){var h=this._coverageSet;const A=this._updateVisibility();var k=
t(A,h);const g=t(this._subscriptions,A),d=t(h,this._subscriptions);h=t(g,h);k=t(k,h);k=t(k,this._paused);this._visible=A;for(const m of d.values())this._subscriptions.set(m,new y(this._version));for(const m of k.values())this._paused.add(m);for(const m of h.values())this._subscriptions.delete(m),this._paused.delete(m);(d.size||h.size||k.size)&&this._sendUpdateSubscriptions(d,h,k)}_sendUpdateSubscriptions(h,A,k){h=Array.from(h.values()).map(g=>({tileId:g,version:this._subscriptions.get(g).version}));
this._config.updateSubscriptions({subscribe:h,unsubscribe:Array.from(A.values()),pause:Array.from(k.values())})}_updateVisibility(){const h=new Set,A=new Set;if(!this._coverage)return h;for(var k of this._coverage.keys())this._config.isDone(k)?h.add(k.id):this._addVisibleParent(h,A,k)||this._addVisibleChildren(h,k)||h.add(k.id);k=new n(0,0,0,0);const g=new n(0,0,0,0);for(const d of A){k.id=d;for(const m of h)g.id=m,k.containsChild(g)&&h.delete(m)}return h}_addVisibleParent(h,A,k){let g=!1;for(const d of this._visible.values())(new n(d)).containsChild(k)&&
(h.add(d),A.add(d),g=!0);return g}_addVisibleChildren(h,A){let k=!1;for(const g of this._visible.values()){const d=new n(g);A.containsChild(d)&&(h.add(g),k=!0)}return k}}l.FeatureTileSubscriptionManager=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(l,n,t,q,y,w,h,A,k,g,d,m,c,a,b,u){return r=>{r=class extends r{constructor(...f){super(...f);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([w.watch(()=>{const f=this.layer;return[f&&"elevationInfo"in f?f.elevationInfo?.featureExpressionInfo:null,f&&"displayField"in f?f.displayField:null,f&&"timeInfo"in f&&f.timeInfo,f&&"renderer"in f&&f.renderer,f&&"labelingInfo"in f&&f.labelingInfo,
f&&"floorInfo"in f&&f.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),w.syncAndInitial),w.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),w.on(()=>{const f=this.layer;return f&&"sublayers"in f?f.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:f,layer:{fieldsIndex:v},requiredFields:x}=this;return"outFields"in f&&f.outFields?m.fixFields(v,[...m.unpackFieldNames(v,
f.outFields),...x]):m.fixFields(v,x)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(f){this._override("featureEffect",f)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(f){q.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(f){throw Error("missing implementation");}createQuery(){var f={outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference};f=null!=this.filter?this.filter.createQuery(f):new a(f);if("floorInfo"in this.layer&&this.layer.floorInfo){const v=c.getFloorFilterClause(this);null!=v&&(f.where=f.where?`(${f.where}) AND (${v})`:v)}null!=this.timeExtent&&(f.timeExtent=null!=f.timeExtent?f.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return f}createAggregateQuery(){return new a({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(f,
v){throw Error("missing implementation");}queryObjectIds(f,v){throw Error("missing implementation");}queryFeatureCount(f,v){throw Error("missing implementation");}queryExtent(f,v){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(f,v){this._validateFetchPopupFeatures(f,v);return this._fetchPopupFeatures(f,v)}_loadArcadeModules(f){return f.expressionInfos?.length||Array.isArray(f.content)&&f.content.some(v=>"expression"===v.type)?b.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const f=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",f);f.then(()=>{this._updatingRequiredFieldsPromise===f&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var f="3d"===this.view.type,{layer:v,layer:{fieldsIndex:x,objectIdField:B}}=this,I="renderer"in v&&v.renderer,J="orderBy"in v&&v.orderBy,L="featureReduction"in v?v.featureReduction:null,G=new Set;I=await Promise.allSettled([I?I.collectRequiredFields(G,x):null,m.collectLabelingFields(G,
v),f&&"elevationInfo"in v?m.collectElevationFields(G,v):null,null!=this.filter?m.collectFilterFields(G,v,this.filter):null,f||null==this.featureEffect?null:m.collectFilterFields(G,v,this.featureEffect.filter),!f&&L?m.collectFeatureReductionFields(G,v,L):null,!f&&J?m.collectOrderByInfos(G,v,J):null]);"timeInfo"in v&&v.timeInfo&&this.timeExtent&&m.collectFields(G,v.fieldsIndex,[v.timeInfo.startField,v.timeInfo.endField]);"floorInfo"in v&&v.floorInfo&&m.collectFields(G,v.fieldsIndex,[v.floorInfo.floorField]);
"feature"===v.type&&f&&null!=v.infoFor3D&&(null==v.globalIdField&&q.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),m.collectFields(G,v.fieldsIndex,[v.globalIdField]));"subtype-group"===v.type&&(m.collectField(G,x,v.subtypeField),J=v.sublayers.map(p=>Promise.all([p.renderer?.collectRequiredFields(G,x),m.collectLabelingFields(G,p)])),await Promise.allSettled(J));"catalog-footprint"===v.type&&v.parent&&(J=v.parent,m.collectFields(G,x,[J.itemNameField,J.itemSourceField,J.itemTypeField,
J.maxScaleField,J.minScaleField]));for(const p of I)"rejected"===p.status&&q.getLogger(this).error(p.reason);m.collectField(G,x,B);f&&"displayField"in v&&v.displayField&&m.collectField(G,x,v.displayField);f=Array.from(G).sort();this._set("requiredFields",f)}}_validateFetchPopupFeatures(f,v){if(null!=v)for(const x of f){f=x.origin&&"layer"in x.origin?x.origin.layer:x.layer;if("popupEnabled"in f&&!f.popupEnabled)throw new n("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:f});if(x.isAggregate){const B=
"featureReduction"in f?f.featureReduction:null;if(!(B&&"popupTemplate"in B&&B.popupEnabled&&B.popupTemplate))throw new n("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:f});}else if("popupTemplate"in f&&!u.getFetchPopupTemplate(f,v))throw new n("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:f});}}_popupFeatureHasRequiredFields(f,v){return m.featureHasFields(v,f)}async _fetchPopupFeatures(f,v){const x=Array(f.length),B=new Map,I=await this._createPopupQuery(f.map(L=>
L.origin?.layer??L.layer),v);for(let L=0;L<f.length;L++){const G=f[L];if(G.isAggregate){x[L]=G;continue}var J=G.origin?.layer??G.layer;if(!(J&&"popupEnabled"in J))continue;const p=m.unpackFieldNames(this.layer.fieldsIndex,I.outFields);J=u.getFetchPopupTemplate(J,v);if(null==J)continue;const C=await this._loadArcadeModules(J);y.throwIfAborted(v);C&&C.arcadeUtils.hasGeometryOperations(J)||!this._popupFeatureHasRequiredFields(G,p)?B.set(G.getObjectId(),{graphic:G,index:L}):x[L]=G}if("stream"===this.layer.type||
0===B.size)return x.filter(Boolean);I.objectIds=Array.from(B.keys());try{const L=await this.layer.queryFeatures(I,v);for(const G of L.features){const {graphic:{geometry:p,origin:C},index:D}=B.get(G.getObjectId());let M;(M=G).geometry||(M.geometry=p);G.origin=C;x[D]=G}}catch{}return x.filter(Boolean)}async _createPopupQuery(f,v){const x=this.layer.createQuery(),B=new Set;var I=!1;f=f??[this.layer];for(const J of f)if("popupEnabled"in J&&(f=u.getFetchPopupTemplate(J,v),null!=f)){I=await this._loadArcadeModules(f);
y.throwIfAborted(v);I=I&&I.arcadeUtils.hasGeometryOperations(f);I=!("point"!==this.layer.geometryType&&!I);f=await u.getRequiredFields(this.layer,f);y.throwIfAborted(v);for(const L of f)B.add(L)}x.returnGeometry=I;x.returnZ=I;x.returnM=I;x.outFields=Array.from(B);x.outSpatialReference=this.view.spatialReference;"floorInfo"in this.layer&&this.layer.floorInfo&&(v=c.getFloorFilterClause(this),null!=v&&(x.where=x.where?`(${x.where}) AND (${v})`:v));return x}canResume(){return!super.canResume()||null!=
this.timeExtent&&this.timeExtent.isEmpty?!1:!0}getTest(){}get test(){}};l.__decorate([h.property()],r.prototype,"_updatingRequiredFieldsPromise",void 0);l.__decorate([h.property({readOnly:!0})],r.prototype,"availableFields",null);l.__decorate([h.property({readOnly:!0})],r.prototype,"dataUpdating",void 0);l.__decorate([h.property({type:g})],r.prototype,"featureEffect",null);l.__decorate([h.property({type:d})],r.prototype,"filter",void 0);l.__decorate([h.property()],r.prototype,"layer",void 0);l.__decorate([h.property({type:Number})],
r.prototype,"maximumNumberOfFeatures",null);l.__decorate([h.property({readOnly:!0,type:Boolean})],r.prototype,"maximumNumberOfFeaturesExceeded",null);l.__decorate([h.property({readOnly:!0})],r.prototype,"requiredFields",void 0);l.__decorate([h.property()],r.prototype,"suspended",void 0);l.__decorate([h.property()],r.prototype,"view",void 0);return r=l.__decorate([k.subclass("esri.views.layers.FeatureLayerView")],r)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(l){function n(t,
q){if(!t?.length)return null;t=t.filter(y=>""!==y).map(y=>`'${y}'`);t.push("''");return`${q} IN (${t.join(",")}) OR ${q} IS NULL`}l.getFloorFilterClause=function(t){const q=t.layer;return"floorInfo"in q&&q.floorInfo?.floorField&&"floors"in t.view?n(t.view.floors,q.floorInfo.floorField):null};l.getLayerFloorFilterClause=function(t,q){return"floorInfo"in q&&q.floorInfo?.floorField?n(t,q.floorInfo.floorField):null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(l,n){function t(q,y){return q.popupTemplate?q.popupTemplate:null!=y&&y.defaultPopupTemplateEnabled&&null!=q.defaultPopupTemplate?q.defaultPopupTemplate:null}l.getFetchPopupTemplate=t;l.getRequiredFields=async function(q,y=q.popupTemplate){if(null==y)return[];const w=await y.getRequiredFields(q.fieldsIndex);({lastEditInfoEnabled:y}=y);const {objectIdField:h,typeIdField:A,globalIdField:k,relationships:g}=q;if(w.includes("*"))return["*"];y=y?n.getFeatureEditFields(q):
[];const d=n.fixFields(q.fieldsIndex,[...w,...y]);A&&d.push(A);d&&h&&q.fieldsIndex?.has(h)&&!d.includes(h)&&d.push(h);d&&k&&q.fieldsIndex?.has(k)&&!d.includes(k)&&d.push(k);g&&g.forEach(m=>{({keyField:m}=m);d&&m&&q.fieldsIndex?.has(m)&&!d.includes(m)&&d.push(m)});return d};l.hasPopupTemplate=function(q,y){return null!=t(q,{defaultPopupTemplateEnabled:y})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(l,n,t,q,y,w,h,A){return k=>{k=class extends k{initialize(){this.addHandles(q.on(()=>this.layer,"refresh",g=>{this.doRefresh(g.dataChanged).catch(d=>{t.isAbortError(d)||n.getLogger(this).error(d)})}),"RefreshableLayerView")}};return k=l.__decorate([A.subclass("esri.views.layers.RefreshableLayerView")],k)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/object ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/graphics/featureConversionUtils ../../../layers/support/FeatureFilter ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/timeSupport ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/highlightReasons ./LayerView2D ./features/FeatureContainer ./features/FeaturePipelineWorkerProxy ./features/FeatureSourceEventLog ./features/layerAdapters/CatalogFootprintLayerAdapter ./features/layerAdapters/FeatureLayerAdapter ./features/layerAdapters/InMemoryLayerAdapter ./features/layerAdapters/KnowledgeGraphSublayerAdapter ./features/layerAdapters/OGCFeatureLayerAdapter ./features/layerAdapters/OrientedImageryLayerAdapter ./features/layerAdapters/StreamLayerAdapter ./features/layerAdapters/SubtypeGroupLayerAdapter ./features/schema/processor/symbols/ComplexSymbolSchema ./support/FeatureCommandQueue ./support/handleNoEngineError ./support/HighlightCounter ./support/util ../tiling/FeatureTileSubscriptionManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../../geometry/Extent".split(" "),function(l,
n,t,q,y,w,h,A,k,g,d,m,c,a,b,u,r,f,v,x,B,I,J,L,G,p,C,D,M,K,F,O,T,U,V,W,Q,ea,aa,Y,ca,R,ha,ia,ja,S,da,fa,la){function ma(e,z){const E=new Set;e&&e.forEach(H=>E.add(H));z&&z.forEach(H=>E.add(H));return E.has("*")?["*"]:Array.from(E)}t=class extends S(fa(D.LayerView2DMixin(da))){constructor(){super(...arguments);this._commandsQueue=new ca({process:e=>{switch(e.type){case "edit-by-feature":case "edit-by-id":return this._doEdit(e);case "update":return this._doUpdate();case "highlight":return this._updateHighlights()}}});
this._visibilityOverrides=new Set;this._highlightCounter=new ha.HighlightCounter;this._lastAvailableFields=[];this._lastTargetState=null;this.eventLog=new F.FeatureSourceEventLog;this._displayRefreshVersion=this._sourceRefreshVersion=1;this._pipelineUpdating=!1;this._fields=null;this.featureEffectView=new f}destroy(){this._workerProxy?.destroy();this._workerAttached.reject(a.createAbortError());this._commandsQueue.destroy()}initialize(){this._workerAttached=a.createResolver();a.ignoreAbortErrors(this._workerAttached.promise);
this.addResolvingPromise(this._initProxy());this.featureEffectView.featureEffect=this.featureEffect;this.featureEffectView.endTransitions()}async _initProxy(){var e=this.layer;if("isTable"in e&&e.isTable)throw new A("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e});if("mesh"===e.geometryType)throw new A("featurelayerview:geometry-type-not-supported",`Geometry type of ${e.geometryType} is not supported`,{layer:e});if(("feature"===e.type||"subtype-group"===e.type)&&
!1===I.getEffectiveLayerCapabilities(e)?.operations.supportsQuery)throw new A("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:e});this._workerProxy&&this._workerProxy.destroy();e=this._createClientOptions();this._workerProxy=await K.createFeaturePipelineWorkerProxy(e)}async _attachProxy(){const e={service:await this.layerAdapter.createServiceOptions(this.view),tileInfoJSON:this.view.featuresTilingScheme.tileInfo.toJSON()};let z=[];Array.isArray(e.service.source)&&
(z=e.service.source);try{await this._workerProxy.pipeline.onAttach(e,{transferList:z}),this._workerAttached.resolve()}catch(E){this._workerAttached.reject(a.createAbortError()),a.throwIfNotAbortError(E)}}async _detachProxy(){return this._workerProxy.pipeline.onDetach()}async getWorker(){await this._workerAttached.promise;return this._workerProxy}get hasAllFeatures(){return this.layer.visible&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&
this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const e=this.layerAdapter.getLabelingDeconflictionInfo(this.view),z=this.layer.geometryType,E=!this.suspended;return e.map(({vvEvaluators:H,deconflictionEnabled:N})=>({container:this.featureContainer,vvEvaluators:H,deconflictionEnabled:N,geometryType:z,visible:E}))}get layerAdapter(){switch(this.layer.type){case "feature":return"memory"===this.layer.source.type?new U.InMemoryLayerAdapter(this.layer):new T.FeatureLayerAdapter(this.layer);
case "geojson":case "csv":case "wfs":return new U.InMemoryLayerAdapter(this.layer);case "subtype-group":return new aa.SubtypeGroupLayerAdapter(this.layer);case "ogc-feature":return new W.OGCFeatureLayerAdapter(this.layer);case "stream":return new ea.StreamLayerAdapter(this.layer);case "oriented-imagery":return new Q.OrientedImageryLayerAdapter(this.layer);case "knowledge-graph-sublayer":return new V.KnowledgeGraphSublayerAdapter(this.layer);case "catalog-footprint":return new O.CatalogFootprintLayerAdapter(this.layer);
default:h.neverReached(this.layer)}return null}get timeExtent(){return J.combineTimeExtent(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(e,z){return this.featureContainer?.getDisplayStatistics(e,z)}async queryHeatmapStatistics(e){return(await this.getWorker()).pipeline.queryHeatmapStatistics(e)}highlight(e,z="highlight"){let E;e instanceof q?E=[e.getObjectId()]:"number"===typeof e||"string"===typeof e?E=[e]:w.isCollection(e)&&0<e.length?E=e.map(N=>
N?.getObjectId()).toArray():Array.isArray(e)&&0<e.length&&(E="number"===typeof e[0]||"string"===typeof e[0]?e:e.map(N=>N?.getObjectId()));const H=E?.filter(y.isSome);if(!H?.length)return k.makeHandle();this._addHighlights(H,z);return k.makeHandle(()=>this._removeHighlights(H,z))}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}async hitTest(e,z){z=await this.featureContainer.hitTest(z);if(0===z.length)return null;const E=await this.getWorker(),
{features:H,aggregates:N}=await E.pipeline.getDisplayFeatures(z),P=this.featureContainer.getSortKeys(z);z=({displayId:X},{displayId:ba})=>P.has(X)&&P.has(ba)?P.get(X)-P.get(ba):X-ba;H.sort(z).reverse();N.sort(z).reverse();return[...N.map(X=>this._createGraphicHit(e,n.fromJSON(X))),...H.map(X=>this._createGraphicHit(e,q.fromJSON(X)))]}async queryStatistics(){const e=await this.getWorker();return R.handleNoEngineError(e.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}async querySummaryStatistics(e,
z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.features.executeQueryForSummaryStatistics(this._cleanUpQuery(e),z,E);return R.handleNoEngineError(e,{})}async queryAggregateSummaryStatistics(e,z,E){z={...z,scale:this.view.scale};e=(await this.getWorker()).aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(e),z,E);return R.handleNoEngineError(e,{})}async queryUniqueValues(e,z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.features.executeQueryForUniqueValues(this._cleanUpQuery(e),
z,E);return R.handleNoEngineError(e,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(e,z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(e),z,E);return R.handleNoEngineError(e,{uniqueValueInfos:[]})}async queryClassBreaks(e,z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.features.executeQueryForClassBreaks(this._cleanUpQuery(e),z,E);return R.handleNoEngineError(e,{classBreakInfos:[]})}async queryAggregateClassBreaks(e,
z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(e),z,E);return R.handleNoEngineError(e,{classBreakInfos:[]})}async queryHistogram(e,z,E){const H=await this.getWorker();z={...z,scale:this.view.scale};e=H.features.executeQueryForHistogram(this._cleanUpQuery(e),z,E);return R.handleNoEngineError(e,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(e,z,E){const H=await this.getWorker();
z={...z,scale:this.view.scale};e=H.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(e),z,E);return R.handleNoEngineError(e,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(e,z){return this.queryFeaturesJSON(e,z).then(E=>{E=G.fromJSON(E);E.features.forEach(H=>this._setLayersForFeature(H));return E})}async queryVisibleFeatures(e,z){e=(await this.getWorker()).pipeline.queryVisibleFeatures(this._cleanUpQuery(e),z);e=await R.handleNoEngineError(e,{features:[]});
e=G.fromJSON(e);e.features.forEach(E=>this._setLayersForFeature(E));return e}async queryAggregates(e,z){e=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),z);e=await R.handleNoEngineError(e,{features:[]});e=L.fromJSON(e);e.features.forEach(E=>this._setLayersForFeature(E));return e}async queryAggregateIds(e,z){e=(await this.getWorker()).aggregates.executeQueryForIds(this._cleanUpAggregateQuery(e),z);return R.handleNoEngineError(e,[])}async queryAggregateCount(e,z){e=
(await this.getWorker()).aggregates.executeQueryForCount(this._cleanUpAggregateQuery(e),z);return R.handleNoEngineError(e,0)}async queryAggregateJSON(e,z){e=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),z);return R.handleNoEngineError(e,{features:[]})}async queryFeaturesJSON(e,z){e=(await this.getWorker()).features.executeQuery(this._cleanUpQuery(e),z);return R.handleNoEngineError(e,{features:[]})}async queryObjectIds(e,z){e=(await this.getWorker()).features.executeQueryForIds(this._cleanUpQuery(e),
z);return R.handleNoEngineError(e,[])}async queryFeatureCount(e,z){e=(await this.getWorker()).features.executeQueryForCount(this._cleanUpQuery(e),z);return R.handleNoEngineError(e,0)}async queryExtent(e,z){e=(await this.getWorker()).features.executeQueryForExtent(this._cleanUpQuery(e),z);e=await R.handleNoEngineError(e,{count:0,extent:null});return{count:e.count,extent:la.fromJSON(e.extent)}}async getSampleFeatures(e){return(await this.getWorker()).pipeline.getSampleFeatures(e)}setVisibility(e,z){z?
this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e);this._update()}update(e){this._subscriptionManager&&(this.view.animation&&!this._lastTargetState&&(this._lastTargetState=e.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null),e=this._subscriptionManager.update(e.targetState,this._lastTargetState),this.featureContainer.setVisibleTiles(e))}attach(){g("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach");a.ignoreAbortErrors(this._updatingHandles.addPromise(this._workerAttached.promise));
a.ignoreAbortErrors(this._attachProxy());this.featureContainer=new M.FeatureContainer(this);this.container.addChild(this.featureContainer);this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._subscriptionManager=new ja.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:e=>{this.featureContainer.updateSubscriptions(e);a.ignoreAbortErrors(this._updatingHandles.addPromise(this.getWorker().then(z=>z.pipeline.updateSubscriptions(e))))},
isDone:e=>this.featureContainer.isDone(e)});this.requestUpdate();this.addAttachHandles([b.watch(()=>JSON.stringify({displayRefreshVersion:this._displayRefreshVersion,timeExtent:this.timeExtent,clips:this.clips,filter:this.filter,featureEffect:this.featureEffect,sourceRefreshVersion:this._sourceRefreshVersion,timeZone:this.view.timeZone,effect:this.featureEffect,...this.layerAdapter.getUpdateHashProperties(this.view)}),()=>this._update(),b.initial),b.watch(()=>this.updateSuspended,e=>{e||(this._subscriptionManager.resume(),
this.view.labelManager.requestUpdate())})]);"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",e=>this._edit(e)))}detach(){g("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach");this._detachProxy();this._fields=null;this.featureContainer.destroy();this.featureContainer=null;this._commandsQueue.clear();this.container.removeAllChildren();this._subscriptionManager=m.destroyMaybe(this._subscriptionManager);this._workerProxy.pipeline.onDetach();
this._workerAttached=a.createResolver();a.ignoreAbortErrors(this._workerAttached.promise);this._lastAvailableFields=[];this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const e="renderer"in this.layer&&null!=this.layer.renderer,z=this._commandsQueue.updateTracking.updating,E=null!=this._updatingRequiredFieldsPromise,H=this.featureContainer.updatingHandles.updating,N=this.updateRequested||e&&(z||E)||H||this._pipelineUpdating||this.dataUpdating;if(g("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${N}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${e}\n  -> updatingRequiredFields ${E}\n  -> hasPendingCommand ${z}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${H}\n`);
for(const P of this.featureContainer.subscriptions())console.log(`    -> Tile[${P.id}] Done: ${P.done}`)}return N}_createClientOptions(){const e=this;return{get container(){return e.featureContainer},setUpdating:z=>{this._set("_pipelineUpdating",z.pipeline);this._set("dataUpdating",z.data)},emitEvent:z=>{this.emit(z.name,z.event)},get eventLog(){return e.eventLog},fetch:z=>Promise.all(z.map(E=>e.view.stage.painter.textureManager.rasterizeItem(E))),fetchDictionary:z=>Promise.all(z.map(E=>this._fetchDictionaryRequest(E)))}}async _fetchDictionaryRequest(e){try{if("subtype-group"===
this.layer.type)throw Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const z=this.layer.renderer;if(!z||"dictionary"!==z.type)throw Error("InternalError: Expected layer to have a DictionaryRenderer");const E=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==E.type)throw Error("InternalError: Expected schema to be of type 'dictionary'");const H={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,
store:this.featureContainer.instanceStore,scaleExpression:E.scaleExpression};this._fields||(this._fields=this.layer.fields.map(X=>X.toJSON()));const N=E.visualVariableUniforms,P=await z.getSymbolAsync(e.feature,{fields:this._fields});return P&&P.data?{type:"dictionary-response",meshes:await Y.createComplexSymbolInstances(P.data,{uniforms:N,path:"renderer",schemaOptions:H})}:{type:"dictionary-response",meshes:[]}}catch(z){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(e){e=p.from(e)||
this.createQuery();e.outSpatialReference||(e.outSpatialReference=this.view.spatialReference);return e.toJSON()}_cleanUpAggregateQuery(e){e=p.from(e)||this.createAggregateQuery();e.outSpatialReference||(e.outSpatialReference=this.view.spatialReference);const z=e.objectIds??[];for(const E of e.aggregateIds??[])z.push(E);e.objectIds=z;e.aggregateIds=[];return e.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(e){if(this.updateSuspended)this._subscriptionManager.suspend();
else if(e=this._getEffectiveEdit(e))return this._commandsQueue.push(e).catch(a.throwIfNotAbortError)}async doRefresh(e){this.attached&&(this.updateSuspended&&e||(e?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%4294967294+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%4294967294+1}_getEffectiveEdit(e){const z="globalIdField"in this.layer&&
this.layer.globalIdField;var E=e.deletedFeatures.some(P=>-1===P.objectId||!P.objectId),H=z&&this.availableFields.includes(z);if(E&&!H)return d.getLogger(this).error(new A("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${z} to be included the layer's outFields for updates to be reflected on the map`)),null;const N=this.layer;E=e.historicMoment?.getTime()??null;if((H="layerId"in N&&e.editedFeatures?.find(P=>P.layerId===N.layerId))&&this._canEditByFeature(H)){const P=
ia.toJSONGeometryType(this.layer.geometryType),{adds:X,deletes:ba,updates:na}=H.editedFeatures,ka=this.layer.objectIdField;e=X.map(Z=>v.convertFromFeature(Z,P,!1,!1));H=na.map(Z=>v.convertFromFeature(Z.current,P,!1,!1));const oa=ba.map(Z=>"attributes"in Z?{globalId:z?Z.attributes[z]:null,objectId:ka?Z.attributes[ka]:null}:Z);return{type:"edit-by-feature",added:e,removed:oa,updated:H,historicMoment:E}}return{type:"edit-by-id",added:e.addedFeatures,updated:e.updatedFeatures,removed:e.deletedFeatures,
historicMoment:E}}_canEditByFeature(e){const {adds:z,updates:E}=e.editedFeatures;return z.every(H=>this.view.spatialReference.equals(H.geometry?.spatialReference))&&E.every(H=>this.view.spatialReference.equals(H.current.geometry?.spatialReference))}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);
try{if(await this._updateRequiredFields(),!this.destroyed&&this.layerAdapter?.hasRequiredSupport&&this._subscriptionManager){var e=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads();e.updateStart();var z=this.featureEffect,E={store:e,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},H=this._createViewSchemaConfig(),N={source:this.layerAdapter.createSourceSchema(H,this._sourceRefreshVersion),
processor:await this.layerAdapter.createProcessorSchema(E,H,this._displayRefreshVersion)},P=c.notDeepEqual(this._lastSchema?.source.mutable,N.source.mutable)||c.notDeepEqual(this._lastSchema?.processor,N.processor);if(P){this._lastSchema=N;this._fields=null;var X=Math.round(performance.now());g("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${X}] FeatureLayerView2D._doUpdate`,{changes:P});await (await this.getWorker()).pipeline.updateSchema(N,X);e.updateEnd();this.featureEffectView.featureEffect=
z;this.featureEffectView.endTransitions();this.featureContainer.attributeView.unlockTextureUploads();this.featureContainer.swapRenderState();this.featureContainer.requestRender();g("esri-2d-update-debug")&&console.debug(`Version[${X}] FeatureLayerView2D.updateEnd`);this.requestUpdate()}else this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),e.updateEnd(),this.featureEffectView.featureEffect=z}}catch(ba){g("esri-2d-update-debug")&&console.error("Encountered an error during update",
ba)}}async _doEdit(e){const z=await this.getWorker();try{this.featureContainer.editStart(),await z.pipeline.onEdits(e),this.featureContainer.editEnd()}catch(E){a.isAbortError(E)}}get hasFilter(){const e=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||0<this._visibilityOverrides.size||e}_getEffectiveAvailableFields(e){this._lastAvailableFields=e=ma(this._lastAvailableFields,e);return B.packFields(this.layer.fieldsIndex,e)}_createViewSchemaConfig(){var e=
this.view,z=this.layerAdapter,E=this.timeExtent,H=this._visibilityOverrides,N=this.filter;N&&=N.clone();const P=null!=N?N.timeExtent:null;if(E=null!=E&&null!=P?E.intersection(P):E||P)N??=new x,N.timeExtent=E;N=z.addFilters?.(N,e)??N;e=N?.toJSON()??null;H.size&&(e??=(new x).toJSON(),e.hiddenIds=Array.from(H));H=this.featureEffect?.filter?.toJSON()??null;H=[e,H];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:H,scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlights(e,
z){this._highlightCounter.addReason(e,z);this._commandsQueue.push({type:"highlight"})}_removeHighlights(e,z){this._highlightCounter.deleteReason(e,z);this._commandsQueue.push({type:"highlight"})}async _updateHighlights(){var e=[];for(var z of this._highlightCounter.ids()){var E=this._highlightCounter.getHighlightReason(z);E=C.getHighlightBits(E);e.push({objectId:z,highlightFlags:E})}z=await this.getWorker();this.destroyed||(e=z.pipeline.updateHighlight({highlights:e}).catch(H=>{a.isAbortError(H)||
d.getLogger(this).error(H)}),this._updatingHandles.addPromise(e))}_setLayersForFeature(e){e.layer=e.sourceLayer=this.layer;this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(e)}_createGraphicHit(e,z){this._setLayersForFeature(z);null!=z.geometry&&(z.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:z,layer:this.layer,mapPoint:e}}};l.__decorate([u.property()],t.prototype,"_commandsQueue",void 0);l.__decorate([u.property()],t.prototype,"_sourceRefreshVersion",
void 0);l.__decorate([u.property()],t.prototype,"_displayRefreshVersion",void 0);l.__decorate([u.property({readOnly:!0})],t.prototype,"_pipelineUpdating",void 0);l.__decorate([u.property({readOnly:!0})],t.prototype,"hasAllFeatures",null);l.__decorate([u.property({readOnly:!0})],t.prototype,"hasAllFeaturesInView",null);l.__decorate([u.property({readOnly:!0})],t.prototype,"hasFullGeometries",null);l.__decorate([u.property()],t.prototype,"featureEffectView",void 0);l.__decorate([u.property()],t.prototype,
"labelingCollisionInfos",null);l.__decorate([u.property()],t.prototype,"layerAdapter",null);l.__decorate([u.property({readOnly:!0})],t.prototype,"timeExtent",null);l.__decorate([u.property()],t.prototype,"updating",void 0);return t=l.__decorate([r.subclass("esri.views.2d.layers.FeatureLayerView2D")],t)});