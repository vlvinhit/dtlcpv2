// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(l,n,k,p,q,r){async function m(a,g,b,c,d){k.throwIfAborted(d);const h=k.onAbort(d,()=>{{const e=a.get(b);null!=e&&0<--e.refCount||(a.delete(b),null!=e&&e.abortController.abort())}});var f=a.get(b);f?f.refCount++:(f=new AbortController,c=c({...d,signal:f.signal}),f={refCount:1,abortController:f,promise:c},a.set(b,f));try{const e=await f.promise;g.put(b,
e,e.size);a.delete(b);k.throwIfAborted(d);return e}finally{n.removeMaybe(h)}}class t{constructor(a){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=a("gltf-resources",()=>{});this._wosrMemCache=a("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(a=>a.abortController.abort());this._wosrLoading.forEach(a=>a.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(a,g,b){const c=b?`gltfPBR:${a}`:`gltf:${a}`,d=this._gltfMemCache.get(c);
return null!=d?Promise.resolve(d):m(this._gltfLoading,this._gltfMemCache,c,h=>q.loadGLTF(new p.DefaultLoadingContext(h.streamDataRequester),a,h,b),g)}loadWOSR(a,g){const b=`wosr:${a}:${g.disableTextures}`,c=this._wosrMemCache.get(b);return null!=c?Promise.resolve(c):m(this._wosrLoading,this._wosrMemCache,b,d=>r.load(a,d),g)}}l.ObjectResourceCache=t;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});