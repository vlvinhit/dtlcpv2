// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["exports"],function(m){class w{constructor(n,b,e){this._scale=n;this._shift=b;this._levelShift=e}getLevelRowColumn(n){const b=this.getLevelShift(n[0]),e=this._shift+b;return e?[n[0]-b,n[1]>>e,n[2]>>e]:n}getLevelShift(n){return Math.min(n,this._levelShift)}getOffset(n,b){let e=0;var f=0;const c=this._shift+this.getLevelShift(n[0]);c&&(f=(1<<c)-1,b/=this._scale*(1<<c-1),e=(n[2]&f)*b,f=(n[1]&f)*b);return[e,f]}getScale(n){return this._scale*
(1<<this._shift+this.getLevelShift(n))}}m.SchemaHelper=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/TileHandler3D":function(){define("../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../geometry/support/aaBoundingRect ./TileHandler ./VectorTile ../../tiling/TileInfoViewPOT ../../tiling/TileKey".split(" "),function(m,w,n,b,e,f,c,h){class d extends e.TileHandler{constructor(g,k,
p,u){super(g,k,p,g.tileInfo.lods.length-1);this._memCache=u;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map;this._tileInfoView=new c(g.tileInfo,g.fullExtent)}destroy(){super.destroy();this._ongoingRequestToController.forEach(g=>g.abort());this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()}async getVectorTile(g,k){const p=new h(g[0],g[1],g[2],0);let u=this._memCache.get(p.id);if(null!=u)return u.retain(),u;const y=await this._getVectorTileData(p);
w.throwIfAborted(k);if(!this._layer)return null;u=this._memCache.get(p.id);if(null!=u)return u.retain(),u;k=this._layer.tileInfo.getTileBounds(b.create(),p);g=this._tileInfoView.getTileResolution(g[0]);u=new f.VectorTile(p,g,k[0],k[3],512,512,this._styleRepository,this._memCache);u.setData(y);y&&(u.retain(),this._memCache.put(p.id,u,u.usedMemory,m.MinPriority));u.neededForCoverage=!0;u.transforms.tileUnitsToPixels=n.fromValues(.125,0,0,0,.125,0,0,0,1);return u}_getVectorTileData(g){const k=g.id;if(this._ongoingTileRequests.has(k))return this._ongoingTileRequests.get(k);
const p=new AbortController;g=this._getParsedVectorTileData(g,{signal:p.signal}).then(u=>{this._ongoingTileRequests.delete(k);this._ongoingRequestToController.delete(k);return u}).catch(()=>{this._ongoingTileRequests.delete(k);this._ongoingRequestToController.delete(k);return null});this._ongoingTileRequests.set(k,g);this._ongoingRequestToController.set(k,p);return g}_getParsedVectorTileData(g,k){return this.fetchTileData(g,k).then(p=>this.parseTileData({key:g,data:p},k))}}return d})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),
function(m,w,n,b,e,f,c,h,d){function g(p){return()=>p.abort()}class k{constructor(p,u,y,t){this._layer=p;this._styleRepository=u;this.devicePixelRatio=y;this._sourceDataMaxLOD=t;this._inputSignalEventListener=this._startOptionsInputSignal=this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=
w.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(p){this._requestSprite(p);var u=this._layer.currentStyleInfo.glyphsUrl;u=new c(u?b.addQueryParameters(u,
{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,1024,u);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:p.schedule,signal:p.signal}).then(y=>{this._layer&&(this._connection?.close(),this._connection=y,this._layer&&!this._connection.closed&&(y=y.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},p),Promise.all(y).catch(t=>n.throwIfNotAbortError(t))))})}_requestSprite(p){this._spriteSourceAbortController?.abort();
const u=new AbortController;this._spriteSourceAbortController=u;const y=p?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._startOptionsInputSignal=null;y&&(this._inputSignalEventListener=g(u),y.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:t}=u;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...p,signal:t});this._spriteSourcePromise.then(z=>{n.throwIfAbortError(t);
this._spriteMosaic=new h(1024,1024,250);this._spriteMosaic.setSpriteSource(z)})}async updateStyle(p){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",p))}setSpriteSource(p){const u=new h(1024,1024,250);u.setSpriteSource(p);this._spriteMosaic=u;this._spriteSourcePromise=Promise.resolve(p);this._spriteSourceAbortController=null;return u}async setStyle(p,u,y){await this._broadcastPromise;this._styleRepository=p;this._sourceDataMaxLOD=y;this._requestSprite();
p=new c(this._layer.currentStyleInfo.glyphsUrl?b.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,1024,p);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:u,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(p,u){p=await this._getRefKeys(p,u);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),p,u)}async fetchTilePBFs(p){const u=
Object.keys(this._layer.sourceNameToSource),y={};p=await this._getRefKeys(p,y);const t=[],z=[];for(let F=0;F<p.length;F++)if(null==p[F].value||null==u[F])z.push(null);else{const D=p[F].value,E=this._getTilePayload(D,u[F],y);E.then(G=>{t.push({...G,key:D})});z.push(E)}return Promise.all(z).then(()=>t)}async parseTileData(p,u){const y=p&&p.data;if(!y)return null;const {sourceName2DataAndRefKey:t,transferList:z}=y;return 0===Object.keys(t).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",
{key:p.key.id,sourceName2DataAndRefKey:t,styleLayerUIDs:p.styleLayerUIDs},{...u,transferList:z}))}async getSprites(p){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(p)}getGlyphs(p){return this._glyphMosaic.getGlyphItems(p.font,p.codePoints)}async _getTilePayload(p,u,y){p=d.pool.acquire(p.id);const t=this._layer.sourceNameToSource[u],{level:z,row:F,col:D}=p;d.pool.release(p);try{return{protobuff:await t.requestTile(z,F,D,y),sourceName:u}}catch(E){if(n.isAbortError(E))throw E;
return{protobuff:null,sourceName:u}}}async _getRefKeys(p,u){const y=this._layer.sourceNameToSource,t=[];for(const z in y){const F=y[z].getRefKey(p,u);t.push(F)}return n.eachAlways(t)}_getSourcesData(p,u,y){const t=[];for(let z=0;z<u.length;z++)if(null==u[z].value||null==p[z])t.push(null);else{const F=this._getTilePayload(u[z].value,p[z],y);t.push(F)}return n.eachAlways(t).then(z=>{const F={},D=[];for(let E=0;E<z.length;E++){const G=z[E].value;G&&G.protobuff&&0<G.protobuff.byteLength&&(F[G.sourceName]=
{refKey:u[E].value.id,protobuff:G.protobuff},D.push(G.protobuff))}return{sourceName2DataAndRefKey:F,transferList:D}})}}m.TileHandler=k;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(m,w,n,b,e){class f{constructor(c,h,d){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=
0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=c;this.height=h;this._glyphSource=d;this._binPack=new m(c-4,h-4);this._glyphData.push(new Uint8Array(c*h));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(c,h){const d=[],g=this._glyphSource,k=new Set,p=1/256;for(const y of h)k.add(Math.floor(y*p));const u=[];k.forEach(y=>{const t=c+y;this._rangePromises.has(t)?u.push(this._rangePromises.get(t)):(y=g.getRange(c,y).then(()=>{this._rangePromises["delete"](t)},
()=>{this._rangePromises["delete"](t)}),this._rangePromises.set(t,y),u.push(y))});return Promise.all(u).then(()=>{let y=this._glyphIndex[c];y||(y={},this._glyphIndex[c]=y);for(const E of h){var t=y[E];if(t){d[E]={sdf:!0,rect:t.rect,metrics:t.metrics,page:t.page,code:E};continue}var z=g.getGlyph(c,E);if(!z?.metrics)continue;t=z.metrics;let G;if(0===t.width)G=new w(0,0,0,0);else{const H=t.width+6,L=t.height+6;var F=H%4?4-H%4:4,D=L%4?4-L%4:4;1===F&&(F=5);1===D&&(D=5);G=this._binPack.allocate(H+F,L+D);
G.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new m(this.width-4,this.height-4),G=this._binPack.allocate(H+F,L+D));F=this._glyphData[this._currentPage];z=z.bitmap;let M;if(z)for(let r=0;r<L;r++){D=H*r;M=this.width*(G.y+r+1)+G.x;for(let x=0;x<H;x++)F[M+x+1]=z.at(D+x)}}y[E]={rect:G,metrics:t,tileIDs:null,
page:this._currentPage};d[E]={sdf:!0,rect:G,metrics:t,page:this._currentPage,code:E};this._dirties[this._currentPage]=!0}return d})}removeGlyphs(c){for(const h in this._glyphIndex){const d=this._glyphIndex[h];if(!d)continue;let g;for(const k in d)if(g=d[k],g.tileIDs["delete"](c),0===g.tileIDs.size){const p=this._glyphData[g.page],u=g.rect;let y,t;for(let z=0;z<u.height;z++)for(y=this.width*(u.y+z)+u.x,t=0;t<u.width;t++)p[y+t]=0;delete d[k];this._dirties[g.page]=!0}}}bind(c,h,d,g=0){if(!this._textures[d]){var k=
new e.TextureDescriptor;k.pixelFormat=n.PixelFormat.ALPHA;k.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;k.width=this.width;k.height=this.height;this._textures[d]=new b.Texture(c,k,new Uint8Array(this.width*this.height))}k=this._textures[d];k.setSamplingMode(h);this._dirties[d]&&k.setData(this._glyphData[d]);c.bindTexture(k,g);this._dirties[d]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const c of this._textures)c&&c.dispose();this._textures.length=0}}return f})},
"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(m){class w{constructor(n,b){this._height=this._width=0;this._free=[];this._width=n;this._height=b;this._free.push(new m(0,0,n,b))}get width(){return this._width}get height(){return this._height}allocate(n,b){if(n>this._width||b>this._height)return new m;let e=null,f=-1;for(let c=0;c<this._free.length;++c){const h=this._free[c];n<=h.width&&b<=h.height&&(null===e||h.y<=e.y&&h.x<=e.x)&&(e=h,f=c)}if(null===
e)return new m;this._free.splice(f,1);e.width<e.height?(e.width>n&&this._free.push(new m(e.x+n,e.y,e.width-n,b)),e.height>b&&this._free.push(new m(e.x,e.y+b,e.width,e.height-b))):(e.width>n&&this._free.push(new m(e.x+n,e.y,e.width-n,e.height)),e.height>b&&this._free.push(new m(e.x,e.y+b,n,e.height-b)));return new m(e.x,e.y,n,b)}release(n){for(let b=0;b<this._free.length;++b){const e=this._free[b];if(e.y===n.y&&e.height===n.height&&e.x+e.width===n.x)e.width+=n.width;else if(e.x===n.x&&e.width===n.width&&
e.y+e.height===n.y)e.height+=n.height;else if(n.y===e.y&&n.height===e.height&&n.x+n.width===e.x)e.x=n.x,e.width+=n.width;else if(n.x===e.x&&n.width===e.width&&n.y+n.height===e.y)e.y=n.y,e.height+=n.height;else continue;this._free.splice(b,1);this.release(n)}this._free.push(n)}}return w})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(m,w){class n{constructor(c){this._metrics=[];if(c){for(var h=new Map,d=0;c.next();)switch(c.tag()){case 1:const k=
c.getMessage();for(;k.next();)switch(k.tag()){case 3:var g=k.getMessage();let p,u,y,t,z,F,D;for(;g.next();)switch(g.tag()){case 1:p=g.getUInt32();break;case 2:u=g.getBytes();break;case 3:y=g.getUInt32();break;case 4:t=g.getUInt32();break;case 5:z=g.getSInt32();break;case 6:F=g.getSInt32();break;case 7:D=g.getUInt32();break;default:g.skip()}g.release();p&&(g=u?.length??0,this._metrics[p]={width:y,height:t,left:z,top:F,advance:D,startOffset:d,length:g},h.set(p,u),d+=g);break;default:k.skip()}k.release();
break;default:c.skip()}c=new Uint8Array(d);d=this._metrics;for(const [k,p]of h){const {startOffset:u,length:y}=d[k];if(p)for(h=0;h<y;++h)c[u+h]=p[h]}this._allBitmaps=c}else this._allBitmaps=null}getMetrics(c){return this._metrics[c]}getBitmap(c){if(this._allBitmaps&&(c=this._metrics[c],void 0!==c)){var {startOffset:h,length:d}=c;if(0!==d)return new f(this._allBitmaps,h,d)}}}class b{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(c){return this._ranges[c]}addRange(c,h){this._ranges[c]=
h}}class e{constructor(c){this._glyphInfo={};this._baseURL=c}getRange(c,h){const d=this._getFontStack(c);if(d.getRange(h))return Promise.resolve();const g=256*h,k=g+255;if(this._baseURL)return c=this._baseURL.replace("{fontstack}",c).replace("{range}",g+"-"+k),m(c,{responseType:"array-buffer"}).then(p=>{d.addRange(h,new n(new w(new Uint8Array(p.data),new DataView(p.data))))}).catch(()=>{d.addRange(h,new n)});d.addRange(h,new n);return Promise.resolve()}getGlyph(c,h){if(c=this._getFontStack(c))if(c=
c.getRange(Math.floor(h/256)))return{metrics:c.getMetrics(h),bitmap:c.getBitmap(h)}}_getFontStack(c){let h=this._glyphInfo[c];h||=this._glyphInfo[c]=new b;return h}}class f{constructor(c,h,d){this._array=c;this._start=h;this.length=d}at(c){return 0<=c&&c<this.length?this._array[this._start+c]:void 0}}return e})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../core/has ../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(m,w,n,b,e,f,c){class h{constructor(d,g,k=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;0>=g&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=d;this._pageHeight=g;0<k&&(this._maxItemSize=k);this._binPack=new n(d-4,g-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const d of this._textures)d&&d.dispose();this._textures.length=0}getWidth(d){return d>=this._size.length?-1:this._size[d][0]}getHeight(d){return d>=this._size.length?-1:this._size[d][1]}getPageSize(d){return d>=this._size.length?null:this._size[d]}setSpriteSource(d){this.dispose();this.pixelRatio=d.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new n(this._pageWidth-4,this._pageHeight-4);const g=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=g;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=d}getSpriteItem(d,g=!1){var k=this._mosaicRects[d];if(k)return k;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let p;d&&d.startsWith("dasharray-")?([k,p]=this._rasterizeDash(d),g=!0):k=this._sprites.getSpriteInfo(d);if(!k?.width||!k.height||0>k.width||0>k.height)return null;const u=k.width,y=k.height,[t,z,F]=this._allocateImage(u,y);if(0>=
t.width)return null;this._copy(t,k,z,F,g,p);k={type:"sprite",rect:t,width:u,height:y,sdf:k.sdf,simplePattern:!1,rasterizationScale:k.pixelRatio,page:z};return this._mosaicRects[d]=k}getSpriteItems(d){const g={};for(const k of d)g[k.name]=this.getSpriteItem(k.name,k.repeat);return g}getMosaicItemPosition(d,g){d=this.getSpriteItem(d,g);g=d?.rect;if(!g)return null;g.width=d.width;g.height=d.height;return{tl:[g.x+2,g.y+2],br:[g.x+2+d.width,g.y+2+d.height],page:d.page}}bind(d,g,k=0,p=0){if(!(k>=this._size.length||
k>=this._mosaicsData.length)){if(!this._textures[k]){var u=new c.TextureDescriptor;u.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;u.width=this._size[k][0];u.height=this._size[k][1];this._textures[k]=new f.Texture(d,u,new Uint8Array(this._mosaicsData[k].buffer))}u=this._textures[k];u.setSamplingMode(g);this._dirties[k]&&u.setData(new Uint8Array(this._mosaicsData[k].buffer));d.bindTexture(u,p);this._dirties[k]=!1}}static _copyBits(d,g,k,p,u,y,t,z,F,D,E){let G=p*g+k;t=z*y+t;if(E)for(t-=y,E=-1;E<=D;E++,G=
((E+D)%D+p)*g+k,t+=y)for(z=-1;z<=F;z++)u[t+z]=d[G+(z+F)%F];else for(k=0;k<D;k++){for(p=0;p<F;p++)u[t+p]=d[G+p];G+=g;t+=y}}_copy(d,g,k,p,u,y){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(k>=this._mosaicsData.length)){var t=new Uint32Array(y?y.buffer:this._sprites.image.buffer);h._copyBits(t,y?g.width:this._sprites.width,g.x,g.y,this._mosaicsData[k],p[0],d.x+2,d.y+2,g.width,g.height,u);this._dirties[k]=!0}}_allocateImage(d,g){d+=2;g+=2;var k=Math.max(d,g);if(this._maxItemSize&&this._maxItemSize<
k)return k=new b(0,0,d,g),this._mosaicsData.push(new Uint32Array(d*g)),this._dirties.push(!0),this._size.push([d,g]),this._textures.push(void 0),[k,this._mosaicsData.length-1,[d,g]];k=d%4?4-d%4:4;let p=g%4?4-g%4:4;1===k&&(k=5);1===p&&(p=5);k=this._binPack.allocate(d+k,g+p);return 0>=k.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),
this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new n(this._pageWidth-4,this._pageHeight-4),this._allocateImage(d,g)):[k,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(d){var g=d.match(/\[(.*?)\]/);if(!g)return null;g=g[1].split(",").map(Number);d=d.slice(d.lastIndexOf("-")+1);const [k,p,u]=w.rasterizeDash(g,d);d=new Uint8Array(k.buffer);return[{x:0,y:0,width:p,height:u,sdf:!0,pixelRatio:1},d]}}return h})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports",
"../../core/floatRGBA","../../core/mathUtils","./constants"],function(m,w,n,b){m.rasterizeDash=function(e,f){null==e&&(e=[]);var c="Butt"===f,h="Square"===f;f=!c&&!h;1===e.length%2&&(e=[...e,...e]);const d=b.dashRadius,g=2*d;var k=0;for(var p of e)k+=p;p=Math.round(k*d);k=new Float32Array(p*g);const u=.5*d;let y=0,t=0,z=.5,F=!0;for(var D of e){y=t;for(t+=D*d;z<=t;){for(e=.5;e<g;){const E=f?(e-d)*(e-d):Math.abs(e-d);k[(e-.5)*p+z-.5]=F?c?Math.max(Math.max(y+u-z,E),Math.max(z-t+u,E)):E:f?Math.min((z-
y)*(z-y)+E,(z-t)*(z-t)+E):h?Math.min(Math.max(z-y,E),Math.max(t-z,E)):Math.min(Math.max(z-y+u,E),Math.max(t+u-z,E));e++}z++}F=!F}c=k.length;D=new Uint8Array(4*c);for(h=0;h<c;++h)w.packFloatRGBA((f?Math.sqrt(k[h]):k[h])/d,D,4*h);return[D,p,g]};m.rasterizeFillStyle=function(e,f,c){f=f.style;c=n.nextPowerOfTwo(Math.ceil(c));var h="vertical"===f||"horizontal"===f||"cross"===f||"esriSFSCross"===f||"esriSFSVertical"===f||"esriSFSHorizontal"===f?8*c:16*c,d=2*c;e.width=h;e.height=h;const g=e.getContext("2d");
g.strokeStyle="#FFFFFF";g.lineWidth=c;g.beginPath();if("vertical"===f||"cross"===f||"esriSFSCross"===f||"esriSFSVertical"===f)g.moveTo(h/2,-d),g.lineTo(h/2,h+d);if("horizontal"===f||"cross"===f||"esriSFSCross"===f||"esriSFSHorizontal"===f)g.moveTo(-d,h/2),g.lineTo(h+d,h/2);if("backward-diagonal"===f||"diagonal-cross"===f||"esriSFSDiagonalCross"===f||"esriSFSBackwardDiagonal"===f)g.moveTo(-d,-d),g.lineTo(h+d,h+d),g.moveTo(h-d,-d),g.lineTo(h+d,d),g.moveTo(-d,h-d),g.lineTo(d,h+d);if("forward-diagonal"===
f||"diagonal-cross"===f||"esriSFSForwardDiagonal"===f||"esriSFSDiagonalCross"===f)g.moveTo(h+d,-d),g.lineTo(-d,h+d),g.moveTo(d,-d),g.lineTo(-d,d),g.moveTo(h+d,h-d),g.lineTo(h-d,h+d);g.stroke();f=g.getImageData(0,0,e.width,e.height);f=new Uint8Array(f.data);for(d=0;d<f.length;d+=4)h=f[d+3]/255,f[d]*=h,f[d+1]*=h,f[d+2]*=h;return[f,e.width,e.height,c]};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(m){m.dashRadius=15.5;
m.maxTileCoordValue=1024;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(m,w,n){class b extends w{constructor(){super(...arguments);this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(e){e=n.pool.acquire(e);const f=0===e.level?null:n.getId(e.level-1,e.row>>1,e.col>>1,e.world);n.pool.release(e);return f}getTileCoverage(e,f,c=!0,h){e=super.getTileCoverage(e,
f,c,h);if(!e)return e;const d=1<<e.lodInfo.level;e.spans=e.spans.filter(g=>0<=g.row&&g.row<d);return e}scaleToLevel(e){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[e])return this._levelByScale[e];var f=this._fullCacheLodInfos;if(e>f[0].scale)return f[0].level;let c;for(let h=0;h<f.length-1;h++)if(c=f[h+1],e>c.scale)return f=f[h],f.level+(f.scale-e)/(f.scale-c.scale);return f[f.length-1].level}_initializeFullCacheLODs(e){e=0===e[0].level?e.map(f=>({level:f.level,
resolution:f.resolution,scale:f.scale})):m.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(f=>({level:f.level,resolution:f.resolution,scale:f.scale}));for(let f=0;f<e.length;f++)this._levelByScale[e[f].scale]=e[f].level;this._fullCacheLodInfos=e}}return b})},"esri/views/2d/engine/vectorTiles/VTLPainter3D":function(){define(["../../../../core/maybe","../vtlBrushes","./shaders/VTLMaterialManager","./style/StyleDefinition","../../../webgl/enums"],function(m,
w,n,b,e){class f{constructor(c,h){this.spriteMosaic=c;this.glyphMosaic=h;this._brushCache=new Map;this._vtlMaterialManager=new n}dispose(){this._brushCache&&(this._brushCache.forEach(c=>c.dispose()),this._brushCache=null);this._vtlMaterialManager=m.disposeMaybe(this._vtlMaterialManager);this.spriteMosaic.dispose();this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(c,h,d){d=d.layers;c.renderPass="translucent";for(let k=0;k<d.length;k++){const p=
d[k];if(p.type===b.StyleLayerType.SYMBOL){var g=p.getLayoutProperty("visibility");g&&g.getValue()===b.Visibility.NONE||(g=c.displayLevel,void 0!==p.minzoom&&p.minzoom>g+1E-6||void 0!==p.maxzoom&&p.maxzoom<=g-1E-6||(c.styleLayerUID=p.uid,c.styleLayer=p,this._drawWithBrush(c,h,"vtlSymbol")))}}}drawBackground(c,h,d){if(0!==d.backgroundBucketIds.length){var {context:g,displayLevel:k,requiredLevel:p}=c;h.key.level=p;g.setBlendingEnabled(!0);g.setDepthTestEnabled(!1);g.setStencilTestEnabled(!1);c.renderPass=
"background";d.backgroundBucketIds.forEach(u=>{u=d.getLayerById(u);if(u.type===b.StyleLayerType.BACKGROUND){var y=u.getLayoutProperty("visibility");y&&y.getValue()===b.Visibility.NONE||void 0!==u.minzoom&&u.minzoom>k+1E-6||void 0!==u.maxzoom&&u.maxzoom<=k-1E-6||(c.styleLayerUID=u.uid,c.styleLayer=u,this._drawWithBrush(c,h,"vtlBackground"))}})}}drawTile(c,h,d,g){const {context:k}=c;d=d.layers;k.setBlendingEnabled(!1);k.setDepthTestEnabled(!0);k.setDepthWriteEnabled(!0);k.setDepthFunction(e.CompareFunction.LEQUAL);
c.renderPass="opaque";for(var p=d.length-1;0<=p;p--){var u=d[p];null!=g&&g!==u.type||this._renderStyleLayer(u,c,h,!1)}k.setDepthWriteEnabled(!1);k.setBlendingEnabled(!0);k.setBlendFunctionSeparate(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);c.renderPass="translucent";for(p=0;p<d.length;p++)u=d[p],null!=g&&g!==u.type||this._renderStyleLayer(u,c,h,!1);k.setDepthTestEnabled(!1);k.bindVAO()}_renderStyleLayer(c,h,d,g){if(g||c&&d.layerData.has(c.uid))if(g=
c.getLayoutProperty("visibility"),!g||g.getValue()!==b.Visibility.NONE){({renderPass:g}=h);switch(c.type){case b.StyleLayerType.BACKGROUND:if("background"!==g)return;var k="vtlBackground";break;case b.StyleLayerType.FILL:if("opaque"!==g&&"translucent"!==h.renderPass)return;k="vtlFill";break;case b.StyleLayerType.LINE:if("translucent"!==g)return;k="vtlLine";break;case b.StyleLayerType.CIRCLE:if("translucent"!==g)return;k="vtlCircle";break;case b.StyleLayerType.SYMBOL:if("translucent"!==g)return;k=
"vtlSymbol"}g=h.displayLevel;void 0!==c.minzoom&&c.minzoom>g+1E-6||void 0!==c.maxzoom&&c.maxzoom<=g-1E-6||({context:g}=h,g.setStencilTestEnabled(!1),g.setStencilWriteMask(0),h.styleLayerUID=c.uid,h.styleLayer=c,this._drawWithBrush(h,d,k))}}_drawWithBrush(c,h,d){this._brushCache.has(d)||this._brushCache.set(d,new w.vtlBrushes[d]);this._brushCache.get(d).drawMany(c,[h])}}return f})},"esri/views/2d/engine/vtlBrushes":function(){define("exports ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),
function(m,w,n,b,e,f){m.vtlBrushes={vtlBackground:w.WGLBrushVTLBackground,vtlFill:b.WGLBrushVTLFill,vtlLine:e.WGLBrushVTLLine,vtlCircle:n.WGLBrushVTLCircle,vtlSymbol:f.WGLBrushVTLSymbol};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../definitions ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(m,w,n,b,e,f,c,h,d){class g extends f{constructor(){super(...arguments);this._color=b.fromValues(1,0,0,1);this._patternMatrix=n.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(k,p){const {context:u,painter:y,requestRender:t,allowDelayedRender:z}=k;this._loadWGLResources(k);const F=k.displayLevel;var D=k.styleLayer,E=D.backgroundMaterial;const G=y.vectorTilesMaterialManager;var H=D.getPaintValue("background-color",F),L=D.getPaintValue("background-opacity",
F);const M=D.getPaintValue("background-pattern",F),r=void 0!==M,x=k.spriteMosaic;let v,B;k=(window.devicePixelRatio|1)>e.vtlHighResCutoff?2:1;const C=this._programOptions;C.pattern=r;E=G.getMaterialProgram(u,E,C);if(z&&null!=t&&!E.compiled)t();else{u.bindVAO(this._vao);u.useProgram(E);if(r){H=x.getMosaicItemPosition(M,!0);if(null!=H){const {tl:J,br:K,page:O}=H;v=K[0]-J[0];B=K[1]-J[1];H=x.getPageSize(O);null!=H&&(x.bind(u,h.TextureSamplingMode.LINEAR,O,e.vtlTextureBindingUnitSprites),E.setUniform4f("u_tlbr",
J[0],J[1],K[0],K[1]),E.setUniform2fv("u_mosaicSize",H),E.setUniform1i("u_texture",e.vtlTextureBindingUnitSprites))}E.setUniform1f("u_opacity",L)}else L*=H[3],this._color[0]=L*H[0],this._color[1]=L*H[1],this._color[2]=L*H[2],this._color[3]=L,E.setUniform4fv("u_color",this._color);E.setUniform1f("u_depth",D.z||0);for(const J of p)E.setUniform1f("u_coord_range",J.rangeX),E.setUniformMatrix3fv("u_dvsMat3",J.transforms.displayViewScreenMat3),r&&(D=k*J.width*Math.max(2**(Math.round(F)-J.key.level),1),p=
D/w.nextPowerOfTwo(v),D/=w.nextPowerOfTwo(B),this._patternMatrix[0]=p,this._patternMatrix[4]=D,E.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),u.setStencilFunction(h.CompareFunction.EQUAL,0,255),u.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(k){if(!this._vao){var {context:p,styleLayer:u}=k;k=u.backgroundMaterial;var y=new Int8Array([0,0,1,0,0,1,1,1]);y=c.BufferObject.createVertex(p,h.Usage.STATIC_DRAW,y);this._vao=new d.VertexArrayObject(p,k.getAttributeLocations(),
k.getLayoutInfo(),{geometry:y})}}}m.WGLBrushVTLBackground=g;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(m){function w(){return new Float32Array(4)}function n(E){const G=new Float32Array(4);G[0]=E[0];G[1]=E[1];G[2]=E[2];G[3]=E[3];return G}function b(E,G,H,L){const M=new Float32Array(4);M[0]=E;M[1]=G;M[2]=H;M[3]=L;return M}function e(E,G){return new Float32Array(E,G,4)}function f(){return w()}function c(){return b(1,
1,1,1)}function h(){return b(1,0,0,0)}function d(){return b(0,1,0,0)}function g(){return b(0,0,1,0)}function k(){return b(0,0,0,1)}const p=w(),u=c(),y=h(),t=d(),z=g(),F=k(),D=Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_W:F,UNIT_X:y,UNIT_Y:t,UNIT_Z:z,ZEROS:p,clone:n,create:w,createView:e,fromValues:b,ones:c,unitW:k,unitX:h,unitY:d,unitZ:g,zeros:f},Symbol.toStringTag,{value:"Module"}));m.ONES=u;m.UNIT_W=F;m.UNIT_X=y;m.UNIT_Y=t;m.UNIT_Z=z;m.ZEROS=p;m.clone=n;m.create=w;m.createView=
e;m.fromValues=b;m.ones=c;m.unitW=k;m.unitX=h;m.unitY=d;m.unitZ=g;m.vec4f32=D;m.zeros=f;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class m{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(w,n){}draw(w,n,b){}drawMany(w,n,b){for(const e of n)e.visible&&this.draw(w,e,b)}}return m})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","./WGLBrush","../../../../webgl/enums"],function(m,w,n,b){class e extends n{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(f,c){const {context:h,displayLevel:d,requiredLevel:g,state:k,painter:p,spriteMosaic:u,styleLayerUID:y,requestRender:t,allowDelayedRender:z}=f;if(c.some(H=>H.layerData.get(y)?.circleIndexCount??!1)){f=f.styleLayer;var F=f.circleMaterial,D=p.vectorTilesMaterialManager,E=f.getPaintValue("circle-translate",
d),G=f.getPaintValue("circle-translate-anchor",d);D=D.getMaterialProgram(h,F,this._programOptions);if(z&&null!=t&&!D.compiled)t();else{h.useProgram(D);D.setUniformMatrix3fv("u_displayMat3",G===w.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);D.setUniform2fv("u_circleTranslation",E);D.setUniform1f("u_depth",f.z);D.setUniform1f("u_antialiasingWidth",1.2);E=-1;for(const H of c)H.layerData.has(y)&&(H.key.level!==E&&(E=H.key.level,F.setDataUniforms(D,d,f,E,u)),c=H.layerData.get(y),c.circleIndexCount&&
(c.prepareForRendering(h),G=c.vao,null!=G&&(h.bindVAO(G),D.setUniformMatrix3fv("u_dvsMat3",H.transforms.displayViewScreenMat3),g!==H.key.level?h.setStencilFunction(b.CompareFunction.EQUAL,H.stencilRef,255):h.setStencilFunction(b.CompareFunction.GREATER,255,255),h.drawElements(b.PrimitiveType.TRIANGLES,c.circleIndexCount,b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*c.circleIndexStart),H.triangleCount+=c.circleIndexCount/3)))}}}}m.WGLBrushVTLCircle=e;Object.defineProperty(m,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports","../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(m,w,n,b,e){const f=1/65536;class c extends b{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(h,d){const {displayLevel:g,renderPass:k,spriteMosaic:p,styleLayerUID:u}=h;var y=!1;for(var t of d)if(t.layerData.has(u)){var z=
t.layerData.get(u);if(0<z.fillIndexCount||0<z.outlineIndexCount){y=!0;break}}if(y){y=h.styleLayer;var F=y.getPaintProperty("fill-pattern");z=(t=void 0!==F)&&F.isDataDriven;if(t&&!z){var D=F.getValue(g);D=p.getMosaicItemPosition(D,!0)}F=!t&&y.getPaintValue("fill-antialias",g);var E=!0,G=1;if(!t){var H=y.getPaintProperty("fill-color"),L=y.getPaintProperty("fill-opacity");H?.isDataDriven||L?.isDataDriven||(G=y.getPaintValue("fill-color",g),G=y.getPaintValue("fill-opacity",g)*G[3],1<=G&&(E=!1))}E&&"opaque"===
k||(H=y.getPaintValue("fill-translate",g),L=y.getPaintValue("fill-translate-anchor",g),(E||"translucent"!==k)&&this._drawFill(h,u,y,d,H,L,t,D,z),D=!y.hasDataDrivenOutlineColor&&y.outlineUsesFillColor&&1>G,F&&"opaque"!==k&&!D&&this._drawOutline(h,u,y,d,H,L))}}_drawFill(h,d,g,k,p,u,y,t,z){if(!y||z||null!=t){var {context:F,displayLevel:D,state:E,painter:G,pixelRatio:H,spriteMosaic:L,requestRender:M,allowDelayedRender:r}=h;h=g.fillMaterial;var x=G.vectorTilesMaterialManager,v=H>n.vtlHighResCutoff?2:1,
B=this._fillProgramOptions;B.pattern=y;x=x.getMaterialProgram(F,h,B);if(r&&null!=M&&!x.compiled)M();else{F.useProgram(x);null!=t&&({page:t}=t,B=L.getPageSize(t),null!=B&&(L.bind(F,e.TextureSamplingMode.LINEAR,t,n.vtlTextureBindingUnitSprites),x.setUniform2fv("u_mosaicSize",B),x.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites)));x.setUniformMatrix3fv("u_displayMat3",u===w.TranslateAnchor.VIEWPORT?E.displayMat3:E.displayViewMat3);x.setUniform2fv("u_fillTranslation",p);x.setUniform1f("u_depth",
g.z+f);p=-1;for(const C of k)if(C.layerData.has(d)&&(C.key.level!==p&&(p=C.key.level,h.setDataUniforms(x,D,g,p,L)),k=C.layerData.get(d),k.fillIndexCount&&(k.prepareForRendering(F),u=k.fillVAO,null!=u))){F.bindVAO(u);x.setUniformMatrix3fv("u_dvsMat3",C.transforms.displayViewScreenMat3);F.setStencilFunction(e.CompareFunction.EQUAL,C.stencilRef,255);y&&x.setUniform1f("u_patternFactor",C.rangeX/(v*C.width*Math.max(2**(Math.round(D)-C.key.level),1)));if(z){u=k.patternMap;if(!u)continue;for(const [J,K]of u)u=
L.getPageSize(J),null!=u&&(L.bind(F,e.TextureSamplingMode.LINEAR,J,n.vtlTextureBindingUnitSprites),x.setUniform2fv("u_mosaicSize",u),x.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites),F.drawElements(e.PrimitiveType.TRIANGLES,K[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*K[0]))}else F.drawElements(e.PrimitiveType.TRIANGLES,k.fillIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.fillIndexStart);C.triangleCount+=k.fillIndexCount/3}}}}_drawOutline(h,d,g,k,p,u){const {context:y,
displayLevel:t,state:z,painter:F,pixelRatio:D,spriteMosaic:E,requestRender:G,allowDelayedRender:H}=h;h=g.outlineMaterial;const L=.75/D,M=F.vectorTilesMaterialManager.getMaterialProgram(y,h,this._outlineProgramOptions);if(H&&null!=G&&!M.compiled)G();else{y.useProgram(M);M.setUniformMatrix3fv("u_displayMat3",u===w.TranslateAnchor.VIEWPORT?z.displayMat3:z.displayViewMat3);M.setUniform2fv("u_fillTranslation",p);M.setUniform1f("u_depth",g.z+f);M.setUniform1f("u_outline_width",L);p=-1;for(const r of k)r.layerData.has(d)&&
(r.key.level!==p&&(p=r.key.level,h.setDataUniforms(M,t,g,p,E)),k=r.layerData.get(d),k.prepareForRendering(y),k.outlineIndexCount&&(u=k.outlineVAO,null!=u&&(y.bindVAO(u),M.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3),y.setStencilFunction(e.CompareFunction.EQUAL,r.stencilRef,255),y.drawElements(e.PrimitiveType.TRIANGLES,k.outlineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.outlineIndexStart),r.triangleCount+=k.outlineIndexCount/3)))}}}m.WGLBrushVTLFill=c;
Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports","../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(m,w,n,b,e){class f extends b{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(c,h){const {context:d,displayLevel:g,state:k,painter:p,pixelRatio:u,spriteMosaic:y,styleLayerUID:t,requestRender:z,allowDelayedRender:F}=
c;if(h.some(J=>J.layerData.get(t)?.lineIndexCount??!1)){c=c.styleLayer;var D=c.lineMaterial,E=p.vectorTilesMaterialManager,G=c.getPaintValue("line-translate",g),H=c.getPaintValue("line-translate-anchor",g),L=c.getPaintProperty("line-pattern"),M=void 0!==L,r=M&&L.isDataDriven;if(M&&!r){L=L.getValue(g);var x=y.getMosaicItemPosition(L)}var v;L=!1;if(!M){var B=c.getPaintProperty("line-dasharray");L=(v=void 0!==B)&&B.isDataDriven;v&&!L&&(x=B.getValue(g),x=c.getDashKey(x,c.getLayoutValue("line-cap",g)),
x=y.getMosaicItemPosition(x))}B=1/u;var C=this._programOptions;C.pattern=M;C.sdf=v;v=E.getMaterialProgram(d,D,C);if(F&&null!=z&&!v.compiled)z();else{d.useProgram(v);v.setUniformMatrix3fv("u_displayViewMat3",k.displayViewMat3);v.setUniformMatrix3fv("u_displayMat3",H===w.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);v.setUniform2fv("u_lineTranslation",G);v.setUniform1f("u_depth",c.z);v.setUniform1f("u_antialiasing",B);x&&null!=x&&({page:G}=x,H=y.getPageSize(G),null!=H&&(y.bind(d,e.TextureSamplingMode.LINEAR,
G,n.vtlTextureBindingUnitSprites),v.setUniform2fv("u_mosaicSize",H),v.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites)));G=-1;for(const J of h)if(J.layerData.has(t)&&(J.key.level!==G&&(G=J.key.level,D.setDataUniforms(v,g,c,G,y)),v.setUniform1f("u_zoomFactor",2**(g-G)/u),h=J.layerData.get(t),h.lineIndexCount&&(h.prepareForRendering(d),H=h.vao,null!=H))){d.bindVAO(H);v.setUniformMatrix3fv("u_dvsMat3",J.transforms.displayViewScreenMat3);d.setStencilFunction(e.CompareFunction.EQUAL,J.stencilRef,
255);if(r||L){H=h.patternMap;if(!H)continue;for(const [K,O]of H)H=y.getPageSize(K),null!=H&&(y.bind(d,e.TextureSamplingMode.LINEAR,K,n.vtlTextureBindingUnitSprites),v.setUniform2fv("u_mosaicSize",H),v.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites),d.drawElements(e.PrimitiveType.TRIANGLES,O[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*O[0]))}else d.drawElements(e.PrimitiveType.TRIANGLES,h.lineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*h.lineIndexStart);J.triangleCount+=
h.lineIndexCount/3}}}}}m.WGLBrushVTLLine=f;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../GeometryUtils ./WGLBrush ../../../../webgl/enums".split(" "),function(m,w,n,b,e,f,c,h){const d=1/65536;class g extends c{constructor(){super(...arguments);this._iconProgramOptions=
{id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=w.create()}dispose(){}drawMany(k,p){const u=k.styleLayer;this._drawIcons(k,u,p);this._drawText(k,u,p)}_drawIcons(k,p,u){const {context:y,displayLevel:t,painter:z,spriteMosaic:F,state:D,styleLayerUID:E,requestRender:G,allowDelayedRender:H}=k,L=p.iconMaterial;var M=z.vectorTilesMaterialManager;let r;var x=!1;for(var v of u)if(v.layerData.has(E)&&(r=v.layerData.get(E),0<r.iconPerPageElementsMap.size)){x=!0;break}if(x){x=p.getPaintValue("icon-translate",
t);v=p.getPaintValue("icon-translate-anchor",t);var B=p.getLayoutValue("icon-rotation-alignment",t);B===b.RotationAlignment.AUTO&&(B=p.getLayoutValue("symbol-placement",t)===b.SymbolPlacement.POINT?b.RotationAlignment.VIEWPORT:b.RotationAlignment.MAP);var C=B===b.RotationAlignment.MAP;C=p.getLayoutValue("icon-keep-upright",t)&&C;var J=this._iconProgramOptions;J.sdf=r.isIconSDF;M=M.getMaterialProgram(y,L,J);if(H&&null!=G&&!M.compiled)G();else{y.useProgram(M);M.setUniformMatrix3fv("u_displayViewMat3",
B===b.RotationAlignment.MAP?D.displayViewMat3:D.displayMat3);M.setUniformMatrix3fv("u_displayMat3",v===b.TranslateAnchor.VIEWPORT?D.displayMat3:D.displayViewMat3);M.setUniform2fv("u_iconTranslation",x);M.setUniform1f("u_depth",p.z);M.setUniform1f("u_mapRotation",f.degToByte(D.rotation));M.setUniform1f("u_keepUpright",C?1:0);M.setUniform1f("u_level",10*t);M.setUniform1i("u_texture",e.vtlTextureBindingUnitSprites);M.setUniform1f("u_fadeDuration",n.fadeDuration/1E3);x=-1;for(const K of u)if(K.layerData.has(E)&&
(K.key.level!==x&&(x=K.key.level,L.setDataUniforms(M,t,p,x,F)),r=K.layerData.get(E),0!==r.iconPerPageElementsMap.size&&(r.prepareForRendering(y),r.updateOpacityInfo(),u=r.iconVAO,null!=u))){y.bindVAO(u);M.setUniformMatrix3fv("u_dvsMat3",K.transforms.displayViewScreenMat3);M.setUniform1f("u_time",(performance.now()-r.lastOpacityUpdate)/1E3);for(const [O,R]of r.iconPerPageElementsMap)this._renderIconRange(k,M,R,O,K)}}}}_renderIconRange(k,p,u,y,t){const {context:z,spriteMosaic:F}=k;this._spritesTextureSize[0]=
F.getWidth(y)/4;this._spritesTextureSize[1]=F.getHeight(y)/4;p.setUniform2fv("u_mosaicSize",this._spritesTextureSize);F.bind(z,h.TextureSamplingMode.LINEAR,y,e.vtlTextureBindingUnitSprites);this._setStencilState(k,t);z.drawElements(h.PrimitiveType.TRIANGLES,u[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*u[0]);t.triangleCount+=u[1]/3}_drawText(k,p,u){const {context:y,displayLevel:t,glyphMosaic:z,painter:F,pixelRatio:D,spriteMosaic:E,state:G,styleLayerUID:H,requestRender:L,allowDelayedRender:M}=
k,r=p.textMaterial;var x=F.vectorTilesMaterialManager,v=!1;for(var B of u)if(B.layerData.has(H)){var C=B.layerData.get(H);if(0<C.glyphPerPageElementsMap.size){v=!0;break}}if(v&&(C=p.getPaintProperty("text-opacity"),!C||C.isDataDriven||0!==C.getValue(t))){C=p.getPaintProperty("text-color");var J=!C||C.isDataDriven||0<C.getValue(t)[3];C=p.getPaintProperty("text-halo-width");v=p.getPaintProperty("text-halo-color");var K=(!C||C.isDataDriven||0<C.getValue(t))&&(!v||v.isDataDriven||0<v.getValue(t)[3]);
if(J||K){C=p.getLayoutValue("text-rotation-alignment",t);C===b.RotationAlignment.AUTO&&(C=p.getLayoutValue("symbol-placement",t)===b.SymbolPlacement.POINT?b.RotationAlignment.VIEWPORT:b.RotationAlignment.MAP);v=C===b.RotationAlignment.MAP;v=p.getLayoutValue("text-keep-upright",t)&&v;B=.8*3/D;this._glyphTextureSize||(this._glyphTextureSize=w.fromValues(z.width/4,z.height/4));var O=p.getPaintValue("text-translate",t),R=p.getPaintValue("text-translate-anchor",t),S=x.getMaterialProgram(y,r,this._sdfProgramOptions);
if(M&&null!=L&&!S.compiled)L();else{y.useProgram(S);S.setUniformMatrix3fv("u_displayViewMat3",C===b.RotationAlignment.MAP?G.displayViewMat3:G.displayMat3);S.setUniformMatrix3fv("u_displayMat3",R===b.TranslateAnchor.VIEWPORT?G.displayMat3:G.displayViewMat3);S.setUniform2fv("u_textTranslation",O);S.setUniform1f("u_depth",p.z+d);S.setUniform2fv("u_mosaicSize",this._glyphTextureSize);S.setUniform1f("u_mapRotation",f.degToByte(G.rotation));S.setUniform1f("u_keepUpright",v?1:0);S.setUniform1f("u_level",
10*t);S.setUniform1i("u_texture",e.vtlTextureBindingUnitGlyphs);S.setUniform1f("u_antialiasingWidth",B);S.setUniform1f("u_fadeDuration",n.fadeDuration/1E3);x=-1;for(const U of u)U.layerData.has(H)&&(U.key.level!==x&&(x=U.key.level,r.setDataUniforms(S,t,p,x,E)),C=U.layerData.get(H),0!==C.glyphPerPageElementsMap.size&&(C.prepareForRendering(y),C.updateOpacityInfo(),u=C.textVAO,null!=u&&(y.bindVAO(u),S.setUniformMatrix3fv("u_dvsMat3",U.transforms.displayViewScreenMat3),this._setStencilState(k,U),u=(performance.now()-
C.lastOpacityUpdate)/1E3,S.setUniform1f("u_time",u),C.glyphPerPageElementsMap.forEach((Y,aa)=>{this._renderGlyphRange(y,Y,aa,z,S,K,J,U)}))))}}}}_renderGlyphRange(k,p,u,y,t,z,F,D){y.bind(k,h.TextureSamplingMode.LINEAR,u,e.vtlTextureBindingUnitGlyphs);z&&(t.setUniform1f("u_halo",1),k.drawElements(h.PrimitiveType.TRIANGLES,p[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*p[0]),D.triangleCount+=p[1]/3);F&&(t.setUniform1f("u_halo",0),k.drawElements(h.PrimitiveType.TRIANGLES,p[1],h.DataType.UNSIGNED_INT,
Uint32Array.BYTES_PER_ELEMENT*p[0]),D.triangleCount+=p[1]/3)}_setStencilState(k,p){const {context:u,is3D:y,stencilSymbols:t}=k;u.setStencilTestEnabled(!0);t?(u.setStencilWriteMask(255),u.setStencilFunction(h.CompareFunction.ALWAYS,p.stencilRef,255)):(u.setStencilWriteMask(0),y?u.setStencilFunction(h.CompareFunction.EQUAL,p.stencilRef,255):u.setStencilFunction(h.CompareFunction.GREATER,255,255))}}m.WGLBrushVTLSymbol=g;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],
function(m){function w(f,c){f%=c;return 0<=f?f:f+c}const n=128/Math.PI,b=256/360,e=1/Math.LN2;m.between=function(f,c,h){return f>=c&&f<=h||f>=h&&f<=c};m.degToByte=function(f){return w(f*b,256)};m.interpolate=function(f,c,h){return f*(1-h)+c*h};m.log2=function(f){return Math.log(f)*e};m.positiveMod=w;m.radToByte=function(f){return w(f*n,256)};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],
function(m,w){class n{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(b=>b.dispose());this._programByKey.clear()}getMaterialProgram(b,e,f){const c=e.key<<3|this._getMaterialOptionsValue(e.type,f);if(this._programByKey.has(c))return this._programByKey.get(c);var h=this._getProgramTemplate(e.type);({shaders:h}=h);const {vertexShader:d,fragmentShader:g}=h(f);f=e.getShaderHeader();h=e.getShaderMain();f=d.replace("#pragma header",f).replace("#pragma main",h);b=b.programCache.acquire(f,
g,e.getAttributeLocations());this._programByKey.set(c,b);return b}_getMaterialOptionsValue(b,e){switch(b){case m.ShaderProgramType.BACKGROUND:return(e.pattern?1:0)<<1;case m.ShaderProgramType.FILL:return(e.pattern?1:0)<<1;case m.ShaderProgramType.OUTLINE:return 0;case m.ShaderProgramType.LINE:return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1;case m.ShaderProgramType.ICON:return(e.sdf?1:0)<<1;case m.ShaderProgramType.CIRCLE:return 0;case m.ShaderProgramType.TEXT:return 0;default:return 0}}_getProgramTemplate(b){switch(b){case m.ShaderProgramType.BACKGROUND:return w.background;
case m.ShaderProgramType.CIRCLE:return w.circle;case m.ShaderProgramType.FILL:return w.fill;case m.ShaderProgramType.ICON:return w.icon;case m.ShaderProgramType.LINE:return w.line;case m.ShaderProgramType.OUTLINE:return w.outline;case m.ShaderProgramType.TEXT:return w.text;default:return null}}}return n})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(m,w,n){m.background={shaders:b=>({vertexShader:n.glslifyDefineMap({PATTERN:b.pattern})+
w.resolveIncludes("background/background.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:b.pattern})+w.resolveIncludes("background/background.frag")})};m.circle={shaders:b=>({vertexShader:w.resolveIncludes("circle/circle.vert"),fragmentShader:w.resolveIncludes("circle/circle.frag")})};m.fill={shaders:b=>({vertexShader:n.glslifyDefineMap({PATTERN:b.pattern})+w.resolveIncludes("fill/fill.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:b.pattern})+w.resolveIncludes("fill/fill.frag")})};m.icon={shaders:b=>
({vertexShader:n.glslifyDefineMap({SDF:b.sdf})+w.resolveIncludes("icon/icon.vert"),fragmentShader:n.glslifyDefineMap({SDF:b.sdf})+w.resolveIncludes("icon/icon.frag")})};m.line={shaders:b=>({vertexShader:n.glslifyDefineMap({PATTERN:b.pattern,SDF:b.sdf})+w.resolveIncludes("line/line.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:b.pattern,SDF:b.sdf})+w.resolveIncludes("line/line.frag")})};m.outline={shaders:b=>({vertexShader:w.resolveIncludes("outline/outline.vert"),fragmentShader:w.resolveIncludes("outline/outline.frag")})};
m.text={shaders:b=>({vertexShader:w.resolveIncludes("text/text.vert"),fragmentShader:w.resolveIncludes("text/text.frag")})};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(m,w,n){const b=new n.ShaderCompiler(function(e){let f=w;e.split("/").forEach(c=>{f&&=f[c]});return f});m.resolveIncludes=function(e){return b.resolveIncludes(e)};
Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],function(m){class w{constructor(n){this._readFile=n}resolveIncludes(n){return this._resolve(n)}_resolve(n,
b=new Map){if(b.has(n))return b.get(n);const e=this._read(n);if(!e)throw Error(`cannot find shader file ${n}`);const f=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let c=f.exec(e);const h=[];for(;null!=c;)h.push({path:c[1],start:c.index,length:c[0].length}),c=f.exec(e);let d=0,g="";h.forEach(k=>{g+=e.slice(d,k.start);g+=b.has(k.path)?"":this._resolve(k.path,b);d=k.start+k.length});g+=e.slice(d);b.set(n,g);return g}_read(n){return this._readFile(n)}}m.ShaderCompiler=w;Object.defineProperty(m,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/programUtils":function(){define(["exports"],function(m){m.glslifyDefineMap=function(w){let n="";for(const e in w){var b=w[e];if("boolean"===typeof b)b&&(n+=`#define ${e}\n`);else if("number"===typeof b)n+=`#define ${e} ${b.toFixed()}\n`;else if("object"===typeof b){const {options:f,value:c}=b;if("number"===typeof f[c]){const {value:h,options:d,namespace:g}=b;b=g?`${g}_`:"";for(const k in d)n+=`#define ${b}${k} ${d[k].toFixed()}\n`;n+=`#define ${e} ${b}${h}\n`}else{const h=
b.options;let d=0;for(const g in h)n+=`#define ${h[g]} ${(d++).toFixed()}\n`;n+=`#define ${e} ${h[b.value]}\n`}}}return n};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(m,w){class n{constructor(b){this._style=b;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;b.layers||(b.layers=[]);this.version=parseFloat(b.version);
if(this.layers=b.layers.map((e,f,c)=>this._create(e,f,c)).filter(e=>!!e))for(b=0;b<this.layers.length;b++){const e=this.layers[b];this._layerByName[e.id]=e;this._uidToLayer.set(e.uid,e);e.type===m.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(b){return(b=this._layerByName[b])?b.isPainterDataDriven():!1}getStyleLayerId(b){return b>=this.layers.length?null:this.layers[b].id}getStyleLayerByUID(b){return this._uidToLayer.get(b)??null}getStyleLayerIndex(b){return(b=
this._layerByName[b])?this.layers.indexOf(b):-1}setStyleLayer(b,e){if(b?.id){var f=this._style;null!=e&&e>=this.layers.length&&(e=this.layers.length-1);var c=!0,h;if(h=this._layerByName[b.id]){const d=this.layers.indexOf(h);e||=d;e===d?(c=!1,h=n._recreateLayer(b,h),this.layers[e]=h,f.layers[e]=b):(this.layers.splice(d,1),f.layers.splice(d,1),h=this._create(b,e,this.layers),this.layers.splice(e,0,h),f.layers.splice(e,0,b))}else h=this._create(b,e,this.layers),!e||e>=this.layers.length?(this.layers.push(h),
f.layers.push(b)):(this.layers.splice(e,0,h),f.layers.splice(e,0,b));this._layerByName[b.id]=h;this._uidToLayer.set(h.uid,h);c&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(b){return(b=this._layerByName[b])?{type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:b.paint}:null}deleteStyleLayer(b){const e=this._layerByName[b];e&&(delete this._layerByName[b],this._uidToLayer.delete(e.uid),b=this.layers.indexOf(e),
this.layers.splice(b,1),this._style.layers.splice(b,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(b){return this._layerByName[b]}getLayoutProperties(b){return(b=this._layerByName[b])?b.layout:null}getPaintProperties(b){return(b=this._layerByName[b])?b.paint:null}setPaintProperties(b,e){if(b=this._layerByName[b]){var f=n._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:e},
b),c=this.layers.indexOf(b);this.layers[c]=f;this._style.layers[c].paint=e;this._layerByName[b.id]=f;this._uidToLayer.set(b.uid,f)}}setLayoutProperties(b,e){if(b=this._layerByName[b]){var f=n._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:e,paint:b.paint},b),c=this.layers.indexOf(b);this.layers[c]=f;this._style.layers[c].layout=e;this._layerByName[b.id]=f;this._uidToLayer.set(b.uid,f)}}setStyleLayerVisibility(b,
e){if(b=this._layerByName[b]){var f=b.layout||{};f.visibility=e;e=n._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:f,paint:b.paint},b);var c=this.layers.indexOf(b);this.layers[c]=e;this._style.layers[c].layout=f;this._layerByName[b.id]=e;this._uidToLayer.set(b.uid,e)}}getStyleLayerVisibility(b){return(b=this._layerByName[b])?b.layout?.visibility??"visible":"none"}_recomputeZValues(){const b=this.layers,
e=1/(b.length+1);for(let f=0;f<b.length;f++)b[f].z=1-(1+f)*e}_identifyRefLayers(){const b=[],e=[];let f=0;for(const d of this.layers){const g=d.layout;if(d.type===m.StyleLayerType.FILL){var c=d,h=d.source+"|"+d.sourceLayer;h+="|"+(g?.visibility??"");h+="|"+d.minzoom;h+="|"+d.maxzoom;h+="|"+JSON.stringify(d.filter);if(c.hasDataDrivenFill||c.hasDataDrivenOutline)h+="|"+f;b.push({key:h,layer:d})}else if(d.type===m.StyleLayerType.LINE){c=d;h=d.paint;h=null!=h&&(null!=h["line-pattern"]||null!=h["line-dasharray"]);
let k=d.source+"|"+d.sourceLayer;k+="|"+(g?.visibility??"");k+="|"+d.minzoom;k+="|"+d.maxzoom;k+="|"+JSON.stringify(d.filter);k+="|"+(void 0!==g?g["line-cap"]:"");k+="|"+(void 0!==g?g["line-join"]:"");if(c.hasDataDrivenLine||h)k+="|"+f;e.push({key:k,layer:d})}++f}this._assignRefLayers(b);this._assignRefLayers(e)}_assignRefLayers(b){b.sort((g,k)=>g.key<k.key?-1:g.key>k.key?1:0);let e,f;const c=b.length;for(let g=0;g<c;g++){const k=b[g];if(k.key===e)k.layer.refLayerId=f;else if(e=k.key,f=k.layer.id,
k.layer.type===m.StyleLayerType.FILL){if(!k.layer.getPaintProperty("fill-outline-color"))for(var h=g+1;h<c;h++){var d=b[h];if(d.key===e){if(d.layer.getPaintProperty("fill-outline-color")){b[g]=d;b[h]=k;f=d.layer.id;break}}else break}}else if(k.layer.type===m.StyleLayerType.LINE)for(h=k.layer,d=g+1;d<c;d++){const p=b[d];if(p.key!==e)break;const u=p.layer;if(h.canUseThinTessellation&&!u.canUseThinTessellation||!h.canUseThinTessellation&&(u.getPaintProperty("line-pattern")||u.getPaintProperty("line-dasharray")))h=
u,b[g]=p,b[d]=k,f=p.layer.id}}}_create(b,e,f){e=1-1/(f.length+1)*(1+e);f=this._runningId++;switch(b.type){case "background":return new w.BackgroundStyleLayer(m.StyleLayerType.BACKGROUND,b,e,f);case "fill":return new w.FillStyleLayer(m.StyleLayerType.FILL,b,e,f);case "line":return new w.LineStyleLayer(m.StyleLayerType.LINE,b,e,f);case "symbol":return new w.SymbolStyleLayer(m.StyleLayerType.SYMBOL,b,e,f);case "raster":console.warn(`Unsupported vector tile raster layer ${b.id}`);break;case "circle":return new w.CircleStyleLayer(m.StyleLayerType.CIRCLE,
b,e,f)}return null}static _recreateLayer(b,e){switch(b.type){case "background":return new w.BackgroundStyleLayer(m.StyleLayerType.BACKGROUND,b,e.z,e.uid);case "fill":return new w.FillStyleLayer(m.StyleLayerType.FILL,b,e.z,e.uid);case "line":return new w.LineStyleLayer(m.StyleLayerType.LINE,b,e.z,e.uid);case "symbol":return new w.SymbolStyleLayer(m.StyleLayerType.SYMBOL,b,e.z,e.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${b.id}`);break;case "circle":return new w.CircleStyleLayer(m.StyleLayerType.CIRCLE,
b,e.z,e.uid)}return null}}return n})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(m,w,n,b,e,f,c,h,d,g,k,p,u){function y(r){r=r?.getGeometry();if(null==r)return null;
let x=Infinity,v=Infinity,B=-Infinity,C=-Infinity;for(const J of r)if(J)for(const K of J)x=Math.min(x,K.x),v=Math.min(v,K.y),B=Math.max(B,K.x),C=Math.max(C,K.y);return w.fromValues(x,v,B,C)}m.CapType=void 0;(function(r){r[r.BUTT=0]="BUTT";r[r.ROUND=1]="ROUND";r[r.SQUARE=2]="SQUARE";r[r.UNKNOWN=4]="UNKNOWN"})(m.CapType||(m.CapType={}));class t{constructor(r,x,v,B,C,J){this.layer=r;this.feature=x;this.bounds=v;this.normalizationRatio=B;this.normalizationOffsetX=C;this.normalizationOffsetY=J}}class z{constructor(r,
x,v,B){this.type=r;this.typeName=x.type;this.id=x.id;this.source=x.source;this.sourceLayer=x["source-layer"];this.minzoom=x.minzoom;this.maxzoom=x.maxzoom;this.filter=x.filter;this.layout=x.layout;this.paint=x.paint;this.z=v;this.uid=B;switch(r){case k.StyleLayerType.BACKGROUND:this._layoutDefinition=k.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=k.StyleDefinition.backgroundPaintDefinition;break;case k.StyleLayerType.FILL:this._layoutDefinition=k.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=k.StyleDefinition.fillPaintDefinition;break;case k.StyleLayerType.LINE:this._layoutDefinition=k.StyleDefinition.lineLayoutDefinition;this._paintDefinition=k.StyleDefinition.linePaintDefinition;break;case k.StyleLayerType.SYMBOL:this._layoutDefinition=k.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=k.StyleDefinition.symbolPaintDefinition;break;case k.StyleLayerType.CIRCLE:this._layoutDefinition=k.StyleDefinition.circleLayoutDefinition,this._paintDefinition=k.StyleDefinition.circlePaintDefinition}this._layoutProperties=
this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=g.createFilter(this.filter)}getLayoutProperty(r){return this._layoutProperties[r]}getPaintProperty(r){return this._paintProperties[r]}getLayoutValue(r,x,v){let B;const C=this._layoutProperties[r];C&&(B=C.getValue(x,v));void 0===B&&(B=this._layoutDefinition[r]["default"]);return B}getPaintValue(r,x,v){let B;const C=this._paintProperties[r];
C&&(B=C.getValue(x,v));void 0===B&&(B=this._paintDefinition[r]["default"]);return B}isPainterDataDriven(){const r=this._paintProperties;if(r)for(const x in r)if(r[x].isDataDriven)return!0;return!1}isIntersectingFeature(r,x,v,B,C,J,K){return!1}getFeatureInflatedBounds(r,x,v,B){return null}_parseLayout(r){const x={};for(const v in r){const B=this._layoutDefinition[v];B&&(x[v]=new p(B,r[v]))}return x}_parsePaint(r){const x={};for(const v in r){const B=this._paintDefinition[v];B&&(x[v]=new p(B,r[v]))}return x}computeAttributesKey(r,
x,v,B){let C=0,J=0;for(const K of x){x=3;if(!K||K!==B){const {isLayout:O,isOptional:R}=v[K];x=O?this.getLayoutProperty(K):this.getPaintProperty(K);x=x?.interpolator?2:x?.isDataDriven?1:R&&!x?3:0}J|=x<<C;C+=2}return J<<3|r}}class F extends z{constructor(r,x,v,B){super(r,x,v,B);this.backgroundMaterial=new e.VTLBackgroundMaterial(this.computeAttributesKey(n.ShaderProgramType.BACKGROUND,e.VTLBackgroundMaterial.ATTRIBUTES,e.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class D extends z{constructor(r,x,v,B){super(r,
x,v,B);r=this.getPaintProperty("fill-color");x=this.getPaintProperty("fill-opacity");v=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=r?.isDataDriven;this.hasDataDrivenOpacity=x?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||v?.isDataDriven;x=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!x;this.hasDataDrivenOutlineColor=x?.isDataDriven;this.hasDataDrivenOutline=x?x.isDataDriven:r?r.isDataDriven:!1;this.hasDataDrivenOutline=
(x?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new c.VTLFillMaterial(this.computeAttributesKey(n.ShaderProgramType.FILL,c.VTLFillMaterial.ATTRIBUTES,c.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new c.VTLOutlineMaterial(this.computeAttributesKey(n.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_FILL:c.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:
c.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(r,x,v,B){v=y(r);if(!v)return null;r=this.getPaintValue("fill-translate",x,r);B*=Math.max(r[0],r[1]);v[0]-=B;v[2]-=B;v[1]+=B;v[3]+=B;return v}isIntersectingFeature(r,x,v,B,C,J,K){const O=B.getGeometry();if(!O)return!1;const R=8/K.normalizationRatio;r=r/K.normalizationRatio+K.normalizationOffsetX;x=x/K.normalizationRatio+K.normalizationOffsetY;B=b.translateAnchor(this.getPaintValue("fill-translate",C,B),
this.getPaintValue("fill-translate-anchor",C,B),J,8);r-=R*B.x;x-=R*B.y;return b.pointInPolygon(r,x,O)?!0:b.distanceFromToPolylineWithinThreshold(r,x,O,R*v)}}class E extends z{constructor(r,x,v,B){super(r,x,v,B);r=this.getPaintProperty("line-pattern");this.lineMaterial=new h.VTLLineMaterial(this.computeAttributesKey(n.ShaderProgramType.LINE,h.VTLLineMaterial.ATTRIBUTES,h.VTLLineMaterial.ATTRIBUTES_INFO,r?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||
this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(r=this.getPaintProperty("line-width"),
!r||"number"===typeof r&&.5*r<u.thinLineHalfWidthThreshold)&&(r=this.getPaintProperty("line-offset"),!r||"number"===typeof r&&0===r)&&(this.canUseThinTessellation=!0)}getDashKey(r,x){switch(x){case m.CapType.BUTT:x="Butt";break;case m.CapType.ROUND:x="Round";break;case m.CapType.SQUARE:x="Square";break;default:x="Butt"}return`dasharray-[${r.toString()}]-${x}`}getFeatureInflatedBounds(r,x,v,B){v=y(r);if(!v)return null;var C=this.getPaintValue("line-translate",x,r);C=B*Math.max(C[0],C[1]);v[0]-=C;v[2]-=
C;v[1]+=C;v[3]+=C;C=B*Math.abs(this.getPaintValue("line-offset",x,r)||0);r=this.getPaintValue("line-width",x,r);B*=r/2;v[0]-=C+B;v[1]-=C+B;v[2]+=C+B;v[3]+=C+B;return v}isIntersectingFeature(r,x,v,B,C,J,K){let O=B.getGeometry();if(!O)return!1;const R=8/K.normalizationRatio;r=r/K.normalizationRatio+K.normalizationOffsetX;x=x/K.normalizationRatio+K.normalizationOffsetY;J=b.translateAnchor(this.getPaintValue("line-translate",C,B),this.getPaintValue("line-translate-anchor",C,B),J,8);r-=R*J.x;x-=R*J.y;
J=R*this.getPaintValue("line-offset",C,B)||0;0!==J&&(O=b.offsetLine(O,-J));B=this.getPaintValue("line-width",C,B);return b.distanceFromToPolylineWithinThreshold(r,x,O,R*(v+B/2))}}class G extends z{constructor(r,x,v,B){super(r,x,v,B);this.iconMaterial=new d.VTLIconMaterial(this.computeAttributesKey(n.ShaderProgramType.ICON,d.VTLIconMaterial.ATTRIBUTES,d.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new d.VTLTextMaterial(this.computeAttributesKey(n.ShaderProgramType.TEXT,d.VTLTextMaterial.ATTRIBUTES,
d.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class H extends z{constructor(r,x,v,B){super(r,x,v,B);this.circleMaterial=new f.VTLCircleMaterial(this.computeAttributesKey(n.ShaderProgramType.CIRCLE,f.VTLCircleMaterial.ATTRIBUTES,f.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(r,x,v,B){v=y(r);if(!v)return null;var C=
this.getPaintValue("circle-translate",x,r);C=Math.max(C[0],C[1]);v[0]-=C;v[2]-=C;v[1]+=C;v[3]+=C;r=8*(this.getPaintValue("circle-radius",x,r)+this.getPaintValue("circle-stroke-width",x,r));B*=r/2;v[0]-=B;v[1]-=B;v[2]+=B;v[3]+=B;return v}isIntersectingFeature(r,x,v,B,C,J,K){var O=B.getGeometry();if(!O)return!1;const R=8/K.normalizationRatio;r=r/K.normalizationRatio+K.normalizationOffsetX;x=x/K.normalizationRatio+K.normalizationOffsetY;v*=R;J=b.translateAnchor(this.getPaintValue("circle-translate",
C,B),this.getPaintValue("circle-translate-anchor",C,B),J,R);B=R*(this.getPaintValue("circle-radius",C,B)+this.getPaintValue("circle-stroke-width",C,B));for(const S of O)if(S)for(const U of S)if(O=U.x+J.x,C=U.y+J.y,Math.sqrt((r-O)*(r-O)+(x-C)*(x-C))-v<=B)return!0;return!1}}class L{constructor(r,x,v){this.allowOverlap=r.getLayoutValue("icon-allow-overlap",x);this.ignorePlacement=r.getLayoutValue("icon-ignore-placement",x);this.keepUpright=r.getLayoutValue("icon-keep-upright",x);this.optional=r.getLayoutValue("icon-optional",
x);this.rotationAlignment=r.getLayoutValue("icon-rotation-alignment",x);this.rotationAlignment===k.RotationAlignment.AUTO&&(this.rotationAlignment=v?k.RotationAlignment.MAP:k.RotationAlignment.VIEWPORT);v=r.getLayoutProperty("icon-anchor");v?.isDataDriven?this._anchorProp=v:this.anchor=r.getLayoutValue("icon-anchor",x);v=r.getLayoutProperty("icon-offset");v?.isDataDriven?this._offsetProp=v:this.offset=r.getLayoutValue("icon-offset",x);v=r.getLayoutProperty("icon-padding");v?.isDataDriven?this._paddingProp=
v:this.padding=r.getLayoutValue("icon-padding",x);v=r.getLayoutProperty("icon-rotate");v?.isDataDriven?this._rotateProp=v:this.rotate=r.getLayoutValue("icon-rotate",x);v=r.getLayoutProperty("icon-size");v?.isDataDriven?this._sizeProp=v:this.size=r.getLayoutValue("icon-size",x)}update(r,x){this._anchorProp&&(this.anchor=this._anchorProp.getValue(r,x));this._offsetProp&&(this.offset=this._offsetProp.getValue(r,x));this._paddingProp&&(this.padding=this._paddingProp.getValue(r,x));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(r,x));this._sizeProp&&(this.size=this._sizeProp.getValue(r,x))}}class M{constructor(r,x,v){this.allowOverlap=r.getLayoutValue("text-allow-overlap",x);this.ignorePlacement=r.getLayoutValue("text-ignore-placement",x);this.keepUpright=r.getLayoutValue("text-keep-upright",x);this.optional=r.getLayoutValue("text-optional",x);this.rotationAlignment=r.getLayoutValue("text-rotation-alignment",x);this.rotationAlignment===k.RotationAlignment.AUTO&&(this.rotationAlignment=v?k.RotationAlignment.MAP:
k.RotationAlignment.VIEWPORT);v=r.getLayoutProperty("text-anchor");v?.isDataDriven?this._anchorProp=v:this.anchor=r.getLayoutValue("text-anchor",x);v=r.getLayoutProperty("text-justify");v?.isDataDriven?this._justifyProp=v:this.justify=r.getLayoutValue("text-justify",x);v=r.getLayoutProperty("text-letter-spacing");v?.isDataDriven?this._letterSpacingProp=v:this.letterSpacing=r.getLayoutValue("text-letter-spacing",x);v=r.getLayoutProperty("text-line-height");v?.isDataDriven?this._lineHeightProp=v:this.lineHeight=
r.getLayoutValue("text-line-height",x);v=r.getLayoutProperty("text-max-angle");v?.isDataDriven?this._maxAngleProp=v:this.maxAngle=r.getLayoutValue("text-max-angle",x);v=r.getLayoutProperty("text-max-width");v?.isDataDriven?this._maxWidthProp=v:this.maxWidth=r.getLayoutValue("text-max-width",x);v=r.getLayoutProperty("text-offset");v?.isDataDriven?this._offsetProp=v:this.offset=r.getLayoutValue("text-offset",x);v=r.getLayoutProperty("text-padding");v?.isDataDriven?this._paddingProp=v:this.padding=r.getLayoutValue("text-padding",
x);v=r.getLayoutProperty("text-rotate");v?.isDataDriven?this._rotateProp=v:this.rotate=r.getLayoutValue("text-rotate",x);v=r.getLayoutProperty("text-size");v?.isDataDriven?this._sizeProp=v:this.size=r.getLayoutValue("text-size",x);v=r.getLayoutProperty("text-writing-mode");v?.isDataDriven?this._writingModeProp=v:this.writingMode=r.getLayoutValue("text-writing-mode",x)}update(r,x){this._anchorProp&&(this.anchor=this._anchorProp.getValue(r,x));this._justifyProp&&(this.justify=this._justifyProp.getValue(r,
x));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(r,x));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(r,x));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(r,x));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(r,x));this._offsetProp&&(this.offset=this._offsetProp.getValue(r,x));this._paddingProp&&(this.padding=this._paddingProp.getValue(r,x));this._rotateProp&&(this.rotate=this._rotateProp.getValue(r,x));this._sizeProp&&
(this.size=this._sizeProp.getValue(r,x));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(r,x))}}m.BackgroundStyleLayer=F;m.CircleStyleLayer=H;m.FillStyleLayer=D;m.IconLayout=L;m.IndexItem=t;m.LineStyleLayer=E;m.StyleLayer=z;m.SymbolStyleLayer=G;m.TextLayout=M;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(m,w,n,b){class e extends w.VTLMaterial{constructor(f){super(f)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES=[];e.GEOMETRY_LAYOUT=[new b.VertexElementDescriptor("a_pos",2,n.DataType.BYTE,0,2)];e.ATTRIBUTES_INFO={};m.VTLBackgroundMaterial=e;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(m,w,n,b,e){class f{constructor(d){this._locations=new Map;this._key=d}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(d,g,k,p,u){var y=this.getUniforms();for(const t of y){const {name:z,type:F,getValue:D}=t;y=D(k,g,p,u);if(null!==y)switch(F){case "float":d.setUniform1f(z,y);break;case "vec2":d.setUniform2fv(z,
y);break;case "vec4":d.setUniform4fv(z,y)}}}encodeAttributes(d,g,k,p){const u=this.attributesInfo(),y=this.getEncodingInfos(),t=[];let z=0,F=0;for(const E of Object.keys(y)){var D=y[E];const {type:G,precisionFactor:H,isLayout:L}=u[E],M=L?k.getLayoutProperty(E):k.getPaintProperty(E),r=M.interpolator?.getInterpolationRange(g);let x=0;for(const v of D){const {offset:B,bufferElementsToAdd:C}=v;if(0<C){for(D=0;D<C;D++)t.push(0);z+=F;F=v.bufferElementsToAdd}D=p??M.getValue(r?r[x]:g,d);switch(G){case n.EncodingType.R8_SIGNED:case n.EncodingType.R8_UNSIGNED:t[z]|=
this._encodeByte(D*(H||1),8*B);break;case n.EncodingType.R16_SIGNED:case n.EncodingType.R16_UNSIGNED:t[z]|=this._encodeShort(D*(H||1),8*B);break;case n.EncodingType.R8G8_SIGNED:case n.EncodingType.R8G8_UNSIGNED:t[z]|=this._encodeByte(D*(H||1),8*B);t[z]|=this._encodeByte(D*(H||1),8*B+8);break;case n.EncodingType.R16G16_SIGNED:case n.EncodingType.R16G16_UNSIGNED:t[z]|=this._encodeShort(D*(H||1),8*B);t[z]|=this._encodeShort(D*(H||1),8*B+16);break;case n.EncodingType.R8G8B8A8_SIGNED:case n.EncodingType.R8G8B8A8_UNSIGNED:t[z]|=
this._encodeByte(D*(H||1),8*B);t[z]|=this._encodeByte(D*(H||1),8*B+8);t[z]|=this._encodeByte(D*(H||1),8*B+16);t[z]|=this._encodeByte(D*(H||1),8*B+24);break;case n.EncodingType.R8G8B8A8_COLOR:t[z]=this._encodeColor(D);break;case n.EncodingType.R16G16B16A16_DASHARRAY:case n.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(z,t,D);break;default:throw Error("Unsupported encoding type");}x++}}return t}getAtributeState(d){const g=3+2*d;d=0|this._bit(g);return d|=this._bit(g+1)<<1}_buildAttributesInfo(){const d=
[],g={};var k={},p=-1;const u=this.attributesInfo();var y=this.attributes();let t=-1;for(const E of y){t++;y=this.getAtributeState(t);if(y===n.AttributeStatus.UNIFORM||y===n.AttributeStatus.UNUSED)continue;var z=u[E];const G=[];g[E]=G;z=z.type;for(let H=0;H<y;H++){const {dataType:L,bytesPerElement:M,count:r,normalized:x}=f._encodingInfo[z],v=M*r;var F=`${L}-${!0===x}`;let B=k[F],C=0;!B||4<B.count+r?(p++,B={dataIndex:p,count:0,offset:0},4!==r&&(k[F]=B),d.push({location:-1,name:"a_data_"+p,count:r,
type:L,normalized:x}),C=Math.ceil(Math.max(v/4,1))):(F=d[B.dataIndex],F.count+=r,C=Math.ceil(Math.max(F.count*M/4,1))-Math.ceil(Math.max(B.offset/4,1)));G.push({dataIndex:B.dataIndex,offset:B.offset,bufferElementsToAdd:C});B.offset+=v;B.count+=r}}for(const E of d)switch(E.type){case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:E.count=4;break;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:E.count+=E.count%2}this._buildVertexBufferLayout(d);k=0;p=this._layoutInfo.geometry;for(var D of p)this._locations.set(D.name,
k++);if(D=this._layoutInfo.opacity)for(const E of D)this._locations.set(E.name,k++);this._buildShaderInfo(d,g);this._propertyEncodingInfo=g}_buildVertexBufferLayout(d){const g={},k=this.geometryInfo();let p=k[0].stride;if(0===d.length)g.geometry=k;else{const u=[];let y=p;for(const t of d)p+=c(t.type)*t.count;for(const t of k)u.push(new e.VertexElementDescriptor(t.name,t.count,t.type,t.offset,p,t.normalized));for(const t of d)u.push(new e.VertexElementDescriptor(t.name,t.count,t.type,y,p,t.normalized)),
y+=c(t.type)*t.count;g.geometry=u}this.opacityInfo()&&(g.opacity=this.opacityInfo());this._layoutInfo=g;this._stride=p}_buildShaderInfo(d,g){let k="\n",p="\n";const u=[];for(var y of d)k+=`attribute ${this._getType(y.count)} ${y.name};\n`;var t=this.attributes();d=this.attributesInfo();y=-1;for(const D of t){y++;const {name:E,type:G,precisionFactor:H,isLayout:L}=d[D];t=H&&1!==H?` * ${1/H}`:"";const {bytesPerElement:M,count:r}=f._encodingInfo[G];var z=x=>`a_data_${x.dataIndex}${h(r,x.offset,M)}`;switch(this.getAtributeState(y)){case n.AttributeStatus.UNIFORM:t=
this._getType(r);var F=`u_${E}`;u.push({name:F,type:t,getValue:(v,B,C,J)=>{C=L?v.getLayoutValue(D,B):v.getPaintValue(D,B);if(G===n.EncodingType.R16G16B16A16_DASHARRAY){v=v.getDashKey(C,v.getLayoutValue("line-cap",B));J=J.getMosaicItemPosition(v,!1);if(null==J)return null;const {tl:K,br:O}=J;return[K[0],O[1],O[0],K[1]]}if(G===n.EncodingType.R16G16B16A16_PATTERN){J=J.getMosaicItemPosition(C,!D.includes("line-"));if(null==J)return null;const {tl:K,br:O}=J;return[K[0],O[1],O[0],K[1]]}return G===n.EncodingType.R8G8B8A8_COLOR?
(J=C[3],[J*C[0],J*C[1],J*C[2],J]):C}});k+=`uniform ${t} ${F};\n`;p+=`${t} ${E} = ${F};\n`;break;case n.AttributeStatus.DATA_DRIVEN:F=z(g[D][0]);p+=`${this._getType(r)} ${E} = ${F}${t};\n`;break;case n.AttributeStatus.INTERPOLATED_DATA_DRIVEN:F=`u_t_${E}`;u.push({name:F,type:"float",getValue:(v,B,C,J)=>(L?v.getLayoutProperty(D):v.getPaintProperty(D)).interpolator.interpolationUniformValue(C,B)});k+=`uniform float ${F};\n`;const x=z(g[D][0]);z=z(g[D][1]);p+=`${this._getType(r)} ${E} = mix(${x}${t}, ${z}${t}, ${F});\n`}}this._shaderHeader=
k;this._shaderMain=p;this._uniforms=u}_bit(d){return(this._key&1<<d)>>d}_getType(d){switch(d){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(d){const g=255*d[3];return w.i8888to32(d[0]*g,d[1]*g,d[2]*g,g)}_encodePattern(d,g,k){if(k?.rect){var p=k.rect,u=k.width;k=k.height;g[d]=this._encodeShort(p.x+2,0);g[d]|=this._encodeShort(p.y+2+k,16);g[d+1]=this._encodeShort(p.x+2+u,0);g[d+1]|=this._encodeShort(p.y+2,16)}}_encodeByte(d,
g){return(d&255)<<g}_encodeShort(d,g){return(d&65535)<<g}}f._encodingInfo={[n.EncodingType.R8_SIGNED]:{dataType:b.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[n.EncodingType.R8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[n.EncodingType.R16_SIGNED]:{dataType:b.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[n.EncodingType.R16_UNSIGNED]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[n.EncodingType.R8G8_SIGNED]:{dataType:b.DataType.BYTE,
bytesPerElement:1,count:2,normalized:!1},[n.EncodingType.R8G8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[n.EncodingType.R16G16_SIGNED]:{dataType:b.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[n.EncodingType.R16G16_UNSIGNED]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[n.EncodingType.R8G8B8A8_SIGNED]:{dataType:b.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[n.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[n.EncodingType.R8G8B8A8_COLOR]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[n.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[n.EncodingType.R16G16B16A16_PATTERN]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const c=d=>{switch(d){case b.DataType.FLOAT:case b.DataType.INT:case b.DataType.UNSIGNED_INT:return 4;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:case b.DataType.HALF_FLOAT:return 2;
case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:return 1}},h=(d,g,k)=>{g/=k;if(1===d)switch(g){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===d)switch(g){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===d)switch(g){case 0:return".xyz";case 1:return".yzw"}return""};m.VTLMaterial=f;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(m){class w{constructor(n){this._array=
[];this._stride=n}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(n,b){return 65535&n|b<<16}static i8888to32(n,b,e,f){return n&255|(b&255)<<8|(e&255)<<16|f<<24}static i8816to32(n,b,e){return n&255|(b&255)<<8|e<<16}}return w})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(m){m.EncodingType=void 0;(function(w){w[w.R8_SIGNED=0]="R8_SIGNED";w[w.R8_UNSIGNED=1]="R8_UNSIGNED";w[w.R16_SIGNED=2]="R16_SIGNED";w[w.R16_UNSIGNED=3]="R16_UNSIGNED";w[w.R8G8_SIGNED=4]="R8G8_SIGNED";w[w.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";w[w.R16G16_SIGNED=6]="R16G16_SIGNED";w[w.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";w[w.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";w[w.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";w[w.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";w[w.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
w[w.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(m.EncodingType||(m.EncodingType={}));m.AttributeStatus=void 0;(function(w){w[w.UNIFORM=0]="UNIFORM";w[w.DATA_DRIVEN=1]="DATA_DRIVEN";w[w.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";w[w.UNUSED=3]="UNUSED"})(m.AttributeStatus||(m.AttributeStatus={}));Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(m,w,n,b,e){class f extends n.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:w.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:w.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:w.EncodingType.R8_UNSIGNED,precisionFactor:32}};m.VTLCircleMaterial=f;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(m,w,n,b,e){class f extends n.VTLMaterial{constructor(h){super(h)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}
f.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO={"fill-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:w.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class c extends n.VTLMaterial{constructor(h,d){super(h);this._usefillColor=d}geometryInfo(){return c.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
c.ATTRIBUTES_FILL:c.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?c.ATTRIBUTES_INFO_FILL:c.ATTRIBUTES_INFO_OUTLINE}}c.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];c.ATTRIBUTES_FILL=["fill-color","fill-opacity"];c.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,8),new e.VertexElementDescriptor("a_offset",2,b.DataType.BYTE,4,8),new e.VertexElementDescriptor("a_xnormal",2,b.DataType.BYTE,6,8)];c.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:w.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100}};c.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100}};m.VTLFillMaterial=f;m.VTLOutlineMaterial=c;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(m,w,n,b,e){class f extends n.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_extrude_offset",
4,b.DataType.BYTE,4,16),new e.VertexElementDescriptor("a_dir_normal",4,b.DataType.BYTE,8,16),new e.VertexElementDescriptor("a_accumulatedDistance",2,b.DataType.UNSIGNED_SHORT,12,16)];f.ATTRIBUTES_INFO={"line-width":{name:"width",type:w.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:w.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:w.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:w.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:w.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};m.VTLLineMaterial=f;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(m,w,n,b,e){const f=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_vertexOffset",2,b.DataType.SHORT,4,16),new e.VertexElementDescriptor("a_texAngleRange",4,b.DataType.UNSIGNED_BYTE,8,16),new e.VertexElementDescriptor("a_levelInfo",4,b.DataType.UNSIGNED_BYTE,12,16)],c=[new e.VertexElementDescriptor("a_opacityInfo",1,b.DataType.UNSIGNED_BYTE,0,1)];
class h extends n.VTLMaterial{constructor(g){super(g)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");h.ATTRIBUTES_INFO={"icon-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:w.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:w.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class d extends n.VTLMaterial{constructor(g){super(g)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}d.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
d.ATTRIBUTES_INFO={"text-color":{name:"color",type:w.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:w.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:w.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:w.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:w.EncodingType.R8_UNSIGNED,isLayout:!0}};m.VTLIconMaterial=
h;m.VTLTextMaterial=d;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(m,w){class n{constructor(b){this._expression=b}filter(b,e){if(!this._expression)return!0;try{return this._expression.evaluate(b,e)}catch(f){return console.log(f.message),!0}}static createFilter(b){if(!b)return null;this.isLegacyFilter(b)&&(b=this.convertLegacyFilter(b));try{const e=m.createExpression(b,
null,w.booleanType);return new n(e)}catch(e){return console.log(e.message),null}}static isLegacyFilter(b){if(!Array.isArray(b)||0===b.length)return!0;switch(b[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===b.length&&"string"===typeof b[1]&&!Array.isArray(b[2]);case "in":return 3<=b.length&&"string"===typeof b[1]&&!Array.isArray(b[2]);case "!in":return!0;case "any":case "all":for(let e=1;e<b.length;e++)if(this.isLegacyFilter(b[e]))return!0;return!1;
case "none":return!0;case "has":return 2===b.length&&("$id"===b[1]||"$type"===b[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(b){if(!Array.isArray(b)||0===b.length)return!0;const e=b[0];if(1===b.length)return"any"!==e;switch(e){case "\x3d\x3d":return n.convertComparison("\x3d\x3d",b[1],b[2]);case "!\x3d":return n.negate(n.convertComparison("\x3d\x3d",b[1],b[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return n.convertComparison(e,b[1],b[2]);case "in":return n.convertIn(b[1],
b.slice(2));case "!in":return n.negate(n.convertIn(b[1],b.slice(2)));case "any":case "all":case "none":return n.convertCombining(e,b.slice(1));case "has":return n.convertHas(b[1]);case "!has":return n.negate(n.convertHas(b[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(b,e,f){switch(e){case "$type":return[b,["geometry-type"],f];case "$id":return[b,["id"],f];default:return[b,["get",e],f]}}static convertIn(b,e){switch(b){case "$type":return["in",["geometry-type"],["literal",
e]];case "$id":return["in",["id"],["literal",e]];default:return["in",["get",b],["literal",e]]}}static convertHas(b){switch(b){case "$type":return!0;case "$id":return["has-id"];default:return["has",b]}}static convertCombining(b,e){return[b].concat(e.map(this.convertLegacyFilter))}static negate(b){return["!",b]}}return n})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(m,w,n,b,e,f,c){function h(a,l,q){var A=typeof a;if("string"===A||"boolean"===A||"number"===A||null===a){if(q)switch(q.kind){case "string":"string"!==A&&(a=W.toString(a));break;case "number":"number"!==A&&(a=W.toNumber(a));break;case "color":a=W.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");A=a[0];if("string"!==typeof A)throw Error("First element of expression must be a string");const I=na[A];if(void 0===I)throw Error(`Invalid expression operator "${A}"`);
if(!I)throw Error(`Unimplemented expression operator "${A}"`);return I.parse(a,l,q)}class d{constructor(a){this._parent=a;this._vars={}}add(a,l){this._vars[a]=l}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class g{constructor(){this.type=c.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new g}evaluate(a,l){return a?.id}}class k{constructor(){this.type=c.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new k}evaluate(a,l){if(!a)return null;switch(a.type){case b.GeometryType.Point:return"Point";case b.GeometryType.LineString:return"LineString";case b.GeometryType.Polygon:return"Polygon";default:return null}}}class p{constructor(){this.type=c.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new p}evaluate(a,l){return a?.values}}class u{constructor(){this.type=c.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new u}evaluate(a,l){return l}}class y{constructor(a,l,q){this._lhs=a;this._rhs=l;this._compare=q;this.type=c.booleanType}static parse(a,l,q){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new y(h(a[1],l),h(a[2],l),q)}evaluate(a,l){return this._compare(this._lhs.evaluate(a,l),this._rhs.evaluate(a,l))}}class t extends y{static parse(a,l){return y.parse(a,l,(q,A)=>q===A)}}class z extends y{static parse(a,
l){return y.parse(a,l,(q,A)=>q!==A)}}class F extends y{static parse(a,l){return y.parse(a,l,(q,A)=>q<A)}}class D extends y{static parse(a,l){return y.parse(a,l,(q,A)=>q<=A)}}class E extends y{static parse(a,l){return y.parse(a,l,(q,A)=>q>A)}}class G extends y{static parse(a,l){return y.parse(a,l,(q,A)=>q>=A)}}class H{constructor(a){this._arg=a;this.type=c.booleanType}static parse(a,l){if(2!==a.length)throw Error('"!" expects 1 argument');return new H(h(a[1],l))}evaluate(a,l){return!this._arg.evaluate(a,
l)}}class L{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,l){const q=[];for(let A=1;A<a.length;A++)q.push(h(a[A],l));return new L(q)}evaluate(a,l){for(const q of this._args)if(!q.evaluate(a,l))return!1;return!0}}class M{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,l){const q=[];for(let A=1;A<a.length;A++)q.push(h(a[A],l));return new M(q)}evaluate(a,l){for(const q of this._args)if(q.evaluate(a,l))return!0;return!1}}class r{constructor(a){this._args=a;this.type=
c.booleanType}static parse(a,l){const q=[];for(let A=1;A<a.length;A++)q.push(h(a[A],l));return new r(q)}evaluate(a,l){for(const q of this._args)if(q.evaluate(a,l))return!1;return!0}}class x{constructor(a,l,q){this.type=a;this._args=l;this._fallback=q}static parse(a,l,q){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let A;const I=[];for(let N=1;N<a.length-1;N+=2){const Q=h(a[N],l),P=h(a[N+1],l,q);A||(A=P.type);
I.push({condition:Q,output:P})}a=h(a[a.length-1],l,q);A||(A=a.type);return new x(A,I,a)}evaluate(a,l){for(const q of this._args)if(q.condition.evaluate(a,l))return q.output.evaluate(a,l);return this._fallback.evaluate(a,l)}}class v{constructor(a,l){this.type=a;this._args=l}static parse(a,l){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let q;const A=[];for(let I=1;I<a.length;I++){const N=h(a[I],l);q||(q=N.type);A.push(N)}return new v(q,A)}evaluate(a,l){for(const q of this._args){const A=
q.evaluate(a,l);if(null!==A)return A}return null}}class B{constructor(a,l,q,A,I){this.type=a;this._input=l;this._labels=q;this._outputs=A;this._fallback=I}static parse(a,l){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let q;const A=h(a[1],l),I=[],N={};let Q;for(let X=2;X<a.length-1;X+=2){var P=a[X];Array.isArray(P)||(P=[P]);for(const ca of P){P=typeof ca;if("string"!==P&&"number"!==P)throw Error('"match" requires string or number literal as labels');
if(!Q)Q=P;else if(P!==Q)throw Error('"match" requires labels to have the same type');N[ca]=I.length}P=h(a[X+1],l);q||(q=P.type);I.push(P)}return new B(q,A,N,I,h(a[a.length-1],l))}evaluate(a,l){const q=this._input.evaluate(a,l);return(this._outputs[this._labels[q]]||this._fallback).evaluate(a,l)}}class C{constructor(a,l,q,A,I){this._operator=a;this.type=l;this.interpolation=q;this.input=A;this._stops=I}static parse(a,l,q){const A=a[0];if(5>a.length)throw Error(`"${A}" expects at least 4 arguments`);
const I=a[1];if(!Array.isArray(I)||0===I.length)throw Error(`"${I}" is not a valid interpolation`);switch(I[0]){case "linear":if(1!==I.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==I.length||"number"!==typeof I[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==I.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var N=1;5>N;N++){var Q=
I[N];if("number"!==typeof Q||0>Q||1<Q)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${I[0]}"`);}if(1!==a.length%2)throw Error(`"${A}" expects an even number of arguments`);N=h(a[2],l,c.numberType);let P;"interpolate-hcl"===A||"interpolate-lab"===A?P=c.colorType:q&&"value"!==q.kind&&(P=q);q=[];for(Q=3;Q<a.length;Q+=2){const X=a[Q];if("number"!==typeof X)throw Error(`"${A}" requires stop inputs as literal numbers`);
if(q.length&&q[q.length-1][0]>=X)throw Error(`"${A}" requires strictly ascending stop inputs`);const ca=h(a[Q+1],l,P);P||(P=ca.type);q.push([X,ca])}if(P&&P!==c.colorType&&P!==c.numberType&&("array"!==P.kind||P.itemType!==c.numberType))throw Error(`"${A}" cannot interpolate type ${c.typeToString(P)}`);return new C(A,P,I,N,q)}evaluate(a,l){var q=this._stops;if(1===q.length)return q[0][1].evaluate(a,l);var A=this.input.evaluate(a,l);if(A<=q[0][0])return q[0][1].evaluate(a,l);if(A>=q[q.length-1][0])return q[q.length-
1][1].evaluate(a,l);let I=0;for(;++I<q.length&&!(A<q[I][0]););const N=C.interpolationRatio(this.interpolation,A,q[I-1][0],q[I][0]);A=q[I-1][1].evaluate(a,l);const Q=q[I][1].evaluate(a,l);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(A)&&Array.isArray(Q))return A.map((P,X)=>f.interpolate(P,Q[X],N));if("color"===this.type.kind&&A instanceof w&&Q instanceof w)return A=new w(A),a=new w(Q),new w([f.interpolate(A.r,a.r,N),f.interpolate(A.g,a.g,N),f.interpolate(A.b,a.b,N),
f.interpolate(A.a,a.a,N)]);if("number"===this.type.kind&&"number"===typeof A&&"number"===typeof Q)return f.interpolate(A,Q,N);throw Error(`"${this._operator}" cannot interpolate type ${c.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=n.toLCH(A),l=n.toLCH(Q),q=l.h-a.h,a=n.toRGB({h:a.h+N*(180<q||-180>q?q-360*Math.round(q/360):q),c:f.interpolate(a.c,l.c,N),l:f.interpolate(a.l,l.l,N)}),new w({a:f.interpolate(A.a,Q.a,N),...a});if("interpolate-lab"===this._operator)return a=
n.toLAB(A),l=n.toLAB(Q),a=n.toRGB({l:f.interpolate(a.l,l.l,N),a:f.interpolate(a.a,l.a,N),b:f.interpolate(a.b,l.b,N)}),new w({a:f.interpolate(A.a,Q.a,N),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,l){const q=this._stops;if(1===q.length||a>=q[q.length-1][0])return 0;let A=0;for(;++A<q.length&&!(a<q[A][0]););return C.interpolationRatio(this.interpolation,l,q[A-1][0],q[A][0])}getInterpolationRange(a){const l=this._stops;if(1===l.length)return a=l[0][0],[a,
a];var q=l[l.length-1][0];if(a>=q)return[q,q];for(q=0;++q<l.length&&!(a<l[q][0]););return[l[q-1][0],l[q][0]]}static interpolationRatio(a,l,q,A){let I=0;"linear"===a[0]?I=C._exponentialInterpolationRatio(l,1,q,A):"exponential"===a[0]?I=C._exponentialInterpolationRatio(l,a[1],q,A):"cubic-bezier"===a[0]&&(I=e.unitBezier(a[1],a[2],a[3],a[4])(C._exponentialInterpolationRatio(l,1,q,A),1E-5));0>I?I=0:1<I&&(I=1);return I}static _exponentialInterpolationRatio(a,l,q,A){A-=q;if(0===A)return 0;a-=q;return 1===
l?a/A:(l**a-1)/(l**A-1)}}class J{constructor(a,l,q){this.type=a;this._input=l;this._stops=q}static parse(a,l){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const q=h(a[1],l,c.numberType);let A;const I=[];I.push([-Infinity,h(a[2],l)]);for(let N=3;N<a.length;N+=2){const Q=a[N];if("number"!==typeof Q)throw Error('"step" requires stop inputs as literal numbers');if(I.length&&I[I.length-1][0]>=Q)throw Error('"step" requires strictly ascending stop inputs');
const P=h(a[N+1],l);A||(A=P.type);I.push([Q,P])}return new J(A,q,I)}evaluate(a,l){const q=this._stops;if(1===q.length)return q[0][1].evaluate(a,l);const A=this._input.evaluate(a,l);let I=0;for(;++I<q.length&&!(A<q[I][0]););return this._stops[I-1][1].evaluate(a,l)}}class K{constructor(a,l){this.type=a;this._output=l}static parse(a,l,q){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const A=new d(l);for(let I=
1;I<a.length-1;I+=2){const N=a[I];if("string"!==typeof N)throw Error(`"let" requires a string to define variable names - found ${N}`);A.add(N,h(a[I+1],l))}a=h(a[a.length-1],A,q);return new K(a.type,a)}evaluate(a,l){return this._output.evaluate(a,l)}}class O{constructor(a,l){this.type=a;this.output=l}static parse(a,l,q){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');l=l.get(a[1]);if(!l)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new O(q||c.valueType,l)}evaluate(a,l){return this.output.evaluate(a,l)}}class R{constructor(a,l,q){this.type=a;this._index=l;this._array=q}static parse(a,l){if(3!==a.length)throw Error('"at" expects 2 arguments');const q=h(a[1],l,c.numberType);a=h(a[2],l);return new R(a.type.itemType,q,a)}evaluate(a,l){const q=this._index.evaluate(a,l);a=this._array.evaluate(a,l);if(0>q||q>=a.length)throw Error('"at" index out of bounds');if(q!==Math.floor(q))throw Error('"at" index must be an integer');return a[q]}}
class S{constructor(a,l){this._key=a;this._obj=l;this.type=c.valueType}static parse(a,l){let q;switch(a.length){case 2:return q=h(a[1],l),new S(q);case 3:return q=h(a[1],l),a=h(a[2],l),new S(q,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,l){const q=this._key.evaluate(a,l);return this._obj?this._obj.evaluate(a,l)[q]:a?.values[q]}}class U{constructor(a,l){this._key=a;this._obj=l;this.type=c.booleanType}static parse(a,l){let q;switch(a.length){case 2:return q=h(a[1],l),new U(q);
case 3:return q=h(a[1],l),a=h(a[2],l),new U(q,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,l){const q=this._key.evaluate(a,l);return this._obj?(a=this._obj.evaluate(a,l),q in a):!!a?.values[q]}}class Y{constructor(a,l){this._key=a;this._vals=l;this.type=c.booleanType}static parse(a,l){if(3!==a.length)throw Error('"in" expects 2 arguments');return new Y(h(a[1],l),h(a[2],l))}evaluate(a,l){const q=this._key.evaluate(a,l);return this._vals.evaluate(a,l).includes(q)}}class aa{constructor(a,
l,q){this._item=a;this._array=l;this._from=q;this.type=c.numberType}static parse(a,l){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const q=h(a[1],l),A=h(a[2],l);return 4===a.length?(a=h(a[3],l,c.numberType),new aa(q,A,a)):new aa(q,A)}evaluate(a,l){const q=this._item.evaluate(a,l),A=this._array.evaluate(a,l);if(this._from){a=this._from.evaluate(a,l);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return A.indexOf(q,a)}return A.indexOf(q)}}class ea{constructor(a){this._arg=
a;this.type=c.numberType}static parse(a,l){if(2!==a.length)throw Error('"length" expects 2 arguments');a=h(a[1],l);return new ea(a)}evaluate(a,l){a=this._arg.evaluate(a,l);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class da{constructor(a,l,q,A){this.type=a;this._array=l;this._from=q;this._to=A}static parse(a,l){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const q=h(a[1],l),A=h(a[2],l,c.numberType);if(A.type!==
c.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=h(a[3],l,c.numberType);if(a.type!==c.numberType)throw Error('"slice" index must return a number');return new da(q.type,q,A,a)}return new da(q.type,q,A)}evaluate(a,l){const q=this._array.evaluate(a,l);if(!Array.isArray(q)&&"string"!==typeof q)throw Error('"slice" input must be an array or a string');const A=this._from.evaluate(a,l);if(0>A||A>=q.length)throw Error('"slice" index out of bounds');if(A!==Math.floor(A))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,l);if(0>a||a>=q.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return q.slice(A,a)}return q.slice(A)}}class fa{constructor(){this.type=c.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new fa}evaluate(a,l){return void 0!==a?.id}}class V{constructor(a,l){this._args=a;this._calculate=l;this.type=c.numberType}static parse(a,l,q){a=a.slice(1).map(A=>
h(A,l));return new V(a,q)}evaluate(a,l){let q;this._args&&(q=this._args.map(A=>A.evaluate(a,l)));return this._calculate(q)}}class oa extends V{static parse(a,l){switch(a.length){case 2:return V.parse(a,l,q=>-q[0]);case 3:return V.parse(a,l,q=>q[0]-q[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends V{static parse(a,l){return V.parse(a,l,q=>{let A=1;for(const I of q)A*=I;return A})}}class qa extends V{static parse(a,l){if(3===a.length)return V.parse(a,l,q=>q[0]/q[1]);throw Error('"/" expects 2 arguments');
}}class ra extends V{static parse(a,l){if(3===a.length)return V.parse(a,l,q=>q[0]%q[1]);throw Error('"%" expects 2 arguments');}}class sa extends V{static parse(a,l){if(3===a.length)return V.parse(a,l,q=>q[0]**q[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends V{static parse(a,l){return V.parse(a,l,q=>{let A=0;for(const I of q)A+=I;return A})}}class T{constructor(a,l){this._args=a;this._calculate=l;this.type=c.numberType}static parse(a,l){const q=a.slice(1).map(A=>h(A,l));return new T(q,
T.ops[a[0]])}evaluate(a,l){let q;this._args&&(q=this._args.map(A=>A.evaluate(a,l)));return this._calculate(q)}}T.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=c.stringType}static parse(a,l){return new ha(a.slice(1).map(q=>h(q,l)))}evaluate(a,l){return this._args.map(q=>q.evaluate(a,l)).join("")}}class ba{constructor(a,l){this._arg=a;this._calculate=l;this.type=c.stringType}static parse(a,l){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);l=h(a[1],l);return new ba(l,ba.ops[a[0]])}evaluate(a,l){return this._calculate(this._arg.evaluate(a,l))}}ba.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=c.colorType}static parse(a,l){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(q=>h(q,l));return new ia(a)}evaluate(a,l){const q=this._validate(this._args[0].evaluate(a,l)),A=this._validate(this._args[1].evaluate(a,l));a=this._validate(this._args[2].evaluate(a,l));return new w({r:q,g:A,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=c.colorType}static parse(a,l){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(q=>h(q,l));return new ja(a)}evaluate(a,l){const q=this._validate(this._args[0].evaluate(a,l)),A=this._validate(this._args[1].evaluate(a,l)),I=this._validate(this._args[2].evaluate(a,l));a=this._validateAlpha(this._args[3].evaluate(a,l));return new w({r:q,g:A,b:I,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=c.arrayType(c.numberType,4)}static parse(a,l){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=h(a[1],l);return new ka(a)}evaluate(a,l){return(new w(this._color.evaluate(a,l))).toRgba()}}class Z{constructor(a,l){this.type=a;this._args=l}static parse(a,l){var q=a[0];if(2>a.length)throw Error(`${q} expects at least one argument`);
let A=1,I;if("array"===q){if(2<a.length){switch(a[1]){case "string":I=c.stringType;break;case "number":I=c.numberType;break;case "boolean":I=c.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}A++}else I=c.valueType;if(3<a.length){var N=a[2];if(null!==N&&("number"!==typeof N||0>N||N!==Math.floor(N)))throw Error('"array" length argument must be a positive integer literal');A++}I=c.arrayType(I,N)}else switch(q){case "string":I=c.stringType;break;case "number":I=
c.numberType;break;case "boolean":I=c.booleanType;break;case "object":I=c.objectType}for(q=[];A<a.length;A++)N=h(a[A],l),q.push(N);return new Z(I,q)}evaluate(a,l){let q;for(const A of this._args){const I=A.evaluate(a,l);q=c.getType(I);if(c.matchType(q,this.type))return I}throw Error(`Expected ${c.typeToString(this.type)} but got ${c.typeToString(q)}`);}}class W{constructor(a,l){this.type=a;this._args=l}static parse(a,l){var q=a[0];const A=W.types[q];if(A===c.booleanType||A===c.stringType){if(2!==
a.length)throw Error(`${q} expects one argument`);}else if(2>a.length)throw Error(`${q} expects at least one argument`);q=[];for(let I=1;I<a.length;I++){const N=h(a[I],l);q.push(N)}return new W(A,q)}evaluate(a,l){if(this.type===c.booleanType)return!!this._args[0].evaluate(a,l);if(this.type===c.stringType)return c.valueToString(this._args[0].evaluate(a,l));if(this.type===c.numberType){for(const A of this._args){var q=Number(A.evaluate(a,l));if(!isNaN(q))return q}return null}if(this.type===c.colorType){for(q of this._args)try{const A=
W.toColor(q.evaluate(a,l));if(A instanceof w)return A}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return c.valueToString(a)}static toNumber(a){const l=Number(a);if(isNaN(l))throw Error(`"${a}" is not a number`);return l}static toColor(a){if(a instanceof w)return a;if("string"===typeof a){const l=w.fromString(a);if(l)return l;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return w.fromArray(a);throw Error(`"${a}" is not a color`);}}W.types={"to-boolean":c.booleanType,
"to-color":c.colorType,"to-number":c.numberType,"to-string":c.stringType};class la{constructor(a){this._val=a;this.type=c.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,l){return this._val}}class ma{constructor(a){this._arg=a;this.type=c.stringType}static parse(a,l){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(h(a[1],l))}evaluate(a,l){return c.typeToString(c.getType(this._arg.evaluate(a,l)))}}const na=
{array:Z,boolean:Z,collator:null,format:null,image:null,literal:la,number:Z,"number-format":null,object:Z,string:Z,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":k,id:g,"line-progress":null,properties:p,at:R,get:S,has:U,in:Y,"index-of":aa,length:ea,slice:da,"!":H,"!\x3d":z,"\x3c":F,"\x3c\x3d":D,"\x3d\x3d":t,"\x3e":E,"\x3e\x3d":G,all:L,any:M,case:x,coalesce:v,match:B,within:null,interpolate:C,"interpolate-hcl":C,"interpolate-lab":C,
step:J,let:K,var:O,concat:ha,downcase:ba,"is-supported-script":null,"resolved-locale":null,upcase:ba,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:T,acos:T,asin:T,atan:T,ceil:T,cos:T,e:T,floor:T,ln:T,ln2:T,log10:T,log2:T,max:T,min:T,pi:T,round:T,sin:T,sqrt:T,tan:T,zoom:u,"heatmap-density":null,"has-id":fa,none:r};m.ALL=L;m.ANY=M;m.Add=ta;m.Assert=Z;m.At=R;m.Calculate=T;m.Case=x;m.Coalesce=v;m.Coerce=W;m.Concat=ha;m.Div=qa;m.EQ=t;m.GE=G;m.GT=E;m.GeomType=k;m.Get=S;m.Has=
U;m.HasID=fa;m.ID=g;m.In=Y;m.IndexOf=aa;m.Interpolate=C;m.LE=D;m.LT=F;m.Length=ea;m.Let=K;m.Literal=la;m.Match=B;m.Mod=ra;m.Mul=pa;m.NE=z;m.NONE=r;m.NOT=H;m.Pow=sa;m.Properties=p;m.Rgb=ia;m.Rgba=ja;m.Slice=da;m.Step=J;m.String=ba;m.Sub=oa;m.ToRgba=ka;m.TypeOf=ma;m.Var=O;m.Zoom=u;m.createExpression=h;m.ops=na;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(m){function w(e,f,c,h){function d(z,F){var D;let E,G;E=z;for(D=
0;8>D;D++){G=((p*E+k)*E+g)*E-z;if(Math.abs(G)<F)return E;var H=(3*p*E+2*k)*E+g;if(1E-6>Math.abs(H))break;E-=G/H}H=0;D=1;E=z;if(E<H)return H;if(E>D)return D;for(;H<D;){G=((p*E+k)*E+g)*E;if(Math.abs(G-z)<F)break;z>G?H=E:D=E;E=.5*(D-H)+H}return E}const g=3*e,k=3*(c-e)-g,p=1-g-k,u=3*f,y=3*(h-f)-u,t=1-u-y;return function(z,F=1E-6){z=d(z,F);return((t*z+y)*z+u)*z}}const n=/^cubic-bezier\((.*)\)/,b={};b.ease=w(.25,.1,.25,1);b.linear=w(0,0,1,1);b.easeIn=b["ease-in"]=w(.42,0,1,1);b.easeOut=b["ease-out"]=w(0,
0,.58,1);b.easeInOut=b["ease-in-out"]=w(.42,0,.58,1);m.easingFunctions=b;m.parse=function(e){let f=b[e]||null;!f&&(e=n.exec(e))&&(e=e[1].split(",").map(c=>parseFloat(c.trim())),4!==e.length||e.some(c=>isNaN(c))||(f=w.apply(w,e)));return f};m.unitBezier=w;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(m,w){function n(t,z){return{kind:"array",itemType:t,n:z}}function b(t){if("array"===
t.kind){const z=b(t.itemType);return"number"===typeof t.n?`array<${z}, ${t.n}>`:"value"===t.itemType.kind?"array":`array<${z}>`}return t.kind}function e(t){if(null===t)return c;if("string"===typeof t)return d;if("boolean"===typeof t)return g;if("number"===typeof t)return h;if(t instanceof w)return k;if(Array.isArray(t)){let z;for(const F of t){const D=e(F);if(!z)z=D;else if(z!==D){z=u;break}}return n(z||u,t.length)}return"object"===typeof t?p:u}function f(t,z){if("array"===z.kind)return"array"===
t.kind&&(0===t.n&&"value"===t.itemType.kind||f(t.itemType,z.itemType))&&("number"!==typeof z.n||z.n===t.n);if("value"===z.kind)for(const F of y)if(f(t,F))return!0;return z.kind===t.kind}const c={kind:"null"},h={kind:"number"},d={kind:"string"},g={kind:"boolean"},k={kind:"color"},p={kind:"object"},u={kind:"value"},y=[c,h,d,g,k,p,n(u)];m.arrayType=n;m.booleanType=g;m.colorType=k;m.getType=e;m.matchType=f;m.nullType=c;m.numberType=h;m.objectType=p;m.stringType=d;m.typeToString=b;m.valueToString=function(t){if(null===
t)return"";const z=typeof t;return"string"===z?t:"number"===z||"boolean"===z?String(t):t instanceof w?t.toString():JSON.stringify(t)};m.valueType=u;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(m,w,n,b){class e{constructor(f,c){this.isDataDriven=!1;this.interpolator=null;switch(f.type){case "number":var h=!0;
break;case "color":h=!0;break;case "array":h="number"===f.value;break;default:h=!1}null==c&&(c=f.default);if(Array.isArray(c)&&0<c.length&&n.ops[c[0]]){h={number:b.numberType,color:b.colorType,string:b.stringType,boolean:b.booleanType,enum:b.stringType};try{var d="array"===f.type?b.arrayType(h[f.value]||b.valueType,f.length):h[f.type];const g=n.createExpression(c,null,d);this.getValue=this._buildExpression(g,f);this.isDataDriven=!0;g instanceof n.Interpolate&&g.input instanceof n.Zoom&&(this.interpolator=
g)}catch(g){console.log(g.message),this.getValue=this._buildSimple(f.default)}}else{h&&"interval"===c.type&&(h=!1);if(d=c?.stops&&0<c.stops.length)for(const g of c.stops)g[1]=this._validate(g[1],f);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,f)),d)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,f);break;case "categorical":this.getValue=this._buildCategorical(c,f);break;default:this.getValue=h?this._buildInterpolate(c,f):this._buildInterval(c,
f)}else this.getValue=this._buildIdentity(c,f);else d?this.getValue=h?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,f),this.getValue=this._buildSimple(c))}}_validate(f,c){if("number"===c.type){if(null!=c.minimum&&f<c.minimum)return c.minimum;if(null!=c.maximum&&f>c.maximum)return c.maximum}else"color"===c.type?f=e._parseColor(f):"enum"===c.type?"string"===typeof f&&(f=c.values.indexOf(f)):"array"===c.type&&"enum"===c.value?f=f.map(h=>"string"===typeof h?c.values.indexOf(h):
h):"string"===c.type&&(f=b.valueToString(f));return f}_buildSimple(f){return()=>f}_buildExpression(f,c){return(h,d)=>{try{const g=f.evaluate(d,h);return void 0===g?c.default:this._validate(g,c)}catch(g){return console.log(g.message),c.default}}}_buildIdentity(f,c){return(h,d)=>{let g;d&&(g=d.values[f.property]);void 0!==g&&(g=this._validate(g,c));return null!=g?g:void 0!==f.default?f.default:c.default}}_buildCategorical(f,c){return(h,d)=>{let g;d&&(g=d.values[f.property]);g=this._categorical(g,f.stops);
return void 0!==g?g:void 0!==f.default?f.default:c.default}}_buildInterval(f,c){return(h,d)=>{let g;d&&(g=d.values[f.property]);return"number"===typeof g?this._interval(g,f.stops):void 0!==f.default?f.default:c.default}}_buildInterpolate(f,c){return(h,d)=>{let g;d&&(g=d.values[f.property]);return"number"===typeof g?this._interpolate(g,f.stops,f.base||1):void 0!==f.default?f.default:c.default}}_buildZoomInterpolate(f){return c=>this._interpolate(c,f.stops,f.base||1)}_buildZoomInterval(f){return c=>
this._interval(c,f.stops)}_categorical(f,c){const h=c.length;for(let d=0;d<h;d++)if(c[d][0]===f)return c[d][1]}_interval(f,c){const h=c.length;let d=0;for(let g=0;g<h;g++)if(c[g][0]<=f)d=g;else break;return c[d][1]}_interpolate(f,c,h){const d=c.length;for(let p=0;p<d;p++){const u=c[p];if(u[0]<=f)var g=u;else{var k=u;break}}if(g&&k){c=k[0]-g[0];f-=g[0];h=1===h?f/c:(h**f-1)/(h**c-1);if(Array.isArray(g[1])){g=g[1];k=k[1];f=[];for(c=0;c<g.length;c++)f.push(w.interpolate(g[c],k[c],h));return f}return w.interpolate(g[1],
k[1],h)}if(g)return g[1];if(k)return k[1]}static _isEmpty(f){for(const c in f)if(f.hasOwnProperty(c))return!1;return!0}static _parseColor(f){if(Array.isArray(f))return f;"string"===typeof f&&(f=new m(f));if(f instanceof m&&!this._isEmpty(f))return m.toUnitRGBA(f)}}return e})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../2d/engine/vectorTiles/SchemaHelper ../../2d/engine/vectorTiles/TileHandler3D ../../2d/engine/vectorTiles/VTLPainter3D ../../2d/engine/vectorTiles/style/StyleRepository ./LayerView3D ./TiledLayerView3D ../terrain/terrainUtils ../../layers/LayerView".split(" "),function(m,
w,n,b,e,f,c,h,d,g,k,p,u,y,t,z,F,D){function E(G){return H=>G.immediate.schedule(H)}h=class extends z.TiledLayerView3D(t.LayerView3D(D)){constructor(){super(...arguments);this._tileHandlerController=null;this.type="vector-tile-3d";this.levelShift=n("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)this.addResolvingPromise(Promise.reject(new w("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));else{var {basemapTerrain:G,
spatialReference:H,state:L,viewingMode:M}=this.view,r="local"===M&&!F.vtlAssumes256PixelSizeAsDefault(H)||F.test.force512VTL?this.layer.tileInfo:this.layer.tileInfo.getCompatibleForVTL(256);r=this._getTileInfoSupportError(r,this.layer.fullExtent);if(null!=r)return this.addResolvingPromise(Promise.reject(r));r=f.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{var K=G.tilingScheme,O=K.pixelSize;this.schemaHelper=new k.SchemaHelper(256===O?1:2,G.spatialReference?.isGeographic&&
256===O?1:0,this.levelShift+(G.spatialReference?.isGeographic||256!==O?0:1));O=256===O||512===O?this.layer.tileInfo.getCompatibleForVTL(O):this.layer.tileInfo;if(K=this._getTileInfoCompatibilityError(O,K))throw K;this.tileInfo=O});this._tileHandlerController=new AbortController;var x=this.view.resourceController;this._memCache=x.memoryController.newCache(`vtl-${this.layer.uid}`,K=>{K.release()});this.addHandles(f.watch(()=>this.view.qualitySettings.memoryLimit,K=>this._memCache.maxSize=Math.ceil(K/
10*1048576),f.syncAndInitial));var v=new y(this.layer.currentStyleInfo.style);this._tileHandler=new p(this.layer,v,L.contentPixelRatio,this._memCache);var B=this._tileHandlerController.signal,C=E(x);x=this._tileHandler.start({signal:B,schedule:C});v=this._tileHandler.spriteMosaic;v.then(K=>{!e.isAborted(B)&&this._tileHandler&&(this.painter=new u(K,this._tileHandler.glyphMosaic))});x.then(()=>this._tileHandlerController=null);var J=()=>{this._tileHandlerController&&this._tileHandlerController.abort();
this._tileHandlerController=new AbortController;this._memCache.clear();var K=this.view.state?.contentPixelRatio??1,O=new y(this.layer.currentStyleInfo.style);const R=new p(this.layer,O,K,this._memCache);K=R.start({signal:this._tileHandlerController.signal,schedule:C});O=R.spriteMosaic;K.then(()=>this._tileHandlerController=null);this._updatingHandles.addPromise(Promise.all([K,O]).then(([,S])=>{const U=this._tileHandler,Y=this.painter;this.painter=new u(S,R.glyphMosaic);this._tileHandler=R;this.emit("data-changed");
U.destroy();Y&&Y.dispose()}))};this._updatingHandles.add(()=>({style:this.layer.currentStyleInfo.style,pixelRatio:this.view.state?.contentPixelRatio}),J);this.addHandles([this.layer.on("paint-change",()=>this.emit("data-changed")),this.layer.on("style-layer-change",J),this.layer.on("delete-style-layer",J),this.layer.on("spriteSource-change",()=>this.emit("data-changed")),this.layer.on("layout-change",()=>this.emit("data-changed")),this.layer.on("style-layer-visibility-change",()=>this.emit("data-changed"))]);
r=Promise.all([r,x,v]);this.addResolvingPromise(r)}}destroy(){this.painter=b.disposeMaybe(this.painter);this._tileHandlerController=b.abortMaybe(this._tileHandlerController);this._tileHandler=b.destroyMaybe(this._tileHandler);this._memCache=b.destroyMaybe(this._memCache)}get contentZoom(){return n("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){var G=this.tileInfo.lods;G=this.levelRangeFromScaleRange(this.layer.minScale||G[0].scale,
this.layer.maxScale||G[G.length-1].scale);this.layer.maxScale?G.maxLevel++:G.maxLevel+=this.levelShift;return G}get dataScaleRange(){const G=this.tileInfo.lods;return{minScale:G[0].scale,maxScale:G[G.length-1].scale}}get dataLevelRange(){const {minScale:G,maxScale:H}=this.dataScaleRange,L=this.levelRangeFromScaleRange(G,H);1===L.minLevel&&256===this.tileInfo.size[0]&&(L.minLevel=0);L.maxLevel+=this.levelShift;return L}async fetchTile(G,H){G=this.schemaHelper.getLevelRowColumn(G);return this._tileHandler.getVectorTile(G,
H)}};m.__decorate([c.property()],h.prototype,"layer",void 0);m.__decorate([c.property()],h.prototype,"levelShift",void 0);m.__decorate([c.property()],h.prototype,"contentZoom",null);m.__decorate([c.property()],h.prototype,"displayLevelRange",null);m.__decorate([c.property()],h.prototype,"tileInfo",void 0);m.__decorate([c.property()],h.prototype,"dataScaleRange",null);m.__decorate([c.property()],h.prototype,"dataLevelRange",null);m.__decorate([c.property()],h.prototype,"updatingProgressValue",void 0);
return h=m.__decorate([g.subclass("esri.views.3d.layers.VectorTileLayerView3D")],h)});