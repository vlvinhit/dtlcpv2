// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/dehydratedFeatures ./FeatureLikeLayerView3D ./LayerView3D ./graphics/FeatureGraphics3DGraphicsPipeline ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(d,m,c,n,k,e,A,B,p,q,r,t,u,v,w,x,y,z){c=class extends z(r.FeatureLikeLayerView3D(x(t.LayerView3D(y)))){constructor(a){super(a)}initialize(){this.addHandles(k.watch(()=>this._updatingRequiredFieldsPromise,a=>this._updatingHandles.addPromise(a),k.syncAndInitial))}destroy(){this._updatingHandles.removeAll();this._fetcherContext=n.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(a){this.graphicsPipeline.maximumNumberOfFeatures=
a}get maximumNumberOfFeaturesExceeded(){return null!=this.graphicsPipeline&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){return this.graphicsPipeline?.updatingProgressValue??0}get updatePolicy(){return this.graphicsPipeline?.updatePolicy??w.UpdatePolicy.ASYNC}get hasZ(){const a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsZ?"returnZ"in a&&null!=a.returnZ?a.returnZ:b.supportsZ:!1}get hasM(){const a=this.layer,b=a.capabilities&&
a.capabilities.data;return b&&b.supportsM?"returnM"in a&&null!=a.returnM?a.returnM:!1:!1}setVisibility(a,b){this.graphicsPipeline?.setVisibility(a,b)}createQuery(){return super.createQuery()}queryFeatures(a,b){const f=()=>super.queryFeatures(a,b);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(a),f):f()}createGraphicsPipeline(){return new u.FeatureGraphics3DGraphicsPipeline({layerView:this})}async doRefresh(a){return await this.graphicsPipeline.doRefresh(a)}_popupFeatureHasRequiredFields(a,
b){if(!super._popupFeatureHasRequiredFields(a,b))return!1;a=q.getObjectId(a,this.layer.objectIdField);if(null==a)return!0;a=this.graphicsPipeline.getMissingAttributesForFeature(a);if(null==a)return!0;for(const f of b)if(a.has(f))return!1;return!0}get usedMemory(){return this.graphicsPipeline?.usedMemory??0}get unloadedMemory(){return this.graphicsPipeline?.unloadedMemory??0}get ignoresMemoryFactor(){return this.graphicsPipeline?.ignoresMemoryFactor??!1}async _queryFeaturesMesh(a,b){await this._validateQueryFeaturesMesh(a);
b=await b();const f=this.graphicsPipeline;if(a?.outStatistics||null==f)return b;a=this.layer.objectIdField;const g=[];for(const h of b.features)if(h.geometry){const l=f.getHydratedGeometry(h.attributes[a]);l&&(h.geometry=l,g.push(h))}else g.push(h);b.features=g;return b}async _validateQueryFeaturesMesh(a){if(a){var b=g=>{throw new m("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${g}'`);},f=["quantizationParameters","geometryPrecision","maxAllowableOffset"];
for(const g of f)null!=a[g]&&b(g);"returnM"in a&&a.returnM&&b("returnM");"returnCentroid"in a&&a.returnCentroid&&b("returnCentroid");null==a.outSpatialReference||a.outSpatialReference.equals(this.view.spatialReference)||b("outSpatialReference")}}get test(){}};d.__decorate([e.property()],c.prototype,"layer",void 0);d.__decorate([e.property()],c.prototype,"graphicsPipeline",void 0);d.__decorate([e.property()],c.prototype,"maximumNumberOfFeatures",null);d.__decorate([e.property()],c.prototype,"maximumNumberOfFeaturesExceeded",
null);d.__decorate([e.property(v.updatingProgress)],c.prototype,"updatingProgress",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"updatingProgressValue",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"updatePolicy",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"hasZ",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"hasM",null);return c=d.__decorate([p.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],c)});