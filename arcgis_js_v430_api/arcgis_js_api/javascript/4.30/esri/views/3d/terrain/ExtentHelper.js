// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),function(c,d,z,k,B,C,D,n,A,e,t,u,v,w){function x(a,b){return null==a||a.spatialReference.equals(b)?a:A.projectWithoutEngine(a,
a.spatialReference,b)}c.ExtentHelper=class extends z{constructor(a){super(a)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const a=[];this.layerViews.forEach(b=>{b=b.layer;"operationalLayerType"in b&&
t.isIntegratedMeshOperationalLayer(b.operationalLayerType)&&null!=this.viewSpatialReference&&(b=x(b.fullExtent,this.viewSpatialReference),null!=b&&a.push(e.fromExtent(b)))});return a}};d.__decorate([k.property({readOnly:!0})],c.ExtentHelper.prototype,"layerViewsExtent",null);d.__decorate([k.property({readOnly:!0})],c.ExtentHelper.prototype,"tiledLayersExtent",null);d.__decorate([k.property({readOnly:!0})],c.ExtentHelper.prototype,"stencilEnabledExtents",null);d.__decorate([k.property()],c.ExtentHelper.prototype,
"viewSpatialReference",void 0);d.__decorate([k.property()],c.ExtentHelper.prototype,"tilingScheme",void 0);d.__decorate([k.property()],c.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);d.__decorate([k.property({constructOnly:!0})],c.ExtentHelper.prototype,"layers",void 0);d.__decorate([k.property({constructOnly:!0})],c.ExtentHelper.prototype,"layerViews",void 0);c.ExtentHelper=d.__decorate([n.subclass("esri.views.3d.terrain.ExtentHelper")],c.ExtentHelper);let p=class extends c.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?
v.webMercatorWorldExtent:v.geographicWorldExtent}};p=d.__decorate([n.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],p);let r=class extends c.ExtentHelper{_computeLayerViewsExtent(){const a=e.empty(),b=this.viewSpatialReference;this.layerViews.forEach(f=>{const g=f.layer;!f.isResolved()||"graphics"===g.type&&g.internal||(f=x("fullExtentInLocalViewSpatialReference"in f&&f.fullExtentInLocalViewSpatialReference||f.layer.fullExtent,b),e.expand(a,f,a))});const h=e.allFinite(a)?a:null,
l=this._get("layerViewsExtent");return e.equals(h,l)?l:h}_computeTiledLayersExtent(){const a=this.tilingScheme;if(!a)return null;const b=this.viewSpatialReference,h=e.empty();this.layers.forEach(g=>{if(g.loaded&&t.isTiledLayer(g)){var m=w.getTiledLayerInfo(g,b,u.ViewingMode.Local);if(null!=m){var {tileInfo:y,fullExtent:q}=m;m="tilemapCache"in g?g.tilemapCache?.effectiveMaxLOD:void 0;null!=y&&null!=q&&(w.isProjectableRasterLayer(g)||a.compatibleWith(y,m)&&q.spatialReference.equals(a.spatialReference))&&
e.expand(h,q,h)}}});e.expand(h,this.defaultTiledLayersExtent,h);const l=e.allFinite(h)?h:null,f=this._get("tiledLayersExtent");return e.equals(l,f)?f:l}};r=d.__decorate([n.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],r);c.create=function(a,b){return a===u.ViewingMode.Global?new p(b):new r(b)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});