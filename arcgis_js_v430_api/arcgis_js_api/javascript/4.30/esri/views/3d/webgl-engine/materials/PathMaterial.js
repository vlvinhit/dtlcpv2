// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/has ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RayIntersections ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique".split(" "),function(p,D,t,E,F,d,q,G,H,I,u,v,h,J,l){function w(a,b,m,e,g,n){a.baked.size&&a.baked.size[0]===b[0]&&a.baked.size[1]===
b[1]||a.baked.bake(b);a.baked.intersect(m,e,g,n)}class x extends H.Material{constructor(a){super(a,new y);this.supportsEdges=!0;this.produces=new Map([[v.RenderSlot.OPAQUE_MATERIAL,b=>(this.parameters.castShadows&&d.isShadowRelatedOutput(b)||d.is3DGeometryOutput(b))&&!this.parameters.transparent],[v.RenderSlot.TRANSPARENT_MATERIAL,b=>(this.parameters.castShadows&&d.isShadowRelatedOutput(b)||d.is3DGeometryOutput(b))&&this.parameters.transparent]]);this._vertexAttributeLocations=l.vertexAttributeLocations;
this._configuration=new l.PathTechniqueConfiguration;this._vertexBufferLayout=x.getVertexBufferLayout()}getConfiguration(a,b){this._configuration.output=a;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;
a===d.ShaderOutput.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?q.NormalsDoubleSidedMode.WindingOrder:q.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=b.ssao);this._configuration.transparencyPassType=b.transparencyPassType;this._configuration.multipassEnabled=
b.multipassEnabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(a){return a===d.ShaderOutput.Shadow||a===d.ShaderOutput.ShadowExcludeHighlight||a===d.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&0<this.parameters.opacity}intersect(a,b,m,e,g,n){if(I.isPathGeometry(a)){b=a.path;var f=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:z,
factor:A,minSize:B,maxSize:C}=this.parameters.vvSize;var k=b.sizeAttributeValue;f[0]*=t.clamp(z[0]+k*A[0],B[0],C[0]);f[1]*=t.clamp(z[2]+k*A[2],B[2],C[2])}k=new u.MeshIntersectionOptions(!1,m.options.normalRequired);var c=Math.max(f[0],f[1]);a=a.boundingInfo;if(null==a)w(b,f,e,g,k,n);else{a=E.fromValues(a.bbMin[0]-c,a.bbMin[1]-c,a.bbMin[2]-c,a.bbMax[0]+c,a.bbMax[1]+c,a.bbMax[2]+c);c=[g[0]-e[0],g[1]-e[1],g[2]-e[2]];var r=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);u.intersectAabbInvDir(a,e,[r/c[0],r/c[1],
r/c[2]],m.tolerance)&&w(b,f,e,g,k,n)}}}createBufferWriter(){return new J.DefaultBufferWriter(this._vertexBufferLayout)}createGLMaterial(a){return new K(a)}static getVertexBufferLayout(){const a=F.newLayout().vec3f(h.VertexAttribute.POSITION).vec4f(h.VertexAttribute.PROFILERIGHT).vec4f(h.VertexAttribute.PROFILEUP).vec4f(h.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(h.VertexAttribute.FEATUREVALUE);D("enable-feature:objectAndLayerId-rendering")&&a.vec4u8(h.VertexAttribute.OBJECTANDLAYERIDCOLOR);return a}}
class K extends G{_updateOccludeeState(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})}_updateShadowState(a){null!=this.technique&&a.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:a.shadowMap.enabled})}beginSlot(a){this._output===d.ShaderOutput.Color&&(this._updateShadowState(a),this._updateOccludeeState(a));return this.ensureTechnique(l.PathTechnique,a)}}class y extends l.PathPassParameters{constructor(){super(...arguments);
this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}p.PathMaterial=x;p.PathMaterialParameters=y;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});