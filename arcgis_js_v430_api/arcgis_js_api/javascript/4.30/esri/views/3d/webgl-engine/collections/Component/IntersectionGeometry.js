// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ../../../../ViewingMode ./ComponentObjectElevationAgnosticComponentBVH".split(" "),function(E,F,G,k,A,M,H,I,N){class O{constructor(a,b,c){this.viewingMode=a;this.positionData=b;this._components=c;this.componentVerticalOffsets=
this.verticalOffset=null;this._planetCenter=A.create();this._componentBvh=null;this._aabb=[0,0,0,0,0,0];this._indices=b.indices?H.compactIndices(b.indices):H.getContinuousIndexArray(b.positions.length/3);this._positions=b.positions}destroy(){this._componentBvh=this._perComponentAabbs=this._indices=this._positions=null}getComponentAabb(a,b){const c=this._ensureComponentAabbs();a*=6;b[0]=c[a];b[1]=c[a+1];b[2]=c[a+2];b[3]=c[a+3];b[4]=c[a+4];b[5]=c[a+5];return b}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){this._perComponentAabbs||
(this._perComponentAabbs=this._computePerComponentAabbs());return this._perComponentAabbs}getComponentPositions(a,b){b.indices=this._indices;b.data=this._positions;b.stride=3;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]}intersect(a,b,c,l,d,e,m,h){this.verticalOffset=l;this.componentVerticalOffsets=d;const {position:f}=e;a=k.sub(P,a,f);b=k.sub(Q,b,f);e=F.invert(R,e.rotationScale);k.transformMat3(a,a,e);k.transformMat3(b,b,e);const q=F.transpose(S,e);if(this.viewingMode===
I.ViewingMode.Global){const g=this._planetCenter;k.negate(g,f);k.transformMat3(g,g,e)}this._intersectComponents(a,b,d,l,(g,r,t,n)=>{h(t,g,n?k.transformMat3(T,n,q):null,r)},c,m)}_computePerComponentAabbs(){var a=this._aabb;const b=.5*(a[0]+a[3]),c=.5*(a[1]+a[4]);a=.5*(a[2]+a[5]);const l=this._components.count,d=M.newFloatArray(6*l),e=this._indices,m=this._positions,h=this._components.offsets;let f=0,q=Infinity,g=Infinity,r=Infinity,t=-Infinity,n=-Infinity,D=-Infinity;for(let B=0;B<l;B++){var C=h[B];
const J=h[B+1];let u=Infinity,v=Infinity,w=Infinity,x=-Infinity,y=-Infinity,z=-Infinity;if(C<J)for(;C<J;C++){var p=3*e[C];const K=m[p],L=m[p+1];p=m[p+2];u=Math.min(u,K);v=Math.min(v,L);w=Math.min(w,p);x=Math.max(x,K);y=Math.max(y,L);z=Math.max(z,p)}else u=b,v=c,w=a,x=b,y=c,z=a;d[f++]=u;d[f++]=v;d[f++]=w;d[f++]=x;d[f++]=y;d[f++]=z;q=Math.min(q,u);g=Math.min(g,v);r=Math.min(r,w);t=Math.max(t,x);n=Math.max(n,y);D=Math.max(D,z)}this._aabb[0]=q;this._aabb[1]=g;this._aabb[2]=r;this._aabb[3]=t;this._aabb[4]=
n;this._aabb[5]=D;return d}_intersectComponents(a,b,c,l,d,e,m){let h=this._componentBvh;null==h&&(this._componentBvh=h=new N.ComponentObjectElevationAgnosticComponentBVH(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode));h.intersectRay(a,b,c,l,d,e,m)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===
I.ViewingMode.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){this._ensureComponentAabbs();return this._aabb}}const P=A.create(),Q=A.create(),R=G.create(),T=A.create(),S=G.create();E.IntersectionGeometry=O;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});