// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),function(q,
x,E,y,F,f,G,H,I,h,z,d,J,K,L,M,A,k){class N extends L.TriangleMaterial{constructor(b){super(b,new B);this.supportsEdges=!0;this.produces=new Map([[h.RenderSlot.OPAQUE_MATERIAL,a=>f.isOIDorHighlight(a)],[h.RenderSlot.TRANSPARENT_MATERIAL,a=>f.isColor(a)],[h.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,a=>f.isDepth(a)&&this.parameters.writeLinearDepth],[h.RenderSlot.DRAPED_MATERIAL,a=>this.parameters.draped&&a===f.ShaderOutput.Color||f.isOIDorHighlight(a)]]);this._vertexAttributeLocations=x("enable-feature:objectAndLayerId-rendering")?
k.vertexAttributeLocationsOID:k.vertexAttributeLocations;this._configuration=new k.PatternTechniqueConfiguration}getConfiguration(b,a){this._configuration.output=b;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=
this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=a.transparencyPassType;this._configuration.enableOffset=a.camera.relativeElevation<I.OITPolygonOffsetLimit;this._configuration.multipassEnabled=a.multipassEnabled;this._configuration.cullAboveGround=a.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration}createGLMaterial(b){return new O(b)}createBufferWriter(){const b=
F.newLayout().vec3f(d.VertexAttribute.POSITION).vec4f(d.VertexAttribute.UVMAPSPACE);this.parameters.draped||b.mat3f(d.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?b.f32(d.VertexAttribute.COLORFEATUREATTRIBUTE):b.vec4u8(d.VertexAttribute.COLOR);x("enable-feature:objectAndLayerId-rendering")&&b.vec4u8(d.VertexAttribute.OBJECTANDLAYERIDCOLOR);return new P(b)}}class O extends H{_updateParameters(b){return this.ensureTechnique(k.PatternTechnique,b)}_updateOccludeeState(b){b.hasOccludees!==this._material.parameters.hasOccludees&&
this._material.setParameters({hasOccludees:b.hasOccludees})}beginSlot(b){this._output===f.ShaderOutput.Color&&this._updateOccludeeState(b);return this._updateParameters(b)}}class P extends J.DefaultBufferWriter{write(b,a,C,r,t){A.writeDefaultAttributes(C,this.vertexBufferLayout,b,a,r,t);for(const l of this.vertexBufferLayout.fields.keys()){var c=C.attributes.get(l);a=c?.indices;if(c&&a)switch(l){case d.VertexAttribute.UVMAPSPACE:z.assert(4===c.size);(a=r.getField(l,y.BufferViewVec4f))&&A.writeBufferVec4(c,
a,t);break;case d.VertexAttribute.BOUNDINGRECT:z.assert(9===c.size);var g=r.getField(l,y.BufferViewMat3f);if(g){a=t;const {data:m,indices:D}=c;c=b;const n=g.typedBuffer;g=g.typedBufferStride;const Q=D.length;a*=g;for(let u=0;u<Q;++u){const p=9*D[u];var e=m[p];const v=m[p+1],w=m[p+2];n[a]=c[0]*e+c[4]*v+c[8]*w+c[12];n[a+1]=c[1]*e+c[5]*v+c[9]*w+c[13];n[a+2]=c[2]*e+c[6]*v+c[10]*w+c[14];for(e=3;9>e;++e)n[a+e]=m[p+e];a+=g}}}}}}class B extends M.VisualVariablePassParameters{constructor(){super(...arguments);
this.color=E.fromValues(1,1,1,1);this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=G.CullFaceOptions.None;this.hasOccludees=!1;this.style=K.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}q.Parameters=B;q.PatternMaterial=N;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});