// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Edge".split(" "),function(H,F,v,c,w,T){function U(a){const A=a.faces.length/3,n=a.faces,p=a.neighbors;a=a.vertices.position;f.length=G.length=0;for(let l=0;l<A;l++){var d=3*l;const u=p[d],m=p[d+1],q=p[d+2],g=n[d],e=n[d+1];d=n[d+2];a.getVec(g,t);a.getVec(e,B);a.getVec(d,C);c.subtract(B,B,t);c.subtract(C,C,t);c.cross(t,B,C);c.normalize(t,
t);G.pushArray(t);if(-1===u||g<e)f.push(g),f.push(e),f.push(l),f.push(u);if(-1===m||e<d)f.push(e),f.push(d),f.push(l),f.push(m);if(-1===q||d<g)f.push(d),f.push(g),f.push(l),f.push(q)}return{edges:f,normals:G}}class V{constructor(){this.length=this.index=0}}const D=new v({allocator:a=>a||new V,deallocator:null}),f=new v({deallocator:null}),G=new v({deallocator:null}),b=new T.Edge,W=w.create(),I=w.create(),t=w.create(),B=w.create(),C=w.create(),J=F.deg2rad(4),X=Math.cos(J);v=F.deg2rad(35);const Y=Math.cos(v);
H.extractEdges=function(a,A,n){const p=a.vertices.position,d=a.vertices.componentIndex,l=b.position0,u=b.position1,m=b.faceNormal0,q=b.faceNormal1,{edges:g,normals:e}=U(a);a=g.length/4;const K=A.allocate(a);let L=0;const E=n?.allocate(a);let M=0,N=0,O=0;D.length=0;for(var r=0;r<a;++r){var x=4*r;p.getVec(g.data[x],l);p.getVec(g.data[x+1],u);x=D.pushNew();x.index=4*r;x.length=c.distance(l,u)}D.sort((y,k)=>k.length-y.length);const P=[],Q=[];D.forAll(({length:y,index:k})=>{var z=g.data[k],h=g.data[k+
1];const R=g.data[k+2],S=g.data[k+3];k=-1===S;p.getVec(z,l);p.getVec(h,u);if(k)h=3*R,c.set(m,e.data[h],e.data[h+1],e.data[h+2]),c.copy(q,m),b.componentIndex=d.get(z),b.cosAngle=c.dot(m,q);else{h=3*R;c.set(m,e.data[h],e.data[h+1],e.data[h+2]);h=3*S;c.set(q,e.data[h],e.data[h+1],e.data[h+2]);b.componentIndex=d.get(z);b.cosAngle=c.dot(m,q);if(b.cosAngle>X)return;-.9999>b.cosAngle&&c.copy(q,m)}N+=y;O++;k||b.cosAngle<Y?(A.write(K,L++,b),P.push(y)):(z=F.acosClamped(b.cosAngle),c.direction(I,b.position1,
b.position0),k=0<c.dot(c.cross(W,b.faceNormal0,b.faceNormal1),I)?-1:1,z*k>J&&(E&&n&&n.write(E,M++,b),Q.push(y)))});a=new Float32Array(P.reverse());r=new Float32Array(Q.reverse());r=E&&n?{instancesData:E.slice(0,M),lodInfo:{lengths:r}}:void 0;return{regular:{instancesData:K.slice(0,L),lodInfo:{lengths:a}},silhouette:r,averageEdgeLength:N/O}};Object.defineProperty(H,Symbol.toStringTag,{value:"Module"})});