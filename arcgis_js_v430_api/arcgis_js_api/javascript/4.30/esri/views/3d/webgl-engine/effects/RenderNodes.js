// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Logger ../../../../core/PooledArray ../../webgl/utils ../core/FBOCache ../../../webgl/checkWebGLError".split(" "),function(m,q,r,l,n,p){class t{constructor(a){this._context=a;this._nodes=new r}destroy(){this._nodes.forEach(a=>a.destroy());this._nodes.clear()}add(a){this._nodes.push(a);p.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:b})=>b).join(", ")}`)}remove(a){this._nodes.remove(a);p.hasFeatureFlagWebGLDebug&&
console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:b})=>b).join(", ")}`)}produces(a){return this._nodes.some(({produces:b})=>b===a)}require(a,...b){const f=this._nodes;return b.reduce((g,k)=>g+f.reduce((d,{consumes:e,produces:h})=>d+(e.required.includes(a)&&h===k?1:0),0),0)}optional(a,...b){const f=this._nodes;return b.reduce((g,k)=>g+f.reduce((d,{consumes:e,produces:h})=>d+(e.optional?.includes(a)&&h===k?1:0),0),0)}updateAnimation(){return this._nodes.reduce((a,b)=>b.updateAnimation()||
a,!1)}render(a,b,f=()=>{}){const g=l.isManagedFBO(a)?a.name:a,k=this._nodes.filter(({produces:d})=>d===g);if(0===k.length)return l.isManagedFBO(a)?a:n.defaultWebGLFBO;k.forEach(d=>{const e=l.isManagedFBO(a)?[a]:[];for(var h of d.consumes.required){if(h===g)continue;const c=b.get(h);if(!c){f&&f(e);return}e.push(c)}if(d.consumes.optional)for(const c of d.consumes.optional)c!==g&&(h=b.get(c))&&e.push(h);try{const c=d.doRender(e,this._context);c&&c!==a&&(l.isManagedFBO(a)?(a.release(),a=c,b.set(g,a)):
a=c)}catch(c){q.getLogger(d).errorOnce(c)}f&&f(e)});this._context.rctx.enforceState();return l.isManagedFBO(a)?a:n.defaultWebGLFBO}}m.RenderNodes=t;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});