// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../webgl/formats ../../../webgl/RenderNode ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(v,f,h,n,p,q,k,F,G,H,w,r,x,y,z,A,B,C,t,g,D,E){function u(a,c,b,d){const e=new E.TextureDescriptor;e.pixelFormat=b;e.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;e.width=d.width;e.height=d.height;e.samplingMode=c;return new D.Texture(a,e,d)}f.SMAA=class extends y{constructor(a){super(a);this.produces="disabled";this.consumes={required:["aa-color","composite-color"]};this._searchTexture=this._areaTexture=null;this._smaaParameters=new C.SMAAPassParameters;this._edgeTechnique=a.techniques.acquire(B.SMAAEdgeDetectTechnique);
this._blendTechnique=a.techniques.acquire(z.SMAABlendWeightsTechnique);this._blurTechnique=a.techniques.acquire(A.SMAABlurTechnique)}initialize(){this.addHandles([q.watch(()=>this.isEnabled(),a=>a?this.enable():this.disable(),q.syncAndInitial)])}async enable(){this.produces="aa-color";if(!(this._abortController||this._areaTexture&&this._searchTexture)){this._abortController=new AbortController;var a=this._abortController.signal;try{const c=await new Promise((b,d)=>v(["./SMAAData"],b,d));await this._loadTextures(c,
a);this.requestRender(t.RenderRequestType.UPDATE)}catch{}this._abortController=null}}async _loadTextures(a,c){p.throwIfAborted(c);const [b,d]=await Promise.allSettled([r.requestImage(a.areaTexture,{signal:c}),r.requestImage(a.searchTexure,{signal:c})]);p.throwIfAborted(c);"fulfilled"===b.status&&"fulfilled"===d.status&&(a=this.renderingContext,this._areaTexture=u(a,g.TextureSamplingMode.LINEAR,g.PixelFormat.RGB,b.value),this._searchTexture=u(a,g.TextureSamplingMode.NEAREST,g.PixelFormat.LUMINANCE,
d.value))}disable(){this.produces="disabled"}destroy(){this._searchTexture=n.disposeMaybe(this._searchTexture);this._areaTexture=n.disposeMaybe(this._areaTexture);this._blurTechnique.release();this._blendTechnique.release();this._edgeTechnique.release()}render(a){const c=a.find(({name:m})=>"aa-color"===m);if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(t.RenderRequestType.UPDATE),c;var b=
a.find(({name:m})=>"composite-color"===m);const d=b.fbo.width,e=b.fbo.height;a=this.renderingContext;a.setViewport(0,0,d,e);const l=this.fboCache.acquire(d,e,"smaa edges",x.ColorFormat.RG);a.unbindTexture(l.fbo?.colorTexture);a.bindFramebuffer(l.fbo);a.setClearColor(0,0,0,1);a.clear(g.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.color=b.getTexture();a.bindTechnique(this._edgeTechnique,null,this._smaaParameters);a.screen.draw();b=this.fboCache.acquire(d,e,"smaa blend");a.unbindTexture(b.fbo?.colorTexture);
a.bindFramebuffer(b.fbo);a.setClearColor(0,0,1,1);a.clear(g.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=l.getTexture();this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;a.bindTechnique(this._blendTechnique,null,this._smaaParameters);a.screen.draw();l.release();a.bindFramebuffer(c.fbo);a.setClearColor(0,1,0,1);a.clear(g.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=b.getTexture();a.bindTechnique(this._blurTechnique,
null,this._smaaParameters);a.screen.draw();b.release();return c}};h.__decorate([k.property()],f.SMAA.prototype,"produces",void 0);h.__decorate([k.property()],f.SMAA.prototype,"consumes",void 0);h.__decorate([k.property({constructOnly:!0})],f.SMAA.prototype,"isEnabled",void 0);h.__decorate([k.property({constructOnly:!0})],f.SMAA.prototype,"techniques",void 0);h.__decorate([k.property()],f.SMAA.prototype,"_abortController",void 0);f.SMAA=h.__decorate([w.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],
f.SMAA);Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});