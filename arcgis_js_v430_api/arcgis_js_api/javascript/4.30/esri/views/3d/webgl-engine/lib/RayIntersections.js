// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./ContentObjectType ./Util ./VertexAttribute".split(" "),function(H,D,J,R,Z,aa,ba){function T(a,b,f,v,w,e,n){if(null!=a){var q=U(f,ca);R.setMin(N,a.bbMin);R.setMax(N,a.bbMax);null!=w&&w.applyToAabb(N);if(V(N,b,q,v)){const {primitiveIndices:p,position:m}=a;q=p?p.length:m.indices.length/3;if(1E3<q&&(a=a.getChildren(),void 0!==a)){for(var B of a)T(B,b,f,v,w,e,n);return}v=
q;B=m.indices;a=m.data;q=m.stride;var I=p;const E=b[0],x=b[1];b=b[2];const F=f[0],A=f[1];f=f[2];({normalRequired:e}=e);for(let u=0;u<v;++u){const G=I[u];var k=3*G,l=q*B[k],z=a[l],r=a[l+1],C=a[l+2],t=q*B[k+1];l=a[t];var y=a[t+1];t=a[t+2];var g=q*B[k+2];k=a[g];var h=a[g+1];g=a[g+2];null!=w&&([z,r,C]=w.applyToVertex(z,r,C,u),[l,y,t]=w.applyToVertex(l,y,t,u),[k,h,g]=w.applyToVertex(k,h,g,u));l-=z;y-=r;t-=C;k-=z;h-=r;g-=C;var c=A*g-h*f,d=f*k-g*F;const L=F*h-k*A,K=l*c+y*d+t*L;if(!(1E-7>=Math.abs(K))){z=
E-z;r=x-r;C=b-C;c=z*c+r*d+C*L;if(0<K){if(0>c||c>K)continue}else if(0<c||c<K)continue;d=r*t-y*C;C=C*l-t*z;r=z*y-l*r;z=F*d+A*C+f*r;if(0<K){if(0>z||c+z>K)continue}else if(0<z||c+z<K)continue;r=(k*d+h*C+g*r)/K;0<=r&&(l=e?O(l,y,t,k,h,g,M):null,n(r,G,l))}}}}}function S(a,b,f,v,w,e,n,q,B,I){const k=da;var l=Math.abs(b[0]),z=Math.abs(b[1]),r=Math.abs(b[2]);l=l>=z?l>=r?0:2:z>=r?1:2;r=0>b[l]?2:1;z=(l+r)%3;r=(l+(3-r))%3;const C=b[z]/b[l],t=b[r]/b[l];b=1/b[l];const y=ea,g=fa,h=ha;for({normalRequired:B}=B;f<v;++f){var c=
3*f,d=n*w[c];D.set(k[0],e[d+0],e[d+1],e[d+2]);d=n*w[c+1];D.set(k[1],e[d+0],e[d+1],e[d+2]);c=n*w[c+2];D.set(k[2],e[c+0],e[c+1],e[c+2]);q&&(D.copy(k[0],q.applyToVertex(k[0][0],k[0][1],k[0][2],f)),D.copy(k[1],q.applyToVertex(k[1][0],k[1][1],k[1][2],f)),D.copy(k[2],q.applyToVertex(k[2][0],k[2][1],k[2][2],f)));D.sub(y,k[0],a);D.sub(g,k[1],a);D.sub(h,k[2],a);d=y[z]-C*y[l];var p=y[r]-t*y[l];const E=g[z]-C*g[l],x=g[r]-t*g[l];var m=h[z]-C*h[l];const F=h[r]-t*h[l];c=m*x-F*E;m=d*F-p*m;p=E*p-x*d;(0>c||0>m||0>
p)&&(0<c||0<m||0<p)||(d=c+m+p,0!==d&&(c=c*b*y[l]+m*b*g[l]+p*b*h[l],0>c*Math.sign(d)||(c/=d,0<=c&&(B?(d=k,D.sub(P,d[1],d[0]),D.sub(Q,d[2],d[0]),D.cross(M,P,Q),D.normalize(M,M),d=M):d=null,I(c,f,d)))))}}function O(a,b,f,v,w,e,n){D.set(P,a,b,f);D.set(Q,v,w,e);D.cross(n,P,Q);D.normalize(n,n);return n}function U(a,b){return D.set(b,1/a[0],1/a[1],1/a[2])}function V(a,b,f,v){return W(a,b,f,v,Infinity)}function W(a,b,f,v,w){var e=(a[0]-v-b[0])*f[0],n=(a[3]+v-b[0])*f[0];let q=Math.min(e,n);e=Math.max(e,n);
n=(a[1]-v-b[1])*f[1];const B=(a[4]+v-b[1])*f[1];e=Math.min(e,Math.max(n,B));if(0>e)return!1;q=Math.max(q,Math.min(n,B));if(q>e)return!1;n=(a[2]-v-b[2])*f[2];a=(a[5]+v-b[2])*f[2];e=Math.min(e,Math.max(n,a));if(0>e)return!1;q=Math.max(q,Math.min(n,a));return q>e?!1:q<w}class X{constructor(a=!1,b=!0){this.isVerticalRay=a;this.normalRequired=b}}const N=R.create(),ca=J.create(),M=J.create(),ea=J.create(),fa=J.create(),ha=J.create(),P=J.create(),Q=J.create(),Y=J.create(),da=[J.create(),J.create(),J.create()];
H.MeshIntersectionOptions=X;H.computeInvDir=function(a,b,f){return D.set(f,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))};H.computeInvDirFromDirection=U;H.computeNormalFromBarycentric=O;H.intersectAabbInvDir=V;H.intersectAabbInvDirBefore=W;H.intersectRayTriangles=function(a,b,f,v,w,e,n,q,B,I=null,k=0){const l=a[0],z=a[1];a=a[2];const r=b[0],C=b[1];for(b=b[2];f<v;++f){const F=k+(I?I[f]:f);var t=3*F,y=n*w[t],g=e[y],h=e[y+1],c=e[y+2],d=n*w[t+1],p=n*w[t+2];t=e[d]-g;y=e[d+1]-h;d=e[d+2]-c;const A=e[p]-g,u=
e[p+1]-h;p=e[p+2]-c;var m=C*p-u*b,E=b*A-p*r;const G=r*u-A*C;var x=t*m+y*E+d*G;if(!(1E-7>=Math.abs(x))){g=l-g;h=z-h;c=a-c;m=g*m+h*E+c*G;if(0<x){if(0>m||m>x)continue}else if(0<m||m<x)continue;E=h*d-y*c;c=c*t-d*g;h=g*y-t*h;g=r*E+C*c+b*h;if(0<x){if(0>g||m+g>x)continue}else if(0<g||m+g<x)continue;x=(A*E+u*c+p*h)/x;0<=x&&(t=q?O(t,y,d,A,u,p,M):null,B(x,F,t))}}};H.intersectRayTrianglesWithDisplacementWatertight=S;H.intersectRayTrianglesWithVerticalOffsetENUGlobal=function(a,b,f,v,w,e,n,q,B,I,k,l=null,z=0){const r=
a[0],C=a[1];a=a[2];const t=b[0],y=b[1];for(b=b[2];f<v;++f){const K=z+(l?l[f]:f);var g=3*K,h=n*w[g],c=e[h],d=e[h+1],p=e[h+2],m=n*w[g+1];h=e[m];var E=e[m+1];m=e[m+2];var x=n*w[g+2];g=e[x];var F=e[x+1];x=e[x+2];var A=p-B,u=q/Math.sqrt(c*c+d*d+A*A);c+=c*u;d+=d*u;p+=A*u;var G=m-B,L=q/Math.sqrt(h*h+E*E+G*G);A=x-B;u=q/Math.sqrt(g*g+F*F+A*A);h=h+h*L-c;E=E+E*L-d;m=m+G*L-p;g=g+g*u-c;F=F+F*u-d;x=x+A*u-p;u=y*x-F*b;G=b*g-x*t;L=t*F-g*y;A=h*u+E*G+m*L;if(!(1E-7>=Math.abs(A))){c=r-c;d=C-d;p=a-p;u=c*u+d*G+p*L;if(0<
A){if(0>u||u>A)continue}else if(0<u||u<A)continue;G=d*m-E*p;p=p*h-m*c;c=c*E-h*d;d=t*G+y*p+b*c;if(0<A){if(0>d||u+d>A)continue}else if(0<d||u+d<A)continue;c=(g*G+F*p+x*c)/A;0<=c&&(h=I?O(h,E,m,g,F,x,M):null,k(c,K,h))}}};H.intersectTriangleGeometry=function(a,b,f,v,w,e){if(a.visible){v=D.sub(Y,v,f);var n=(B,I,k)=>{e(B,k,I,!1)},q=new X(!1,b.options.normalRequired);a.boundingInfo?(aa.assert(a.type===Z.ContentObjectType.Mesh),T(a.boundingInfo,f,v,b.tolerance,w,q,n)):(a=a.attributes.get(ba.VertexAttribute.POSITION),
b=a.indices,S(f,v,0,b.length/3,b,a.data,a.stride,w,q,n))}};H.intersectTriangles=function(a,b,f,v,w,e,n,q,B){const {data:I,stride:k}=e;b=D.sub(Y,b,a);S(a,b,f,v,w,I,k,n,q,B)};H.triangleRayParallelTolerance=1E-7;Object.defineProperty(H,Symbol.toStringTag,{value:"Module"})});