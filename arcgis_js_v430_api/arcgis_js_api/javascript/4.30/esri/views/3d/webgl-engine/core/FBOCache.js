// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../webgl/formats ../../webgl/ManagedColorAttachment ../../webgl/ManagedDepthAttachment ../../webgl/ManagedFBO ../../webgl/ManagedFBObject ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(v,g,E,y,z,F,w,c,G,H,I,A,f){class J{constructor(b){this.rctx=b;this._acquired=new Set;this._cache=new w.FBOPool(b.newCache,"FBOCache");this._depthCache=
new w.FBOPool(b.newCache,"DepthAttachmentCache");this._colorCache=new w.FBOPool(b.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frameStart(){this._cache.frame();this._colorCache.frame();this._depthCache.frame();this.debugCallback&&this.debugCallback()}frameEnd(){const b=this.debugCallback;b&&this._acquired.forEach(d=>d.type===F.AttachmentType.FBO&&
b(d.name,d.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((b,d)=>b+("getTexture"in d?d.getTexture()?.usedMemory??0:d.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(b){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=b}acquire(b,d,h,k=g.ColorFormat.RGBA){const l=`${k}x${b}x${d}`;let a=this._cache.pop(l);a?(a.retain(),a.setName(h),h=this.rctx.getBoundFramebufferObject(),this.rctx.bindFramebuffer(a.fbo),
this.rctx.setDrawBuffers([c.ColorAttachment.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(h)):a=new z(l,h,new G.FramebufferObject(this.rctx,{...B[k],width:b,height:d}),e=>{e??=g.DepthFormat.DEPTH_STENCIL_TEXTURE;e=this._acquireDepth(e,a.fbo.width,a.fbo.height,`${a.name} depth`);a.attachDepth(e);e.release();return a},(e,m)=>{m??=g.ColorFormat.RGBA;m=this._acquireColor(m,b,d,`${a.name} color ${e}`);a.attachColor(m,e);m.release();return a},()=>{this.debugCallback&&this.debugCallback(a.name,a.fbo);this._acquired.delete(a);
a.detachAll();this._cache.put(a)});return this._trackHandle(a)}acquireDepth(b,d,h,k){return this._acquireDepth(b,d,h,k)}_acquireDepth(b,d,h,k){const l=`${b}x${d}x${h}`,a=this._depthCache.pop(l);if(a)return a.retain(),a.name=k,this._trackHandle(a);const e=b===g.DepthFormat.DEPTH_STENCIL_TEXTURE?new y.ManagedDepthAttachment(l,new A.Texture(this.rctx,{...C[b],width:d,height:h}),()=>{this._acquired.delete(e);this._depthCache.put(e)}):new y.ManagedDepthAttachment(l,new H.Renderbuffer(this.rctx,{...C[b],
width:d,height:h}),()=>{this._acquired.delete(e);this._depthCache.put(e)});e.name=k;return this._trackHandle(e)}_acquireColor(b,d,h,k){const l=`${b}x${d}x${h}`,a=this._colorCache.pop(l);if(a)return a.retain(),a.name=k,this._trackHandle(a);const e=new E.ManagedColorAttachment(l,new A.Texture(this.rctx,{...B[b],width:d,height:h}),()=>{this._acquired.delete(e);this._colorCache.put(e)});e.name=k;return this._trackHandle(e)}_trackHandle(b){this._acquired.add(b);return b}}const x=new z("default","default",
null,()=>x,()=>x,()=>{}),q=new f.TextureDescriptor;q.pixelFormat=c.PixelFormat.RED;q.internalFormat=c.SizedPixelFormat.R8;q.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;const r=new f.TextureDescriptor;r.pixelFormat=c.PixelFormat.RG;r.internalFormat=c.SizedPixelFormat.RG8;r.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;const t=new f.TextureDescriptor;t.internalFormat=c.SizedPixelFormat.RGBA4;t.dataType=c.PixelType.UNSIGNED_SHORT_4_4_4_4;t.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;const D=new f.TextureDescriptor;
D.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;const n=new f.TextureDescriptor;n.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;n.samplingMode=c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;n.hasMipmap=!0;n.maxAnisotropy=8;const p=new f.TextureDescriptor;p.pixelFormat=c.PixelFormat.RED;p.dataType=c.PixelType.HALF_FLOAT;p.internalFormat=c.SizedPixelFormat.R16F;p.samplingMode=c.TextureSamplingMode.NEAREST;const u=new f.TextureDescriptor;u.dataType=c.PixelType.HALF_FLOAT;u.internalFormat=c.SizedPixelFormat.RGBA16F;
u.samplingMode=c.TextureSamplingMode.NEAREST;const B={[g.ColorFormat.RED]:q,[g.ColorFormat.RG]:r,[g.ColorFormat.RGBA4]:t,[g.ColorFormat.RGBA]:D,[g.ColorFormat.RGBA_MIPMAP]:n,[g.ColorFormat.R16F]:p,[g.ColorFormat.RGBA16F]:u};f=new f.TextureDescriptor;f.pixelFormat=c.PixelFormat.DEPTH_STENCIL;f.dataType=c.PixelType.UNSIGNED_INT_24_8;f.samplingMode=c.TextureSamplingMode.NEAREST;f.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;const C={[g.DepthFormat.DEPTH_STENCIL_TEXTURE]:f,[g.DepthFormat.DEPTH16_BUFFER]:new I.RenderbufferDescriptor(c.RenderbufferFormat.DEPTH_COMPONENT16,
4)};v.FBOCache=J;v.defaultWebGLFBO=x;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});