// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl/RenderCamera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(f,y,p,va,r,F,wa,xa,d,n,G,B,C,w,H,I,ba,ya,S){function T(a,c,b){b=r.fromRotation(H.sm4d.get(),b[3],G.axis(b));null==b||r.exactEquals(b,F.IDENTITY)||(d.subtract(l,a.eye,c),d.transformMat4(l,l,b),a.eye=d.add(l,l,c),d.subtract(l,a.center,c),d.transformMat4(l,l,b),a.center=d.add(l,l,c),a.up=d.transformMat4(l,a.up,b))}function ca(a,c,b,e){return Math.sin(a/d.length(c))*(b+e.radius)}function da(a,c,b,e){b=I.fromScreenAtEye(c,b,U);if(null==b)return!1;w.closestPointOnSilhouette(a,b,J);return w.intersectRay(a,
b,e)?d.squaredDistance(J,b.origin)<d.squaredDistance(e,b.origin)?(d.copy(e,J),!1):!0:(d.subtract(z,c.eye,c.center),d.normalize(z,z),C.fromNormalAndOffset(z,-d.dot(d.normalize(z,z),J),ea),C.intersectRay(ea,b,e),!1)}function fa(a,c,b,e,g,k){var h=0;d.cross(K,a,c);d.subtract(L,a,c);d.length(a)<=g||!e.aboveGround?(d.cross(b,L,e.eye),h=d.dot(a,c)/(d.length(a)*d.length(c)),.9999>h?h=p.acosClamped(h):(a=d.length(d.cross(n.create(),a,c))/(d.length(a)*d.length(c)),h=p.asinClamped(a)),k=Math.cos(p.clamp(y.cyclicalPI.normalize(p.deg2rad(k)),
0,V)),h=-h-Math.max(0,d.length(c)-g)/(k*g)):(d.subtract(ha,e.eye,e.center),d.cross(b,L,ha),h=-d.length(L)/g);d.normalize(b,b);d.scale(b,b,d.length(K));return h}function W(a,c,b,e){e=Math.cos(p.clamp(y.cyclicalPI.normalize(p.deg2rad(e)),0,V));c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):p.acosClamped(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):p.acosClamped(a/b))-c)*b}function ia(a,c,b,e,g,k,h,m,q,t){m=W(a[2],c[2],k[3],m);c=q?W(a[0],c[0],k[3],180):c[0]-a[0];a=Math.sin(h)*c-Math.cos(h)*m;
h=Math.cos(h)*c+Math.sin(h)*m;d.normalize(l,g);g=q?a/Math.sqrt(Math.abs(k[3]**2-d.dot(b,l)**2)):a/k[3];b=h/Math.sqrt(Math.abs(k[3]**2-d.dot(b,e)**2));wa.set(t,g,b)}function ja(a,c,b,e,g,k,h,m,q,t){d.cross(K,a,c);B.coordinateSystemFromOneAxisAndNormalVector(k.up,k.eye,M,N,O);B.coordinateSystemFromOneAxisAndNormalVector([0,0,1],k.eye,u,v,ka);d.copy(b,v);d.copy(e,u);d.normalize(b,b);d.scale(b,b,d.length(K));B.vectorCoordinates(a,d.normalize(N,N),d.normalize(O,O),d.normalize(M,M),la);B.vectorCoordinates(c,
N,O,M,ma);ia(la,ma,a,u,v,h,m,q,t,g)}function na(a,c,b,e,g,k,h){r.fromRotation(P,g,e);r.fromRotation(Q,h,k);r.multiply(A,P,Q);d.subtract(c,a,b);d.transformMat4(c,c,A);d.add(c,c,b)}function oa(a,c,b,e,g,k){r.fromRotation(P,e,b);r.fromRotation(Q,k,g);r.multiply(A,P,Q);d.subtract(l,a.eye,c);d.transformMat4(l,l,A);a.eye=d.add(l,l,c);d.subtract(l,a.center,c);d.transformMat4(l,l,A);a.center=d.add(l,l,c);d.subtract(l,a.up,c);d.transformMat4(l,l,A);a.up=d.add(l,l,c)}function X(a,c,b,e,g,k){return(Math.abs(e)>
Math.PI-D.Angle||Math.abs(e)<D.Angle)&&(Math.abs(a[2])<b*D.Pole||Math.abs(c)>b)&&k.aboveGround&&g<D.Tilt}function pa(a,c,b,e,g,k){k?(G.fromPoints(b,e,qa),T(c,w.getCenter(a),qa)):(b=fa(b,e,ra,c,a[3],g),T(c,w.getCenter(a),G.wrapAxisAngle(ra,b)))}function sa(a,c,b,e,g,k,h){const m=h?20:1;d.copy(x,e);R.copyFrom(c);let q;for(let t=0;t<m&&1E-12<d.squaredDistance(b,x);t++)if(e=d.squaredDistance(b,x),ja(b,x,v,u,E,R,a,g,k,h),oa(R,w.getCenter(a),u,E[1],v,E[0]),na(x,x,w.getCenter(a),u,E[1],v,E[0]),q=d.squaredDistance(b,
x),q<e||0===t)c.copyFrom(R);else break}f.SpherePickPointFallback=void 0;(function(a){a[a.Ellipsoid=0]="Ellipsoid";a[a.Silhouette=1]="Silhouette"})(f.SpherePickPointFallback||(f.SpherePickPointFallback={}));S={exclude:new Set([S.terrainId])};const ta=va.createScreenPointArray();f.NavigationMode=void 0;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(f.NavigationMode||(f.NavigationMode={}));const Y={Elevation:3E4,Angle:p.deg2rad(16)},D={Pole:.95,Angle:p.deg2rad(18),Tilt:45},
V=p.deg2rad(80),Z=n.create(),J=n.create(),z=n.create(),ea=C.create(),ha=n.create(),u=n.create(),v=n.create(),ka=n.create(),M=n.create(),N=n.create(),O=n.create(),la=n.create(),ma=n.create(),E=xa.create(),qa=G.create(),P=F.create(),Q=F.create(),A=F.create(),x=n.create(),l=n.create(),L=n.create(),R=new ya,K=n.create(),ra=n.create(),U={origin:n.create(),direction:n.create()},aa={origin:n.create(),direction:n.create()};f.PreservingHeadingThreshold=D;f.TiltThresholdPanningSpeed=V;f.VerticalPanTresholds=
Y;f.applyPanPlanar=function(a,c,b){d.subtract(Z,b,c);a.eye=d.subtract(l,a.eye,Z);a.center=d.subtract(l,a.center,Z)};f.applyPanSphericalDirectRotation=pa;f.applyPanSphericalPreserveHeading=sa;f.applyRotation=T;f.applyRotationWithTwoAxes=oa;f.applyZoomOnSphere=function(a,c,b){c.getScreenCenter(ta);ba.intersectScreen(a,c,ta,l)&&(c.center=l);a=c.distance;b*=a;1E-6>Math.abs(a-b)||(b=d.scale(H.sv3d.get(),c.viewForward,b),c.eye=d.subtract(l,c.center,b))};f.applyZoomToPoint=function(a,c,b,e){const g=H.sv3d.get();
b=1-b;d.subtract(g,c,a.eye);const k=d.length(g);let h=k*(1-b);0<=b&&h<e&&(h=e,b=-(h-k)/k);1E-6>Math.abs(k-h)||(d.scale(g,g,b),a.eye=d.add(l,a.eye,g),a.center=d.lerp(l,a.center,c,b))};f.centroid=function(a,c){d.set(c,0,0,0);for(const b of a)d.add(c,c,b);d.scale(c,c,1/a.length)};f.contentIntersectorOptions=S;f.distanceClampValues=[1,3E8];f.intersectPlaneFromScreenPoint=function(a,c,b,e){return C.intersectRay(a,I.fromScreen(c,b,U),e)};f.intersectPlaneFromScreenPointAtEye=function(a,c,b,e){return C.intersectRay(a,
I.fromScreenAtEye(c,b,U),e)};f.lengthFromPoints=W;f.minHeightLimit=50;f.navigationMode=function(a,c,b,e){const g=a.relativeElevation;if(g>Y.Elevation&&"global"===e)return f.NavigationMode.Horizontal;I.fromScreenAtEye(a,c,aa);c=Math.sign(g);a=b.worldUpAtPosition(a.eye,l);return-c*d.dot(a,aa.direction)<Math.sin(Y.Angle)*d.length(aa.direction)?f.NavigationMode.Vertical:f.NavigationMode.Horizontal};f.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);b[1]=c[1]/(a.fullHeight/a.pixelRatio);
return b};f.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};f.offSurfaceTiltToEyeTiltGlobal=function(a,c,b,e){return ca(Math.PI/2,c,b,e)+(a-Math.PI/2)};f.onSurfaceTiltToEyeTiltGlobal=ca;f.panDistanceModifier=5;f.panMotionToRotationMatrix=function(a,c,b,e,g,k,h,m,q){if(X(a.center,d.dot(a.up,a.center),d.length(a.center),-y.cyclicalPI.normalize(p.deg2rad(k)),h,c))switch(a=-y.cyclicalPI.normalize(p.deg2rad(g)),{eye:g}=c,B.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],g,u,v,ka),g=b.translation[0]*e.pan,k="zoom"===q.mode?0:b.translation[1]*e.pan,c=Math.max(Math.sqrt(Math.abs(1-d.dot(c.center,u)**2/d.length(c.center)**2)),.5),h=-Math.cos(a)*k+Math.sin(a)*g,r.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(a)*k+Math.cos(a)*g)/c,u),m.pan.enabled=!0,q.mode){case "pan":r.rotate(m.pan.matrix,m.pan.matrix,h,v);m.pan.enabled=!0;break;case "zoom":m.zoom=-b.translation[1]*e.zoom}else{const {eye:t,viewRight:ua}=c;c=d.cross(H.sv3d.get(),ua,t);a=b.translation[0]*e.pan;0!==a&&
(r.rotate(m.pan.matrix,m.pan.matrix,-a,c),m.pan.enabled=!0);switch(q.mode){case "pan":b=b.translation[1]*e.pan;0!==b&&(r.rotate(m.pan.matrix,m.pan.matrix,b,ua),m.pan.enabled=!0);break;case "zoom":m.zoom=-b.translation[1]*e.zoom}}};f.panToPosition=function(a,c,b,e,g,k,h){X(b,d.dot(c.up,b),a[3],-y.cyclicalPI.normalize(p.deg2rad(g)),k,c)?sa(a,c,b,e,-y.cyclicalPI.normalize(p.deg2rad(g)),k,h):pa(a,c,b,e,k,h)};f.pickPointAndInitSphere=function(a,c,b,e,g,k){const h=n.create(),m=w.create();let q=!0,t=!0;
a.intersectScreen(b,h,k)?m[3]=d.length(h):(t=!1,m[3]=c.aboveGround&&g!==f.SpherePickPointFallback.Ellipsoid?Math.max(d.length(c.center),.9*e.radius):d.length(c.eye)-c.relativeElevation,g===f.SpherePickPointFallback.Silhouette?da(m,c,b,h):q=ba.intersectScreen(m,c,b,h));return{sphere:m,scenePickPoint:q?h:null,hasGeometryIntersection:t}};f.pivotDistanceModifier=30;f.preserveHeadingThreshold=X;f.rotatePivotDistanceModifier=5;f.rotatePivotMinDistanceModifier=10;f.rotatePointAroundTwoAxes=na;f.rotateScreenPixelArea=
90;f.rotationAngleAndAxisDirectRotation=fa;f.rotationAnglesAndAxesHeadingPreserving=ja;f.rotationAnglesHeadingPreserving=ia;f.screenPixelArea=80;f.sphereOrPlanePointFromScreenPoint=da;f.zoomDistanceModifier=8;f.zoomMaxDistanceModifier=1508E5;f.zoomMinDistanceModifier=200;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});