// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../Color ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/vectorStacks ../../Manipulator3D ../../RenderObject ../dragEventPipeline3D ../ManipulatorType ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/basicInterfaces ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Material ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces".split(" "),
function(u,C,D,E,v,Q,F,w,g,G,q,x,e,H,y,I,z,m,J,K,L,A,M,N,p,B){class O extends J.Manipulation{constructor(a){super();this._handles=new E;this._arrowManipulatorInfos=[];this._angle=0;this._scale=1;this._radius=m.discRadius;this._updateAfterDrag=!1;this.events=new D;this._tool=a.tool;this._view=a.view;this._opaqueMaterial=this._createMaterial();this._transparentMaterial=this._createMaterial(.5);null!=a.radius&&(this._radius=a.radius);this._createManipulators();this.forEachManipulator(b=>this._tool.manipulators.add(b))}set orthogonalAvailable(a){3<=
this._arrowManipulatorInfos.length&&(this._arrowManipulatorInfos[1].manipulator.available=a,this._arrowManipulatorInfos[3].manipulator.available=a)}destroy(){this._handles=F.destroyMaybe(this._handles);this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._view=this._tool=null;this._arrowManipulatorInfos.length=0}forEachManipulator(a){for(const {manipulator:b}of this._arrowManipulatorInfos)a(b,z.ManipulatorType.TRANSLATE_XY)}createManipulatedObjectDragPipeline(a,b,c){if(!b.operations)return v.makeHandle();
const f=b.operations.data.spatialReference,d=b.graphic;return K.createManipulatedMoveDragPipeline(b,c,h=>this.createDragPipeline((k,l,n,r,t)=>{({steps:l,cancel:n}=a(k,l,n,r,t));return h(k,l,n)},b.elevationInfo,f,d))}createDragPipeline(a,b,c,f){return v.handlesGroup(this._arrowManipulatorInfos.map(({manipulator:d},h)=>p.createManipulatorDragEventPipeline(d,(k,l,n,r,t)=>{l=l.next(P=>({...P,manipulatorType:z.ManipulatorType.TRANSLATE_XY})).next(p.dragAtLocation(this._view,k.elevationAlignedLocation)).next(I.screenToMapXYAtLocation(this._view,
k.elevationAlignedLocation,b,c,f)).next(p.constrainToMapAxis(k.location,this.angle+(h+1)*Math.PI*.5)).next(p.addScreenDelta());a(k,l,n,r,t)})))}get angle(){return this._angle}set angle(a){this._angle=a;this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(a){this._scale=a;this._updateManipulatorTransform()}get radius(){return this._radius}set radius(a){this._radius!==a&&(this._radius=a,this._updateManipulators())}_updateManipulators(){for(let a=
0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],a);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:a,transform:b},c){var f=this._radius/m.discRadius,d=m.discTranslateArrowSize*f;const h=d*Math.sqrt(3)/2;d=A.createExtrudedTriangle(this._opaqueMaterial,h,d/2,d/2,m.discHeight);A.transformInPlace(d,g.fromTranslation(e.sm4d.get(),q.set(e.sv3d.get(),0,-h/3,0)));a.renderObjects=[new y.RenderObject(d,B.ManipulatorStateFlags.Focused),
new y.RenderObject(d.instantiate({material:this._transparentMaterial}),B.ManipulatorStateFlags.Unfocused)];a.radius=h/3*2.4;a=g.fromZRotation(e.sm4d.get(),c*Math.PI/2);f=g.fromTranslation(e.sm4d.get(),q.set(e.sv3d.get(),0,m.discTranslateArrowOffset*f,0));g.multiply(b,a,f)}_createManipulators(){for(let a=0;4>a;a++){const b=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(b)}this._updateManipulatorTransform()}_updateManipulatorTransform(){var a=this.angle;a=g.fromRotation(e.sm4d.get(),
a,x.fromValues(0,0,1));if(null!=a){var b=g.fromScaling(e.sm4d.get(),q.set(e.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));a=g.multiply(e.sm4d.get(),b,a);for(const c of this._arrowManipulatorInfos)b=g.multiply(e.sm4d.get(),a,c.transform),c.manipulator.modelTransform=b}}_createArrowManipulator(a){const b=new H.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:x.fromValues(0,0,1)}}),
c={manipulator:b,transform:G.create()};this._updateArrowManipulator(c,a);this._handles.add(b.events.on("drag",f=>{this._updateAfterDrag&&"end"===f.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}));return c}_createMaterial(a=1){const b=new N.ColorMaterial({cullFace:L.CullFaceOptions.Back,renderOccluded:M.RenderOccludedFlag.Transparent,isDecoration:!0});this._handles.add(w.watch(()=>C.toUnitRGBA(this._view.effectiveTheme.accentColor),c=>{c[3]*=a;b.setParameters({color:c})},
w.initial));return b}get test(){}}u.MoveXYAxisManipulation=O;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});