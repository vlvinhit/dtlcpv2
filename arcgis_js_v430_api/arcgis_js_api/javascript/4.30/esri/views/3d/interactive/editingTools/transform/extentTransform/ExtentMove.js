// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/handleUtils ../../../../../../core/quantityUtils ../../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../geometry/support/vectorStacks ../../../../analysis/Slice/ShiftManipulator ../../../../analysis/Slice/sliceToolUtils ../../dragEventPipeline3D ../../ManipulatorType ../../manipulations/MoveXYObjectManipulation ../../../../../interactive/dragEventPipeline ../../../../../interactive/editGeometry/interfaces ../../../../../interactive/tooltip/infos/TranslateTooltipInfo ../../../../../interactive/tooltip/infos/TranslateZTooltipInfo ../../../../../support/automaticLengthMeasurementUtils ../../../../../support/euclideanLengthMeasurementUtils".split(" "),
function(g,p,h,q,r,t,k,l,u,v,w,x,f,m,y,z,A,B){class C{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(a,c){this._tool=a;this._bounds=c;this._moveZTooltipInfo=this._moveXYTooltipInfo=null;a=this._tool;c=a.view;this.moveXYObjectManipulation=new x.MoveXYObjectManipulation({view:c,tool:a,object:this._object});a.addHandles(this._createMoveXYObjectDragPipeline());this.moveZManipulator=new l.ShiftManipulator(c,l.OffsetMode.CENTER_ON_CALLOUT);this.moveZManipulator.state|=
u.IsShiftEdgeOnScreenFlag;a.manipulators.add(this.moveZManipulator);a.addHandles([this._createMoveZDragPipeline()]);a.addHandles([a.events.on("translate-stop",()=>{this._moveZTooltipInfo=this._moveXYTooltipInfo=null})])}destroy(){this.moveXYObjectManipulation.destroy();this._tool.manipulators.remove(this.moveZManipulator);this.moveZManipulator.destroy()}forEachManipulator(a){this.moveXYObjectManipulation.forEachManipulator(a);a(this.moveZManipulator,w.ManipulatorType.TRANSLATE_Z)}updateManipulators(a,
c){const b=this.moveZManipulator;a=q.rotateZ(k.sm4d.get(),a,Math.PI);a[12]=0;a[13]=0;a[14]=0;b.modelTransform=a;b.renderLocation=r.subtract(k.sv3d.get(),c.origin,c.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){var a=this._tool;const c=this._moveXYTooltipInfo??(this._moveXYTooltipInfo=new y.TranslateTooltipInfo({sketchOptions:a.sketchOptions}));
if(this.moveXYObjectManipulation.dragging){var b=this._bounds,d=b.mapBoundsStart.origin;b=b.mapBounds.origin;({renderSpatialReference:a}=a.view);if(!a)return null;d=A.autoDistance2D(d,b,a);if(null==d)return null;c.distance=d}else c.distance=h.zeroMeters;return c}_computeMoveZTooltipInfo(){var a=this._tool;const c=this._moveZTooltipInfo??(this._moveZTooltipInfo=new z.TranslateZTooltipInfo({sketchOptions:a.sketchOptions}));if(this.moveZManipulator.dragging){var b=this._bounds,d=b.mapBoundsStart.origin;
b=b.mapBounds.origin;({renderSpatialReference:a}=a.view);if(!a)return null;d=B.verticalSignedDistance(d,b,a);if(null==d)return null;c.distance=d}else c.distance=h.zeroMeters;return c}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((a,c,b)=>this._applyObjectMoveSteps(c,b))}_createMoveZDragPipeline(){if(!this._operations)return p.makeHandle();const a=this._operations.data.spatialReference;return f.createManipulatorDragEventPipeline(this.moveZManipulator,(c,
b,d)=>{c=t.clone(c.renderLocation);b=b.next(v.screenToZConstrained(this._tool.view,c,a)).next(f.addScreenDelta());this._applyObjectMoveSteps(b,d)})}_applyObjectMoveSteps(a,c){const {_tool:b,_object:d}=this;a=a.next(e=>{"start"===e.action&&(b.inputState={type:"move"},this._bounds.backupMapBounds(),b.events.emit("translate-start",{object:d,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY}));return e}).next(f.addMapDelta()).next(this._moveDragUpdateGeometry()).next(e=>{const n={object:d,dxScreen:e.screenDeltaX,
dyScreen:e.screenDeltaY};switch(e.action){case "start":case "update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&b.events.emit("translate",n);break;case "end":b.inputState=null,b.events.emit("translate-stop",n)}return e});c.next(()=>{null!=b.inputState&&b.events.emit("translate-stop",{object:d,dxScreen:0,dyScreen:0});b.cancel()});return a}_moveDragUpdateGeometry(){const a=this._tool;return c=>{if(null==a.inputState||"move"!==a.inputState.type)return c;var b=
"start"===c.action?m.AccumulationBehavior.NEW_STEP:m.AccumulationBehavior.ACCUMULATE_STEPS;this._operations&&(b=this._operations.move(c.mapDeltaX,c.mapDeltaY,c.mapDeltaZ,b),this._bounds.updateMapBoundsFromOperation(b));return c}}}g.ExtentMove=C;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});