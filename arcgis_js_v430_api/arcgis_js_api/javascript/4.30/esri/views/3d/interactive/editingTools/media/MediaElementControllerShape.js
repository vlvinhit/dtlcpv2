// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/handleUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/support/UpdatingHandles ../../../../../geometry/projection ../../../../interactive/editGeometry/EditGeometryOperations".split(" "),function(c,d,h,
k,l,e,t,u,v,m,n,p,q){c.MediaElementControllerShape=class extends h{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(a){super(a);this._updatingHandles=new n.UpdatingHandles}initialize(){this.addHandles([k.destroyHandle(this._updatingHandles),this._updatingHandles.add(()=>this.element.georeference?.coords,a=>this._elementCoordinatesChanged(a),l.initial)])}_elementCoordinatesChanged(a){this._updatedElementCoordinates!==a&&this._updatingHandles.addPromise(this._whenProjected(a,
this.view.spatialReference,b=>{if(b){var {_operations:f}=this;if(f?.trySetGeometry(b))this.onModifiedExternally();else this._replaceOperations(q.EditGeometryOperations.fromGeometry(b,this.view.state.viewingMode))}else this._replaceOperations(null)}))}_operationsGeometryChanged(){const {element:{georeference:a},_operations:b}=this;if(b&&a){var f=b.data.geometry;a.coords?this._updatingHandles.addPromise(this._whenProjected(f,a.coords.spatialReference,g=>this._updateElementCoordinates(g))):this._updateElementCoordinates(f)}}_updateElementCoordinates(a){const {georeference:b}=
this.element;b&&(b.coords=a,this._updatedElementCoordinates=b.coords)}async _whenProjected(a,b,f){if(a){var {_operations:g,element:{georeference:r}}=this;a=await p.projectWithZConversion(a,b);g===this._operations&&r===this.element.georeference&&f(a)}else f(a)}_replaceOperations(a){this._operations&&(this.removeHandles(this._operations),this._operations.destroy());(this._operations=a)&&this.addHandles(a.data.on("change",()=>this._operationsGeometryChanged()),a);this.onModifiedExternally()}};d.__decorate([e.property({constructOnly:!0})],
c.MediaElementControllerShape.prototype,"view",void 0);d.__decorate([e.property({constructOnly:!0})],c.MediaElementControllerShape.prototype,"layer",void 0);d.__decorate([e.property({constructOnly:!0})],c.MediaElementControllerShape.prototype,"element",void 0);d.__decorate([e.property({constructOnly:!0})],c.MediaElementControllerShape.prototype,"onModifiedExternally",void 0);d.__decorate([e.property()],c.MediaElementControllerShape.prototype,"_operations",void 0);d.__decorate([e.property()],c.MediaElementControllerShape.prototype,
"operations",null);d.__decorate([e.property()],c.MediaElementControllerShape.prototype,"updating",null);c.MediaElementControllerShape=d.__decorate([m.subclass("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],c.MediaElementControllerShape);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});