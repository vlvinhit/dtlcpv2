// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/colorUtils ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/vectorStacks ./Object3DVisualElement ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Material ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),
function(p,q,y,z,A,B,f,m,r,t,k,C,D,E,F,G,H){function I(a,b,g){a=f.sub(u,b,a);g=f.cross(u,a,g);return 0===f.len(g)}class J extends C.Object3DVisualElement{constructor(a){super(a);this._arrowWidth=16;this._arrowSubdivisions=128;this._origin=m.create();this._originTransform=B.create();this._arrowCenter=m.create();this._renderOccluded=G.RenderOccludedFlag.OccludeAndTransparent;this._geometry=null;this._stripeLength=1;this._stripesEnabled=!0;this._color=t.create();this._contrastColor=t.create();this.applyProperties(a)}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==
this._renderOccluded&&(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:a}))}get geometry(){return this._geometry}set geometry(a){this._geometry=a;this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(a){this._stripeLength=a;this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(a){this._stripesEnabled=a;this.attached&&this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?
this._contrastColor:this._color})}get color(){return this._color}set color(a){q.colorVectorEquals(a,this._color)||(r.copy(this._color,a),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(a){q.colorVectorEquals(a,this._color)||(r.copy(this._contrastColor,a),this._updateArrowColor())}createExternalResources(){const a=this._color,b=this._contrastColor;this._arrowMaterial=new H.MeasurementArrowMaterial({outlineColor:a,stripeEvenColor:this._stripesEnabled?b:a,stripeOddColor:a,
renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration});this._handles=new y;this._handles.add(A.watch(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null;this._handles=z.destroyMaybe(this._handles)}forEachExternalMaterial(a){a(this._arrowMaterial)}createGeometries(a){if(null!=this._geometry?.startRenderSpace&&null!=this._geometry.endRenderSpace){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,
this._origin,this._geometry);b.transformation=this._originTransform;a.addGeometry(b);this._viewChanged()}}_createArrowGeometry(a,b,g,c){var h=this.view,l=h.renderCoordsHelper;const v=[],w=[],n=(d,e)=>{const x=k.sv3d.get();f.subtract(x,d,g);v.push(x);w.push(e)};if("euclidean"===c.type){c.eval(.5,this._arrowCenter);c=k.sv3d.get();l.worldUpAtPosition(this._arrowCenter,c);if(I(a,b,c)){const {heading:d,tilt:e}=h.camera;({direction:l}=D.headingTiltToDirectionUp(h,a,d,e,K));f.copy(c,l)}n(a,c);n(b,c)}else for(c.eval(.5,
this._arrowCenter),a=this._arrowSubdivisions+1&-2,b=0;b<a;++b){h=b/(a-1);const d=k.sv3d.get(),e=k.sv3d.get();c.eval(h,d);l.worldUpAtPosition(d,e);n(d,e)}return F.createPolylineGeometry(this._arrowMaterial,v,w)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const a=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*a})}}_updateArrowColor(){if(this.attached){var a=
this._color,b=this._contrastColor;this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?b:a,outlineColor:a,stripeOddColor:a})}}}const u=m.create(),K=E.createDirectionUp();p.MeasurementArrowVisualElement=J;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});