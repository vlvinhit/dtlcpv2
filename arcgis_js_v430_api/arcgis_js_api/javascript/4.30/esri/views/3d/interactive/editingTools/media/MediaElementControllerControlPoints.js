// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../geometry ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/handleUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/support/UpdatingHandles ../../../../../geometry/projection ../../../../interactive/editGeometry/EditGeometryOperations ../../../../../geometry/Polygon ../../../../../geometry/Point".split(" "),
function(e,f,A,r,p,t,u,h,B,C,v,w,q,x,y,z){e.MediaElementControllerControlPoints=class extends r{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(a){super(a);this._updatingHandles=new w.UpdatingHandles}initialize(){this.addHandles([t.destroyHandle(this._updatingHandles),this._updatingHandles.add(()=>{const a=this.element.georeference;return"control-points"===a?.type?a.controlPoints:null},a=>this._elementControlPointsChanged(a),u.initial)])}_elementControlPointsChanged(a){if(this._updatedElementControlPoints!==
a){a=a?.map(({mapPoint:b})=>b).filter(p.isSome);var c=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(a,c,b=>{if(b){var {_operations:g}=this;b=new y({rings:[b.map(({x:k,y:d})=>[k,d])],spatialReference:c});if(g?.trySetGeometry(b))this.onModifiedExternally();else this._replaceOperations(x.EditGeometryOperations.fromGeometry(b,this.view.state.viewingMode))}else this._replaceOperations(null)}))}}_operationsGeometryChanged(){const {element:{georeference:a},_operations:c}=
this;if(c&&a&&"control-points"===a.type&&a.controlPoints){var b=c.data.geometry,g=a.controlPoints.map(({mapPoint:d})=>d).filter(p.isSome);if(b.rings[0]?.length!==g.length)this._updateElementControlPoints(null);else{var k=b.rings[0].map(([d,m])=>new z({x:d,y:m,spatialReference:b.spatialReference}));g=g.map(({spatialReference:d})=>d);this._updatingHandles.addPromise(this._whenProjected(k,g,d=>this._updateElementControlPoints(d)))}}}_updateElementControlPoints(a){var {georeference:c}=this.element;if(c&&
a&&"control-points"===c.type&&c.controlPoints?.length===a?.length&&(a||(c.controlPoints=null),c=c.controlPoints,c?.length===a.length))for(let b=0;b<c.length;b++)c[b].mapPoint=a[b]}async _whenProjected(a,c,b){if(a){var {_operations:g,element:{georeference:k}}=this,d=a.map(({spatialReference:l})=>l),m=Array.isArray(c)?c:Array(d.length).fill(c);await q.initializeProjection(Array.from(d).map((l,n)=>({source:l,dest:m[n]})));a=a.map((l,n)=>q.project(l,m[n]));g===this._operations&&k===this.element.georeference&&
b(a)}else b(a)}_replaceOperations(a){this._operations&&(this.removeHandles(this._operations),this._operations.destroy());(this._operations=a)&&this.addHandles(a.data.on("change",()=>this._operationsGeometryChanged()),a)}};f.__decorate([h.property({constructOnly:!0})],e.MediaElementControllerControlPoints.prototype,"view",void 0);f.__decorate([h.property({constructOnly:!0})],e.MediaElementControllerControlPoints.prototype,"layer",void 0);f.__decorate([h.property({constructOnly:!0})],e.MediaElementControllerControlPoints.prototype,
"element",void 0);f.__decorate([h.property({constructOnly:!0})],e.MediaElementControllerControlPoints.prototype,"onModifiedExternally",void 0);f.__decorate([h.property()],e.MediaElementControllerControlPoints.prototype,"_operations",void 0);f.__decorate([h.property()],e.MediaElementControllerControlPoints.prototype,"operations",null);f.__decorate([h.property()],e.MediaElementControllerControlPoints.prototype,"updating",null);e.MediaElementControllerControlPoints=f.__decorate([v.subclass("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],
e.MediaElementControllerControlPoints);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});