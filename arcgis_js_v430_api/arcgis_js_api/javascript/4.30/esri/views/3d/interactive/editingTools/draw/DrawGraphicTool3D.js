// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../support/elevationInfoUtils ../../../../../symbols/support/ElevationInfo ../../SegmentLabels3D ../../SnappingVisualizer3D ../meshFastUpdateUtils ../settings ../../visualElements/ExtendedLineVisualElement ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement ../../../layers/graphics/elevationAlignmentUtils ../../../layers/graphics/ElevationContext ../../../layers/graphics/GraphicState ../../../webgl-engine/lib/Material ../../../../draw/DrawGraphicTool ../../../../draw/DrawOperation ../../../../draw/drawSurfaces ../../../../interactive/tooltip/tooltipCommonUtils ../../../../../core/accessorSupport/trackingUtils".split(" "),
function(h,m,p,g,q,f,r,Q,R,S,z,A,B,t,C,D,E,F,G,H,I,u,J,K,L,M,v,N,w,x,O){h.DrawGraphicTool3D=class extends v.DrawGraphicTool{constructor(a){super(a);this._verticalLineVisualElement=this._verticesVisualElement=this._outlineVisualElement=this._createGraphicState=this._activeVertexVisualElement=null;this._settings=new G.Settings({getTheme:()=>this.view.effectiveTheme});this.geometryType=null;this.type="draw-3d"}initialize(){const {mode:a,offset:b,unit:c}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=
new C({mode:a,offset:b,unit:c})}normalizeCtorArgs(a){return a.elevationInfo?a:{...a,elevationInfo:t.getEffectiveElevationInfo(a.hasZ??!0)}}initializeGraphic(a){const {view:b}=this,c=this._createGraphicState=new L.GraphicState({graphic:a});return g.handlesGroup([b.maskOccludee(a),b.trackGraphicState(c),f.watch(()=>({element:this._outlineVisualElement,isDraped:c.isDraped}),({element:d,isDraped:e})=>{d&&(d.isDraped=e)},f.syncAndInitial),O.autorun(()=>{x.updateMeshTransformFromTooltipInfo(this.tooltipInfos.mesh,
this.geometryToPlace)}),this._setupLoadingIndicator(c),...F.meshTransformFastUpdateHandles(c)])}makeDrawOperation(){const {geometryType:a}=this,b="circle"!==a&&"rectangle"!==a;return new N.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:v.geometryTypeToDrawOperationGeometryType(a),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new w.SceneDrawSurface(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new w.ElevationDrawSurface(this.elevationInfo,
this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new E.SnappingVisualizer3D,segmentLabels:b?new D.SegmentLabels3D:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===t.getEffectiveElevationMode(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(a){var {view:b}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=
[a],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(a),g.makeHandle();const c=this._settings,d=c.manipulators.vertex,e=new u.VerticesVisualElement({view:b,spatialReference:b.spatialReference,vertices:[a],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:d.size,outlineSize:d.outlineSize,renderOccluded:d.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=e;const k=new H.ExtendedLineVisualElement({view:b,extensionType:c.visualElements.zVerticalLine.extensionType,
innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:M.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=k;b=g.handlesGroup([f.watch(()=>c.visualElements.zVerticalLine,n=>n.apply(k),f.initial),f.watch(()=>({selectedColor:p.unitRGBAFromColor(c.colors.selected),outlineColor:p.unitRGBAFromColor(c.manipulators.vertex.outlineColor)}),({selectedColor:n,outlineColor:P})=>{e.color=n;e.outlineColor=P},f.initial),g.makeHandle(()=>{this._activeVertexVisualElement=
q.destroyMaybe(this._activeVertexVisualElement);this._verticalLineVisualElement=q.destroyMaybe(this._verticalLineVisualElement)})]);e.attached=!0;this._updateVerticalLineVisualElement(a);return b}_updateVerticalLineVisualElement(a){const b=this._verticalLineVisualElement;if(b){var {renderCoordsHelper:c,elevationProvider:d}=this.view;A.set(l,a[0],a[1],a[2]);y.setFromElevationInfo(this.elevationInfo);l[2]=J.evaluateElevationAlignmentAtPoint(l,d,y,c);c.toRenderCoords(l,this.view.spatialReference,l)?
(b.setStartEndFromWorldDownAtLocation(l),b.attached=!0):b.attached=!1}}onOutlineChanged(a){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=a,g.makeHandle();const b=this.internalGraphicsLayer.elevationInfo,{view:c}=this,d=this._settings,e=new I.OutlineVisualElement({view:c,geometry:a,elevationInfo:b,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===t.getEffectiveElevationMode(this.hasZ,b),attached:!1,isDecoration:!0});this._outlineVisualElement=
e;a=g.handlesGroup([f.watch(()=>d.visualElements.lineObjects.outline,k=>k.apply(e),f.initial),f.watch(()=>d.visualElements.lineObjects.shadowStyle,k=>k.apply(e),f.initial),g.makeHandle(()=>{this._outlineVisualElement=q.destroyMaybe(this._outlineVisualElement)})]);e.attached=!0;e.laserlineEnabled=!0;return a}onRegularVerticesChanged(a){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=a,g.makeHandle();const {view:b}=this,c=this._settings,d=c.manipulators.vertex,e=new u.VerticesVisualElement({view:b,
spatialReference:b.spatialReference,vertices:a,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:d.size,outlineSize:d.outlineSize,renderOccluded:d.renderOccluded,attached:!1,isDecoration:!0});a=g.handlesGroup([f.watch(()=>({color:p.unitRGBAFromColor(c.manipulators.vertex.color),outlineColor:p.unitRGBAFromColor(c.manipulators.vertex.outlineColor)}),({color:k,outlineColor:n})=>{e.color=k;e.outlineColor=n},f.initial),g.makeHandle(()=>{this._verticesVisualElement=q.destroyMaybe(this._verticesVisualElement)})]);
e.attached=!0;this._verticesVisualElement=e;return a}updateGraphicGeometry(a){if("mesh"===this.geometryType&&"point"===a?.type){const b=this.geometryToPlace;b?.centerAt(a);x.updateMeshTransformFromTooltipInfo(this.tooltipInfos.mesh,b);a=this._graphic;b&&a.geometry===b||(a.geometry=b)}else super.updateGraphicGeometry(a)}_setupLoadingIndicator(a){const {drawOperation:b}=this;if(!this.geometryToPlace)return b.loading=!1,null;b.loading=!0;const c=g.makeHandle(()=>{b.loading=!1});let d=void 0;return g.handlesGroup([f.when(()=>
a.displaying,()=>{d&&cancelAnimationFrame(d);d=requestAnimationFrame(()=>c.remove())},{...f.syncAndInitial,once:!0}),g.makeHandle(()=>d&&cancelAnimationFrame(d)),c])}};m.__decorate([r.property({constructOnly:!0})],h.DrawGraphicTool3D.prototype,"elevationInfo",void 0);m.__decorate([r.property({constructOnly:!0})],h.DrawGraphicTool3D.prototype,"geometryType",void 0);m.__decorate([r.property()],h.DrawGraphicTool3D.prototype,"type",void 0);m.__decorate([r.property({constructOnly:!0})],h.DrawGraphicTool3D.prototype,
"view",void 0);h.DrawGraphicTool3D=m.__decorate([z.subclass("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],h.DrawGraphicTool3D);const y=new K.ElevationContext,l=B.create();Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});