// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/tslib.es6 ../../../../core/a11yUtils ../../../../core/has ../../../../core/memoize ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/unitFormatUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../support/getDefaultUnitForView ../../keybindings ../css ../fields/parsingAndFormattingUtils ../../../../widgets/Widget ../../../../chunks/componentsUtils ../../../../widgets/support/widgetUtils ../../../../widgets/support/decorators/messageBundle ../../../../widgets/support/jsxFactory".split(" "),
function(q,d,e,y,H,z,m,t,A,r,f,I,J,B,u,C,h,D,E,F,G,v,k){async function n(a){await a?.setFocus()}function w(a){return(Array.isArray(a)?a:[a]).flat(10).filter(b=>!!b)}d.TooltipContent=class extends E{constructor(){super(...arguments);this._focusAbortController=new AbortController;this._transition=null;this._mode="feedback";this._getFormatters=z.memoize(D.getFormatters);this._onDiscard=()=>{this.info.clearInputValues();this.exitInputMode()};this._onCommit=(a,b)=>{if("commit-and-exit"===b)this.exitInputMode();
else if("commit-on-blur"!==b){var c=this._getFocusableElements(),g=c.length;a=c.indexOf(a);-1===a?this.exitInputMode():n(c.at(((a+("commit-and-next"===b?1:-1))%g+g)%g))}};this._handleTab=a=>{if(a.code===C.tooltipKeys.next){var b=this._getFocusableElements(),c=b.at(0);b=b.at(-1);c&&b&&(a.shiftKey?document.activeElement===c&&(a.preventDefault(),n(b)):document.activeElement===b&&(a.preventDefault(),n(c)))}}}get mode(){return this._mode}get _displayUnits(){const a=u.getDefaultUnitForView(this.tooltip.view);
return{length:a,verticalLength:a,area:a,angle:"degrees"}}get _inputUnitInfos(){const a=this._messagesUnits;var b=p=>({unit:p,abbreviation:A.unitName(a,p,"abbr")}),c=u.getDefaultUnitForView(this.tooltip.view);const g=b(r.defaultLengthUnit(c)),l=b(r.defaultVerticalLengthUnit(c));c=b(r.defaultAreaUnit(c));b=b("degrees");return{length:g,lengthRelative:g,verticalLength:l,verticalLengthRelative:l,area:c,direction:b,orientation:b,rotation:b,longitudeLatitude:b}}get _formatters(){return this._getFormatters(this._messagesUnits,
this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const {visibleElements:a}=this.info.sketchOptions.tooltips,b=this._renderedContent,c=this._renderedActions,g=this._renderedHelpMessage,l=0<b.length,p=l||!!g,x="input"===this.mode;return k.tsx("div",{class:G.classes(h.content,x&&h.contentInputMode),onkeydown:this._handleTab},
x&&p&&a.header?k.tsx("div",{class:h.contentHeader,key:"header"},k.tsx("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),0<c.length?k.tsx(k.tsxFragment,null,k.tsx("div",{class:h.contentHeaderSpacer,key:"spacer"}),k.tsx("div",{class:h.contentHeaderActions,key:"actions"},c)):null):null,l?k.tsx("div",{class:h.table,key:"content"},...b):null,g)}_renderActions(){return null}loadDependencies(){return F.loadCalciteComponents({button:()=>
new Promise((a,b)=>q(["../../../../chunks/calcite-button"],a,b)),icon:()=>new Promise((a,b)=>q(["../../../../chunks/calcite-icon"],a,b)),input:()=>new Promise((a,b)=>q(["../../../../chunks/calcite-input"],a,b))})}async enterInputMode(a){try{await this._transitionTo("input"),await this._focusField(a)}catch(b){m.throwIfNotAbortError(b)}}async exitInputMode({focusOnView:a=!0}={}){try{const {container:b,info:c}=this;c.clearInputValues();a=a?b?.closest(".esri-view")?.querySelector(".esri-view-surface"):
null;await this._transitionTo("feedback");a instanceof HTMLElement&&a.focus()}catch(b){m.throwIfNotAbortError(b)}}get _renderedContent(){return w(this._renderContent())}get _renderedActions(){return w(this._renderActions())}get _renderedHelpMessage(){const {sketchOptions:a,visibleElements:b}=this.info;if(!b.helpMessage)return null;const c=a.tooltips.helpMessage??this._defaultHelpMessage;if(!c)return null;const g=a.tooltips.helpMessageIcon??"information";return k.tsx("div",{class:h.helpMessage,key:"help-message"},
g?k.tsx("calcite-icon",{class:h.helpMessageIcon,icon:g,scale:"s"}):null,k.tsx("div",{class:h.helpMessageText},c))}get _defaultHelpMessage(){const {helpMessage:a,viewType:b}=this.info;return null==a?null:this._messagesTooltip?.sketch?.["3d"===b?"helpMessages3d":"helpMessages2d"]?.[a]}async _focusField(a){this._focusAbortController?.abort();this._focusAbortController=new AbortController;var {signal:b}=this._focusAbortController;await this._waitForInputs();m.throwIfAborted(b);b=this._getFocusableInputs();
b=a?b.find(c=>c.getAttribute("data-field-name")===a):b.at(0);await n(b)}async _transitionTo(a){if(this._mode!==a){var b=()=>{this._mode=a};if(this.domNode?.firstChild&&document.startViewTransition&&!y.prefersReducedMotion()){this.autoRenderingEnabled=!1;this._transition?.skipTransition();var c=this._transition=document.startViewTransition(()=>{if(!this.destroyed)return this.autoRenderingEnabled=!0,b(),this.renderNow(),t.waitTick()});try{await this._transition.finished}finally{c===this._transition&&
(this._transition=null)}}else b()}}async _waitForInputs(){const a=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===a().length;)await m.after(20);await t.waitAnimationFrame()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const a=this.domNode?.querySelector(`.${h.drawContentHeaderActions}`);return[...Array.from(a?.querySelectorAll(`.${h.contentHeaderActions} calcite-button:not([disabled])`)??
[]),...this._getFocusableInputs()]}};e.__decorate([v.messageBundle("esri/core/t9n/Units"),f.property()],d.TooltipContent.prototype,"_messagesUnits",void 0);e.__decorate([v.messageBundle("esri/views/interactive/tooltip/t9n/Tooltip"),f.property()],d.TooltipContent.prototype,"_messagesTooltip",void 0);e.__decorate([f.property()],d.TooltipContent.prototype,"info",void 0);e.__decorate([f.property()],d.TooltipContent.prototype,"tooltip",void 0);e.__decorate([f.property()],d.TooltipContent.prototype,"_mode",
void 0);e.__decorate([f.property()],d.TooltipContent.prototype,"mode",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_displayUnits",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_inputUnitInfos",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_formatters",null);e.__decorate([f.property()],d.TooltipContent.prototype,"fieldContext",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_renderedContent",null);e.__decorate([f.property()],d.TooltipContent.prototype,
"_renderedActions",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_renderedHelpMessage",null);e.__decorate([f.property()],d.TooltipContent.prototype,"_defaultHelpMessage",null);d.TooltipContent=e.__decorate([B.subclass("esri.views.interactive.tooltip.content.TooltipContent")],d.TooltipContent);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});