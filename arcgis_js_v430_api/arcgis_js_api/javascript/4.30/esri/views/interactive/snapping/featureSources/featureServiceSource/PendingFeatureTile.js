// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],function(b,e,f){class h{constructor(a,d){this.data=a;this.resolution=d;this.state={type:b.StateType.CREATED};this.alive=!0}process(a){switch(this.state.type){case b.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,a),this.state.task.promise.then(a.resume,a.resume);case b.StateType.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,a),this.state.task.promise.then(a.resume,
a.resume);case b.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,a)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case b.StateType.CREATED:case b.StateType.FETCH_COUNT:return 0;case b.StateType.FETCHED_COUNT:return this.state.featureCount;case b.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case b.StateType.FETCHED_FEATURES:return this.state.features.length;
case b.StateType.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case b.StateType.CREATED:return"created";case b.StateType.FETCH_COUNT:return"fetch-count";case b.StateType.FETCHED_COUNT:return"fetched-count";case b.StateType.FETCH_FEATURES:return"fetch-features";case b.StateType.FETCHED_FEATURES:return"fetched-features";case b.StateType.DONE:return"done"}}_gotoFetchCount(a,d){return{type:b.StateType.FETCH_COUNT,previous:a,task:e.createTask(async c=>{c=
await e.resultOrAbort(d.fetchCount(this,c));this.state.type===b.StateType.FETCH_COUNT&&(this.state={type:b.StateType.FETCHED_COUNT,featureCount:c.ok?c.value:Infinity,previous:this.state})})}}_gotoFetchFeatures(a,d){return{type:b.StateType.FETCH_FEATURES,previous:a,task:e.createTask(async c=>{c=await e.resultOrAbort(d.fetchFeatures(this,a.featureCount,c));this.state.type===b.StateType.FETCH_FEATURES&&(this.state={type:b.StateType.FETCHED_FEATURES,previous:this.state,features:c.ok?c.value:[]})})}}_goToDone(a,
d){d.finish(this,a.features);return{type:b.StateType.DONE,previous:a}}reset(){const a=this.state;this.state={type:b.StateType.CREATED};switch(a.type){case b.StateType.FETCH_COUNT:case b.StateType.FETCH_FEATURES:a.task.abort()}}intersects(a){if(null==a||!this.data.extent)return!0;f.fromExtent(a,g);return f.intersects(this.data.extent,g)}}b.StateType=void 0;(function(a){a[a.CREATED=0]="CREATED";a[a.FETCH_COUNT=1]="FETCH_COUNT";a[a.FETCHED_COUNT=2]="FETCHED_COUNT";a[a.FETCH_FEATURES=3]="FETCH_FEATURES";
a[a.FETCHED_FEATURES=4]="FETCHED_FEATURES";a[a.DONE=5]="DONE"})(b.StateType||(b.StateType={}));const g=f.create();b.PendingFeatureTile=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});