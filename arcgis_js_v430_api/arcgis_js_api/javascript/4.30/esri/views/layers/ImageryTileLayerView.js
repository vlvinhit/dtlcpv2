// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/timeSupport ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(e,t,u,h,B,C,D,v,w,m,x){return c=>{c=class extends c{constructor(){super(...arguments);this._rasterFieldPrefix="Raster.";this.tileInfo=this.view=this.layer=null}get fullExtent(){return this._getfullExtent()}get timeExtent(){return w.combineTimeExtent(this.layer,
this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return m.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(b){return!!m.projectDatasetExtent(this.layer.serviceRasterInfo,b)}async fetchPopupFeaturesAtLocation(b,d){const {layer:a}=this;if(!b)throw new u("imageryTileLayerView:fetchPopupFeatures",
"Nothing to fetch without area",{layer:a});var {popupEnabled:k}=a,f=x.getFetchPopupTemplate(a,d);if(!k||null==f)return[];k=[];const {value:l,magdirValue:q,processedValue:y}=await a.identify(b,{timeExtent:this.timeExtent,signal:d?.signal});d="";if(l?.length){d="imagery-tile"===a.type&&a.hasStandardTime()&&null!=l[0]?l.map(n=>a.getStandardTimeValue(n)).join(", "):l.join(", ");b={ObjectId:0};b["Raster.ServicePixelValue"]="imagery-tile"===a.type&&"Function"===a.raster.datasetFormat?y?.join(", "):d;b["Raster.ServicePixelValue.Raw"]=
d;d=a.raster?.rasterInfo??a.serviceRasterInfo;f=d?.attributeTable;if(null!=f){const {fields:n,features:z}=f,r=n.find(({name:p})=>"value"===p.toLowerCase()),A=b["Raster.ServicePixelValue"];if(f=r?z.find(p=>String(p.attributes[r.name])===A):null)for(var g in f.attributes)f.attributes.hasOwnProperty(g)&&(b[this._rasterFieldPrefix+g]=f.attributes[g])}g=d?.dataType;if("vector-magdir"===g||"vector-uv"===g)b["Raster.Magnitude"]=q?.[0],b["Raster.Direction"]=q?.[1];g=new t({geometry:this.fullExtent.clone(),
attributes:b,layer:a,sourceLayer:a});k.push(g)}return k}_getfullExtent(){return m.projectDatasetExtent(this.layer.serviceRasterInfo,this.view.spatialReference)}};e.__decorate([h.property()],c.prototype,"fullExtent",null);e.__decorate([h.property()],c.prototype,"layer",void 0);e.__decorate([h.property({readOnly:!0})],c.prototype,"timeExtent",null);e.__decorate([h.property()],c.prototype,"view",void 0);e.__decorate([h.property()],c.prototype,"tileInfo",void 0);e.__decorate([h.property({readOnly:!0})],
c.prototype,"hasTilingEffects",null);e.__decorate([h.property()],c.prototype,"datumTransformation",null);return c=e.__decorate([v.subclass("esri.views.layers.ImageryTileLayerView")],c)}});