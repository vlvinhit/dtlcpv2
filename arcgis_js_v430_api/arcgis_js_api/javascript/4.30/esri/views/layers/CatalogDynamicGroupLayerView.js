// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Collection ../../core/handleUtils ../../core/Logger ../../core/promiseUtils ../../core/sql ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(d,v,r,w,t,m,f,B,C,x){const h=Symbol();return b=>{b=class extends b{constructor(){super(...arguments);this.layerViews=new v;this._debouncedUpdate=t.debounce(async()=>{const {layer:a,parent:c}=this;var e=c?.footprintLayerView;
let g=[];const k=this._createQuery();k&&e&&({features:e}=await e.queryFeatures(k),this.suspended||(g=e.map(n=>a.acquireLayer(n))));this.removeHandles(h);this.addHandles(g,h)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(a=>a.updating)}enableLayerUpdates(){return r.handlesGroup([this._updatingHandles.addWhen(()=>!1===this.parent?.footprintLayerView?.dataUpdating,
()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),r.makeHandle(()=>this.removeHandles(h))])}updateLayers(){this.suspended?this.removeHandles(h):this._updatingHandles.addPromise(t.ignoreAbortErrors(this._debouncedUpdate()).catch(a=>{w.getLogger(this).error(a)}))}_createQuery(){var a=this.parent?.footprintLayerView,
c=this.layer?.parent;if(!a||!c||c.destroyed)return null;const {layer:{maximumVisibleSublayers:e},view:{scale:g}}=this;if(!e)return null;const {itemTypeField:k,itemSourceField:n,itemNameField:y,minScaleField:p,maxScaleField:u,objectIdField:z,orderBy:A}=c;var q=m.sqlAnd(`${p} IS NULL OR ${g} <= ${p} OR ${p} = 0`,`${u} IS NULL OR ${g} >= ${u}`);c=A?.find(l=>l.field&&!l.valueExpression);a=a.createQuery();a.returnGeometry=!1;a.num=e;a.outFields=[z,n,y];a.where=m.sqlAnd(a.where,q);null!=this.unsupportedItemTypes&&
(q=`${k} NOT IN (${this.unsupportedItemTypes.map(l=>`'${l}'`)})`,a.where=m.sqlAnd(a.where,q));c?.field&&(a.orderByFields=[`${c.field} ${"descending"===c.order?"DESC":"ASC"}`],a.outFields.push(c.field));return a}};d.__decorate([f.property({readOnly:!0})],b.prototype,"creatingLayerViews",null);d.__decorate([f.property()],b.prototype,"layer",void 0);d.__decorate([f.property()],b.prototype,"layerViews",void 0);d.__decorate([f.property({readOnly:!0})],b.prototype,"unsupportedItemTypes",void 0);d.__decorate([f.property()],
b.prototype,"parent",void 0);d.__decorate([f.property({readOnly:!0})],b.prototype,"isUpdating",null);return b=d.__decorate([x.subclass("esri.views.layers.CatalogDynamicGroupLayerView")],b)}});