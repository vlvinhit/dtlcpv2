// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../renderers/support/AuthoringInfo ../../renderers/support/ClassBreakInfo ../../renderers/visualVariables/support/SizeStop ../../renderers/visualVariables/support/visualVariableUtils ./color ./size ./support/utils ../support/binningUtils ../support/utils ../support/adapters/support/layerUtils ../symbology/support/aboveAndBelowUtils ../../symbols/support/cimSymbolUtils ../../symbols/support/Symbol3DMaterial".split(" "),function(v,n,H,z,m,t,A,w,u,B,y,q,I,J,K){async function L(a){if(!a?.layer||
!(a.field||a.valueExpression||a.sqlExpression))throw new n("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new n("univariate-colorsize-visual-variables:missing-parameters","View is required when 'valueExpression' is specified");if("above-and-below"===a.theme&&a.sizeOptions?.sizeOptimizationEnabled)throw new n("univariate-colorsize-visual-variables:invalid-parameters",
"sizeOptimizationEnabled cannot be true for 'above-and-below' theme");a.forBinning&&B.verifyBinningParams(a,"univariate-colorsize-visual-variables");const b={...a,layer:a.layer};var c=a.forBinning?q.binningCapableLayerTypes:q.featureCapableLayerTypes;a=q.createLayerAdapter(b.layer,c,a.forBinning);if(!a)throw new n("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+q.getLayerTypeLabels(c).join(", "));b.layer=a;b.theme=b.theme||b.colorOptions?.theme?b.theme:
"high-to-low";await a.load(null!=b.signal?{signal:b.signal}:null);c=await y.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});if(c=u.verifyBasicFieldValidity(a,c,"univariate-colorsize-visual-variables:invalid-parameters"))throw c;return b}async function M(a){if(!a?.layer||!(a.field||a.valueExpression||a.sqlExpression))throw new n("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new n("univariate-colorsize-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a.forBinning&&B.verifyBinningParams(a,"univariate-colorsize-continuous-renderer");const b={...a,layer:a.layer};b.symbolType=b.symbolType||"2d";b.colorOptions||(b.colorOptions={});b.colorOptions.isContinuous=b.colorOptions.isContinuous??!1;var c=a.forBinning?q.binningCapableLayerTypes:q.featureCapableLayerTypes;a=q.createLayerAdapter(b.layer,
c,a.forBinning);if(!a)throw new n("univariate-colorsize-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+q.getLayerTypeLabels(c).join(", "));b.layer=a;await a.load(null!=b.signal?{signal:b.signal}:null);if("above-and-below"===b.theme&&b.symbolOptions){if(b.symbolType.includes("3d-volumetric"))throw new n("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' is applicable for '2d' and '3d-flat' 'symbolType' only");if("point"!==a.geometryType&&
"polygon"!==a.geometryType)throw new n("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' only apply to layers with 'point' or 'polygon' geometryType");}c=await y.getFieldsList({field:b.field,normalizationField:b.normalizationField,valueExpression:b.valueExpression});if(c=u.verifyBasicFieldValidity(a,c,"univariate-colorsize-continuous-renderer:invalid-parameters"))throw c;return b}function C(a,b){"type"in a&&"cim"===a.type?J.applyCIMSymbolColor(a,b):"type"in a&&a.type.includes("3d")?
a.symbolLayers.forEach(c=>{"material"in c&&null!=c.material&&"color"in c.material&&(c.material?c.material.color=b:c.material=new K.Symbol3DMaterial({color:b}))}):"color"in a&&(a.color=b)}function D(a,b,c=!0){const d=b?.authoringInfo?.clone(),e=d?.visualVariables?.some(f=>"reference-size"===f.theme)?[]:b.size.visualVariables.map(f=>f.clone());c?e.push(b.color.visualVariable.clone()):d.visualVariables=d.visualVariables?.filter(f=>"size"===f.type);e.push(...a.visualVariables.filter(f=>"target"in f&&
"outline"===f.target).map(f=>f.clone()));a.authoringInfo=d;a.visualVariables=e}async function N(a,b,c,d){const e=b[0];b=b[1];const f=Math.round((b-e)/2)+e,k=a.clone();k.stops=[new m({value:c[0],size:b}),new m({value:c[1],size:f}),new m({value:c[2],size:e}),new m({value:c[3],size:f}),new m({value:c[4],size:b})];a.stops=[new m({value:d[0],size:t.getSize(k,d[0])}),new m({value:d[1],size:t.getSize(k,d[1])}),new m({value:d[2],size:t.getSize(k,d[2])}),new m({value:d[3],size:t.getSize(k,d[3])}),new m({value:d[4],
size:t.getSize(k,d[4])})]}async function O(a,b,c,d,e){a=a.find(g=>"width-and-depth"!==g.axis&&!g.target);const f="number"===typeof a?.minSize?a?.minSize:null,k="number"===typeof a?.maxSize?a?.maxSize:null;if(null!=a?.minDataValue&&null!=f&&null!=k)if(d)if("above-and-below"===d){a.minDataValue=null;a.maxDataValue=null;a.minSize=null;a.maxSize=null;d=u.createStopValuesForAboveBelow(c,e);const g=u.clampAboveAndBelowStopValues(d,c);await N(a,[f,k],d,g);b.stops.forEach((l,h)=>l.value=g[h])}else{const {minDataValue:g,
maxDataValue:l}=a,h=u.createDefaultStopValues(g,l,5);b.stops.forEach((r,p)=>r.value=h[p]);a.minDataValue=h[0];a.maxDataValue=h[h.length-1]}else a.minDataValue=b.stops[0].value,a.maxDataValue=b.stops[b.stops.length-1].value}async function E(a){var b=await L(a),c=A.createVisualVariable,d={...b},e=d.colorOptions,f=d.theme||e?.theme,k=d.legendOptions||d.colorOptions?.legendOptions;delete d.sizeOptions;delete d.colorOptions;c=await c.call(A,{...d,...e,statistics:d.statistics,theme:f,legendOptions:k});
const {visualVariable:g,statistics:l}=c;d=w.createVisualVariables;e={...b};const {sizeOptions:h,theme:r}=e;f=e.legendOptions||e.sizeOptions?.legendOptions;delete e.sizeOptions;delete e.colorOptions;d=await d.call(w,{...e,...h,statistics:l||e.statistics,theme:"above-and-below"===r?null:r,legendOptions:f});var p=d.visualVariables;e=a.layer;a=a.field?e.getField(a.field):null;await O(p,g,l,b.theme,y.isAnyDateField(a));a=d.basemapId;e=d.basemapTheme;f=c.defaultValuesUsed;k={visualVariable:g,colorScheme:c.colorScheme};
p={visualVariables:p,sizeScheme:d.sizeScheme};const {theme:x,minValue:P,maxValue:Q}=b;b=c.authoringInfo.visualVariables[0].clone();d=d.authoringInfo.visualVariables[0].clone();({stops:c}=c.visualVariable);"above-and-below"===x?(b.minSliderValue=d.minSliderValue=P??c[0].value,b.maxSliderValue=d.maxSliderValue=Q??c.at(-1)?.value,d.theme="above-and-below"):x&&"high-to-low"!==x||"reference-size"!==d.theme||2!==d.sizeStops?.length||(d.sizeStops[0].value=c[0].value,d.sizeStops[1].value=c.at(-1)?.value);
b=new H({type:"univariate-color-size",univariateTheme:x,visualVariables:[b,d]});return{basemapId:a,basemapTheme:e,statistics:l,defaultValuesUsed:f,color:k,size:p,authoringInfo:b}}async function F(a){a=await M(a);var b=w.createContinuousRenderer,c={...a},d={...c.sizeOptions};delete c.sizeOptions;delete c.colorOptions;delete d.sizeOptimizationEnabled;const {renderer:e,statistics:f,defaultValuesUsed:k}=await b.call(w,{...c,...d});b={...a};c=b.symbolType;d=!!c?.includes("3d-volumetric");delete b.symbolType;
delete b.defaultSymbolEnabled;if(b.worldScale=d)b.sizeOptions={...b.sizeOptions},b.sizeOptions.axis="3d-volumetric-uniform"===c?"all":"height";b.statistics=f;b=await E(b);if("above-and-below"===a.theme){var g=a.symbolOptions,l=a.layer;c=g?.symbols?"custom":g?.symbolStyle;var h=a.colorOptions?.isContinuous;D(e,b,h);if(c||!h){d=b.size.visualVariables[0].stops;l=l.geometryType;!g?.symbolStyle&&!g?.symbols||"point"!==l&&"polygon"!==l?(g=e.classBreakInfos[0].symbol,g={above:g.clone(),below:g.clone()}):
g=g.symbols||I.getAboveAndBelowSymbols(g.symbolStyle);const {above:r,below:p}=g;h||(h=b.color.colorScheme.colors,g=h[0],C(r,h[h.length-1]),C(p,g));e.classBreakInfos=[new z({minValue:-G,maxValue:d[2].value,symbol:p}),new z({minValue:d[2].value,maxValue:G,symbol:r})];c&&e.authoringInfo&&(e.authoringInfo.univariateSymbolStyle=c)}}else D(e,b);return{renderer:e,statistics:f,defaultValuesUsed:k,color:a.colorOptions?.isContinuous||"above-and-below"!==a.theme?b.color:null,size:b.size,basemapId:b.basemapId,
basemapTheme:b.basemapTheme}}const G=2**53-1;v.createContinuousRenderer=async function(a){return F(a)};v.createRenderer=F;v.createVisualVariables=E;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});