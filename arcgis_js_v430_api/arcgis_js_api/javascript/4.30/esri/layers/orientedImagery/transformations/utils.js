// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry ../../../core/mathUtils ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../geometry/projection ../../../geometry/support/Ellipsoid ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../widgets/PanoramicViewer/constants ../../../geometry/Point".split(" "),function(k,I,n,C,r,p,
t,u,D,E,F,v,G){function w(b,a,g,e,d,h,c,f,l){let m=!1;0===a.z&&0===g.z&&0===e.z&&0===d.z&&(a.z=g.z=e.z=d.z=1,b.z=1);a.z=a.z??1;g.z=g.z??1;e.z=e.z??1;d.z=d.z??1;0===h.z&&0===c.z&&0===f.z&&0===l.z&&(m=!0,h.z=c.z=f.z=l.z=1);h.z=h.z??1;c.z=c.z??1;f.z=f.z??1;l.z=l.z??1;a=q(a,g,e,d);c=q(h,c,f,l);f=t.invertOrIdentity(r.create(),a);h=r.create();h[0]=c[0]*f[0]+c[1]*f[4]+c[2]*f[8]+c[3]*f[12];h[1]=c[0]*f[1]+c[1]*f[5]+c[2]*f[9]+c[3]*f[13];h[2]=c[0]*f[2]+c[1]*f[6]+c[2]*f[10]+c[3]*f[14];h[3]=c[0]*f[3]+c[1]*f[7]+
c[2]*f[11]+c[3]*f[15];h[4]=c[4]*f[0]+c[5]*f[4]+c[6]*f[8]+c[7]*f[12];h[5]=c[4]*f[1]+c[5]*f[5]+c[6]*f[9]+c[7]*f[13];h[6]=c[4]*f[2]+c[5]*f[6]+c[6]*f[10]+c[7]*f[14];h[7]=c[4]*f[3]+c[5]*f[7]+c[6]*f[11]+c[7]*f[15];h[8]=c[8]*f[0]+c[9]*f[4]+c[10]*f[8]+c[11]*f[12];h[9]=c[8]*f[1]+c[9]*f[5]+c[10]*f[9]+c[11]*f[13];h[10]=c[8]*f[2]+c[9]*f[6]+c[10]*f[10]+c[11]*f[14];h[11]=c[8]*f[3]+c[9]*f[7]+c[10]*f[11]+c[11]*f[15];h[12]=c[12]*f[0]+c[13]*f[4]+c[14]*f[8]+c[15]*f[12];h[13]=c[12]*f[1]+c[13]*f[5]+c[14]*f[9]+c[15]*f[13];
h[14]=c[12]*f[2]+c[13]*f[6]+c[14]*f[10]+c[15]*f[14];h[15]=c[12]*f[3]+c[13]*f[7]+c[14]*f[11]+c[15]*f[15];c=h[0]*b.x+h[1]*b.y+h[2]*b.z+h[3];f=h[4]*b.x+h[5]*b.y+h[6]*b.z+h[7];l=h[8]*b.x+h[9]*b.y+h[10]*b.z+h[11];b=h[12]*b.x+h[13]*b.y+h[14]*b.z+h[15];0===b&&(b=1);return{x:c/b,y:f/b,z:m?0:l/b}}function q(b,a,g,e){var d=x([e.x,e.y,e.z,1],t.invertOrIdentity(Array(16),[b.x,a.x,g.x,0,b.y,a.y,g.y,0,b.z,a.z,g.z,0,1,1,1,1]));e=d[0];const h=d[1];d=d[2];const c=Array(16);c[0]=e*b.x;c[1]=h*a.x;c[2]=d*g.x;c[3]=0;
c[4]=e*b.y;c[5]=h*a.y;c[6]=d*g.y;c[7]=0;c[8]=e*b.z;c[9]=h*a.z;c[10]=d*g.z;c[11]=0;c[12]=e;c[13]=h;c[14]=d;c[15]=1;return c}function x(b,a){const [g,e,d,h]=b;b=Array(4);b[0]=g*a[0]+e*a[1]+d*a[2]+h*a[3];b[1]=g*a[4]+e*a[5]+d*a[6]+h*a[7];b[2]=g*a[8]+e*a[9]+d*a[10]+h*a[11];b[3]=g*a[12]+e*a[13]+d*a[14]+h*a[15];return b}function y(b,a){const g=Math.PI/180,e=Number(b.x);var d=a[0]*g;const h=a[1]*g;var c=a[2]/Math.sqrt(1-a[3]*Math.sin(d)**2),f=Number(b.y)/c,l=Number(b.z)/c;b=Math.cos(d)-Math.sin(d)*f+Math.cos(d)*
l;f=Math.sin(d)+Math.cos(d)*f+Math.sin(d)*l;l=Math.sqrt(b**2+(e/c)**2);const m=a[3]*c*Math.sin(d);d=Math.atan(f/l-(m-a[2]/Math.sqrt(1-a[3]*Math.sin(d)**2)*a[3]*Math.sin(d))/(c*l));d=Math.atan(f/l-(m-a[2]/Math.sqrt(1-a[3]*Math.sin(d)**2)*a[3]*Math.sin(d))/(c*l));d=Math.atan(f/l-(m-a[2]/Math.sqrt(1-a[3]*Math.sin(d)**2)*a[3]*Math.sin(d))/(c*l));d=Math.atan(f/l-(m-a[2]/Math.sqrt(1-a[3]*Math.sin(d)**2)*a[3]*Math.sin(d))/(c*l));c=Math.atan(e/(c*b))+h;return{x:c/g,y:d/g,z:e/(Math.cos(d)*Math.sin(c-h))-a[2]/
Math.sqrt(1-a[3]*Math.sin(d)**2),spatialReference:{wkid:4326}}}function z(b,a,g,e){return{x:g/2+b/(360/g),y:e-a/(180/e),heading:b,pitch:a}}function A(b,a){a=n.rad2deg(Math.acos(-b.z/a));return{heading:n.rad2deg(Math.atan2(b.x,b.y)),pitch:a}}function B(b){return 4===b?.type}k.calculateRotationMatrix=function(b,a){const g=Math.PI/180,e=C.create();if("OPK"===b){b=Number(a[0])*g;var d=Number(a[1])*g;a=Number(a[2])*g;e[0]=Math.cos(d)*Math.cos(a);e[1]=Math.cos(b)*Math.sin(a)+Math.sin(b)*Math.sin(d)*Math.cos(a);
e[2]=Math.sin(b)*Math.sin(a)-Math.cos(b)*Math.sin(d)*Math.cos(a);e[3]=-Math.cos(d)*Math.sin(a);e[4]=Math.cos(b)*Math.cos(a)-Math.sin(b)*Math.sin(d)*Math.sin(a);e[5]=Math.sin(b)*Math.cos(a)+Math.cos(b)*Math.sin(d)*Math.sin(a);e[6]=Math.sin(d);e[7]=-Math.sin(b)*Math.cos(d);e[8]=Math.cos(b)*Math.cos(d)}else b=Number(a[0])*g,d=Number(a[1])*g,a=Number(a[2])*g,e[0]=Math.cos(b)*Math.cos(a)-Math.sin(b)*Math.cos(d)*Math.sin(a),e[1]=-1*Math.sin(b)*Math.cos(a)-Math.cos(b)*Math.cos(d)*Math.sin(a),e[2]=-1*Math.sin(a)*
Math.sin(d),e[3]=Math.cos(b)*Math.sin(a)+Math.sin(b)*Math.cos(d)*Math.cos(a),e[4]=-1*Math.sin(b)*Math.sin(a)+Math.cos(b)*Math.cos(d)*Math.cos(a),e[5]=Math.cos(a)*Math.sin(d),e[6]=-1*Math.sin(b)*Math.sin(d),e[7]=-1*Math.cos(b)*Math.sin(d),e[8]=Math.cos(d);return e};k.computeHFOVAndVFOV=function(b,a,g){const e=Math.sin(g*Math.PI/180),d=Math.cos(g*Math.PI/180),h=[[b,0],[b,a],[0,a]];h.forEach((c,f)=>{h[f]=[d*c[0]-e*c[1],e*c[0]+d*c[1]]});return{hfov:Math.abs(Math.max(0,h[0][0],h[1][0],h[2][0])-Math.min(0,
h[0][0],h[1][0],h[2][0])),vfov:Math.abs(Math.max(0,h[0][1],h[1][1],h[2][1])-Math.min(0,h[0][1],h[1][1],h[2][1]))}};k.convertHeadingPitchToSphereVertex=function(b,a,g=v.defaultImageSphereSize/2){const e=Math.sin(n.deg2rad(b))*Math.sin(n.deg2rad(a));b=Math.cos(n.deg2rad(b))*Math.sin(n.deg2rad(a));a=Math.cos(n.deg2rad(180-a));return[g*e,g*b,g*a]};k.convertOrientationToPixelLocation=z;k.convertPixelToHeadingPitch=function(b,a,g){return{heading:360/a*(b.x-a/2),pitch:90-180/g*(b.y-g/2)}};k.convertSphereVertexToOrientation=
A;k.convertSphereVertexToPixelLocation=function(b,a,g,e=v.defaultImageSphereSize/2){const {heading:d,pitch:h}=A(b,e);return z(d,h,a,g)};k.geographicToLTP=function(b,a){var g=Math.PI/180;const e=b.y*g,d=b.z||0,h=a[0]*g,c=a[2]/Math.sqrt(1-a[3]*Math.sin(h)**2);b=b.x*g-a[1]*g;g=a[2]/Math.sqrt(1-a[3]*Math.sin(e)**2);a=a[3]*(c*Math.sin(h)-g*Math.sin(e));return{x:(g+d)*Math.cos(e)*Math.sin(b),y:(g+d)*(Math.sin(e)*Math.cos(h)-Math.sin(h)*Math.cos(e)*Math.cos(b))+a*Math.cos(h),z:(g+d)*(Math.sin(e)*Math.sin(h)+
Math.cos(h)*Math.cos(e)*Math.cos(b))-c+a*Math.sin(h)}};k.getCameraLocationWhenCameraOrientation=function(b,a){const g=B(a);let e=b;if(g){const {latitude:d,longitude:h,ellipsoidRadius:c,squaredEccentricity:f}=a;e=new G(y(b,[d,h,c,f]))}e.spatialReference.isWGS84&&(e=F.geographicToWebMercator(e));return e};k.getInitialAngle=async function(b,a,g){await u.initializeProjection(a.spatialReference,b.spatialReference,null,g);a=await u.projectWithZConversion(a,b.spatialReference,g);b=n.rad2deg(Math.atan2(a.y-
b.y,a.x-b.x));return b=0<=b&&90>=b?90-b:90<b&&180>=b?360-b+90:90+Math.abs(b)};k.getPlaneLineIntersectionPoint=function(b,a,g,e,d,h){const c=g*(a.x-b.x)+e*(a.y-b.y)+d*(a.z-b.z);if(0===c)return null;g=-(g*b.x+e*b.y+d*b.z+h)/c;return{x:b.x+g*(a.x-b.x),y:b.y+g*(a.y-b.y),z:b.z+g*(a.z-b.z)}};k.getWebMercatorScalingFactor=function(b){return b&&E.isWebMercator(b?.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*b.y/D.earth.radius))):1};k.hasCameraOrientationLTP=B;k.linearEquationSolve=q;k.ltpToGeographic=
y;k.projectiveTransform=w;k.projectiveTransform2=function(b,a,g){const [e,d,h,c]=a,[f,l,m,H]=g;return w(b,e,d,h,c,f,l,m,H)};k.rotatePixel=function(b,a,g){const e=Math.cos(g);g=Math.sin(g);const d=[1,0,0,1,0,0],h=d[1]*e+d[3]*g,c=-d[0]*g+d[2]*e,f=-d[1]*g+d[3]*e;d[0]=d[0]*e+d[2]*g;d[1]=h;d[2]=c;d[3]=f;return[b*d[0]+a*d[2]+d[4],b*d[1]+a*d[3]+d[5]]};k.scaleAndAddWithFactor=function(b,a,g,e,d=p.zeros()){d[0]=b[0]+a[0]*g;d[1]=b[1]+a[1]*g;d[2]=b[2]+g/e*a[2];return d};k.scaleWithFactor=function(b,a,g){const e=
p.zeros();e[0]=b[0]*a;e[1]=b[1]*a;e[2]=a/g*b[2];return e};k.transformMat3=function(b,a){const [g,e,d]=b;b=p.zeros();b[0]=g*a[0]+e*a[3]+d*a[6];b[1]=g*a[1]+e*a[4]+d*a[7];b[2]=g*a[2]+e*a[5]+d*a[8];return b};k.transformMat4=x;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});