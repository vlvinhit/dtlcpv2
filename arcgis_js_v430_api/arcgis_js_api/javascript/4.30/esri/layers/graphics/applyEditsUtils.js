// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../Graphic ../../core/Error ../../core/Logger ../../core/unitUtils ../../core/urlUtils ../../geometry/projection ../../geometry/support/jsonUtils ../../geometry/support/MeshTransform ../../geometry/support/spatialReferenceUtils ./editingSupport".split(" "),function(f,y,z,u,v,A,q,B,C,D,w){async function x(b,a){const {feature:c,attachment:d}=a,{globalId:e,name:m,contentType:g,data:k,uploadId:l}=d;a={globalId:e};c&&("attributes"in c?a.parentGlobalId=c.attributes?.[b.globalIdField]:
c.globalId&&(a.parentGlobalId=c.globalId));if(l)a.uploadId=l;else if(k){if(b=await A.parseData(k))a.contentType=b.mediaType,a.data=b.data;k instanceof File&&(a.name=k.name)}m&&(a.name=m);g&&(a.contentType=g);return a}function h(b){const a=!0===b.success?null:b.error||{code:void 0,description:void 0};return{objectId:b.objectId,globalId:b.globalId,error:a?new z("feature-layer-source:edit-failure",a.description,{code:a.code}):null}}function n(b,a){return new y({attributes:b.attributes,geometry:B.fromJSON({...b.geometry,
spatialReference:a})})}f.createEditedFeatures=function(b,a){return{adds:b?.adds?.map(c=>n(c,a))||[],updates:b?.updates?.map(c=>({original:n(c[0],a),current:n(c[1],a)}))||[],deletes:b?.deletes?.map(c=>n(c,a))||[],spatialReference:a}};f.createFeatureEditResult=h;f.getAttachmentEditsJSON=async function(b,a){const c=await Promise.all((a.addAttachments??[]).map(e=>x(b,e))),d=await Promise.all((a.updateAttachments??[]).map(e=>x(b,e)));a=a.deleteAttachments??[];return c.length||d.length||a.length?{adds:c,
updates:d,deletes:[...a]}:null};f.getFeatureIds=function(b,a,c){if(!a||0===a.length)return[];if(c&&w.isFeatureIdentifierArrayWithGlobalId(a))return a.map(e=>e.globalId);if(w.isFeatureIdentifierArrayWithObjectId(a))return a.map(e=>e.objectId);const d=c?b.globalIdField:b.objectIdField;return d?a.map(e=>e.getAttribute(d)):[]};f.getFeatureJSON=async function(b,a,c){var {geometry:d}=a;a={...a.attributes};if(null!=c&&"mesh"===d?.type){({transformFieldRoles:c}=c);const {origin:m,spatialReference:g,vertexSpace:k}=
d;d=d.transform??new C;const l="local"===k.type;b=b.spatialReference;var e=b.isGeographic;const E=D.equals(b,g),F=q.isEqualBaseGCS(g,b)&&q.canProjectWithoutEngine(g,b);if(!(l&&e&&F||!l&&!e&&E))return null;e=q.projectWithoutEngine(m,g,b);if(null==e)return null;a[c.originX]=e.x;a[c.originY]=e.y;a[c.originZ]=e.z??0;if(null!=d){const {translation:r,scale:t,rotation:p}=d;d=l?1:v.getMetersPerCartesianUnitForSR(g)/v.getMetersPerCartesianUnitForSR(b);a[c.translationX]=r[0]*d;a[c.translationY]=r[2]*d;a[c.translationZ]=
-r[1]*d;a[c.scaleX]=t[0];a[c.scaleY]=t[2];a[c.scaleZ]=t[1];a[c.rotationX]=p[0];a[c.rotationY]=p[2];a[c.rotationZ]=-p[1];a[c.rotationDeg]=p[3]}return{attributes:a}}return null==d?{attributes:a}:"mesh"===d.type||"extent"===d.type?null:{geometry:d.toJSON(),attributes:a}};f.isProtectedOrPrivateVersionError=function(b){b=b.details.raw;const a=+b.extendedCode;return 500===+b.code&&(-2147217144===a||-2147467261===a)};f.unpackEditResultData=function(b){var a=b?.assetMaps;if(a){for(const c of a.addResults)c.success||
u.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`);for(const c of a.updateResults)c.success||u.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`)}a=b?.attachments;a={addFeatureResults:b?.addResults?.map(h)??[],updateFeatureResults:b?.updateResults?.map(h)??[],deleteFeatureResults:b?.deleteResults?.map(h)??[],addAttachmentResults:a?.addResults?
a.addResults.map(h):[],updateAttachmentResults:a?.updateResults?a.updateResults.map(h):[],deleteAttachmentResults:a?.deleteResults?a.deleteResults.map(h):[]};b?.editMoment&&(a.editMoment=b.editMoment);return a};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});