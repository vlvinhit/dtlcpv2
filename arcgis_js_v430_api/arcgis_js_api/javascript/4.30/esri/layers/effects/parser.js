// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../colorUtils ../../core/Error ./effects ../../chunks/_commonjsHelpers ./utils".split(" "),function(X,O,z,J,Ba,Y){function Z(f){let h;if(!f)return[];try{h=Ca.parse(f)}catch(r){throw new z("effect:invalid-syntax","Invalid effect syntax",{value:f,error:r});}return h.map(r=>Da(r))}function Da(f){try{switch(f.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var h=1;K(f.parameters,1);1===f.parameters.length&&(h=E(f.parameters[0]));return new J.ColorMatrixEffect(f.name,
h);case "opacity":return h=1,K(f.parameters,1),1===f.parameters.length&&(h=E(f.parameters[0])),new J.OpacityEffect(h);case "hue-rotate":h=0;K(f.parameters,1);if(1===f.parameters.length){var r=f.parameters[0];if("quantity"!==r.type||!(0===r.value&&null===r.unit||r.unit&&null!=R[r.unit]))throw new z("effect:type-error",`Expected <angle>, Actual: ${P(r)}`,{term:r});h=r.value*R[r.unit]||0}return new J.HueRotateEffect(h);case "blur":return h=0,K(f.parameters,1),1===f.parameters.length&&(h=S(f.parameters[0]),
L(h,f.parameters[0])),new J.BlurEffect(h);case "drop-shadow":const q=[];let y=null;for(const C of f.parameters)if("color"===C.type){q.length&&Object.freeze(q);if(y)throw new z("effect:type-error","Accepts only one color",{});a:{r=void 0;var e=C;switch(e.colorType){case "hex":y=O.hex2rgba(e.value);break a;case "named":y=aa(e.value);break a;case "function":h=e.value;K(h.parameters,4);if(Ea.test(h.name))r=[E(h.parameters[0]),E(h.parameters[1]),E(h.parameters[2]),h.parameters[3]?E(h.parameters[3]):1];
else if(Fa.test(h.name)){e=O;var p=e.hsla2rgba,n=h.parameters[0],u=n;if("quantity"!==u.type||null!==u.unit)throw new z("effect:type-error",`Expected <double>, Actual: ${P(u)}`,{term:u});L(n.value,n);r=p.call(e,n.value,E(h.parameters[1]),E(h.parameters[2]),h.parameters[3]?E(h.parameters[3]):1)}else throw new z("effect:syntax-error",`Invalid color function '${h.name}'`,{colorFunction:h});y=r;break a}y=void 0}}else{const g=S(C);if(Object.isFrozen(q))throw new z("effect:type-error","\x3clength\x3e parameters not consecutive",
{lengths:q});q.push(g);3===q.length&&L(g,C)}if(2>q.length||3<q.length)throw new z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${q.length}}`,{lengths:q});return new J.DropShadowEffect(q[0],q[1],q[2]||0,y||aa("black"));case "bloom":return h=1,n=p=0,K(f.parameters,3),f.parameters[0]&&(h=E(f.parameters[0])),f.parameters[1]&&(p=S(f.parameters[1]),L(p,f.parameters[1])),f.parameters[2]&&(n=E(f.parameters[2])),new J.BloomEffect(h,p,n)}}catch(q){throw q.details.filter=f,q;}throw new z("effect:unknown-effect",
`Effect '${f.name}' is not supported`,{effect:f});}function K(f,h){if(f.length>h)throw new z("effect:type-error",`Function supports up to ${h} parameters, Actual: ${f.length}`,{parameters:f});}function P(f){if("color"===f.type)return"\x3ccolor\x3e";if(f.unit){if(f.unit in T)return"\x3clength\x3e";if(f.unit in R)return"\x3cangle\x3e";if("%"===f.unit)return"\x3cpercentage\x3e"}return"\x3cdouble\x3e"}function L(f,h){if(0>f)throw new z("effect:type-error",`Negative values are not allowed, Actual: ${f}`,
{term:h});}function E(f){if("quantity"!==f.type||null!==f.unit&&"%"!==f.unit)throw new z("effect:type-error",`Expected <double> or <percentage>, Actual: ${P(f)}`,{term:f});const h=f.value;L(h,f);return"%"===f.unit?.01*h:h}function S(f){if("quantity"!==f.type||!(0===f.value&&null===f.unit||f.unit&&null!=T[f.unit]))throw new z("effect:type-error",`Expected <length>, Actual: ${P(f)}`,{term:f});return f.value*T[f.unit]||0}function aa(f){if(!O.isNamedColor(f))throw new z("effect:unknown-color",`color '${f}' isn't valid`,
{namedColor:f});return O.getNamedColorCopy(f)}var ba={exports:{}};(function(f){(function(h,r){f.exports&&(f.exports=r())})(Ba.commonjsGlobal,function(){function h(e,p,n,u){e=Error.call(this,e);Object.setPrototypeOf&&Object.setPrototypeOf(e,h.prototype);e.expected=p;e.found=n;e.location=u;e.name="SyntaxError";return e}function r(e,p,n){n=n||" ";if(e.length>p)return e;p-=e.length;n+=n.repeat(p);return e+n.slice(0,p)}(function(e,p){function n(){this.constructor=e}n.prototype=p.prototype;e.prototype=
new n})(h,Error);h.prototype.format=function(e){var p="Error: "+this.message;if(this.location){var n=null,u;for(u=0;u<e.length;u++)if(e[u].source===this.location.source){n=e[u].text.split(/\r\n|\n|\r/g);break}e=this.location.start;u=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(e):e;var q=this.location.source+":"+u.line+":"+u.column;if(n){var y=this.location.end,C=r("",u.line.toString().length," ");n=n[e.line-1];y=(e.line===y.line?y.column:n.length+
1)-e.column||1;p+="\n --\x3e "+q+"\n"+C+" |\n"+u.line+" | "+n+"\n"+C+" | "+r("",e.column-1," ")+r("",y,"^")}else p+="\n at "+q}return p};h.buildMessage=function(e,p){function n(g){return g.charCodeAt(0).toString(16).toUpperCase()}function u(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function q(g){return g.replace(/\\/g,
"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function y(g){return C[g.type](g)}var C={literal:function(g){return'"'+u(g.text)+'"'},class:function(g){var w=g.parts.map(function(A){return Array.isArray(A)?q(A[0])+"-"+q(A[1]):q(A)});return"["+(g.inverted?"^":"")+w.join("")+"]"},
any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};return"Expected "+function(g){g=g.map(y);var w,A;g.sort();if(0<g.length){for(A=w=1;w<g.length;w++)g[w-1]!==g[w]&&(g[A]=g[w],A++);g.length=A}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}(e)+" but "+(p?'"'+u(p)+'"':"end of input")+" found."};return{SyntaxError:h,parse:function(e,p){function n(m,a){return{type:"literal",
text:m,ignoreCase:a}}function u(m,a,d){return{type:"class",parts:m,inverted:a,ignoreCase:d}}function q(m){return{type:"other",description:m}}function y(m){var a=Q[m],d;if(!a){for(d=m-1;!Q[d];)d--;a=Q[d];for(a={line:a.line,column:a.column};d<m;)10===e.charCodeAt(d)?(a.line++,a.column=1):a.column++,d++;Q[m]=a}return a}function C(m,a,d){d=y(m);var k=y(a);return{source:Ga,start:{offset:m,line:d.line,column:d.column},end:{offset:a,line:k.line,column:k.column}}}function g(m){c<F||(c>F&&(F=c,U=[]),U.push(m))}
function w(){l++;var m=c;x();if(e.substr(c,4)===ca){var a=ca;c+=4}else a=b,0===l&&g(Ha);a!==b?(x(),t=m,m=[]):(c=m,m=b);l--;m===b&&0===l&&g(Ia);if(m===b)if(m=[],a=A(),a!==b)for(;a!==b;)m.push(a),a=A();else m=b;return m}function A(){var m=c;x();l++;var a=c;var d=da();if(d!==b){if(40===e.charCodeAt(c)){var k=Ja;c++}else k=b,0===l&&g(Ka);k!==b?(t=a,a=d):(c=a,a=b)}else c=a,a=b;l--;a===b&&(d=b,0===l&&g(La));if(a!==b){x();d=c;k=V();if(k!==b){var B=[];var v=c;var M=x();if(44===e.charCodeAt(c)){var G=ea;c++}else G=
b,0===l&&g(fa);G===b&&(G=null);var W=x();var N=V();N!==b?v=M=[M,G,W,N]:(c=v,v=b);for(;v!==b;)B.push(v),v=c,M=x(),44===e.charCodeAt(c)?(G=ea,c++):(G=b,0===l&&g(fa)),G===b&&(G=null),W=x(),N=V(),N!==b?v=M=[M,G,W,N]:(c=v,v=b);t=d;d=0<B.length?[k].concat(Ma(B,3)):[k]}else c=d,d=b;d===b&&(d=null);x();41===e.charCodeAt(c)?(k=Na,c++):(k=b,0===l&&g(Oa));k!==b?(x(),t=m,m={type:"function",name:a,parameters:d||[]}):(c=m,m=b)}else c=m,m=b;return m}function V(){var m=c;l++;var a=c;x();var d=D();if(d!==b){if(37===
e.charCodeAt(c)){var k=Pa;c++}else k=b,0===l&&g(Qa);k!==b?(t=a,a={value:d,unit:"%"}):(c=a,a=b)}else c=a,a=b;l--;a===b&&0===l&&g(Ra);a===b&&(l++,a=c,x(),d=D(),d!==b?(e.substr(c,2)===ha?(k=ha,c+=2):(k=b,0===l&&g(Sa)),k!==b?(t=a,a={value:d,unit:"px"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ia?(k=ia,c+=2):(k=b,0===l&&g(Ta)),k!==b?(t=a,a={value:d,unit:"cm"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ja?(k=ja,c+=2):(k=b,0===l&&g(Ua)),k!==b?(t=a,a={value:d,
unit:"mm"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ka?(k=ka,c+=2):(k=b,0===l&&g(Va)),k!==b?(t=a,a={value:d,unit:"in"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===la?(k=la,c+=2):(k=b,0===l&&g(Wa)),k!==b?(t=a,a={value:d,unit:"pt"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,x(),d=D(),d!==b?(e.substr(c,2)===ma?(k=ma,c+=2):(k=b,0===l&&g(Xa)),k!==b?(t=a,a={value:d,unit:"pc"}):(c=a,a=b)):(c=a,a=b)))))),l--,a===b&&0===l&&g(Ya),a===b&&(l++,a=c,d=D(),d!==b?(e.substr(c,
3)===na?(k=na,c+=3):(k=b,0===l&&g(Za)),k!==b?(t=a,a={value:d,unit:"deg"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,3)===oa?(k=oa,c+=3):(k=b,0===l&&g($a)),k!==b?(t=a,a={value:d,unit:"rad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,4)===pa?(k=pa,c+=4):(k=b,0===l&&g(ab)),k!==b?(t=a,a={value:d,unit:"grad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=D(),d!==b?(e.substr(c,4)===qa?(k=qa,c+=4):(k=b,0===l&&g(bb)),k!==b?(t=a,a={value:d,unit:"turn"}):(c=a,a=b)):(c=a,a=b)))),l--,a===
b&&(d=b,0===l&&g(cb)),a===b&&(l++,a=c,x(),d=D(),d!==b?(t=a,a={value:d,unit:null}):(c=a,a=b),l--,a===b&&0===l&&g(db))));a!==b&&(t=m,a={type:"quantity",value:a.value,unit:a.unit});m=a;if(m===b){m=c;l++;a=c;35===e.charCodeAt(c)?(d=eb,c++):(d=b,0===l&&g(fb));if(d!==b){d=[];ra.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&g(sa));if(k!==b)for(;k!==b;)d.push(k),ra.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&g(sa));else d=b;d!==b?(t=a,a={type:"hex",value:e.substring(t,c)}):(c=a,a=b)}else c=a,a=
b;a===b&&(a=c,d=A(),d!==b&&(t=a,d={type:"function",value:d}),a=d,a===b&&(a=c,d=da(),d!==b&&(t=a,d={type:"named",value:e.substring(t,c)}),a=d));l--;a===b&&(d=b,0===l&&g(gb));a!==b&&(t=m,a={type:"color",colorType:a.type,value:a.value});m=a}return m}function x(){l++;var m=[];if(ta.test(e.charAt(c))){var a=e.charAt(c);c++}else a=b,0===l&&g(ua);for(;a!==b;)m.push(a),ta.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&g(ua));l--;a=b;0===l&&g(hb);return m}function da(){l++;var m=c;var a=[];if(va.test(e.charAt(c))){var d=
e.charAt(c);c++}else d=b,0===l&&g(wa);if(d!==b)for(;d!==b;)a.push(d),va.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&g(wa));else a=b;a!==b&&(t=m,a=e.substring(t,c));m=a;l--;m===b&&(a=b,0===l&&g(ib));return m}function D(){var m=c;xa.test(e.charAt(c))?(e.charAt(c),c++):0===l&&g(ya);var a=c;var d=[];if(H.test(e.charAt(c))){var k=e.charAt(c);c++}else k=b,0===l&&g(I);for(;k!==b;)d.push(k),H.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&g(I));46===e.charCodeAt(c)?(k=jb,c++):(k=b,0===l&&g(kb));
if(k!==b){var B=[];if(H.test(e.charAt(c))){var v=e.charAt(c);c++}else v=b,0===l&&g(I);if(v!==b)for(;v!==b;)B.push(v),H.test(e.charAt(c))?(v=e.charAt(c),c++):(v=b,0===l&&g(I));else B=b;B!==b?a=d=[d,k,B]:(c=a,a=b)}else c=a,a=b;if(a===b)if(a=[],H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&g(I)),d!==b)for(;d!==b;)a.push(d),H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&g(I));else a=b;if(a!==b){d=c;101===e.charCodeAt(c)?(k=lb,c++):(k=b,0===l&&g(mb));if(k!==b){xa.test(e.charAt(c))?(B=e.charAt(c),
c++):(B=b,0===l&&g(ya));B===b&&(B=null);v=[];H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&g(I));if(a!==b)for(;a!==b;)v.push(a),H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&g(I));else v=b;v!==b?d=k=[k,B,v]:(c=d,d=b)}else c=d,d=b;d===b&&(d=null);t=m;m=parseFloat(e.substring(t,c))}else c=m,m=b;return m}function Ma(m,a){return m.map(function(d){return d[a]})}p=void 0!==p?p:{};var b={},Ga=p.grammarSource,za={start:w},Aa=w,ca="none",Na=")",ea=",",Ja="(",Pa="%",ha="px",ia="cm",ja="mm",ka="in",
la="pt",ma="pc",na="deg",oa="rad",pa="grad",qa="turn",eb="#",jb=".",lb="e",ta=/^[ \t\n\r]/,va=/^[a-z\-]/,ra=/^[0-9a-fA-F]/,xa=/^[+\-]/,H=/^[0-9]/,Ia=q("none"),Ha=n("none",!1),Oa=n(")",!1),fa=n(",",!1),hb=q("whitespace"),ua=u([" ","\t","\n","\r"],!1,!1),La=q("function"),Ka=n("(",!1),ib=q("identifier"),wa=u([["a","z"],"-"],!1,!1),Ra=q("percentage"),Qa=n("%",!1),Ya=q("length"),Sa=n("px",!1),Ta=n("cm",!1),Ua=n("mm",!1),Va=n("in",!1),Wa=n("pt",!1),Xa=n("pc",!1),cb=q("angle"),Za=n("deg",!1),$a=n("rad",
!1),ab=n("grad",!1),bb=n("turn",!1),db=q("number"),gb=q("color"),fb=n("#",!1),sa=u([["0","9"],["a","f"],["A","F"]],!1,!1),ya=u(["+","-"],!1,!1),I=u([["0","9"]],!1,!1),kb=n(".",!1),mb=n("e",!1),c=0,t=0,Q=[{line:1,column:1}],F=0,U=[],l=0;if("startRule"in p){if(!(p.startRule in za))throw Error("Can't start parsing from rule \""+p.startRule+'".');Aa=za[p.startRule]}p=Aa();if(p!==b&&c===e.length)return p;p!==b&&c<e.length&&g({type:"end"});throw function(m,a,d){return new h(h.buildMessage(m,a),m,a,d)}(U,
F<e.length?e.charAt(F):null,F<e.length?C(F,F+1):C(F,F));}}})})(ba);var Ca=ba.exports;const R={deg:1,grad:.9,rad:180/Math.PI,turn:360},T={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72},Ea=/^rgba?/i,Fa=/^hsla?/i;X.parse=function(f){if(!f||0===f.length)return null;if("string"===typeof f)return(f=Z(f))&&0!==f.length?f:null;f=f.map(h=>{if(!Number.isFinite(h.scale)||0>=h.scale)throw new z("effect:invalid-scale","scale must be finite and greater than 0",{stop:h});return{scale:h.scale,effects:Z(h.value)}});
f.sort((h,r)=>r.effects.length-h.effects.length);for(let h=0;h<f.length-1;h++){if(!Y.canInterpolateEffects(f[h].effects,f[h+1].effects))throw new z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:f[h].effects,b:f[h+1].effects});Y.normalizeEffects(f[h].effects,f[h+1].effects)}f.sort((h,r)=>r.scale-h.scale);return f};Object.defineProperty(X,Symbol.toStringTag,{value:"Module"})});