// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../core/colorUtils ../../../core/Error ../../../core/lang ./ArithmeticFunction ./AspectFunction ./BandArithmeticFunction ./ClipFunction ./ColormapFunction ./CompositeBandFunction ./ComputeChangeFunction ./ContrastBrightnessFunction ./ConvolutionFunction ./CurvatureFunction ./ExtractBandFunction ./GrayscaleFunction ./LocalFunction ./MaskFunction ./NDVIFunction ./RemapFunction ./SlopeFunction ./StatisticsFunction ./StatisticsHistogramFunction ./StretchFunction ./TableFunction".split(" "),
function(q,w,n,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,aa){function x(a,c){({rasterFunctionArguments:a}=a);a&&(a.rasters||[a.raster,a.raster2]).forEach(b=>{b&&"number"!==typeof b&&("string"===typeof b?b.startsWith("http")&&(c.includes(b)||c.push(b)):"rasterFunctionArguments"in b&&x(b,c))})}function y(a,c){return"rasters"===c[0]&&Array.isArray(a.rasters)?a.rasters:c.map(b=>a[b])}function z(a){return!!(a&&"object"===typeof a&&a.rasterFunction&&a.rasterFunctionArguments)}function t(a){const {rasterFunction:c,
rasterFunctionArguments:b}=a,d={};for(const g in b){let f=b[g];var e=g.toLowerCase();if("rasters"===e&&Array.isArray(f))d.rasters=f.map(k=>z(k)?t(k):k);else switch(z(f)&&(f=t(f)),e){case "dra":d.dra=f;break;case "pspower":d.psPower=f;break;case "pszfactor":d.psZFactor=f;break;case "bandids":d.bandIds=f;break;default:e=g[0].toLowerCase()+g.slice(1),d[e]=f}}"Local"!==c||d.rasters?.length||(d.rasters=["$$"]);return{...a,rasterFunctionArguments:d}}function A(a,c){const {rasterFunction:b,rasterFunctionArguments:d}=
a;var e=a.outputPixelType?.toLowerCase();if(null==b||!h.has(b))throw new n("raster-function-helper",`unsupported raster function: ${b}`);var g=h.get(b);const f=("function"===typeof g.ctor?g.ctor:g.ctor["default"]).fromJSON({...a,outputPixelType:e});({rasterArgumentNames:a}=f);e=[];g=y(d,a);const k="rasters"===a[0]||1<a.length,m=[];for(let p=0;p<g.length;p++){const l=g[p];let r;null==l||"string"===typeof l&&l.startsWith("$")?e.push(c?.raster):"string"===typeof l?c[l]&&e.push(c[l]):"number"!==typeof l&&
"rasterFunction"in l&&(r=A(l,c),k||(f.functionArguments[a[p]]=r),e.push(r));k&&m.push(r??l)}k&&("rasters"===a[0]?f.functionArguments.rasters=m:a.forEach((p,l)=>{f.functionArguments[p]=m[l]}));c&&(f.sourceRasters=e,c=c.raster?.url)&&(f.mainPrimaryRasterId=c);return f}function B(a,c){if(a&&c)for(const b in a){const d=a[b];d&&"object"===typeof d&&"type"in d&&("RasterFunctionTemplate"===d.type?B(d.arguments,c):"RasterFunctionVariable"===d.type&&null!=c[d.name]&&(d.value=c[d.name]))}}function u(a,c){if(!a||
"object"!==typeof a)return a;const {value:b}=a;if(!b||"object"!==typeof b)return a.isDataset?"$$":b;if(Array.isArray(b))return 0===b.length?[]:b.map(e=>"object"===typeof e&&"RasterFunctionVariable"===e.type?u(e,c):e);if("value"in b&&["number","string","boolean"].includes(typeof b.value))return b.value;if(a.isDataset&&"Scalar"!==b.type)return"$$";if(!("type"in b))return b;a=b;switch(b.type){case "Scalar":a=b.value;break;case "AlgorithmicColorRamp":a=C(b);break;case "MultiPartColorRamp":a={type:"multipart",
colorRamps:b.ArrayOfColorRamp.map(C)};break;case "ArgumentArray":if(b.elements?.length&&"RasterStatistics"!==b.elements[0].type){a=[];for(let e=0;e<b.elements.length;e++){const g=b.elements[e];var {type:d}=g;if(d)if("RasterFunctionTemplate"===d)({renderingRule:d}=D(g,c)),a.push(d),null!=g._object_id&&c.set(g._object_id,d);else if("RasterFunctionVariable"===d)d=u(g,c),a.push(d),null!=g._object_id&&c.set(g._object_id,d);else throw new n("raster-function-helper","unsupported raster function json.");
else a.push(g)}}else a=b.elements}null!=b._object_id&&c.set(b._object_id,a);return a}function C(a){const c=a.algorithm??"esriHSVAlgorithm";let {FromColor:b,ToColor:d}=a;if(!Array.isArray(b)){const {r:e,g,b:f}=w.toRGB({h:b.Hue,s:b.Saturation,v:b.Value});b=[e,g,f,b.AlphaValue]}if(!Array.isArray(d)){const {r:e,g,b:f}=w.toRGB({h:d.Hue,s:d.Saturation,v:d.Value});d=[e,g,f,d.AlphaValue]}return{type:"algorithmic",algorithm:c,fromColor:b,toColor:d}}function D(a,c,b){b&&B(a,b);c={renderingRule:{},templates:c};
E(a,c);return c}function E(a,c){if(a&&c.renderingRule){var {renderingRule:b,templates:d}=c,{function:e,arguments:g,_object_id:f}=a;if(e&&g){null!=f&&d.set(f,b);b.rasterFunction=e.type.replace("Function","");b.outputPixelType=e.pixelType;a={};b.rasterFunctionArguments=a;for(const k in g)"type"!==k&&"object_id"!==k&&"_object_ref_id"!==k&&((c=g[k])&&"object"===typeof c&&"type"in c&&("RasterFunctionTemplate"===c.type||"RasterFunctionVariable"===c.type)?("RasterFunctionVariable"===c.type?a[k]=u(c,d):(b.rasterFunctionArguments[k]=
{},E(c,{renderingRule:b.rasterFunctionArguments[k],templates:d})),null!=c._object_id&&d.set(c._object_id,a[k])):a[k]=c);a.DEM&&!a.Raster&&(a.Raster=a.DEM,delete a.DEM);switch(b.rasterFunction){case "Stretch":ba(a);break;case "Colormap":"randomcolorramp"===a.ColorRamp?.type?.toLowerCase()&&(delete a.ColorRamp,a.ColormapName="Random");0===a.ColorSchemeType&&delete a.ColorRamp;break;case "Convolution":null!=a.ConvolutionType&&(a.Type=a.ConvolutionType,delete a.ConvolutionType);break;case "Mask":ca(a)}}}}
function v(a){const {renderingRule:c,templates:b}=a;if("object"===typeof c&&c?.rasterFunctionArguments&&b.size){({rasterFunctionArguments:a}=c);for(const d in a){const e=a[d],g="_object_ref_id"===d?e:e&&"object"===typeof e&&"_object_ref_id"in e?e._object_ref_id:null;if(null!=g){if(!b.has(g))throw new n("raster-function-helper",`unsupported raster function json. _object_ref_id: ${g} does not exist`);const f=b.get(g);"_object_ref_id"!==d?a[d]=f:f&&"object"===typeof f&&Object.assign(a,f)}else e&&"object"===
typeof e&&(e.rasterFunctionArguments&&v({renderingRule:e,templates:b}),Array.isArray(e)&&e.forEach((f,k)=>{if("object"===typeof f)if(null!=f._object_ref_id){if(!b.has(f._object_ref_id))throw new n("raster-function-helper",`unsupported raster function json. _object_ref_id: ${e} does not exist`);const m=b.get(g);m&&"object"===typeof m?Object.assign(f,m):e[k]=m}else v({renderingRule:f,templates:b})}))}}}function ba(a){a.Statistics?.length&&"object"===typeof a.Statistics&&(a.Statistics=a.Statistics.map(c=>
[c.min,c.max,c.mean,c.standardDeviation]));null!=a.NumberOfStandardDeviation&&(a.NumberOfStandardDeviations=a.NumberOfStandardDeviation,delete a.NumberOfStandardDeviation)}function ca(a){a.NoDataValues?.length&&"string"===typeof a.NoDataValues[0]&&(a.NoDataValues=a.NoDataValues.filter(c=>""!==c).map(c=>Number(c)))}const h=new Map;h.set("Arithmetic",{desc:"Arithmetic Function",ctor:G,rasterArgumentNames:["rasters"]});h.set("Aspect",{desc:"Aspect Function",ctor:H,rasterArgumentNames:["raster"]});h.set("BandArithmetic",
{desc:"Band Arithmetic Function",ctor:I,rasterArgumentNames:["raster"]});h.set("Colormap",{desc:"Colormap Function",ctor:K,rasterArgumentNames:["raster"]});h.set("CompositeBand",{desc:"CompositeBand Function",ctor:L,rasterArgumentNames:["rasters"]});h.set("ComputeChange",{desc:"ComputeChange Function",ctor:M,rasterArgumentNames:["rasters"]});h.set("Convolution",{desc:"Convolution Function",ctor:O,rasterArgumentNames:["raster"]});h.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:N,
rasterArgumentNames:["raster"]});h.set("ExtractBand",{desc:"ExtractBand Function",ctor:Q,rasterArgumentNames:["raster"]});h.set("Curvature",{desc:"Curvature Function",ctor:P,rasterArgumentNames:["raster"]});h.set("Grayscale",{desc:"Grayscale Function",ctor:R,rasterArgumentNames:["raster"]});h.set("Clip",{desc:"Clip Function",ctor:J,rasterArgumentNames:["raster"]});h.set("Local",{desc:"Local Function",ctor:S,rasterArgumentNames:["rasters"]});h.set("Mask",{desc:"Mask Function",ctor:T,rasterArgumentNames:["raster"]});
h.set("NDVI",{desc:"NDVI Function",ctor:U,rasterArgumentNames:["raster"]});h.set("Remap",{desc:"Remap Function",ctor:V,rasterArgumentNames:["raster"]});h.set("Slope",{desc:"Slope Function",ctor:W,rasterArgumentNames:["raster"]});h.set("Statistics",{desc:"Focal Statistics Function",ctor:X,rasterArgumentNames:["raster"]});h.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:Y,rasterArgumentNames:["raster"]});h.set("Stretch",{desc:"Stretch Function",ctor:Z,rasterArgumentNames:["raster"]});
h.set("Table",{desc:"Attribute Table Function",ctor:aa,rasterArgumentNames:["raster"]});q.create=function(a,c){c=c??{};a=F.clone(a);if("function"in a&&"arguments"in a&&a.arguments){const b=new Map;a=D(a,b,c);v(a);if(!a.renderingRule)throw new n("raster-function-helper","Unsupported raster function json.");a=a.renderingRule}if("rasterFunction"in a)return a=t(a),A(a,c);throw new n("raster-function-helper","unsupported raster function json.");};q.getPrimaryRasterUrls=x;q.getRasterValues=y;Object.defineProperty(q,
Symbol.toStringTag,{value:"Module"})});