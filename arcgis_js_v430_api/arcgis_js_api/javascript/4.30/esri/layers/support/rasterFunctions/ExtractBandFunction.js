// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./bandIndexUtils ./BaseRasterFunction ./ExtractBandFunctionArguments ./pixelUtils".split(" "),function(u,v,q,E,F,w,x,y,z,A){function B(a,c){a=a.bandInfos.map(({name:d})=>d.toLowerCase());const b=[];for(let d=0;d<c.length;d++){const g=c[d].toLowerCase();let e=a.indexOf(g);-1===e&&"nearinfrared"===g&&(e=a.findIndex(h=>
h.startsWith("nearinfrared_1")),-1===e&&(e=a.findIndex(h=>h.startsWith("nearinfrared"))));if(-1===e)return null;b.push(e)}return b}function C(a,c,b){const {bandCount:d}=a;return!c?.length||b&&c.some(g=>0>g||g>=d)?null:c}function D(a,c,{wavelengthMatchTolerance:b},d){var {bandInfos:g}=a;a=[];for(var e=0;e<g.length;e++){const {minWavelength:h,maxWavelength:k}=g[e];if(!h||!k)return null;a.push({minWavelength:h,maxWavelength:k})}g=[];for(e=0;e<c.length;e++){const h=c[e];let k=!1,r=-1,n=Number.MAX_VALUE;
for(let f=0;f<a.length;f++){const l=a[f],m=Math.abs(h-(l.minWavelength+l.maxWavelength)/2);h>=l.minWavelength&&h<=l.maxWavelength?m<n&&(k=!0,r=f,n=m):!k&&m<n&&(r=f,n=m)}!k&&b&&n<b&&(k=!0);if(!k&&d)return null;g.push(r)}return g}q=class extends y{constructor(){super(...arguments);this.functionName="ExtractBand";this.functionArguments=null;this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const {functionArguments:a,sourceRasterInfos:c}=this;var b=c[0];const {method:d,bandNames:g,bandWavelengths:e,
bandIds:h,missingBandAction:k}=a,r=g?.length&&("name"===d||"id"!==d&&!h?.length),n=e?.length&&("wavelength"===d||"id"!==d&&!h?.length);var f=k===A.MissingBandAction.fail;f=r?B(b,g):n?D(b,e,this.functionArguments,f):C(b,h,f);if(null==f)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${r?"band names":n?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=f;this.functionArguments.method="id";this.outputPixelType=this._getOutputPixelType("f32");
b=b.clone();b.pixelType=this.outputPixelType;b.bandCount=f.length;const {statistics:l,histograms:m}=b;null!=l&&l.length&&(b.statistics=f.map(t=>l[t]||l[l.length-1]));null!=m&&m.length&&(b.histograms=f.map(t=>m[t]||m[m.length-1]));let p=b.keyProperties?.BandProperties;p?.length&&(p=f.map(t=>t>=p.length?p[p.length-1]:p[t]),b.keyProperties={...b.keyProperties,BandProperties:p});this.rasterInfo=b;return{success:!0,supportsGPU:3>=b.bandCount}}_processPixels(a){a=a.pixelBlocks?.[0];if(null==a)return null;
const c=a.pixels.length,b=this.functionArguments.bandIds.map(d=>d>=c?c-1:d);return a.extractBands(b)}_getWebGLParameters(){let a;if(this.isInputBandIdsSwizzled)a=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{a=[...this.functionArguments.bandIds];0===a.length?a=[0,1,2]:3>a.length&&(a[1]=a[1]??a[0],a[2]=a[2]??a[1]);for(let c=0;3>c;c++)a[c]=Math.min(a[c],2)}return{bandIndexMat3:x.getBandMatrix3(a)}}_getInputBandIds(a){const c=a.length;return this.functionArguments.bandIds.map(b=>
b>=c?c-1:b).map(b=>a[b])}};u.__decorate([v.property({json:{write:!0,name:"rasterFunction"}})],q.prototype,"functionName",void 0);u.__decorate([v.property({type:z,json:{write:!0,name:"rasterFunctionArguments"}})],q.prototype,"functionArguments",void 0);u.__decorate([v.property()],q.prototype,"rasterArgumentNames",void 0);return q=u.__decorate([w.subclass("esri.layers.support.rasterFunctions.ExtractBandFunction")],q)});