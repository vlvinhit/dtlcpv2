// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../../core/Error ./CovJSONRaster ./ImageAuxRaster ./ImageServerRaster ./InMemoryRaster ./MRFRaster ./TIFFRaster".split(" "),function(m,p,h,q,r,t,u){const b=new Map;b.set("MRF",{desc:"Meta Raster Format",constructor:t});b.set("TIFF",{desc:"GeoTIFF",constructor:u});b.set("RasterTileServer",{desc:"Raster Tile Server",constructor:q});b.set("JPG",{desc:"JPG Raster Format",constructor:h});b.set("PNG",{desc:"PNG Raster Format",constructor:h});b.set("GIF",{desc:"GIF Raster Format",constructor:h});
b.set("BMP",{desc:"BMP Raster Format",constructor:h});b.set("CovJSON",{desc:"COVJSON Raster Format",constructor:p});b.set("MEMORY",{desc:"In Memory Raster Format",constructor:r});class v{static get supportedFormats(){const c=new Set;b.forEach((d,f)=>c.add(f));return c}static async open(c){const {url:d,ioConfig:f,source:k,sourceJSON:w}=c;let a=c.datasetFormat??f?.datasetFormat;null==a&&(d.includes(".")?a=d.slice(d.lastIndexOf(".")+1).toUpperCase():"coverage"===k?.type?.toLowerCase()?a="CovJSON":k?.extent&&
k.pixelblocks&&(a="MEMORY"));"OVR"===a||"TIF"===a?a="TIFF":"JPG"===a||"JPEG"===a||"JFIF"===a?a="JPG":"COVJSON"===a&&(a="CovJSON");d.toLowerCase().includes("/imageserver")&&!d.toLowerCase().includes("/wcsserver")&&(a="RasterTileServer");var l={bandIds:null,sampling:null};const g={url:d,source:k,sourceJSON:w,datasetFormat:a,ioConfig:f??l};Object.keys(g).forEach(e=>{null==g[e]&&delete g[e]});if(a){if(!this.supportedFormats.has(a))throw new m("rasterfactory:open","not a supported format "+a);if("CRF"===
a)throw new m("rasterfactory:open",`cannot open raster: ${d}`);l=new (b.get(a).constructor)(g);await l.open({signal:c.signal});return l}const x=Array.from(b.keys()).filter(e=>"CovJSON"!==e&&"Memory"!==e);let y=0;const n=()=>{a=x[y++];if(!a||"CRF"===a)return null;const e=new (b.get(a).constructor)(g);return e.open({signal:c.signal}).then(()=>e).catch(()=>n())};return n()}static register(c,d,f){b.has(c.toUpperCase())||b.set(c.toUpperCase(),{desc:d,constructor:f})}}return v});