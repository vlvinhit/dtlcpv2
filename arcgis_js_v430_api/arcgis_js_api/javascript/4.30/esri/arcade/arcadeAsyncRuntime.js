// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ./ArcadeModule ./ArcadeModuleLoader ./containerUtils ./Dictionary ./executionError ./Feature ./FunctionWrapper ../chunks/languageUtils ./treeAnalysis ../chunks/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ../geometry/Geometry ../geometry/SpatialReference".split(" "),function(A,C,M,D,w,f,N,t,e,X,Y,Z,aa,ba,ca,da,ea,O,P){async function E(a,b){const c=[];for(let d=0;d<b.arguments.length;d++)c.push(await h(a,b.arguments[d]));
return c}async function u(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await E(a,b);return c(a,b,d)}async function y(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await E(a,b);return c(a,b,d)}async function h(a,b,c){if(b.breakpoint&&!0!==c)return await b.breakpoint(),h(a,b,!0);try{switch(b?.type){case "VariableDeclarator":return await fa(a,b);case "ImportDeclaration":return await ha(a,b);case "ExportNamedDeclaration":return await ia(a,b);case "VariableDeclaration":return await Q(a,
b,0);case "BlockStatement":case "Program":return await ja(a,b);case "FunctionDeclaration":return await ka(a,b);case "ReturnStatement":return await la(a,b);case "IfStatement":return await ma(a,b);case "ExpressionStatement":return await na(a,b);case "UpdateExpression":return await oa(a,b);case "AssignmentExpression":return await pa(a,b);case "ForStatement":return await qa(a,b);case "WhileStatement":return await ra(a,b);case "ForInStatement":return await sa(a,b);case "BreakStatement":return e.breakResult;
case "EmptyStatement":return e.voidOperation;case "ContinueStatement":return e.continueResult;case "TemplateElement":return await ta(a,b);case "TemplateLiteral":return await ua(a,b);case "Identifier":return await F(a,b);case "MemberExpression":return await va(a,b);case "Literal":return b.value;case "CallExpression":return await wa(a,b);case "UnaryExpression":return await xa(a,b);case "BinaryExpression":return await ya(a,b);case "LogicalExpression":return await za(a,b);case "ArrayExpression":return await Aa(a,
b);case "ObjectExpression":return await Ba(a,b);case "Property":return await Ca(a,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Unrecognized,b);}}catch(d){throw f.ensureArcadeExecutionError(a,b,d);}}async function Ba(a,b){const c=[];for(var d=0;d<b.properties.length;d++)c[d]=await h(a,b.properties[d]);d={};const g=new Map;for(let l=0;l<c.length;l++){const k=c[l];if(e.isFunctionParameter(k.value))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInDictionary,
b);if(!1===e.isString(k.key))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyMustBeString,b);let m=k.key.toString();const n=m.toLowerCase();g.has(n)?m=g.get(n):g.set(n,m);d[m]=k.value===e.voidOperation?null:k.value}a=new w(d);a.immutable=!1;return a}async function Ca(a,b){const c=await h(a,b.value);return"Identifier"===b.key.type?{key:b.key.name,value:c}:{key:await h(a,b.key),value:c}}async function ra(a,b){var c=!0,d=e.voidOperation;c=await h(a,b.test);if(!1===c)return e.voidOperation;
if(!0!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);for(;!0===c;){d=await h(a,b.body);if(d===e.breakResult)break;if(d instanceof e.returnResult)break;c=await h(a,b.test);if(!0!==c&&!1!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return d instanceof e.returnResult?d:e.voidOperation}async function Da(a,b,c){const d=await h(a,b.body);c.lastAction=d;if(c.lastAction===e.breakResult||c.lastAction instanceof e.returnResult)return c.testResult=
!1,c;null!==b.update&&await h(a,b.update);return c}async function Ea(a,b,c){if(null!==b.test){const d=await h(a,b.test);if(!0===a.abortSignal?.aborted)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Cancelled,b);c.testResult=d;if(!1===c.testResult)return c;if(!0!==c.testResult)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return Da(a,b,c)}function B(a,b,c,d,g,l){try{Ea(a,b,c).then(()=>{try{!0===c.testResult?(l++,100<l?(l=0,setTimeout(()=>{B(a,b,c,d,
g,l)},0)):B(a,b,c,d,g,l)):c.lastAction instanceof e.returnResult?d(c.lastAction):d(e.voidOperation)}catch(k){g(k)}},k=>{g(k)})}catch(k){g(k)}}function qa(a,b){try{return null!==b.init?h(a,b.init).then(()=>new Promise((c,d)=>{B(a,b,{testResult:!0,lastAction:e.voidOperation},g=>{c(g)},g=>{d(g)},0)})):new Promise((c,d)=>{B(a,b,{testResult:!0,lastAction:e.voidOperation},g=>{c(g)},g=>{d(g)},0)})}catch(c){return Promise.reject(c)}}function G(a,b,c,d,g,l,k,m,n,p){try{d<=l?m(e.voidOperation):(g.value="k"===
k?c[l]:l,h(a,b.body).then(r=>{try{r instanceof e.returnResult?m(r):r===e.breakResult?m(e.voidOperation):(p++,100<p?(p=0,setTimeout(()=>{G(a,b,c,d,g,l+1,k,m,n,p)},0)):G(a,b,c,d,g,l+1,k,m,n,p))}catch(H){n(H)}},r=>{n(r)}))}catch(r){n(r)}}function I(a,b,c,d,g,l,k,m,n){try{c.length()<=g?k(e.voidOperation):(d.value="k"===l?c.get(g):g,h(a,b.body).then(p=>{p instanceof e.returnResult?k(p):p===e.breakResult?k(e.voidOperation):(n++,100<n?(n=0,setTimeout(()=>{I(a,b,c,d,g+1,l,k,m,n)},0)):I(a,b,c,d,g+1,l,k,m,
n))},p=>{m(p)}))}catch(p){m(p)}}function J(a,b,c,d,g,l){try{void 0===l&&(l="i"),0===c.length?d.resolve(e.voidOperation):G(a,b,c,c.length,g,0,l,k=>{d.resolve(k)},k=>{d.reject(k)},0)}catch(k){d.reject(k)}}function Fa(a,b,c,d,g,l){try{void 0===l&&(l="i"),0===c.length?d.resolve(e.voidOperation):I(a,b,c,g,0,l,k=>{d.resolve(k)},k=>{d.reject(k)},0)}catch(k){d.reject(k)}}function Ga(a,b,c,d,g){try{const l=c.keys();J(a,b,l,d,g,"k")}catch(l){d.reject(l)}}function K(a,b,c,d,g,l,k,m){try{a.next().then(n=>{try{if(null===
n)l(e.voidOperation);else{const p=N.createFromGraphicLikeObject(n.geometry,n.attributes,d,b.timeZone);p._underlyingGraphic=n;g.value=p;h(b,c.body).then(r=>{try{r===e.breakResult?l(e.voidOperation):r instanceof e.returnResult?l(r):(m++,100<m?(m=0,setTimeout(()=>{K(a,b,c,d,g,l,k,m)},0)):K(a,b,c,d,g,l,k,m))}catch(H){k(H)}},r=>{k(r)})}}catch(p){k(p)}},n=>{k(n)})}catch(n){k(n)}}async function sa(a,b){return new Promise((c,d)=>{h(a,b.right).then(g=>{try{let l=null;l="VariableDeclaration"===b.left.type?
h(a,b.left):Promise.resolve();l.then(()=>{try{let m="";if("VariableDeclaration"===b.left.type){var k=b.left.declarations[0].id;"Identifier"===k.type&&(m=k.name)}else"Identifier"===b.left.type&&(m=b.left.name);if(!m)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);m=m.toLowerCase();k=null;null!=a.localScope&&void 0!==a.localScope[m]&&(k=a.localScope[m]);null===k&&void 0!==a.globalScope[m]&&(k=a.globalScope[m]);null===k?d(new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,
b)):e.isArray(g)||e.isString(g)?J(a,b,g,{reject:d,resolve:c},k):e.isImmutableArray(g)?Fa(a,b,g,{reject:d,resolve:c},k):g instanceof w||e.isFeature(g)?Ga(a,b,g,{reject:d,resolve:c},k):e.isFeatureSet(g)?K(g.iterator(a.abortSignal),a,b,g,k,n=>{c(n)},n=>{d(n)},0):J(a,b,[],{reject:d,resolve:c},k)}catch(m){d(m)}},d)}catch(l){d(l)}},d)})}async function oa(a,b){var c=b.argument;if("MemberExpression"===c.type){var d=null,g=null;d=await h(a,c.object);!0===c.computed?g=await h(a,c.property):"Identifier"===c.property.type&&
(g=c.property.name);c=d;if(e.isArray(c))if(e.isNumber(g)){0>g&&(g=c.length+g);if(0>g||g>=c.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);a=e.toNumber(c[g]);c[g]="++"===b.operator?a+1:a-1}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(c instanceof w){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===c.hasField(g))a=e.toNumber(c.field(g)),c.setField(g,
"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});}else if(c instanceof x){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleAccessorMustBeString,b);if(!0===c.hasGlobal(g))a=e.toNumber(await c.global(g)),c.setGlobal(g,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(c)){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===c.hasField(g))a=e.toNumber(c.field(g)),c.setField(g,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});}else{if(e.isImmutableArray(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return!1===b.prefix?a:"++"===b.operator?a+1:a-1}g="Identifier"===b.argument.type?b.argument.name.toLowerCase():
"";if(!g)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);if(null!=a.localScope&&void 0!==a.localScope[g])return c=e.toNumber(a.localScope[g].value),a.localScope[g]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;if(void 0!==a.globalScope[g])return c=e.toNumber(a.globalScope[g].value),a.globalScope[g]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidIdentifier,b);}function v(a,b,c,d,g){switch(b){case "\x3d":return a===e.voidOperation?null:a;case "/\x3d":return e.toNumber(c)/e.toNumber(a);case "*\x3d":return e.toNumber(c)*e.toNumber(a);case "-\x3d":return e.toNumber(c)-e.toNumber(a);case "+\x3d":return e.isString(c)||e.isString(a)?e.toString(c)+e.toString(a):e.toNumber(c)+e.toNumber(a);case "%\x3d":return e.toNumber(c)%e.toNumber(a);default:throw new f.ArcadeExecutionError(g,f.ExecutionErrorCodes.UnsupportedOperator,
d);}}async function pa(a,b){var c=b.left;if("MemberExpression"===c.type){var d=await h(a,c.object),g=null;if(!0===c.computed)g=await h(a,c.property);else if("Identifier"===c.property.type)g=c.property.name;else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);c=await h(a,b.right);if(e.isArray(d))if(e.isNumber(g)){0>g&&(g=d.length+g);if(0>g||g>d.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);if(g===d.length&&"\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.OutOfBounds,b);d[g]=v(c,b.operator,d[g],b,a)}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(d instanceof w){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(g))d.setField(g,v(c,b.operator,d.field(g),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:g});d.setField(g,v(c,b.operator,null,b,a))}}else if(d instanceof
x){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasGlobal(g))d.setGlobal(g,v(c,b.operator,await d.global(g),b,a));else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(d)){if(!1===e.isString(g))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(g))d.setField(g,v(c,b.operator,d.field(g),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.FieldNotFound,b,{key:g});d.setField(g,v(c,b.operator,null,b,a))}}else{if(e.isImmutableArray(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return e.voidOperation}d=c.name.toLowerCase();if(null!=a.localScope&&void 0!==a.localScope[d])return g=await h(a,b.right),a.localScope[d]={value:v(g,b.operator,a.localScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;if(void 0!==
a.globalScope[d])return g=await h(a,b.right),a.globalScope[d]={value:v(g,b.operator,a.globalScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}async function na(a,b){if("AssignmentExpression"===b.expression.type)return h(a,b.expression);if("CallExpression"===b.expression.type)return a=await h(a,b.expression),a===e.voidOperation?e.voidOperation:new e.implicitResult(a);a=await h(a,b.expression);return a===e.voidOperation?
e.voidOperation:new e.implicitResult(a)}async function ma(a,b){const c=await h(a,b.test);if(!0===c)return h(a,b.consequent);if(!1===c)return null!==b.alternate?h(a,b.alternate):e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}async function ja(a,b){return R(a,b,0)}async function R(a,b,c){if(c>=b.body.length)return e.voidOperation;const d=await h(a,b.body[c]);return d instanceof e.returnResult||d===e.breakResult||d===e.continueResult||c===b.body.length-
1?d:R(a,b,c+1)}async function la(a,b){if(null===b.argument)return new e.returnResult(e.voidOperation);a=await h(a,b.argument);return new e.returnResult(a)}async function ka(a,b){const c=b.id.name.toLowerCase();a.globalScope[c]={valueset:!0,node:null,value:new Ha(b,a)};return e.voidOperation}async function ha(a,b){const c=b.specifiers[0].local.name.toLowerCase(),d=a.libraryResolver.loadLibrary(c);let g=null;a.libraryResolver._moduleSingletons?.has(d.uri)?g=a.libraryResolver._moduleSingletons.get(d.uri):
(g=new x(d),await g.loadModule(a),a.libraryResolver._moduleSingletons?.set(d.uri,g));a.globalScope[c]={value:g,valueset:!0,node:b};return e.voidOperation}async function ia(a,b){await h(a,b.declaration);if("FunctionDeclaration"===b.declaration.type)a.exports[b.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===b.declaration.type)for(const c of b.declaration.declarations)a.exports[c.id.name.toLowerCase()]="variable";return e.voidOperation}async function Q(a,b,c){if(c>=b.declarations.length)return e.voidOperation;
await h(a,b.declarations[c]);if(c===b.declarations.length-1)return e.voidOperation;await Q(a,b,c+1);return e.voidOperation}async function fa(a,b){let c=null;c=null===b.init?null:await h(a,b.init);if(null!==a.localScope){c===e.voidOperation&&(c=null);if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);var d=b.id.name.toLowerCase();null!=a.localScope&&(a.localScope[d]={value:c,valueset:!0,node:b.init});return e.voidOperation}if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidIdentifier,b);d=b.id.name.toLowerCase();c===e.voidOperation&&(c=null);a.globalScope[d]={value:c,valueset:!0,node:b.init};return e.voidOperation}async function va(a,b){const c=await h(a,b.object);if(null===c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MemberOfNull,b);if(!1===b.computed){if("Identifier"===b.property.type){if(c instanceof w||e.isFeature(c))return c.field(b.property.name);if(c instanceof O)return D.geometryMember(c,b.property.name,a,b);if(c instanceof
x){if(!c.hasGlobal(b.property.name))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);return c.global(b.property.name)}}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}let d=await h(a,b.property);if(c instanceof w||e.isFeature(c)){if(e.isString(d))return c.field(d)}else if(c instanceof x){if(e.isString(d))return c.global(d)}else if(c instanceof O){if(e.isString(d))return D.geometryMember(c,d,a,b)}else if(e.isArray(c)){if(e.isNumber(d)&&
isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}}else if(e.isImmutableArray(c)){if(e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c.get(d)}}else if(e.isString(c)&&e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}async function xa(a,b){const c=await h(a,b.argument);if(e.isBoolean(c)&&"!"===b.operator)return!c;if("-"===b.operator)return-1*e.toNumber(c);if("+"===b.operator)return 1*e.toNumber(c);if("~"===b.operator)return~e.toNumber(c);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedUnaryOperator,b);}async function Aa(a,b){const c=[];for(var d=0;d<b.elements.length;d++)c.push(await h(a,
b.elements[d]));for(d=0;d<c.length;d++){if(e.isFunctionParameter(c[d]))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInArray,b);c[d]===e.voidOperation&&(c[d]=null)}return c}async function ya(a,b){var c=[];c[0]=await h(a,b.left);c[1]=await h(a,b.right);const d=c[0];c=c[1];switch(b.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":return e.binaryOperator(e.toNumber(d),e.toNumber(c),b.operator);case "\x3d\x3d":return e.equalityTest(d,c);
case "!\x3d":return!e.equalityTest(d,c);case "\x3c":return e.greaterThanLessThan(d,c,b.operator);case "\x3e":return e.greaterThanLessThan(d,c,b.operator);case "\x3c\x3d":return e.greaterThanLessThan(d,c,b.operator);case "\x3e\x3d":return e.greaterThanLessThan(d,c,b.operator);case "+":return e.isString(d)||e.isString(c)?e.toString(d)+e.toString(c):e.toNumber(d)+e.toNumber(c);case "-":return e.toNumber(d)-e.toNumber(c);case "*":return e.toNumber(d)*e.toNumber(c);case "/":return e.toNumber(d)/e.toNumber(c);
case "%":return e.toNumber(d)%e.toNumber(c);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedOperator,b);}}async function za(a,b){const c=await h(a,b.left);let d=null;if(e.isBoolean(c))switch(b.operator){case "||":if(!0===c)return c;d=await h(a,b.right);if(e.isBoolean(d))return d;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);case "\x26\x26":if(!1===c)return c;d=await h(a,b.right);if(e.isBoolean(d))return d;throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.LogicExpressionOrAnd,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,b);}async function F(a,b){const c=b.name.toLowerCase();if(null!=a.localScope&&void 0!==a.localScope[c]){b=a.localScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=h(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}if(void 0!==a.globalScope[c]){b=
a.globalScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=h(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}async function wa(a,b){if("MemberExpression"===b.callee.type){var c=await h(a,b.callee.object);if(!(c instanceof x))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);const d=!1===b.callee.computed?b.callee.property.name:await h(a,b.callee.property);if(!c.hasGlobal(d))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.FunctionNotFound,b);c=await c.global(d);if(!e.isFunctionParameter(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);return c.call(a,b)}if("Identifier"!==b.callee.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);if(null!=a.localScope&&void 0!==a.localScope[b.callee.name.toLowerCase()]){c=a.localScope[b.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.CallNonFunction,b);}if(void 0!==a.globalScope[b.callee.name.toLowerCase()]){c=a.globalScope[b.callee.name.toLowerCase()];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);}async function ta(a,b){return b.value?b.value.cooked:""}async function ua(a,b){const c=[];for(var d=0;d<b.expressions.length;d++){var g=await h(a,
b.expressions[d]);c[d]=e.toString(g)}d="";g=0;for(const n of b.quasis)if(d+=n.value?n.value.cooked:"",!1===n.tail){if(c[g]){var l=c[g];var k=a,m=b;if(e.isFunctionParameter(l))throw new f.ArcadeExecutionError(k,f.ExecutionErrorCodes.NoFunctionInTemplateLiteral,m);}else l="";d+=l;g++}return d}async function S(a,b,c,d){var g=await h(a,b.arguments[c]);if(e.equalityTest(g,d))return h(a,b.arguments[c+1]);g=b.arguments.length-c;return 1===g?h(a,b.arguments[c]):2===g?null:3===g?h(a,b.arguments[c+2]):S(a,
b,c+2,d)}async function T(a,b,c,d){if(!0===d)return h(a,b.arguments[c+1]);if(3===b.arguments.length-c)return h(a,b.arguments[c+2]);d=await h(a,b.arguments[c+2]);if(!1===e.isBoolean(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b.arguments[c+2]);return T(a,b,c+2,d)}async function L(a,b,c,d){const g=a.body;if(c.length!==a.params.length)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let l=0;l<c.length;l++){const k=a.params[l];
"Identifier"===k.type&&null!=b.localScope&&(b.localScope[k.name.toLowerCase()]={d:null,value:c[l],valueset:!0,node:null})}a=await h(b,g);if(a instanceof e.returnResult)return a.value;if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);return a instanceof e.implicitResult?a.value:a}function U(a,b,c){const d=new z;if(void 0===a||null===a)a={};if(void 0===b||
null===b)b={};const g=new w({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});g.immutable=!1;d.textformatting={value:g,valueset:!0,node:null};for(const l in b)d[l]={value:new t.NativeFunction(b[l]),native:!0,valueset:!0,node:null};for(const l in a)d[l]=a[l]&&"esri.Graphic"===a[l].declaredClass?{value:N.createFromGraphic(a[l],c),valueset:!0,node:null}:{value:a[l],valueset:!0,node:null};return d}function V(a){console.log(a)}function W(a){const b={mode:"async",
compiled:!1,functions:{},signatures:[],standardFunction:u,standardFunctionAsync:y,evaluateIdentifier:F};for(let c=0;c<a.length;c++)a[c].registerFunctions(b);for(const c in b.functions)q[c]={value:new t.NativeFunction(b.functions[c]),valueset:!0,node:null},z.prototype[c]=q[c];for(a=0;a<b.signatures.length;a++)X.addFunctionDeclaration(b.signatures[a],"async")}class Ha extends t.ArcadeFunction{constructor(a,b){super();this.context=this.definition=null;this.definition=a;this.context=b}createFunction(a){return(...b)=>
{const c={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:a.depthCounter+1},globalScope:this.context.globalScope};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,null);return L(this.definition,c,b,null)}}call(a,
b){return y(a,b,(c,d,g)=>{c={spatialReference:a.spatialReference,services:a.services,console:a.console,libraryResolver:a.libraryResolver,exports:a.exports,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{},abortSignal:a.abortSignal,globalScope:a.globalScope,depthCounter:{depth:a.depthCounter.depth+1}};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,b);return L(this.definition,c,g,b)})}marshalledCall(a,b,c,d){return d(a,
b,async(g,l,k)=>{g={spatialReference:a.spatialReference,globalScope:c.globalScope,depthCounter:{depth:a.depthCounter.depth+1},libraryResolver:a.libraryResolver,exports:a.exports,console:a.console,abortSignal:a.abortSignal,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{}};k=k.map(m=>!e.isFunctionParameter(m)||m instanceof t.ScopeMarshalledFunction?m:t.wrapModuleScopedResponse(m,a,d));return t.wrapModuleScopedResponse(await L(this.definition,g,k,b),c,d)})}}class x extends C.ArcadeModule{constructor(a){super(a)}async global(a){a=
this.executingContext.globalScope[a.toLowerCase()];a.valueset||(a.value=await h(this.executingContext,a.node),a.valueset=!0);if(e.isFunctionParameter(a.value)&&!(a.value instanceof t.ScopeMarshalledFunction)){const b=new t.ScopeMarshalledFunction;b.fn=a.value;b.parameterEvaluator=y;b.context=this.executingContext;a.value=b}return a.value}setGlobal(a,b){if(e.isFunctionParameter(b))throw new f.ArcadeExecutionError(null,f.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[a.toLowerCase()]=
{value:b,valueset:!0,node:null}}hasGlobal(a){void 0===this.executingContext.exports[a]&&(a=a.toLowerCase());return void 0!==this.executingContext.exports[a]?!0:!1}async loadModule(a){let b=a.spatialReference;if(null===b||void 0===b)b=new P({wkid:102100});this.moduleScope=U({},a.customfunctions,a.timeZone);this.executingContext={spatialReference:b,services:a.services,libraryResolver:new M.ArcadeModuleLoader(a.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===
a.abortSignal||null===a.abortSignal?{aborted:!1}:a.abortSignal,globalScope:this.moduleScope,console:a.console??V,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:null,depthCounter:{depth:1}};await h(this.executingContext,this.source.syntax)}}const q={};Z.registerFunctions(q,u);ea.registerFunctions(q,u);ca.registerFunctions(q,u);ba.registerFunctions(q,u);da.registerFunctions(q,u);aa.registerFunctions({functions:q,compiled:!1,signatures:null,evaluateIdentifier:null,
mode:"async",standardFunction:u,standardFunctionAsync:y});q.iif=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,3,3,a,b);const c=await h(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);return c?h(a,b.arguments[1]):h(a,b.arguments[2])};q.defaultvalue=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,2,3,a,b);var c=await h(a,b.arguments[0]);if(3===b.arguments.length){const d=await h(a,b.arguments[1]);
c=D.getNestedOptionalValue(c,d);return null!=c&&""!==c?c:h(a,b.arguments[2])}return null==c||""===c?h(a,b.arguments[1]):c};q.decode=async function(a,b){if(2>b.arguments.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(2===b.arguments.length)return h(a,b.arguments[1]);if(0===(b.arguments.length-1)%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);const c=await h(a,b.arguments[0]);return S(a,b,1,c)};q.when=async function(a,
b){if(3>b.arguments.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(0===b.arguments.length%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);const c=await h(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b.arguments[0]);return T(a,b,0,c)};C={fixSpatialReference:e.fixSpatialReference,parseArguments:E,standardFunction:u,standardFunctionAsync:y,
evaluateIdentifier:F};for(const a in q)q[a]={value:new t.NativeFunction(q[a]),valueset:!0,node:null};const z=function(){};z.prototype=q;z.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};z.prototype.pi={value:Math.PI,valueset:!0,node:null};W([Y.ArrayFunctions]);A.executeScript=async function(a,b){let c=b.spatialReference;if(null===c||void 0===c)c=new P({wkid:102100});let d=null;a.usesModules&&(d=new M.ArcadeModuleLoader(new Map,a.loadedModules));const g=U(b.vars,b.customfunctions,
b.timeZone);b={spatialReference:c,services:b.services,exports:{},libraryResolver:d,abortSignal:void 0===b.abortSignal||null===b.abortSignal?{aborted:!1}:b.abortSignal,globalScope:g,console:b.console??V,timeZone:b.timeZone??null,lrucache:b.lrucache,interceptor:b.interceptor,localScope:null,depthCounter:{depth:1}};a=await h(b,a);a instanceof e.returnResult&&(a=a.value);a instanceof e.implicitResult&&(a=a.value);a===e.voidOperation&&(a=null);if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,
null);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);if(e.isFunctionParameter(a))throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);return a};A.extend=W;A.functionHelper=C;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});