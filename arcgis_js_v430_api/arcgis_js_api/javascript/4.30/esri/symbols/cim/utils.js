// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["require","exports","./defaultCIMValues"],function(T,e,w){function E(a){return"function"===typeof a}function F(a){let b=a.length;for(;b--;)if(!" /-,\n".includes(a.charAt(b)))return!1;return!0}function G(a,b){"string"!==typeof a&&(a=String(a));switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function H(a){return a?[a[0],a[1],a[2],a[3]/255]:[0,0,0,0]}function I(a){return null!=a&&("CIMMarkerPlacementAlongLineRandomSize"===a.type||"CIMMarkerPlacementAlongLineSameSize"===
a.type||"CIMMarkerPlacementAlongLineVariableSize"===a.type||"CIMMarkerPlacementAtExtremities"===a.type||"CIMMarkerPlacementAtMeasuredUnits"===a.type||"CIMMarkerPlacementAtRatioPositions"===a.type||"CIMMarkerPlacementOnLine"===a.type||"CIMMarkerPlacementOnVertices"===a.type)}function A(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=A(b),null!=a)return a;break;case "CIMTextSymbol":return A(a.symbol);case "CIMSolidFill":return a.color}return null}
function B(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a=a.symbolLayers)for(const b of a)if(a=B(b),null!=a)return a;break;case "CIMTextSymbol":return B(a.symbol);case "CIMSolidStroke":return a.color}}function C(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=C(b),void 0!==a)return a;break;case "CIMTextSymbol":return C(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}}
function x(a){return a?a.charAt(0).toLowerCase()+a.substring(1):a}function J(a){if(null==a)return!1;if(Array.isArray(a))return a.every(b=>J(b));switch(typeof a){case "string":return!!a;case "number":return!isNaN(a)}}function K(a,b){if("color"===b||"outlinecolor"===b||"backgroundcolor"===b||"borderlinecolor"===b||"tintcolor"===b)return[...w.defaultCIMColor[b]];const c=w.defaultCIMValues[a];if(!c)throw Error(`InternalError: default value for type ${a}.`);return c[b]}function D(a){if(null==a)return"Normal";
switch(a.type){case "CIMTextSymbol":return a.textCase??"Normal";case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var b=a.symbolLayers;if(!b)break;for(var c of b)if("CIMVectorMarker"===c.type)return D(c);break;case "CIMVectorMarker":if(c=a.markerGraphics)for(b of c)if(b.symbol)return D(b.symbol)}return"Normal"}function L(a,b){return null!==b?(b=b.get(a))?b.name:a:a}function M(a,b,c,d,f){return(c=c*Math.PI/180)?(Math.sin(c)*a+Math.cos(c)*b)*d+f:b*d+f}function N(a,b,c,d,f){return(c=
c*Math.PI/180)?(Math.cos(c)*a-Math.sin(c)*b)*d+f:a*d+f}e.adjustTextCase=G;e.analyzeTextParts=function(a,b){const c=[];var d=0;let f=-1;do f=a.indexOf("[",d),f>=d&&(f>d&&(d=a.substr(d,f-d),c.push([d,null,F(d)])),d=f+1,f=a.indexOf("]",d),f>=d&&(f>d&&(d=a.substr(d,f-d),(d=b[d])&&c.push([null,d,!1])),d=f+1));while(-1!==f);d<a.length-1&&(a=a.substr(d),c.push([a,null,F(a)]));return c};e.applyParentTransform=function(a,b,c,d,f,h){const {infos:v}=h;h=1;let k=0;var l=0,q=0;for(const {offsetX:g,offsetY:t,rotation:m,
size:p,frameHeight:r,rotateClockWise:u}of v)l=N(g,t,k,h,l),q=M(g,t,k,h,q),r&&(h*=p/r),k=u?k-m:k+m;l=N(d,f,k,h,l);d=M(d,f,k,h,q);return{size:a*h,rotation:c?k-b:k+b,offsetX:l,offsetY:d}};e.assignTextValuesFromFeature=function(a,b,c,d){let f="",h=null;for(const v of b){const [k,l,q]=v;if(k)q?h=k:(h&&(f+=h,h=null),f+=k);else if(b=l,null!=c&&(b=L(l,c)),b=a.attributes[b])h&&(f+=h,h=null),f+=b}return G(f,d)};e.attributesToFields=function(a){return(a?Object.keys(a):[]).map(b=>({name:b,alias:b,type:"string"===
typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}))};e.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};e.evaluateValueOrFunction=function(a,b,c,d){return E(a)?a(b,c,d):a};e.fromCIMFontDecoration=function(a){return a.underline?"underline":a.strikethrough?"line-through":"none"};e.fromCIMFontStyle=function(a){let b="normal",c="normal";a&&(a=a.toLowerCase(),a.includes("italic")?b="italic":a.includes("oblique")&&(b="oblique"),a.includes("bold")?c="bold":a.includes("light")&&(c="lighter"));return{style:b,
weight:c}};e.fromCIMHorizontalAlignment=function(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};e.fromCIMVerticalAlignment=function(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};e.getDefaultCIMValue=K;e.getEnum=(a,b)=>null==a?b:a;e.getFieldName=L;e.getFillColor=A;e.getFontStyle=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "italic":return"italic";
case "oblique":return"oblique";default:return"normal"}};e.getFontWeight=function(a){if(!a)return"normal";switch(a.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};e.getNumericValue=(a,b=0)=>null==a||isNaN(a)?b:a;e.getSize=function(a){if(a)switch(a.type){case "CIMTextSymbol":return a.height;case "CIMPointSymbol":var b=0;if(a.symbolLayers)for(var c of a.symbolLayers)if(c)switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":a=
c.size??w.defaultCIMValues.CIMVectorMarker.size,a>b&&(b=a)}return b;case "CIMLineSymbol":case "CIMPolygonSymbol":c=0;if(a.symbolLayers)for(b of a.symbolLayers)if(b)switch(b.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":a=b.width;null!=a&&a>c&&(c=a);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":b.markerPlacement&&I(b.markerPlacement)&&(a=b.size??w.defaultCIMValues.CIMVectorMarker.size,a>
c&&(c=a));break;case "CIMPictureFill":a=b.height,null!=a&&a>c&&(c=a)}return c}};e.getStrokeColor=B;e.getStrokeWidth=C;e.getTextCasing=D;e.getTintColor=a=>a.tintColor?H(a.tintColor):[255,255,255,1];e.getValueOrExpression=function(a,b,c){let d=b[x(c)];null==d&&(d=K(b.type,c));null!=b.primitiveName&&(a=a[b.primitiveName],null!=a&&(a=a[c],null!=a&&(d="string"===typeof a||"number"===typeof a||Array.isArray(a)?a:{valueExpressionInfo:a,defaultValue:d})));if(null==d)throw Error(`Failed to derive a value or an expression for "${c}".`);
return d};e.importGeometryEngine=function(){return new Promise((a,b)=>T(["../../geometry/geometryEngineJSON"],a,b))};e.isCIMFill=function(a){return null!=a&&("CIMGradientFill"===a.type||"CIMHatchFill"===a.type||"CIMPictureFill"===a.type||"CIMSolidFill"===a.type||"CIMWaterFill"===a.type)};e.isCIMMarker=function(a){return"CIMVectorMarker"===a.type||"CIMPictureMarker"===a.type||"CIMBarChartMarker"===a.type||"CIMCharacterMarker"===a.type||"CIMPieChartMarker"===a.type||"CIMStackedBarChartMarker"===a.type};
e.isCIMMarkerStrokePlacement=I;e.isCIMStroke=function(a){return"CIMGradientStroke"===a.type||"CIMPictureStroke"===a.type||"CIMSolidStroke"===a.type};e.isFeatureValueFn=E;e.isGeometryEngineRequired=a=>{if(!a)return!1;for(const b of a)switch(b.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};e.isSVGImage=a=>a.includes("data:image/svg+xml");e.isValidCIMValue=J;e.mapCIMSymbolToGeometryType=function(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";
case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};e.normalizeAlpha=H;e.normalizeDashTemplate=function(a){a?.dashTemplate&&"string"===typeof a.dashTemplate&&(a.dashTemplate=a.dashTemplate.split(" ").map(Number));return a};e.normalizePrimitiveOverrideProps=function(a){return a.map(b=>({...b,propertyName:x(b.propertyName)}))};e.resampleHermite=function(a,b,c,d,f,h,v=!0){const k=b/f;c/=h;const l=Math.ceil(k/2),q=Math.ceil(c/2);
for(let m=0;m<h;m++)for(let p=0;p<f;p++){const r=4*(p+(v?h-m-1:m)*f);var g=0;let u=0,O=0,P=0,Q=0,R=0,S=0;const U=(m+.5)*c;for(let y=Math.floor(m*c);y<(m+1)*c;y++){var t=Math.abs(U-(y+.5))/q;const V=(p+.5)*k;t*=t;for(let z=Math.floor(p*k);z<(p+1)*k;z++){let n=Math.abs(V-(z+.5))/l;g=Math.sqrt(t+n*n);-1<=g&&1>=g&&(g=2*g*g*g-3*g*g+1,0<g&&(n=4*(z+y*b),S+=g*a[n+3],O+=g,255>a[n+3]&&(g=g*a[n+3]/250),P+=g*a[n],Q+=g*a[n+1],R+=g*a[n+2],u+=g))}}d[r]=P/u;d[r+1]=Q/u;d[r+2]=R/u;d[r+3]=S/O}};e.toCIMSymbolJSON=function(a){return a.data?.symbol??
null};e.toLowerCaseProps=function(a){const b={};for(const c in a){const d=a[c];b[x(c)]=d}return b};e.uncapitalize=x;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});