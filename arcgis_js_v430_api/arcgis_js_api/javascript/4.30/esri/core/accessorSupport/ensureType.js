// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define(["exports","../has","../Logger","../MapUtils"],function(f,V,P,Q){function C(a){return null==a?a:new Date(a)}function D(a){return null==a?a:!!a}function E(a){return null==a?a:a.toString()}function F(a){if(null==a)return a;a=parseFloat(a);return isNaN(a)?0:a}function G(a){return null==a?a:Math.round(parseFloat(a))}function H(a){return null}function y(a){return a?.constructor&&void 0!==a.constructor.__accessorMetadata__}function r(a,b){return null!=b&&a&&!(b instanceof a)}function I(a){return a?.Type?
"function"===typeof a.Type?a.Type:a.Type.base:null}function R(a,b){var c;(c=!b?.constructor)||(c=b.constructor,c=!(c&&"isCollection"in c));if(c)return z(a,b)?b:new a(b);c=I(a.prototype.itemType);const e=I(b.constructor.prototype.itemType);if(!c)return b;if(!e)return new a(b);if(c===e)return b;if(c.prototype.isPrototypeOf(e.prototype))return new a(b);z(a,b);return b}function z(a,b){return y(b)?(n().error("Accessor#set","Assigning an instance of '"+(b.declaredClass||"unknown")+"' which is not a subclass of '"+
u(a)+"'"),!0):!1}function J(a,b){return null==b?b:a&&"isCollection"in a?R(a,b):r(a,b)?z(a,b)?b:new a(b):b}function u(a){return a?.prototype?.declaredClass||"unknown"}function S(a){switch(a){case Number:return F;case v:return G;case Boolean:return D;case String:return E;case Date:return C;case w:return H;default:return Q.getOrCreateMapValue(T,a,()=>J.bind(null,a))}}function m(a,b){const c=S(a);return 1===arguments.length?c:c(b)}function t(a,b,c){return 1===arguments.length?t.bind(null,a):b?Array.isArray(b)?
b.map(e=>a(e,c)):[a(b,c)]:b}function K(a,b,c){return 0!==b&&Array.isArray(c)?c.map(e=>K(a,b-1,e)):a(c)}function x(a,b,c){if(2===arguments.length)return p=>x(a,b,p);if(!c)return c;c=K(a,b,c);let e=b;for(var h=c;0<e&&Array.isArray(h);)e--,h=h[0];if(void 0!==h)for(h=0;h<e;h++)c=[c];return c}function L(a,b){if(2===arguments.length)return L(a).call(null,b);const c=new Set,e=a.filter(d=>"function"!==typeof d),h=a.filter(d=>"function"===typeof d);for(const d of a)"string"!==typeof d&&"number"!==typeof d||
c.add(d);let p=null,g=null;return(d,q)=>{if(null==d)return d;const l=typeof d,M="string"===l||"number"===l;if(M&&(c.has(d)||h.some(k=>"string"===l&&k===String||"number"===l&&k===Number))||"object"===l&&h.some(k=>!r(d,k)))return d;M&&e.length?(p||=e.map(k=>"string"===typeof k?`'${k}'`:`${k}`).join(", "),n().error("Accessor#set",`'${d}' is not a valid value for this property, only the following values are valid: ${p}`)):"object"===typeof d&&h.length?(g||=h.map(k=>u(k)).join(", "),n().error("Accessor#set",
`'${d}' is not a valid value for this property, value must be one of ${g}`)):n().error("Accessor#set",`'${d}' is not a valid value for this property`);q&&(q.valid=!1);return null}}function N(a,b){if(2===arguments.length)return N(a).call(null,b);const c={},e=[],h=[];for(const g in a.typeMap){const d=a.typeMap[g];c[g]=m(d);e.push(u(d));h.push(g)}const p="string"===typeof a.key?g=>g[a.key]:a.key;return g=>{if(a.base&&!r(a.base,g)||null==g)return g;var d=p(g)||a.defaultKeyValue;const q=c[d];if(!q)return n().error("Accessor#set",
`Invalid property value, value needs to be one of ${`'${e.join("', '")}'`}, or a plain object that can autocast (having .type = ${`'${h.join("', '")}'`})`),null;if(!r(a.typeMap[d],g))return g;if("string"===typeof a.key&&!y(g)){d={};for(const l in g)l!==a.key&&(d[l]=g[l]);return q(d)}return q(g)}}function O(a){switch(a.type){case "native":return m(a.value);case "array":return t(O(a.value));case "one-of":return U(a);default:return null}}function U(a){let b=null;return(c,e)=>{if(A(c,a))return c;null==
b&&(b=B(a));n().error("Accessor#set",`Invalid property value, value needs to be of type ${b}`);e&&(e.valid=!1);return null}}function B(a){switch(a.type){case "native":switch(a.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case v:return"integer";case Date:return"date";case w:return"null";default:return u(a.value)}case "array":return`array of ${B(a.value)}`;case "one-of":return a=a.values.map(b=>B(b)),`one of ${a.slice(0,-1)} or ${a[a.length-1]}`}return"unknown"}
function A(a,b){if(null==a)return!0;switch(b.type){case "native":switch(b.value){case Number:case v:return"number"===typeof a;case Boolean:return"boolean"===typeof a;case String:return"string"===typeof a;case w:return null===a}return a instanceof b.value;case "array":return Array.isArray(a)?!a.some(c=>!A(c,b.value)):!1;case "one-of":return b.values.some(c=>A(a,c))}}const n=()=>P.getLogger("esri.core.accessorSupport.ensureTypes"),T=new WeakMap;class v{}class w{}f.Integer=v;f.Null=w;f.ensureArray=function(a,
b){return 1===arguments.length?t(c=>m(a,c)):t(c=>m(a,c),b)};f.ensureArrayTyped=t;f.ensureBoolean=D;f.ensureClass=J;f.ensureDate=C;f.ensureInteger=G;f.ensureLongFormType=O;f.ensureNArray=function(a,b,c){return 2===arguments.length?x(e=>m(a,e),b):x(e=>m(a,e),b,c)};f.ensureNArrayTyped=x;f.ensureNull=H;f.ensureNumber=F;f.ensureOneOf=L;f.ensureOneOfType=N;f.ensureString=E;f.ensureType=m;f.isClassedType=y;f.isLongFormType=function(a){if(!(a&&"type"in a))return!1;switch(a.type){case "native":case "array":case "one-of":return!0}return!1};
f.isOneOf=function(a){return Array.isArray(a)?!a.some(b=>{b=typeof b;return!("string"===b||"number"===b||"function"===b&&1<a.length)}):!1};f.requiresType=r;f.types={native(a){return{type:"native",value:a}},array(a){return{type:"array",value:a}},oneOf(a){return{type:"one-of",values:a}}};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});