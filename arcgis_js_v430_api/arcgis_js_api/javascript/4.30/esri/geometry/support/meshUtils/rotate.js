// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),
function(C,H,I,J,u,D,K,L,y,q,M,N,O,B,n,P,Q,R,d,S){function v(a,b,c,z=q.ZEROS){if(null!=a)for(u.fromRotation(A,n.angleRad(b),n.axis(b)),b=0;b<a.length;b+=c){for(var h=0;3>h;h++)w[h]=a[b+h]-z[h];y.transformMat4(w,w,A);for(h=0;3>h;h++)a[b+h]=w[h]+z[h]}}const k=()=>H.getLogger("esri.geometry.support.meshUtils.rotate"),w=q.create(),E=D.create(),x=n.create(),A=D.create(),F=J.create(),m=q.create(),G=L.create();C.rotate=function(a,b,c){if(a.vertexAttributes?.position&&0!==b[3]){var {spatialReference:z,vertexSpace:h}=
a,f=c?.origin??a.anchor;c=R.performGlobalOperation(k,h,z,c?.geographic);if(Q.isMeshWithRelativeVertexSpace(a))a:{a.transform??(a.transform=new P);const {vertexSpace:p,transform:g,spatialReference:l}=a,[r,t,T]=p.origin;c=new M({x:r,y:t,z:T,spatialReference:l});var e=w;if(c.equals(f))y.set(e,0,0,0);else if(!S.projectPointToVertexSpace(e,f,a)){d.logProjectionError(k(),f.spatialReference,l,d.loadProjectErrorMessage);break a}K.setAxisAngle(G,n.axis(b),n.angleRad(b));a=u.fromRotationTranslationScaleOrigin(E,
G,q.ZEROS,q.ONES,e);({localMatrix:b}=g);a=u.multiply(E,a,b);g.scale=u.getScaling(q.create(),a);u.scale(a,a,y.inverse(w,g.scale));b=g.rotationAxis;g.rotation=n.fromMatrix(a);0===g.rotationAngle&&(g.rotationAxis=b);g.translation=u.getTranslation(q.create(),a)}else if(c)a:{c=a.spatialReference;e=N.getSphericalPCPF(c);if(!B.projectPointToVector(f,m,e)&&(d.logProjectionError(k(),f.spatialReference,e,"Falling back to mesh origin"),!B.projectPointToVector(a.origin,m,e))){d.logProjectionError(k(),a.origin.spatialReference,
e);break a}f=a.vertexAttributes.position;const p=a.vertexAttributes.normal,g=a.vertexAttributes.tangent,l=new Float64Array(f.length),r=null!=p?new Float32Array(p.length):null,t=null!=g?new Float32Array(g.length):null;O.computeTranslationToOriginAndRotation(e,m,A,e);I.fromMat4(F,A);y.transformMat3(n.axis(x),n.axis(b),F);x[3]=b[3];if(d.projectToPCPF(f,c,l))if(null==p||null==r||d.projectNormalToPCPF(p,f,l,c,r))if(null==g||null==t||d.projectTangentToPCPF(g,f,l,c,t))if(v(l,x,3,m),d.projectFromPCPF(l,f,
c)){if(null!=p&&null!=r&&(v(r,x,3),!d.projectNormalFromPCPF(r,f,l,c,p))){d.logProjectionError(k(),e,c);break a}if(null!=g&&null!=t&&(v(t,x,4),!d.projectTangentFromPCPF(t,f,l,c,g))){d.logProjectionError(k(),e,c);break a}a.vertexAttributesChanged()}else d.logProjectionError(k(),e,c);else d.logProjectionError(k(),c,e);else d.logProjectionError(k(),c,e);else d.logProjectionError(k(),c,e)}else B.projectPointToVector(f,m,a.spatialReference)?(v(a.vertexAttributes.position,b,3,m),v(a.vertexAttributes.normal,
b,3),v(a.vertexAttributes.tangent,b,4),a.vertexAttributesChanged()):(b=a.origin,m[0]=b.x,m[1]=b.y,m[2]=b.z,d.logProjectionError(k(),f.spatialReference,a.spatialReference,d.loadProjectErrorMessage))}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});