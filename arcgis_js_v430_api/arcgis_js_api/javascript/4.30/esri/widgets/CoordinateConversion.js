// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Logger ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./CoordinateConversion/CoordinateConversionViewModel ./CoordinateConversion/support/Conversion ../chunks/componentsUtils ./support/globalCss ./support/Heading ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(r,h,x,D,m,E,f,K,F,G,y,z,H,t,A,I,p,B,d,u){const C={settingsButton:!0,inputButton:!0,captureButton:!0,expandButton:!0};f=class extends G{constructor(a,b){super(a,b);this._popupMessage=null;this._clipboardPopupTimeoutId=this._popupTimeoutId=void 0;this._coordinateInput=null;this._goToEnabled=this._badInput=!1;this._previewConversion=this._settingsFormat=this._conversionFormat=null;this._inputVisible=this._settingsVisible=this._popupVisible=this._clipboardPopupVisible=this._expanded=!1;this.headingLevel=
4;this.messagesCommon=this.messages=null;this.orientation="auto";this.viewModel=new y;this.visibleElements={...C}}loadDependencies(){return H.loadCalciteComponents({button:()=>new Promise((a,b)=>r(["../chunks/calcite-button"],a,b)),checkbox:()=>new Promise((a,b)=>r(["../chunks/calcite-checkbox"],a,b)),input:()=>new Promise((a,b)=>r(["../chunks/calcite-input"],a,b)),label:()=>new Promise((a,b)=>r(["../chunks/calcite-label"],a,b)),option:()=>new Promise((a,b)=>r(["../chunks/calcite-option"],a,b)),select:()=>
new Promise((a,b)=>r(["../chunks/calcite-select"],a,b))})}get conversions(){return this.viewModel.conversions}set conversions(a){this.viewModel.conversions=a}get currentLocation(){return this.viewModel.currentLocation}set currentLocation(a){this.viewModel.currentLocation=a}get formats(){return this.viewModel.formats}set formats(a){this.viewModel.formats=a}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(a){this.viewModel.goToOverride=a}get icon(){return"coordinate-system"}set icon(a){this._overrideIfSome("icon",
a)}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get mode(){return this.viewModel.mode}set mode(a){this.viewModel.mode=a}set multipleConversions(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",a)}get multipleConversions(){const a=this._get("multipleConversions");return"boolean"===typeof a?a:!0}get locationSymbol(){return this.viewModel.locationSymbol}set locationSymbol(a){this.viewModel.locationSymbol=
a}get storageEnabled(){return this.viewModel.storageEnabled}set storageEnabled(a){this.viewModel.storageEnabled=a}get storageType(){return this.viewModel.storageType}set storageType(a){this.viewModel.storageType=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}castVisibleElements(a){return{...C,...a}}reverseConvert(a,b){return this.viewModel.reverseConvert(a,b)}render(){const a=this.viewModel?.state,b="disabled"===a?d.tsx("div",{key:"esri-coordinate__no-basemap"},this.messages?.noBasemap):
null,c=!b&&this._inputVisible?this._renderInputForm():null,e=!b&&this._settingsVisible?this._renderSettings():null,g=b||c||e?null:this._renderConversionsView(),k=this._popupVisible?this._renderPopup():null;return d.tsx("div",{class:this.classes("esri-coordinate-conversion",t.globalCss.widget,{["esri-coordinate-conversion--capture-mode"]:"capture"===this.mode,[t.globalCss.disabled]:"loading"===a,["esri-coordinate-conversion--no-basemap"]:"disabled"===a})},k,b,g,e,c)}_addConversion(a){a=a.target;var b=
a.selectedOption.value;const c=a["data-index"];null!=b&&null!=c&&(b=new z({format:b}),a.value="default",0<=c?(this.conversions.removeAt(c),this.conversions.add(b,c)):this.conversions.add(b))}_findSettingsFormat(){return this._settingsFormat||this.conversions.reduceRight((a,b)=>{b=b.format;return b?.hasDisplayProperties?b:a},null)||this.formats.find(a=>a.hasDisplayProperties)}_hidePopup(){this._popupTimeoutId&&(clearTimeout(this._popupTimeoutId),this._popupTimeoutId=void 0);this._popupVisible=!1;this._popupMessage=
null;this.scheduleRender()}_hideClipboardPopup(){this._clipboardPopupTimeoutId&&(clearTimeout(this._clipboardPopupTimeoutId),this._clipboardPopupTimeoutId=void 0);this._clipboardPopupVisible=!1;this.scheduleRender()}_onConvertComplete(){this._inputVisible=!1;this._coordinateInput.value=""}_onCopy(a){const b=a.currentTarget["data-conversion"]?.displayCoordinate;null!=b&&(a.clipboardData?.setData("text/plain",b),this._showClipboardPopup(),a.preventDefault())}_processUserInput(a){a=D.maybeProperty(a,
"key");const b=this.viewModel;"Enter"!==a&&a?this._badInput&&(this._badInput=!1):(a=this._conversionFormat||this.conversions.at(0).format)&&this._reverseConvert(this._coordinateInput.value,a).then(c=>{"capture"===this.mode?b.resume():this.mode="capture";this.currentLocation=c;b.setLocation(c);this._onConvertComplete()}).catch(c=>{x.getLogger(this).error(c);this._showPopup(this.messages?.invalidCoordinate);this._badInput=!0})}async _reverseConvert(a,b){const c=this.viewModel;a=await b.reverseConvert(a);
this._goToEnabled&&a&&c.goToLocation(a).catch(e=>{x.getLogger(this).warn(e);this._showPopup(this.messages?.locationOffBasemap)});return a}_setInputFormat(a){a=a.target.selectedOption.value;null!=a&&(this._conversionFormat=a)}_setPreviewConversion(){const a=this._findSettingsFormat(),b=this.viewModel;if(a){const c=this.conversions.find(e=>e.format===a);this._previewConversion=new z({format:a,position:{location:this.currentLocation,coordinate:c?.position?.coordinate}});this._previewConversion.position?.coordinate||
b.previewConversion(this._previewConversion)}}_setSettingsFormat(a){a=a.target.selectedOption.value;null!=a&&(this._settingsFormat=a,this._setPreviewConversion())}_showClipboardPopup(){this._clipboardPopupVisible?clearTimeout(this._clipboardPopupTimeoutId):this._clipboardPopupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hideClipboardPopup()},750)}_showPopup(a,b=2500){this._popupMessage=a;this._popupVisible?clearTimeout(this._popupTimeoutId):
this._popupVisible=!0;this.scheduleRender();this._popupTimeoutId=setTimeout(()=>{this._popupTimeoutId=void 0;this._hidePopup()},b)}_toggleGoTo(){this._goToEnabled=!this._goToEnabled}_updateCurrentPattern(a){a.stopPropagation();a=a.target;const b=this._findSettingsFormat();b&&(b.currentPattern=a.value)}_renderConversion(a,b){const {messages:c}=this;if(!c)return d.tsx("li",null);const {format:e}=a,g=e?.label??"",k=`${this.id}__list-item-${b}`,n=`${g} ${c.conversionOutputSuffix}`;var l=0===b;const q=
l||this._expanded,v=l?this._renderFirstConversion(a):this._renderTools(b,a,k);l=l&&!a.displayCoordinate?c.noLocation:a.displayCoordinate;l=d.tsx("div",{"aria-label":l,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabIndex:0,title:l??""},l);const w=this._renderOptions(this.formats.filter(J=>J!==e));return q?d.tsx("li",{"aria-label":n,class:"esri-coordinate-conversion__row",id:k,key:a,role:"group",tabIndex:0,title:n},d.tsx("calcite-select",{"aria-controls":k,bind:this,
class:"esri-coordinate-conversion__select-row","data-index":b,label:c.selectFormat,scale:"s",onCalciteSelectChange:this._addConversion},d.tsx("calcite-option",{label:g.toUpperCase(),selected:!0},g.toUpperCase()),w),l,v):null}_renderCopyButton(a){const b=this._clipboardPopupVisible&&this._renderClipboardPopup(),{messagesCommon:c}=this;return c?d.tsx("li",{"aria-label":c.copy,bind:this,class:this.classes(t.globalCss.widgetButton,"esri-coordinate-conversion__row-button"),"data-conversion":a,onclick:this._copyCoordinateOutput,
oncopy:this._onCopy,onkeydown:this._copyCoordinateOutput,role:"button",tabIndex:0,title:c.copy},b,d.tsx("span",{"aria-hidden":"true",class:I.legacyIcon.duplicate})):d.tsx("li",null)}_renderFirstConversion(a){var b=this.id;const {messages:c,messagesCommon:e,multipleConversions:g,visibleElements:k}=this;if(!e||!c)return d.tsx("ul",null);var n="live"===this.mode?c.captureMode:c.liveMode;const l=this._expanded?e.collapse:e.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):
null;b=g&&k.expandButton&&this._renderIconButton({iconType:this._expanded?"chevron-down":"chevron-up",clickFunction:this._toggleExpand,classes:["esri-coordinate-conversion__expand-button"],attributes:{"aria-controls":`${b}__${"esri-coordinate-conversion__conversion-list"}`,label:l}});n=!g&&k.captureButton&&this._renderIconButton({iconType:"live"===this.mode?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:["esri-coordinate-conversion__mode-toggle"],attributes:{label:n}});return d.tsx("ul",
{class:"esri-coordinate-conversion__tools"},a,b,n)}_renderInputForm(){const a=this._conversionFormat||this.conversions.at(0).format;var b=this.formats.findIndex(q=>q.name===a?.name),c=this.id;const e=`${c}__${"esri-coordinate-conversion__input-coordinate"}`;c=`${c}__${"esri-coordinate-conversion__input-coordinate"}__header`;b=this._renderOptions(this.formats,!0,b);const {messages:g,messagesCommon:k,headingLevel:n}=this;if(!k||!g)return d.tsx("div",null);const l=this._renderIconButton({iconType:u.isRTL(this.container)?
"arrow-right":"arrow-left",clickFunction:this._toggleInputVisibility,attributes:{label:k.back}});return d.tsx("div",{"aria-labelledby":c,class:"esri-coordinate-conversion__input-form",key:"esri-coordinate-conversion__input-form",role:"search"},d.tsx("div",{class:"esri-coordinate-conversion__heading"},l,d.tsx(A.Heading,{class:t.globalCss.heading,id:c,level:n},g.inputCoordTitle)),d.tsx("div",{class:"esri-coordinate-conversion__input-group"},d.tsx("calcite-select",{"aria-controls":e,bind:this,class:"esri-coordinate-conversion__input-select",
label:g.selectFormat,scale:"s",onCalciteSelectChange:this._setInputFormat},b),d.tsx("calcite-input",{afterCreate:u.storeNode,"aria-labelledby":c,bind:this,class:"esri-coordinate-conversion__input-coordinate","data-format":a,"data-node-ref":"_coordinateInput",id:e,onkeydown:this._processUserInput,placeholder:g.inputCoordTitle,required:!0,scale:"s",spellcheck:!1,status:this._badInput?"invalid":"idle"})),d.tsx("div",{class:"esri-coordinate-conversion__input-group"},d.tsx("calcite-label",{layout:"inline",
scale:"s"},d.tsx("calcite-checkbox",{bind:this,checked:this._goToEnabled,onCalciteCheckboxChange:this._toggleGoTo}),g.goTo),d.tsx("calcite-button",{appearance:"outline",bind:this,kind:"neutral",onclick:this._processUserInput,type:"button",width:"auto"},g.convert)))}_renderConversionsView(){var {messages:a}=this;if(!a)return d.tsx("div",null);const b=`${this.id}__${"esri-coordinate-conversion__conversion-list"}`,c=this._renderPrimaryTools(),e=this._renderOptions(this.formats),g=this.conversions.map((k,
n)=>this._renderConversion(k,n)).toArray();a=this._expanded?d.tsx("div",{class:"esri-coordinate-conversion__row"},d.tsx("calcite-select",{"aria-controls":b,bind:this,"data-index":-1,label:a.addConversion,scale:"s",onCalciteSelectChange:this._addConversion},d.tsx("calcite-option",{disabled:!0,selected:!0,value:"default"},a.addConversion),e),c):null;return d.tsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",{["esri-coordinate-conversion__conversions-view--expanded"]:this._expanded,
["esri-coordinate-conversion__conversions-view--expand-up"]:"expand-up"===this.orientation,["esri-coordinate-conversion__conversions-view--expand-down"]:"expand-down"===this.orientation}),key:"esri-coordinate-conversion__main-view"},d.tsx("ul",{"aria-expanded":this._expanded?"true":"false",class:"esri-coordinate-conversion__conversion-list",id:b},g),a)}_renderOptions(a,b,c){const e=this.conversions.at(0),g=e.format?.name;return a.map((k,n)=>{const l=b||!e?!1:g===k.name||this.conversions.map(q=>q.format?.name).includes(k.name);
return d.tsx("calcite-option",{disabled:l,key:k.name??"unnamed-format",label:k.label.toUpperCase(),selected:n===c,value:k},k.label)}).toArray()}_renderPopup(){return d.tsx("div",{class:"esri-coordinate-conversion__popup",role:"alert"},this._popupMessage)}_renderClipboardPopup(){const {messages:a}=this;return a?d.tsx("div",{class:this.classes("esri-coordinate-conversion__popup","esri-coordinate-conversion__clipboard-popup"),role:"alert"},a.copySuccessMessage):d.tsx("div",null)}_renderPrimaryTools(){const {messages:a,
visibleElements:b}=this;if(!a)return d.tsx("ul",null);var c="live"===this.mode?a.captureMode:a.liveMode;const e=b.inputButton&&this._renderIconButton({iconType:"pencil",clickFunction:this._toggleInputVisibility,attributes:{label:a.inputCoordTitle}});c=b.captureButton&&this._renderIconButton({iconType:"live"===this.mode?"pin-tear":"pin-tear-f",clickFunction:this._toggleMode,classes:["esri-coordinate-conversion__mode-toggle"],attributes:{label:c}});const g=b.settingsButton&&this._renderIconButton({iconType:"gear",
clickFunction:this._toggleSettingsVisibility,attributes:{label:a.settingsTitle}});return d.tsx("ul",{class:"esri-coordinate-conversion__tools"},e,c,g)}_renderSettings(){var a=this.id;const b=`${a}__${"esri-coordinate-conversion__pattern-input"}`,c=`${a}__${"esri-coordinate-conversion__pattern-input"}__header`;a=`${a}__${"esri-coordinate-conversion__preview-coordinate"}`;var e=this.formats.filter(w=>w.hasDisplayProperties),g=this._findSettingsFormat(),k=g?e.indexOf(g):-1;e=this._renderOptions(e,!0,
k);g=g?.currentPattern;const {messages:n,messagesCommon:l,headingLevel:q}=this;if(!l||!n)return d.tsx("div",null);k=this._renderIconButton({iconType:u.isRTL(this.container)?"arrow-right":"arrow-left",clickFunction:this._toggleSettingsVisibility,attributes:{label:l.back}});const v=this._renderIconButton({iconType:"refresh",clickFunction:this._setDefaultPattern,attributes:{label:n.defaultPattern}});return d.tsx("div",{"aria-labelledby":c,class:"esri-coordinate-conversion__settings",key:"esri-coordinate-conversion__settings"},
d.tsx("div",{class:"esri-coordinate-conversion__heading"},k,d.tsx(A.Heading,{class:t.globalCss.heading,id:c,level:q},n.settingsTitle)),d.tsx("div",{class:"esri-coordinate-conversion__settings-group"},d.tsx("label",{for:b},n.changeCoordinateDisplay),d.tsx("calcite-select",{bind:this,label:n.selectFormat,width:"full",onCalciteSelectChange:this._setSettingsFormat},e),d.tsx("div",{class:"esri-coordinate-conversion__settings-group-horizontal"},d.tsx("calcite-input",{"aria-controls":a,bind:this,class:"esri-coordinate-conversion__pattern-input",
id:b,spellcheck:!1,type:"text",value:g,onCalciteInputInput:this._updateCurrentPattern}),v)),d.tsx("div",{class:"esri-coordinate-conversion__settings-group"},d.tsx("label",null,l.preview,d.tsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabIndex:0},this._previewConversion?.displayCoordinate))))}_renderIconButton(a){const {iconType:b,clickFunction:c,classes:e,attributes:g}=a;return d.tsx("calcite-button",{appearance:"transparent",bind:this,class:this.classes(e),iconStart:b,kind:"neutral",
onclick:c,onkeydown:c,...g})}_renderTools(a,b,c){b=b.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(b):null;const {messages:e}=this;if(!e)return d.tsx("ul",null);a=this._renderIconButton({iconType:"x",clickFunction:this._removeConversion,attributes:{"aria-controls":c,label:e.removeConversion,"data-index":a}});return d.tsx("ul",{class:"esri-coordinate-conversion__tools",role:"listitem"},b,d.tsx("li",{class:this.classes("esri-coordinate-conversion__row-button")},a))}_copyCoordinateOutput(a){a=
a.target;if(!("createTextRange"in document.body)){const b=window.getSelection(),c=document.createRange();c.selectNodeContents(a);b?.removeAllRanges();b?.addRange(c)}document.execCommand("copy")}_removeConversion(a){a=a.currentTarget["data-index"];null!=a&&this.conversions.removeAt(a)}_setDefaultPattern(a){a.stopPropagation();if(a=this._findSettingsFormat())a.currentPattern=a.defaultPattern}_toggleExpand(){this._expanded=!this._expanded}_toggleInputVisibility(){this._inputVisible=!this._inputVisible;
this._popupVisible&&this._hidePopup();this._inputVisible?this.viewModel.pause():this.viewModel.resume()}_toggleMode(){this.mode="live"===this.mode?"capture":"live"}_toggleSettingsVisibility(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()}};h.__decorate([m.property()],f.prototype,"conversions",null);h.__decorate([m.property()],f.prototype,"currentLocation",null);
h.__decorate([m.property()],f.prototype,"formats",null);h.__decorate([m.property()],f.prototype,"goToOverride",null);h.__decorate([m.property()],f.prototype,"headingLevel",void 0);h.__decorate([m.property()],f.prototype,"icon",null);h.__decorate([m.property()],f.prototype,"label",null);h.__decorate([m.property(),B.messageBundle("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],f.prototype,"messages",void 0);h.__decorate([m.property(),B.messageBundle("esri/t9n/common")],f.prototype,"messagesCommon",
void 0);h.__decorate([m.property()],f.prototype,"mode",null);h.__decorate([m.property()],f.prototype,"orientation",void 0);h.__decorate([m.property()],f.prototype,"multipleConversions",null);h.__decorate([m.property()],f.prototype,"locationSymbol",null);h.__decorate([m.property()],f.prototype,"storageEnabled",null);h.__decorate([m.property()],f.prototype,"storageType",null);h.__decorate([m.property()],f.prototype,"view",null);h.__decorate([m.property({type:y})],f.prototype,"viewModel",void 0);h.__decorate([m.property()],
f.prototype,"visibleElements",void 0);h.__decorate([E.cast("visibleElements")],f.prototype,"castVisibleElements",null);h.__decorate([p.accessibleHandler()],f.prototype,"_copyCoordinateOutput",null);h.__decorate([p.accessibleHandler()],f.prototype,"_removeConversion",null);h.__decorate([p.accessibleHandler()],f.prototype,"_setDefaultPattern",null);h.__decorate([p.accessibleHandler()],f.prototype,"_toggleExpand",null);h.__decorate([p.accessibleHandler()],f.prototype,"_toggleInputVisibility",null);h.__decorate([p.accessibleHandler()],
f.prototype,"_toggleMode",null);h.__decorate([p.accessibleHandler()],f.prototype,"_toggleSettingsVisibility",null);return f=h.__decorate([F.subclass("esri.widgets.CoordinateConversion")],f)});