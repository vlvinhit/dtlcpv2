// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../LayerList/ListItem ../LayerList/support/layerListUtils".split(" "),function(g,e,x,f,h,z,A,B,y,t,r){const q=e.ofType(t);e=class extends x.EventedAccessor{constructor(a){super(a);this.baseItems=new q;this.baseListItemCreatedFunction=null;this.listModeDisabled=
this.checkPublishStatusEnabled=!1;this.referenceListItemCreatedFunction=null;this.referenceItems=new q;this.view=null;this._compileBaseList=this._compileBaseList.bind(this);this._compileReferenceList=this._compileReferenceList.bind(this)}initialize(){this.addHandles([f.watch(()=>[this.view?.map?.basemap,!0===this.view?.ready,this.view?.basemapView],()=>this._watchBasemapLayers(),f.initial),f.watch(()=>[this.baseListItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._baseListItemCreatedFunctionChanged()),
f.watch(()=>[this.referenceListItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._referenceListItemCreatedFunctionChanged())],"view")}destroy(){this.view=null;this._removeAllBaseItems();this._removeAllReferenceItems()}get basemapTitle(){return this.view?.map?.basemap?.title??null}set basemapTitle(a){this._override("basemapTitle",a)}get state(){return this.view?.ready?"ready":this.view?"loading":"disabled"}get totalBaseItems(){return this.baseItems.flatten(a=>a.children).length}get totalReferenceItems(){return this.referenceItems.flatten(a=>
a.children).length}triggerAction(a,b){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:b})}moveListItem({targetItem:a,fromParentItem:b,toParentItem:c,from:d,to:k,newIndex:n}){const l=a?.layer;if(l&&"subtype-sublayer"!==l.type&&"sublayer"!==l.type){var p=this.view?.map?.basemap,m=p?.baseLayers,u=p?.referenceLayers;p=b?r.getItemLayers(b):"base"===d?m:u;m=c?r.getItemLayers(c):"base"===k?m:u;if(p&&m){var {baseItems:v,referenceItems:w}=this;k=c?.children||("base"===k?v:w);n=m.length-n;a.parent=
c||null;(b?.children||("base"===d?v:w)).remove(a);p.remove(l);k.includes(a)||k.add(a,n);m.includes(l)||m.add(l,n);this._compileLists()}}}_createItemChangeHandles({items:a,key:b,callback:c}){this.removeHandles(b);c();a&&this.addHandles(a.on("change",()=>c()),b)}_createListItem({layer:a,type:b}){const {view:c,baseListItemCreatedFunction:d,referenceListItemCreatedFunction:k,checkPublishStatusEnabled:n,listModeDisabled:l}=this;return new t({layer:a,checkPublishStatusEnabled:n,listItemCreatedFunction:"base"===
b?d:k,listModeDisabled:l,view:c})}_watchLayersListMode({layers:a,key:b,callback:c}){this.removeHandles(b);a&&!this.listModeDisabled&&this.addHandles(f.watch(()=>a.filter(d=>"listMode"in d).map(d=>d.listMode).toArray(),()=>c()),b)}_getViewableLayers(a){return a?this.listModeDisabled?a:a.filter(b=>"hide"!==r.findLayerListMode(b)):void 0}_compileListItems({layers:a,items:b,key:c,type:d,callback:k}){this._watchLayersListMode({layers:a,key:c,callback:k});a=this._getViewableLayers(a);a?.length?(this._createNewItems({type:d,
items:b,layers:a}),this._removeItems({items:b,layers:a}),this._sortItems(b,a)):"base"===d?this._removeAllBaseItems():this._removeAllReferenceItems()}_compileReferenceList(){const {referenceItems:a}=this;this._compileListItems({type:"reference",layers:this.view?.map?.basemap?.referenceLayers,items:a,key:"base-layers-list-mode",callback:this._compileReferenceList})}_compileBaseList(){const {baseItems:a}=this;this._compileListItems({type:"base",layers:this.view?.map?.basemap?.baseLayers,items:a,key:"reference-layers-list-mode",
callback:this._compileBaseList})}_compileLists(){this._compileReferenceList();this._compileBaseList()}_createNewItems({items:a,layers:b,type:c}){b?.forEach(d=>{a.some(k=>k.layer===d)||a.add(this._createListItem({type:c,layer:d}))})}_removeItems({items:a,layers:b}){a&&a.forEach(c=>{c&&!b?.some(d=>c.layer===d)&&(this.removeHandles(`${"children"}-${c.uid}`),a.remove(c),c.destroy())})}_sortItems(a,b){a&&b&&a.sort((c,d)=>{c=b.indexOf(c.layer);d=b.indexOf(d.layer);return c>d?-1:c<d?1:0})}_removeAllBaseItems(){this.baseItems.drain(a=>
{this.removeHandles(`${"children"}-${a.uid}`);a.destroy()})}_removeAllReferenceItems(){this.referenceItems.drain(a=>{this.removeHandles(`${"children"}-${a.uid}`);a.destroy()})}_baseListItemCreatedFunctionChanged(){this._removeAllBaseItems();this._compileLists()}_referenceListItemCreatedFunctionChanged(){this._removeAllReferenceItems();this._compileLists()}_watchBasemapLayers(){const {view:a}=this;this.removeHandles(["base-layers","reference-layers","basemap","base-layer-views","reference-layer-views"]);
a?.ready?(this._compileLists(),this.addHandles([f.watch(()=>this.view?.map?.basemap?.baseLayers,b=>this._createItemChangeHandles({items:b,key:"base-layers",callback:this._compileBaseList}),f.initial),f.watch(()=>this.view?.map?.basemap?.referenceLayers,b=>this._createItemChangeHandles({items:b,key:"reference-layers",callback:this._compileReferenceList}),f.initial),f.watch(()=>this.view?.basemapView?.baseLayerViews,b=>this._createItemChangeHandles({items:b,key:"base-layer-views",callback:this._compileBaseList}),
f.initial),f.watch(()=>this.view?.basemapView?.referenceLayerViews,b=>this._createItemChangeHandles({items:b,key:"reference-layer-views",callback:this._compileReferenceList}),f.initial)],"basemap")):(this._removeAllBaseItems(),this._removeAllReferenceItems())}};g.__decorate([h.property({type:q,readOnly:!0})],e.prototype,"baseItems",void 0);g.__decorate([h.property()],e.prototype,"basemapTitle",null);g.__decorate([h.property()],e.prototype,"baseListItemCreatedFunction",void 0);g.__decorate([h.property()],
e.prototype,"checkPublishStatusEnabled",void 0);g.__decorate([h.property({nonNullable:!0})],e.prototype,"listModeDisabled",void 0);g.__decorate([h.property()],e.prototype,"referenceListItemCreatedFunction",void 0);g.__decorate([h.property({type:q,readOnly:!0})],e.prototype,"referenceItems",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"state",null);g.__decorate([h.property()],e.prototype,"totalBaseItems",null);g.__decorate([h.property()],e.prototype,"totalReferenceItems",null);g.__decorate([h.property()],
e.prototype,"view",void 0);return e=g.__decorate([y.subclass("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],e)});