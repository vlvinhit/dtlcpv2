// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("require exports ../../../Color ../../../symbols ../../../renderers/support/numberUtils ../../../smartMapping/renderers/support/referenceSizeUtils ../../../symbols/support/cimSymbolUtils ../../../symbols/support/utils ./utils ../../support/widgetUtils ../../../support/themeUtils ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol".split(" "),function(I,x,J,K,q,Q,R,D,E,ea,S,T,U){function V(a,b){const c=a.length-1;return a.map((d,g)=>E.createStopLabel(d,g,c,b))}function W(a,
b){a=a?.authoringInfo;const c="univariate-color-size"===a?.type;let d=[12,30];if(c){const g=b[0],m=b[b.length-1];d=b.map(h=>12+(h-g)/(m-g)*18)}c&&"below"===a?.univariateTheme&&d.reverse();return d}function L(a,b,c,d){const g="class-breaks"===a.type;a=g?a.classBreakInfos?.[0]?.symbol?.clone():a.uniqueValueInfos?.[0]?.symbol?.clone();if(!(a&&"type"in a&&"cim"===a.type))return null;Q.updateReferenceSizeSymbol(a,{color:d??(g?null:new J(F)),innerDotSize:24/c*b||1,outerRingSize:24});return a}function X(a,
b){const c=a.classBreakInfos,d=c.length;b=2>d||!(2<=b)?c[0].symbol.clone():c[d-1].symbol.clone();a.visualVariables.some(g=>"color"===g.type)&&(b.type.includes("3d")?M(b):N(b));return b}async function Y(a,b){if("flow"===a.type)return E.getSymbolForFlowRenderer(a,b);if("pie-chart"===a.type)return new T({color:null,outline:a.outline?.width?a.outline:new U});let c=null,d=null;"simple"===a.type?c=a.symbol:"class-breaks"===a.type?(c=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,d=1<a.length):"unique-value"===
a.type&&(a=a.uniqueValueInfos,c=a?.[0]?.symbol,d=null!=a&&1<a.length);if(!c||Z(c))return null;c=c.clone();if(b||d)c.type.includes("3d")?M(c):N(c);return c}function Z(a){return a?K.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(b=>b&&"fill"===b.type):!1:a.type.includes("fill"):!1}function M(a){"line-3d"===a.type?a.symbolLayers.forEach(b=>{b.material={color:u}}):a.symbolLayers.forEach(b=>{"icon"!==b.type||b.resource?.href?b.material={color:F}:(b.material={color:O},b.outline={color:u,size:1.5})})}
function N(a){const b=S.isDarkTheme();if("cim"===a.type)R.applyCIMSymbolColor(a,new J(F));else if(a.type.includes("line"))a.color=u;else if(a.color=b?u:O,"simple-marker"===a.type)a.outline?"#ffffff"===a.outline?.color?.toHex()&&(a.outline.color=u):a.outline={color:u,width:1.5}}async function aa(a,b,c,d){const g=(await new Promise((f,k)=>I(["../../../renderers/visualVariables/support/visualVariableUtils"],f,k))).getSizeRangeAtScale(a,c,d),m=g&&P(g);if(g&&m){var h=m.map(f=>{const k=g.minSize,e=g.maxSize,
n=a.minDataValue,l=a.maxDataValue;return f<=k?n:f>=e?l:(f-k)/(e-k)*(l-n)+n});h=q.round(h);for(let f=1;f<h.length-1;f++){const k=await ba(a,b,h[f],h[f-1],c,d);k&&(h[f]=k[0],m[f]=k[1])}return h}}function P(a){const b=a.minSize;a=(a.maxSize-b)/4;const c=[];for(let d=0;5>d;d++)c.push(b+a*d);return c}async function ba(a,b,c,d,g,m){const h=await v(a,b,c,g,m);d=await v(a,b,d,g,m);var f=q.numDigits(c),k=f.fractional,e=f.integer;let n=f=null;0<c&&1>c&&(f=10**k,c*=f,e=q.numDigits(c).integer);for(k=e-1;0<=k;k--){var l=
10**k;e=Math.floor(c/l)*l;l*=Math.ceil(c/l);null!=f&&(e/=f,l/=f);let r=(e+l)/2;[,r]=q.round([e,r,l],{indexes:[1]});const t=await v(a,b,e,g,m),y=await v(a,b,l,g,m),z=await v(a,b,r,g,m),A=q.percentChange(h,t,d,null),B=q.percentChange(h,y,d,null),G=q.percentChange(h,z,d,null);let w=20>=A.previous,p=20>=B.previous;w&&p&&(A.previous<=B.previous?(w=!0,p=!1):(p=!0,w=!1));w?n=[e,t]:p?n=[l,y]:20>=G.previous&&(n=[r,z]);if(n)break}return n}async function v(a,b,c,d,g){const {getSize:m}=await new Promise((h,f)=>
I(["../../../renderers/visualVariables/support/visualVariableUtils"],h,f));return m(a,c,{scale:d,view:g,shape:"simple-marker"===b.type?b.style:null})}function ca(a,b){a=a.clone();if(K.isSymbol3D(a))D.isVolumetricSymbol(a)||a.symbolLayers.forEach(c=>{"fill"!==c.type&&(c.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){const c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===
a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=b);return a}const O=[255,255,255],F=[200,200,200],u=[128,128,128];x.getRampStops=async function(a,b,c,d,g,m,h){var f=b.legendOptions?.customValues;const k=h||await Y(a,c);h=b.stops;var e=null!=b.minSize&&null!=b.maxSize;const n=h&&1<h.length;var l=!!b.target;if(k&&(f||e||n&&!l)){var r=D.isVolumetricSymbol(k),t=!1,y=e=null;e=r&&!n?q.round([b.minDataValue,b.maxDataValue]):f??await aa(b,k,d,g?.type);f=a?.authoringInfo;
var z=(l="univariate-color-size"===f?.type)&&"above-and-below"===f?.univariateTheme,A=!!E.getReferenceSizeAuthoringInfoVisualVariable(a);!e&&n&&(e=h.map(p=>p.value),t=h.some(p=>!!p.label),"flow"===a.type&&(e=q.round(e)),t&&(y=h.map(p=>p.label)));r&&null!=e&&2<e?.length&&!z&&(e=[e[0],e[e.length-1]]);if(!e)return null;l&&5!==e?.length&&(e=P({minSize:e[0],maxSize:e[e.length-1]}));var B=r?W(a,e):null,G=D.getSymbolOutlineSize(k),w=t?null:V(e,m);return(await Promise.all(e.map(async(p,C)=>{const H=r?B[C]:
await v(b,k,p,d,g?.type),da=!A||"class-breaks"!==a.type&&"unique-value"!==a.type?ca(z&&"class-breaks"===a.type?X(a,C):k,H):L(a,H,b.maxSize,c)??k;return{value:p,symbol:da,label:t?y[C]:w[C],size:A?24:H,outlineSize:G}}))).reverse()}};x.getReferenceSizeSymbol=L;x.realWorldMaxSize=30;x.realWorldMinSize=12;Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});