// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("exports ../../intl ../../core/arrayUtils ../../core/compilerUtils ../../core/lang ../../core/Logger ../../core/string ../../form/support/formUtils ../../layers/support/domainUtils ../../layers/support/fieldUtils ../../smartMapping/support/utils ../support/dateUtils ../../intl/substitute".split(" "),function(c,L,E,F,G,H,l,I,u,p,J,q,v){function w(a){const {fields:b,values:e}=a,f=a.timeZone??void 0;a=b.map((d,h)=>{let g=e[h];d.domain&&"coded-value"===d.domain.type&&(h=d.domain.codedValues.find(r=>
r.code===g),h?.name&&(g=h.name));if(J.isAnyDateField(d)||p.isTimeOnlyField(d))g=q.getLabelForDateFieldValue(d,g,{timeZone:f,...q.getIntlOptionsForField(d)});return[d.name,g]});return Object.fromEntries(a)}function x(a,b){return l.replace(l.replace(a,e=>`{${e.toLowerCase()}}`),Object.fromEntries(Object.entries(b).map(([e,f])=>[e.toLowerCase(),f])))}function y(a){return 1E7<=a||-1E7>=a}function K(a,{validationErrors:b}){return null!=a.max&&null!=a.min?b.outsideRange:null!=a.max?b.outsideRangeMax:b.outsideRangeMin}
const z=a=>"field"===a?.type,A=a=>"relationship"===a?.type,t=a=>a.reduce((b,e)=>"group"===e?.type?[...b,...e.inputs]:[...b,e],[]),m=(a,b)=>null!=a&&a.input?.type===b;c.LengthValidationError=void 0;(function(a){a.TOO_SHORT="length-validation-error::too-short";a.TOO_LONG="length-validation-error::too-long"})(c.LengthValidationError||(c.LengthValidationError={}));const B={type:"number"},C={type:"number",intlOptions:{notation:"scientific"}};c.capabilitiesAllowEditType=(a,b)=>{if(!a)return!0;({operations:a}=
a);switch(b){case "INSERT":return a.supportsAdd;case "UPDATE":case "DELETE":return a.supportsUpdate;default:return!0}};c.extractExpressionNameFromString=function(a){const [b,e]=a.split("expression/");return""===b&&e?e:(H.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${a} is not a valid expression reference of the form '${"expression/"}/expressionName'`),"")};c.flattenFieldInputs=a=>t(a).filter(z);c.flattenInputs=t;c.flattenRelationshipInputs=
a=>t(a).filter(A);c.formTemplateHasInvalidFields=function(a,b){return(b=b??("formTemplate"in a&&a.formTemplate))?(b.elements?.filter(I.isFieldElement)??[]).some(({fieldName:e})=>!a.fieldsIndex.get(e)):!1};c.getComputedAttributes=w;c.getErrorMessageForFieldInput=(a,b,e)=>{const {dataType:f,error:d,minLength:h,value:g,required:r}=a,n=b?.validationErrors;if(!n||!d)return null;if(r&&null===g)return n.cannotBeNull;if(d===u.DomainValidationError.VALUE_OUT_OF_RANGE||d===p.NumericRangeValidationError.OUT_OF_RANGE){const {field:D,
range:k}=a;a={type:"date",intlOptions:{timeZone:"date"===D.type&&e?e:void 0,...q.getIntlOptionsForField(D)}};b=K(k,b);return v.substitute(b,k,{format:{max:"date"===f?a:null!=k.max&&y(k.max)?C:B,min:"date"===f?a:null!=k.min&&y(k.min)?C:B}})}return d===u.DomainValidationError.INVALID_CODED_VALUE?n.invalidCodedValue:d===p.TypeValidationError.INVALID_TYPE?n.invalidType:d===c.LengthValidationError.TOO_SHORT?v.substitute(n.tooShort,{min:h}):null};c.getFieldsInTitleAndDesc=a=>{const b=[];if(a.formTemplate){const {description:e,
title:f}=a.formTemplate;a.fields?.forEach(d=>{const h=f&&l.templateHasKey(f,d.name),g=e&&l.templateHasKey(e,d.name);(h||g)&&b.push(d.name)})}return b};c.getIconForFeature=a=>{if(a){var b=a.layer;b=b&&"geometryType"in b?b.geometryType:void 0;a=a.geometry?.type;return"polyline"===a||"polyline"===b?"line":"mesh"===a||"mesh"===b||"multipatch"===b?"cube":"multipoint"===a||"multipoint"===b?"point":a||b||"table"}};c.getNormalizedFeatureTypeInfo=a=>{const b={typeFieldName:null,types:[]};if(!a)return b;"subtype-sublayer"===
a.type?(b.typeFieldName=a.parent?.subtypeField,b.types=a.parent?.subtypes??[]):"subtype-group"===a.type||"feature"===a.type&&a.subtypes?.length?(b.typeFieldName=a.subtypeField,b.types=a.subtypes??[]):"types"in a&&a.types&&(b.typeFieldName=a.typeIdField,b.types=a.types.map(({id:e,name:f,domains:d})=>({code:e,name:f,domains:d})));null!=b.typeFieldName&&(b.typeFieldName=a.getField(b.typeFieldName)?.name??b.typeFieldName);return b};c.isExpressionReference=function(a){return a.startsWith("expression/")};
c.isFieldElementWithInputType=m;c.isFieldElementWithShowNoValueOptionInput=a=>null!=a&&(m(a,"combo-box")||m(a,"radio-buttons"));c.isFieldElementWithTextInput=a=>null!=a&&(m(a,"text-box")||m(a,"text-area"));c.isFieldInput=z;c.isGroupInput=a=>"group"===a?.type;c.isInputInGroupInput=a=>"group"!==a?.type&&null!=a.group;c.isLegacyFieldMapsExpressionReference=function(a){return a.startsWith("expr/")};c.isNumberFieldInput=({domain:a,inputType:b="text-box",dataType:e})=>"number"===e&&"text-box"===b&&(!a||
"coded-value"!==a.type);c.isRelationshipInput=A;c.isTemplateItemGroup=a=>"items"in a;c.isTextElementInput=a=>"text"===a.type;c.parseFormTemplateString=function(a){const {attributes:b,fieldsIndex:e,label:f,timeZone:d}=a;if(!b||"object"!==typeof b)return f;var h=Object.keys(b).filter(g=>l.templateHasKey(f,g));a=h.map(g=>b[g]);h=h.map(g=>e.get(g)).filter(E.isSome);return x(f,w({values:a,fields:h,timeZone:d}))};c.prependExpressionPrefix=function(a){return`${"expression/"}${a}`};c.prependFieldPrefix=function(a){return`${"field/"}${a}`};
c.substituteFieldTemplatesInString=x;c.subtypeChangeShouldPrompt=function(a,b,e){if(!(a&&"subtypes"in a))return!1;const f=a.subtypes?.find(d=>d.code===e);if(!f)return!1;a=a.subtypes?.find(d=>d.code===b);return G.equalsShallow(f.defaultValues,a?.defaultValues)?!1:Object.values(f.defaultValues).some(d=>null!=d)};c.valueIsInvalidSwitchValue=function(a,b){return null==a||b.onValue!==a&&b.offValue!==a};c.valueIsValidContingentValue=function(a,b){switch(b.objectType){case "any":return!0;case "null":return null==
a;case "code":return a===b.codedValue?.code;case "range":return null!=a&&null!=b.minValue&&null!=b.maxValue&&+a>=b.minValue&&+a<=b.maxValue;default:return F.neverReached(b.objectType),!1}};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});