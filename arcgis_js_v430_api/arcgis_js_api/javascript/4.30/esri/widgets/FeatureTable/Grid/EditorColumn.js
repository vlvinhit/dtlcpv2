// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./Column ../../support/uriUtils".split(" "),function(e,n,f,d,u,v,q,r,t){d=class extends r{constructor(c){super(c);this.editInfo=null;this.cellValueValidatorFunction=({oldValue:a,value:b})=>a!==b;this.editable=!0;this.headerRenderFunction=a=>{({root:a}=a);const b=this.createHeaderContent();
this.tableEditingEnabled&&!this.effectiveEditable&&b.prepend(this._lockIconNode);this.removeCellContent(a);a.appendChild(b)};this.inputRenderFunction=({root:a,column:b,rowData:g})=>{if(!this.editInfo&&this.effectiveEditable){var h=this.getCellValue(b,g),k=this.createInputElement({root:a,column:b,rowData:g,value:h});this._set("editInfo",{column:b,inputs:[k],root:a,rowData:g,oldValue:h});b=document.createElement("div");b.appendChild(k);this.removeCellContent(a);a.appendChild(b);k.focus();k instanceof
HTMLInputElement&&k.select()}};this.loadingMessage="";this.inputType="text";this.maxLength=null;this.parseInputValueFunction=({inputs:a})=>a?.length?null:1!==a.length||Array.isArray(a[0].value)?null:a[0].value;this.renderFunction=a=>{const {root:b,column:g,rowData:h}=a;var {editInfo:k}=this;if(!k){k=this.getCellValue(g,h);var m=this.cellValueFormatFunction({column:g,rowData:h,value:k}),l=null;b.onclick=()=>b.focus();b.ondblclick=()=>this.inputRenderFunction(a);b.ontouchend=()=>this.inputRenderFunction(a);
(l=this.grid?.getSlotElementByName(b.slot)?.parentElement)&&!l.onkeydown&&(l.onkeydown=p=>{"Enter"!==p.key||this.editInfo||this.inputRenderFunction(a);"Escape"===p.key&&this.editInfo&&this.cancel()});null!=k&&null!=m?b.title=m.toString():b.title&&b.removeAttribute("title");l=m instanceof HTMLElement?m:t.autoLink(this.messagesURIUtils,m);this.removeCellContent(b);l instanceof HTMLElement?b.appendChild(l):null!=l&&(b.innerHTML=l.toString())}};this.tableEditingEnabled=this.required=!1;this.updateRowItemFunction=
({rowData:a,column:b,value:g})=>{n.assertIsSome(a);b.path&&a?.item&&(a.item[b.path]=g)};this.updateStoreItemFunction=async({rowData:a,column:b,value:g})=>{n.assertIsSome(a);b.path&&await this.store?.updateItem({index:a.index,name:b.path,value:g})}}get _lockIconNode(){return this.createCalciteIcon({icon:"lock"})}get effectiveEditable(){return this.tableEditingEnabled&&this.editable}get editing(){return!!this.editInfo}onEditComplete(){this._set("editInfo",null);this.grid?.generateCellPartNames()}cancel(){const {editInfo:c}=
this;if(c){var {column:a,root:b,rowData:g}=c;this.onEditComplete();this.renderFunction({column:a,root:b,rowData:g})}}createInputElement({value:c}){const a=document.createElement("input");null!=this.maxLength&&(a.maxLength=this.maxLength);a.type=this.inputType;a.value=c;a.onblur=()=>{a.onblur=null;this.submit()};return a}createDateComponent(){const c=document.createElement("calcite-input-date-picker");c.focusTrapDisabled=!0;c.overlayPositioning="fixed";return c}createTimeComponent(){const c=document.createElement("calcite-input-time-picker");
c.overlayPositioning="fixed";c.placement="auto-start";c.step=1;return c}createTimeZoneComponent(){const c=document.createElement("calcite-input-time-zone");c.maxItems=4;c.overlayPositioning="fixed";return c}async submit(){var {editInfo:c}=this;if(c){var {column:a,inputs:b,root:g,rowData:h,oldValue:k}=c;c=this.parseInputValueFunction({inputs:b,column:a,rowData:h});if(this.cellValueValidatorFunction({value:c,oldValue:k,column:a,rowData:h})){g.textContent=this.loadingMessage;try{await this.updateStoreItemFunction({rowData:h,
column:a,value:c}),this.updateRowItemFunction({rowData:h,column:a,value:c}),this.onEditComplete(),this.renderFunction({column:a,root:g,rowData:h}),this.emit("value-change",{column:a,rowData:h,value:this.getCellValue(a,h)})}catch(m){this.cancel()}}else this.cancel()}}};e.__decorate([f.property()],d.prototype,"_lockIconNode",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"editInfo",void 0);e.__decorate([f.property()],d.prototype,"cellValueValidatorFunction",void 0);e.__decorate([f.property()],
d.prototype,"editable",void 0);e.__decorate([f.property()],d.prototype,"effectiveEditable",null);e.__decorate([f.property()],d.prototype,"editing",null);e.__decorate([f.property()],d.prototype,"headerRenderFunction",void 0);e.__decorate([f.property()],d.prototype,"inputRenderFunction",void 0);e.__decorate([f.property({constructOnly:!0})],d.prototype,"loadingMessage",void 0);e.__decorate([f.property()],d.prototype,"inputType",void 0);e.__decorate([f.property()],d.prototype,"maxLength",void 0);e.__decorate([f.property()],
d.prototype,"parseInputValueFunction",void 0);e.__decorate([f.property()],d.prototype,"renderFunction",void 0);e.__decorate([f.property()],d.prototype,"required",void 0);e.__decorate([f.property()],d.prototype,"tableEditingEnabled",void 0);e.__decorate([f.property()],d.prototype,"updateRowItemFunction",void 0);e.__decorate([f.property()],d.prototype,"updateStoreItemFunction",void 0);return d=e.__decorate([q.subclass("esri.widgets.FeatureTable.Grid.EditorColumn")],d)});