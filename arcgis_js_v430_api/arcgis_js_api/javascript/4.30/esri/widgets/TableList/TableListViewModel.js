// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/Collection ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../LayerList/support/layerListUtils ./ListItem".split(" "),function(e,d,n,h,f,t,u,v,p,q,k){const l=d.ofType(k);d=class extends n.EventedAccessor{constructor(a){super(a);this.checkPublishStatusEnabled=!1;this.listItemCreatedFunction=null;this.listModeDisabled=
!1;this.tableItems=new l;this.map=null}initialize(){this.addHandles([h.watch(()=>[this.tables,this.map?.allTables.toArray()],()=>this._compileList(),h.initial),h.watch(()=>[this.map?.loaded,this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList())],"map")}destroy(){this._removeAllItems();this.tables=this.map=null}get tables(){return this.map?.allTables}set tables(a){this._overrideIfSome("tables",a)}get state(){const {map:a,tables:b}=this;if(!a)return b?
"ready":"disabled";const c=a?.loadStatus;return"string"===typeof c?"loaded"===c?"ready":"loading"===c?"loading":"disabled":"ready"}get totalItems(){return this.tableItems.length}triggerAction(a,b){a&&!a.disabled&&this.emit("trigger-action",{action:a,item:b})}_removeAllItems(){this.tableItems.destroyAll()}_getViewableTables(a){return a?this.listModeDisabled?a:a.filter(b=>"hide"!==q.findLayerListMode(b)):void 0}_watchTablesListMode(a){this.removeHandles("layer-list-mode");a&&!this.listModeDisabled&&
this.addHandles(h.watch(()=>a.filter(b=>"listMode"in b).map(b=>b.listMode).toArray(),()=>this._compileList()),"layer-list-mode")}_compileList(){var {tables:a}=this;this._watchTablesListMode(a);a=this._getViewableTables(a);a?.length?(this._createNewItems(a),this._removeItems(a),this._sortItems(a)):this._removeAllItems()}_createNewItems(a){const {tableItems:b,listItemCreatedFunction:c,checkPublishStatusEnabled:g}=this;a.forEach(m=>{b.some(r=>r.layer===m)||b.add(new k({checkPublishStatusEnabled:g,layer:m,
listItemCreatedFunction:c}))})}_removeItems(a){const {tableItems:b}=this;b.forEach(c=>{c&&!a?.find(g=>c.layer===g)&&(b.remove(c),c.destroy())})}_sortItems(a){const {tableItems:b}=this;b.sort((c,g)=>{c=a.indexOf(c.layer);g=a.indexOf(g.layer);return c>g?-1:c<g?1:0})}_recompileList(){this._removeAllItems();this._compileList()}};e.__decorate([f.property()],d.prototype,"checkPublishStatusEnabled",void 0);e.__decorate([f.property()],d.prototype,"listItemCreatedFunction",void 0);e.__decorate([f.property({nonNullable:!0})],
d.prototype,"listModeDisabled",void 0);e.__decorate([f.property({type:l,readOnly:!0})],d.prototype,"tableItems",void 0);e.__decorate([f.property()],d.prototype,"tables",null);e.__decorate([f.property()],d.prototype,"map",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"state",null);e.__decorate([f.property()],d.prototype,"totalItems",null);return d=e.__decorate([p.subclass("esri.widgets.TableList.TableListViewModel")],d)});