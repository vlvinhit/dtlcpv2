// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.30/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Collection ../core/Identifiable ../core/ReactiveMap ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../layers/catalog/catalogUtils ../support/actions/actionUtils ./Widget ./CatalogLayerList/CatalogLayerListViewModel ./CatalogLayerList/CatalogLayerListVisibleElements ./CatalogLayerList/css ./LayerList/ListItem ./LayerList/support/layerListUtils ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory".split(" "),
function(r,g,f,E,F,h,N,O,P,G,H,z,I,B,C,k,J,u,K,x,Q,A,L,e){const M=f.ofType(J);f=class extends E.IdentifiableMixin(I){constructor(a,b){super(a,b);this._activeItem=null;this._tooltipReferenceMap=new F;this._focusPanelFlowItem=this._focusRootFlowItem=!1;this._rootGroupUid=`operational-${this.uid}`;this.collapsed=!1;this.filterText=this.filterPlaceholder="";this.headingLevel=2;this.messagesCommon=this.messagesLayerList=this.messages=null;this.minFilterItems=u.minFilterItems;this.selectedItems=new M;this.selectionMode=
"none";this.viewModel=new B;this.visibilityAppearance="default";this.visibleElements=new C;this._clearActiveItem=()=>{this._activeItem=null};this._setActiveItem=c=>{"default"===this.visibilityAppearance&&(c=Array.from(c.composedPath()).find(d=>d.classList?.contains(k.css.item)),this._activeItem=u.getItem(c))}}loadDependencies(){return K.loadCalciteComponents({action:()=>new Promise((a,b)=>r(["../chunks/calcite-action"],a,b)),"action-group":()=>new Promise((a,b)=>r(["../chunks/calcite-action-group"],
a,b)),"action-menu":()=>new Promise((a,b)=>r(["../chunks/calcite-action-menu"],a,b)),button:()=>new Promise((a,b)=>r(["../chunks/calcite-button"],a,b)),flow:()=>new Promise((a,b)=>r(["../chunks/calcite-flow"],a,b)),"flow-item":()=>new Promise((a,b)=>r(["../chunks/calcite-flow-item"],a,b)),icon:()=>new Promise((a,b)=>r(["../chunks/calcite-icon"],a,b)),list:()=>new Promise((a,b)=>r(["../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>r(["../chunks/calcite-list-item"],a,b)),notice:()=>
new Promise((a,b)=>r(["../chunks/calcite-notice"],a,b)),tooltip:()=>new Promise((a,b)=>r(["../chunks/calcite-tooltip"],a,b))})}destroy(){this._tooltipReferenceMap.clear()}get _filterEnabled(){return this.viewModel.totalItems>=this.minFilterItems&&this.visibleElements.filter}get catalogItems(){return this.viewModel.catalogItems}set catalogItems(a){this.viewModel.catalogItems=a}get catalogLayer(){return this.viewModel.catalogLayer}set catalogLayer(a){this.viewModel.catalogLayer=a}get icon(){return"catalog-dataset"}set icon(a){this._overrideIfSome("icon",
a)}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(a){this.viewModel.listItemCreatedFunction=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}triggerAction(a,b){return this.viewModel.triggerAction(a,b)}render(){var a=this.viewModel?.state;a={[x.globalCss.hidden]:"loading"===a,[x.globalCss.disabled]:"disabled"===a};const b=this.catalogItems?.filter(c=>
!c.hidden&&(this.visibleElements.errors||!c.error));return e.tsx("div",{class:this.classes(k.css.base,x.globalCss.widget,x.globalCss.panel,a)},b?.length?[this._renderItemTooltips(b),this._renderItems(b)]:this._renderNoItems())}_renderItemTooltip(a){const {_tooltipReferenceMap:b,messagesLayerList:c}=this;return a?e.tsx("calcite-tooltip",{key:`tooltip-${a.layer.uid}`,referenceElement:b.get(a.layer.uid)},c.layerIncompatibleTooltip):null}_renderItemTooltipNodes(a){return a.incompatible?this._renderItemTooltip(a):
a.children?.filter(b=>!b.hidden).toArray().map(b=>this._renderItemTooltipNodes(b))}_renderItemTooltips(a){return a?.toArray().map(b=>this._renderItemTooltipNodes(b))}_renderNoItemsMessage(){return e.tsx("div",{slot:"message"},this.messagesLayerList.noItemsToDisplay)}_renderNoItems(){return e.tsx("div",{class:k.css.itemMessage,key:"esri-layer-list__no-items"},e.tsx("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}_renderPanelFlowItems(a){return a?
a.flatten(b=>b.children).filter(({hidden:b,panel:c})=>!b&&c?.open&&!c.disabled&&c.flowEnabled).toArray().map(({title:b,panel:c})=>{const d=()=>this._handlePanelFlowItemBack(c);return e.tsx("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:b,heading:c.title,headingLevel:this.headingLevel,key:`flow-panel-${c.uid}`,onCalciteFlowItemBack:l=>{l.preventDefault();d()}},c.render(),e.tsx("calcite-button",{appearance:"transparent",onclick:d,
slot:"footer-actions",width:"full"},this.messagesCommon.back))}):[]}_handlePanelFlowItemBack(a){a.open=!1;this._focusRootFlowItem=!0}_focusRootFlowItemNode(a){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,requestAnimationFrame(()=>a?.setFocus()))}_focusPanelFlowItemNode(a){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,requestAnimationFrame(()=>a?.setFocus()))}_renderItems(a){const {visible:b,collapsed:c,_filterEnabled:d,_rootGroupUid:l,visibleElements:{closeButton:n,collapseButton:p,
heading:m,flow:q},selectionMode:v,filterText:y,filterPlaceholder:w,messages:D}=this;a=[e.tsx("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:n,closed:!b,collapsed:c,collapsible:p,heading:m?D.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},e.tsx("calcite-list",{afterCreate:t=>{t.addEventListener("focusin",this._setActiveItem);t.addEventListener("focusout",this._clearActiveItem)},
afterRemoved:t=>{t.removeEventListener("focusin",this._setActiveItem);t.removeEventListener("focusout",this._clearActiveItem)},"data-layer-type":l,filterEnabled:d,filterPlaceholder:w,filterText:d?y:"",group:l,key:"root-list",label:D.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:v,onCalciteListChange:t=>this._handleCalciteListChange(t),onCalciteListFilter:t=>this.filterText=t.target?.filterText??""},a?.toArray().map(t=>this._renderItem(t)),
a?.length&&d?e.tsx("div",{class:k.css.filterNoResults,slot:"filter-no-results"},e.tsx("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(a)];return b?q?e.tsx("calcite-flow",{key:"root-flow"},a):a:null}_renderChildList(a,b=[]){const {_rootGroupUid:c,viewModel:{listModeDisabled:d},selectionMode:l}=this,{children:n}=a,p=u.listItemHasChildren(a),m=!(d?0:u.areChildrenHidden(a.layer))&&!p&&"group"===a.layer?.type;return p||m?e.tsx("calcite-list",
{"data-item":a,"data-layer-type":c,group:`${c}-${a.layer.uid}`,key:`child-list-${a.layer.uid}`,selectionAppearance:"border",selectionMode:l},n?.filter(q=>!q.hidden).toArray().map(q=>this._renderItem(q,a,[...b,a.title]))):null}_renderItemMessage(a){return a.error?e.tsx("div",{class:k.css.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},e.tsx("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},e.tsx("div",{slot:"message"},this.messagesLayerList.layerError))):
a.incompatible?e.tsx("div",{class:k.css.itemMessage,key:"esri-layer-list__incompatible",slot:"content-bottom"},e.tsx("calcite-notice",{afterCreate:b=>this._setTooltipReference(b,a),afterRemoved:()=>this._removeTooltipReference(a),bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},e.tsx("div",{slot:"message"},this.messagesLayerList.layerIncompatible))):null}_getLayerTitle(a){return a.title||this.messagesLayerList.untitledLayer}_renderItem(a,b,c){const {_activeItem:d,
selectionMode:l,selectedItems:n,messagesLayerList:p}=this,m=this._getLayerTitle(a),q=a.visibleAtCurrentTimeExtent?a.visibleAtCurrentScale?m:`${m} (${p.layerInvisibleAtScale})`:`${m} (${p.layerInvisibleAtTime})`,v=this._filterActions(a.actionsSections),y=this._countActions(v);return e.tsx("calcite-list-item",{class:this.classes(k.css.item,{[k.css.itemActive]:d===a}),"data-item":a,"data-layer-id":a.layer.id,id:a.layer.uid,key:`list-item-${a.layer.uid}`,label:m,metadata:{parentTitles:c,title:m},open:a.open,
selected:"none"!==l?n.includes(a):!1,title:q,value:a.layer.uid,onCalciteListItemSelect:w=>this._handleCalciteListItemSelect(w,a,b),onCalciteListItemToggle:w=>this._handleCalciteListItemToggle(w,a)},e.tsx("div",{class:this.classes({[k.css.itemContent]:!0,[k.css.itemInvisible]:!a.visibleAtCurrentScale||!a.visibleAtCurrentTimeExtent}),slot:"content"},m),this._renderItemStatus(a,b),this._renderItemToggle(a,b),this._renderItemTemporaryIcon(a),this._renderChildList(a,c),this._renderItemMessage(a),this._renderPanel(a.panel),
this._renderPanelAction(a.panel),1<y?this._renderActionsSections(a,v):1===y?this._renderAction({item:a,action:this._getSingleAction(v),textEnabled:!1}):null)}_renderItemStatus(a,b){const {visibleElements:c}=this;if(!c.statusIndicators)return null;const {connectionStatus:d,publishing:l,updating:n}=a;a=!!d;return e.tsx("calcite-icon",{class:this.classes({[k.css.statusIndicator]:!0,[k.css.publishing]:l,[k.css.updating]:n&&!b,[k.css.connectionStatus]:a,[k.css.connectionStatusConnected]:a&&"connected"===
d}),icon:u.getStatusIcon({connectionStatus:d,publishing:l}),key:"layer-item-status",scale:"s",slot:"actions-end"})}_renderItemTemporaryIcon(a){return this.visibleElements.temporaryLayerIndicators&&"persistenceEnabled"in a.layer&&(H.isLayerFromCatalog(a.layer)||!a.layer.persistenceEnabled)?e.tsx("calcite-icon",{class:k.css.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"actions-start",title:this.messagesLayerList.temporary}):null}_renderItemToggle(a,b){const {messagesLayerList:c,
visibilityAppearance:d}=this,{visible:l}=a,n=b?.visibilityMode;if("inherited"===n)return null;const p=u.getVisibilityIcon({visible:l,exclusive:"exclusive"===n,visibilityAppearance:d}),m="checkbox"===d,q=c.layerVisibility;return e.tsx("calcite-action",{appearance:"transparent",class:k.css.visibleToggle,icon:m?p:void 0,key:"visibility-toggle",onclick:()=>this._toggleVisibility(a,b),scale:"s",slot:m?"actions-start":"actions-end",text:q,title:q},m?null:e.tsx("calcite-icon",{class:this.classes({[k.css.visibleIcon]:"exclusive"!==
n&&l}),icon:p,scale:"s"}))}_renderPanel(a){return!a?.open||a.disabled||a.flowEnabled?null:e.tsx("div",{class:k.css.itemContentBottom,key:`content-panel-${a.uid}`,slot:"content-bottom"},a.render())}_renderPanelAction(a){if(!a?.visible)return null;const {open:b,title:c,disabled:d}=a;return e.tsx("calcite-action",{active:b,appearance:"transparent",disabled:d,icon:z.getActionIcon(a),key:`action-${a.uid}`,onclick:()=>this._togglePanel(a),scale:"s",slot:"actions-end",text:c??"",title:c??void 0},this._renderFallbackIcon(a))}_renderActionsSections(a,
b){const c=this.messagesCommon.options;return e.tsx("calcite-action-menu",{appearance:"transparent",class:k.css.actionMenu,key:"item-action-menu",label:this.messagesCommon.menu,open:a.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:d=>a.actionsOpen=d.target.open},e.tsx("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:c,title:c}),b.toArray().map((d,l)=>this._renderActionSection(a,d,l)))}_renderActionSection(a,
b,c){return e.tsx("calcite-action-group",{class:k.css.actionGroup,key:`action-section-${c}`},b.toArray().map(d=>this._renderAction({item:a,action:d,textEnabled:!0})))}_renderFallbackIcon(a){const {className:b,icon:c}=a;if(c)return null;a="image"in a?a.image:void 0;const d={[k.css.itemActionIcon]:!!b,[k.css.itemActionImage]:!!a};b&&(d[b]=!0);return a||b?e.tsx("span",{"aria-hidden":"true",class:this.classes(k.css.itemActionIcon,d),key:"icon",styles:z.getActionStyles(a)}):null}_renderAction(a){const {item:b,
action:c,textEnabled:d}=a;if(!c)return null;const {active:l,disabled:n,title:p,type:m,indicator:q}=c;return e.tsx("calcite-action",{active:"toggle"===m?c.value:!1,appearance:"transparent",disabled:n,icon:z.getActionIcon(c),indicator:q,key:`action-${c.uid}`,loading:l,onclick:()=>this._triggerAction(b,c),scale:"s",slot:d?void 0:"actions-end",text:p??"",textEnabled:d,title:p??void 0},this._renderFallbackIcon(c))}_setTooltipReference(a,b){this._tooltipReferenceMap.set(b.layer.uid,a)}_removeTooltipReference(a){this._tooltipReferenceMap.delete(a.layer.uid)}_getSingleAction(a){return a.reduce(b=>
b).find(b=>b&&("button"===b.type||"toggle"===b.type))}_filterActions(a){return a.map(b=>b.filter(c=>c.visible))}_countActions(a){return a.reduce((b,c)=>b+c.length,0)}_triggerAction(a,b){b&&a&&("toggle"===b.type&&(b.value=!b.value),this.triggerAction(b,a))}_handleCalciteListChange(a){const {selectionMode:b,selectedItems:c}=this;"none"!==b&&(a=a.target.selectedItems.map(d=>u.getItem(d)).filter(Boolean),c.removeAll(),c.addMany(a))}_handleCalciteListItemToggle(a,b){a.stopPropagation();b.open=a.target.open}_handleCalciteListItemSelect(a,
b,c){u.getItem(a.target)===b&&"none"===this.selectionMode&&"inherited"!==c?.visibilityMode&&this._toggleVisibility(b,c)}_togglePanel(a){a.open=!a.open;a.open&&(this._focusPanelFlowItem=!0)}_toggleVisibility(a,b){!a||"exclusive"===b?.visibilityMode&&a.visible||(a.visible=!a.visible)}};g.__decorate([h.property()],f.prototype,"_activeItem",void 0);g.__decorate([h.property()],f.prototype,"_tooltipReferenceMap",void 0);g.__decorate([h.property()],f.prototype,"_focusRootFlowItem",void 0);g.__decorate([h.property()],
f.prototype,"_focusPanelFlowItem",void 0);g.__decorate([h.property()],f.prototype,"_filterEnabled",null);g.__decorate([h.property()],f.prototype,"catalogItems",null);g.__decorate([h.property()],f.prototype,"catalogLayer",null);g.__decorate([h.property()],f.prototype,"collapsed",void 0);g.__decorate([h.property()],f.prototype,"filterPlaceholder",void 0);g.__decorate([h.property()],f.prototype,"filterText",void 0);g.__decorate([h.property()],f.prototype,"headingLevel",void 0);g.__decorate([h.property()],
f.prototype,"icon",null);g.__decorate([h.property()],f.prototype,"label",null);g.__decorate([h.property()],f.prototype,"listItemCreatedFunction",null);g.__decorate([h.property(),A.messageBundle("esri/widgets/CatalogLayerList/t9n/CatalogLayerList")],f.prototype,"messages",void 0);g.__decorate([h.property(),A.messageBundle("esri/widgets/LayerList/t9n/LayerList")],f.prototype,"messagesLayerList",void 0);g.__decorate([h.property(),A.messageBundle("esri/t9n/common")],f.prototype,"messagesCommon",void 0);
g.__decorate([h.property()],f.prototype,"minFilterItems",void 0);g.__decorate([h.property()],f.prototype,"selectedItems",void 0);g.__decorate([h.property()],f.prototype,"selectionMode",void 0);g.__decorate([h.property()],f.prototype,"view",null);g.__decorate([L.vmEvent("trigger-action"),h.property({type:B})],f.prototype,"viewModel",void 0);g.__decorate([h.property()],f.prototype,"visibilityAppearance",void 0);g.__decorate([h.property({type:C,nonNullable:!0})],f.prototype,"visibleElements",void 0);
return f=g.__decorate([G.subclass("esri.widgets.CatalogLayerList")],f)});