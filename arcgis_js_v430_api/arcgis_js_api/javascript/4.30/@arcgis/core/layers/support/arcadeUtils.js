/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function e(e,n){const t=[];if(!e)return t;if("valueExpression"in e&&e.valueExpression){const o={expression:e.valueExpression,title:e.valueExpressionTitle,profileInfo:{name:"visualization",context:`${e.type}-renderer`,source:n}};t.push(o)}if("visualVariables"in e&&e.visualVariables){const o=e.visualVariables.filter((({valueExpression:e})=>e&&"$view.scale"!==e)).map((({valueExpression:e,valueExpressionTitle:t,type:o})=>({expression:e,title:t,profileInfo:{name:"visualization",context:`${o}-variable`,source:n}})));t.push(...o)}if("attributes"in e&&e.attributes){const o=e?.attributes.filter((({valueExpression:e})=>e)).map((({valueExpression:t,valueExpressionTitle:o})=>({expression:t,title:o,profileInfo:{name:"visualization",context:`${e.type}-renderer`,source:n}})));t.push(...o)}return t}function n(e,n){const t=[];if(e?.expressionInfos){const o=e?.expressionInfos.map((({title:e,name:t,expression:o,returnType:r})=>({title:e,name:t,expression:o,profileInfo:{name:"layer"===n?"popup":"feature-reduction-popup",context:"popup-template",returnType:r,source:n}})));t.push(...o)}if(e?.content&&Array.isArray(e.content)){const o=e?.content.filter((({type:e})=>"expression"===e)).map((({expressionInfo:e})=>({title:e.title,expression:e.expression,profileInfo:{name:"layer"===n?"popup-element":"feature-reduction-popup-element",context:"popup-expression-content",returnType:e.returnType,source:n}})));t.push(...o)}return t}function t(e){const n=[];if(e){const t=e.filter((({onStatisticExpression:e,isAutoGenerated:n})=>e&&!n)).map((({onStatisticExpression:{expression:e,title:n}})=>({expression:e,title:n,profileInfo:{name:"aggregate-field",context:"aggregate-field",source:"feature-reduction"}})));n.push(...t)}return n}function o(e,n){const t=[];if(e){const o=e.filter((({labelExpressionInfo:e})=>e?.expression)).map((({labelExpressionInfo:e})=>({expression:e?.expression,title:e?.title,profileInfo:{name:"labeling",context:"label-class",source:n}})));t.push(...o)}return t}function r(r){const s=[...o(r.labelingInfo,"layer"),...n(r.popupTemplate,"layer"),...e(r.renderer,"layer")];var i;return"elevationInfo"in r&&s.push(...function(e){const n=[];if(e?.featureExpressionInfo?.expression){const t={expression:e?.featureExpressionInfo?.expression,profileInfo:{name:"feature-z",context:"elevation-info",source:"layer"}};n.push(t)}return n}(r.elevationInfo)),"featureReduction"in r&&s.push(...(i=r.featureReduction,[...n(i?.popupTemplate,"feature-reduction"),...o(i?.labelingInfo,"feature-reduction"),...e(i?.renderer,"feature-reduction"),...t(i?.fields)])),"orderBy"in r&&s.push(...function(e){const n=[];if(e){const t=e.filter((({valueExpression:e})=>e)).map((({valueExpression:e})=>({expression:e,profileInfo:{name:"feature-z",context:"order-by",source:"layer"}})));n.push(...t)}return n}(r.orderBy)),"formTemplate"in r&&s.push(...function(e){const n=[];if(e?.expressionInfos){const t=e?.expressionInfos.map((({title:e,name:n,expression:t,returnType:o})=>({title:e,name:n,expression:t,profileInfo:{name:"boolean"===o?"form-constraint":"form-calculation",context:"form-template",returnType:o,source:"layer"}})));n.push(...t)}return n}(r.formTemplate)),s}export{r as getExpressionsFromLayer};
