/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../intl.js";import e from"../../core/Accessor.js";import{i as o}from"../../core/lang.js";import{b as n,e as i,i as s}from"../../chunks/domUtils.js";import r from"../../core/Evented.js";import{m as a}from"../../chunks/handleUtils.js";import{watch as d,initial as p}from"../../core/reactiveUtils.js";import{property as c}from"../../core/accessorSupport/decorators/property.js";import{cast as l}from"../../core/accessorSupport/decorators/cast.js";import{subclass as m}from"../../core/accessorSupport/decorators/subclass.js";import{s as h}from"../../chunks/themeUtils.js";import{a as u}from"../../chunks/widgetUtils.js";import{g as f,o as g}from"../../chunks/locale.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../config.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/Logger.js";import"../../chunks/messages.js";import"../../core/Error.js";import"../../core/promiseUtils.js";import"../../chunks/maybe.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/utils.js";import"../../core/Handles.js";import"../../chunks/metadata.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../chunks/assets.js";import"../../chunks/asyncUtils.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";const _="esri-component";let y=class extends e{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(t){this._set("id",t)}set node(t){const e=this._get("node");t!==e&&(t&&t.classList.add(_),e&&e.classList.remove(_),this._set("node",t))}castNode(t){return this.widget?.destroy(),t?"string"==typeof t||function(t){return t&&"nodeType"in t}(t)?(this._set("widget",null),n(t)):(function(t){return t&&"function"==typeof t.render}(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};t([c()],y.prototype,"id",null),t([c()],y.prototype,"node",null),t([l("node")],y.prototype,"castNode",null),t([c({readOnly:!0})],y.prototype,"widget",void 0),y=t([m("esri.views.ui.Component")],y);const C=y,j={left:0,top:0,bottom:0,right:0},v={bottom:30,top:15,right:15,left:15},k="esri-ui",b={ui:k,corner:`${k}-corner`,innerContainer:`${k}-inner-container`,manualContainer:`${k}-manual-container`,cornerContainer:`${k}-corner-container`,topLeft:`${k}-top-left`,topRight:`${k}-top-right`,bottomLeft:`${k}-bottom-left`,bottomRight:`${k}-bottom-right`};function w(t){return 0===t?"0":`${t}px`}function L(t){const e="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==e&&e!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:t}function P(t,{top:e,bottom:o,left:n,right:i}){t.style.top=e,t.style.bottom=o,t.style.left=n,t.style.right=i}let N=class extends r.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=f(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&P(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&P(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([d((()=>[this.view?.padding,this.container]),this._applyViewPadding,p),d((()=>this.padding),this._applyUIPadding,p),d((()=>[this.container,this._locale]),(([t,e])=>{t&&t.setAttribute("lang",e)}),p),g((t=>{this._locale=t}))])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(b.ui),h(t),this._attachContainers(t)),e&&(e.classList.remove(b.ui),P(e,{top:"",bottom:"",left:"",right:""}),i(e)),this._set("container",t))}get height(){const t=this.view?.height??0;if(0===t)return t;const e=this._getViewPadding(),{top:o,bottom:n}=e;return Math.max(t-o-n,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{...v,...t}}get width(){const t=this.view?.width??0;if(0===t)return t;const e=this._getViewPadding(),{left:o,right:n}=e;return Math.max(t-o-n,0)}add(t,e){let o,n,i;if(Array.isArray(t))return void t.forEach((t=>this.add(t,e)));const s=L(t);s&&({index:o,position:e,component:t,key:n}=s),e&&"object"==typeof e&&({index:o,key:n,position:e,internal:i}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,o,n,i)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map((t=>this.remove(t,e)));const o=this._find(t);if(o){if(this._componentMap.has(o)&&this._componentMap.get(o)?.key!==e)return;const t=this._components.indexOf(o),n=o.node.parentNode;return n?.removeChild(o.node),this._componentMap.delete(o),o.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(t,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const o of t)this.empty(o,e);return}const o=this._positionNameToContainerLookup[t??"manual"],n=Array.prototype.slice.call(o.children).map((t=>this._findByNode(t))).filter((t=>null!=t&&(!this._componentMap.get(t)?.internal||e.removeInternal)));for(const t of n)this.remove(t)}move(t,e){if(Array.isArray(t)&&t.forEach((t=>this.move(t,e))),!t)return;let o;const n=L(t)||L(e);if(n&&(o=n.index,e=n.position,t=n.component||t),e&&!this._isValidPosition(e))return;const i=this.remove(t);i&&this.add(i,{position:e,index:o})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap((t=>this._getComponentsAtPosition(t,e))):this._getComponentsAtPosition(t,e):this._components.filter((t=>e.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:e})=>t??e))}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,o,n,i,s){t instanceof C||(t=new C({node:t}));const{widget:r}=t;null!=r&&r instanceof e&&r.addHandles(a((()=>{queueMicrotask((()=>this.remove(t)))})),this._removeWidgetHandleKey),this._place({component:t,position:o,index:n}),this._components.push(t),this._componentMap.set(t,{key:i,internal:s})}_find(t){return t?t instanceof C?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.view?.padding??j}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(b.innerContainer,b.cornerContainer);const e=document.createElement("div");e.classList.add(b.innerContainer,b.manualContainer);const o=document.createElement("div");o.classList.add(b.topLeft,b.corner),t.appendChild(o);const n=document.createElement("div");n.classList.add(b.topRight,b.corner),t.appendChild(n);const i=document.createElement("div");i.classList.add(b.bottomLeft,b.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(b.bottomRight,b.corner),t.appendChild(s),this._innerContainer=t,this._manualContainer=e;const r=u();this._cornerNameToContainerLookup={"top-left":o,"top-right":n,"bottom-left":i,"bottom-right":s,"top-leading":r?n:o,"top-trailing":r?o:n,"bottom-leading":r?s:i,"bottom-trailing":r?i:s},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:o,index:n}=t,i=this._positionNameToContainerLookup[e],r=null!=n&&n>-1;var a;if((a=o.widget)&&!a._started&&"function"==typeof a.postMixInProperties&&"function"==typeof a.buildRendering&&"function"==typeof a.postCreate&&"function"==typeof a.startup&&o.widget.startup(),!r)return void i.appendChild(o.node);const d=Array.from(i.children);0!==n?n>=d.length?i.appendChild(o.node):s(o.node,d[n]):i.firstChild?s(o.node,i.firstChild):i.appendChild(o.node)}_toPixelPosition(t){return{top:w(t.top),left:w(t.left),right:w(t.right),bottom:w(t.bottom)}}_findByComponent(t){return this._components.find((e=>e===t))??null}_findById(t){return this._components.find((({id:e})=>e===t))??null}_findByNode(t){return this._components.find((({node:e})=>e===t))??null}_getComponentsAtPosition(t,e){const n=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(n.children).map((t=>this._findByNode(t))).filter(o).filter((t=>e.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:e})=>t??e))}};t([c()],N.prototype,"_locale",void 0),t([c()],N.prototype,"container",null),t([c()],N.prototype,"height",null),t([c({value:v})],N.prototype,"padding",null),t([l("padding")],N.prototype,"castPadding",null),t([c()],N.prototype,"view",void 0),t([c()],N.prototype,"width",null),N=t([m("esri.views.ui.UI")],N);const A=N;export{C,A as default};
