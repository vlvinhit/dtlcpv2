/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{c as t}from"./asyncUtils.js";import{h as e,m as o}from"./handleUtils.js";import{e as a}from"./mathUtils.js";import{v as i,c as s,e as n,z as r,d as l,t as u,f as c,g as p,b as m}from"./quantityUtils.js";import{b as f,v as h}from"./unitUtils.js";import{u as d,b as g,E as v}from"./vec3.js";import{e as y,O as b,c as k,b as x}from"./vec3f64.js";import{isLoaded as I,load as A}from"../geometry/coordinateFormatter.js";import{g as j}from"../geometry/Point.js";import V from"../geometry/support/MeshTransform.js";import{i as U}from"./meshVertexSpaceUtils.js";import{lngLatToXY as w}from"../geometry/support/webMercatorUtils.js";import{t as L}from"./keybindings.js";import{p as M,a as F,m as _,b as S,f as R,c as D,d as O,e as C}from"./Tooltip.js";import{a as z,g as P,b as T,c as X,D as Y}from"./angularMeasurementUtils.js";import{_ as E}from"./tslib.es6.js";import{property as B}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./Logger.js";import{subclass as Z}from"../core/accessorSupport/decorators/subclass.js";import q from"../core/Accessor.js";import{g as N}from"./uuid.js";import{e as W}from"./quantityFormatUtils.js";import{s as G}from"./viewUtils.js";import{c as H,e as J}from"./euclideanAreaMeasurementUtils.js";import{g as K}from"./geodesicAreaMeasurementUtils.js";function Q(t,e){const o=U(e.vertexSpace),{scale:a,orientation:i}=t,{transform:r}=e,l=function(t){if(!t)return 0;const e=ot(t.rotationAxis);return null!=e?e*t.rotationAngle:null}(r);o&&null!=l?(i.actual=s(l,"degrees","arithmetic"),i.visible=!0):(i.actual=null,i.visible=!1),o?(a.actual=n(it(r)),a.visible=!0):(a.actual=null,a.visible=!1)}function $(t,e,o){if(!e||!U(e.vertexSpace))return;const a=e.transform??=new V,{rotationAngle:i,rotationAxis:s}=a,n=z(t.orientation.actual),r=ot(s);if(null!=n&&null!=r&&n!==i){o?.onRotateStart?.(i);const t=n*r;a.rotationAngle=t,o?.onRotate?.(t),o?.onRotateStop?.(t)}const l=t.scale.actual?.value,u=it(a);if(null!=l&&l!==u){const{scale:t}=a;let e;if(o?.onScaleStart?.(t[0],t[1],t[2]),0===u)e=y(b);else{const o=l/u;e=g(k(),t,o)}a.scale=e,o?.onScale?.(e[0],e[1],e[2]),o?.onScaleStop?.(e[0],e[1],e[2])}}function tt(t,e){const{x:o,y:s,z:n}=e,{x:r,y:l,z:u}=function(t,e){let o,a,s;if(t.geographic){o=P(t.longitude.actual),a=P(t.latitude.actual),f(e)&&(null!=o&&null!=a?[o,a]=w(o,a,et):null!=o?o=w(o,0,et)[0]:null!=a&&(a=w(0,a,et)[1]));const n=t.elevation.actual,r=h(e);s=null!=r&&null!=n?i(n,r):void 0}else o=t.x.actual?.value,a=t.y.actual?.value,s=t.elevation.actual?.value;return{x:o,y:a,z:s}}(t,e.spatialReference);return{dx:null==r||a(r,o)?0:r-o,dy:null==l||a(l,s)?0:l-s,dz:null==u||null==n||a(u,n)?0:u-n}}const et=[0,0];function ot(t){return v(t,x)?1:v(t,at)?-1:null}const at=d(k(),x);function it(t){return t?Math.max(...t.scale):1}function st(t,e){return!("key-down"!==t.type||t.key!==L.enterInputMode||!e||!function(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:o,visibleElements:a}=e.tooltips;return o&&!0===t.editableFields.some((({name:t})=>"x"===t||"y"===t?a.coordinates:a[t]))}(e.info)||(e.enterInputMode(),t.stopPropagation(),0))}function nt(a){let i=null;return e([a.on("paste",(async e=>{i?.abort(),i=t((async()=>{I()||await A(),rt(e,a.info)}))})),t((()=>A())),o((()=>i?.abort()))])}function rt(t,e){if(!e||!("geographic"in e))return;const o=t.clipboardData?.getData("text");if(o)if(e.geographic){const a=M(o);a&&(e.longitude.applyValue(a.longitude),e.latitude.applyValue(a.latitude),t.stopPropagation(),t.preventDefault())}else{const a=F(o);a&&(e.x.applyValue(a.x),e.y.applyValue(a.y),t.stopPropagation(),t.preventDefault())}}let lt=class extends q{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=N(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(t){this.inputValue=t}onCommit(t,e,o){this.lockable?this._onCommitLockable(t,o):this._onCommitNonLockable(o),this.invalid&&"commit-and-exit"===t||o.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:o,locked:a}=this;a&&ut(o)?this.unlock():("commit-and-exit"===t&&!a||null!=o)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;ut(e)?this.setActual(null):null!=e&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return"function"==typeof e?e(t):e}getFormattedValue(t){const{actual:e,committed:o,format:a}=this;return null!=o?a(o,t):null!=e?a(e,t):null}getRawDisplayValue(t){const{actual:e,committed:o,inputValue:a}=this;return null!=a?a:this.lockable&&null!=o?this.formatForInputMode(o,t):null!=e?this.formatForInputMode(e,t):null}_parseInputAndSetActual(t){const{inputValue:e}=this;if(null==e||ut(e))return this.setActual(null);const o=this.parse(e,t);null!=o?this.setActual(o):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:o}=this;if(ut(e))return this.unlock();if(null==e)return this.lock(o);const a=this.parse(e,t);null!=a?this.lock(a):this.invalid=!0}};function ut(t){return null!=t&&""===t.trim()}E([B()],lt.prototype,"actual",void 0),E([B()],lt.prototype,"committed",null),E([B()],lt.prototype,"dirty",null),E([B()],lt.prototype,"format",void 0),E([B()],lt.prototype,"formatForInputMode",void 0),E([B()],lt.prototype,"lockable",void 0),E([B()],lt.prototype,"locked",null),E([B()],lt.prototype,"id",void 0),E([B()],lt.prototype,"inputValue",void 0),E([B()],lt.prototype,"name",void 0),E([B()],lt.prototype,"parse",void 0),E([B()],lt.prototype,"readOnly",void 0),E([B()],lt.prototype,"suffix",void 0),E([B()],lt.prototype,"title",void 0),E([B()],lt.prototype,"visible",void 0),E([B()],lt.prototype,"invalid",void 0),E([B()],lt.prototype,"unlockOnVertexPlacement",void 0),lt=E([Z("esri.views.interactive.tooltip.fields.TooltipField")],lt);let ct=class extends lt{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:r,parse:_(((t,o)=>l(t,e(o)))),format:(t,e)=>e.formatters.verticalLength(t),formatForInputMode:(t,o)=>o.formatters.scalar(u(t,e(o))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};E([B()],ct.prototype,"showAsZ",void 0),ct=E([Z("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],ct);let pt=class extends lt{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){return{name:"orientation",actual:null,parse:_(((t,e)=>s(t,(t=>t.inputUnitInfos.orientation.unit)(e),"geographic"))),format:t=>{const e=T(t);return W(e,"geographic",this.precision)},formatForInputMode:(t,e)=>{const o=T(t);return e.formatters.scalar(o)},suffix:t=>t.inputUnitInfos.orientation.abbreviation,title:t=>t.messages.sketch.orientation,...t}}};function mt(t){const e=t=>t.inputUnitInfos.direction.unit,o=t=>t.sketchOptions.values.effectiveDirectionMode;return new lt({name:"direction",actual:c,parse:_(((t,o)=>s(t,e(o),"geographic"))),format:(t,e)=>{const a=o(e),i=X(t,a);switch(a){case Y.Absolute:return e.formatters.direction(i);case Y.Relative:return e.formatters.directionRelative(i);case Y.RelativeBilateral:return e.formatters.directionRelativeBilateral(i)}},formatForInputMode:(t,a)=>{const i=X(t,o(a));return a.formatters.scalar(u(i,e(a)))},suffix:t=>t.inputUnitInfos.direction.abbreviation,title:t=>{const e=o(t),{absolute:a,relative:i}=t.messages.sketch.direction;switch(e){case Y.Absolute:return a;case Y.Relative:case Y.RelativeBilateral:return i}},...t})}function ft(t){const e=t=>t.inputUnitInfos.length.unit;return new lt({name:"distance",actual:r,parse:_(((t,o)=>l(Math.max(t,0),e(o)))),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,o)=>o.formatters.scalar(u(t,e(o))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})}function ht(){return ft({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0})}function dt(t){return new pt(t)}function gt(t){return yt("scale",{name:"scale",actual:null,parse:_((t=>n(Math.abs(t)))),...t})}function vt(t){const e=t=>t.inputUnitInfos.area.unit;return new lt({name:"area",actual:p,parse:_(((t,o)=>m(t,e(o)))),format:(t,e)=>e.formatters.area(t),formatForInputMode:(t,o)=>o.formatters.scalar(u(t,e(o))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...t})}function yt(t,e){return new lt({actual:n(0),parse:_((t=>n(t))),format:(t,e)=>e.formatters.scalar(t),formatForInputMode:(t,e)=>e.formatters.scalar(t),title:e=>e.messages.sketch[t],...e})}E([B()],pt.prototype,"precision",void 0),pt=E([Z("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],pt);const bt=t=>{let e=class extends t{constructor(){super(...arguments),this.longitude=new lt({name:"x",actual:c,parse:S,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>R(t),suffix:t=>t.inputUnitInfos.longitudeLatitude.abbreviation,title:t=>t.messages.sketch.longitude}),this.latitude=new lt({name:"y",actual:c,parse:D,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>O(t),suffix:t=>t.inputUnitInfos.longitudeLatitude.abbreviation,title:t=>t.messages.sketch.latitude}),this.x=yt("x",{name:"x"}),this.y=yt("y",{name:"y"}),this.elevation=new ct(void 0),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,e=t?.spatialReference){if(this.geographic=!!e&&G(e),null==t)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const e=j(t,kt);this._setActualLonLat(C(e?.[0]),C(e?.[1]))}else this._setActualXY(n(t.x),n(t.y))}_setActualLonLat(t,e){this.longitude.actual=t,this.latitude.actual=e}_setActualXY(t,e){this.x.actual=t,this.y.actual=e}};return E([B()],e.prototype,"geographic",void 0),E([B()],e.prototype,"effectiveX",null),E([B()],e.prototype,"effectiveY",null),E([B()],e.prototype,"key",null),e=E([Z("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},kt=[0,0];function xt(t,e=H()){return function(t,e,o=H()){{const e=K(t);return null!=e?e:J(t,o)}}(t,0,e)}export{bt as T,ht as a,xt as b,nt as c,dt as d,st as e,gt as f,tt as g,mt as h,ft as i,$ as j,vt as m,rt as p,Q as u};
