/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{e as t}from"./earcut.js";import{A as n}from"./Axis.js";import{i as e}from"./coordsUtils.js";import{d as o,a as s,n as r}from"./DoubleArray.js";import{c as i}from"./Indices.js";import{d as a}from"./mathUtils.js";import{g as c,y as l}from"./unitUtils.js";import{s as f}from"./vec3.js";import{c as h,g,u}from"./plane.js";import{d as p}from"./deduplicate.js";function m(t,e,o){const s=function(t,n,e,o){const s=(i=n,Array.isArray(i[0])?(t,e)=>n[t][e]:(t,e)=>n[3*t+e]),r=o?c(o)/l(o):1;var i;return u(t,((t,n)=>f(t,s(n,0)*r,s(n,1)*r,s(n,2))),e)}(d,t,e,o)?g(d):[0,0,1];return Math.abs(s[2])>Math.cos(a(80))?n.Z:Math.abs(s[1])>Math.abs(s[0])?n.Y:n.X}const d=h();function y(n){const e=A(n.rings,n.hasZ,w.CCW_IS_HOLE,n.spatialReference),a=new Array;let c=0,l=0;for(const n of e.polygons){const s=n.count,r=n.index,f=o(e.position,3*r,3*s),h=n.holeIndices.map((t=>t-r)),g=i(t(f,h,3));a.push({position:f,faces:g}),c+=f.length,l+=g.length}const f=function(t,n,e){if(1===t.length)return t[0];const o=r(n),s=new Array(e);let a=0,c=0,l=0;for(const n of t){for(let t=0;t<n.position.length;t++)o[a++]=n.position[t];for(const t of n.faces)s[c++]=t+l;l=a/3}return{position:o,faces:i(s)}}(a,c,l),h=Array.isArray(f.position)?p(f.position,3,{originalIndices:f.faces}):p(f.position.buffer,6,{originalIndices:f.faces});return f.position=s(new Float64Array(h.buffer)),f.faces=h.indices,f}function A(t,n,e,o){const s=t.length,i=new Array(s),a=new Array(s),c=new Array(s);let l=0;for(let n=0;n<s;++n)l+=t[n].length;let f=0,h=0,g=0;const u=r(3*l);let p=0;for(let r=s-1;r>=0;r--){const l=t[r],m=e===w.CCW_IS_HOLE&&I(l,n,o);if(m&&1!==s)i[f++]=l;else{let t=l.length;for(let n=0;n<f;++n)t+=i[n].length;const e={index:p,pathLengths:new Array(f+1),count:t,holeIndices:new Array(f)};e.pathLengths[0]=l.length,l.length>0&&(c[g++]={index:p,count:l.length}),p=m?j(l,l.length-1,-1,u,p,l.length,n):j(l,0,1,u,p,l.length,n);for(let t=0;t<f;++t){const o=i[t];e.holeIndices[t]=p,e.pathLengths[t+1]=o.length,o.length>0&&(c[g++]={index:p,count:o.length}),p=j(o,0,1,u,p,o.length,n)}f=0,e.count>0&&(a[h++]=e)}}for(let t=0;t<f;++t){const e=i[t];e.length>0&&(c[g++]={index:p,count:e.length}),p=j(e,0,1,u,p,e.length,n)}return a.length=h,c.length=g,{position:u,polygons:a,outlines:c}}function j(t,n,e,o,s,r,i){s*=3;for(let a=0;a<r;++a){const r=t[n];o[s++]=r[0],o[s++]=r[1],o[s++]=i?r[2]:0,n+=e}return s/3}function I(t,o,s){if(!o)return!e(t);switch(m(t,t.length-1,s)){case n.X:return!e(t,n.Y,n.Z);case n.Y:return!e(t,n.X,n.Z);case n.Z:return!e(t,n.X,n.Y)}}var w;!function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(w||(w={}));export{w as C,m as l,A as r,y as t};
