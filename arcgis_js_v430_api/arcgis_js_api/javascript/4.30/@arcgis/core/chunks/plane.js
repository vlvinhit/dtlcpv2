/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{a as t,c as r}from"./mathUtils.js";import{d as n,l as e,n as s,e as c,b as a,c as i,i as o,p as u,g as f,s as m}from"./vec3.js";import{c as h}from"./vec3f64.js";import"../core/lang.js";import{n as I}from"../core/scheduling.js";import{c as N}from"./mat3f64.js";import{c as M}from"./mat4f64.js";import{c as _}from"./quatf64.js";import{c as g}from"./vec2f64.js";import{c as l}from"./vec4f64.js";import{t as p}from"./mathUtils2.js";function E(t,r,e){const s=n(t,r)/n(t,t);return a(e,t,s)}function j(t,r){return n(t,r)/e(t)}function A(r,s){const c=n(r,s)/(e(r)*e(s));return-t(c)}function P(r,e,a){s(F,r),s(T,e);const i=n(F,T),o=t(i),u=c(F,F,T);return n(u,a)<0?2*Math.PI-o:o}const F=h(),T=h();class v{constructor(t){this._create=t,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&I((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const t=2*this._itemsPtr;this._items.length>t&&(this._items.length=t),this._itemsPtr=0}static createVec2f64(){return new v(g)}static createVec3f64(){return new v(h)}static createVec4f64(){return new v(l)}static createMat3f64(){return new v(N)}static createMat4f64(){return new v(M)}static createQuatf64(){return new v(_)}get test(){}}const w=v.createVec2f64(),b=v.createVec3f64(),d=v.createVec4f64();v.createMat3f64();const y=v.createMat4f64(),V=v.createQuatf64();function C(t=ft){return[t[0],t[1],t[2],t[3]]}function X(t=ft[0],r=ft[1],n=ft[2],e=ft[3]){return x(t,r,n,e,d.get())}function q(t,r){return x(r[0],r[1],r[2],r[3],t)}function L(t){return t}function x(t,r,n,e,s=C()){return s[0]=t,s[1]=r,s[2]=n,s[3]=e,s}function O(t,r,n){return u(n,t),n[3]=r,n}function Q(t,r,n){const e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=Math.abs(e-1)>1e-5&&e>1e-12?1/Math.sqrt(e):1;return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n}function U(t,r,n,e=C()){const s=n[0]-r[0],c=n[1]-r[1],a=n[2]-r[2],i=t[0]-r[0],o=t[1]-r[1],u=t[2]-r[2],f=c*u-a*o,m=a*i-s*u,h=s*o-c*i,I=f*f+m*m+h*h,N=Math.abs(I-1)>1e-5&&I>1e-12?1/Math.sqrt(I):1;return e[0]=f*N,e[1]=m*N,e[2]=h*N,e[3]=-(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),e}function k(t,r,e,c=0,a=Math.floor(e*(1/3)),o=Math.floor(e*(2/3))){if(e<3)return!1;r(D,c);let u=a,m=!1;for(;u<e-1&&!m;)r(G,u),u++,m=!f(D,G);if(!m)return!1;for(u=Math.max(u,o),m=!1;u<e&&!m;)r(H,u),u++,i(J,D,G),s(J,J),i(K,G,H),s(K,K),m=!f(D,H)&&!f(G,H)&&Math.abs(n(J,K))<B;return m?(U(D,G,H,t),!0):(0!==c||1!==a||2!==o)&&k(t,r,e,0,1,2)}function z(t,r,n=!0){const e=r.length/3;return k(t,((t,n)=>m(t,r[3*n+0],r[3*n+1],r[3*n+2])),n?e-1:e)}const B=.99619469809,D=h(),G=h(),H=h(),J=h(),K=h();function R(t,r,e){return r!==t&&q(t,r),t[3]=-n(t,e),t}function S(t,r){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function W(t,r,n,e){return c(H,r,t),Q(n,H,e)}function Y(t,r,n,e){return ut(t,r,i(b.get(),n,r),ht,e)}function Z(t,r,n){return null!=r&&ut(t,r.origin,r.direction,It,n)}function $(t,r,n){return ut(t,r.origin,r.vector,mt.NONE,n)}function tt(t,r,n){return ut(t,r.origin,r.vector,mt.CLAMP,n)}function rt(t,r){return ot(t,r)>=0}function nt(t,r){const e=n(t,r.ray.direction),s=-ot(t,r.ray.origin);if(s<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return s>0;if((s<0||e<0)&&!(s<0&&e<0))return!0;const c=s/e;return e>0?c<r.c1&&(r.c1=c):c>r.c0&&(r.c0=c),r.c0<=r.c1}function et(t,r){const e=n(t,r.ray.direction),s=-ot(t,r.ray.origin);if(e>-1e-6&&e<1e-6)return s>0;const c=s/e;return e>0?c<r.c1&&(r.c1=c):c>r.c0&&(r.c0=c),r.c0<=r.c1}function st(t,r,n){const e=a(b.get(),t,-t[3]),s=at(t,i(b.get(),r,e),b.get());return o(n,s,e),n}function ct(t,r,n,e){const s=t,c=b.get(),a=b.get();p(s,c,a);const o=i(b.get(),n,r),u=j(c,o),f=j(a,o),h=j(s,o);return m(e,u,f,h)}function at(t,r,e){const s=a(b.get(),t,n(t,r));return i(e,r,s),e}function it(t,r){return Math.abs(ot(t,r))}function ot(t,r){return n(t,r)+t[3]}function ut(t,e,s,c,i){const u=n(t,s);if(0===u)return!1;let f=-(n(t,e)+t[3])/u;return c&mt.CLAMP&&(f=r(f,0,1)),!(!(c&mt.INFINITE_MIN)&&f<0||!(c&mt.INFINITE_MAX)&&f>1||(o(i,e,a(i,s,f)),0))}const ft=[0,0,1,0];var mt;!function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"}(mt||(mt={}));const ht=mt.INFINITE_MIN|mt.INFINITE_MAX,It=mt.INFINITE_MAX;export{nt as A,P as B,it as C,Y as D,O as E,z as F,S as G,at as H,y as a,A as b,C as c,W as d,R as e,U as f,L as g,q as h,x as i,Z as j,$ as k,tt as l,rt as m,st as n,j as o,ct as p,w as q,Q as r,b as s,E as t,k as u,V as v,X as w,d as x,et as y,ot as z};
