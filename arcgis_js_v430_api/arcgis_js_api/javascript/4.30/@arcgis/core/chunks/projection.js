/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{h as r,d as o}from"./mathUtils.js";import{n as t,f as e}from"./mat3.js";import{c as s}from"./mat3f64.js";import{m as i,b as n,i as a}from"./mat4.js";import{I as m,c as p}from"./mat4f64.js";import{r as c,n as l,g as f}from"./vec3.js";import{Z as u,c as j}from"./vec3f64.js";import{canProjectWithoutEngine as y}from"../geometry/projection.js";import{g}from"./spatialReferenceEllipsoidUtils.js";import{c as T}from"./computeTranslationToOriginAndRotation.js";import{p as d}from"./projectBuffer.js";import{n as A,c as P}from"./DoubleArray.js";import{N as M,O as N,Q as O,h}from"./unitUtils.js";import{y2lat as R}from"../geometry/support/webMercatorUtils.js";import{B as E,a as F}from"./BufferView.js";import{t as S,n as _,a as b}from"./vec32.js";import{t as v}from"./vec42.js";import"./common.js";import"../core/Error.js";import"../core/lang.js";import"./Logger.js";import"../config.js";import"../core/promiseUtils.js";import"./handleUtils.js";import"./maybe.js";import"./tracking.js";import"./utils.js";import"./SimpleObservable.js";import"./ObservableBase.js";import"../geometry/Extent.js";import"./tslib.es6.js";import"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./metadata.js";import"../core/accessorSupport/decorators/subclass.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../core/scheduling.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./writer.js";import"./jsonMap.js";import"./assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./coordsUtils.js";import"./Axis.js";import"./extentUtils.js";import"./aaBoundingRect.js";import"../geometry/Polyline.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"./zscale.js";import"./geodesicConstants.js";import"./vec2.js";import"./vec4.js";const C="Projection may be possible after calling projection.load().";function L(r,o,t,e){r.error(`Failed to project from (wkid:${o.wkid}) to (wkid:${t.wkid}).${e?" ":""}${e}`)}function G(r,o,t,e,s){return I(D.TO_PCPF,E.fromTypedArray(r),Y.NORMAL,F.fromTypedArray(o),F.fromTypedArray(t),e,E.fromTypedArray(s))?s:null}function U(r,o,t,e,s){return I(D.FROM_PCPF,E.fromTypedArray(r),Y.NORMAL,F.fromTypedArray(o),F.fromTypedArray(t),e,E.fromTypedArray(s))?s:null}function x(r,o,t){return d(r,o,0,t,g(o),0,r.length/3)?t:null}function w(r,o,t){return d(r,g(t),0,o,t,0,r.length/3)?o:null}function B(o,e,s){return t(X,s),S(e,o,X),r(X)&&_(e,e),e}function V(o,t,s){return e(X,s),v(t,o,X),r(X)&&_(t,t,4),t}function k(r,t,e,s){const i=t===Y.NORMAL;return q(r,t,e,((r,t)=>{const e=Math.cos(o(r));t[0]=i?e:1/e,t[1]=1}),s)}function $(r,o,t,e){const s=o===Y.NORMAL;return q(r,o,t,((r,o)=>{const t=Math.cosh(-r/h.radius);o[0]=1,o[1]=s?t:1/t}),e)}function q(r,o,t,e,s){const i=o===Y.NORMAL?3:4,n=[0,0];for(let o=0,a=1;o<r.length;o+=i,a+=3){e(t[a],n);const m=r[o]*n[0],p=r[o+1]*n[1],c=r[o+2],l=1/Math.sqrt(m*m+p*p+c*c);s[o]=m*l,s[o+1]=p*l,s[o+2]=c*l,4===i&&(s[o+3]=r[o+3])}return s}function z(r,o,t,e,s){if(!I(D.TO_PCPF,E.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),Y.TANGENT,F.fromTypedArray(o),F.fromTypedArray(t),e,E.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let o=3;o<r.length;o+=4)s[o]=r[o];return s}function W(r,o,t,e,s){if(!I(D.FROM_PCPF,E.fromTypedArray(r,16),Y.TANGENT,F.fromTypedArray(o),F.fromTypedArray(t),e,E.fromTypedArray(s,16)))return null;for(let o=3;o<r.length;o+=4)s[o]=r[o];return s}var Y,D;function H(r,o,s,i,n){switch(T(i,s,K,i),r===D.FROM_PCPF&&a(K,K),o){case Y.NORMAL:return t(n,K);case Y.TANGENT:return e(n,K)}}function I(r,o,t,e,s,i,n){if(!o)return;const a=e.count,m=g(i);if(function(r){return r.isWGS84||M(r)||N(r)||O(r)}(i))for(let e=0;e<a;e++)s.getVec(e,Q),o.getVec(e,Z),c(Z,Z,H(r,t,Q,m,X)),n.setVec(e,Z);else for(let i=0;i<a;i++){s.getVec(i,Q),o.getVec(i,Z);const a=R(e.get(i,1));let p=Math.cos(a);t===Y.TANGENT!=(r===D.TO_PCPF)&&(p=1/p),H(r,t,Q,m,X),r===D.TO_PCPF?(X[0]*=p,X[1]*=p,X[2]*=p,X[3]*=p,X[4]*=p,X[5]*=p):(X[0]*=p,X[3]*=p,X[6]*=p,X[1]*=p,X[4]*=p,X[7]*=p),c(Z,Z,X),l(Z,Z),n.setVec(i,Z)}return n}function J(r){return"local"===r.vertexSpace.type?function({vertexSpace:r,transform:o,inSpatialReference:t,outSpatialReference:e,localMode:s,outPositions:n,positions:a}){const p=r.origin??u,c=null!=r.origin?o?.localMatrix??m:m,l=g(t),f=e.isWebMercator&&s||!y(t,l)?t:l;T(t,p,K,f),i(K,K,c);const j=n??A(a.length);return b(j,a,K),d(j,f,0,j,e,0,j.length/3),j}(r):function({vertexSpace:r,transform:o,outPositions:t,positions:e,inSpatialReference:s,outSpatialReference:i}){const a=null!=r.origin?o?.localMatrix??m:m,p=t??A(e.length);n(a,m)?P(p,e):b(p,e,a);const c=r.origin??u;if(!f(c,u)){const[r,o,t]=c;for(let e=0;e<p.length;e+=3)p[e]+=r,p[e+1]+=o,p[e+2]+=t}return d(p,s,0,p,i,0,p.length/3)?p:null}(r)}!function(r){r[r.NORMAL=0]="NORMAL",r[r.TANGENT=1]="TANGENT"}(Y||(Y={})),function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(D||(D={}));const Q=j(),Z=j(),K=p(),X=s();export{Y as VectorType,C as loadProjectErrorMessage,L as logProjectionError,J as project,w as projectFromPCPF,U as projectNormalFromPCPF,G as projectNormalToPCPF,W as projectTangentFromPCPF,z as projectTangentToPCPF,x as projectToPCPF,B as transformNormal,V as transformTangent,k as transformVectorENUPlateCarree,$ as transformVectorWMPlateCarree};
