"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[5075],{35075:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B});var i,n=a(32816),s=(a(94345),a(17745)),o=a(6407),r=a(20266),l=a(36544),h=a(80959),u=a(29298),d=(a(32773),a(69421)),c=a(73597),p=a(83637),y=a(96153),g=a(16702),m=a(31315),f=a(96807),L=a(18683),C=a(43551),M=a(44600),k=a(64752),b=a(67504);let w;var E;a(2160),a(99924),a(41390),a(40499),a(93181),a(13671),a(58498),a(91047),a(45371),a(49877),a(7969),a(69763),a(93804),a(90740),a(56273),a(64604),a(29512),a(99063),a(36533),a(29208),a(48844),a(84200),a(97827),a(91695),a(18169),a(48402),a(16699),a(26809),a(2589),a(18527),a(92517),a(77037),a(81272),a(44945),a(66136),a(4734),a(50214),a(59192),a(78016),a(54483),a(80473),a(73509),a(28276),a(47239),a(72393),a(52731),a(30011),a(55270),a(95779),a(13262),a(346),a(51961),a(62399),a(64995),a(33150),a(58173),a(66110),a(67520),a(27532),a(88663),a(48103),a(65085),a(33611),a(84857),a(60373),a(98187),a(35902),a(13226),a(16794),a(52357),a(11090),a(49319),a(93546),a(29570),a(34592),a(79825),a(95101),a(67578),a(14896),a(95611),a(98089),a(91366),a(43435),a(73435),a(91381),a(4048),a(85232),a(93471),a(53252),a(34039),a(70061),a(3495),a(97906),a(64524),a(65023),a(31424),a(74676),a(53610),a(29447),a(78273),a(49475),a(32368),a(7391),a(22529),a(43534),a(38094),a(67723),a(59858),a(63728),a(1178),a(7182),a(47788),a(19297),a(82408),a(69277),a(70580),a(75191),a(24319),a(62092),a(4157),a(62401),a(89322),a(20138),a(53370),a(46946),a(3816),a(71992),a(80167),a(4478),a(91808),a(7161),a(55586),a(35121),a(92229),a(18344),a(64884),a(23351),a(51222),a(42870),a(67321),a(73067),a(54512),a(53103),a(19648),a(42948),a(60027),a(57111),a(75651),a(88614),a(1030),a(15319),a(60785),a(56487),a(6399),a(9498),a(23105),a(24079),a(38149),a(19681),a(40328),a(84539),a(65299),a(6510),a(38641),a(27281),a(73502),a(19869),a(3827),a(65174),a(78328),a(72604),a(54616),a(25018),a(49011),a(23787),a(22151),a(38632),a(79875),a(133),a(83002),a(24330),a(91276),a(62482),a(45476),a(69310),a(43682),a(85351),a(54481),a(1535),a(9943),a(89253),a(16677),a(17813),a(3112),a(46626),a(45560),a(56303),a(85890),a(55884),a(32397),a(2810),a(11494),a(6801),a(41003),a(9380),a(78281),a(47387),a(46728),a(64102),a(13141),a(42614),a(11721),a(32159),a(67138),a(59700),a(3952),a(339),a(79281),a(69033),a(13978),a(2824),a(56764),a(11618),a(2232),a(38896),a(26589),a(17872),a(70648),a(49010),a(47215),a(71044),a(172),a(65283),a(43059),a(89935),a(49813),a(81623),a(13478),a(12856),a(47812),a(47368),a(88817),a(75169),a(75377),a(33348),a(53104),a(49197),a(56833),a(73600),a(81284),a(44864),a(95637),a(59930),a(45862),a(72762),a(71613),a(78860),a(26805),a(13983),a(38093),a(25643),a(56367),a(12119),a(13201),a(8904),a(29755),a(97511),a(32264),a(68849),a(82842),a(98238),a(49755),a(54131),a(58196),a(86941),a(1739),a(81618),a(10224),a(36309),a(62959),a(74159),a(90197),a(76636),a(6837),a(96625),a(46935),a(69448),a(79205),a(35619),a(60408),a(8824),a(20978),a(91308),a(53206),a(77e3),a(19049),a(64724),a(63402),a(17618),a(43053),a(19548),a(92975),a(7603),a(14658),a(10043),a(89754),a(76999),a(6105),a(72076),a(5370),a(76641),(E=i||(i={})).MULTIPLIER="multiplier",E.ABSOLUTE="absoluteValue";let T=null;var D,A,x,N,v,_,R,I,P,G,S;function O(e,t,a,i,n,s){const o=a.length,r=n.length,l=Float64Array.BYTES_PER_ELEMENT,h=Uint32Array.BYTES_PER_ELEMENT,u=Uint8Array.BYTES_PER_ELEMENT,d=16+o*(u+2*l)+r*(2*h),c=T._malloc(d);try{const u=c+16-c%16,d=u+o*l,p=d+o*l,y=p+r*h,g=y+r*h,m=()=>[T.HEAPF64.subarray(u>>3,(u>>3)+o),T.HEAPF64.subarray(d>>3,(d>>3)+o),T.HEAPU32.subarray(p>>2,(p>>2)+r),T.HEAPU32.subarray(y>>2,(y>>2)+r),T.HEAPU8.subarray(g,g+o)],[f,L,C,M,k]=m();f.set(a),L.set(i),C.set(n),M.set(s),k.set(t);let b=e(o,g,u,d,r,p,y),w=null,E=null;if(b){const e=T.getLayoutLinksTypes(),t=T.getLayoutLinksVerticesEndIndices(),a=T.getLayoutLinksVertices(),i=T.countLayoutLinksVertices();!r||e&&t?i&&!a?b=!1:(w={types:new Uint8Array(T.HEAPU8.subarray(e,e+r)),vertexEndIndex:new Uint32Array(T.HEAPU32.subarray(t>>2,(t>>2)+r)),vertices:new Float64Array(T.HEAPF64.subarray(a>>3,(a>>3)+2*i))},E=T.getAuxiliaryGraphicElements()):b=!1}const[D,A,x,N,v]=m();return a.set(D),i.set(A),n.set(x),s.set(N),t.set(v),{success:b,links:w,graphics:E}}finally{T._free(c),T.cleanupLayout()}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(D||(D={})),function(e){e[e.Regular=0]="Regular",e[e.Orthogonal=1]="Orthogonal",e[e.Curved=2]="Curved",e[e.Recursive=3]="Recursive"}(A||(A={})),function(e){e.getMinIdealEdgeLength=function(){return T.getMinIdealEdgeLength()},e.apply=function(e,t,a,i,n,s=2,o=1,r=-1){return O(((e,t,a,i,n,l,h)=>T.applyForceDirectedLayout(e,t,a,i,n,l,h,s,o,r)),e,t,a,i,n)}}(x||(x={})),function(e){e.apply=function(e,t,a,i,n,s=2,o=1,r=-1){return O(((e,t,a,i,n,l,h)=>T.applyCommunityLayout(e,t,a,i,n,l,h,s,o,r)),e,t,a,i,n)}}(N||(N={})),function(e){e.apply=function(e,t,a,i,n){return O(T.applySimpleLayout,e,t,a,i,n)}}(v||(v={})),function(e){e.apply=function(e,t,a,i,n){return O(T.applyHierarchicalLayout,e,t,a,i,n)}}(_||(_={})),function(e){e.apply=function(e,t,a,i,n){return O(T.applyRadialTreeLayout,e,t,a,i,n)}}(R||(R={})),function(e){e.apply=function(e,t,a,i,n){return O(T.applySmartTreeLayout,e,t,a,i,n)}}(I||(I={})),function(e){e.apply=function(e,t,a,i,n,s,o,r,l){return O(((e,t,a,s,o,h,u)=>{if(i.length!==e)return!1;if(n.length!==e)return!1;if(r.length!==o)return!1;if(l.length!==o)return!1;const d=Float64Array.BYTES_PER_ELEMENT,c=16,p=T._malloc(c+e*d),y=T._malloc(c+e*d),g=T._malloc(c+o*d),m=T._malloc(c+o*d),f=p+c-p%c,L=y+c-y%c,C=g+c-g%c,M=m+c-m%c;try{return T.HEAPF64.subarray(f>>3,(f>>3)+e).set(i),T.HEAPF64.subarray(L>>3,(L>>3)+e).set(n),T.HEAPF64.subarray(C>>3,(C>>3)+o).set(r),T.HEAPF64.subarray(M>>3,(M>>3)+o).set(l),T.applyChronologicalLayout(e,t,a,s,f,L,o,h,u,C,M)}finally{T._free(p),T._free(y),T._free(g),T._free(m)}}),e,t,a,s,o)}}(P||(P={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(G||(G={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(S||(S={}));let H=class extends((0,m.dM)((0,f.j)(c.A))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new s.A,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new M.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new s.A,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new o.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const t=new Set;let a=[],i=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new o.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(a=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,s)=>{const o=this._graphTypeLookup.get(s);if(!o)return r.L.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(s);"relationship"===o.type?t.has(s)||(t.add(s),i.push(o)):"entity"===o.type?t.has(s)||(t.add(s),a.push(o)):(r.L.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(s))})):(a=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]);const n=new g.K({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=a,this.memberRelationshipTypes=i,this.dataManager=n}load(e){return this.addResolvingPromise(new Promise((t=>{(0,C.fetchKnowledgeGraph)(this.url).then((a=>{if(this._initializeLayerProperties({knowledgeGraph:a,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})})),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.useAllData=!1,e.members?.forEach((e=>{let t;t=e.linkChartLocation instanceof y.O?e.linkChartLocation:e.linkChartLocation?(0,p.b)(e.linkChartLocation):null,t&&2===t.coords.length&&0===t.lengths.length?this.entityLinkChartDiagramLookup.set(e.id,t):this.relationshipLinkChartDiagramLookup.set(e.id,t)})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{const t="GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode;this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,h.Te)(e);const t=[],a=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let a=[];t?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(a=await(0,g.g)(e,this.dataManager.knowledgeGraph));const i=e.concat(a).filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));await this._handleNewRecords(i)}async removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:a=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){let i=[];for(const t of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(t.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(t.typeName)?.members?.has(t.id)&&i.push(t);if(t){const e=new Set,t=[];for(const t of i)if(this.dataManager.nodeConnectionsLookup.has(t.id))for(const a of this.dataManager.nodeConnectionsLookup.get(t.id))e.add(a);for(const a of e)if(this.dataManager.memberIdTypeLookup.has(a))for(const e of this.dataManager.memberIdTypeLookup.get(a))this.dataManager.relationshipTypeNames.has(e)&&t.push({id:a,typeName:e});i=i.concat(t)}this.dataManager.removeFromLayer(i);for(const e of i)this.sublayerIdsCache.get(e.typeName)?.delete(e.id),this.dataManager.relationshipTypeNames.has(e.typeName)?this.relationshipLinkChartDiagramLookup.delete(e.id):this.entityLinkChartDiagramLookup.delete(e.id);a&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,this._currentLinkChartConfig.layoutOptions);const n=[];return this.layers.forEach((e=>{n.push(e.refreshCachedQueryEngine())})),await Promise.all(n),this._refreshNamedTypes(),i}async expand(e,t){const a=await this.dataManager.getConnectedRecordIds(e,t),i=a.filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));return await this._handleNewRecords(a),{records:i}}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach((e=>{const t=new g.A({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new g.A({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const a=(0,l.g)(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof y.O)this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation);else{const a=(0,p.b)(e.linkChartLocation);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null)}}))}))}async calculateLinkChartLayout(e="RADIAL_TREE",t){const i=[],n=[],s=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{i.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{n.push({typeName:t,feature:e})}))})),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map;const l=new Map,h=new Map,u=new Map,d=new Map,c=new Uint8Array(i.length),y=new Float64Array(i.length),m=new Float64Array(i.length),f=new Uint32Array(n.length),C=new Uint32Array(n.length),E=[],P=new M.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let G,S="FORCE_DIRECTED",O=0,H=0;switch(S="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,S){case"FORCE_DIRECTED":G=x.apply;break;case"COMMUNITY":G=N.apply;break;case"HIERARCHICAL":G=_.apply;break;case"RADIAL_TREE":G=R.apply;break;case"SMART_TREE":G=I.apply;break;default:G=v.apply}i.forEach((({typeName:a,feature:i})=>{if(t?.lockedNodeLocations?.has(i.attributes[g.m])){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)?c[O]=D.IsGeographic:c[O]=D.None;const n=t.lockedNodeLocations.get(i.attributes[g.m]);y[O]=n.x,m[O]=n.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)){c[O]=D.IsGeographic;let e=null;const t=i.attributes[this.dataManager.geographicLookup.get(a).name],n=this.dataManager.geographicLookup.get(a)?.geometryType;switch(n){case"esriGeometryPoint":y[O]=t?.x,m[O]=t?.y;break;case"esriGeometryPolygon":e=t?.centroid,null!=e?.x&&null!=e?.y?(y[O]=e.x,m[O]=e.y):c[O]=D.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=t?.extent?.center,null!=e?.x&&null!=e?.y?(y[O]=e.x,m[O]=e.y):c[O]=D.IsMovable;break;default:c[O]=D.IsMovable}(null==y[O]||null==m[O]||Number.isNaN(y[O])||Number.isNaN(m[O]))&&(c[O]=D.IsMovable,y[O]=0,m[O]=0)}else c[O]=D.IsMovable,y[O]=0,m[O]=0;d.set(i.attributes[g.m],O),E[O]={feature:i,typeName:a},O++}));let B=!1;const F=new Map;n.forEach((e=>{const t=e.feature.attributes[g.a],a=e.feature.attributes[g.b],i=d.get(t),n=d.get(a);if(void 0!==i&&void 0!==n){const o=t+"-"+a,r=F.get(o),l=r?.has(e.typeName);l||(f[H]=i,C[H]=n,void 0===r?F.set(o,new Map([[e.typeName,H]])):r.set(e.typeName,H),H++),s.push(e)}else B=!0,this.relationshipLinkChartDiagramLookup.set(t,null)})),B&&r.L.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null");const U=this._validateLayoutSettings(e,t),z=this._convertLayoutSettingsToCalculationSettings(U);await(w||(w=a.e(8269).then(a.bind(a,8269)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,L.g)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{T=e})),w));const{success:Z,links:j}=G(c,y,m,f.subarray(0,H),C.subarray(0,H),z.computationBudgetTime,z.idealEdgeLengthMultiplier,z.repulsionRadiusMultiplier);if(!Z)throw new o.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let e=0;e<E.length;e++){if(m[e]>84.9999?m[e]=84.9999:m[e]<-84.9999&&(m[e]=-84.9999),y[e]>179.9999?y[e]=179.9999:y[e]<-179.9999&&(y[e]=-179.9999),E[e].feature.attributes[g.c]=new k.A(y[e],m[e]),l.has(E[e].typeName)){const t=l.get(E[e].typeName);t?.set(E[e].feature.attributes[g.m],E[e].feature)}else{const t=new Map;t.set(E[e].feature.attributes[g.m],E[e].feature),l.set(E[e].typeName,t)}u.set(E[e].feature.attributes[g.m],E[e].feature);const t=(0,p.b)(E[e].feature.attributes[g.c]);this.entityLinkChartDiagramLookup.set(E[e].feature.attributes[g.m],E[e].feature.attributes[g.c]?t:null),E[e].feature.attributes[g.c].x<P.xmin&&(P.xmin=E[e].feature.attributes[g.c].x),E[e].feature.attributes[g.c].x>P.xmax&&(P.xmax=E[e].feature.attributes[g.c].x),E[e].feature.attributes[g.c].y<P.ymin&&(P.ymin=E[e].feature.attributes[g.c].y),E[e].feature.attributes[g.c].y>P.ymax&&(P.ymax=E[e].feature.attributes[g.c].y)}if(this.linkChartExtent.xmin=P.xmin,this.linkChartExtent.xmax=P.xmax,this.linkChartExtent.ymin=P.ymin,this.linkChartExtent.ymax=P.ymax,!j)throw new o.A("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const Q=new Map,Y=new Map,V=new Map,$=new Set;for(let e=0;e<s.length;e++){const t=[],a=s[e],i=a.feature.attributes[g.a],n=a.feature.attributes[g.b],o=i+"-"+n,l=F.get(o).get(a.typeName),c=0===l?0:j?.vertexEndIndex[l-1];if(!$.has(l)){if($.add(l),j.types[l]===A.Recursive){const e=[j.vertices[2*c],j.vertices[2*c+1]],a=[j.vertices[2*(c+1)],j.vertices[2*(c+1)+1]],i=[.5*(e[0]+a[0]),.5*(e[1]+a[1])],n=[i[0]-e[0],i[1]-e[1]],s=[i[0]+n[1],i[1]-n[0]],o=[i[0]-n[1],i[1]+n[0]];t.push(e),t.push(s),t.push(a),t.push(o),t.push(e)}else{if(j.types[l]!==A.Regular){r.L.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let e=c;e<j.vertexEndIndex[l];e++)t.push([j.vertices[2*e],j.vertices[2*e+1]])}const e=E[d.get(i)]?.feature.attributes[g.c],a=E[d.get(n)]?.feature.attributes[g.c];t[0][0]===e.x&&t[0][1]===e.y||(t[0]=[e.x,e.y]),t[t.length-1][0]===a.x&&t[t.length-1][1]===a.y||(t[t.length-1]=[a.x,a.y]);for(let e=1;e<t.length-1;e++)t[e][1]>85.5?t[e][1]=85.5:t[e][1]<-85.5&&(t[e][1]=-85.5),t[e][0]>179.9999?t[e][0]=179.9999:t[e][0]<-179.9999&&(t[e][0]=-179.9999);Q.has(o)?Q.get(o).push(t):Q.set(o,[t])}const y=Q.get(o);Y.has(o)||(Y.set(o,new Map),V.set(o,new Map));const m=Y.get(o),f=V.get(o);m.has(a.typeName)||(m.set(a.typeName,y.shift()),f.set(a.typeName,0));const L=m.get(a.typeName);f.set(a.typeName,f.get(a.typeName)+1);const C=new b.A({paths:L});if(a.feature.attributes[g.c]=C,h.has(a.typeName)){const e=h.get(a.typeName);e?.set(a.feature.attributes[g.m],a.feature)}else{const e=new Map;e.set(a.feature.attributes[g.m],a.feature),h.set(a.typeName,e)}u.set(a.feature.attributes[g.m],a.feature);const M=(0,p.b)(a.feature.attributes[g.c]);this.relationshipLinkChartDiagramLookup.set(a.feature.attributes[g.m],a.feature.attributes[g.c]?M:null)}for(const e of s)e.feature.attributes[g.d]=V.get(e.feature.attributes[g.a]+"-"+e.feature.attributes[g.b])?.get(e.typeName)??null;return this._currentLinkChartConfig={layoutMode:e,layoutOptions:U},{nodes:l,links:h,idMap:u}}async applyNewLinkChartLayout(e="RADIAL_TREE",t){const a=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a),this._refreshNamedTypes()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t=>{t?.members?.forEach((t=>{const a=t.linkChartLocation;let i;const n=t.id;a&&(i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]},e.set(n,new k.A({x:i.x,y:i.y})))}))})),e}async synchronizeInclusionListWithCache(){return new Promise((e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const a=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!a.has(e))).forEach((t=>{e.members?.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async connectEntities(e){let t=[];for(const e of this.dataManager.relationshipTypeNames){const a=this.sublayerIdsCache.get(e);a&&(t=t.concat(Array.from(a.keys())))}const a=await this.dataManager.getAttachedRelationships(e,t);return await this._handleNewRecords(a),{records:a}}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const a of e)this.sublayerIdsCache.has(a.typeName)||(this.sublayerIdsCache.set(a.typeName,new Set),t.push(a.typeName)),this.sublayerIdsCache.get(a.typeName).add(a.id);for(const e of t){const t=this._graphTypeLookup.get(e);if(t){const a=new g.A({objectType:t,parentCompositeLayer:this,graphType:t.type,title:e});"entity"===t.type?this.dataManager.entityTypeNames.add(e):this.dataManager.relationshipTypeNames.add(e),a.geometryType?this.layers.push(a):this.tables.push(a),this.dataManager.sublayerCaches.set(e,new Map)}}await this.dataManager.refreshCacheContent(e.map((e=>e.id)));const a=Object.assign({},this._currentLinkChartConfig.layoutOptions);a.lockedNodeLocations=this.getCurrentNodeLocations(),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,a)}async _initializeDiagram(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e?.members?.forEach((e=>{const a=e.linkChartLocation;let i;const n=e.id;if(!a)return;i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]};const s=(0,p.b)(i);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(n,s):this.entityLinkChartDiagramLookup.set(n,s),this.linkChartExtent.xmin>i.x&&(this.linkChartExtent.xmin=i.x),this.linkChartExtent.xmax<i.x&&(this.linkChartExtent.xmax=i.x),this.linkChartExtent.ymin>i.y&&(this.linkChartExtent.ymin=i.y),this.linkChartExtent.ymax<i.y&&(this.linkChartExtent.ymax=i.y)}))})),this.memberRelationshipTypes.forEach((e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach((e=>{const t=this.relationshipLinkChartDiagramLookup.get(e.attributes[g.a]),a=this.relationshipLinkChartDiagramLookup.get(e.attributes[g.b]);if(t&&a){const i=(0,p.b)(new b.A({paths:[[t.coords[0],t.coords[1]],[a.coords[0],a.coords[1]]]}));this.relationshipLinkChartDiagramLookup.set(e.attributes[g.m],i)}else this.relationshipLinkChartDiagramLookup.set(e.attributes[g.m],null)}))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:this.getCurrentNodeLocations(),...this.defaultLinkChartConfig.layoutOptions||{}}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}_validateLayoutSettings(e,t){const a=e=>"number"==typeof e&&!isNaN(e),n=new Set(["FORCE_DIRECTED","COMMUNITY","GEOGRAPHIC"]),s={};if(!n.has(e)||!t)return!n.has(e)&&t&&r.L.getLogger(this).warn("Layout mode options were given for a layout mode that does not utilize them, settings will be ignored"),s;const{computationBudgetTime:o,repulsionRadiusMultiplier:l,idealEdgeLength:h,idealEdgeLengthType:u}=t;var d,c;a(d=o)&&d>=1?s.computationBudgetTime=o:void 0!==o&&r.L.getLogger(this).warn("Invalid layout computationBudgetTime setting, will revert to default setting"),a(c=l)&&c>=1?s.repulsionRadiusMultiplier=l:void 0!==l&&r.L.getLogger(this).warn("Invalid layout repulsionRadiusMultiplier setting, will revert to default setting");const p=void 0!==h||void 0!==u;var y,g;return"GEOGRAPHIC"!==e&&p?r.L.getLogger(this).warn("Ideal edge length settings were specified for an incompatible layout mode, and will be ignored"):"GEOGRAPHIC"===e&&p&&(g=u,Object.values(i).includes(g)?s.idealEdgeLengthType=u:void 0!==u&&r.L.getLogger(this).warn('Invalid layout idealEdgeLengthType setting, will revert to "multiplier" setting'),a(y=h)&&y>=0?s.idealEdgeLength=h:void 0!==h&&r.L.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting")),s}_convertLayoutSettingsToCalculationSettings(e){let t=e.idealEdgeLength;return e.idealEdgeLengthType===i.ABSOLUTE&&(void 0===t?t=-1:t*=-1),{computationBudgetTime:e.computationBudgetTime,repulsionRadiusMultiplier:e.repulsionRadiusMultiplier,idealEdgeLengthMultiplier:t}}};(0,n._)([(0,u.MZ)()],H.prototype,"dataPreloadedInLocalCache",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"defaultLinkChartConfig",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"dataManager",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"knowledgeGraph",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"layers",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"entityLinkChartDiagramLookup",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"linkChartExtent",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"memberEntityTypes",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"memberRelationshipTypes",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"sublayerIdsCache",void 0),(0,n._)([(0,u.MZ)()],H.prototype,"tables",void 0),(0,n._)([(0,u.MZ)({json:{read:!1}})],H.prototype,"type",void 0),H=(0,n._)([(0,d.$)("esri.layers.LinkChartLayer")],H);const B=H}}]);