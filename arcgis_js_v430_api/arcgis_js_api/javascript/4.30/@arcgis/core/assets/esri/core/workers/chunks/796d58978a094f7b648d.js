"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[4295],{79697:(e,t,r)=>{r.d(t,{a:()=>o,c:()=>l});var a=r(99063),n=r(82408);function o(e,t){return{...s(e,t),readResourcePaths:[]}}function l(e,t,r){const n=(0,a.An)(e.itemUrl);return{...s(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function s(e,t){return{origin:t,url:(0,a.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e}}},24295:(e,t,r)=>{r.d(t,{load:()=>f});var a=r(6407),n=r(1985),o=r(89157),l=r(56810),s=r(60570),i=r(57492),c=r(82408),u=r(79697),p=r(82454),y=r(58396),d=r(30861);async function f(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:i,title:c}=n,f=(0,u.a)(n,"portal-item");if("group"===r.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:c}=n;if("Group Layer"===c){if(!(0,p.h)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e){const t=e.portalItem,r=await t.fetchData("json");if(!r)return;const a=(0,u.a)(t,"web-map");e.read(r,a),await(0,s.N)(e,r,{context:a}),e.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]}}(e)}return e.read({title:i},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const s=n.type,i=t.layerModuleTypeMap;switch(s){case"Feature Service":case"Feature Collection":r=i.FeatureLayer;break;case"Stream Service":r=i.StreamLayer;break;case"Scene Service":r=i.SceneLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const c=new l.L;let[u,p]=await Promise.all([r(),h(t,c)]),y=()=>u;if("Feature Service"===s){const t=(0,l.g)(p)?.customParameters;p=n.url?await(0,l.p)(p,n.url,c):{},y=await async function(e,t){const{layers:r}=e;if(!r?.length)return;const a=new Set,n=[];for(const{layerType:e}of r){const r=e??"ArcGISFeatureLayer";if(a.has(r))continue;a.add(r);const o=t[(0,l.l)(r)];n.push(o())}const o=await Promise.all(n),s=new Map;return Array.from(a).forEach(((e,t)=>{s.set(e,o[t])})),({layerType:e})=>{const t=e??"ArcGISFeatureLayer";return s.get(t)}}(p,i)||y;const r=await async function(e,t){const{layersJSON:r}=await(0,o.f)(e,t);if(!r)return null;const a=[...r.layers,...r.tables];return e=>a.find((t=>t.id===e.id))}(n.url,{customParameters:t,loadContext:c});return await m(e,y,p,r)}return"Scene Service"===s&&n.url&&(p=await(0,l.a)(n,p,c)),(0,l.b)(p)>0?await m(e,y,p):await async function(e,t){const{portalItem:r}=e;if(!r?.url)return;const a=await(0,d.f)(r.url);a&&m(e,t,{layers:a.layers?.map(l.c),tables:a.tables?.map(l.c)})}(e,y)}(e,r)}(r,f,e);i&&"media"!==r.type&&r.read({url:i},f);const w=new l.L,g=await h(e,w,t);return g&&r.read(g,f),r.resourceReferences={portalItem:n,paths:f.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:c},f),(0,y.l)(r,f)}(e,t)}async function m(e,t,r,a){let n=r.layers||[];const o=r.tables||[];if("Feature Collection"===e.portalItem?.type?(n.forEach(((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&o.push(e)})),n=n.filter((e=>"Table"!==e?.layerDefinition?.type))):(n.reverse(),o.reverse()),n.forEach((n=>{const o=a?.(n);if(o||!a){const a=w(e,t(n),r,n,o);e.add(a)}})),o.length){const t=await i.l.FeatureLayer();o.forEach((n=>{const o=a?.(n);if(o||!a){const a=w(e,t,r,n,o);e.tables.add(a)}}))}}function w(e,t,r,a,n){const o=e.portalItem,l={portalItem:o.clone(),layerId:a.id};null!=a.url&&(l.url=a.url);const s=new t(l);if("sourceJSON"in s&&(s.sourceJSON=n),"subtype-group"!==s.type&&"catalog"!==s.type&&(s.sublayerTitleMode="service-name"),"Feature Collection"===o.type){const e={origin:"portal-item",portal:o.portal||c.A.getDefault()};s.read(a,e);const t=r.showLegend;null!=t&&s.read({showLegend:t},e)}return s}async function h(e,t,r){if(!1===e.supportsData)return;const a=e.instance,o=a.portalItem;if(!o)return;let s=null;try{s=await o.fetchData("json",r)}catch(e){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){let e=null;const r=await async function(e,t,r){if(t?.layers&&t?.tables)return(0,l.b)(t);const a=(0,n.p)(e.url);if(!a)return 1;const o=await r.fetchServiceMetadata(a.url.path,{customParameters:(0,l.g)(t)?.customParameters}).catch((()=>null));return(t?.layers?.length??o?.layers?.length??0)+(t?.tables?.length??o?.tables?.length??0)}(o,s,t);if((s?.layers||s?.tables)&&r>0){if(null==a.layerId){const e=(0,l.i)(a.type),t=e?(0,l.d)(s,e)[0]:(0,l.g)(s);t&&(a.layerId=t.id)}e=function(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(s,a),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=s.showLegend&&(e.showLegend=s.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),e}return s}r(32773),r(20266),r(90740),r(99063),r(99924),r(32816),r(41390),r(69421),r(40499),r(93181),r(13671),r(91047),r(36544),r(29298),r(58498),r(45371),r(80959),r(1178),r(29512),r(50472),r(64604),r(43059),r(18683),r(73509),r(28276),r(49877),r(44600),r(2160),r(7969),r(69763),r(93804),r(56273),r(64752),r(48844),r(29208),r(89935),r(49813),r(59192),r(69277),r(70580),r(75191),r(24319),r(62092),r(72604),r(17745),r(81272),r(44945),r(78281),r(2589),r(36533),r(84200),r(97827),r(91695),r(18169),r(48402),r(16699),r(26809),r(18527),r(67504),r(47387),r(46728),r(64102),r(73067)}}]);