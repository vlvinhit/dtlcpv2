/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{watch as t,on as s,initial as i}from"../core/reactiveUtils.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{cast as o}from"../core/accessorSupport/decorators/cast.js";import"../core/lang.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import l from"./Widget.js";import n from"./Legend/LegendViewModel.js";import"../intl.js";import{a as p}from"../chunks/screenUtils.js";import{s as c}from"../chunks/Logger.js";import{renderColorRampPreviewHTML as m,c as d,d as h}from"../symbols/support/symbolUtils.js";import{l as y}from"../chunks/utils11.js";import{c as u}from"../chunks/projector.js";import{a as v}from"../chunks/widgetUtils.js";import{t as b}from"../chunks/jsxFactory.js";import{s as g}from"../chunks/substitute.js";import{f}from"../chunks/number.js";import{H as j,i as _}from"../chunks/Heading.js";import{a as L}from"../chunks/accessibleHandler.js";import{m as w}from"../chunks/messageBundle.js";import{g as k}from"../chunks/globalCss.js";import"../chunks/asyncUtils.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../config.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/ensureType.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/featureReductionUtils.js";import"./Legend/support/ActiveLayerInfo.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"../chunks/jsonMap.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/date.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/EffectView.js";import"../chunks/parser.js";import"../chunks/utils3.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../chunks/jsonUtils.js";import"../chunks/ExportImageParameters.js";import"../chunks/scaleUtils.js";import"../chunks/floorFilterUtils.js";import"../chunks/sublayerUtils.js";import"../chunks/layerUtils2.js";import"../chunks/pixelRangeUtils.js";import"../renderers/support/jsonUtils.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../chunks/UnknownTimeZone.js";import"../chunks/OverrideHelper.js";import"../chunks/colorUtils2.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../chunks/utils7.js";import"../chunks/quantizationUtils.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/rendererConversion.js";import"../chunks/referenceSizeUtils.js";import"../chunks/enums2.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/colorRampUtils2.js";import"../chunks/utils14.js";import"../chunks/timeUtils.js";import"../chunks/numberUtils.js";import"../chunks/utils2.js";import"../chunks/basemapUtils.js";import"../Basemap.js";import"../chunks/loadAll.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../renderers/support/utils.js";import"../chunks/sizeRampUtils.js";import"../chunks/themeUtils.js";import"./smartMapping/support/utils.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";const C="esri-legend--card",S="esri-legend",R={activated:`${C}__carousel-indicator--activated`,base:C,stacked:`${S}--stacked`,carouselTitle:`${C}__carousel-title`,indicator:`${C}__carousel-indicator`,intervalSeparator:`${C}__interval-separator`,imageryLayerStretchedImage:`${C}__imagery-layer-image--stretched`,imageLabel:`${C}__image-label`,layerCaption:`${C}__layer-caption`,labelElement:`${C}__label-element`,layerRow:`${C}__layer-row`,labelCell:`${C}__label-cell`,message:`${C}__message`,rampLabel:`${C}__ramp-label`,section:`${C}__section`,relationshipSection:`${C}__relationship-section`,serviceCaptionText:`${C}__service-caption-text`,serviceContent:`${C}__service-content`,service:`${C}__service`,groupLayer:`${C}__group-layer`,groupLayerChild:`${C}__group-layer-child`,symbol:`${C}__symbol`,sizeRampRow:`${C}__size-ramp-row`,symbolRow:`${C}__symbol-row`,symbolCell:`${C}__symbol-cell`,indicatorContainer:`${C}__carousel-indicator-container`,intervalSeparatorsContainer:`${C}__interval-separators-container`,relationshipLabelContainer:`${C}__relationship-label-container`,labelContainer:`${C}__label-container`,serviceCaptionContainer:`${C}__service-caption-container`,symbolContainer:`${C}__symbol-container`,sizeRampContainer:`${C}__size-ramp-container`,sizeRampPreview:`${C}__size-ramp-preview`,pieChartRampPreview:`${C}__pie-chart-ramp-preview`,rampContainer:`${S}__ramps`,sizeRampHorizontal:`${S}__size-ramp--horizontal`,rampLabelsContainer:`${S}__ramp-labels`,layerInfo:`${S}__layer-cell ${S}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"},$=u(),I=10,x=20,z=10,A=20,U={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function E(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?b("svg",{height:"4",width:"10"},b("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):b("svg",{height:"10",width:"10"},b("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function M(e,t="vertical"){const s=document.createElement("div");return s.style.height=`${x}px`,s.className=U.univariateAboveAndBelowSymbol,null!=e&&(s.style.opacity=e.toString()),$.append(s,E.bind(null,t)),s}function V(e,t,s="vertical",i){e.infos.forEach(((e,r)=>{if(i&&2===r)e.preview=M(t,s);else{const t=p(e.size)+("horizontal"===s?A:z),i=e.preview,r="div"===i?.tagName.toLowerCase(),o=r?i:document.createElement("div");o.className=U.univariateAboveAndBelowSymbol,"horizontal"===s?o.style.width=`${t}px`:o.style.height=`${t}px`,!r&&i&&o.appendChild(i),e.preview=o}}))}function N(e,t="classic"){const s=e.infos;return"classic"===t?(p(s[0].size)+z)/2:(p(s[0].size)-p(s[s.length-1].size))/2}function F(e,t){if(!e)return null;const s=e.infos.map((e=>e.color)),i=m("full"===t.type?s:"above"===t.type?s.slice(0,3):s.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return i.className=U.colorRamp,null!=t.opacity&&(i.style.opacity=t.opacity.toString()),i}function D(e,t,s,i="vertical"){let r=0;const o=e.infos,a=Math.floor(o.length/2),l="full"===t||"above"===t?0:a,n="full"===t||"below"===t?o.length-1:a;for(let e=l;e<=n;e++)r+=s&&e===a?"horizontal"===i?I:x:p(o[e].size)+("horizontal"===i?A:z);return Math.round(r)}function P(e,t,s,i="vertical"){const r=D(e,t,s,i),o=e.infos,a=Math.floor(o.length/2),l="full"===t||"above"===t?0:a,n="full"===t||"below"===t?o.length-1:a,c="full"===t?o[l].size+o[n].size:"above"===t?o[l].size:o[n].size,m=s?"vertical"===i?x:I:0,d="vertical"===i?z*("full"===t?2:1):A*("full"===t?2:1);return Math.round(r-(p(c)/2+m/2+d/2))}function T(e,t,s="vertical"){const i=e.infos;let r=i.find((({type:e})=>"size-ramp"===e)),o=i.find((({type:e})=>"color-ramp"===e));return r&&(r={...r},r.infos=[...r.infos],V(r,t,s,!0)),o&&(o={...o},o.infos=[...o.infos]),"horizontal"===s&&(r?.infos.reverse(),o?.infos.reverse()),{sizeRampElement:r,colorRampElement:o}}function B(e,t="vertical"){const s=e.infos;let i=s.find((({type:e})=>"size-ramp"===e)),r=s.find((({type:e})=>"color-ramp"===e));return i&&(i={...i},i.infos=[...i.infos],V(i,null,t,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===t&&(i?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:i,colorRampElement:r}}function O(e){e.appendChild(this)}function H(e,t,s){if(!t)return;if("number"==typeof t)return t;if("string"==typeof t)return c(t);if("value"in t||"unit"in t)return g(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let i=null;return function(e,t){return t}(0,s)?i=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:q(0,s)&&(i=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),i?g("showField"===i?"{field}":e[i],{field:t.field,normField:t.normField}):void 0}function q(e,t){return!t}function W(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}function G(e,t){return e.label?t[e.label]+": "+("string"==typeof e.value?e.value:f(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}const Z=window.devicePixelRatio;let J=class extends l{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles(t((()=>this.activeLayerInfos),(e=>{this.removeAllHandles(),this._watchForSectionChanges(e)})))}render(){const{view:e}=this;this._hasIndicators="auto"===this.layout&&e&&e.container.clientWidth<=768||"stack"===this.layout;const t=this.activeLayerInfos,s=t?.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,r=this._sectionNames.map(((e,t)=>{const s=g(this.messagesCommon.pagination.pageText,{index:t+1,total:i});return b("div",{"aria-controls":`${e}-panel`,"aria-label":s,"aria-selected":(this._selectedSectionName===e).toString(),bind:this,class:this.classes(R.indicator,{[R.activated]:this._selectedSectionName===e}),"data-section-name":e,id:e,key:e,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===e?0:-1,title:s})})),o=this._hasIndicators&&i>1?b("div",{class:R.indicatorContainer,key:"carousel-navigation",role:"tablist"},r):null,a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s?.length?s:null,l={[R.stacked]:this._hasIndicators};return b("div",{class:this.classes(R.base,l)},a||b("div",{class:R.message},this.messages.noLegend),o)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),o=this._sectionNames;let a=null;-1!==r&&(o[r+s]?a=document.getElementById(o[r+s]):"ArrowLeft"===t?a=document.getElementById(o[o.length-1]):"ArrowRight"===t&&(a=document.getElementById(o[0])),a?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const s=`activeLayerInfo-${e.layer.uid}-version-change`;this.removeHandles(s),this._watchForSectionChanges(e.children),this.addHandles(t((()=>e.version),(()=>this._generateSectionNames())),s)}));const s="activeLayerInfos-collection-change";this.removeHandles(s),this.addHandles(e.on("change",(()=>this._watchForSectionChanges(e))),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,s){return`${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return b("div",{class:this.classes(R.service,R.groupLayer),key:e.layer.uid},b("div",{class:R.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={[R.groupLayerChild]:!!e.parent};return b("div",{class:this.classes(R.service,r),key:e.layer.uid},b("div",{class:R.serviceCaptionContainer},b("div",{class:R.serviceCaptionText},e.title)),b("div",{class:R.serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1,r=!1){const o="color-ramp"===e.type,a="opacity-ramp"===e.type,l=t.layer;let n=null;if("string"==typeof e.title)n=e.title;else if(e.title){const t=e.title,s=H(this.messages,t,o||a);n=t.title?`${t.title} (${s})`:s}const p=this._getSectionName(l,e,s),c=this._hasIndicators&&!r?b("div",null,b(j,{class:R.carouselTitle,level:this.headingLevel},t.title),b(j,{class:R.layerCaption,level:_(this.headingLevel)},n)):n?b(j,{class:R.layerCaption,level:this.headingLevel},n):null,m=t.effectList;let h=null;switch(e.type){case"symbol-table":{const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes?.[R.symbolRow],t={[R.labelContainer]:!e&&!i,[R.relationshipLabelContainer]:i};h=b("div",{class:this.classes(t)},s)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":h=this._renderLegendForRamp(e,l.opacity,m);break;case"size-ramp":h=this._renderSizeRamp(e,l.opacity);break;case"pie-chart-ramp":h=this._renderPieChartRamp(e);break;case"relationship-ramp":h=d(e,this.id,{opacity:l.opacity,effectList:m,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":h=this._renderUnivariateAboveAndBelowRamp(e,l.opacity,m);break;case"univariate-color-size-ramp":h=this._renderUnivariateColorSizeRamp(e,l.opacity,m)}if(!h)return null;const y=b("div",{"aria-labelledby":p,class:R.section,id:`${p}-panel`,key:p,role:"tabpanel",tabIndex:0},[c,h]);return r||this._sectionMap.set(p,y),y}_renderPieChartRamp(e){return b("div",{afterCreate:O,bind:e.preview,class:R.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=T(e,t,"horizontal");if(!i)return null;const o=D(i,"full",!0,"horizontal"),a=P(i,"above",!0,"horizontal"),l=P(i,"below",!0,"horizontal"),n=this.messages?.previewColorRampAriaLabel,p=F(r,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:s,ariaLabel:n}),c=F(r,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:s,ariaLabel:n}),m=N(i,"card"),d=i.infos.map((e=>e.label)),h=d.length-1,y=d.map(((e,t)=>0===t||t===h?b("div",{key:t},e):null)),u={marginTop:"3px",display:"flex"};v(this.container)?u.marginRight=`${m}px`:u.marginLeft=`${m}px`;const g={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return b("div",{class:R.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},b("div",{class:this.classes(R.symbolContainer,R.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>b("div",{afterCreate:O,bind:e.preview,class:R.symbol,key:t})))),p?b("div",{class:R.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:u},b("div",{afterCreate:O,bind:p}),b("div",{afterCreate:O,bind:c})):null,b("div",{class:R.layerInfo},b("div",{class:R.rampLabelsContainer,styles:g},y)))}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=B(e,"horizontal");if(!i)return null;const o=D(i,"full",!1,"horizontal"),a=F(r,{width:P(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:s,ariaLabel:this.messages?.previewColorRampAriaLabel}),l=N(i,"card"),n=i.infos.length-1,p=i.infos.map(((e,t)=>0===t||t===n?b("div",{key:t},e.label):null)),c={marginTop:"3px",display:"flex"};v(this.container)?c.marginRight=`${l}px`:c.marginLeft=`${l}px`;const m={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return b("div",{class:R.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},b("div",{class:this.classes(R.symbolContainer,R.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>b("div",{afterCreate:O,bind:e.preview,class:R.symbol,key:t})))),b("div",{class:R.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:c},b("div",{afterCreate:O,bind:a})),b("div",{class:R.layerInfo},b("div",{class:R.rampLabelsContainer,styles:m},p)))}_renderLegendForElementInfo(e,t,s,i){const r=t.layer;if(e.type)return this._renderLegendForElement(e,t,i,!1,!0);const o=W(r,s),a=H(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return b("div",{afterCreate:O,bind:e.preview,key:i});const t={[R.symbolCell]:this._hasIndicators};return b("div",{class:this.classes(R.layerRow,{[R.symbolRow]:this._hasIndicators}),key:i},b("div",{afterCreate:O,bind:e.preview,class:this.classes(t)}),b("div",{class:this.classes(R.imageLabel,{[R.labelCell]:this._hasIndicators})},a))}let s=255,o=255,l=255,n=0,p=255,c=255,m=255,d=0;const h=e.symbol.color?.a,u=e.symbol.outline?.color?.a;h&&(s=e.symbol.color.r,o=e.symbol.color.g,l=e.symbol.color.b,n=e.symbol.color.a*r.opacity),u&&(p=e.symbol.outline.color.r,c=e.symbol.outline.color.g,m=e.symbol.outline.color.b,d=e.symbol.outline.color.a*r.opacity);const v=e.symbol.color?.isBright??!0,g=v?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",f={background:h?`rgba(${s}, ${o}, ${l}, ${n})`:"none",color:v?"black":"white",textShadow:`-1px -1px 0 ${g},\n                                              1px -1px 0 ${g},\n                                              -1px 1px 0 ${g},\n                                              1px 1px 0 ${g}`,border:u?`1px solid rgba(${p}, ${c}, ${m}, ${d})`:"none",filter:y(t.effectList)??void 0};return b("div",{class:R.layerRow,key:i},b("div",{class:R.labelElement,styles:f},a))}if(e.src){const t=this._renderImage(e,r,o);return b("div",{class:R.layerRow,key:i},t,b("div",{class:R.imageLabel},a))}}_renderImage(e,t,s){const{label:i,src:r,opacity:o}=e,a={[R.imageryLayerStretchedImage]:s,[R.symbol]:!s},l={opacity:`${null!=o?o:t.opacity}`};return b("img",{alt:H(this.messages,i,!1),"aria-label":H(this.messages,i,!1),border:0,class:this.classes(a),height:e.height,src:r,styles:l,width:e.width})}_renderSizeRampLines(e){const t=e.infos,s=t[0],i=t[t.length-1],r=s.symbol,o=this._hasIndicators,a=p(s.size+s.outlineSize)*Z,l=p(i.size+i.outlineSize)*Z,n=o?a:a+50*Z,c=o?a/2+50*Z:a,m=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const s=e.symbolLayers.at(t-1).get("resource.primitive");return"triangle"===s||"cone"===s||"tetrahedron"===s}return"triangle"===e.style}}(r),d=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const s=e.symbolLayers.at(t-1),i=s.resource?.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(r),h=document.createElement("canvas");h.width=n,h.height=c,h.style.width=h.width/Z+"px",h.style.height=h.height/Z+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=n/2-l/2,i=c;y.moveTo(e,t),y.lineTo(s,i);const r=n,o=0,a=n/2+l/2,p=c;y.moveTo(r,o),y.lineTo(a,p)}else{y.beginPath();const e=0,t=c/2-l/2,s=n,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,o=c/2+l/2,a=n,p=c;y.moveTo(r,o),y.lineTo(a,p)}return y.strokeStyle="#ddd",y.stroke(),b("div",{afterCreate:O,bind:h,styles:o?{display:"flex",marginTop:`-${m?0:d?a/2:0}px`,marginBottom:`-${m?l:d?l/2:0}px`}:{display:"flex",marginRight:`-${m?0:d?a/2:0}px`,marginLeft:`-${m?0:d?l/2:0}px`}})}_renderSizeRamp(e,t){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let o=s[0].preview,a=s[s.length-1].preview;const l=this._hasIndicators,n={"flex-direction":l?"column":"row-reverse"};o&&(o=o.cloneNode(!0),o.style.display="flex"),a&&(a=a.cloneNode(!0),a.style.display="flex");const p={opacity:null!=t?`${t}`:""};return b("div",{class:this.classes(R.layerRow,{[R.sizeRampRow]:l})},b("div",{class:R.rampLabel},l?i:r),b("div",{class:R.sizeRampContainer,styles:n},b("div",{afterCreate:O,bind:o,class:R.sizeRampPreview,styles:p}),this._renderSizeRampLines(e),b("div",{afterCreate:O,bind:a,class:R.sizeRampContainer,styles:p})),b("div",{class:R.rampLabel},l?r:i))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return G(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,s){const i=e.infos,r=e.type,o="heatmap-ramp"===r,a=i.length-1,l=a>2&&!o?25*a:100,n=l+20,p=i.slice(0).reverse(),c=p.length-1,m=p.length%2!=0?p[p.length/2|0]:null,d=m&&b("div",{class:R.intervalSeparatorsContainer},b("div",{class:R.intervalSeparator},"|"),b("div",{class:R.rampLabel},this._getRampStopLabel(m,r))),u=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:p[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:l,height:25},fill:{type:"linear",x1:10,y1:0,x2:l+10,y2:0,colors:p.map(((e,t)=>({color:e.color,offset:o&&"ratio"in e?e.ratio:t/a})))},stroke:{width:0}},{shape:{type:"path",path:`M${l+10} 0 L${n} 12.5 L${l+10} 25 Z`},fill:p[c].color,stroke:{width:0}}]],v=h(u,n,25),g={filter:y(s)??void 0,opacity:null==t?void 0:`${t}`};return b("div",{class:R.layerRow,styles:{justifyContent:"center"}},b("div",{class:R.rampLabel},this._getRampStopLabel(p[0],r)),b("div",{class:R.symbolContainer},b("div",{styles:g},v),d),b("div",{class:R.rampLabel},this._getRampStopLabel(p[c],r)))}};e([r()],J.prototype,"activeLayerInfos",void 0),e([r()],J.prototype,"headingLevel",void 0),e([r()],J.prototype,"layout",void 0),e([r(),w("esri/widgets/Legend/t9n/Legend")],J.prototype,"messages",void 0),e([r(),w("esri/t9n/common")],J.prototype,"messagesCommon",void 0),e([r({readOnly:!0})],J.prototype,"type",void 0),e([r()],J.prototype,"view",void 0),e([L()],J.prototype,"_selectSection",null),J=e([a("esri.widgets.Legend.styles.Card")],J);const Q=J,K="esri-legend",X={service:`${K}__service`,label:`${K}__service-label`,layer:`${K}__layer`,groupLayer:`${K}__group-layer`,groupLayerChild:`${K}__group-layer-child`,layerTable:`${K}__layer-table`,layerTableSizeRamp:`${K}__layer-table--size-ramp`,layerChildTable:`${K}__layer-child-table`,layerCaption:`${K}__layer-caption`,layerBody:`${K}__layer-body`,layerRow:`${K}__layer-row`,layerCell:`${K}__layer-cell`,layerInfo:`${K}__layer-cell ${K}__layer-cell--info`,imageryLayerStretchedImage:`${K}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${K}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${K}__imagery-layer-info--stretched`,symbolContainer:`${K}__layer-cell ${K}__layer-cell--symbols`,symbol:`${K}__symbol`,rampContainer:`${K}__ramps`,sizeRamp:`${K}__size-ramp`,colorRamp:`${K}__color-ramp`,opacityRamp:`${K}__opacity-ramp`,borderlessRamp:`${K}__borderless-ramp`,rampTick:`${K}__ramp-tick`,rampFirstTick:`${K}__ramp-tick-first`,rampLastTick:`${K}__ramp-tick-last`,rampLabelsContainer:`${K}__ramp-labels`,rampLabel:`${K}__ramp-label`,message:`${K}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"},Y=`${K}__`,ee={display:"flex",alignItems:"flex-start"},te={marginLeft:"3px"},se={display:"table-cell",verticalAlign:"middle"};let ie=class extends l{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e?.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return b("div",null,t?.length?t:b("div",{class:X.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,s=`${Y}${e.layer.uid}-version-${e.version}`,i=e.title?j({level:this.headingLevel,class:this.classes(k.heading,X.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return b("div",{class:this.classes(X.service,X.groupLayer),key:s},i,t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const o={[X.groupLayerChild]:!!e.parent};return b("div",{class:this.classes(X.service,o),key:s},i,b("div",{class:X.layer},r))}}_renderLegendForElement(e,t,s,i){const r="color-ramp"===e.type,o="opacity-ramp"===e.type,a="size-ramp"===e.type;let l=null;if("symbol-table"===e.type||a){const i=e.infos.map((i=>this._renderLegendForElementInfo(i,t,s,a,e.legendType))).filter((e=>!!e));i.length&&(l=b("div",{class:X.layerBody},i))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?l=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?l=d(e,this.id,{opacity:t.opacity,effectList:s,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?l=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?l=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,s):"univariate-color-size-ramp"===e.type&&(l=this._renderUnivariateColorSizeRamp(e,t.opacity,s));if(!l)return null;const n=e.title;let p=null;if("string"==typeof n)p=n;else if(n){const e=H(this.messages,n,r||o);p=q(0,r||o)&&n.title?`${n.title} (${e})`:e}const c=i?X.layerChildTable:X.layerTable,m=p?b("div",{class:X.layerCaption},p):null,h={[X.layerTableSizeRamp]:a||!i};return b("div",{class:this.classes(c,h)},m,l)}_renderPieChartRamp(e){return b("div",{afterCreate:O,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=T(e,t);if(!i)return null;const o=this.messages?.previewColorRampAriaLabel,a=P(i,"above",!0),l=P(i,"below",!0),n=F(r,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"above",effectList:s,ariaLabel:o}),p=F(r,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"below",effectList:s,ariaLabel:o}),c=N(i),m=i.infos.map((e=>e.label)),d=m.map(((e,t)=>{const s=2===t;return 0===t?b("div",{class:e?n?X.univariateAboveAndBelowLabel:X.rampLabel:void 0,key:t},e):s?b("div",null):null})),h=m.length-1,y=Math.floor(m.length/2),u=m.map(((e,t)=>t===y||t===h?b("div",{class:e?n?X.univariateAboveAndBelowLabel:X.rampLabel:void 0,key:t},e):null)),v={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${c}px`},f={height:`${a}px`},j={height:`${l}px`};return b("div",{key:"univariate-above-and-below-ramp-preview",styles:ee},b("div",{class:X.layerBody},i.infos.map(((e,t)=>b("div",{class:this.classes(X.layerRow,X.sizeRamp)},b("div",{afterCreate:O,bind:e.preview,class:X.symbol,styles:v}),n||t%2!=0?null:b("div",{class:X.layerInfo},m[t]))))),n?b("div",{key:"color-ramp-preview",styles:g},b("div",{styles:te},b("div",{styles:se},b("div",{afterCreate:O,bind:n,class:X.rampContainer})),b("div",{styles:se},b("div",{class:X.rampLabelsContainer,styles:f},d))),b("div",{styles:te},b("div",{styles:se},b("div",{afterCreate:O,bind:p,class:X.rampContainer})),b("div",{styles:se},b("div",{class:X.rampLabelsContainer,styles:j},u)))):null)}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=B(e);if(!i)return null;const o=N(i),a=P(i,"full",!1),l=F(r,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"full",effectList:s,ariaLabel:this.messages?.previewColorRampAriaLabel}),n=i.infos.length-1,p=i.infos.map(((e,t)=>0===t||t===n?b("div",{class:e.label?r?X.univariateAboveAndBelowLabel:X.rampLabel:void 0,key:t},e.label):null)),c={display:"table-cell",verticalAlign:"middle"},m={marginTop:`${o}px`},d={height:`${a}px`};return b("div",{key:"univariate-above-and-below-ramp-preview",styles:ee},b("div",{class:X.layerBody},i.infos.map((e=>b("div",{class:this.classes(X.layerRow,X.sizeRamp)},b("div",{afterCreate:O,bind:e.preview,class:X.symbol,styles:c}))))),b("div",{key:"color-ramp-preview",styles:m},b("div",{styles:te},b("div",{styles:se},b("div",{afterCreate:O,bind:l,class:X.rampContainer})),b("div",{styles:se},b("div",{class:X.rampLabelsContainer,styles:d},p)))))}_renderLegendForRamp(e,t){const s=e.infos,i="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,o="stretch-ramp"===e.type,a=e.preview,l=i?X.opacityRamp:"";a.className=`${X.colorRamp} ${l}`,null!=t&&(a.style.opacity=t.toString());const n=s.map((e=>b("div",{class:e.label?X.rampLabel:void 0},r?this.messages[e.label]||e.label:o?G(e,this.messages):e.label))),p={height:a.style.height};return b("div",{class:X.layerRow},b("div",{class:X.symbolContainer,styles:{width:"24px"}},b("div",{afterCreate:O,bind:a,class:X.rampContainer})),b("div",{class:X.layerInfo},b("div",{class:X.rampLabelsContainer,styles:p},n)))}_renderLegendForElementInfo(e,t,s,i,r){if(e.type)return this._renderLegendForElement(e,t,s,!0);let o=null;const a=W(t,r);if(e.preview?o=b("div",{afterCreate:O,bind:e.preview,class:X.symbol}):e.src&&(o=this._renderImage(e,t,a)),!o)return null;const l={[X.imageryLayerInfoStretched]:a},n={[X.imageryLayerInfoStretched]:a,[X.sizeRamp]:!a&&i};return b("div",{class:X.layerRow},b("div",{class:this.classes(X.symbolContainer,n)},o),b("div",{class:this.classes(X.layerInfo,l)},H(this.messages,e.label,!1)||""))}_renderImage(e,t,s){const{label:i,src:r,opacity:o}=e,a={[X.imageryLayerStretchedImage]:s,[X.symbol]:!s},l={opacity:`${null!=o?o:t.opacity}`};return b("img",{alt:H(this.messages,i,!1),"aria-label":H(this.messages,i,!1),border:0,class:this.classes(a),height:e.height,src:r,styles:l,width:e.width})}};e([r()],ie.prototype,"activeLayerInfos",void 0),e([r()],ie.prototype,"headingLevel",void 0),e([r(),w("esri/widgets/Legend/t9n/Legend")],ie.prototype,"messages",void 0),e([r({readOnly:!0})],ie.prototype,"type",void 0),ie=e([a("esri.widgets.Legend.styles.Classic")],ie);const re=ie;let oe=class extends l{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.style=new re,this.viewModel=new n}initialize(){this.addHandles([s((()=>this.view),"resize",(()=>this.scheduleRender())),s((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),t((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),t((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),i)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof Q||e instanceof re)return e;if("string"==typeof e)return"card"===e?new Q:new re;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Q:re)(t)}return new re}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return b("div",{class:this.classes("esri-legend",k.widget,this.style instanceof re?k.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach((e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const r=t((()=>e.version),(()=>this.scheduleRender()));this.addHandles(r,`version_${e.layer.uid}`);const o=s((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),i);this.addHandles(o,`version_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([r()],oe.prototype,"activeLayerInfos",null),e([r()],oe.prototype,"basemapLegendVisible",null),e([r()],oe.prototype,"groundLegendVisible",null),e([r()],oe.prototype,"headingLevel",void 0),e([r()],oe.prototype,"hideLayersNotInCurrentView",null),e([r()],oe.prototype,"keepCacheOnDestroy",null),e([r()],oe.prototype,"respectLayerDefinitionExpression",null),e([r()],oe.prototype,"respectLayerVisibility",null),e([r()],oe.prototype,"icon",null),e([r()],oe.prototype,"label",null),e([r()],oe.prototype,"layerInfos",null),e([r(),w("esri/widgets/Legend/t9n/Legend")],oe.prototype,"messages",void 0),e([r()],oe.prototype,"style",void 0),e([o("style")],oe.prototype,"castStyle",null),e([r()],oe.prototype,"view",null),e([r()],oe.prototype,"viewModel",void 0),oe=e([a("esri.widgets.Legend")],oe);const ae=oe;export{ae as default};
