/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import s,{l as n}from"./Widget.js";import i from"./Expand/ExpandViewModel.js";import{g as r}from"../chunks/globalCss.js";import{isWidget as l,hasDomNode as p}from"./support/widget.js";import{t as a}from"../chunks/jsxFactory.js";import{m as c}from"../chunks/messageBundle.js";import"../chunks/ensureType.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../config.js";import"../chunks/tracking.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../core/promiseUtils.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/scheduling.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../core/reactiveUtils.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/widgetUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/accessibleHandler.js";import"../chunks/vmEvent.js";import"../chunks/themeUtils.js";const d="esri-expand",h={base:d,toggle:`${d}__toggle`,popoverContent:`${d}__popover-content`,panel:`${d}__panel`,panelContent:`${d}__panel-content`,sheet:`${d}__sheet`,panelIconNumber:`${d}__panel-icon-number`,contentContainer:`${d}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconExpanded:`${d}__icon--expanded`,iconNumber:`${d}__icon-number`,content:`${d}__content`,contentExpanded:`${d}__content--expanded`},u="chevrons-left",m="chevrons-right";let g=class extends s{constructor(e,t){super(e,t),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new i,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=e=>{e.target===this._popoverEl&&(this.viewModel.expanded=e.target.open)},this._handleSheetClose=e=>{this.viewModel.expanded=e.target.open},this._handlePanelClose=e=>{this.viewModel.expanded=!e.target.closed},this._handleKeyDown=e=>{this.viewModel.expanded&&"Escape"===e.key&&!this._willCloseOnEsc(e)&&e.preventDefault()},this._storeToggleButtonEl=e=>{this._toggleButtonEl=e},this._storePopoverEl=e=>{this._popoverEl=e}}loadDependencies(){return n({button:()=>import("../chunks/calcite-button.js"),icon:()=>import("../chunks/calcite-icon.js"),panel:()=>import("../chunks/calcite-panel.js"),popover:()=>import("../chunks/calcite-popover.js"),sheet:()=>import("../chunks/calcite-sheet.js")})}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:o,expandTooltip:s}=this;return(e?o||t?.collapse:s||t?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return"xsmall"===this.viewModel.view?.widthBreakpoint;default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIcon(){return m}set collapseIcon(e){this._overrideIfSome("collapseIcon",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIcon(){return l(this.content)?this.content.icon:u}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get icon(){return null}get label(){return(l(this.content)?this.content.label:null)??this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:e,_toggleButtonEl:t,viewModel:{expanded:o},label:s,placement:n}=this;return a("div",{class:this.classes(h.base,r.widget)},this._renderToggle(),e?a("calcite-sheet",{class:h.sheet,heightScale:"l",label:s,onkeydown:this._handleKeyDown,open:o,position:"block-end",onCalciteSheetClose:this._handleSheetClose},a("calcite-panel",{class:h.panel,closable:!0,closed:!o,heading:s,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},a("div",{class:h.panelContent},this._renderContent()))):t?a("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,label:s,onkeydown:this._handleKeyDown,open:o,overlayPositioning:"fixed",placement:n??this._getPlacement(),referenceElement:t,onCalcitePopoverClose:this._handlePopoverClose},a("div",{class:h.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:e,view:t}=this,o=e&&t?t.ui.getPosition(e):null;if(!o||"manual"===o)return"auto";const[s,n]=o.split("-");return`${"right"===n?"left":"right"}-${"bottom"===s?"end":"start"}`}_willCloseOnEsc(e){const{closeOnEsc:t}=this;return"function"==typeof t?t(e):t}_renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?a("span",{class:h.iconNumber,key:"expand__icon-number"},t):null}_renderToggleButton(){const{expanded:e,expandTitle:t,expandIcon:o,collapseIcon:s}=this,n=e?s:o,i=n===u||n===m;return a("calcite-button",{afterCreate:this._storeToggleButtonEl,afterUpdate:this._storeToggleButtonEl,class:r.widgetButton,kind:"neutral",label:t,onclick:this.toggle,scale:"s",title:t},n?a("calcite-icon",{class:this.classes(h.icon,i&&h.iconFlip),icon:n,scale:"s"}):null)}_renderToggle(){return a("div",{class:h.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:e}=this;return"string"==typeof e?a("div",{class:h.contentContainer,innerHTML:e,key:"content__string"}):l(e)?a("div",{class:h.contentContainer,key:"content__widget"},e.render()):e instanceof HTMLElement?a("div",{afterCreate:this._attachToNode,bind:e,class:h.contentContainer,key:"content__html-element"}):p(e)?a("div",{afterCreate:this._attachToNode,bind:e.domNode,class:h.contentContainer,key:"content__node"}):null}_attachToNode(e){e.appendChild(this)}};e([t({readOnly:!0})],g.prototype,"expandTitle",null),e([t()],g.prototype,"_toggleButtonEl",void 0),e([t()],g.prototype,"_displaySheet",null),e([t()],g.prototype,"autoCollapse",null),e([t()],g.prototype,"closeOnEsc",void 0),e([t()],g.prototype,"collapseIcon",null),e([t()],g.prototype,"collapseTooltip",void 0),e([t()],g.prototype,"content",void 0),e([t()],g.prototype,"expanded",null),e([t()],g.prototype,"expandIcon",null),e([t()],g.prototype,"expandTooltip",void 0),e([t()],g.prototype,"group",null),e([t()],g.prototype,"icon",null),e([t()],g.prototype,"iconNumber",void 0),e([t()],g.prototype,"label",null),e([t(),c("esri/widgets/Expand/t9n/Expand")],g.prototype,"messages",void 0),e([t(),c("esri/t9n/common")],g.prototype,"messagesCommon",void 0),e([t()],g.prototype,"mode",void 0),e([t()],g.prototype,"placement",void 0),e([t()],g.prototype,"view",null),e([t({type:i})],g.prototype,"viewModel",void 0),g=e([o("esri.widgets.Expand")],g);const _=g;export{_ as default};
