/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import{b as e}from"../../../chunks/maybe.js";import{property as o}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import"../../../chunks/Logger.js";import{subclass as n}from"../../../core/accessorSupport/decorators/subclass.js";import i from"./Column.js";import{a as r}from"../../../chunks/uriUtils.js";import"../../../chunks/ensureType.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/metadata.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/tracking.js";import"../../../core/Evented.js";import"../../../core/Accessor.js";import"../../../core/Handles.js";import"../../../chunks/ObservableBase.js";import"../../../core/scheduling.js";import"../../../core/promiseUtils.js";import"../../../core/reactiveUtils.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../chunks/widgetUtils.js";let s=class extends i{constructor(t){super(t),this.editInfo=null,this.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,this.editable=!0,this.headerRenderFunction=t=>{const{root:e}=t,o=this.createHeaderContent();this.tableEditingEnabled&&!this.effectiveEditable&&o.prepend(this._lockIconNode),this.removeCellContent(e),e.appendChild(o)},this.inputRenderFunction=({root:t,column:e,rowData:o})=>{if(this.editInfo||!this.effectiveEditable)return;const n=this.getCellValue(e,o),i=this.createInputElement({root:t,column:e,rowData:o,value:n});this._set("editInfo",{column:e,inputs:[i],root:t,rowData:o,oldValue:n});const r=document.createElement("div");r.appendChild(i),this.removeCellContent(t),t.appendChild(r),i.focus(),i instanceof HTMLInputElement&&i.select()},this.loadingMessage="",this.inputType="text",this.maxLength=null,this.parseInputValueFunction=({inputs:t})=>t?.length||1!==t.length||Array.isArray(t[0].value)?null:t[0].value,this.renderFunction=t=>{const{root:e,column:o,rowData:n}=t,{editInfo:i}=this;if(i)return;const s=this.getCellValue(o,n),a=this.cellValueFormatFunction({column:o,rowData:n,value:s});let l=null;e.onclick=()=>e.focus(),e.ondblclick=()=>this.inputRenderFunction(t),e.ontouchend=()=>this.inputRenderFunction(t);const c=this.grid?.getSlotElementByName(e.slot),u=c?.parentElement;u&&!u.onkeydown&&(u.onkeydown=e=>{"Enter"!==e.key||this.editInfo||this.inputRenderFunction(t),"Escape"===e.key&&this.editInfo&&this.cancel()}),null!=s&&null!=a?e.title=a.toString():e.title&&e.removeAttribute("title"),l=a instanceof HTMLElement?a:r(this.messagesURIUtils,a),this.removeCellContent(e),l instanceof HTMLElement?e.appendChild(l):null!=l&&(e.innerHTML=l.toString())},this.required=!1,this.tableEditingEnabled=!1,this.updateRowItemFunction=({rowData:t,column:o,value:n})=>{e(t),o.path&&t?.item&&(t.item[o.path]=n)},this.updateStoreItemFunction=async({rowData:t,column:o,value:n})=>{e(t),o.path&&await(this.store?.updateItem({index:t.index,name:o.path,value:n}))}}get _lockIconNode(){return this.createCalciteIcon({icon:"lock"})}get effectiveEditable(){return this.tableEditingEnabled&&this.editable}get editing(){return!!this.editInfo}onEditComplete(){this._set("editInfo",null),this.grid?.generateCellPartNames()}cancel(){const{editInfo:t}=this;if(!t)return;const{column:e,root:o,rowData:n}=t;this.onEditComplete(),this.renderFunction({column:e,root:o,rowData:n})}createInputElement({value:t}){const e=document.createElement("input");return null!=this.maxLength&&(e.maxLength=this.maxLength),e.type=this.inputType,e.value=t,e.onblur=()=>{e.onblur=null,this.submit()},e}createDateComponent(){const t=document.createElement("calcite-input-date-picker");return t.focusTrapDisabled=!0,t.overlayPositioning="fixed",t}createTimeComponent(){const t=document.createElement("calcite-input-time-picker");return t.overlayPositioning="fixed",t.placement="auto-start",t.step=1,t}createTimeZoneComponent(){const t=document.createElement("calcite-input-time-zone");return t.maxItems=4,t.overlayPositioning="fixed",t}async submit(){const{editInfo:t}=this;if(!t)return;const{column:e,inputs:o,root:n,rowData:i,oldValue:r}=t,s=this.parseInputValueFunction({inputs:o,column:e,rowData:i});if(this.cellValueValidatorFunction({value:s,oldValue:r,column:e,rowData:i})){n.textContent=this.loadingMessage;try{await this.updateStoreItemFunction({rowData:i,column:e,value:s}),this.updateRowItemFunction({rowData:i,column:e,value:s}),this.onEditComplete(),this.renderFunction({column:e,root:n,rowData:i}),this.emit("value-change",{column:e,rowData:i,value:this.getCellValue(e,i)})}catch(t){this.cancel()}}else this.cancel()}};t([o()],s.prototype,"_lockIconNode",null),t([o({readOnly:!0})],s.prototype,"editInfo",void 0),t([o()],s.prototype,"cellValueValidatorFunction",void 0),t([o()],s.prototype,"editable",void 0),t([o()],s.prototype,"effectiveEditable",null),t([o()],s.prototype,"editing",null),t([o()],s.prototype,"headerRenderFunction",void 0),t([o()],s.prototype,"inputRenderFunction",void 0),t([o({constructOnly:!0})],s.prototype,"loadingMessage",void 0),t([o()],s.prototype,"inputType",void 0),t([o()],s.prototype,"maxLength",void 0),t([o()],s.prototype,"parseInputValueFunction",void 0),t([o()],s.prototype,"renderFunction",void 0),t([o()],s.prototype,"required",void 0),t([o()],s.prototype,"tableEditingEnabled",void 0),t([o()],s.prototype,"updateRowItemFunction",void 0),t([o()],s.prototype,"updateStoreItemFunction",void 0),s=t([n("esri.widgets.FeatureTable.Grid.EditorColumn")],s);const a=s;export{a as default};
