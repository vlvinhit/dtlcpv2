/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{i as t}from"../core/lang.js";import o,{d as i}from"../core/Accessor.js";import{IdentifiableMixin as r}from"../core/Identifiable.js";import{L as a}from"../chunks/Logger.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{f as l,c as d}from"../chunks/date.js";import{s as m}from"../chunks/timeZoneUtils.js";import{S as c,T as u}from"../chunks/SlideThumbnail.js";import k,{l as h}from"./Widget.js";import p from"./Bookmarks/BookmarksViewModel.js";import{g as b}from"../chunks/globalCss.js";import{H as g}from"../chunks/Heading.js";import"../chunks/widgetUtils.js";import{m as _}from"../chunks/messageBundle.js";import{v as B}from"../chunks/vmEvent.js";import{t as v}from"../chunks/jsxFactory.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../config.js";import"../chunks/ensureType.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/datetime.js";import"../core/JSONSupport.js";import"../intl.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../core/reactiveUtils.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../Viewpoint.js";import"../Camera.js";import"../CameraLayout.js";import"../core/Clonable.js";import"../chunks/Cyclical.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../geometry/support/webMercatorUtils.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../webmap/Bookmark.js";import"../chunks/timeProperties.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"./support/GoTo.js";let f=class extends o{constructor(e){super(e)}get editedBookmark(){const{bookmark:e}=this;return e?this._get("editedBookmark")||e.clone():null}get customUrl(){return this.editedBookmark?.thumbnail?.isSecureUrl?this.editedBookmark?.thumbnail?.url:null}set customUrl(e){this._override("customUrl",e)}get screenshotUrl(){return this.editedBookmark?.thumbnail?.isDataURI?this.editedBookmark?.thumbnail?.url:null}set screenshotUrl(e){this._override("screenshotUrl",e)}get state(){return this._get("state")}set state(e){this.validationState=void 0,this.loading=void 0,this._set("state",e)}get thumbnailState(){return this.editedBookmark?.thumbnail?.url?this.editedBookmark?.thumbnail?.isSecureUrl?"url":"screenshot":"none"}set thumbnailState(e){this._overrideIfSome("thumbnailState",e)}};e([s()],f.prototype,"bookmark",void 0),e([s({readOnly:!0})],f.prototype,"editedBookmark",null),e([s()],f.prototype,"customUrl",null),e([s()],f.prototype,"screenshotUrl",null),e([s()],f.prototype,"state",null),e([s()],f.prototype,"thumbnailState",null),e([s()],f.prototype,"validationState",void 0),e([s()],f.prototype,"loading",void 0),f=e([n("esri.widgets.Bookmarks.BookmarksUserState")],f);const E=f;let w=class extends o{constructor(){super(...arguments),this.addBookmarkButton=!1,this.closeButton=!1,this.collapseButton=!1,this.editBookmarkButton=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.thumbnail=!0,this.time=!0}get addBookmark(){return i(a.getLogger(this),"addBookmark",{replacement:"addBookmarkButton",version:"4.29",warnOnce:!0}),this.addBookmarkButton}set addBookmark(e){i(a.getLogger(this),"addBookmark",{replacement:"addBookmarkButton",version:"4.29",warnOnce:!0}),this.addBookmarkButton=e}};e([s({type:Boolean,nonNullable:!0})],w.prototype,"addBookmark",null),e([s({type:Boolean,nonNullable:!0})],w.prototype,"addBookmarkButton",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"closeButton",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"collapseButton",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"editBookmarkButton",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"filter",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"flow",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"heading",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"thumbnail",void 0),e([s({type:Boolean,nonNullable:!0})],w.prototype,"time",void 0),w=e([n("esri.widgets.Bookmarks.BookmarksVisibleElements")],w);const y=w,j="esri-bookmarks",S=`${j}__authoring`,I=`${j}__bookmark`,C={base:j,noBookmarksHeader:`${j}__no-bookmarks-heading`,noBookmarksDescription:`${j}__no-bookmarks-description`,form:`${j}__form`,list:`${j}__list`,loader:`${j}__loader`,filterNoResults:`${j}__filter-no-results`,formContent:`${j}__form-content`,addBookmarkButton:`${j}__add-bookmark-button`,editBookmarkInput:`${j}__edit-bookmark-input`,addBookmarkInput:`${j}__add-bookmark-input`,dragEnabled:`${j}--drag-enabled`,bookmarkImage:`${j}__image`,bookmarkImageContainer:`${I}-image-container`,bookmarkContent:`${I}-content`,bookmarkContentLabel:`${I}-content-label`,authoring:S,authoringImageContainer:`${S}-image-container`,authoringRefreshThumbnailButton:`${S}-refresh-thumbnail-button`};let T=class extends(r(k)){constructor(e,t){super(e,t),this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._lastDragDetail=null,this._selectedDragBookmarkUid=null,this._editIncludeTimeExtent=void 0,this._userState=null,this._focusRootFlowItem=!1,this._focusAddFlowItem=!1,this._focusEditFlowItem=!1,this.disabled=!1,this.dragEnabled=!1,this.filterPlaceholder="",this.filterText="",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.viewModel=new p,this.visibleElements=new y,this._onCalciteListOrderChange=e=>{const{_lastDragDetail:t,bookmarks:o}=this,{toEl:i,fromEl:r,dragEl:a,newIndex:s}=e;if(!o.length)return;if(!r||!i||t?.newIndex===s&&t?.dragEl===a&&t?.toEl===i&&t?.fromEl===r)return;this._lastDragDetail=e;const n=Array.from(r.children).filter((e=>e?.matches("calcite-list-item"))).map((e=>e.value));o.sort(((e,t)=>{const o=n.indexOf(e.uid),i=n.indexOf(t.uid);return o>i?1:o<i?-1:0}))}}normalizeCtorArgs(e){return null!=e?.editingEnabled&&null!=e.visibleElements?{...e,visibleElements:new y({...e.visibleElements,addBookmarkButton:e.editingEnabled,editBookmarkButton:e.editingEnabled})}:e}loadDependencies(){return h({action:()=>import("../chunks/calcite-action.js"),button:()=>import("../chunks/calcite-button.js"),"chip-group":()=>import("../chunks/calcite-chip-group.js"),chip:()=>import("../chunks/calcite-chip.js"),fab:()=>import("../chunks/calcite-fab.js"),flow:()=>import("../chunks/calcite-flow.js"),"flow-item":()=>import("../chunks/calcite-flow-item.js"),icon:()=>import("../chunks/calcite-icon.js"),input:()=>import("../chunks/calcite-input.js"),"input-message":()=>import("../chunks/calcite-input-message.js"),label:()=>import("../chunks/calcite-label.js"),list:()=>import("../chunks/calcite-list.js"),"list-item":()=>import("../chunks/calcite-list-item.js"),loader:()=>import("../chunks/calcite-loader.js"),notice:()=>import("../chunks/calcite-notice.js"),scrim:()=>import("../chunks/calcite-scrim.js"),switch:()=>import("../chunks/calcite-switch.js"),table:()=>import("../chunks/calcite-table.js"),"table-cell":()=>import("../chunks/calcite-table-cell.js"),"table-header":()=>import("../chunks/calcite-table-header.js"),"table-row":()=>import("../chunks/calcite-table-row.js")})}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(e){this.viewModel.defaultEditOptions=e}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(e){this.viewModel.bookmarks=e}get editingEnabled(){return i(a.getLogger(this),"editingEnabled",{replacement:"dragEnabled, visibleElements.editBookmarkButton, visibleElements.addBookmarkButton",version:"4.29",warnOnce:!0}),this.dragEnabled&&this.visibleElements.editBookmarkButton&&this.visibleElements.addBookmarkButton}set editingEnabled(e){i(a.getLogger(this),"editingEnabled",{replacement:"dragEnabled, visibleElements.editBookmarkButton, visibleElements.addBookmarkButton",version:"4.29",warnOnce:!0}),this.dragEnabled=e,this.visibleElements.editBookmarkButton=e,this.visibleElements.addBookmarkButton=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"bookmark"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}endAddBookmark(){this._userState=null}goTo(e){return this.viewModel.goTo(e)}render(){return v("div",{class:this.classes(C.base,b.widget,b.panel)},this._renderBookmarksContainer())}startAddBookmark(){this._userState=new E({state:"add"}),this._focusAddFlowItem=!0}_renderNoBookmarksContainer(e){const{messages:t,viewModel:{state:o}}=this;return e.length||"loading"===o?null:v("div",{class:b.empty,key:"no-bookmarks"},v("calcite-icon",{icon:"bookmark",scale:"l"}),v(g,{class:this.classes(b.heading,C.noBookmarksHeader),level:this.headingLevel},t?.noBookmarksHeading),v("p",{class:C.noBookmarksDescription},t.noBookmarksDescription))}_renderEditBookmarkFlowItems(){const{_userState:e}=this,t=e?.editedBookmark;return t&&"edit"===e?.state?this._renderEditingBookmark(t):[]}_renderBookmarkItems(e){return e?e.toArray().map((e=>this._renderBookmark(e))):[]}_handleCalciteListDragEnd(e){const{fromEl:t,dragEl:o,oldIndex:i}=e;t.insertBefore(o,t.children[i])}_renderBookmarksContainer(){const{viewModel:{state:e,bookmarks:o},dragEnabled:i,messages:r,disabled:a,filterPlaceholder:s,filterText:n,visible:l,headingLevel:d,visibleElements:{closeButton:m,collapseButton:c,filter:u,heading:k,flow:h},uid:p}=this,b=o.filter(t),g=b.length?v("calcite-list",{class:C.list,dragEnabled:i,filterEnabled:u,filterPlaceholder:s,filterText:n,group:`bookmarks-${p}`,key:"bookmark-list",label:r.widgetLabel,selectionAppearance:"border",selectionMode:"none",onCalciteListDragEnd:e=>this._handleCalciteListDragEnd(e.detail),onCalciteListFilter:e=>this.filterText=e.target?.filterText??"",onCalciteListOrderChange:e=>this._onCalciteListOrderChange(e.detail)},this._renderBookmarkItems(b),u?v("div",{class:C.filterNoResults,slot:"filter-no-results"},v("calcite-notice",{kind:"info",open:!0,width:"full"},v("div",{slot:"message"},r.noBookmarksHeading),";")):null):null,_=[v("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:m,closed:!l,collapsible:c,disabled:a,heading:k?r.widgetLabel:void 0,headingLevel:d,loading:"loading"===e,onCalciteFlowItemClose:()=>this.visible=!1},this._renderNoBookmarksContainer(b),g,this._renderAddBookmarkButton()),this._renderAddingBookmark(),this._renderEditBookmarkFlowItems()];return l?h?v("calcite-flow",{key:"root-flow"},_):_:null}_renderAddBookmarkButton(){const{messages:e,_userState:t,disabled:o,viewModel:{view:i,state:r},visibleElements:{addBookmarkButton:a}}=this,s=t?.loading??!1;return i&&"loading"!==r&&a?v("calcite-fab",{appearance:"outline-fill",bind:this,class:C.addBookmarkButton,disabled:o||s,icon:"plus",key:"add-bookmark-item",kind:"neutral",loading:s,onclick:this.startAddBookmark,slot:"fab",text:e.addBookmark,textEnabled:!0,title:e.addBookmark,type:"button"}):null}_renderEditContainer(e){const{messagesCommon:t,visibleElements:{editBookmarkButton:o}}=this,i=`${t.edit} ${this._getBookmarkTitle(e)}`;return o?v("calcite-action",{appearance:"transparent",icon:"pencil",key:"edit-action",onclick:()=>this._showEditBookmarkForm(e),slot:"actions-end",text:i,title:i}):null}_renderBookmarkImage(e,t){return t?v("img",{alt:"",class:C.bookmarkImage,key:"bookmark-image",src:e.thumbnail?.url}):null}_renderBookmarkTimeSwitch(e){const{messages:t,viewModel:{view:o}}=this,{timeExtent:i}=e;return o?.timeExtent??i?v("calcite-label",{layout:"inline-space-between"},t.includeTimeExtent,v("calcite-switch",{checked:!!i,onCalciteSwitchChange:e=>{this._editIncludeTimeExtent=!!e.target.checked}})):null}_renderEditBookmarkTimeExtent(e){return this._editIncludeTimeExtent?this._renderBookmarkTimeExtent(e):null}_getTimeExtentStrings(e){const{visibleElements:t}=this,{timeExtent:o}=e;if(!o)return{};const{start:i,end:r}=o,a=null!=r&&(null==i||i.getTime()!==r.getTime()),s=i?this._formatDate(i):"",n=i&&t.time?this._formatTime(i):"";return a?{startDate:s,startTime:n,endDate:this._formatDate(r),endTime:t.time?this._formatTime(r):""}:{startDate:s,startTime:n}}_renderTimeExtentDescription(e){const{startDate:t,startTime:o,endDate:i,endTime:r}=this._getTimeExtentStrings(e);if(!t)return"";const a=`${t} ${o}`;return i?`${a} - ${i} ${r}`:a}_renderBookmarkTimeExtent(e,t=!1){const{messages:o}=this,{startDate:i,startTime:r,endDate:a,endTime:s}=this._getTimeExtentStrings(e),n=t?null:v("calcite-table-row",{slot:"table-header"},v("calcite-table-header",{heading:o.startDate}),a?v("calcite-table-header",{heading:o.endDate}):null);return i?v("calcite-table",{caption:o.timeExtent,scale:"s"},n,v("calcite-table-row",null,v("calcite-table-cell",null,i," ",r?[v("br",null),r]:null),a?v("calcite-table-cell",null,a,s?[v("br",null),s]:null):null)):null}_renderBookmarkActiveScrim(e,t){return this.viewModel.activeBookmark===e&&t?v("calcite-scrim",{key:"bookmark-active-scrim",loading:!0}):null}_renderBookmarkActiveLoader(e,t){return this.viewModel.activeBookmark!==e||t?null:v("calcite-loader",{class:C.loader,inline:!0,key:"bookmark-active-loader",label:this.messagesCommon.loading})}_renderBookmarkImageIcon(e,t){return this.viewModel.activeBookmark===e||t?null:v("calcite-icon",{icon:"bookmark",key:"bookmark-icon",scale:"s"})}_renderBookmarkThumbnail(e){const t=this.visibleElements.thumbnail&&!!e.thumbnail?.url;return v("div",{class:C.bookmarkImageContainer,slot:"content-start"},this._renderBookmarkActiveScrim(e,t),this._renderBookmarkImage(e,t),this._renderBookmarkActiveLoader(e,t),this._renderBookmarkImageIcon(e,t))}_focusSelectedDragEl(e,t){this._selectedDragBookmarkUid===t.uid&&requestAnimationFrame((()=>e?.setFocus()))}_handleCalciteListItemDragHandleChange(e,t){e.stopPropagation();const o=e.target.dragSelected;this._selectedDragBookmarkUid=o?t.uid:null}_renderBookmark(e){return v("calcite-list-item",{afterCreate:t=>this._focusSelectedDragEl(t,e),afterUpdate:t=>this._focusSelectedDragEl(t,e),class:this.classes({[C.dragEnabled]:this.dragEnabled}),description:this._renderTimeExtentDescription(e),dragSelected:e.uid===this._selectedDragBookmarkUid,key:e.uid,label:this._getBookmarkTitle(e),value:e.uid,onCalciteListItemDragHandleChange:t=>this._handleCalciteListItemDragHandleChange(t,e),onCalciteListItemSelect:()=>this._goToBookmark(e)},this._renderBookmarkThumbnail(e),this._renderBookmarkContent(e),this._renderEditContainer(e))}_renderBookmarkContent(e){return v("div",{class:C.bookmarkContent,slot:"content"},v("span",{class:C.bookmarkContentLabel},this._getBookmarkTitle(e)),this._renderBookmarkTimeExtent(e,!0))}_renderEditingBookmarkName(e){const{messages:t,_userState:o}=this,i="name-required"===o?.validationState;return v("calcite-label",null,t.title,v("calcite-input",{afterCreate:this._storeEditInput,bind:this,class:C.editBookmarkInput,name:"bookmark-name",placeholder:t.titlePlaceholder,required:!0,type:"text",value:e.name}),i?v("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},t.invalidTitle):null)}_renderEditingBookmarkActions(){const{messagesCommon:e,_userState:t}=this,o=t?.bookmark;return[v("calcite-button",{appearance:"transparent",kind:"danger",onclick:()=>this._deleteBookmark(o),slot:"footer",type:"button",width:"full"},e.delete),v("calcite-button",{appearance:"outline",bind:this,onclick:this._closeEditBookmarkForm,slot:"footer",type:"button",width:"full"},e.cancel),v("calcite-button",{slot:"footer",type:"submit",width:"full"},e.save)]}_handleUrlEditInputChange(){const{_userState:e,_urlEditInputNode:t}=this,o=t?.value;if(!e?.editedBookmark||!o)return;e.validationState=void 0,e.editedBookmark.thumbnail?.isDataURI&&(e.screenshotUrl=e.editedBookmark.thumbnail?.url);const i=new c({url:o});i.isSecureUrl&&(e.customUrl=o,e.editedBookmark.thumbnail=i)}_renderEditingTimeExtent(e){const{capabilities:t,view:o}=this.viewModel,{timeExtent:i}=e;return t.time&&(o?.timeExtent??i)?v("div",{key:"edit-bookmark-time-container"},this._renderBookmarkTimeSwitch(e),this._renderEditBookmarkTimeExtent(e)):null}_renderEditingBookmarkImage(e){const{_userState:t}=this,o=t?.thumbnailState,i=e.thumbnail?.isSecureUrl?"url"===o:e.thumbnail?.isDataURI?"screenshot"===o:null;if(i)return this._renderBookmarkImage(e,i)}_renderEditingThumbnail(e){const{_userState:t,visibleElements:o}=this,i=t?.thumbnailState;return o.thumbnail&&"none"!==i?v("div",{class:C.authoringImageContainer},this._renderEditingBookmarkImage(e)):null}_renderUpdateThumbnailButton(){const{visibleElements:e,messages:t,_userState:o}=this,i=o?.thumbnailState;return e.thumbnail&&"screenshot"===i?v("calcite-button",{appearance:"outline",class:C.authoringRefreshThumbnailButton,iconStart:"refresh",key:"update-thumbnail",kind:"neutral",onclick:()=>{this._updateThumbnail()},width:"half"},t.updateThumbnail):null}_renderEditingBookmarkUrlInput(e){const{messages:t,_userState:o}=this,i=e.thumbnail?.url,r=e.thumbnail?.isSecureUrl?i:void 0,a=i&&"absolute-url-required"===o?.validationState,s=o?.thumbnailState;return"url"===s?v("calcite-label",{key:"thumbnail-url-input"},v("calcite-input",{afterCreate:this._storeUrlEditInput,bind:this,name:"bookmark-thumbnail-url",pattern:u,placeholder:t?`https://<${t.imageUrlPlaceholder}>`:void 0,required:!0,title:t.imageUrlTooltip,type:"text",value:r,onCalciteInputChange:this._handleUrlEditInputChange,onCalciteInputInput:this._handleUrlEditInputChange}),a?v("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},t.invalidImageUrl):null):null}_renderThumbnailSelector(){const{visibleElements:e,messages:t,_userState:o}=this,i=o?.thumbnailState;return e.thumbnail?v("calcite-label",{key:"thumbnail-chip-group"},t.thumbnail,v("calcite-chip-group",{label:t.thumbnail,selectionMode:"single-persist",onCalciteChipGroupSelect:e=>this._handleThumbnailTypeSelect(e.target.selectedItems[0].value)},v("calcite-chip",{selected:"screenshot"===i,value:"screenshot"},t.screenshot),v("calcite-chip",{selected:"url"===i,value:"url"},t.url),v("calcite-chip",{selected:"none"===i,value:"none"},t.none))):null}_renderEditingBookmark(e){const{disabled:t,messagesCommon:o,headingLevel:i}=this;return e?v("form",{bind:this,class:C.form,disabled:this.disabled,onsubmit:this._editBookmarkSubmit},v("calcite-flow-item",{afterCreate:this._focusEditFlowItemNode,afterUpdate:this._focusEditFlowItemNode,bind:this,disabled:t,heading:o.edit,headingLevel:i,key:"edit-bookmark-form",onCalciteFlowItemBack:e=>{e.preventDefault(),this._closeEditBookmarkForm()}},v("div",{class:C.formContent},v("div",{class:C.authoring},this._renderEditingBookmarkName(e),this._renderThumbnailSelector(),this._renderEditingThumbnail(e),this._renderEditingBookmarkUrlInput(e),this._renderUpdateThumbnailButton(),this._renderEditingTimeExtent(e))),this._renderEditingBookmarkActions())):null}_renderAddingBookmarkName(){const{_userState:e,messages:t}=this,o="name-required"===e?.validationState;return v("calcite-label",null,t.title,v("calcite-input",{afterCreate:this._storeAddInput,bind:this,class:C.addBookmarkInput,name:"bookmark-name",placeholder:t.titlePlaceholder,required:!0,type:"text",value:""}),o?v("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},t.invalidTitle):null)}_renderAddingBookmarkActions(){const{messagesCommon:e}=this;return[v("calcite-button",{appearance:"outline",bind:this,onclick:this._endAddBookmark,slot:"footer",type:"button",width:"half"},e.cancel),v("calcite-button",{slot:"footer",type:"submit",width:"half"},e.add)]}_renderAddingBookmark(){const{disabled:e,messages:t,headingLevel:o,_userState:i}=this;return"add"===i?.state?v("form",{bind:this,class:C.form,disabled:e,onsubmit:this._addBookmarkSubmitClick},v("calcite-flow-item",{afterCreate:this._focusAddFlowItemNode,afterUpdate:this._focusAddFlowItemNode,bind:this,disabled:e,heading:t.addBookmark,headingLevel:o,key:"add-bookmark-form",onCalciteFlowItemBack:e=>{e.preventDefault(),this._endAddBookmark()}},v("div",{class:C.formContent},this._renderAddingBookmarkName()),this._renderAddingBookmarkActions())):null}_getBookmarkTitle(e){return e?.name||this.messagesCommon.untitled}_formatDate(e){return e?l(e,{...d("short-date"),timeZone:this.viewModel.view?.timeZone??m}):""}_formatTime(e){return e?l(e,{...d("long-time"),timeZone:this.viewModel.view?.timeZone??m}):""}_endAddBookmark(){this.endAddBookmark(),this._focusRootFlowItem=!0}_showEditBookmarkForm(e){e&&(this._editIncludeTimeExtent=!!e.timeExtent,this._userState=new E({bookmark:e,state:"edit"}),this._focusEditFlowItem=!0,this.viewModel.goTo(e))}async _createNewScreenshotUrl(){const e=await this.viewModel.createBookmark();return e.thumbnail?.url??null}_storeCurrentUrl(){const{_userState:e}=this,t=e?.editedBookmark?.thumbnail?.url;t&&(e?.editedBookmark?.thumbnail?.isSecureUrl?e.customUrl=t:e?.editedBookmark?.thumbnail?.isDataURI&&(e.screenshotUrl=t))}async _handleThumbnailTypeSelect(e){const{_userState:t}=this;if(!t)return;const{screenshotUrl:o,customUrl:i,editedBookmark:r}=t,a="screenshot"===e?o??await this._createNewScreenshotUrl():"url"===e&&i?i:null;this._storeCurrentUrl(),r&&a&&(r.thumbnail=new c({url:a})),t.validationState=void 0,t.thumbnailState=e}_closeEditBookmarkForm(){this._userState=null,this._focusRootFlowItem=!0}_addBookmarkSubmitClick(e){e.preventDefault(),this._addBookmarkSubmit()}async _addBookmarkSubmit(){const{_addInputNode:e,_userState:t,viewModel:o,viewModel:{bookmarks:i}}=this;if(!t)return;const r=e?e.value.trim():null;if(!r)return void(t.validationState="name-required");t.loading=!0;const a=await o.createBookmark();a.name=r,i.add(a),this._endAddBookmark()}async _editBookmarkAndClose(e,t){const{viewModel:o,viewModel:{defaultEditOptions:i}}=this;await o.editBookmark(e,{...i,...t}),this._closeEditBookmarkForm()}_editBookmarkSubmit(e){e.preventDefault();const{_editInputNode:t,_userState:o,_editIncludeTimeExtent:i,_urlEditInputNode:r}=this;if(!o?.bookmark||!o.editedBookmark)return;o.validationState=void 0,o.customUrl=void 0,o.screenshotUrl=void 0;const a=t?.value.trim();if(!a)return void(o.validationState="name-required");o.bookmark.name=a,o.bookmark.thumbnail=o.editedBookmark.thumbnail,i||(o.bookmark.timeExtent=null);const s=o.thumbnailState;if("url"===s&&r){const e=r.value,t=new c({url:e});if(!t.isSecureUrl)return void(o.validationState="absolute-url-required");o.bookmark.thumbnail=t}else"none"===s&&(o.bookmark.thumbnail=null);this._editBookmarkAndClose(o.bookmark,{takeScreenshot:!1,captureTimeExtent:i})}_storeEditInput(e){this._editInputNode=e}_storeAddInput(e){this._addInputNode=e}_storeUrlEditInput(e){this._urlEditInputNode=e}_deleteBookmark(e){this._closeEditBookmarkForm(),e&&(this.viewModel.bookmarks.remove(e),e.destroy())}_goToBookmark(e){e&&(this.endAddBookmark(),this.viewModel.goTo(e))}async _updateThumbnail(){const{_userState:e,viewModel:t}=this;e&&(e.validationState=void 0,await t.editBookmark(e.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}))}_focusRootFlowItemNode(e){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,requestAnimationFrame((()=>e?.setFocus())))}_focusEditFlowItemNode(e){this._focusEditFlowItem&&(this._focusEditFlowItem=!1,requestAnimationFrame((()=>e?.setFocus())))}_focusAddFlowItemNode(e){this._focusAddFlowItem&&(this._focusAddFlowItem=!1,requestAnimationFrame((()=>e?.setFocus())))}};e([s()],T.prototype,"_editIncludeTimeExtent",void 0),e([s({type:E})],T.prototype,"_userState",void 0),e([s()],T.prototype,"_focusRootFlowItem",void 0),e([s()],T.prototype,"_focusAddFlowItem",void 0),e([s()],T.prototype,"_focusEditFlowItem",void 0),e([s()],T.prototype,"defaultCreateOptions",null),e([s()],T.prototype,"defaultEditOptions",null),e([s()],T.prototype,"bookmarks",null),e([s()],T.prototype,"disabled",void 0),e([s()],T.prototype,"dragEnabled",void 0),e([s()],T.prototype,"editingEnabled",null),e([s()],T.prototype,"filterPlaceholder",void 0),e([s()],T.prototype,"filterText",void 0),e([s()],T.prototype,"headingLevel",void 0),e([s()],T.prototype,"goToOverride",null),e([s()],T.prototype,"icon",null),e([s()],T.prototype,"label",null),e([s(),_("esri/widgets/Bookmarks/t9n/Bookmarks")],T.prototype,"messages",void 0),e([s(),_("esri/t9n/common")],T.prototype,"messagesCommon",void 0),e([s()],T.prototype,"uiStrings",void 0),e([s()],T.prototype,"view",null),e([s({type:p}),B(["select-bookmark","bookmark-edit","bookmark-select"])],T.prototype,"viewModel",void 0),e([s({type:y,nonNullable:!0})],T.prototype,"visibleElements",void 0),e([s()],T.prototype,"endAddBookmark",null),e([s()],T.prototype,"startAddBookmark",null),T=e([n("esri.widgets.Bookmarks")],T);const U=T;export{U as default};
