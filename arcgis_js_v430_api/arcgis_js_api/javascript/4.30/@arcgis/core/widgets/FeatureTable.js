/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import t from"../core/Collection.js";import{watch as o,sync as i,initial as s,on as l}from"../core/reactiveUtils.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import{isLayerFromCatalog as a}from"../layers/catalog/catalogUtils.js";import{b as p}from"../chunks/layerUtils2.js";import c,{l as d}from"./Widget.js";import m from"../core/Accessor.js";import u from"./FeatureTable/FeatureTableViewModel.js";import h from"./FeatureTable/support/FieldColumnTemplate.js";import b from"./FeatureTable/support/TableTemplate.js";import{b as y,u as g,c as v,d as j}from"../chunks/tableUtils.js";import{g as w}from"../chunks/globalCss.js";import{H as f}from"../chunks/Heading.js";import{r as _}from"../chunks/widgetUtils.js";import{m as M}from"../chunks/messageBundle.js";import{v as S}from"../chunks/vmEvent.js";import{t as C}from"../chunks/jsxFactory.js";import{s as k}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/tracking.js";import"../chunks/ensureType.js";import"../chunks/ObservableBase.js";import"../core/scheduling.js";import"../chunks/assets.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/asyncUtils.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/collectionUtils.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/layerViewUtils.js";import"../chunks/selectionUtils.js";import"./FeatureTable/ActionColumn.js";import"./FeatureTable/Grid/Column.js";import"../chunks/uriUtils.js";import"./FeatureTable/AttachmentsColumn.js";import"./FeatureTable/FieldColumn.js";import"../layers/support/CodedValueDomain.js";import"../chunks/enumeration.js";import"../layers/support/Domain.js";import"../chunks/editableLayers.js";import"../chunks/utils2.js";import"../chunks/basemapUtils.js";import"../Basemap.js";import"../core/Loadable.js";import"../chunks/loadAll.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/persistableUrlUtils.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../chunks/utils3.js";import"../chunks/colorUtils.js";import"../chunks/screenUtils.js";import"../chunks/mat4.js";import"./FeatureForm/FieldInput.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/featureUtils.js";import"./FeatureForm/EditableInput.js";import"../chunks/featureFormUtils.js";import"../chunks/compilerUtils.js";import"../chunks/formUtils.js";import"./FeatureForm/InputBase.js";import"./FeatureTable/Grid/EditorColumn.js";import"./FeatureTable/RelationshipColumn.js";import"./FeatureTable/Grid/GroupColumn.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/RelationshipQuery.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../chunks/fieldType.js";import"./FeatureTable/support/ColumnTemplateBase.js";import"./FeatureTable/support/EditableColumnTemplateMixin.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../form/ExpressionInfo.js";import"./FeatureTable/support/ColumnTemplate.js";import"./FeatureTable/support/GroupColumnTemplate.js";let T=class extends m{constructor(e){super(e),this.sortAscending=!0,this.sortDescending=!0}};e([n({type:Boolean,nonNullable:!0})],T.prototype,"sortAscending",void 0),e([n({type:Boolean,nonNullable:!0})],T.prototype,"sortDescending",void 0),T=e([r("esri.widgets.FeatureTable.ColumnMenuVisibleElements")],T);const E=T;let I=class extends m{constructor(e){super(e),this.clearSelection=!0,this.deleteSelection=!0,this.refreshData=!0,this.selectedRecordsShowAllToggle=!0,this.selectedRecordsShowSelectedToggle=!0,this.toggleColumns=!0,this.zoomToSelection=!0}};e([n({type:Boolean,nonNullable:!0})],I.prototype,"clearSelection",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"deleteSelection",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"refreshData",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"selectedRecordsShowAllToggle",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"selectedRecordsShowSelectedToggle",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"toggleColumns",void 0),e([n({type:Boolean,nonNullable:!0})],I.prototype,"zoomToSelection",void 0),I=e([r("esri.widgets.FeatureTable.TableMenuVisibleElements")],I);const A=I;let R=class extends m{constructor(e){super(e),this.columnMenus=!0,this.columnMenuItems=new E,this.close=!1,this.header=!0,this.layerDropdown=!1,this.menu=!0,this.menuItems=new A,this.progress=!0,this.selectionColumn=!0,this.tooltips=!0}};e([n({type:Boolean,nonNullable:!0})],R.prototype,"columnMenus",void 0),e([n({type:E,nonNullable:!0})],R.prototype,"columnMenuItems",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"close",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"header",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"layerDropdown",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"menu",void 0),e([n({type:A,nonNullable:!0})],R.prototype,"menuItems",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"progress",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"selectionColumn",void 0),e([n({type:Boolean,nonNullable:!0})],R.prototype,"tooltips",void 0),R=e([r("esri.widgets.FeatureTable.VisibleElements")],R);const D=R;var F;const x="esri-feature-table",L=`${x}__prompt`,P={base:x,content:`${x}__content`,menuPopover:`${x}__menu-popover`,layerDropdownMenu:`${x}__layer-switcher-menu`,tableContainer:`${x}__table-container`,tableNavigation:`${x}__table-navigation`,expanded:`${x}__expanded`,collapsed:`${x}__collapsed`,promptContainer:L,promptHeader:`${L}__header`,promptHeading:`${L}__header__heading`,promptMessage:`${L}__message`,promptDivider:`${L}__divider`,promptActions:`${L}__actions`};let U=F=class extends c{constructor(e,o){super(e,o),this._columnVisibilityActions=new Map,this._prompt=null,this._showAllTablesEnabled=!1,this.description=null,this.disabled=!1,this.layers=null,this.menuConfig=null,this.relatedTables=new t,this.tableParent=null,this.title=null,this.viewModel=new u,this.visibleElements=new D,this.visibleElementsOverride=null,this._showDeletePrompt=this._showDeletePrompt.bind(this),this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.addHandles([o((()=>[this.viewModel.store.querying,this.viewModel.store.syncing,this.editingEnabled]),(()=>this.scheduleRender())),o((()=>({visibleElements:this._effectiveVisibleElements,items:this.columns.length})),(({visibleElements:e})=>{this.columns.forEach((t=>t.visibleElements=e)),this.refreshCellContent()}),i),o((()=>this._effectiveVisibleElements.selectionColumn),(e=>{this.grid&&(this.grid.selectionColumnEnabled=e)}),s),l((()=>this.viewModel),"show-related-table",(e=>this._onShowRelatedTable(e))),o((()=>this.viewModel.state),(e=>{"disabled"===e&&this.relatedTables.length&&this._drainRelatedTables()}))])}loadDependencies(){return d({action:()=>import("../chunks/calcite-action.js"),button:()=>import("../chunks/calcite-button.js"),dropdown:()=>import("../chunks/calcite-dropdown.js"),"dropdown-group":()=>import("../chunks/calcite-dropdown-group.js"),"dropdown-item":()=>import("../chunks/calcite-dropdown-item.js"),icon:()=>import("../chunks/calcite-icon.js"),label:()=>import("../chunks/calcite-label.js"),list:()=>import("../chunks/calcite-list.js"),"list-item":()=>import("../chunks/calcite-list-item.js"),panel:()=>import("../chunks/calcite-panel.js"),popover:()=>import("../chunks/calcite-popover.js"),progress:()=>import("../chunks/calcite-progress.js"),scrim:()=>import("../chunks/calcite-scrim.js"),switch:()=>import("../chunks/calcite-switch.js"),tooltip:()=>import("../chunks/calcite-tooltip.js"),"action-bar":()=>import("../chunks/calcite-action-bar.js"),"input-date-picker":()=>import("../chunks/calcite-input-date-picker.js"),"input-time-picker":()=>import("../chunks/calcite-input-time-picker.js"),"input-time-zone":()=>import("../chunks/calcite-input-time-zone.js")})}destroy(){this._drainRelatedTables(),this._clearPrompt()}get _effectiveDescription(){const{description:e}=this;return null!=e?_.sanitize("function"==typeof e?e():e):void 0}get _effectiveLayers(){const{layer:e,layers:t}=this,o=t?.length?t.filter(y):[],i=o.length?o:[...this._viewLayers];return e&&!i.includes(e)&&i.push(e),i}get _effectiveTable(){return this.relatedTable||this}get _effectiveTitle(){const{layer:e,messages:t,state:o,highlightIds:i,title:s,viewModel:l}=this;if(s)return _.sanitize("function"==typeof s?s():s);if(!e)return t.noLayer;switch(o){case"disabled":return t.errorLayer;case"ready":case"loading":return t.loading;case"error":return t.errorData}return k(t.header,{title:_.sanitize(e.title),count:l.size,selected:i.length})}get _effectiveVisibleElements(){return this.visibleElementsOverride??this.visibleElements}get _hasCustomMenuItems(){return!!this.menuConfig?.items?.length}get _hasDefaultMenuItems(){return!!(this._showClearSelectionAction||this._showDeleteSelectionAction||this._showRefreshDataAction||this._showZoomToSelectionAction||this._showSelectedRecordsShowSelectedAction||this._showSelectedRecordsShowAllAction||this._showColumnsVisibilityAction)}get _shouldShowMenu(){const{header:e,menu:t}=this._effectiveVisibleElements;return!(!e||!t||!this._hasDefaultMenuItems&&!this._hasCustomMenuItems)}get _showClearSelectionAction(){return!(!this.highlightIds.length||!this._effectiveVisibleElements.menuItems?.clearSelection||this.relatedTables.length)}get _showColumnsVisibilityAction(){const{header:e,menu:t,menuItems:o}=this._effectiveVisibleElements;return!(!(e&&t&&o?.toggleColumns)||this.showRelatedTableCallback||this._showAllTablesEnabled)}get _showDeleteSelectionAction(){return!(!(this.editingEnabled&&this.highlightIds.length&&this._effectiveVisibleElements.menuItems?.deleteSelection&&this.layer?.capabilities?.operations?.supportsDelete)||this.relatedTables.length)}get _showLayerDropdown(){return!(!this._effectiveLayers.length||!this._effectiveVisibleElements.layerDropdown)}get _showRefreshDataAction(){return!!this._effectiveVisibleElements.menuItems?.refreshData}get _showSelectedRecordsShowSelectedAction(){const e=this.objectIds.length,t=this.highlightIds.length;return!(!t||!this._effectiveVisibleElements.menuItems?.selectedRecordsShowSelectedToggle||e&&t===e||this.relatedTables.length)}get _showSelectedRecordsShowAllAction(){return!(!this._effectiveVisibleElements.menuItems?.selectedRecordsShowAllToggle||!this.objectIds.length||this.relatedTables.length)}get _showZoomToSelectionAction(){return!(!this.view||!this.highlightIds.length||this._effectiveTable.layer?.isTable||!this._effectiveVisibleElements.menuItems?.zoomToSelection)}get _viewLayers(){const e=this.view?.map;if(!e)return[];const t=new Set,o=e=>{y(e)&&!t.has(e)&&t.add(e)},i=e=>{a(e)||"catalog-footprint"===e.type||(p(e)?(e.layers?.forEach(o),e.tables?.forEach(o)):j(e)?(e.sublayers?.forEach(o),e.subtables?.forEach(o)):o(e))};return e.allLayers.forEach(i),e.allTables.forEach(i),[...t.values()]}get actionColumnConfig(){return this.viewModel.actionColumnConfig}set actionColumnConfig(e){this.viewModel.actionColumnConfig=e}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(e){this.viewModel.attachmentsEnabled=e}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(e){this.viewModel.autoRefreshEnabled=e}get columnPerformanceModeEnabled(){return this.viewModel.columnPerformanceModeEnabled}set columnPerformanceModeEnabled(e){this.viewModel.columnPerformanceModeEnabled=e}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(e){this.viewModel.columnReorderingEnabled=e}get columns(){return this.viewModel.columns}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(e){this.viewModel.editingEnabled=e}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(e){this.viewModel.filterGeometry=e}get filterBySelectionEnabled(){return this.viewModel.filterBySelectionEnabled}set filterBySelectionEnabled(e){this.viewModel.filterBySelectionEnabled=e}get grid(){return this.viewModel.grid}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(e){this.viewModel.hiddenFields=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(e){this.viewModel.highlightIds=e}get icon(){return"table"}set icon(e){this._overrideIfSome("icon",e)}get isQueryingOrSyncing(){return this.viewModel.isQueryingOrSyncing||this.relatedTables.some((e=>!!e.isQueryingOrSyncing))}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this._drainRelatedTables(),this.viewModel.layer=e}get layerView(){return this.viewModel.layerView}get messages(){return this.viewModel.messages}set messages(e){this.viewModel.messages=e}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(e){this.viewModel.messagesCommon=e}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(e){this.viewModel.messagesURIUtils=e}get multipleSelectionEnabled(){return this.viewModel.multipleSelectionEnabled}set multipleSelectionEnabled(e){this.viewModel.multipleSelectionEnabled=e}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(e){this.viewModel.multiSortEnabled=e}get objectIds(){return this.viewModel.objectIds}set objectIds(e){this.viewModel.objectIds=e}get pageSize(){return this.viewModel.pageSize}set pageSize(e){this.viewModel.pageSize=e}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(e){this.viewModel.relatedRecordsEnabled=e}get relatedTable(){return this.relatedTables.at(-1)}get relationship(){return this.viewModel.relationship}get relationshipColumnConfigs(){return this.viewModel.relationshipColumnConfigs}set relationshipColumnConfigs(e){this.viewModel.relationshipColumnConfigs=e}get relationshipConfig(){return this.viewModel.relationshipConfig}set relationshipConfig(e){this.viewModel.relationshipConfig=e}get returnGeometryEnabled(){return this.viewModel.returnGeometryEnabled}set returnGeometryEnabled(e){this.viewModel.returnGeometryEnabled=e}get returnMEnabled(){return this.viewModel.returnMEnabled}set returnMEnabled(e){this.viewModel.returnMEnabled=e}get returnZEnabled(){return this.viewModel.returnZEnabled}set returnZEnabled(e){this.viewModel.returnZEnabled=e}get rowHighlightIds(){return this.viewModel.rowHighlightIds}set rowHighlightIds(e){this.viewModel.rowHighlightIds=e}get selectionSource(){return this.viewModel.selectionSource}set selectionSource(e){this.viewModel.selectionSource=e}get showRelatedTableCallback(){return this.viewModel.showRelatedTableCallback}set showRelatedTableCallback(e){this.viewModel.showRelatedTableCallback=e}get size(){return this.viewModel.size}get state(){return this.viewModel.state}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(e){this.viewModel.tableTemplate=e}get tableTemplateOverride(){return this.viewModel.tableTemplateOverride}set tableTemplateOverride(e){this.viewModel.tableTemplateOverride=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clearSelectionFilter(){this.viewModel.clearSelectionFilter()}deleteSelection(e){return this.highlightIds.length?e?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}filterBySelection(){this.viewModel.filterBySelection()}findColumn(e){return this.viewModel.findColumn(e)}hideColumn(e){this.grid?.hideColumn(e)}async refresh(){this.relatedTables.forEach((async e=>await e.refresh())),await this.viewModel.refresh()}refreshCellContent(){this.viewModel.refreshCellContent()}showAllColumns(){this.viewModel.showAllColumns()}showColumn(e){this.grid?.showColumn(e)}sortColumn(e,t){this.viewModel.sortColumn(e,t)}scrollToIndex(e){this.viewModel.scrollToIndex(e)}toggleColumnVisibility(e){this.viewModel.toggleColumnVisibility(e)}zoomToSelection(){this._effectiveTable.viewModel.zoomToSelection()}render(){const{_prompt:e,_effectiveVisibleElements:t,isQueryingOrSyncing:o,menuConfig:i,state:s}=this;return C("div",{bind:this,class:this.classes(P.base,w.widget)},C("calcite-panel",{bind:this,class:P.content,closable:t.close,description:this._effectiveDescription,disabled:this.disabled||"disabled"===s,heading:t.header?this._effectiveTitle:void 0,loading:"loading"===s,menuOpen:!!i?.open,overlayPositioning:"fixed",onCalcitePanelClose:e=>{e.target.closed=!1,this.emit("close")}},t.progress?C("calcite-progress",{type:o?"indeterminate":"determinate"}):null,this._showLayerDropdown?this._renderLayerDropdown():null,this._renderColumnVisibilityAction(),this._renderHeaderMenuActions(),this._renderRelatedTableNavigationBar(),C("div",{class:P.tableContainer},this._renderTables())),e?C("calcite-scrim",null,this._renderPrompt(e)):null)}_renderTables(){const{_showAllTablesEnabled:e,grid:t,relatedTables:o}=this;if(o.length){const i=o.toArray(),s=1===i.length,l=this.classes(P.base,e?P.expanded:P.collapsed),n=e||s,r=e?i:s?[i[0]]:i.slice(-2);return C("calcite-panel",{overlayPositioning:"fixed"},C("div",null,[n?C("div",{class:l},t?.render()):void 0,...r.map((e=>{const t=o.indexOf(e);return C("div",{class:l,key:`related-${t}`},e.render())})),,]))}return t?.render()}_clearPrompt(){this._prompt=null}_renderPrompt({title:e,message:t,context:o,actions:i}){const s=C("calcite-button",{appearance:"solid",key:"prompt-primary-button",kind:"danger"===o?"danger":"brand",onclick:i.primary.action,width:i.secondary?"half":"full"},i.primary.label),l=i.secondary?C("calcite-button",{appearance:"outline",key:"prompt-secondary-button",kind:"danger"===o?"danger":"brand",onclick:i.secondary.action,width:"half"},i.secondary.label):null;return C("div",{class:`${P.promptContainer}--${o}`},C("div",{class:P.promptHeader},C("calcite-icon",{icon:"exclamation-mark-triangle"}),C(f,{class:P.promptHeading,level:2},e)),C("div",{class:P.promptMessage},t),C("div",{class:P.promptDivider}),C("div",{class:P.promptActions},l,s))}_showDeletePrompt(){const{messages:e,messagesCommon:t}=this,o=k(e.deleteSelectionCount,{count:this.highlightIds.length});this._prompt={title:o,message:e.deleteRecordsRemoved,context:"danger",actions:{primary:{label:t.delete,action:this._onDeleteSelectionClick},secondary:{label:e.keepRecords,action:()=>this._clearPrompt()}}}}async _onDeleteSelectionClick(){try{await this.viewModel.deleteSelection()}finally{this._clearPrompt()}}_renderHeaderMenuAction(e){const{disabled:t,hidden:o,icon:i,text:s,clickFunction:l}=e;if(!o)return C("calcite-action",{disabled:t??this.menuConfig?.disabled,icon:i??void 0,key:s,onclick:()=>l(),slot:"header-menu-actions",text:s,textEnabled:!0,title:s})}_renderHeaderMenuActions(){return this._shouldShowMenu?[this._renderDefaultHeaderMenuActions(),this._renderCustomHeaderMenuActions()]:[]}_renderDefaultHeaderMenuActions(){if(!this._hasDefaultMenuItems)return[];const{messages:e}=this,t=[];return this._showRefreshDataAction&&t.push(this._renderHeaderMenuAction({icon:"refresh",text:e.refreshData,clickFunction:()=>this.refresh()})),this._showDeleteSelectionAction&&t.push(this._renderHeaderMenuAction({icon:"trash",text:e.deleteSelection,clickFunction:()=>this.deleteSelection(!0)})),this._showClearSelectionAction&&t.push(this._renderHeaderMenuAction({icon:"clear-selection",text:e.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()})),this._showZoomToSelectionAction&&t.push(this._renderHeaderMenuAction({icon:"zoom-to-object",text:e.zoomToSelection,clickFunction:()=>this.zoomToSelection()})),this._showSelectedRecordsShowSelectedAction&&t.push(this._renderHeaderMenuAction({icon:"selection-filter",text:e.showSelected,clickFunction:()=>{const{objectIds:e}=this;e.removeAll(),e.addMany(this.highlightIds.toArray())}})),this._showSelectedRecordsShowAllAction&&t.push(this._renderHeaderMenuAction({icon:"selection-x",text:e.showAllRecords,clickFunction:()=>this.objectIds.removeAll()})),t}_renderCustomHeaderMenuActions(){return this.menuConfig?.items?.map((({disabled:e,hidden:t,icon:o,label:i,clickFunction:s})=>this._renderHeaderMenuAction({hidden:"function"==typeof t?t():t,icon:o,text:i,disabled:e,clickFunction:e=>s(e)})))??[]}_renderColumnVisibilityAction(){if(!this._showColumnsVisibilityAction)return[];const{_columnVisibilityActions:e,_effectiveTable:t,_effectiveVisibleElements:o,id:i,messages:s}=this,l=t.columns.toArray(),n=s?.toggleColumns,r=`${i}__toggle-columns-action`,a=[C("calcite-action",{afterCreate:t=>e.set(i,t),afterRemoved:()=>e.delete(i),appearance:"transparent",bind:this,disabled:t.menuConfig?.disabled,icon:"show-column",id:r,slot:"header-actions-end",text:n},o.tooltips?C("calcite-tooltip",{closeOnClick:!0,overlayPositioning:"fixed",placement:"bottom-end",slot:"tooltip"},n):null)];return t.menuConfig?.disabled||a.push(C("calcite-popover",{autoClose:!0,class:P.menuPopover,label:n,overlayPositioning:"fixed",placement:"top-end",pointerDisabled:!0,referenceElement:e.get(i)},C("calcite-list",{filterEnabled:!0,filterPlaceholder:s.toggleColumns,selectionMode:"multiple"},...l.map((e=>{const o="columns"in e&&e.columns?.length?e.columns.map((e=>this._renderColumnListItem({column:e,table:t,ignoreSelect:!0}))):void 0;return this._renderColumnListItem({column:e,table:t,items:o})}))))),a}_renderColumnListItem(e){const{column:t,table:o,items:i,ignoreSelect:s}=e,{effectiveLabel:l,fieldName:n,hidden:r}=t;return C("calcite-list-item",{key:`toggle-columns__item-${n}`,label:l,open:!(!i?.length||r)||void 0,selected:!r,value:n,onCalciteListItemSelect:e=>{s||o.toggleColumnVisibility(e.target.value)}},i)}_renderLayerDropdown(){const e=this.messages.selectALayer;return C("div",{class:P.layerDropdownMenu,key:`${this.id}-layerDropdown`,slot:"header-actions-start"},C("calcite-dropdown",{bind:this,maxItems:5,overlayPositioning:"fixed",placement:"bottom-start"},C("calcite-action",{icon:"layers",slot:"trigger",text:e,title:e}),C("calcite-dropdown-group",{selectionMode:"single"},this._effectiveLayers.map(((e,t)=>this._renderLayerDropdownItem(e,t)))??null)))}_renderLayerDropdownItem(e,t){return C("calcite-dropdown-item",{key:`dropdown-item-${t}`,label:e.title??"",selected:e===this.layer,value:e.id,onCalciteDropdownItemSelect:()=>{this.layer=e}},e.title)}_onShowRelatedTable(e){this.showRelatedTableCallback||(this._collapseRelatedTable(this._effectiveTable,e),this._createRelatedTable(e))}_renderRelatedTableNavigationBar(){const{messages:e}=this,t=e.exitRelatedRecords;if(this.relatedTables.length&&!this.showRelatedTableCallback)return C("div",{class:P.tableNavigation,key:"table-nav"},C("calcite-action",{icon:"move-up",iconFlipRtl:!0,key:t,onclick:()=>this._drainRelatedTables(),text:t,title:t}),this.relatedTables.toArray().map(((e,t)=>this._renderRelatedTableNavigationAction(e,t))),C("div",null,C("calcite-label",{layout:"inline"},e.showAllTables,C("calcite-switch",{checked:this._showAllTablesEnabled,onCalciteSwitchChange:e=>{const t=!!e.target.checked,o=this.relatedTable;this._showAllTablesEnabled=t,o&&(t?this._enterShowAllView(o):this._exitShowAllView(o))}}))))}_renderRelatedTableNavigationAction(e,t){const o=this._getLabelForRelatedTableNavigationAction(e);return C("calcite-action",{icon:"chevron-right",iconFlipRtl:!0,key:t,onclick:()=>this._drainRelatedTablesAboveIndex(t),text:o,textEnabled:!0,title:e.layer?.title||""})}_getLabelForRelatedTableNavigationAction(e){const t=e.layer?.title;if(!t)return"";const{relatedTables:o}=this;return o.length<=1?t:o.indexOf(e)!==o.length-1&&t.length>20?`${t.slice(0,20)}...`:t}_drainRelatedTables(){this.relatedTables.drain((e=>!e.destroyed&&e.destroy())),this.set({_showAllTablesEnabled:!1,multipleSelectionEnabled:!0,tableTemplateOverride:null,relationshipColumnConfigs:null,visibleElementsOverride:null}),this.hiddenFields.removeMany([g.action,g.attachments])}_drainRelatedTablesAboveIndex(e){const t=this.relatedTables,o=t.filter(((t,o)=>o>e));o.forEach((e=>!e.destroyed&&e.destroy())),t.removeMany(o);const i=t.at(-1);if(!i?.layer||!i?.relationship)return;const{layer:s,relationship:l}=i;this._showAllTablesEnabled?this._enterShowAllView(i):i.set({multipleSelectionEnabled:!0,tableTemplateOverride:null,relationshipColumnConfigs:this._getRelationshipIdsToShow(s,l.id),visibleElementsOverride:null}),i.hiddenFields.removeMany([g.action,g.attachments])}_getRelatedTableMenuItemConfig(e,t,o){return t.fields.map((({alias:i,name:s})=>({selected:s===o,label:i||s,clickFunction:o=>{o.stopPropagation(),e.tableTemplateOverride=new b({columnTemplates:[this._createRelatedFieldColumnTemplate(e,t,s)]})}})))}_createRelatedFieldColumnTemplate(e,t,o){return new h({fieldName:o,editable:!1,menuConfig:{selectionMode:"single",icon:"chevron-down",items:this._getRelatedTableMenuItemConfig(e,t,o)},resizable:!1})}_enterShowAllView(e){const t=e.layer;if(!t)return;const o=e===this,{visibleElements:i}=e,s=t.displayField||t.objectIdField;e.set({relationshipColumnConfigs:[],tableTemplateOverride:new b({columnTemplates:[this._createRelatedFieldColumnTemplate(e,t,s)]}),visibleElementsOverride:new D({header:o&&i.header,progress:o&&i.progress,columnMenus:i.columnMenus,close:i.close,tooltips:i.tooltips,selectionColumn:!1,columnMenuItems:new E({sortAscending:!1,sortDescending:!1})})}),e.hiddenFields.addMany([g.action,g.attachments])}_exitShowAllView(e){const{layer:t,relationship:o}=e;t&&null!=o?.id&&(e.set({relationshipColumnConfigs:this._getRelationshipIdsToShow(t,o.id),tableTemplateOverride:null,visibleElementsOverride:null}),e.hiddenFields.removeMany([g.action,g.attachments]))}_collapseRelatedTable(e,o){const{relatedLayer:i,feature:s,relationshipId:l}=o,n=i.relationships?.find((({id:e})=>e===l)),{objectIdField:r}=i,a=i.displayField||n?.keyField||r,p=s.getObjectId()??s.attributes[r],c=e===this,{close:d,columnMenus:m,header:u,layerDropdown:h,menu:y,menuItems:v,progress:j,tooltips:w}=e.visibleElements;e.set({highlightIds:new t([p]),multipleSelectionEnabled:!1,relationshipColumnConfigs:[{relationshipId:l,collapsed:!0}],tableTemplateOverride:new b({columnTemplates:[this._createRelatedFieldColumnTemplate(e,i,a)]}),visibleElementsOverride:new D({header:c&&u,progress:c&&j,columnMenus:m,close:d,layerDropdown:h,menu:y,menuItems:v,tooltips:w,selectionColumn:!1,columnMenuItems:new E({sortAscending:!1,sortDescending:!1})})}),e.hiddenFields.addMany([g.action,g.attachments]),e.grid?.scrollLeft(0)}_getRelationshipIdsToShow(e,t){return(e.relationships??[]).filter((e=>!(e.id===t&&"one-to-one"===e.cardinality))).map((({id:e})=>({relationshipId:e})))}async _createRelatedTable(e){const{editingEnabled:t,relatedTables:o,view:i,viewModel:s}=this,{layer:n,feature:r,relatedLayer:a,relationshipId:p}=e,c=r.getObjectId()??r.attributes[a.objectIdField],d=o.length,m=d?o.getItemAt(d-1):this;await n.load();const u=this.attachmentsEnabled&&v(n),h=new F({layer:n,attachmentsEnabled:u,editingEnabled:t,relatedRecordsEnabled:!0,relationshipConfig:{objectId:c,relatedLayer:a,relationshipId:p},relationshipColumnConfigs:this._getRelationshipIdsToShow(n,p),tableParent:m,view:i,visibleElements:new D({header:!1,progress:!1}),showRelatedTableCallback:({feature:e,layer:t,relatedLayer:o,relationshipId:i})=>{null!=(e.getObjectId()??e.attributes[o.objectIdField])&&s.emit("show-related-table",{feature:e,layer:t,relatedLayer:o,relationshipId:i})}});h.addHandles([l((()=>m.highlightIds),"change",(({added:e})=>{const t=e[0];null!=t&&(h.highlightIds.removeAll(),h.relationshipConfig={objectId:t,relatedLayer:a,relationshipId:p})})),l((()=>m),"cell-click",(e=>{const{feature:t}=e;if(t){const e=t.getObjectId()??t.attributes[a.objectIdField];null!=e&&m.highlightIds.add(e)}}))]),this.relatedTables.add(h),this.scheduleRender()}};e([n()],U.prototype,"_columnVisibilityActions",void 0),e([n()],U.prototype,"_effectiveDescription",null),e([n()],U.prototype,"_effectiveLayers",null),e([n()],U.prototype,"_effectiveTable",null),e([n()],U.prototype,"_effectiveTitle",null),e([n()],U.prototype,"_effectiveVisibleElements",null),e([n()],U.prototype,"_hasCustomMenuItems",null),e([n()],U.prototype,"_hasDefaultMenuItems",null),e([n()],U.prototype,"_prompt",void 0),e([n()],U.prototype,"_shouldShowMenu",null),e([n()],U.prototype,"_showAllTablesEnabled",void 0),e([n()],U.prototype,"_showClearSelectionAction",null),e([n()],U.prototype,"_showColumnsVisibilityAction",null),e([n()],U.prototype,"_showDeleteSelectionAction",null),e([n()],U.prototype,"_showLayerDropdown",null),e([n()],U.prototype,"_showRefreshDataAction",null),e([n()],U.prototype,"_showSelectedRecordsShowSelectedAction",null),e([n()],U.prototype,"_showSelectedRecordsShowAllAction",null),e([n()],U.prototype,"_showZoomToSelectionAction",null),e([n()],U.prototype,"_viewLayers",null),e([n()],U.prototype,"actionColumnConfig",null),e([n({readOnly:!0})],U.prototype,"activeFilters",null),e([n({readOnly:!0})],U.prototype,"activeSortOrders",null),e([n()],U.prototype,"attachmentsEnabled",null),e([n()],U.prototype,"autoRefreshEnabled",null),e([n()],U.prototype,"columnPerformanceModeEnabled",null),e([n()],U.prototype,"columnReorderingEnabled",null),e([n({readOnly:!0})],U.prototype,"columns",null),e([n()],U.prototype,"description",void 0),e([n()],U.prototype,"disabled",void 0),e([n()],U.prototype,"editingEnabled",null),e([n()],U.prototype,"filterGeometry",null),e([n()],U.prototype,"filterBySelectionEnabled",null),e([n({readOnly:!0})],U.prototype,"grid",null),e([n()],U.prototype,"hiddenFields",null),e([n()],U.prototype,"highlightEnabled",null),e([n()],U.prototype,"highlightIds",null),e([n()],U.prototype,"icon",null),e([n()],U.prototype,"isQueryingOrSyncing",null),e([n()],U.prototype,"label",null),e([n()],U.prototype,"layer",null),e([n()],U.prototype,"layers",void 0),e([n()],U.prototype,"layerView",null),e([n(),M("esri/widgets/FeatureTable/t9n/FeatureTable")],U.prototype,"messages",null),e([n(),M("esri/t9n/common")],U.prototype,"messagesCommon",null),e([n(),M("esri/widgets/support/t9n/uriUtils")],U.prototype,"messagesURIUtils",null),e([n()],U.prototype,"menuConfig",void 0),e([n()],U.prototype,"multipleSelectionEnabled",null),e([n()],U.prototype,"multiSortEnabled",null),e([n()],U.prototype,"objectIds",null),e([n()],U.prototype,"pageSize",null),e([n()],U.prototype,"relatedRecordsEnabled",null),e([n()],U.prototype,"relatedTable",null),e([n()],U.prototype,"relatedTables",void 0),e([n()],U.prototype,"relationship",null),e([n()],U.prototype,"relationshipColumnConfigs",null),e([n()],U.prototype,"relationshipConfig",null),e([n()],U.prototype,"returnGeometryEnabled",null),e([n()],U.prototype,"returnMEnabled",null),e([n()],U.prototype,"returnZEnabled",null),e([n()],U.prototype,"rowHighlightIds",null),e([n()],U.prototype,"selectionSource",null),e([n()],U.prototype,"showRelatedTableCallback",null),e([n()],U.prototype,"size",null),e([n({readOnly:!0})],U.prototype,"state",null),e([n({constructOnly:!0})],U.prototype,"tableParent",void 0),e([n()],U.prototype,"tableTemplate",null),e([n()],U.prototype,"tableTemplateOverride",null),e([n()],U.prototype,"title",void 0),e([n()],U.prototype,"timeExtent",null),e([n()],U.prototype,"timeZone",null),e([n()],U.prototype,"view",null),e([n({type:u}),S(["cell-click","cell-pointerover","cell-pointerout","cell-keydown","show-related-table"])],U.prototype,"viewModel",void 0),e([n({type:D,nonNullable:!0})],U.prototype,"visibleElements",void 0),e([n({type:D})],U.prototype,"visibleElementsOverride",void 0),U=F=e([r("esri.widgets.FeatureTable")],U);const O=U;export{O as default};
