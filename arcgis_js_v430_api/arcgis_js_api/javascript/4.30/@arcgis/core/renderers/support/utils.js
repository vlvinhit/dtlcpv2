/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{u as s,i as o}from"../../core/lang.js";import{L as t}from"../../chunks/Logger.js";import{g as e}from"../../chunks/ensureType.js";import{c as i,f as l}from"../../chunks/date.js";import{isTimeOnlyField as r}from"../../layers/support/fieldUtils.js";import{f as a,r as n}from"../../chunks/numberUtils.js";import m from"../visualVariables/support/ColorStop.js";import{i as p,f as u}from"../../chunks/utils2.js";import{k as c}from"../../chunks/utils11.js";import{getRampStops as y}from"../../chunks/colorRampUtils2.js";import j from"./HeatmapColorStop.js";import"../../config.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/handleUtils.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/datetime.js";import"../../core/Error.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../core/sql.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/tslib.es6.js";import"../../chunks/assets.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/basemapUtils.js";import"../../Basemap.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/collectionUtils.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../chunks/loadAll.js";import"../../chunks/asyncUtils.js";import"../../portal/Portal.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../chunks/persistableUrlUtils.js";import"../../support/BasemapStyle.js";import"../../chunks/writeUtils.js";import"../../chunks/layerUtils2.js";import"../../chunks/utils3.js";import"../../chunks/screenUtils.js";import"../../chunks/mat4.js";import"../../symbols.js";import"../../symbols/CIMSymbol.js";import"../../chunks/enumeration.js";import"../../symbols/Symbol.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils4.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../core/reactiveUtils.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/_commonjsHelpers.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils7.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/utils14.js";import"../../chunks/timeUtils.js";function f(s){if(!s.colorStops)return[];const o=[...s.colorStops].filter((s=>s.color?.a>0));let t=o.length-1;if(o&&o[0]){const s=o[t];s&&1!==s.ratio&&(o.push(new j({ratio:1,color:s.color})),t++)}return o.map(((o,e)=>{let i="";return 0===e?i=s.legendOptions?.minLabel||"low":e===t&&(i=s.legendOptions?.maxLabel||"high"),{color:o.color,label:i,ratio:o.ratio}})).reverse()}const d={lte:"<=",gte:">=",lt:"<",gt:">",pct:"%",ld:"â€“"},b={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},h={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"},k=i("short-date");async function g(s,o,t){e(s,o,(()=>[])).push(...t)}async function S(o){const t=new Map;if(!o)return t;if("visualVariables"in o&&o.visualVariables){const s=o.visualVariables.filter((s=>"color"===s.type));for(const o of s){const s=(await y(o)??[]).map((s=>s.color));await g(t,o.field||o.valueExpression,s)}}if("heatmap"===o.type){const s=f(o).map((s=>s.color));await g(t,o.field||o.valueExpression,s)}else if("pie-chart"===o.type){for(const s of o.attributes)await g(t,s.field||s.valueExpression,[s.color]);await g(t,"default",[o?.othersCategory?.color,c(o.backgroundFillSymbol,null)])}else if("dot-density"===o.type){for(const s of o.attributes)await g(t,s.field||s.valueExpression,[s.color]);await g(t,"default",[o.backgroundColor])}else if("unique-value"===o.type)if("predominance"===o.authoringInfo?.type)for(const s of o.uniqueValueInfos??[])await g(t,s.value.toString(),[c(s.symbol,null)]);else{const s=(o.uniqueValueInfos??[]).map((s=>c(s.symbol,null))),{field:e,field2:i,field3:l,valueExpression:r}=o;(e||r)&&await g(t,e||r,s),i&&await g(t,i,s),l&&await g(t,l,s)}else if("class-breaks"===o.type){const s=o.classBreakInfos.map((s=>c(s.symbol,null))),{field:e,valueExpression:i}=o;await g(t,e??i,s)}else"simple"===o.type&&await g(t,"default",[c(o.symbol,null)]);return"defaultSymbol"in o&&o.defaultSymbol&&await g(t,"default",[c(o.defaultSymbol,null)]),t.forEach(((o,e)=>{const i=s(o.filter(Boolean),((s,o)=>JSON.stringify(s)===JSON.stringify(o)));t.set(e,i)})),t}async function v(s,o,t){const i=e(s,o,(()=>new Map));for(const s of t)i.set(s.value,s.color)}async function U(s){const o=new Map;if(!s)return o;if("unique-value"!==s.type||s.authoringInfo?.type)if("class-breaks"===s.type){const t=s.classBreakInfos.map((s=>({value:s.minValue,color:c(s.symbol,null)}))).reverse(),{field:e,valueExpression:i}=s;await v(o,e??i,t)}else"simple"===s.type&&await v(o,"default",[{value:"default",color:c(s.symbol,null)}]);else{const t=(s.uniqueValueInfos??[]).map((s=>({value:s.value,color:c(s.symbol,null)}))),{field:e,field2:i,field3:l,valueExpression:r,fieldDelimiter:a}=s,n=[e,i,l].filter(Boolean).join(a||"");(n||r)&&await v(o,n||r,t)}if("defaultSymbol"in s&&s.defaultSymbol&&await v(o,"default",[{value:"default",color:c(s.defaultSymbol,null)}]),"visualVariables"in s&&s.visualVariables){const t=s.visualVariables.filter((s=>"color"===s.type));for(const s of t){const t=await y(s)??[];await v(o,s.field||s.valueExpression,t)}}return o}function x(s){const{values:o,colors:t,labelIndexes:e,isDate:i}=s;return o.map(((s,r)=>{let n=null;if(!e||e.includes(r)){const t=i?l(s):a(s);t&&(n=function(s,o,t){let e="";return 0===o?e=d.lt+" ":o===t&&(e=d.gt+" "),e+s}(t,r,o.length-1))}return new m({value:s,color:t[r],label:n})}))}function w(s){let o=s.minValue,t=s.maxValue;const e=s.isFirstBreak?"":d.gt+" ",i="percent-of-total"===s.normalizationType?d.pct:"";return o=null==o?"":a(o),t=null==t?"":a(t),e+o+i+" "+d.ld+" "+t+i}function D(s){const o=s.classBreakInfos,e=s.normalizationType;let i=[];if(o?.length)if("standard-deviation"!==s.classificationMethod)if(s.round){i.push(o[0].minValue);for(const s of o)i.push(s.maxValue);i=n(i),o.forEach(((s,o)=>{s.label=w({minValue:0===o?i[0]:i[o],maxValue:i[o+1],isFirstBreak:0===o,normalizationType:e})}))}else o.forEach(((s,o)=>{s.label=w({minValue:s.minValue,maxValue:s.maxValue,isFirstBreak:0===o,normalizationType:e})}));else t.getLogger("esri.renderers.support.utils").warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")}function L(s){const o=s.map((s=>new Date(s))),t=o.length;let e=1/0,i=null;for(let s=0;s<t-1;s++){const l=o[s];let r=1/0,a=null;for(let e=s+1;e<t;e++){const s=o[e],t=(l.getFullYear()!==s.getFullYear()?"year":l.getMonth()!==s.getMonth()&&"month")||l.getDate()!==s.getDate()&&"day"||l.getHours()!==s.getHours()&&"hour"||l.getMinutes()!==s.getMinutes()&&"minute"||l.getSeconds()!==s.getSeconds()&&"second"||"millisecond",i=b[t];i<r&&(r=i,a=t)}r<e&&(e=r,i=a)}return i}function V(s){const{value:o,domain:t,fieldInfo:e,dateFormatOptions:i}=s;let l=String(o);const n=t&&"codedValues"in t&&t.codedValues?t.getName(o):null;return n?l=n:null!=o&&e&&(p(e)||r(e))?l=u(o,i??{fieldType:e.type}):"number"==typeof o&&(l=a(o)),l}function E(s,o){return"normalizationField"in s&&s.normalizationField?{type:"normalized-field",field:s.field,normalizationField:s.normalizationField}:"field"in s&&s.field?F(s.field):"valueExpression"in s&&s.valueExpression?{type:"expression",expression:s.valueExpression,title:s.valueExpressionTitle,returnType:o}:null}function F(s){return{type:"field",field:s}}function M(t,e){const i=[];if("class-breaks"===t.type||"heatmap"===t.type)i.push(E(t,"number"));else if("unique-value"===t.type){const s=t.authoringInfo;if(s&&"relationship"===s.type){if(s.field1&&s.field2){const o=s.field1.field,t=s.field2.field,e=s.field1.normalizationField,l=s.field2.normalizationField;i.push(E({field:o,normalizationField:e})),i.push(E({field:t,normalizationField:l}))}}else{const s=t.uniqueValueInfos?.[0];let o=null;if(s?.value){const t=typeof s.value;"string"!==t&&"number"!==t||(o=t)}i.push(E(t,o)),[t.field2,t.field3].forEach((s=>s&&i.push(F(s))))}}else"attributes"in t&&t.attributes?.forEach((s=>i.push(E(s,"number"))));const l=e?e(t):"visualVariables"in t?t.visualVariables:null;return l&&l.forEach((s=>i.push(E(s,"number")))),s(i.filter(o),((s,o)=>"field"===s.type&&"field"===o.type?s.field===o.field:"normalized-field"===s.type&&"normalized-field"===o.type?s.field===o.field&&s.normalizationField===o.normalizationField:"expression"===s.type&&"expression"===o.type&&s.expression===o.expression))}export{L as calculateDateFormatInterval,w as createClassBreakLabel,x as createColorStops,V as createUniqueValueLabel,h as dateFormatIntervalOptions,f as g,E as getAttribute,M as getAttributes,U as getColorsForRendererValues,S as getColorsFromRenderer,D as setLabelsForClassBreaks,k as timelineDateFormatOptions};
