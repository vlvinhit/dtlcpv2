/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{c as o}from"../../chunks/asyncUtils.js";import{ignoreAbortErrors as e,isAborted as t,createResolver as s,onAbort as i,o as n}from"../../core/promiseUtils.js";import{m as r}from"../../chunks/handleUtils.js";import{whenOnce as c}from"../../core/reactiveUtils.js";import{waitAnimationFrame as a}from"../../core/scheduling.js";import{c as p}from"../../chunks/screenUtils.js";import{S as l}from"../../chunks/SketchTooltipVisibleElements.js";import"../../chunks/tslib.es6.js";import"../../core/Accessor.js";import"../../core/lang.js";import"../../core/Handles.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObservableBase.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";async function m(l,m,u={}){const f=d.get(l);f&&(f.abort(),await f.promise);const h=o((async function(o){const e=function(o){const{activeComponent:e}=o;return e&&"tooltip"in e&&"activeTooltipInfo"in e&&"destroyed"in e?e:null}(l);if("coordinates"===m?(m="x",l.tooltipOptions.xyMode="coordinates"):"direction"!==m&&"distance"!==m||(l.tooltipOptions.xyMode="direction-distance"),await a(),t(u)||t(o))return;const d=e?.tooltip;if(!d||!e.activeTooltipInfo?.editableFields?.find((o=>o.name===m)))return;const{handle:f,promise:h}=function(o,{hideOnBlur:e=!0}){const t=s();if(!e)return{promise:t.promise,handle:r()};const i=o.contentContainer,c=n(i,"focusout",(({relatedTarget:o})=>{o instanceof HTMLElement&&i.contains(o)||t.resolve()}));return{promise:t.promise,handle:c}}(d,u),j=s(),k=i(u.signal,j.resolve),v=i(o,j.resolve),b=d.position;try{if(l.tooltipOptions.forceEnabled=!0,u.position&&(d.position=p(u.position[0],u.position[1])),await d.enterInputMode(m),t(u)||t(o))return;u.onOpen?.(),await Promise.race([c((()=>e.destroyed||"feedback"===d.content?.mode),u),h,j.promise])}finally{k?.remove(),v?.remove(),f.remove();const o=d.contentContainer.contains(document.activeElement);l.tooltipOptions.enabled?await d.exitInputMode({focusOnView:o}):o&&l.view?.focus(),u.onClose?.(),d.position=b,l.tooltipOptions.forceEnabled=!1}}));return d.set(l,h),h.promise.catch(e).finally((()=>{d.get(l)===h&&d.delete(l)}))}const d=new Map,u={area:!1,distance:!1,direction:!1,elevation:!1,orientation:!1,radius:!1,rotation:!1,scale:!1,size:!1,totalLength:!1,coordinates:!1,helpMessage:!1,header:!1};function f(o){o.tooltipOptions.visibleElements=new l(u)}export{f as hideAllVisibleElements,m as showTooltipAndFocusField};
